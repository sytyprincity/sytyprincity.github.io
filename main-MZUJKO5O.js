var fL=Object.create;var Tx=Object.defineProperty,pL=Object.defineProperties,mL=Object.getOwnPropertyDescriptor,gL=Object.getOwnPropertyDescriptors,_L=Object.getOwnPropertyNames,v_=Object.getOwnPropertySymbols,yL=Object.getPrototypeOf,Ex=Object.prototype.hasOwnProperty,JM=Object.prototype.propertyIsEnumerable;var KM=(l,c,g)=>c in l?Tx(l,c,{enumerable:!0,configurable:!0,writable:!0,value:g}):l[c]=g,Rt=(l,c)=>{for(var g in c||={})Ex.call(c,g)&&KM(l,g,c[g]);if(v_)for(var g of v_(c))JM.call(c,g)&&KM(l,g,c[g]);return l},gr=(l,c)=>pL(l,gL(c));var Uh=(l,c)=>{var g={};for(var p in l)Ex.call(l,p)&&c.indexOf(p)<0&&(g[p]=l[p]);if(l!=null&&v_)for(var p of v_(l))c.indexOf(p)<0&&JM.call(l,p)&&(g[p]=l[p]);return g};var vL=(l,c)=>()=>(c||l((c={exports:{}}).exports,c),c.exports);var xL=(l,c,g,p)=>{if(c&&typeof c=="object"||typeof c=="function")for(let b of _L(c))!Ex.call(l,b)&&b!==g&&Tx(l,b,{get:()=>c[b],enumerable:!(p=mL(c,b))||p.enumerable});return l};var eD=(l,c,g)=>(g=l!=null?fL(yL(l)):{},xL(c||!l||!l.__esModule?Tx(g,"default",{value:l,enumerable:!0}):g,l));var bp=(l,c,g)=>new Promise((p,b)=>{var r=V=>{try{N(g.next(V))}catch(Y){b(Y)}},A=V=>{try{N(g.throw(V))}catch(Y){b(Y)}},N=V=>V.done?p(V.value):Promise.resolve(V.value).then(r,A);N((g=g.apply(l,c)).next())});var Bw=vL((Nw,zw)=>{"use strict";(function(l,c){typeof Nw=="object"&&typeof zw<"u"?zw.exports=c():typeof define=="function"&&define.amd?define(c):(l=typeof globalThis<"u"?globalThis:l||self,l.mapboxgl=c())})(Nw,function(){"use strict";var l,c,g;function p(r,A){if(!l)l=A;else if(!c)c=A;else{var N="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",V={};l(V),g=A(V),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(g.workerUrl=window.URL.createObjectURL(new Blob([N],{type:"text/javascript"})))}}p(["exports"],function(r){var A="3.6.0";let N,V={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(N==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{N=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{N=t}}return N},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!V.API_URL)return null;try{let t=new URL(V.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Y(t){return V.API_URL_REGEX.test(t)}function ve(t){return t.indexOf("mapbox:")===0}function Pe(t){return V.API_CDN_URL_REGEX.test(t)}function tt(t){return V.API_SPRITE_REGEX.test(t)}function rt(t){return V.API_STYLE_REGEX.test(t)&&!tt(t)}let Ot={create:"create",load:"load",fullLoad:"fullLoad"},Jt={mark(t){performance.mark(t)},measure(t,e,n){performance.measure(t,e,n)}};function qt(t){let e=t.name.split("?")[0];return Pe(e)&&e.includes("mapbox-gl.js")?"javascript":Pe(e)&&e.includes("mapbox-gl.css")?"css":function(n){return V.API_FONTS_REGEX.test(n)}(e)?"fontRange":tt(e)?"sprite":rt(e)?"style":function(n){return V.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function Ft(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var rn={},on={};Object.defineProperty(on,"__esModule",{value:!0}),on.setMatrixArrayType=function(t){on.ARRAY_TYPE=Cr=t},on.toRadian=function(t){return t*di},on.equals=function(t,e){return Math.abs(t-e)<=Ln*Math.max(1,Math.abs(t),Math.abs(e))},on.RANDOM=on.ARRAY_TYPE=on.EPSILON=void 0;var Ln=1e-6;on.EPSILON=Ln;var Cr=typeof Float32Array<"u"?Float32Array:Array;on.ARRAY_TYPE=Cr;var Sr=Math.random;on.RANDOM=Sr;var di=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Dn={};function vn(t){return vn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vn(t)}Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.create=function(){var t=new fi.ARRAY_TYPE(4);return fi.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Dn.clone=function(t){var e=new fi.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Dn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Dn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Dn.fromValues=function(t,e,n,o){var s=new fi.ARRAY_TYPE(4);return s[0]=t,s[1]=e,s[2]=n,s[3]=o,s},Dn.set=function(t,e,n,o,s){return t[0]=e,t[1]=n,t[2]=o,t[3]=s,t},Dn.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Dn.invert=function(t,e){var n=e[0],o=e[1],s=e[2],u=e[3],h=n*u-s*o;return h?(t[0]=u*(h=1/h),t[1]=-o*h,t[2]=-s*h,t[3]=n*h,t):null},Dn.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},Dn.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Dn.multiply=yu,Dn.rotate=function(t,e,n){var o=e[0],s=e[1],u=e[2],h=e[3],m=Math.sin(n),y=Math.cos(n);return t[0]=o*y+u*m,t[1]=s*y+h*m,t[2]=o*-m+u*y,t[3]=s*-m+h*y,t},Dn.scale=function(t,e,n){var o=e[1],s=e[2],u=e[3],h=n[0],m=n[1];return t[0]=e[0]*h,t[1]=o*h,t[2]=s*m,t[3]=u*m,t},Dn.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=-n,t[3]=o,t},Dn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Dn.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Dn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Dn.LDU=function(t,e,n,o){return t[2]=o[2]/o[0],n[0]=o[0],n[1]=o[1],n[3]=o[3]-t[2]*n[1],[t,e,n]},Dn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Dn.subtract=vu,Dn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Dn.equals=function(t,e){var n=t[0],o=t[1],s=t[2],u=t[3],h=e[0],m=e[1],y=e[2],x=e[3];return Math.abs(n-h)<=fi.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-m)<=fi.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(s-y)<=fi.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(u-x)<=fi.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))},Dn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Dn.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t},Dn.sub=Dn.mul=void 0;var fi=function(t,e){if(t&&t.__esModule)return t;if(t===null||vn(t)!=="object"&&typeof t!="function")return{default:t};var n=ga(void 0);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=s?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(on);function ga(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ga=function(o){return o?n:e})(t)}function yu(t,e,n){var o=e[0],s=e[1],u=e[2],h=e[3],m=n[0],y=n[1],x=n[2],T=n[3];return t[0]=o*m+u*y,t[1]=s*m+h*y,t[2]=o*x+u*T,t[3]=s*x+h*T,t}function vu(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}Dn.mul=yu,Dn.sub=vu;var Pn={};function kl(t){return kl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kl(t)}Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.create=function(){var t=new Si.ARRAY_TYPE(6);return Si.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},Pn.clone=function(t){var e=new Si.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},Pn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},Pn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},Pn.fromValues=function(t,e,n,o,s,u){var h=new Si.ARRAY_TYPE(6);return h[0]=t,h[1]=e,h[2]=n,h[3]=o,h[4]=s,h[5]=u,h},Pn.set=function(t,e,n,o,s,u,h){return t[0]=e,t[1]=n,t[2]=o,t[3]=s,t[4]=u,t[5]=h,t},Pn.invert=function(t,e){var n=e[0],o=e[1],s=e[2],u=e[3],h=e[4],m=e[5],y=n*u-o*s;return y?(t[0]=u*(y=1/y),t[1]=-o*y,t[2]=-s*y,t[3]=n*y,t[4]=(s*m-u*h)*y,t[5]=(o*h-n*m)*y,t):null},Pn.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},Pn.multiply=Fl,Pn.rotate=function(t,e,n){var o=e[0],s=e[1],u=e[2],h=e[3],m=e[4],y=e[5],x=Math.sin(n),T=Math.cos(n);return t[0]=o*T+u*x,t[1]=s*T+h*x,t[2]=o*-x+u*T,t[3]=s*-x+h*T,t[4]=m,t[5]=y,t},Pn.scale=function(t,e,n){var o=e[1],s=e[2],u=e[3],h=e[4],m=e[5],y=n[0],x=n[1];return t[0]=e[0]*y,t[1]=o*y,t[2]=s*x,t[3]=u*x,t[4]=h,t[5]=m,t},Pn.translate=function(t,e,n){var o=e[0],s=e[1],u=e[2],h=e[3],m=e[4],y=e[5],x=n[0],T=n[1];return t[0]=o,t[1]=s,t[2]=u,t[3]=h,t[4]=o*x+u*T+m,t[5]=s*x+h*T+y,t},Pn.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=-n,t[3]=o,t[4]=0,t[5]=0,t},Pn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},Pn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},Pn.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},Pn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},Pn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},Pn.subtract=Ps,Pn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},Pn.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t},Pn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},Pn.equals=function(t,e){var n=t[0],o=t[1],s=t[2],u=t[3],h=t[4],m=t[5],y=e[0],x=e[1],T=e[2],I=e[3],M=e[4],S=e[5];return Math.abs(n-y)<=Si.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-x)<=Si.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-T)<=Si.EPSILON*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(u-I)<=Si.EPSILON*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(h-M)<=Si.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(m-S)<=Si.EPSILON*Math.max(1,Math.abs(m),Math.abs(S))},Pn.sub=Pn.mul=void 0;var Si=function(t,e){if(t&&t.__esModule)return t;if(t===null||kl(t)!=="object"&&typeof t!="function")return{default:t};var n=xu(void 0);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=s?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(on);function xu(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(xu=function(o){return o?n:e})(t)}function Fl(t,e,n){var o=e[0],s=e[1],u=e[2],h=e[3],m=e[4],y=e[5],x=n[0],T=n[1],I=n[2],M=n[3],S=n[4],R=n[5];return t[0]=o*x+u*T,t[1]=s*x+h*T,t[2]=o*I+u*M,t[3]=s*I+h*M,t[4]=o*S+u*R+m,t[5]=s*S+h*R+y,t}function Ps(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}Pn.mul=Fl,Pn.sub=Ps;var wn={};function _a(t){return _a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_a(t)}Object.defineProperty(wn,"__esModule",{value:!0}),wn.create=function(){var t=new Ar.ARRAY_TYPE(9);return Ar.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},wn.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},wn.clone=function(t){var e=new Ar.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},wn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},wn.fromValues=function(t,e,n,o,s,u,h,m,y){var x=new Ar.ARRAY_TYPE(9);return x[0]=t,x[1]=e,x[2]=n,x[3]=o,x[4]=s,x[5]=u,x[6]=h,x[7]=m,x[8]=y,x},wn.set=function(t,e,n,o,s,u,h,m,y,x){return t[0]=e,t[1]=n,t[2]=o,t[3]=s,t[4]=u,t[5]=h,t[6]=m,t[7]=y,t[8]=x,t},wn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},wn.transpose=function(t,e){if(t===e){var n=e[1],o=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=o,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},wn.invert=function(t,e){var n=e[0],o=e[1],s=e[2],u=e[3],h=e[4],m=e[5],y=e[6],x=e[7],T=e[8],I=T*h-m*x,M=-T*u+m*y,S=x*u-h*y,R=n*I+o*M+s*S;return R?(t[0]=I*(R=1/R),t[1]=(-T*o+s*x)*R,t[2]=(m*o-s*h)*R,t[3]=M*R,t[4]=(T*n-s*y)*R,t[5]=(-m*n+s*u)*R,t[6]=S*R,t[7]=(-x*n+o*y)*R,t[8]=(h*n-o*u)*R,t):null},wn.adjoint=function(t,e){var n=e[0],o=e[1],s=e[2],u=e[3],h=e[4],m=e[5],y=e[6],x=e[7],T=e[8];return t[0]=h*T-m*x,t[1]=s*x-o*T,t[2]=o*m-s*h,t[3]=m*y-u*T,t[4]=n*T-s*y,t[5]=s*u-n*m,t[6]=u*x-h*y,t[7]=o*y-n*x,t[8]=n*h-o*u,t},wn.determinant=function(t){var e=t[3],n=t[4],o=t[5],s=t[6],u=t[7],h=t[8];return t[0]*(h*n-o*u)+t[1]*(-h*e+o*s)+t[2]*(u*e-n*s)},wn.multiply=wu,wn.translate=function(t,e,n){var o=e[0],s=e[1],u=e[2],h=e[3],m=e[4],y=e[5],x=e[6],T=e[7],I=e[8],M=n[0],S=n[1];return t[0]=o,t[1]=s,t[2]=u,t[3]=h,t[4]=m,t[5]=y,t[6]=M*o+S*h+x,t[7]=M*s+S*m+T,t[8]=M*u+S*y+I,t},wn.rotate=function(t,e,n){var o=e[0],s=e[1],u=e[2],h=e[3],m=e[4],y=e[5],x=e[6],T=e[7],I=e[8],M=Math.sin(n),S=Math.cos(n);return t[0]=S*o+M*h,t[1]=S*s+M*m,t[2]=S*u+M*y,t[3]=S*h-M*o,t[4]=S*m-M*s,t[5]=S*y-M*u,t[6]=x,t[7]=T,t[8]=I,t},wn.scale=function(t,e,n){var o=n[0],s=n[1];return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},wn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},wn.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=-n,t[4]=o,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},wn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},wn.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},wn.fromQuat=function(t,e){var n=e[0],o=e[1],s=e[2],u=e[3],h=n+n,m=o+o,y=s+s,x=n*h,T=o*h,I=o*m,M=s*h,S=s*m,R=s*y,L=u*h,k=u*m,B=u*y;return t[0]=1-I-R,t[3]=T-B,t[6]=M+k,t[1]=T+B,t[4]=1-x-R,t[7]=S-L,t[2]=M-k,t[5]=S+L,t[8]=1-x-I,t},wn.normalFromMat4=function(t,e){var n=e[0],o=e[1],s=e[2],u=e[3],h=e[4],m=e[5],y=e[6],x=e[7],T=e[8],I=e[9],M=e[10],S=e[11],R=e[12],L=e[13],k=e[14],B=e[15],Z=n*m-o*h,W=n*y-s*h,X=n*x-u*h,re=o*y-s*m,ie=o*x-u*m,le=s*x-u*y,ge=T*L-I*R,we=T*k-M*R,Ce=T*B-S*R,Te=I*k-M*L,Oe=I*B-S*L,$e=M*B-S*k,Le=Z*$e-W*Oe+X*Te+re*Ce-ie*we+le*ge;return Le?(t[0]=(m*$e-y*Oe+x*Te)*(Le=1/Le),t[1]=(y*Ce-h*$e-x*we)*Le,t[2]=(h*Oe-m*Ce+x*ge)*Le,t[3]=(s*Oe-o*$e-u*Te)*Le,t[4]=(n*$e-s*Ce+u*we)*Le,t[5]=(o*Ce-n*Oe-u*ge)*Le,t[6]=(L*le-k*ie+B*re)*Le,t[7]=(k*X-R*le-B*W)*Le,t[8]=(R*ie-L*X+B*Z)*Le,t):null},wn.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},wn.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},wn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},wn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},wn.subtract=Tu,wn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},wn.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t[6]=e[6]+n[6]*o,t[7]=e[7]+n[7]*o,t[8]=e[8]+n[8]*o,t},wn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},wn.equals=function(t,e){var n=t[0],o=t[1],s=t[2],u=t[3],h=t[4],m=t[5],y=t[6],x=t[7],T=t[8],I=e[0],M=e[1],S=e[2],R=e[3],L=e[4],k=e[5],B=e[6],Z=e[7],W=e[8];return Math.abs(n-I)<=Ar.EPSILON*Math.max(1,Math.abs(n),Math.abs(I))&&Math.abs(o-M)<=Ar.EPSILON*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(s-S)<=Ar.EPSILON*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(u-R)<=Ar.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(h-L)<=Ar.EPSILON*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(m-k)<=Ar.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(y-B)<=Ar.EPSILON*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(x-Z)<=Ar.EPSILON*Math.max(1,Math.abs(x),Math.abs(Z))&&Math.abs(T-W)<=Ar.EPSILON*Math.max(1,Math.abs(T),Math.abs(W))},wn.sub=wn.mul=void 0;var Ar=function(t,e){if(t&&t.__esModule)return t;if(t===null||_a(t)!=="object"&&typeof t!="function")return{default:t};var n=bu(void 0);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=s?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(on);function bu(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(bu=function(o){return o?n:e})(t)}function wu(t,e,n){var o=e[0],s=e[1],u=e[2],h=e[3],m=e[4],y=e[5],x=e[6],T=e[7],I=e[8],M=n[0],S=n[1],R=n[2],L=n[3],k=n[4],B=n[5],Z=n[6],W=n[7],X=n[8];return t[0]=M*o+S*h+R*x,t[1]=M*s+S*m+R*T,t[2]=M*u+S*y+R*I,t[3]=L*o+k*h+B*x,t[4]=L*s+k*m+B*T,t[5]=L*u+k*y+B*I,t[6]=Z*o+W*h+X*x,t[7]=Z*s+W*m+X*T,t[8]=Z*u+W*y+X*I,t}function Tu(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}wn.mul=wu,wn.sub=Tu;var Mt={};function ya(t){return ya=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ya(t)}Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.create=function(){var t=new Un.ARRAY_TYPE(16);return Un.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Mt.clone=function(t){var e=new Un.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Mt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Mt.fromValues=function(t,e,n,o,s,u,h,m,y,x,T,I,M,S,R,L){var k=new Un.ARRAY_TYPE(16);return k[0]=t,k[1]=e,k[2]=n,k[3]=o,k[4]=s,k[5]=u,k[6]=h,k[7]=m,k[8]=y,k[9]=x,k[10]=T,k[11]=I,k[12]=M,k[13]=S,k[14]=R,k[15]=L,k},Mt.set=function(t,e,n,o,s,u,h,m,y,x,T,I,M,S,R,L,k){return t[0]=e,t[1]=n,t[2]=o,t[3]=s,t[4]=u,t[5]=h,t[6]=m,t[7]=y,t[8]=x,t[9]=T,t[10]=I,t[11]=M,t[12]=S,t[13]=R,t[14]=L,t[15]=k,t},Mt.identity=Iu,Mt.transpose=function(t,e){if(t===e){var n=e[1],o=e[2],s=e[3],u=e[6],h=e[7],m=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=o,t[9]=u,t[11]=e[14],t[12]=s,t[13]=h,t[14]=m}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Mt.invert=function(t,e){var n=e[0],o=e[1],s=e[2],u=e[3],h=e[4],m=e[5],y=e[6],x=e[7],T=e[8],I=e[9],M=e[10],S=e[11],R=e[12],L=e[13],k=e[14],B=e[15],Z=n*m-o*h,W=n*y-s*h,X=n*x-u*h,re=o*y-s*m,ie=o*x-u*m,le=s*x-u*y,ge=T*L-I*R,we=T*k-M*R,Ce=T*B-S*R,Te=I*k-M*L,Oe=I*B-S*L,$e=M*B-S*k,Le=Z*$e-W*Oe+X*Te+re*Ce-ie*we+le*ge;return Le?(t[0]=(m*$e-y*Oe+x*Te)*(Le=1/Le),t[1]=(s*Oe-o*$e-u*Te)*Le,t[2]=(L*le-k*ie+B*re)*Le,t[3]=(M*ie-I*le-S*re)*Le,t[4]=(y*Ce-h*$e-x*we)*Le,t[5]=(n*$e-s*Ce+u*we)*Le,t[6]=(k*X-R*le-B*W)*Le,t[7]=(T*le-M*X+S*W)*Le,t[8]=(h*Oe-m*Ce+x*ge)*Le,t[9]=(o*Ce-n*Oe-u*ge)*Le,t[10]=(R*ie-L*X+B*Z)*Le,t[11]=(I*X-T*ie-S*Z)*Le,t[12]=(m*we-h*Te-y*ge)*Le,t[13]=(n*Te-o*we+s*ge)*Le,t[14]=(L*W-R*re-k*Z)*Le,t[15]=(T*re-I*W+M*Z)*Le,t):null},Mt.adjoint=function(t,e){var n=e[0],o=e[1],s=e[2],u=e[3],h=e[4],m=e[5],y=e[6],x=e[7],T=e[8],I=e[9],M=e[10],S=e[11],R=e[12],L=e[13],k=e[14],B=e[15];return t[0]=m*(M*B-S*k)-I*(y*B-x*k)+L*(y*S-x*M),t[1]=-(o*(M*B-S*k)-I*(s*B-u*k)+L*(s*S-u*M)),t[2]=o*(y*B-x*k)-m*(s*B-u*k)+L*(s*x-u*y),t[3]=-(o*(y*S-x*M)-m*(s*S-u*M)+I*(s*x-u*y)),t[4]=-(h*(M*B-S*k)-T*(y*B-x*k)+R*(y*S-x*M)),t[5]=n*(M*B-S*k)-T*(s*B-u*k)+R*(s*S-u*M),t[6]=-(n*(y*B-x*k)-h*(s*B-u*k)+R*(s*x-u*y)),t[7]=n*(y*S-x*M)-h*(s*S-u*M)+T*(s*x-u*y),t[8]=h*(I*B-S*L)-T*(m*B-x*L)+R*(m*S-x*I),t[9]=-(n*(I*B-S*L)-T*(o*B-u*L)+R*(o*S-u*I)),t[10]=n*(m*B-x*L)-h*(o*B-u*L)+R*(o*x-u*m),t[11]=-(n*(m*S-x*I)-h*(o*S-u*I)+T*(o*x-u*m)),t[12]=-(h*(I*k-M*L)-T*(m*k-y*L)+R*(m*M-y*I)),t[13]=n*(I*k-M*L)-T*(o*k-s*L)+R*(o*M-s*I),t[14]=-(n*(m*k-y*L)-h*(o*k-s*L)+R*(o*y-s*m)),t[15]=n*(m*M-y*I)-h*(o*M-s*I)+T*(o*y-s*m),t},Mt.determinant=function(t){var e=t[0],n=t[1],o=t[2],s=t[3],u=t[4],h=t[5],m=t[6],y=t[7],x=t[8],T=t[9],I=t[10],M=t[11],S=t[12],R=t[13],L=t[14],k=t[15];return(e*h-n*u)*(I*k-M*L)-(e*m-o*u)*(T*k-M*R)+(e*y-s*u)*(T*L-I*R)+(n*m-o*h)*(x*k-M*S)-(n*y-s*h)*(x*L-I*S)+(o*y-s*m)*(x*R-T*S)},Mt.multiply=Mu,Mt.translate=function(t,e,n){var o,s,u,h,m,y,x,T,I,M,S,R,L=n[0],k=n[1],B=n[2];return e===t?(t[12]=e[0]*L+e[4]*k+e[8]*B+e[12],t[13]=e[1]*L+e[5]*k+e[9]*B+e[13],t[14]=e[2]*L+e[6]*k+e[10]*B+e[14],t[15]=e[3]*L+e[7]*k+e[11]*B+e[15]):(s=e[1],u=e[2],h=e[3],m=e[4],y=e[5],x=e[6],T=e[7],I=e[8],M=e[9],S=e[10],R=e[11],t[0]=o=e[0],t[1]=s,t[2]=u,t[3]=h,t[4]=m,t[5]=y,t[6]=x,t[7]=T,t[8]=I,t[9]=M,t[10]=S,t[11]=R,t[12]=o*L+m*k+I*B+e[12],t[13]=s*L+y*k+M*B+e[13],t[14]=u*L+x*k+S*B+e[14],t[15]=h*L+T*k+R*B+e[15]),t},Mt.scale=function(t,e,n){var o=n[0],s=n[1],u=n[2];return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Mt.rotate=function(t,e,n,o){var s,u,h,m,y,x,T,I,M,S,R,L,k,B,Z,W,X,re,ie,le,ge,we,Ce,Te,Oe=o[0],$e=o[1],Le=o[2],qe=Math.hypot(Oe,$e,Le);return qe<Un.EPSILON?null:(Oe*=qe=1/qe,$e*=qe,Le*=qe,s=Math.sin(n),u=Math.cos(n),y=e[1],x=e[2],T=e[3],M=e[5],S=e[6],R=e[7],k=e[9],B=e[10],Z=e[11],W=Oe*Oe*(h=1-u)+u,ie=Oe*$e*h-Le*s,le=$e*$e*h+u,ge=Le*$e*h+Oe*s,we=Oe*Le*h+$e*s,Ce=$e*Le*h-Oe*s,Te=Le*Le*h+u,t[0]=(m=e[0])*W+(I=e[4])*(X=$e*Oe*h+Le*s)+(L=e[8])*(re=Le*Oe*h-$e*s),t[1]=y*W+M*X+k*re,t[2]=x*W+S*X+B*re,t[3]=T*W+R*X+Z*re,t[4]=m*ie+I*le+L*ge,t[5]=y*ie+M*le+k*ge,t[6]=x*ie+S*le+B*ge,t[7]=T*ie+R*le+Z*ge,t[8]=m*we+I*Ce+L*Te,t[9]=y*we+M*Ce+k*Te,t[10]=x*we+S*Ce+B*Te,t[11]=T*we+R*Ce+Z*Te,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Mt.rotateX=function(t,e,n){var o=Math.sin(n),s=Math.cos(n),u=e[4],h=e[5],m=e[6],y=e[7],x=e[8],T=e[9],I=e[10],M=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*s+x*o,t[5]=h*s+T*o,t[6]=m*s+I*o,t[7]=y*s+M*o,t[8]=x*s-u*o,t[9]=T*s-h*o,t[10]=I*s-m*o,t[11]=M*s-y*o,t},Mt.rotateY=function(t,e,n){var o=Math.sin(n),s=Math.cos(n),u=e[0],h=e[1],m=e[2],y=e[3],x=e[8],T=e[9],I=e[10],M=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*s-x*o,t[1]=h*s-T*o,t[2]=m*s-I*o,t[3]=y*s-M*o,t[8]=u*o+x*s,t[9]=h*o+T*s,t[10]=m*o+I*s,t[11]=y*o+M*s,t},Mt.rotateZ=function(t,e,n){var o=Math.sin(n),s=Math.cos(n),u=e[0],h=e[1],m=e[2],y=e[3],x=e[4],T=e[5],I=e[6],M=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*s+x*o,t[1]=h*s+T*o,t[2]=m*s+I*o,t[3]=y*s+M*o,t[4]=x*s-u*o,t[5]=T*s-h*o,t[6]=I*s-m*o,t[7]=M*s-y*o,t},Mt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Mt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Mt.fromRotation=function(t,e,n){var o,s,u,h=n[0],m=n[1],y=n[2],x=Math.hypot(h,m,y);return x<Un.EPSILON?null:(h*=x=1/x,m*=x,y*=x,o=Math.sin(e),s=Math.cos(e),t[0]=h*h*(u=1-s)+s,t[1]=m*h*u+y*o,t[2]=y*h*u-m*o,t[3]=0,t[4]=h*m*u-y*o,t[5]=m*m*u+s,t[6]=y*m*u+h*o,t[7]=0,t[8]=h*y*u+m*o,t[9]=m*y*u-h*o,t[10]=y*y*u+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Mt.fromXRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Mt.fromYRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Mt.fromZRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Mt.fromRotationTranslation=Nl,Mt.fromQuat2=function(t,e){var n=new Un.ARRAY_TYPE(3),o=-e[0],s=-e[1],u=-e[2],h=e[3],m=e[4],y=e[5],x=e[6],T=e[7],I=o*o+s*s+u*u+h*h;return I>0?(n[0]=2*(m*h+T*o+y*u-x*s)/I,n[1]=2*(y*h+T*s+x*o-m*u)/I,n[2]=2*(x*h+T*u+m*s-y*o)/I):(n[0]=2*(m*h+T*o+y*u-x*s),n[1]=2*(y*h+T*s+x*o-m*u),n[2]=2*(x*h+T*u+m*s-y*o)),Nl(t,e,n),t},Mt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Mt.getScaling=va,Mt.getRotation=function(t,e){var n=new Un.ARRAY_TYPE(3);va(n,e);var o=1/n[0],s=1/n[1],u=1/n[2],h=e[0]*o,m=e[1]*s,y=e[2]*u,x=e[4]*o,T=e[5]*s,I=e[6]*u,M=e[8]*o,S=e[9]*s,R=e[10]*u,L=h+T+R,k=0;return L>0?(k=2*Math.sqrt(L+1),t[3]=.25*k,t[0]=(I-S)/k,t[1]=(M-y)/k,t[2]=(m-x)/k):h>T&&h>R?(k=2*Math.sqrt(1+h-T-R),t[3]=(I-S)/k,t[0]=.25*k,t[1]=(m+x)/k,t[2]=(M+y)/k):T>R?(k=2*Math.sqrt(1+T-h-R),t[3]=(M-y)/k,t[0]=(m+x)/k,t[1]=.25*k,t[2]=(I+S)/k):(k=2*Math.sqrt(1+R-h-T),t[3]=(m-x)/k,t[0]=(M+y)/k,t[1]=(I+S)/k,t[2]=.25*k),t},Mt.fromRotationTranslationScale=function(t,e,n,o){var s=e[0],u=e[1],h=e[2],m=e[3],y=s+s,x=u+u,T=h+h,I=s*y,M=s*x,S=s*T,R=u*x,L=u*T,k=h*T,B=m*y,Z=m*x,W=m*T,X=o[0],re=o[1],ie=o[2];return t[0]=(1-(R+k))*X,t[1]=(M+W)*X,t[2]=(S-Z)*X,t[3]=0,t[4]=(M-W)*re,t[5]=(1-(I+k))*re,t[6]=(L+B)*re,t[7]=0,t[8]=(S+Z)*ie,t[9]=(L-B)*ie,t[10]=(1-(I+R))*ie,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},Mt.fromRotationTranslationScaleOrigin=function(t,e,n,o,s){var u=e[0],h=e[1],m=e[2],y=e[3],x=u+u,T=h+h,I=m+m,M=u*x,S=u*T,R=u*I,L=h*T,k=h*I,B=m*I,Z=y*x,W=y*T,X=y*I,re=o[0],ie=o[1],le=o[2],ge=s[0],we=s[1],Ce=s[2],Te=(1-(L+B))*re,Oe=(S+X)*re,$e=(R-W)*re,Le=(S-X)*ie,qe=(1-(M+B))*ie,Re=(k+Z)*ie,ze=(R+W)*le,Ze=(k-Z)*le,ke=(1-(M+L))*le;return t[0]=Te,t[1]=Oe,t[2]=$e,t[3]=0,t[4]=Le,t[5]=qe,t[6]=Re,t[7]=0,t[8]=ze,t[9]=Ze,t[10]=ke,t[11]=0,t[12]=n[0]+ge-(Te*ge+Le*we+ze*Ce),t[13]=n[1]+we-(Oe*ge+qe*we+Ze*Ce),t[14]=n[2]+Ce-($e*ge+Re*we+ke*Ce),t[15]=1,t},Mt.fromQuat=function(t,e){var n=e[0],o=e[1],s=e[2],u=e[3],h=n+n,m=o+o,y=s+s,x=n*h,T=o*h,I=o*m,M=s*h,S=s*m,R=s*y,L=u*h,k=u*m,B=u*y;return t[0]=1-I-R,t[1]=T+B,t[2]=M-k,t[3]=0,t[4]=T-B,t[5]=1-x-R,t[6]=S+L,t[7]=0,t[8]=M+k,t[9]=S-L,t[10]=1-x-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Mt.frustum=function(t,e,n,o,s,u,h){var m=1/(n-e),y=1/(s-o),x=1/(u-h);return t[0]=2*u*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*u*y,t[6]=0,t[7]=0,t[8]=(n+e)*m,t[9]=(s+o)*y,t[10]=(h+u)*x,t[11]=-1,t[12]=0,t[13]=0,t[14]=h*u*2*x,t[15]=0,t},Mt.perspectiveNO=Gi,Mt.perspectiveZO=function(t,e,n,o,s){var u,h=1/Math.tan(e/2);return t[0]=h/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(t[10]=s*(u=1/(o-s)),t[14]=s*o*u):(t[10]=-1,t[14]=-o),t},Mt.perspectiveFromFieldOfView=function(t,e,n,o){var s=Math.tan(e.upDegrees*Math.PI/180),u=Math.tan(e.downDegrees*Math.PI/180),h=Math.tan(e.leftDegrees*Math.PI/180),m=Math.tan(e.rightDegrees*Math.PI/180),y=2/(h+m),x=2/(s+u);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=x,t[6]=0,t[7]=0,t[8]=-(h-m)*y*.5,t[9]=(s-u)*x*.5,t[10]=o/(n-o),t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n/(n-o),t[15]=0,t},Mt.orthoNO=Hi,Mt.orthoZO=function(t,e,n,o,s,u,h){var m=1/(e-n),y=1/(o-s),x=1/(u-h);return t[0]=-2*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=x,t[11]=0,t[12]=(e+n)*m,t[13]=(s+o)*y,t[14]=u*x,t[15]=1,t},Mt.lookAt=function(t,e,n,o){var s,u,h,m,y,x,T,I,M,S,R=e[0],L=e[1],k=e[2],B=o[0],Z=o[1],W=o[2],X=n[0],re=n[1],ie=n[2];return Math.abs(R-X)<Un.EPSILON&&Math.abs(L-re)<Un.EPSILON&&Math.abs(k-ie)<Un.EPSILON?Iu(t):(T=R-X,I=L-re,M=k-ie,s=Z*(M*=S=1/Math.hypot(T,I,M))-W*(I*=S),u=W*(T*=S)-B*M,h=B*I-Z*T,(S=Math.hypot(s,u,h))?(s*=S=1/S,u*=S,h*=S):(s=0,u=0,h=0),m=I*h-M*u,y=M*s-T*h,x=T*u-I*s,(S=Math.hypot(m,y,x))?(m*=S=1/S,y*=S,x*=S):(m=0,y=0,x=0),t[0]=s,t[1]=m,t[2]=T,t[3]=0,t[4]=u,t[5]=y,t[6]=I,t[7]=0,t[8]=h,t[9]=x,t[10]=M,t[11]=0,t[12]=-(s*R+u*L+h*k),t[13]=-(m*R+y*L+x*k),t[14]=-(T*R+I*L+M*k),t[15]=1,t)},Mt.targetTo=function(t,e,n,o){var s=e[0],u=e[1],h=e[2],m=o[0],y=o[1],x=o[2],T=s-n[0],I=u-n[1],M=h-n[2],S=T*T+I*I+M*M;S>0&&(T*=S=1/Math.sqrt(S),I*=S,M*=S);var R=y*M-x*I,L=x*T-m*M,k=m*I-y*T;return(S=R*R+L*L+k*k)>0&&(R*=S=1/Math.sqrt(S),L*=S,k*=S),t[0]=R,t[1]=L,t[2]=k,t[3]=0,t[4]=I*k-M*L,t[5]=M*R-T*k,t[6]=T*L-I*R,t[7]=0,t[8]=T,t[9]=I,t[10]=M,t[11]=0,t[12]=s,t[13]=u,t[14]=h,t[15]=1,t},Mt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Mt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Mt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},Mt.subtract=zl,Mt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},Mt.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t[6]=e[6]+n[6]*o,t[7]=e[7]+n[7]*o,t[8]=e[8]+n[8]*o,t[9]=e[9]+n[9]*o,t[10]=e[10]+n[10]*o,t[11]=e[11]+n[11]*o,t[12]=e[12]+n[12]*o,t[13]=e[13]+n[13]*o,t[14]=e[14]+n[14]*o,t[15]=e[15]+n[15]*o,t},Mt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Mt.equals=function(t,e){var n=t[0],o=t[1],s=t[2],u=t[3],h=t[4],m=t[5],y=t[6],x=t[7],T=t[8],I=t[9],M=t[10],S=t[11],R=t[12],L=t[13],k=t[14],B=t[15],Z=e[0],W=e[1],X=e[2],re=e[3],ie=e[4],le=e[5],ge=e[6],we=e[7],Ce=e[8],Te=e[9],Oe=e[10],$e=e[11],Le=e[12],qe=e[13],Re=e[14],ze=e[15];return Math.abs(n-Z)<=Un.EPSILON*Math.max(1,Math.abs(n),Math.abs(Z))&&Math.abs(o-W)<=Un.EPSILON*Math.max(1,Math.abs(o),Math.abs(W))&&Math.abs(s-X)<=Un.EPSILON*Math.max(1,Math.abs(s),Math.abs(X))&&Math.abs(u-re)<=Un.EPSILON*Math.max(1,Math.abs(u),Math.abs(re))&&Math.abs(h-ie)<=Un.EPSILON*Math.max(1,Math.abs(h),Math.abs(ie))&&Math.abs(m-le)<=Un.EPSILON*Math.max(1,Math.abs(m),Math.abs(le))&&Math.abs(y-ge)<=Un.EPSILON*Math.max(1,Math.abs(y),Math.abs(ge))&&Math.abs(x-we)<=Un.EPSILON*Math.max(1,Math.abs(x),Math.abs(we))&&Math.abs(T-Ce)<=Un.EPSILON*Math.max(1,Math.abs(T),Math.abs(Ce))&&Math.abs(I-Te)<=Un.EPSILON*Math.max(1,Math.abs(I),Math.abs(Te))&&Math.abs(M-Oe)<=Un.EPSILON*Math.max(1,Math.abs(M),Math.abs(Oe))&&Math.abs(S-$e)<=Un.EPSILON*Math.max(1,Math.abs(S),Math.abs($e))&&Math.abs(R-Le)<=Un.EPSILON*Math.max(1,Math.abs(R),Math.abs(Le))&&Math.abs(L-qe)<=Un.EPSILON*Math.max(1,Math.abs(L),Math.abs(qe))&&Math.abs(k-Re)<=Un.EPSILON*Math.max(1,Math.abs(k),Math.abs(Re))&&Math.abs(B-ze)<=Un.EPSILON*Math.max(1,Math.abs(B),Math.abs(ze))},Mt.sub=Mt.mul=Mt.ortho=Mt.perspective=void 0;var Un=function(t,e){if(t&&t.__esModule)return t;if(t===null||ya(t)!=="object"&&typeof t!="function")return{default:t};var n=Eu(void 0);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=s?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(on);function Eu(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Eu=function(o){return o?n:e})(t)}function Iu(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Mu(t,e,n){var o=e[0],s=e[1],u=e[2],h=e[3],m=e[4],y=e[5],x=e[6],T=e[7],I=e[8],M=e[9],S=e[10],R=e[11],L=e[12],k=e[13],B=e[14],Z=e[15],W=n[0],X=n[1],re=n[2],ie=n[3];return t[0]=W*o+X*m+re*I+ie*L,t[1]=W*s+X*y+re*M+ie*k,t[2]=W*u+X*x+re*S+ie*B,t[3]=W*h+X*T+re*R+ie*Z,t[4]=(W=n[4])*o+(X=n[5])*m+(re=n[6])*I+(ie=n[7])*L,t[5]=W*s+X*y+re*M+ie*k,t[6]=W*u+X*x+re*S+ie*B,t[7]=W*h+X*T+re*R+ie*Z,t[8]=(W=n[8])*o+(X=n[9])*m+(re=n[10])*I+(ie=n[11])*L,t[9]=W*s+X*y+re*M+ie*k,t[10]=W*u+X*x+re*S+ie*B,t[11]=W*h+X*T+re*R+ie*Z,t[12]=(W=n[12])*o+(X=n[13])*m+(re=n[14])*I+(ie=n[15])*L,t[13]=W*s+X*y+re*M+ie*k,t[14]=W*u+X*x+re*S+ie*B,t[15]=W*h+X*T+re*R+ie*Z,t}function Nl(t,e,n){var o=e[0],s=e[1],u=e[2],h=e[3],m=o+o,y=s+s,x=u+u,T=o*m,I=o*y,M=o*x,S=s*y,R=s*x,L=u*x,k=h*m,B=h*y,Z=h*x;return t[0]=1-(S+L),t[1]=I+Z,t[2]=M-B,t[3]=0,t[4]=I-Z,t[5]=1-(T+L),t[6]=R+k,t[7]=0,t[8]=M+B,t[9]=R-k,t[10]=1-(T+S),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function va(t,e){var n=e[4],o=e[5],s=e[6],u=e[8],h=e[9],m=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,o,s),t[2]=Math.hypot(u,h,m),t}function Gi(t,e,n,o,s){var u,h=1/Math.tan(e/2);return t[0]=h/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(t[10]=(s+o)*(u=1/(o-s)),t[14]=2*s*o*u):(t[10]=-1,t[14]=-2*o),t}function Hi(t,e,n,o,s,u,h){var m=1/(e-n),y=1/(o-s),x=1/(u-h);return t[0]=-2*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*x,t[11]=0,t[12]=(e+n)*m,t[13]=(s+o)*y,t[14]=(h+u)*x,t[15]=1,t}function zl(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}Mt.perspective=Gi,Mt.ortho=Hi,Mt.mul=Mu,Mt.sub=zl;var wt={},Dt={};function xa(t){return xa=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xa(t)}Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.create=Du,Dt.clone=function(t){var e=new si.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Dt.length=Rs,Dt.fromValues=function(t,e,n){var o=new si.ARRAY_TYPE(3);return o[0]=t,o[1]=e,o[2]=n,o},Dt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Dt.set=function(t,e,n,o){return t[0]=e,t[1]=n,t[2]=o,t},Dt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},Dt.subtract=Cu,Dt.multiply=Ko,Dt.divide=Jo,Dt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Dt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Dt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},Dt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},Dt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Dt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},Dt.scaleAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t},Dt.distance=ba,Dt.squaredDistance=Bl,Dt.squaredLength=wa,Dt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Dt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Dt.normalize=function(t,e){var n=e[0],o=e[1],s=e[2],u=n*n+o*o+s*s;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t[2]=e[2]*u,t},Dt.dot=Ta,Dt.cross=function(t,e,n){var o=e[0],s=e[1],u=e[2],h=n[0],m=n[1],y=n[2];return t[0]=s*y-u*m,t[1]=u*h-o*y,t[2]=o*m-s*h,t},Dt.lerp=function(t,e,n,o){var s=e[0],u=e[1],h=e[2];return t[0]=s+o*(n[0]-s),t[1]=u+o*(n[1]-u),t[2]=h+o*(n[2]-h),t},Dt.hermite=function(t,e,n,o,s,u){var h=u*u,m=h*(2*u-3)+1,y=h*(u-2)+u,x=h*(u-1),T=h*(3-2*u);return t[0]=e[0]*m+n[0]*y+o[0]*x+s[0]*T,t[1]=e[1]*m+n[1]*y+o[1]*x+s[1]*T,t[2]=e[2]*m+n[2]*y+o[2]*x+s[2]*T,t},Dt.bezier=function(t,e,n,o,s,u){var h=1-u,m=h*h,y=u*u,x=m*h,T=3*u*m,I=3*y*h,M=y*u;return t[0]=e[0]*x+n[0]*T+o[0]*I+s[0]*M,t[1]=e[1]*x+n[1]*T+o[1]*I+s[1]*M,t[2]=e[2]*x+n[2]*T+o[2]*I+s[2]*M,t},Dt.random=function(t,e){e=e||1;var n=2*si.RANDOM()*Math.PI,o=2*si.RANDOM()-1,s=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(n)*s,t[1]=Math.sin(n)*s,t[2]=o*e,t},Dt.transformMat4=function(t,e,n){var o=e[0],s=e[1],u=e[2],h=n[3]*o+n[7]*s+n[11]*u+n[15];return t[0]=(n[0]*o+n[4]*s+n[8]*u+n[12])/(h=h||1),t[1]=(n[1]*o+n[5]*s+n[9]*u+n[13])/h,t[2]=(n[2]*o+n[6]*s+n[10]*u+n[14])/h,t},Dt.transformMat3=function(t,e,n){var o=e[0],s=e[1],u=e[2];return t[0]=o*n[0]+s*n[3]+u*n[6],t[1]=o*n[1]+s*n[4]+u*n[7],t[2]=o*n[2]+s*n[5]+u*n[8],t},Dt.transformQuat=function(t,e,n){var o=n[0],s=n[1],u=n[2],h=e[0],m=e[1],y=e[2],x=s*y-u*m,T=u*h-o*y,I=o*m-s*h,M=s*I-u*T,S=u*x-o*I,R=o*T-s*x,L=2*n[3];return T*=L,I*=L,S*=2,R*=2,t[0]=h+(x*=L)+(M*=2),t[1]=m+T+S,t[2]=y+I+R,t},Dt.rotateX=function(t,e,n,o){var s=[],u=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],u[0]=s[0],u[1]=s[1]*Math.cos(o)-s[2]*Math.sin(o),u[2]=s[1]*Math.sin(o)+s[2]*Math.cos(o),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},Dt.rotateY=function(t,e,n,o){var s=[],u=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],u[0]=s[2]*Math.sin(o)+s[0]*Math.cos(o),u[1]=s[1],u[2]=s[2]*Math.cos(o)-s[0]*Math.sin(o),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},Dt.rotateZ=function(t,e,n,o){var s=[],u=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],u[0]=s[0]*Math.cos(o)-s[1]*Math.sin(o),u[1]=s[0]*Math.sin(o)+s[1]*Math.cos(o),u[2]=s[2],t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},Dt.angle=function(t,e){var n=t[0],o=t[1],s=t[2],u=e[0],h=e[1],m=e[2],y=Math.sqrt(n*n+o*o+s*s)*Math.sqrt(u*u+h*h+m*m),x=y&&Ta(t,e)/y;return Math.acos(Math.min(Math.max(x,-1),1))},Dt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Dt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Dt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Dt.equals=function(t,e){var n=t[0],o=t[1],s=t[2],u=e[0],h=e[1],m=e[2];return Math.abs(n-u)<=si.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-h)<=si.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-m)<=si.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))},Dt.forEach=Dt.sqrLen=Dt.len=Dt.sqrDist=Dt.dist=Dt.div=Dt.mul=Dt.sub=void 0;var si=function(t,e){if(t&&t.__esModule)return t;if(t===null||xa(t)!=="object"&&typeof t!="function")return{default:t};var n=Mo(void 0);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=s?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(on);function Mo(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Mo=function(o){return o?n:e})(t)}function Du(){var t=new si.ARRAY_TYPE(3);return si.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Rs(t){return Math.hypot(t[0],t[1],t[2])}function Cu(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Ko(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Jo(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function ba(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Bl(t,e){var n=e[0]-t[0],o=e[1]-t[1],s=e[2]-t[2];return n*n+o*o+s*s}function wa(t){var e=t[0],n=t[1],o=t[2];return e*e+n*n+o*o}function Ta(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Dt.sub=Cu,Dt.mul=Ko,Dt.div=Jo,Dt.dist=ba,Dt.sqrDist=Bl,Dt.len=Rs,Dt.sqrLen=wa;var Ai,ei=(Ai=Du(),function(t,e,n,o,s,u){var h,m;for(e||(e=3),n||(n=0),m=o?Math.min(o*e+n,t.length):t.length,h=n;h<m;h+=e)Ai[0]=t[h],Ai[1]=t[h+1],Ai[2]=t[h+2],s(Ai,Ai,u),t[h]=Ai[0],t[h+1]=Ai[1],t[h+2]=Ai[2];return t});Dt.forEach=ei;var Tt={};function Ea(t){return Ea=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ea(t)}Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.create=Os,Tt.clone=function(t){var e=new Wr.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Tt.fromValues=function(t,e,n,o){var s=new Wr.ARRAY_TYPE(4);return s[0]=t,s[1]=e,s[2]=n,s[3]=o,s},Tt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Tt.set=function(t,e,n,o,s){return t[0]=e,t[1]=n,t[2]=o,t[3]=s,t},Tt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Tt.subtract=Pi,Tt.multiply=Ia,Tt.divide=jl,Tt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Tt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Tt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},Tt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},Tt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Tt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Tt.scaleAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t},Tt.distance=Ma,Tt.squaredDistance=Ls,Tt.length=Da,Tt.squaredLength=Ca,Tt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Tt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Tt.normalize=function(t,e){var n=e[0],o=e[1],s=e[2],u=e[3],h=n*n+o*o+s*s+u*u;return h>0&&(h=1/Math.sqrt(h)),t[0]=n*h,t[1]=o*h,t[2]=s*h,t[3]=u*h,t},Tt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Tt.cross=function(t,e,n,o){var s=n[0]*o[1]-n[1]*o[0],u=n[0]*o[2]-n[2]*o[0],h=n[0]*o[3]-n[3]*o[0],m=n[1]*o[2]-n[2]*o[1],y=n[1]*o[3]-n[3]*o[1],x=n[2]*o[3]-n[3]*o[2],T=e[0],I=e[1],M=e[2],S=e[3];return t[0]=I*x-M*y+S*m,t[1]=-T*x+M*h-S*u,t[2]=T*y-I*h+S*s,t[3]=-T*m+I*u-M*s,t},Tt.lerp=function(t,e,n,o){var s=e[0],u=e[1],h=e[2],m=e[3];return t[0]=s+o*(n[0]-s),t[1]=u+o*(n[1]-u),t[2]=h+o*(n[2]-h),t[3]=m+o*(n[3]-m),t},Tt.random=function(t,e){var n,o,s,u,h,m;e=e||1;do h=(n=2*Wr.RANDOM()-1)*n+(o=2*Wr.RANDOM()-1)*o;while(h>=1);do m=(s=2*Wr.RANDOM()-1)*s+(u=2*Wr.RANDOM()-1)*u;while(m>=1);var y=Math.sqrt((1-h)/m);return t[0]=e*n,t[1]=e*o,t[2]=e*s*y,t[3]=e*u*y,t},Tt.transformMat4=function(t,e,n){var o=e[0],s=e[1],u=e[2],h=e[3];return t[0]=n[0]*o+n[4]*s+n[8]*u+n[12]*h,t[1]=n[1]*o+n[5]*s+n[9]*u+n[13]*h,t[2]=n[2]*o+n[6]*s+n[10]*u+n[14]*h,t[3]=n[3]*o+n[7]*s+n[11]*u+n[15]*h,t},Tt.transformQuat=function(t,e,n){var o=e[0],s=e[1],u=e[2],h=n[0],m=n[1],y=n[2],x=n[3],T=x*o+m*u-y*s,I=x*s+y*o-h*u,M=x*u+h*s-m*o,S=-h*o-m*s-y*u;return t[0]=T*x+S*-h+I*-y-M*-m,t[1]=I*x+S*-m+M*-h-T*-y,t[2]=M*x+S*-y+T*-m-I*-h,t[3]=e[3],t},Tt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Tt.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Tt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Tt.equals=function(t,e){var n=t[0],o=t[1],s=t[2],u=t[3],h=e[0],m=e[1],y=e[2],x=e[3];return Math.abs(n-h)<=Wr.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-m)<=Wr.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(s-y)<=Wr.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(u-x)<=Wr.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))},Tt.forEach=Tt.sqrLen=Tt.len=Tt.sqrDist=Tt.dist=Tt.div=Tt.mul=Tt.sub=void 0;var Wr=function(t,e){if(t&&t.__esModule)return t;if(t===null||Ea(t)!=="object"&&typeof t!="function")return{default:t};var n=qi(void 0);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=s?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(on);function qi(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(qi=function(o){return o?n:e})(t)}function Os(){var t=new Wr.ARRAY_TYPE(4);return Wr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Pi(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Ia(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function jl(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Ma(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function Ls(t,e){var n=e[0]-t[0],o=e[1]-t[1],s=e[2]-t[2],u=e[3]-t[3];return n*n+o*o+s*s+u*u}function Da(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Ca(t){var e=t[0],n=t[1],o=t[2],s=t[3];return e*e+n*n+o*o+s*s}Tt.sub=Pi,Tt.mul=Ia,Tt.div=jl,Tt.dist=Ma,Tt.sqrDist=Ls,Tt.len=Da,Tt.sqrLen=Ca;var es=function(){var t=Os();return function(e,n,o,s,u,h){var m,y;for(n||(n=4),o||(o=0),y=s?Math.min(s*n+o,e.length):e.length,m=o;m<y;m+=n)t[0]=e[m],t[1]=e[m+1],t[2]=e[m+2],t[3]=e[m+3],u(t,t,h),e[m]=t[0],e[m+1]=t[1],e[m+2]=t[2],e[m+3]=t[3];return e}}();function Sa(t){return Sa=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sa(t)}Tt.forEach=es,Object.defineProperty(wt,"__esModule",{value:!0}),wt.create=Aa,wt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},wt.setAxisAngle=cr,wt.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),o=Math.sin(n/2);return o>Ri.EPSILON?(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o):(t[0]=1,t[1]=0,t[2]=0),n},wt.getAngle=function(t,e){var n=ae(t,e);return Math.acos(2*n*n-1)},wt.multiply=Ul,wt.rotateX=function(t,e,n){n*=.5;var o=e[0],s=e[1],u=e[2],h=e[3],m=Math.sin(n),y=Math.cos(n);return t[0]=o*y+h*m,t[1]=s*y+u*m,t[2]=u*y-s*m,t[3]=h*y-o*m,t},wt.rotateY=function(t,e,n){n*=.5;var o=e[0],s=e[1],u=e[2],h=e[3],m=Math.sin(n),y=Math.cos(n);return t[0]=o*y-u*m,t[1]=s*y+h*m,t[2]=u*y+o*m,t[3]=h*y-s*m,t},wt.rotateZ=function(t,e,n){n*=.5;var o=e[0],s=e[1],u=e[2],h=e[3],m=Math.sin(n),y=Math.cos(n);return t[0]=o*y+s*m,t[1]=s*y-o*m,t[2]=u*y+h*m,t[3]=h*y-u*m,t},wt.calculateW=function(t,e){var n=e[0],o=e[1],s=e[2];return t[0]=n,t[1]=o,t[2]=s,t[3]=Math.sqrt(Math.abs(1-n*n-o*o-s*s)),t},wt.exp=pe,wt.ln=j,wt.pow=function(t,e,n){return j(t,e),ue(t,t,n),pe(t,t),t},wt.slerp=q,wt.random=function(t){var e=Ri.RANDOM(),n=Ri.RANDOM(),o=Ri.RANDOM(),s=Math.sqrt(1-e),u=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*n),t[1]=s*Math.cos(2*Math.PI*n),t[2]=u*Math.sin(2*Math.PI*o),t[3]=u*Math.cos(2*Math.PI*o),t},wt.invert=function(t,e){var n=e[0],o=e[1],s=e[2],u=e[3],h=n*n+o*o+s*s+u*u,m=h?1/h:0;return t[0]=-n*m,t[1]=-o*m,t[2]=-s*m,t[3]=u*m,t},wt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},wt.fromMat3=ee,wt.fromEuler=function(t,e,n,o){var s=.5*Math.PI/180;e*=s,n*=s,o*=s;var u=Math.sin(e),h=Math.cos(e),m=Math.sin(n),y=Math.cos(n),x=Math.sin(o),T=Math.cos(o);return t[0]=u*y*T-h*m*x,t[1]=h*m*T+u*y*x,t[2]=h*y*x-u*m*T,t[3]=h*y*T+u*m*x,t},wt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},wt.setAxes=wt.sqlerp=wt.rotationTo=wt.equals=wt.exactEquals=wt.normalize=wt.sqrLen=wt.squaredLength=wt.len=wt.length=wt.lerp=wt.dot=wt.scale=wt.mul=wt.add=wt.set=wt.copy=wt.fromValues=wt.clone=void 0;var Ri=ks(on),Od=ks(wn),Oi=ks(Dt),Er=ks(Tt);function Vl(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Vl=function(o){return o?n:e})(t)}function ks(t,e){if(t&&t.__esModule)return t;if(t===null||Sa(t)!=="object"&&typeof t!="function")return{default:t};var n=Vl(e);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=s?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}function Aa(){var t=new Ri.ARRAY_TYPE(4);return Ri.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function cr(t,e,n){n*=.5;var o=Math.sin(n);return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=Math.cos(n),t}function Ul(t,e,n){var o=e[0],s=e[1],u=e[2],h=e[3],m=n[0],y=n[1],x=n[2],T=n[3];return t[0]=o*T+h*m+s*x-u*y,t[1]=s*T+h*y+u*m-o*x,t[2]=u*T+h*x+o*y-s*m,t[3]=h*T-o*m-s*y-u*x,t}function pe(t,e){var n=e[0],o=e[1],s=e[2],u=e[3],h=Math.sqrt(n*n+o*o+s*s),m=Math.exp(u),y=h>0?m*Math.sin(h)/h:0;return t[0]=n*y,t[1]=o*y,t[2]=s*y,t[3]=m*Math.cos(h),t}function j(t,e){var n=e[0],o=e[1],s=e[2],u=e[3],h=Math.sqrt(n*n+o*o+s*s),m=h>0?Math.atan2(h,u)/h:0;return t[0]=n*m,t[1]=o*m,t[2]=s*m,t[3]=.5*Math.log(n*n+o*o+s*s+u*u),t}function q(t,e,n,o){var s,u,h,m,y,x=e[0],T=e[1],I=e[2],M=e[3],S=n[0],R=n[1],L=n[2],k=n[3];return(u=x*S+T*R+I*L+M*k)<0&&(u=-u,S=-S,R=-R,L=-L,k=-k),1-u>Ri.EPSILON?(s=Math.acos(u),h=Math.sin(s),m=Math.sin((1-o)*s)/h,y=Math.sin(o*s)/h):(m=1-o,y=o),t[0]=m*x+y*S,t[1]=m*T+y*R,t[2]=m*I+y*L,t[3]=m*M+y*k,t}function ee(t,e){var n,o=e[0]+e[4]+e[8];if(o>0)n=Math.sqrt(o+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);var u=(s+1)%3,h=(s+2)%3;n=Math.sqrt(e[3*s+s]-e[3*u+u]-e[3*h+h]+1),t[s]=.5*n,t[3]=(e[3*u+h]-e[3*h+u])*(n=.5/n),t[u]=(e[3*u+s]+e[3*s+u])*n,t[h]=(e[3*h+s]+e[3*s+h])*n}return t}wt.clone=Er.clone,wt.fromValues=Er.fromValues,wt.copy=Er.copy,wt.set=Er.set,wt.add=Er.add,wt.mul=Ul;var ue=Er.scale;wt.scale=ue;var ae=Er.dot;wt.dot=ae,wt.lerp=Er.lerp;var ye=Er.length;wt.length=ye,wt.len=ye;var Se=Er.squaredLength;wt.squaredLength=Se,wt.sqrLen=Se;var _e=Er.normalize;wt.normalize=_e,wt.exactEquals=Er.exactEquals,wt.equals=Er.equals;var De,Ue,Ve,it=(De=Oi.create(),Ue=Oi.fromValues(1,0,0),Ve=Oi.fromValues(0,1,0),function(t,e,n){var o=Oi.dot(e,n);return o<-.999999?(Oi.cross(De,Ue,e),Oi.len(De)<1e-6&&Oi.cross(De,Ve,e),Oi.normalize(De,De),cr(t,De,Math.PI),t):o>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Oi.cross(De,e,n),t[0]=De[0],t[1]=De[1],t[2]=De[2],t[3]=1+o,_e(t,t))});wt.rotationTo=it;var pt,yt,sn=(pt=Aa(),yt=Aa(),function(t,e,n,o,s,u){return q(pt,e,s,u),q(yt,n,o,u),q(t,pt,yt,2*u*(1-u)),t});wt.sqlerp=sn;var Lt,en=(Lt=Od.create(),function(t,e,n,o){return Lt[0]=n[0],Lt[3]=n[1],Lt[6]=n[2],Lt[1]=o[0],Lt[4]=o[1],Lt[7]=o[2],Lt[2]=-e[0],Lt[5]=-e[1],Lt[8]=-e[2],_e(t,ee(t,Lt))});wt.setAxes=en;var ut={};function Vn(t){return Vn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vn(t)}Object.defineProperty(ut,"__esModule",{value:!0}),ut.create=function(){var t=new an.ARRAY_TYPE(8);return an.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},ut.clone=function(t){var e=new an.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},ut.fromValues=function(t,e,n,o,s,u,h,m){var y=new an.ARRAY_TYPE(8);return y[0]=t,y[1]=e,y[2]=n,y[3]=o,y[4]=s,y[5]=u,y[6]=h,y[7]=m,y},ut.fromRotationTranslationValues=function(t,e,n,o,s,u,h){var m=new an.ARRAY_TYPE(8);m[0]=t,m[1]=e,m[2]=n,m[3]=o;var y=.5*s,x=.5*u,T=.5*h;return m[4]=y*o+x*n-T*e,m[5]=x*o+T*t-y*n,m[6]=T*o+y*e-x*t,m[7]=-y*t-x*e-T*n,m},ut.fromRotationTranslation=Pr,ut.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},ut.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},ut.fromMat4=function(t,e){var n=Yt.create();tr.getRotation(n,e);var o=new an.ARRAY_TYPE(3);return tr.getTranslation(o,e),Pr(t,n,o),t},ut.copy=Zr,ut.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},ut.set=function(t,e,n,o,s,u,h,m,y){return t[0]=e,t[1]=n,t[2]=o,t[3]=s,t[4]=u,t[5]=h,t[6]=m,t[7]=y,t},ut.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},ut.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},ut.getTranslation=function(t,e){var n=e[4],o=e[5],s=e[6],u=e[7],h=-e[0],m=-e[1],y=-e[2],x=e[3];return t[0]=2*(n*x+u*h+o*y-s*m),t[1]=2*(o*x+u*m+s*h-n*y),t[2]=2*(s*x+u*y+n*m-o*h),t},ut.translate=function(t,e,n){var o=e[0],s=e[1],u=e[2],h=e[3],m=.5*n[0],y=.5*n[1],x=.5*n[2],T=e[4],I=e[5],M=e[6],S=e[7];return t[0]=o,t[1]=s,t[2]=u,t[3]=h,t[4]=h*m+s*x-u*y+T,t[5]=h*y+u*m-o*x+I,t[6]=h*x+o*y-s*m+M,t[7]=-o*m-s*y-u*x+S,t},ut.rotateX=function(t,e,n){var o=-e[0],s=-e[1],u=-e[2],h=e[3],m=e[4],y=e[5],x=e[6],T=e[7],I=m*h+T*o+y*u-x*s,M=y*h+T*s+x*o-m*u,S=x*h+T*u+m*s-y*o,R=T*h-m*o-y*s-x*u;return Yt.rotateX(t,e,n),t[4]=I*(h=t[3])+R*(o=t[0])+M*(u=t[2])-S*(s=t[1]),t[5]=M*h+R*s+S*o-I*u,t[6]=S*h+R*u+I*s-M*o,t[7]=R*h-I*o-M*s-S*u,t},ut.rotateY=function(t,e,n){var o=-e[0],s=-e[1],u=-e[2],h=e[3],m=e[4],y=e[5],x=e[6],T=e[7],I=m*h+T*o+y*u-x*s,M=y*h+T*s+x*o-m*u,S=x*h+T*u+m*s-y*o,R=T*h-m*o-y*s-x*u;return Yt.rotateY(t,e,n),t[4]=I*(h=t[3])+R*(o=t[0])+M*(u=t[2])-S*(s=t[1]),t[5]=M*h+R*s+S*o-I*u,t[6]=S*h+R*u+I*s-M*o,t[7]=R*h-I*o-M*s-S*u,t},ut.rotateZ=function(t,e,n){var o=-e[0],s=-e[1],u=-e[2],h=e[3],m=e[4],y=e[5],x=e[6],T=e[7],I=m*h+T*o+y*u-x*s,M=y*h+T*s+x*o-m*u,S=x*h+T*u+m*s-y*o,R=T*h-m*o-y*s-x*u;return Yt.rotateZ(t,e,n),t[4]=I*(h=t[3])+R*(o=t[0])+M*(u=t[2])-S*(s=t[1]),t[5]=M*h+R*s+S*o-I*u,t[6]=S*h+R*u+I*s-M*o,t[7]=R*h-I*o-M*s-S*u,t},ut.rotateByQuatAppend=function(t,e,n){var o=n[0],s=n[1],u=n[2],h=n[3],m=e[0],y=e[1],x=e[2],T=e[3];return t[0]=m*h+T*o+y*u-x*s,t[1]=y*h+T*s+x*o-m*u,t[2]=x*h+T*u+m*s-y*o,t[3]=T*h-m*o-y*s-x*u,t[4]=(m=e[4])*h+(T=e[7])*o+(y=e[5])*u-(x=e[6])*s,t[5]=y*h+T*s+x*o-m*u,t[6]=x*h+T*u+m*s-y*o,t[7]=T*h-m*o-y*s-x*u,t},ut.rotateByQuatPrepend=function(t,e,n){var o=e[0],s=e[1],u=e[2],h=e[3],m=n[0],y=n[1],x=n[2],T=n[3];return t[0]=o*T+h*m+s*x-u*y,t[1]=s*T+h*y+u*m-o*x,t[2]=u*T+h*x+o*y-s*m,t[3]=h*T-o*m-s*y-u*x,t[4]=o*(T=n[7])+h*(m=n[4])+s*(x=n[6])-u*(y=n[5]),t[5]=s*T+h*y+u*m-o*x,t[6]=u*T+h*x+o*y-s*m,t[7]=h*T-o*m-s*y-u*x,t},ut.rotateAroundAxis=function(t,e,n,o){if(Math.abs(o)<an.EPSILON)return Zr(t,e);var s=Math.hypot(n[0],n[1],n[2]);o*=.5;var u=Math.sin(o),h=u*n[0]/s,m=u*n[1]/s,y=u*n[2]/s,x=Math.cos(o),T=e[0],I=e[1],M=e[2],S=e[3];t[0]=T*x+S*h+I*y-M*m,t[1]=I*x+S*m+M*h-T*y,t[2]=M*x+S*y+T*m-I*h,t[3]=S*x-T*h-I*m-M*y;var R=e[4],L=e[5],k=e[6],B=e[7];return t[4]=R*x+B*h+L*y-k*m,t[5]=L*x+B*m+k*h-R*y,t[6]=k*x+B*y+R*m-L*h,t[7]=B*x-R*h-L*m-k*y,t},ut.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},ut.multiply=Fs,ut.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},ut.lerp=function(t,e,n,o){var s=1-o;return Ld(e,n)<0&&(o=-o),t[0]=e[0]*s+n[0]*o,t[1]=e[1]*s+n[1]*o,t[2]=e[2]*s+n[2]*o,t[3]=e[3]*s+n[3]*o,t[4]=e[4]*s+n[4]*o,t[5]=e[5]*s+n[5]*o,t[6]=e[6]*s+n[6]*o,t[7]=e[7]*s+n[7]*o,t},ut.invert=function(t,e){var n=$l(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},ut.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},ut.normalize=function(t,e){var n=$l(e);if(n>0){n=Math.sqrt(n);var o=e[0]/n,s=e[1]/n,u=e[2]/n,h=e[3]/n,m=e[4],y=e[5],x=e[6],T=e[7],I=o*m+s*y+u*x+h*T;t[0]=o,t[1]=s,t[2]=u,t[3]=h,t[4]=(m-o*I)/n,t[5]=(y-s*I)/n,t[6]=(x-u*I)/n,t[7]=(T-h*I)/n}return t},ut.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},ut.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},ut.equals=function(t,e){var n=t[0],o=t[1],s=t[2],u=t[3],h=t[4],m=t[5],y=t[6],x=t[7],T=e[0],I=e[1],M=e[2],S=e[3],R=e[4],L=e[5],k=e[6],B=e[7];return Math.abs(n-T)<=an.EPSILON*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(o-I)<=an.EPSILON*Math.max(1,Math.abs(o),Math.abs(I))&&Math.abs(s-M)<=an.EPSILON*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(u-S)<=an.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(h-R)<=an.EPSILON*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(m-L)<=an.EPSILON*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(y-k)<=an.EPSILON*Math.max(1,Math.abs(y),Math.abs(k))&&Math.abs(x-B)<=an.EPSILON*Math.max(1,Math.abs(x),Math.abs(B))},ut.sqrLen=ut.squaredLength=ut.len=ut.length=ut.dot=ut.mul=ut.setReal=ut.getReal=void 0;var an=mr(on),Yt=mr(wt),tr=mr(Mt);function nr(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(nr=function(o){return o?n:e})(t)}function mr(t,e){if(t&&t.__esModule)return t;if(t===null||Vn(t)!=="object"&&typeof t!="function")return{default:t};var n=nr(e);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=s?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}function Pr(t,e,n){var o=.5*n[0],s=.5*n[1],u=.5*n[2],h=e[0],m=e[1],y=e[2],x=e[3];return t[0]=h,t[1]=m,t[2]=y,t[3]=x,t[4]=o*x+s*y-u*m,t[5]=s*x+u*h-o*y,t[6]=u*x+o*m-s*h,t[7]=-o*h-s*m-u*y,t}function Zr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Fs(t,e,n){var o=e[0],s=e[1],u=e[2],h=e[3],m=n[4],y=n[5],x=n[6],T=n[7],I=e[4],M=e[5],S=e[6],R=e[7],L=n[0],k=n[1],B=n[2],Z=n[3];return t[0]=o*Z+h*L+s*B-u*k,t[1]=s*Z+h*k+u*L-o*B,t[2]=u*Z+h*B+o*k-s*L,t[3]=h*Z-o*L-s*k-u*B,t[4]=o*T+h*m+s*x-u*y+I*Z+R*L+M*B-S*k,t[5]=s*T+h*y+u*m-o*x+M*Z+R*k+S*L-I*B,t[6]=u*T+h*x+o*y-s*m+S*Z+R*B+I*k-M*L,t[7]=h*T-o*m-s*y-u*x+R*Z-I*L-M*k-S*B,t}ut.getReal=Yt.copy,ut.setReal=Yt.copy,ut.mul=Fs;var Ld=Yt.dot;ut.dot=Ld;var kd=Yt.length;ut.length=kd,ut.len=kd;var $l=Yt.squaredLength;ut.squaredLength=$l,ut.sqrLen=$l;var zt={};function Su(t){return Su=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Su(t)}Object.defineProperty(zt,"__esModule",{value:!0}),zt.create=Nd,zt.clone=function(t){var e=new ts.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},zt.fromValues=function(t,e){var n=new ts.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},zt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},zt.set=function(t,e,n){return t[0]=e,t[1]=n,t},zt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},zt.subtract=zd,zt.multiply=Bd,zt.divide=jd,zt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},zt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},zt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},zt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},zt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},zt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},zt.scaleAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t},zt.distance=Vd,zt.squaredDistance=Ud,zt.length=Gl,zt.squaredLength=Hl,zt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},zt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},zt.normalize=function(t,e){var n=e[0],o=e[1],s=n*n+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t},zt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},zt.cross=function(t,e,n){var o=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=o,t},zt.lerp=function(t,e,n,o){var s=e[0],u=e[1];return t[0]=s+o*(n[0]-s),t[1]=u+o*(n[1]-u),t},zt.random=function(t,e){e=e||1;var n=2*ts.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},zt.transformMat2=function(t,e,n){var o=e[0],s=e[1];return t[0]=n[0]*o+n[2]*s,t[1]=n[1]*o+n[3]*s,t},zt.transformMat2d=function(t,e,n){var o=e[0],s=e[1];return t[0]=n[0]*o+n[2]*s+n[4],t[1]=n[1]*o+n[3]*s+n[5],t},zt.transformMat3=function(t,e,n){var o=e[0],s=e[1];return t[0]=n[0]*o+n[3]*s+n[6],t[1]=n[1]*o+n[4]*s+n[7],t},zt.transformMat4=function(t,e,n){var o=e[0],s=e[1];return t[0]=n[0]*o+n[4]*s+n[12],t[1]=n[1]*o+n[5]*s+n[13],t},zt.rotate=function(t,e,n,o){var s=e[0]-n[0],u=e[1]-n[1],h=Math.sin(o),m=Math.cos(o);return t[0]=s*m-u*h+n[0],t[1]=s*h+u*m+n[1],t},zt.angle=function(t,e){var n=t[0],o=t[1],s=e[0],u=e[1],h=Math.sqrt(n*n+o*o)*Math.sqrt(s*s+u*u);return Math.acos(Math.min(Math.max(h&&(n*s+o*u)/h,-1),1))},zt.zero=function(t){return t[0]=0,t[1]=0,t},zt.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},zt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},zt.equals=function(t,e){var n=t[0],o=t[1],s=e[0],u=e[1];return Math.abs(n-s)<=ts.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(o-u)<=ts.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))},zt.forEach=zt.sqrLen=zt.sqrDist=zt.dist=zt.div=zt.mul=zt.sub=zt.len=void 0;var ts=function(t,e){if(t&&t.__esModule)return t;if(t===null||Su(t)!=="object"&&typeof t!="function")return{default:t};var n=Fd(void 0);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=s?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(on);function Fd(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Fd=function(o){return o?n:e})(t)}function Nd(){var t=new ts.ARRAY_TYPE(2);return ts.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function zd(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Bd(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function jd(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function Vd(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Ud(t,e){var n=e[0]-t[0],o=e[1]-t[1];return n*n+o*o}function Gl(t){return Math.hypot(t[0],t[1])}function Hl(t){var e=t[0],n=t[1];return e*e+n*n}zt.len=Gl,zt.sub=zd,zt.mul=Bd,zt.div=jd,zt.dist=Vd,zt.sqrDist=Ud,zt.sqrLen=Hl;var Au=function(){var t=Nd();return function(e,n,o,s,u,h){var m,y;for(n||(n=2),o||(o=0),y=s?Math.min(s*n+o,e.length):e.length,m=o;m<y;m+=n)t[0]=e[m],t[1]=e[m+1],u(t,t,h),e[m]=t[0],e[m+1]=t[1];return e}}();function Pu(t){return Pu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pu(t)}zt.forEach=Au,Object.defineProperty(rn,"__esModule",{value:!0}),r.aB=rn.vec4=r.$=rn.vec3=rn.vec2=rn.quat2=r.aw=rn.quat=r.ae=rn.mat4=r.bE=rn.mat3=rn.mat2d=r.aD=rn.mat2=rn.glMatrix=void 0;var _m=pi(on);rn.glMatrix=_m;var ym=pi(Dn);r.aD=rn.mat2=ym;var Pa=pi(Pn);rn.mat2d=Pa;var Qt=pi(wn);r.bE=rn.mat3=Qt;var i0=pi(Mt);r.ae=rn.mat4=i0;var o0=pi(wt);r.aw=rn.quat=o0;var s0=pi(ut);rn.quat2=s0;var vm=pi(zt);rn.vec2=vm;var a0=pi(Dt);r.$=rn.vec3=a0;var $d=pi(Tt);function ql(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ql=function(o){return o?n:e})(t)}function pi(t,e){if(t&&t.__esModule)return t;if(t===null||Pu(t)!=="object"&&typeof t!="function")return{default:t};var n=ql(e);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=s?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}r.aB=rn.vec4=$d;var xm=bm;function bm(t,e,n,o){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=o}bm.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,o=0;o<8;o++){var s=this.sampleCurveX(n)-t;if(Math.abs(s)<e)return n;var u=this.sampleCurveDerivativeX(n);if(Math.abs(u)<1e-6)break;n-=s/u}var h=0,m=1;for(n=t,o=0;o<20&&(s=this.sampleCurveX(n),!(Math.abs(s-t)<e));o++)t>s?h=n:m=n,n=.5*(m-h)+h;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Gd=Ft(xm),Wl=Ns;function Ns(t,e){this.x=t,this.y=e}Ns.prototype={clone:function(){return new Ns(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround:function(t,e){var n=Math.cos(t),o=Math.sin(t),s=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ns.convert=function(t){return t instanceof Ns?t:Array.isArray(t)?new Ns(t[0],t[1]):t};var Je=Ft(Wl);function Ra(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Ra(t[n],e[n]))return!1;return!0}if(typeof t=="object"&&t!==null&&e!==null){if(typeof e!="object"||Object.keys(t).length!==Object.keys(e).length)return!1;for(let n in t)if(!Ra(t[n],e[n]))return!1;return!0}return t===e}let wm=Math.PI/180,Oa=180/Math.PI;function Gt(t){return t*wm}function ti(t){return t*Oa}let Zl=[[0,0],[1,0],[1,1],[0,1]];function Ru(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Ou(t,e,n,o){let s=new Gd(t,e,n,o);return function(u){return s.solve(u)}}let Wi=Ou(.25,.1,.25,1);function jt(t,e,n){return Math.min(n,Math.max(e,t))}function Hd(t,e,n){return(n=jt((n-t)/(e-t),0,1))*n*(3-2*n)}function La(t,e,n){let o=n-e,s=((t-e)%o+o)%o+e;return s===e?n:s}function Xl(t,e,n){if(!t.length)return n(null,[]);let o=t.length,s=new Array(t.length),u=null;t.forEach((h,m)=>{e(h,(y,x)=>{y&&(u=y),s[m]=x,--o==0&&n(u,s)})})}function qd(t){let e=[];for(let n in t)e.push(t[n]);return e}function Rr(t,...e){for(let n of e)for(let o in n)t[o]=n[o];return t}let Tm=1;function Lu(){return Tm++}function ka(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function zs(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Wd(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function ku(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Yl(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Ql(t,e,n){let o={};for(let s in t)o[s]=e.call(this,t[s],s,t);return o}function Or(t,e,n){let o={};for(let s in t)e.call(this,t[s],s,t)&&(o[s]=t[s]);return o}function ni(t){return Array.isArray(t)?t.map(ni):typeof t=="object"&&t?Ql(t,ni):t}let Lr={};function rr(t){Lr[t]||(typeof console<"u"&&console.warn(t),Lr[t]=!0)}function ns(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function l0(t){let e=0;for(let n,o,s=0,u=t.length,h=u-1;s<u;h=s++)n=t[s],o=t[h],e+=(o.x-n.x)*(n.y+o.y);return e}function Fa([t,e,n]){let o=Gt(e+90),s=Gt(n);return{x:t*Math.cos(o)*Math.sin(s),y:t*Math.sin(o)*Math.sin(s),z:t*Math.cos(s),azimuthal:e,polar:n}}function Na(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Kl(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,s,u)=>{let h=s||u;return e[o]=!h||h.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Zd,Jl,rs,ec,is,tc,nc=null;function Fu(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function os(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Nu(t,e,n,o){for(;e<n;){let s=e+n>>1;t[s]<o?e=s+1:n=s}return e}function zu(t,e,n,o){for(;e<n;){let s=e+n>>1;t[s]<=o?e=s+1:n=s}return e}function Em(t){return t>0?1/(1.001-t):1+t}function Im(t){return t>0?1-1/(1.001-t):-t}function Xd(){return Zd==null&&(Zd=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Zd}let kr={now:()=>ec!==void 0?ec:performance.now(),setNow(t){ec=t},restoreNow(){ec=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:n,height:o}=t;is||(is=document.createElement("canvas"));let s=is.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return(n>is.width||o>is.height)&&(is.width=n,is.height=o),s.clearRect(-e,-e,n+2*e,o+2*e),s.drawImage(t,0,0,n,o),s.getImageData(-e,-e,n+2*e,o+2*e)},resolveURL:t=>(Jl||(Jl=document.createElement("a")),Jl.href=t,Jl.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(rs==null&&(rs=window.matchMedia("(prefers-reduced-motion: reduce)")),rs.matches)},hasCanvasFingerprintNoise(){if(tc!==void 0)return tc;if(!Xd())return tc=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),n=0;for(let s=0;s<t.width;++s)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(s,0,1,1);let o=e.getImageData(0,0,t.width,t.height);n=0;for(let s=0;s<o.data.length;++s)if(s%4!=3&&n++!==o.data[s])return tc=!0,!0;return tc=!1,!1}};function Mm(t,e){let n=t.indexOf("?");if(n<0)return`${t}?${new URLSearchParams(e).toString()}`;let o=new URLSearchParams(t.slice(n));for(let s in e)o.set(s,e[s]);return`${t.slice(0,n)}?${o.toString()}`}function Yd(t,e={persistentParams:[]}){let n=t.indexOf("?");if(n<0)return t;let o=new URLSearchParams,s=new URLSearchParams(t.slice(n));for(let h of e.persistentParams){let m=s.get(h);m&&o.set(h,m)}let u=o.toString();return`${t.slice(0,n)}${u.length>0?`?${u}`:""}`}let Dm="mapbox-tiles",Qd=500,Kd=50,Cm=["language","worldview","jobid"],ao,Bu;function Sm(){try{return caches}catch{}}function rc(){let t=Sm();t&&!ao&&(ao=t.open(Dm))}let ju=1/0,Vu={supported:!1,testSupport:function(t){!Uu&&za&&(Am?Jd(t):ic=t)}},ic,za,Uu=!1,Am=!1,Pm=typeof self<"u"?self:{};function Jd(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,za),t.isContextLost())return;Vu.supported=!0}catch{}t.deleteTexture(e),Uu=!0}Pm.document&&(za=Pm.document.createElement("img"),za.onload=function(){ic&&Jd(ic),ic=null,Am=!0},za.onerror=function(){Uu=!0,ic=null},za.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let oc={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(oc);class $u extends Error{constructor(e,n,o){n===401&&Y(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let ef=Na()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,lo=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(ef())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,s){let u=new AbortController,h=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:ef(),referrerPolicy:o.referrerPolicy,signal:u.signal}),m=!1,y=!1,x=(T=h.url).indexOf("sku=")>0&&Y(T);var T;o.type==="json"&&h.headers.set("Accept","application/json");let I=(S,R,L)=>{if(y)return;if(S&&S.message!=="SecurityError"&&rr(S.toString()),R&&L)return M(R);let k=Date.now();fetch(h).then(B=>{if(B.ok){let Z=x?B.clone():null;return M(B,Z,k)}return s(new $u(B.statusText,B.status,o.url))}).catch(B=>{B.name!=="AbortError"&&s(new Error(`${B.message} ${o.url}`))})},M=(S,R,L)=>{(o.type==="arrayBuffer"?S.arrayBuffer():o.type==="json"?S.json():S.text()).then(k=>{y||(R&&L&&function(B,Z,W){if(rc(),!ao)return;let X=Kl(Z.headers.get("Cache-Control")||"");if(X["no-store"])return;let re={status:Z.status,statusText:Z.statusText,headers:new Headers};Z.headers.forEach((ge,we)=>re.headers.set(we,ge)),X["max-age"]&&re.headers.set("Expires",new Date(W+1e3*X["max-age"]).toUTCString());let ie=re.headers.get("Expires");if(!ie||new Date(ie).getTime()-W<42e4)return;let le=Yd(B.url,{persistentParams:Cm});if(Z.status===206){let ge=B.headers.get("Range");if(!ge)return;re.status=200,le=Mm(le,{range:ge})}(function(ge,we){if(Bu===void 0)try{new Response(new ReadableStream),Bu=!0}catch{Bu=!1}Bu?we(ge.body):ge.blob().then(we)})(Z,ge=>{let we=new Response((Ce=Z.status)!==200&&Ce!==404&&[101,103,204,205,304].includes(Ce)?null:ge,re);var Ce;rc(),ao&&ao.then(Te=>Te.put(le,we)).catch(Te=>rr(Te.message))})}(h,R,L),m=!0,s(null,k,S.headers.get("Cache-Control"),S.headers.get("Expires")))}).catch(k=>{y||s(new Error(k.message))})};return x?function(S,R){if(rc(),!ao)return R(null);ao.then(L=>{let k=Yd(S.url,{persistentParams:Cm}),B=S.headers.get("Range");B&&(k=Mm(k,{range:B})),L.match(k).then(Z=>{let W=function(X){if(!X)return!1;let re=new Date(X.headers.get("Expires")||0),ie=Kl(X.headers.get("Cache-Control")||"");return re>Date.now()&&!ie["no-cache"]}(Z);L.delete(k),W&&L.put(k,Z.clone()),R(null,Z,W)}).catch(R)}).catch(R)}(h,I):I(null,null),{cancel:()=>{y=!0,m||u.abort()}}}(t,e);if(Na()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(o,s){let u=new XMLHttpRequest;u.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(let h in o.headers)u.setRequestHeader(h,o.headers[h]);return o.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=o.credentials==="include",u.onerror=()=>{s(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let h=u.response;if(o.type==="json")try{h=JSON.parse(u.response)}catch(m){return s(m)}s(null,h,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else s(new $u(u.statusText,u.status,o.url))},u.send(o.body),{cancel:()=>u.abort()}}(t,e)},Bs=function(t,e){return lo(Rr(t,{type:"arrayBuffer"}),e)};function c0(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let Rm="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",sc,Ba;sc=[],Ba=0;let ac=function(t,e){if(Vu.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ba>=V.MAX_PARALLEL_IMAGE_REQUESTS){let u={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return sc.push(u),u}Ba++;let n=!1,o=()=>{if(!n)for(n=!0,Ba--;sc.length&&Ba<V.MAX_PARALLEL_IMAGE_REQUESTS;){let u=sc.shift(),{requestParameters:h,callback:m,cancelled:y}=u;y||(u.cancel=ac(h,m).cancel)}},s=Bs(t,(u,h,m,y)=>{o(),u?e(u):h&&(self.createImageBitmap?function(x,T){let I=new Blob([new Uint8Array(x)],{type:"image/png"});createImageBitmap(I).then(M=>{T(null,M)}).catch(M=>{T(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(x,T)=>e(x,T,m,y)):function(x,T){let I=new Image;I.onload=()=>{T(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=Rm})},I.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let M=new Blob([new Uint8Array(x)],{type:"image/png"});I.src=x.byteLength?URL.createObjectURL(M):Rm}(h,(x,T)=>e(x,T,m,y)))});return{cancel:()=>{s.cancel(),o()}}},tf="01",nf="NO_ACCESS_TOKEN",u0=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Li(t){let e=t.match(u0);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function js(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let rf="mapbox.eventData";function Om(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Vs{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=Om(V.ACCESS_TOKEN),o="";return o=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(s,u)=>String.fromCharCode(+("0x"+u)))):V.ACCESS_TOKEN||"",e?`${rf}.${e}:${o}`:`${rf}:${o}`}fetchEventData(){let e=Fu("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{let s=localStorage.getItem(n);s&&(this.eventData=JSON.parse(s));let u=localStorage.getItem(o);u&&(this.anonId=u)}catch{rr("Unable to read from LocalStorage")}}saveEventData(){let e=Fu("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid"),s=this.anonId;if(e&&s)try{localStorage.setItem(o,s),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{rr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,o,s){if(!V.EVENTS_URL)return;let u=Li(V.EVENTS_URL);u.params.push(`access_token=${s||V.ACCESS_TOKEN||""}`);let h={event:this.type,created:new Date(e).toISOString()},m=n?Rr(h,n):h,y={url:js(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([m])};this.pendingRequest=function(x,T){return lo(Rr(x,{method:"POST"}),T)}(y,x=>{this.pendingRequest=null,o(x),this.saveEventData(),this.processRequests(s)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let Lm=new class extends Vs{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){V.EVENTS_URL&&V.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>ve(n)||Y(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=Om(V.ACCESS_TOKEN),n=e?e.u:V.ACCESS_TOKEN,o=n!==this.eventData.tokenU;Wd(this.anonId)||(this.anonId=ka(),o=!0);let s=this.queue.shift();if(this.eventData.lastSuccess){let u=new Date(this.eventData.lastSuccess),h=new Date(s),m=(s-this.eventData.lastSuccess)/864e5;o=o||m>=1||m<-1||u.getDate()!==h.getDate()}else o=!0;o?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:A,skuId:tf,"enabled.telemetry":!1,userId:this.anonId},u=>{u||(this.eventData.lastSuccess=s,this.eventData.tokenU=n)},t):this.processRequests()}},of=Lm.postTurnstileEvent.bind(Lm),ja=new class extends Vs{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,o){this.skuToken=e,this.errorCb=o,V.EVENTS_URL&&(n||V.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(nf)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Wd(this.anonId)||(this.anonId=ka()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:A,skuId:tf,skuToken:this.skuToken,userId:this.anonId},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},km=ja.postMapLoadEvent.bind(ja),lc=new class extends Vs{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=ka(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){let e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){let{map:n,style:o,importedStyles:s}=e;if(!V.EVENTS_URL||!t&&!V.ACCESS_TOKEN)return;let u=this.getMapInstanceId(n),h={mapInstanceId:u,eventId:this.getEventId(u),style:o};s.length&&(h.importedStyles=s),this.queueRequest({timestamp:Date.now(),payload:h},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:n}=this.queue.shift();this.postEvent(e,n,()=>{},t)}},Fm=lc.postStyleLoadEvent.bind(lc),Nm=new class extends Vs{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){V.EVENTS_URL&&(t||V.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),o=function(s){let u=performance.getEntriesByType("resource"),h=performance.getEntriesByType("mark"),m=function(S){let R={};if(S){for(let L in S)if(L!=="other")for(let k of S[L]){let B=`${L}ResolveRangeMin`,Z=`${L}ResolveRangeMax`,W=`${L}RequestCount`,X=`${L}RequestCachedCount`;R[B]=Math.min(R[B]||1/0,k.startTime),R[Z]=Math.max(R[Z]||-1/0,k.responseEnd);let re=ie=>{R[ie]===void 0&&(R[ie]=0),++R[ie]};k.transferSize!==void 0&&k.transferSize===0&&re(X),re(W)}}return R}(function(S,R){let L={};if(S)for(let k of S){let B=R(k);L[B]===void 0&&(L[B]=[]),L[B].push(k)}return L}(u,qt)),y=window.devicePixelRatio,x=navigator.connection||navigator.mozConnection||navigator.webkitConnection,T=x?x.effectiveType:void 0,I={counters:[],metadata:[],attributes:[]},M=(S,R,L)=>{L!=null&&S.push({name:R,value:L.toString()})};for(let S in m)M(I.counters,S,m[S]);if(s.interactionRange[0]!==1/0&&s.interactionRange[1]!==-1/0&&(M(I.counters,"interactionRangeMin",s.interactionRange[0]),M(I.counters,"interactionRangeMax",s.interactionRange[1])),h)for(let S of Object.keys(Ot)){let R=Ot[S],L=h.find(k=>k.name===R);L&&M(I.counters,R,L.startTime)}return M(I.counters,"visibilityHidden",s.visibilityHidden),M(I.attributes,"style",function(S){if(S)for(let R of S){let L=R.name.split("?")[0];if(rt(L)){let k=L.split("/").slice(-2);if(k.length===2)return`mapbox://styles/${k[0]}/${k[1]}`}}}(u)),M(I.attributes,"terrainEnabled",s.terrainEnabled?"true":"false"),M(I.attributes,"fogEnabled",s.fogEnabled?"true":"false"),M(I.attributes,"projection",s.projection),M(I.attributes,"zoom",s.zoom),M(I.metadata,"devicePixelRatio",y),M(I.metadata,"connectionEffectiveType",T),M(I.metadata,"navigatorUserAgent",navigator.userAgent),M(I.metadata,"screenWidth",window.screen.width),M(I.metadata,"screenHeight",window.screen.height),M(I.metadata,"windowWidth",window.innerWidth),M(I.metadata,"windowHeight",window.innerHeight),M(I.metadata,"mapWidth",s.width/y),M(I.metadata,"mapHeight",s.height/y),M(I.metadata,"webglRenderer",s.renderer),M(I.metadata,"webglVendor",s.vendor),M(I.metadata,"sdkVersion",A),M(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(n);for(let s of o.metadata);for(let s of o.counters);for(let s of o.attributes);this.postEvent(e,o,()=>{},t)}},h0=Nm.postPerformanceEvent.bind(Nm),cc=new class extends Vs{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,o){if(!V.API_URL||!V.SESSION_PATH)return;let s=Li(V.API_URL+V.SESSION_PATH);s.params.push(`sku=${e||""}`),s.params.push(`access_token=${o||V.ACCESS_TOKEN||""}`);let u={url:js(s),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(h,m){return lo(Rr(h,{method:"GET"}),m)}(u,h=>{this.pendingRequest=null,n(h),this.saveEventData(),this.processRequests(o)})}getSessionAPI(t,e,n,o){this.skuToken=e,this.errorCb=o,V.SESSION_PATH&&V.API_URL&&(n||V.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(nf)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},sf=cc.getSessionAPI.bind(cc),uc=new Set;var Us={exports:{}},Va={exports:function(t,e){var n,o,s,u,h,m,y,x;for(o=t.length-(n=3&t.length),s=e,h=3432918353,m=461845907,x=0;x<o;)y=255&t.charCodeAt(x)|(255&t.charCodeAt(++x))<<8|(255&t.charCodeAt(++x))<<16|(255&t.charCodeAt(++x))<<24,++x,s=27492+(65535&(u=5*(65535&(s=(s^=y=(65535&(y=(y=(65535&y)*h+(((y>>>16)*h&65535)<<16)&4294967295)<<15|y>>>17))*m+(((y>>>16)*m&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(u>>>16)&65535)<<16);switch(y=0,n){case 3:y^=(255&t.charCodeAt(x+2))<<16;case 2:y^=(255&t.charCodeAt(x+1))<<8;case 1:s^=y=(65535&(y=(y=(65535&(y^=255&t.charCodeAt(x)))*h+(((y>>>16)*h&65535)<<16)&4294967295)<<15|y>>>17))*m+(((y>>>16)*m&65535)<<16)&4294967295}return s^=t.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,(s^=s>>>16)>>>0}},d0={exports:function(t,e){for(var n,o=t.length,s=e^o,u=0;o>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(u)|(255&t.charCodeAt(++u))<<8|(255&t.charCodeAt(++u))<<16|(255&t.charCodeAt(++u))<<24))+((1540483477*(n>>>16)&65535)<<16),s=1540483477*(65535&s)+((1540483477*(s>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++u;switch(o){case 3:s^=(255&t.charCodeAt(u+2))<<16;case 2:s^=(255&t.charCodeAt(u+1))<<8;case 1:s=1540483477*(65535&(s^=255&t.charCodeAt(u)))+((1540483477*(s>>>16)&65535)<<16)}return s=1540483477*(65535&(s^=s>>>13))+((1540483477*(s>>>16)&65535)<<16),(s^=s>>>15)>>>0}},zm=Va.exports,f0=d0.exports;Us.exports=zm,Us.exports.murmur3=zm,Us.exports.murmur2=f0;var Gu=Ft(Us.exports);class co{constructor(e,...n){Rr(this,n[0]||{}),this.type=e}}class hc extends co{constructor(e,n={}){super("error",Rr({error:e},n))}}function Hu(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function af(t,e,n){if(n&&n[t]){let o=n[t].indexOf(e);o!==-1&&n[t].splice(o,1)}}class $s{on(e,n){return this._listeners=this._listeners||{},Hu(e,n,this._listeners),this}off(e,n){return af(e,n,this._listeners),af(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Hu(e,n,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,n){let o=typeof e=="string"?new co(e,n):e,s=o.type;if(this.listens(s)){o.target=this;let u=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(let y of u)y.call(this,o);let h=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(let y of h)af(s,y,this._oneTimeListeners),y.call(this,o);let m=this._eventedParent;m&&(Rr(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(o))}else o instanceof hc&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}r.G=void 0;var Bm={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function qu(t){return(t=Math.round(t))<0?0:t>255?255:t}function lf(t){return qu(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Wu(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function cf(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{r.G={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Bm)return Bm[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var o=n.indexOf("("),s=n.indexOf(")");if(o!==-1&&s+1===n.length){var u=n.substr(0,o),h=n.substr(o+1,s-(o+1)).split(","),m=1;switch(u){case"rgba":if(h.length!==4)return null;m=Wu(h.pop());case"rgb":return h.length!==3?null:[lf(h[0]),lf(h[1]),lf(h[2]),m];case"hsla":if(h.length!==4)return null;m=Wu(h.pop());case"hsl":if(h.length!==3)return null;var y=(parseFloat(h[0])%360+360)%360/360,x=Wu(h[1]),T=Wu(h[2]),I=T<=.5?T*(x+1):T+x-T*x,M=2*T-I;return[qu(255*cf(M,I,y+1/3)),qu(255*cf(M,I,y)),qu(255*cf(M,I,y-1/3)),m];default:return null}}return null}}catch{}class hn{constructor(e,n,o,s=1){this.r=e,this.g=n,this.b=o,this.a=s}static parse(e){if(!e)return;if(e instanceof hn)return e;if(typeof e!="string")return;let n=r.G(e);return n?new hn(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,o,s]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(o)},${s})`}toRenderColor(e){let{r:n,g:o,b:s,a:u}=this;return new p0(e,n,o,s,u)}}class p0{constructor(e,n,o,s,u){if(e){let h=e.image.height,m=h*h;n=u===0?0:n/u*(h-1),o=u===0?0:o/u*(h-1),s=u===0?0:s/u*(h-1);let y=Math.floor(n),x=Math.floor(o),T=Math.floor(s),I=Math.ceil(n),M=Math.ceil(o),S=Math.ceil(s),R=n-y,L=o-x,k=s-T,B=e.image.data,Z=4*(y+x*m+T*h),W=4*(y+x*m+S*h),X=4*(y+M*m+T*h),re=4*(y+M*m+S*h),ie=4*(I+x*m+T*h),le=4*(I+x*m+S*h),ge=4*(I+M*m+T*h),we=4*(I+M*m+S*h);if(Z<0||we>=B.length)throw new Error("out of range");this.r=gt(gt(gt(B[Z],B[W],k),gt(B[X],B[re],k),L),gt(gt(B[ie],B[le],k),gt(B[ge],B[we],k),L),R)/255*u,this.g=gt(gt(gt(B[Z+1],B[W+1],k),gt(B[X+1],B[re+1],k),L),gt(gt(B[ie+1],B[le+1],k),gt(B[ge+1],B[we+1],k),L),R)/255*u,this.b=gt(gt(gt(B[Z+2],B[W+2],k),gt(B[X+2],B[re+2],k),L),gt(gt(B[ie+2],B[le+2],k),gt(B[ge+2],B[we+2],k),L),R)/255*u,this.a=u}else this.r=n,this.g=o,this.b=s,this.a=u}toArray(){let{r:e,g:n,b:o,a:s}=this;return s===0?[0,0,0,0]:[255*e/s,255*n/s,255*o/s,s]}toArray01(){let{r:e,g:n,b:o,a:s}=this;return s===0?[0,0,0,0]:[e/s,n/s,o/s,s]}toArray01Scaled(e){let{r:n,g:o,b:s,a:u}=this;return u===0?[0,0,0]:[n/u*e,o/u*e,s/u*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:o,a:s}=this;return[e,n,o,s]}toArray01Linear(){let{r:e,g:n,b:o,a:s}=this;return s===0?[0,0,0,0]:[Math.pow(e/s,2.2),Math.pow(n/s,2.2),Math.pow(o/s,2.2),s]}}function gt(t,e,n){return t*(1-n)+e*n}function uf(t,e,n){return t.map((o,s)=>gt(o,e[s],n))}hn.black=new hn(0,0,0,1),hn.white=new hn(1,1,1,1),hn.transparent=new hn(0,0,0,0),hn.red=new hn(1,0,0,1),hn.blue=new hn(0,0,1,1);var dc=Object.freeze({__proto__:null,array:uf,color:function(t,e,n){return new hn(gt(t.r,e.r,n),gt(t.g,e.g,n),gt(t.b,e.b,n),gt(t.a,e.a,n))},number:gt});function Ua(t,...e){for(let n of e)for(let o in n)t[o]=n[o];return t}class uo extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class hf{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[o,s]of n)this.bindings[o]=s}concat(e){return new hf(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let mi={kind:"null"},st={kind:"number"},Kt={kind:"string"},pn={kind:"boolean"},ki={kind:"color"},$a={kind:"object"},ln={kind:"value"},Zu={kind:"collator"},Ga={kind:"formatted"},Gs={kind:"resolvedImage"};function Fr(t,e){return{kind:"array",itemType:t,N:e}}function Qn(t){if(t.kind==="array"){let e=Qn(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let df=[mi,st,Kt,pn,ki,Ga,$a,Fr(ln),Gs];function fc(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!fc(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let n of df)if(!fc(n,e))return null}}return`Expected ${Qn(t)} but found ${Qn(e)} instead.`}function Fi(t,e){return e.some(n=>n.kind===t.kind)}function pc(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}class Xu{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Yu{constructor(e,n,o,s,u){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=o,this.fontStack=s,this.textColor=u}}class Xr{constructor(e){this.sections=e}static fromString(e){return new Xr([new Yu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Xr?e:Xr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let o={};n.fontStack&&(o["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(o["font-scale"]=n.scale),n.textColor&&(o["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),e.push(o)}return e}}class gi{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new gi({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function jm(t,e,n,o){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[t,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[t,e,n,o]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ha(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof hn||t instanceof Xu||t instanceof Xr||t instanceof gi)return!0;if(Array.isArray(t)){for(let e of t)if(!Ha(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!Ha(t[e]))return!1;return!0}return!1}function ur(t){if(t===null)return mi;if(typeof t=="string")return Kt;if(typeof t=="boolean")return pn;if(typeof t=="number")return st;if(t instanceof hn)return ki;if(t instanceof Xu)return Zu;if(t instanceof Xr)return Ga;if(t instanceof gi)return Gs;if(Array.isArray(t)){let e=t.length,n;for(let o of t){let s=ur(o);if(n){if(n===s)continue;n=ln;break}n=s}return Fr(n||ln,e)}return $a}function Zi(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof hn||t instanceof Xr||t instanceof gi?t.toString():JSON.stringify(t)}class Xi{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ha(e[1]))return n.error("invalid value");let o=e[1],s=ur(o),u=n.expectedType;return s.kind!=="array"||s.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(s=u),new Xi(s,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof hn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Xr?this.value.serialize():this.value}}class dr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let ff={string:Kt,number:st,boolean:pn,object:$a};class _i{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,s=1,u=e[0];if(u==="array"){let m,y;if(e.length>2){let x=e[1];if(typeof x!="string"||!(x in ff)||x==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);m=ff[x],s++}else m=ln;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],s++}o=Fr(m,y)}else o=ff[u];let h=[];for(;s<e.length;s++){let m=n.parse(e[s],s,ln);if(!m)return null;h.push(m)}return new _i(o,h)}evaluate(e){for(let n=0;n<this.args.length;n++){let o=this.args[n].evaluate(e);if(!fc(this.type,ur(o)))return o;if(n===this.args.length-1)throw new dr(`The expression ${JSON.stringify(this.args[n].serialize())} evaluated to ${Qn(ur(o))} but was expected to be of type ${Qn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){n.push(o.kind);let s=e.N;(typeof s=="number"||this.args.length>1)&&n.push(s)}}return n.concat(this.args.map(o=>o.serialize()))}}class Hs{constructor(e){this.type=Ga,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");let s=[],u=!1;for(let h=1;h<=e.length-1;++h){let m=e[h];if(u&&typeof m=="object"&&!Array.isArray(m)){u=!1;let y=null;if(m["font-scale"]&&(y=n.parse(m["font-scale"],1,st),!y))return null;let x=null;if(m["text-font"]&&(x=n.parse(m["text-font"],1,Fr(Kt)),!x))return null;let T=null;if(m["text-color"]&&(T=n.parse(m["text-color"],1,ki),!T))return null;let I=s[s.length-1];I.scale=y,I.font=x,I.textColor=T}else{let y=n.parse(e[h],1,ln);if(!y)return null;let x=y.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,s.push({content:y,scale:null,font:null,textColor:null})}}return new Hs(s)}evaluate(e){return new Xr(this.sections.map(n=>{let o=n.content.evaluate(e);return ur(o)===Gs?new Yu("",o,null,null,null):new Yu(Zi(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let o={};n.scale&&(o["font-scale"]=n.scale.serialize()),n.font&&(o["text-font"]=n.font.serialize()),n.textColor&&(o["text-color"]=n.textColor.serialize()),e.push(o)}return e}}class Do{constructor(e,n){this.type=Gs,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let o=n.parse(e[1],1,Kt);if(!o)return n.error("No image name provided.");if(e.length===2)return new Do(o);let s=n.parse(e[2],1,Kt);return s?new Do(o,s):n.error("Secondary image variant is not a string.")}evaluate(e){let n=gi.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function ss(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let m0={"to-boolean":pn,"to-color":ki,"to-number":st,"to-string":Kt};class Co{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o=e[0],s=[],u=mi;if(o==="to-array"){if(!Array.isArray(e[1]))return null;let h=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);u=Fr(n.expectedType.itemType,h)}else{if(!(h>0&&Ha(e[1][0])))return null;u=Fr(ur(e[1][0]),h)}for(let m=0;m<h;m++){let y=e[1][m],x;if(ss(y)==="array")x=n.parse(y,void 0,u.itemType);else{let T=ss(y);if(T!==u.itemType.kind)return n.error(`Expected ${u.itemType.kind} but found ${T}.`);x=n.registry.literal.parse(["literal",y===void 0?null:y],n)}if(!x)return null;s.push(x)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");u=m0[o];for(let h=1;h<e.length;h++){let m=n.parse(e[h],h,ln);if(!m)return null;s.push(m)}}return new Co(u,s)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,o;for(let s of this.args){if(n=s.evaluate(e),o=null,n instanceof hn)return n;if(typeof n=="string"){let u=e.parseColor(n);if(u)return u}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:jm(n[0],n[1],n[2],n[3]),!o))return new hn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new dr(o||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let o of this.args){if(n=o.evaluate(e),n===null)return 0;let s=Number(n);if(!isNaN(s))return s}throw new dr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Xr.fromString(Zi(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?gi.fromString(Zi(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Zi(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Hs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Do(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}let g0=["Unknown","Point","LineString","Polygon"];class pf{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?g0[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:o,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*n-e[0])+this.featureDistanceData.bearing[1]*(s*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=hn.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class ai{constructor(e,n,o,s,u){this.name=e,this.type=n,this._evaluate=o,this.args=s,this._overloadIndex=u}evaluate(e){if(!this._evaluate){let n=ai.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let o=e[0],s=ai.definitions[o];if(!s)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);let u=Array.isArray(s)?s[0]:s.type,h=Array.isArray(s)?[[s[1],s[2]]]:s.overloads,m=[],y=null,x=-1;for(let[T,I]of h){if(Array.isArray(T)&&T.length!==e.length-1)continue;m.push(T),x++,y=new rg(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);let M=[],S=!1;for(let R=1;R<e.length;R++){let L=e[R],k=Array.isArray(T)?T[R-1]:T.type,B=y.parse(L,1+M.length,k);if(!B){S=!0;break}M.push(B)}if(!S)if(Array.isArray(T)&&T.length!==M.length)y.error(`Expected ${T.length} arguments, but found ${M.length} instead.`);else{for(let R=0;R<M.length;R++){let L=Array.isArray(T)?T[R]:T.type,k=M[R];y.concat(R+1).checkSubtype(L,k.type)}if(y.errors.length===0)return new ai(o,u,I,M,x)}}if(m.length===1)n.errors.push(...y.errors);else{let T=(m.length?m:h.map(([M])=>M)).map(_0).join(" | "),I=[];for(let M=1;M<e.length;M++){let S=n.parse(e[M],1+I.length);if(!S)return null;I.push(Qn(S.type))}n.error(`Expected arguments of type ${T}, but found (${I.join(", ")}) instead.`)}return null}static register(e,n){ai.definitions=n;for(let o in n)e[o]=ai}}function _0(t){return Array.isArray(t)?`(${t.map(Qn).join(", ")})`:`(${Qn(t.type)}...)`}class mc{constructor(e,n,o){this.type=Zu,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");let s=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,pn);if(!s)return null;let u=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,pn);if(!u)return null;let h=null;return o.locale&&(h=n.parse(o.locale,1,Kt),!h)?null:new mc(s,u,h)}evaluate(e){return new Xu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function dn(t,e,n=0,o=t.length-1,s=Vm){for(;o>n;){if(o-n>600){let y=o-n+1,x=e-n+1,T=Math.log(y),I=.5*Math.exp(2*T/3),M=.5*Math.sqrt(T*I*(y-I)/y)*(x-y/2<0?-1:1);dn(t,e,Math.max(n,Math.floor(e-x*I/y+M)),Math.min(o,Math.floor(e+(y-x)*I/y+M)),s)}let u=t[e],h=n,m=o;for(qa(t,n,e),s(t[o],u)>0&&qa(t,n,o);h<m;){for(qa(t,h,m),h++,m--;s(t[h],u)<0;)h++;for(;s(t[m],u)>0;)m--}s(t[n],u)===0?qa(t,n,m):(m++,qa(t,m,o)),m<=e&&(n=m+1),e<=m&&(o=m-1)}}function qa(t,e,n){let o=t[e];t[e]=t[n],t[n]=o}function Vm(t,e){return t<e?-1:t>e?1:0}function y0(t){let e=0;for(let n,o,s=0,u=t.length,h=u-1;s<u;h=s++)n=t[s],o=t[h],e+=(o.x-n.x)*(n.y+o.y);return e}function gc(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function as(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Qu(t,e,n){let o=t[0]-e[0],s=t[1]-e[1],u=t[0]-n[0],h=t[1]-n[1];return o*h-u*s==0&&o*u<=0&&s*h<=0}function So(t,e,n=!1){let o=!1;for(let m=0,y=e.length;m<y;m++){let x=e[m];for(let T=0,I=x.length,M=I-1;T<I;M=T++){let S=x[M],R=x[T];if(Qu(t,S,R))return n;(u=S)[1]>(s=t)[1]!=(h=R)[1]>s[1]&&s[0]<(h[0]-u[0])*(s[1]-u[1])/(h[1]-u[1])+u[0]&&(o=!o)}}var s,u,h;return o}function Um(t,e,n,o){let s=o[0]-n[0],u=o[1]-n[1],h=(t[0]-n[0])*u-s*(t[1]-n[1]),m=(e[0]-n[0])*u-s*(e[1]-n[1]);return h>0&&m<0||h<0&&m>0}function _c(t,e,n,o){return(s=[o[0]-n[0],o[1]-n[1]])[0]*(u=[e[0]-t[0],e[1]-t[1]])[1]-s[1]*u[0]!=0&&!(!Um(t,e,n,o)||!Um(n,o,t,e));var s,u}let Nr=8192;function v0(t,e){let n=(180+t[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,s=Math.pow(2,e.z);return[Math.round(n*s*Nr),Math.round(o*s*Nr)]}function $m(t,e){for(let n=0;n<e.length;n++)if(So(t,e[n]))return!0;return!1}function yc(t,e,n){for(let o of n)for(let s=0,u=o.length,h=u-1;s<u;h=s++)if(_c(t,e,o[h],o[s]))return!0;return!1}function Ku(t,e){for(let n=0;n<t.length;++n)if(!So(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(yc(t[n],t[n+1],e))return!1;return!0}function x0(t,e){for(let n=0;n<e.length;n++)if(Ku(t,e[n]))return!0;return!1}function mf(t,e,n){let o=[];for(let s=0;s<t.length;s++){let u=[];for(let h=0;h<t[s].length;h++){let m=v0(t[s][h],n);gc(e,m),u.push(m)}o.push(u)}return o}function Gm(t,e,n){let o=[];for(let s=0;s<t.length;s++){let u=mf(t[s],e,n);o.push(u)}return o}function gf(t,e,n,o){if(t[0]<n[0]||t[0]>n[2]){let s=.5*o,u=t[0]-n[0]>s?-o:n[0]-t[0]>s?o:0;u===0&&(u=t[0]-n[2]>s?-o:n[2]-t[0]>s?o:0),t[0]+=u}gc(e,t)}function Ju(t,e,n,o){let s=Math.pow(2,o.z)*Nr,u=[o.x*Nr,o.y*Nr],h=[];if(!t)return h;for(let m of t)for(let y of m){let x=[y.x+u[0],y.y+u[1]];gf(x,e,n,s),h.push(x)}return h}function Hm(t,e,n,o){let s=Math.pow(2,o.z)*Nr,u=[o.x*Nr,o.y*Nr],h=[];if(!t)return h;for(let y of t){let x=[];for(let T of y){let I=[T.x+u[0],T.y+u[1]];gc(e,I),x.push(I)}h.push(x)}if(e[2]-e[0]<=s/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(let y of h)for(let x of y)gf(x,e,n,s)}var m;return h}class ho{constructor(e,n){this.type=pn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ha(e[1])){let o=e[1];if(o.type==="FeatureCollection")for(let s=0;s<o.features.length;++s){let u=o.features[s].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new ho(o,o.features[s].geometry)}else if(o.type==="Feature"){let s=o.geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new ho(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new ho(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){let s=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=n.canonicalID();if(!h)return!1;if(o.type==="Polygon"){let m=mf(o.coordinates,u,h),y=Ju(n.geometry(),s,u,h);if(!as(s,u))return!1;for(let x of y)if(!So(x,m))return!1}if(o.type==="MultiPolygon"){let m=Gm(o.coordinates,u,h),y=Ju(n.geometry(),s,u,h);if(!as(s,u))return!1;for(let x of y)if(!$m(x,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){let s=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=n.canonicalID();if(!h)return!1;if(o.type==="Polygon"){let m=mf(o.coordinates,u,h),y=Hm(n.geometry(),s,u,h);if(!as(s,u))return!1;for(let x of y)if(!Ku(x,m))return!1}if(o.type==="MultiPolygon"){let m=Gm(o.coordinates,u,h),y=Hm(n.geometry(),s,u,h);if(!as(s,u))return!1;for(let x of y)if(!x0(x,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let eh={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},qm=1/298.257223563,Wm=qm*(2-qm),vc=Math.PI/180;class xc{static fromTile(e,n,o){let s=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),u=Math.atan(.5*(Math.exp(s)-Math.exp(-s)))/vc;return new xc(u,o)}static get units(){return eh}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!eh[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(eh).join(", ")}`);let o=6378.137*vc*(n?eh[n]:1),s=Math.cos(e*vc),u=1/(1-Wm*(1-s*s)),h=Math.sqrt(u);this.kx=o*h*s,this.ky=o*h*u*(1-Wm)}distance(e,n){let o=yi(e[0]-n[0])*this.kx,s=(e[1]-n[1])*this.ky;return Math.sqrt(o*o+s*s)}bearing(e,n){let o=yi(n[0]-e[0])*this.kx;return Math.atan2(o,(n[1]-e[1])*this.ky)/vc}destination(e,n,o){let s=o*vc;return this.offset(e,Math.sin(s)*n,Math.cos(s)*n)}offset(e,n,o){return[e[0]+n/this.kx,e[1]+o/this.ky]}lineDistance(e){let n=0;for(let o=0;o<e.length-1;o++)n+=this.distance(e[o],e[o+1]);return n}area(e){let n=0;for(let o=0;o<e.length;o++){let s=e[o];for(let u=0,h=s.length,m=h-1;u<h;m=u++)n+=yi(s[u][0]-s[m][0])*(s[u][1]+s[m][1])*(o?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let o=0;if(n<=0)return e[0];for(let s=0;s<e.length-1;s++){let u=e[s],h=e[s+1],m=this.distance(u,h);if(o+=m,o>n)return _f(u,h,(n-(o-m))/m)}return e[e.length-1]}pointToSegmentDistance(e,n,o){let[s,u]=n,h=yi(o[0]-s)*this.kx,m=(o[1]-u)*this.ky;if(h!==0||m!==0){let y=(yi(e[0]-s)*this.kx*h+(e[1]-u)*this.ky*m)/(h*h+m*m);y>1?(s=o[0],u=o[1]):y>0&&(s+=h/this.kx*y,u+=m/this.ky*y)}return h=yi(e[0]-s)*this.kx,m=(e[1]-u)*this.ky,Math.sqrt(h*h+m*m)}pointOnLine(e,n){let o=1/0,s=e[0][0],u=e[0][1],h=0,m=0;for(let y=0;y<e.length-1;y++){let x=e[y][0],T=e[y][1],I=yi(e[y+1][0]-x)*this.kx,M=(e[y+1][1]-T)*this.ky,S=0;I===0&&M===0||(S=(yi(n[0]-x)*this.kx*I+(n[1]-T)*this.ky*M)/(I*I+M*M),S>1?(x=e[y+1][0],T=e[y+1][1]):S>0&&(x+=I/this.kx*S,T+=M/this.ky*S)),I=yi(n[0]-x)*this.kx,M=(n[1]-T)*this.ky;let R=I*I+M*M;R<o&&(o=R,s=x,u=T,h=y,m=S)}return{point:[s,u],index:h,t:Math.max(0,Math.min(1,m))}}lineSlice(e,n,o){let s=this.pointOnLine(o,e),u=this.pointOnLine(o,n);if(s.index>u.index||s.index===u.index&&s.t>u.t){let x=s;s=u,u=x}let h=[s.point],m=s.index+1,y=u.index;!Zm(o[m],h[0])&&m<=y&&h.push(o[m]);for(let x=m+1;x<=y;x++)h.push(o[x]);return Zm(o[y],u.point)||h.push(u.point),h}lineSliceAlong(e,n,o){let s=0,u=[];for(let h=0;h<o.length-1;h++){let m=o[h],y=o[h+1],x=this.distance(m,y);if(s+=x,s>e&&u.length===0&&u.push(_f(m,y,(e-(s-x))/x)),s>=n)return u.push(_f(m,y,(n-(s-x))/x)),u;s>e&&u.push(y)}return u}bufferPoint(e,n){let o=n/this.ky,s=n/this.kx;return[e[0]-s,e[1]-o,e[0]+s,e[1]+o]}bufferBBox(e,n){let o=n/this.ky,s=n/this.kx;return[e[0]-s,e[1]-o,e[2]+s,e[3]+o]}insideBBox(e,n){return yi(e[0]-n[0])>=0&&yi(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function Zm(t,e){return t[0]===e[0]&&t[1]===e[1]}function _f(t,e,n){let o=yi(e[0]-t[0]);return[t[0]+o*n,t[1]+(e[1]-t[1])*n]}function yi(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}class ls{constructor(e=[],n=(o,s)=>o<s?-1:o>s?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:n,compare:o}=this,s=n[e];for(;e>0;){let u=e-1>>1,h=n[u];if(o(s,h)>=0)break;n[e]=h,e=u}n[e]=s}_down(e){let{data:n,compare:o}=this,s=this.length>>1,u=n[e];for(;e<s;){let h=1+(e<<1),m=h+1;if(m<this.length&&o(n[m],n[h])<0&&(h=m),o(n[h],u)>=0)break;n[e]=n[h],e=h}n[e]=u}}var Xe=8192;function Xm(t,e){return e.dist-t.dist}let bc=100,yf=50;function Ym(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function th(t){return t[1]-t[0]+1}function Ao(t,e){let n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function vf(t,e){if(t[0]>t[1])return[null,null];let n=th(t);if(e){if(n===2)return[t,null];let o=Math.floor(n/2);return[[t[0],t[0]+o],[t[0]+o,t[1]]]}{if(n===1)return[t,null];let o=Math.floor(n/2)-1;return[[t[0],t[0]+o],[t[0]+o+1,t[1]]]}}function vi(t,e){let n=[1/0,1/0,-1/0,-1/0];if(!Ao(e,t.length))return n;for(let o=e[0];o<=e[1];++o)gc(n,t[o]);return n}function nh(t){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let o=0;o<t[n].length;++o)gc(e,t[n][o]);return e}function Wa(t,e,n){if(Ym(t)||Ym(e))return NaN;let o=0,s=0;return t[2]<e[0]&&(o=e[0]-t[2]),t[0]>e[2]&&(o=t[0]-e[2]),t[1]>e[3]&&(s=t[1]-e[3]),t[3]<e[1]&&(s=e[1]-t[3]),n.distance([0,0],[o,s])}function Qm(t){return 360*t-180}function Km(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function xi(t,e){let n=Math.pow(2,e.z),o=(t.y/Xe+e.y)/n;return[Qm((t.x/Xe+e.x)/n),Km(o)]}function Jm(t,e){let n=[];for(let o=0;o<t.length;++o)n.push(xi(t[o],e));return n}function eg(t,e,n){let o=n.pointOnLine(e,t).point;return n.distance(t,o)}function xf(t,e,n,o,s){let u=n.slice(o[0],o[1]+1),h=1/0;for(let m=e[0];m<=e[1];++m)if((h=Math.min(h,eg(t[m],u,s)))===0)return 0;return h}function Za(t,e,n,o,s){let u=Math.min(s.pointToSegmentDistance(t,n,o),s.pointToSegmentDistance(e,n,o)),h=Math.min(s.pointToSegmentDistance(n,t,e),s.pointToSegmentDistance(o,t,e));return Math.min(u,h)}function b0(t,e,n,o,s){if(!Ao(e,t.length)||!Ao(o,n.length))return NaN;let u=1/0;for(let h=e[0];h<e[1];++h)for(let m=o[0];m<o[1];++m){if(_c(t[h],t[h+1],n[m],n[m+1]))return 0;u=Math.min(u,Za(t[h],t[h+1],n[m],n[m+1],s))}return u}function w0(t,e,n,o,s){if(!Ao(e,t.length)||!Ao(o,n.length))return NaN;let u=1/0;for(let h=e[0];h<=e[1];++h)for(let m=o[0];m<=o[1];++m)if((u=Math.min(u,s.distance(t[h],n[m])))===0)return u;return u}function T0(t,e,n){if(So(t,e,!0))return 0;let o=1/0;for(let s of e){let u=s.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(s[0]!==s[u-1]&&(o=Math.min(o,n.pointToSegmentDistance(t,s[u-1],s[0])))===0||(o=Math.min(o,eg(t,s,n)))===0)return o}return o}function E0(t,e,n,o){if(!Ao(e,t.length))return NaN;for(let u=e[0];u<=e[1];++u)if(So(t[u],n,!0))return 0;let s=1/0;for(let u=e[0];u<e[1];++u)for(let h of n)for(let m=0,y=h.length,x=y-1;m<y;x=m++){if(_c(t[u],t[u+1],h[x],h[m]))return 0;s=Math.min(s,Za(t[u],t[u+1],h[x],h[m],o))}return s}function tg(t,e){for(let n of t)for(let o=0;o<=n.length-1;++o)if(So(n[o],e,!0))return!0;return!1}function rh(t,e,n,o=1/0){let s=nh(t),u=nh(e);if(o!==1/0&&Wa(s,u,n)>=o)return o;if(as(s,u)){if(tg(t,e))return 0}else if(tg(e,t))return 0;let h=o;for(let m of t)for(let y=0,x=m.length,T=x-1;y<x;T=y++)for(let I of e)for(let M=0,S=I.length,R=S-1;M<S;R=M++){if(_c(m[T],m[y],I[R],I[M]))return 0;h=Math.min(h,Za(m[T],m[y],I[R],I[M],n))}return h}function qs(t,e,n,o,s,u,h){if(u===null||h===null)return;let m=Wa(vi(o,u),vi(s,h),n);m<e&&t.push({dist:m,range1:u,range2:h})}function bi(t,e,n,o,s=1/0){let u=Math.min(o.distance(t[0],n[0][0]),s);if(u===0)return u;let h=new ls([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Xm),m=e?yf:bc,y=nh(n);for(;h.length;){let x=h.pop();if(x.dist>=u)continue;let T=x.range1;if(th(T)<=m){if(!Ao(T,t.length))return NaN;if(e){let I=E0(t,T,n,o);if((u=Math.min(u,I))===0)return u}else for(let I=T[0];I<=T[1];++I){let M=T0(t[I],n,o);if((u=Math.min(u,M))===0)return u}}else{let I=vf(T,e);if(I[0]!==null){let M=Wa(vi(t,I[0]),y,o);M<u&&h.push({dist:M,range1:I[0],range2:[0,0]})}if(I[1]!==null){let M=Wa(vi(t,I[1]),y,o);M<u&&h.push({dist:M,range1:I[1],range2:[0,0]})}}}return u}function wc(t,e,n,o,s,u=1/0){let h=Math.min(u,s.distance(t[0],n[0]));if(h===0)return h;let m=new ls([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],Xm),y=e?yf:bc,x=o?yf:bc;for(;m.length;){let T=m.pop();if(T.dist>=h)continue;let I=T.range1,M=T.range2;if(th(I)<=y&&th(M)<=x){if(!Ao(I,t.length)||!Ao(M,n.length))return NaN;if(e&&o?h=Math.min(h,b0(t,I,n,M,s)):e||o?e&&!o?h=Math.min(h,xf(n,M,t,I,s)):!e&&o&&(h=Math.min(h,xf(t,I,n,M,s))):h=Math.min(h,w0(t,I,n,M,s)),h===0)return h}else{let S=vf(I,e),R=vf(M,o);qs(m,h,s,t,n,S[0],R[0]),qs(m,h,s,t,n,S[0],R[1]),qs(m,h,s,t,n,S[1],R[0]),qs(m,h,s,t,n,S[1],R[1])}}return h}function bf(t,e,n,o,s=1/0){let u=s,h=vi(t,[0,t.length-1]);for(let m of n)if(!(u!==1/0&&Wa(h,vi(m,[0,m.length-1]),o)>=u)&&(u=Math.min(u,wc(t,e,m,!0,o,u)),u===0))return u;return u}function ih(t,e,n,o,s=1/0){let u=s,h=vi(t,[0,t.length-1]);for(let m of n){if(u!==1/0&&Wa(h,nh(m),o)>=u)continue;let y=bi(t,e,m,o,u);if(isNaN(y))return y;if((u=Math.min(u,y))===0)return u}return u}function wf(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Ws{constructor(e,n){this.type=st,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ha(e[1])){let o=e[1];if(o.type==="FeatureCollection"){for(let s=0;s<o.features.length;++s)if(wf(o.features[s].geometry.type))return new Ws(o,o.features[s].geometry)}else if(o.type==="Feature"){if(wf(o.geometry.type))return new Ws(o,o.geometry)}else if(wf(o.type))return new Ws(o,o)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),o=e.canonicalID();if(n!=null&&o!=null){if(e.geometryType()==="Point")return function(s,u,h){let m=[];for(let x of s)for(let T of x)m.push(xi(T,u));let y=new xc(m[0][1],"meters");return h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString"?wc(m,!1,h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",y):h.type==="MultiLineString"?bf(m,!1,h.coordinates,y):h.type==="Polygon"||h.type==="MultiPolygon"?ih(m,!1,h.type==="Polygon"?[h.coordinates]:h.coordinates,y):null}(n,o,this.geometries);if(e.geometryType()==="LineString")return function(s,u,h){let m=[];for(let x of s){let T=[];for(let I of x)T.push(xi(I,u));m.push(T)}let y=new xc(m[0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return bf(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",m,y);if(h.type==="MultiLineString"){let x=1/0;for(let T=0;T<h.coordinates.length;T++){let I=bf(h.coordinates[T],!0,m,y,x);if(isNaN(I))return I;if((x=Math.min(x,I))===0)return x}return x}if(h.type==="Polygon"||h.type==="MultiPolygon"){let x=1/0;for(let T=0;T<m.length;T++){let I=ih(m[T],!0,h.type==="Polygon"?[h.coordinates]:h.coordinates,y,x);if(isNaN(I))return I;if((x=Math.min(x,I))===0)return x}return x}return null}(n,o,this.geometries);if(e.geometryType()==="Polygon")return function(s,u,h){let m=[];for(let x of function(T,I){let M=T.length;if(M<=1)return[T];let S=[],R,L;for(let k=0;k<M;k++){let B=y0(T[k]);B!==0&&(T[k].area=Math.abs(B),L===void 0&&(L=B<0),L===B<0?(R&&S.push(R),R=[T[k]]):R.push(T[k]))}return R&&S.push(R),S}(s)){let T=[];for(let I=0;I<x.length;++I)T.push(Jm(x[I],u));m.push(T)}let y=new xc(m[0][0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return ih(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",m,y);if(h.type==="MultiLineString"){let x=1/0;for(let T=0;T<h.coordinates.length;T++){let I=ih(h.coordinates[T],!0,m,y,x);if(isNaN(I))return I;if((x=Math.min(x,I))===0)return x}return x}return h.type==="Polygon"||h.type==="MultiPolygon"?function(x,T,I){let M=1/0;for(let S of x)for(let R of T){let L=rh(S,R,I,M);if(isNaN(L))return L;if((M=Math.min(M,L))===0)return M}return M}(h.type==="Polygon"?[h.coordinates]:h.coordinates,m,y):null}(n,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Tc(t,e){switch(t){case"string":return Zi(e);case"number":return+e;case"boolean":return!!e;case"color":return hn.parse(e);case"formatted":return Xr.fromString(Zi(e));case"resolvedImage":return gi.fromString(Zi(e))}return e}function ng(t,e,n,o){return o!==void 0&&(t=o*Math.round(t/o)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}class cs{constructor(e,n,o){this.type=e,this.key=n,this.scope=o}static parse(e,n){let o=n.expectedType;if(o==null&&(o=ln),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");let s=n.parse(e[1],1);if(!(s instanceof Xi))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let u=n.parse(e[2],2);return u instanceof Xi?new cs(o,Zi(s.value),Zi(u.value)):n.error("Scope of 'config' expression must be a string literal.")}return new cs(o,Zi(s.value))}evaluate(e){let n=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(n);if(!o)return null;let{type:s,value:u,values:h,minValue:m,maxValue:y,stepValue:x}=o,T=o.default.evaluate(e),I=T;if(u){let M=e.scope;e.scope=(M||"").split("").slice(1).join(""),I=u.evaluate(e),e.scope=M}return s&&(I=Tc(s,I)),I===void 0||m===void 0&&y===void 0&&x===void 0||(typeof I=="number"?I=ng(I,m,y,x):Array.isArray(I)&&(I=I.map(M=>typeof M=="number"?ng(M,m,y,x):M))),u!==void 0&&I!==void 0&&h&&!h.includes(I)&&(I=T,s&&(I=Tc(s,I))),(s&&s!==this.type||I!==void 0&&ur(I)!==this.type)&&(I=Tc(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Ec(t){if(t instanceof ai&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof ho||t instanceof Ws)return!1;let e=!0;return t.eachChild(n=>{e&&!Ec(n)&&(e=!1)}),e}function oh(t){if(t instanceof ai&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!oh(n)&&(e=!1)}),e}function Ic(t){if(t instanceof cs)return new Set([t.key]);let e=new Set;return t.eachChild(n=>{e=new Set([...e,...Ic(n)])}),e}function Mc(t,e){if(t instanceof ai&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(o=>{n&&!Mc(o,e)&&(n=!1)}),n}class Dc{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let o=e[1];return n.scope.has(o)?new Dc(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class sh{constructor(e,n=[],o,s=new hf,u=[],h,m){this.registry=e,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=s,this.errors=u,this.expectedType=o,this._scope=h,this.options=m}parse(e,n,o,s,u={}){return n||o?this.concat(n,o,s)._parse(e,u):this._parse(e,u)}_parse(e,n){function o(s,u,h){return h==="assert"?new _i(u,[s]):h==="coerce"?new Co(u,[s]):s}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let s=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(s){let u=s.parse(e,this);if(!u)return null;if(this.expectedType){let h=this.expectedType,m=u.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||m.kind!=="value")if(h.kind!=="color"&&h.kind!=="formatted"&&h.kind!=="resolvedImage"||m.kind!=="value"&&m.kind!=="string"){if(this.checkSubtype(h,m))return null}else u=o(u,h,n.typeAnnotation||"coerce");else u=o(u,h,n.typeAnnotation||"assert")}if(!(u instanceof Xi)&&u.type.kind!=="resolvedImage"&&Cc(u)){let h=new pf(this._scope,this.options);try{u=new Xi(u.type,u.evaluate(h))}catch(m){return this.error(m.message),null}}return u}return Co.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){let s=typeof e=="number"?this.path.concat(e):this.path,u=o?this.scope.concat(o):this.scope;return new sh(this.registry,s,n||null,u,this.errors,this._scope,this.options)}error(e,...n){let o=`${this.key}${n.map(s=>`[${s}]`).join("")}`;this.errors.push(new uo(o,e))}checkSubtype(e,n){let o=fc(e,n);return o&&this.error(o),o}}var rg=sh;function Cc(t){if(t instanceof Dc)return Cc(t.boundExpression);if(t instanceof ai&&t.name==="error"||t instanceof mc||t instanceof ho||t instanceof Ws||t instanceof cs)return!1;let e=t instanceof Co||t instanceof _i,n=!0;return t.eachChild(o=>{n=e?n&&Cc(o):n&&o instanceof Xi}),!!n&&Ec(t)&&Mc(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Zs(t,e){let n=t.length-1,o,s,u=0,h=n,m=0;for(;u<=h;)if(m=Math.floor((u+h)/2),o=t[m],s=t[m+1],o<=e){if(m===n||e<s)return m;u=m+1}else{if(!(o>e))throw new dr("Input is not a number.");h=m-1}return 0}class Xa{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[s,u]of o)this.labels.push(s),this.outputs.push(u)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let o=n.parse(e[1],1,st);if(!o)return null;let s=[],u=null;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);for(let h=1;h<e.length;h+=2){let m=h===1?-1/0:e[h],y=e[h+1],x=h,T=h+1;if(typeof m!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(s.length&&s[s.length-1][0]>=m)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);let I=n.parse(y,T,u);if(!I)return null;u=u||I.type,s.push([m,I])}return new Xa(u,o,s)}evaluate(e){let n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);let s=this.input.evaluate(e);if(s<=n[0])return o[0].evaluate(e);let u=n.length;return s>=n[u-1]?o[u-1].evaluate(e):o[Zs(n,s)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}let ig=.95047,Tf=1.08883,og=4/29,us=6/29,sg=3*us*us,I0=us*us*us,M0=Math.PI/180,D0=180/Math.PI;function ah(t){return t>I0?Math.pow(t,1/3):t/sg+og}function Ef(t){return t>us?t*t*t:sg*(t-og)}function If(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Mf(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ag(t){let e=Mf(t.r),n=Mf(t.g),o=Mf(t.b),s=ah((.4124564*e+.3575761*n+.1804375*o)/ig),u=ah((.2126729*e+.7151522*n+.072175*o)/1);return{l:116*u-16,a:500*(s-u),b:200*(u-ah((.0193339*e+.119192*n+.9503041*o)/Tf)),alpha:t.a}}function lg(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,o=isNaN(t.b)?e:e-t.b/200;return e=1*Ef(e),n=ig*Ef(n),o=Tf*Ef(o),new hn(If(3.2404542*n-1.5371385*e-.4985314*o),If(-.969266*n+1.8760108*e+.041556*o),If(.0556434*n-.2040259*e+1.0572252*o),t.alpha)}function C0(t,e,n){let o=e-t;return t+n*(o>180||o<-180?o-360*Math.round(o/360):o)}let Sc={forward:ag,reverse:lg,interpolate:function(t,e,n){return{l:gt(t.l,e.l,n),a:gt(t.a,e.a,n),b:gt(t.b,e.b,n),alpha:gt(t.alpha,e.alpha,n)}}},Ac={forward:function(t){let{l:e,a:n,b:o}=ag(t),s=Math.atan2(o,n)*D0;return{h:s<0?s+360:s,c:Math.sqrt(n*n+o*o),l:e,alpha:t.a}},reverse:function(t){let e=t.h*M0,n=t.c;return lg({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:C0(t.h,e.h,n),c:gt(t.c,e.c,n),l:gt(t.l,e.l,n),alpha:gt(t.alpha,e.alpha,n)}}};var Pc=Object.freeze({__proto__:null,hcl:Ac,lab:Sc});class wi{constructor(e,n,o,s,u){this.type=e,this.operator=n,this.interpolation=o,this.input=s,this.labels=[],this.outputs=[];for(let[h,m]of u)this.labels.push(h),this.outputs.push(m)}static interpolationFactor(e,n,o,s){let u=0;if(e.name==="exponential")u=Df(n,e.base,o,s);else if(e.name==="linear")u=Df(n,1,o,s);else if(e.name==="cubic-bezier"){let h=e.controlPoints;u=new Gd(h[0],h[1],h[2],h[3]).solve(Df(n,1,o,s))}return u}static parse(e,n){let[o,s,u,...h]=e;if(!Array.isArray(s)||s.length===0)return n.error("Expected an interpolation type expression.",1);if(s[0]==="linear")s={name:"linear"};else if(s[0]==="exponential"){let x=s[1];if(typeof x!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);s={name:"exponential",base:x}}else{if(s[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(s[0])}`,1,0);{let x=s.slice(1);if(x.length!==4||x.some(T=>typeof T!="number"||T<0||T>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);s={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(u=n.parse(u,2,st),!u)return null;let m=[],y=null;o==="interpolate-hcl"||o==="interpolate-lab"?y=ki:n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let x=0;x<h.length;x+=2){let T=h[x],I=h[x+1],M=x+3,S=x+4;if(typeof T!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(m.length&&m[m.length-1][0]>=T)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);let R=n.parse(I,S,y);if(!R)return null;y=y||R.type,m.push([T,R])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new wi(y,o,s,u,m):n.error(`Type ${Qn(y)} is not interpolatable.`)}evaluate(e){let n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);let s=this.input.evaluate(e);if(s<=n[0])return o[0].evaluate(e);let u=n.length;if(s>=n[u-1])return o[u-1].evaluate(e);let h=Zs(n,s),m=wi.interpolationFactor(this.interpolation,s,n[h],n[h+1]),y=o[h].evaluate(e),x=o[h+1].evaluate(e);return this.operator==="interpolate"?dc[this.type.kind.toLowerCase()](y,x,m):this.operator==="interpolate-hcl"?Ac.reverse(Ac.interpolate(Ac.forward(y),Ac.forward(x),m)):Sc.reverse(Sc.interpolate(Sc.forward(y),Sc.forward(x),m))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)n.push(this.labels[o],this.outputs[o].serialize());return n}}function Df(t,e,n,o){let s=o-n,u=t-n;return s===0?0:e===1?u/s:(Math.pow(e,u)-1)/(Math.pow(e,s)-1)}class Xs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let o=null,s=n.expectedType;s&&s.kind!=="value"&&(o=s);let u=[];for(let m of e.slice(1)){let y=n.parse(m,1+u.length,o,void 0,{typeAnnotation:"omit"});if(!y)return null;o=o||y.type,u.push(y)}let h=s&&u.some(m=>fc(s,m.type));return new Xs(h?ln:o,u)}evaluate(e){let n,o=null,s=0;for(let u of this.args){if(s++,o=u.evaluate(e),o&&o instanceof gi&&!o.available&&(n||(n=o),o=null,s===this.args.length))return n;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class lh{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let o=[];for(let u=1;u<e.length-1;u+=2){let h=e[u];if(typeof h!="string")return n.error(`Expected string, but found ${typeof h} instead.`,u);if(/[^a-zA-Z0-9_]/.test(h))return n.error("Variable names must contain only alphanumeric characters or '_'.",u);let m=n.parse(e[u+1],u+1);if(!m)return null;o.push([h,m])}let s=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return s?new lh(o,s):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,o]of this.bindings)e.push(n,o.serialize());return e.push(this.result.serialize()),e}}class ch{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,st),s=n.parse(e[2],2,Fr(n.expectedType||ln));return o&&s?new ch(s.type.itemType,o,s):null}evaluate(e){let n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new dr(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new dr(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new dr(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Cf{constructor(e,n){this.type=pn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,ln),s=n.parse(e[2],2,ln);return o&&s?Fi(o.type,[pn,Kt,st,mi,ln])?new Cf(o,s):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qn(o.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!pc(n,["boolean","string","number","null"]))throw new dr(`Expected first argument to be of type boolean, string, number or null, but found ${Qn(ur(n))} instead.`);if(!pc(o,["string","array"]))throw new dr(`Expected second argument to be of type array or string, but found ${Qn(ur(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Rc{constructor(e,n,o){this.type=st,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,ln),s=n.parse(e[2],2,ln);if(!o||!s)return null;if(!Fi(o.type,[pn,Kt,st,mi,ln]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qn(o.type)} instead`);if(e.length===4){let u=n.parse(e[3],3,st);return u?new Rc(o,s,u):null}return new Rc(o,s)}evaluate(e){let n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!pc(n,["boolean","string","number","null"]))throw new dr(`Expected first argument to be of type boolean, string, number or null, but found ${Qn(ur(n))} instead.`);if(!pc(o,["string","array"]))throw new dr(`Expected second argument to be of type array or string, but found ${Qn(ur(o))} instead.`);if(this.fromIndex){let s=this.fromIndex.evaluate(e);return o.indexOf(n,s)}return o.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class uh{constructor(e,n,o,s,u,h){this.inputType=e,this.type=n,this.input=o,this.cases=s,this.outputs=u,this.otherwise=h}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,s;n.expectedType&&n.expectedType.kind!=="value"&&(s=n.expectedType);let u={},h=[];for(let x=2;x<e.length-1;x+=2){let T=e[x],I=e[x+1];Array.isArray(T)||(T=[T]);let M=n.concat(x);if(T.length===0)return M.error("Expected at least one branch label.");for(let R of T){if(typeof R!="number"&&typeof R!="string")return M.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return M.error("Numeric branch labels must be integer values.");if(o){if(M.checkSubtype(o,ur(R)))return null}else o=ur(R);if(u[String(R)]!==void 0)return M.error("Branch labels must be unique.");u[String(R)]=h.length}let S=n.parse(I,x,s);if(!S)return null;s=s||S.type,h.push(S)}let m=n.parse(e[1],1,ln);if(!m)return null;let y=n.parse(e[e.length-1],e.length-1,s);return y?m.type.kind!=="value"&&n.concat(1).checkSubtype(o,m.type)?null:new uh(o,s,m,u,h,y):null}evaluate(e){let n=this.input.evaluate(e);return(ur(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),o=[],s={};for(let h of n){let m=s[this.cases[h]];m===void 0?(s[this.cases[h]]=o.length,o.push([this.cases[h],[h]])):o[m][1].push(h)}let u=h=>this.inputType.kind==="number"?Number(h):h;for(let[h,m]of o)e.push(m.length===1?u(m[0]):m.map(u)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}class hh{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);let s=[];for(let h=1;h<e.length-1;h+=2){let m=n.parse(e[h],h,pn);if(!m)return null;let y=n.parse(e[h+1],h+1,o);if(!y)return null;s.push([m,y]),o=o||y.type}let u=n.parse(e[e.length-1],e.length-1,o);return u?new hh(o,s,u):null}evaluate(e){for(let[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Oc{constructor(e,n,o,s){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,ln),s=n.parse(e[2],2,st);if(!o||!s)return null;if(!Fi(o.type,[Fr(ln),Kt,ln]))return n.error(`Expected first argument to be of type array or string, but found ${Qn(o.type)} instead`);if(e.length===4){let u=n.parse(e[3],3,st);return u?new Oc(o.type,o,s,u):null}return new Oc(o.type,o,s)}evaluate(e){let n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!pc(n,["string","array"]))throw new dr(`Expected first argument to be of type array or string, but found ${Qn(ur(n))} instead.`);if(this.endIndex){let s=this.endIndex.evaluate(e);return n.slice(o,s)}return n.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function dh(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function fh(t,e,n,o){return o.compare(e,n)===0}function Ya(t,e,n){let o=t!=="=="&&t!=="!=";return class AA{constructor(u,h,m){this.type=pn,this.lhs=u,this.rhs=h,this.collator=m,this.hasUntypedArgument=u.type.kind==="value"||h.type.kind==="value"}static parse(u,h){if(u.length!==3&&u.length!==4)return h.error("Expected two or three arguments.");let m=u[0],y=h.parse(u[1],1,ln);if(!y)return null;if(!dh(m,y.type))return h.concat(1).error(`"${m}" comparisons are not supported for type '${Qn(y.type)}'.`);let x=h.parse(u[2],2,ln);if(!x)return null;if(!dh(m,x.type))return h.concat(2).error(`"${m}" comparisons are not supported for type '${Qn(x.type)}'.`);if(y.type.kind!==x.type.kind&&y.type.kind!=="value"&&x.type.kind!=="value")return h.error(`Cannot compare types '${Qn(y.type)}' and '${Qn(x.type)}'.`);o&&(y.type.kind==="value"&&x.type.kind!=="value"?y=new _i(x.type,[y]):y.type.kind!=="value"&&x.type.kind==="value"&&(x=new _i(y.type,[x])));let T=null;if(u.length===4){if(y.type.kind!=="string"&&x.type.kind!=="string"&&y.type.kind!=="value"&&x.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(T=h.parse(u[3],3,Zu),!T)return null}return new AA(y,x,T)}evaluate(u){let h=this.lhs.evaluate(u),m=this.rhs.evaluate(u);if(o&&this.hasUntypedArgument){let y=ur(h),x=ur(m);if(y.kind!==x.kind||y.kind!=="string"&&y.kind!=="number")throw new dr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${x.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){let y=ur(h),x=ur(m);if(y.kind!=="string"||x.kind!=="string")return e(u,h,m)}return this.collator?n(u,h,m,this.collator.evaluate(u)):e(u,h,m)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){let u=[t];return this.eachChild(h=>{u.push(h.serialize())}),u}}}let S0=Ya("==",function(t,e,n){return e===n},fh),cg=Ya("!=",function(t,e,n){return e!==n},function(t,e,n,o){return!fh(0,e,n,o)}),A0=Ya("<",function(t,e,n){return e<n},function(t,e,n,o){return o.compare(e,n)<0}),P0=Ya(">",function(t,e,n){return e>n},function(t,e,n,o){return o.compare(e,n)>0}),R0=Ya("<=",function(t,e,n){return e<=n},function(t,e,n,o){return o.compare(e,n)<=0}),O0=Ya(">=",function(t,e,n){return e>=n},function(t,e,n,o){return o.compare(e,n)>=0});class Sf{constructor(e,n,o,s,u,h){this.type=Kt,this.number=e,this.locale=n,this.currency=o,this.unit=s,this.minFractionDigits=u,this.maxFractionDigits=h}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let o=n.parse(e[1],1,st);if(!o)return null;let s=e[2];if(typeof s!="object"||Array.isArray(s))return n.error("NumberFormat options argument must be an object.");let u=null;if(s.locale&&(u=n.parse(s.locale,1,Kt),!u))return null;let h=null;if(s.currency&&(h=n.parse(s.currency,1,Kt),!h))return null;let m=null;if(s.unit&&(m=n.parse(s.unit,1,Kt),!m))return null;let y=null;if(s["min-fraction-digits"]&&(y=n.parse(s["min-fraction-digits"],1,st),!y))return null;let x=null;return s["max-fraction-digits"]&&(x=n.parse(s["max-fraction-digits"],1,st),!x)?null:new Sf(o,u,h,m,y,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Af{constructor(e){this.type=st,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Qn(o.type)} instead.`):new Af(o):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new dr(`Expected value to be of type string or array, but found ${Qn(ur(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function ug(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Qa={"==":S0,"!=":cg,">":P0,"<":A0,">=":O0,"<=":R0,array:_i,at:ch,boolean:_i,case:hh,coalesce:Xs,collator:mc,format:Hs,image:Do,in:Cf,"index-of":Rc,interpolate:wi,"interpolate-hcl":wi,"interpolate-lab":wi,length:Af,let:lh,literal:Xi,match:uh,number:_i,"number-format":Sf,object:_i,slice:Oc,step:Xa,string:_i,"to-boolean":Co,"to-color":Co,"to-number":Co,"to-string":Co,var:Dc,within:ho,distance:Ws,config:cs};function hg(t,[e,n,o,s]){e=e.evaluate(t),n=n.evaluate(t),o=o.evaluate(t);let u=s?s.evaluate(t):1,h=jm(e,n,o,u);if(h)throw new dr(h);return new hn(e/255*u,n/255*u,o/255*u,u)}function L0(t,[e,n,o,s]){e=e.evaluate(t),n=n.evaluate(t),o=o.evaluate(t);let u=s?s.evaluate(t):1,h=function(x,T,I,M){return typeof x=="number"&&x>=0&&x<=360?typeof T=="number"&&T>=0&&T<=100&&typeof I=="number"&&I>=0&&I<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[x,T,I,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[x,T,I,M]:[x,T,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[x,T,I,M]:[x,T,I]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,o,u);if(h)throw new dr(h);let m=`hsla(${e}, ${n}%, ${o}%, ${u})`,y=hn.parse(m);if(!y)throw new dr(`Failed to parse HSLA color: ${m}`);return y}function d(t,e){return t in e}function i(t,e){let n=e[t];return n===void 0?null:n}function a(t){return{type:t}}function f(t){return{result:"success",value:t}}function _(t){return{result:"error",value:t}}function v(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function w(t){return t["property-type"]==="data-driven"}function E(t){return v(t.expression,"measure-light")}function D(t){return v(t.expression,"zoom")}function C(t){return!!t.expression&&t.expression.interpolated}function P(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function O(t){return t}function F(t,e){let n=e.type==="color",o=t.stops&&typeof t.stops[0][0]=="object",s=o||!(o||t.property!==void 0),u=t.type||(C(e)?"exponential":"interval");if(n&&((t=Ua({},t)).stops&&(t.stops=t.stops.map(x=>[x[0],hn.parse(x[1])])),t.default=hn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Pc[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let h,m,y;if(u==="exponential")h=G;else if(u==="interval")h=$;else if(u==="categorical"){h=U,m=Object.create(null);for(let x of t.stops)m[x[0]]=x[1];y=typeof t.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);h=H}if(o){let x={},T=[];for(let S=0;S<t.stops.length;S++){let R=t.stops[S],L=R[0].zoom;x[L]===void 0&&(x[L]={zoom:L,type:t.type,property:t.property,default:t.default,stops:[]},T.push(L)),x[L].stops.push([R[0].value,R[1]])}let I=[];for(let S of T)I.push([x[S].zoom,F(x[S],e)]);let M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:wi.interpolationFactor.bind(void 0,M),zoomStops:I.map(S=>S[0]),evaluate:({zoom:S},R)=>G({stops:I,base:t.base},e,S).evaluate(S,R)}}if(s){let x=u==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:wi.interpolationFactor.bind(void 0,x),zoomStops:t.stops.map(T=>T[0]),evaluate:({zoom:T})=>h(t,e,T,m,y)}}return{kind:"source",evaluate(x,T){let I=T&&T.properties?T.properties[t.property]:void 0;return I===void 0?z(t.default,e.default):h(t,e,I,m,y)}}}function z(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function U(t,e,n,o,s){return z(typeof n===s?o[n]:void 0,t.default,e.default)}function $(t,e,n){if(ss(n)!=="number")return z(t.default,e.default);let o=t.stops.length;if(o===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[o-1][0])return t.stops[o-1][1];let s=Zs(t.stops.map(u=>u[0]),n);return t.stops[s][1]}function G(t,e,n){let o=t.base!==void 0?t.base:1;if(ss(n)!=="number")return z(t.default,e.default);let s=t.stops.length;if(s===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[s-1][0])return t.stops[s-1][1];let u=Zs(t.stops.map(T=>T[0]),n),h=function(T,I,M,S){let R=S-M,L=T-M;return R===0?0:I===1?L/R:(Math.pow(I,L)-1)/(Math.pow(I,R)-1)}(n,o,t.stops[u][0],t.stops[u+1][0]),m=t.stops[u][1],y=t.stops[u+1][1],x=dc[e.type]||O;if(t.colorSpace&&t.colorSpace!=="rgb"){let T=Pc[t.colorSpace];x=(I,M)=>T.reverse(T.interpolate(T.forward(I),T.forward(M),h))}return typeof m.evaluate=="function"?{evaluate(...T){let I=m.evaluate.apply(void 0,T),M=y.evaluate.apply(void 0,T);if(I!==void 0&&M!==void 0)return x(I,M,h)}}:x(m,y,h)}function H(t,e,n){return e.type==="color"?n=hn.parse(n):e.type==="formatted"?n=Xr.fromString(n.toString()):e.type==="resolvedImage"?n=gi.fromString(n.toString()):ss(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),z(n,t.default,e.default)}ai.register(Qa,{error:[{kind:"error"},[Kt],(t,[e])=>{throw new dr(e.evaluate(t))}],typeof:[Kt,[ln],(t,[e])=>Qn(ur(e.evaluate(t)))],"to-rgba":[Fr(st,4),[ki],(t,[e])=>e.evaluate(t).toRenderColor(null).toArray()],rgb:[ki,[st,st,st],hg],rgba:[ki,[st,st,st,st],hg],hsl:[ki,[st,st,st],L0],hsla:[ki,[st,st,st,st],L0],has:{type:pn,overloads:[[[Kt],(t,[e])=>d(e.evaluate(t),t.properties())],[[Kt,$a],(t,[e,n])=>d(e.evaluate(t),n.evaluate(t))]]},get:{type:ln,overloads:[[[Kt],(t,[e])=>i(e.evaluate(t),t.properties())],[[Kt,$a],(t,[e,n])=>i(e.evaluate(t),n.evaluate(t))]]},"feature-state":[ln,[Kt],(t,[e])=>i(e.evaluate(t),t.featureState||{})],properties:[$a,[],t=>t.properties()],"geometry-type":[Kt,[],t=>t.geometryType()],id:[ln,[],t=>t.id()],zoom:[st,[],t=>t.globals.zoom],pitch:[st,[],t=>t.globals.pitch||0],"distance-from-center":[st,[],t=>t.distanceFromCenter()],"measure-light":[st,[Kt],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[st,[],t=>t.globals.heatmapDensity||0],"line-progress":[st,[],t=>t.globals.lineProgress||0],"raster-value":[st,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[st,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[st,[],t=>t.globals.skyRadialProgress||0],accumulated:[ln,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[st,a(st),(t,e)=>{let n=0;for(let o of e)n+=o.evaluate(t);return n}],"*":[st,a(st),(t,e)=>{let n=1;for(let o of e)n*=o.evaluate(t);return n}],"-":{type:st,overloads:[[[st,st],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[st],(t,[e])=>-e.evaluate(t)]]},"/":[st,[st,st],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[st,[st,st],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[st,[],()=>Math.LN2],pi:[st,[],()=>Math.PI],e:[st,[],()=>Math.E],"^":[st,[st,st],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[st,[st],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[st,[st],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[st,[st],(t,[e])=>Math.log(e.evaluate(t))],log2:[st,[st],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[st,[st],(t,[e])=>Math.sin(e.evaluate(t))],cos:[st,[st],(t,[e])=>Math.cos(e.evaluate(t))],tan:[st,[st],(t,[e])=>Math.tan(e.evaluate(t))],asin:[st,[st],(t,[e])=>Math.asin(e.evaluate(t))],acos:[st,[st],(t,[e])=>Math.acos(e.evaluate(t))],atan:[st,[st],(t,[e])=>Math.atan(e.evaluate(t))],min:[st,a(st),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[st,a(st),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[st,[st],(t,[e])=>Math.abs(e.evaluate(t))],round:[st,[st],(t,[e])=>{let n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[st,[st],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[st,[st],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[pn,[Kt,ln],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[pn,[ln],(t,[e])=>t.id()===e.value],"filter-type-==":[pn,[Kt],(t,[e])=>t.geometryType()===e.value],"filter-<":[pn,[Kt,ln],(t,[e,n])=>{let o=t.properties()[e.value],s=n.value;return typeof o==typeof s&&o<s}],"filter-id-<":[pn,[ln],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[pn,[Kt,ln],(t,[e,n])=>{let o=t.properties()[e.value],s=n.value;return typeof o==typeof s&&o>s}],"filter-id->":[pn,[ln],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[pn,[Kt,ln],(t,[e,n])=>{let o=t.properties()[e.value],s=n.value;return typeof o==typeof s&&o<=s}],"filter-id-<=":[pn,[ln],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[pn,[Kt,ln],(t,[e,n])=>{let o=t.properties()[e.value],s=n.value;return typeof o==typeof s&&o>=s}],"filter-id->=":[pn,[ln],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[pn,[ln],(t,[e])=>e.value in t.properties()],"filter-has-id":[pn,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[pn,[Fr(Kt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[pn,[Fr(ln)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[pn,[Kt,Fr(ln)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[pn,[Kt,Fr(ln)],(t,[e,n])=>function(o,s,u,h){for(;u<=h;){let m=u+h>>1;if(s[m]===o)return!0;s[m]>o?h=m-1:u=m+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:pn,overloads:[[[pn,pn],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[a(pn),(t,e)=>{for(let n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:pn,overloads:[[[pn,pn],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[a(pn),(t,e)=>{for(let n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[pn,[pn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[pn,[Kt],(t,[e])=>{let n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Kt,[Kt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Kt,[Kt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Kt,a(ln),(t,e)=>e.map(n=>Zi(n.evaluate(t))).join("")],"resolved-locale":[Kt,[Zu],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[st,[st,st,ln],(t,e)=>{let[n,o,s]=e.map(h=>h.evaluate(t));if(n>o||n===o)return n;let u;if(typeof s=="string")u=function(h){let m=0;if(h.length===0)return m;for(let y=0;y<h.length;y++)m=(m<<5)-m+h.charCodeAt(y),m|=0;return m}(s);else{if(typeof s!="number")throw new dr(`Invalid seed input: ${s}`);u=s}return n+ug(u)()*(o-n)}]});class K{constructor(e,n,o,s){this.expression=e,this._warningHistory={},this._evaluator=new pf(o,s),this._defaultValue=n?function(u){return u.type==="color"&&(P(u.default)||Array.isArray(u.default))?new hn(0,0,0,0):u.type==="color"?hn.parse(u.default)||null:u.default===void 0?null:u.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,o,s,u,h,m,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=s||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,s,u,h,m,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=s||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=y||null;try{let x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new dr(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${x.message}`)),this._defaultValue}}}function J(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Qa}function Q(t,e,n,o){let s=new rg(Qa,[],e?function(h){let m={color:ki,string:Kt,number:st,enum:Kt,boolean:pn,formatted:Ga,resolvedImage:Gs};return h.type==="array"?Fr(m[h.value]||ln,h.length):m[h.type]}(e):void 0,void 0,void 0,n,o),u=s.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?f(new K(u,e,n,o)):_(s.errors)}class se{constructor(e,n,o){this.kind=e,this._styleExpression=n,this.isLightConstant=o,this.isStateDependent=e!=="constant"&&!oh(n.expression),this.configDependencies=Ic(n.expression)}evaluateWithoutErrorHandling(e,n,o,s,u,h){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,s,u,h)}evaluate(e,n,o,s,u,h){return this._styleExpression.evaluate(e,n,o,s,u,h)}}class te{constructor(e,n,o,s,u){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!oh(n.expression),this.isLightConstant=u,this.configDependencies=Ic(n.expression),this.interpolationType=s}evaluateWithoutErrorHandling(e,n,o,s,u,h){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,s,u,h)}evaluate(e,n,o,s,u,h){return this._styleExpression.evaluate(e,n,o,s,u,h)}interpolationFactor(e,n,o){return this.interpolationType?wi.interpolationFactor(this.interpolationType,e,n,o):0}}function ne(t,e,n,o){if((t=Q(t,e,n,o)).result==="error")return t;let s=t.value.expression,u=Ec(s);if(!u&&!w(e))return _([new uo("","data expressions not supported")]);let h=Mc(s,["zoom","pitch","distance-from-center"]);if(!h&&!D(e))return _([new uo("","zoom expressions not supported")]);let m=Mc(s,["measure-light"]);if(!m&&!E(e))return _([new uo("","measure-light expression not supported")]);let y=e.expression&&e.expression.relaxZoomRestriction,x=he(s);return x||h||y?x instanceof uo?_([x]):x instanceof wi&&!C(e)?_([new uo("",'"interpolate" expressions cannot be used with this property')]):f(x?new te(u?"camera":"composite",t.value,x.labels,x instanceof wi?x.interpolation:void 0,m):new se(u?"constant":"source",t.value,m)):_([new uo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ce{constructor(e,n){this._parameters=e,this._specification=n,Ua(this,F(this._parameters,this._specification))}static deserialize(e){return new ce(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function he(t){let e=null;if(t instanceof lh)e=he(t.result);else if(t instanceof Xs){for(let n of t.args)if(e=he(n),e)break}else(t instanceof Xa||t instanceof wi)&&t.input instanceof ai&&t.input.name==="zoom"&&(e=t);return e instanceof uo||t.eachChild(n=>{let o=he(n);o instanceof uo?e=o:e&&o&&e!==o&&(e=new uo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var xe=oe,de=3;function oe(t,e,n){var o=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var s=new Int32Array(this.arrayBuffer);t=s[0],this.d=(e=s[1])+2*(n=s[2]);for(var u=0;u<this.d*this.d;u++){var h=s[de+u],m=s[de+u+1];o.push(h===m?null:s.subarray(h,m))}var y=s[de+o.length+1];this.keys=s.subarray(s[de+o.length],y),this.bboxes=s.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var x=0;x<this.d*this.d;x++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var T=n/e*t;this.min=-T,this.max=t+T}oe.prototype.insert=function(t,e,n,o,s){this._forEachCell(e,n,o,s,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(s)},oe.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},oe.prototype._insertCell=function(t,e,n,o,s,u){this.cells[s].push(u)},oe.prototype.query=function(t,e,n,o,s){var u=this.min,h=this.max;if(t<=u&&e<=u&&h<=n&&h<=o&&!s)return Array.prototype.slice.call(this.keys);var m=[];return this._forEachCell(t,e,n,o,this._queryCell,m,{},s),m},oe.prototype._queryCell=function(t,e,n,o,s,u,h,m){var y=this.cells[s];if(y!==null)for(var x=this.keys,T=this.bboxes,I=0;I<y.length;I++){var M=y[I];if(h[M]===void 0){var S=4*M;(m?m(T[S+0],T[S+1],T[S+2],T[S+3]):t<=T[S+2]&&e<=T[S+3]&&n>=T[S+0]&&o>=T[S+1])?(h[M]=!0,u.push(x[M])):h[M]=!1}}},oe.prototype._forEachCell=function(t,e,n,o,s,u,h,m){for(var y=this._convertToCellCoord(t),x=this._convertToCellCoord(e),T=this._convertToCellCoord(n),I=this._convertToCellCoord(o),M=y;M<=T;M++)for(var S=x;S<=I;S++){var R=this.d*S+M;if((!m||m(this._convertFromCellCoord(M),this._convertFromCellCoord(S),this._convertFromCellCoord(M+1),this._convertFromCellCoord(S+1)))&&s.call(this,t,e,n,o,R,u,h,m))return}},oe.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},oe.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},oe.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=de+this.cells.length+1+1,n=0,o=0;o<this.cells.length;o++)n+=this.cells[o].length;var s=new Int32Array(e+n+this.keys.length+this.bboxes.length);s[0]=this.extent,s[1]=this.n,s[2]=this.padding;for(var u=e,h=0;h<t.length;h++){var m=t[h];s[de+h]=u,s.set(m,u),u+=m.length}return s[de+t.length]=u,s.set(this.keys,u),s[de+t.length+1]=u+=this.keys.length,s.set(this.bboxes,u),u+=this.bboxes.length,s.buffer};var Me=Ft(xe);let Ee={};function me(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),Ee[e]={klass:t,omit:n.omit||[]}}me(Object,"Object"),Me.serialize=function(t,e){let n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},Me.deserialize=function(t){return new Me(t.buffer)},Object.defineProperty(Me,"name",{value:"Grid"}),me(Me,"Grid"),me(hn,"Color"),me(Error,"Error"),me(Xr,"Formatted"),me(Yu,"FormattedSection"),me($u,"AJAXError"),me(gi,"ResolvedImage"),me(ce,"StylePropertyFunction"),me(K,"StyleExpression",{omit:["_evaluator"]}),me(te,"ZoomDependentExpression"),me(se,"ZoomConstantExpression"),me(ai,"CompoundExpression",{omit:["_evaluate"]});for(let t in Qa)Ee[Qa[t]._classRegistryKey]||me(Qa[t],`Expression${t}`);function je(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Fe(t){return self.ImageBitmap&&t instanceof ImageBitmap}function be(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(je(t)||Fe(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let n=[];for(let o of t)n.push(be(o,e));return n}if(t instanceof Map){let n={$name:"Map"};for(let[o,s]of t.entries())n[o]=be(s);return n}if(t instanceof Set){let n={$name:"Set"},o=0;for(let s of t.values())n[++o]=be(s);return n}if(typeof t=="object"){let n=t.constructor,o=n._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);let s=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(let u in t)t.hasOwnProperty(u)&&(Ee[o].omit.indexOf(u)>=0||(s[u]=be(t[u],e)));t instanceof Error&&(s.message=t.message)}if(s.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(s.$name=o),s}throw new Error("can't serialize object of type "+typeof t)}function Ae(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||je(t)||Fe(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Ae);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let s=new Map;for(let u of Object.keys(t))u!=="$name"&&s.set(u,Ae(t[u]));return s}if(e==="Set"){let s=new Set;for(let u of Object.keys(t))u!=="$name"&&s.add(Ae(t[u]));return s}let{klass:n}=Ee[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);let o=Object.create(n.prototype);for(let s of Object.keys(t))s!=="$name"&&(o[s]=Ae(t[s]));return o}throw new Error("can't deserialize object of type "+typeof t)}let fe={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Ne(t){for(let e of t)if(et(e.charCodeAt(0)))return!0;return!1}function Be(t){for(let e of t)if(!Ke(e.charCodeAt(0)))return!1;return!0}function Ke(t){return!(fe.Arabic(t)||fe["Arabic Supplement"](t)||fe["Arabic Extended-A"](t)||fe["Arabic Presentation Forms-A"](t)||fe["Arabic Presentation Forms-B"](t))}function et(t){return!(t!==746&&t!==747&&(t<4352||!(fe["Bopomofo Extended"](t)||fe.Bopomofo(t)||fe["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||fe["CJK Compatibility Ideographs"](t)||fe["CJK Compatibility"](t)||fe["CJK Radicals Supplement"](t)||fe["CJK Strokes"](t)||!(!fe["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||fe["CJK Unified Ideographs Extension A"](t)||fe["CJK Unified Ideographs"](t)||fe["Enclosed CJK Letters and Months"](t)||fe["Hangul Compatibility Jamo"](t)||fe["Hangul Jamo Extended-A"](t)||fe["Hangul Jamo Extended-B"](t)||fe["Hangul Jamo"](t)||fe["Hangul Syllables"](t)||fe.Hiragana(t)||fe["Ideographic Description Characters"](t)||fe.Kanbun(t)||fe["Kangxi Radicals"](t)||fe["Katakana Phonetic Extensions"](t)||fe.Katakana(t)&&t!==12540||!(!fe["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!fe["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||fe["Unified Canadian Aboriginal Syllabics"](t)||fe["Unified Canadian Aboriginal Syllabics Extended"](t)||fe["Vertical Forms"](t)||fe["Yijing Hexagram Symbols"](t)||fe["Yi Syllables"](t)||fe["Yi Radicals"](t))))}function at(t){return!(et(t)||function(e){return!!(fe["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||fe["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||fe["Letterlike Symbols"](e)||fe["Number Forms"](e)||fe["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||fe["Control Pictures"](e)&&e!==9251||fe["Optical Character Recognition"](e)||fe["Enclosed Alphanumerics"](e)||fe["Geometric Shapes"](e)||fe["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||fe["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||fe["CJK Symbols and Punctuation"](e)||fe.Katakana(e)||fe["Private Use Area"](e)||fe["CJK Compatibility Forms"](e)||fe["Small Form Variants"](e)||fe["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function nt(t){return t>=1424&&t<=2303||fe["Arabic Presentation Forms-A"](t)||fe["Arabic Presentation Forms-B"](t)}function mt(t,e){return!(!e&&nt(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||fe.Khmer(t))}function At(t){for(let e of t)if(nt(e.charCodeAt(0)))return!0;return!1}let _t="deferred",kt="loading",Ht="loaded",kn=null,In="unavailable",Wt=null,Tn=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(In="error"),kn&&kn(t)};function Bt(){Vt.fire(new co("pluginStateChange",{pluginStatus:In,pluginURL:Wt}))}let Vt=new $s,Pt=function(){return In},tn=function(){if(In!==_t||!Wt)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");In=kt,Bt(),Wt&&Bs({url:Wt},t=>{t?Tn(t):(In=Ht,Bt())})},Ut={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>In===Ht||Ut.applyArabicShaping!=null,isLoading:()=>In===kt,setState(t){In=t.pluginStatus,Wt=t.pluginURL},isParsed:()=>Ut.applyArabicShaping!=null&&Ut.processBidirectionalText!=null&&Ut.processStyledBidirectionalText!=null,getPluginURL:()=>Wt};class xt{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,o){for(let s of n)if(!mt(s.charCodeAt(0),o))return!1;return!0}(e,Ut.isLoaded())}}class ir{constructor(e,n,o,s){this.property=e,this.value=n,this.expression=function(u,h,m,y){if(P(u))return new ce(u,h);if(J(u)||Array.isArray(u)&&u.length>0){let x=ne(u,h,m,y);if(x.result==="error")throw new Error(x.value.map(T=>`${T.key}: ${T.message}`).join(", "));return x.value}{let x=u;return typeof u=="string"&&h.type==="color"&&(x=hn.parse(u)),{kind:"constant",configDependencies:new Set,evaluate:()=>x}}}(n===void 0?e.specification.default:n,e.specification,o,s)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class or{constructor(e,n,o){this.property=e,this.value=new ir(e,void 0,n,o)}transitioned(e,n){return new Br(this.property,this.value,n,Rr({},e.transition,this.transition),e.now)}untransitioned(){return new Br(this.property,this.value,null,{},0)}}class zr{constructor(e,n,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=o,this.configDependencies=new Set}getValue(e){return ni(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new or(this._values[e].property,this._scope,this._options)),this._values[e].value=new ir(this._values[e].property,n===null?void 0:ni(n),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,n){n&&(this._options=n);let o=this._properties.properties;if(e)for(let s in e){let u=e[s];if(Yl(s,"-transition")){let h=s.slice(0,-11);o[h]&&this.setTransition(h,u)}else o.hasOwnProperty(s)&&this.setValue(s,u)}}getTransition(e){return ni(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new or(this._values[e].property)),this._values[e].transition=ni(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let o=this.getValue(n);o!==void 0&&(e[n]=o);let s=this.getTransition(n);s!==void 0&&(e[`${n}-transition`]=s)}return e}transitioned(e,n){let o=new Ir(this._properties);for(let s of Object.keys(this._values))o._values[s]=this._values[s].transitioned(e,n._values[s]);return o}untransitioned(){let e=new Ir(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Br{constructor(e,n,o,s,u){let h=s.delay||0,m=s.duration||0;u=u||0,this.property=e,this.value=n,this.begin=u+h,this.end=this.begin+m,e.specification.transition&&(s.delay||s.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){let s=e.now||0,u=this.value.possiblyEvaluate(e,n,o),h=this.prior;if(h){if(s>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(s<this.begin)return h.possiblyEvaluate(e,n,o);{let m=(s-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,n,o),u,Ru(m))}}return u}}class Ir{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){let s=new Mr(this._properties);for(let u of Object.keys(this._values))s._values[u]=this._values[u].possiblyEvaluate(e,n,o);return s}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class jr{constructor(e,n,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=o,this.configDependencies=new Set}getValue(e){return ni(this._values[e].value)}setValue(e,n){this._values[e]=new ir(this._values[e].property,n===null?void 0:ni(n),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){let e={};for(let n of Object.keys(this._values)){let o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){let s=new Mr(this._properties);for(let u of Object.keys(this._values))s._values[u]=this._values[u].possiblyEvaluate(e,n,o);return s}}class yr{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,s){return this.property.evaluate(this.value,this.parameters,e,n,o,s)}}class Mr{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class He{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,o){let s=dc[this.specification.type];return s?s(e,n,o):e}}class ct{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,s){return new yr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,s)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new yr(this,{kind:"constant",value:void 0},e.parameters);let s=dc[this.specification.type];return s?new yr(this,{kind:"constant",value:s(e.value.value,n.value.value,o)},e.parameters):e}evaluate(e,n,o,s,u,h){return e.kind==="constant"?e.value:e.evaluate(n,o,s,u,h)}}class Yr{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,s){return!!e.expression.evaluate(n,null,{},o,s)}interpolate(){return!1}}class Rn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new xt(0,{});for(let o in e){let s=e[o];s.specification.overridable&&this.overridableProperties.push(o);let u=this.defaultPropertyValues[o]=new ir(s,void 0),h=this.defaultTransitionablePropertyValues[o]=new or(s);this.defaultTransitioningPropertyValues[o]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=u.possiblyEvaluate(n)}}}me(ct,"DataDrivenProperty"),me(He,"DataConstantProperty"),me(Yr,"ColorRampProperty");var Ie=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-line-alignment":{"type":"enum","values":{"inside":1,"outside":1,"center":1},"default":"center","property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Po(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Yi(t){if(Array.isArray(t))return t.map(Yi);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let n in t)e[n]=Yi(t[n]);return e}return Po(t)}function Ro(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!Ro(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Oo(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ro(t)||(t=Ka(t));let n=t,o=!0;try{o=function(x){if(!hs(x))return x;let T=Yi(x);return mh(T),T=ph(T),T}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let s=Ie[`filter_${e}`],u=Q(o,s),h=null;if(u.result==="error")throw new Error(u.value.map(x=>`${x.key}: ${x.message}`).join(", "));h=(x,T,I)=>u.value.evaluate(x,T,{},I);let m=null,y=null;if(o!==n){let x=Q(n,s);if(x.result==="error")throw new Error(x.value.map(T=>`${T.key}: ${T.message}`).join(", "));m=(T,I,M,S,R)=>x.value.evaluate(T,I,{},M,void 0,void 0,S,R),y=!Ec(x.value.expression)}return{filter:h,dynamicFilter:m||void 0,needGeometry:gh(o),needFeature:!!y}}function ph(t){if(!Array.isArray(t))return t;let e=function(n){if(Pf.has(n[0])){for(let o=1;o<n.length;o++)if(hs(n[o]))return!0}return n}(t);return e===!0?e:e.map(n=>ph(n))}function mh(t){let e=!1,n=[];if(t[0]==="case"){for(let o=1;o<t.length-1;o+=2)e=e||hs(t[o]),n.push(t[o+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||hs(t[1]);for(let o=2;o<t.length-1;o+=2)n.push(t[o+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||hs(t[1]);for(let o=1;o<t.length-1;o+=2)n.push(t[o+1])}e&&(t.length=0,t.push("any",...n));for(let o=1;o<t.length;o++)mh(t[o])}function hs(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(hs(t[n]))return!0;return!1}let Pf=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ys(t,e){return t<e?-1:t>e?1:0}function gh(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(gh(t[e]))return!0;return!1}function Ka(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?k0(t[1],t[2],"=="):e==="!="?dg(k0(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?k0(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(Ka))):e==="all"?["all"].concat(t.slice(1).map(Ka)):e==="none"?["all"].concat(t.slice(1).map(Ka).map(dg)):e==="in"?Vw(t[1],t.slice(2)):e==="!in"?dg(Vw(t[1],t.slice(2))):e==="has"?Uw(t[1]):e!=="!has"||dg(Uw(t[1]));var n}function k0(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Vw(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Ys)]]:["filter-in-small",t,["literal",e]]}}function Uw(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function dg(t){return["!",t]}let fg="";function $w(t,e){return e?`${t}${fg}${e}`:t}let Gw="-transition",UA=new Set(["fill","line","background","hillshade","raster"]);class Ti extends $s{constructor(e,n,o,s,u){if(super(),this.id=e.id,this.fqid=$w(this.id,o),this.type=e.type,this.scope=o,this.lut=s,this.options=u,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new jr(n.layout,this.scope,u),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),n.paint)){this._transitionablePaint=new zr(n.paint,this.scope,u);for(let h in e.paint)this.setPaintProperty(h,e.paint[h]);for(let h in e.layout)this.setLayoutProperty(h,e.layout[h]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Mr(n.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return UA.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,n),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Yl(e,Gw)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){let o=this._transitionablePaint,s=o._properties.properties;if(Yl(e,Gw)){let I=e.slice(0,-11);return s[I]&&o.setTransition(I,n||void 0),!1}if(!s[e])return!1;let u=o._values[e],h=u.value.isDataDriven(),m=u.value;o.setValue(e,n),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);let y=o._values[e].value,x=y.isDataDriven(),T=Yl(e,"pattern")||e==="line-dasharray";return x||h||T||this._handleOverridablePaintPropertyUpdate(e,m,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,o){return null}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return Or({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof yr&&w(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Oo(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,o,s,u,h,m,y,x){}queryIntersectsMatchingFeature(e,n,o,s){}}let $A={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Rf{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class $n{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function mn(t,e=1){let n=0,o=0;return{members:t.map(s=>{let u=$A[s.type].BYTES_PER_ELEMENT,h=n=Hw(n,Math.max(e,u)),m=s.components||1;return o=Math.max(o,u),n+=u*m,{name:s.name,type:s.type,components:m,offset:h}}),size:Hw(n,Math.max(o,e)),alignment:e}}function Hw(t,e){return Math.ceil(t/e)*e}class Lo extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){let s=2*e;return this.int16[s+0]=n,this.int16[s+1]=o,e}}Lo.prototype.bytesPerElement=4,me(Lo,"StructArrayLayout2i4");class pg extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){let s=this.length;return this.resize(s+1),this.emplace(s,e,n,o)}emplace(e,n,o,s){let u=3*e;return this.int16[u+0]=n,this.int16[u+1]=o,this.int16[u+2]=s,e}}pg.prototype.bytesPerElement=6,me(pg,"StructArrayLayout3i6");class Qs extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,s){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,s)}emplace(e,n,o,s,u){let h=4*e;return this.int16[h+0]=n,this.int16[h+1]=o,this.int16[h+2]=s,this.int16[h+3]=u,e}}Qs.prototype.bytesPerElement=8,me(Qs,"StructArrayLayout4i8");class F0 extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,o,s,u)}emplace(e,n,o,s,u,h){let m=5*e;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=s,this.int16[m+3]=u,this.int16[m+4]=h,e}}F0.prototype.bytesPerElement=10,me(F0,"StructArrayLayout5i10");class N0 extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,u,h,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,s,u,h,m)}emplace(e,n,o,s,u,h,m,y){let x=6*e,T=12*e,I=3*e;return this.int16[x+0]=n,this.int16[x+1]=o,this.uint8[T+4]=s,this.uint8[T+5]=u,this.uint8[T+6]=h,this.uint8[T+7]=m,this.float32[I+2]=y,e}}N0.prototype.bytesPerElement=12,me(N0,"StructArrayLayout2i4ub1f12");class Ja extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,s)}emplace(e,n,o,s,u){let h=4*e;return this.float32[h+0]=n,this.float32[h+1]=o,this.float32[h+2]=s,this.float32[h+3]=u,e}}Ja.prototype.bytesPerElement=16,me(Ja,"StructArrayLayout4f16");class el extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){let s=this.length;return this.resize(s+1),this.emplace(s,e,n,o)}emplace(e,n,o,s){let u=3*e;return this.float32[u+0]=n,this.float32[u+1]=o,this.float32[u+2]=s,e}}el.prototype.bytesPerElement=12,me(el,"StructArrayLayout3f12");class tl extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,o,s,u)}emplace(e,n,o,s,u,h){let m=6*e,y=3*e;return this.uint16[m+0]=n,this.uint16[m+1]=o,this.uint16[m+2]=s,this.uint16[m+3]=u,this.float32[y+2]=h,e}}tl.prototype.bytesPerElement=12,me(tl,"StructArrayLayout4ui1f12");class mg extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,s){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,s)}emplace(e,n,o,s,u){let h=4*e;return this.uint16[h+0]=n,this.uint16[h+1]=o,this.uint16[h+2]=s,this.uint16[h+3]=u,e}}mg.prototype.bytesPerElement=8,me(mg,"StructArrayLayout4ui8");class gg extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,s,u,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,o,s,u,h)}emplace(e,n,o,s,u,h,m){let y=6*e;return this.int16[y+0]=n,this.int16[y+1]=o,this.int16[y+2]=s,this.int16[y+3]=u,this.int16[y+4]=h,this.int16[y+5]=m,e}}gg.prototype.bytesPerElement=12,me(gg,"StructArrayLayout6i12");class z0 extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,s,u,h,m,y,x,T,I,M){let S=this.length;return this.resize(S+1),this.emplace(S,e,n,o,s,u,h,m,y,x,T,I,M)}emplace(e,n,o,s,u,h,m,y,x,T,I,M,S){let R=12*e;return this.int16[R+0]=n,this.int16[R+1]=o,this.int16[R+2]=s,this.int16[R+3]=u,this.uint16[R+4]=h,this.uint16[R+5]=m,this.uint16[R+6]=y,this.uint16[R+7]=x,this.int16[R+8]=T,this.int16[R+9]=I,this.int16[R+10]=M,this.int16[R+11]=S,e}}z0.prototype.bytesPerElement=24,me(z0,"StructArrayLayout4i4ui4i24");class B0 extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,u,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,o,s,u,h)}emplace(e,n,o,s,u,h,m){let y=10*e,x=5*e;return this.int16[y+0]=n,this.int16[y+1]=o,this.int16[y+2]=s,this.float32[x+2]=u,this.float32[x+3]=h,this.float32[x+4]=m,e}}B0.prototype.bytesPerElement=20,me(B0,"StructArrayLayout3i3f20");class j0 extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}j0.prototype.bytesPerElement=4,me(j0,"StructArrayLayout1ul4");class nl extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){let s=2*e;return this.uint16[s+0]=n,this.uint16[s+1]=o,e}}nl.prototype.bytesPerElement=4,me(nl,"StructArrayLayout2ui4");class V0 extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,s,u,h,m,y,x,T,I,M,S){let R=this.length;return this.resize(R+1),this.emplace(R,e,n,o,s,u,h,m,y,x,T,I,M,S)}emplace(e,n,o,s,u,h,m,y,x,T,I,M,S,R){let L=20*e,k=10*e;return this.int16[L+0]=n,this.int16[L+1]=o,this.int16[L+2]=s,this.int16[L+3]=u,this.int16[L+4]=h,this.float32[k+3]=m,this.float32[k+4]=y,this.float32[k+5]=x,this.float32[k+6]=T,this.int16[L+14]=I,this.uint32[k+8]=M,this.uint16[L+18]=S,this.uint16[L+19]=R,e}}V0.prototype.bytesPerElement=40,me(V0,"StructArrayLayout5i4f1i1ul2ui40");class _g extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,s,u,h,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,s,u,h,m)}emplace(e,n,o,s,u,h,m,y){let x=8*e;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=s,this.int16[x+4]=u,this.int16[x+5]=h,this.int16[x+6]=m,this.int16[x+7]=y,e}}_g.prototype.bytesPerElement=16,me(_g,"StructArrayLayout3i2i2i16");class U0 extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,o,s,u)}emplace(e,n,o,s,u,h){let m=4*e,y=8*e;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=s,this.int16[y+6]=u,this.int16[y+7]=h,e}}U0.prototype.bytesPerElement=16,me(U0,"StructArrayLayout2f1f2i16");class $0 extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,s)}emplace(e,n,o,s,u){let h=12*e,m=3*e;return this.uint8[h+0]=n,this.uint8[h+1]=o,this.float32[m+1]=s,this.float32[m+2]=u,e}}$0.prototype.bytesPerElement=12,me($0,"StructArrayLayout2ub2f12");class vr extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){let s=this.length;return this.resize(s+1),this.emplace(s,e,n,o)}emplace(e,n,o,s){let u=3*e;return this.uint16[u+0]=n,this.uint16[u+1]=o,this.uint16[u+2]=s,e}}vr.prototype.bytesPerElement=6,me(vr,"StructArrayLayout3ui6");class G0 extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,u,h,m,y,x,T,I,M,S,R,L,k,B,Z,W,X,re){let ie=this.length;return this.resize(ie+1),this.emplace(ie,e,n,o,s,u,h,m,y,x,T,I,M,S,R,L,k,B,Z,W,X,re)}emplace(e,n,o,s,u,h,m,y,x,T,I,M,S,R,L,k,B,Z,W,X,re,ie){let le=30*e,ge=15*e,we=60*e;return this.int16[le+0]=n,this.int16[le+1]=o,this.int16[le+2]=s,this.float32[ge+2]=u,this.float32[ge+3]=h,this.uint16[le+8]=m,this.uint16[le+9]=y,this.uint32[ge+5]=x,this.uint32[ge+6]=T,this.uint32[ge+7]=I,this.uint16[le+16]=M,this.uint16[le+17]=S,this.uint16[le+18]=R,this.float32[ge+10]=L,this.float32[ge+11]=k,this.uint8[we+48]=B,this.uint8[we+49]=Z,this.uint8[we+50]=W,this.uint32[ge+13]=X,this.int16[le+28]=re,this.uint8[we+58]=ie,e}}G0.prototype.bytesPerElement=60,me(G0,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class H0 extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,u,h,m,y,x,T,I,M,S,R,L,k,B,Z,W,X,re,ie,le,ge,we,Ce,Te,Oe,$e,Le,qe,Re){let ze=this.length;return this.resize(ze+1),this.emplace(ze,e,n,o,s,u,h,m,y,x,T,I,M,S,R,L,k,B,Z,W,X,re,ie,le,ge,we,Ce,Te,Oe,$e,Le,qe,Re)}emplace(e,n,o,s,u,h,m,y,x,T,I,M,S,R,L,k,B,Z,W,X,re,ie,le,ge,we,Ce,Te,Oe,$e,Le,qe,Re,ze){let Ze=20*e,ke=40*e,Qe=80*e;return this.float32[Ze+0]=n,this.float32[Ze+1]=o,this.int16[ke+4]=s,this.int16[ke+5]=u,this.int16[ke+6]=h,this.int16[ke+7]=m,this.int16[ke+8]=y,this.int16[ke+9]=x,this.int16[ke+10]=T,this.int16[ke+11]=I,this.int16[ke+12]=M,this.uint16[ke+13]=S,this.uint16[ke+14]=R,this.uint16[ke+15]=L,this.uint16[ke+16]=k,this.uint16[ke+17]=B,this.uint16[ke+18]=Z,this.uint16[ke+19]=W,this.uint16[ke+20]=X,this.uint16[ke+21]=re,this.uint16[ke+22]=ie,this.uint16[ke+23]=le,this.uint16[ke+24]=ge,this.uint16[ke+25]=we,this.uint16[ke+26]=Ce,this.uint16[ke+27]=Te,this.uint32[Ze+14]=Oe,this.float32[Ze+15]=$e,this.float32[Ze+16]=Le,this.float32[Ze+17]=qe,this.float32[Ze+18]=Re,this.uint8[Qe+76]=ze,e}}H0.prototype.bytesPerElement=80,me(H0,"StructArrayLayout2f9i15ui1ul4f1ub80");class _h extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}_h.prototype.bytesPerElement=4,me(_h,"StructArrayLayout1f4");class Lc extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,o,s,u)}emplace(e,n,o,s,u,h){let m=5*e;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=s,this.float32[m+3]=u,this.float32[m+4]=h,e}}Lc.prototype.bytesPerElement=20,me(Lc,"StructArrayLayout5f20");class q0 extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,u,h,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,s,u,h,m)}emplace(e,n,o,s,u,h,m,y){let x=7*e;return this.float32[x+0]=n,this.float32[x+1]=o,this.float32[x+2]=s,this.float32[x+3]=u,this.float32[x+4]=h,this.float32[x+5]=m,this.float32[x+6]=y,e}}q0.prototype.bytesPerElement=28,me(q0,"StructArrayLayout7f28");class W0 extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,s){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,s)}emplace(e,n,o,s,u){let h=6*e;return this.uint32[3*e+0]=n,this.uint16[h+2]=o,this.uint16[h+3]=s,this.uint16[h+4]=u,e}}W0.prototype.bytesPerElement=12,me(W0,"StructArrayLayout1ul3ui12");class Of extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Of.prototype.bytesPerElement=2,me(Of,"StructArrayLayout1ui2");class Lf extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){let s=2*e;return this.float32[s+0]=n,this.float32[s+1]=o,e}}Lf.prototype.bytesPerElement=8,me(Lf,"StructArrayLayout2f8");class Z0 extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,u,h,m,y,x,T,I,M,S,R,L,k){let B=this.length;return this.resize(B+1),this.emplace(B,e,n,o,s,u,h,m,y,x,T,I,M,S,R,L,k)}emplace(e,n,o,s,u,h,m,y,x,T,I,M,S,R,L,k,B){let Z=16*e;return this.float32[Z+0]=n,this.float32[Z+1]=o,this.float32[Z+2]=s,this.float32[Z+3]=u,this.float32[Z+4]=h,this.float32[Z+5]=m,this.float32[Z+6]=y,this.float32[Z+7]=x,this.float32[Z+8]=T,this.float32[Z+9]=I,this.float32[Z+10]=M,this.float32[Z+11]=S,this.float32[Z+12]=R,this.float32[Z+13]=L,this.float32[Z+14]=k,this.float32[Z+15]=B,e}}Z0.prototype.bytesPerElement=64,me(Z0,"StructArrayLayout16f64");class yg extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,u,h,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,s,u,h,m)}emplace(e,n,o,s,u,h,m,y){let x=10*e,T=5*e;return this.uint16[x+0]=n,this.uint16[x+1]=o,this.uint16[x+2]=s,this.uint16[x+3]=u,this.float32[T+2]=h,this.float32[T+3]=m,this.float32[T+4]=y,e}}yg.prototype.bytesPerElement=20,me(yg,"StructArrayLayout4ui3f20");class X0 extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}X0.prototype.bytesPerElement=2,me(X0,"StructArrayLayout1i2");class Y0 extends $n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}Y0.prototype.bytesPerElement=1,me(Y0,"StructArrayLayout1ub1");class qw extends Rf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}qw.prototype.size=40;class Q0 extends V0{get(e){return new qw(this,e)}}me(Q0,"CollisionBoxArray");class Ww extends Rf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Ww.prototype.size=60;class Zw extends G0{get(e){return new Ww(this,e)}}me(Zw,"PlacedSymbolArray");class Xw extends Rf{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Xw.prototype.size=80;class Yw extends H0{get(e){return new Xw(this,e)}}me(Yw,"SymbolInstanceArray");class Qw extends _h{getoffsetX(e){return this.float32[1*e+0]}}me(Qw,"GlyphOffsetArray");class Kw extends Lo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}me(Kw,"SymbolLineVertexArray");class Jw extends Rf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Jw.prototype.size=12;class eT extends W0{get(e){return new Jw(this,e)}}me(eT,"FeatureIndexArray");class tT extends nl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}me(tT,"FillExtrusionCentroidArray");class nT extends Rf{get a_join_normal_inside_polygon0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside_polygon1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside_polygon2(){return this._structArray.int16[this._pos2+2]}get a_join_normal_inside_polygon3(){return this._structArray.int16[this._pos2+3]}}nT.prototype.size=8;class rT extends Qs{get(e){return new nT(this,e)}}me(rT,"FillExtrusionWallArray");let GA=mn([{name:"a_pos",components:2,type:"Int16"}],4),HA=mn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Zn{constructor(e=[]){this.segments=e}_prepareSegment(e,n,o,s){let u=this.segments[this.segments.length-1];return e>Zn.MAX_VERTEX_ARRAY_LENGTH&&rr(`Max vertices per segment is ${Zn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>Zn.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==s)&&(u={vertexOffset:n,primitiveOffset:o,vertexLength:0,primitiveLength:0},s!==void 0&&(u.sortKey=s),this.segments.push(u)),u}prepareSegment(e,n,o,s){return this._prepareSegment(e,n.length,o.length,s)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,s){return new Zn([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:s,vaos:{},sortKey:0}])}}function iT(t,e){return 256*(t=jt(Math.floor(t),0,255))+jt(Math.floor(e),0,255)}Zn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,me(Zn,"SegmentVector");let qA=mn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),WA=mn([{name:"a_dash",components:4,type:"Uint16"}]);class kf{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,o,s){this.ids.push(oT(e)),this.positions.push(n,o,s)}eachPosition(e,n){let o=oT(e),s=0,u=this.ids.length-1;for(;s<u;){let h=s+u>>1;this.ids[h]>=o?u=h:s=h+1}for(;this.ids[s]===o;)n(this.positions[3*s],this.positions[3*s+1],this.positions[3*s+2]),s++}static serialize(e,n){let o=new Float64Array(e.ids),s=new Uint32Array(e.positions);return K0(o,s,0,o.length-1),n&&(n.add(o.buffer),n.add(s.buffer)),{ids:o,positions:s}}static deserialize(e){let n=new kf,o;n.ids=e.ids,n.positions=e.positions;for(let s of n.ids)s!==o&&n.uniqueIds.push(s),o=s;return n.indexed=!0,n}}function oT(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Gu(String(t))}function K0(t,e,n,o){for(;n<o;){let s=t[n+o>>1],u=n-1,h=o+1;for(;;){do u++;while(t[u]<s);do h--;while(t[h]>s);if(u>=h)break;vg(t,u,h),vg(e,3*u,3*h),vg(e,3*u+1,3*h+1),vg(e,3*u+2,3*h+2)}h-n<o-h?(K0(t,e,n,h),n=h+1):(K0(t,e,h+1,o),o=h)}}function vg(t,e,n){let o=t[e];t[e]=t[n],t[n]=o}me(kf,"FeaturePositionMap");class Ks{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class xg extends Ks{constructor(e){super(e),this.current=0}set(e,n,o){this.fetchUniformLocation(e,n)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class li extends Ks{constructor(e){super(e),this.current=0}set(e,n,o){this.fetchUniformLocation(e,n)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Js extends Ks{constructor(e){super(e),this.current=[0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class J0 extends Ks{constructor(e){super(e),this.current=[0,0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class ev extends Ks{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class sT extends Ks{constructor(e){super(e),this.current=hn.transparent.toRenderColor(null)}set(e,n,o){this.fetchUniformLocation(e,n)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}let ZA=new Float32Array(16);class Ff extends Ks{constructor(e){super(e),this.current=ZA}set(e,n,o){if(this.fetchUniformLocation(e,n)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let s=1;s<16;s++)if(o[s]!==this.current[s]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}let XA=new Float32Array(9),YA=new Float32Array(4);class tv extends Ks{constructor(e){super(e),this.current=YA}set(e,n,o){if(this.fetchUniformLocation(e,n)){for(let s=0;s<4;s++)if(o[s]!==this.current[s]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function nv(t){return[iT(255*t.r,255*t.g),iT(255*t.b,255*t.a)]}class Nf{constructor(e,n,o,s){this.value=e,this.uniformNames=n.map(u=>`u_${u}`),this.type=o,this.context=s}setUniform(e,n,o,s,u){let h=s.constantOr(this.value);n.set(e,u,h instanceof hn?h.toRenderColor(this.context.lut):h)}getBinding(e,n){return this.type==="color"?new sT(e):new li(e)}}class yh{constructor(e,n){this.uniformNames=n.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,o,s,u){let h=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;h&&n.set(e,u,h)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new ev(e):new li(e)}}class ea{constructor(e,n,o,s){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(u=>({name:`a_${u}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new s}populatePaintArray(e,n,o,s,u,h,m){let y=this.paintVertexArray.length,x=this.expression.evaluate(new xt(0,{brightness:h}),n,{},u,s,m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,x,this.context)}updatePaintArray(e,n,o,s,u,h,m){let y=this.expression.evaluate({zoom:0,brightness:m},o,s,void 0,u);this._setPaintValue(e,n,y,this.context)}_setPaintValue(e,n,o,s){if(this.type==="color"){let u=nv(o.toRenderColor(s.lut));for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,u[0],u[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ko{constructor(e,n,o,s,u,h){this.expression=e,this.uniformNames=n.map(m=>`u_${m}_t`),this.type=o,this.useIntegerZoom=s,this.context=u,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,n,o,s,u,h,m){let y=this.expression.evaluate(new xt(this.context.zoom,{brightness:h}),n,{},u,s,m),x=this.expression.evaluate(new xt(this.context.zoom+1,{brightness:h}),n,{},u,s,m),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,y,x,this.context)}updatePaintArray(e,n,o,s,u,h,m){let y=this.expression.evaluate({zoom:this.context.zoom,brightness:m},o,s,void 0,u),x=this.expression.evaluate({zoom:this.context.zoom+1,brightness:m},o,s,void 0,u);this._setPaintValue(e,n,y,x,this.context)}_setPaintValue(e,n,o,s,u){if(this.type==="color"){let h=nv(o.toRenderColor(u.lut)),m=nv(o.toRenderColor(u.lut));for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,h[0],h[1],m[0],m[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,o,s);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,o,s,u){let h=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,m=jt(this.expression.interpolationFactor(h,this.context.zoom,this.context.zoom+1),0,1);n.set(e,u,m)}getBinding(e,n){return new li(e)}}class rl{constructor(e,n,o,s,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(o==="array"?WA:qA).members;for(let h=0;h<n.length;++h);this.paintVertexArray=new s}populatePaintArray(e,n,o,s){let u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(e,n,o,s,u,h,m){this._setPaintValues(e,n,o.patterns&&o.patterns[this.layerId],h)}_setPaintValues(e,n,o,s){if(!s||!o)return;let u=s[o];if(!u)return;let{tl:h,br:m,pixelRatio:y}=u;for(let x=e;x<n;x++)this.paintVertexArray.emplace(x,h[0],h[1],m[0],m[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class kc{constructor(e,n,o=()=>!0){this.binders={},this._buffers=[],this.context=n;let s=[];for(let u in e.paint._values){let h=e.paint.get(u);if(!o(u)||!(h instanceof yr&&w(h.property.specification)))continue;let m=KA(u,e.type),y=h.value,x=h.property.specification.type,T=!!h.property.useIntegerZoom,I=u==="line-dasharray"||u.endsWith("pattern"),M=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||M)if(y.kind==="source"||M||I){let S=aT(u,x,"source");this.binders[u]=I?new rl(y,m,x,S,e.id):new ea(y,m,x,S),s.push(`/a_${u}`)}else{let S=aT(u,x,"composite");this.binders[u]=new ko(y,m,x,T,n,S),s.push(`/z_${u}`)}else this.binders[u]=I?new yh(y.value,m):new Nf(y.value,m,x,n),s.push(`/u_${u}`)}this.cacheKey=s.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof ea||n instanceof ko?n.maxValue:0}populatePaintArrays(e,n,o,s,u,h,m){for(let y in this.binders){let x=this.binders[y];x.context=this.context,(x instanceof ea||x instanceof ko||x instanceof rl)&&x.populatePaintArray(e,n,o,s,u,h,m)}}setConstantPatternPositions(e){for(let n in this.binders){let o=this.binders[n];o instanceof yh&&o.setConstantPatternPositions(e)}}updatePaintArrays(e,n,o,s,u,h,m,y){let x=!1,T=Object.keys(e),I=T.length!==0,M=I?T:n.uniqueIds;this.context.lut=u.lut;for(let S in this.binders){let R=this.binders[S];if(R.context=this.context,(R instanceof ea||R instanceof ko||R instanceof rl)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){let L=u.paint.get(S);R.expression=L.value;for(let k of M){let B=e[k.toString()];n.eachPosition(k,(Z,W,X)=>{let re=s.feature(Z);R.updatePaintArray(W,X,re,B,h,m,y)})}if(!I)for(let k of o.uniqueIds){let B=e[k.toString()];o.eachPosition(k,(Z,W,X)=>{let re=s.feature(Z);R.updatePaintArray(W,X,re,B,h,m,y)})}x=!0}}return x}defines(){let e=[];for(let n in this.binders){let o=this.binders[n];(o instanceof Nf||o instanceof yh)&&e.push(...o.uniformNames.map(s=>`#define HAS_UNIFORM_${s}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let o=this.binders[n];if(o instanceof ea||o instanceof ko||o instanceof rl)for(let s=0;s<o.paintVertexAttributes.length;s++)e.push(o.paintVertexAttributes[s].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let o=this.binders[n];if(o instanceof Nf||o instanceof yh||o instanceof ko)for(let s of o.uniformNames)e.push(s)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let o in this.binders){let s=this.binders[o];if(s instanceof Nf||s instanceof yh||s instanceof ko)for(let u of s.uniformNames)n.push({name:u,property:o,binding:s.getBinding(e,u)})}return n}setUniforms(e,n,o,s,u){for(let{name:h,property:m,binding:y}of o)this.binders[m].setUniform(e,y,u,s.get(m),h)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof ea||n instanceof ko||n instanceof rl)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let o=this.binders[n];(o instanceof ea||o instanceof ko||o instanceof rl)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof ea||n instanceof ko||n instanceof rl)&&n.destroy()}}}class il{constructor(e,n,o=()=>!0){this.programConfigurations={};for(let s of e)this.programConfigurations[s.id]=new kc(s,n,o);this.needsUpload=!1,this._featureMap=new kf,this._featureMapWithoutIds=new kf,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,o,s,u,h,m,y){for(let x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,n,s,u,h,m,y);n.id!==void 0?this._featureMap.add(n.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,s,u,h){for(let m of o)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,m,s,u,h||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let QA={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function KA(t,e){return QA[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let JA={"line-pattern":{source:tl,composite:tl},"fill-pattern":{source:tl,composite:tl},"fill-extrusion-pattern":{source:tl,composite:tl},"line-dasharray":{source:mg,composite:mg}},eP={color:{source:Lf,composite:Ja},number:{source:_h,composite:Lf}};function aT(t,e,n){let o=JA[t];return o&&o[n]||eP[e][n]}me(Nf,"ConstantBinder"),me(yh,"PatternConstantBinder"),me(ea,"SourceExpressionBinder"),me(rl,"PatternCompositeBinder"),me(ko,"CompositeExpressionBinder"),me(kc,"ProgramConfiguration",{omit:["_buffers"]}),me(il,"ProgramConfigurationSet");let ci=Xe/Math.PI/2,rv=5,lT=6,tP=16383,vh=64,iv=[vh,32,16],fo=-ci,po=ci;function xh(t,e,n,o=ci){return n=Gt(n),[t*Math.sin(n)*o,-e*o,t*Math.cos(n)*o]}function Fc(t,e,n){return xh(Math.cos(Gt(t)),Math.sin(Gt(t)),e,n)}let bh=63710088e-1,ov=2*Math.PI*bh;class cn{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new cn(La(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,o=this.lat*n,s=e.lat*n,u=Math.sin(o)*Math.sin(s)+Math.cos(o)*Math.cos(s)*Math.cos((e.lng-this.lng)*n);return bh*Math.acos(Math.min(u,1))}toBounds(e=0){let n=360*e/40075017,o=n/Math.cos(Math.PI/180*this.lat);return new ol({lng:this.lng-o,lat:this.lat-n},{lng:this.lng+o,lat:this.lat+n})}toEcef(e){return Fc(this.lat,this.lng,ci+e*ci/bh)}static convert(e){if(e instanceof cn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new cn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new cn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ol{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){let o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{let o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof cn?new cn(e.lng,e.lat):cn.convert(e),this}setSouthWest(e){return this._sw=e instanceof cn?new cn(e.lng,e.lat):cn.convert(e),this}extend(e){let n=this._sw,o=this._ne,s,u;if(e instanceof cn)s=e,u=e;else{if(!(e instanceof ol))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ol.convert(e)):this.extend(cn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(cn.convert(e)):this;if(s=e._sw,u=e._ne,!s||!u)return this}return n||o?(n.lng=Math.min(s.lng,n.lng),n.lat=Math.min(s.lat,n.lat),o.lng=Math.max(u.lng,o.lng),o.lat=Math.max(u.lat,o.lat)):(this._sw=new cn(s.lng,s.lat),this._ne=new cn(u.lng,u.lat)),this}getCenter(){return new cn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new cn(this.getWest(),this.getNorth())}getSouthEast(){return new cn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:o}=cn.convert(e),s=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(s=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&s}static convert(e){return!e||e instanceof ol?e:new ol(e)}}var cT={};(function(t,e){(function(n){function o(u,h,m){var y=s(256*u,256*(h=Math.pow(2,m)-h-1),m),x=s(256*(u+1),256*(h+1),m);return y[0]+","+y[1]+","+x[0]+","+x[1]}function s(u,h,m){var y=2*Math.PI*6378137/256/Math.pow(2,m);return[u*y-2*Math.PI*6378137/2,h*y-2*Math.PI*6378137/2]}n.getURL=function(u,h,m,y,x,T){return T=T||{},u+"?"+["bbox="+o(m,y,x),"format="+(T.format||"image/png"),"service="+(T.service||"WMS"),"version="+(T.version||"1.1.1"),"request="+(T.request||"GetMap"),"srs="+(T.srs||"EPSG:3857"),"width="+(T.width||256),"height="+(T.height||256),"layers="+h].join("&")},n.getTileBBox=o,n.getMercCoords=s,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,cT);var nP=cT;class Nc{constructor(e,n,o){this.z=e,this.x=n,this.y=o,this.key=wh(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let o=nP.getTileBBox(this.x,this.y,this.z),s=function(u,h,m){let y,x="";for(let T=u;T>0;T--)y=1<<T-1,x+=(h&y?1:0)+(m&y?2:0);return x}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",s).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class uT{constructor(e,n){this.wrap=e,this.canonical=n,this.key=wh(e,n.z,n.z,n.x,n.y)}}class fr{constructor(e,n,o,s,u){this.overscaledZ=e,this.wrap=n,this.canonical=new Nc(o,+s,+u),this.key=n===0&&e===o?this.canonical.key:wh(n,e,o,s,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new fr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fr(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return wh(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let o=this.canonical.z-e;return wh(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new fr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,o=2*this.canonical.x,s=2*this.canonical.y;return[new fr(n,this.wrap,n,o,s),new fr(n,this.wrap,n,o+1,s),new fr(n,this.wrap,n,o,s+1),new fr(n,this.wrap,n,o+1,s+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new fr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new fr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new uT(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function wh(t,e,n,o,s){let u=1<<Math.min(n,22),h=u*(s%u)+o%u;return t&&n<22&&(h+=u*u*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*h+n)+(e-n)}let rP=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new fr(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new fr(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new fr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new fr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];me(Nc,"CanonicalTileID"),me(fr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let iP=0,oP=25.5;function sv(t){return ov*Math.cos(t*Math.PI/180)}function ds(t){return(180+t)/360}function fs(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ui(t,e){return t/sv(e)}function Ei(t){return 360*t-180}function Dr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function hT(t,e){return t*sv(Dr(e))}let sr=85.051129;function dT(t){return Math.cos(Gt(jt(t,-sr,sr)))}function zc(t,e){let n=jt(e,iP,oP),o=Math.pow(2,n);return dT(t)*ov/(512*o)}function fT(t){return 1/Math.cos(t*Math.PI/180)}function bg(t,e=0){let n=Math.exp(Math.PI*(1-(t.y+e/Xe)/(1<<t.z)*2));return 80150034*n/(n*n+1)/Xe/(1<<t.z)}class Qr{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){let o=cn.convert(e);return new Qr(ds(o.lng),fs(o.lat),ui(n,o.lat))}toLngLat(){return new cn(Ei(this.x),Dr(this.y))}toAltitude(){return hT(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ov*fT(Dr(this.y))}}function av(t,e,n,o,s,u,h,m,y){let x=(e+o)/2,T=(n+s)/2,I=new Je(x,T);m(I),function(M,S,R,L,k,B){let Z=R-k,W=L-B;return Math.abs((L-S)*Z-(R-M)*W)/Math.hypot(Z,W)}(I.x,I.y,u.x,u.y,h.x,h.y)>=y?(av(t,e,n,x,T,u,I,m,y),av(t,x,T,o,s,I,h,m,y)):t.push(h)}function pT(t,e,n){let o=t[0],s=o.x,u=o.y;e(o);let h=[o];for(let m=1;m<t.length;m++){let y=t[m],{x,y:T}=y;e(y),av(h,s,u,x,T,o,y,e,n),s=x,u=T,o=y}return h}function lv(t,e,n,o){if(o(e,n)){let s=e.add(n)._mult(.5);lv(t,e,s,o),lv(t,s,n,o)}else t.push(n)}function sP(t,e){let n=t[0],o=[n];for(let s=1;s<t.length;s++){let u=t[s];lv(o,n,u,e),n=u}return o}let cv=Math.pow(2,14)-1,mT=-cv-1;function aP(t,e){let n=Math.round(t.x*e),o=Math.round(t.y*e);return t.x=jt(n,mT,cv),t.y=jt(o,mT,cv),(n<t.x||n>t.x+1||o<t.y||o>t.y+1)&&rr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Fo(t,e,n){let o=t.loadGeometry(),s=t.extent,u=Xe/s;if(e&&n&&n.projection.isReprojectedInTileSpace){let h=1<<e.z,{scale:m,x:y,y:x,projection:T}=n,I=M=>{let S=Ei((e.x+M.x/s)/h),R=Dr((e.y+M.y/s)/h),L=T.project(S,R);M.x=(L.x*m-y)*s,M.y=(L.y*m-x)*s};for(let M=0;M<o.length;M++)if(t.type!==1)o[M]=pT(o[M],I,1);else{let S=[];for(let R of o[M])R.x<0||R.x>=s||R.y<0||R.y>=s||(I(R),S.push(R));o[M]=S}}for(let h of o)for(let m of h)aP(m,u);return o}function ta(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Fo(t):[]}}function wg(t,e,n,o,s){t.emplaceBack(2*e+(o+1)/2,2*n+(s+1)/2)}function Tg(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class uv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Lo,this.indexArray=new vr,this.segments=new Zn,this.programConfigurations=new il(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(e,n){}populate(e,n,o,s){let u=this.layers[0],h=[],m=null;u.type==="circle"&&(m=u.layout.get("circle-sort-key"));for(let{feature:x,id:T,index:I,sourceLayerIndex:M}of e){let S=this.layers[0]._featureFilter.needGeometry,R=ta(x,S);if(!this.layers[0]._featureFilter.filter(new xt(this.zoom),R,o))continue;let L=m?m.evaluate(R,{},o):void 0,k={id:T,properties:x.properties,type:x.type,sourceLayerIndex:M,index:I,geometry:S?R.geometry:Fo(x,o,s),patterns:{},sortKey:L};h.push(k)}m&&h.sort((x,T)=>x.sortKey-T.sortKey);let y=null;s.projection.name==="globe"&&(this.globeExtVertexArray=new gg,y=s.projection);for(let x of h){let{geometry:T,index:I,sourceLayerIndex:M}=x,S=e[I].feature;this.addFeature(x,T,I,n.availableImages,o,y,n.brightness),n.featureIndex.insert(S,T,I,M,this.index)}}update(e,n,o,s,u){let h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,h?this.stateDependentLayers:this.layers,o,s,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,GA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,HA.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,o,s,u,h,m){for(let y of n)for(let x of y){let T=x.x,I=x.y;if(T<0||T>=Xe||I<0||I>=Xe)continue;if(h){let R=h.projectTilePoint(T,I,u),L=h.upVector(u,T,I),k=this.globeExtVertexArray;Tg(k,R,L),Tg(k,R,L),Tg(k,R,L),Tg(k,R,L)}let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),S=M.vertexLength;wg(this.layoutVertexArray,T,I,-1,-1),wg(this.layoutVertexArray,T,I,1,-1),wg(this.layoutVertexArray,T,I,1,1),wg(this.layoutVertexArray,T,I,-1,1),this.indexArray.emplaceBack(S,S+1,S+2),this.indexArray.emplaceBack(S,S+2,S+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},s,u,m)}}function hv(t,e){for(let n=0;n<t.length;n++)if(sl(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(sl(t,e[n]))return!0;return!!dv(t,e)}function lP(t,e,n){return!!sl(t,e)||!!fv(e,t,n)}function gT(t,e){if(t.length===1)return yT(e,t[0]);for(let n=0;n<e.length;n++){let o=e[n];for(let s=0;s<o.length;s++)if(sl(t,o[s]))return!0}for(let n=0;n<t.length;n++)if(yT(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(dv(t,e[n]))return!0;return!1}function cP(t,e,n){if(t.length>1){if(dv(t,e))return!0;for(let o=0;o<e.length;o++)if(fv(e[o],t,n))return!0}for(let o=0;o<t.length;o++)if(fv(t[o],e,n))return!0;return!1}function dv(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){let o=t[n],s=t[n+1];for(let u=0;u<e.length-1;u++)if(uP(o,s,e[u],e[u+1]))return!0}return!1}function uP(t,e,n,o){return ns(t,n,o)!==ns(e,n,o)&&ns(t,e,n)!==ns(t,e,o)}function fv(t,e,n){let o=n*n;if(e.length===1)return t.distSqr(e[0])<o;for(let s=1;s<e.length;s++)if(_T(t,e[s-1],e[s])<o)return!0;return!1}function _T(t,e,n){let o=e.distSqr(n);if(o===0)return t.distSqr(e);let s=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/o;return t.distSqr(s<0?e:s>1?n:n.sub(e)._mult(s)._add(e))}function yT(t,e){let n,o,s,u=!1;for(let h=0;h<t.length;h++){n=t[h];for(let m=0,y=n.length-1;m<n.length;y=m++)o=n[m],s=n[y],o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(u=!u)}return u}function sl(t,e){let n=!1;for(let o=0,s=t.length-1;o<t.length;s=o++){let u=t[o],h=t[s];u.y>e.y!=h.y>e.y&&e.x<(h.x-u.x)*(e.y-u.y)/(h.y-u.y)+u.x&&(n=!n)}return n}function vT(t,e,n,o,s){for(let h of t)if(e<=h.x&&n<=h.y&&o>=h.x&&s>=h.y)return!0;let u=[new Je(e,n),new Je(e,s),new Je(o,s),new Je(o,n)];if(t.length>2){for(let h of u)if(sl(t,h))return!0}for(let h=0;h<t.length-1;h++)if(hP(t[h],t[h+1],u))return!0;return!1}function hP(t,e,n){let o=n[0],s=n[2];if(t.x<o.x&&e.x<o.x||t.x>s.x&&e.x>s.x||t.y<o.y&&e.y<o.y||t.y>s.y&&e.y>s.y)return!1;let u=ns(t,e,n[0]);return u!==ns(t,e,n[1])||u!==ns(t,e,n[2])||u!==ns(t,e,n[3])}function Th(t,e,n,o,s,u){let h=e.y-t.y,m=t.x-e.x;if(u=u||0){let y=h*h+m*m;if(y===0)return!0;let x=Math.sqrt(y);h/=x,m/=x}return!((n.x-t.x)*h+(n.y-t.y)*m-u<0||(o.x-t.x)*h+(o.y-t.y)*m-u<0||(s.x-t.x)*h+(s.y-t.y)*m-u<0)}function pv(t,e,n,o,s,u,h){return!(Th(t,e,o,s,u,h)||Th(e,n,o,s,u,h)||Th(n,t,o,s,u,h)||Th(o,s,t,e,n,h)||Th(s,u,t,e,n,h)||Th(u,o,t,e,n,h))}function Eh(t,e,n){let o=e.paint.get(t).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Eg(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function xT(t,e,n,o,s){if(!e[0]&&!e[1])return t;let u=Je.convert(e)._mult(s);n==="viewport"&&u._rotate(-o);let h=[];for(let m=0;m<t.length;m++)h.push(t[m].sub(u));return h}function bT(t,e,n,o){let s=Je.convert(t)._mult(o);return e==="viewport"&&s._rotate(-n),s}let wT,TT;me(uv,"CircleBucket",{omit:["layers"]});class mv{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,o){let s=r.$.dot(n,this.dir);if(Math.abs(s)<1e-6)return!1;let u=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/s;return o[0]=this.pos[0]+this.dir[0]*u,o[1]=this.pos[1]+this.dir[1]*u,o[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,n,o){if(r.$.equals(this.pos,e)||n===0)return o[0]=o[1]=o[2]=0,!1;let[s,u,h]=this.dir,m=this.pos[0]-e[0],y=this.pos[1]-e[1],x=this.pos[2]-e[2],T=s*s+u*u+h*h,I=2*(m*s+y*u+x*h),M=I*I-4*T*(m*m+y*y+x*x-n*n);if(M<0){let S=Math.max(-I/2,0),R=m+s*S,L=y+u*S,k=x+h*S,B=Math.hypot(R,L,k);return o[0]=R*n/B,o[1]=L*n/B,o[2]=k*n/B,!1}{let S=(-I-Math.sqrt(M))/(2*T);if(S<0){let R=Math.hypot(m,y,x);return o[0]=m*n/R,o[1]=y*n/R,o[2]=x*n/R,!1}return o[0]=m+s*S,o[1]=y+u*S,o[2]=x+h*S,!0}}}class gv{constructor(e,n,o,s,u){this.TL=e,this.TR=n,this.BR=o,this.BL=s,this.horizon=u}static fromInvProjectionMatrix(e,n,o){let s=[-1,1,1],u=[1,1,1],h=[1,-1,1],m=[-1,-1,1],y=r.$.transformMat4(s,s,e),x=r.$.transformMat4(u,u,e),T=r.$.transformMat4(h,h,e),I=r.$.transformMat4(m,m,e);return new gv(y,x,T,I,n/o)}}function zf(t,e,n){let o=1/0,s=-1/0,u=[];for(let h of t){r.$.sub(u,h,e);let m=r.$.dot(u,n);o=Math.min(o,m),s=Math.max(s,m)}return[o,s]}function ET(t,e){let n=!0;for(let o=0;o<t.planes.length;o++){let s=t.planes[o],u=0;for(let h=0;h<e.length;h++)u+=r.$.dot(s,e[h])+s[3]>=0;if(u===0)return 0;u!==e.length&&(n=!1)}return n?2:1}function IT(t,e){for(let n of t.projections){let o=zf(e,t.points[0],n.axis);if(n.projection[1]<o[0]||n.projection[0]>o[1])return 0}return 1}function MT(t,e){let n=0,o=[0,0,0,0];for(let s=0;s<t.length;s++)o[0]=t[s][0],o[1]=t[s][1],o[2]=t[s][2],o[3]=1,r.aB.dot(o,e)>=0&&n++;return n}class _v{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=Gn.fromPoints(this.points),this.projections=[],this.frustumEdges=[r.$.sub([],this.points[2],this.points[3]),r.$.sub([],this.points[0],this.points[3]),r.$.sub([],this.points[4],this.points[0]),r.$.sub([],this.points[5],this.points[1]),r.$.sub([],this.points[6],this.points[2]),r.$.sub([],this.points[7],this.points[3])];for(let o of this.frustumEdges){let s=[0,-o[2],o[1]],u=[o[2],0,-o[0]];this.projections.push({axis:s,projection:zf(this.points,this.points[0],s)}),this.projections.push({axis:u,projection:zf(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,n,o,s){let u=Math.pow(2,o),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{let T=r.aB.transformMat4([],x,e),I=1/T[3]/n*u;return r.aB.mul(T,T,[I,I,s?1/T[3]:I,I])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{let T=r.$.sub([],h[x[0]],h[x[1]]),I=r.$.sub([],h[x[2]],h[x[1]]),M=r.$.normalize([],r.$.cross([],T,I)),S=-r.$.dot(M,h[x[1]]);return M.concat(S)}),y=[];for(let x=0;x<h.length;x++)y.push([h[x][0],h[x][1],h[x][2]]);return new _v(y,m)}intersectsPrecise(e,n,o){for(let s=0;s<n.length;s++)if(!MT(e,n[s]))return 0;for(let s=0;s<this.planes.length;s++)if(!MT(e,this.planes[s]))return 0;for(let s of o)for(let u of this.frustumEdges){let h=r.$.cross([],s,u),m=r.$.length(h);if(m===0)continue;r.$.scale(h,h,1/m);let y=zf(this.points,this.points[0],h),x=zf(e,this.points[0],h);if(y[0]>x[1]||x[0]>y[1])return 0}return 1}containsPoint(e){for(let n of this.planes){let o=n[3];if(r.$.dot([n[0],n[1],n[2]],e)+o<0)return!1}return!0}}class Gn{static fromPoints(e){let n=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(let s of e)r.$.min(n,n,s),r.$.max(o,o,s);return new Gn(n,o)}static fromTileIdAndHeight(e,n,o){let s=1<<e.canonical.z,u=e.canonical.x,h=e.canonical.y;return new Gn([u/s,h/s,n],[(u+1)/s,(h+1)/s,o])}static applyTransform(e,n){let o=e.getCorners();for(let s=0;s<o.length;++s)r.$.transformMat4(o[s],o[s],n);return Gn.fromPoints(o)}static applyTransformFast(e,n){let o=[n[12],n[13],n[14]],s=[...o];for(let u=0;u<3;u++)for(let h=0;h<3;h++){let m=n[4*h+u],y=m*e.min[h],x=m*e.max[h];o[u]+=Math.min(y,x),s[u]+=Math.max(y,x)}return new Gn(o,s)}static projectAabbCorners(e,n){let o=e.getCorners();for(let s=0;s<o.length;++s)r.$.transformMat4(o[s],o[s],n);return o}constructor(e,n){this.min=e,this.max=n,this.center=r.$.scale([],r.$.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],o=r.$.clone(this.min),s=r.$.clone(this.max);for(let u=0;u<n.length;u++)o[u]=n[u]?this.min[u]:this.center[u],s[u]=n[u]?this.center[u]:this.max[u];return s[2]=this.max[2],new Gn(o,s)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?ET(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?ET(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?IT(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?IT(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}me(Gn,"Aabb");let dP=mn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ig}=dP,DT=mn([{name:"a_pos_3",components:3,type:"Int16"}]);var Bf=mn([{name:"a_pos",type:"Int16",components:2}]);function Mg(t){return t*ci/bh}let fP=[new Gn([fo,fo,fo],[po,po,po]),new Gn([fo,fo,fo],[0,0,po]),new Gn([0,fo,fo],[po,0,po]),new Gn([fo,0,fo],[0,po,po]),new Gn([0,0,fo],[po,po,po])];function CT(t,e,n,o=!0){let s=r.$.scale([],t._camera.position,t.worldSize),u=[e,n,1,1];r.aB.transformMat4(u,u,t.pixelMatrixInverse),r.aB.scale(u,u,1/u[3]);let h=r.$.sub([],u,s),m=r.$.normalize([],h),y=t.globeMatrix,x=[y[12],y[13],y[14]],T=r.$.sub([],x,s),I=r.$.length(T),M=r.$.normalize([],T),S=t.worldSize/(2*Math.PI),R=r.$.dot(M,m),L=Math.asin(S/I);if(L<Math.acos(R)){if(!o)return null;let Te=[],Oe=[];r.$.scale(Te,m,I/R),r.$.normalize(Oe,r.$.sub(Oe,Te,T)),r.$.normalize(m,r.$.add(m,T,r.$.scale(m,Oe,Math.tan(L)*I)))}let k=[];new mv(s,m).closestPointOnSphere(x,S,k);let B=r.$.normalize([],os(y,0)),Z=r.$.normalize([],os(y,1)),W=r.$.normalize([],os(y,2)),X=r.$.dot(B,k),re=r.$.dot(Z,k),ie=r.$.dot(W,k),le=ti(Math.asin(-re/S)),ge=ti(Math.atan2(X,ie));ge=t.center.lng+function(Te,Oe){let $e=(Oe-Te+180)%360-180;return $e<-180?$e+360:$e}(t.center.lng,ge);let we=ds(ge),Ce=jt(fs(le),0,1);return new Qr(we,Ce)}class pP{constructor(e,n,o){this.a=r.$.sub([],e,o),this.b=r.$.sub([],n,o),this.center=o;let s=r.$.normalize([],this.a),u=r.$.normalize([],this.b);this.angle=Math.acos(r.$.dot(s,u))}}function yv(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(o,s,u,h){let m=Math.sin(u);return o*(Math.sin((1-h)*u)/m)+s*(Math.sin(h*u)/m)}(t.a[e],t.b[e],t.angle,jt(n,0,1))+t.center[e]}function ps(t){if(t.z<=1)return fP[t.z+2*t.y+t.x];let e=vv(Dg(t));return Gn.fromPoints(e)}function na(t,e,n){return r.$.scale(t,t,1-n),r.$.scaleAndAdd(t,t,e,n)}function ST(t,e){let n=ra(e.zoom);if(n===0)return ps(t);let o=Dg(t),s=vv(o),u=ds(o.getWest())*e.worldSize,h=ds(o.getEast())*e.worldSize,m=fs(o.getNorth())*e.worldSize,y=fs(o.getSouth())*e.worldSize,x=[u,m,0],T=[h,m,0],I=[u,y,0],M=[h,y,0],S=r.ae.invert([],e.globeMatrix);return r.$.transformMat4(x,x,S),r.$.transformMat4(T,T,S),r.$.transformMat4(I,I,S),r.$.transformMat4(M,M,S),s[0]=na(s[0],I,n),s[1]=na(s[1],M,n),s[2]=na(s[2],T,n),s[3]=na(s[3],x,n),Gn.fromPoints(s)}function AT(t,e,n){for(let o of t)r.$.transformMat4(o,o,e),r.$.scale(o,o,n)}function PT(t,e,n,o){let s=e/t.worldSize,u=t.globeMatrix;if(n.z<=1){let we=ps(n).getCorners();return AT(we,u,s),Gn.fromPoints(we)}let h=Dg(n,o),m=vv(h,ci+Mg(t._tileCoverLift));AT(m,u,s);let y=Number.MAX_VALUE,x=[-y,-y,-y],T=[y,y,y];if(h.contains(t.center)){for(let Te of m)r.$.min(T,T,Te),r.$.max(x,x,Te);x[2]=0;let we=t.point,Ce=[we.x*s,we.y*s,0];return r.$.min(T,T,Ce),r.$.max(x,x,Ce),new Gn(T,x)}if(t._tileCoverLift>0){for(let we of m)r.$.min(T,T,we),r.$.max(x,x,we);return new Gn(T,x)}let I=[u[12]*s,u[13]*s,u[14]*s],M=h.getCenter(),S=jt(t.center.lat,-sr,sr),R=jt(M.lat,-sr,sr),L=ds(t.center.lng),k=fs(S),B=L-ds(M.lng),Z=k-fs(R);B>.5?B-=1:B<-.5&&(B+=1);let W=0;if(Math.abs(B)>Math.abs(Z))W=B>=0?1:3;else{W=Z>=0?0:2;let we=[u[4]*s,u[5]*s,u[6]*s],Ce=-Math.sin(Gt(Z>=0?h.getSouth():h.getNorth()))*ci;r.$.scaleAndAdd(I,I,we,Ce)}let X=m[W],re=m[(W+1)%4],ie=new pP(X,re,I),le=[yv(ie,0)||X[0],yv(ie,1)||X[1],yv(ie,2)||X[2]],ge=ra(t.zoom);if(ge>0){let we=function({x:Te,y:Oe,z:$e},Le,qe,Re,ze){let Ze=1/(1<<$e),ke=Te*Ze,Qe=ke+Ze,We=Oe*Ze,Ge=We+Ze,ft=0,ht=(ke+Qe)/2-Re;return ht>.5?ft=-1:ht<-.5&&(ft=1),ke=((ke+ft)*Le-(Re*=Le))*qe+Re,Qe=((Qe+ft)*Le-Re)*qe+Re,We=(We*Le-(ze*=Le))*qe+ze,Ge=(Ge*Le-ze)*qe+ze,[[ke,Ge,0],[Qe,Ge,0],[Qe,We,0],[ke,We,0]]}(n,e,t._pixelsPerMercatorPixel,L,k);for(let Te=0;Te<m.length;Te++)na(m[Te],we[Te],ge);let Ce=r.$.add([],we[W],we[(W+1)%4]);r.$.scale(Ce,Ce,.5),na(le,Ce,ge)}for(let we of m)r.$.min(T,T,we),r.$.max(x,x,we);return T[2]=Math.min(X[2],re[2]),r.$.min(T,T,le),r.$.max(x,x,le),new Gn(T,x)}function Dg({x:t,y:e,z:n},o=!1){let s=1/(1<<n),u=new cn(Ei(t*s),e===(1<<n)-1&&o?-90:Dr((e+1)*s)),h=new cn(Ei((t+1)*s),e===0&&o?90:Dr(e*s));return new ol(u,h)}function vv(t,e=ci){let n=Gt(t.getNorth()),o=Gt(t.getSouth()),s=Math.cos(n),u=Math.cos(o),h=Math.sin(n),m=Math.sin(o),y=t.getWest(),x=t.getEast();return[xh(u,m,y,e),xh(u,m,x,e),xh(s,h,x,e),xh(s,h,y,e)]}function jf(t,e,n,o){let s=1<<n.z,u=(t/Xe+n.x)/s;return Fc(Dr((e/Xe+n.y)/s),Ei(u),o)}function Cg({min:t,max:e}){return tP/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let RT=new Float64Array(16);function Vf(t){let e=Cg(t),n=r.ae.fromScaling(RT,[e,e,e]);return r.ae.translate(n,n,r.$.negate([],t.min))}function xv(t){let e=r.ae.fromTranslation(RT,t.min),n=1/Cg(t);return r.ae.scale(e,e,[n,n,n])}function bv(t){let e=Xe/(2*Math.PI);return t/(2*Math.PI)/e}function OT(t,e){return Xe/(512*Math.pow(2,t))*Cg(ps(e))}function LT(t,e,n,o,s){let u=bv(n),h=[t,e,-n/(2*Math.PI)],m=r.ae.identity(new Float64Array(16));return r.ae.translate(m,m,h),r.ae.scale(m,m,[u,u,u]),r.ae.rotateX(m,m,Gt(-s)),r.ae.rotateY(m,m,Gt(-o)),m}function ra(t){return Hd(rv,lT,t)}function kT(t,e){let n=Fc(e.lat,e.lng),o=function(u){let h=Fc(u._center.lat,u._center.lng),m=r.$.fromValues(0,1,0),y=r.$.cross([],m,h),x=r.ae.fromRotation([],-u.angle,h);y=r.$.transformMat4(y,y,x),r.ae.fromRotation(x,-u._pitch,y);let T=r.$.normalize([],h);return r.$.scale(T,T,Mg(u.cameraToCenterDistance/u.pixelsPerMeter)),r.$.transformMat4(T,T,x),r.$.add([],h,T)}(t),s=r.$.subtract([],o,n);return r.$.angle(s,n)}function wv(t,e){return kT(t,e)>Math.PI/2*1.01}let FT=Gt(85),mP=Math.cos(FT),gP=Math.sin(FT),_P=r.ae.create(),NT=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function zT(t,e,n,o,s,u,h,m,y){if(u&&t.queryGeometry.isAboveHorizon)return!1;u&&(y*=t.pixelToTileUnitsFactor);let x=t.tileID.canonical,T=n.projection.upVectorScale(x,n.center.lat,n.worldSize).metersToTile;for(let I of e)for(let M of I){let S=M.add(m),R=s&&n.elevation?n.elevation.exaggeration()*s.getElevationAt(S.x,S.y,!0):0,L=n.projection.projectTilePoint(S.x,S.y,x);if(R>0){let W=n.projection.upVector(x,S.x,S.y);L.x+=W[0]*T*R,L.y+=W[1]*T*R,L.z+=W[2]*T*R}let k=u?S:yP(L.x,L.y,L.z,o),B=u?t.tilespaceRays.map(W=>xP(W,R)):t.queryGeometry.screenGeometry,Z=r.aB.transformMat4([],[L.x,L.y,L.z,1],o);if(!h&&u?y*=Z[3]/n.cameraToCenterDistance:h&&!u&&(y*=n.cameraToCenterDistance/Z[3]),u){let W=Dr((M.y/Xe+x.y)/(1<<x.z));y/=n.projection.pixelsPerMeter(W,1)/ui(1,W)}if(lP(B,k,y))return!0}return!1}function yP(t,e,n,o){let s=r.aB.transformMat4([],[t,e,n,1],o);return new Je(s[0]/s[3],s[1]/s[3])}let BT=r.$.fromValues(0,0,0),vP=r.$.fromValues(0,0,1);function xP(t,e){let n=r.$.create();return BT[2]=e,t.intersectsPlane(BT,vP,n),new Je(n[0],n[1])}class jT extends uv{}function VT(t,{width:e,height:n},o,s){if(s){if(s instanceof Uint8ClampedArray)s=new Uint8Array(s.buffer);else if(s.length!==e*n*o)throw new RangeError("mismatched image size")}else s=new Uint8Array(e*n*o);return t.width=e,t.height=n,t.data=s,t}function UT(t,e,n){let{width:o,height:s}=e;o===t.width&&s===t.height||(Tv(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,o),height:Math.min(t.height,s)},n,null),t.width=o,t.height=s,t.data=e.data)}function Tv(t,e,n,o,s,u,h,m){if(s.width===0||s.height===0)return e;if(s.width>t.width||s.height>t.height||n.x>t.width-s.width||n.y>t.height-s.height)throw new RangeError("out of range source coordinates for image copy");if(s.width>e.width||s.height>e.height||o.x>e.width-s.width||o.y>e.height-s.height)throw new RangeError("out of range destination coordinates for image copy");let y=t.data,x=e.data,T=u===4&&m;for(let I=0;I<s.height;I++){let M=((n.y+I)*t.width+n.x)*u,S=((o.y+I)*e.width+o.x)*u;if(T)for(let R=0;R<s.width;R++){let L=M+R*u+3,k=S+R*u;x[k+0]=255,x[k+1]=255,x[k+2]=255,x[k+3]=y[L]}else if(h)for(let R=0;R<s.width;R++){let L=M+R*u,k=S+R*u,B=y[L+3],Z=new hn(y[L+0]/255*B,y[L+1]/255*B,y[L+2]/255*B,B).toRenderColor(h).toArray();x[k+0]=Z[0],x[k+1]=Z[1],x[k+2]=Z[2],x[k+3]=Z[3]}else for(let R=0;R<s.width*u;R++)x[S+R]=y[M+R]}return e}me(jT,"HeatmapBucket",{omit:["layers"]});class al{constructor(e,n){VT(this,e,1,n)}resize(e){UT(this,new al(e),1)}clone(){return new al({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,s,u){Tv(e,n,o,s,u,1,null)}}class Qi{constructor(e,n){VT(this,e,4,n)}resize(e){UT(this,new Qi(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Qi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,s,u,h,m){Tv(e,n,o,s,u,4,h,m)}}class $T{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}let GT,HT,qT,WT;function Uf(t){let e={},n=t.resolution||256,o=t.clips?t.clips.length:1,s=t.image||new Qi({width:n,height:o}),u=(h,m,y)=>{e[t.evaluationKey]=y;let x=t.expression.evaluate(e);x&&(s.data[h+m+0]=Math.floor(255*x.r/x.a),s.data[h+m+1]=Math.floor(255*x.g/x.a),s.data[h+m+2]=Math.floor(255*x.b/x.a),s.data[h+m+3]=Math.floor(255*x.a))};if(t.clips)for(let h=0,m=0;h<o;++h,m+=4*n)for(let y=0,x=0;y<n;y++,x+=4){let T=y/(n-1),{start:I,end:M}=t.clips[h];u(m,x,I*(1-T)+M*T)}else for(let h=0,m=0;h<n;h++,m+=4)u(0,m,h/(n-1));return s}me(al,"AlphaImage"),me(Qi,"RGBAImage");let bP=mn([{name:"a_pos",components:2,type:"Int16"}],4),{members:wP}=bP;function $f(t,e,n=2){let o=e&&e.length,s=o?e[0]*n:t.length,u=ZT(t,0,s,n,!0),h=[];if(!u||u.next===u.prev)return h;let m,y,x;if(o&&(u=function(T,I,M,S){let R=[];for(let L=0,k=I.length;L<k;L++){let B=ZT(T,I[L]*S,L<k-1?I[L+1]*S:T.length,S,!1);B===B.next&&(B.steiner=!0),R.push(AP(B))}R.sort(DP);for(let L=0;L<R.length;L++)M=CP(R[L],M);return M}(t,e,u,n)),t.length>80*n){m=1/0,y=1/0;let T=-1/0,I=-1/0;for(let M=n;M<s;M+=n){let S=t[M],R=t[M+1];S<m&&(m=S),R<y&&(y=R),S>T&&(T=S),R>I&&(I=R)}x=Math.max(T-m,I-y),x=x!==0?32767/x:0}return Gf(u,h,n,m,y,x,0),h}function ZT(t,e,n,o,s){let u;if(s===function(h,m,y,x){let T=0;for(let I=m,M=y-x;I<y;I+=x)T+=(h[M]-h[I])*(h[I+1]+h[M+1]),M=I;return T}(t,e,n,o)>0)for(let h=e;h<n;h+=o)u=QT(h/o|0,t[h],t[h+1],u);else for(let h=n-o;h>=e;h-=o)u=QT(h/o|0,t[h],t[h+1],u);return u&&Sg(u,u.next)&&(qf(u),u=u.next),u}function Bc(t,e){if(!t)return t;e||(e=t);let n,o=t;do if(n=!1,o.steiner||!Sg(o,o.next)&&pr(o.prev,o,o.next)!==0)o=o.next;else{if(qf(o),o=e=o.prev,o===o.next)break;n=!0}while(n||o!==e);return e}function Gf(t,e,n,o,s,u,h){if(!t)return;!h&&u&&function(y,x,T,I){let M=y;do M.z===0&&(M.z=Ev(M.x,M.y,x,T,I)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==y);M.prevZ.nextZ=null,M.prevZ=null,function(S){let R,L=1;do{let k,B=S;S=null;let Z=null;for(R=0;B;){R++;let W=B,X=0;for(let ie=0;ie<L&&(X++,W=W.nextZ,W);ie++);let re=L;for(;X>0||re>0&&W;)X!==0&&(re===0||!W||B.z<=W.z)?(k=B,B=B.nextZ,X--):(k=W,W=W.nextZ,re--),Z?Z.nextZ=k:S=k,k.prevZ=Z,Z=k;B=W}Z.nextZ=null,L*=2}while(R>1)}(M)}(t,o,s,u);let m=t;for(;t.prev!==t.next;){let y=t.prev,x=t.next;if(u?EP(t,o,s,u):TP(t))e.push(y.i,t.i,x.i),qf(t),t=x.next,m=x.next;else if((t=x)===m){h?h===1?Gf(t=IP(Bc(t),e),e,n,o,s,u,2):h===2&&MP(t,e,n,o,s,u):Gf(Bc(t),e,n,o,s,u,1);break}}}function TP(t){let e=t.prev,n=t,o=t.next;if(pr(e,n,o)>=0)return!1;let s=e.x,u=n.x,h=o.x,m=e.y,y=n.y,x=o.y,T=s<u?s<h?s:h:u<h?u:h,I=m<y?m<x?m:x:y<x?y:x,M=s>u?s>h?s:h:u>h?u:h,S=m>y?m>x?m:x:y>x?y:x,R=o.next;for(;R!==e;){if(R.x>=T&&R.x<=M&&R.y>=I&&R.y<=S&&Ih(s,m,u,y,h,x,R.x,R.y)&&pr(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function EP(t,e,n,o){let s=t.prev,u=t,h=t.next;if(pr(s,u,h)>=0)return!1;let m=s.x,y=u.x,x=h.x,T=s.y,I=u.y,M=h.y,S=m<y?m<x?m:x:y<x?y:x,R=T<I?T<M?T:M:I<M?I:M,L=m>y?m>x?m:x:y>x?y:x,k=T>I?T>M?T:M:I>M?I:M,B=Ev(S,R,e,n,o),Z=Ev(L,k,e,n,o),W=t.prevZ,X=t.nextZ;for(;W&&W.z>=B&&X&&X.z<=Z;){if(W.x>=S&&W.x<=L&&W.y>=R&&W.y<=k&&W!==s&&W!==h&&Ih(m,T,y,I,x,M,W.x,W.y)&&pr(W.prev,W,W.next)>=0||(W=W.prevZ,X.x>=S&&X.x<=L&&X.y>=R&&X.y<=k&&X!==s&&X!==h&&Ih(m,T,y,I,x,M,X.x,X.y)&&pr(X.prev,X,X.next)>=0))return!1;X=X.nextZ}for(;W&&W.z>=B;){if(W.x>=S&&W.x<=L&&W.y>=R&&W.y<=k&&W!==s&&W!==h&&Ih(m,T,y,I,x,M,W.x,W.y)&&pr(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;X&&X.z<=Z;){if(X.x>=S&&X.x<=L&&X.y>=R&&X.y<=k&&X!==s&&X!==h&&Ih(m,T,y,I,x,M,X.x,X.y)&&pr(X.prev,X,X.next)>=0)return!1;X=X.nextZ}return!0}function IP(t,e){let n=t;do{let o=n.prev,s=n.next.next;!Sg(o,s)&&XT(o,n,n.next,s)&&Hf(o,s)&&Hf(s,o)&&(e.push(o.i,n.i,s.i),qf(n),qf(n.next),n=t=s),n=n.next}while(n!==t);return Bc(n)}function MP(t,e,n,o,s,u){let h=t;do{let m=h.next.next;for(;m!==h.prev;){if(h.i!==m.i&&PP(h,m)){let y=YT(h,m);return h=Bc(h,h.next),y=Bc(y,y.next),Gf(h,e,n,o,s,u,0),void Gf(y,e,n,o,s,u,0)}m=m.next}h=h.next}while(h!==t)}function DP(t,e){return t.x-e.x}function CP(t,e){let n=function(s,u){let h=u,m=s.x,y=s.y,x,T=-1/0;do{if(y<=h.y&&y>=h.next.y&&h.next.y!==h.y){let L=h.x+(y-h.y)*(h.next.x-h.x)/(h.next.y-h.y);if(L<=m&&L>T&&(T=L,x=h.x<h.next.x?h:h.next,L===m))return x}h=h.next}while(h!==u);if(!x)return null;let I=x,M=x.x,S=x.y,R=1/0;h=x;do{if(m>=h.x&&h.x>=M&&m!==h.x&&Ih(y<S?m:T,y,M,S,y<S?T:m,y,h.x,h.y)){let L=Math.abs(y-h.y)/(m-h.x);Hf(h,s)&&(L<R||L===R&&(h.x>x.x||h.x===x.x&&SP(x,h)))&&(x=h,R=L)}h=h.next}while(h!==I);return x}(t,e);if(!n)return e;let o=YT(n,t);return Bc(o,o.next),Bc(n,n.next)}function SP(t,e){return pr(t.prev,t,e.prev)<0&&pr(e.next,t,t.next)<0}function Ev(t,e,n,o,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function AP(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Ih(t,e,n,o,s,u,h,m){return(s-h)*(e-m)>=(t-h)*(u-m)&&(t-h)*(o-m)>=(n-h)*(e-m)&&(n-h)*(u-m)>=(s-h)*(o-m)}function PP(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,o){let s=n;do{if(s.i!==n.i&&s.next.i!==n.i&&s.i!==o.i&&s.next.i!==o.i&&XT(s,s.next,n,o))return!0;s=s.next}while(s!==n);return!1}(t,e)&&(Hf(t,e)&&Hf(e,t)&&function(n,o){let s=n,u=!1,h=(n.x+o.x)/2,m=(n.y+o.y)/2;do s.y>m!=s.next.y>m&&s.next.y!==s.y&&h<(s.next.x-s.x)*(m-s.y)/(s.next.y-s.y)+s.x&&(u=!u),s=s.next;while(s!==n);return u}(t,e)&&(pr(t.prev,t,e.prev)||pr(t,e.prev,e))||Sg(t,e)&&pr(t.prev,t,t.next)>0&&pr(e.prev,e,e.next)>0)}function pr(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Sg(t,e){return t.x===e.x&&t.y===e.y}function XT(t,e,n,o){let s=Pg(pr(t,e,n)),u=Pg(pr(t,e,o)),h=Pg(pr(n,o,t)),m=Pg(pr(n,o,e));return s!==u&&h!==m||!(s!==0||!Ag(t,n,e))||!(u!==0||!Ag(t,o,e))||!(h!==0||!Ag(n,t,o))||!(m!==0||!Ag(n,e,o))}function Ag(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Pg(t){return t>0?1:t<0?-1:0}function Hf(t,e){return pr(t.prev,t,t.next)<0?pr(t,e,t.next)>=0&&pr(t,t.prev,e)>=0:pr(t,e,t.prev)<0||pr(t,t.next,e)<0}function YT(t,e){let n=Iv(t.i,t.x,t.y),o=Iv(e.i,e.x,e.y),s=t.next,u=e.prev;return t.next=e,e.prev=t,n.next=s,s.prev=n,o.next=n,n.prev=o,u.next=o,o.prev=u,o}function QT(t,e,n,o){let s=Iv(t,e,n);return o?(s.next=o.next,s.prev=o,o.next.prev=s,o.next=s):(s.prev=s,s.next=s),s}function qf(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Iv(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Rg(t,e){let n=t.length;if(n<=1)return[t];let o=[],s,u;for(let h=0;h<n;h++){let m=l0(t[h]);m!==0&&(t[h].area=Math.abs(m),u===void 0&&(u=m<0),u===m<0?(s&&o.push(s),s=[t[h]]):s.push(t[h]))}if(s&&o.push(s),e>1)for(let h=0;h<o.length;h++)o[h].length<=e||(dn(o[h],e,1,o[h].length-1,RP),o[h]=o[h].slice(0,e));return o}function RP(t,e){return e.area-t.area}function Mv(t,e,n){let o=n.patternDependencies,s=!1;for(let u of e){let h=u.paint.get(`${t}-pattern`);h.isConstant()||(s=!0);let m=h.constantOr(null);m&&(s=!0,o[m]=!0)}return s}function Dv(t,e,n,o,s){let u=s.patternDependencies;for(let h of e){let m=h.paint.get(`${t}-pattern`).value;if(m.kind!=="constant"){let y=m.evaluate({zoom:o},n,{},s.availableImages);y=y&&y.name?y.name:y,u[y]=!0,n.patterns[h.id]=y}}return n}class Og{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Lo,this.indexArray=new vr,this.indexArray2=new nl,this.programConfigurations=new il(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Zn,this.segments2=new Zn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}updateFootprints(e,n){}populate(e,n,o,s){this.hasPattern=Mv("fill",this.layers,n);let u=this.layers[0].layout.get("fill-sort-key"),h=[];for(let{feature:m,id:y,index:x,sourceLayerIndex:T}of e){let I=this.layers[0]._featureFilter.needGeometry,M=ta(m,I);if(!this.layers[0]._featureFilter.filter(new xt(this.zoom),M,o))continue;let S=u?u.evaluate(M,{},o,n.availableImages):void 0,R={id:y,properties:m.properties,type:m.type,sourceLayerIndex:T,index:x,geometry:I?M.geometry:Fo(m,o,s),patterns:{},sortKey:S};h.push(R)}u&&h.sort((m,y)=>m.sortKey-y.sortKey);for(let m of h){let{geometry:y,index:x,sourceLayerIndex:T}=m;if(this.hasPattern){let I=Dv("fill",this.layers,m,this.zoom,n);this.patternFeatures.push(I)}else this.addFeature(m,y,x,o,{},n.availableImages,n.brightness);n.featureIndex.insert(e[x].feature,y,x,T,this.index)}}update(e,n,o,s,u){let h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,h?this.stateDependentLayers:this.layers,o,s,u)}addFeatures(e,n,o,s,u,h){for(let m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,n,o,s,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,s,u,h=[],m){for(let y of Rg(n,500)){let x=0;for(let L of y)x+=L.length;let T=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),I=T.vertexLength,M=[],S=[];for(let L of y){if(L.length===0)continue;L!==y[0]&&S.push(M.length/2);let k=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),B=k.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(B+L.length-1,B),M.push(L[0].x),M.push(L[0].y);for(let Z=1;Z<L.length;Z++)this.layoutVertexArray.emplaceBack(L[Z].x,L[Z].y),this.indexArray2.emplaceBack(B+Z-1,B+Z),M.push(L[Z].x),M.push(L[Z].y);k.vertexLength+=L.length,k.primitiveLength+=L.length}let R=$f(M,S);for(let L=0;L<R.length;L+=3)this.indexArray.emplaceBack(I+R[L],I+R[L+1],I+R[L+2]);T.vertexLength+=x,T.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,h,s,m)}}let KT,JT,eE,tE;me(Og,"FillBucket",{omit:["layers","patternFeatures"]});class Cv{constructor(e,n,o,s){if(this.triangleCount=n.length/3,this.min=new Je(0,0),this.max=new Je(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[u,h]=[e[0].clone(),e[0].clone()];for(let I=1;I<e.length;++I){let M=e[I];u.x=Math.min(u.x,M.x),u.y=Math.min(u.y,M.y),h.x=Math.max(h.x,M.x),h.y=Math.max(h.y,M.y)}if(s){let I=Math.ceil(Math.max(h.x-u.x,h.y-u.y)/s);o=Math.max(o,I)}if(o===0)return;this.min=u,this.max=h;let m=this.max.sub(this.min);m.x=Math.max(m.x,1),m.y=Math.max(m.y,1);let y=Math.max(m.x,m.y)/o;this.cellsX=Math.max(1,Math.ceil(m.x/y)),this.cellsY=Math.max(1,Math.ceil(m.y/y)),this.xScale=1/y,this.yScale=1/y;let x=[];for(let I=0;I<this.triangleCount;I++){let M=e[n[3*I+0]].sub(this.min),S=e[n[3*I+1]].sub(this.min),R=e[n[3*I+2]].sub(this.min),L=ms(Math.floor(Math.min(M.x,S.x,R.x)),this.xScale,this.cellsX),k=ms(Math.floor(Math.max(M.x,S.x,R.x)),this.xScale,this.cellsX),B=ms(Math.floor(Math.min(M.y,S.y,R.y)),this.yScale,this.cellsY),Z=ms(Math.floor(Math.max(M.y,S.y,R.y)),this.yScale,this.cellsY),W=new Je(0,0),X=new Je(0,0),re=new Je(0,0),ie=new Je(0,0);for(let le=B;le<=Z;++le){W.y=X.y=le*y,re.y=ie.y=(le+1)*y;for(let ge=L;ge<=k;++ge)W.x=re.x=ge*y,X.x=ie.x=(ge+1)*y,(pv(M,S,R,W,X,ie)||pv(M,S,R,W,ie,re))&&x.push({cellIdx:le*this.cellsX+ge,triIdx:I})}}if(x.length===0)return;x.sort((I,M)=>I.cellIdx-M.cellIdx||I.triIdx-M.triIdx);let T=0;for(;T<x.length;){let I=x[T].cellIdx,M={start:this.payload.length,len:0};for(;T<x.length&&x[T].cellIdx===I;)++M.len,this.payload.push(x[T++].triIdx);this.cells[I]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let o=ms(e.x-this.min.x,this.xScale,this.cellsX),s=ms(e.y-this.min.y,this.yScale,this.cellsY),u=this.cells[s*this.cellsX+o];if(u){this._lazyInitLookup();for(let h=0;h<u.len;h++){let m=this.payload[u.start+h],y=Math.floor(m/8),x=1<<m%8;if(!(this.lookup[y]&x)&&(this.lookup[y]|=x,n.push(m),n.length===this.triangleCount))return}}}query(e,n,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();let s=ms(e.x-this.min.x,this.xScale,this.cellsX),u=ms(n.x-this.min.x,this.xScale,this.cellsX),h=ms(e.y-this.min.y,this.yScale,this.cellsY),m=ms(n.y-this.min.y,this.yScale,this.cellsY);for(let y=h;y<=m;y++)for(let x=s;x<=u;x++){let T=this.cells[y*this.cellsX+x];if(T)for(let I=0;I<T.len;I++){let M=this.payload[T.start+I],S=Math.floor(M/8),R=1<<M%8;if(!(this.lookup[S]&R)&&(this.lookup[S]|=R,o.push(M),o.length===this.triangleCount))return}}}}function ms(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}me(Cv,"TriangleGridIndex");class nE{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(e,n){for(let o of this.footprints)n.push({footprint:o,id:e})}populate(e,n,o,s){let u=[];for(let{feature:h,id:m,index:y,sourceLayerIndex:x}of e){let T=this.layers[0]._featureFilter.needGeometry,I=ta(h,T);if(!this.layers[0]._featureFilter.filter(new xt(this.zoom),I,o))continue;let M={id:m,properties:h.properties,type:h.type,sourceLayerIndex:x,index:y,geometry:T?I.geometry:Fo(h,o,s),patterns:{}};u.push(M)}for(let h of u){let{geometry:m,index:y,sourceLayerIndex:x}=h;this.addFeature(h,m,y,o,{},n.availableImages,n.brightness),n.featureIndex.insert(e[y].feature,m,y,x,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,o,s,u){}destroy(){}addFeature(e,n,o,s,u,h=[],m){for(let y of Rg(n,2)){let x=[],T=[],I=[],M=new Je(1/0,1/0),S=new Je(-1/0,-1/0);for(let k of y)if(k.length!==0){k!==y[0]&&I.push(T.length/2);for(let B=0;B<k.length;B++)T.push(k[B].x),T.push(k[B].y),x.push(k[B]),M.x=Math.min(M.x,k[B].x),M.y=Math.min(M.y,k[B].y),S.x=Math.max(S.x,k[B].x),S.y=Math.max(S.y,k[B].y)}let R=$f(T,I),L=new Cv(x,R,8,256);this.footprints.push({vertices:x,indices:R,grid:L,min:M,max:S})}}}me(nE,"ClipBucket",{omit:["layers"]});let OP=mn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),LP=mn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),kP=mn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),FP=mn([{name:"a_join_normal_inside_polygon",components:4,type:"Int16"}]),NP=mn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),zP=mn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:BP}=OP;var Lg={},jP=Wl,rE=Mh;function Mh(t,e,n,o,s){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=o,this._values=s,t.readFields(VP,this,e)}function VP(t,e,n){t==1?e.id=n.readVarint():t==2?function(o,s){for(var u=o.readVarint()+o.pos;o.pos<u;){var h=s._keys[o.readVarint()],m=s._values[o.readVarint()];s.properties[h]=m}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function UP(t){for(var e,n,o=0,s=0,u=t.length,h=u-1;s<u;h=s++)o+=((n=t[h]).x-(e=t[s]).x)*(e.y+n.y);return o}Mh.types=["Unknown","Point","LineString","Polygon"],Mh.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,o=1,s=0,u=0,h=0,m=[];t.pos<n;){if(s<=0){var y=t.readVarint();o=7&y,s=y>>3}if(s--,o===1||o===2)u+=t.readSVarint(),h+=t.readSVarint(),o===1&&(e&&m.push(e),e=[]),e.push(new jP(u,h));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&m.push(e),m},Mh.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,o=0,s=0,u=0,h=1/0,m=-1/0,y=1/0,x=-1/0;t.pos<e;){if(o<=0){var T=t.readVarint();n=7&T,o=T>>3}if(o--,n===1||n===2)(s+=t.readSVarint())<h&&(h=s),s>m&&(m=s),(u+=t.readSVarint())<y&&(y=u),u>x&&(x=u);else if(n!==7)throw new Error("unknown command "+n)}return[h,y,m,x]},Mh.prototype.toGeoJSON=function(t,e,n){var o,s,u=this.extent*Math.pow(2,n),h=this.extent*t,m=this.extent*e,y=this.loadGeometry(),x=Mh.types[this.type];function T(S){for(var R=0;R<S.length;R++){var L=S[R];S[R]=[360*(L.x+h)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(L.y+m)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(o=0;o<y.length;o++)I[o]=y[o][0];T(y=I);break;case 2:for(o=0;o<y.length;o++)T(y[o]);break;case 3:for(y=function(S){var R=S.length;if(R<=1)return[S];for(var L,k,B=[],Z=0;Z<R;Z++){var W=UP(S[Z]);W!==0&&(k===void 0&&(k=W<0),k===W<0?(L&&B.push(L),L=[S[Z]]):L.push(S[Z]))}return L&&B.push(L),B}(y),o=0;o<y.length;o++)for(s=0;s<y[o].length;s++)T(y[o][s])}y.length===1?y=y[0]:x="Multi"+x;var M={type:"Feature",geometry:{type:x,coordinates:y},properties:this.properties};return"id"in this&&(M.id=this.id),M};var $P=rE,iE=oE;function oE(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(GP,this,e),this.length=this._features.length}function GP(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(o){for(var s=null,u=o.readVarint()+o.pos;o.pos<u;){var h=o.readVarint()>>3;s=h===1?o.readString():h===2?o.readFloat():h===3?o.readDouble():h===4?o.readVarint64():h===5?o.readVarint():h===6?o.readSVarint():h===7?o.readBoolean():null}return s}(n))}oE.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new $P(this._pbf,e,this.extent,this._keys,this._values)};var HP=iE;function qP(t,e,n){if(t===3){var o=new HP(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}var Sv=Lg.VectorTile=function(t,e){this.layers=t.readFields(qP,{},e)},kg=Lg.VectorTileFeature=rE;Lg.VectorTileLayer=iE;class jc extends Je{constructor(e,n,o){super(e,n),this.z=o}}class sE extends jc{constructor(e,n,o,s){super(e,n,o),this.w=s}}function Fg(t,e,n,o){let s=[],u=o===0?(h,m,y,x,T,I)=>{h.push(new Je(I,y+(I-m)/(x-m)*(T-y)))}:(h,m,y,x,T,I)=>{h.push(new Je(m+(I-y)/(T-y)*(x-m),I))};for(let h of t){let m=[];for(let y of h){if(y.length<=2)continue;let x=[];for(let M=0;M<y.length-1;M++){let S=y[M].x,R=y[M].y,L=y[M+1].x,k=y[M+1].y,B=o===0?S:R,Z=o===0?L:k;B<e?Z>e&&u(x,S,R,L,k,e):B>n?Z<n&&u(x,S,R,L,k,n):x.push(y[M]),Z<e&&B>=e&&u(x,S,R,L,k,e),Z>n&&B<=n&&u(x,S,R,L,k,n)}let T=y[y.length-1],I=o===0?T.x:T.y;I>=e&&I<=n&&x.push(T),x.length&&(T=x[x.length-1],x[0].x===T.x&&x[0].y===T.y||x.push(x[0]),m.push(x))}m.length&&s.push(m)}return s}function aE(t,e,n,o){let s=n==="x"?"y":"x",u=(o-t[n])/(e[n]-t[n]);t[s]=t[s]+(e[s]-t[s])*u,t[n]=o,t.hasOwnProperty("z")&&(t.z=gt(t.z,e.z,u)),t.hasOwnProperty("w")&&(t.w=gt(t.w,e.w,u))}function lE(t,e,n,o){let s=n,u=o;for(let h of["x","y"]){let m=t,y=e;m[h]>=y[h]&&(m=e,y=t),m[h]<s&&y[h]>s&&aE(m,y,h,s),m[h]<u&&y[h]>u&&aE(y,m,h,u)}}let Ng=Number.MAX_SAFE_INTEGER;function cE(t,e,n,o){return t.order<e||t.order===Ng||!(t.clipMask&n)||function(s,u){return u.length!==0&&u.find(h=>h===s)===void 0}(o,t.clipScope)}function zg(t,e){return t.x-e.x||t.y-e.y}function uE(t,e){return zg(t.min,e.min)===0&&zg(t.max,e.max)===0}function Av(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function Pv(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n].sourceId!==e[n].sourceId||!uE(t[n],e[n])||t[n].order!==e[n].order||t[n].clipMask!==e[n].clipMask||!Ra(t[n].clipScope,e[n].clipScope))return!1;return!0}function hE(t,e,n){let o=1/Xe,s=1/(1<<n.canonical.z),u=(e.x*o+n.canonical.x)*s+n.wrap,h=(e.y*o+n.canonical.y)*s;return{min:new Je((t.x*o+n.canonical.x)*s+n.wrap,(t.y*o+n.canonical.y)*s),max:new Je(u,h)}}function WP(t,e,n){let o=1<<n.canonical.z,s=((e.x-n.wrap)*o-n.canonical.x)*Xe,u=(e.y*o-n.canonical.y)*Xe;return{min:new Je(((t.x-n.wrap)*o-n.canonical.x)*Xe,(t.y*o-n.canonical.y)*Xe),max:new Je(s,u)}}function dE(t,e,n,o,s,u,h){let m=t.indices,y=t.vertices,x=[];for(let T=o;T<o+s;T+=3){let I=e[n[T+0]+u],M=e[n[T+1]+u],S=e[n[T+2]+u],R=Math.min(I.x,M.x,S.x),L=Math.max(I.x,M.x,S.x),k=Math.min(I.y,M.y,S.y),B=Math.max(I.y,M.y,S.y);x.length=0,t.grid.query(new Je(R,k),new Je(L,B),x);for(let Z=0;Z<x.length;Z++){let W=x[Z];if(pv(y[m[3*W+0]],y[m[3*W+1]],y[m[3*W+2]],I,M,S,h))return!0}}return!1}function fE(t,e,n,o){if(!t||!n)return!1;let s=t.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(n.vertices.length<t.vertices.length)return fE(n,o,t,e);let u=e.canonical,h=o.canonical,m=Math.pow(2,h.z-u.z);s=t.vertices.map(y=>new Je((y.x+u.x*Xe)*m-h.x*Xe,(y.y+u.y*Xe)*m-h.y*Xe))}return dE(n,s,t.indices,0,t.indices.length,0,0)}function pE(t,e,n,o){let s=Math.pow(2,o.z-n.z);return new Je((t+n.x*Xe)*s-o.x*Xe,(e+n.y*Xe)*s-o.y*Xe)}function mE(t,e){let n=[];e.footprint.grid.queryPoint(t,n);let o=e.footprint.indices,s=e.footprint.vertices;for(let u=0;u<n.length;u++){let h=n[u];if(sl([s[o[3*h+0]],s[o[3*h+1]],s[o[3*h+2]]],t))return!0}return!1}class gE{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let o=this.toIdx(e,n);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function _E(t,e,n,o){let s=0,u=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(o[h])<1e-15){if(n[h]<t[h]||n[h]>e[h])return null}else{let m=1/o[h],y=(t[h]-n[h])*m,x=(e[h]-n[h])*m;if(y>x){let T=y;y=x,x=T}if(y>s&&(s=y),x<u&&(u=x),s>u)return null}return s}function yE(t,e,n,o,s,u,h,m,y,x,T){let I=o-t,M=s-e,S=u-n,R=h-t,L=m-e,k=y-n,B=T[1]*k-T[2]*L,Z=T[2]*R-T[0]*k,W=T[0]*L-T[1]*R,X=I*B+M*Z+S*W;if(Math.abs(X)<1e-15)return null;let re=1/X,ie=x[0]-t,le=x[1]-e,ge=x[2]-n,we=(ie*B+le*Z+ge*W)*re;if(we<0||we>1)return null;let Ce=le*S-ge*M,Te=ge*I-ie*S,Oe=ie*M-le*I,$e=(T[0]*Ce+T[1]*Te+T[2]*Oe)*re;return $e<0||we+$e>1?null:(R*Ce+L*Te+k*Oe)*re}function vE(t,e,n){return(t-e)/(n-e)}function xE(t,e,n,o,s,u,h,m,y){let x=1<<n,T=u-o,I=h-s,M=(t+1)/x*T+o,S=(e+0)/x*I+s,R=(e+1)/x*I+s;m[0]=(t+0)/x*T+o,m[1]=S,y[0]=M,y[1]=R}class bE{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(u){let h=Math.ceil(Math.log2(u.dim/8)),m=[],y=Math.ceil(Math.pow(2,h)),x=1/y,T=(S,R,L,k,B)=>{let Z=k?1:0,W=(S+1)*L-Z,X=R*L,re=(R+1)*L-Z;B[0]=S*L,B[1]=X,B[2]=W,B[3]=re},I=new gE(y),M=[];for(let S=0;S<y*y;S++){T(S%y,Math.floor(S/y),x,!1,M);let R=ll(M[0],M[1],u),L=ll(M[2],M[1],u),k=ll(M[2],M[3],u),B=ll(M[0],M[3],u);I.minimums.push(Math.min(R,L,k,B)),I.maximums.push(Math.max(R,L,k,B)),I.leaves.push(1)}for(m.push(I),y/=2;y>=1;y/=2){let S=m[m.length-1];I=new gE(y);for(let R=0;R<y*y;R++){T(R%y,Math.floor(R/y),2,!0,M);let L=S.getElevation(M[0],M[1]),k=S.getElevation(M[2],M[1]),B=S.getElevation(M[2],M[3]),Z=S.getElevation(M[0],M[3]),W=S.isLeaf(M[0],M[1]),X=S.isLeaf(M[2],M[1]),re=S.isLeaf(M[2],M[3]),ie=S.isLeaf(M[0],M[3]),le=Math.min(L.min,k.min,B.min,Z.min),ge=Math.max(L.max,k.max,B.max,Z.max),we=W&&X&&re&&ie;I.maximums.push(ge),I.minimums.push(le),I.leaves.push(ge-le<=5&&we?1:0)}m.push(I)}return m}(this.dem),o=n.length-1,s=n[o];this._addNode(s.minimums[0],s.maximums[0],s.leaves[0]),this._construct(n,0,0,o,0)}raycastRoot(e,n,o,s,u,h,m=1){return _E([e,n,-100],[o,s,this.maximums[0]*m],u,h)}raycast(e,n,o,s,u,h,m=1){if(!this.nodeCount)return null;let y=this.raycastRoot(e,n,o,s,u,h,m);if(y==null)return null;let x=[],T=[],I=[],M=[],S=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;S.length>0;){let{idx:R,t:L,nodex:k,nodey:B,depth:Z}=S.pop();if(this.leaves[R]){xE(k,B,Z,e,n,o,s,I,M);let X=1<<Z,re=(k+0)/X,ie=(k+1)/X,le=(B+0)/X,ge=(B+1)/X,we=ll(re,le,this.dem)*m,Ce=ll(ie,le,this.dem)*m,Te=ll(ie,ge,this.dem)*m,Oe=ll(re,ge,this.dem)*m,$e=yE(I[0],I[1],we,M[0],I[1],Ce,M[0],M[1],Te,u,h),Le=yE(M[0],M[1],Te,I[0],M[1],Oe,I[0],I[1],we,u,h),qe=Math.min($e!==null?$e:Number.MAX_VALUE,Le!==null?Le:Number.MAX_VALUE);if(qe!==Number.MAX_VALUE)return qe;{let Re=r.$.scaleAndAdd([],u,h,L);if(wE(we,Ce,Oe,Te,vE(Re[0],I[0],M[0]),vE(Re[1],I[1],M[1]))>=Re[2])return L}continue}let W=0;for(let X=0;X<this._siblingOffset.length;X++){xE((k<<1)+this._siblingOffset[X][0],(B<<1)+this._siblingOffset[X][1],Z+1,e,n,o,s,I,M),I[2]=-100,M[2]=this.maximums[this.childOffsets[R]+X]*m;let re=_E(I,M,u,h);if(re!=null){let ie=re;x[X]=ie;let le=!1;for(let ge=0;ge<W&&!le;ge++)ie>=x[T[ge]]&&(T.splice(ge,0,X),le=!0);le||(T[W]=X),W++}}for(let X=0;X<W;X++){let re=T[X];S.push({idx:this.childOffsets[R]+re,t:x[re],nodex:(k<<1)+this._siblingOffset[re][0],nodey:(B<<1)+this._siblingOffset[re][1],depth:Z+1})}}return null}_addNode(e,n,o){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,o,s,u){if(e[s].isLeaf(n,o)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);let h=s-1,m=e[h],y=0,x=0;for(let T=0;T<this._siblingOffset.length;T++){let I=2*n+this._siblingOffset[T][0],M=2*o+this._siblingOffset[T][1],S=m.getElevation(I,M),R=m.isLeaf(I,M),L=this._addNode(S.min,S.max,R);R&&(y|=1<<T),x||(x=L)}for(let T=0;T<this._siblingOffset.length;T++)y&1<<T||this._construct(e,2*n+this._siblingOffset[T][0],2*o+this._siblingOffset[T][1],h,x+T)}}function wE(t,e,n,o,s,u){return gt(gt(t,n,u),gt(e,o,u),s)}function ll(t,e,n){let o=n.dim,s=jt(t*o-.5,0,o-1),u=jt(e*o-.5,0,o-1),h=Math.floor(s),m=Math.floor(u),y=Math.min(h+1,o-1),x=Math.min(m+1,o-1);return wE(n.get(h,m),n.get(y,m),n.get(h,x),n.get(y,x),s-h,u-m)}let ZP={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function XP(t,e,n){return(256*t*256+256*e+n)/10-1e4}function YP(t,e,n){return 256*t+e+n/256-32768}class Bg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,o,s=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return rr(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let u=this.dim=n.height-2,h=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=s,this._modifiedForSources={},!s){for(let y=0;y<u;y++)h[this._idx(-1,y)]=h[this._idx(0,y)],h[this._idx(u,y)]=h[this._idx(u-1,y)],h[this._idx(y,-1)]=h[this._idx(y,0)],h[this._idx(y,u)]=h[this._idx(y,u-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(u,-1)]=h[this._idx(u-1,0)],h[this._idx(-1,u)]=h[this._idx(0,u-1)],h[this._idx(u,u)]=h[this._idx(u-1,u-1)]}let m=o==="terrarium"?YP:XP;for(let y=0;y<h.length;++y){let x=4*y;this.floatView[y]=m(this.pixels[x],this.pixels[x+1],this.pixels[x+2])}this._timestamp=kr.now()}_buildQuadTree(){this._tree=new bE(this)}get(e,n,o=!1){o&&(e=jt(e,-1,this.dim),n=jt(n,-1,this.dim));let s=this._idx(e,n);return this.floatView[s]}set(e,n,o){let s=this._idx(e,n),u=this.floatView[s];return this.floatView[s]=o,o-u}static getUnpackVector(e){return ZP[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let o=[0,0,0,0],s=Bg.getUnpackVector(n),u=Math.floor((e+s[3])/s[2]);return o[2]=u%256,u=Math.floor(u/256),o[1]=u%256,u=Math.floor(u/256),o[0]=u,o}getPixels(){return new $T({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let s=n*this.dim,u=n*this.dim+this.dim,h=o*this.dim,m=o*this.dim+this.dim;switch(n){case-1:s=u-1;break;case 1:u=s+1}switch(o){case-1:h=m-1;break;case 1:m=h+1}let y=-n*this.dim,x=-o*this.dim;for(let T=h;T<m;T++)for(let I=s;I<u;I++){let M=4*this._idx(I,T),S=4*this._idx(I+y,T+x);this.pixels[M+0]=e.pixels[S+0],this.pixels[M+1]=e.pixels[S+1],this.pixels[M+2]=e.pixels[S+2],this.pixels[M+3]=e.pixels[S+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}me(Bg,"DEMData"),me(bE,"DemMinMaxQuadTree",{omit:["dem"]});class Dh{constructor(e,n,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=o}static create(e,n,o){let s=o||e.findDEMTileFor(n);if(!s||!s.dem)return;let u=s.dem,h=s.tileID,m=1<<n.canonical.z-h.canonical.z;return new Dh(s,u.dim/Xe/m,[(n.canonical.x/m-h.canonical.x)*u.dim,(n.canonical.y/m-h.canonical.y)*u.dim])}tileCoordToPixel(e,n){let o=n*this._scale+this._offset[1],s=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(o);return new Je(s,u)}getElevationAt(e,n,o,s){let u=e*this._scale+this._offset[0],h=n*this._scale+this._offset[1],m=Math.floor(u),y=Math.floor(h),x=this._dem;return s=!!s,o?gt(gt(x.get(m,y,s),x.get(m,y+1,s),h-y),gt(x.get(m+1,y,s),x.get(m+1,y+1,s),h-y),u-m):x.get(m,y,s)}getElevationAtPixel(e,n,o){return this._dem.get(e,n,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ui(1,e)*this._dem.stride}}let TE={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},QP=kg.types,KP=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-line-alignment"],JP=["fill-extrusion-flood-light-ground-radius"],eR=Math.pow(2,13),tR=Math.pow(2,15)-1,EE=new Je(0,1),cl=2147483648;function Wf(t,e,n,o,s,u,h,m){t.emplaceBack((e<<1)+h,(n<<1)+u,(Math.floor(o*eR)<<1)+s,Math.round(m))}function Zf(t,e,n,o){t.emplaceBack(e.x*Xe,e.y*Xe,n?0:1,o?1:0)}function jg(t,e,n,o,s,u){t.emplaceBack(e.x,e.y,(n.x<<1)+o,(n.y<<1)+s,u)}function Xf(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class IE{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class ME{constructor(){this.centroidXY=new Je(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Je(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Je(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Je(this.max.x-this.min.x,this.max.y-this.min.y)}}class DE{constructor(){this.acc=new Je(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,o){this.accCount++,this.acc._add(n);let s=!!this.borders;n.x<e.min.x?(e.min.x=n.x,s=!0):n.x>e.max.x&&(e.max.x=n.x,s=!0),n.y<e.min.y?(e.min.y=n.y,s=!0):n.y>e.max.y&&(e.max.y=n.y,s=!0),((n.x===0||n.x===Xe)&&n.x===o.x)!=((n.y===0||n.y===Xe)&&n.y===o.y)&&this.processBorderOverlap(n,o),s&&this.checkBorderIntersection(n,o)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,gt(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Xe!=e.x>Xe&&this.addBorderIntersection(1,gt(n.y,e.y,(Xe-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,gt(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Xe!=e.y>Xe&&this.addBorderIntersection(3,gt(n.x,e.x,(Xe-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let o=this.borders[e];n<o[0]&&(o[0]=n),n>o[1]&&(o[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let o=e.x===0?0:1;this.addBorderIntersection(o,n.y),this.addBorderIntersection(o,e.y)}else{let o=e.y===0?2:3;this.addBorderIntersection(o,n.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new Je(0,0):new Je(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function CE(t,e){let n=t.add(e)._unit(),o=jt(t.x*n.x+t.y*n.y,-1,1);var s,u,h;return s=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(s)))/4*tR*((u=t).x*(h=e).y-u.y*h.x<0?-1:1)}let nR=[t=>t.x<0,t=>t.x>Xe,t=>t.y<0,t=>t.y>Xe];function rR(t,e,n,o){let s=[4];if(o===0)return s;n._mult(o);let u=t.sub(n),h=e.sub(n),m=[t,e,u,h];for(let y=0;y<4;y++)for(let x of m)if(nR[y](x)){s.push(y);break}return s}class SE{constructor(e){this.vertexArray=new F0,this.indexArray=new vr,this.programConfigurations=new il(e.layers,{zoom:e.zoom,lut:e.lut},n=>JP.includes(n)),this._segments=new Zn,this.hiddenByLandmarkVertexArray=new Y0,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Zn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,o,s=!1){let u=e.length;if(u>2){let h=Math.max(0,this._segments.get().length-1),m=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[h].length),y;h!==this._segments.get().length-1&&(h++,this._segmentToGroundQuads[h]=[],this._segmentToRegionTriCounts[h]=[0,0,0,0,0]);{let x=e[0],T=e[1];y=CE(x.sub(e[u-1])._perp()._unit(),T.sub(x)._perp()._unit())}for(let x=0;x<u;x++){let T=x===u-1?0:x+1,I=e[x],M=e[T],S=e[T===u-1?0:T+1],R=M.sub(I)._perp()._unit(),L=CE(R,S.sub(M)._perp()._unit()),k=y,B=L;if(Rv(I,M,n)||s&&RE(I,n)&&RE(M,n)){y=L;continue}let Z=m.vertexLength;jg(this.vertexArray,I,M,1,1,k),jg(this.vertexArray,I,M,1,0,k),jg(this.vertexArray,I,M,0,1,B),jg(this.vertexArray,I,M,0,0,B),m.vertexLength+=4;let W=rR(I,M,R,o);for(let X of W)this._segmentToGroundQuads[h].push({id:Z,region:X}),this._segmentToRegionTriCounts[h][X]+=2,m.primitiveLength+=2;y=L}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let o=0;o<n;o++)this._segmentToGroundQuads[o].sort((s,u)=>s.region-u.region);for(let o=0;o<n;o++){let s=this._segmentToGroundQuads[o],u=e[o],h=this._segmentToRegionTriCounts[o];h.reduce((y,x)=>y+x,0);let m=0;for(let y=0;y<=4;y++){let x=h[y];if(x!==0){let T=this.regionSegments[y];T||(T=this.regionSegments[y]=new Zn);let I={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+m,vertexLength:u.vertexLength,primitiveLength:x};T.get().push(I)}m+=x}for(let y=0;y<s.length;y++){let x=s[y].id;this.indexArray.emplaceBack(x,x+1,x+3),this.indexArray.emplaceBack(x,x+3,x+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,o,s,u,h){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,o,s,u,h)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,LP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,o,s,u,h){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,o,s,u,h)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let o=e.flags&cl?1:0;for(let s=e.groundVertexArrayOffset;s<n;++s)this.hiddenByLandmarkVertexArray.emplace(s,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,NP.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class Vg{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new vr,this.footprintVertices=new Lo,this.footprintSegments=[],this.layoutVertexArray=new Qs,this.centroidVertexArray=new tT,this.wallVertexArray=new rT,this.indexArray=new vr,this.programConfigurations=new il(e.layers,{zoom:e.zoom,lut:e.lut},n=>KP.includes(n)),this.segments=new Zn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new SE(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,n){}populate(e,n,o,s){this.features=[],this.hasPattern=Mv("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=bg(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(let{feature:u,id:h,index:m,sourceLayerIndex:y}of e){let x=this.layers[0]._featureFilter.needGeometry,T=ta(u,x);if(!this.layers[0]._featureFilter.filter(new xt(this.zoom),T,o))continue;let I={id:h,sourceLayerIndex:y,index:m,geometry:x?T.geometry:Fo(u,o,s),properties:u.properties,type:u.type,patterns:{}},M=this.layoutVertexArray.length;if(this.hasPattern)this.features.push(Dv("fill-extrusion",this.layers,I,this.zoom,n));else if(this.wallMode)for(let S of I.geometry)this.addFeature(I,[S],m,o,{},n.availableImages,s,n.brightness);else this.addFeature(I,I.geometry,m,o,{},n.availableImages,s,n.brightness);n.featureIndex.insert(u,I.geometry,m,y,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,o,s,u,h){for(let m of this.features){let{geometry:y}=m;if(this.wallMode)for(let x of y)this.addFeature(m,[x],m.index,n,o,s,u,h);else this.addFeature(m,y,m.index,n,o,s,u,h)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,o,s,u){let h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;let m=h?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,m,o,s,u),this.groundEffect.update(e,n,m,o,s,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,BP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,FP.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,zP.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,kP.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,s,u,h,m,y){let x=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,T=[new Je(0,0),new Je(Xe,Xe)],I=m.projection,M=I.name==="globe",S=this.wallMode||QP[e.type]==="Polygon",R=new DE;R.centroidDataIndex=this.centroidData.length;let L=new ME,k=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},s)<=0,B=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},s),Z;if(L.height=B,L.vertexArrayOffset=this.layoutVertexArray.length,L.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new gg),this.wallMode){if(M)return void rr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(n.length!==1)return;Z=function(Ce){let Te=Ce[0].x===Ce[Ce.length-1].x&&Ce[0].y===Ce[Ce.length-1].y;(function(ht){let ot=0,Ye=ht.length;for(let vt=0;vt<Ye;vt++)ot+=(ht[(vt+1)%Ye].x-ht[vt].x)*(ht[(vt+1)%Ye].y+ht[vt].y);return ot>=0})(Ce)||(Ce=Ce.reverse());let $e={isPolygon:Te,geometry:[],joinNormals:[]},Le=[],qe=[],Re=[],ze=Ce.length;if(ze<(Te?3:2))return $e;for(;ze>=2&&Ce[ze-1].equals(Ce[ze-2]);)ze--;let Ze,ke,Qe,We,Ge,ft=0;for(;ft<ze-1&&Ce[ft].equals(Ce[ft+1]);)ft++;Te&&(Ze=Ce[ze-2],Ge=Ce[ft].sub(Ze)._unit()._perp());for(let ht=ft;ht<ze;ht++){if(Qe=ht===ze-1?Te?Ce[ft+1]:void 0:Ce[ht+1],Qe&&Ce[ht].equals(Qe))continue;Ge&&(We=Ge),Ze&&(ke=Ze),Ze=Ce[ht],Ge=Qe?Qe.sub(Ze)._unit()._perp():We,We=We||Ge;let ot=We.add(Ge);ot.x===0&&ot.y===0||ot._unit();let Ye=ot.x*Ge.x+ot.y*Ge.y,vt=Ye!==0?1/Ye:1/0,dt=We.x*Ge.y-We.y*Ge.x>0,lt="miter";lt==="miter"&&vt>2&&(lt="bevel");let Et=(Ct,It,Nt,Zt)=>{let $t=new Je(Ct.x,Ct.y),Cn=new Je(Ct.x,Ct.y);$t.x-=It.x*Zt,$t.y-=It.y*Zt,Cn.x-=It.x*Math.max(Nt,1),Cn.y-=It.y*Math.max(Nt,1),Re.push(It),Le.push($t),qe.push(Cn)};if(lt==="miter")ot._mult(vt),Et(Ze,ot,1,0);else{let Ct=-Math.sqrt(vt*vt-1),It=dt?Ct:0,Nt=dt?0:Ct;ke&&Et(Ze,We,It,Nt),Qe&&Et(Ze,Ge,It,Nt)}}return $e.geometry=[...Le,...qe.reverse(),Le[0]],$e.joinNormals=[...Re,...Re.reverse(),Re[Re.length-1]],$e}(n[0]),n=[Z.geometry]}let W=(Ce,Te)=>Ce<(Te.length-1)/2||Ce===Te.length-1,X=this.wallMode?[n]:Rg(n,500);for(let Ce=X.length-1;Ce>=0;Ce--){let Te=X[Ce];(Te.length===0||(re=Te[0]).every(Oe=>Oe.x<=0)||re.every(Oe=>Oe.x>=Xe)||re.every(Oe=>Oe.y<=0)||re.every(Oe=>Oe.y>=Xe))&&X.splice(Ce,1)}var re;let ie;if(M)ie=FE(X,T,s);else{ie=[];for(let Ce of X)ie.push({polygon:Ce,bounds:T})}let le=S?this.edgeRadius:0,ge=le>0&&this.zoom<17,we=(Ce,Te)=>{if(Ce.length===0)return!1;let Oe=Ce[Ce.length-1];return Te.x===Oe.x&&Te.y===Oe.y};for(let{polygon:Ce,bounds:Te}of ie){let Oe=0,$e=0;for(let ze of Ce)S&&!ze[0].equals(ze[ze.length-1])&&ze.push(ze[0]),$e+=S?ze.length-1:ze.length;let Le=this.segments.prepareSegment((S?5:4)*$e,this.layoutVertexArray,this.indexArray);L.footprintSegIdx<0&&(L.footprintSegIdx=this.footprintSegments.length),L.polygonSegIdx<0&&(L.polygonSegIdx=this.polygonSegments.length);let qe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Re=new IE;if(Re.vertexOffset=this.footprintVertices.length,Re.indexOffset=3*this.footprintIndices.length,Re.ringIndices=[],S){let ze=[],Ze=[];Oe=Le.vertexLength;for(let Qe=0;Qe<Ce.length;Qe++){let We=Ce[Qe];We.length&&Qe!==0&&Ze.push(ze.length/2);let Ge=[],ft,ht;ft=We[1].sub(We[0])._perp()._unit(),Re.ringIndices.push(We.length-1);for(let ot=1;ot<We.length;ot++){let Ye=We[ot],vt=We[ot===We.length-1?1:ot+1],dt=Ye.clone();if(le){ht=vt.sub(Ye)._perp()._unit();let lt=ft.add(ht)._unit(),Et=le*Math.min(4,1/(ft.x*lt.x+ft.y*lt.y));dt.x+=Et*lt.x,dt.y+=Et*lt.y,dt.x=Math.round(dt.x),dt.y=Math.round(dt.y),ft=ht}if(!k||le!==0&&!ge||we(Ge,dt)||Ge.push(dt),Wf(this.layoutVertexArray,dt.x,dt.y,0,0,1,1,0),this.wallMode){let lt=W(ot,We);Zf(this.wallVertexArray,Z.joinNormals[ot],lt,Z.isPolygon)}Le.vertexLength++,this.footprintVertices.emplaceBack(Ye.x,Ye.y),ze.push(Ye.x,Ye.y),M&&Xf(this.layoutVertexExtArray,I.projectTilePoint(dt.x,dt.y,s),I.upVector(s,dt.x,dt.y))}k&&(le===0||ge)&&(Ge.length!==0&&we(Ge,Ge[0])&&Ge.pop(),this.groundEffect.addData(Ge,Te,x))}let ke=$f(ze,Ze);for(let Qe=0;Qe<ke.length;Qe+=3)this.footprintIndices.emplaceBack(Re.vertexOffset+ke[Qe+0],Re.vertexOffset+ke[Qe+1],Re.vertexOffset+ke[Qe+2]),this.indexArray.emplaceBack(Oe+ke[Qe],Oe+ke[Qe+2],Oe+ke[Qe+1]),Le.primitiveLength++;Re.indexCount+=ke.length,Re.vertexCount+=this.footprintVertices.length-Re.vertexOffset}for(let ze=0;ze<Ce.length;ze++){let Ze=Ce[ze];R.startRing(L,Ze[0]);let ke=Ze.length>4&&OE(Ze[Ze.length-2],Ze[0],Ze[1]),Qe=le?iR(Ze[Ze.length-2],Ze[0],Ze[1],le):0,We=[],Ge,ft,ht;ft=Ze[1].sub(Ze[0])._perp()._unit();let ot=!0;for(let Ye=1,vt=0;Ye<Ze.length;Ye++){let dt=Ze[Ye-1],lt=Ze[Ye],Et=Ze[Ye===Ze.length-1?1:Ye+1];if(R.appendEdge(L,lt,dt),Rv(lt,dt,Te)){le&&(ft=Et.sub(lt)._perp()._unit(),ot=!ot);continue}let Ct=lt.sub(dt)._perp(),It=Ct.x/(Math.abs(Ct.x)+Math.abs(Ct.y)),Nt=Ct.y>0?1:0,Zt=dt.dist(lt);if(vt+Zt>32768&&(vt=0),le){ht=Et.sub(lt)._perp()._unit();let St=PE(dt,lt,Et,AE(ft,ht),le);isNaN(St)&&(St=0);let gn=lt.sub(dt)._unit();dt=dt.add(gn.mult(Qe))._round(),lt=lt.add(gn.mult(-St))._round(),Qe=St,ft=ht,k&&this.zoom>=17&&(we(We,dt)||We.push(dt),we(We,lt)||We.push(lt))}let $t=Le.vertexLength,Cn=Ze.length>4&&OE(dt,lt,Et),On=LE(vt,ke,ot);if(Wf(this.layoutVertexArray,dt.x,dt.y,It,Nt,0,0,On),Wf(this.layoutVertexArray,dt.x,dt.y,It,Nt,0,1,On),this.wallMode){let St=W(Ye-1,Ze),gn=Z.joinNormals[Ye-1];Zf(this.wallVertexArray,gn,!St,Z.isPolygon),Zf(this.wallVertexArray,gn,!St,Z.isPolygon)}if(vt+=Zt,On=LE(vt,Cn,!ot),ke=Cn,Wf(this.layoutVertexArray,lt.x,lt.y,It,Nt,0,0,On),Wf(this.layoutVertexArray,lt.x,lt.y,It,Nt,0,1,On),this.wallMode){let St=W(Ye,Ze),gn=Z.joinNormals[Ye];Zf(this.wallVertexArray,gn,!St,Z.isPolygon),Zf(this.wallVertexArray,gn,!St,Z.isPolygon)}if(Le.vertexLength+=4,this.indexArray.emplaceBack($t+0,$t+1,$t+2),this.indexArray.emplaceBack($t+1,$t+3,$t+2),Le.primitiveLength+=2,le){let St=Oe+(Ye===1?Ze.length-2:Ye-2),gn=Ye===1?Oe:St+1;if(this.indexArray.emplaceBack($t+1,St,$t+3),this.indexArray.emplaceBack(St,gn,$t+3),Le.primitiveLength+=2,Ge===void 0&&(Ge=$t),!Rv(Et,Ze[Ye],Te)){let xn=Ye===Ze.length-1?Ge:Le.vertexLength;this.indexArray.emplaceBack($t+2,$t+3,xn),this.indexArray.emplaceBack($t+3,xn+1,xn),this.indexArray.emplaceBack($t+3,gn,xn+1),Le.primitiveLength+=3}ot=!ot}if(M){let St=this.layoutVertexExtArray,gn=I.projectTilePoint(dt.x,dt.y,s),xn=I.projectTilePoint(lt.x,lt.y,s),zn=I.upVector(s,dt.x,dt.y),Kn=I.upVector(s,lt.x,lt.y);Xf(St,gn,zn),Xf(St,gn,zn),Xf(St,xn,Kn),Xf(St,xn,Kn)}}S&&(Oe+=Ze.length-1),k&&le&&this.zoom>=17&&(We.length!==0&&we(We,We[0])&&We.pop(),this.groundEffect.addData(We,Te,x,le>0))}this.footprintSegments.push(Re),qe.triangleCount=this.indexArray.length-qe.triangleArrayOffset,this.polygonSegments.push(qe),++L.footprintSegLen,++L.polygonSegLen}if(L.vertexCount=this.layoutVertexArray.length-L.vertexArrayOffset,L.groundVertexCount=this.groundEffect.vertexArray.length-L.groundVertexArrayOffset,L.vertexCount!==0){if(L.centroidXY=R.borders?EE:this.encodeCentroid(R,L),this.centroidData.push(L),R.borders){this.featuresOnBorder.push(R);let Ce=this.featuresOnBorder.length-1;for(let Te=0;Te<R.borders.length;Te++)R.borders[Te][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Te].push(Ce)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,h,s,y),this.groundEffect.addPaintPropertiesData(e,o,u,h,s,y),this.maxHeight=Math.max(this.maxHeight,B)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,o)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){let e=[];for(let m=0;m<this.centroidData.length;m++){let y=this.centroidData[m],x=+(y.min.y+y.max.y>Xe),T=2*x+(+(y.min.x+y.max.x>Xe)^x);for(let I=0;I<y.polygonSegLen;I++){let M=y.polygonSegIdx+I;e.push({centroidIdx:m,subtile:T,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}let n=new vr;e.sort((m,y)=>m.triangleSegmentIdx===y.triangleSegmentIdx?m.subtile-y.subtile:m.triangleSegmentIdx-y.triangleSegmentIdx);let o=0,s=0,u=0;for(let m of e){if(m.triangleSegmentIdx!==o)break;u++}let h=e.length;for(;s!==e.length;){o=e[s].triangleSegmentIdx;let m=0,y=s,x=s;for(let T=y;T<u&&e[T].subtile===m;T++)x++;for(;y!==u;){let T=e[y];m=T.subtile;let I=this.centroidData[T.centroidIdx].min.clone(),M=this.centroidData[T.centroidIdx].max.clone(),S={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=y;R<x;R++){let L=e[R],k=this.polygonSegments[L.polygonSegmentIdx],B=this.centroidData[L.centroidIdx].min,Z=this.centroidData[L.centroidIdx].max,W=this.indexArray.uint16;for(let X=k.triangleArrayOffset;X<k.triangleArrayOffset+k.triangleCount;X++)n.emplaceBack(W[3*X],W[3*X+1],W[3*X+2]);S.primitiveLength+=k.triangleCount,I.x=Math.min(I.x,B.x),I.y=Math.min(I.y,B.y),M.x=Math.max(M.x,Z.x),M.y=Math.max(M.y,Z.y)}S.primitiveLength>0&&this.triangleSubSegments.push({segment:S,min:I,max:M}),y=x;for(let R=y;R<u&&e[R].subtile===e[y].subtile;R++)x++}s=u;for(let T=s;T<h&&e[T].triangleSegmentIdx===e[s].triangleSegmentIdx;T++)u++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,o){let s=new Zn;if(this.wallMode){for(let L of this.triangleSubSegments)s.segments.push(L.segment);return s}let u=0,h=0,m=1<<e.canonical.z;if(n){let L=n.getMinMaxForTile(e);L&&(u=L.min,h=L.max)}h+=this.maxHeight;let y=e.toUnwrapped(),x,T=[y.canonical.x/m+y.wrap,y.canonical.y/m],I=[(y.canonical.x+1)/m+y.wrap,(y.canonical.y+1)/m],M=(L,k,B)=>[L[0]*(1-B[0])+k[0]*B[0],L[1]*(1-B[1])+k[1]*B[1]],S=[],R=[];for(let L of this.triangleSubSegments){S[0]=L.min.x/Xe,S[1]=L.min.y/Xe,R[0]=L.max.x/Xe,R[1]=L.max.y/Xe;let k=M(T,I,S),B=M(T,I,R);if(new Gn([k[0],k[1],u],[B[0],B[1],h]).intersectsPrecise(o)===0){x&&(s.segments.push(x),x=void 0);continue}let Z=L.segment;x&&x.vertexOffset!==Z.vertexOffset&&(s.segments.push(x),x=void 0),x?(x.vertexLength+=Z.vertexLength,x.primitiveLength+=Z.primitiveLength):x={vertexOffset:Z.vertexOffset,primitiveLength:Z.primitiveLength,vertexLength:Z.vertexLength,primitiveOffset:Z.primitiveOffset,sortKey:void 0,vaos:{}}}return x&&s.segments.push(x),s}encodeCentroid(e,n){let o=e.centroid(),s=n.span(),u=Math.min(7,Math.round(s.x*this.tileToMeter/10)),h=Math.min(7,Math.round(s.y*this.tileToMeter/10));return new Je(jt(o.x,1,Xe-1)<<3|u,jt(o.y,1,Xe-1)<<3|h)}encodeBorderCentroid(e){if(!e.borders)return new Je(0,0);let n=e.borders,o=Number.MAX_VALUE;if(n[0][0]!==o||n[1][0]!==o){let s=n[0][0]!==o?0:1;return new Je(6|(n[0][0]!==o?0:65528),(n[s][0]+n[s][1])/2<<3|6)}{let s=n[2][0]!==o?2:3;return new Je((n[s][0]+n[s][1])/2<<3|6,6|(n[2][0]!==o?0:65528))}}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=cl,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,s=e.flags&cl?EE:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==s.y||u!==s.x){for(let h=n;h<o;++h)this.centroidVertexArray.emplace(h,s.x,s.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,o){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let s=n.getReplacementRegionsForTile(e.toUnwrapped());if(Pv(this.activeReplacements,s))return;if(this.activeReplacements=s,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let h of this.centroidData)h.flags&=2147483647;let u=[];for(let h of this.activeReplacements){if(h.order<o)continue;let m=Math.pow(2,h.footprintTileId.canonical.z-e.canonical.z);for(let y of this.centroidData)if(!(y.flags&cl||h.min.x>y.max.x||y.min.x>h.max.x||h.min.y>y.max.y||y.min.y>h.max.y))for(let x=0;x<y.footprintSegLen;x++){let T=this.footprintSegments[y.footprintSegIdx+x];if(u.length=0,oR(this.footprintVertices,T.vertexOffset,T.vertexCount,h.footprintTileId.canonical,e.canonical,u),dE(h.footprint,u,this.footprintIndices.uint16,T.indexOffset,T.indexCount,-T.vertexOffset,-m)){y.flags|=cl;break}}}for(let h of this.centroidData)this.writeCentroidToBuffer(h);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,o){let s=!1;for(let u=0;u<o.footprintSegLen;u++){let h=this.footprintSegments[o.footprintSegIdx+u],m=0;for(let y of h.ringIndices){for(let x=m,T=y+m-1;x<y+m;T=x++){let I=this.footprintVertices.int16[2*(x+h.vertexOffset)+0],M=this.footprintVertices.int16[2*(x+h.vertexOffset)+1],S=this.footprintVertices.int16[2*(T+h.vertexOffset)+1];M>n!=S>n&&e<(this.footprintVertices.int16[2*(T+h.vertexOffset)+0]-I)*(n-M)/(S-M)+I&&(s=!s)}m=y}}return s}getHeightAtTileCoord(e,n){let o=Number.NEGATIVE_INFINITY,s=!0,u=4*(e+Xe)*Xe+(n+Xe);if(this.partLookup.hasOwnProperty(u)){let h=this.partLookup[u];return h?{height:h.height,hidden:!!(h.flags&cl)}:void 0}for(let h of this.centroidData)e>h.max.x||h.min.x>e||n>h.max.y||h.min.y>n||this.footprintContainsPoint(e,n,h)&&h&&h.height>o&&(o=h.height,this.partLookup[u]=h,s=!!(h.flags&cl));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:s};this.partLookup[u]=void 0}}function AE(t,e){let n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function iR(t,e,n,o){let s=e.sub(t)._perp()._unit(),u=n.sub(e)._perp()._unit();return PE(t,e,n,AE(s,u),o)}function PE(t,e,n,o,s){let u=Math.sqrt(1-o*o);return Math.min(t.dist(e)/3,e.dist(n)/3,s*u/o)}function Rv(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function RE(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function OE(t,e,n){if(t.x<0||t.x>=Xe||e.x<0||e.x>=Xe||n.x<0||n.x>=Xe)return!1;let o=n.sub(e),s=o.perp(),u=t.sub(e);return(o.x*u.x+o.y*u.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(u.x*u.x+u.y*u.y))>-.866&&s.x*u.x+s.y*u.y<0}function LE(t,e,n){let o=e?2|t:-3&t;return n?1|o:-2&o}function kE(){let t=Math.PI/32,e=Math.tan(t),n=bh;return n*Math.sqrt(1+2*e*e)-n}function FE(t,e,n){let o=1<<n.z,s=Ei(n.x/o),u=Ei((n.x+1)/o),h=Dr(n.y/o),m=Dr((n.y+1)/o);return function(y,x,T,I,M=0,S){let R=[];if(!y.length||!T||!I)return R;let L=(ie,le)=>{for(let ge of ie)R.push({polygon:ge,bounds:le})},k=Math.ceil(Math.log2(T)),B=Math.ceil(Math.log2(I)),Z=k-B,W=[];for(let ie=0;ie<Math.abs(Z);ie++)W.push(Z>0?0:1);for(let ie=0;ie<Math.min(k,B);ie++)W.push(0),W.push(1);let X=y;if(X=Fg(X,x[0].y-M,x[1].y+M,1),X=Fg(X,x[0].x-M,x[1].x+M,0),!X.length)return R;let re=[];for(W.length?re.push({polygons:X,bounds:x,depth:0}):L(X,x);re.length;){let ie=re.pop(),le=ie.depth,ge=W[le],we=ie.bounds[0],Ce=ie.bounds[1],Te=ge===0?we.x:we.y,Oe=ge===0?Ce.x:Ce.y,$e=S?S(ge,Te,Oe):.5*(Te+Oe),Le=Fg(ie.polygons,Te-M,$e+M,ge),qe=Fg(ie.polygons,$e-M,Oe+M,ge);if(Le.length){let Re=[we,new Je(ge===0?$e:Ce.x,ge===1?$e:Ce.y)];W.length>le+1?re.push({polygons:Le,bounds:Re,depth:le+1}):L(Le,Re)}if(qe.length){let Re=[new Je(ge===0?$e:we.x,ge===1?$e:we.y),Ce];W.length>le+1?re.push({polygons:qe,bounds:Re,depth:le+1}):L(qe,Re)}}return R}(t,e,Math.ceil((u-s)/11.25),Math.ceil((h-m)/11.25),1,(y,x,T)=>{if(y===0)return .5*(x+T);{let I=Dr((n.y+x/Xe)/o);return(fs(.5*(Dr((n.y+T/Xe)/o)+I))*o-n.y)*Xe}})}function oR(t,e,n,o,s,u){let h=Math.pow(2,o.z-s.z);for(let m=0;m<n;m++){let y=t.int16[2*(m+e)+0],x=t.int16[2*(m+e)+1];y=(y+s.x*Xe)*h-o.x*Xe,x=(x+s.y*Xe)*h-o.y*Xe,u.push(new Je(y,x))}}let NE,zE;function Yf(t,e){return t.x*e.x+t.y*e.y}function BE(t,e){if(t.length===1){let n=0,o=e[n++],s;for(;!s||o.equals(s);)if(s=e[n++],!s)return 1/0;for(;n<e.length;n++){let u=e[n],h=t[0],m=s.sub(o),y=u.sub(o),x=h.sub(o),T=Yf(m,m),I=Yf(m,y),M=Yf(y,y),S=Yf(x,m),R=Yf(x,y),L=T*M-I*I,k=(M*S-I*R)/L,B=(T*R-I*S)/L,Z=o.z*(1-k-B)+s.z*k+u.z*B;if(isFinite(Z))return Z}return 1/0}{let n=1/0;for(let o of e)n=Math.min(n,o.z);return n}}function jE(t,e,n,o,s,u,h,m){let y=h*s.getElevationAt(t,e,!0,!0),x=u[0]!==0,T=x?u[1]===0?h*(u[0]/7-450):h*function(I,M,S){let R=Math.floor(M[0]/8),L=Math.floor(M[1]/8),k=10*(M[0]-8*R),B=10*(M[1]-8*L),Z=I.getElevationAt(R,L,!0,!0),W=I.getMeterToDEM(S),X=Math.floor(.5*(k*W-1)),re=Math.floor(.5*(B*W-1)),ie=I.tileCoordToPixel(R,L),le=2*X+1,ge=2*re+1,we=function(qe,Re,ze,Ze,ke){return[qe.getElevationAtPixel(Re,ze,!0),qe.getElevationAtPixel(Re+ke,ze,!0),qe.getElevationAtPixel(Re,ze+ke,!0),qe.getElevationAtPixel(Re+Ze,ze+ke,!0)]}(I,ie.x-X,ie.y-re,le,ge),Ce=Math.abs(we[0]-we[1]),Te=Math.abs(we[2]-we[3]),Oe=Math.abs(we[0]-we[2])+Math.abs(we[1]-we[3]),$e=Math.min(.25,.5*W*(Ce+Te)/le),Le=Math.min(.25,.5*W*Oe/ge);return Z+Math.max($e*k,Le*B)}(s,u,m):y;return{base:y+(n===0)?-1:n,top:x?Math.max(T+o,y+n+2):y+o}}me(Vg,"FillExtrusionBucket",{omit:["layers","features"]}),me(ME,"PartData"),me(IE,"FootprintSegment"),me(DE,"BorderCentroidData"),me(SE,"GroundEffect");let sR=mn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:aR}=sR,lR=mn([{name:"a_packed",components:4,type:"Float32"}]),{members:cR}=lR,uR=mn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:hR}=uR,dR=mn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),fR=mn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),pR=mn([{name:"a_projected_pos",components:4,type:"Float32"}],4);mn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let VE=mn([{name:"a_z_offset",components:1,type:"Float32"}],4),mR=mn([{name:"a_texb",components:2,type:"Uint16"}]),gR=mn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),_R=mn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);mn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let UE=mn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),yR=mn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);mn([{name:"triangle",components:3,type:"Uint16"}]),mn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),mn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),mn([{type:"Float32",name:"offsetX"}]),mn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class $E{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new al({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let o=this.getKey(e,n);return this.positions[o]}trim(){let e=this.width,n=this.height=zs(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,o){let s=[],u=e.length%2==1?-e[e.length-1]*o:0,h=e[0]*o,m=!0;s.push({left:u,right:h,isDash:m,zeroLength:e[0]===0});let y=e[0];for(let x=1;x<e.length;x++){m=!m;let T=e[x];u=y*o,y+=T,h=y*o,s.push({left:u,right:h,isDash:m,zeroLength:T===0})}return s}addRoundDash(e,n,o){let s=n/2;for(let u=-o;u<=o;u++){let h=this.width*(this.nextRow+o+u),m=0,y=e[m];for(let x=0;x<this.width;x++){x/y.right>1&&(y=e[++m]);let T=Math.abs(x-y.left),I=Math.abs(x-y.right),M=Math.min(T,I),S,R=u/o*(s+1);if(y.isDash){let L=s-Math.abs(R);S=Math.sqrt(M*M+L*L)}else S=s-Math.sqrt(M*M+R*R);this.image.data[h+x]=Math.max(0,Math.min(255,S+128))}}}addRegularDash(e,n){for(let y=e.length-1;y>=0;--y){let x=e[y],T=e[y+1];x.zeroLength?e.splice(y,1):T&&T.isDash===x.isDash&&(T.left=x.left,e.splice(y,1))}let o=e[0],s=e[e.length-1];o.isDash===s.isDash&&(o.left=s.left-this.width,s.right=o.right+this.width);let u=this.width*this.nextRow,h=0,m=e[h];for(let y=0;y<this.width;y++){y/m.right>1&&(m=e[++h]);let x=Math.abs(y-m.left),T=Math.abs(y-m.right),I=Math.min(x,T);this.image.data[u+y]=Math.max(0,Math.min(255,(m.isDash?I:-I)+n+128))}}addDash(e,n){let o=this.getKey(e,n);if(this.positions[o])return this.positions[o];let s=n==="round",u=s?7:0,h=2*u+1;if(this.nextRow+h>this.height)return rr("LineAtlas out of space"),null;e.length===0&&e.push(1);let m=0;for(let T=0;T<e.length;T++)e[T]<0&&(rr("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),m+=e[T];if(m!==0){let T=this.width/m,I=this.getDashRanges(e,this.width,T);s?this.addRoundDash(I,T,u):this.addRegularDash(I,n==="square"?.5*T:0)}let y=this.nextRow+u;this.nextRow+=h;let x={tl:[y,u],br:[m,0]};return this.positions[o]=x,x}}me($E,"LineAtlas");let vR=kg.types,xR=Math.cos(Math.PI/180*37.5),bR=Math.cos(Math.PI/180*5);class Ug{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new N0,this.layoutVertexArray2=new Ja,this.patternVertexArray=new el,this.indexArray=new vr,this.programConfigurations=new il(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Zn,this.maxLineLength=0,this.zOffsetVertexArray=new _h,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Xe/64}updateFootprints(e,n){}populate(e,n,o,s){this.hasPattern=Mv("line",this.layers,n);let u=this.layers[0].layout.get("line-sort-key"),h=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!h.isConstant()||!!h.constantOr(0);let m=[];for(let{feature:I,id:M,index:S,sourceLayerIndex:R}of e){let L=this.layers[0]._featureFilter.needGeometry,k=ta(I,L);if(!this.layers[0]._featureFilter.filter(new xt(this.zoom),k,o))continue;let B=u?u.evaluate(k,{},o):void 0,Z={id:M,properties:I.properties,type:I.type,sourceLayerIndex:R,index:S,geometry:L?k.geometry:Fo(I,o,s),patterns:{},sortKey:B};m.push(Z)}u&&m.sort((I,M)=>I.sortKey-M.sortKey);let{lineAtlas:y,featureIndex:x}=n,T=this.addConstantDashes(y);for(let I of m){let{geometry:M,index:S,sourceLayerIndex:R}=I;if(T&&this.addFeatureDashes(I,y),this.hasPattern){let L=Dv("line",this.layers,I,this.zoom,n);this.patternFeatures.push(L)}else this.addFeature(I,M,S,o,y.positions,n.availableImages,n.brightness);x.insert(e[S].feature,M,S,R,this.index)}}addConstantDashes(e){let n=!1;for(let o of this.layers){let s=o.paint.get("line-dasharray").value,u=o.layout.get("line-cap").value;if(s.kind!=="constant"||u.kind!=="constant")n=!0;else{let h=u.value,m=s.value;if(!m)continue;e.addDash(m,h)}}return n}addFeatureDashes(e,n){let o=this.zoom;for(let s of this.layers){let u=s.paint.get("line-dasharray").value,h=s.layout.get("line-cap").value;if(u.kind==="constant"&&h.kind==="constant")continue;let m,y;if(u.kind==="constant"){if(m=u.value,!m)continue}else m=u.evaluate({zoom:o},e);y=h.kind==="constant"?h.value:h.evaluate({zoom:o},e),n.addDash(m,y),e.patterns[s.id]=n.getKey(m,y)}}update(e,n,o,s,u){let h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,h?this.stateDependentLayers:this.layers,o,s,u)}addFeatures(e,n,o,s,u,h){for(let m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,n,o,s,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,cR)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,hR)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,VE.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,aR),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,s,u,h,m){let y=this.layers[0].layout,x=y.get("line-join").evaluate(e,{}),T=y.get("line-cap").evaluate(e,{}),I=y.get("line-miter-limit"),M=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let S of n)this.addLine(S,e,s,x,T,I,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,h,s,m)}addLine(e,n,o,s,u,h,m){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;let y={zoom:this.zoom,lineProgress:void 0},x=this.layers[0].layout,T=s==="none";if(this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<e.length-1;ie++)this.totalDistance+=e[ie].dist(e[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let I=vR[n.type]==="Polygon",M=e.length;for(;M>=2&&e[M-1].equals(e[M-2]);)M--;let S=0;for(;S<M-1&&e[S].equals(e[S+1]);)S++;if(M<(I?3:2))return;s==="bevel"&&(h=1.05);let R=this.overscaling<=16?15*Xe/(512*this.overscaling):0,L=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray),k,B,Z,W,X,re;this.e1=this.e2=-1,I&&(k=e[M-2],X=e[S].sub(k)._unit()._perp());for(let ie=S;ie<M;ie++){if(Z=ie===M-1?I?e[S+1]:void 0:e[ie+1],Z&&e[ie].equals(Z))continue;if(X&&(W=X),k&&(B=k),k=e[ie],this.hasZOffset){let Re=x.get("line-z-offset").value;if(Re.kind==="constant")re=Re.value;else{if(this.lineClips){let ze=this.totalDistance/(this.lineClips.end-this.lineClips.start);y.lineProgress=(ze*this.lineClips.start+this.distance+(B?B.dist(k):0))/ze}else rr(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),y.lineProgress=0;re=Re.evaluate(y,n)}re=re||0}X=Z?Z.sub(k)._unit()._perp():W,W=W||X;let le=B&&Z,ge=le?s:I||T?"butt":u,we=W.x*X.x+W.y*X.y;if(T){let Re=function(ze){if(ze.patternJoinNone){let Ze=ze.segmentPoints.length/2,ke=ze.lineSoFar-ze.segmentStart;for(let Qe=0;Qe<Ze;++Qe){let We=ze.segmentPoints[2*Qe+1],Ge=Math.round(ze.segmentPoints[2*Qe])+.5+.25*We;ze.patternVertexArray.emplaceBack(Ge,ke,ze.segmentStart),ze.patternVertexArray.emplaceBack(Ge,ke,ze.segmentStart)}ze.segmentPoints.length=0}ze.e1=ze.e2=-1};if(le&&we<bR){this.updateDistance(B,k),this.addCurrentVertex(k,W,1,1,L,re),Re(this),this.addCurrentVertex(k,X,-1,-1,L,re);continue}if(B){if(!Z){this.updateDistance(B,k),this.addCurrentVertex(k,W,1,1,L,re),Re(this);continue}ge="miter"}}let Ce=W.add(X);Ce.x===0&&Ce.y===0||Ce._unit();let Te=Ce.x*X.x+Ce.y*X.y,Oe=Te!==0?1/Te:1/0,$e=2*Math.sqrt(2-2*Te),Le=Te<xR&&B&&Z,qe=W.x*X.y-W.y*X.x>0;if(Le&&ie>S){let Re=k.dist(B);if(Re>2*R){let ze=k.sub(k.sub(B)._mult(R/Re)._round());this.updateDistance(B,ze),this.addCurrentVertex(ze,W,0,0,L,re),B=ze}}if(le&&ge==="round"&&(Oe<m?ge="miter":Oe<=2&&(ge="fakeround")),ge==="miter"&&Oe>h&&(ge="bevel"),ge==="bevel"&&(Oe>2&&(ge="flipbevel"),Oe<h&&(ge="miter")),B&&this.updateDistance(B,k),ge==="miter")Ce._mult(Oe),this.addCurrentVertex(k,Ce,0,0,L,re);else if(ge==="flipbevel"){if(Oe>100)Ce=X.mult(-1);else{let Re=Oe*W.add(X).mag()/W.sub(X).mag();Ce._perp()._mult(Re*(qe?-1:1))}this.addCurrentVertex(k,Ce,0,0,L,re),this.addCurrentVertex(k,Ce.mult(-1),0,0,L,re)}else if(ge==="bevel"||ge==="fakeround"){let Re=-Math.sqrt(Oe*Oe-1),ze=qe?Re:0,Ze=qe?0:Re;if(B&&this.addCurrentVertex(k,W,ze,Ze,L,re),ge==="fakeround"){let ke=Math.round(180*$e/Math.PI/20);for(let Qe=1;Qe<ke;Qe++){let We=Qe/ke;if(We!==.5){let ft=We-.5;We+=We*ft*(We-1)*((1.0904+we*(we*(3.55645-1.43519*we)-3.2452))*ft*ft+(.848013+we*(.215638*we-1.06021)))}let Ge=X.sub(W)._mult(We)._add(W)._unit()._mult(qe?-1:1);this.addHalfVertex(k,Ge.x,Ge.y,!1,qe,0,L,re)}}Z&&this.addCurrentVertex(k,X,-ze,-Ze,L,re)}else ge==="butt"?this.addCurrentVertex(k,Ce,0,0,L,re):ge==="square"?(B||this.addCurrentVertex(k,Ce,-1,-1,L,re),this.addCurrentVertex(k,Ce,0,0,L,re),B&&this.addCurrentVertex(k,Ce,1,1,L,re)):ge==="round"&&(B&&(this.addCurrentVertex(k,W,0,0,L,re),this.addCurrentVertex(k,W,1,1,L,re,!0)),Z&&(this.addCurrentVertex(k,X,-1,-1,L,re,!0),this.addCurrentVertex(k,X,0,0,L,re)));if(Le&&ie<M-1){let Re=k.dist(Z);if(Re>2*R){let ze=k.add(Z.sub(k)._mult(R/Re)._round());this.updateDistance(k,ze),this.addCurrentVertex(ze,X,0,0,L,re),k=ze}}}}addVerticesTo(e,n,o,s,u,h,m,y,x,T){let I=(n.w-e.w)/this.tessellationStep|0;if(I>1){this.lineSoFar=e.w;let M=(n.x-e.x)/I,S=(n.y-e.y)/I,R=(n.z-e.z)/I,L=(n.w-e.w)/I;for(let k=1;k<I;++k)e.x+=M,e.y+=S,e.z+=R,this.lineSoFar+=L,this.addHalfVertex(e,o,s,T,!1,m,x,e.z),this.addHalfVertex(e,u,h,T,!0,-y,x,e.z)}this.lineSoFar=n.w,this.addHalfVertex(n,o,s,T,!1,m,x,n.z),this.addHalfVertex(n,u,h,T,!0,-y,x,n.z)}addCurrentVertex(e,n,o,s,u,h,m=!1){let y=n.x+n.y*o,x=n.y-n.x*o,T=n.y*s-n.x,I=-n.y-n.x*s;if(h!=null){let S=Xe+10,R=h,L=new sE(e.x,e.y,R,this.lineSoFar),k=GE(e,-10,S),B=this.lineSoFar;if(this.currentVertex)if(k){let Z=this.currentVertexIsOutside,W=this.currentVertex,X=new sE(e.x,e.y,R,this.lineSoFar);lE(W,X,-10,S),GE(X,-10,S)||(Z&&(this.e1=this.e2=-1,this.lineSoFar=W.w,this.addHalfVertex(W,y,x,m,!1,o,u,W.z),this.addHalfVertex(W,T,I,m,!0,-s,u,W.z)),this.addVerticesTo(W,X,y,x,T,I,o,s,u,m))}else{let Z=this.currentVertex;this.currentVertexIsOutside&&(lE(Z,L,-10,S),this.e1=this.e2=-1,this.lineSoFar=Z.w,this.addHalfVertex(Z,y,x,m,!1,o,u,Z.z),this.addHalfVertex(Z,T,I,m,!0,-s,u,Z.z)),this.addVerticesTo(Z,L,y,x,T,I,o,s,u,m)}else k||(this.addHalfVertex(e,y,x,m,!1,o,u,h),this.addHalfVertex(e,T,I,m,!0,-s,u,h));this.currentVertex=L,this.currentVertexIsOutside=k,this.lineSoFar=B}else this.addHalfVertex(e,y,x,m,!1,o,u,h),this.addHalfVertex(e,T,I,m,!0,-s,u,h)}addHalfVertex({x:e,y:n},o,s,u,h,m,y,x){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),h||this.segmentPoints.push(this.lineSoFar-this.segmentStart,m)),this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(n<<1)+(h?1:0),Math.round(63*o)+128,Math.round(63*s)+128,1+(m===0?0:m<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let T=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),y.primitiveLength++),h?this.e2=T:this.e1=T,x!=null&&this.zOffsetVertexArray.emplaceBack(x)}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}function GE(t,e,n){return t.x<e||t.x>n||t.y<e||t.y>n}let HE,qE;function WE(t,e,n){return e*(Xe/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function ZE(t,e){return 1/WE(t,1,e.tileZoom)}function XE(t,e,n,o){return t.translatePosMatrix(o||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}me(Ug,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let YE=t=>{let e=[];QE(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=t.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let o=t.layout.get("line-join").constantOr("miter")==="none",s=!!t.paint.get("line-pattern").constantOr(1);return o&&s&&e.push("LINE_JOIN_NONE"),e};function QE(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class KE{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var wR={read:function(t,e,n,o,s){var u,h,m=8*s-o-1,y=(1<<m)-1,x=y>>1,T=-7,I=n?s-1:0,M=n?-1:1,S=t[e+I];for(I+=M,u=S&(1<<-T)-1,S>>=-T,T+=m;T>0;u=256*u+t[e+I],I+=M,T-=8);for(h=u&(1<<-T)-1,u>>=-T,T+=o;T>0;h=256*h+t[e+I],I+=M,T-=8);if(u===0)u=1-x;else{if(u===y)return h?NaN:1/0*(S?-1:1);h+=Math.pow(2,o),u-=x}return(S?-1:1)*h*Math.pow(2,u-o)},write:function(t,e,n,o,s,u){var h,m,y,x=8*u-s-1,T=(1<<x)-1,I=T>>1,M=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,S=o?0:u-1,R=o?1:-1,L=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,h=T):(h=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-h))<1&&(h--,y*=2),(e+=h+I>=1?M/y:M*Math.pow(2,1-I))*y>=2&&(h++,y/=2),h+I>=T?(m=0,h=T):h+I>=1?(m=(e*y-1)*Math.pow(2,s),h+=I):(m=e*Math.pow(2,I-1)*Math.pow(2,s),h=0));s>=8;t[n+S]=255&m,S+=R,m/=256,s-=8);for(h=h<<s|m,x+=s;x>0;t[n+S]=255&h,S+=R,h/=256,x-=8);t[n+S-R]|=128*L}},JE=Hn,$g=wR;function Hn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Hn.Varint=0,Hn.Fixed64=1,Hn.Bytes=2,Hn.Fixed32=5;var Ov=4294967296,eI=1/Ov,tI=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ia(t){return t.type===Hn.Bytes?t.readVarint()+t.pos:t.pos+1}function Ch(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function nI(t,e,n){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(var s=n.pos-1;s>=t;s--)n.buf[s+o]=n.buf[s]}function TR(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function ER(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function IR(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function MR(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function DR(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function CR(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function SR(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function AR(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function PR(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Gg(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Sh(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function rI(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Hn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),s=o>>3,u=this.pos;this.type=7&o,t(s,e,this),this.pos===u&&this.skip(o)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Gg(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=rI(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Gg(this.buf,this.pos)+Gg(this.buf,this.pos+4)*Ov;return this.pos+=8,t},readSFixed64:function(){var t=Gg(this.buf,this.pos)+rI(this.buf,this.pos+4)*Ov;return this.pos+=8,t},readFloat:function(){var t=$g.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=$g.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,o=this.buf;return e=127&(n=o[this.pos++]),n<128?e:(e|=(127&(n=o[this.pos++]))<<7,n<128?e:(e|=(127&(n=o[this.pos++]))<<14,n<128?e:(e|=(127&(n=o[this.pos++]))<<21,n<128?e:function(s,u,h){var m,y,x=h.buf;if(m=(112&(y=x[h.pos++]))>>4,y<128||(m|=(127&(y=x[h.pos++]))<<3,y<128)||(m|=(127&(y=x[h.pos++]))<<10,y<128)||(m|=(127&(y=x[h.pos++]))<<17,y<128)||(m|=(127&(y=x[h.pos++]))<<24,y<128)||(m|=(1&(y=x[h.pos++]))<<31,y<128))return Ch(s,m,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=o[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&tI?function(n,o,s){return tI.decode(n.subarray(o,s))}(this.buf,e,t):function(n,o,s){for(var u="",h=o;h<s;){var m,y,x,T=n[h],I=null,M=T>239?4:T>223?3:T>191?2:1;if(h+M>s)break;M===1?T<128&&(I=T):M===2?(192&(m=n[h+1]))==128&&(I=(31&T)<<6|63&m)<=127&&(I=null):M===3?(y=n[h+2],(192&(m=n[h+1]))==128&&(192&y)==128&&((I=(15&T)<<12|(63&m)<<6|63&y)<=2047||I>=55296&&I<=57343)&&(I=null)):M===4&&(y=n[h+2],x=n[h+3],(192&(m=n[h+1]))==128&&(192&y)==128&&(192&x)==128&&((I=(15&T)<<18|(63&m)<<12|(63&y)<<6|63&x)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,M=1):I>65535&&(I-=65536,u+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),u+=String.fromCharCode(I),h+=M}return u}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Hn.Bytes)return t.push(this.readVarint(e));var n=ia(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Hn.Bytes)return t.push(this.readSVarint());var e=ia(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Hn.Bytes)return t.push(this.readBoolean());var e=ia(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Hn.Bytes)return t.push(this.readFloat());var e=ia(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Hn.Bytes)return t.push(this.readDouble());var e=ia(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Hn.Bytes)return t.push(this.readFixed32());var e=ia(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Hn.Bytes)return t.push(this.readSFixed32());var e=ia(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Hn.Bytes)return t.push(this.readFixed64());var e=ia(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Hn.Bytes)return t.push(this.readSFixed64());var e=ia(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Hn.Varint)for(;this.buf[this.pos++]>127;);else if(e===Hn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Hn.Fixed32)this.pos+=4;else{if(e!==Hn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Sh(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Sh(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Sh(this.buf,-1&t,this.pos),Sh(this.buf,Math.floor(t*eI),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Sh(this.buf,-1&t,this.pos),Sh(this.buf,Math.floor(t*eI),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var o,s;if(e>=0?(o=e%4294967296|0,s=e/4294967296|0):(s=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,s=s+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(u,h,m){m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,m.buf[m.pos]=127&(u>>>=7)}(o,0,n),function(u,h){var m=(7&u)<<4;h.buf[h.pos++]|=m|((u>>>=3)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u)))))}(s,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(o,s,u){for(var h,m,y=0;y<s.length;y++){if((h=s.charCodeAt(y))>55295&&h<57344){if(!m){h>56319||y+1===s.length?(o[u++]=239,o[u++]=191,o[u++]=189):m=h;continue}if(h<56320){o[u++]=239,o[u++]=191,o[u++]=189,m=h;continue}h=m-55296<<10|h-56320|65536,m=null}else m&&(o[u++]=239,o[u++]=191,o[u++]=189,m=null);h<128?o[u++]=h:(h<2048?o[u++]=h>>6|192:(h<65536?o[u++]=h>>12|224:(o[u++]=h>>18|240,o[u++]=h>>12&63|128),o[u++]=h>>6&63|128),o[u++]=63&h|128)}return u}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&nI(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),$g.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),$g.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var o=this.pos-n;o>=128&&nI(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(t,e,n){this.writeTag(t,Hn.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,TR,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,ER,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,DR,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,IR,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,MR,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,CR,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,SR,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,AR,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,PR,e)},writeBytesField:function(t,e){this.writeTag(t,Hn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Hn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Hn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Hn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Hn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Hn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Hn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Hn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Hn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Hn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Qf=Ft(JE);let RR=["id","tile","layer","source","sourceLayer","state"];class iI{constructor(e,n,o,s,u){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=o,this._y=s,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let n of RR)this[n]!==void 0&&(e[n]=this[n]);return e}}class OR{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,o){let s=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][s]=this.stateChanges[e][s]||{},Rr(this.stateChanges[e][s],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(let u in this.state[e])u!==s&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][s]===null){this.deletedStates[e][s]={};for(let u in this.state[e][s])o[u]||(this.deletedStates[e][s][u]=null)}else for(let u in o)this.deletedStates[e]&&this.deletedStates[e][s]&&this.deletedStates[e][s][u]===null&&delete this.deletedStates[e][s][u]}removeFeatureState(e,n,o){if(this.deletedStates[e]===null)return;let s=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&n!==void 0)this.deletedStates[e][s]!==null&&(this.deletedStates[e][s]=this.deletedStates[e][s]||{},this.deletedStates[e][s][o]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][s])for(o in this.deletedStates[e][s]={},this.stateChanges[e][s])this.deletedStates[e][s][o]=null;else this.deletedStates[e][s]=null;else this.deletedStates[e]=null}getState(e,n){let o=String(n),s=Rr({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let u=this.deletedStates[e][n];if(u===null)return{};for(let h in u)delete s[h]}return s}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let o={};for(let s in this.stateChanges){this.state[s]=this.state[s]||{};let u={};for(let h in this.stateChanges[s])this.state[s][h]||(this.state[s][h]={}),Rr(this.state[s][h],this.stateChanges[s][h]),u[h]=this.state[s][h];o[s]=u}for(let s in this.deletedStates){this.state[s]=this.state[s]||{};let u={};if(this.deletedStates[s]===null)for(let h in this.state[s])u[h]={},this.state[s][h]={};else for(let h in this.deletedStates[s]){if(this.deletedStates[s][h]===null)this.state[s][h]={};else if(this.state[s][h])for(let m of Object.keys(this.deletedStates[s][h]))delete this.state[s][h][m];u[h]=this.state[s][h]}o[s]=o[s]||{},Rr(o[s],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(let s in e)e[s].setFeatureState(o,n)}}class oI{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Me(Xe,16,0),this.featureIndexArray=new eT,this.promoteId=n,this.is3DTile=!1}insert(e,n,o,s,u,h=0,m=0){let y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,s,u,h);let x=this.grid;for(let T=0;T<n.length;T++){let I=n[T],M=[1/0,1/0,-1/0,-1/0];for(let S=0;S<I.length;S++){let R=I[S];M[0]=Math.min(M[0],R.x),M[1]=Math.min(M[1],R.y),M[2]=Math.max(M[2],R.x),M[3]=Math.max(M[3],R.y)}m!==0&&(M[0]-=m,M[1]-=m,M[2]+=m,M[3]+=m),M[0]<Xe&&M[1]<Xe&&M[2]>=0&&M[3]>=0&&x.insert(y,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Sv(new Qf(this.rawTileData)).layers,this.sourceLayerCoder=new KE(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,o,s){this.loadVTLayers();let u=e.params||{},h=Oo(u.filter),m=e.tileResult,y=e.transform,x=m.bufferedTilespaceBounds,T=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(R,L,k,B)=>vT(m.bufferedTilespaceGeometry,R,L,k,B));T.sort(LR);let I=null;y.elevation&&T.length>0&&(I=Dh.create(y.elevation,this.tileID));let M={},S;for(let R=0;R<T.length;R++){let L=T[R];if(L===S)continue;S=L;let k=this.featureIndexArray.get(L),B=null;if(this.is3DTile){let Z=this.bucketLayerIDs[0][0],W=n[Z];if(W.type!=="model")continue;let{queryFeature:X,intersectionZ:re}=W.queryIntersectsMatchingFeature(m,k.featureIndex,h,y);X&&this.appendToResult(M,Z,k.featureIndex,X,re)}else this.loadMatchingFeature(M,k,h,u.layers,u.availableImages,n,o,s,(Z,W,X,re=0)=>(B||(B=Fo(Z,this.tileID.canonical,e.tileTransform)),W.queryIntersectsFeature(m,Z,X,B,this.z,e.transform,e.pixelPosMatrix,I,re)))}return M}loadMatchingFeature(e,n,o,s,u,h,m,y,x){let{featureIndex:T,bucketIndex:I,sourceLayerIndex:M,layoutVertexArrayOffset:S}=n,R=this.bucketLayerIDs[I];if(s&&!function(Z,W){for(let X=0;X<Z.length;X++)if(W.indexOf(Z[X])>=0)return!0;return!1}(s,R))return;let L=this.sourceLayerCoder.decode(M),k=this.vtLayers[L].feature(T);if(o.needGeometry){let Z=ta(k,!0);if(!o.filter(new xt(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!o.filter(new xt(this.tileID.overscaledZ),k))return;let B=this.getId(k,L);for(let Z=0;Z<R.length;Z++){let W=R[Z];if(s&&s.indexOf(W)<0)continue;let X=h[W];if(!X)continue;let re={};B!==void 0&&y&&(re=y.getState(X.sourceLayer||"_geojsonTileLayer",B));let ie=!x||x(k,X,re,S);if(!ie)continue;let le=new iI(k,this.z,this.x,this.y,B),ge=Rr({},m[W]);ge.paint=sI(ge.paint,X.paint,k,re,u),ge.layout=sI(ge.layout,X.layout,k,re,u),le.layer=ge,this.appendToResult(e,W,T,le,ie)}}appendToResult(e,n,o,s,u){let h=e[n];h===void 0&&(h=e[n]=[]),h.push({featureIndex:o,feature:s,intersectionZ:u})}lookupSymbolFeatures(e,n,o,s,u,h,m,y){let x={};this.loadVTLayers();let T=Oo(u);for(let I of e)this.loadMatchingFeature(x,{bucketIndex:o,sourceLayerIndex:s,featureIndex:I,layoutVertexArrayOffset:0},T,h,m,y,n);return x}loadFeature(e){let{featureIndex:n,sourceLayerIndex:o}=e;this.loadVTLayers();let s=this.sourceLayerCoder.decode(o),u=this.vtFeatures[s];if(u[n])return u[n];let h=this.vtLayers[s].feature(n);return u[n]=h,h}hasLayer(e){for(let n of this.bucketLayerIDs)for(let o of n)if(e===o)return!0;return!1}getId(e,n){let o=e.id;if(this.promoteId){let s=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];s!=null&&(o=e.properties[s]),typeof o=="boolean"&&(o=Number(o))}return o}}function sI(t,e,n,o,s){return Ql(t,(u,h)=>{let m=e instanceof Mr?e.get(h):null;return m&&m.evaluate?m.evaluate(n,o,s):m})}function LR(t,e){return e-t}me(oI,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var Vr=24;let No=128;function Lv(t,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new xt(t+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:o,interpolationType:s}=n,u=0;for(;u<o.length&&o[u]<=t;)u++;u=Math.max(0,u-1);let h=u;for(;h<o.length&&o[h]<t+1;)h++;h=Math.min(o.length-1,h);let m=o[u],y=o[h];return n.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:y,interpolationType:s}:{kind:"camera",minZoom:m,maxZoom:y,minSize:n.evaluate(new xt(m)),maxSize:n.evaluate(new xt(y)),interpolationType:s}}}function Hg(t,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:s}){return t.kind==="source"?o/No:t.kind==="composite"?gt(o/No,s/No,n):e}function Ah(t,e){let n=0,o=0;if(t.kind==="constant")o=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:s,minZoom:u,maxZoom:h}=t,m=s?jt(wi.interpolationFactor(s,e,u,h),0,1):0;t.kind==="camera"?o=gt(t.minSize,t.maxSize,m):n=m}return{uSizeT:n,uSize:o}}var kR=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:No,evaluateSizeForFeature:Hg,evaluateSizeForZoom:Ah,getSizeData:Lv});function FR(t,e,n){return t.sections.forEach(o=>{o.text=function(s,u,h){let m=u.layout.get("text-transform").evaluate(h,{});return m==="uppercase"?s=s.toLocaleUpperCase():m==="lowercase"&&(s=s.toLocaleLowerCase()),Ut.applyArabicShaping&&(s=Ut.applyArabicShaping(s)),s}(o.text,e,n)}),t}let Kf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function NR(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function zR(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}let kv=3;function BR(t,e,n){e.glyphs=[],t===1&&n.readMessage(jR,e)}function jR(t,e,n){if(t===3){let{id:o,bitmap:s,width:u,height:h,left:m,top:y,advance:x}=n.readMessage(VR,{});e.glyphs.push({id:o,bitmap:new al({width:u+2*kv,height:h+2*kv},s),metrics:{width:u,height:h,left:m,top:y,advance:x}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function VR(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}let aI=kv,Ki={horizontal:1,vertical:2,horizontalOnly:3};class Jf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let o=new Jf;return o.scale=e||1,o.fontStack=n,o}static forImage(e){let n=new Jf;return n.imageName=e,n}}class Ph{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let o=new Ph;for(let s=0;s<e.sections.length;s++){let u=e.sections[s];u.image?o.addImageSection(u):o.addTextSection(u,n)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,o){let s="";for(let u=0;u<n.length;u++){let h=n.charCodeAt(u+1)||null,m=n.charCodeAt(u-1)||null;s+=!o&&(h&&at(h)&&!Kf[n[u+1]]||m&&at(m)&&!Kf[n[u-1]])||!Kf[n[u]]?n[u]:Kf[n[u]]}return s}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&qg[this.text.charCodeAt(o)];o++)e++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&qg[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let o=new Ph;return o.text=this.text.substring(e,n),o.sectionIndex=this.sectionIndex.slice(e,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Jf.forText(e.scale,e.fontStack||n));let o=this.sections.length-1;for(let s=0;s<e.text.length;++s)this.sectionIndex.push(o)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void rr("Can't add FormattedSection with an empty image.");let o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(Jf.forImage(n)),this.sectionIndex.push(this.sections.length-1)):rr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Fv(t,e,n,o,s,u,h,m,y,x,T,I,M,S,R){let L=Ph.fromFeature(t,s);I===Ki.vertical&&L.verticalizePunctuation(M);let k=[],B=function(ie,le,ge,we,Ce,Te){if(!ie)return[];let Oe=[],$e=function(ze,Ze,ke,Qe,We,Ge){let ft=0;for(let ht=0;ht<ze.length();ht++){let ot=ze.getSection(ht);ft+=lI(ze.getCodePoint(ht),ot,Qe,We,Ze,Ge)}return ft/Math.max(1,Math.ceil(ft/ke))}(ie,le,ge,we,Ce,Te),Le=ie.text.indexOf("\u200B")>=0,qe=0;for(let ze=0;ze<ie.length();ze++){let Ze=ie.getSection(ze),ke=ie.getCodePoint(ze);if(qg[ke]||(qe+=lI(ke,Ze,we,Ce,le,Te)),ze<ie.length()-1){let Qe=!((Re=ke)<11904||!(fe["Bopomofo Extended"](Re)||fe.Bopomofo(Re)||fe["CJK Compatibility Forms"](Re)||fe["CJK Compatibility Ideographs"](Re)||fe["CJK Compatibility"](Re)||fe["CJK Radicals Supplement"](Re)||fe["CJK Strokes"](Re)||fe["CJK Symbols and Punctuation"](Re)||fe["CJK Unified Ideographs Extension A"](Re)||fe["CJK Unified Ideographs"](Re)||fe["Enclosed CJK Letters and Months"](Re)||fe["Halfwidth and Fullwidth Forms"](Re)||fe.Hiragana(Re)||fe["Ideographic Description Characters"](Re)||fe["Kangxi Radicals"](Re)||fe["Katakana Phonetic Extensions"](Re)||fe.Katakana(Re)||fe["Vertical Forms"](Re)||fe["Yi Radicals"](Re)||fe["Yi Syllables"](Re)));(UR[ke]||Qe||Ze.imageName)&&Oe.push(uI(ze+1,qe,$e,Oe,$R(ke,ie.getCodePoint(ze+1),Qe&&Le),!1))}}var Re;return hI(uI(ie.length(),qe,$e,Oe,0,!0))}(L,x,u,e,o,S),{processBidirectionalText:Z,processStyledBidirectionalText:W}=Ut;if(Z&&L.sections.length===1){let ie=Z(L.toString(),B);for(let le of ie){let ge=new Ph;ge.text=le,ge.sections=L.sections;for(let we=0;we<le.length;we++)ge.sectionIndex.push(0);k.push(ge)}}else if(W){let ie=W(L.text,L.sectionIndex,B);for(let le of ie){let ge=new Ph;ge.text=le[0],ge.sectionIndex=le[1],ge.sections=L.sections,k.push(ge)}}else k=function(ie,le){let ge=[],we=ie.text,Ce=0;for(let Te of le)ge.push(ie.substring(Ce,Te)),Ce=Te;return Ce<we.length&&ge.push(ie.substring(Ce,we.length)),ge}(L,B);let X=[],re={positionedLines:X,text:L.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ie,le,ge,we,Ce,Te,Oe,$e,Le,qe,Re,ze){let Ze=0,ke=0,Qe=0,We=$e==="right"?1:$e==="left"?0:.5,Ge=!1;for(let dt of Ce){let lt=dt.getSections();for(let Et of lt){if(Et.imageName)continue;let Ct=le[Et.fontStack];if(Ct&&(Ge=Ct.ascender!==void 0&&Ct.descender!==void 0,!Ge))break}if(!Ge)break}let ft=0;for(let dt of Ce){dt.trim();let lt=dt.getMaxScale(),Et=(lt-1)*Vr,Ct={positionedGlyphs:[],lineOffset:0};ie.positionedLines[ft]=Ct;let It=Ct.positionedGlyphs,Nt=0;if(!dt.length()){ke+=Te,++ft;continue}let Zt=0,$t=0;for(let On=0;On<dt.length();On++){let St=dt.getSection(On),gn=dt.getSectionIndex(On),xn=dt.getCodePoint(On),zn=St.scale,Kn=null,lr=null,Jn=null,Yn=Vr,xr=0,hr=!(Le===Ki.horizontal||!Re&&!et(xn)||Re&&(qg[xn]||(ht=xn,fe.Arabic(ht)||fe["Arabic Supplement"](ht)||fe["Arabic Extended-A"](ht)||fe["Arabic Presentation Forms-A"](ht)||fe["Arabic Presentation Forms-B"](ht))));if(St.imageName){let Ur=we[St.imageName];if(!Ur)continue;Jn=St.imageName,ie.iconsInText=ie.iconsInText||!0,lr=Ur.paddedRect;let Fn=Ur.displaySize;zn=zn*Vr/ze,Kn={width:Fn[0],height:Fn[1],left:0,top:-aI,advance:hr?Fn[1]:Fn[0],localGlyph:!1},xr=Ge?-Kn.height*zn:lt*Vr-17-Fn[1]*zn,Yn=Kn.advance;let Ii=(hr?Fn[0]:Fn[1])*zn-Vr*lt;Ii>0&&Ii>Nt&&(Nt=Ii)}else{let Ur=ge[St.fontStack];if(!Ur)continue;Ur[xn]&&(lr=Ur[xn]);let Fn=le[St.fontStack];if(!Fn)continue;let Ii=Fn.glyphs[xn];if(!Ii)continue;if(Kn=Ii.metrics,Yn=xn!==8203?Vr:0,Ge){let $o=Fn.ascender!==void 0?Math.abs(Fn.ascender):0,yo=Fn.descender!==void 0?Math.abs(Fn.descender):0,vo=($o+yo)*zn;Zt<vo&&(Zt=vo,$t=($o-yo)/2*zn),xr=-$o*zn}else xr=(lt-zn)*Vr-17}hr?(ie.verticalizable=!0,It.push({glyph:xn,imageName:Jn,x:Ze,y:ke+xr,vertical:hr,scale:zn,localGlyph:Kn.localGlyph,fontStack:St.fontStack,sectionIndex:gn,metrics:Kn,rect:lr}),Ze+=Yn*zn+qe):(It.push({glyph:xn,imageName:Jn,x:Ze,y:ke+xr,vertical:hr,scale:zn,localGlyph:Kn.localGlyph,fontStack:St.fontStack,sectionIndex:gn,metrics:Kn,rect:lr}),Ze+=Kn.advance*zn+qe)}It.length!==0&&(Qe=Math.max(Ze-qe,Qe),Ge?dI(It,We,Nt,$t,Te*lt/2):dI(It,We,Nt,0,Te/2)),Ze=0;let Cn=Te*lt+Nt;Ct.lineOffset=Math.max(Nt,Et),ke+=Cn,++ft}var ht;let ot=ke,{horizontalAlign:Ye,verticalAlign:vt}=Nv(Oe);(function(dt,lt,Et,Ct,It,Nt){let Zt=(lt-Et)*It,$t=-Nt*Ct;for(let Cn of dt)for(let On of Cn.positionedGlyphs)On.x+=Zt,On.y+=$t})(ie.positionedLines,We,Ye,vt,Qe,ot),ie.top+=-vt*ot,ie.bottom=ie.top+ot,ie.left+=-Ye*Qe,ie.right=ie.left+Qe,ie.hasBaseline=Ge}(re,e,n,o,k,h,m,y,I,x,M,R),!function(ie){for(let le of ie)if(le.positionedGlyphs.length!==0)return!1;return!0}(X)&&re}let qg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},UR={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function lI(t,e,n,o,s,u){if(e.imageName){let h=o[e.imageName];return h?h.displaySize[0]*e.scale*Vr/u+s:0}{let h=n[e.fontStack],m=h&&h.glyphs[t];return m?m.metrics.advance*e.scale+s:0}}function cI(t,e,n,o){let s=Math.pow(t-e,2);return o?t<e?s/2:2*s:s+Math.abs(n)*n}function $R(t,e,n){let o=0;return t===10&&(o-=1e4),n&&(o+=150),t!==40&&t!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function uI(t,e,n,o,s,u){let h=null,m=cI(e,n,s,u);for(let y of o){let x=cI(e-y.x,n,s,u)+y.badness;x<=m&&(h=y,m=x)}return{index:t,x:e,priorBreak:h,badness:m}}function hI(t){return t?hI(t.priorBreak).concat(t.index):[]}function Nv(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function dI(t,e,n,o,s){if(!(e||n||o||s))return;let u=t.length-1,h=t[u],m=(h.x+h.metrics.advance*h.scale)*e;for(let y=0;y<=u;y++)t[y].x-=m,t[y].y+=n+o+s}function GR(t,e,n,o){let{horizontalAlign:s,verticalAlign:u}=Nv(o),h=n[0]-t.displaySize[0]*s,m=n[1]-t.displaySize[1]*u;return{imagePrimary:t,imageSecondary:e,top:m,bottom:m+t.displaySize[1],left:h,right:h+t.displaySize[0]}}function fI(t,e,n,o,s,u){let h=t.imagePrimary,m;if(h.content){let k=h.content,B=h.pixelRatio||1;m=[k[0]/B,k[1]/B,h.displaySize[0]-k[2]/B,h.displaySize[1]-k[3]/B]}let y=e.left*u,x=e.right*u,T,I,M,S;n==="width"||n==="both"?(S=s[0]+y-o[3],I=s[0]+x+o[1]):(S=s[0]+(y+x-h.displaySize[0])/2,I=S+h.displaySize[0]);let R=e.top*u,L=e.bottom*u;return n==="height"||n==="both"?(T=s[1]+R-o[0],M=s[1]+L+o[2]):(T=s[1]+(R+L-h.displaySize[1])/2,M=T+h.displaySize[1]),{imagePrimary:h,imageSecondary:void 0,top:T,right:I,bottom:M,left:S,collisionPadding:m}}class oa extends Je{constructor(e,n,o,s,u){super(e,n),this.angle=s,this.z=o,u!==void 0&&(this.segment=u)}clone(){return new oa(this.x,this.y,this.z,this.angle,this.segment)}}function pI(t,e,n,o,s){if(e.segment===void 0)return!0;let u=e,h=e.segment+1,m=0;for(;m>-n/2;){if(h--,h<0)return!1;m-=t[h].dist(u),u=t[h]}m+=t[h].dist(t[h+1]),h++;let y=[],x=0;for(;m<n/2;){let T=t[h],I=t[h+1];if(!I)return!1;let M=t[h-1].angleTo(T)-T.angleTo(I);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:m,angleDelta:M}),x+=M;m-y[0].distance>o;)x-=y.shift().angleDelta;if(x>s)return!1;h++,m+=T.dist(I)}return!0}function mI(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function gI(t,e,n){return t?.6*e*n:0}function _I(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function HR(t,e,n,o,s,u){let h=gI(n,s,u),m=_I(n,o)*u,y=0,x=mI(t)/2;for(let T=0;T<t.length-1;T++){let I=t[T],M=t[T+1],S=I.dist(M);if(y+S>x){let R=(x-y)/S,L=gt(I.x,M.x,R),k=gt(I.y,M.y,R),B=new oa(L,k,0,M.angleTo(I),T);return!h||pI(t,B,m,h,e)?B:void 0}y+=S}}function qR(t,e,n,o,s,u,h,m,y){let x=gI(o,u,h),T=_I(o,s),I=T*h,M=t[0].x===0||t[0].x===y||t[0].y===0||t[0].y===y;return e-I<e/4&&(e=I+e/4),yI(t,M?e/2*m%e:(T/2+2*u)*h*m%e,e,x,n,I,M,!1,y)}function yI(t,e,n,o,s,u,h,m,y){let x=u/2,T=mI(t),I=0,M=e-n,S=[];for(let R=0;R<t.length-1;R++){let L=t[R],k=t[R+1],B=L.dist(k),Z=k.angleTo(L);for(;M+n<I+B;){M+=n;let W=(M-I)/B,X=gt(L.x,k.x,W),re=gt(L.y,k.y,W);if(X>=0&&X<y&&re>=0&&re<y&&M-x>=0&&M+x<=T){let ie=new oa(X,re,0,Z,R);o&&!pI(t,ie,u,o,s)||S.push(ie)}}I+=B}return m||S.length||h||(S=yI(t,I/2,n,o,s,u,h,!0,y)),S}function vI(t,e,n,o,s){let u=[];for(let h=0;h<t.length;h++){let m=t[h],y;for(let x=0;x<m.length-1;x++){let T=m[x],I=m[x+1];T.x<e&&I.x<e||(T.x<e?T=new Je(e,T.y+(e-T.x)/(I.x-T.x)*(I.y-T.y))._round():I.x<e&&(I=new Je(e,T.y+(e-T.x)/(I.x-T.x)*(I.y-T.y))._round()),T.y<n&&I.y<n||(T.y<n?T=new Je(T.x+(n-T.y)/(I.y-T.y)*(I.x-T.x),n)._round():I.y<n&&(I=new Je(T.x+(n-T.y)/(I.y-T.y)*(I.x-T.x),n)._round()),T.x>=o&&I.x>=o||(T.x>=o?T=new Je(o,T.y+(o-T.x)/(I.x-T.x)*(I.y-T.y))._round():I.x>=o&&(I=new Je(o,T.y+(o-T.x)/(I.x-T.x)*(I.y-T.y))._round()),T.y>=s&&I.y>=s||(T.y>=s?T=new Je(T.x+(s-T.y)/(I.y-T.y)*(I.x-T.x),s)._round():I.y>=s&&(I=new Je(T.x+(s-T.y)/(I.y-T.y)*(I.x-T.x),s)._round()),y&&T.equals(y[y.length-1])||(y=[T],u.push(y)),y.push(I)))))}}return u}function xI(t){let e=0,n=0;for(let h of t)e+=h.w*h.h,n=Math.max(n,h.w);t.sort((h,m)=>m.h-h.h);let o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],s=0,u=0;for(let h of t)for(let m=o.length-1;m>=0;m--){let y=o[m];if(!(h.w>y.w||h.h>y.h)){if(h.x=y.x,h.y=y.y,u=Math.max(u,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===y.w&&h.h===y.h){let x=o.pop();m<o.length&&(o[m]=x)}else h.h===y.h?(y.x+=h.w,y.w-=h.w):h.w===y.w?(y.y+=h.h,y.h-=h.h):(o.push({x:y.x+h.w,y:y.y,w:y.w-h.w,h:h.h}),y.y+=h.h,y.h-=h.h);break}}return{w:s,h:u,fill:e/(s*u)||0}}me(oa,"Anchor");let Ni=1;class zv{constructor(e,{pixelRatio:n,version:o,stretchX:s,stretchY:u,content:h}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=s,this.stretchY=u,this.content=h,this.version=o}get tl(){return[this.paddedRect.x+Ni,this.paddedRect.y+Ni]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ni,this.paddedRect.y+this.paddedRect.h-Ni]}get displaySize(){return[(this.paddedRect.w-2*Ni)/this.pixelRatio,(this.paddedRect.h-2*Ni)/this.pixelRatio]}}class bI{constructor(e,n,o){let s={},u={};this.haveRenderCallbacks=[];let h=[];this.addImages(e,s,h),this.addImages(n,u,h);let{w:m,h:y}=xI(h),x=new Qi({width:m||1,height:y||1});for(let T in e){let I=e[T],M=s[T].paddedRect;Qi.copy(I.data,x,{x:0,y:0},{x:M.x+Ni,y:M.y+Ni},I.data,o,I.sdf)}for(let T in n){let I=n[T],M=u[T].paddedRect,S=M.x+Ni,R=M.y+Ni,L=I.data.width,k=I.data.height;Qi.copy(I.data,x,{x:0,y:0},{x:S,y:R},I.data,o),Qi.copy(I.data,x,{x:0,y:k-1},{x:S,y:R-1},{width:L,height:1},o),Qi.copy(I.data,x,{x:0,y:0},{x:S,y:R+k},{width:L,height:1},o),Qi.copy(I.data,x,{x:L-1,y:0},{x:S-1,y:R},{width:1,height:k},o),Qi.copy(I.data,x,{x:0,y:0},{x:S+L,y:R},{width:1,height:k},o)}this.image=x,this.iconPositions=s,this.patternPositions=u}addImages(e,n,o){for(let s in e){let u=e[s],h={x:0,y:0,w:u.data.width+2*Ni,h:u.data.height+2*Ni};o.push(h),n[s]=new zv(h,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(s)}}patchUpdatedImages(e,n,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(let s in e.getUpdatedImages(o))this.patchUpdatedImage(this.iconPositions[s],e.getImage(s,o),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s,o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;let[s,u]=e.tl,h=!!Object.keys(this.patternPositions).length;o.update(n.data,{useMipmap:h},{x:s,y:u})}}me(zv,"ImagePosition"),me(bI,"ImageAtlas");let ep=1e20;function wI(t,e,n,o,s,u,h,m,y){for(let x=e;x<e+o;x++)TI(t,n*u+x,u,s,h,m,y);for(let x=n;x<n+s;x++)TI(t,x*u+e,1,o,h,m,y)}function TI(t,e,n,o,s,u,h){u[0]=0,h[0]=-ep,h[1]=ep,s[0]=t[e];for(let m=1,y=0,x=0;m<o;m++){s[m]=t[e+m*n];let T=m*m;do{let I=u[y];x=(s[m]-s[I]+T-I*I)/(m-I)/2}while(x<=h[y]&&--y>-1);y++,u[y]=m,h[y]=x,h[y+1]=ep}for(let m=0,y=0;m<o;m++){for(;h[y+1]<m;)y++;let x=u[y],T=m-x;t[e+m*n]=s[x]+T*T}}let zo=2,Bv={none:0,ideographs:1,all:2};class Rh{constructor(e,n,o){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,o){let s=[],u=this.urls[n]||V.GLYPHS_URL;for(let h in e)for(let m of e[h])s.push({stack:h,id:m});Xl(s,({stack:h,id:m},y)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=x.glyphs[m];if(T!==void 0)return void y(null,{stack:h,id:m,glyph:T});if(T=this._tinySDF(x,h,m),T)return x.glyphs[m]=T,void y(null,{stack:h,id:m,glyph:T});let I=Math.floor(m/256);if(256*I>65535)return void y(new Error("glyphs > 65535 not supported"));if(x.ranges[I])return void y(null,{stack:h,id:m,glyph:T});let M=x.requests[I];M||(M=x.requests[I]=[],Rh.loadGlyphRange(h,I,u,this.requestManager,(S,R)=>{if(R){x.ascender=R.ascender,x.descender=R.descender;for(let L in R.glyphs)this._doesCharSupportLocalGlyph(+L)||(x.glyphs[+L]=R.glyphs[+L]);x.ranges[I]=!0}for(let L of M)L(S,R);delete x.requests[I]})),M.push((S,R)=>{S?y(S):R&&y(null,{stack:h,id:m,glyph:R.glyphs[m]||null})})},(h,m)=>{if(h)o(h);else if(m){let y={};for(let{stack:x,id:T,glyph:I}of m)y[x]===void 0&&(y[x]={}),y[x].glyphs===void 0&&(y[x].glyphs={}),y[x].glyphs[T]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},y[x].ascender=this.entries[x].ascender,y[x].descender=this.entries[x].descender;o(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Bv.none&&(this.localGlyphMode===Bv.all?!!this.localFontFamily:!!this.localFontFamily&&(fe["CJK Unified Ideographs"](e)||fe["Hangul Syllables"](e)||fe.Hiragana(e)||fe.Katakana(e)||fe["CJK Symbols and Punctuation"](e)||fe["CJK Unified Ideographs Extension A"](e)||fe["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,o){let s=this.localFontFamily;if(!s||!this._doesCharSupportLocalGlyph(o))return;let u=e.tinySDF;if(!u){let L="400";/bold/i.test(n)?L="900":/medium/i.test(n)?L="500":/light/i.test(n)&&(L="200"),u=e.tinySDF=new Rh.TinySDF({fontFamily:s,fontWeight:L,fontSize:24*zo,buffer:3*zo,radius:8*zo}),u.fontWeight=L}if(this.localGlyphs[u.fontWeight][o])return this.localGlyphs[u.fontWeight][o];let h=String.fromCodePoint(o),{data:m,width:y,height:x,glyphWidth:T,glyphHeight:I,glyphLeft:M,glyphTop:S,glyphAdvance:R}=u.draw(h);return this.localGlyphs[u.fontWeight][o]={id:o,bitmap:new al({width:y,height:x},m),metrics:{width:T/zo,height:I/zo,left:M/zo,top:S/zo-27,advance:R/zo,localGlyph:!0}}}}Rh.loadGlyphRange=function(t,e,n,o,s){let u=256*e,h=u+255,m=o.transformRequest(o.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${u}-${h}`),oc.Glyphs);Bs(m,(y,x)=>{if(y)s(y);else if(x){let T={},I=function(M){return new Qf(M).readFields(BR,{})}(x);for(let M of I.glyphs)T[M.id]=M;s(null,{glyphs:T,ascender:I.ascender,descender:I.descender})}})},Rh.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:o=.25,fontFamily:s="sans-serif",fontWeight:u="normal",fontStyle:h="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=n;let m=this.size=t+4*e,y=this._createCanvas(m),x=this.ctx=y.getContext("2d",{willReadFrequently:!0});x.font=`${h} ${u} ${t}px ${s}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(m*m),this.gridInner=new Float64Array(m*m),this.f=new Float64Array(m),this.z=new Float64Array(m+1),this.v=new Uint16Array(m)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:s,actualBoundingBoxRight:u}=this.ctx.measureText(t),h=Math.ceil(n),m=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-s))),y=Math.min(this.size-this.buffer,h+Math.ceil(o)),x=m+2*this.buffer,T=y+2*this.buffer,I=Math.max(x*T,0),M=new Uint8ClampedArray(I),S={data:M,width:x,height:T,glyphWidth:m,glyphHeight:y,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(m===0||y===0)return S;let{ctx:R,buffer:L,gridInner:k,gridOuter:B}=this;R.clearRect(L,L,m,y),R.fillText(t,L,L+h);let Z=R.getImageData(L,L,m,y);B.fill(ep,0,I),k.fill(0,0,I);for(let W=0;W<y;W++)for(let X=0;X<m;X++){let re=Z.data[4*(W*m+X)+3]/255;if(re===0)continue;let ie=(W+L)*x+X+L;if(re===1)B[ie]=0,k[ie]=ep;else{let le=.5-re;B[ie]=le>0?le*le:0,k[ie]=le<0?le*le:0}}wI(B,0,0,x,T,x,this.f,this.v,this.z),wI(k,L,L,m,y,x,this.f,this.v,this.z);for(let W=0;W<I;W++){let X=Math.sqrt(B[W])-Math.sqrt(k[W]);M[W]=Math.round(255-255*(X/this.radius+this.cutoff))}return S}};let ul=Ni;function EI(t,e,n,o){let s=[],u=t.imagePrimary,h=u.pixelRatio,m=u.paddedRect.w-2*ul,y=u.paddedRect.h-2*ul,x=t.right-t.left,T=t.bottom-t.top,I=u.stretchX||[[0,m]],M=u.stretchY||[[0,y]],S=(Te,Oe)=>Te+Oe[1]-Oe[0],R=I.reduce(S,0),L=M.reduce(S,0),k=m-R,B=y-L,Z=0,W=R,X=0,re=L,ie=0,le=k,ge=0,we=B;if(u.content&&o){let Te=u.content;Z=Wg(I,0,Te[0]),X=Wg(M,0,Te[1]),W=Wg(I,Te[0],Te[2]),re=Wg(M,Te[1],Te[3]),ie=Te[0]-Z,ge=Te[1]-X,le=Te[2]-Te[0]-W,we=Te[3]-Te[1]-re}let Ce=(Te,Oe,$e,Le)=>{let qe=Zg(Te.stretch-Z,W,x,t.left),Re=Xg(Te.fixed-ie,le,Te.stretch,R),ze=Zg(Oe.stretch-X,re,T,t.top),Ze=Xg(Oe.fixed-ge,we,Oe.stretch,L),ke=Zg($e.stretch-Z,W,x,t.left),Qe=Xg($e.fixed-ie,le,$e.stretch,R),We=Zg(Le.stretch-X,re,T,t.top),Ge=Xg(Le.fixed-ge,we,Le.stretch,L),ft=new Je(qe,ze),ht=new Je(ke,ze),ot=new Je(ke,We),Ye=new Je(qe,We),vt=new Je(Re/h,Ze/h),dt=new Je(Qe/h,Ge/h),lt=e*Math.PI/180;if(lt){let $t=Math.sin(lt),Cn=Math.cos(lt),On=[Cn,-$t,$t,Cn];ft._matMult(On),ht._matMult(On),Ye._matMult(On),ot._matMult(On)}let Et=Te.stretch+Te.fixed,Ct=$e.stretch+$e.fixed,It=Oe.stretch+Oe.fixed,Nt=Le.stretch+Le.fixed,Zt=t.imageSecondary;return{tl:ft,tr:ht,bl:Ye,br:ot,texPrimary:{x:u.paddedRect.x+ul+Et,y:u.paddedRect.y+ul+It,w:Ct-Et,h:Nt-It},texSecondary:Zt?{x:Zt.paddedRect.x+ul+Et,y:Zt.paddedRect.y+ul+It,w:Ct-Et,h:Nt-It}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:vt,pixelOffsetBR:dt,minFontScaleX:le/h/x,minFontScaleY:we/h/T,isSDF:n}};if(o&&(u.stretchX||u.stretchY)){let Te=II(I,k,R),Oe=II(M,B,L);for(let $e=0;$e<Te.length-1;$e++){let Le=Te[$e],qe=Te[$e+1];for(let Re=0;Re<Oe.length-1;Re++)s.push(Ce(Le,Oe[Re],qe,Oe[Re+1]))}}else s.push(Ce({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:y+1}));return s}function Wg(t,e,n){let o=0;for(let s of t)o+=Math.max(e,Math.min(n,s[1]))-Math.max(e,Math.min(n,s[0]));return o}function II(t,e,n){let o=[{fixed:-ul,stretch:0}];for(let[s,u]of t){let h=o[o.length-1];o.push({fixed:s-h.stretch,stretch:h.stretch}),o.push({fixed:s-h.stretch,stretch:h.stretch+(u-s)})}return o.push({fixed:e+ul,stretch:n}),o}function Zg(t,e,n,o){return t/e*n+o}function Xg(t,e,n,o){return t-e*n/o}function WR(t,e,n,o){let s=e+t.positionedLines[o].lineOffset;return o===0?n+s/2:n+(s+(e+t.positionedLines[o-1].lineOffset))/2}function ZR(t,e=1,n=!1){let o=1/0,s=1/0,u=-1/0,h=-1/0,m=t[0];for(let S=0;S<m.length;S++){let R=m[S];(!S||R.x<o)&&(o=R.x),(!S||R.y<s)&&(s=R.y),(!S||R.x>u)&&(u=R.x),(!S||R.y>h)&&(h=R.y)}let y=Math.min(u-o,h-s),x=y/2,T=new ls([],XR);if(y===0)return new Je(o,s);for(let S=o;S<u;S+=y)for(let R=s;R<h;R+=y)T.push(new Oh(S+x,R+x,x,t));let I=function(S){let R=0,L=0,k=0,B=S[0];for(let Z=0,W=B.length,X=W-1;Z<W;X=Z++){let re=B[Z],ie=B[X],le=re.x*ie.y-ie.x*re.y;L+=(re.x+ie.x)*le,k+=(re.y+ie.y)*le,R+=3*le}return new Oh(L/R,k/R,0,S)}(t),M=T.length;for(;T.length;){let S=T.pop();(S.d>I.d||!I.d)&&(I=S,n&&console.log("found best %d after %d probes",Math.round(1e4*S.d)/1e4,M)),S.max-I.d<=e||(x=S.h/2,T.push(new Oh(S.p.x-x,S.p.y-x,x,t)),T.push(new Oh(S.p.x+x,S.p.y-x,x,t)),T.push(new Oh(S.p.x-x,S.p.y+x,x,t)),T.push(new Oh(S.p.x+x,S.p.y+x,x,t)),M+=4)}return n&&(console.log(`num probes: ${M}`),console.log(`best distance: ${I.d}`)),I.p}function XR(t,e){return e.max-t.max}class Oh{constructor(e,n,o,s){this.p=new Je(e,n),this.h=o,this.d=function(u,h){let m=!1,y=1/0;for(let x=0;x<h.length;x++){let T=h[x];for(let I=0,M=T.length,S=M-1;I<M;S=I++){let R=T[I],L=T[S];R.y>u.y!=L.y>u.y&&u.x<(L.x-R.x)*(u.y-R.y)/(L.y-R.y)+R.x&&(m=!m),y=Math.min(y,_T(u,R,L))}}return(m?1:-1)*Math.sqrt(y)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}}let jv=Number.POSITIVE_INFINITY,YR=Math.sqrt(2);function MI(t,[e,n]){let o=0,s=0;if(n===jv){e<0&&(e=0);let u=e/YR;switch(t){case"top-right":case"top-left":s=u-7;break;case"bottom-right":case"bottom-left":s=7-u;break;case"bottom":s=7-e;break;case"top":s=e-7}switch(t){case"top-right":case"bottom-right":o=-u;break;case"top-left":case"bottom-left":o=u;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":s=n-7;break;case"bottom-right":case"bottom-left":case"bottom":s=7-n}switch(t){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,s]}function Vv(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function QR(t,e,n,o,s,u,h,m,y,x,T,I,M,S,R){let L=u.textMaxSize.evaluate(e,{},I);L===void 0&&(L=h);let k=t.layers[0].layout,B=k.get("icon-offset").evaluate(e,{},I),Z=CI(n.horizontal)||n.vertical,W=M.name==="globe",X=Vr,re=h/X,ie=t.tilePixelRatio*L/X,le=(qe=t.overscaling,t.zoom>18&&qe>2&&(qe>>=1),Math.max(Xe/(512*qe),1)*k.get("symbol-spacing")),ge=k.get("text-padding")*t.tilePixelRatio,we=k.get("icon-padding")*t.tilePixelRatio,Ce=Gt(k.get("text-max-angle")),Te=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",Oe=k.get("icon-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",$e=k.get("symbol-placement"),Le=le/2;var qe;let Re=k.get("icon-text-fit").evaluate(e,{},I),ze=k.get("icon-text-fit-padding").evaluate(e,{},I),Ze=Re!=="none",ke;t.hasAnyIconTextFit===!1&&Ze&&(t.hasAnyIconTextFit=!0),o&&Ze&&(t.allowVerticalPlacement&&n.vertical&&(ke=fI(o,n.vertical,Re,ze,B,re)),Z&&(o=fI(o,Z,Re,ze,B,re)));let Qe=(We,Ge,ft)=>{if(Ge.x<0||Ge.x>=Xe||Ge.y<0||Ge.y>=Xe)return;let ht=null;if(W){let{x:ot,y:Ye,z:vt}=M.projectTilePoint(Ge.x,Ge.y,ft);ht={anchor:new oa(ot,Ye,vt,0,void 0),up:M.upVector(ft,Ge.x,Ge.y)}}(function(ot,Ye,vt,dt,lt,Et,Ct,It,Nt,Zt,$t,Cn,On,St,gn,xn,zn,Kn,lr,Jn,Yn,xr,hr,Ur,Fn,Ii,$o){let yo=ot.addToLineVertexArray(Ye,dt),vo,qc,gl,Wc,xp,GM,HM,qM=0,WM=0,ZM=0,XM=0,_x=-1,yx=-1,ys={},YM=Gu(""),Zc=vt?vt.anchor:Ye,vx=Nt.layout.get("icon-text-fit").evaluate(Yn,{},Fn)!=="none",xx=0,bx=0;if(Nt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[xx,bx]=Nt.layout.get("text-offset").evaluate(Yn,{},Fn).map(Bi=>Bi*Vr):(xx=Nt.layout.get("text-radial-offset").evaluate(Yn,{},Fn)*Vr,bx=jv),ot.allowVerticalPlacement&&lt.vertical){let Bi=lt.vertical;if(gn)GM=Uv(Bi),It&&(HM=Uv(It));else{let ji=Nt.layout.get("text-rotate").evaluate(Yn,{},Fn)+90;gl=Yg(Zt,Zc,Ye,$t,Cn,On,Bi,St,ji,xn),It&&(Wc=Yg(Zt,Zc,Ye,$t,Cn,On,It,Kn,ji))}}if(Et){let Bi=Nt.layout.get("icon-rotate").evaluate(Yn,{},Fn),ji=EI(Et,Bi,hr,vx),Vh=It?EI(It,Bi,hr,vx):void 0;qc=Yg(Zt,Zc,Ye,$t,Cn,On,Et,Kn,Bi),qM=4*ji.length;let QM=ot.iconSizeData,Xc=null;QM.kind==="source"?(Xc=[No*Nt.layout.get("icon-size").evaluate(Yn,{},Fn)],Xc[0]>hl&&rr(`${ot.layerIds[0]}: Value for "icon-size" is >= ${tp}. Reduce your "icon-size".`)):QM.kind==="composite"&&(Xc=[No*xr.compositeIconSizes[0].evaluate(Yn,{},Fn),No*xr.compositeIconSizes[1].evaluate(Yn,{},Fn)],(Xc[0]>hl||Xc[1]>hl)&&rr(`${ot.layerIds[0]}: Value for "icon-size" is >= ${tp}. Reduce your "icon-size".`)),ot.addSymbols(ot.icon,ji,Xc,Jn,lr,Yn,!1,vt,Ye,yo.lineStartIndex,yo.lineLength,-1,Ur,Fn,Ii,$o),_x=ot.icon.placedSymbolArray.length-1,Vh&&(WM=4*Vh.length,ot.addSymbols(ot.icon,Vh,Xc,Jn,lr,Yn,Ki.vertical,vt,Ye,yo.lineStartIndex,yo.lineLength,-1,Ur,Fn,Ii,$o),yx=ot.icon.placedSymbolArray.length-1)}for(let Bi in lt.horizontal){let ji=lt.horizontal[Bi];vo||(YM=Gu(ji.text),gn?xp=Uv(ji):vo=Yg(Zt,Zc,Ye,$t,Cn,On,ji,St,Nt.layout.get("text-rotate").evaluate(Yn,{},Fn),xn));let Vh=ji.positionedLines.length===1;if(ZM+=DI(ot,vt,Ye,ji,Ct,Nt,gn,Yn,xn,yo,lt.vertical?Ki.horizontal:Ki.horizontalOnly,Vh?Object.keys(lt.horizontal):[Bi],ys,_x,xr,Ur,Fn,Ii),Vh)break}lt.vertical&&(XM+=DI(ot,vt,Ye,lt.vertical,Ct,Nt,gn,Yn,xn,yo,Ki.vertical,["vertical"],ys,yx,xr,Ur,Fn,Ii));let _l=-1,wx=(Bi,ji)=>Bi?Math.max(Bi,ji):ji;_l=wx(xp,_l),_l=wx(GM,_l),_l=wx(HM,_l);let dL=_l>-1?1:0;ot.glyphOffsetArray.length>=65535&&rr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Yn.sortKey!==void 0&&ot.addToSortKeyRanges(ot.symbolInstances.length,Yn.sortKey),ot.symbolInstances.emplaceBack(Ye.x,Ye.y,Zc.x,Zc.y,Zc.z,ys.right>=0?ys.right:-1,ys.center>=0?ys.center:-1,ys.left>=0?ys.left:-1,ys.vertical>=0?ys.vertical:-1,_x,yx,YM,vo!==void 0?vo:ot.collisionBoxArray.length,vo!==void 0?vo+1:ot.collisionBoxArray.length,gl!==void 0?gl:ot.collisionBoxArray.length,gl!==void 0?gl+1:ot.collisionBoxArray.length,qc!==void 0?qc:ot.collisionBoxArray.length,qc!==void 0?qc+1:ot.collisionBoxArray.length,Wc||ot.collisionBoxArray.length,Wc?Wc+1:ot.collisionBoxArray.length,$t,ZM,XM,qM,WM,dL,0,xx,bx,_l,0,vx?1:0)})(t,Ge,ht,We,n,o,s,ke,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ge,Te,y,0,we,Oe,B,e,u,x,T,I,S,R)};if($e==="line")for(let We of vI(e.geometry,0,0,Xe,Xe)){let Ge=qR(We,le,Ce,n.vertical||Z,o,X,ie,t.overscaling,Xe);for(let ft of Ge)Z&&KR(t,Z.text,Le,ft)||Qe(We,ft,I)}else if($e==="line-center"){for(let We of e.geometry)if(We.length>1){let Ge=HR(We,Ce,n.vertical||Z,o,X,ie);Ge&&Qe(We,Ge,I)}}else if(e.type==="Polygon")for(let We of Rg(e.geometry,0)){let Ge=ZR(We,16);Qe(We[0],new oa(Ge.x,Ge.y,0,0,void 0),I)}else if(e.type==="LineString")for(let We of e.geometry)Qe(We,new oa(We[0].x,We[0].y,0,0,void 0),I);else if(e.type==="Point")for(let We of e.geometry)for(let Ge of We)Qe([Ge],new oa(Ge.x,Ge.y,0,0,void 0),I)}let tp=255,hl=tp*No;function DI(t,e,n,o,s,u,h,m,y,x,T,I,M,S,R,L,k,B){let Z=function(re,ie,le,ge,we,Ce,Te,Oe){let $e=[];if(ie.positionedLines.length===0)return $e;let Le=ge.layout.get("text-rotate").evaluate(Ce,{})*Math.PI/180,qe=function(Qe){let We=Qe[0],Ge=Qe[1],ft=We*Ge;return ft>0?[We,-Ge]:ft<0?[-We,Ge]:We===0?[Ge,We]:[Ge,-We]}(le),Re=Math.abs(ie.top-ie.bottom);for(let Qe of ie.positionedLines)Re-=Qe.lineOffset;let ze=ie.positionedLines.length,Ze=Re/ze,ke=ie.top-le[1];for(let Qe=0;Qe<ze;++Qe){let We=ie.positionedLines[Qe];ke=WR(ie,Ze,ke,Qe);for(let Ge of We.positionedGlyphs){if(!Ge.rect)continue;let ft=Ge.rect||{},ht=aI+1,ot=!0,Ye=1,vt=0;if(Ge.imageName){let Jn=Te[Ge.imageName];if(!Jn)continue;if(Jn.sdf){rr("SDF images are not supported in formatted text and will be ignored.");continue}ot=!1,Ye=Jn.pixelRatio,ht=Ni/Ye}let dt=(we||Oe)&&Ge.vertical,lt=Ge.metrics.advance*Ge.scale/2,Et=Ge.metrics,Ct=Ge.rect;if(Ct===null)continue;Oe&&ie.verticalizable&&(vt=Ge.imageName?lt-Ge.metrics.width*Ge.scale/2:0);let It=we?[Ge.x+lt,Ge.y]:[0,0],Nt=[0,0],Zt=[0,0],$t=!1;we||(dt?(Zt=[Ge.x+lt+qe[0],Ge.y+qe[1]-vt],$t=!0):Nt=[Ge.x+lt+le[0],Ge.y+le[1]-vt]);let Cn=Ct.w*Ge.scale/(Ye*(Ge.localGlyph?zo:1)),On=Ct.h*Ge.scale/(Ye*(Ge.localGlyph?zo:1)),St,gn,xn,zn;if(dt){let Jn=Ge.y-ke,Yn=new Je(-lt,lt-Jn),xr=-Math.PI/2,hr=new Je(...Zt);St=new Je(-lt+Nt[0],Nt[1]),St._rotateAround(xr,Yn)._add(hr),St.x+=-Jn+lt,St.y-=(Et.left-ht)*Ge.scale;let Ur=Ge.imageName?Et.advance*Ge.scale:Vr*Ge.scale,Fn=String.fromCodePoint(Ge.glyph);NR(Fn)?St.x+=(1-ht)*Ge.scale:zR(Fn)?St.x+=Ur-Et.height*Ge.scale+(-ht-1)*Ge.scale:St.x+=Ge.imageName||Et.width+2*ht===Ct.w&&Et.height+2*ht===Ct.h?(Ur-On)/2:(Ur-(Et.height+2*ht)*Ge.scale)/2,gn=new Je(St.x,St.y-Cn),xn=new Je(St.x+On,St.y),zn=new Je(St.x+On,St.y-Cn)}else{let Jn=(Et.left-ht)*Ge.scale-lt+Nt[0],Yn=(-Et.top-ht)*Ge.scale+Nt[1],xr=Jn+Cn,hr=Yn+On;St=new Je(Jn,Yn),gn=new Je(xr,Yn),xn=new Je(Jn,hr),zn=new Je(xr,hr)}if(Le){let Jn;Jn=we?new Je(0,0):$t?new Je(qe[0],qe[1]):new Je(le[0],le[1]),St._rotateAround(Le,Jn),gn._rotateAround(Le,Jn),xn._rotateAround(Le,Jn),zn._rotateAround(Le,Jn)}let Kn=new Je(0,0),lr=new Je(0,0);$e.push({tl:St,tr:gn,bl:xn,br:zn,texPrimary:ft,texSecondary:void 0,writingMode:ie.writingMode,glyphOffset:It,sectionIndex:Ge.sectionIndex,isSDF:ot,pixelOffsetTL:Kn,pixelOffsetBR:lr,minFontScaleX:0,minFontScaleY:0})}}return $e}(0,o,y,u,h,m,s,t.allowVerticalPlacement),W=t.textSizeData,X=null;W.kind==="source"?(X=[No*u.layout.get("text-size").evaluate(m,{},k)],X[0]>hl&&rr(`${t.layerIds[0]}: Value for "text-size" is >= ${tp}. Reduce your "text-size".`)):W.kind==="composite"&&(X=[No*R.compositeTextSizes[0].evaluate(m,{},k),No*R.compositeTextSizes[1].evaluate(m,{},k)],(X[0]>hl||X[1]>hl)&&rr(`${t.layerIds[0]}: Value for "text-size" is >= ${tp}. Reduce your "text-size".`)),t.addSymbols(t.text,Z,X,y,h,m,T,e,n,x.lineStartIndex,x.lineLength,S,L,k,B,!1);for(let re of I)M[re]=t.text.placedSymbolArray.length-1;return 4*Z.length}function CI(t){for(let e in t)return t[e];return null}function Yg(t,e,n,o,s,u,h,m,y,x){let T=h.top,I=h.bottom,M=h.left,S=h.right,R=h.collisionPadding;if(R&&(M-=R[0],T-=R[1],S+=R[2],I+=R[3]),y){let L=new Je(M,T),k=new Je(S,T),B=new Je(M,I),Z=new Je(S,I),W=Gt(y),X=new Je(0,0);x&&(X=new Je(x[0],x[1])),L._rotateAround(W,X),k._rotateAround(W,X),B._rotateAround(W,X),Z._rotateAround(W,X),M=Math.min(L.x,k.x,B.x,Z.x),S=Math.max(L.x,k.x,B.x,Z.x),T=Math.min(L.y,k.y,B.y,Z.y),I=Math.max(L.y,k.y,B.y,Z.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,M,T,S,I,m,o,s,u),t.length-1}function Uv(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function KR(t,e,n,o){let s=t.compareText;if(e in s){let u=s[e];for(let h=u.length-1;h>=0;h--)if(o.dist(u[h])<n)return!0}else s[e]=[];return s[e].push(o),!1}function SI(t,e){let n=t.fovAboveCenter,o=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,s=(t._camera.position[2]*t.worldSize-o)/Math.cos(t._pitch),u=Math.sin(n)*s/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),h=Math.sin(t._pitch)*u+s;return Math.min(1.01*h,s*(1/t._horizonShift))}function Vc(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let n=Math.pow(2,-t.z),o=t.x*n,s=(t.x+1)*n,u=t.y*n,h=(t.y+1)*n,m=Ei(o),y=Ei(s),x=Dr(u),T=Dr(h),I=e.project(m,x),M=e.project(y,x),S=e.project(y,T),R=e.project(m,T),L=Math.min(I.x,M.x,S.x,R.x),k=Math.min(I.y,M.y,S.y,R.y),B=Math.max(I.x,M.x,S.x,R.x),Z=Math.max(I.y,M.y,S.y,R.y),W=n/16;function X(ie,le,ge,we,Ce,Te){let Oe=(ge+Ce)/2,$e=(we+Te)/2,Le=e.project(Ei(Oe),Dr($e)),qe=Math.max(0,L-Le.x,k-Le.y,Le.x-B,Le.y-Z);L=Math.min(L,Le.x),B=Math.max(B,Le.x),k=Math.min(k,Le.y),Z=Math.max(Z,Le.y),qe>W&&(X(ie,Le,ge,we,Oe,$e),X(Le,le,Oe,$e,Ce,Te))}X(I,M,o,u,s,u),X(M,S,s,u,s,h),X(S,R,s,h,o,h),X(R,I,o,h,o,u),L-=W,k-=W,B+=W,Z+=W;let re=1/Math.max(B-L,Z-k);return{scale:re,x:L*re,y:k*re,x2:B*re,y2:Z*re,projection:e}}function AI(t,{x:e,y:n},o=0){return new Je(((e-o)*t.scale-t.x)*Xe,(n*t.scale-t.y)*Xe)}let JR=r.ae.identity(new Float32Array(16));class dl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new cn(0,0)}projectTilePoint(e,n,o){return{x:e,y:n,z:0}}locationPoint(e,n,o=!0){return e._coordinatePoint(e.locationCoordinate(n),o)}pixelsPerMeter(e,n){return ui(1,e)*n}pixelSpaceConversion(e,n,o){return 1}farthestPixelDistance(e){return SI(e,e.pixelsPerMeter)}pointCoordinate(e,n,o,s){let u=e.horizonLineFromTop(!1),h=new Je(n,Math.max(u,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(h,s))}pointCoordinate3D(e,n,o){let s=new Je(n,o);if(e.elevation)return e.elevation.pointCoordinate(s);{let u=this.pointCoordinate(e,s.x,s.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);let o=e.horizonLineFromTop();return n.y<o}createInversionMatrix(e,n){return JR}createTileMatrix(e,n,o){let s,u,h,m=o.canonical,y=r.ae.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let x=Vc(m,this);s=1,u=x.x+o.wrap*x.scale,h=x.y,r.ae.scale(y,y,[s/x.scale,s/x.scale,e.pixelsPerMeter/n])}else s=n/e.zoomScale(m.z),u=(m.x+Math.pow(2,m.z)*o.wrap)*s,h=m.y*s;return r.ae.translate(y,y,[u,h,0]),r.ae.scale(y,y,[s/Xe,s/Xe,1]),y}upVector(e,n,o){return[0,0,1]}upVectorScale(e,n,o){return{metersToTile:1}}}class eO extends dl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,o]=this.parallels=e.parallels||[29.5,45.5],s=Math.sin(Gt(n));this.n=(s+Math.sin(Gt(o)))/2,this.c=1+s*(2*this.n-s),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:o,c:s,r0:u}=this,h=Gt(e-this.center[0]),m=Gt(n),y=Math.sqrt(s-2*o*Math.sin(m))/o;return{x:y*Math.sin(h*o),y:y*Math.cos(h*o)-u,z:0}}unproject(e,n){let{n:o,c:s,r0:u}=this,h=u+n,m=Math.atan2(e,Math.abs(h))*Math.sign(h);h*o<0&&(m-=Math.PI*Math.sign(e)*Math.sign(h));let y=Gt(this.center[0])*o;m=La(m,-Math.PI-y,Math.PI-y);let x=jt(ti(m/o)+this.center[0],-180,180),T=Math.asin(jt((s-(e*e+h*h)*o*o)/(2*o),-1,1)),I=jt(ti(T),-sr,sr);return new cn(x,I)}}let np=1.340264,rp=-.081106,ip=893e-6,op=.003796,Qg=Math.sqrt(3)/2;class tO extends dl{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let o=Math.asin(Qg*Math.sin(n)),s=o*o,u=s*s*s;return{x:.5*(e*Math.cos(o)/(Qg*(np+3*rp*s+u*(7*ip+9*op*s)))/Math.PI+.5),y:1-.5*(o*(np+rp*s+u*(ip+op*s))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,s=o*o,u=s*s*s;for(let T,I,M,S=0;S<12&&(I=o*(np+rp*s+u*(ip+op*s))-n,M=np+3*rp*s+u*(7*ip+9*op*s),T=I/M,o=jt(o-T,-Math.PI/3,Math.PI/3),s=o*o,u=s*s*s,!(Math.abs(T)<1e-12));++S);let h=Qg*e*(np+3*rp*s+u*(7*ip+9*op*s))/Math.cos(o),m=Math.asin(Math.sin(o)/Qg),y=jt(180*h/Math.PI,-180,180),x=jt(180*m/Math.PI,-sr,sr);return new cn(y,x)}}class nO extends dl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let o=360*(e-.5),s=jt(360*(.5-n),-sr,sr);return new cn(o,s)}}let Lh=Math.PI/2;function Kg(t){return Math.tan((Lh+t)/2)}class rO extends dl{constructor(e){super(e),this.center=e.center||[0,30];let[n,o]=this.parallels=e.parallels||[30,30],s=Gt(n),u=Gt(o);this.southernCenter=s+u<0,this.southernCenter&&(s=-s,u=-u);let h=Math.cos(s),m=Kg(s);this.n=s===u?Math.sin(s):Math.log(h/Math.cos(u))/Math.log(Kg(u)/m),this.f=h*Math.pow(Kg(s),this.n)/this.n}project(e,n){n=Gt(n),this.southernCenter&&(n=-n),e=Gt(e-this.center[0]);let o=1e-6,{n:s,f:u}=this;u>0?n<-Lh+o&&(n=-Lh+o):n>Lh-o&&(n=Lh-o);let h=u/Math.pow(Kg(n),s),m=h*Math.sin(s*e),y=u-h*Math.cos(s*e);return m=.5*(m/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:m,y:this.southernCenter?y:1-y,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:o,f:s}=this,u=s-n,h=Math.sign(u),m=Math.sign(o)*Math.sqrt(e*e+u*u),y=Math.atan2(e,Math.abs(u))*h;u*o<0&&(y-=Math.PI*Math.sign(e)*h);let x=jt(ti(y/o)+this.center[0],-180,180),T=jt(ti(2*Math.atan(Math.pow(s/m,1/o))-Lh),-sr,sr);return new cn(x,this.southernCenter?-T:T)}}class PI extends dl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:ds(e),y:fs(n),z:0}}unproject(e,n){let o=Ei(e),s=Dr(n);return new cn(o,s)}}let RI=Gt(sr);class iO extends dl{project(e,n){let o=(n=Gt(n))*n,s=o*o;return{x:.5*((e=Gt(e))*(.8707-.131979*o+s*(s*(.003971*o-.001529*s)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+o*(.015085+s*(.028874*o-.044475-.005916*s)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,s=25,u=0,h=o*o;do{h=o*o;let x=h*h;u=(o*(1.007226+h*(.015085+x*(.028874*h-.044475-.005916*x)))-n)/(1.007226+h*(.045255+x*(.259866*h-.311325-.005916*11*x))),o=jt(o-u,-RI,RI)}while(Math.abs(u)>1e-6&&--s>0);h=o*o;let m=jt(ti(e/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),y=ti(o);return new cn(m,y)}}let OI=Gt(sr);class oO extends dl{project(e,n){n=Gt(n),e=Gt(e);let o=Math.cos(n),s=2/Math.PI,u=Math.acos(o*Math.cos(e/2)),h=Math.sin(u)/u,m=.5*(e*s+2*o*Math.sin(e/2)/h)||0,y=.5*(n+Math.sin(n)/h)||0;return{x:.5*(m/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,n){let o=e=(2*e-.5)*Math.PI,s=n=(2*(1-n)-1)*Math.PI,u=25,h=1e-6,m=0,y=0;do{let x=Math.cos(s),T=Math.sin(s),I=2*T*x,M=T*T,S=x*x,R=Math.cos(o/2),L=Math.sin(o/2),k=2*R*L,B=L*L,Z=1-S*R*R,W=Z?1/Z:0,X=Z?Math.acos(x*R)*Math.sqrt(1/Z):0,re=.5*(2*X*x*L+2*o/Math.PI)-e,ie=.5*(X*T+s)-n,le=.5*W*(S*B+X*x*R*M)+1/Math.PI,ge=W*(k*I/4-X*T*L),we=.125*W*(I*L-X*T*S*k),Ce=.5*W*(M*R+X*B*x)+.5,Te=ge*we-Ce*le;m=(ie*ge-re*Ce)/Te,y=(re*we-ie*le)/Te,o=jt(o-m,-Math.PI,Math.PI),s=jt(s-y,-OI,OI)}while((Math.abs(m)>h||Math.abs(y)>h)&&--u>0);return new cn(ti(o),ti(s))}}class LI extends dl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Gt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:o,cosPhi:s}=this;return{x:Gt(e)*s*o+.5,y:-Math.sin(Gt(n))/s*o+.5,z:0}}unproject(e,n){let{scale:o,cosPhi:s}=this,u=-(n-.5)/o,h=jt(ti((e-.5)/o)/s,-180,180),m=Math.asin(jt(u*s,-1,1)),y=jt(ti(m),-sr,sr);return new cn(h,y)}}class sO extends PI{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,o){let s=jf(e,n,o),u=Vf(ps(o));return r.$.transformMat4(s,s,u),{x:s[0],y:s[1],z:s[2]}}locationPoint(e,n){let o=Fc(n.lat,n.lng),s=r.$.normalize([],o),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,h=ui(1,0)*Xe*u;r.$.scaleAndAdd(o,o,s,h);let m=r.ae.identity(new Float64Array(16));return r.ae.multiply(m,e.pixelMatrix,e.globeMatrix),r.$.transformMat4(o,o,m),new Je(o[0],o[1])}pixelsPerMeter(e,n){return ui(1,0)*n}pixelSpaceConversion(e,n,o){let s=ui(1,e)*n,u=gt(ui(1,45)*n,s,o);return this.pixelsPerMeter(e,n)/u}createTileMatrix(e,n,o){let s=xv(ps(o.canonical));return r.ae.multiply(new Float64Array(16),e.globeMatrix,s)}createInversionMatrix(e,n){let{center:o}=e,s=Vf(ps(n));return r.ae.rotateY(s,s,Gt(o.lng)),r.ae.rotateX(s,s,Gt(o.lat)),r.ae.scale(s,s,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(s)}pointCoordinate(e,n,o,s){return CT(e,n,o,!0)||new Qr(0,0)}pointCoordinate3D(e,n,o){let s=this.pointCoordinate(e,n,o,0);return[s.x,s.y,s.z]}isPointAboveHorizon(e,n){return!CT(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(s,u){let h=s.cameraToCenterDistance,m=s._centerAltitude*u,y=s._camera,x=s._camera.forward(),T=r.$.add([],r.$.scale([],x,-h),[0,0,m]),I=s.worldSize/(2*Math.PI),M=[0,0,-I],S=s.width/s.height,R=Math.tan(s.fovAboveCenter),L=r.$.scale([],y.up(),R),k=r.$.scale([],y.right(),R*S),B=r.$.normalize([],r.$.add([],r.$.add([],x,L),k)),Z=[],W;if(new mv(T,B).closestPointOnSphere(M,I,Z)){let X=r.$.add([],Z,M),re=r.$.sub([],X,T);W=Math.cos(s.fovAboveCenter)*r.$.length(re)}else{let X=r.$.sub([],T,M),re=r.$.sub([],M,T);r.$.normalize(re,re);let ie=r.$.length(X)-I;W=Math.sqrt(ie*(ie+2*I));let le=Math.acos(W/(I+ie))-Math.acos(r.$.dot(x,re));W*=Math.cos(le)}return 1.01*W}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=ra(e.zoom);if(o>0){let s=SI(e,ui(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),h=Math.max(e.width,e.height)/e.worldSize*Math.PI;return gt(n,s+u*(1-Math.cos(h)),Math.pow(o,10))}return n}upVector(e,n,o){return jf(n,o,e,1)}upVectorScale(e){return{metersToTile:Mg(Cg(ps(e)))}}}function kI(t){let e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new PI(t);case"equirectangular":return new nO(t);case"naturalEarth":return new iO(t);case"equalEarth":return new tO(t);case"winkelTripel":return new oO(t);case"albers":return n?new LI(t):new eO(t);case"lambertConformalConic":return n?new LI(t):new rO(t);case"globe":return new sO(t)}throw new Error(`Invalid projection name: ${t.name}`)}let aO=kg.types,lO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Jg(t,e,n,o,s,u,h,m,y,x,T,I,M){let S=m?Math.min(hl,Math.round(m[0])):0,R=m?Math.min(hl,Math.round(m[1])):0;t.emplaceBack(e,n,Math.round(32*o),Math.round(32*s),u,h,(S<<1)+(y?1:0),R,16*x,16*T,256*I,256*M)}function e_(t,e,n){t.emplaceBack(e,n)}function t_(t,e,n,o,s,u,h){t.emplaceBack(e,n,o,s,u,h)}function n_(t,e,n,o,s){t.emplaceBack(e,n,o,s),t.emplaceBack(e,n,o,s),t.emplaceBack(e,n,o,s),t.emplaceBack(e,n,o,s)}function cO(t){for(let e of t.sections)if(At(e.text))return!0;return!1}class $v{constructor(e){this.layoutVertexArray=new z0,this.indexArray=new vr,this.programConfigurations=e,this.segments=new Zn,this.dynamicLayoutVertexArray=new Ja,this.opacityVertexArray=new j0,this.placedSymbolArray=new Zw,this.iconTransitioningVertexArray=new nl,this.globeExtVertexArray=new B0,this.zOffsetVertexArray=new _h}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,o,s,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dR.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,pR.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,lO,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,mR.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,fR.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,VE.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||s)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}me($v,"SymbolBuffers");class Gv{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new Zn,this.collisionVertexArray=new $0,this.collisionVertexArrayExt=new Ja}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,gR.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,_R.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}me(Gv,"CollisionBuffers");class kh{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=r.ae.identity([]),this.placementViewportMatrix=r.ae.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Lv(this.zoom,n["text-size"]),this.iconSizeData=Lv(this.zoom,n["icon-size"]);let o=this.layers[0].layout,s=o.get("symbol-sort-key"),u=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&s.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(h=>Ki[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new $v(new il(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new $v(new il(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new Qw,this.lineVertexArray=new Kw,this.symbolInstances=new Yw}calculateGlyphDependencies(e,n,o,s,u){for(let h=0;h<e.length;h++){let m=e.codePointAt(h);if(m===void 0)break;if(n[m]=!0,s&&u&&m<=65535){let y=Kf[e.charAt(h)];y&&(n[y.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let o=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Pv(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,n,o,s){let u=this.layers[0],h=u.layout,m=this.projection.name==="globe",y=h.get("text-font"),x=h.get("text-field"),T=h.get("icon-image"),I=(x.value.kind!=="constant"||x.value.value instanceof Xr&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),M=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,S=h.get("symbol-sort-key");if(this.features=[],!I&&!M)return;let R=n.iconDependencies,L=n.glyphDependencies,k=n.availableImages,B=new xt(this.zoom);for(let{feature:Z,id:W,index:X,sourceLayerIndex:re}of e){let ie=u._featureFilter.needGeometry,le=ta(Z,ie);if(!u._featureFilter.filter(B,le,o))continue;if(ie||(le.geometry=Fo(Z,o,s)),m&&Z.type!==1&&o.z<=5){let Te=le.geometry,Oe=.98078528056,$e=(Le,qe)=>{let Re=jf(Le.x,Le.y,o,1),ze=jf(qe.x,qe.y,o,1);return r.$.dot(Re,ze)<Oe};for(let Le=0;Le<Te.length;Le++)Te[Le]=sP(Te[Le],$e)}let ge,we;if(I){let Te=u.getValueAndResolveTokens("text-field",le,o,k),Oe=Xr.factory(Te);cO(Oe)&&(this.hasRTLText=!0),(!this.hasRTLText||Pt()==="unavailable"||this.hasRTLText&&Ut.isParsed())&&(ge=FR(Oe,u,le))}if(M){let Te=u.getValueAndResolveTokens("icon-image",le,o,k);we=Te instanceof gi?Te:gi.fromString(Te)}if(!ge&&!we)continue;let Ce=this.sortFeaturesByKey?S.evaluate(le,{},o):void 0;if(this.features.push({id:W,text:ge,icon:we,index:X,sourceLayerIndex:re,geometry:le.geometry,properties:Z.properties,type:aO[Z.type],sortKey:Ce}),we&&(R[we.namePrimary]=!0,we.nameSecondary&&(R[we.nameSecondary]=!0)),ge){let Te=y.evaluate(le,{},o).join(","),Oe=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ki.vertical)>=0;for(let $e of ge.sections)if($e.image)R[$e.image.namePrimary]=!0;else{let Le=Ne(ge.toString()),qe=$e.fontStack||Te,Re=L[qe]=L[qe]||{};this.calculateGlyphDependencies($e.text,Re,Oe,this.allowVerticalPlacement,Le)}}}h.get("symbol-placement")==="line"&&(this.features=function(Z){let W={},X={},re=[],ie=0;function le(Te){re.push(Z[Te]),ie++}function ge(Te,Oe,$e){let Le=X[Te];return delete X[Te],X[Oe]=Le,re[Le].geometry[0].pop(),re[Le].geometry[0]=re[Le].geometry[0].concat($e[0]),Le}function we(Te,Oe,$e){let Le=W[Oe];return delete W[Oe],W[Te]=Le,re[Le].geometry[0].shift(),re[Le].geometry[0]=$e[0].concat(re[Le].geometry[0]),Le}function Ce(Te,Oe,$e){let Le=$e?Oe[0][Oe[0].length-1]:Oe[0][0];return`${Te}:${Le.x}:${Le.y}`}for(let Te=0;Te<Z.length;Te++){let Oe=Z[Te],$e=Oe.geometry,Le=Oe.text?Oe.text.toString():null;if(!Le){le(Te);continue}let qe=Ce(Le,$e),Re=Ce(Le,$e,!0);if(qe in X&&Re in W&&X[qe]!==W[Re]){let ze=we(qe,Re,$e),Ze=ge(qe,Re,re[ze].geometry);delete W[qe],delete X[Re],X[Ce(Le,re[Ze].geometry,!0)]=Ze,re[ze].geometry=null}else qe in X?ge(qe,Re,$e):Re in W?we(qe,Re,$e):(le(Te),W[qe]=ie-1,X[Re]=ie-1)}return re.filter(Te=>Te.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Z,W)=>Z.sortKey-W.sortKey)}update(e,n,o,s,u){let h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;let m=h?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,m,o,s,u),this.icon.programConfigurations.updatePaintArrays(e,n,m,o,s,u)}updateZOffset(){let e=(u,h,m)=>{o+=h,o>u.length&&u.resize(o);for(let y=-h;y<0;y++)u.emplace(y+o,m)},n=(u,h,m)=>{s+=h,s>u.length&&u.resize(s);for(let y=-h;y<0;y++)u.emplace(y+s,m)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,s=0;for(let u=0;u<this.symbolInstances.length;u++){let h=this.symbolInstances.get(u),{numHorizontalGlyphVertices:m,numVerticalGlyphVertices:y,numIconVertices:x}=h,T=h.zOffset,I=x>0;if((m>0||y>0)&&(e(this.text.zOffsetVertexArray,m,T),e(this.text.zOffsetVertexArray,y,T)),I){let{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:S}=h;M>=0&&n(this.icon.zOffsetVertexArray,x,T),S>=0&&n(this.icon.zOffsetVertexArray,h.numVerticalIconVertices,T)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=kI(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){let o=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:s,y:u}of n)this.lineVertexArray.emplaceBack(s,u);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,s,u,h,m,y,x,T,I,M,S,R,L,k){let B=e.indexArray,Z=e.layoutVertexArray,W=e.globeExtVertexArray,X=e.segments.prepareSegment(4*n.length,Z,B,this.canOverlap?h.sortKey:void 0),re=this.glyphOffsetArray.length,ie=X.vertexLength,le=this.allowVerticalPlacement&&m===Ki.vertical?Math.PI/2:0,ge=h.text&&h.text.sections;for(let Ce=0;Ce<n.length;Ce++){let{tl:Te,tr:Oe,bl:$e,br:Le,texPrimary:qe,texSecondary:Re,pixelOffsetTL:ze,pixelOffsetBR:Ze,minFontScaleX:ke,minFontScaleY:Qe,glyphOffset:We,isSDF:Ge,sectionIndex:ft}=n[Ce],ht=X.vertexLength,ot=We[1];if(Jg(Z,x.x,x.y,Te.x,ot+Te.y,qe.x,qe.y,o,Ge,ze.x,ze.y,ke,Qe),Jg(Z,x.x,x.y,Oe.x,ot+Oe.y,qe.x+qe.w,qe.y,o,Ge,Ze.x,ze.y,ke,Qe),Jg(Z,x.x,x.y,$e.x,ot+$e.y,qe.x,qe.y+qe.h,o,Ge,ze.x,Ze.y,ke,Qe),Jg(Z,x.x,x.y,Le.x,ot+Le.y,qe.x+qe.w,qe.y+qe.h,o,Ge,Ze.x,Ze.y,ke,Qe),y){let{x:Ye,y:vt,z:dt}=y.anchor,[lt,Et,Ct]=y.up;t_(W,Ye,vt,dt,lt,Et,Ct),t_(W,Ye,vt,dt,lt,Et,Ct),t_(W,Ye,vt,dt,lt,Et,Ct),t_(W,Ye,vt,dt,lt,Et,Ct),n_(e.dynamicLayoutVertexArray,Ye,vt,dt,le)}else n_(e.dynamicLayoutVertexArray,x.x,x.y,x.z,le);if(k){let Ye=Re||qe;e_(e.iconTransitioningVertexArray,Ye.x,Ye.y),e_(e.iconTransitioningVertexArray,Ye.x+Ye.w,Ye.y),e_(e.iconTransitioningVertexArray,Ye.x,Ye.y+Ye.h),e_(e.iconTransitioningVertexArray,Ye.x+Ye.w,Ye.y+Ye.h)}B.emplaceBack(ht,ht+1,ht+2),B.emplaceBack(ht+1,ht+2,ht+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(We[0]),Ce!==n.length-1&&ft===n[Ce+1].sectionIndex||e.programConfigurations.populatePaintArrays(Z.length,h,h.index,{},S,R,L,ge&&ge[ft])}let we=y?y.anchor:x;e.placedSymbolArray.emplaceBack(we.x,we.y,we.z,x.x,x.y,re,this.glyphOffsetArray.length-re,ie,T,I,x.segment,o?o[0]:0,o?o[1]:0,s[0],s[1],m,0,!1,0,M,0)}_commitLayoutVertex(e,n,o,s,u,h,m){e.emplaceBack(n,o,s,u,h,Math.round(m.x),Math.round(m.y))}_addCollisionDebugVertices(e,n,o,s,u,h,m){let y=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),x=y.vertexLength,T=m.tileAnchorX,I=m.tileAnchorY;for(let S=0;S<4;S++)o.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,n,e.padding,m.zOffset),this._commitLayoutVertex(o.layoutVertexArray,s,u,h,T,I,new Je(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,s,u,h,T,I,new Je(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,s,u,h,T,I,new Je(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,s,u,h,T,I,new Je(e.x1,e.y2)),y.vertexLength+=4;let M=o.indexArray;M.emplaceBack(x,x+1),M.emplaceBack(x+1,x+2),M.emplaceBack(x+2,x+3),M.emplaceBack(x+3,x),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,o,s,u,h){for(let m=s;m<u;m++){let y=o.get(m),x=this.getSymbolInstanceTextSize(e,h,n,m);this._addCollisionDebugVertices(y,x,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,n,o,s,u,h){for(let m=s;m<u;m++){let y=o.get(m),x=this.getSymbolInstanceIconSize(e,n,h.placedIconSymbolIndex);this._addCollisionDebugVertices(y,x,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Gv(_g,UE.members,nl),this.iconCollisionBox=new Gv(_g,UE.members,nl);let o=Ah(this.iconSizeData,e),s=Ah(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){let h=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(s,e,n,h.textBoxStartIndex,h.textBoxEndIndex,h),this._addTextDebugCollisionBoxes(s,e,n,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._addIconDebugCollisionBoxes(o,e,n,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._addIconDebugCollisionBoxes(o,e,n,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}}getSymbolInstanceTextSize(e,n,o,s){let u=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:s),h=Hg(this.textSizeData,e,u)/Vr;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,n,o){let s=this.icon.placedSymbolArray.get(o),u=Hg(this.iconSizeData,e,s);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,n,o,s){e.emplaceBack(n,-o,-o,s),e.emplaceBack(n,o,-o,s),e.emplaceBack(n,o,o,s),e.emplaceBack(n,-o,o,s)}_updateTextDebugCollisionBoxes(e,n,o,s,u,h){for(let m=s;m<u;m++){let y=o.get(m),x=this.getSymbolInstanceTextSize(e,h,n,m);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,y.padding,h.zOffset)}}_updateIconDebugCollisionBoxes(e,n,o,s,u,h){for(let m=s;m<u;m++){let y=o.get(m),x=this.getSymbolInstanceIconSize(e,n,h.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,y.padding,h.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let o=Ah(this.iconSizeData,e),s=Ah(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){let h=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(s,e,n,h.textBoxStartIndex,h.textBoxEndIndex,h),this._updateTextDebugCollisionBoxes(s,e,n,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._updateIconDebugCollisionBoxes(o,e,n,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._updateIconDebugCollisionBoxes(o,e,n,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,o,s,u,h,m,y,x){let T={};if(n<o){let{x1:I,y1:M,x2:S,y2:R,padding:L,projectedAnchorX:k,projectedAnchorY:B,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:X,featureIndex:re}=e.get(n);T.textBox={x1:I,y1:M,x2:S,y2:R,padding:L,projectedAnchorX:k,projectedAnchorY:B,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:X},T.textFeatureIndex=re}if(s<u){let{x1:I,y1:M,x2:S,y2:R,padding:L,projectedAnchorX:k,projectedAnchorY:B,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:X,featureIndex:re}=e.get(s);T.verticalTextBox={x1:I,y1:M,x2:S,y2:R,padding:L,projectedAnchorX:k,projectedAnchorY:B,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:X},T.verticalTextFeatureIndex=re}if(h<m){let{x1:I,y1:M,x2:S,y2:R,padding:L,projectedAnchorX:k,projectedAnchorY:B,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:X,featureIndex:re}=e.get(h);T.iconBox={x1:I,y1:M,x2:S,y2:R,padding:L,projectedAnchorX:k,projectedAnchorY:B,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:X},T.iconFeatureIndex=re}if(y<x){let{x1:I,y1:M,x2:S,y2:R,padding:L,projectedAnchorX:k,projectedAnchorY:B,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:X,featureIndex:re}=e.get(y);T.verticalIconBox={x1:I,y1:M,x2:S,y2:R,padding:L,projectedAnchorX:k,projectedAnchorY:B,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:X},T.verticalIconFeatureIndex=re}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let o=e.placedSymbolArray.get(n),s=o.vertexStartIndex+4*o.numGlyphs;for(let u=o.vertexStartIndex;u<s;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),o=Math.cos(e),s=[],u=[],h=[];for(let m=0;m<this.symbolInstances.length;++m){h.push(m);let y=this.symbolInstances.get(m);s.push(0|Math.round(n*y.tileAnchorX+o*y.tileAnchorY)),u.push(y.featureIndex)}return h.sort((m,y)=>s[m]-s[y]||u[y]-u[m]),h}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex);let{rightJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:m,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:x}=o;s>=0&&this.addIndicesForPlacedSymbol(this.text,s),u>=0&&u!==s&&this.addIndicesForPlacedSymbol(this.text,u),h>=0&&h!==u&&h!==s&&this.addIndicesForPlacedSymbol(this.text,h),m>=0&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}me(kh,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),kh.addDynamicAttributes=n_;class mo{constructor(e,n,o,s){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(n,s)}update(e,n,o){let{width:s,height:u}=e,{context:h}=this,{gl:m}=h;if(m.bindTexture(m.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA&&(!n||n.premultiply!==!1)),this.useMipmap=!!(n&&n.useMipmap),o||this.size&&this.size[0]===s&&this.size[1]===u){let{x:y,y:x}=o||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)m.texSubImage2D(m.TEXTURE_2D,0,y,x,m.RGBA,m.UNSIGNED_BYTE,e);else{let T=this.format,I=m.UNSIGNED_BYTE;this.format===m.R32F&&(T=m.RED,I=m.FLOAT),m.texSubImage2D(m.TEXTURE_2D,0,y,x,s,u,T,I,e.data)}}else if(this.size=[s,u],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===m.R8&&(y=m.RED),m.texImage2D(m.TEXTURE_2D,0,this.format,y,m.UNSIGNED_BYTE,e)}else{let y=this.format,x=this.format,T=m.UNSIGNED_BYTE,I=!1;this.format===m.DEPTH_COMPONENT&&(y=m.DEPTH_COMPONENT16,T=m.UNSIGNED_SHORT),this.format===m.DEPTH_STENCIL&&(y=m.DEPTH24_STENCIL8,T=m.UNSIGNED_INT_24_8,I=!0),this.format===m.R8&&(x=m.RED),this.format===m.R32F&&(T=m.FLOAT,x=m.RED),!this.useMipmap&&I?m.texStorage2D(m.TEXTURE_2D,1,y,s,u):m.texImage2D(m.TEXTURE_2D,0,y,s,u,0,x,T,e.data)}this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,n,o=!1){let{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,o,s){let{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),n!==this.magFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),this.wrapS=o),s!==this.wrapT&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrapT=s)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class r_{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:o}=this,{gl:s}=o;s.bindTexture(s.TEXTURE_2D,this.texture),e!==this.minFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,n),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,n),this.wrapS=n)}}let go=32,gs=33,fl=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,o=0,s=0,u=0,h=0,m=0;for(1&e?s=u=h=go:n=o=m=go;(e>>=1)>1;){let x=n+s>>1,T=o+u>>1;1&e?(s=n,u=o,n=h,o=m):(n=s,o=u,s=h,u=m),h=x,m=T}let y=4*t;fl[y+0]=n,fl[y+1]=o,fl[y+2]=s,fl[y+3]=u}let _s=new Uint16Array(2178),pl=new Uint8Array(1089),i_=new Uint16Array(1089);function FI(t){return t===0?-.03125:t===32?.03125:0}var o_=mn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let uO=(()=>{class t{constructor(n,o,s,u){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=n;let h=n.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!s,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||u||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;let o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})();class Fh{constructor(e,n,o){this.func=e,this.mask=n,this.range=o}}Fh.ReadOnly=!1,Fh.ReadWrite=!0,Fh.disabled=new Fh(519,Fh.ReadOnly,[0,1]);let Hv=7680;class qv{constructor(e,n,o,s,u,h){this.test=e,this.ref=n,this.mask=o,this.fail=s,this.depthFail=u,this.pass=h}}qv.disabled=new qv({func:519,mask:0},0,0,Hv,Hv,Hv);let sp=771;class zi{constructor(e,n,o,s){this.blendFunction=e,this.blendColor=n,this.mask=o,this.blendEquation=s}}zi.Replace=[1,0,1,0],zi.disabled=new zi(zi.Replace,hn.transparent,[!1,!1,!1,!1]),zi.unblended=new zi(zi.Replace,hn.transparent,[!0,!0,!0,!0]),zi.alphaBlended=new zi([1,sp,1,sp],hn.transparent,[!0,!0,!0,!0]),zi.alphaBlendedNonPremultiplied=new zi([770,sp,770,sp],hn.transparent,[!0,!0,!0,!0]),zi.multiply=new zi([774,0,774,0],hn.transparent,[!0,!0,!0,!0]);let Wv=1029,Zv=2305;class Bo{constructor(e,n,o){this.enable=e,this.mode=n,this.frontFace=o}}Bo.disabled=new Bo(!1,Wv,Zv),Bo.backCCW=new Bo(!0,Wv,Zv),Bo.backCW=new Bo(!0,Wv,2304),Bo.frontCW=new Bo(!0,1028,2304),Bo.frontCCW=new Bo(!0,1028,Zv);var hO=mn([{name:"a_index",type:"Int16",components:1}]);let NI={type:2,extent:Xe,loadGeometry:()=>[[new Je(0,0),new Je(Xe+1,0),new Je(Xe+1,Xe+1),new Je(0,Xe+1),new Je(0,0)]]};class s_{constructor(e,n,o,s,u){this.tileID=e,this.uid=Lu(),this.uses=0,this.tileSize=n,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,s&&s.style&&(this._lastUpdatedBrightness=s.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",s&&s.transform&&(this.projection=s.transform.projection)}registerFadeDuration(e){let n=e+this.timeAdded;n<kr.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Vc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,o){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(s,u){let h={};if(!u)return h;for(let m of s){let y=m.layerIds.map(x=>u.getLayer(x)).filter(Boolean);if(y.length!==0){m.layers=y,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map(x=>y.filter(T=>T.id===x)[0]));for(let x of y)h[x.fqid]=m}}return h}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let s in this.buckets){let u=this.buckets[s];if(u instanceof kh){if(this.hasSymbolBuckets=!0,!o)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let s in this.buckets){let u=this.buckets[s];if(u instanceof kh&&u.hasRTLText){this.hasRTLText=!0,Ut.isLoading()||Ut.isLoaded()||Pt()!=="deferred"||tn();break}}this.queryPadding=0;for(let s in this.buckets){let u=this.buckets[s],h=n.style.getOwnLayer(s);if(!h)continue;let m=h.queryRadius(u);this.queryPadding=Math.max(this.queryPadding,m)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new Q0}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let s in this.buckets){let u=this.buckets[s];u.uploadPending()&&u.upload(e)}let n=e.gl,o=this.imageAtlas;if(o&&!o.uploaded){let s=!!Object.keys(o.patternPositions).length;this.imageAtlasTexture=new mo(e,o.image,n.RGBA,{useMipmap:s}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new mo(e,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new mo(e,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,n,o){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,o),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let s=n.style.getBrightness();(this._lastUpdatedBrightness||s)&&(this._lastUpdatedBrightness&&s&&Math.abs(this._lastUpdatedBrightness-s)<.001||(this._lastUpdatedBrightness=s,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,o,s,u,h,m,y){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:s,pixelPosMatrix:m,transform:h,params:u,tileTransform:this.tileTransform},e,n,o):{}}querySourceFeatures(e,n){let o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;let s=o.loadVTLayers(),u=n?n.sourceLayer:"",h=s._geojsonTileLayer||s[u];if(!h)return;let m=Oo(n&&n.filter),{z:y,x,y:T}=this.tileID.canonical,I={z:y,x,y:T};for(let M=0;M<h.length;M++){let S=h.feature(M);if(m.needGeometry){let k=ta(S,!0);if(!m.filter(new xt(this.tileID.overscaledZ),k,this.tileID.canonical))continue}else if(!m.filter(new xt(this.tileID.overscaledZ),S))continue;let R=o.getId(S,u),L=new iI(S,y,x,T,R);L.tile=I,e.push(L)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let o=Kl(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let o=Date.now(),s=!1;if(this.expirationTime>o)s=!1;else if(n)if(this.expirationTime<n)s=!0;else{let u=this.expirationTime-n;u?this.expirationTime=o+Math.max(u,3e4):s=!0}else s=!0;s?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;let o=this.latestFeatureIndex.loadVTLayers(),s=n.style.listImages(),u=n.style.getBrightness();for(let h in this.buckets){if(!n.style.hasLayer(h))continue;let m=this.buckets[h],y=m.layers[0].sourceLayer||"_geojsonTileLayer",x=o[y],T={};if(e&&(T=e[y],!x||!T||Object.keys(T).length===0))continue;if(m.update(T,x,s,this.imageAtlas&&this.imageAtlas.patternPositions||{},u),m instanceof Ug||m instanceof Og){let M=n.style.getOwnSourceCache(m.layers[0].source);n._terrain&&n._terrain.enabled&&M&&m.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(M.id,this.tileID)}let I=n&&n.style&&n.style.getOwnLayer(h);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<kr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=kr.now()+e}setTexture(e,n){let o=n.context,s=o.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof mo?this.texture.update(e,{useMipmap:!0}):(this.texture=new mo(o,e,s.RGBA,{useMipmap:!0}),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE))}setDependencies(e,n){let o={};for(let s of n)o[s]=!0;this.dependencies[e]=o}hasDependency(e,n){for(let o of e){let s=this.dependencies[o];if(s){for(let u of n)if(s[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;let o=Fo(NI,this.tileID.canonical,this.tileTransform)[0],s=new Lo,u=new Of;for(let h=0;h<o.length;h++){let{x:m,y}=o[h];s.emplaceBack(m,y),u.emplaceBack(h)}u.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(s,Bf.members),this._tileDebugSegments=Zn.simpleSegment(0,0,s.length,u.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;let o=Fo(NI,this.tileID.canonical,this.tileTransform)[0],s,u;if(this.isRaster){let h=function(m,y){let x=Vc(m,y),T=Math.pow(2,m.z);for(let k=0;k<gs;k++)for(let B=0;B<gs;B++){let Z=Ei((m.x+(B+FI(B))/go)/T),W=Dr((m.y+(k+FI(k))/go)/T),X=y.project(Z,W),re=k*gs+B;_s[2*re+0]=Math.round((X.x*x.scale-x.x)*Xe),_s[2*re+1]=Math.round((X.y*x.scale-x.y)*Xe)}pl.fill(0),i_.fill(0);for(let k=2045;k>=0;k--){let B=4*k,Z=fl[B+0],W=fl[B+1],X=fl[B+2],re=fl[B+3],ie=Z+X>>1,le=W+re>>1,ge=ie+le-W,we=le+Z-ie,Ce=W*gs+Z,Te=re*gs+X,Oe=le*gs+ie,$e=Math.hypot((_s[2*Ce+0]+_s[2*Te+0])/2-_s[2*Oe+0],(_s[2*Ce+1]+_s[2*Te+1])/2-_s[2*Oe+1])>=16;pl[Oe]=pl[Oe]||($e?1:0),k<1022&&(pl[Oe]=pl[Oe]||pl[(W+we>>1)*gs+(Z+ge>>1)]||pl[(re+we>>1)*gs+(X+ge>>1)])}let I=new Qs,M=new vr,S=0;function R(k,B){let Z=B*gs+k;return i_[Z]===0&&(I.emplaceBack(_s[2*Z+0],_s[2*Z+1],k*Xe/go,B*Xe/go),i_[Z]=++S),i_[Z]-1}function L(k,B,Z,W,X,re){let ie=k+Z>>1,le=B+W>>1;if(Math.abs(k-X)+Math.abs(B-re)>1&&pl[le*gs+ie])L(X,re,k,B,ie,le),L(Z,W,X,re,ie,le);else{let ge=R(k,B),we=R(Z,W),Ce=R(X,re);M.emplaceBack(ge,we,Ce)}}return L(0,0,go,go,go,0),L(go,go,0,0,0,go),{vertices:I,indices:M}}(this.tileID.canonical,n);s=h.vertices,u=h.indices}else{s=new Qs,u=new vr;for(let{x:m,y}of o)s.emplaceBack(m,y,0,0);let h=$f(s.int16,void 0,4);for(let m=0;m<h.length;m+=3)u.emplaceBack(h[m],h[m+1],h[m+2])}this._tileBoundsBuffer=e.createVertexBuffer(s,o_.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(u),this._tileBoundsSegments=Zn.simpleSegment(0,0,s.length,u.length)}_makeGlobeTileDebugBuffers(e,n){let o=n.projection;if(!o||o.name!=="globe"||n.freezeTileCoverage)return;let s=this.tileID.canonical,u=Vf(ST(s,n)),h=ra(n.zoom),m;h>0&&(m=r.ae.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,s,n,u,m,h),this._makeGlobeTileDebugTextBuffer(e,s,n,u,m,h)}_globePoint(e,n,o,s,u,h,m){let y=jf(e,n,o);if(h){let x=1<<o.z,T=ds(s.center.lng),I=fs(s.center.lat),M=(o.x+.5)/x-T,S=0;M>.5?S=-1:M<-.5&&(S=1);let R=(e/Xe+o.x)/x+S,L=(n/Xe+o.y)/x;R=(R-T)*s._pixelsPerMercatorPixel+T,L=(L-I)*s._pixelsPerMercatorPixel+I;let k=[R*s.worldSize,L*s.worldSize,0];r.$.transformMat4(k,k,h),y=na(y,k,m)}return r.$.transformMat4(y,y,u)}_makeGlobeTileDebugBorderBuffer(e,n,o,s,u,h){let m=new Lo,y=new Of,x=new pg,T=(M,S,R,L,k)=>{let B=(R-M)/(k-1),Z=(L-S)/(k-1),W=m.length;for(let X=0;X<k;X++){let re=M+X*B,ie=S+X*Z;m.emplaceBack(re,ie);let le=this._globePoint(re,ie,n,o,s,u,h);x.emplaceBack(le[0],le[1],le[2]),y.emplaceBack(W+X)}},I=Xe;T(0,0,I,0,16),T(I,0,I,I,16),T(I,I,0,I,16),T(0,I,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(m,Bf.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(x,DT.members),this._tileDebugSegments=Zn.simpleSegment(0,0,m.length,y.length)}_makeGlobeTileDebugTextBuffer(e,n,o,s,u,h){let m=Xe/4,y=new Lo,x=new vr,T=new pg,I=25;x.reserve(32),y.reserve(I),T.reserve(I);let M=(S,R)=>I*S+R;for(let S=0;S<I;S++){let R=S*m;for(let L=0;L<I;L++){let k=L*m;y.emplaceBack(k,R);let B=this._globePoint(k,R,n,o,s,u,h);T.emplaceBack(B[0],B[1],B[2])}}for(let S=0;S<4;S++)for(let R=0;R<4;R++){let L=M(S,R),k=M(S,R+1),B=M(S+1,R),Z=M(S+1,R+1);x.emplaceBack(L,k,B),x.emplaceBack(B,k,Z)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(x),this._tileDebugTextBuffer=e.createVertexBuffer(y,Bf.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(T,DT.members),this._tileDebugTextSegments=Zn.simpleSegment(0,0,I,32)}destroy(e=!1){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof mo&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function dO(t,e,n){t===1?e.header_length=n.readFixed32():t===2?e.x=n.readVarint():t===3?e.y=n.readVarint():t===4?e.z=n.readVarint():t===5&&e.layers.push(function(o,s){return o.readFields(_O,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},s)}(n,n.readVarint()+n.pos))}function fO(t,e,n){t===1?(e.delta_filter=function(o,s){return o.readFields(pO,{block_size:0},s)}(n,n.readVarint()+n.pos),e.filter="delta_filter"):t===2?(n.readVarint(),e.filter="zigzag_filter"):t===3?(n.readVarint(),e.filter="bitshuffle_filter"):t===4&&(n.readVarint(),e.filter="byteshuffle_filter")}function pO(t,e,n){t===1&&(e.block_size=n.readVarint())}function mO(t,e,n){t===1?(n.readVarint(),e.codec="gzip_data"):t===2?(n.readVarint(),e.codec="jpeg_image"):t===3?(n.readVarint(),e.codec="webp_image"):t===4&&(n.readVarint(),e.codec="png_image")}function gO(t,e,n){t===1?e.first_byte=n.readFixed64():t===2?e.last_byte=n.readFixed64():t===3?e.filters.push(function(o,s){return o.readFields(fO,{},s)}(n,n.readVarint()+n.pos)):t===4?e.codec=function(o,s){return o.readFields(mO,{},s)}(n,n.readVarint()+n.pos):t===5?e.deprecated_offset=n.readFloat():t===6?e.deprecated_scale=n.readFloat():t===7?e.bands.push(n.readString()):t===8?e.offset=n.readDouble():t===9&&(e.scale=n.readDouble())}function _O(t,e,n){t===1?e.version=n.readVarint():t===2?e.name=n.readString():t===3?e.units=n.readString():t===4?e.tilesize=n.readVarint():t===5?e.buffer=n.readVarint():t===6?e.pixel_format=n.readVarint():t===7&&e.data_index.push(function(o,s){return o.readFields(gO,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},s)}(n,n.readVarint()+n.pos))}function yO(t,e,n){if(t===2)(function(o,s,u){o.readFields(vO,u,s)})(n,n.readVarint()+n.pos,e);else if(t===3)throw new Error("Not implemented")}function vO(t,e,n){if(t===1){let o=0,s=n.readVarint()+n.pos;for(;n.pos<s;)e[o++]=n.readVarint()}}class xO{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;let n=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,n),n}put(e,n){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,n)}}function bO(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let o=2;o>=1;o--){let s=o===1?1:0,u=o===2?1:0;for(let h=0;h<e[0];h++){let m=e[1]*h;for(let y=s;y<e[1];y++){let x=e[2]*(y+m);for(let T=u;T<e[2];T++){let I=e[3]*(T+x);for(let M=0;M<e[3];M++){let S=I+M;t[S]+=t[S-n]}}}}n*=e[o]}return t}function wO(t){for(let e=0,n=t.length;e<n;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function TO(t,e){switch(e){case"uint32":return t;case"uint16":for(let n=0;n<t.length;n+=2){let o=t[n],s=t[n+1];t[n]=(240&o)>>4|(61440&o)>>8|(240&s)<<4|61440&s,t[n+1]=15&o|(3840&o)>>4|(15&s)<<8|(3840&s)<<4}return t;case"uint8":for(let n=0;n<t.length;n+=4){let o=t[n],s=t[n+1],u=t[n+2],h=t[n+3];t[n+0]=(192&o)>>6|(192&s)>>4|(192&u)>>2|192&h,t[n+1]=(48&o)>>4|(48&s)>>2|48&u|(48&h)<<2,t[n+2]=(12&o)>>2|12&s|(12&u)<<2|(12&h)<<4,t[n+3]=3&o|(3&s)<<2|(3&u)<<4|(3&h)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}var Ji=Uint8Array,ap=Uint16Array,EO=Int32Array,zI=new Ji([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),BI=new Ji([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),IO=new Ji([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),jI=function(t,e){for(var n=new ap(31),o=0;o<31;++o)n[o]=e+=1<<t[o-1];var s=new EO(n[30]);for(o=1;o<30;++o)for(var u=n[o];u<n[o+1];++u)s[u]=u-n[o]<<5|o;return{b:n,r:s}},VI=jI(zI,2),UI=VI.b,MO=VI.r;UI[28]=258,MO[258]=28;for(var DO=jI(BI,0).b,$I=new ap(32768),ar=0;ar<32768;++ar){var Nh=(43690&ar)>>1|(21845&ar)<<1;$I[ar]=((65280&(Nh=(61680&(Nh=(52428&Nh)>>2|(13107&Nh)<<2))>>4|(3855&Nh)<<4))>>8|(255&Nh)<<8)>>1}var lp=function(t,e,n){for(var o=t.length,s=0,u=new ap(e);s<o;++s)t[s]&&++u[t[s]-1];var h,m=new ap(e);for(s=1;s<e;++s)m[s]=m[s-1]+u[s-1]<<1;h=new ap(1<<e);var y=15-e;for(s=0;s<o;++s)if(t[s])for(var x=s<<4|t[s],T=e-t[s],I=m[t[s]-1]++<<T,M=I|(1<<T)-1;I<=M;++I)h[$I[I]>>y]=x;return h},cp=new Ji(288);for(ar=0;ar<144;++ar)cp[ar]=8;for(ar=144;ar<256;++ar)cp[ar]=9;for(ar=256;ar<280;++ar)cp[ar]=7;for(ar=280;ar<288;++ar)cp[ar]=8;var GI=new Ji(32);for(ar=0;ar<32;++ar)GI[ar]=5;var CO=lp(cp,9),SO=lp(GI,5),Xv=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},jo=function(t,e,n){var o=e/8|0;return(t[o]|t[o+1]<<8)>>(7&e)&n},Yv=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},AO=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Vo=function(t,e,n){var o=new Error(e||AO[t]);if(o.code=t,Error.captureStackTrace&&Error.captureStackTrace(o,Vo),!n)throw o;return o},PO=new Ji(0),RO=typeof TextDecoder<"u"&&new TextDecoder;try{RO.decode(PO,{stream:!0})}catch{}let OO={gzip_data:"gzip"};class _o extends Error{constructor(e){super(e),this.name="MRTError"}}let LO={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},HI={uint32:1,uint16:2,uint8:4},kO={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array},Qv,Kv;class up{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){let n=this.layers[e];if(!n)throw new _o(`Layer '${e}' not found`);return n}getHeaderLength(e){let n=new Uint8Array(e),o=new DataView(e);if(n[0]!==13)throw new _o("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){let n=new Uint8Array(e),o=this.getHeaderLength(e);if(n.length<o)throw new _o(`Expected header with length >= ${o} but got buffer of length ${n.length}`);let s=function(u,h){return u.readFields(dO,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new Qv(n.subarray(0,o)));if(!isNaN(this.x)&&(this.x!==s.x||this.y!==s.y||this.z!==s.z))throw new _o(`Invalid attempt to parse header ${s.z}/${s.x}/${s.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=s.x,this.y=s.y,this.z=s.z;for(let u of s.layers)this.layers[u.name]=new FO(u,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let n=[],o=this.getLayer(e.layerName);for(let s of e.blockIndices){let u=o.dataIndex[s],h=u.first_byte-e.firstByte,m=u.last_byte-e.firstByte;if(o._blocksInProgress.has(s))continue;let y={layerName:o.name,firstByte:h,lastByte:m,pixelFormat:o.pixelFormat,blockIndex:s,blockShape:[u.bands.length].concat(o.bandShape),buffer:o.buffer,codec:u.codec.codec,filters:u.filters.map(x=>x.filter)};o._blocksInProgress.add(s),n.push(y)}return new qI(n,()=>{n.forEach(s=>o._blocksInProgress.delete(s.blockIndex))},(s,u)=>{if(n.forEach(h=>o._blocksInProgress.delete(h.blockIndex)),s)throw s;u.forEach(h=>{this.getLayer(h.layerName).processDecodedData(h)})})}}class FO{constructor({version:e,name:n,units:o,tilesize:s,pixel_format:u,buffer:h,data_index:m},y){if(this.version=e,this.version!==1)throw new _o(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=o,this.tileSize=s,this.buffer=h,this.pixelFormat=LO[u],this.dataIndex=m,this.bandShape=[s+2*h,s+2*h,HI[this.pixelFormat]],this._decodedBlocks=new xO(y?y.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return HI[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){let n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.put(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(let[o,s]of this.dataIndex.entries()){for(let[u,h]of s.bands.entries())if(h===e)return{bandIndex:n+u,blockIndex:o,blockBandIndex:u};n+=s.bands.length}break;case"number":for(let[o,s]of this.dataIndex.entries()){if(e>=n&&e<n+s.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-n};n+=s.bands.length}break;default:throw new _o(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new _o(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,o=-1/0,s=[],u=new Set;for(let h of e){let{blockIndex:m}=this.getBlockForBand(h);if(m<0)throw new _o(`Invalid band: ${JSON.stringify(h)}`);let y=this.dataIndex[m];s.includes(m)||s.push(m),u.add(m),n=Math.min(n,y.first_byte),o=Math.max(o,y.last_byte)}if(u.size>this.cacheSize)throw new _o(`Number of blocks to decode (${u.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:n,lastByte:o,blockIndices:s}}hasBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){let{blockIndex:n,blockBandIndex:o}=this.getBlockForBand(e),s=this._decodedBlocks.get(n.toString());if(!s)throw new _o(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let u=this.dataIndex[n],h=this.bandShape.reduce((x,T)=>x*T,1),m=o*h,y=s.subarray(m,m+h);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:u.offset!==0?u.offset:u.deprecated_offset,scale:u.scale!==0?u.scale:u.deprecated_scale}}}up.setPbf=function(t){Qv=t};class qI{constructor(e,n,o){this.tasks=e,this._onCancel=n,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}up.performDecoding=function(t,e){let n=new Uint8Array(t);return Promise.all(e.tasks.map(o=>{let{layerName:s,firstByte:u,lastByte:h,pixelFormat:m,blockShape:y,blockIndex:x,filters:T,codec:I}=o,M=n.subarray(u,h+1),S=new Uint32Array(y[0]*y[1]*y[2]),R;if(I!=="gzip_data")throw new _o(`Unhandled codec: ${I}`);return R=function(L,k){if(!globalThis.DecompressionStream&&k==="gzip_data")return Promise.resolve(((X=function(le){le[0]==31&&le[1]==139&&le[2]==8||Vo(6,"invalid gzip data");var ge=le[3],we=10;4&ge&&(we+=2+(le[10]|le[11]<<8));for(var Ce=(ge>>3&1)+(ge>>4&1);Ce>0;Ce-=!le[we++]);return we+(2&ge)}(W=L))+8>W.length&&Vo(6,"invalid gzip data"),function(le,ge,we,Ce){var Te=le.length;if(!Te||ge.f&&!ge.l)return we||new Ji(0);var Oe=!we,$e=Oe||ge.i!=2,Le=ge.i;Oe&&(we=new Ji(3*Te));var qe,Re,ze=function(gl){var Wc=we.length;if(gl>Wc){var xp=new Ji(Math.max(2*Wc,gl));xp.set(we),we=xp}},Ze=ge.f||0,ke=ge.p||0,Qe=ge.b||0,We=ge.l,Ge=ge.d,ft=ge.m,ht=ge.n,ot=8*Te;do{if(!We){Ze=jo(le,ke,1);var Ye=jo(le,ke+1,3);if(ke+=3,!Ye){var vt=le[(St=4+((ke+7)/8|0))-4]|le[St-3]<<8,dt=St+vt;if(dt>Te){Le&&Vo(0);break}$e&&ze(Qe+vt),we.set(le.subarray(St,dt),Qe),ge.b=Qe+=vt,ge.p=ke=8*dt,ge.f=Ze;continue}if(Ye==1)We=CO,Ge=SO,ft=9,ht=5;else if(Ye==2){var lt=jo(le,ke,31)+257,Et=jo(le,ke+10,15)+4,Ct=lt+jo(le,ke+5,31)+1;ke+=14;for(var It=new Ji(Ct),Nt=new Ji(19),Zt=0;Zt<Et;++Zt)Nt[IO[Zt]]=jo(le,ke+3*Zt,7);ke+=3*Et;var $t=Xv(Nt),Cn=(1<<$t)-1,On=lp(Nt,$t);for(Zt=0;Zt<Ct;){var St,gn=On[jo(le,ke,Cn)];if(ke+=15&gn,(St=gn>>4)<16)It[Zt++]=St;else{var xn=0,zn=0;for(St==16?(zn=3+jo(le,ke,3),ke+=2,xn=It[Zt-1]):St==17?(zn=3+jo(le,ke,7),ke+=3):St==18&&(zn=11+jo(le,ke,127),ke+=7);zn--;)It[Zt++]=xn}}var Kn=It.subarray(0,lt),lr=It.subarray(lt);ft=Xv(Kn),ht=Xv(lr),We=lp(Kn,ft),Ge=lp(lr,ht)}else Vo(1);if(ke>ot){Le&&Vo(0);break}}$e&&ze(Qe+131072);for(var Jn=(1<<ft)-1,Yn=(1<<ht)-1,xr=ke;;xr=ke){var hr=(xn=We[Yv(le,ke)&Jn])>>4;if((ke+=15&xn)>ot){Le&&Vo(0);break}if(xn||Vo(2),hr<256)we[Qe++]=hr;else{if(hr==256){xr=ke,We=null;break}var Ur=hr-254;hr>264&&(Ur=jo(le,ke,(1<<($o=zI[Zt=hr-257]))-1)+UI[Zt],ke+=$o);var Fn=Ge[Yv(le,ke)&Yn],Ii=Fn>>4;if(Fn||Vo(3),ke+=15&Fn,lr=DO[Ii],Ii>3){var $o=BI[Ii];lr+=Yv(le,ke)&(1<<$o)-1,ke+=$o}if(ke>ot){Le&&Vo(0);break}$e&&ze(Qe+131072);var yo=Qe+Ur;if(Qe<lr){var vo=0-lr,qc=Math.min(lr,yo);for(vo+Qe<0&&Vo(3);Qe<qc;++Qe)we[Qe]=(void 0)[vo+Qe]}for(;Qe<yo;++Qe)we[Qe]=we[Qe-lr]}}ge.l=We,ge.p=xr,ge.b=Qe,ge.f=Ze,We&&(Ze=1,ge.m=ft,ge.d=Ge,ge.n=ht)}while(!Ze);return Qe!=we.length&&Oe?(qe=we,((Re=Qe)==null||Re>qe.length)&&(Re=qe.length),new Ji(qe.subarray(0,Re))):we.subarray(0,Qe)}(W.subarray(X,-8),{i:2},new Ji(((B=W)[(Z=B.length)-4]|B[Z-3]<<8|B[Z-2]<<16|B[Z-1]<<24)>>>0))));var B,Z,W,X;let re=OO[k];if(!re)throw new Error(`Unhandled codec: ${k}`);let ie=new globalThis.DecompressionStream(re);return new Response(new Blob([L]).stream().pipeThrough(ie)).arrayBuffer().then(le=>new Uint8Array(le))}(M,I).then(L=>(function(k,B){k.readFields(yO,B)}(new Qv(L),S),new kO[m](S.buffer))),R.then(L=>{for(let k=T.length-1;k>=0;k--)switch(T[k]){case"delta_filter":bO(L,y);break;case"zigzag_filter":wO(L);break;case"bitshuffle_filter":TO(L,m);break;default:throw new _o(`Unhandled filter "${T[k]}"`)}return{layerName:s,blockIndex:x,data:L}}).catch(L=>{throw L})}))},up.setPbf(Qf);class WI extends s_{constructor(e,n,o,s,u){super(e,n,o,s,u),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,n){let o=n.context,s=o.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof mo?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new mo(o,e,s.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,n){let o=this._mrt=new up(30),s=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=Bs(s,(u,h,m,y)=>{if(u)n(u);else try{let x=o.getHeaderLength(h);if(x>e)return void(this.request=this.fetchHeader(x,n));o.parseHeader(h),this._isHeaderLoaded=!0;let T=0;for(let I of Object.values(o.layers))T=Math.max(T,I.dataIndex[I.dataIndex.length-1].last_byte);h.byteLength>=T&&(this.entireBuffer=h),n(null,this.entireBuffer||h,m,y)}catch(x){n(x)}}),this.request}fetchBand(e,n,o){let s=this._mrt;if(!this._isHeaderLoaded||!s)return void o(new Error("Tile header is not ready"));let u=this.actor;if(!u)return void o(new Error("Can't fetch tile band without an actor"));let h,m=(I,M)=>{h.complete(I,M),I?o(I):(this.updateTextureDescriptor(e,n),o(null,this.textureDescriptor&&this.textureDescriptor.img))},y=(I,M)=>{if(I)return o(I);let S=u.send("decodeRasterArray",{buffer:M,task:h},m,void 0,!0);this._workQueue.push(()=>{S&&S.cancel(),h.cancel()})},x=s.getLayer(e);if(!x)return void o(new Error(`Unknown sourceLayer "${e}"`));if(x.hasDataForBand(n))return this.updateTextureDescriptor(e,n),void o(null,this.textureDescriptor?this.textureDescriptor.img:null);let T=x.getDataRange([n]);if(h=s.createDecodingTask(T),!h||h.tasks.length)if(this.flushQueues(),this.entireBuffer)y(null,this.entireBuffer.slice(T.firstByte,T.lastByte+1));else{let I=Object.assign({},this.requestParams,{headers:{Range:`bytes=${T.firstByte}-${T.lastByte}`}}),M=Bs(I,y);this._fetchQueue.push(()=>{M.cancel(),h.cancel()})}else o(null)}updateNeeded(e,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,n){if(!this._mrt)return;let o=this._mrt.getLayer(e);if(!o||!o.hasBand(n)||!o.hasDataForBand(n))return;let{bytes:s,tileSize:u,buffer:h,offset:m,scale:y}=o.getBandView(n),x=u+2*h,T={data:s,width:x,height:x},I=this.texture;I&&I instanceof mo&&I.update(T,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:n,img:T,buffer:h,offset:m,tileSize:u,format:o.pixelFormat,mix:[y,256*y,65536*y,16777216*y]}}}class NO{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,o){let s=e.wrapped().key;this.data[s]===void 0&&(this.data[s]=[]);let u={value:n,timeout:void 0};if(o!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},o)),this.data[s].push(u),this.order.push(s),this.order.length>this.max){let h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let o=e.wrapped().key,s=n===void 0?0:this.data[o].indexOf(n),u=this.data[o][s];return this.data[o].splice(s,1),u.timeout&&clearTimeout(u.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(u.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let o in this.data)for(let s of this.data[o])e(s.value)||n.push(s);for(let o of n)this.remove(o.value.tileID,o)}}class Uc extends $s{constructor(e,n,o){super(),this.id=e,this._onlySymbols=o,n.on("data",s=>{s.dataType==="source"&&s.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&s.dataType==="source"&&s.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new NO(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new OR,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let o=this._tiles[n];o.upload(e),o.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return qd(this._tiles).map(e=>e.tileID).sort(ZI).map(e=>e.key)}getRenderableIds(e,n){let o=[];for(let s in this._tiles)this._isIdRenderable(+s,e,n)&&o.push(this._tiles[s]);return e?o.sort((s,u)=>{let h=s.tileID,m=u.tileID,y=new Je(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),x=new Je(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-m.overscaledZ||x.y-y.y||x.x-y.x}).map(s=>s.tileID.key):o.map(s=>s.tileID).sort(ZI).map(s=>s.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(o||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){let o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=n),this._loadTile(o,this._tileLoaded.bind(this,o,e,n)))}_tileLoaded(e,n,o,s){if(s)if(e.state="errored",s.status!==404)this._source.fire(new hc(s,{tile:e}));else{if(this._source.fire(new co("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:e})),!(e.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=kr.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new co("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let n=this.getRenderableIds();for(let s=0;s<n.length;s++){let u=n[s];if(e.neighboringTiles&&e.neighboringTiles[u]){let h=this.getTileByID(u);o(e,h),o(h,e)}}function o(s,u){if(!s.dem||s.dem.borderReady)return;s.needsHillshadePrepare=!0,s.needsDEMTextureUpload=!0;let h=u.tileID.canonical.x-s.tileID.canonical.x,m=u.tileID.canonical.y-s.tileID.canonical.y,y=Math.pow(2,s.tileID.canonical.z),x=u.tileID.key;h===0&&m===0||Math.abs(m)>1||(Math.abs(h)>1&&(Math.abs(h+y)===1?h+=y:Math.abs(h-y)===1&&(h-=y)),u.dem&&s.dem&&(s.dem.backfillBorder(u.dem,h,m),s.neighboringTiles&&s.neighboringTiles[x]&&(s.neighboringTiles[x].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,o,s){for(let u in this._tiles){let h=this._tiles[u];if(s[u]||!h.hasData()||h.tileID.overscaledZ<=n||h.tileID.overscaledZ>o)continue;let m=h.tileID;for(;h&&h.tileID.overscaledZ>n+1;){let x=h.tileID.scaledTo(h.tileID.overscaledZ-1);h=this._tiles[x.key],h&&h.hasData()&&(m=x)}let y=m;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){s[m.key]=m;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=e.overscaledZ-1;o>=n;o--){let s=e.scaledTo(o),u=this._getLoadedTile(s);if(u)return u}}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;let o=Math.ceil(e.width/n)+1,s=Math.ceil(e.height/n)+1,u=Math.floor(o*s*5),h=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(m)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let o={};for(let s in this._tiles){let u=this._tiles[s];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+n),o[u.tileID.key]=u}this._tiles=o;for(let s in this._timers)clearTimeout(this._timers[s]),delete this._timers[s];for(let s in this._tiles)this._setTileReloadTimer(+s,this._tiles[s])}}update(e,n,o,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!o)return;this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};let u=this._source.type==="batched-model",h;if(this.used||this.usedForTerrain){if(this._source.tileID)h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new fr(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y));else if(this.tileCoverLift!==0){let x=e.clone();x.tileCoverLift=this.tileCoverLift,h=x.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:u}),this._source.minzoom<=1&&e.projection.name==="globe"&&(h.push(new fr(1,0,1,0,0)),h.push(new fr(1,0,1,1,0)),h.push(new fr(1,0,1,0,1)),h.push(new fr(1,0,1,1,1)))}else if(h=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:u}),this._source.hasTile){let x=this._source.hasTile.bind(this._source);h=h.filter(T=>x(T))}}else h=[];if(h.length>0&&this.castsShadows&&s&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Jv(this._source.type)){let x=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!o}),T=Math.min(x,this._source.maxzoom);if(u){let I=e.extendTileCover(h,T);for(let M of I)h.push(M)}else{let I=e.extendTileCover(h,T,s);for(let M of I)this._shadowCasterTiles[M.key]=!0,h.push(M)}}let m=this._updateRetainedTiles(h);if(Jv(this._source.type)&&h.length!==0){let x={},T={},I=Object.keys(m);for(let S of I){let R=m[S],L=this._tiles[S];if(!L||L.fadeEndTime&&L.fadeEndTime<=kr.now())continue;let k=this.findLoadedParent(R,Math.max(R.overscaledZ-Uc.maxOverzooming,this._source.minzoom));k&&(this._addTile(k.tileID),x[k.tileID.key]=k.tileID),T[S]=R}let M=h[h.length-1].overscaledZ;for(let S in this._tiles){let R=this._tiles[S];if(m[S]||!R.hasData())continue;let L=R.tileID;for(;L.overscaledZ>M;){L=L.scaledTo(L.overscaledZ-1);let k=this._tiles[L.key];if(k&&k.hasData()&&T[L.key]){m[S]=R.tileID;break}}}for(let S in x)m[S]||(this._coveredTiles[S]=!0,m[S]=x[S])}for(let x in m)this._tiles[x].clearFadeHold();let y=function(x,T){let I=[];for(let M in x)M in T||I.push(M);return I}(this._tiles,m);for(let x of y){let T=this._tiles[x];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let n={};if(e.length===0)return n;let o={},s=e.reduce((x,T)=>Math.min(x,T.overscaledZ),1/0),u=e[0].overscaledZ,h=Math.max(u-Uc.maxOverzooming,this._source.minzoom),m=Math.max(u+Uc.maxUnderzooming,this._source.minzoom),y={};for(let x of e){let T=this._addTile(x);n[x.key]=x,T.hasData()||s<this._source.maxzoom&&(y[x.key]=x)}this._retainLoadedChildren(y,s,m,n);for(let x of e){let T=this._tiles[x.key];if(T.hasData())continue;if(x.canonical.z>=this._source.maxzoom){let M=x.children(this._source.maxzoom)[0],S=this.getTile(M);if(S&&S.hasData()){n[M.key]=M;continue}}else{let M=x.children(this._source.maxzoom);if(n[M[0].key]&&n[M[1].key]&&n[M[2].key]&&n[M[3].key])continue}let I=T.wasRequested();for(let M=x.overscaledZ-1;M>=h;--M){let S=x.scaledTo(M);if(o[S.key]||(o[S.key]=!0,T=this.getTile(S),!T&&I&&(T=this._addTile(S)),T&&(n[S.key]=S,I=T.wasRequested(),T.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],o,s=this._tiles[e].tileID;for(;s.overscaledZ>0;){if(s.key in this._loadedParentTiles){o=this._loadedParentTiles[s.key];break}n.push(s.key);let u=s.scaledTo(s.overscaledZ-1);if(o=this._getLoadedTile(u),o)break;s=u}for(let u of n)this._loadedParentTiles[u]=o}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let o=!!n;if(!o){let s=this.map?this.map.painter:null,u=this._source.tileSize*e.overscaleFactor();n=this._source.type==="raster-array"?new WI(e,u,this.transform.tileZoom,s,this._isRaster):new s_(e,u,this.transform.tileZoom,s,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,o||this._source.fire(new co("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let o=n.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,o){let s=[],u=this.transform;if(!u)return s;let h=u.projection.name==="globe",m=ds(u.center.lng);for(let y in this._tiles){let x=this._tiles[y];if(o&&x.clearQueryDebugViz(),x.holdingForFade())continue;let T;if(h){let I=x.tileID.canonical;if(I.z===0){let M=[Math.abs(jt(m,...hp(I,-1))-m),Math.abs(jt(m,...hp(I,1))-m)];T=[0,2*M.indexOf(Math.min(...M))-1]}else{let M=[Math.abs(jt(m,...hp(I,-1))-m),Math.abs(jt(m,...hp(I,0))-m),Math.abs(jt(m,...hp(I,1))-m)];T=[M.indexOf(Math.min(...M))-1]}}else T=[0];for(let I of T){let M=e.containsTile(x,u,n,I);M&&s.push(M)}}return s}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){let o=this.getRenderableIds(e,n).map(u=>this._tiles[u].tileID),s=this.transform.projection.name==="globe";for(let u of o)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped()),u.expandedProjMatrix=s?this.transform.calculateProjMatrix(u.toUnwrapped(),!1,!0):u.projMatrix;return o}sortCoordinatesByDistance(e){let n=e.slice(),o=this.transform._camera.position,s=this.transform._camera.forward(),u={};for(let h of n){let m=1/(1<<h.canonical.z);u[h.key]=((h.canonical.x+.5)*m+h.wrap-o[0])*s[0]+((h.canonical.y+.5)*m-o[1])*s[1]-o[2]*s[2]}return n.sort((h,m)=>u[h.key]-u[m.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(Jv(this._source.type))for(let e in this._tiles){let n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=kr.now())return!0}return!1}setFeatureState(e,n,o){this._state.updateState(e=e||"_geojsonTileLayer",n,o)}removeFeatureState(e,n,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,o)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,o){let s=this._tiles[e];s&&s.setDependencies(n,o)}reloadTilesForDependencies(e,n){for(let o in this._tiles)this._tiles[o].hasDependency(e,n)&&this._reloadTile(+o,"reloading");this._cache.filter(o=>!o.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){let m=()=>{this._sourceLoaded&&(this._source.off("data",m),this._preloadTiles(e,n))};return void this._source.on("data",m)}let o=new Map,s=Array.isArray(e)?e:[e],u=this.map.painter.terrain,h=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(let m of s){let y=m.coveringTiles({tileSize:h,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let x of y)o.set(x.key,x);this.usedForTerrain&&m.updateElevation(!1)}Xl(Array.from(o.values()),(m,y)=>{let x=new s_(m,this._source.tileSize*m.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(x,T=>{this._source.type==="raster-dem"&&x.dem&&this._backfillDEM(x),y(T,x)})},n)}}function ZI(t,e){let n=Math.abs(2*t.wrap)-+(t.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||o-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Jv(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function hp(t,e){let n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}Uc.maxOverzooming=10,Uc.maxUnderzooming=3;let XI=()=>Kv||(Kv={layout:HE||(HE=new Rn({"line-cap":new ct(Ie.layout_line["line-cap"]),"line-join":new ct(Ie.layout_line["line-join"]),"line-miter-limit":new He(Ie.layout_line["line-miter-limit"]),"line-round-limit":new He(Ie.layout_line["line-round-limit"]),"line-sort-key":new ct(Ie.layout_line["line-sort-key"]),"line-z-offset":new ct(Ie.layout_line["line-z-offset"]),visibility:new He(Ie.layout_line.visibility)})),paint:qE||(qE=new Rn({"line-opacity":new ct(Ie.paint_line["line-opacity"]),"line-color":new ct(Ie.paint_line["line-color"]),"line-translate":new He(Ie.paint_line["line-translate"]),"line-translate-anchor":new He(Ie.paint_line["line-translate-anchor"]),"line-width":new ct(Ie.paint_line["line-width"]),"line-gap-width":new ct(Ie.paint_line["line-gap-width"]),"line-offset":new ct(Ie.paint_line["line-offset"]),"line-blur":new ct(Ie.paint_line["line-blur"]),"line-dasharray":new ct(Ie.paint_line["line-dasharray"]),"line-pattern":new ct(Ie.paint_line["line-pattern"]),"line-gradient":new Yr(Ie.paint_line["line-gradient"]),"line-trim-offset":new He(Ie.paint_line["line-trim-offset"]),"line-trim-fade-range":new He(Ie.paint_line["line-trim-fade-range"]),"line-trim-color":new He(Ie.paint_line["line-trim-color"]),"line-emissive-strength":new He(Ie.paint_line["line-emissive-strength"]),"line-border-width":new ct(Ie.paint_line["line-border-width"]),"line-border-color":new ct(Ie.paint_line["line-border-color"]),"line-occlusion-opacity":new He(Ie.paint_line["line-occlusion-opacity"])}))},Kv);class zO extends ct{possiblyEvaluate(e,n){return n=new xt(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,o,s){return n=Rr({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,o,s)}}let dp,YI,QI,ex;function KI(t,e){return e>0?e+2*t:t}class JI{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:mi,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}me(JI,"FormatSectionOverride",{omit:["defaultValue"]});let tx=()=>ex||(ex={layout:YI||(YI=new Rn({"symbol-placement":new He(Ie.layout_symbol["symbol-placement"]),"symbol-spacing":new He(Ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new He(Ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ct(Ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new He(Ie.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new He(Ie.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new He(Ie.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new He(Ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new He(Ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new He(Ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new ct(Ie.layout_symbol["icon-size"]),"icon-text-fit":new ct(Ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ct(Ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new ct(Ie.layout_symbol["icon-image"]),"icon-rotate":new ct(Ie.layout_symbol["icon-rotate"]),"icon-padding":new He(Ie.layout_symbol["icon-padding"]),"icon-keep-upright":new He(Ie.layout_symbol["icon-keep-upright"]),"icon-offset":new ct(Ie.layout_symbol["icon-offset"]),"icon-anchor":new ct(Ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new He(Ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new He(Ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new He(Ie.layout_symbol["text-rotation-alignment"]),"text-field":new ct(Ie.layout_symbol["text-field"]),"text-font":new ct(Ie.layout_symbol["text-font"]),"text-size":new ct(Ie.layout_symbol["text-size"]),"text-max-width":new ct(Ie.layout_symbol["text-max-width"]),"text-line-height":new ct(Ie.layout_symbol["text-line-height"]),"text-letter-spacing":new ct(Ie.layout_symbol["text-letter-spacing"]),"text-justify":new ct(Ie.layout_symbol["text-justify"]),"text-radial-offset":new ct(Ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new He(Ie.layout_symbol["text-variable-anchor"]),"text-anchor":new ct(Ie.layout_symbol["text-anchor"]),"text-max-angle":new He(Ie.layout_symbol["text-max-angle"]),"text-writing-mode":new He(Ie.layout_symbol["text-writing-mode"]),"text-rotate":new ct(Ie.layout_symbol["text-rotate"]),"text-padding":new He(Ie.layout_symbol["text-padding"]),"text-keep-upright":new He(Ie.layout_symbol["text-keep-upright"]),"text-transform":new ct(Ie.layout_symbol["text-transform"]),"text-offset":new ct(Ie.layout_symbol["text-offset"]),"text-allow-overlap":new He(Ie.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new He(Ie.layout_symbol["text-ignore-placement"]),"text-optional":new He(Ie.layout_symbol["text-optional"]),visibility:new He(Ie.layout_symbol.visibility)})),paint:QI||(QI=new Rn({"icon-opacity":new ct(Ie.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ct(Ie.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ct(Ie.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ct(Ie.paint_symbol["text-emissive-strength"]),"icon-color":new ct(Ie.paint_symbol["icon-color"]),"icon-halo-color":new ct(Ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new ct(Ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ct(Ie.paint_symbol["icon-halo-blur"]),"icon-translate":new He(Ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new He(Ie.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ct(Ie.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ct(Ie.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ct(Ie.paint_symbol["text-occlusion-opacity"]),"text-color":new ct(Ie.paint_symbol["text-color"],{runtimeType:ki,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ct(Ie.paint_symbol["text-halo-color"]),"text-halo-width":new ct(Ie.paint_symbol["text-halo-width"]),"text-halo-blur":new ct(Ie.paint_symbol["text-halo-blur"]),"text-translate":new He(Ie.paint_symbol["text-translate"]),"text-translate-anchor":new He(Ie.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new He(Ie.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new He(Ie.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new He(Ie.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new He(Ie.paint_symbol["icon-color-brightness-max"])}))},ex);class a_ extends Ti{constructor(e,n,o,s){super(e,tx(),n,o,s),this._colorAdjustmentMatrix=r.ae.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let o=this.layout.get("text-writing-mode");if(o){let s=[];for(let u of o)s.indexOf(u)<0&&s.push(u);this.layout._values["text-writing-mode"]=s}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,o,s){return this._saturation===e&&this._contrast===n&&this._brightnessMin===o&&this._brightnessMax===s||(this._colorAdjustmentMatrix=function(u,h,m,y){u=Im(u),h=Em(h);let x=r.ae.create(),T=u/3,I=1-2*T,M=[I,T,T,0,T,I,T,0,T,T,I,0,0,0,0,1],S=.5-.5*h,R=y-m;return r.ae.multiply(x,[R,0,0,0,0,R,0,0,0,0,R,0,m,m,m,1],[h,0,0,0,0,h,0,0,0,0,h,0,S,S,S,1]),r.ae.multiply(x,x,M),x}(e,n,o,s),this._saturation=e,this._contrast=n,this._brightnessMin=o,this._brightnessMax=s),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,o,s){let u=this.layout.get(e).evaluate(n,{},o,s),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||J(h.value)||!u?u:function(m,y){return y.replace(/{([^{}]+)}/g,(x,T)=>T in m?String(m[T]):"")}(n.properties,u)}createBucket(e){return new kh(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of tx().paint.overridableProperties){if(!a_.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),o=new JI(n),s=new K(o,n.property.specification,this.scope,this.options),u=null;u=n.value.kind==="constant"||n.value.kind==="source"?new se("source",s):new te("composite",s,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new yr(n.property,u,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&a_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let o=e.get("text-field"),s=tx().paint.properties[n],u=!1,h=m=>{for(let y of m)if(s.overrides&&s.overrides.hasOverride(y))return void(u=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Xr)h(o.value.value.sections);else if(o.value.kind==="source"){let m=x=>{u||(x instanceof Xi&&ur(x.value)===Ga?h(x.value.sections):x instanceof Hs?h(x.sections):x.eachChild(m))},y=o.value;y._styleExpression&&m(y._styleExpression.expression)}return u}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,o=[];return e&&o.push("symbolIcon"),n&&o.push("symbolSDF"),o}getDefaultProgramParams(e,n,o){return{config:new kc(this,{zoom:n,lut:o}),overrideFog:!1}}}let eM,tM,nM,rM;function l_(t,e,n,o,s,u,h,m){let y=[t,e,1,n,o,1,s,u,1],x=[h,m,1],T=r.bE.adjoint([],y),[I,M,S]=r.$.transformMat3(x,x,T);return r.bE.multiply(y,y,[I,0,0,0,M,0,0,0,S])}function iM(t,e,n,o,s,u,h,m){let y=function(x,T,I,M,S,R,L,k){let B=l_(0,0,1,0,1,1,0,1),Z=l_(x,T,I,M,S,R,L,k),W=r.bE.adjoint([],B);return r.bE.multiply(Z,Z,W)}(t,e,n,o,s,u,h,m);return[y[2]/y[8]/Xe,y[5]/y[8]/Xe]}function c_(t){return[t[0],Math.min(Math.max(t[1],-sr),sr)]}class oM extends $s{constructor(e,n,o,s){super(),this.id=e,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(s),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new co("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=ac(this.map._requestManager.transformRequest(this.url,oc.Image),(o,s)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new hc(o)):s&&(this.image=s instanceof HTMLImageElement?kr.getImageData(s):s,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new r_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new co("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof r_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],o=e[0][1];for(let u of e)u[1]>o&&(o=u[1]),u[1]<n&&(n=u[1]);let s=(o+n)/2;if(s>sr?this.onNorthPole=!0:s<-sr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let u=e.map(Qr.fromLngLat);this.tileID=function(h){let m=1/0,y=1/0,x=-1/0,T=-1/0;for(let L of h)m=Math.min(m,L.x),y=Math.min(y,L.y),x=Math.max(x,L.x),T=Math.max(T,L.y);let I=Math.max(x-m,T-y),M=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),S=Math.pow(2,M),R=Math.floor((m+x)/2*S);return R>1&&(R-=1),new Nc(M,R,Math.floor((y+T)/2*S))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new co("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let k in this.tiles){let B=this.tiles[k];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let n=Vc(new Nc(0,0,0),this.map.transform.projection),o=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(k){let B=k[1].x-k[0].x,Z=k[1].y-k[0].y,W=k[2].x-k[1].x,X=k[2].y-k[1].y,re=k[3].x-k[2].x,ie=k[3].y-k[2].y,le=k[0].x-k[3].x,ge=k[0].y-k[3].y,we=B*X-W*Z,Ce=W*ie-re*X,Te=re*ge-le*ie,Oe=le*Z-B*ge;return we>0&&Ce>0&&Te>0&&Oe>0||we<0&&Ce<0&&Te<0&&Oe<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let s=Vc(this.tileID,this.map.transform.projection),[u,h,m,y]=this.coordinates.map(k=>{let B=s.projection.project(k[0],k[1]);return AI(s,B)._round()});this.perspectiveTransform=iM(u.x,u.y,h.x,h.y,m.x,m.y,y.x,y.y);let x=this._boundsArray=new Qs;x.emplaceBack(u.x,u.y,0,0),x.emplaceBack(h.x,h.y,Xe,0),x.emplaceBack(y.x,y.y,0,Xe),x.emplaceBack(m.x,m.y,Xe,Xe),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(x,o_.members),this.boundsSegments=Zn.simpleSegment(0,0,4,2);let T=[],I=function(k){return[c_(k[0]),c_(k[1]),c_(k[2]),c_(k[3])]}(this.coordinates),[M,S,R,L]=function(k){let B=k[0][0],Z=B,W=k[0][1],X=W;for(let re=1;re<k.length;re++)k[re][0]<B?B=k[re][0]:k[re][0]>Z&&(Z=k[re][0]),k[re][1]<W?W=k[re][1]:k[re][1]>X&&(X=k[re][1]);return[B,W,Z-B,X-W]}(I);{let k=new Qs,[B,Z,W,X]=function(Re){let ze=Re[0].x,Ze=ze,ke=Re[0].y,Qe=ke;for(let We=1;We<Re.length;We++)Re[We].x<ze?ze=Re[We].x:Re[We].x>Ze&&(Ze=Re[We].x),Re[We].y<ke?ke=Re[We].y:Re[We].y>Qe&&(Qe=Re[We].y);return[ze,ke,Ze-ze,Qe-ke]}(o),re=Re=>[(Re.x-B)/W,(Re.y-Z)/X],[ie,le,ge,we]=o.map(re),Ce=function(Re,ze,Ze,ke,Qe,We,Ge,ft){let ht=l_(0,0,1,0,1,1,0,1),ot=l_(Re,ze,Ze,ke,Qe,We,Ge,ft),Ye=r.bE.adjoint([],ot);return r.bE.multiply(ht,ht,Ye)}(ie[0],ie[1],le[0],le[1],ge[0],ge[1],we[0],we[1]);this.elevatedGlobePerspectiveTransform=iM(ie[0],ie[1],le[0],le[1],ge[0],ge[1],we[0],we[1]);let Te=(Re,ze)=>{T.push(Re.lng);let Ze=Math.round((Re.lng-M)/R*Xe),ke=Math.round((Re.lat-S)/L*Xe),Qe=re(ze),We=r.$.transformMat3([],[Qe[0],Qe[1],1],Ce),Ge=Math.round(We[0]/We[2]*Xe),ft=Math.round(We[1]/We[2]*Xe);k.emplaceBack(Ze,ke,Ge,ft)},Oe=o[3].x-o[0].x,$e=o[3].y-o[0].y,Le=o[2].x-o[1].x,qe=o[2].y-o[1].y;for(let Re=0;Re<65;Re++){let ze=Re/64,Ze=[o[0].x+ze*Oe,o[0].y+ze*$e],ke=[o[1].x+ze*Le,o[1].y+ze*qe],Qe=ke[0]-Ze[0],We=ke[1]-Ze[1];for(let Ge=0;Ge<65;Ge++){let ft=Ge/64,ht={x:Ze[0]+Qe*ft,y:Ze[1]+We*ft,z:0};Te(n.projection.unproject(ht.x,ht.y),ht)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(k,o_.members)}{this.maxLongitudeTriangleSize=0;let k=[],B=new vr,Z=(W,X,re)=>{B.emplaceBack(W,X,re);let ie=T[W],le=T[X],ge=T[re],we=Math.min(Math.min(ie,le),ge),Ce=Math.max(Math.max(ie,le),ge)-we;Ce>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ce),k.push(we+Ce/2)};for(let W=0;W<64;W++)for(let X=0;X<64;X++){let re=65*W+X,ie=re+1,le=re+65,ge=le+1;Z(re,le,ie),Z(ie,le,ge)}[k,B]=function(W,X){let re=Array.from({length:W.length},(ge,we)=>we);re.sort((ge,we)=>W[ge]-W[we]);let ie=[],le=new vr;for(let ge=0;ge<re.length;ge++){let we=re[ge];ie.push(W[we]);let Ce=3*we,Te=Ce+1;le.emplaceBack(X.uint16[Ce],X.uint16[Te],X.uint16[Te+1])}return[ie,le]}(k,B),this.elevatedGlobeTrianglesCenterLongitudes=k,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(B)}this.elevatedGlobeSegments=Zn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/Xe,0,L/Xe,0,0,S,M,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,o=n.gl;!this._dirty||this.texture instanceof r_||(this.texture?this.texture.update(this.image):(this.texture=new mo(n,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;let o=this.elevatedGlobeTrianglesCenterLongitudes,s=(u=e+180)+360*Math.round((o[0]-u)/360);var u;let h=new Zn,m=(I,M)=>{h.segments.push({vertexOffset:0,primitiveOffset:I,vertexLength:n.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-s)<=y){let I=zu(o,0,o.length,s+y);return I===o.length||m(I,Nu(o,I+1,o.length,s+360-y)-I),h}s<o[0]&&(s+=360);let x=Nu(o,0,o.length,s-y);if(x===o.length)return m(0,o.length),h;m(0,x-0);let T=zu(o,x+1,o.length,s+y);return T!==o.length&&m(T,o.length-T),h}}let BO=(Math.pow(256,2)-1)/16907520;class sM extends Ti{constructor(e,n,o,s){super(e,{layout:nM||(nM=new Rn({visibility:new He(Ie.layout_raster.visibility)})),paint:rM||(rM=new Rn({"raster-opacity":new He(Ie.paint_raster["raster-opacity"]),"raster-color":new Yr(Ie.paint_raster["raster-color"]),"raster-color-mix":new He(Ie.paint_raster["raster-color-mix"]),"raster-color-range":new He(Ie.paint_raster["raster-color-range"]),"raster-hue-rotate":new He(Ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new He(Ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new He(Ie.paint_raster["raster-brightness-max"]),"raster-saturation":new He(Ie.paint_raster["raster-saturation"]),"raster-contrast":new He(Ie.paint_raster["raster-contrast"]),"raster-resampling":new He(Ie.paint_raster["raster-resampling"]),"raster-fade-duration":new He(Ie.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new He(Ie.paint_raster["raster-emissive-strength"]),"raster-array-band":new He(Ie.paint_raster["raster-array-band"]),"raster-elevation":new He(Ie.paint_raster["raster-elevation"])}))},n,o,s),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof oM&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let n=this._transitionablePaint._values["raster-color"].value.expression,[o,s]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(s)||o===this._curRampRange[0]&&s===this._curRampRange[1]||(this.colorRamp=Uf({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:s}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,s])}}let aM,lM,cM,uM,hM;class dM extends Ti{constructor(e,n,o,s){super(e,{layout:aM||(aM=new Rn({visibility:new He(Ie["layout_raster-particle"].visibility)})),paint:lM||(lM=new Rn({"raster-particle-array-band":new He(Ie["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new He(Ie["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Yr(Ie["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new He(Ie["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new He(Ie["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new He(Ie["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new He(Ie["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new He(Ie["paint_raster-particle"]["raster-particle-elevation"])}))},n,o,s),this._updateColorRamp(),this.lastInvalidatedAt=kr.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Uf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=kr.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class jO extends Ti{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function nx(t,e,n){let o=[0,0,1],s=r.aw.identity([]);return r.aw.rotateY(s,s,n?-Gt(t)+Math.PI:Gt(t)),r.aw.rotateX(s,s,-Gt(e)),r.$.transformQuat(o,o,s),r.$.normalize(o,o)}function fM(t,e){let n=u_(t.projection,t.zoom,t.width,t.height),o=function(u,h,m,y,x){let T=new cn(m.lng-180*ml,m.lat),I=new cn(m.lng+180*ml,m.lat),M=u.project(T.lng,T.lat),S=u.project(I.lng,I.lat),R=-Math.atan2(S.y-M.y,S.x-M.x),L=Qr.fromLngLat(m);L.y=jt(L.y,-1+ml,1-ml);let k=L.toLngLat(),B=u.project(k.lng,k.lat),Z=Qr.fromLngLat(k);Z.x+=ml;let W=Z.toLngLat(),X=u.project(W.lng,W.lat),re=gM(X.x-B.x,X.y-B.y,R),ie=Qr.fromLngLat(k);ie.y+=ml;let le=ie.toLngLat(),ge=u.project(le.lng,le.lat),we=gM(ge.x-B.x,ge.y-B.y,R),Ce=Math.abs(re.x)/Math.abs(we.y),Te=r.ae.identity([]);r.ae.rotateZ(Te,Te,-R*(1-(x?0:y)));let Oe=r.ae.identity([]);return r.ae.scale(Oe,Oe,[1,1-(1-Ce)*y,1]),Oe[4]=-we.x/we.y*y,r.ae.rotateZ(Oe,Oe,R),r.ae.multiply(Oe,Te,Oe),Oe}(t.projection,0,t.center,n,e),s=pM(t);return r.ae.scale(o,o,[s,s,1]),o}function pM(t){let e=t.projection,n=u_(t.projection,t.zoom,t.width,t.height),o=mM(e,t.center),s=mM(e,cn.convert(e.center));return Math.pow(2,o*n+(1-n)*s)}function u_(t,e,n,o,s=1/0){let u=t.range;if(!u)return 0;let h=Math.min(s,Math.max(n,o)),m=Math.log(h/1024)/Math.LN2;return Hd(u[0]+m,u[1]+m,e)}let ml=1/4e4;function mM(t,e){let n=jt(e.lat,-sr,sr),o=new cn(e.lng-180*ml,n),s=new cn(e.lng+180*ml,n),u=t.project(o.lng,n),h=t.project(s.lng,n),m=Qr.fromLngLat(o),y=Qr.fromLngLat(s),x=h.x-u.x,T=h.y-u.y,I=y.x-m.x,M=y.y-m.y,S=Math.sqrt((I*I+M*M)/(x*x+T*T));return Math.log(S)/Math.LN2}function gM(t,e,n){let o=Math.cos(n),s=Math.sin(n);return{x:t*o-e*s,y:t*s+e*o}}function _M(t,e,n){r.ae.identity(t),r.ae.rotateZ(t,t,Gt(e[2])),r.ae.rotateX(t,t,Gt(e[0])),r.ae.rotateY(t,t,Gt(e[1])),r.ae.scale(t,t,n),r.ae.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function h_(t,e,n,o,s,u,h,m){let y=[n[0]-e[0],n[1]-e[1],0],x=[o[0]-e[0],o[1]-e[1],0];if(r.$.length(y)<1e-12||r.$.length(x)<1e-12)return r.aw.identity(t);let T=r.$.cross([],y,x);r.$.normalize(T,T),r.$.subtract(x,o,e),y[2]=(u-s)*m,x[2]=(h-s)*m;let I=y;return r.$.cross(I,y,x),r.$.normalize(I,I),r.aw.rotationTo(t,T,I)}function rx(t,e,n=!1){let o=ra(e.zoom),s=function(u,h,m){let y=h.worldSize,x=[u[12],u[13],u[14]],T=Dr(x[1]/y),I=Ei(x[0]/y),M=r.ae.identity([]),S=ui(1,T)*y,R=ui(1,0)*y*zc(T,h.zoom),L=1/bv(y),k=R*L;if(m){let X=u_(h.projection,h.zoom,h.width,h.height,1024);k=L*h.projection.pixelSpaceConversion(h.center.lat,y,X)}let B=Fc(T,I);r.$.add(B,B,r.$.scale([],r.$.normalize([],B),S*k*x[2]));let Z=function(X){let re=[X[0],X[1],X[2]],ie=[0,1,0],le=r.$.cross([],ie,re);return r.$.cross(ie,re,le),r.$.squaredLength(ie)===0&&(ie=[0,1,0],r.$.cross(le,re,ie)),r.$.normalize(le,le),r.$.normalize(ie,ie),r.$.normalize(re,re),[le[0],le[1],le[2],0,ie[0],ie[1],ie[2],0,re[0],re[1],re[2],0,X[0],X[1],X[2],1]}(B);r.ae.scale(M,M,[k,k,k*S]),r.ae.translate(M,M,[-x[0],-x[1],-x[2]]);let W=r.ae.multiply([],h.globeMatrix,Z);return r.ae.multiply(W,W,M),r.ae.multiply(W,W,u),W}(t,e,n);if(o>0){let u=function(h,m){let y=m.worldSize,x=ui(1,0)*y*zc(m.center.lat,m.zoom)/bv(y),T=ui(1,m.center.lat)*y,I=r.ae.identity([]);return r.ae.rotateY(I,I,Gt(m.center.lng)),r.ae.rotateX(I,I,Gt(m.center.lat)),r.ae.translate(I,I,[0,0,ci]),r.ae.scale(I,I,[x,x,x*T]),r.ae.translate(I,I,[m.point.x-.5*y,m.point.y-.5*y,0]),r.ae.multiply(I,I,h),r.ae.multiply(I,m.globeMatrix,I)}(t,e);return function(h,m,y){let x=(R,L,k)=>{let B=r.$.length(R),Z=r.$.length(L),W=na(R,L,k);return r.$.scale(W,W,1/r.$.length(W)*gt(B,Z,k))},T=x([h[0],h[1],h[2]],[m[0],m[1],m[2]],y),I=x([h[4],h[5],h[6]],[m[4],m[5],m[6]],y),M=x([h[8],h[9],h[10]],[m[8],m[9],m[10]],y),S=na([h[12],h[13],h[14]],[m[12],m[13],m[14]],y);return[T[0],T[1],T[2],0,I[0],I[1],I[2],0,M[0],M[1],M[2],0,S[0],S[1],S[2],1]}(s,u,o)}return s}function yM(t,e,n,o){let s=Gn.projectAabbCorners(o,n),u=Number.MAX_VALUE,h=-1;for(let x=0;x<s.length;++x){let T=s[x];T[0]=(.5*T[0]+.5)*e.width,T[1]=(.5-.5*T[1])*e.height,T[2]<u&&(h=x,u=T[2])}let m=x=>new Je(s[x][0],s[x][1]),y;switch(h){case 0:case 6:y=[m(1),m(5),m(4),m(7),m(3),m(2),m(1)];break;case 1:case 7:y=[m(0),m(4),m(5),m(6),m(2),m(3),m(0)];break;case 3:case 5:y=[m(1),m(0),m(4),m(7),m(6),m(2),m(1)];break;default:y=[m(1),m(5),m(6),m(7),m(3),m(0),m(1)]}if(hv(t,y))return u}let VO=mn([{name:"a_pos_3f",components:3,type:"Float32"}]),UO=mn([{name:"a_color_3f",components:3,type:"Float32"}]),$O=mn([{name:"a_color_4f",components:4,type:"Float32"}]),GO=mn([{name:"a_uv_2f",components:2,type:"Float32"}]),HO=mn([{name:"a_normal_3f",components:3,type:"Float32"}]),qO=mn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),WO=mn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class d_{constructor(e,n,o,s){this.message=(e?`${e}: `:"")+o,s&&(this.identifier=s),n!=null&&n.__line__&&(this.line=n.__line__)}}function vM(t,e){let n=t.indexOf("://")===-1;try{return new URL(t,n&&e?"http://example.com":void 0),!0}catch{return!1}}class xM{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class bM{constructor(){this.instancedDataArray=new Z0,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class ix{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,n){}populate(e,n,o,s){this.tileToMeter=bg(o);let u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:h,id:m,index:y,sourceLayerIndex:x}of e){let T=m??(h.properties&&h.properties.hasOwnProperty("id")?h.properties.id:void 0),I=ta(h,u);if(!this.layers[0]._featureFilter.filter(new xt(this.zoom),I,o))continue;let M={id:T,sourceLayerIndex:x,index:y,geometry:u?I.geometry:Fo(h,o,s),properties:h.properties,type:h.type,patterns:{}},S=this.addFeature(M,M.geometry,I);S&&n.featureIndex.insert(h,M.geometry,y,x,this.index,this.instancesPerModel[S].instancedDataArray.length,Xe/32)}this.lookup=null}update(e,n,o,s){for(let u in this.instancesPerModel){let h=this.instancesPerModel[u];for(let m in e)h.idToFeaturesIndex.hasOwnProperty(m)&&(this.evaluate(h.features[h.idToFeaturesIndex[m]],e[m],h,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let o=this.instancesPerModel[n];for(let s of o.features){let u=this.layers[0],h=s.feature,m=this.canonical,y=u.paint.get("model-rotation").evaluate(h,{},m),x=u.paint.get("model-scale").evaluate(h,{},m),T=u.paint.get("model-translation").evaluate(h,{},m);r.$.exactEquals(s.rotation,y)&&r.$.exactEquals(s.scale,x)&&r.$.exactEquals(s.translation,T)||(this.evaluate(s,s.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,n,o,s){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let u=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Pv(this.activeReplacements,u))return!1;this.activeReplacements=u;let h=!1;for(let m in this.instancesPerModel){let y=this.instancesPerModel[m],x=y.instancedDataArray;for(let T of y.features){let I=T.instancedDataOffset,M=T.instancedDataCount;for(let S=0;S<M;S++){let R=16*(S+I),L=x.float32[R+0];L=L>Xe?L-Xe:L;let k=Math.floor(L),B=x.float32[R+1],Z=!1;for(let W of this.activeReplacements)if(!cE(W,o,TE.Model,s)&&!(W.min.x>k||k>W.max.x||W.min.y>B||B>W.max.y)&&(Z=mE(pE(k,B,e.canonical,W.footprintTileId.canonical),W),Z))break;x.float32[R]=Z?L+Xe:L,h=h||Z}}}return h}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let o=this.instancesPerModel[n];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,qO.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let n in this.instancesPerModel){let o=this.instancesPerModel[n];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,o){let s=this.layers[0],u=s.layout.get("model-id").evaluate(o,{},this.canonical);if(!u)return rr(`modelId is not evaluated for layer ${s.id} and it is not going to get rendered.`),u;vM(u,!1)&&(this.modelUris.includes(u)||this.modelUris.push(u)),this.instancesPerModel[u]||(this.instancesPerModel[u]=new bM);let h=this.instancesPerModel[u],m=h.instancedDataArray,y=new xM(o,m.length);for(let x of n)for(let T of x){if(T.x<0||T.x>=Xe||T.y<0||T.y>=Xe)continue;let I=(this.lookupDim-1)/Xe,M=this.lookupDim*(T.y*I|0)+T.x*I|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;let S=m.length;m.resize(S+1),h.instancesEvaluatedElevation.push(0),m.float32[16*S]=T.x,m.float32[16*S+1]=T.y}return y.instancedDataCount=h.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(h.idToFeaturesIndex[e.id]=h.features.length),h.features.push(y),this.evaluate(y,{},h,!1)),u}getModelUris(){return this.modelUris}evaluate(e,n,o,s){let u=this.layers[0],h=e.feature,m=this.canonical,y=e.rotation=u.paint.get("model-rotation").evaluate(h,n,m),x=e.scale=u.paint.get("model-scale").evaluate(h,n,m),T=e.translation=u.paint.get("model-translation").evaluate(h,n,m),I=u.paint.get("model-color").evaluate(h,n,m);I.a=u.paint.get("model-color-mix-intensity").evaluate(h,n,m);let M=[];this.maxVerticalOffset<T[2]&&(this.maxVerticalOffset=T[2]),this.maxScale=Math.max(Math.max(this.maxScale,x[0]),Math.max(x[1],x[2])),_M(M,y,x);let S=Math.round(100*I.a)+I.b/1.05;for(let R=0;R<e.instancedDataCount;++R){let L=e.instancedDataOffset+R,k=16*L,B=o.instancedDataArray.float32,Z=0;s&&(Z=B[k+6]-o.instancesEvaluatedElevation[L]);let W=0|B[k+1];B[k]=(0|B[k])+I.r/1.05,B[k+1]=W+I.g/1.05,B[k+2]=S,B[k+3]=1/(m.z>10?this.tileToMeter:bg(m,W)),B[k+4]=T[0],B[k+5]=T[1],B[k+6]=T[2]+Z,B[k+7]=M[0],B[k+8]=M[1],B[k+9]=M[2],B[k+10]=M[4],B[k+11]=M[5],B[k+12]=M[6],B[k+13]=M[8],B[k+14]=M[9],B[k+15]=M[10],o.instancesEvaluatedElevation[L]=T[2]}}}let wM,TM;me(ix,"ModelBucket",{omit:["layers"]}),me(bM,"PerModelAttributes"),me(xM,"ModelFeature");let $c=64,zh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function EM(t,e,n,o,s,u,h,m,y,x=!1){let T=n.zoom,I=n.project(o),M=zc(o.lat,T),S=1/M;r.ae.identity(t),r.ae.translate(t,t,[I.x+h[0]*S,I.y+h[1]*S,h[2]]);let R=1,L=1,k=n.worldSize;if(x){if(n.projection.name==="mercator"){let X=0;n.elevation&&(X=n.elevation.getAtPointOrZero(new Qr(I.x/k,I.y/k),0));let re=r.aB.transformMat4([],[I.x,I.y,X,1],n.projMatrix)[3]/n.cameraToCenterDistance;R=re,L=re*zc(n.center.lat,T)}else if(n.projection.name==="globe"){let X=rx(t,n),re=r.ae.multiply([],n.projMatrix,X),ie=[0,0,0,1];r.aB.transformMat4(ie,ie,re);let le=ie[3]/n.cameraToCenterDistance,ge=ra(T),we=n.projection.pixelsPerMeter(o.lat,k)*zc(o.lat,T),Ce=n.projection.pixelsPerMeter(n.center.lat,k)*zc(n.center.lat,T);R=le/gt(we,dT(n.center.lat),ge),L=le*M/we,R*=Ce,L*=Ce}}else R=S;r.ae.scale(t,t,[R,R,L]);let B=[...t],Z=e.orientation,W=[];if(_M(W,[Z[0]+s[0],Z[1]+s[1],Z[2]+s[2]],u),r.ae.multiply(t,B,W),m&&n.elevation){let X=0,re=[];if(y&&n.elevation){X=function(ge,we,Ce,Te,Oe){let $e=we.elevation;if(!$e)return 0;let Le=Gn.projectAabbCorners(Ce,Te),qe=ui(1,Oe.lat)*we.worldSize,Re=function(vt,dt){let lt=[0,0,1],Et=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Ct of Et){let It=vt[Ct.corners[0]],Nt=vt[Ct.corners[1]],Zt=vt[Ct.corners[2]],$t=[Nt[0]-It[0],Nt[1]-It[1],dt*(Nt[2]-It[2])],Cn=r.$.cross($t,$t,[Zt[0]-It[0],Zt[1]-It[1],dt*(Zt[2]-It[2])]);r.$.normalize(Cn,Cn),Ct.dotProductWithUp=r.$.dot(Cn,lt)}return Et.sort((Ct,It)=>Ct.dotProductWithUp-It.dotProductWithUp),Et[0].corners}(Le,qe),ze=Le[Re[0]],Ze=Le[Re[1]],ke=Le[Re[2]],Qe=Le[Re[3]],We=$e.getAtPointOrZero(new Qr(ze[0]/we.worldSize,ze[1]/we.worldSize),0),Ge=$e.getAtPointOrZero(new Qr(Ze[0]/we.worldSize,Ze[1]/we.worldSize),0),ft=$e.getAtPointOrZero(new Qr(ke[0]/we.worldSize,ke[1]/we.worldSize),0),ht=$e.getAtPointOrZero(new Qr(Qe[0]/we.worldSize,Qe[1]/we.worldSize),0),ot=(We+ht)/2,Ye=(Ge+ft)/2;return ot>Ye?Ge<ft?h_(ge,Ze,Qe,ze,Ge,ht,We,qe):h_(ge,ke,ze,Qe,ft,We,ht,qe):We<ht?h_(ge,ze,Ze,ke,We,Ge,ft,qe):h_(ge,Qe,ke,Ze,ht,ft,Ge,qe),Math.max(ot,Ye)}(re,n,e.aabb,t,o);let ie=r.ae.fromQuat([],re),le=r.ae.multiply([],ie,W);r.ae.multiply(t,B,le)}else X=n.elevation.getAtPointOrZero(new Qr(I.x/k,I.y/k),0);X!==0&&(t[14]+=X)}}function fp(t,e,n=!1){t.uploaded||(t.gfxTexture=new mo(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function ZO(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,VO.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,HO.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,GO.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?UO:$O).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,WO.members,!0)),t.segments=Zn.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let o=t.material;o.pbrMetallicRoughness.baseColorTexture&&fp(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&fp(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&fp(o.normalTexture,e),o.occlusionTexture&&fp(o.occlusionTexture,e,n),o.emissionTexture&&fp(o.emissionTexture,e)}function ox(t,e,n){if(t.meshes)for(let o of t.meshes)ZO(o,e,n);if(t.children)for(let o of t.children)ox(o,e,n)}function f_(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)f_(e)}function sx(t){if(t.meshes)for(let n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let n of t.children)sx(n)}class XO{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class YO{constructor(){this.tasks={},this.taskQueue=[],ku(["process"],this),this.invoker=new XO(this.process),this.nextId=0}add(e,n){let o=this.nextId++,s=function({type:u,isSymbolTile:h,zoom:m}){return m=m||0,u==="message"?0:u!=="maybePrepare"||h?u!=="parseTile"||h?u==="parseTile"&&h?300-m:u==="maybePrepare"&&h?400-m:500:200-m:100-m}(n);if(s===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:n,priority:s,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let s=0;s<this.taskQueue.length;s++){let u=this.tasks[this.taskQueue[s]];u.priority<n&&(n=u.priority,e=s)}if(e===null)return null;let o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class IM{constructor(e,n,o){this.target=e,this.parent=n,this.mapId=o,this.callbacks={},this.cancelCallbacks={},ku(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new YO}send(e,n,o,s,u=!1,h){let m=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=h,this.callbacks[m]=o);let y=new Set;return this.target.postMessage({id:m,type:e,hasCallback:!!o,targetMapId:s,mustQueue:u,sourceMapId:this.mapId,data:be(n,y)},y),{cancel:()=>{o&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(e){let n=e.data,o=n.id;if(o&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let s=this.cancelCallbacks[o];delete this.cancelCallbacks[o],s&&s.cancel()}else if(n.mustQueue||Na()){let s=this.callbacks[o],u=this.scheduler.add(()=>this.processTask(o,n),s&&s.metadata||{type:"message"});u&&(this.cancelCallbacks[o]=u)}else this.processTask(o,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){let o=this.callbacks[e];delete this.callbacks[e],o&&(n.error?o(Ae(n.error)):o(null,Ae(n.data)))}else{let o=new Set,s=n.hasCallback?(h,m)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:h?be(h):null,data:be(m,o)},o)}:h=>{},u=Ae(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,u,s);else if(this.parent.getWorkerSource){let h=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,h[0],u.source,u.scope)[h[1]](u,s)}else s(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let ax=(()=>{class t{constructor(n,o){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Lu();let s=this.workerPool.acquire(this.id);for(let u=0;u<s.length;u++){let h=new t.Actor(s[u],o,this.id);h.name=`Worker ${u}`,this.actors.push(h)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,o,s){Xl(this.actors,(u,h)=>{u.send(n,o,h)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=IM,t})();var pp={workerUrl:"",workerClass:null,workerParams:void 0};function QO(){return pp.workerClass!=null?new pp.workerClass:new self.Worker(pp.workerUrl,pp.workerParams)}let lx="mapboxgl_preloaded_worker_pool";class mp{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<mp.workerCount;)this.workers.push(new QO);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[lx]}numActive(){return Object.keys(this.active).length}}let gp;function p_(){return gp||(gp=new mp),gp}mp.workerCount=2;let m_,cx,Uo,Bh,ux,jh=null;function MM(){return Na()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:cx||V.DRACO_URL}function DM(){if(Na()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Bh)return Bh;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Bh=WebAssembly.validate(t)?V.MESHOPT_SIMD_URL:V.MESHOPT_URL,Bh}let g_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},KO={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},_p={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function CM(t,e,n){let o=n.json.bufferViews.length,s=n.buffers.length;e.bufferView=o,n.json.bufferViews[o]={buffer:s,byteLength:t.byteLength},n.buffers[s]=t}let hx="KHR_draco_mesh_compression";function JO(t,e){let n=t.extensions&&t.extensions[hx];if(!n)return;let o=new Uo.Decoder,s=RM(e,n.bufferView),u=new Uo.Mesh;if(!o.DecodeArrayToMesh(s,s.byteLength,u))throw new Error("Failed to decode Draco mesh");let h=e.json.accessors[t.indices],m=g_[h.componentType],y=h.count*m.BYTES_PER_ELEMENT,x=Uo._malloc(y);m===Uint16Array?o.GetTrianglesUInt16Array(u,y,x):o.GetTrianglesUInt32Array(u,y,x),CM(Uo.memory.buffer.slice(x,x+y),h,e),Uo._free(x);for(let T of Object.keys(n.attributes)){let I=o.GetAttributeByUniqueId(u,n.attributes[T]),M=e.json.accessors[t.attributes[T]],S=KO[M.componentType],R=M.count*_p[M.type]*g_[M.componentType].BYTES_PER_ELEMENT,L=Uo._malloc(R);o.GetAttributeDataArrayForAllPoints(u,I,Uo[S],R,L),CM(Uo.memory.buffer.slice(L,L+R),M,e),Uo._free(L)}o.destroy(),u.destroy(),delete t.extensions[hx]}let __="EXT_meshopt_compression";function eL(t,e){if(!t.extensions||!t.extensions[__])return;let n=t.extensions[__],o=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),s=new Uint8Array(n.count*n.byteStride);ux.decodeGltfBuffer(s,n.count,n.byteStride,o,n.mode,n.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=s.buffer,delete t.extensions[__]}let SM=1179937895,AM=new TextDecoder("utf8");function PM(t,e){return new URL(t,e).href}function tL(t,e,n,o){return fetch(PM(t.uri,o)).then(s=>s.arrayBuffer()).then(s=>{e.buffers[n]=s})}function RM(t,e){let n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function nL(t,e,n,o){if(t.uri){let s=PM(t.uri,o);return fetch(s).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{e.images[n]=u})}if(t.bufferView!==void 0){let s=RM(e,t.bufferView),u=new Blob([s],{type:t.mimeType});return createImageBitmap(u).then(h=>{e.images[n]=h})}}function OM(t,e=0,n){let o={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===SM){let T=new Uint32Array(t,e),I=2,M=(T[I++]>>2)-3,S=T[I++]>>2;if(I++,o.json=JSON.parse(AM.decode(T.subarray(I,I+S))),I+=S,I<M){let R=T[I++];I++;let L=e+(I<<2);o.buffers[0]=t.slice(L,L+R)}}else o.json=JSON.parse(AM.decode(new Uint8Array(t,e)));let{buffers:s,images:u,meshes:h,extensionsUsed:m,bufferViews:y}=o.json,x=Promise.resolve();if(s){let T=[];for(let I=0;I<s.length;I++){let M=s[I];M.uri?T.push(tL(M,o,I,n)):o.buffers[I]||(o.buffers[I]=null)}x=Promise.all(T)}return x.then(()=>{let T=[],I=m&&m.includes(hx),M=m&&m.includes(__);if(I&&T.push(function(){if(!Uo)return m_||(m_=function(S){let R,L=null;function k(){R=new Uint8Array(L.buffer)}function B(){throw new Error("Unexpected Draco error.")}let Z={a:{a:B,d:function(W,X,re){return R.copyWithin(W,X,X+re)},c:function(W){let X=R.length,re=Math.max(W>>>0,Math.ceil(1.2*X)),ie=Math.ceil((re-X)/65536);try{return L.grow(ie),k(),!0}catch{return!1}},b:B}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(S,Z):S.then(W=>W.arrayBuffer()).then(W=>WebAssembly.instantiate(W,Z))).then(W=>{let{Rb:X,Qb:re,P:ie,T:le,X:ge,Ja:we,La:Ce,Qa:Te,Va:Oe,Wa:$e,eb:Le,jb:qe,f:Re,e:ze,yb:Ze,zb:ke,Ab:Qe,Bb:We,Db:Ge,Gb:ft}=W.instance.exports;L=ze;let ht=(()=>{let ot=0,Ye=0,vt=0,dt=0;return lt=>{vt&&(X(dt),X(ot),Ye+=vt,vt=ot=0),ot||(Ye+=128,ot=re(Ye));let Et=lt.length+7&-8,Ct=ot;Et>=Ye&&(vt=Et,Ct=dt=re(Et));for(let It=0;It<lt.length;It++)R[Ct+It]=lt[It];return Ct}})();return k(),Re(),{memory:ze,_free:X,_malloc:re,Mesh:class{constructor(){this.ptr=ie()}destroy(){le(this.ptr)}},Decoder:class{constructor(){this.ptr=we()}destroy(){qe(this.ptr)}DecodeArrayToMesh(ot,Ye,vt){let dt=ht(ot),lt=Ce(this.ptr,dt,Ye,vt.ptr);return!!ge(lt)}GetAttributeByUniqueId(ot,Ye){return{ptr:Te(this.ptr,ot.ptr,Ye)}}GetTrianglesUInt16Array(ot,Ye,vt){Oe(this.ptr,ot.ptr,Ye,vt)}GetTrianglesUInt32Array(ot,Ye,vt){$e(this.ptr,ot.ptr,Ye,vt)}GetAttributeDataArrayForAllPoints(ot,Ye,vt,dt,lt){Le(this.ptr,ot.ptr,Ye.ptr,vt,dt,lt)}},DT_INT8:Ze(),DT_UINT8:ke(),DT_INT16:Qe(),DT_UINT16:We(),DT_UINT32:Ge(),DT_FLOAT32:ft()}})}(fetch(MM())),m_.then(S=>{Uo=S,m_=void 0}))}()),M&&T.push(function(){if(ux)return;let S=function(R){let L,k=WebAssembly.instantiateStreaming(R,{}).then(W=>{L=W.instance,L.exports.__wasm_call_ctors()}),B={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Z={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:k,supported:!0,decodeGltfBuffer(W,X,re,ie,le,ge){(function(we,Ce,Te,Oe,$e,Le,qe){let Re=we.exports.sbrk,ze=Oe+3&-4,Ze=Re(ze*$e),ke=Re(Le.length),Qe=new Uint8Array(we.exports.memory.buffer);Qe.set(Le,ke);let We=Ce(Ze,Oe,$e,ke,Le.length);if(We===0&&qe&&qe(Ze,ze,$e),Te.set(Qe.subarray(Ze,Ze+Oe*$e)),Re(Ze-Re(0)),We!==0)throw new Error(`Malformed buffer data: ${We}`)})(L,L.exports[Z[le]],W,X,re,ie,L.exports[B[ge]])}}}(fetch(DM()));return S.ready.then(()=>{ux=S})}()),u)for(let S=0;S<u.length;S++)T.push(nL(u[S],o,S,n));return(T.length?Promise.all(T):Promise.resolve()).then(()=>{if(I&&h)for(let{primitives:S}of h)for(let R of S)JO(R,o);if(M&&h&&y)for(let S of y)eL(S,o);return o})})}function Gc(t,e){let n=t.json.bufferViews[e.bufferView],o=g_[e.componentType];return new o(t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==_p[e.type]*o.BYTES_PER_ELEMENT?n.byteStride/o.BYTES_PER_ELEMENT:_p[e.type]))}function dx(t,e,n,o){let s=g_[e.componentType],u=function(T){switch(T){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(s),h=t.json.bufferViews[e.bufferView],m=h.byteStride?h.byteStride/s.BYTES_PER_ELEMENT:_p[e.type],y=n.float32,x=y.length/n.capacity;for(let T=0,I=0;T<e.count*m;T+=m,I+=x)for(let M=0;M<x;M++)y[I+M]=o[T+M]*u;n._trim()}function rL(t,e,n){let o=t.indices,s=t.attributes,u={};u.indexArray=new vr;let h=e.json.accessors[o],m=h.count/3;u.indexArray.reserve(m);let y=Gc(e,h);for(let M=0;M<m;M++)u.indexArray.emplaceBack(y[3*M],y[3*M+1],y[3*M+2]);u.indexArray._trim(),u.vertexArray=new el;let x=e.json.accessors[s.POSITION];u.vertexArray.reserve(x.count);let T=Gc(e,x);for(let M=0;M<x.count;M++)u.vertexArray.emplaceBack(T[3*M],T[3*M+1],T[3*M+2]);if(u.vertexArray._trim(),u.aabb=new Gn(x.min,x.max),u.centroid=function(M,S){let R=[0,0,0],L=M.length;if(L>0){for(let k=0;k<L;k++){let B=3*M[k];R[0]+=S[B],R[1]+=S[B+1],R[2]+=S[B+2]}R[0]/=L,R[1]/=L,R[2]/=L}return R}(y,T),s.COLOR_0!==void 0){let M=e.json.accessors[s.COLOR_0],S=_p[M.type],R=Gc(e,M);u.colorArray=S===3?new el:new Ja,u.colorArray.resize(M.count),dx(e,M,u.colorArray,R)}if(s.NORMAL!==void 0){u.normalArray=new el;let M=e.json.accessors[s.NORMAL];u.normalArray.resize(M.count);let S=Gc(e,M);dx(e,M,u.normalArray,S)}if(s.TEXCOORD_0!==void 0&&n.length>0){u.texcoordArray=new Lf;let M=e.json.accessors[s.TEXCOORD_0];u.texcoordArray.resize(M.count);let S=Gc(e,M);dx(e,M,u.texcoordArray,S)}if(s._FEATURE_ID_RGBA4444!==void 0){let M=e.json.accessors[s._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=Gc(e,M))}s._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(Gc(e,e.json.accessors[s._FEATURE_RGBA4444]).buffer));let I=t.material;return u.material=function(M,S){let{emissiveFactor:R=[0,0,0],alphaMode:L="OPAQUE",alphaCutoff:k=.5,normalTexture:B,occlusionTexture:Z,emissiveTexture:W,doubleSided:X}=M,{baseColorFactor:re=[1,1,1,1],metallicFactor:ie=1,roughnessFactor:le=1,baseColorTexture:ge,metallicRoughnessTexture:we}=M.pbrMetallicRoughness||{},Ce=Z?S[Z.index]:void 0;if(Z&&Z.extensions&&Z.extensions.KHR_texture_transform&&Ce){let Te=Z.extensions.KHR_texture_transform;Ce.offsetScale=[Te.offset[0],Te.offset[1],Te.scale[0],Te.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new hn(...re),metallicFactor:ie,roughnessFactor:le,baseColorTexture:ge?S[ge.index]:void 0,metallicRoughnessTexture:we?S[we.index]:void 0},doubleSided:X,emissiveFactor:R,alphaMode:L,alphaCutoff:k,normalTexture:B?S[B.index]:void 0,occlusionTexture:Ce,emissionTexture:W?S[W.index]:void 0,defined:M.defined===void 0}}(I!==void 0?e.json.materials[I]:{defined:!1},n),u}function LM(t,e,n){let{matrix:o,rotation:s,translation:u,scale:h,mesh:m,extras:y,children:x}=t,T={};if(T.matrix=o||r.ae.fromRotationTranslationScale([],s||[0,0,0,1],u||[0,0,0],h||[1,1,1]),m!==void 0){T.meshes=n[m];let I=T.anchor=[0,0];for(let M of T.meshes){let{min:S,max:R}=M.aabb;I[0]+=S[0]+R[0],I[1]+=S[1]+R[1]}I[0]=Math.floor(I[0]/T.meshes.length/2),I[1]=Math.floor(I[1]/T.meshes.length/2)}if(y&&(y.id&&(T.id=y.id),y.lights&&(T.lights=function(I){if(!I.length)return[];let M=function(B){let Z=atob(B),W=new Uint8Array(Z.length);for(let X=0;X<Z.length;X++)W[X]=Z.codePointAt(X);return W}(I),S=[],R=M.length/24,L=new Uint16Array(M.buffer),k=new Float32Array(M.buffer);for(let B=0;B<R;B++){let Z=L[2*B*6]/30,W=L[2*B*6+1]/30,X=L[2*B*6+10]/100,re=k[6*B+1],ie=k[6*B+2],le=k[6*B+3],ge=k[6*B+4],we=le-re,Ce=ge-ie,Te=Math.hypot(we,Ce);S.push({pos:[re+.5*we,ie+.5*Ce,W],normal:[Ce/Te,-we/Te,0],width:Te,height:Z,depth:X,points:[re,ie,le,ge]})}return S}(y.lights))),x){let I=[];for(let M of x)I.push(LM(e.json.nodes[M],e,n));T.children=I}return T}function iL(t){if(t.vertices.length===0||t.indices.length===0)return null;let e=new Cv(t.vertices,t.indices,8,256),[n,o]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:n,max:o}}function oL(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let o=[];for(let h of n){if(!Array.isArray(h)||h.length!==2)continue;let m=h[0],y=h[1];typeof m=="number"&&typeof y=="number"&&o.push(new Je(m,y))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let s=0;for(let h=0;h<o.length;h++){let m=o[h],y=o[(h+1)%o.length],x=o[(h+2)%o.length];s+=(m.x-y.x)*(x.y-y.y)-(x.x-y.x)*(m.y-y.y)}s>0&&o.reverse();let u=$f(o.flatMap(h=>[h.x,h.y]),[]);return u.length===0?null:{vertices:o,indices:u}}function sL(t,e){let n=[],o=[],s=0,u=[];for(let h of t){s=n.length;let m=h.vertexArray.float32,y=h.indexArray.uint16;for(let x=0;x<h.vertexArray.length;x++)u[0]=m[3*x+0],u[1]=m[3*x+1],u[2]=m[3*x+2],r.$.transformMat4(u,u,e),n.push(new Je(u[0],u[1]));for(let x=0;x<3*h.indexArray.length;x++)o.push(y[x]+s)}if(o.length%3!=0)return null;for(let h=0;h<o.length;h+=3){let m=n[o[h+0]],y=n[o[h+1]],x=n[o[h+2]];(m.x-y.x)*(x.y-y.y)-(x.x-y.x)*(m.y-y.y)>0&&([o[h+1],o[h+2]]=[o[h+2],o[h+1]])}return{vertices:n,indices:o}}function kM(t){let e=function(y,x){let T=[],I=WebGL2RenderingContext;if(y.json.textures)for(let M of y.json.textures){let S={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};M.sampler!==void 0&&Object.assign(S,y.json.samplers[M.sampler]),T.push({image:x[M.source],sampler:S,uploaded:!1})}return T}(t,t.images),n=function(y,x){let T=[];for(let I of y.json.meshes){let M=[];for(let S of I.primitives)M.push(rL(S,y,x));T.push(M)}return T}(t,e),{scenes:o,scene:s,nodes:u}=t.json,h=o?o[s||0].nodes:u,m=[];for(let y of h)m.push(LM(u[y],t,n));return function(y,x,T){let I={},M=new Set;for(let S=0;S<y.length;S++){let R=T[x[S]];if(!R.extras)continue;let L=R.extras["mapbox:footprint:version"],k=R.extras["mapbox:footprint:id"];(L||k)&&M.add(S),L==="1.0.0"&&k&&(I[k]=S)}for(let S=0;S<y.length;S++){if(M.has(S))continue;let R=y[S],L=T[x[S]];if(!L.extras)continue;let k=null;R.id in I&&(k=sL(y[I[R.id]].meshes,R.matrix)),k||(k=oL(L)),k&&(R.footprint=iL(k))}if(M.size>0){let S=Array.from(M.values()).sort((R,L)=>R-L);for(let R=S.length-1;R>=0;R--)y.splice(S[R],1)}}(m,h,t.json.nodes),m}function aL(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,n=t.aabb.min[0]-1,o=t.aabb.min[1]-1,s=$c/(t.aabb.max[0]-n+2),u=$c/(t.aabb.max[1]-o+2);for(let h=0;h<e.length;h+=3){let m=e[h+2],y=(e[h+0]-n)*s|0,x=(e[h+1]-o)*u|0;m>t.heightmap[x*$c+y]&&(t.heightmap[x*$c+y]=m)}}function lL(t,e){let n={};n.indexArray=new vr,n.indexArray.reserve(4*t.length),n.vertexArray=new el,n.vertexArray.reserve(10*t.length),n.colorArray=new Ja,n.vertexArray.reserve(10*t.length);let o=0;for(let h of t){let m=Math.min(10,Math.max(4,1.3*h.height))*e,y=[-h.normal[1],h.normal[0],0],x=Math.min(.29,.1*h.width/h.depth),T=h.width-2*h.depth*e*(x+.01),I=r.$.scaleAndAdd([],h.pos,y,T/2),M=r.$.scaleAndAdd([],h.pos,y,-T/2),S=[I[0],I[1],I[2]+h.height],R=[M[0],M[1],M[2]+h.height],L=r.$.scaleAndAdd([],h.normal,y,x);r.$.scale(L,L,m);let k=r.$.scaleAndAdd([],h.normal,y,-x);r.$.scale(k,k,m),r.$.add(L,I,L),r.$.add(k,M,k),I[2]+=.1,M[2]+=.1,n.vertexArray.emplaceBack(L[0],L[1],L[2]),n.vertexArray.emplaceBack(k[0],k[1],k[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(M[0],M[1],M[2]),n.vertexArray.emplaceBack(S[0],S[1],S[2]),n.vertexArray.emplaceBack(R[0],R[1],R[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(M[0],M[1],M[2]),n.vertexArray.emplaceBack(L[0],L[1],L[2]),n.vertexArray.emplaceBack(k[0],k[1],k[2]);let B=T/m/2;n.colorArray.emplaceBack(-B-x,-1,B,.8),n.colorArray.emplaceBack(B+x,-1,B,.8),n.colorArray.emplaceBack(-B,0,B,1.3),n.colorArray.emplaceBack(B,0,B,1.3),n.colorArray.emplaceBack(B+x,-.8,B,.7),n.colorArray.emplaceBack(B+x,-.8,B,.7),n.colorArray.emplaceBack(0,0,B,1.3),n.colorArray.emplaceBack(0,0,B,1.3),n.colorArray.emplaceBack(B+x,-1.2,B,.8),n.colorArray.emplaceBack(B+x,-1.2,B,.8),n.indexArray.emplaceBack(6+o,4+o,8+o),n.indexArray.emplaceBack(7+o,9+o,5+o),n.indexArray.emplaceBack(0+o,1+o,2+o),n.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}let s={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=hn.white,s.pbrMetallicRoughness=u,n.material=s,n.aabb=new Gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}let fx=new Float32Array(262144),Hc=new Uint8Array(262144);function FM(t){let e=0;if(t.meshes)for(let n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(let n of t.children)e=Math.max(e,FM(n));return e}function NM(t,e,n){if(t.meshes)for(let o of t.meshes)o.aabb.min[0]!==1/0&&n.insert(e,o.aabb.min[0],o.aabb.min[1],o.aabb.max[0],o.aabb.max[1]);if(t.children)for(let o of t.children)NM(o,e,n)}let zM=["","wall","door","roof","window","lamp","logo"];class BM{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:FM(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,n=new Gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=Gn.applyTransformFast(o.aabb,this.node.matrix),n.encapsulate(o.transformedAabb)),e++;this.aabb=n}return this.aabb}}class y_{constructor(e,n,o,s,u,h){this.id=n,this.modelTraits|=zh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,o&&(this.modelTraits|=zh.HasMapboxMeshFeatures),s&&(this.modelTraits|=zh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=u,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let m of e)this.nodesInfo.push(new BM(m)),NM(m,h.featureIndexArray.length,h.grid),h.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,h.bucketLayerIDs.length-1,0)}updateFootprints(e,n){for(let o of this.getNodesInfo()){let s=o.node;s.footprint&&n.push({footprint:s.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let o of n){let s=o.node;this.uploaded?this.updatePbrBuffer(s):ox(s,e,!0)}for(let o of n)f_(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),n=!0);return n}needsReEvaluation(e,n,o){let s=e.transform.projectionOptions,u=e.style.getBrightness(),h=this.brightness!==u;return!!(!this.uploaded||this.dirty||s.name!==this.projection.name||yp(o.paint.get("model-color").value,h)||yp(o.paint.get("model-color-mix-intensity").value,h)||yp(o.paint.get("model-roughness").value,h)||yp(o.paint.get("model-emissive-strength").value,h)||yp(o.paint.get("model-height-based-emissive-strength-multiplier").value,h))&&(this.projection=s,this.brightness=u,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let o=this.getNodesInfo(),s=this.id.canonical;for(let u of o){let h=u.feature;u.evaluatedScale=n.paint.get("model-scale").evaluate(h,{},s)}}evaluate(e){let n=this.getNodesInfo();for(let o of n){if(!o.node.meshes)continue;let s=o.feature,u=o.node.meshes&&o.node.meshes[0].featureData,h=o.evaluatedColor[2],m=o.evaluatedRMEA[2],y=this.id.canonical;if(o.hasTranslucentParts=!1,u){for(let x=0;x<zM.length;x++){let T=zM[x];T.length&&(s.properties.part=T);let I=e.paint.get("model-color").evaluate(s,{},y).toRenderColor(null),M=e.paint.get("model-color-mix-intensity").evaluate(s,{},y);o.evaluatedColor[x]=[I.r,I.g,I.b,M],o.evaluatedRMEA[x][0]=e.paint.get("model-roughness").evaluate(s,{},y),o.evaluatedRMEA[x][2]=e.paint.get("model-emissive-strength").evaluate(s,{},y),o.evaluatedRMEA[x][3]=I.a,o.emissionHeightBasedParams[x]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(s,{},y),!o.hasTranslucentParts&&I.a<1&&(o.hasTranslucentParts=!0)}delete s.properties.part,uL(o,h!==o.evaluatedColor[2]||m!==o.evaluatedRMEA[2],this.modelTraits)}else o.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(s,{},y);o.evaluatedScale=e.paint.get("model-scale").evaluate(s,{},y),this.updatePbrBuffer(o.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,o,s){let u=e.findDEMTileFor(o);if(u&&(u.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;let h=Dh.create(e,o,u);if(!h)return;this.modelTraits&zh.HasMapboxMeshFeatures&&this.updateDEM(e,h,o,s);for(let m of this.getNodesInfo()){let y=m.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;let x=y.footprint.vertices,T=h.getElevationAt(x[0].x,x[0].y,!0,!0);for(let I=1;I<x.length;I++)T=Math.min(T,h.getElevationAt(x[I].x,x[I].y,!0,!0));y.elevation=T}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,o,s){let u=n._dem._modifiedForSources[s];if(u===void 0&&(n._dem._modifiedForSources[s]=[],u=n._dem._modifiedForSources[s]),u.includes(o.canonical))return;let h=n._dem.dim;u.push(o.canonical);let m=!1;for(let y of this.getNodesInfo()){let x=y.node;if(!x.footprint||!x.footprint.grid)continue;let T=x.footprint.grid,I=n.tileCoordToPixel(T.min.x,T.min.y),M=n.tileCoordToPixel(T.max.x,T.max.y),S=Math.min(Math.min(h-M.y,I.x),Math.min(I.y,h-M.x));if(S<0)continue;let R=jt(S,2,5),L=Math.max(0,I.x-R),k=Math.max(0,I.y-R),B=Math.min(M.x+R,h-1),Z=Math.min(M.y+R,h-1);for(let ie=k;ie<=Z;++ie)for(let le=L;le<=B;++le)Hc[ie*h+le]=255;let W=0,X=0;for(let ie=0;ie<T.cellsY;++ie)for(let le=0;le<T.cellsX;++le){if(!T.cells[ie*T.cellsX+le])continue;let ge=n.tileCoordToPixel(T.min.x+le/T.xScale,T.min.y+ie/T.yScale),we=n.tileCoordToPixel(T.min.x+(le+1)/T.xScale,T.min.y+(ie+1)/T.yScale);for(let Ce=ge.y;Ce<=Math.min(we.y+1,h-1);++Ce)for(let Te=ge.x;Te<=Math.min(we.x+1,h-1);++Te)Hc[Ce*h+Te]===255&&(Hc[Ce*h+Te]=0,W+=n.getElevationAtPixel(Te,Ce),X++)}let re=W/X;L=Math.max(1,I.x-R),k=Math.max(1,I.y-R),B=Math.min(M.x+R,h-2),Z=Math.min(M.y+R,h-2),m=!0;for(let ie=k;ie<=Z;++ie)for(let le=L;le<=B;++le)Hc[ie*h+le]===0&&(fx[ie*h+le]=n._dem.set(le,ie,re));for(let ie=1;ie<R;++ie){L=Math.max(1,I.x-ie),k=Math.max(1,I.y-ie),B=Math.min(M.x+ie,h-2),Z=Math.min(M.y+ie,h-2);for(let le=k;le<=Z;++le)for(let ge=L;ge<=B;++ge){let we=le*h+ge;if(Hc[we]===255){let Ce=0,Te=0,Oe=-1,$e=-1;for(let Le=-1;Le<=1;++Le)for(let qe=-1;qe<=1;++qe){let Re=(le+Le)*h+ge+qe;if(Hc[Re]>=ie)continue;let ze=fx[Re],Ze=Math.abs(ze);Ze>Te&&(Ce=ze,Te=Ze,Oe=qe,$e=Le)}if(Te>.1){let Le=1-(ie+.5*Math.abs(Oe*$e))/R,qe=n._dem.get(ge,le)+Ce*Le,Re=n._dem.get(ge+Oe,le+$e),ze=n._dem.get(ge-Oe,le-$e,!0);(qe-Re)*(qe-ze)>0&&(qe=(Re+ze)/2),fx[we]=n._dem.set(ge,le,qe),Hc[we]=ie}}}}}m&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=kr.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let n of e)f_(n.node),sx(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let o=n.getReplacementRegionsForTile(e.toUnwrapped()),s=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){let h=s[u].node;s[u].hiddenByReplacement=!!h.footprint&&!o.find(m=>m.footprint===h.footprint)}}getHeightAtTileCoord(e,n){let o=this.getNodesInfo(),s=[],u=[0,0,0],h=r.ae.identity([]);for(let m=0;m<this.nodesInfo.length;m++){let y=o[m],x=y.node.meshes[0],T=x.transformedAabb;if(e<T.min[0]||n<T.min[1]||e>T.max[0]||n>T.max[1])continue;if(y.node.hidden===!0)return{height:0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};r.ae.invert(h,y.node.matrix),u[0]=e,u[1]=n,r.$.transformMat4(u,u,h);let I=(u[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*$c|0,M=Math.min(63,(u[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*$c|0)*$c+Math.min(63,I),S=x.heightmap[M];if(!(S<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:S,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new Je(e,n),new Je(e,n),s),s.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function yp(t,e){return!t.isLightConstant&&e}function cL(t,e,n,o,s,u,h,m){let y=(61440&e|(61440&e)>>4)>>8,x=(3840&e|(3840&e)>>4)>>4,T=240&e|(240&e)>>4;n[3]>0&&(y=gt(y,255*n[0],n[3]),x=gt(x,255*n[1],n[3]),T=gt(T,255*n[2],n[3]));let I=y<<8|x,M=T<<8|Math.floor(255*o[3]),S=function(ie){let le=jt(ie,0,2);return Math.min(Math.round(.5*le*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],R=jt(s[0],0,1),L=jt(s[1],0,1),k=jt(s[2],0,1),B=jt(s[3],0,1),Z,W,X,re;if(R!==L&&h!==u&&L!==R){let ie=h-u;W=1/(ie*(L-R)),X=-(u+ie*R)/(ie*(L-R));let le=jt(s[4],-1,1);re=Math.pow(10,le),Z=255*k<<8|255*B}else Z=65535,W=0,X=1,re=1;if(t.emplaceBack(I,M,S,Z,W,X,re),m){let ie=m.length;m.clear();for(let le=0;le<ie;le++)m.emplaceBack(I,M,S,Z,W,X,re)}}function uL(t,e,n){let o=t.node,s=0,u=n&zh.HasMeshoptCompression;for(let h of o.meshes){if(o.lights&&o.lightMeshIndex===s||!h.featureData)continue;h.featureArray=new yg,h.featureArray.reserve(h.featureData.length);let m=e;for(let y of h.featureData){let x=u?65535&y:y>>16&65535,T=u?y>>16&65535:65535&y,I=(15&T)<8?15&T:0,M=t.evaluatedRMEA[I],S=t.evaluatedColor[I],R=t.emissionHeightBasedParams[I],L;if(m&&I===2&&o.lights&&(L=new yg,L.resize(10*o.lights.length)),cL(h.featureArray,x,S,M,R,h.aabb.min[2],h.aabb.max[2],L),L&&m){m=!1;let k=o.meshes[o.lightMeshIndex];k.featureArray=L,k.featureArray._trim()}}h.featureArray._trim(),s++}}function jM(t,e,n,o){let s=1<<t.z;e.lat=Dr((o/Xe+t.y)/s),e.lng=Ei((n/Xe+t.x)/s)}me(y_,"Tiled3dModelBucket",{omit:["layers"]}),me(BM,"Tiled3dModelFeature");let hL={circle:class extends Ti{constructor(t,e,n,o){super(t,{layout:wT||(wT=new Rn({"circle-sort-key":new ct(Ie.layout_circle["circle-sort-key"]),visibility:new He(Ie.layout_circle.visibility)})),paint:TT||(TT=new Rn({"circle-radius":new ct(Ie.paint_circle["circle-radius"]),"circle-color":new ct(Ie.paint_circle["circle-color"]),"circle-blur":new ct(Ie.paint_circle["circle-blur"]),"circle-opacity":new ct(Ie.paint_circle["circle-opacity"]),"circle-translate":new He(Ie.paint_circle["circle-translate"]),"circle-translate-anchor":new He(Ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new He(Ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new He(Ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ct(Ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ct(Ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ct(Ie.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new He(Ie.paint_circle["circle-emissive-strength"])}))},e,n,o)}createBucket(t){return new uv(t)}queryRadius(t){let e=t;return Eh("circle-radius",this,e)+Eh("circle-stroke-width",this,e)+Eg(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,o,s,u,h,m){let y=bT(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return zT(t,o,u,h,m,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,x)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,n){let o=NT(this);return{config:new kc(this,{zoom:e,lut:n}),defines:o,overrideFog:!1}}},heatmap:class extends Ti{createBucket(t){return new jT(t)}constructor(t,e,n,o){super(t,{layout:GT||(GT=new Rn({visibility:new He(Ie.layout_heatmap.visibility)})),paint:HT||(HT=new Rn({"heatmap-radius":new ct(Ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ct(Ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new He(Ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Yr(Ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new He(Ie.paint_heatmap["heatmap-opacity"])}))},e,n,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Uf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Eh("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,o,s,u,h,m){let y=this.paint.get("heatmap-radius").evaluate(e,n);return zT(t,o,u,h,m,!0,!0,new Je(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,n){return t==="heatmap"?{config:new kc(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends Ti{constructor(t,e,n,o){super(t,{layout:qT||(qT=new Rn({visibility:new He(Ie.layout_hillshade.visibility)})),paint:WT||(WT=new Rn({"hillshade-illumination-direction":new He(Ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new He(Ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new He(Ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new He(Ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new He(Ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new He(Ie.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new He(Ie.paint_hillshade["hillshade-emissive-strength"])}))},e,n,o)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},fill:class extends Ti{constructor(t,e,n,o){super(t,{layout:KT||(KT=new Rn({"fill-sort-key":new ct(Ie.layout_fill["fill-sort-key"]),visibility:new He(Ie.layout_fill.visibility)})),paint:JT||(JT=new Rn({"fill-antialias":new He(Ie.paint_fill["fill-antialias"]),"fill-opacity":new ct(Ie.paint_fill["fill-opacity"]),"fill-color":new ct(Ie.paint_fill["fill-color"]),"fill-outline-color":new ct(Ie.paint_fill["fill-outline-color"]),"fill-translate":new He(Ie.paint_fill["fill-translate"]),"fill-translate-anchor":new He(Ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new ct(Ie.paint_fill["fill-pattern"]),"fill-emissive-strength":new He(Ie.paint_fill["fill-emissive-strength"])}))},e,n,o)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e,n){return{config:new kc(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Og(t)}queryRadius(){return Eg(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,o,s,u){return!t.queryGeometry.isAboveHorizon&&gT(xT(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends Ti{constructor(t,e,n,o){super(t,{layout:NE||(NE=new Rn({visibility:new He(Ie["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new He(Ie["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:zE||(zE=new Rn({"fill-extrusion-opacity":new He(Ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ct(Ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new He(Ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new He(Ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ct(Ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ct(Ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ct(Ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new He(Ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new He(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new He(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new He(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new He(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new He(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new He(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new He(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ct(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ct(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new He(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new He(Ie["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new He(Ie["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new He(Ie["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new He(Ie["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new ct(Ie["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-line-alignment":new He(Ie["paint_fill-extrusion"]["fill-extrusion-line-alignment"])}))},e,n,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Vg(t)}queryRadius(){return Eg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,o,s,u,h,m,y){let x=bT(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,n),I=this.paint.get("fill-extrusion-base").evaluate(e,n),M=[0,0],S=m&&u.elevation,R=u.elevation?u.elevation.exaggeration():1,L=t.tile.getBucket(this);if(S&&L instanceof Vg){let X=L.centroidVertexArray,re=y+1;re<X.length&&(M[0]=X.geta_centroid_pos0(re),M[1]=X.geta_centroid_pos1(re))}if(M[0]===0&&M[1]===1)return!1;u.projection.name==="globe"&&(o=FE([o],[new Je(0,0),new Je(Xe,Xe)],t.tileID.canonical).map(X=>X.polygon).flat());let k=S?m:null,[B,Z]=function(X,re,ie,le,ge,we,Ce,Te,Oe,$e,Le){return X.projection.name==="globe"?function(qe,Re,ze,Ze,ke,Qe,We,Ge,ft,ht,ot){let Ye=[],vt=[],dt=qe.projection.upVectorScale(ot,qe.center.lat,qe.worldSize).metersToTile,lt=[0,0,0,1],Et=[0,0,0,1],Ct=(Nt,Zt,$t,Cn)=>{Nt[0]=Zt,Nt[1]=$t,Nt[2]=Cn,Nt[3]=1},It=kE();ze>0&&(ze+=It),Ze+=It;for(let Nt of Re){let Zt=[],$t=[];for(let Cn of Nt){let On=Cn.x+ke.x,St=Cn.y+ke.y,gn=qe.projection.projectTilePoint(On,St,ot),xn=qe.projection.upVector(ot,Cn.x,Cn.y),zn=ze,Kn=Ze;if(We){let lr=jE(On,St,ze,Ze,We,Ge,ft,ht);zn+=lr.base,Kn+=lr.top}ze!==0?Ct(lt,gn.x+xn[0]*dt*zn,gn.y+xn[1]*dt*zn,gn.z+xn[2]*dt*zn):Ct(lt,gn.x,gn.y,gn.z),Ct(Et,gn.x+xn[0]*dt*Kn,gn.y+xn[1]*dt*Kn,gn.z+xn[2]*dt*Kn),r.$.transformMat4(lt,lt,Qe),r.$.transformMat4(Et,Et,Qe),Zt.push(new jc(lt[0],lt[1],lt[2])),$t.push(new jc(Et[0],Et[1],Et[2]))}Ye.push(Zt),vt.push($t)}return[Ye,vt]}(X,re,ie,le,ge,we,Ce,Te,Oe,$e,Le):Ce?function(qe,Re,ze,Ze,ke,Qe,We,Ge,ft){let ht=[],ot=[],Ye=[0,0,0,1];for(let vt of qe){let dt=[],lt=[];for(let Et of vt){let Ct=Et.x+Ze.x,It=Et.y+Ze.y,Nt=jE(Ct,It,Re,ze,Qe,We,Ge,ft);Ye[0]=Ct,Ye[1]=It,Ye[2]=Nt.base,Ye[3]=1,r.aB.transformMat4(Ye,Ye,ke),Ye[3]=Math.max(Ye[3],1e-5);let Zt=new jc(Ye[0]/Ye[3],Ye[1]/Ye[3],Ye[2]/Ye[3]);Ye[0]=Ct,Ye[1]=It,Ye[2]=Nt.top,Ye[3]=1,r.aB.transformMat4(Ye,Ye,ke),Ye[3]=Math.max(Ye[3],1e-5);let $t=new jc(Ye[0]/Ye[3],Ye[1]/Ye[3],Ye[2]/Ye[3]);dt.push(Zt),lt.push($t)}ht.push(dt),ot.push(lt)}return[ht,ot]}(re,ie,le,ge,we,Ce,Te,Oe,$e):function(qe,Re,ze,Ze,ke){let Qe=[],We=[],Ge=ke[8]*Re,ft=ke[9]*Re,ht=ke[10]*Re,ot=ke[11]*Re,Ye=ke[8]*ze,vt=ke[9]*ze,dt=ke[10]*ze,lt=ke[11]*ze;for(let Et of qe){let Ct=[],It=[];for(let Nt of Et){let Zt=Nt.x+Ze.x,$t=Nt.y+Ze.y,Cn=ke[0]*Zt+ke[4]*$t+ke[12],On=ke[1]*Zt+ke[5]*$t+ke[13],St=ke[2]*Zt+ke[6]*$t+ke[14],gn=ke[3]*Zt+ke[7]*$t+ke[15],xn=Cn+Ge,zn=On+ft,Kn=St+ht,lr=Math.max(gn+ot,1e-5),Jn=Cn+Ye,Yn=On+vt,xr=St+dt,hr=Math.max(gn+lt,1e-5);Ct.push(new jc(xn/lr,zn/lr,Kn/lr)),It.push(new jc(Jn/hr,Yn/hr,xr/hr))}Qe.push(Ct),We.push(It)}return[Qe,We]}(re,ie,le,ge,we)}(u,o,I,T,x,h,k,M,R,u.center.lat,t.tileID.canonical),W=t.queryGeometry;return function(X,re,ie){let le=1/0;gT(ie,re)&&(le=BE(ie,re[0]));for(let ge=0;ge<re.length;ge++){let we=re[ge],Ce=X[ge];for(let Te=0;Te<we.length-1;Te++){let Oe=we[Te],$e=[Oe,we[Te+1],Ce[Te+1],Ce[Te],Oe];hv(ie,$e)&&(le=Math.min(le,BE(ie,$e)))}}return le!==1/0&&le}(B,Z,W.isPointQuery()?W.screenBounds:W.screenGeometry)}},line:class extends Ti{constructor(t,e,n,o){let s=XI();super(t,s,e,n,o),s.layout&&(this.layout=new Mr(s.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Xa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=(()=>{if(dp)return dp;let n=XI();return dp=new zO(n.paint.properties["line-width"].specification),dp.useIntegerZoom=!0,dp})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Ug(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,n){let o=YE(this);return{config:new kc(this,{zoom:e,lut:n}),defines:o,overrideFog:!1}}queryRadius(t){let e=t,n=KI(Eh("line-width",this,e),Eh("line-gap-width",this,e)),o=Eh("line-offset",this,e);return n/2+Math.abs(o)+Eg(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,o,s,u){if(t.queryGeometry.isAboveHorizon)return!1;let h=xT(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),m=t.pixelToTileUnitsFactor/2*KI(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),y=this.paint.get("line-offset").evaluate(e,n);return y&&(o=function(x,T){let I=[],M=new Je(0,0);for(let S=0;S<x.length;S++){let R=x[S],L=[];for(let k=0;k<R.length;k++){let B=R[k],Z=R[k+1],W=k===0?M:B.sub(R[k-1])._unit()._perp(),X=k===R.length-1?M:Z.sub(B)._unit()._perp(),re=W._add(X)._unit();re._mult(1/(re.x*X.x+re.y*X.y)),L.push(re._mult(T)._add(B))}I.push(L)}return I}(o,y*t.pixelToTileUnitsFactor)),function(x,T,I){for(let M=0;M<T.length;M++){let S=T[M];if(x.length>=3){for(let R=0;R<S.length;R++)if(sl(x,S[R]))return!0}if(cP(x,S,I))return!0}return!1}(h,o,m)}isTileClipped(){return!0}isDraped(t){let e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:a_,background:class extends Ti{constructor(t,e,n,o){super(t,{layout:eM||(eM=new Rn({visibility:new He(Ie.layout_background.visibility)})),paint:tM||(tM=new Rn({"background-color":new He(Ie.paint_background["background-color"]),"background-pattern":new He(Ie.paint_background["background-pattern"]),"background-opacity":new He(Ie.paint_background["background-opacity"]),"background-emissive-strength":new He(Ie.paint_background["background-emissive-strength"])}))},e,n,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},raster:sM,"raster-particle":dM,sky:class extends Ti{constructor(t,e,n,o){super(t,{layout:cM||(cM=new Rn({visibility:new He(Ie.layout_sky.visibility)})),paint:uM||(uM=new Rn({"sky-type":new He(Ie.paint_sky["sky-type"]),"sky-atmosphere-sun":new He(Ie.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new He(Ie.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new He(Ie.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new He(Ie.paint_sky["sky-gradient-radius"]),"sky-gradient":new Yr(Ie.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new He(Ie.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new He(Ie.paint_sky["sky-atmosphere-color"]),"sky-opacity":new He(Ie.paint_sky["sky-opacity"])}))},e,n,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Uf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let o=this.paint.get("sky-atmosphere-sun"),s=!o,u=t.style.light,h=u.properties.get("position");return s&&u.properties.get("anchor")==="viewport"&&rr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),s?nx(h.azimuthal,90-h.polar,e):nx(o[0],90-o[1],e)}let n=this.paint.get("sky-gradient-center");return nx(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends Ti{constructor(t,e,n,o){super(t,{paint:hM||(hM=new Rn({}))},e,null)}},model:class extends Ti{constructor(t,e,n,o){super(t,{layout:wM||(wM=new Rn({visibility:new He(Ie.layout_model.visibility),"model-id":new ct(Ie.layout_model["model-id"])})),paint:TM||(TM=new Rn({"model-opacity":new He(Ie.paint_model["model-opacity"]),"model-rotation":new ct(Ie.paint_model["model-rotation"]),"model-scale":new ct(Ie.paint_model["model-scale"]),"model-translation":new ct(Ie.paint_model["model-translation"]),"model-color":new ct(Ie.paint_model["model-color"]),"model-color-mix-intensity":new ct(Ie.paint_model["model-color-mix-intensity"]),"model-type":new He(Ie.paint_model["model-type"]),"model-cast-shadows":new He(Ie.paint_model["model-cast-shadows"]),"model-receive-shadows":new He(Ie.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new He(Ie.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ct(Ie.paint_model["model-emissive-strength"]),"model-roughness":new ct(Ie.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ct(Ie.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new He(Ie.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new He(Ie.paint_model["model-front-cutoff"])}))},e,n,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new ix(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof y_?Xe-1:0}queryIntersectsFeature(t,e,n,o,s,u){if(!this.modelManager)return!1;let h=this.modelManager,m=t.tile.getBucket(this);if(!(m&&m instanceof ix))return!1;let y=m;for(let x in y.instancesPerModel){let T=y.instancesPerModel[x],I=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(I)){let M=T.features[T.idToFeaturesIndex[I]],S=h.getModel(x,this.scope);if(!S)return!1;let R=r.ae.create(),L=new cn(0,0),k=y.canonical,B=Number.MAX_VALUE;for(let Z=0;Z<M.instancedDataCount;++Z){let W=16*(M.instancedDataOffset+Z),X=T.instancedDataArray.float32,re=[X[W+4],X[W+5],X[W+6]];jM(k,L,X[W],0|X[W+1]),EM(R,S,u,L,M.rotation,M.scale,re,!1,!1,!1),u.projection.name==="globe"&&(R=rx(R,u));let ie=r.ae.multiply([],u.projMatrix,R),le=t.queryGeometry,ge=yM(le.isPointQuery()?le.screenBounds:le.screenGeometry,u,ie,S.aabb);ge!=null&&(B=Math.min(ge,B))}return B!==Number.MAX_VALUE&&B}}return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof te}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,n,o){let s=t.tile,u=s.getBucket(this),h=null,m=Number.MAX_VALUE;if(!(u&&u instanceof y_))return{queryFeature:h,intersectionZ:m};let y=u.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!n.filter(new xt(s.tileID.overscaledZ),y.feature,s.tileID.canonical))return{queryFeature:h,intersectionZ:m};let x=y.node,T=o.calculatePosMatrix(s.tileID.toUnwrapped(),o.worldSize),I=y.evaluatedScale,M=0;o.elevation&&x.elevation&&(M=x.elevation*o.elevation.exaggeration()),r.ae.translate(T,T,[(x.anchor?x.anchor[0]:0)*(I[0]-1),(x.anchor?x.anchor[1]:0)*(I[1]-1),M]),r.ae.scale(T,T,I),r.ae.multiply(T,T,x.matrix);let S=t.queryGeometry,R=S.isPointQuery()?S.screenBounds:S.screenGeometry,L=function(B){let Z=r.ae.multiply([],T,B.matrix),W=r.ae.multiply(Z,o.expandedFarZProjMatrix,Z);for(let X=0;X<B.meshes.length;++X){let re=B.meshes[X];if(X===B.lightMeshIndex)continue;let ie=yM(R,o,W,re.aabb);ie!=null&&(m=Math.min(ie,m))}if(B.children)for(let X of B.children)L(X)};if(L(x),m===Number.MAX_VALUE)return{queryFeature:h,intersectionZ:m};let k=new cn(0,0);return jM(s.tileID.canonical,k,y.node.anchor[0],y.node.anchor[1]),h={type:"Feature",geometry:{type:"Point",coordinates:[k.lng,k.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:h,intersectionZ:m}}},clip:class extends Ti{constructor(t,e,n,o){super(t,{layout:eE||(eE=new Rn({"clip-layer-types":new He(Ie.layout_clip["clip-layer-types"]),"clip-layer-scope":new He(Ie.layout_clip["clip-layer-scope"])})),paint:tE||(tE=new Rn({}))},e,n,o)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new nE(t)}isTileClipped(){return!0}is3D(){return!0}}};me(qI,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let VM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class px{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,o]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let s=o>>4;if(s!==1)throw new Error(`Got v${s} data when expected v1.`);let u=VM[15&o];if(!u)throw new Error("Unrecognized array type.");let[h]=new Uint16Array(e,2,1),[m]=new Uint32Array(e,4,1);return new px(m,h,u,e)}constructor(e,n=64,o=Float64Array,s){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let u=VM.indexOf(this.ArrayType),h=2*e*this.ArrayType.BYTES_PER_ELEMENT,m=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-m%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${o}.`);s&&s instanceof ArrayBuffer?(this.data=s,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+h+m+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=n,o}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return mx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,o,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:h,nodeSize:m}=this,y=[0,u.length-1,0],x=[];for(;y.length;){let T=y.pop()||0,I=y.pop()||0,M=y.pop()||0;if(I-M<=m){for(let k=M;k<=I;k++){let B=h[2*k],Z=h[2*k+1];B>=e&&B<=o&&Z>=n&&Z<=s&&x.push(u[k])}continue}let S=M+I>>1,R=h[2*S],L=h[2*S+1];R>=e&&R<=o&&L>=n&&L<=s&&x.push(u[S]),(T===0?e<=R:n<=L)&&(y.push(M),y.push(S-1),y.push(1-T)),(T===0?o>=R:s>=L)&&(y.push(S+1),y.push(I),y.push(1-T))}return x}within(e,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:s,coords:u,nodeSize:h}=this,m=[0,s.length-1,0],y=[],x=o*o;for(;m.length;){let T=m.pop()||0,I=m.pop()||0,M=m.pop()||0;if(I-M<=h){for(let k=M;k<=I;k++)$M(u[2*k],u[2*k+1],e,n)<=x&&y.push(s[k]);continue}let S=M+I>>1,R=u[2*S],L=u[2*S+1];$M(R,L,e,n)<=x&&y.push(s[S]),(T===0?e-o<=R:n-o<=L)&&(m.push(M),m.push(S-1),m.push(1-T)),(T===0?e+o>=R:n+o>=L)&&(m.push(S+1),m.push(I),m.push(1-T))}return y}}function mx(t,e,n,o,s,u){if(s-o<=n)return;let h=o+s>>1;UM(t,e,h,o,s,u),mx(t,e,n,o,h-1,1-u),mx(t,e,n,h+1,s,1-u)}function UM(t,e,n,o,s,u){for(;s>o;){if(s-o>600){let x=s-o+1,T=n-o+1,I=Math.log(x),M=.5*Math.exp(2*I/3),S=.5*Math.sqrt(I*M*(x-M)/x)*(T-x/2<0?-1:1);UM(t,e,n,Math.max(o,Math.floor(n-T*M/x+S)),Math.min(s,Math.floor(n+(x-T)*M/x+S)),u)}let h=e[2*n+u],m=o,y=s;for(vp(t,e,o,n),e[2*s+u]>h&&vp(t,e,o,s);m<y;){for(vp(t,e,m,y),m++,y--;e[2*m+u]<h;)m++;for(;e[2*y+u]>h;)y--}e[2*o+u]===h?vp(t,e,o,y):(y++,vp(t,e,y,s)),y<=n&&(o=y+1),n<=y&&(s=y-1)}}function vp(t,e,n,o){gx(t,n,o),gx(e,2*n,2*o),gx(e,2*n+1,2*o+1)}function gx(t,e,n){let o=t[e];t[e]=t[n],t[n]=o}function $M(t,e,n,o){let s=t-n,u=e-o;return s*s+u*u}r.A=oh,r.B=Mc,r.C=hn,r.D=Ec,r.E=$s,r.F=ai,r.H=Ro,r.I=uO,r.J=P,r.K=E,r.L=function(t){let e=t.value,n=[];if(!e)return n;let o=ss(e);return o!=="string"?(n=n.concat([new d_(t.key,e,`string expected, "${o}" found`)]),n):(vM(e,!0)||(n=n.concat([new d_(t.key,e,`invalid url "${e}"`)])),n)},r.M=class{constructor(t,e,n,o){this.id=t,this.position=e!=null?new cn(e[0],e[1]):new cn(0,0),this.orientation=n??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new Gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(r.ae.multiply(t.matrix,e,t.matrix),t.meshes)for(let n of t.meshes){let o=Gn.applyTransformFast(n.aabb,t.matrix);this.aabb.encapsulate(o)}if(t.children)for(let n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){let t=r.ae.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,n,o,s,u,h=!1){EM(this.matrix,this,t.transform,this.position,e,n,o,s,u,h)}upload(t){if(!this.uploaded){for(let e of this.nodes)ox(e,t);for(let e of this.nodes)f_(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)sx(t)}},r.N=Ie,r.O=zr,r.P=Je,r.Q=Rr,r.R=oc,r.S=X0,r.T=mo,r.U=Rn,r.V=d_,r.W=He,r.X=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Fa(t.expression.evaluate(e))}interpolate(t,e,n){return{x:gt(t.x,e.x,n),y:gt(t.y,e.y,n),z:gt(t.z,e.z,n),azimuthal:gt(t.azimuthal,e.azimuthal,n),polar:gt(t.polar,e.polar,n)}}},r.Y=xt,r.Z=te,r._=Qr,r.a=zi,r.a$=gv,r.a0=Hd,r.a1=Mr,r.a2=ra,r.a3=gt,r.a4=Xe,r.a5=uf,r.a6=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,o]){let s=Fa([1,n,o]);return{x:s.x,y:s.y,z:s.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:gt(t.x,e.x,n),y:gt(t.y,e.y,n),z:gt(t.z,e.z,n)}}},r.a7=Ff,r.a8=xg,r.a9=Js,r.aA=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},r.aC=function(t,e){let{x:n,y:o}=t.point,s=LT(n,o,t.worldSize/t._pixelsPerMercatorPixel,0,0);return r.ae.multiply(s,s,xv(ps(e)))},r.aE=Ah,r.aF=Ki,r.aG=Hg,r.aH=function(t,e,n,o,s){let u=5*e+2;t.float32[u+0]=n,t.float32[u+1]=o,t.float32[u+2]=s},r.aI=n_,r.aJ=cn,r.aK=kI,r.aL=uT,r.aM=_v,r.aN=pM,r.aO=Nc,r.aP=PT,r.aQ=fr,r.aR=function(t,e,n,o,s,u,h,m,y){if(y.name==="globe")return PT(t,e,new Nc(n,o,s),!1);let x=Vc({z:n,x:o,y:s},y);return new Gn([(u+x.x/x.scale)*e,e*(x.y/x.scale),h],[(u+x.x2/x.scale)*e,e*(x.y2/x.scale),m])},r.aS=function(t,e,n){let o=0;for(let s=0;s<2;++s)t[s]>0&&(o+=(t[s]-0)*(t[s]-0)),e[s]<0&&(o+=(0-e[s])*(0-e[s]));return o},r.aT=sr,r.aU=mv,r.aV=lT,r.aW=function(t){let e=r.ae.identity(new Float64Array(16));r.ae.multiply(e,t.pixelMatrix,t.globeMatrix);let n=[0,fo,0],o=[0,po,0];return r.$.transformMat4(n,n,e),r.$.transformMat4(o,o,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!wv(t,new cn(t.center.lat,90)),o[0]>0&&o[0]<=t.width&&o[1]>0&&o[1]<=t.height&&!wv(t,new cn(t.center.lat,-90))]},r.aX=function(t,e){let{scale:n}=t.tileTransform,o=n*Xe/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return r.aD.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},r.aY=u_,r.aZ=fM,r.a_=function(t){let e=fM(t,!0);return r.aD.invert([],[e[0],e[1],e[4],e[5]])},r.aa=sT,r.ab=li,r.ac=Gt,r.ad=function(t,e,n){let o=Math.sqrt(t*t+e*e+n*n),s=o>0?Math.acos(n/o)*Oa:0,u=t!==0||e!==0?Math.atan2(-e,-t)*Oa+90:0;return u<0&&(u+=360),[o,u,s]},r.af=Fh,r.ag=Bo,r.ah=qv,r.ai=function(t,e){let n={};for(let o=0;o<e.length;o++){let s=e[o];s in t&&(n[s]=t[s])}return n},r.aj=ol,r.ak=ds,r.al=fs,r.am=$w,r.an=function(t){ju++,ju>Kd&&(t.getActor().send("enforceCacheSizeLimit",Qd),ju=0)},r.ao=of,r.ap=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,o){let s=this.entries[t]=this.entries[t]||{callbacks:[]};if(s.result){let[u,h]=s.result;return this.scheduler?this.scheduler.add(()=>{o(u,h)},e):o(u,h),()=>{}}return s.callbacks.push(o),s.cancel||(s.cancel=n((u,h)=>{s.result=[u,h];for(let m of s.callbacks)this.scheduler?this.scheduler.add(()=>{m(u,h)},e):m(u,h);setTimeout(()=>delete this.entries[t],3e3)})),()=>{s.result||(s.callbacks=s.callbacks.filter(u=>u!==o),s.callbacks.length||(s.cancel(),delete this.entries[t]))}}},r.aq=function(t,e,n){let o=JSON.stringify(t.request);return t.data&&(this.deduped.entries[o]={result:[null,t.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},s=>{let u=Bs(t.request,(h,m,y,x)=>{h?s(h):m&&s(null,{vectorTile:n?void 0:new Sv(new Qf(m)),rawData:m,cacheControl:y,expires:x})});return()=>{u.cancel(),s()}},e)},r.ar=J0,r.as=class extends Ks{constructor(t){super(t),this.current=XA}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let o=0;o<9;o++)if(n[o]!==this.current[o]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},r.at=ev,r.au=jt,r.av=La,r.ax=os,r.ay=ui,r.az=Dr,r.b=Zn,r.b$=rP,r.b0=function(t){let{x:e,y:n}=t.point,{lng:o,lat:s}=t._center;return LT(e,n,t.worldSize,o,s)},r.b1=ti,r.b2=wh,r.b3=rv,r.b4=function(t){let e=Math.round((t+45+360)%360/90)%4;return Zl[e]},r.b5=45,r.b6=sv,r.b7=bg,r.b8=Gn,r.b9=Fa,r.bA=s_,r.bB=$T,r.bC=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},r.bD=WE,r.bF=OT,r.bG=Im,r.bH=Em,r.bI=256,r.bJ=function(t,e){let n=[0,0,0],o=Vf(ps(e.canonical));return r.$.transformMat4(n,n,o),r.$.transformMat4(n,n,t),n},r.bK=t=>({u_camera_to_center_distance:new li(t),u_extrude_scale:new tv(t),u_device_pixel_ratio:new li(t),u_matrix:new Ff(t),u_inv_rot_matrix:new Ff(t),u_merc_center:new Js(t),u_tile_id:new J0(t),u_zoom_transition:new li(t),u_up_dir:new J0(t),u_emissive_strength:new li(t)}),r.bL=t=>({u_matrix:new Ff(t),u_pixels_to_tile_units:new tv(t),u_device_pixel_ratio:new li(t),u_units_to_pixels:new Js(t),u_dash_image:new xg(t),u_gradient_image:new xg(t),u_image_height:new li(t),u_texsize:new Js(t),u_tile_units_to_pixels:new li(t),u_alpha_discard_threshold:new li(t),u_trim_offset:new Js(t),u_trim_fade_range:new Js(t),u_trim_color:new ev(t),u_emissive_strength:new li(t)}),r.bM=t=>({u_matrix:new Ff(t),u_texsize:new Js(t),u_pixels_to_tile_units:new tv(t),u_device_pixel_ratio:new li(t),u_image:new xg(t),u_units_to_pixels:new Js(t),u_tile_units_to_pixels:new li(t),u_alpha_discard_threshold:new li(t),u_trim_offset:new Js(t)}),r.bN=U0,r.bO=yR,r.bP=Vr,r.bQ=kR,r.bR=MI,r.bS=Nv,r.bT=NT,r.bU=(t,e,n,o,s,u)=>{let h=t.transform,m=h.projection.name==="globe",y;if(u.paint.get("circle-pitch-alignment")==="map")if(m){let T=OT(h.zoom,e.canonical)*h._pixelsPerMercatorPixel;y=Float32Array.from([T,0,0,T])}else y=h.calculatePixelsToTileUnitsMatrix(n);else y=new Float32Array([h.pixelsToGLUnits[0],0,0,h.pixelsToGLUnits[1]]);let x={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(h.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:kr.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:_P,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(m){x.u_inv_rot_matrix=o,x.u_merc_center=s,x.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],x.u_zoom_transition=ra(h.zoom);let T=s[0]*Xe,I=s[1]*Xe;x.u_up_dir=h.projection.upVector(new Nc(0,0,0),T,I)}return x},r.bV=YE,r.bW=(t,e,n,o,s,u)=>{let h=t.transform;return{u_matrix:XE(t,e,n,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:h.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:s,u_image:0,u_tile_units_to_pixels:ZE(e,h),u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:u}},r.bX=(t,e,n,o,s,u,h)=>{let m=t.transform,y=m.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:XE(t,e,n,o),u_pixels_to_tile_units:y,u_device_pixel_ratio:u,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:s,u_texsize:QE(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ZE(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:h,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength")}},r.bY=zs,r.bZ=Uf,r.b_=kE,r.ba=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},r.bb=Ru,r.bc=function(t,e,n){let o=ra(n.zoom),s=t.style.map._antialias,u=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return o===0&&!s&&!u},r.bd=function(t){let e=t.pixelsPerMeter,n=e/ui(1,t.center.lat),o=r.ae.identity(new Float64Array(16));return r.ae.translate(o,o,[t.point.x,t.point.y,0]),r.ae.scale(o,o,[n,n,e]),Float32Array.from(o)},r.be=Dg,r.bf=function(t){let e=sr-5;t=jt(t,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(Gt(t))),3);return Math.round(n*(iv.length-1))},r.bg=function(t,e,n,o){let s=e.getNorth(),u=e.getSouth(),h=e.getWest(),m=e.getEast(),y=1<<t.z,x=m-h,T=s-u,I=x/vh,M=-T/iv[n],S=[0,I,0,M,0,0,s,h,0];if(t.z>0){let R=180/o;r.bE.multiply(S,S,[R/x+1,0,0,0,R/T+1,0,-.5*R/I,.5*R/M,1])}return S[2]=y,S[5]=t.x,S[8]=t.y,S},r.bh=Vf,r.bi=ps,r.bj=function(t,e,n){let o=r.ae.identity(new Float64Array(16)),s=(e/(1<<t)-.5)*Math.PI*2;return r.ae.rotateY(o,n.globeMatrix,s),Float32Array.from(o)},r.bk=Xd,r.bl=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.bm=sM,r.bn=dM,r.bo=oM,r.bp=function(t,e){let n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let o=0;o<t.length;o++){let s=document.createElement("source");c0(t[o])||(n.crossOrigin="Anonymous"),s.src=t[o],n.appendChild(s)}return{cancel:()=>{}}},r.bq=r_,r.br=ku,r.bs=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let n=e.getSource().maxzoom,o=1<<n,s=Math.floor(t.x),u=Math.floor((t.x-s)*o),h=Math.floor(t.y*o),m=this.findDEMTileFor(new fr(n,s,n,u,h));return!(!m||!m.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let o=this._source();if(!o||t.y<0||t.y>1)return e;let s=o.getSource().maxzoom,u=1<<s,h=Math.floor(t.x),m=t.x-h,y=new fr(s,h,s,Math.floor(m*u),Math.floor(t.y*u)),x=this.findDEMTileFor(y);if(!x||!x.dem)return e;let T=x.dem,I=1<<x.tileID.canonical.z,M=(m*I-x.tileID.canonical.x)*T.dim,S=(t.y*I-x.tileID.canonical.y)*T.dim,R=Math.floor(M),L=Math.floor(S);return(n?this.exaggeration():1)*gt(gt(T.get(R,L),T.get(R,L+1),S-L),gt(T.get(R+1,L),T.get(R+1,L+1),S-L),M-R)}getAtTileOffset(t,e,n){let o=1<<t.canonical.z;return this.getAtPointOrZero(new Qr(t.wrap+(t.canonical.x+e/Xe)/o,(t.canonical.y+n/Xe)/o))}getAtTileOffsetFunc(t,e,n,o){return s=>{let u=this.getAtTileOffset(t,s.x,s.y),h=o.upVector(t.canonical,s.x,s.y),m=o.upVectorScale(t.canonical,e,n).metersToTile;return r.$.scale(h,h,u*m),h}}getForTilePoints(t,e,n,o){if(this.isUsingMockSource())return!1;let s=Dh.create(this,t,o);return!!s&&(e.forEach(u=>{u[2]=this.exaggeration()*s.getElevationAt(u[0],u[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let n=e.dem.tree,o=e.tileID,s=1<<t.canonical.z-o.canonical.z,u=t.canonical.x/s-o.canonical.x,h=t.canonical.y/s-o.canonical.y,m=0;for(let y=0;y<t.canonical.z-o.canonical.z&&!n.leaves[m];y++){u*=2,h*=2;let x=2*Math.floor(h)+Math.floor(u);m=n.childOffsets[m]+x,u%=1,h%=1}return{min:this.exaggeration()*n.minimums[m],max:this.exaggeration()*n.maximums[m]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,n=Number.MAX_VALUE,o=Number.MIN_VALUE;for(let s of t){let u=this.getMinMaxForTile(s.tileID);u&&(n=Math.min(n,u.min),o=Math.max(o,u.max),e=!0)}return e?{min:n,max:o}:null}},r.bt=Bf,r.bu=Mg,r.bv=Lo,r.bw=vr,r.bx=Uc,r.by=ax,r.bz=p_,r.c=kM,r.c$=function(t,e,n,o){return t.type==="custom"?new jO(t,e):new hL[t.type](t,e,n,o)},r.c0=Vg,r.c1=cl,r.c2=450,r.c3=7,r.c4=BO,r.c5=WI,r.c6=256,r.c7=ST,r.c8=xv,r.c9=mn,r.cA=vT,r.cB=function(t,e,n=0){return r.$.fromValues(((e.x-n)*t.scale-t.x)*Xe,(e.y*t.scale-t.y)*Xe,hT(e.z,e.y))},r.cC=function(t){let e=1/0,n=1/0,o=-1/0,s=-1/0;for(let u of t)e=Math.min(e,u.x),n=Math.min(n,u.y),o=Math.max(o,u.x),s=Math.max(s,u.y);return{min:new Je(e,n),max:new Je(o,s)}},r.cD=sl,r.cE=pT,r.cF=ci,r.cG=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.cH=vI,r.cI=hv,r.cJ=cE,r.cK=pE,r.cL=mE,r.cM=Vv,r.cN=px,r.cO=function(t){return t({pluginStatus:In,pluginURL:Wt}),Vt.on("pluginStateChange",t),t},r.cP=Rh,r.cQ=Bv,r.cR=ef,r.cS=Tn,r.cT=ve,r.cU=Yd,r.cV=Gu,r.cW=ni,r.cX=function(t){let e=t.indexOf(fg);return e>=0?t.slice(0,e):t},r.cY=function(t){return t.indexOf(fg)>=0},r.cZ=function(t){let e=t.indexOf(fg);return e>=0?t.slice(e+1):""},r.c_=function(t){let e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},r.ca=el,r.cb=Lc,r.cc=1,r.cd=sp,r.ce=0,r.cf=q0,r.cg=function(t,e,n,o,s){return jt((t-e)/(n-e)*(s-o)+o,o,s)},r.ch=ug,r.ci=zc,r.cj=class{constructor(t,e,n,o){this.context=t,this.format=o,this.size=n,this.texture=t.gl.createTexture();let[s,u,h]=this.size,{gl:m}=t;m.bindTexture(m.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1);let y=this.format,x=m.UNSIGNED_BYTE;this.format===m.DEPTH_COMPONENT&&(y=m.DEPTH_COMPONENT16,x=m.UNSIGNED_SHORT),this.format===m.R8&&(o=m.RED),this.format===m.R32F&&(x=m.FLOAT,o=m.RED),m.texImage3D(m.TEXTURE_3D,0,y,s,u,h,0,o,x,e.data)}bind(t,e){let{context:n}=this,{gl:o}=n;o.bindTexture(o.TEXTURE_3D,this.texture),t!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,t),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},r.ck=rx,r.cl=[1,1,1],r.cm=Dh,r.cn=zh,r.co=nl,r.cp=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Je(1/0,1/0),max:new Je(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){let n=hE(new Je(0,0),new Je(Xe,Xe),t),o=[];if(e&&!Av(n,this._globalClipBounds))return o;for(let s of this._activeRegions){if(s.hiddenByOverlap||!Av(n,s))continue;let u=WP(s.min,s.max,t);o.push({min:u.min,max:u.max,sourceId:this._sourceIds[s.priority],footprint:s.footprint,footprintTileId:s.tileId,order:s.order,clipMask:s.clipMask,clipScope:s.clipScope})}return o}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let n=[];for(let o of e.cache.getVisibleCoordinates()){let s=e.cache.getTile(o).buckets[e.layer];s&&s.updateFootprints(o.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(t){let e=t.getFootprints();if(e.length===0)return;let n=t.getOrder(),o=t.getClipMask(),s=t.getClipScope();for(let u of e){if(!u.footprint)continue;let h=hE(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:h.min,max:h.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:n,clipMask:o,clipScope:s})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||zg(e.min,n.min)||zg(e.max,n.max)||e.order-n.order||e.clipMask-n.clipMask||function(o,s){let u=(h,m)=>h+m;return o.length-s.length||o.reduce(u,"").localeCompare(s.reduce(u,""))}(e.clipScope,n.clipScope));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){let n=this._activeRegions[e],o=this._prevRegions[e];t=n.priority!==o.priority||!uE(n,o)||n.order!==o.order||n.clipMask!==o.clipMask||!Ra(n.clipScope,o.clipScope),++e}}if(t){++this._updateTime;for(let n of this._activeRegions)n.order!==Ng&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));let e=n=>{let o=this._activeRegions;if(n>=o.length)return n;let s=o[n].priority;for(;n<o.length&&o[n].priority===s;)++n;return n};if(this._sourceIds.length>1){let n=0,o=e(n);for(;n!==o;){let s=n,u=n;for(;s!==o;){let h=this._activeRegions[s];h.hiddenByOverlap=!1;for(let m=0;m<u;m++){let y=this._activeRegions[m];if(!y.hiddenByOverlap&&h.order===Ng&&Av(h,y)&&(h.hiddenByOverlap=fE(h.footprint,h.tileId,y.footprint,y.tileId),h.hiddenByOverlap))break}++s}n=o,o=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},r.cq=Qs,r.cr=o_,r.cs=Of,r.ct=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let n=new Lo,o=new vr,s=[],u=t+1+2,h=e[0]+1,m=e[0]+1+(1+e.length),y=(x,T,I)=>{let M=x===u-1?x-2:x===0?x:x-1;return M+=I?24575:0,[M,T]};for(let x=0;x<u;++x)n.emplaceBack(...y(x,0,!0));for(let x=0;x<h;++x)for(let T=0;T<u;++T)n.emplaceBack(...y(T,x,(T===0||T===u-1)&&!0));for(let x=0;x<e.length;++x){let T=e[x];for(let I=0;I<u;++I)n.emplaceBack(...y(I,T,!0))}for(let x=0;x<e.length;++x){let T=o.length,I=e[x]+1+2,M=new vr;for(let L=0;L<I-1;L++){let k=L===I-2,B=k?u*(m-e.length+x-L):u;for(let Z=0;Z<u-1;Z++){let W=L*u+Z;L===0||k||Z===0||Z===u-2?(M.emplaceBack(W+1,W,W+B),M.emplaceBack(W+B,W+B+1,W+1)):(o.emplaceBack(W+1,W,W+B),o.emplaceBack(W+B,W+B+1,W+1))}}let S=Zn.simpleSegment(0,T,n.length,o.length-T);for(let L=0;L<M.uint16.length;L+=3)o.emplaceBack(M.uint16[L],M.uint16[L+1],M.uint16[L+2]);let R=Zn.simpleSegment(0,T,n.length,o.length-T);s.push({withoutSkirts:S,withSkirts:R})}return{vertices:n,indices:o,segments:s}}_createGrid(t){let e=this._fillGridMeshWithLods(vh,iv);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Bf.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new vr;for(let h=0;h<=vh;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let n=new Lc,o=new Lc,s=new Lc,u=new Lc;this._poleSegments=[];for(let h=0,m=0;h<rv;h++){let y=360/(1<<h);n.emplaceBack(0,-ci,0,.5,0),o.emplaceBack(0,-ci,0,.5,1),s.emplaceBack(0,-ci,0,.5,.5),u.emplaceBack(0,-ci,0,.5,.5);for(let x=0;x<=vh;x++){let T=x/vh,I=0,M=gt(0,y,T),[S,R,L]=xh(mP,gP,M,ci);n.emplaceBack(S,R,L,T,I),o.emplaceBack(S,R,L,T,1-I);let k=Gt(M);T=.5+.5*Math.sin(k),I=.5+.5*Math.cos(k),s.emplaceBack(S,R,L,T,I),u.emplaceBack(S,R,L,T,1-I)}this._poleSegments.push(Zn.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,Ig,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(o,Ig,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(s,Ig,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(u,Ig,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},r.cu=function(t){return uc.has(t)},r.cv=Ng,r.cw=TE,r.cx=function(t,e,n=0,o=!0){let s=new Je(n,n),u=t.sub(s),h=e.add(s),m=[u,new Je(h.x,u.y),h,new Je(u.x,h.y)];return o&&m.push(u.clone()),m},r.cy=function(t,e){let n=[];for(let o=0;o<t.length;o++){let s=La(o-1,-1,t.length-1),u=La(o+1,-1,t.length-1),h=t[o],m=t[u],y=t[s].sub(h).unit(),x=m.sub(h).unit(),T=x.angleWithSep(y.x,y.y),I=y.add(x).unit().mult(-1*e/Math.sin(T/2));n.push(h.add(I))}return n},r.cz=AI,r.d=Ra,r.d$=up,r.d0=Or,r.d1=Vt,r.d2=lo,r.d3=Ou,r.d4=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.d5=Wi,r.d6=fT,r.d7=Fc,r.d8=function([t,e,n]){let o=Math.hypot(t,e,n),s=Math.atan2(t,n),u=.5*Math.PI-Math.acos(-e/o);return new cn(ti(s),ti(u))},r.d9=Ei,r.dA=function(){p_().acquire(lx)},r.dB=function(){let t=gp;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(lx),gp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dC=mp,r.dD=function(t){let e=Sm();if(!e)return;let n=e.delete(Dm);t&&n.catch(t).then(()=>t())},r.dE=pp,r.dF=MM,r.dG=function(t){cx=kr.resolveURL(t),jh||(jh=new ax(p_(),new $s)),jh.broadcast("setDracoUrl",cx)},r.dH=DM,r.dI=function(t){Bh=kr.resolveURL(t),jh||(jh=new ax(p_(),new $s)),jh.broadcast("setMeshoptUrl",Bh)},r.dJ=qd,r.dK=me,r.dL=al,r.dM=zo,r.dN=Vc,r.dO=Q0,r.dP=KE,r.dQ=oI,r.dR=$E,r.dS=Ql,r.dT=bI,r.dU=kh,r.dV=function(t,e,n,o,s,u,h,m,y,x,T){t.createArrays(),t.tilePixelRatio=Xe/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let I=t.layers[0].layout,M=t.layers[0]._unevaluatedLayout._values,S={};if(t.textSizeData.kind==="composite"){let{minZoom:B,maxZoom:Z}=t.textSizeData;S.compositeTextSizes=[M["text-size"].possiblyEvaluate(new xt(B),m),M["text-size"].possiblyEvaluate(new xt(Z),m)]}if(t.iconSizeData.kind==="composite"){let{minZoom:B,maxZoom:Z}=t.iconSizeData;S.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new xt(B),m),M["icon-size"].possiblyEvaluate(new xt(Z),m)]}S.layoutTextSize=M["text-size"].possiblyEvaluate(new xt(y+1),m),S.layoutIconSize=M["icon-size"].possiblyEvaluate(new xt(y+1),m),S.textMaxSize=M["text-size"].possiblyEvaluate(new xt(18),m);let R=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",L=I.get("text-size"),k=!1;for(let B of t.features)if(B.icon&&B.icon.nameSecondary){k=!0;break}for(let B of t.features){let Z=I.get("text-font").evaluate(B,{},m).join(","),W=L.evaluate(B,{},m),X=S.layoutTextSize.evaluate(B,{},m),re=(S.layoutIconSize.evaluate(B,{},m),{horizontal:{},vertical:void 0}),ie=B.text,le,ge=[0,0];if(ie){let Te=ie.toString(),Oe=I.get("text-letter-spacing").evaluate(B,{},m)*Vr,$e=I.get("text-line-height").evaluate(B,{},m)*Vr,Le=Be(Te)?Oe:0,qe=I.get("text-anchor").evaluate(B,{},m),Re=I.get("text-variable-anchor");if(!Re){let We=I.get("text-radial-offset").evaluate(B,{},m);ge=We?MI(qe,[We*Vr,jv]):I.get("text-offset").evaluate(B,{},m).map(Ge=>Ge*Vr)}let ze=R?"center":I.get("text-justify").evaluate(B,{},m),Ze=I.get("symbol-placement")==="point",ke=Ze?I.get("text-max-width").evaluate(B,{},m)*Vr:1/0,Qe=We=>{t.allowVerticalPlacement&&Ne(Te)&&(re.vertical=Fv(ie,e,n,s,Z,ke,$e,qe,We,Le,ge,Ki.vertical,!0,X,W))};if(!R&&Re){let We=ze==="auto"?Re.map(ft=>Vv(ft)):[ze],Ge=!1;for(let ft=0;ft<We.length;ft++){let ht=We[ft];if(!re.horizontal[ht])if(Ge)re.horizontal[ht]=re.horizontal[0];else{let ot=Fv(ie,e,n,s,Z,ke,$e,"center",ht,Le,ge,Ki.horizontal,!1,X,W);ot&&(re.horizontal[ht]=ot,Ge=ot.positionedLines.length===1)}}Qe("left")}else{if(ze==="auto"&&(ze=Vv(qe)),Ze||I.get("text-writing-mode").indexOf("horizontal")>=0||!Ne(Te)){let We=Fv(ie,e,n,s,Z,ke,$e,qe,ze,Le,ge,Ki.horizontal,!1,X,W);We&&(re.horizontal[ze]=We)}Qe(Ze?"left":ze)}}let we=!1;if(B.icon&&B.icon.namePrimary){let Te=o[B.icon.namePrimary];Te&&(le=GR(s[B.icon.namePrimary],B.icon.nameSecondary?s[B.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate(B,{},m),I.get("icon-anchor").evaluate(B,{},m)),we=Te.sdf,t.sdfIcons===void 0?t.sdfIcons=Te.sdf:t.sdfIcons!==Te.sdf&&rr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Te.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let Ce=CI(re.horizontal)||re.vertical;t.iconsInText||(t.iconsInText=!!Ce&&Ce.iconsInText),(Ce||le)&&QR(t,B,re,le,o,S,X,0,ge,we,h,m,x,T,k)}u&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)},r.dW=Ug,r.dX=Og,r.dY=Sv,r.dZ=Qf,r.d_=Bg,r.da=bh,r.db=V,r.dc=wv,r.dd=kT,r.de=function(t){let e=[0,0,0],n=r.ae.identity(new Float64Array(16));return r.ae.multiply(n,t.pixelMatrix,t.globeMatrix),r.$.transformMat4(e,e,n),new Je(e[0],e[1])},r.df=Jt,r.dg=Ot,r.dh=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(nc==null){let o=n.navigator?n.navigator.userAgent:null;nc=!!n.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return nc}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.di=Lu,r.dj=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",tf,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!ve(t))return t;let n=Li(t);return n.params.push(`sdk=js-${A}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!ve(t))return t;let n=Li(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!ve(t))return t;let n=Li(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,o){if(!ve(t))return t;let s=Li(t);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),n&&s.params.push(`language=${n}`),o&&s.params.push(`worldview=${o}`),this._makeAPIURL(s,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,o){let s=Li(t);return ve(t)?(s.path=`/styles/v1${s.path}/sprite${e}${n}`,this._makeAPIURL(s,this._customAccessToken||o)):(s.path+=`${e}${n}`,js(s))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ve(t))return t;let o=Li(t);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&o.authority!=="raster"&&n===512?"@2x":""}${Vu.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${V.RASTER_URL_PREFIX}${o.path}`:o.authority==="rasterarrays"?o.path=`/${V.RASTERARRAYS_URL_PREFIX}${o.path}`:o.authority==="3dtiles"?o.path=`/${V.TILES3D_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${V.TILE_URL_VERSION}${o.path}`);let s=this._customAccessToken||function(u){for(let h of u){let m=h.match(/^access_token=(.*)$/);if(m)return m[1]}return null}(o.params)||V.ACCESS_TOKEN;return V.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,s)}canonicalizeTileURL(t,e){let n=Li(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let o="mapbox://";n.path.match(/^\/raster\/v1\//)?o+=`raster/${n.path.replace(`/${V.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?o+=`rasterarrays/${n.path.replace(`/${V.RASTERARRAYS_URL_PREFIX}/`,"")}`:o+=`tiles/${n.path.replace(`/${V.TILE_URL_VERSION}/`,"")}`;let s=n.params;return e&&(s=s.filter(u=>!u.match(/^access_token=/))),s.length&&(o+=`?${s.join("&")}`),o}canonicalizeTileset(t,e){let n=!!e&&ve(e),o=[];for(let s of t.tiles||[])Y(s)?o.push(this.canonicalizeTileURL(s,n)):o.push(s);return o}_makeAPIURL(t,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",o=Li(V.API_URL);if(t.protocol=o.protocol,t.authority=o.authority,t.protocol==="http"){let s=t.params.indexOf("secure");s>=0&&t.params.splice(s,1)}if(o.path!=="/"&&(t.path=`${o.path}${t.path}`),!V.REQUIRE_ACCESS_TOKEN)return js(t);if(e=e||V.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(s=>s.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),js(t)}},r.dk=function(t,e){e?uc.add(t):uc.delete(t)},r.dl=Vu,r.dm=h0,r.dn=sf,r.dp=nf,r.dq=km,r.dr=Fm,r.ds=function(t){uc.delete(t)},r.dt=cc,r.du=ja,r.dv=Xl,r.dw=A,r.dx=function(t,e){Qd=t,Kd=e},r.dy=function(t,e,n=!1){if(In===_t||In===kt||In===Ht)throw new Error("setRTLTextPlugin cannot be called multiple times.");Wt=kr.resolveURL(t),In=_t,kn=e,Bt(),n||tn()},r.dz=Pt,r.e=kr,r.e0=kg,r.e1=Lg,r.e2=Wl,r.e3=JE,r.e4=Ft,r.e5=Bs,r.e6=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==SM){let n=new Uint32Array(t,0,7),[,,o,s,u,h]=n;e=n.byteLength+s+u+h+u,(o!==t.byteLength||e>=t.byteLength)&&rr("Invalid b3dm header information.")}return OM(t,e)},r.e7=function(t,e){let n=kM(t);for(let o of n){for(let s of o.meshes)aL(s);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(lL(o.lights,e)))}return n},r.e8=y_,r.e9=IM,r.ea=Ut,r.eb=function(t){rc(),ao&&ao.then(e=>{e.keys().then(n=>{for(let o=0;o<n.length-t;o++)e.delete(n[o])})})},r.f=hc,r.g=co,r.h=function(t,e){return lo(Rr(t,{type:"json"}),e)},r.i=ac,r.j=Qi,r.k=xI,r.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>OM(e,0,t))},r.m=zv,r.n=class extends d_{},r.o=ss,r.p=hO,r.q=Ua,r.r=w,r.s=C,r.t=D,r.u=Po,r.v=J,r.w=rr,r.x=Yi,r.y=ne,r.z=Q}),p(["./shared"],function(r){function A(pe){let j=pe?pe.url.toString():void 0;return j?performance.getEntriesByName(j):[]}function N(pe){if(typeof pe=="number"||typeof pe=="boolean"||typeof pe=="string"||pe==null)return JSON.stringify(pe);if(Array.isArray(pe)){let q="[";for(let ee of pe)q+=`${N(ee)},`;return`${q}]`}let j="{";for(let q of Object.keys(pe).sort())j+=`${q}:${N(pe[q])},`;return`${j}}`}function V(pe){let j="";for(let q of r.cG)j+=`/${N(pe[q])}`;return j}class Y{constructor(j){this.keyCache={},this._layers={},this._layerConfigs={},j&&this.replace(j)}replace(j,q){this._layerConfigs={},this._layers={},this.update(j,[],q)}update(j,q,ee){this._options=ee;for(let ae of j)this._layerConfigs[ae.id]=ae,(this._layers[ae.id]=r.c$(ae,this.scope,null,this._options)).compileFilter(),this.keyCache[ae.id]&&delete this.keyCache[ae.id];for(let ae of q)delete this.keyCache[ae],delete this._layerConfigs[ae],delete this._layers[ae];this.familiesBySource={};let ue=function(ae,ye){let Se={};for(let De=0;De<ae.length;De++){let Ue=ye&&ye[ae[De].id]||V(ae[De]);ye&&(ye[ae[De].id]=Ue);let Ve=Se[Ue];Ve||(Ve=Se[Ue]=[]),Ve.push(ae[De])}let _e=[];for(let De in Se)_e.push(Se[De]);return _e}(r.dJ(this._layerConfigs),this.keyCache);for(let ae of ue){let ye=ae.map(it=>this._layers[it.id]),Se=ye[0];if(Se.visibility==="none")continue;let _e=Se.source||"",De=this.familiesBySource[_e];De||(De=this.familiesBySource[_e]={});let Ue=Se.sourceLayer||"_geojsonTileLayer",Ve=De[Ue];Ve||(Ve=De[Ue]=[]),Ve.push(ye)}}}let ve=1*r.dM;class Pe{constructor(j){let q={},ee=[];for(let Se in j){let _e=j[Se],De=q[Se]={};for(let Ue in _e.glyphs){let Ve=_e.glyphs[+Ue];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;let it=Ve.metrics.localGlyph?ve:1,pt={x:0,y:0,w:Ve.bitmap.width+2*it,h:Ve.bitmap.height+2*it};ee.push(pt),De[Ue]=pt}}let{w:ue,h:ae}=r.k(ee),ye=new r.dL({width:ue||1,height:ae||1});for(let Se in j){let _e=j[Se];for(let De in _e.glyphs){let Ue=_e.glyphs[+De];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;let Ve=q[Se][De],it=Ue.metrics.localGlyph?ve:1;r.dL.copy(Ue.bitmap,ye,{x:0,y:0},{x:Ve.x+it,y:Ve.y+it},Ue.bitmap)}}this.image=ye,this.positions=q}}r.dK(Pe,"GlyphAtlas");class tt{constructor(j){this.tileID=new r.aQ(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.tileZoom=j.tileZoom,this.uid=j.uid,this.zoom=j.zoom,this.lut=j.lut,this.canonical=j.tileID.canonical,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.scope=j.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.promoteId=j.promoteId,this.isSymbolTile=j.isSymbolTile,this.tileTransform=r.dN(j.tileID.canonical,j.projection),this.projection=j.projection,this.brightness=j.brightness,this.extraShadowCaster=!!j.extraShadowCaster,this.tessellationStep=j.tessellationStep}parse(j,q,ee,ue,ae){this.status="parsing",this.data=j,this.collisionBoxArray=new r.dO;let ye=new r.dP(Object.keys(j.layers).sort()),Se=new r.dQ(this.tileID,this.promoteId);Se.bucketLayerIDs=[];let _e={},De=new r.dR(256,256),Ue={featureIndex:Se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:De,availableImages:ee,brightness:this.brightness},Ve=q.familiesBySource[this.source];for(let ut in Ve){let Vn=j.layers[ut];if(!Vn)continue;let an=!1,Yt=!1,tr=!1;for(let Pr of Ve[ut])Pr[0].type==="symbol"?an=!0:Yt=!0,Pr[0].is3D()&&Pr[0].type!=="model"&&(tr=!0);if(this.extraShadowCaster&&!tr||this.isSymbolTile===!0&&!an||this.isSymbolTile===!1&&!Yt)continue;Vn.version===1&&r.w(`Vector tile source "${this.source}" layer "${ut}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let nr=ye.encode(ut),mr=[];for(let Pr=0;Pr<Vn.length;Pr++){let Zr=Vn.feature(Pr),Fs=Se.getId(Zr,ut);mr.push({feature:Zr,id:Fs,index:Pr,sourceLayerIndex:nr})}for(let Pr of Ve[ut]){let Zr=Pr[0];(!this.extraShadowCaster||Zr.is3D()&&Zr.type!=="model")&&(this.isSymbolTile!==void 0&&Zr.type==="symbol"!==this.isSymbolTile||Zr.minzoom&&this.zoom<Math.floor(Zr.minzoom)||Zr.maxzoom&&this.zoom>=Zr.maxzoom||Zr.visibility!=="none"&&(rt(Pr,this.zoom,Ue.brightness,ee),(_e[Zr.id]=Zr.createBucket({index:Se.bucketLayerIDs.length,layers:Pr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:nr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(mr,Ue,this.tileID.canonical,this.tileTransform),Se.bucketLayerIDs.push(Pr.map(Fs=>Fs.id))))}}let it,pt,yt,sn;De.trim();let Lt={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},en=()=>{if(it)return this.status="done",ae(it);if(this.extraShadowCaster)this.status="done",ae(null,{buckets:r.dJ(_e).filter(ut=>!ut.isEmpty()),featureIndex:Se,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ue.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(pt&&yt&&sn){let ut=new Pe(pt),Vn=new r.dT(yt,sn,this.lut);for(let an in _e){let Yt=_e[an];Yt instanceof r.dU?(rt(Yt.layers,this.zoom,Ue.brightness,ee),r.dV(Yt,pt,ut.positions,yt,Vn.iconPositions,this.showCollisionBoxes,ee,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Yt.hasPattern&&(Yt instanceof r.dW||Yt instanceof r.dX||Yt instanceof r.c0)&&(rt(Yt.layers,this.zoom,Ue.brightness,ee),Yt.addFeatures(Ue,this.tileID.canonical,Vn.patternPositions,ee,this.tileTransform,this.brightness))}this.status="done",ae(null,{buckets:r.dJ(_e).filter(an=>!an.isEmpty()),featureIndex:Se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ut.image,lineAtlas:De,imageAtlas:Vn,brightness:Ue.brightness})}};if(!this.extraShadowCaster){let ut=r.dS(Ue.glyphDependencies,Yt=>Object.keys(Yt).map(Number));Object.keys(ut).length?ue.send("getGlyphs",{uid:this.uid,stacks:ut,scope:this.scope},(Yt,tr)=>{it||(it=Yt,pt=tr,en())},void 0,!1,Lt):pt={};let Vn=Object.keys(Ue.iconDependencies);Vn.length?ue.send("getImages",{icons:Vn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Yt,tr)=>{it||(it=Yt,yt=tr,en())},void 0,!1,Lt):yt={};let an=Object.keys(Ue.patternDependencies);an.length?ue.send("getImages",{icons:an,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Yt,tr)=>{it||(it=Yt,sn=tr,en())},void 0,!1,Lt):sn={}}en()}}function rt(pe,j,q,ee){let ue=new r.Y(j,{brightness:q});for(let ae of pe)ae.recalculate(ue,ee)}class Ot extends r.E{constructor(j,q,ee,ue,ae,ye){super(),this.actor=j,this.layerIndex=q,this.availableImages=ee,this.loadVectorData=ae||r.aq,this.loading={},this.loaded={},this.deduped=new r.ap(j.scheduler),this.isSpriteLoaded=ue,this.scheduler=j.scheduler,this.brightness=ye}loadTile(j,q){let ee=j.uid,ue=j&&j.request,ae=ue&&ue.collectResourceTiming,ye=this.loading[ee]=new tt(j);ye.abort=this.loadVectorData(j,(Se,_e)=>{let De=!this.loading[ee];if(delete this.loading[ee],De||Se||!_e)return ye.status="done",De||(this.loaded[ee]=ye),q(Se);let Ue=_e.rawData,Ve={};_e.expires&&(Ve.expires=_e.expires),_e.cacheControl&&(Ve.cacheControl=_e.cacheControl),ye.vectorTile=_e.vectorTile||new r.dY(new r.dZ(Ue));let it=()=>{ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor,(pt,yt)=>{if(pt||!yt)return q(pt);let sn={};if(ae){let Lt=A(ue);Lt.length>0&&(sn.resourceTiming=JSON.parse(JSON.stringify(Lt)))}q(null,r.Q({rawTileData:Ue.slice(0)},yt,Ve,sn))})};this.isSpriteLoaded?it():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(it,{type:"parseTile",isSymbolTile:j.isSymbolTile,zoom:j.tileZoom}):it()}),this.loaded=this.loaded||{},this.loaded[ee]=ye})}reloadTile(j,q){let ee=this.loaded,ue=j.uid;if(ee&&ee[ue]){let ae=ee[ue];ae.showCollisionBoxes=j.showCollisionBoxes,ae.projection=j.projection,ae.brightness=j.brightness,ae.tileTransform=r.dN(j.tileID.canonical,j.projection),ae.extraShadowCaster=j.extraShadowCaster,ae.lut=j.lut;let ye=(Se,_e)=>{let De=ae.reloadCallback;De&&(delete ae.reloadCallback,ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,De)),q(Se,_e)};ae.status==="parsing"?ae.reloadCallback=ye:ae.status==="done"&&(ae.vectorTile?ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,ye):ye())}else q(null,void 0)}abortTile(j,q){let ee=j.uid,ue=this.loading[ee];ue&&(ue.abort&&ue.abort(),delete this.loading[ee]),q()}removeTile(j,q){let ee=this.loaded,ue=j.uid;ee&&ee[ue]&&delete ee[ue],q()}}class Jt{loadTile(j,q){let{uid:ee,encoding:ue,rawImageData:ae,padding:ye}=j,Se=ImageBitmap&&ae instanceof ImageBitmap?this.getImageData(ae,ye):ae;q(null,new r.d_(ee,Se,ue,ye<1))}getImageData(j,q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(j.width,j.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=j.width,this.offscreenCanvas.height=j.height,this.offscreenCanvasContext.drawImage(j,0,0,j.width,j.height);let ee=this.offscreenCanvasContext.getImageData(-q,-q,j.width+2*q,j.height+2*q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ee}}r.d$.setPbf(r.dZ);class qt{decodeRasterArray({task:j,buffer:q},ee){r.d$.performDecoding(q,j).then(ue=>{ee(null,ue)},ue=>{ee(ue)})}}let Ft=r.e0.prototype.toGeoJSON,rn=class{constructor(pe){this._feature=pe,this.extent=r.a4,this.type=pe.type,this.properties=pe.tags,"id"in pe&&!isNaN(pe.id)&&(this.id=parseInt(pe.id,10))}loadGeometry(){if(this._feature.type===1){let pe=[];for(let j of this._feature.geometry)pe.push([new r.P(j[0],j[1])]);return pe}{let pe=[];for(let j of this._feature.geometry){let q=[];for(let ee of j)q.push(new r.P(ee[0],ee[1]));pe.push(q)}return pe}}toGeoJSON(pe,j,q){return Ft.call(this,pe,j,q)}},on=class{constructor(pe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.a4,this.length=pe.length,this._features=pe}feature(pe){return new rn(this._features[pe])}},Ln=64/4096,Cr=128;class Sr{constructor(){this.features=new Map}clear(){this.features.clear()}load(j=[],q){for(let ee of j){let ue=ee.id;if(ue==null)continue;let ae=this.features.get(ue);ae&&this.updateCache(ae,q),ee.geometry?(ae=Dn(ee),this.updateCache(ae,q),this.features.set(ue,ae)):this.features.delete(ue),this.updateCache(ae,q)}}updateCache(j,q){for(let{canonical:ee,uid:ue}of Object.values(q)){let{z:ae,x:ye,y:Se}=ee;di(j,Math.pow(2,ae),ye,Se)&&delete q[ue]}}getTile(j,q,ee){let ue=Math.pow(2,j),ae=[];for(let ye of this.features.values())di(ye,ue,q,ee)&&ae.push(yu(ye,ue,q,ee));return{features:ae}}getFeatures(){return[...this.features.values()]}}function di({minX:pe,minY:j,maxX:q,maxY:ee},ue,ae,ye){return pe<(ae+1+Ln)/ue&&j<(ye+1+Ln)/ue&&q>(ae-Ln)/ue&&ee>(ye-Ln)/ue}function Dn(pe){let{id:j,geometry:q,properties:ee}=pe;if(!q)return;if(q.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:ue,coordinates:ae}=q,ye={id:j,type:1,geometry:[],tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Se=ye.geometry;if(ue==="Point")vn(ae,Se,ye);else if(ue==="MultiPoint")for(let _e of ae)vn(_e,Se,ye);else if(ue==="LineString")ye.type=2,fi(ae,Se,ye);else if(ue==="MultiLineString")ye.type=2,ga(ae,Se,ye);else if(ue==="Polygon")ye.type=3,ga(ae,Se,ye,!0);else{if(ue!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ye.type=3;for(let _e of ae)ga(_e,Se,ye,!0)}return ye}function vn([pe,j],q,ee){let ue=r.ak(pe),ae=r.al(j);ae=ae<0?0:ae>1?1:ae,q.push(ue,ae),ee.minX=Math.min(ee.minX,ue),ee.minY=Math.min(ee.minY,ae),ee.maxX=Math.max(ee.maxX,ue),ee.maxY=Math.max(ee.maxY,ae)}function fi(pe,j,q,ee=!1,ue=!1){let ae=[];for(let ye of pe)vn(ye,ae,q);j.push(ae),ee&&function(ye,Se){let _e=0;for(let De=0,Ue=ye.length,Ve=Ue-2;De<Ue;Ve=De,De+=2)_e+=(ye[De]-ye[Ve])*(ye[De+1]+ye[Ve+1]);if(_e>0===Se)for(let De=0,Ue=ye.length;De<Ue/2;De+=2){let Ve=ye[De],it=ye[De+1];ye[De]=ye[Ue-2-De],ye[De+1]=ye[Ue-1-De],ye[Ue-2-De]=Ve,ye[Ue-1-De]=it}}(ae,ue)}function ga(pe,j,q,ee=!1){for(let ue=0;ue<pe.length;ue++)fi(pe[ue],j,q,ee,ue===0)}function yu(pe,j,q,ee){let{id:ue,type:ae,geometry:ye,tags:Se}=pe,_e=[];if(ae===1)(function(De,Ue,Ve,it,pt){for(let yt=0;yt<De.length;yt+=2){let sn=Math.round(r.a4*(De[yt+0]*Ue-Ve)),Lt=Math.round(r.a4*(De[yt+1]*Ue-it));pt.push([sn,Lt])}})(ye,j,q,ee,_e);else for(let De of ye)vu(De,j,q,ee,_e);return{id:ue,type:ae,geometry:_e,tags:Se}}function vu(pe,j,q,ee,ue){let ae=-Cr,ye=r.a4+Cr,Se;for(let _e=0;_e<pe.length-2;_e+=2){let De=Math.round(r.a4*(pe[_e+0]*j-q)),Ue=Math.round(r.a4*(pe[_e+1]*j-ee)),Ve=Math.round(r.a4*(pe[_e+2]*j-q)),it=Math.round(r.a4*(pe[_e+3]*j-ee)),pt=Ve-De,yt=it-Ue;De<ae&&Ve<ae||(De<ae?(Ue+=Math.round(yt*((ae-De)/pt)),De=ae):Ve<ae&&(it=Ue+Math.round(yt*((ae-De)/pt)),Ve=ae),Ue<ae&&it<ae||(Ue<ae?(De+=Math.round(pt*((ae-Ue)/yt)),Ue=ae):it<ae&&(Ve=De+Math.round(pt*((ae-Ue)/yt)),it=ae),De>=ye&&Ve>=ye||(De>=ye?(Ue+=Math.round(yt*((ye-De)/pt)),De=ye):Ve>=ye&&(it=Ue+Math.round(yt*((ye-De)/pt)),Ve=ye),Ue>=ye&&it>=ye||(Ue>=ye?(De+=Math.round(pt*((ye-Ue)/yt)),Ue=ye):it>=ye&&(Ve=De+Math.round(pt*((ye-Ue)/yt)),it=ye),Se&&De===Se[Se.length-1][0]&&Ue===Se[Se.length-1][1]||(Se=[[De,Ue]],ue.push(Se)),Se.push([Ve,it])))))}}var Pn={exports:{}},kl=r.e2,Si=r.e1.VectorTileFeature,xu=Fl;function Fl(pe,j){this.options=j||{},this.features=pe,this.length=pe.length}function Ps(pe,j){this.id=typeof pe.id=="number"?pe.id:void 0,this.type=pe.type,this.rawGeometry=pe.type===1?[pe.geometry]:pe.geometry,this.properties=pe.tags,this.extent=j||4096}Fl.prototype.feature=function(pe){return new Ps(this.features[pe],this.options.extent)},Ps.prototype.loadGeometry=function(){var pe=this.rawGeometry;this.geometry=[];for(var j=0;j<pe.length;j++){for(var q=pe[j],ee=[],ue=0;ue<q.length;ue++)ee.push(new kl(q[ue][0],q[ue][1]));this.geometry.push(ee)}return this.geometry},Ps.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var pe=this.geometry,j=1/0,q=-1/0,ee=1/0,ue=-1/0,ae=0;ae<pe.length;ae++)for(var ye=pe[ae],Se=0;Se<ye.length;Se++){var _e=ye[Se];j=Math.min(j,_e.x),q=Math.max(q,_e.x),ee=Math.min(ee,_e.y),ue=Math.max(ue,_e.y)}return[j,ee,q,ue]},Ps.prototype.toGeoJSON=Si.prototype.toGeoJSON;var wn=r.e3,_a=xu;function Ar(pe){var j=new wn;return function(q,ee){for(var ue in q.layers)ee.writeMessage(3,bu,q.layers[ue])}(pe,j),j.finish()}function bu(pe,j){var q;j.writeVarintField(15,pe.version||1),j.writeStringField(1,pe.name||""),j.writeVarintField(5,pe.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<pe.length;q++)ee.feature=pe.feature(q),j.writeMessage(2,wu,ee);var ue=ee.keys;for(q=0;q<ue.length;q++)j.writeStringField(3,ue[q]);var ae=ee.values;for(q=0;q<ae.length;q++)j.writeMessage(4,Eu,ae[q])}function wu(pe,j){var q=pe.feature;q.id!==void 0&&j.writeVarintField(1,q.id),j.writeMessage(2,Tu,pe),j.writeVarintField(3,q.type),j.writeMessage(4,Un,q)}function Tu(pe,j){var q=pe.feature,ee=pe.keys,ue=pe.values,ae=pe.keycache,ye=pe.valuecache;for(var Se in q.properties){var _e=q.properties[Se],De=ae[Se];if(_e!==null){De===void 0&&(ee.push(Se),ae[Se]=De=ee.length-1),j.writeVarint(De);var Ue=typeof _e;Ue!=="string"&&Ue!=="boolean"&&Ue!=="number"&&(_e=JSON.stringify(_e));var Ve=Ue+":"+_e,it=ye[Ve];it===void 0&&(ue.push(_e),ye[Ve]=it=ue.length-1),j.writeVarint(it)}}}function Mt(pe,j){return(j<<3)+(7&pe)}function ya(pe){return pe<<1^pe>>31}function Un(pe,j){for(var q=pe.loadGeometry(),ee=pe.type,ue=0,ae=0,ye=q.length,Se=0;Se<ye;Se++){var _e=q[Se],De=1;ee===1&&(De=_e.length),j.writeVarint(Mt(1,De));for(var Ue=ee===3?_e.length-1:_e.length,Ve=0;Ve<Ue;Ve++){Ve===1&&ee!==1&&j.writeVarint(Mt(2,Ue-1));var it=_e[Ve].x-ue,pt=_e[Ve].y-ae;j.writeVarint(ya(it)),j.writeVarint(ya(pt)),ue+=it,ae+=pt}ee===3&&j.writeVarint(Mt(7,1))}}function Eu(pe,j){var q=typeof pe;q==="string"?j.writeStringField(1,pe):q==="boolean"?j.writeBooleanField(7,pe):q==="number"&&(pe%1!=0?j.writeDoubleField(3,pe):pe<0?j.writeSVarintField(6,pe):j.writeVarintField(5,pe))}Pn.exports=Ar,Pn.exports.fromVectorTileJs=Ar,Pn.exports.fromGeojsonVt=function(pe,j){j=j||{};var q={};for(var ee in pe)q[ee]=new _a(pe[ee].features,j),q[ee].name=ee,q[ee].version=j.version,q[ee].extent=j.extent;return Ar({layers:q})},Pn.exports.GeoJSONWrapper=_a;var Iu=r.e4(Pn.exports);let Mu={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:pe=>pe},Nl=Math.fround||(va=new Float32Array(1),pe=>(va[0]=+pe,va[0]));var va;let Gi=3,Hi=5,zl=6;class wt{constructor(j){this.options=Object.assign(Object.create(Mu),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){let{log:q,minZoom:ee,maxZoom:ue}=this.options;q&&console.time("total time");let ae=`prepare ${j.length} points`;q&&console.time(ae),this.points=j;let ye=[];for(let _e=0;_e<j.length;_e++){let De=j[_e];if(!De.geometry)continue;let[Ue,Ve]=De.geometry.coordinates,it=Nl(si(Ue)),pt=Nl(Mo(Ve));ye.push(it,pt,1/0,_e,-1,1),this.options.reduce&&ye.push(0)}let Se=this.trees[ue+1]=this._createTree(ye);q&&console.timeEnd(ae);for(let _e=ue;_e>=ee;_e--){let De=+Date.now();Se=this.trees[_e]=this._createTree(this._cluster(Se,_e)),q&&console.log("z%d: %d clusters in %dms",_e,Se.numItems,+Date.now()-De)}return q&&console.timeEnd("total time"),this}getClusters(j,q){let ee=((j[0]+180)%360+360)%360-180,ue=Math.max(-90,Math.min(90,j[1])),ae=j[2]===180?180:((j[2]+180)%360+360)%360-180,ye=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)ee=-180,ae=180;else if(ee>ae){let Ve=this.getClusters([ee,ue,180,ye],q),it=this.getClusters([-180,ue,ae,ye],q);return Ve.concat(it)}let Se=this.trees[this._limitZoom(q)],_e=Se.range(si(ee),Mo(ye),si(ae),Mo(ue)),De=Se.data,Ue=[];for(let Ve of _e){let it=this.stride*Ve;Ue.push(De[it+Hi]>1?Dt(De,it,this.clusterProps):this.points[De[it+Gi]])}return Ue}getChildren(j){let q=this._getOriginId(j),ee=this._getOriginZoom(j),ue="No cluster with the specified id.",ae=this.trees[ee];if(!ae)throw new Error(ue);let ye=ae.data;if(q*this.stride>=ye.length)throw new Error(ue);let Se=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),_e=ae.within(ye[q*this.stride],ye[q*this.stride+1],Se),De=[];for(let Ue of _e){let Ve=Ue*this.stride;ye[Ve+4]===j&&De.push(ye[Ve+Hi]>1?Dt(ye,Ve,this.clusterProps):this.points[ye[Ve+Gi]])}if(De.length===0)throw new Error(ue);return De}getLeaves(j,q,ee){let ue=[];return this._appendLeaves(ue,j,q=q||10,ee=ee||0,0),ue}getTile(j,q,ee){let ue=this.trees[this._limitZoom(j)],ae=Math.pow(2,j),{extent:ye,radius:Se}=this.options,_e=Se/ye,De=(ee-_e)/ae,Ue=(ee+1+_e)/ae,Ve={features:[]};return this._addTileFeatures(ue.range((q-_e)/ae,De,(q+1+_e)/ae,Ue),ue.data,q,ee,ae,Ve),q===0&&this._addTileFeatures(ue.range(1-_e/ae,De,1,Ue),ue.data,ae,ee,ae,Ve),q===ae-1&&this._addTileFeatures(ue.range(0,De,_e/ae,Ue),ue.data,-1,ee,ae,Ve),Ve.features.length?Ve:null}getClusterExpansionZoom(j){let q=this._getOriginZoom(j)-1;for(;q<=this.options.maxZoom;){let ee=this.getChildren(j);if(q++,ee.length!==1)break;j=ee[0].properties.cluster_id}return q}_appendLeaves(j,q,ee,ue,ae){let ye=this.getChildren(q);for(let Se of ye){let _e=Se.properties;if(_e&&_e.cluster?ae+_e.point_count<=ue?ae+=_e.point_count:ae=this._appendLeaves(j,_e.cluster_id,ee,ue,ae):ae<ue?ae++:j.push(Se),j.length===ee)break}return ae}_createTree(j){let q=new r.cN(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<j.length;ee+=this.stride)q.add(j[ee],j[ee+1]);return q.finish(),q.data=j,q}_addTileFeatures(j,q,ee,ue,ae,ye){for(let Se of j){let _e=Se*this.stride,De=q[_e+Hi]>1,Ue,Ve,it;if(De)Ue=xa(q,_e,this.clusterProps),Ve=q[_e],it=q[_e+1];else{let sn=this.points[q[_e+Gi]];Ue=sn.properties;let[Lt,en]=sn.geometry.coordinates;Ve=si(Lt),it=Mo(en)}let pt={type:1,geometry:[[Math.round(this.options.extent*(Ve*ae-ee)),Math.round(this.options.extent*(it*ae-ue))]],tags:Ue},yt;yt=De||this.options.generateId?q[_e+Gi]:this.points[q[_e+Gi]].id,yt!==void 0&&(pt.id=yt),ye.features.push(pt)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,q){let{radius:ee,extent:ue,reduce:ae,minPoints:ye}=this.options,Se=ee/(ue*Math.pow(2,q)),_e=j.data,De=[],Ue=this.stride;for(let Ve=0;Ve<_e.length;Ve+=Ue){if(_e[Ve+2]<=q)continue;_e[Ve+2]=q;let it=_e[Ve],pt=_e[Ve+1],yt=j.within(_e[Ve],_e[Ve+1],Se),sn=_e[Ve+Hi],Lt=sn;for(let en of yt){let ut=en*Ue;_e[ut+2]>q&&(Lt+=_e[ut+Hi])}if(Lt>sn&&Lt>=ye){let en,ut=it*sn,Vn=pt*sn,an=-1,Yt=(Ve/Ue<<5)+(q+1)+this.points.length;for(let tr of yt){let nr=tr*Ue;if(_e[nr+2]<=q)continue;_e[nr+2]=q;let mr=_e[nr+Hi];ut+=_e[nr]*mr,Vn+=_e[nr+1]*mr,_e[nr+4]=Yt,ae&&(en||(en=this._map(_e,Ve,!0),an=this.clusterProps.length,this.clusterProps.push(en)),ae(en,this._map(_e,nr)))}_e[Ve+4]=Yt,De.push(ut/Lt,Vn/Lt,1/0,Yt,-1,Lt),ae&&De.push(an)}else{for(let en=0;en<Ue;en++)De.push(_e[Ve+en]);if(Lt>1)for(let en of yt){let ut=en*Ue;if(!(_e[ut+2]<=q)){_e[ut+2]=q;for(let Vn=0;Vn<Ue;Vn++)De.push(_e[ut+Vn])}}}}return De}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,q,ee){if(j[q+Hi]>1){let ye=this.clusterProps[j[q+zl]];return ee?Object.assign({},ye):ye}let ue=this.points[j[q+Gi]].properties,ae=this.options.map(ue);return ee&&ae===ue?Object.assign({},ae):ae}}function Dt(pe,j,q){return{type:"Feature",id:pe[j+Gi],properties:xa(pe,j,q),geometry:{type:"Point",coordinates:[(ee=pe[j],360*(ee-.5)),Du(pe[j+1])]}};var ee}function xa(pe,j,q){let ee=pe[j+Hi],ue=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,ae=pe[j+zl],ye=ae===-1?{}:Object.assign({},q[ae]);return Object.assign(ye,{cluster:!0,cluster_id:pe[j+Gi],point_count:ee,point_count_abbreviated:ue})}function si(pe){return pe/360+.5}function Mo(pe){let j=Math.sin(pe*Math.PI/180),q=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return q<0?0:q>1?1:q}function Du(pe){let j=(180-360*pe)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function Rs(pe,j,q,ee){let ue=ee,ae=j+(q-j>>1),ye,Se=q-j,_e=pe[j],De=pe[j+1],Ue=pe[q],Ve=pe[q+1];for(let it=j+3;it<q;it+=3){let pt=Cu(pe[it],pe[it+1],_e,De,Ue,Ve);if(pt>ue)ye=it,ue=pt;else if(pt===ue){let yt=Math.abs(it-ae);yt<Se&&(ye=it,Se=yt)}}ue>ee&&(ye-j>3&&Rs(pe,j,ye,ee),pe[ye+2]=ue,q-ye>3&&Rs(pe,ye,q,ee))}function Cu(pe,j,q,ee,ue,ae){let ye=ue-q,Se=ae-ee;if(ye!==0||Se!==0){let _e=((pe-q)*ye+(j-ee)*Se)/(ye*ye+Se*Se);_e>1?(q=ue,ee=ae):_e>0&&(q+=ye*_e,ee+=Se*_e)}return ye=pe-q,Se=j-ee,ye*ye+Se*Se}function Ko(pe,j,q,ee){let ue={id:pe??null,type:j,geometry:q,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")Jo(ue,q);else if(j==="Polygon")Jo(ue,q[0]);else if(j==="MultiLineString")for(let ae of q)Jo(ue,ae);else if(j==="MultiPolygon")for(let ae of q)Jo(ue,ae[0]);return ue}function Jo(pe,j){for(let q=0;q<j.length;q+=3)pe.minX=Math.min(pe.minX,j[q]),pe.minY=Math.min(pe.minY,j[q+1]),pe.maxX=Math.max(pe.maxX,j[q]),pe.maxY=Math.max(pe.maxY,j[q+1])}function ba(pe,j,q,ee){if(!j.geometry)return;let ue=j.geometry.coordinates;if(ue&&ue.length===0)return;let ae=j.geometry.type,ye=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2),Se=[],_e=j.id;if(q.promoteId?_e=j.properties[q.promoteId]:q.generateId&&(_e=ee||0),ae==="Point")Bl(ue,Se);else if(ae==="MultiPoint")for(let De of ue)Bl(De,Se);else if(ae==="LineString")wa(ue,Se,ye,!1);else if(ae==="MultiLineString"){if(q.lineMetrics){for(let De of ue)Se=[],wa(De,Se,ye,!1),pe.push(Ko(_e,"LineString",Se,j.properties));return}Ta(ue,Se,ye,!1)}else if(ae==="Polygon")Ta(ue,Se,ye,!0);else{if(ae!=="MultiPolygon"){if(ae==="GeometryCollection"){for(let De of j.geometry.geometries)ba(pe,{id:_e,geometry:De,properties:j.properties},q,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let De of ue){let Ue=[];Ta(De,Ue,ye,!0),Se.push(Ue)}}pe.push(Ko(_e,ae,Se,j.properties))}function Bl(pe,j){j.push(Ai(pe[0]),ei(pe[1]),0)}function wa(pe,j,q,ee){let ue,ae,ye=0;for(let _e=0;_e<pe.length;_e++){let De=Ai(pe[_e][0]),Ue=ei(pe[_e][1]);j.push(De,Ue,0),_e>0&&(ye+=ee?(ue*Ue-De*ae)/2:Math.sqrt(Math.pow(De-ue,2)+Math.pow(Ue-ae,2))),ue=De,ae=Ue}let Se=j.length-3;j[2]=1,Rs(j,0,Se,q),j[Se+2]=1,j.size=Math.abs(ye),j.start=0,j.end=j.size}function Ta(pe,j,q,ee){for(let ue=0;ue<pe.length;ue++){let ae=[];wa(pe[ue],ae,q,ee),j.push(ae)}}function Ai(pe){return pe/360+.5}function ei(pe){let j=Math.sin(pe*Math.PI/180),q=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return q<0?0:q>1?1:q}function Tt(pe,j,q,ee,ue,ae,ye,Se){if(ee/=j,ae>=(q/=j)&&ye<ee)return pe;if(ye<q||ae>=ee)return null;let _e=[];for(let De of pe){let Ue=De.geometry,Ve=De.type,it=ue===0?De.minX:De.minY,pt=ue===0?De.maxX:De.maxY;if(it>=q&&pt<ee){_e.push(De);continue}if(pt<q||it>=ee)continue;let yt=[];if(Ve==="Point"||Ve==="MultiPoint")Ea(Ue,yt,q,ee,ue);else if(Ve==="LineString")Wr(Ue,yt,q,ee,ue,!1,Se.lineMetrics);else if(Ve==="MultiLineString")Os(Ue,yt,q,ee,ue,!1);else if(Ve==="Polygon")Os(Ue,yt,q,ee,ue,!0);else if(Ve==="MultiPolygon")for(let sn of Ue){let Lt=[];Os(sn,Lt,q,ee,ue,!0),Lt.length&&yt.push(Lt)}if(yt.length){if(Se.lineMetrics&&Ve==="LineString"){for(let sn of yt)_e.push(Ko(De.id,Ve,sn,De.tags));continue}Ve!=="LineString"&&Ve!=="MultiLineString"||(yt.length===1?(Ve="LineString",yt=yt[0]):Ve="MultiLineString"),Ve!=="Point"&&Ve!=="MultiPoint"||(Ve=yt.length===3?"Point":"MultiPoint"),_e.push(Ko(De.id,Ve,yt,De.tags))}}return _e.length?_e:null}function Ea(pe,j,q,ee,ue){for(let ae=0;ae<pe.length;ae+=3){let ye=pe[ae+ue];ye>=q&&ye<=ee&&Pi(j,pe[ae],pe[ae+1],pe[ae+2])}}function Wr(pe,j,q,ee,ue,ae,ye){let Se=qi(pe),_e=ue===0?Ia:jl,De,Ue,Ve=pe.start;for(let Lt=0;Lt<pe.length-3;Lt+=3){let en=pe[Lt],ut=pe[Lt+1],Vn=pe[Lt+2],an=pe[Lt+3],Yt=pe[Lt+4],tr=ue===0?en:ut,nr=ue===0?an:Yt,mr=!1;ye&&(De=Math.sqrt(Math.pow(en-an,2)+Math.pow(ut-Yt,2))),tr<q?nr>q&&(Ue=_e(Se,en,ut,an,Yt,q),ye&&(Se.start=Ve+De*Ue)):tr>ee?nr<ee&&(Ue=_e(Se,en,ut,an,Yt,ee),ye&&(Se.start=Ve+De*Ue)):Pi(Se,en,ut,Vn),nr<q&&tr>=q&&(Ue=_e(Se,en,ut,an,Yt,q),mr=!0),nr>ee&&tr<=ee&&(Ue=_e(Se,en,ut,an,Yt,ee),mr=!0),!ae&&mr&&(ye&&(Se.end=Ve+De*Ue),j.push(Se),Se=qi(pe)),ye&&(Ve+=De)}let it=pe.length-3,pt=pe[it],yt=pe[it+1],sn=ue===0?pt:yt;sn>=q&&sn<=ee&&Pi(Se,pt,yt,pe[it+2]),it=Se.length-3,ae&&it>=3&&(Se[it]!==Se[0]||Se[it+1]!==Se[1])&&Pi(Se,Se[0],Se[1],Se[2]),Se.length&&j.push(Se)}function qi(pe){let j=[];return j.size=pe.size,j.start=pe.start,j.end=pe.end,j}function Os(pe,j,q,ee,ue,ae){for(let ye of pe)Wr(ye,j,q,ee,ue,ae,!1)}function Pi(pe,j,q,ee){pe.push(j,q,ee)}function Ia(pe,j,q,ee,ue,ae){let ye=(ae-j)/(ee-j);return Pi(pe,ae,q+(ue-q)*ye,1),ye}function jl(pe,j,q,ee,ue,ae){let ye=(ae-q)/(ue-q);return Pi(pe,j+(ee-j)*ye,ae,1),ye}function Ma(pe,j){let q=[];for(let ee=0;ee<pe.length;ee++){let ue=pe[ee],ae=ue.type,ye;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")ye=Ls(ue.geometry,j);else if(ae==="MultiLineString"||ae==="Polygon"){ye=[];for(let Se of ue.geometry)ye.push(Ls(Se,j))}else if(ae==="MultiPolygon"){ye=[];for(let Se of ue.geometry){let _e=[];for(let De of Se)_e.push(Ls(De,j));ye.push(_e)}}q.push(Ko(ue.id,ae,ye,ue.tags))}return q}function Ls(pe,j){let q=[];q.size=pe.size,pe.start!==void 0&&(q.start=pe.start,q.end=pe.end);for(let ee=0;ee<pe.length;ee+=3)q.push(pe[ee]+j,pe[ee+1],pe[ee+2]);return q}function Da(pe,j){if(pe.transformed)return pe;let q=1<<pe.z,ee=pe.x,ue=pe.y;for(let ae of pe.features){let ye=ae.geometry,Se=ae.type;if(ae.geometry=[],Se===1)for(let _e=0;_e<ye.length;_e+=2)ae.geometry.push(Ca(ye[_e],ye[_e+1],j,q,ee,ue));else for(let _e=0;_e<ye.length;_e++){let De=[];for(let Ue=0;Ue<ye[_e].length;Ue+=2)De.push(Ca(ye[_e][Ue],ye[_e][Ue+1],j,q,ee,ue));ae.geometry.push(De)}}return pe.transformed=!0,pe}function Ca(pe,j,q,ee,ue,ae){return[Math.round(q*(pe*ee-ue)),Math.round(q*(j*ee-ae))]}function es(pe,j,q,ee,ue){let ae=j===ue.maxZoom?0:ue.tolerance/((1<<j)*ue.extent),ye={features:[],numPoints:0,numSimplified:0,numFeatures:pe.length,source:null,x:q,y:ee,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Se of pe)Sa(ye,Se,ae,ue);return ye}function Sa(pe,j,q,ee){let ue=j.geometry,ae=j.type,ye=[];if(pe.minX=Math.min(pe.minX,j.minX),pe.minY=Math.min(pe.minY,j.minY),pe.maxX=Math.max(pe.maxX,j.maxX),pe.maxY=Math.max(pe.maxY,j.maxY),ae==="Point"||ae==="MultiPoint")for(let Se=0;Se<ue.length;Se+=3)ye.push(ue[Se],ue[Se+1]),pe.numPoints++,pe.numSimplified++;else if(ae==="LineString")Ri(ye,ue,pe,q,!1,!1);else if(ae==="MultiLineString"||ae==="Polygon")for(let Se=0;Se<ue.length;Se++)Ri(ye,ue[Se],pe,q,ae==="Polygon",Se===0);else if(ae==="MultiPolygon")for(let Se=0;Se<ue.length;Se++){let _e=ue[Se];for(let De=0;De<_e.length;De++)Ri(ye,_e[De],pe,q,!0,De===0)}if(ye.length){let Se=j.tags||null;if(ae==="LineString"&&ee.lineMetrics){Se={};for(let De in j.tags)Se[De]=j.tags[De];Se.mapbox_clip_start=ue.start/ue.size,Se.mapbox_clip_end=ue.end/ue.size}let _e={geometry:ye,type:ae==="Polygon"||ae==="MultiPolygon"?3:ae==="LineString"||ae==="MultiLineString"?2:1,tags:Se};j.id!==null&&(_e.id=j.id),pe.features.push(_e)}}function Ri(pe,j,q,ee,ue,ae){let ye=ee*ee;if(ee>0&&j.size<(ue?ye:ee))return void(q.numPoints+=j.length/3);let Se=[];for(let _e=0;_e<j.length;_e+=3)(ee===0||j[_e+2]>ye)&&(q.numSimplified++,Se.push(j[_e],j[_e+1])),q.numPoints++;ue&&function(_e,De){let Ue=0;for(let Ve=0,it=_e.length,pt=it-2;Ve<it;pt=Ve,Ve+=2)Ue+=(_e[Ve]-_e[pt])*(_e[Ve+1]+_e[pt+1]);if(Ue>0===De)for(let Ve=0,it=_e.length;Ve<it/2;Ve+=2){let pt=_e[Ve],yt=_e[Ve+1];_e[Ve]=_e[it-2-Ve],_e[Ve+1]=_e[it-1-Ve],_e[it-2-Ve]=pt,_e[it-1-Ve]=yt}}(Se,ae),pe.push(Se)}let Od={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Oi{constructor(j,q){let ee=(q=this.options=function(ae,ye){for(let Se in ye)ae[Se]=ye[Se];return ae}(Object.create(Od),q)).debug;if(ee&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");let ue=function(ae,ye){let Se=[];if(ae.type==="FeatureCollection")for(let _e=0;_e<ae.features.length;_e++)ba(Se,ae.features[_e],ye,_e);else ba(Se,ae.type==="Feature"?ae:{geometry:ae},ye);return Se}(j,q);this.tiles={},this.tileCoords=[],ee&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ue=function(ae,ye){let Se=ye.buffer/ye.extent,_e=ae,De=Tt(ae,1,-1-Se,Se,0,-1,2,ye),Ue=Tt(ae,1,1-Se,2+Se,0,-1,2,ye);return(De||Ue)&&(_e=Tt(ae,1,-Se,1+Se,0,-1,2,ye)||[],De&&(_e=Ma(De,1).concat(_e)),Ue&&(_e=_e.concat(Ma(Ue,-1)))),_e}(ue,q),ue.length&&this.splitTile(ue,0,0,0),ee&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,q,ee,ue,ae,ye,Se){let _e=[j,q,ee,ue],De=this.options,Ue=De.debug;for(;_e.length;){ue=_e.pop(),ee=_e.pop(),q=_e.pop(),j=_e.pop();let Ve=1<<q,it=Er(q,ee,ue),pt=this.tiles[it];if(!pt&&(Ue>1&&console.time("creation"),pt=this.tiles[it]=es(j,q,ee,ue,De),this.tileCoords.push({z:q,x:ee,y:ue}),Ue)){Ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,ee,ue,pt.numFeatures,pt.numPoints,pt.numSimplified),console.timeEnd("creation"));let mr=`z${q}`;this.stats[mr]=(this.stats[mr]||0)+1,this.total++}if(pt.source=j,ae==null){if(q===De.indexMaxZoom||pt.numPoints<=De.indexMaxPoints)continue}else{if(q===De.maxZoom||q===ae)continue;if(ae!=null){let mr=ae-q;if(ee!==ye>>mr||ue!==Se>>mr)continue}}if(pt.source=null,j.length===0)continue;Ue>1&&console.time("clipping");let yt=.5*De.buffer/De.extent,sn=.5-yt,Lt=.5+yt,en=1+yt,ut=null,Vn=null,an=null,Yt=null,tr=Tt(j,Ve,ee-yt,ee+Lt,0,pt.minX,pt.maxX,De),nr=Tt(j,Ve,ee+sn,ee+en,0,pt.minX,pt.maxX,De);j=null,tr&&(ut=Tt(tr,Ve,ue-yt,ue+Lt,1,pt.minY,pt.maxY,De),Vn=Tt(tr,Ve,ue+sn,ue+en,1,pt.minY,pt.maxY,De),tr=null),nr&&(an=Tt(nr,Ve,ue-yt,ue+Lt,1,pt.minY,pt.maxY,De),Yt=Tt(nr,Ve,ue+sn,ue+en,1,pt.minY,pt.maxY,De),nr=null),Ue>1&&console.timeEnd("clipping"),_e.push(ut||[],q+1,2*ee,2*ue),_e.push(Vn||[],q+1,2*ee,2*ue+1),_e.push(an||[],q+1,2*ee+1,2*ue),_e.push(Yt||[],q+1,2*ee+1,2*ue+1)}}getTile(j,q,ee){j=+j,q=+q,ee=+ee;let ue=this.options,{extent:ae,debug:ye}=ue;if(j<0||j>24)return null;let Se=1<<j,_e=Er(j,q=q+Se&Se-1,ee);if(this.tiles[_e])return Da(this.tiles[_e],ae);ye>1&&console.log("drilling down to z%d-%d-%d",j,q,ee);let De,Ue=j,Ve=q,it=ee;for(;!De&&Ue>0;)Ue--,Ve>>=1,it>>=1,De=this.tiles[Er(Ue,Ve,it)];return De&&De.source?(ye>1&&(console.log("found parent tile z%d-%d-%d",Ue,Ve,it),console.time("drilling down")),this.splitTile(De.source,Ue,Ve,it,j,q,ee),ye>1&&console.timeEnd("drilling down"),this.tiles[_e]?Da(this.tiles[_e],ae):null):null}}function Er(pe,j,q){return 32*((1<<pe)*q+j)+pe}function Vl(pe,j){let q=pe.tileID.canonical;if(!this._geoJSONIndex)return j(null,null);let ee=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!ee)return j(null,null);let ue=new on(ee.features),ae=Iu(ue);ae.byteOffset===0&&ae.byteLength===ae.buffer.byteLength||(ae=new Uint8Array(ae)),j(null,{vectorTile:ue,rawData:ae.buffer})}class ks extends Ot{constructor(j,q,ee,ue,ae,ye){super(j,q,ee,ue,Vl,ye),ae&&(this.loadGeoJSON=ae),this._dynamicIndex=new Sr}loadData(j,q){let ee=j&&j.request,ue=ee&&ee.collectResourceTiming;this.loadGeoJSON(j,(ae,ye)=>{if(ae||!ye)return q(ae);if(typeof ye!="object")return q(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`));{try{if(j.filter){let _e=r.z(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(_e.result==="error")throw new Error(_e.value.map(De=>`${De.key}: ${De.message}`).join(", "));ye.features=ye.features.filter(De=>_e.value.evaluate({zoom:0},De))}j.dynamic?(ye.type==="Feature"&&(ye={type:"FeatureCollection",features:[ye]}),j.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ye.features,this.loaded),j.cluster&&(ye.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=j.cluster?new wt(function({superclusterOptions:_e,clusterProperties:De}){if(!De||!_e)return _e;let Ue={},Ve={},it={accumulated:null,zoom:0},pt={properties:null},yt=Object.keys(De);for(let sn of yt){let[Lt,en]=De[sn],ut=r.z(en),Vn=r.z(typeof Lt=="string"?[Lt,["accumulated"],["get",sn]]:Lt);Ue[sn]=ut.value,Ve[sn]=Vn.value}return _e.map=sn=>{pt.properties=sn;let Lt={};for(let en of yt)Lt[en]=Ue[en].evaluate(it,pt);return Lt},_e.reduce=(sn,Lt)=>{pt.properties=Lt;for(let en of yt)it.accumulated=sn[en],sn[en]=Ve[en].evaluate(it,pt)},_e}(j)).load(ye.features):j.dynamic?this._dynamicIndex:function(_e,De){return new Oi(_e,De)}(ye,j.geojsonVtOptions)}catch(_e){return q(_e)}let Se={};if(ue){let _e=A(ee);_e&&(Se.resourceTiming={},Se.resourceTiming[j.source]=JSON.parse(JSON.stringify(_e)))}q(null,Se)}})}reloadTile(j,q){let ee=this.loaded;return ee&&ee[j.uid]?j.partial?q(null,void 0):super.reloadTile(j,q):this.loadTile(j,q)}loadGeoJSON(j,q){if(j.request)r.h(j.request,q);else{if(typeof j.data!="string")return q(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`));try{return q(null,JSON.parse(j.data))}catch{return q(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(j,q){try{q(null,this._geoJSONIndex.getClusterExpansionZoom(j.clusterId))}catch(ee){q(ee)}}getClusterChildren(j,q){try{q(null,this._geoJSONIndex.getChildren(j.clusterId))}catch(ee){q(ee)}}getClusterLeaves(j,q){try{q(null,this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset))}catch(ee){q(ee)}}}class Aa{constructor(j,q){this.tileID=new r.aQ(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.tileZoom=j.tileZoom,this.uid=j.uid,this.zoom=j.zoom,this.canonical=j.tileID.canonical,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=j.projection,this.brightness=q}parse(j,q,ee,ue){this.status="parsing";let ae=new r.aQ(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),ye={},Se=q.familiesBySource[ee.source],_e=new r.dQ(ae,ee.promoteId);return _e.bucketLayerIDs=[],_e.is3DTile=!0,r.e6(j).then(De=>{if(!De)return ue(new Error("Could not parse tile"));let Ue=r.e7(De,1/r.b7(ee.tileID.canonical)),Ve=De.json.extensionsUsed&&De.json.extensionsUsed.includes("MAPBOX_mesh_features")||De.json.asset.extras&&De.json.asset.extras.MAPBOX_mesh_features,it=De.json.extensionsUsed&&De.json.extensionsUsed.includes("EXT_meshopt_compression"),pt=new r.Y(this.zoom,{brightness:this.brightness});for(let yt in Se)for(let sn of Se[yt]){let Lt=sn[0];_e.bucketLayerIDs.push(sn.map(ut=>ut.id)),Lt.recalculate(pt,[]);let en=new r.e8(Ue,ae,Ve,it,this.brightness,_e);Ve||(en.needsUpload=!0),ye[Lt.fqid]=en,en.evaluate(Lt)}this.status="done",ue(null,{buckets:ye,featureIndex:_e})}).catch(De=>ue(new Error(De.message)))}}class cr{constructor(j,q,ee,ue,ae,ye){this.actor=j,this.layerIndex=q,this.brightness=ye,this.loading={},this.loaded={}}loadTile(j,q){let ee=j.uid,ue=this.loading[ee]=new Aa(j,this.brightness);r.e5(j.request,(ae,ye)=>{let Se=!this.loading[ee];return delete this.loading[ee],Se||ae?(ue.status="done",Se||(this.loaded[ee]=ue),q(ae)):ye&&ye.byteLength!==0?void ue.parse(ye,this.layerIndex,j,(_e,De)=>{ue.status="done",this.loaded=this.loaded||{},this.loaded[ee]=ue,_e||!De?q(_e):q(null,De)}):(ue.status="done",this.loaded[ee]=ue,q())})}reloadTile(j,q){let ee=this.loaded,ue=j.uid;if(ee&&ee[ue]){let ae=ee[ue];ae.projection=j.projection,ae.brightness=j.brightness;let ye=(Se,_e)=>{ae.reloadCallback&&(delete ae.reloadCallback,this.loadTile(j,q)),q(Se,_e)};ae.status==="parsing"?ae.reloadCallback=ye:ae.status==="done"&&this.loadTile(j,q)}}abortTile(j,q){let ee=j.uid;this.loading[ee]&&delete this.loading[ee],q()}removeTile(j,q){let ee=this.loaded,ue=j.uid;ee&&ee[ue]&&delete ee[ue],q()}}class Ul{constructor(j){this.self=j,this.actor=new r.e9(j,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.aK({name:"mercator"}),this.workerSourceTypes={vector:Ot,geojson:ks,"batched-model":cr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(q,ee)=>{if(this.workerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.workerSourceTypes[q]=ee},this.self.registerRTLTextPlugin=q=>{if(r.ea.isParsed())throw new Error("RTL text plugin already registered.");r.ea.applyArabicShaping=q.applyArabicShaping,r.ea.processBidirectionalText=q.processBidirectionalText,r.ea.processStyledBidirectionalText=q.processStyledBidirectionalText}}clearCaches(j,q,ee){delete this.layerIndexes[j],delete this.availableImages[j],delete this.workerSources[j],delete this.demWorkerSources[j],delete this.rasterArrayWorkerSource,ee()}checkIfReady(j,q,ee){ee()}setReferrer(j,q){this.referrer=q}spriteLoaded(j,{scope:q,isLoaded:ee}){if(this.isSpriteLoaded[j]||(this.isSpriteLoaded[j]={}),this.isSpriteLoaded[j][q]=ee,this.workerSources[j]&&this.workerSources[j][q])for(let ue in this.workerSources[j][q]){let ae=this.workerSources[j][q][ue];for(let ye in ae){let Se=ae[ye];Se instanceof Ot&&(Se.isSpriteLoaded=ee,Se.fire(new r.g("isSpriteLoaded")))}}}setImages(j,{scope:q,images:ee},ue){if(this.availableImages[j]||(this.availableImages[j]={}),this.availableImages[j][q]=ee,this.workerSources[j]&&this.workerSources[j][q]){for(let ae in this.workerSources[j][q]){let ye=this.workerSources[j][q][ae];for(let Se in ye)ye[Se].availableImages=ee}ue()}else ue()}setProjection(j,q){this.projections[j]=r.aK(q)}setBrightness(j,q,ee){this.brightness=q,ee()}setLayers(j,q,ee){this.getLayerIndex(j,q.scope).replace(q.layers,q.options),ee()}updateLayers(j,q,ee){this.getLayerIndex(j,q.scope).update(q.layers,q.removedIds,q.options),ee()}loadTile(j,q,ee){q.projection=this.projections[j]||this.defaultProjection,this.getWorkerSource(j,q.type,q.source,q.scope).loadTile(q,ee)}loadDEMTile(j,q,ee){this.getDEMWorkerSource(j,q.source,q.scope).loadTile(q,ee)}decodeRasterArray(j,q,ee){this.getRasterArrayWorkerSource().decodeRasterArray(q,ee)}reloadTile(j,q,ee){q.projection=this.projections[j]||this.defaultProjection,this.getWorkerSource(j,q.type,q.source,q.scope).reloadTile(q,ee)}abortTile(j,q,ee){this.getWorkerSource(j,q.type,q.source,q.scope).abortTile(q,ee)}removeTile(j,q,ee){this.getWorkerSource(j,q.type,q.source,q.scope).removeTile(q,ee)}removeSource(j,q,ee){if(!(this.workerSources[j]&&this.workerSources[j][q.scope]&&this.workerSources[j][q.scope][q.type]&&this.workerSources[j][q.scope][q.type][q.source]))return;let ue=this.workerSources[j][q.scope][q.type][q.source];delete this.workerSources[j][q.scope][q.type][q.source],ue.removeSource!==void 0?ue.removeSource(q,ee):ee()}loadWorkerSource(j,q,ee){try{this.self.importScripts(q.url),ee()}catch(ue){ee(ue.toString())}}syncRTLPluginState(j,q,ee){try{r.ea.setState(q);let ue=r.ea.getPluginURL();if(r.ea.isLoaded()&&!r.ea.isParsed()&&ue!=null){this.self.importScripts(ue);let ae=r.ea.isParsed();ee(ae?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ue}`),ae)}}catch(ue){ee(ue.toString())}}setDracoUrl(j,q){this.dracoUrl=q}getAvailableImages(j,q){this.availableImages[j]||(this.availableImages[j]={});let ee=this.availableImages[j][q];return ee||(ee=[]),ee}getLayerIndex(j,q){this.layerIndexes[j]||(this.layerIndexes[j]={});let ee=this.layerIndexes[j][q];return ee||(ee=this.layerIndexes[j][q]=new Y,ee.scope=q),ee}getWorkerSource(j,q,ee,ue){return this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][ue]||(this.workerSources[j][ue]={}),this.workerSources[j][ue][q]||(this.workerSources[j][ue][q]={}),this.isSpriteLoaded[j]||(this.isSpriteLoaded[j]={}),this.workerSources[j][ue][q][ee]||(this.workerSources[j][ue][q][ee]=new this.workerSourceTypes[q]({send:(ae,ye,Se,_e,De,Ue)=>{this.actor.send(ae,ye,Se,j,De,Ue)},scheduler:this.actor.scheduler},this.getLayerIndex(j,ue),this.getAvailableImages(j,ue),this.isSpriteLoaded[j][ue],void 0,this.brightness)),this.workerSources[j][ue][q][ee]}getDEMWorkerSource(j,q,ee){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][ee]||(this.demWorkerSources[j][ee]={}),this.demWorkerSources[j][ee][q]||(this.demWorkerSources[j][ee][q]=new Jt),this.demWorkerSources[j][ee][q]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new qt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(j,q){r.eb(q)}getWorkerPerformanceMetrics(j,q,ee){ee(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ul(self)),Ul}),p(["./shared"],function(r){var A=N;function N(d){return!function(i){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,_,v=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(v);try{_=new Worker(w),f=!0}catch{f=!1}return _&&_.terminate(),URL.revokeObjectURL(w),f}()?function(){var f=document.createElement("canvas");f.width=f.height=1;var _=f.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===f.width}()?(V[a=i&&i.failIfMajorPerformanceCaveat]===void 0&&(V[a]=function(f){var _,v=function(w){var E=document.createElement("canvas"),D=Object.create(N.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=w,E.getContext("webgl2",D)}(f);if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),v.getShaderParameter(_,v.COMPILE_STATUS)===!0)}(a)),V[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var a}(d)}var V={};function Y(d,i,a){let f=document.createElement(d);return i!=null&&(f.className=i),a&&a.appendChild(f),f}function ve(d,i,a){let f=document.createElementNS("http://www.w3.org/2000/svg",d);for(let _ of Object.keys(i))f.setAttributeNS(null,_,String(i[_]));return a&&a.appendChild(f),f}N.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let Pe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,tt=Pe&&Pe.userSelect!==void 0?"userSelect":"WebkitUserSelect",rt;function Ot(){Pe&&tt&&(rt=Pe[tt],Pe[tt]="none")}function Jt(){Pe&&tt&&(Pe[tt]=rt)}function qt(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",qt,!0)}function Ft(){window.addEventListener("click",qt,!0),window.setTimeout(()=>{window.removeEventListener("click",qt,!0)},0)}function rn(d,i){let a=d.getBoundingClientRect();return Cr(d,a,i)}function on(d,i){let a=d.getBoundingClientRect(),f=[];for(let _=0;_<i.length;_++)f.push(Cr(d,a,i[_]));return f}function Ln(d){return window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function Cr(d,i,a){let f=d.offsetWidth===i.width?1:d.offsetWidth/i.width;return new r.P((a.clientX-i.left)*f,(a.clientY-i.top)*f)}class Sr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,a){this._updatedSourceCaches[i]=a,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){let a=i.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(i.id),this.setDirty()}removeLayer(i){let a=i.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][i.id]=i,this._updatedLayers[a].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){let i={};for(let a in this._updatedLayers)i[a]=i[a]||{},i[a].updatedIds=Array.from(this._updatedLayers[a].values());for(let a in this._removedLayers)i[a]=i[a]||{},i[a].removedIds=Object.keys(this._removedLayers[a]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let di={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Dn{constructor(i,a,f,_,v,w){this.length=a.length,this.attributes=f,this.itemSize=a.bytesPerElement,this.dynamicDraw=_,this.instanceCount=w,this.context=i;let E=i.gl;this.buffer=E.createBuffer(),i.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||v||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){let a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,a){for(let f=0;f<this.attributes.length;f++){let _=a.attributes[this.attributes[f].name];_!==void 0&&i.enableVertexAttribArray(_)}}setVertexAttribPointers(i,a,f){for(let _=0;_<this.attributes.length;_++){let v=this.attributes[_],w=a.attributes[v.name];w!==void 0&&i.vertexAttribPointer(w,v.components,i[di[v.type]],!1,this.itemSize,v.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(i,a,f){for(let _=0;_<this.attributes.length;_++){let v=a.attributes[this.attributes[_].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(v,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class vn{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fi extends vn{getDefault(){return r.C.transparent}set(i){let a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class ga extends vn{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class yu extends vn{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class vu extends vn{getDefault(){return[!0,!0,!0,!0]}set(i){let a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Pn extends vn{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class kl extends vn{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Si extends vn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){let a=this.current;(i.func!==a.func||i.ref!==a.ref||i.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class xu extends vn{getDefault(){let i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){let a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Fl extends vn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let a=this.gl;i?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=i,this.dirty=!1}}class Ps extends vn{getDefault(){return[0,1]}set(i){let a=this.current;(i[0]!==a[0]||i[1]!==a[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class wn extends vn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let a=this.gl;i?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=i,this.dirty=!1}}class _a extends vn{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Ar extends vn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let a=this.gl;i?a.enable(a.BLEND):a.disable(a.BLEND),this.current=i,this.dirty=!1}}class bu extends vn{getDefault(){let i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){let a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class wu extends vn{getDefault(){return r.C.transparent}set(i){let a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Tu extends vn{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class Mt extends vn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let a=this.gl;i?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=i,this.dirty=!1}}class ya extends vn{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Un extends vn{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let Eu=class extends vn{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class Iu extends vn{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Mu extends vn{getDefault(){let i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){let a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Nl extends vn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;let a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class va extends vn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;let a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Gi extends vn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;let a=this.gl;a.bindTexture(a.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Hi extends vn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;let a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class zl extends vn{getDefault(){return null}set(i){let a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class wt extends vn{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class Dt extends vn{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class xa extends vn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class si extends vn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Mo extends vn{constructor(i,a){super(i),this.context=i,this.parent=a}getDefault(){return null}}class Du extends Mo{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Rs extends Mo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Cu extends Mo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Ko extends Rs{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Jo{constructor(i,a,f,_,v){this.context=i,this.width=a,this.height=f;let w=this.framebuffer=i.gl.createFramebuffer();_&&(this.colorAttachment=new Du(i,w)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new Rs(i,w):new Cu(i,w))}destroy(){let i=this.context.gl;if(this.colorAttachment){let a=this.colorAttachment.get();a&&i.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let a=this.depthAttachment.get();a&&i.deleteRenderbuffer(a)}else{let a=this.depthAttachment.get();a&&i.deleteTexture(a)}i.deleteFramebuffer(this.framebuffer)}}class ba{constructor(i,a){this.gl=i,this.clearColor=new fi(this),this.clearDepth=new ga(this),this.clearStencil=new yu(this),this.colorMask=new vu(this),this.depthMask=new Pn(this),this.stencilMask=new kl(this),this.stencilFunc=new Si(this),this.stencilOp=new xu(this),this.stencilTest=new Fl(this),this.depthRange=new Ps(this),this.depthTest=new wn(this),this.depthFunc=new _a(this),this.blend=new Ar(this),this.blendFunc=new bu(this),this.blendColor=new wu(this),this.blendEquation=new Tu(this),this.cullFace=new Mt(this),this.cullFaceSide=new ya(this),this.frontFace=new Un(this),this.program=new Eu(this),this.activeTexture=new Iu(this),this.viewport=new Mu(this),this.bindFramebuffer=new Nl(this),this.bindRenderbuffer=new va(this),this.bindTexture=new Gi(this),this.bindVertexBuffer=new Hi(this),this.bindElementBuffer=new zl(this),this.bindVertexArrayOES=new wt(this),this.pixelStoreUnpack=new Dt(this),this.pixelStoreUnpackPremultiplyAlpha=new xa(this),this.pixelStoreUnpackFlipY=new si(this),this.options=a?Rt({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,a,f){return new r.I(this,i,a,f)}createVertexBuffer(i,a,f,_,v){return new Dn(this,i,a,f,_,v)}createRenderbuffer(i,a,f){let _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,i,a,f),this.bindRenderbuffer.set(null),v}createFramebuffer(i,a,f,_){return new Jo(this,i,a,f,_)}clear({color:i,depth:a,stencil:f,colorMask:_}){let v=this.gl,w=0;i&&(w|=v.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(_||[!0,!0,!0,!0])),a!==void 0&&(w|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),f!==void 0&&(w|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),v.clear(w)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){r.d(i.blendFunction,r.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Bl{constructor(i,a,f,_){let v={width:f[0],height:f[1],data:null},w=i.gl;this.targetColorTexture=new r.T(i,v,w.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new r.T(i,v,w.RGBA,{useMipmap:!1}),this.context=i,this.updateParticleTexture(a,_),this.lastInvalidatedAt=0}updateParticleTexture(i,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let f=this.context.gl,_=a.width*a.height;this.particleTexture0=new r.T(this.context,a,f.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,a,f.RGBA,{premultiply:!1,useMipmap:!1});let v=new r.S;v.reserve(_);for(let w=0;w<_;w++)v.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(v,r.p.members,!0),this.particleSegment=r.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=r.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class wa extends r.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.numModelsLoading={}}loadModel(i,a){return r.l(this.requestManager.transformRequest(a,r.R.Model).url).then(f=>{if(!f)return;let _=r.c(f),v=new r.M(i,void 0,void 0,_);return v.computeBoundsAndApplyParent(),v}).catch(f=>{if(f&&f.status===404)return null;this.fire(new r.f(new Error(`Could not load model ${i} from ${a}: ${f.message}`)))})}load(i,a){this.models[a]||(this.models[a]={});let f=Object.keys(i);this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+f.length;let _=[];for(let v of f)_.push(this.loadModel(v,i[v]));Promise.allSettled(_).then(v=>{for(let w=0;w<v.length;w++){let{status:E,value:D}=v[w];E==="fulfilled"&&D&&(this.models[a][f[w]]={model:D,numReferences:1})}this.numModelsLoading[a]-=f.length,this.fire(new r.g("data",{dataType:"style"}))}).catch(v=>{this.fire(new r.f(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(let i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,a){return!!this.getModel(i,a)}getModel(i,a){return this.models[a]||(this.models[a]={}),this.models[a][i]?this.models[a][i].model:void 0}addModel(i,a,f){this.models[f]||(this.models[f]={}),this.hasModel(i,f)&&this.models[f][i].numReferences++,this.load({[i]:this.requestManager.normalizeModelURL(a)},f)}addModels(i,a){this.models[a]||(this.models[a]={});let f={};for(let _ in i)this.models[a][_]={},f[_]=this.requestManager.normalizeModelURL(i[_]);this.load(f,a)}addModelsFromBucket(i,a){this.models[a]||(this.models[a]={});let f={};for(let _ of i)this.hasModel(_,a)?this.models[a][_].numReferences++:f[_]=this.requestManager.normalizeModelURL(_);this.load(f,a)}removeModel(i,a){if(this.models[a]&&this.models[a][i]&&(this.models[a][i].numReferences--,this.models[a][i].numReferences===0)){let f=this.models[a][i].model;delete this.models[a][i],f.destroy()}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,a){this.models[a]||(this.models[a]={});for(let f in this.models[a])this.models[a][f].model&&this.models[a][f].model.upload(i.context)}}function Ta(d){let{userImage:i}=d;return!!(i&&i.render&&i.render())&&(d.data.replace(new Uint8Array(i.data.buffer)),!0)}class Ai extends r.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new r.j({width:1,height:1})}isLoaded(){for(let i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,a){if(this.loaded[a]!==i&&(this.loaded[a]=i,i)){for(let{ids:f,callback:_}of this.requestors)this._notify(f,a,_);this.requestors=[]}}hasImage(i,a){return!!this.getImage(i,a)}getImage(i,a){return this.images[a][i]}addImage(i,a,f){this._validate(i,f)&&(this.images[a][i]=f)}_validate(i,a){let f=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new r.f(new Error(`Image "${i}" has invalid "stretchX" value`))),f=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new r.f(new Error(`Image "${i}" has invalid "stretchY" value`))),f=!1),this._validateContent(a.content,a)||(this.fire(new r.f(new Error(`Image "${i}" has invalid "content" value`))),f=!1),f}_validateStretch(i,a){if(!i)return!0;let f=0;for(let _ of i){if(_[0]<f||_[1]<_[0]||a<_[1])return!1;f=_[1]}return!0}_validateContent(i,a){return!(i&&(i.length!==4||i[0]<0||a.data.width<i[0]||i[1]<0||a.data.height<i[1]||i[2]<0||a.data.width<i[2]||i[3]<0||a.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,a,f){f.version=this.images[a][i].version+1,this.images[a][i]=f,this.updatedImages[a][i]=!0}removeImage(i,a){let f=this.images[a][i];delete this.images[a][i],delete this.patterns[a][i],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,a,f){let _=!0,v=!!this.loaded[a];if(!v)for(let w of i)this.images[a][w]||(_=!1);v||_?this._notify(i,a,f):this.requestors.push({ids:i,scope:a,callback:f})}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,a,f){let _={};for(let v of i){this.images[a][v]||this.fire(new r.g("styleimagemissing",{id:v}));let w=this.images[a][v];w?_[v]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:r.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,_)}getPixelSize(i){let{width:a,height:f}=this.atlasImage[i];return{width:a,height:f}}getPattern(i,a,f){let _=this.patterns[a][i],v=this.getImage(i,a);if(!v)return null;if(_&&_.position.version===v.version)return _.position;if(_)_.position.version=v.version;else{let w={w:v.data.width+2,h:v.data.height+2,x:0,y:0},E=new r.m(w,v);this.patterns[a][i]={bin:w,position:E}}return this._updatePatternAtlas(a,f),this.patterns[a][i].position}bind(i,a){let f=i.gl,_=this.atlasTexture[a];_?this.dirty&&(_.update(this.atlasImage[a]),this.dirty=!1):(_=new r.T(i,this.atlasImage[a],f.RGBA),this.atlasTexture[a]=_),_.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(i,a){let f=[];for(let E in this.patterns[i])f.push(this.patterns[i][E].bin);let{w:_,h:v}=r.k(f),w=this.atlasImage[i];w.resize({width:_||1,height:v||1});for(let E in this.patterns[i]){let{bin:D}=this.patterns[i][E],C=D.x+1,P=D.y+1,O=this.images[i][E].data,F=O.width,z=O.height;r.j.copy(O,w,{x:0,y:0},{x:C,y:P},{width:F,height:z},a),r.j.copy(O,w,{x:0,y:z-1},{x:C,y:P-1},{width:F,height:1},a),r.j.copy(O,w,{x:0,y:0},{x:C,y:P+z},{width:F,height:1},a),r.j.copy(O,w,{x:F-1,y:0},{x:C-1,y:P},{width:1,height:z},a),r.j.copy(O,w,{x:0,y:0},{x:C+F,y:P},{width:1,height:z},a)}this.dirty=!0}beginFrame(){for(let i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,a){for(let f of i){if(this.callbackDispatchedThisFrame[a][f])continue;this.callbackDispatchedThisFrame[a][f]=!0;let _=this.images[a][f];Ta(_)&&this.updateImage(f,a,_)}}}function ei(d){let i=d.key,a=d.value,f=d.valueSpec||{},_=d.objectElementValidators||{},v=d.style,w=d.styleSpec,E=[],D=r.o(a);if(D!=="object")return[new r.V(i,a,`object expected, ${D} found`)];for(let C in a){let P=C.split(".")[0],O;_[P]?O=_[P]:f[P]?O=cr:_["*"]?O=_["*"]:f["*"]&&(O=cr),O?E=E.concat(O({key:(i&&`${i}.`)+C,value:a[C],valueSpec:f[P]||f["*"],style:v,styleSpec:w,object:a,objectKey:C},a)):E.push(new r.n(i,a[C],`unknown property "${C}"`))}for(let C in f)_[C]||f[C].required&&f[C].default===void 0&&a[C]===void 0&&E.push(new r.V(i,a,`missing required property "${C}"`));return E}function Tt(d){let i=d.value,a=d.valueSpec,f=d.style,_=d.styleSpec,v=d.key,w=d.arrayElementValidator||cr;if(r.o(i)!=="array")return[new r.V(v,i,`array expected, ${r.o(i)} found`)];if(a.length&&i.length!==a.length)return[new r.V(v,i,`array length ${a.length} expected, length ${i.length} found`)];if(a["min-length"]&&i.length<a["min-length"])return[new r.V(v,i,`array length at least ${a["min-length"]} expected, length ${i.length} found`)];let E={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};_.$version<7&&(E.function=a.function),r.o(a.value)==="object"&&(E=a.value);let D=[];for(let C=0;C<i.length;C++)D=D.concat(w({array:i,arrayIndex:C,value:i[C],valueSpec:E,style:f,styleSpec:_,key:`${v}[${C}]`},!0));return D}function Ea(d){let i=d.key,a=d.value,f=d.valueSpec,_=r.o(a);if(_==="number"&&a!=a&&(_="NaN"),_!=="number")return[new r.V(i,a,`number expected, ${_} found`)];if("minimum"in f){let v=f.minimum;if(r.o(f.minimum)==="array"&&(v=f.minimum[d.arrayIndex]),a<v)return[new r.V(i,a,`${a} is less than the minimum value ${v}`)]}if("maximum"in f){let v=f.maximum;if(r.o(f.maximum)==="array"&&(v=f.maximum[d.arrayIndex]),a>v)return[new r.V(i,a,`${a} is greater than the maximum value ${v}`)]}return[]}function Wr(d){let i=d.valueSpec,a=r.u(d.value.type),f,_,v,w={},E=a!=="categorical"&&d.value.property===void 0,D=!E,C=r.o(d.value.stops)==="array"&&r.o(d.value.stops[0])==="array"&&r.o(d.value.stops[0][0])==="object",P=ei({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(z){if(a==="identity")return[new r.V(z.key,z.value,'identity function may not have a "stops" property')];let U=[],$=z.value;return U=U.concat(Tt({key:z.key,value:$,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:O})),r.o($)==="array"&&$.length===0&&U.push(new r.V(z.key,$,"array must have at least one stop")),U},default:function(z){return cr({key:z.key,value:z.value,valueSpec:i,style:z.style,styleSpec:z.styleSpec})}}});return a==="identity"&&E&&P.push(new r.V(d.key,d.value,'missing required property "property"')),a==="identity"||d.value.stops||P.push(new r.V(d.key,d.value,'missing required property "stops"')),a==="exponential"&&d.valueSpec.expression&&!r.s(d.valueSpec)&&P.push(new r.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(D&&!r.r(d.valueSpec)?P.push(new r.V(d.key,d.value,"property functions not supported")):E&&!r.t(d.valueSpec)&&P.push(new r.V(d.key,d.value,"zoom functions not supported"))),a!=="categorical"&&!C||d.value.property!==void 0||P.push(new r.V(d.key,d.value,'"property" property is required')),P;function O(z){let U=[],$=z.value,G=z.key;if(r.o($)!=="array")return[new r.V(G,$,`array expected, ${r.o($)} found`)];if($.length!==2)return[new r.V(G,$,`array length 2 expected, length ${$.length} found`)];if(C){if(r.o($[0])!=="object")return[new r.V(G,$,`object expected, ${r.o($[0])} found`)];if($[0].zoom===void 0)return[new r.V(G,$,"object stop key must have zoom")];if($[0].value===void 0)return[new r.V(G,$,"object stop key must have value")];let H=r.u($[0].zoom);if(typeof H!="number")return[new r.V(G,$[0].zoom,"stop zoom values must be numbers")];if(v&&v>H)return[new r.V(G,$[0].zoom,"stop zoom values must appear in ascending order")];H!==v&&(v=H,_=void 0,w={}),U=U.concat(ei({key:`${G}[0]`,value:$[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:Ea,value:F}}))}else U=U.concat(F({key:`${G}[0]`,value:$[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},$));return r.v(r.x($[1]))?U.concat([new r.V(`${G}[1]`,$[1],"expressions are not allowed in function stops.")]):U.concat(cr({key:`${G}[1]`,value:$[1],valueSpec:i,style:z.style,styleSpec:z.styleSpec}))}function F(z,U){let $=r.o(z.value),G=r.u(z.value),H=z.value!==null?z.value:U;if(f){if($!==f)return[new r.V(z.key,H,`${$} stop domain type must match previous stop domain type ${f}`)]}else f=$;if($!=="number"&&$!=="string"&&$!=="boolean"&&typeof G!="number"&&typeof G!="string"&&typeof G!="boolean")return[new r.V(z.key,H,"stop domain value must be a number, string, or boolean")];if($!=="number"&&a!=="categorical"){let K=`number expected, ${$} found`;return r.r(i)&&a===void 0&&(K+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(z.key,H,K)]}return a!=="categorical"||$!=="number"||typeof G=="number"&&isFinite(G)&&Math.floor(G)===G?a!=="categorical"&&$==="number"&&typeof G=="number"&&typeof _=="number"&&_!==void 0&&G<_?[new r.V(z.key,H,"stop domain values must appear in ascending order")]:(_=G,a==="categorical"&&G in w?[new r.V(z.key,H,"stop domain values must be unique")]:(w[G]=!0,[])):[new r.V(z.key,H,`integer expected, found ${String(G)}`)]}}function qi(d){let i=(d.expressionContext==="property"?r.y:r.z)(r.x(d.value),d.valueSpec);if(i.result==="error")return i.value.map(f=>new r.V(`${d.key}${f.key}`,d.value,f.message));let a=i.value.expression||i.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!a.outputDefined())return[new r.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!r.A(a))return[new r.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return Os(a,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!r.B(a,["zoom","feature-state"]))return[new r.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!r.D(a))return[new r.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Os(d,i){let a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(let _ of i.valueSpec.expression.parameters)a.delete(_);if(a.size===0)return[];let f=[];return d instanceof r.F&&a.has(d.name)?[new r.V(i.key,i.value,`["${d.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(d.eachChild(_=>{f.push(...Os(_,i))}),f)}function Pi(d){let i=d.key,a=d.value,f=d.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(r.u(a))===-1&&_.push(new r.V(i,a,`expected one of [${f.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(f.values).indexOf(r.u(a))===-1&&_.push(new r.V(i,a,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(a)} found`)),_}function Ia(d){return r.H(r.x(d.value))?qi(r.q({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):jl(d)}function jl(d){let i=d.value,a=d.key;if(r.o(i)!=="array")return[new r.V(a,i,`array expected, ${r.o(i)} found`)];let f=d.styleSpec,_,v=[];if(i.length<1)return[new r.V(a,i,"filter array must have at least 1 element")];switch(v=v.concat(Pi({key:`${a}[0]`,value:i[0],valueSpec:f.filter_operator,style:d.style,styleSpec:d.styleSpec})),r.u(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&r.u(i[1])==="$type"&&v.push(new r.V(a,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&v.push(new r.V(a,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(_=r.o(i[1]),_!=="string"&&v.push(new r.V(`${a}[1]`,i[1],`string expected, ${_} found`)));for(let w=2;w<i.length;w++)_=r.o(i[w]),r.u(i[1])==="$type"?v=v.concat(Pi({key:`${a}[${w}]`,value:i[w],valueSpec:f.geometry_type,style:d.style,styleSpec:d.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&v.push(new r.V(`${a}[${w}]`,i[w],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let w=1;w<i.length;w++)v=v.concat(jl({key:`${a}[${w}]`,value:i[w],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":_=r.o(i[1]),i.length!==2?v.push(new r.V(a,i,`filter array for "${i[0]}" operator must have 2 elements`)):_!=="string"&&v.push(new r.V(`${a}[1]`,i[1],`string expected, ${_} found`))}return v}function Ma(d,i){let a=d.key,f=d.style,_=d.layer,v=d.styleSpec,w=d.value,E=d.objectKey,D=v[`${i}_${d.layerType}`];if(!D)return[];let C=E.match(/^(.*)-transition$/);if(i==="paint"&&C&&D[C[1]]&&D[C[1]].transition)return cr({key:a,value:w,valueSpec:v.transition,style:f,styleSpec:v});let P=d.valueSpec||D[E];if(!P)return[new r.n(a,w,`unknown property "${E}"`)];let O;if(r.o(w)==="string"&&r.r(P)&&!P.tokens&&(O=/^{([^}]+)}$/.exec(w))){let z=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new r.V(a,w,`"${E}" does not support interpolation syntax
Use an identity property function instead: ${z}.`)]}let F=[];if(d.layerType==="symbol")E!=="text-field"||!f||f.glyphs||f.imports||F.push(new r.V(a,w,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&r.J(r.x(w))&&r.u(w.type)==="identity"&&F.push(new r.V(a,w,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&i==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&r.r(P)&&(r.K(P)||r.t(P))){let z=r.y(r.x(w),P),U=z.value.expression||z.value._styleExpression.expression;U&&!r.B(U,["measure-light"])&&(E==="model-emissive-strength"&&r.D(U)&&r.A(U)||F.push(new r.V(a,w,`${E} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return F.concat(cr({key:d.key,value:w,valueSpec:P,style:f,styleSpec:v,expressionContext:"property",propertyType:i,propertyKey:E}))}function Ls(d){return Ma(d,"paint")}function Da(d){return Ma(d,"layout")}function Ca(d){let i=[],a=d.value,f=d.key,_=d.style,v=d.styleSpec;a.type||a.ref||i.push(new r.V(f,a,'either "type" or "ref" is required'));let w=r.u(a.type),E=r.u(a.ref);if(a.id){let D=r.u(a.id);for(let C=0;C<d.arrayIndex;C++){let P=_.layers[C];r.u(P.id)===D&&i.push(new r.V(f,a.id,`duplicate layer id "${a.id}", previously used at line ${P.id.__line__}`))}}if("ref"in a){let D;["type","source","source-layer","filter","layout"].forEach(C=>{C in a&&i.push(new r.V(f,a[C],`"${C}" is prohibited for ref layers`))}),_.layers.forEach(C=>{r.u(C.id)===E&&(D=C)}),D?D.ref?i.push(new r.V(f,a.ref,"ref cannot reference another ref layer")):w=r.u(D.type):typeof E=="string"&&i.push(new r.V(f,a.ref,`ref layer "${E}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(a.source){let D=_.sources&&_.sources[a.source],C=D&&r.u(D.type);D?C==="vector"&&w==="raster"?i.push(new r.V(f,a.source,`layer "${a.id}" requires a raster source`)):C==="raster"&&w!=="raster"?i.push(new r.V(f,a.source,`layer "${a.id}" requires a vector source`)):C!=="vector"||a["source-layer"]?C==="raster-dem"&&w!=="hillshade"?i.push(new r.V(f,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="raster-array"||["raster","raster-particle"].includes(w)?w!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||C==="geojson"&&D.lineMetrics?w==="raster-particle"&&C!=="raster-array"&&i.push(new r.V(f,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):i.push(new r.V(f,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new r.V(f,a.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new r.V(f,a,`layer "${a.id}" must specify a "source-layer"`)):i.push(new r.V(f,a.source,`source "${a.source}" not found`))}else i.push(new r.V(f,a,'missing required property "source"'));return i=i.concat(ei({key:f,value:a,valueSpec:v.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>cr({key:`${f}.type`,value:a.type,valueSpec:v.layer.type,style:d.style,styleSpec:d.styleSpec,object:a,objectKey:"type"}),filter:D=>Ia(r.q({layerType:w},D)),layout:D=>ei({layer:a,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":C=>Da(r.q({layerType:w},C))}}),paint:D=>ei({layer:a,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":C=>Ls(r.q({layerType:w,layer:a},C))}})}})),i}function es(d){let i=d.value,a=d.key,f=r.o(i);return f!=="string"?[new r.V(a,i,`string expected, ${f} found`)]:[]}let Sa={promoteId:function({key:d,value:i}){if(r.o(i)==="string")return es({key:d,value:i});{let a=[];for(let f in i)a.push(...es({key:`${d}.${f}`,value:i[f]}));return a}}};function Ri(d){let i=d.value,a=d.key,f=d.styleSpec,_=d.style;if(!i.type)return[new r.V(a,i,'"type" is required')];let v=r.u(i.type),w=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(i.url||i.tiles||w.push(new r.n(a,i,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(ei({key:a,value:i,valueSpec:f[`source_${v.replace("-","_")}`],style:d.style,styleSpec:f,objectElementValidators:Sa})),w;case"geojson":if(w=ei({key:a,value:i,valueSpec:f.source_geojson,style:_,styleSpec:f,objectElementValidators:Sa}),i.cluster)for(let E in i.clusterProperties){let[D,C]=i.clusterProperties[E],P=typeof D=="string"?[D,["accumulated"],["get",E]]:D;w.push(...qi({key:`${a}.${E}.map`,value:C,expressionContext:"cluster-map"})),w.push(...qi({key:`${a}.${E}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return w;case"video":return ei({key:a,value:i,valueSpec:f.source_video,style:_,styleSpec:f});case"image":return ei({key:a,value:i,valueSpec:f.source_image,style:_,styleSpec:f});case"canvas":return[new r.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Pi({key:`${a}.type`,value:i.type,valueSpec:{values:Od(f)},style:_,styleSpec:f})}}function Od(d){return d.source.reduce((i,a)=>{let f=d[a];return f.type.type==="enum"&&(i=i.concat(Object.keys(f.type.values))),i},[])}function Oi(d){let i=d.value,a=d.styleSpec,f=a.light,_=d.style,v=[],w=r.o(i);if(i===void 0)return v;if(w!=="object")return v=v.concat([new r.V("light",i,`object expected, ${w} found`)]),v;for(let E in i){let D=E.match(/^(.*)-transition$/);v=v.concat(D&&f[D[1]]&&f[D[1]].transition?cr({key:E,value:i[E],valueSpec:a.transition,style:_,styleSpec:a}):f[E]?cr({key:E,value:i[E],valueSpec:f[E],style:_,styleSpec:a}):[new r.V(E,i[E],`unknown property "${E}"`)])}return v}function Er(d){let i=d.value,a=[];if(!i)return a;let f=r.o(i);if(f!=="object")return a=a.concat([new r.V("light-3d",i,`object expected, ${f} found`)]),a;let _=d.styleSpec,v=_["light-3d"],w=d.key,E=d.style,D=d.style.lights;for(let O of["type","id"])if(!(O in i))return a=a.concat([new r.V("light-3d",i,`missing property ${O} on light`)]),a;if(i.type&&D)for(let O=0;O<d.arrayIndex;O++){let F=r.u(i.type),z=D[O];r.u(z.type)===F&&a.push(new r.V(w,i.id,`duplicate light type "${i.type}", previously defined at line ${z.id.__line__}`))}let C=`properties_light_${i.type}`;if(!(C in _))return a=a.concat([new r.V("light-3d",i,`Invalid light type ${i.type}`)]),a;let P=_[C];for(let O in i)if(O==="properties"){let F=i[O],z=r.o(F);if(z!=="object")return a=a.concat([new r.V("properties",F,`object expected, ${z} found`)]),a;for(let U in F)a=a.concat(P[U]?cr({key:U,value:F[U],valueSpec:P[U],style:E,styleSpec:_}):[new r.n(d.key,F[U],`unknown property "${U}"`)])}else{let F=O.match(/^(.*)-transition$/);a=a.concat(F&&v[F[1]]&&v[F[1]].transition?cr({key:O,value:i[O],valueSpec:_.transition,style:E,styleSpec:_}):v[O]?cr({key:O,value:i[O],valueSpec:v[O],style:E,styleSpec:_}):[new r.n(O,i[O],`unknown property "${O}"`)])}return a}function Vl(d){let i=d.value,a=d.key,f=d.style,_=d.styleSpec,v=_.terrain,w=[],E=r.o(i);if(i===void 0||E==="null")return w;if(E!=="object")return w=w.concat([new r.V("terrain",i,`object expected, ${E} found`)]),w;for(let D in i){let C=D.match(/^(.*)-transition$/);w=w.concat(C&&v[C[1]]&&v[C[1]].transition?cr({key:D,value:i[D],valueSpec:_.transition,style:f,styleSpec:_}):v[D]?cr({key:D,value:i[D],valueSpec:v[D],style:f,styleSpec:_}):[new r.n(D,i[D],`unknown property "${D}"`)])}if(i.source){let D=f.sources&&f.sources[i.source],C=D&&r.u(D.type);D?C!=="raster-dem"&&w.push(new r.V(a,i.source,`terrain cannot be used with a source of type ${String(C)}, it only be used with a "raster-dem" source type`)):w.push(new r.V(a,i.source,`source "${i.source}" not found`))}else w.push(new r.V(a,i,'terrain is missing required property "source"'));return w}function ks(d){let i=d.value,a=d.style,f=d.styleSpec,_=f.fog,v=[],w=r.o(i);if(i===void 0)return v;if(w!=="object")return v=v.concat([new r.V("fog",i,`object expected, ${w} found`)]),v;for(let E in i){let D=E.match(/^(.*)-transition$/);v=v.concat(D&&_[D[1]]&&_[D[1]].transition?cr({key:E,value:i[E],valueSpec:f.transition,style:a,styleSpec:f}):_[E]?cr({key:E,value:i[E],valueSpec:_[E],style:a,styleSpec:f}):[new r.n(E,i[E],`unknown property "${E}"`)])}return v}let Aa={"*":()=>[],array:Tt,boolean:function(d){let i=d.value,a=d.key,f=r.o(i);return f!=="boolean"?[new r.V(a,i,`boolean expected, ${f} found`)]:[]},number:Ea,color:function(d){let i=d.key,a=d.value,f=r.o(a);return f!=="string"?[new r.V(i,a,`color expected, ${f} found`)]:r.G(a)===null?[new r.V(i,a,`color expected, "${a}" found`)]:[]},enum:Pi,filter:Ia,function:Wr,layer:Ca,object:ei,source:Ri,model:r.L,light:Oi,"light-3d":Er,terrain:Vl,fog:ks,string:es,formatted:function(d){return es(d).length===0?[]:qi(d)},resolvedImage:function(d){return es(d).length===0?[]:qi(d)},projection:function(d){let i=d.value,a=d.styleSpec,f=a.projection,_=d.style,v=[],w=r.o(i);if(w==="object")for(let E in i)v=v.concat(cr({key:E,value:i[E],valueSpec:f[E],style:_,styleSpec:a}));else w!=="string"&&(v=v.concat([new r.V("projection",i,`object or string expected, ${w} found`)]));return v},import:function(d){let{value:i,styleSpec:a}=d,w=i,{data:f}=w,_=Uh(w,["data"]);Object.defineProperty(_,"__line__",{value:i.__line__,enumerable:!1});let v=ei(r.q({},d,{value:_,valueSpec:a.import}));return r.u(_.id)===""&&v.push(new r.V(`${d.key}.id`,_,"import id can't be an empty string")),f&&(v=v.concat(pe(f,a,{key:`${d.key}.data`}))),v}};function cr(d,i=!1){let a=d.value,f=d.valueSpec,_=d.styleSpec;if(f.expression&&r.J(r.u(a)))return Wr(d);if(f.expression&&r.v(r.x(a)))return qi(d);if(f.type&&Aa[f.type]){let v=Aa[f.type](d);return i===!0&&v.length>0&&r.o(d.value)==="array"?qi(d):v}return ei(r.q({},d,{valueSpec:f.type?_[f.type]:f}))}function Ul(d){let i=d.value,a=d.key,f=es(d);return f.length||(i.indexOf("{fontstack}")===-1&&f.push(new r.V(a,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&f.push(new r.V(a,i,'"glyphs" url must include a "{range}" token'))),f}function pe(d,i=r.N,a={}){return cr({key:a.key||"",value:d,valueSpec:i.$root,styleSpec:i,style:d,objectElementValidators:{glyphs:Ul,"*":()=>[]}})}function j(d,i=r.N){return it(pe(d,i))}let q=d=>it(Ri(d)),ee=d=>it(Oi(d)),ue=d=>it(Er(d)),ae=d=>it(Vl(d)),ye=d=>it(ks(d)),Se=d=>it(Ca(d)),_e=d=>it(Ia(d)),De=d=>it(Ls(d)),Ue=d=>it(Da(d)),Ve=d=>it(r.L(d));function it(d){return d.slice().sort((i,a)=>i.line&&a.line?i.line-a.line:0)}function pt(d,i){let a=!1;if(i&&i.length)for(let f of i)f instanceof r.n?r.w(f.message):(d.fire(new r.f(new Error(f.message))),a=!0);return a}let yt;class sn extends r.E{constructor(i,a="flat"){super(),this._transitionable=new r.O(yt||(yt=new r.U({anchor:new r.W(r.N.light.anchor),position:new r.X(r.N.light.position),color:new r.W(r.N.light.color),intensity:new r.W(r.N.light.intensity)}))),this.setLight(i,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,a,f={}){this._validate(ee,i,f)||(this._transitionable.setTransitionOrValue(i),this.id=a)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,f){return(!f||f.validate!==!1)&&pt(this,i.call(j,r.Q({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.N})))}}let Lt=new r.U({source:new r.W(r.N.terrain.source),exaggeration:new r.W(r.N.terrain.exaggeration)}),en=class extends r.E{constructor(d,i,a,f){super(),this.scope=a,this._transitionable=new r.O(Lt,a,f),this._transitionable.setTransitionOrValue(d,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(d,i){this._transitionable.setTransitionOrValue(d,i)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new r.Y(d)).get("exaggeration")}isZoomDependent(){let d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof r.Z}},ut=45,Vn=65,an=.05;function Yt(d,i,a,f){let _=r.a0(ut,Vn,a),[v,w]=tr(d,f),E=1-Math.min(1,Math.exp((i-v)/(w-v)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*_*d.alpha}function tr(d,i){let a=.5/Math.tan(.5*i);return[d.range[0]+a,d.range[1]+a]}function nr(d,i,a,f,_){let v=r.$.transformMat4([],[i,a,f],_.mercatorFogMatrix);return Yt(d,r.$.length(v),_.pitch,_._fov)}function mr(d,i,a,f,_,v,w){let E=[[a,f,0],[_,f,0],[_,v,0],[a,v,0]],D=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let P of E){let O=r.$.transformMat4([],P,i),F=r.$.length(O);D=Math.min(D,F),C=Math.max(C,F)}return[Yt(d,D,w.pitch,w._fov),Yt(d,C,w.pitch,w._fov)]}let Pr=new r.U({range:new r.W(r.N.fog.range),color:new r.W(r.N.fog.color),"high-color":new r.W(r.N.fog["high-color"]),"space-color":new r.W(r.N.fog["space-color"]),"horizon-blend":new r.W(r.N.fog["horizon-blend"]),"star-intensity":new r.W(r.N.fog["star-intensity"]),"vertical-range":new r.W(r.N.fog["vertical-range"])});class Zr extends r.E{constructor(i,a,f,_){super(),this._transitionable=new r.O(Pr,f,new Map(_)),this.set(i,_),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new r.a1(Pr),this.scope=f}get state(){let i=this._transform,a=i.projection.name==="globe",f=r.a2(i.zoom),_=this.properties.get("range"),v=[.5,3];return{range:a?[r.a3(v[0],_[0],f),r.a3(v[1],_[1],f)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,a,f={}){if(this._validate(ye,i,f))return;let _=r.Q({},i);for(let v of Object.keys(r.N.fog))_[v]===void 0&&(_[v]=r.N.fog[v].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;let a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.a0(ut,Vn,i))*a.a}getOpacityAtLatLng(i,a){return this._transform.projection.supportsFog?function(f,_,v){let w=r._.fromLngLat(_),E=v.elevation?v.elevation.getAtPointOrZero(w):0;return nr(f,w.x,w.y,E,v)}(this.state,i,a):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];let a=this._transform.calculateFogTileMatrix(i.toUnwrapped());return mr(this.state,a,0,0,r.a4,r.a4,this._transform)}getOpacityForBounds(i,a,f,_,v){return this._transform.projection.supportsFog?mr(this.state,i,a,f,_,v,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?tr(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;let a=[4,5,6,7];for(let f of a){let _=i.points[f],v;if(_[2]>=0)v=_;else{let w=i.points[f-4];v=r.a5(w,_,w[2]/(w[2]-_[2]))}if(nr(this.state,v[0],v[1],0,this._transform)>=an)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,f){return(!f||f.validate!==!1)&&pt(this,i.call(j,r.Q({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.N})))}}class Fs extends r.E{constructor(i,a,f,_){super(),this.scope=f,this._options=i,this.properties=new r.a1(a),this._transitionable=new r.O(a,f,new Map(_)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,a){this._options=i,this._transitionable.setTransitionOrValue(i.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Ld,kd;var $l=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,zt=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Su=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ts="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Fd=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Nd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,zd=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Bd=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,jd=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Vd=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Ud=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let Gl=[];Pa($l,Gl),Pa(Su,Gl),Pa(zt,Gl);let Hl={"_prelude_fog.vertex.glsl":Nd,"_prelude_terrain.vertex.glsl":Fd,"_prelude_shadow.vertex.glsl":Vd,"_prelude_fog.fragment.glsl":zd,"_prelude_shadow.fragment.glsl":Ud,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Bd,"_prelude_raster_particle.glsl":jd},Au={};Qt("",Fd),Qt(zd,Nd),Qt(Ud,Vd),Qt(Bd,""),Qt(jd,"");let Pu=Qt(zt,Su),_m=$l;var ym={background:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Qt("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Qt(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Qt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Qt("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Qt("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Qt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);scaled_pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);scaled_pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Qt(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_alignment;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);p.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);p.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Qt(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Qt(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Qt(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Qt("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Qt("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Qt(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Qt(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);v_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:Qt(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Qt(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Qt("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Qt(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ts),skyboxGradient:Qt(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ts),skyboxCapture:Qt(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Qt(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Qt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Qt(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Qt(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:Qt("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Pa(d,i){let a=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of a)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let _=f.split(" ");for(let v of _)i.includes(v)||i.push(v)}}function Qt(d,i){let a=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,_=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map(C=>{let P=C.split(" ");return P[P.length-1]}),_=[...new Set(_)]);let v={},w=[],E=[];if(d=d.replace(a,(C,P)=>(E.push(P),"")),(i=i.replace(a,(C,P)=>(w.push(P),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let D=[...Gl];Pa(d,D),Pa(i,D);for(let C of[...w,...E])Hl[C]||console.error(`Undefined include: ${C}`),Au[C]||(Au[C]=[],Pa(Hl[C],Au[C])),D=[...D,...Au[C]];return{fragmentSource:d=d.replace(f,(C,P,O,F,z)=>(v[z]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${z}
in ${O} ${F} ${z};
#else
uniform ${O} ${F} u_${z};
#endif
`:P==="initialize"?`
#ifdef HAS_UNIFORM_u_${z}
    ${O} ${F} ${z} = u_${z};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    in ${O} ${F} ${z};
#endif
`:P==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(f,(C,P,O,F,z)=>{let U=F==="float"?"vec2":F,$=z.match(/color/)?"color":U;return P==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${z}
in ${O} ${F} a_${z};
#endif
`:v[z]?P==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
in ${O} ${U} a_${z};
out ${O} ${F} ${z};
#else
uniform ${O} ${F} u_${z};
#endif
`:P==="initialize"?$==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${O} ${F} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${$}(a_${z}, u_${z}_t);
#else
    ${O} ${F} ${z} = u_${z};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    in ${O} ${F} a_${z};
    out ${O} ${F} ${z};
#endif
`:P==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    ${z} = a_${z};
#endif
`:void 0:P==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
in ${O} ${U} a_${z};
#else
uniform ${O} ${F} u_${z};
#endif
`:P==="define-instanced"?$==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${z}0;
in vec4 a_${z}1;
in vec4 a_${z}2;
in vec4 a_${z}3;
#else
uniform ${O} ${F} u_${z};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${O} ${U} a_${z};
#else
uniform ${O} ${F} u_${z};
#endif
`:P==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    ${O} ${F} ${z} = a_${z};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${O} ${F} ${z} = a_${z};
#else
    ${O} ${F} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${O} ${F} ${z} = unpack_mix_${$}(a_${z}, u_${z}_t);
#else
    ${O} ${F} ${z} = u_${z};
#endif
`}),staticAttributes:_,usedDefines:D,vertexIncludes:w,fragmentIncludes:E}}class i0{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,a,f,_,v,w,E,D){this.context=i;let C=this.boundPaintVertexBuffers.length!==_.length;for(let O=0;!C&&O<_.length;O++)this.boundPaintVertexBuffers[O]!==_[O]&&(C=!0);let P=this.boundDynamicVertexBuffers.length!==E.length;for(let O=0;!P&&O<E.length;O++)this.boundDynamicVertexBuffers[O]!==E[O]&&(P=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==f||C||P||this.boundIndexBuffer!==v||this.boundVertexOffset!==w)this.freshBind(a,f,_,v,w,E,D);else{i.bindVertexArrayOES.set(this.vao);for(let O of E)O&&(O.bind(),D&&O.instanceCount&&O.setVertexAttribDivisor(i.gl,a,D));v&&v.dynamicDraw&&v.bind()}}freshBind(i,a,f,_,v,w,E){let D=i.numAttributes,C=this.context,P=C.gl;this.vao&&this.destroy(),this.vao=C.gl.createVertexArray(),C.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=w,a.enableAttributes(P,i),a.bind(),a.setVertexAttribPointers(P,i,v);for(let O of f)O.enableAttributes(P,i),O.bind(),O.setVertexAttribPointers(P,i,v);for(let O of w)O&&(O.enableAttributes(P,i),O.bind(),O.setVertexAttribPointers(P,i,v),E&&O.instanceCount&&O.setVertexAttribDivisor(P,i,E));_&&_.bind(),C.currentNumAttributes=D}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function o0(d,i){let a=Math.pow(2,i.canonical.z),f=i.canonical.y;return[new r._(0,f/a).toLngLat().lat,new r._(0,(f+1)/a).toLngLat().lat]}function s0(d,i,a,f,_,v,w){let E=d.context,D=E.gl,C=a.hillshadeFBO;if(!C)return;d.prepareDrawTile();let P=d.isTileAffectedByFog(i),O=d.getOrCreateProgram("hillshade",{overrideFog:P});E.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,C.colorAttachment.get());let F=((G,H,K,J)=>{let Q=K.paint.get("hillshade-shadow-color"),se=K.paint.get("hillshade-highlight-color"),te=K.paint.get("hillshade-accent-color"),ne=K.paint.get("hillshade-emissive-strength"),ce=r.ac(K.paint.get("hillshade-illumination-direction"));if(K.paint.get("hillshade-illumination-anchor")==="viewport")ce-=G.transform.angle;else if(G.style&&G.style.enable3dLights()&&G.style.directionalLight){let xe=G.style.directionalLight.properties.get("direction"),de=r.ad(xe.x,xe.y,xe.z);ce=r.ac(de[1])}let he=!G.options.moving;return{u_matrix:J||G.transform.calculateProjMatrix(H.tileID.toUnwrapped(),he),u_image:0,u_latrange:o0(0,H.tileID),u_light:[K.paint.get("hillshade-exaggeration"),ce],u_shadow:Q.toRenderColor(K.lut),u_highlight:se.toRenderColor(K.lut),u_emissive_strength:ne,u_accent:te.toRenderColor(K.lut)}})(d,a,f,d.terrain?i.projMatrix:null);d.uploadCommonUniforms(E,O,i.toUnwrapped());let{tileBoundsBuffer:z,tileBoundsIndexBuffer:U,tileBoundsSegments:$}=d.getTileBoundsBuffers(a);O.draw(d,D.TRIANGLES,_,v,w,r.ag.disabled,F,f.id,z,U,$)}function vm(d,i,a){if(!i.needsDEMTextureUpload)return;let f=d.context,_=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||d.getTileTexture(a.stride);let v=a.getPixels();i.demTexture?i.demTexture.update(v,{premultiply:!1}):i.demTexture=new r.T(f,v,_.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function a0(d,i,a){let f=d.context,_=f.gl;if(!i.dem)return;let v=i.dem;if(f.activeTexture.set(_.TEXTURE1),vm(d,i,v),!i.demTexture)return;i.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);let w=v.dim;f.activeTexture.set(_.TEXTURE0);let E=i.hillshadeFBO;if(!E){let F=new r.T(f,{width:w,height:w,data:null},_.RGBA);F.bind(_.LINEAR,_.CLAMP_TO_EDGE),E=i.hillshadeFBO=f.createFramebuffer(w,w,!0,"renderbuffer"),E.colorAttachment.set(F.texture)}f.bindFramebuffer.set(E.framebuffer),f.viewport.set([0,0,w,w]);let{tileBoundsBuffer:D,tileBoundsIndexBuffer:C,tileBoundsSegments:P}=d.getMercatorTileBoundsBuffers(),O=[];d.linearFloatFilteringSupported()&&O.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:O}).draw(d,_.TRIANGLES,r.af.disabled,r.ah.disabled,r.a.unblended,r.ag.disabled,((F,z)=>{let U=z.stride,$=r.ae.create();return r.ae.ortho($,0,r.a4,-r.a4,0,0,1),r.ae.translate($,$,[0,-r.a4,0]),{u_matrix:$,u_image:1,u_dimension:[U,U],u_zoom:F.overscaledZ}})(i.tileID,v),a.id,D,C,P),i.needsHillshadePrepare=!1}function $d(d,i,a,f,_){let v=function(E,D){if(E)return _(E);if(D){if(d.url&&D.tiles&&d.tiles&&delete d.tiles,D.variants){if(!Array.isArray(D.variants))return _(new Error("variants must be an array"));for(let P of D.variants){if(P==null||typeof P!="object"||P.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(P.capabilities))return _(new Error("capabilities must be an array"));if(P.capabilities.length===1&&P.capabilities[0]==="meshopt"){D=r.Q(D,P);break}}}let C=r.ai(r.Q(D,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);D.vector_layers&&(C.vectorLayers=D.vector_layers,C.vectorLayerIds=C.vectorLayers.map(P=>P.id)),D.raster_layers&&(C.rasterLayers=D.raster_layers,C.rasterLayerIds=C.rasterLayers.map(P=>P.id)),C.tiles=i.canonicalizeTileset(C,d.url),_(null,C)}},w=function(E,D,C){if(!E)return null;if(!D&&!C)return E;C=C||E.worldview_default;let P=Object.values(E.language||{});if(P.length===0)return null;let O=Object.values(E.worldview||{});if(O.length===0)return null;let F=P.every(U=>U===D),z=O.every(U=>U===C);return F&&z?E:D in(E.language_options||{})||C in(E.worldview_options||{})?null:E.language_options&&E.worldview_options?E:null}(d.data,a,f);return w?r.e.frame(()=>v(null,w)):d.url?r.h(i.transformRequest(i.normalizeSourceURL(d.url,null,a,f),r.R.Source),v):r.e.frame(()=>{let C=d,{data:E}=C,D=Uh(C,["data"]);v(null,D)})}class ql{constructor(i,a,f){this.bounds=r.aj.convert(this.validateBounds(i)),this.minzoom=a||0,this.maxzoom=f||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){let a=Math.pow(2,i.z),f=Math.floor(r.ak(this.bounds.getWest())*a),_=Math.floor(r.al(this.bounds.getNorth())*a),v=Math.ceil(r.ak(this.bounds.getEast())*a),w=Math.ceil(r.al(this.bounds.getSouth())*a);return i.x>=f&&i.x<v&&i.y>=_&&i.y<w}}class pi extends r.E{constructor(i,a,f,_){super(),this.id=i,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.Q({type:"raster"},a),r.Q(this,r.ai(a,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new r.g("dataloading",{dataType:"source"})),this._tileJSONRequest=$d(this._options,this.map._requestManager,null,null,(a,f)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new r.f(a)):f&&(r.Q(this,f),f.bounds&&(this.tileBounds=new ql(f.bounds,this.minzoom,this.maxzoom)),r.ao(f.tiles),this.fire(new r.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.g("data",{dataType:"source",sourceDataType:"content"}))),i&&i(a)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();let i=r.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return r.Q({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,a){let f=r.e.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);i.request=r.i(this.map._requestManager.transformRequest(_,r.R.Tile),(v,w,E,D)=>(delete i.request,i.aborted?(i.state="unloaded",a(null)):v?(i.state="errored",a(v)):w?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:E,expires:D}),i.setTexture(w,this.map.painter),i.state="loaded",r.an(this.dispatcher),void a(null)):a(null)))}abortTile(i,a){i.request&&(i.request.cancel(),delete i.request),a&&a()}unloadTile(i,a){i.texture&&i.texture instanceof r.T?(i.destroy(!0),i.texture&&i.texture instanceof r.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class xm extends r.E{constructor(i,a,f,_){if(super(),this.id=i,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.Q(this,r.ai(a,["url","scheme","tileSize","promoteId"])),this._options=r.Q({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new r.ap}load(i){this._loaded=!1,this.fire(new r.g("dataloading",{dataType:"source"}));let a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=$d(this._options,this.map._requestManager,a,f,(_,v)=>{this._tileJSONRequest=null,this._loaded=!0,_?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new r.f(_))):v&&(r.Q(this,v),v.bounds&&(this.tileBounds=new ql(v.bounds,this.minzoom,this.maxzoom)),r.ao(v.tiles,this.map._requestManager._customAccessToken),this.fire(new r.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.g("data",{dataType:"source",sourceDataType:"content"}))),i&&i(_)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();let i=r.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return r.Q({},this._options)}loadTile(i,a){let f=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),_=this.map._requestManager.transformRequest(f,r.R.Tile),v=this.map.style?this.map.style.getLut(this.scope):null,w={request:_,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,lut:v?{image:v.image.clone()}:null,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(w.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=a:i.request=i.actor.send("reloadTile",w,E.bind(this));else if(i.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",w,E.bind(this),void 0,!0);else{let D=r.aq.call({deduped:this._deduped},w,(C,P)=>{C||!P?E.call(this,C):(w.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},i.actor&&i.actor.send("loadTile",w,E.bind(this),void 0,!0))},!0);i.request={cancel:D}}function E(D,C){return delete i.request,i.aborted?a(null):D&&D.status!==404?a(D):(C&&C.resourceTiming&&(i.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&i.setExpiryData(C),i.loadVectorData(C,this.map.painter),r.an(this.dispatcher),a(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,a){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let bm=(d,i,a)=>({u_matrix:d,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:a}),Gd=(d,i,a,f,_,v,w,E,D,C,P,O,F,z,U,$)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:a,u_zoom_transition:_,u_merc_center:v,u_image0:0,u_frustum_tl:w,u_frustum_tr:E,u_frustum_br:D,u_frustum_bl:C,u_globe_pos:P,u_globe_radius:O,u_viewport:F,u_grid_matrix:$?Float32Array.from($):new Float32Array(9),u_skirt_height:z,u_far_z_cutoff:U});class Wl{constructor(i=0,a=0,f=0,_=0){if(isNaN(i)||i<0||isNaN(a)||a<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=a,this.left=f,this.right=_}interpolate(i,a,f){return a.top!=null&&i.top!=null&&(this.top=r.a3(i.top,a.top,f)),a.bottom!=null&&i.bottom!=null&&(this.bottom=r.a3(i.bottom,a.bottom,f)),a.left!=null&&i.left!=null&&(this.left=r.a3(i.left,a.left,f)),a.right!=null&&i.right!=null&&(this.right=r.a3(i.right,a.right,f)),this}getCenter(i,a){let f=r.au((this.left+i-this.right)/2,0,i),_=r.au((this.top+a-this.bottom)/2,0,a);return new r.P(f,_)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Wl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ns(d,i){let a=r.ax(d,3);r.ae.fromQuat(d,i),r.aA(d,3,a)}function Je(d,i){let a=r.aw.identity([]);return r.aw.rotateZ(a,a,-i),r.aw.rotateX(a,a,-d),a}function Ra(d,i){let a=[d[0],d[1],0],f=[i[0],i[1],0];if(r.$.length(a)>=1e-15){let w=r.$.normalize([],a);r.$.scale(f,w,r.$.dot(f,w)),i[0]=f[0],i[1]=f[1]}let _=r.$.cross([],i,d);if(r.$.len(_)<1e-15)return null;let v=Math.atan2(-_[1],_[0]);return Je(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),v)}class wm{constructor(i,a){this.position=i,this.orientation=a}get position(){return this._position}set position(i){if(i){let a=i instanceof r._?i:new r._(i[0],i[1],i[2]);this._renderWorldCopies&&(a.x=r.av(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(i,a){if(this.orientation=null,!this.position)return;let f=this.position,_=this._elevation?this._elevation.getAtPointOrZero(r._.fromLngLat(i)):0,v=r._.fromLngLat(i,_),w=[v.x-f.x,v.y-f.y,v.z-f.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Ra(w,a)}setPitchBearing(i,a){this.orientation=Je(r.ac(i),r.ac(-a))}}class Oa{constructor(i,a){this._transform=r.ae.identity([]),this.orientation=a,this.position=i}get mercatorPosition(){let i=this.position;return new r._(i[0],i[1],i[2])}get position(){let i=r.ax(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var a;i&&r.aA(this._transform,3,[(a=i)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||r.aw.identity([]),i&&Ns(this._transform,this._orientation)}getPitchBearing(){let i=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,a){this._orientation=Je(i,a),Ns(this._transform,this._orientation)}forward(){let i=r.ax(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){let i=r.ax(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){let i=r.ax(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,a){let f=new Float64Array(16);return r.ae.invert(f,this.getWorldToCamera(i,a)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,a,f){let _=this.position;r.$.scale(_,_,-i);let v=new Float64Array(16);return r.ae.fromScaling(v,[f,f,f]),r.ae.translate(v,v,_),v[10]*=a,v}getWorldToCamera(i,a){let f=new Float64Array(16),_=new Float64Array(4),v=this.position;return r.aw.conjugate(_,this._orientation),r.$.scale(v,v,-i),r.ae.fromQuat(f,_),r.ae.translate(f,f,v),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=a,f[9]*=a,f[10]*=a,f[11]*=a,f}getCameraToClipPerspective(i,a,f,_){let v=new Float64Array(16);return r.ae.perspective(v,i,a,f,_),v}getCameraToClipOrthographic(i,a,f,_,v,w){let E=new Float64Array(16);return r.ae.ortho(E,i,a,f,_,v,w),E}getDistanceToElevation(i,a=!1){let f=i===0?0:r.ay(i,a?r.az(this.position[1]):this.position[1]),_=this.forward();return(f-this.position[2])/_[2]}clone(){return new Oa([...this.position],[...this.orientation])}}let Gt={unknown:0,flipRequired:1,flipNotRequired:2},ti=Math.tan(85*Math.PI/180);function Zl(d,i,a,f,_,v,w){let E=r.ae.create();if(a)if(v.name==="globe"){let D=r.aC(_,i);r.ae.multiply(E,E,D)}else{let D=r.aD.invert([],w);E[0]=D[0],E[1]=D[1],E[4]=D[2],E[5]=D[3],f||r.ae.rotateZ(E,E,_.angle)}else r.ae.multiply(E,_.labelPlaneMatrix,d);return E}function Ru(d,i,a,f,_,v,w){let E=Zl(d,i,a,f,_,v,w);return v.name==="globe"&&a||(E[2]=E[6]=E[10]=E[14]=0),E}function Ou(d,i,a,f,_,v,w){if(a){if(v.name==="globe"){let E=Zl(d,i,a,f,_,v,w);return r.ae.invert(E,E),r.ae.multiply(E,d,E),E}{let E=r.ae.clone(d),D=r.ae.identity([]);return D[0]=w[0],D[1]=w[1],D[4]=w[2],D[5]=w[3],r.ae.multiply(E,E,D),f||r.ae.rotateZ(E,E,-_.angle),E}}return _.glCoordMatrix}function Wi(d,i,a,f){let _=[d,i,a,1];a?r.aB.transformMat4(_,_,f):Wd(_,_,f);let v=_[3];return _[0]/=v,_[1]/=v,_[2]/=v,_}function jt(d,i){return Math.min(.5+d/i*.5,1.5)}function Hd(d,i){let a=d[0]/d[3],f=d[1]/d[3];return a>=-i[0]&&a<=i[0]&&f>=-i[1]&&f<=i[1]}function La(d,i,a,f,_,v,w,E,D,C){let P=a.transform,O=f?d.textSizeData:d.iconSizeData,F=r.aE(O,a.transform.zoom),z=P.projection.name==="globe",U=[256/a.width*2+1,256/a.height*2+1],$=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;$.clear();let G=null;z&&(G=f?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);let H=d.lineVertexArray,K=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,J=a.transform.width/a.transform.height,Q,se=!1;for(let te=0;te<K.length;te++){let ne=K.get(te),{numGlyphs:ce,writingMode:he}=ne;if(he!==r.aF.vertical||se||Q===r.aF.horizontal||(se=!0),Q=he,(ne.hidden||he===r.aF.vertical)&&!se){zs(ce,$);continue}se=!1;let xe=new r.P(ne.tileAnchorX,ne.tileAnchorY),{x:de,y:oe,z:Me}=P.projection.projectTilePoint(xe.x,xe.y,C.canonical);if(D){let[Ke,et,at]=D(xe);de+=Ke,oe+=et,Me+=at}let Ee=[de,oe,Me,1];if(r.aB.transformMat4(Ee,Ee,i),!Hd(Ee,U)){zs(ce,$);continue}let me=Ee[3],je=jt(a.transform.getCameraToCenterDistance(P.projection),me),Fe=r.aG(O,F,ne),be=w?Fe/je:Fe*je,Ae=Wi(de,oe,Me,_);if(Ae[3]<=0){zs(ce,$);continue}let fe={},Ne=w?null:D,Be=Rr(ne,be,!1,E,i,_,v,d.glyphOffsetArray,H,$,G,Ae,xe,fe,J,Ne,P.projection,C,w);se=Be.useVertical,Ne&&Be.needsFlipping&&(fe={}),(Be.notEnoughRoom||se||Be.needsFlipping&&Rr(ne,be,!0,E,i,_,v,d.glyphOffsetArray,H,$,G,Ae,xe,fe,J,Ne,P.projection,C,w).notEnoughRoom)&&zs(ce,$)}f?(d.text.dynamicLayoutVertexBuffer.updateData($),G&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(G)):(d.icon.dynamicLayoutVertexBuffer.updateData($),G&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(G))}function Xl(d,i,a,f,_,v,w,E,D,C,P,O,F,z,U,$){let{lineStartIndex:G,glyphStartIndex:H,segment:K}=E,J=H+E.numGlyphs,Q=G+E.lineLength,se=i.getoffsetX(H),te=i.getoffsetX(J-1),ne=ka(d*se,a,f,_,v,w,K,G,Q,D,C,P,O,F,!0,z,U,$);if(!ne)return null;let ce=ka(d*te,a,f,_,v,w,K,G,Q,D,C,P,O,F,!0,z,U,$);return ce?{first:ne,last:ce}:null}function qd(d,i,a,f){return d===r.aF.horizontal&&Math.abs(f)>Math.abs(a)?{useVertical:!0}:d===r.aF.vertical?f>0?{needsFlipping:!0}:null:i!==Gt.unknown&&function(_,v){return _===0||Math.abs(v/_)>ti}(a,f)?i===Gt.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Rr(d,i,a,f,_,v,w,E,D,C,P,O,F,z,U,$,G,H,K){let J=i/24,Q=d.lineOffsetX*J,se=d.lineOffsetY*J,{lineStartIndex:te,glyphStartIndex:ne,numGlyphs:ce,segment:he,writingMode:xe,flipState:de}=d,oe=te+d.lineLength,Me=Ee=>{if(P){let[be,Ae,fe]=Ee.up,Ne=C.length;r.aH(P,Ne+0,be,Ae,fe),r.aH(P,Ne+1,be,Ae,fe),r.aH(P,Ne+2,be,Ae,fe),r.aH(P,Ne+3,be,Ae,fe)}let[me,je,Fe]=Ee.point;r.aI(C,me,je,Fe,Ee.angle)};if(ce>1){let Ee=Xl(J,E,Q,se,a,O,F,d,D,v,z,$,!1,G,H,K);if(!Ee)return{notEnoughRoom:!0};if(f&&!a){let[me,je,Fe]=Ee.first.point,[be,Ae,fe]=Ee.last.point;[me,je]=Wi(me,je,Fe,w),[be,Ae]=Wi(be,Ae,fe,w);let Ne=qd(xe,de,(be-me)*U,Ae-je);if(d.flipState=Ne&&Ne.needsFlipping?Gt.flipRequired:Gt.flipNotRequired,Ne)return Ne}Me(Ee.first);for(let me=ne+1;me<ne+ce-1;me++){let je=ka(J*E.getoffsetX(me),Q,se,a,O,F,he,te,oe,D,v,z,$,!1,!1,G,H,K);if(!je)return C.length-=4*(me-ne),{notEnoughRoom:!0};Me(je)}Me(Ee.last)}else{if(f&&!a){let me=Wi(F.x,F.y,0,_),je=te+he+1,Fe=new r.P(D.getx(je),D.gety(je)),be=Wi(Fe.x,Fe.y,0,_),Ae=be[3]>0?be:Lu(F,Fe,me,1,_,void 0,G,H.canonical),fe=qd(xe,de,(Ae[0]-me[0])*U,Ae[1]-me[1]);if(d.flipState=fe&&fe.needsFlipping?Gt.flipRequired:Gt.flipNotRequired,fe)return fe}let Ee=ka(J*E.getoffsetX(ne),Q,se,a,O,F,he,te,oe,D,v,z,$,!1,!1,G,H,K);if(!Ee)return{notEnoughRoom:!0};Me(Ee)}return{}}function Tm(d,i,a,f,_){let{x:v,y:w,z:E}=f.projectTilePoint(d.x,d.y,i);if(!_)return Wi(v,w,E,a);let[D,C,P]=_(d);return Wi(v+D,w+C,E+P,a)}function Lu(d,i,a,f,_,v,w,E){let D=Tm(d.sub(i)._unit()._add(d),E,_,w,v);return r.$.sub(D,a,D),r.$.normalize(D,D),r.$.scaleAndAdd(D,a,D,f)}function ka(d,i,a,f,_,v,w,E,D,C,P,O,F,z,U,$,G,H){let K=f?d-i:d+i,J=K>0?1:-1,Q=0;f&&(J*=-1,Q=Math.PI),J<0&&(Q+=Math.PI);let se=E+w+(J>0?0:1)|0,te=_,ne=_,ce=0,he=0,xe=Math.abs(K),de=[],oe=[],Me=v,Ee=Me,me=()=>Lu(Ee,Me,ne,xe-ce+1,P,F,$,G.canonical);for(;ce+he<=xe;){if(se+=J,se<E||se>=D)return null;if(ne=te,Ee=Me,de.push(ne),z&&oe.push(Ee),Me=new r.P(C.getx(se),C.gety(se)),te=O[se],!te){let et=Tm(Me,G.canonical,P,$,F);te=et[3]>0?O[se]=et:me()}ce+=he,he=r.$.distance(ne,te)}U&&F&&(O[se]&&(te=me(),he=r.$.distance(ne,te)),O[se]=te);let je=(xe-ce)/he,Fe=Me.sub(Ee)._mult(je)._add(Ee),be=r.$.sub([],te,ne),Ae=r.$.scaleAndAdd([],ne,be,je),fe=[0,0,1],Ne=be[0],Be=be[1];if(H&&(fe=$.upVector(G.canonical,Fe.x,Fe.y),fe[0]!==0||fe[1]!==0||fe[2]!==1)){let et=[fe[2],0,-fe[0]],at=r.$.cross([],fe,et);r.$.normalize(et,et),r.$.normalize(at,at),Ne=r.$.dot(be,et),Be=r.$.dot(be,at)}if(a){let et=r.$.cross([],fe,be);r.$.normalize(et,et),r.$.scaleAndAdd(Ae,Ae,et,a*J)}let Ke=Q+Math.atan2(Be,Ne);return de.push(Ae),z&&oe.push(Fe),{point:Ae,angle:Ke,path:de,tilePath:oe,up:fe}}function zs(d,i){let a=i.length,f=a+4*d;i.resize(f),i.float32.fill(-1/0,4*a,4*f)}function Wd(d,i,a){let f=i[0],_=i[1];return d[0]=a[0]*f+a[4]*_+a[12],d[1]=a[1]*f+a[5]*_+a[13],d[3]=a[3]*f+a[7]*_+a[15],d}let ku=(d,i,a)=>(1-a)*d+a*i,Yl=d=>d*d*d*d*d;class Ql{constructor(i,a,f,_,v,w,E){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=i||0,this._maxZoom=a||22,this._minPitch=f??0,this._maxPitch=_??60,this.setProjection(w),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new r.aJ(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Wl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Oa,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let i=new Ql(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,a=!1){let f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(i||f)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return r.ai(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};let a=this.projection?this.getProjection():void 0;this.projection=r.aK(this.projectionOptions);let f=this.getProjection(),_=!r.d(a,f);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){let i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.aK({name:"mercator"});let a=i!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){let i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.ay(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.av(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){let a=-i*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=r.aD.create(),r.aD.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){let a=r.au(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=r.ac(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){let a=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){let i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let f=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let i=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop(),_=0,v=0;for(let w=0;w<a.length;w++){let E=new r.P(a[w][0]*this.width,f+a[w][1]*(this.height-f)),D=i.pointCoordinate(E);if(!D)continue;let C=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);_+=D[3]*C,v+=C}return v===0?NaN:_/v}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let i=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*a,_=this._mercatorZfromZoom(i),v=this._mercatorZfromZoom(this._maxZoom),w=Math.max(_-f,v);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){let a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude())),f;f=i.z<this._camera.position[2]?[a.x,a.y,a.z]:[i.x,i.y,i.z];let _=r.$.length(r.$.sub([],this._camera.position,f));return r.au(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let a=!1;if(i.orientation&&!r.aw.exactEquals(i.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(i.orientation)),i.position){let f=[i.position.x,i.position.y,i.position.z];r.$.exactEquals(f,this._camera.position)||(this._setCameraPosition(f),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let i=this._camera.position,a=new wm;return a.position=new r._(i[0],i[1],i[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(i){if(!r.aw.length(i))return!1;r.aw.normalize(i,i);let a=r.$.transformQuat([],[0,0,-1],i),f=r.$.transformQuat([],[0,-1,0],i);if(f[2]<0)return!1;let _=Ra(a,f);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(i){let a=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;i[2]=r.au(i[2],_/f,_/a),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,a,f){this._unmodified=!1,this._edgeInsets.interpolate(i,a,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){let a=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(i){let a=[new r.aL(0,i)];if(this.renderWorldCopies){let f=this.pointCoordinate(new r.P(0,0)),_=this.pointCoordinate(new r.P(this.width,0)),v=this.pointCoordinate(new r.P(this.width,this.height)),w=this.pointCoordinate(new r.P(0,this.height)),E=Math.floor(Math.min(f.x,_.x,v.x,w.x)),D=Math.floor(Math.max(f.x,_.x,v.x,w.x)),C=1;for(let P=E-C;P<=D+C;P++)P!==0&&a.push(new r.aL(P,i))}return a}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(i,a,f){let _=[],v=f!==void 0,w=!v;if(w&&this.zoom<a||v&&f[0]===0&&f[1]===0)return _;let E=new Set,D=(P,O,F,z,U)=>{let $=r.b2(O,P,F,z,U);E.has($)||(_.push(new r.aQ(P,O,F,z,U)),E.add($))};for(let P=0;P<i.length;P++){let O=i[P];if(w&&O.canonical.z!==a)continue;let F=O.canonical,z=O.overscaledZ,U=O.wrap,$=1<<F.z,G=F.x+1<$,H=F.x>0,K=F.y+1<$,J=F.y>0,Q=O.wrap-(H?0:1),se=O.wrap+(G?0:1),te=H?F.x-1:$-1,ne=G?F.x+1:0;if(v)f[0]<0?(D(z,se,F.z,ne,F.y),f[1]<0&&K&&(D(z,U,F.z,F.x,F.y+1),D(z,se,F.z,ne,F.y+1)),f[1]>0&&J&&(D(z,U,F.z,F.x,F.y-1),D(z,se,F.z,ne,F.y-1))):f[0]>0?(D(z,Q,F.z,te,F.y),f[1]<0&&K&&(D(z,U,F.z,F.x,F.y+1),D(z,Q,F.z,te,F.y+1)),f[1]>0&&J&&(D(z,U,F.z,F.x,F.y-1),D(z,Q,F.z,te,F.y-1))):f[1]<0&&K?D(z,U,F.z,F.x,F.y+1):J&&D(z,U,F.z,F.x,F.y-1);else{let ce=O.visibleQuadrants;1&ce&&(D(z,Q,F.z,te,F.y),J&&(D(z,U,F.z,F.x,F.y-1),D(z,Q,F.z,te,F.y-1))),2&ce&&(D(z,se,F.z,ne,F.y),J&&(D(z,U,F.z,F.x,F.y-1),D(z,se,F.z,ne,F.y-1))),4&ce&&(D(z,Q,F.z,te,F.y),K&&(D(z,U,F.z,F.x,F.y+1),D(z,Q,F.z,te,F.y+1))),8&ce&&(D(z,se,F.z,ne,F.y),K&&(D(z,U,F.z,F.x,F.y+1),D(z,se,F.z,ne,F.y+1)))}}let C=[];for(let P of _)_.some(O=>P.isChildOf(O))||C.push(P);if(_=C.filter(P=>!i.some(O=>!!(P.overscaledZ<a&&O.isChildOf(P))||P.equals(O)||P.isChildOf(O))),w){let P=1<<a,O=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),F=[P*O.x,P*O.y],z=4,U=z*z;_=_.filter($=>{let G=$.canonical.x+.5-F[0],H=$.canonical.y+.5-F[1];return G*G+H*H<U})}return _}coveringTiles(i){let a=this.coveringZoomLevel(i),f=a,_=this.elevation&&this.elevation.exaggeration(),v=_&&!i.isTerrainDEM,w=this.projection.name==="mercator";if(i.minzoom!==void 0&&a<i.minzoom)return[];i.maxzoom!==void 0&&a>i.maxzoom&&(a=i.maxzoom);let E=this.locationCoordinate(this.center),D=this.center.lat,C=1<<a,P=[C*E.x,C*E.y,0],O=this.projection.name==="globe",F=!O,z=r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,F),U=O?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$=C*r.ay(1,this.center.lat),G=this._camera.position[2]/r.ay(1,this.center.lat),H=[C*U.x,C*U.y,G*(F?1:$)],K=O||_,J=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),Q=this.isLODDisabled(!0)?a:0,se;if(this._elevation&&i.isTerrainDEM)se=1e4*this._elevation.exaggeration();else if(this._elevation){let be=this._elevation.getMinMaxForVisibleTiles();se=be?be.max:this._centerAltitude}else se=this._centerAltitude;let te=i.isTerrainDEM?-se:this._elevation?this._elevation.getMinElevationBelowMSL():0,ne=this.projection.isReprojectedInTileSpace?r.aN(this):1,ce=be=>{let fe=new r._(be.x+25e-6,be.y,be.z),Ne=new r._(be.x,be.y+25e-6,be.z),Be=be.toLngLat(),Ke=fe.toLngLat(),et=Ne.toLngLat(),at=this.locationCoordinate(Be),nt=this.locationCoordinate(Ke),mt=this.locationCoordinate(et),At=Math.hypot(nt.x-at.x,nt.y-at.y),_t=Math.hypot(mt.x-at.x,mt.y-at.y);return Math.sqrt(At*_t)*ne/25e-6},he=be=>{let Ae=se,fe=te;return{aabb:r.aR(this,C,0,0,0,be,fe,Ae,this.projection),zoom:0,x:0,y:0,minZ:fe,maxZ:Ae,wrap:be,fullyVisible:!1}},xe=[],de=[],oe=a,Me=i.reparseOverscaled?f:a,Ee=(G-this._centerAltitude)*$,me=be=>{if(!this._elevation||!be.tileID||!w)return;let Ae=this._elevation.getMinMaxForTile(be.tileID),fe=be.aabb;Ae?(fe.min[2]=Ae.min,fe.max[2]=Ae.max,fe.center[2]=(fe.min[2]+fe.max[2])/2):(be.shouldSplit=Fe(be),be.shouldSplit||(fe.min[2]=fe.max[2]=fe.center[2]=this._centerAltitude))},je=(be,Ae)=>{if(.707*Ae<be)return 1;let fe=Ae/be;return fe/(1.4144271570014144+(Math.pow(1.1,fe-1.4144271570014144+1)-1)/(1.1-1)-1)},Fe=be=>{if(be.zoom<Q)return!0;if(be.zoom===oe)return!1;if(be.shouldSplit!=null)return be.shouldSplit;let Ae=be.aabb.distanceX(H),fe=be.aabb.distanceY(H),Ne=Ee,Be=1;if(O){Ne=be.aabb.distanceZ(H);let _t=Math.pow(2,be.zoom),kt=r.az((be.y+1)/_t),Ht=r.az(be.y/_t),kn=Math.min(Math.max(D,kt),Ht),In=r.b6(kn)/r.b6(D);if(Be=kn===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,In/this._mercatorScaleRatio),this.zoom<=r.b3&&be.zoom===oe-1&&In>=.9)return!0}else if(v&&(Ne=be.aabb.distanceZ(H)*$),this.projection.isReprojectedInTileSpace&&f<=5){let _t=Math.pow(2,be.zoom),kt=ce(new r._((be.x+.5)/_t,(be.y+.5)/_t));Be=kt>.85?1:kt}if(!w){let _t=Math.sqrt(Ae*Ae+fe*fe+Ne*Ne),kt=(1<<oe-be.zoom)*J*Be;return kt*=je(Math.max(Ne,Ee),_t),_t<kt}let Ke=Number.MAX_VALUE,et=0,at=be.aabb.getCorners(),nt=[];for(let _t of at){r.$.sub(nt,_t,H),O||(v?nt[2]*=$:nt[2]=Ee);let kt=r.$.dot(nt,this._camera.forward());kt<Ke&&(Ke=kt,et=Math.abs(nt[2]))}let mt=(1<<oe-be.zoom)*J*Be;if(mt*=je(Math.max(et,Ee),Ke),Ke<mt)return!0;let At=be.aabb.closestPoint(P);return At[0]===P[0]&&At[1]===P[1]};if(this.renderWorldCopies)for(let be=1;be<=3;be++)xe.push(he(-be)),xe.push(he(be));for(xe.push(he(0));xe.length>0;){let be=xe.pop(),Ae=be.x,fe=be.y,Ne=be.fullyVisible,Be=()=>this.projection.name==="globe"&&(be.y===0||be.y===(1<<be.zoom)-1);if(!Ne){let Ke=K?be.aabb.intersects(z):be.aabb.intersectsFlat(z);if(Ke===0&&Be()){let et=new r.aO(be.zoom,Ae,fe);Ke=r.aP(this,C,et,!0).intersects(z)}if(Ke===0)continue;Ne=Ke===2}if(be.zoom!==oe&&Fe(be))for(let Ke=0;Ke<4;Ke++){let et=(Ae<<1)+Ke%2,at=(fe<<1)+(Ke>>1),nt={aabb:w?be.aabb.quadrant(Ke):r.aR(this,C,be.zoom+1,et,at,be.wrap,be.minZ,be.maxZ,this.projection),zoom:be.zoom+1,x:et,y:at,wrap:be.wrap,fullyVisible:Ne,tileID:void 0,shouldSplit:void 0,minZ:be.minZ,maxZ:be.maxZ};v&&!O&&(nt.tileID=new r.aQ(be.zoom+1===oe?Me:be.zoom+1,be.wrap,be.zoom+1,et,at),me(nt)),xe.push(nt)}else{let Ke=be.zoom===oe?Me:be.zoom;if(i.minzoom&&i.minzoom>Ke)continue;let et=0;if(!Ne){let At=K?be.aabb.intersectsPrecise(z):be.aabb.intersectsPreciseFlat(z);if(At===0&&Be()){let _t=new r.aO(be.zoom,Ae,fe);At=r.aP(this,C,_t,!0).intersectsPrecise(z)}if(At===0)continue;if(i.calculateQuadrantVisibility)if(z.containsPoint(be.aabb.center))et=15;else for(let _t=0;_t<4;_t++)be.aabb.quadrant(_t).intersects(z)!==0&&(et|=1<<_t)}let at=P[0]-(.5+Ae+(be.wrap<<be.zoom))*(1<<a-be.zoom),nt=P[1]-.5-fe,mt=be.tileID?be.tileID:new r.aQ(Ke,be.wrap,be.zoom,Ae,fe);i.calculateQuadrantVisibility&&(mt.visibleQuadrants=et),de.push({tileID:mt,distanceSq:at*at+nt*nt})}}if(this.fogCullDistSq){let be=this.fogCullDistSq,Ae=this.horizonLineFromTop();de=de.filter(fe=>{let Ne=[0,0,0,1],Be=[r.a4,r.a4,0,1],Ke=this.calculateFogTileMatrix(fe.tileID.toUnwrapped());r.aB.transformMat4(Ne,Ne,Ke),r.aB.transformMat4(Be,Be,Ke);let et=r.aB.min([],Ne,Be),at=r.aB.max([],Ne,Be),nt=r.aS(et,at);if(nt===0)return!0;let mt=!1,At=this._elevation;if(At&&nt>be&&Ae!==0){let _t=this.calculateProjMatrix(fe.tileID.toUnwrapped()),kt;i.isTerrainDEM||(kt=At.getMinMaxForTile(fe.tileID)),kt||(kt={min:te,max:se});let Ht=r.b4(this.rotation),kn=[Ht[0]*r.a4,Ht[1]*r.a4,kt.max];r.$.transformMat4(kn,kn,_t),mt=(1-kn[1])*this.height*.5<Ae}return nt<be||mt})}return de.sort((be,Ae)=>be.distanceSq-Ae.distanceSq).map(be=>be.tileID)}resize(i,a){this.width=i,this.height=a,this.pixelsToGLUnits=[2/i,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){let a=r.au(i.lat,-r.aT,r.aT),f=this.projection.project(i.lng,a);return new r.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.ay(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,a){let f,_,v=this.centerPoint;if(this.projection.name==="globe"){let E=this.worldSize;f=(a.x-v.x)/E,_=(a.y-v.y)/E}else{let E=this.pointCoordinate(a),D=this.pointCoordinate(v);f=E.x-D.x,_=E.y-D.y}let w=this.locationCoordinate(i);this.setLocation(new r._(w.x-f,w.y-_))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,a){let f=a?r.ay(a,i.lat):void 0,_=this.projection.project(i.lng,i.lat);return new r._(_.x,_.y,f)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,a){let f=a??this._centerAltitude,_=[i.x,i.y,0,1],v=[i.x,i.y,1,1];r.aB.transformMat4(_,_,this.pixelMatrixInverse),r.aB.transformMat4(v,v,this.pixelMatrixInverse);let w=v[3];r.aB.scale(_,_,1/_[3]),r.aB.scale(v,v,1/w);let E=_[2],D=v[2];return{p0:_,p1:v,t:E===D?0:(f-E)/(D-E)}}screenPointToMercatorRay(i){let a=[i.x,i.y,0,1],f=[i.x,i.y,1,1];return r.aB.transformMat4(a,a,this.pixelMatrixInverse),r.aB.transformMat4(f,f,this.pixelMatrixInverse),r.aB.scale(a,a,1/a[3]),r.aB.scale(f,f,1/f[3]),a[2]=r.ay(a[2],this._center.lat)*this.worldSize,f[2]=r.ay(f[2],this._center.lat)*this.worldSize,r.aB.scale(a,a,1/this.worldSize),r.aB.scale(f,f,1/this.worldSize),new r.aU([a[0],a[1],a[2]],r.$.normalize([],r.$.sub([],f,a)))}rayIntersectionCoordinate(i){let{p0:a,p1:f,t:_}=i,v=r.ay(a[2],this._center.lat),w=r.ay(f[2],this._center.lat);return new r._(r.a3(a[0],f[0],_)/this.worldSize,r.a3(a[1],f[1],_)/this.worldSize,r.a3(v,w,_))}pointCoordinate(i,a=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,a)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let a=this.projection.pointCoordinate3D(this,i.x,i.y);if(a)return new r._(a[0],a[1],a[2]);let f=0,_=this.horizonLineFromTop();if(i.y>_)return this.pointCoordinate(i);let v=.02*_,w=i.clone();for(let E=0;E<10&&_-f>v;E++){w.y=r.a3(f,_,.66);let D=this.projection.pointCoordinate3D(this,w.x,w.y);D?(_=w.y,a=D):f=w.y}return a?new r._(a[0],a[1],a[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=r.aV)return!this.isPointAboveHorizon(i);let a=this.pointCoordinate(i);return a.y>=0&&a.y<=1}_coordinatePoint(i,a){let f=a&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,_=[i.x*this.worldSize,i.y*this.worldSize,f+i.toAltitude(),1];return r.aB.transformMat4(_,_,this.pixelMatrix),_[3]>0?new r.P(_[0]/_[3],_[1]/_[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:i,left:a}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,v=this.pointLocation3D(new r.P(a,i)),w=this.pointLocation3D(new r.P(_,i)),E=this.pointLocation3D(new r.P(_,f)),D=this.pointLocation3D(new r.P(a,f)),C=Math.min(v.lng,w.lng,E.lng,D.lng),P=Math.max(v.lng,w.lng,E.lng,D.lng),O=Math.min(v.lat,w.lat,E.lat,D.lat),F=Math.max(v.lat,w.lat,E.lat,D.lat),z=Math.pow(2,-this.zoom)/16*270,U=this.projection.name==="globe"?1:4,$=(G,H,K,J,Q)=>{let se=(G+K)/2,te=(H+J)/2,ne=new r.P(se,te),{lng:ce,lat:he}=this.pointLocation3D(ne),xe=Math.max(0,C-ce,O-he,ce-P,he-F);C=Math.min(C,ce),P=Math.max(P,ce),O=Math.min(O,he),F=Math.max(F,he),(Q<U||xe>z)&&($(G,H,se,te,Q+1),$(se,te,K,J,Q+1))};if($(a,i,_,i,1),$(_,i,_,f,1),$(_,f,a,f,1),$(a,f,a,i,1),this.projection.name==="globe"){let[G,H]=r.aW(this);G?(F=90,P=180,C=-180):H&&(O=-90,P=180,C=-180)}return new r.aj(new r.aJ(C,O),new r.aJ(P,F))}_getBoundsRectangular(i,a){let{top:f,left:_}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,E=new r.P(_,f),D=new r.P(w,f),C=new r.P(w,v),P=new r.P(_,v),O=this.pointCoordinate(E,i),F=this.pointCoordinate(D,i),z=this.pointCoordinate(C,a),U=this.pointCoordinate(P,a),$=(G,H)=>(H.y-G.y)/(H.x-G.x);return O.y>1&&F.y>=0?O=new r._((1-U.y)/$(U,O)+U.x,1):O.y<0&&F.y<=1&&(O=new r._(-U.y/$(U,O)+U.x,0)),F.y>1&&O.y>=0?F=new r._((1-z.y)/$(z,F)+z.x,1):F.y<0&&O.y<=1&&(F=new r._(-z.y/$(z,F)+z.x,0)),new r.aj().extend(this.coordinateLocation(O)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(z))}_getBoundsRectangularTerrain(){let i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);let a=i.visibleDemTiles.reduce((f,_)=>{if(_.dem){let v=_.dem.tree;f.min=Math.min(f.min,v.minimums[0]),f.max=Math.max(f.max,v.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*i.exaggeration(),a.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){let a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-a*(1-this._horizonShift);return i?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-r.aT,this.maxLat=r.aT,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.ak(this.minLng)*this.tileSize,this.worldMaxX=r.ak(this.maxLng)*this.tileSize,this.worldMinY=r.al(this.maxLat)*this.tileSize,this.worldMaxY=r.al(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,a){return this.projection.createTileMatrix(this,a,i)}calculateDistanceTileData(i){let a=i.key,f=this._distanceTileDataCache;if(f[a])return f[a];let _=i.canonical,v=1/this.height,w=this.cameraWorldSize,E=w/this.zoomScale(_.z),D=(_.x+Math.pow(2,_.z)*i.wrap)*E,C=_.y*E,P=this.point;P.x*=w/this.worldSize,P.y*=w/this.worldSize;let O=this.angle,F=Math.sin(-O),z=-Math.cos(-O);return f[a]={bearing:[F,z],center:[(P.x-D)*v,(P.y-C)*v],scale:E/r.a4*v},f[a]}calculateFogTileMatrix(i){let a=i.key,f=this._fogTileMatrixCache;if(f[a])return f[a];let _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return r.ae.multiply(_,this.worldToFogMatrix,_),f[a]=new Float32Array(_),f[a]}calculateProjMatrix(i,a=!1,f=!1){let _=i.key,v;if(v=f?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,v[_])return v[_];let w=this.calculatePosMatrix(i,this.worldSize),E;return E=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,r.ae.multiply(w,E,w),v[_]=new Float32Array(w),v[_]}calculatePixelsToTileUnitsMatrix(i){let a=i.tileID.key,f=this._pixelsToTileUnitsCache;if(f[a])return f[a];let _=r.aX(i,this);return f[a]=_,f[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let i=1/this.worldSize,a=r.ae.fromScaling([],[i,i,i]);return r.ae.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let i=this._elevation;this._updateCameraState();let a=r.ay(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(a),_=this._camera.forward(),v=r.ay(1,this._center.lat);f[2]/=v,_[2]/=v,r.$.normalize(_,_);let w=i.raycast(f,_,i.exaggeration());if(w){let E=r.$.scaleAndAdd([],f,_,w),D=new r._(E[0],E[1],r.ay(E[2],r.az(E[1]))),C=(D.z+r.$.length([D.x-f[0],D.y-f[1],D.z-f[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(C),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;let a=this._elevation,f=r.ay(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),v=a.getAtPointOrZero(new r._(..._)),w=this.pixelsPerMeter/this.worldSize*v,E=this._minimumHeightOverTerrain(),D=_[2]-w;if(D<=E)if(D<0||i){let C=this.locationCoordinate(this._center,this._centerAltitude),P=[_[0],_[1],C.z-_[2]],O=r.$.length(P);P[2]-=(E-D)/this._pixelsPerMercatorPixel;let F=r.$.length(P);if(F===0)return;r.$.scale(P,P,O/F*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],C.z*this._pixelsPerMercatorPixel-P[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){let F=this.center;return F.lat=r.au(F.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(F.lng=r.au(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}let a=this._unmodified,{x:f,y:_}=this.point,v=0,w=f,E=_,D=this.width/2,C=this.height/2,P=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(_-C<P&&(E=P+C),_+C>O&&(E=O-C),O-P<this.height&&(v=Math.max(v,this.height/(O-P)),E=(O+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let F=this.worldMinX*this.scale,z=this.worldMaxX*this.scale,U=this.worldSize/2-(F+z)/2;w=(f+U+this.worldSize)%this.worldSize-U,w-D<F&&(w=F+D),w+D>z&&(w=z-D),z-F<this.width&&(v=Math.max(v,this.width/(z-F)),w=(z+F)/2)}w===f&&E===_||(this.center=this.unproject(new r.P(w,E))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let i=this.centerOffset,a=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.ay(1,this.center.lat)/r.ay(1,r.b5));let _=r.aY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let v=this.projection.zAxisUnit==="meters"?f:1,w=this._camera.getWorldToCamera(this.worldSize,v),E,D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-i.x/this.width,D[9]=2*i.y/this.height,this.isOrthographic){let he=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),xe=he*this.aspect,de=-xe,oe=-he;xe-=i.x,de-=i.x,he+=i.y,oe+=i.y,E=this._camera.getCameraToClipOrthographic(de,xe,oe,he,this._nearZ,this._farZ),((Me,Ee,me,je)=>{for(let Fe=0;Fe<16;Fe++)Me[Fe]=ku(Ee[Fe],me[Fe],je)})(E,E,D,Yl(this.pitch>=15?1:this.pitch/15))}else E=D;let C=r.ae.mul([],D,w),P=r.ae.mul([],E,w);if(this.projection.isReprojectedInTileSpace){let he=this.locationCoordinate(this.center),xe=r.ae.identity([]);r.ae.translate(xe,xe,[he.x*this.worldSize,he.y*this.worldSize,0]),r.ae.multiply(xe,xe,r.aZ(this)),r.ae.translate(xe,xe,[-he.x*this.worldSize,-he.y*this.worldSize,0]),r.ae.multiply(P,P,xe),r.ae.multiply(C,C,xe),this.inverseAdjustmentMatrix=r.a_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.ae.scale([],P,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=P,this.invProjMatrix=r.ae.invert(new Float64Array(16),this.projMatrix),a){let he=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);he[8]=2*-i.x/this.width,he[9]=2*i.y/this.height,this.expandedFarZProjMatrix=r.ae.mul([],he,w)}else this.expandedFarZProjMatrix=this.projMatrix;let O=r.ae.invert([],E);this.frustumCorners=r.a$.fromInvProjectionMatrix(O,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);let F=new Float32Array(16);r.ae.identity(F),r.ae.scale(F,F,[1,-1,1]),r.ae.rotateX(F,F,this._pitch),r.ae.rotateZ(F,F,this.angle);let z=r.ae.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.ae.clone(z);let U=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-i.x/this.width,z[9]=2*(i.y+U)/this.height,this.skyboxMatrix=r.ae.multiply(F,z,F);let $=this.point,G=$.x,H=$.y,K=this.width%2/2,J=this.height%2/2,Q=Math.cos(this.angle),se=Math.sin(this.angle),te=G-Math.round(G)+Q*K+se*J,ne=H-Math.round(H)+Q*J+se*K,ce=new Float64Array(P);if(r.ae.translate(ce,ce,[te>.5?te-1:te,ne>.5?ne-1:ne,0]),this.alignedProjMatrix=ce,P=r.ae.create(),r.ae.scale(P,P,[this.width/2,-this.height/2,1]),r.ae.translate(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=r.ae.create(),r.ae.scale(P,P,[1,-1,1]),r.ae.translate(P,P,[-1,-1,0]),r.ae.scale(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=r.ae.multiply(new Float64Array(16),this.labelPlaneMatrix,C),this._calcFogMatrices(),this._distanceTileDataCache={},P=r.ae.invert(new Float64Array(16),this.pixelMatrix),!P)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=P,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.b0(this);let he=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.$.transformMat4(he,he,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=P;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let i=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,f=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,v=[i,i,a];r.$.scale(v,v,_),r.$.scale(f,f,-1),r.$.multiply(f,f,v);let w=r.ae.create();r.ae.translate(w,w,f),r.ae.scale(w,w,v),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,a,_)}_computeCameraPosition(i){let a=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),_=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-i/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-f[0]*v,_.y/this.worldSize-f[1]*v,i/this.worldSize*this._centerAltitude-f[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){let a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],_=i[2],v=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(v=Math.min((a-f)/_,1)),this._camera.position=r.$.scaleAndAdd([],this._camera.position,i,v),this._updateStateFromCamera()}_updateStateFromCamera(){let i=this._camera.position,a=this._camera.forward(),{pitch:f,bearing:_}=this._camera.getPitchBearing(),v=r.ay(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.ac(this._maxPitch)),E=Math.max((i[2]-v)/Math.cos(f),w),D=this._zoomFromMercatorZ(E);r.$.scaleAndAdd(i,i,a,E),this._pitch=r.au(f,r.ac(this.minPitch),r.ac(this.maxPitch)),this.angle=r.av(_,-Math.PI,Math.PI),this._setZoom(r.au(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r._(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){let i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let a=0,f=r.aV,_=0,v=1/0;for(;f-a>1e-6&&f>a;){let w=a+.5*(f-a),E=this.tileSize*Math.pow(2,w),D=this.getCameraToCenterDistance(this.projection,w,E),C=this.scaleZoom(D/(i*this.tileSize)),P=Math.abs(w-C);P<v&&(v=P,_=w),w<C?a=w:f=w}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,a){let f=Math.min(i.x,a.x),_=Math.max(i.x,a.x),v=Math.min(i.y,a.y),w=Math.max(i.y,a.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let E=[new r.P(f,v),new r.P(_,w),new r.P(f,w),new r.P(_,v)],D=this.renderWorldCopies?-3:0,C=this.renderWorldCopies?4:1;for(let P of E){let O=this.pointRayIntersection(P);if(O.t<0)return!0;let F=this.rayIntersectionCoordinate(O);if(F.x<D||F.y<0||F.x>C||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.b1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(i,a){let f=r.$.length(r.$.sub([],this._camera.position,i)),_=this._zoomFromMercatorZ(f)+a;return f-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){let i=function([a,f,_],v){let w=[a,f,_,1];r.aB.transformMat4(w,w,v);let E=w[3]=Math.max(w[3],1e-6);return w[0]/=E,w[1]/=E,w[2]/=E,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(i[0],i[1])}{let i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,i))}}getCameraToCenterDistance(i,a=this.zoom,f=this.worldSize){let _=r.aY(i,a,this.width,this.height,1024),v=i.pixelSpaceConversion(this.center.lat,f,_),w=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(w=ku(1,w,Yl(this.pitch>=15?1:this.pitch/15))),w}getWorldToCameraMatrix(){let i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.ae.multiply(i,i,this.globeMatrix),i}getFrustum(i){return r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}let Or={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},ni=(d,i)=>{if(i>0&&d.terrain&&r.w("Cutoff is currently disabled on terrain"),i<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let a=d.transform,f=Math.max(Math.abs(a._zoom-(d.minCutoffZoom-1)),1),_=a.isLODDisabled(!1)?r.a0(60,45,a.pitch):r.a0(30,15,a.pitch),v=a._farZ-a._nearZ,w=i*a.height,E=((1-(D=_))*a.cameraToCenterDistance+D*(a._farZ+w))*f;var D;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(E-a._nearZ)/v,(E-w-a._nearZ)/v]}}},Lr={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class rr{constructor(i,a){this.aabb=i,this.lastCascade=a}}class ns{add(i,a){let f=this.receivers[i.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],a.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],a.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],a.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],a.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],a.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],a.max[2])):this.receivers[i.key]=new rr(a,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,a,f){let _=r.b8.fromPoints(i.points),v=0;for(let w in this.receivers){let E=this.receivers[w];if(!E||!_.intersectsAabb(E.aabb))continue;E.aabb.min=_.closestPoint(E.aabb.min),E.aabb.max=_.closestPoint(E.aabb.max);let D=E.aabb.getCorners();for(let C=0;C<f.length;C++){let P=!0;for(let O of D){let F=[O[0]*a,O[1]*a,O[2]];if(r.$.transformMat4(F,F,f[C].matrix),F[0]<-1||F[0]>1||F[1]<-1||F[1]>1){P=!1;break}}if(E.lastCascade=C,v=Math.max(v,C),P)break}}return v+1}}class l0{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ns,this._depthMode=new r.af(i.context.gl.LEQUAL,r.af.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(Lr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(Lr,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),i.tp.registerParameter(Lr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,a){let f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;let _=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||_<=0||(this._shadowLayerCount=f.style.order.reduce((U,$)=>{let G=f.style._mergedLayers[$];return U+(G.hasShadowPass()&&!G.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let v=f.context,w=Lr.shadowMapResolution,E=Lr.shadowMapResolution;if(this._cascades.length===0||Lr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let U=0;U<Lr.cascadeCount;++U){let $=f._shadowMapDebug,G=v.gl,H=v.createFramebuffer(w,E,$,"texture"),K=new r.T(v,{width:w,height:E,data:null},G.DEPTH_COMPONENT);if(H.depthAttachment.set(K.texture),$){let J=new r.T(v,{width:w,height:E,data:null},G.RGBA);H.colorAttachment.set(J.texture)}this._cascades.push({framebuffer:H,texture:K,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.aM,scale:0})}}this.shadowDirection=Na(a);let D=0;if(i.elevation){let U=i.elevation,$=[1e4,-1e4];U.visibleDemTiles.filter(G=>G.dem).forEach(G=>{let H=G.dem.tree;$[0]=Math.min($[0],H.minimums[0]),$[1]=Math.max($[1],H.maximums[0])}),$[0]!==1e4&&(D=($[1]-$[0])*U.exaggeration())}let C=1.5*i.cameraToCenterDistance,P=3*C,O=new Float64Array(16);for(let U=0;U<this._cascades.length;++U){let $=this._cascades[U],G=i.height/50,H=1;Lr.cascadeCount===1?H=P:U===0?H=C:(G=C,H=P);let[K,J]=Zd(i,this.shadowDirection,G,H,Lr.shadowMapResolution,D);$.scale=i.scale,$.matrix=K,$.boundingSphereRadius=J,r.ae.invert(O,$.matrix),$.frustum=r.aM.fromInvProjectionMatrix(O,1,0,!0),$.far=H}let F=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[F].far,this._cascades[F].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Lr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Lr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Or.ShadowMap0,this._uniformValues.u_shadowmap_1=Or.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let z=f.transform.elevation;for(let U of this._groundShadowTiles){let $={min:0,max:0};if(z){let G=z.getMinMaxForTile(U);G&&($=G)}this.addShadowReceiver(U.toUnwrapped(),$.min,$.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,a){if(!this.enabled)return;let f=this.painter,_=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),_.viewport.set([0,0,Lr.shadowMapResolution,Lr.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){f.currentShadowCascade=v,_.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),_.clear({color:r.C.white,depth:1});for(let w of i.order){let E=i._mergedLayers[w];if(!E.hasShadowPass()||E.isHidden(f.transform.zoom))continue;let D=i.getLayerSourceCache(E),C=D?a[D.id]:void 0;(E.type==="model"||C&&C.length)&&f.renderLayer(f,D,E,C)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let i=this.painter,a=i.style,f=i.context,_=a.directionalLight,v=a.ambientLight;if(!_||!v)return;let w=[],E=ni(i,i.longestCutoffRange);E.shouldRenderCutoff&&w.push("RENDER_CUTOFF");let D=Kl(a,_,v),C=new r.af(f.gl.LEQUAL,r.af.ReadOnly,i.depthRangeFor3D);for(let P of this._groundShadowTiles){let O=P.toUnwrapped(),F=i.isTileAffectedByFog(P),z=i.getOrCreateProgram("groundShadow",{defines:w,overrideFog:F});this.setupShadows(O,z),i.uploadCommonUniforms(f,z,O,null,E);let U={u_matrix:i.transform.calculateProjMatrix(O),u_ground_shadow_factor:D};z.draw(i,f.gl.TRIANGLES,C,r.ah.disabled,r.a.multiply,r.ag.disabled,U,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?r.a.unblended:r.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){let a=this.painter.transform,f=a.calculatePosMatrix(i,a.worldSize);return r.ae.multiply(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(i){return r.ae.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,a,f,_=0){if(!this.enabled)return;let v=this.painter.transform,w=this.painter.context,E=w.gl,D=this._uniformValues,C=new Float64Array(16),P=v.calculatePosMatrix(i,v.worldSize);for(let O=0;O<this._cascades.length;O++)r.ae.multiply(C,this._cascades[O].matrix,P),D[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),w.activeTexture.set(E.TEXTURE0+Or.ShadowMap0+O),this._cascades[O].texture.bind(E.NEAREST,E.CLAMP_TO_EDGE);if(this.useNormalOffset=!!f,this.useNormalOffset){let O=r.b7(i.canonical),F=2/v.tileSize*r.a4/Lr.shadowMapResolution,z=F*this._cascades[0].boundingSphereRadius,U=F*this._cascades[this._cascades.length-1].boundingSphereRadius,$=(f==="vector-tile"?1:3)/Math.pow(2,_-i.canonical.z-(1-v.zoom+Math.floor(v.zoom)));D.u_shadow_normal_offset=[O,z*$,U*$],D.u_shadow_bias=[6e-5,.0012,.012]}else D.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(w,D)}setupShadowsFromMatrix(i,a,f=!1){if(!this.enabled)return;let _=this.painter.context,v=_.gl,w=this._uniformValues,E=new Float64Array(16);for(let D=0;D<Lr.cascadeCount;D++)r.ae.multiply(E,this._cascades[D].matrix,i),w[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),_.activeTexture.set(v.TEXTURE0+Or.ShadowMap0+D),this._cascades[D].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);if(this.useNormalOffset=f,f){let D=Lr.normalOffset;w.u_shadow_normal_offset=[1,D,D],w.u_shadow_bias=[6e-5,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(_,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,a,f,_){if(_[2]>=0)return{};let v=function(D,C,P){let O=P/(1<<D.canonical.z);return new r.b8([D.canonical.x*O+D.wrap*P,D.canonical.y*O+D.wrap*P,0],[(D.canonical.x+1)*O+D.wrap*P,(D.canonical.y+1)*O+D.wrap*P,C])}(i,a,f).getCorners(),w=a/-_[2];_[0]<0?(r.$.add(v[0],v[0],[_[0]*w,0,0]),r.$.add(v[3],v[3],[_[0]*w,0,0])):_[0]>0&&(r.$.add(v[1],v[1],[_[0]*w,0,0]),r.$.add(v[2],v[2],[_[0]*w,0,0])),_[1]<0?(r.$.add(v[0],v[0],[0,_[1]*w,0]),r.$.add(v[1],v[1],[0,_[1]*w,0])):_[1]>0&&(r.$.add(v[2],v[2],[0,_[1]*w,0]),r.$.add(v[3],v[3],[0,_[1]*w,0]));let E={};return E.vertices=v,E.planes=[Fa(v[1],v[0],v[4]),Fa(v[2],v[1],v[5]),Fa(v[3],v[2],v[6]),Fa(v[0],v[3],v[7])],E}addShadowReceiver(i,a,f){this._receivers.add(i,r.b8.fromTileIdAndHeight(i,a,f))}getMaxCascadeForTile(i){let a=this._receivers.get(i);return a&&a.lastCascade?a.lastCascade:0}}function Fa(d,i,a){let f=r.$.sub([],a,i),_=r.$.sub([],d,i),v=r.$.cross([],f,_),w=r.$.length(v);return w===0?[0,0,1,0]:(r.$.scale(v,v,1/w),[v[0],v[1],v[2],-r.$.dot(v,i)])}function Na(d){let i=d.properties.get("direction"),a=r.ad(i.x,i.y,i.z);a[2]=r.au(a[2],0,75);let f=r.b9([a[0],a[1],a[2]]);return r.$.fromValues(f.x,f.y,f.z)}function Kl(d,i,a){let f=i.properties.get("color"),_=i.properties.get("intensity"),v=i.properties.get("direction"),w=[v.x,v.y,v.z],E=a.properties.get("color"),D=a.properties.get("intensity"),C=Math.max(r.$.dot([0,0,1],w),0),P=[0,0,0];r.$.scale(P,E.toRenderColor(d.getLut(i.scope)).toArray01Linear().slice(0,3),D);let O=[0,0,0];return r.$.scale(O,f.toRenderColor(d.getLut(a.scope)).toArray01Linear().slice(0,3),C*_),r.ba([P[0]>0?P[0]/(P[0]+O[0]):0,P[1]>0?P[1]/(P[1]+O[1]):0,P[2]>0?P[2]/(P[2]+O[2]):0])}function Zd(d,i,a,f,_,v){let w=d.zoom,E=d.scale,D=d.worldSize,C=1/D,P=d.aspect,O=Math.sqrt(1+P*P)*Math.tan(.5*d.fovX),F=O*O,z=f-a,U=f+a,$,G;F>z/U?($=f,G=f*O):($=.5*U*(1+F),G=.5*Math.sqrt(z*z+2*(f*f+a*a)*F+U*U*F*F));let H=d.projection.pixelsPerMeter(d.center.lat,D),K=d._camera.getCameraToWorldMercator(),J=[0,0,-$*C];r.$.transformMat4(J,J,K);let Q=G*C,se=d._edgeInsets;if(!(se.left===0&&se.top===0&&se.right===0&&se.bottom===0||se.left===se.right&&se.top===se.bottom)){let Ne=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?H:1),Be=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,a,f);Be[8]=2*-d.centerOffset.x/d.width,Be[9]=2*d.centerOffset.y/d.height;let Ke=new Float64Array(16);r.ae.mul(Ke,Be,Ne);let et=new Float64Array(16);r.ae.invert(et,Ke);let at=r.aM.fromInvProjectionMatrix(et,D,w,!0);for(let nt of at.points){let mt=((te=nt)[0]/=E,te[1]/=E,te[2]=r.ay(te[2],d._center.lat),te);Q=Math.max(Q,r.$.len(r.$.subtract([],J,mt)))}}var te;Q*=_/(_-1);let ne=Math.acos(i[2]),ce=Math.atan2(-i[0],-i[1]),he=new Oa;he.position=J,he.setPitchBearing(ne,ce);let xe=he.getWorldToCamera(D,H),de=Q*D,oe=Math.min(d._mercatorZfromZoom(17)*D*-2,-2*de),Me=he.getCameraToClipOrthographic(-de,de,-de,de,oe,(de+v*H)/i[2]),Ee=new Float64Array(16);r.ae.multiply(Ee,Me,xe);let me=r.$.fromValues(Math.floor(1e6*J[0])/1e6*D,Math.floor(1e6*J[1])/1e6*D,0),je=.5*_,Fe=[0,0,0];r.$.transformMat4(Fe,me,Ee),r.$.scale(Fe,Fe,je);let be=[Math.floor(Fe[0]),Math.floor(Fe[1]),Math.floor(Fe[2])],Ae=[0,0,0];r.$.sub(Ae,Fe,be),r.$.scale(Ae,Ae,-1/je);let fe=new Float64Array(16);return r.ae.identity(fe),r.ae.translate(fe,fe,Ae),r.ae.multiply(Ee,fe,Ee),[Ee,de]}function Jl(d,i){return d!=null&&i!=null&&!(!d.hasData()||!i.hasData())&&d.demTexture!=null&&i.demTexture!=null&&d.tileID.key!==i.tileID.key}let rs=new class{constructor(){this.operations={}}newMorphing(d,i,a,f,_){if(d in this.operations){let v=this.operations[d];v.to.tileID.key!==a.tileID.key&&(v.queued=a)}else this.operations[d]={startTime:f,phase:0,duration:_,from:i,to:a,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;let i=this.operations[d];return{from:i.from,to:i.to,phase:i.phase}}update(d){for(let i in this.operations){let a=this.operations[i];for(a.phase=(d-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,d)){delete this.operations[i];break}}}_nextOp(d,i){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=i,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},ec={0:null,1:"TERRAIN_VERTEX_MORPHING"};function is(d,i,a){if(i===0)return 0;let f=i<1&&a===514?.25/i:1;return 6*Math.pow(1.5,22-d)*Math.max(i,1)*f}function tc(d,i){let a=1<<d.z;return!i&&(d.x===0||d.x===a-1)||d.y===0||d.y===a-1}let nc=d=>({u_matrix:d});function Fu(d,i,a,f,_){if(_>0){let v=r.e.now(),w=(v-d.timeAdded)/_,E=i?(v-i.timeAdded)/_:-1,D=a.getSource(),C=f.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),P=!i||Math.abs(i.tileID.overscaledZ-C)>Math.abs(d.tileID.overscaledZ-C),O=P&&d.refreshedUponExpiration?1:r.au(P?w:1-E,0,1);return d.refreshedUponExpiration&&w>=1&&(d.refreshedUponExpiration=!1),i?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}class os extends pi{constructor(i,a,f,_){super(i,a,f,_),this.type="raster-array",this.maxzoom=22,this._options=r.Q({type:"raster-array"},a)}triggerRepaint(i){let a=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);a&&a.enabled&&f&&a._clearRenderCacheForTile(f.id,i.tileID),this.map.triggerRepaint()}loadTile(i,a){let f=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,r.R.Tile);i.requestParams=_,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(v,w,E,D)=>{if(delete i.request,i.aborted)return i.state="unloaded",a(null);if(v)return v.code===20?void 0:(i.state="errored",a(v));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:E,expires:D}),i.state="empty",a(null)})}unloadTile(i,a){let f=i.texture;f&&f instanceof r.T?(i.destroy(!0),this.map.painter.saveTileTexture(f)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,a,f){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(a,f,(_,v)=>{if(_)return i.state="errored",this.fire(new r.f(_)),void this.triggerRepaint(i);v&&(i.setTexture(v,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;let a=this.rasterLayers.find(({id:v})=>v===i),f=a&&a.fields,_=f&&f.bands&&f.bands;return _?_[0]:0}getTextureDescriptor(i,a,f){if(!i)return;let _=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let v=null;a instanceof r.bm?v=a.paint.get("raster-array-band"):a instanceof r.bn&&(v=a.paint.get("raster-particle-array-band"));let w=v||this.getInitialBand(_);if(w!=null)if(i.textureDescriptor){if(!i.updateNeeded(_,w)||f)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,_,w)}}let Nu={vector:xm,raster:pi,"raster-dem":class extends pi{constructor(d,i,a,f){super(d,i,a,f),this.type="raster-dem",this.maxzoom=22,this._options=r.Q({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(d,i){let a=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(_,v){_&&(d.state="errored",i(_)),v&&(d.dem=v,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",i(null))}d.request=r.i(this.map._requestManager.transformRequest(a,r.R.Tile),(function(_,v,w,E){if(delete d.request,d.aborted)d.state="unloaded",i(null);else if(_)d.state="errored",i(_);else if(v){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:w,expires:E});let D=ImageBitmap&&v instanceof ImageBitmap&&r.bk(),C=1-(v.width-r.bl(v.width))/2;C<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));let P=D?v:r.e.getImageData(v,C),O={uid:d.uid,coord:d.tileID,source:this.id,scope:this.scope,rawImageData:P,encoding:this.encoding,padding:C};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",O,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){let i=d.canonical,a=Math.pow(2,i.z),f=(i.x-1+a)%a,_=i.x===0?d.wrap-1:d.wrap,v=(i.x+1+a)%a,w=i.x+1===a?d.wrap+1:d.wrap,E={};return E[new r.aQ(d.overscaledZ,_,i.z,f,i.y).key]={backfilled:!1},E[new r.aQ(d.overscaledZ,w,i.z,v,i.y).key]={backfilled:!1},i.y>0&&(E[new r.aQ(d.overscaledZ,_,i.z,f,i.y-1).key]={backfilled:!1},E[new r.aQ(d.overscaledZ,d.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},E[new r.aQ(d.overscaledZ,w,i.z,v,i.y-1).key]={backfilled:!1}),i.y+1<a&&(E[new r.aQ(d.overscaledZ,_,i.z,f,i.y+1).key]={backfilled:!1},E[new r.aQ(d.overscaledZ,d.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},E[new r.aQ(d.overscaledZ,w,i.z,v,i.y+1).key]={backfilled:!1}),E}},"raster-array":os,geojson:class extends r.E{constructor(d,i,a,f){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(f),this._data=i.data,this._options=r.Q({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;let _=r.a4/this.tileSize;this.workerOptions=r.Q({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*_,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*_,extent:r.a4,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:r.a4,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*_,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new r.f(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new r.f(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){let i=new Map;for(let a of this._data.features)i.set(a.id,a);for(let a of d.features)i.set(a.id,a);this._data.features=[...i.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},i),this}getClusterChildren(d,i){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},i),this}getClusterLeaves(d,i,a,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:i,offset:a},f),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.g("dataloading",{dataType:"source"})),this._loaded=!1;let i=r.Q({append:d},this.workerOptions);i.scope=this.scope;let a=this._data;typeof a=="string"?(i.request=this.map._requestManager.transformRequest(r.e.resolveURL(a),r.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(f,_)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new r.f(f));else{let v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(v.resourceTiming=_.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new r.g("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,i){let a=d.actor?"reloadTile":"loadTile";d.actor=this.actor;let f=this.map.style?this.map.style.getLut(this.scope):null,_=this._partialReload,v={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:f?{image:f.image.clone()}:null,scope:this.scope,pixelRatio:r.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:_};d.request=this.actor.send(a,v,(w,E)=>_&&!E?(d.state="loaded",i(null)):(delete d.request,d.destroy(),d.aborted?i(null):w?i(w):(d.loadVectorData(E,this.map.painter,a==="reloadTile"),i(null))),void 0,a==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,i){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.Q({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.bo{constructor(d,i,a,f){super(d,i,a,f),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;let d=this.options;this.urls=[];for(let i of d.urls)this.urls.push(this.map._requestManager.transformRequest(i,r.R.Source).url);r.bp(this.urls,(i,a)=>{this._loaded=!0,i?this.fire(new r.f(i)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){let i=this.video.seekable;d<i.start(0)||d>i.end(0)?this.fire(new r.f(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let d=this.map.painter.context,i=d.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(d,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.bo,model:class extends r.E{constructor(d,i,a,f){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){let d=[];for(let i in this._options.models){let a=this._options.models[i],f=r.l(this.map._requestManager.transformRequest(a.uri,r.R.Model).url).then(_=>{if(!_)return;let v=r.c(_),w=new r.M(i,a.position,a.orientation,v);w.computeBoundsAndApplyParent(),this.models.push(w)}).catch(_=>{this.fire(new r.f(new Error(`Could not load model ${i} from ${a.uri}: ${_.message}`)))});d.push(f)}return Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new r.g("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new r.f(new Error(`Could not load models: ${i.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,i){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(d,i,a,f){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(d){this.map=d,this.load()}load(d){this._loaded=!1,this.fire(new r.g("dataloading",{dataType:"source"}));let i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map._worldview;this._tileJSONRequest=$d(this._options,this.map._requestManager,i,a,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new r.f(f))):_&&(r.Q(this,_),_.bounds&&(this.tileBounds=new ql(_.bounds,this.minzoom,this.maxzoom)),r.ao(_.tiles,this.map._requestManager._customAccessToken),this.fire(new r.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.g("data",{dataType:"source",sourceDataType:"content"}))),d&&d(f)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,i){let a=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(a,r.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=i;else{if(d.buckets){let v=Object.values(d.buckets);for(let w of v)w.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",f,_.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",f,_.bind(this),void 0,!0);function _(v,w){return d.aborted?i(null):v&&v.status!==404?i(v):(w&&(w.resourceTiming&&(d.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&d.setExpiryData(w),d.buckets=Rt(Rt({},d.buckets),w.buckets),w.featureIndex&&(d.latestFeatureIndex=w.featureIndex)),d.state="loaded",void i(null))}}serialize(){return r.Q({},this._options)}},canvas:class extends r.bo{constructor(d,i,a,f){super(d,i,a,f),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(v=>typeof v!="number"))||this.fire(new r.f(new r.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.f(new r.V(`sources.${d}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new r.f(new r.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new r.f(new r.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.f(new r.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.f(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let i=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof r.bq||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends r.E{constructor(d,i,a,f){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=i,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.f(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.f(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ql(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),r.Q(this,r.ai(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ai(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.g("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new r.g("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){let{x:i,y:a,z:f}=d.canonical;return this._implementation.hasTile({x:i,y:a,z:f})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,i){let{x:a,y:f,z:_}=d.tileID.canonical,v=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:a,y:f,z:_},{signal:v.signal})).then((function(w){return delete d.request,d.aborted?(d.state="unloaded",i(null)):w===void 0?(d.state="errored",i(null)):w===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",i(null)):function(E){return E instanceof ImageData||E instanceof HTMLCanvasElement||E instanceof ImageBitmap||E instanceof HTMLImageElement}(w)?(this.loadTileData(d,w),d.state="loaded",void i(null)):(d.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.code!==20&&(d.state="errored",i(w))}),d.request.cancel=()=>v.abort()}loadTileData(d,i){d.setTexture(i,this.map.painter)}unloadTile(d,i){if(d.texture&&d.texture instanceof r.T?(d.destroy(!0),d.texture&&d.texture instanceof r.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){let{x:a,y:f,z:_}=d.tileID.canonical;this._implementation.unloadTile({x:a,y:f,z:_})}i&&i()}abortTile(d,i){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){let d=r.am(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new r.g("data",{dataType:"source",sourceDataType:"content"}))}}},zu=function(d,i,a,f){let _=new Nu[i.type](d,i,a,f);if(_.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${_.id}`);return r.br(["load","abort","unload","serialize","prepare"],_),_};class Em extends r.bx{constructor(i){let a={type:"raster-dem",maxzoom:i.transform.maxZoom},f=new r.by(r.bz(),null),_=zu("mock-dem",a,f,i.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,a){i.state="loaded",a(null)}}class Im extends r.bx{constructor(i){let a=zu("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new r.by(r.bz(),null),i.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,a,f){if(i.freezeTileCoverage)return;this.transform=i;let _=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,w)=>{if(v[w.key]="",!this._tiles[w.key]){let E=new r.bA(w,this._source.tileSize*w.overscaleFactor(),i.tileZoom);E.state="loaded",this._tiles[w.key]=E}return v},{});for(let v in this._tiles)v in _||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(i){let a=this.proxyCachedFBO[i];if(a!==void 0){let f=Object.values(a);this.renderCachePool.push(...f),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Xd extends r.aQ{constructor(i,a,f){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=a,this.projMatrix=f}}class kr extends r.bs{constructor(i,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[f,_,v]=function(D){let C=new r.bv,P=new r.bw,O=131;C.reserve(17161),P.reserve(33800);let F=r.a4/128,z=r.a4+F/2,U=z+F;for(let G=-F;G<U;G+=F)for(let H=-F;H<U;H+=F){let K=H<0||H>z||G<0||G>z?24575:0,J=r.au(Math.round(H),0,r.a4),Q=r.au(Math.round(G),0,r.a4);C.emplaceBack(J+K,Q)}let $=(G,H)=>{let K=H*O+G;P.emplaceBack(K+1,K,K+O),P.emplaceBack(K+O,K+O+1,K+1)};for(let G=1;G<129;G++)for(let H=1;H<129;H++)$(H,G);return[0,129].forEach(G=>{for(let H=0;H<130;H++)$(H,G),$(G,H)}),[C,P,32768]}(),w=i.context;this.gridBuffer=w.createVertexBuffer(f,r.bt.members),this.gridIndexBuffer=w.createIndexBuffer(_),this.gridSegments=r.b.simpleSegment(0,0,f.length,_.length),this.gridNoSkirtSegments=r.b.simpleSegment(0,0,f.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Im(a.map),this.orthoMatrix=r.ae.create(),r.ae.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.a4,0,r.a4,0,1);let E=w.gl;this._overlapStencilMode=new r.ah({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Em(a.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,a,f){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);let _=i.terrain.properties,v=i.terrain.drapeRenderMode===0,w=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.e.now();let E=i.terrain&&i.terrain.scope,D=_.get("source"),C=v?this._mockSourceCache:i.getSourceCache(D,E);if(!C)return void r.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=C,this._exaggeration=w?this.calculateExaggeration(a):_.get("exaggeration"),!a.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;let P=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let O=this.getScaledDemTileSize();this.sourceCache.update(a,O,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,P(),this._initializing=!0),P(),a.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(i){let a=this._previousCameraAltitude,f=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=f;let _=a!=null?f-a:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;let v=i.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(v);let E=v-this._previousZoom,D=this._previousUpdateTimestamp,C=v;this._evaluationZoom!=null&&(C=this._evaluationZoom,Math.abs(v-C)>.5&&(E=.5*(v-C+E)),E*_<0&&(C+=E)),this._evaluationZoom=C;let P=w.getExaggeration(C),O=P===w.getExaggeration(Math.max(0,C-.1));if(O&&Math.abs(P-this._exaggeration)<.01)return P;let F=Math.min(.1,.00375*(this._updateTimestamp-D));return(O||P<.1||Math.abs(E)<1e-4)&&(F=Math.min(.2,4*F)),r.a3(this._exaggeration,P,F)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let a=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(r._.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let _=this.proxyCoords=a.getIds().map(D=>{let C=a.getTileByID(D).tileID;return C.projMatrix=f.calculateProjMatrix(C.toUnwrapped()),C});(function(D,C){let P=C.transform.pointCoordinate(C.transform.getCameraPoint()),O=new r.P(P.x,P.y);D.sort((F,z)=>{if(z.overscaledZ-F.overscaledZ)return z.overscaledZ-F.overscaledZ;let U=new r.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),$=new r.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),G=O.mult(1<<F.canonical.z);return G.x-=.5,G.y-=.5,G.distSqr(U)-G.distSqr($)})})(_,this.painter);let v=this.proxyToSource||{};this.proxyToSource={},_.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};let w=this._style._mergedSourceCaches;for(let D in w){let C=w[D];if(!C.used||(C!==this.sourceCache&&this.resetTileLookupCache(C.id),this._setupProxiedCoordsForOrtho(C,i[D],v),C.usedForTerrain))continue;let P=i[D];C.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[a.id]=_.map(D=>new Xd(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;let E={};this._visibleDemTiles=[];for(let D of this.proxyCoords){let C=this.terrainTileForTile[D.key];if(!C)continue;let P=C.tileID.key;P in E||(this._visibleDemTiles.push(C),E[P]=P)}}_assignTerrainTiles(i){this._initializing||i.forEach(a=>{if(this.terrainTileForTile[a.key])return;let f=this._findTileCoveringTileID(a,this.sourceCache);f&&(this.terrainTileForTile[a.key]=f)})}_prepareDEMTextures(){let i=this.painter.context,a=i.gl;for(let f in this.terrainTileForTile){let _=this.terrainTileForTile[f],v=_.dem;!v||_.demTexture&&!_.needsDEMTextureUpload||(i.activeTexture.set(a.TEXTURE1),vm(this.painter,_,v))}}_prepareDemTileUniforms(i,a,f,_){if(!a||a.demTexture==null)return!1;let v=i.tileID.canonical,w=Math.pow(2,a.tileID.canonical.z-v.z),E=_||"";return f[`u_dem_tl${E}`]=[v.x*w%1,v.y*w%1],f[`u_dem_scale${E}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0,a=this._visibleDemTiles.reduce((f,_)=>{if(!_.dem)return f;let v=_.dem.tree.minimums[0];return v>0&&i++,f+v},0);return i?a/i:0}_updateEmptyDEMTexture(){let i=this.painter.context,a=i.gl;i.activeTexture.set(a.TEXTURE2);let f=this._getLoadedAreaMinimum(),[_,v]=(()=>{let E=new r.bB({width:1,height:1},new Float32Array([f]));return[a.R32F,E]})();this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(v,{premultiply:!1}):w=this._emptyDEMTexture=new r.T(i,v,_,{premultiply:!1}),w}setupElevationDraw(i,a,f){let _=this.painter.context,v=_.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let E=null,D=null,C=1;if(f&&f.morphing&&this._useVertexMorphing){let z=f.morphing.srcDemTile,U=f.morphing.dstDemTile;C=f.morphing.phase,z&&U&&(this._prepareDemTileUniforms(i,z,w,"_prev")&&(D=z),this._prepareDemTileUniforms(i,U,w)&&(E=U))}let P=z=>z&&z.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST,O=null;var F;if(this.enabled?D&&E?(O=E.demTexture,_.activeTexture.set(v.TEXTURE4),D.demTexture.bind(P(D),v.CLAMP_TO_EDGE),w.u_dem_lerp=C):(E=this.terrainTileForTile[i.tileID.key],O=this._prepareDemTileUniforms(i,E,w)?E.demTexture:this.emptyDEMTexture):O=this.emptyDEMTexture,_.activeTexture.set(v.TEXTURE2),O&&(w.u_dem_size=(F=O).size[0]===1?1:F.size[0]-2,O.bind(P(E),v.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,a,w),f&&f.useMeterToDem&&E){let z=(1<<E.tileID.canonical.z)*r.ay(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=z}if(f&&f.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),a.setTerrainUniformValues(_,w),this.painter.transform.projection.name==="globe"){let z=this.globeUniformValues(this.painter.transform,i.tileID.canonical,f&&f.useDenormalizedUpVectorScale);a.setGlobeUniformValues(_,z)}}globeUniformValues(i,a,f){let _=i.projection;return{u_tile_tl_up:_.upVector(a,0,0),u_tile_tr_up:_.upVector(a,r.a4,0),u_tile_br_up:_.upVector(a,r.a4,r.a4),u_tile_bl_up:_.upVector(a,0,r.a4),u_tile_up_scale:f?r.bu(1):_.upVectorScale(a,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){let a=this.painter,f=this.painter.context;i.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,v,w,E,D){if(_.transform.projection.name==="globe")(function(C,P,O,F,z){let U=C.context,$=U.gl,G,H,K=C.transform,J=r.bc(C,U,K),Q=(Me,Ee)=>{if(H===Ee)return;let me=[ec[Ee],"PROJECTION_GLOBE_VIEW"];J&&me.push("CUSTOM_ANTIALIASING");let je=C.isTileAffectedByFog(Me);G=C.getOrCreateProgram("globeRaster",{defines:me,overrideFog:je}),H=Ee},se=C.colorModeForRenderPass(),te=new r.af($.LEQUAL,r.af.ReadWrite,C.depthRangeFor3D);rs.update(z);let ne=r.bd(K),ce=[r.ak(K.center.lng),r.al(K.center.lat)],he=C.globeSharedBuffers,xe=[K.width*r.e.devicePixelRatio,K.height*r.e.devicePixelRatio],de=Float32Array.from(K.globeMatrix),oe={useDenormalizedUpVectorScale:!0};{let Me=C.transform,Ee=is(Me.zoom,P.exaggeration(),P.sourceCache._source.tileSize);H=-1;let me=$.TRIANGLES;for(let je of F){let Fe=O.getTile(je),be=r.ah.disabled,Ae=P.prevTerrainTileForTile[je.key],fe=P.terrainTileForTile[je.key];Jl(Ae,fe)&&rs.newMorphing(je.key,Ae,fe,z,250),U.activeTexture.set($.TEXTURE0),Fe.texture&&Fe.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);let Ne=rs.getMorphValuesForProxy(je.key),Be=Ne?1:0;Ne&&r.q(oe,{morphing:{srcDemTile:Ne.from,dstDemTile:Ne.to,phase:r.bb(Ne.phase)}});let Ke=r.be(je.canonical),et=r.bf(Ke.getCenter().lat),at=r.bg(je.canonical,Ke,et,Me.worldSize/Me._pixelsPerMercatorPixel),nt=r.bh(r.bi(je.canonical)),mt=Gd(Me.expandedFarZProjMatrix,de,ne,nt,r.a2(Me.zoom),ce,Me.frustumCorners.TL,Me.frustumCorners.TR,Me.frustumCorners.BR,Me.frustumCorners.BL,Me.globeCenterInViewSpace,Me.globeRadius,xe,Ee,Me._farZ,at);if(Q(je,Be),G&&(P.setupElevationDraw(Fe,G,oe),C.uploadCommonUniforms(U,G,je.toUnwrapped()),he)){let[At,_t,kt]=he.getGridBuffers(et,Ee!==0);G.draw(C,me,te,be,se,r.ag.backCCW,mt,"globe_raster",At,_t,kt)}}}if(he&&(C.renderDefaultNorthPole||C.renderDefaultSouthPole)){let Me=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];J&&Me.push("CUSTOM_ANTIALIASING"),G=C.getOrCreateProgram("globeRaster",{defines:Me});for(let Ee of F){let{x:me,y:je,z:Fe}=Ee.canonical,be=je===0,Ae=je===(1<<Fe)-1,[fe,Ne,Be,Ke]=he.getPoleBuffers(Fe,!1);if(Ke&&(be||Ae)){let et=O.getTile(Ee);U.activeTexture.set($.TEXTURE0),et.texture&&et.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);let at=r.bj(Fe,me,K),nt=r.bh(r.bi(Ee.canonical)),mt=(At,_t)=>At.draw(C,$.TRIANGLES,te,r.ah.disabled,se,r.ag.disabled,Gd(K.expandedFarZProjMatrix,at,at,nt,0,ce,K.frustumCorners.TL,K.frustumCorners.TR,K.frustumCorners.BR,K.frustumCorners.BL,K.globeCenterInViewSpace,K.globeRadius,xe,0,K._farZ),"globe_pole_raster",_t,Be,Ke);P.setupElevationDraw(et,G,oe),C.uploadCommonUniforms(U,G,Ee.toUnwrapped()),be&&C.renderDefaultNorthPole&&mt(G,fe),Ae&&C.renderDefaultSouthPole&&(at=r.ae.scale(r.ae.create(),at,[1,-1,1]),mt(G,Ne))}}}})(_,v,w,E,D);else{let C=_.context,P=C.gl,O,F,z=_.shadowRenderer,U=ni(_,_.longestCutoffRange),$=se=>{if(F===se)return;let te=[];te.push(ec[se]),U.shouldRenderCutoff&&te.push("RENDER_CUTOFF"),O=_.getOrCreateProgram("terrainRaster",{defines:te}),F=se},G=_.colorModeForRenderPass(),H=new r.af(P.LEQUAL,r.af.ReadWrite,_.depthRangeFor3D);rs.update(D);let K=_.transform,J=is(K.zoom,v.exaggeration(),v.sourceCache._source.tileSize),Q=[0,0,0];if(z){let se=_.style.directionalLight,te=_.style.ambientLight;se&&te&&(Q=Kl(_.style,se,te))}{F=-1;let se=P.TRIANGLES,[te,ne]=[v.gridIndexBuffer,v.gridSegments];for(let ce of E){let he=w.getTile(ce),xe=r.ah.disabled,de=v.prevTerrainTileForTile[ce.key],oe=v.terrainTileForTile[ce.key];Jl(de,oe)&&rs.newMorphing(ce.key,de,oe,D,250),C.activeTexture.set(P.TEXTURE0),he.texture&&he.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE);let Me=rs.getMorphValuesForProxy(ce.key),Ee=Me?1:0,me;Me&&(me={morphing:{srcDemTile:Me.from,dstDemTile:Me.to,phase:r.bb(Me.phase)}});let je=bm(ce.projMatrix,tc(ce.canonical,K.renderWorldCopies)?J/10:J,Q);if($(Ee),!O)continue;v.setupElevationDraw(he,O,me);let Fe=ce.toUnwrapped();z&&z.setupShadows(Fe,O),_.uploadCommonUniforms(C,O,Fe,null,U),O.draw(_,se,H,xe,G,r.ag.backCCW,je,"terrain_raster",v.gridBuffer,te,ne)}}}}(a,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;let a=this.painter,f=this.painter.context,_=this.proxySourceCache,v=this.proxiedCoords[_.id],w=this._drapedRenderBatches.shift(),E=a.style.order,D=[],C=0;for(let P of v){let O=_.getTileByID(P.proxyTileKey),F=_.proxyCachedFBO[P.key]?_.proxyCachedFBO[P.key][i]:void 0,z=F!==void 0?_.renderCache[F]:this.pool[C++],U=F!==void 0;if(O.texture=z.tex,U&&!z.dirty){D.push(O.tileID);continue}let $;f.bindFramebuffer.set(z.fb.framebuffer),this.renderedToTile=!1,z.dirty&&(f.clear({color:r.C.transparent,stencil:0}),z.dirty=!1);for(let G=w.start;G<=w.end;++G){let H=a.style._mergedLayers[E[G]];if(H.isHidden(a.transform.zoom))continue;let K=a.style.getLayerSourceCache(H),J=K?this.proxyToSource[P.key][K.id]:[P];if(!J)continue;let Q=J;f.viewport.set([0,0,z.fb.width,z.fb.height]),$!==(K?K.id:null)&&(this._setupStencil(z,J,H,K),$=K?K.id:null),a.renderLayer(a,K,H,Q)}if(this._drapedRenderBatches.length===0)for(let G of this._pendingGroundEffectLayers){let H=a.style._mergedLayers[E[G]];if(H.isHidden(a.transform.zoom))continue;let K=a.style.getLayerSourceCache(H),J=K?this.proxyToSource[P.key][K.id]:[P];if(!J)continue;let Q=J;f.viewport.set([0,0,z.fb.width,z.fb.height]),$!==(K?K.id:null)&&(this._setupStencil(z,J,H,K),$=K?K.id:null),a.renderLayer(a,K,H,Q)}this.renderedToTile?(z.dirty=!0,D.push(O.tileID)):U||--C,C===5&&(C=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),w.end+1}postRender(){}isLayerOrderingCorrect(i){let a=i.order.length,f=-1,_=a;for(let v=0;v<a;++v)this._style.isLayerDraped(i._mergedLayers[i.order[v]])?f=Math.max(f,v):_=Math.min(_,v);return _>f}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{i=Math.min(i,a.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,a,f){if(!this._visibleDemTiles)return null;let _=this._visibleDemTiles.filter(v=>v.dem).map(v=>{let w=v.tileID,E=1<<w.overscaledZ,{x:D,y:C}=w.canonical,P=D/E,O=(D+1)/E,F=C/E,z=(C+1)/E;return{minx:P,miny:F,maxx:O,maxy:z,t:v.dem.tree.raycastRoot(P,F,O,z,i,a,f),tile:v}});_.sort((v,w)=>(v.t!==null?v.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(let v of _){if(v.t==null)return null;let w=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,i,a,f);if(w!=null)return w}return null}_createFBO(){let i=this.painter.context,a=i.gl,f=this.drapeBufferSize;i.activeTexture.set(a.TEXTURE0);let _=new r.T(i,{width:f[0],height:f[1],data:null},a.RGBA);_.bind(a.LINEAR,a.CLAMP_TO_EDGE);let v=i.createFramebuffer(f[0],f[1],!0,null);return v.colorAttachment.set(_.texture),v.depthAttachment=new Ko(i,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:v,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{let a=this._style._mergedLayers[i],f=a.isHidden(this.painter.transform.zoom);return a.type==="custom"?!f&&a.shouldRedrape():!f&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(let f of this._style.getSources())if(f instanceof xm){i=!0;break}if(!i)return;let a={};for(let f=0;f<this._style.order.length;++f){let _=this._style._mergedLayers[this._style.order[f]],v=this._style.getLayerSourceCache(_);if(v&&!a[v.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof r.Z){a[v.id]=!0;for(let w of this.proxyCoords){let E=this.proxyToSource[w.key][v.id];if(E)for(let D of E)this._clearRenderCacheForTile(v.id,D)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(let f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof pi){i=!0;break}if(!i)return;let a={};for(let f=0;f<this._style.order.length;++f){let _=this._style._mergedLayers[this._style.order[f]],v=this._style.getLayerSourceCache(_);if(!v||a[v.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;let w=_.paint.get("raster-fade-duration");for(let E of this.proxyCoords){let D=this.proxyToSource[E.key][v.id];if(D)for(let C of D){let P=Fu(v.getTile(C),v.findLoadedParent(C,0),v,this.painter.transform,w);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(v.id,C)}}}}_setupDrapedRenderBatches(){let i=this._style.order,a=i.length;if(a===0)return;let f=[];this._pendingGroundEffectLayers=[];let _,v=0,w=this._style._mergedLayers[i[v]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++v<a;)w=this._style._mergedLayers[i[v]];for(;v<a;++v){let E=this._style._mergedLayers[i[v]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?_===void 0&&(_=v):(E.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),_!==void 0&&(f.push({start:_,end:v-1}),_=void 0)))}if(_!==void 0&&f.push({start:_,end:v-1}),f.length!==0){let E=f[f.length-1];this._pendingGroundEffectLayers.every(D=>D>E.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(i){let a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){let w=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let E=0;E<w.length;++E){let D=Object.values(w[E]);a.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();let f=this.proxyCoords,_=this._tilesDirty;for(let w=f.length-1;w>=0;w--){let E=f[w];if(a.getTileByID(E.key),a.proxyCachedFBO[E.key]!==void 0){let D=i[E.key],C=this.proxyToSource[E.key],P=0;for(let O in C){let F=C[O],z=D[O];if(!z||z.length!==F.length||F.some((U,$)=>U!==z[$]||_[O]&&_[O].hasOwnProperty(U.key))){P=-1;break}++P}for(let O in a.proxyCachedFBO[E.key])a.renderCache[a.proxyCachedFBO[E.key][O]].dirty=P<0||P!==Object.values(D).length}}let v=[...this._drapedRenderBatches];v.sort((w,E)=>E.end-E.start-(w.end-w.start));for(let w of v)for(let E of f){if(a.proxyCachedFBO[E.key])continue;let D=a.renderCachePool.pop();D===void 0&&a.renderCache.length<50&&(D=a.renderCache.length,a.renderCache.push(this._createFBO())),D!==void 0&&(a.proxyCachedFBO[E.key]={},a.proxyCachedFBO[E.key][w.start]=D,a.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(i,a,f,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let v=this.painter.context,w=v.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let E;if(f.isTileClipped())E=a.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):r.ah.disabled}_renderTileClippingMasks(i,a){let f=this.painter,_=this.painter.context,v=_.gl;f._tileClippingMaskIDs={},_.setColorMode(r.a.disabled),_.setDepthMode(r.af.disabled);let w=f.getOrCreateProgram("clippingMask");for(let E of i){let D=f._tileClippingMaskIDs[E.key]=--a;w.draw(f,v.TRIANGLES,r.af.disabled,new r.ah({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),r.a.disabled,r.ag.disabled,nc(E.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(i){let a=this.painter.transform;if(i.x<0||i.x>a.width||i.y<0||i.y>a.height)return null;let f=[i.x,i.y,1,1];r.aB.transformMat4(f,f,a.pixelMatrixInverse),r.aB.scale(f,f,1/f[3]),f[0]/=a.worldSize,f[1]/=a.worldSize;let _=a._camera.position,v=r.ay(1,a.center.lat),w=[_[0],_[1],_[2]/v,0],E=r.$.subtract([],f.slice(0,3),w);r.$.normalize(E,E);let D=this.raycast(w,E,this._exaggeration);return D!==null&&D?(r.$.scaleAndAdd(w,w,E,D),w[3]=w[2],w[2]*=v,w):null}_setupProxiedCoordsForOrtho(i,a,f){if(i.getSource()instanceof r.bo)return this._setupProxiedCoordsForImageSource(i,a,f);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};let _=this.proxiedCoords[i.id]=[],v=this.proxyCoords;for(let D=0;D<v.length;D++){let C=v[D],P=this._findTileCoveringTileID(C,i);if(P){let O=this._createProxiedId(C,P,f[C.key]&&f[C.key][i.id]);_.push(O),this.proxyToSource[C.key][i.id]=[O]}}let w=!1,E=new Set;for(let D=0;D<a.length;D++){let C=i.getTile(a[D]);if(!C||!C.hasData())continue;let P=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==C.tileID.canonical.z){let O=this.proxyToSource[P.tileID.key][i.id],F=this._createProxiedId(P.tileID,C,f[P.tileID.key]&&f[P.tileID.key][i.id]);O?O.splice(O.length-1,0,F):this.proxyToSource[P.tileID.key][i.id]=[F];let z=this.proxyToSource[P.tileID.key][i.id];E.has(z)||E.add(z),_.push(F),w=!0}}if(this._sourceTilesOverlap[i.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(let D of E)D.sort((C,P)=>P.overscaledZ-C.overscaledZ)}_setupProxiedCoordsForImageSource(i,a,f){if(!i.getSource().loaded())return;let _=this.proxiedCoords[i.id]=[],v=this.proxyCoords,w=i.getSource(),E=w.tileID;if(!E)return;let D=new r.P(E.x,E.y)._div(1<<E.z),C=w.coordinates.map(r._.fromLngLat).reduce((O,F)=>(O.min.x=Math.min(O.min.x,F.x-D.x),O.min.y=Math.min(O.min.y,F.y-D.y),O.max.x=Math.max(O.max.x,F.x-D.x),O.max.y=Math.max(O.max.y,F.y-D.y),O),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(O,F)=>{let z=O.wrap+O.canonical.x/(1<<O.canonical.z),U=O.canonical.y/(1<<O.canonical.z),$=r.a4/(1<<O.canonical.z),G=F.wrap+F.canonical.x/(1<<F.canonical.z),H=F.canonical.y/(1<<F.canonical.z);return z+$<G+C.min.x||z>G+C.max.x||U+$<H+C.min.y||U>H+C.max.y};for(let O=0;O<v.length;O++){let F=v[O];for(let z=0;z<a.length;z++){let U=i.getTile(a[z]);if(!U||!U.hasData()||P(F,U.tileID))continue;let $=this._createProxiedId(F,U,f[F.key]&&f[F.key][i.id]),G=this.proxyToSource[F.key][i.id];G?G.push($):this.proxyToSource[F.key][i.id]=[$],_.push($)}}}_createProxiedId(i,a,f){let _=this.orthoMatrix;if(f){let v=f.find(w=>w.key===a.tileID.key);if(v)return v}if(a.tileID.key!==i.key){let v=i.canonical.z-a.tileID.canonical.z,w,E,D;_=r.ae.create();let C=a.tileID.wrap-i.wrap<<i.overscaledZ;v>0?(w=r.a4>>v,E=w*((a.tileID.canonical.x<<v)-i.canonical.x+C),D=w*((a.tileID.canonical.y<<v)-i.canonical.y)):(w=r.a4<<-v,E=r.a4*(a.tileID.canonical.x-(i.canonical.x+C<<-v)),D=r.a4*(a.tileID.canonical.y-(i.canonical.y<<-v))),r.ae.ortho(_,0,w,0,w,0,1),r.ae.translate(_,_,[E,D,0])}return new Xd(a.tileID,i.key,_)}_findTileCoveringTileID(i,a){let f=a.getTile(i);if(f&&f.hasData())return f;let _=this._findCoveringTileCache[a.id],v=_[i.key];if(f=v?a.getTileByID(v):null,f&&f.hasData()||v===null)return f;let w=f?f.tileID:i,E=w.overscaledZ,D=a.getSource().minzoom,C=[];if(!v){let O=a.getSource().maxzoom;if(i.canonical.z>=O){let F=i.canonical.z-O;a.getSource().reparseOverscaled?(E=Math.max(i.canonical.z+2,a.transform.tileZoom),w=new r.aQ(E,i.wrap,O,i.canonical.x>>F,i.canonical.y>>F)):F!==0&&(E=O,w=new r.aQ(E,i.wrap,O,i.canonical.x>>F,i.canonical.y>>F))}w.key!==i.key&&(C.push(w.key),f=a.getTile(w))}let P=O=>{C.forEach(F=>{_[F]=O}),C.length=0};for(E-=1;E>=D&&(!f||!f.hasData());E--){f&&P(f.tileID.key);let O=w.calculateScaledKey(E);if(f=a.getTileByID(O),f&&f.hasData())break;let F=_[O];if(F===null)break;F===void 0?C.push(O):f=a.getTileByID(F)}return P(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,a){let f=this._tilesDirty[i];f||(f=this._tilesDirty[i]={}),f[a.key]=!0}}function Mm(d,i,a){let f=function(E,D,C){let P=r.$.dot(D,E),O=r.$.dot(C,[.2126,.7152,.0722]),F=(U,$,G)=>(1-G)*U+G*$,z=F(1-.3*Math.min(O,1),1,Math.min(P+1,1));return F(.92,1,Math.asin(r.au(D[2],-1,1))/Math.PI+.5)*z}(d,[0,0,1],i),_=[0,0,0];r.$.scale(_,a.slice(0,3),f);let v=[0,0,0];r.$.scale(v,i.slice(0,3),d[2]);let w=[0,0,0];return r.$.add(w,_,v),r.ba(w)}let Yd=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Dm=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Qd{static cacheKey(i,a,f,_){let v=`${a}${_?_.cacheKey:""}`;for(let w of f)i.usedDefines.includes(w)&&(v+=`/${w}`);return v}constructor(i,a,f,_,v,w){let E=i.gl;this.program=E.createProgram(),this.configuration=_,this.name=a,this.fixedDefines=[...w];let D=_?_.getBinderAttributes():[],C=(f.staticAttributes||[]).concat(D),P=_?_.defines():[];P=P.concat(w.map(G=>`#define ${G}`));let O=`#version 300 es
`,F=O+P.concat("precision mediump float;",_m,Pu.fragmentSource).join(`
`);for(let G of f.fragmentIncludes)F+=`
${Hl[G]}`;F+=`
${f.fragmentSource}`;let z=O+P.concat("precision highp float;",_m,Pu.vertexSource).join(`
`);for(let G of f.vertexIncludes)z+=`
${Hl[G]}`;z+=`
${f.vertexSource}`;let U=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(U,F),E.compileShader(U),E.attachShader(this.program,U);let $=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource($,z),E.compileShader($),E.attachShader(this.program,$),this.attributes={},this.numAttributes=C.length;for(let G=0;G<this.numAttributes;G++)if(C[G]){let H=C[G].startsWith("a_")?C[G]:`a_${C[G]}`;E.bindAttribLocation(this.program,G,H),this.attributes[H]=G}E.linkProgram(this.program),E.deleteShader($),E.deleteShader(U),this.fixedUniforms=v(i),this.binderUniforms=_?_.getUniforms(i):[],(w.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(G=>({u_dem:new r.a8(G),u_dem_prev:new r.a8(G),u_dem_tl:new r.a9(G),u_dem_scale:new r.ab(G),u_dem_tl_prev:new r.a9(G),u_dem_scale_prev:new r.ab(G),u_dem_size:new r.ab(G),u_dem_lerp:new r.ab(G),u_exaggeration:new r.ab(G),u_depth:new r.a8(G),u_depth_size_inv:new r.a9(G),u_depth_range_unpack:new r.a9(G),u_occluder_half_size:new r.ab(G),u_occlusion_depth_offset:new r.ab(G),u_meter_to_dem:new r.ab(G),u_label_plane_matrix_inv:new r.a7(G)}))(i)),w.includes("GLOBE")&&(this.globeUniforms=(G=>({u_tile_tl_up:new r.ar(G),u_tile_tr_up:new r.ar(G),u_tile_br_up:new r.ar(G),u_tile_bl_up:new r.ar(G),u_tile_up_scale:new r.ab(G)}))(i)),w.includes("FOG")&&(this.fogUniforms=(G=>({u_fog_matrix:new r.a7(G),u_fog_range:new r.a9(G),u_fog_color:new r.at(G),u_fog_horizon_blend:new r.ab(G),u_fog_vertical_limit:new r.a9(G),u_fog_temporal_offset:new r.ab(G),u_frustum_tl:new r.ar(G),u_frustum_tr:new r.ar(G),u_frustum_br:new r.ar(G),u_frustum_bl:new r.ar(G),u_globe_pos:new r.ar(G),u_globe_radius:new r.ab(G),u_globe_transition:new r.ab(G),u_is_globe:new r.a8(G),u_viewport:new r.a9(G)}))(i)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(G=>({u_cutoff_params:new r.at(G)}))(i)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(G=>({u_lighting_ambient_color:new r.ar(G),u_lighting_directional_dir:new r.ar(G),u_lighting_directional_color:new r.ar(G),u_ground_radiance:new r.ar(G)}))(i)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(G=>({u_light_matrix_0:new r.a7(G),u_light_matrix_1:new r.a7(G),u_fade_range:new r.a9(G),u_shadow_normal_offset:new r.ar(G),u_shadow_intensity:new r.ab(G),u_shadow_texel_size:new r.ab(G),u_shadow_map_resolution:new r.ab(G),u_shadow_direction:new r.ar(G),u_shadow_bias:new r.ar(G),u_shadowmap_0:new r.a8(G),u_shadowmap_1:new r.a8(G)}))(i))}}setTerrainUniformValues(i,a){if(!this.terrainUniforms)return;let f=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(let _ in a)f[_]&&f[_].set(this.program,_,a[_])}}setGlobeUniformValues(i,a){if(!this.globeUniforms)return;let f=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(let _ in a)f[_]&&f[_].set(this.program,_,a[_])}}setFogUniformValues(i,a){if(!this.fogUniforms)return;let f=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(let _ in a)f[_].set(this.program,_,a[_])}}setCutoffUniformValues(i,a){if(!this.cutoffUniforms)return;let f=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(let _ in a)f[_].set(this.program,_,a[_])}}setLightsUniformValues(i,a){if(!this.lightsUniforms)return;let f=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(let _ in a)f[_].set(this.program,_,a[_])}}setShadowUniformValues(i,a){if(this.failedToCreate||!this.shadowUniforms)return;let f=this.shadowUniforms;i.program.set(this.program);for(let _ in a)f[_].set(this.program,_,a[_])}_drawDebugWireframe(i,a,f,_,v,w,E,D,C,P){let O=i.options.wireframe;if(O.terrain===!1&&O.layers2D===!1&&O.layers3D===!1)return;let F=i.context;if(!(!(!O.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!O.layers2D||i._terrain&&i._terrain.renderingToTexture||!Yd.includes(this.name))||!(!O.layers3D||!Dm.includes(this.name))))return;let z=F.gl,U=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,v,F);if(!U)return;let $=[...this.fixedDefines];$.push("DEBUG_WIREFRAME");let G=i.getOrCreateProgram(this.name,{config:this.configuration,defines:$});F.program.set(G.program);let H=(Q,se,te)=>{if(se[Q]&&te[Q])for(let ne in se[Q])te[Q][ne]&&te[Q][ne].set(te.program,ne,se[Q][ne].current)};C&&C.setUniforms(G.program,F,G.binderUniforms,E,{zoom:D}),H("fixedUniforms",this,G),H("terrainUniforms",this,G),H("globeUniforms",this,G),H("fogUniforms",this,G),H("lightsUniforms",this,G),H("shadowUniforms",this,G),U.bind(),F.setColorMode(new r.a([z.ONE,z.ONE_MINUS_SRC_ALPHA,z.ZERO,z.ONE],r.C.transparent,[!0,!0,!0,!1])),F.setDepthMode(new r.af(a.func===z.LESS?z.LEQUAL:a.func,r.af.ReadOnly,a.range)),F.setStencilMode(r.ah.disabled);let K=3*w.primitiveLength*2,J=3*w.primitiveOffset*2*2;P&&P>1?z.drawElementsInstanced(z.LINES,K,z.UNSIGNED_SHORT,J,P):z.drawElements(z.LINES,K,z.UNSIGNED_SHORT,J),v.bind(),F.program.set(this.program),F.setDepthMode(a),F.setStencilMode(f),F.setColorMode(_)}draw(i,a,f,_,v,w,E,D,C,P,O,F,z,U,$,G){let H=i.context,K=H.gl;if(this.failedToCreate)return;H.program.set(this.program),H.setDepthMode(f),H.setStencilMode(_),H.setColorMode(v),H.setCullFace(w);for(let se of Object.keys(this.fixedUniforms))this.fixedUniforms[se].set(this.program,se,E[se]);U&&U.setUniforms(this.program,H,this.binderUniforms,F,{zoom:z});let J={[K.POINTS]:1,[K.LINES]:2,[K.TRIANGLES]:3,[K.LINE_STRIP]:1}[a],Q=G&&G>0?1:void 0;for(let se of O.get()){let te=se.vaos||(se.vaos={});(te[D]||(te[D]=new i0)).bind(H,this,C,U?U.getPaintVertexBuffers():[],P,se.vertexOffset,$||[],Q),G&&G>1?K.drawElementsInstanced(a,se.primitiveLength*J,K.UNSIGNED_SHORT,se.primitiveOffset*J*2,G):P?K.drawElements(a,se.primitiveLength*J,K.UNSIGNED_SHORT,se.primitiveOffset*J*2):K.drawArrays(a,se.vertexOffset,se.vertexLength),a===K.TRIANGLES&&P&&this._drawDebugWireframe(i,f,_,v,P,se,F,z,U,G)}}}function Kd(d,i){let a=Math.pow(2,i.tileID.overscaledZ),f=i.tileSize*Math.pow(2,d.transform.tileZoom)/a,_=f*(i.tileID.canonical.x+i.tileID.wrap*a),v=f*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.bD(i,1,d.transform.tileZoom),u_pixel_coord_upper:[_>>16,v>>16],u_pixel_coord_lower:[65535&_,65535&v]}}let Cm=r.ae.create(),ao=(d,i,a,f,_,v,w,E,D,C,P,O,F,z,U,$,G,H)=>{let K=i.style.light,J=K.properties.get("position"),Q=[J.x,J.y,J.z],se=r.bE.create();K.properties.get("anchor")==="viewport"&&(r.bE.fromRotation(se,-i.transform.angle),r.$.transformMat3(Q,Q,se));let te=K.properties.get("color"),ne=i.transform,ce={u_matrix:d,u_lightpos:Q,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[te.r,te.g,te.b],u_vertical_gradient:+a,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Cm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:v,u_alignment:w,u_width_scale:E,u_flood_light_color:z,u_vertical_scale:U,u_flood_light_intensity:$,u_ground_shadow_factor:G,u_emissive_strength:H};return ne.projection.name==="globe"&&(ce.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],ce.u_zoom_transition=P,ce.u_inv_rot_matrix=F,ce.u_merc_center=O,ce.u_up_dir=ne.projection.upVector(new r.aO(0,0,0),O[0]*r.a4,O[1]*r.a4),ce.u_height_lift=C),ce},Bu=(d,i,a,f,_)=>({u_matrix:d,u_edge_radius:i,u_alignment:a,u_width_scale:f,u_vertical_scale:_}),Sm=(d,i,a,f,_,v,w,E,D,C,P,O,F,z,U,$)=>{let G=ao(d,i,a,f,_,v,w,E,D,P,O,F,z,U,$,1,[0,0,0],0),H={u_height_factor:-Math.pow(2,D.overscaledZ)/C.tileSize/8};return r.Q(G,Kd(i,C),H)},rc=(d,i)=>({u_matrix:d,u_emissive_strength:i}),ju=(d,i,a,f)=>r.Q(rc(d,i),Kd(a,f)),Vu=(d,i,a)=>({u_matrix:d,u_world:a,u_emissive_strength:i}),ic=(d,i,a,f,_)=>r.Q(ju(d,i,a,f),{u_world:_}),za=(d,i,a,f)=>{let _=r.a4/a.tileSize;return{u_matrix:d,u_camera_to_center_distance:i.getCameraToCenterDistance(f),u_extrude_scale:[i.pixelsToGLUnits[0]/_,i.pixelsToGLUnits[1]/_]}},Uu=(d,i,a=1)=>({u_matrix:d,u_color:i.toRenderColor(null),u_overlay:0,u_overlay_scale:a}),Am=r.ae.create(),Pm=(d,i,a,f,_,v,w)=>{let E=d.transform,D=E.projection.name==="globe",C=D?r.bF(E.zoom,i.canonical)*E._pixelsPerMercatorPixel:r.bD(a,1,v),P={u_matrix:i.projMatrix,u_extrude_scale:C,u_intensity:w,u_inv_rot_matrix:Am,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){P.u_inv_rot_matrix=f,P.u_merc_center=_,P.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],P.u_zoom_transition=r.a2(E.zoom);let O=_[0]*r.a4,F=_[1]*r.a4;P.u_up_dir=E.projection.upVector(new r.aO(0,0,0),O,F)}return P};function Jd(d,[i,a,f,_],[v,w]){if(v===w)return[0,0,0,0];let E=255*(d-1)/(d*(w-v));return[i*E,a*E,f*E,_*E]}function oc(d,i,[a,f]){return a===f?0:.5/d+(i-a)*(d-1)/(d*(f-a))}let $u=(d,i,a,f,_,v,w,E,D,C,P,O,F,z,U,$,G,H,K,J,Q)=>({u_matrix:d,u_normalize_matrix:i,u_globe_matrix:a,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:v,u_scale_parent:C,u_fade_t:P.mix,u_opacity:P.opacity*O.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:O.paint.get("raster-brightness-min"),u_brightness_high:O.paint.get("raster-brightness-max"),u_saturation_factor:r.bG(O.paint.get("raster-saturation")),u_contrast_factor:r.bH(O.paint.get("raster-contrast")),u_spin_weights:ef(O.paint.get("raster-hue-rotate")),u_perspective_transform:F,u_raster_elevation:z,u_zoom_transition:w,u_merc_center:E,u_cutoff_params:D,u_colorization_mix:Jd(r.bI,$,H),u_colorization_offset:oc(r.bI,G,H),u_color_ramp:U,u_texture_offset:[J/(K+2*J),K/(K+2*J)],u_texture_res:[K+2*J,K+2*J],u_emissive_strength:Q});function ef(d){d*=Math.PI/180;let i=Math.sin(d),a=Math.cos(d);return[(2*a+1)/3,(-Math.sqrt(3)*i-a+1)/3,(Math.sqrt(3)*i-a+1)/3]}let lo=.05,Bs=(d,i,a,f,_,v,w,E,D,C,P,O)=>({u_matrix:d,u_normalize_matrix:i,u_globe_matrix:a,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:v,u_scale_parent:C,u_fade_t:P.mix,u_opacity:P.opacity,u_image0:0,u_image1:1,u_raster_elevation:O,u_zoom_transition:w,u_merc_center:E,u_cutoff_params:D}),c0=(d,i,a,f,_,v,w,E,D,C)=>({u_particle_texture:d,u_particle_texture_side_len:i,u_tile_offset:a,u_velocity:f,u_color_ramp:v,u_velocity_res:_,u_max_speed:w,u_uv_offset:E,u_data_scale:[255*D[0],255*D[1]],u_data_offset:C,u_particle_pos_scale:1.1,u_particle_pos_offset:[lo,lo]}),Rm=(d,i,a,f,_,v,w,E,D,C)=>({u_particle_texture:d,u_particle_texture_side_len:i,u_velocity:a,u_velocity_res:f,u_max_speed:_,u_speed_factor:v,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:E,u_data_scale:[255*D[0],255*D[1]],u_data_offset:C,u_particle_pos_scale:1.1,u_particle_pos_offset:[lo,lo]}),sc=r.ae.create(),Ba=(d,i,a,f,_,v,w,E,D,C,P,O,F,z,U,$,G,H)=>{let K=_.transform,J={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:K.getCameraToCenterDistance($),u_rotate_symbol:+a,u_aspect_ratio:K.width/K.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:w,u_coord_matrix:E,u_is_text:+D,u_pitch_with_map:+f,u_texsize:C,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:sc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:sc,u_up_vector:[0,-1,0],u_color_adj_mat:G,u_icon_transition:H||0};return $.name==="globe"&&(J.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],J.u_zoom_transition=O,J.u_inv_rot_matrix=z,J.u_merc_center=F,J.u_camera_forward=K._camera.forward(),J.u_ecef_origin=r.bJ(K.globeMatrix,P.toUnwrapped()),J.u_tile_matrix=Float32Array.from(K.globeMatrix),J.u_up_vector=U),J},ac=(d,i,a,f,_,v,w,E,D,C,P,O,F,z,U,$,G)=>r.Q(Ba(d,i,a,f,_,v,w,E,D,C,O,F,z,U,$,G),{u_gamma_scale:f?_.transform.getCameraToCenterDistance(G)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:r.e.devicePixelRatio,u_is_halo:+P,undefined:void 0}),tf=(d,i,a,f,_,v,w,E,D,C,P,O,F,z,U,$)=>r.Q(ac(d,i,a,f,_,v,w,E,!0,D,!0,P,O,F,z,U,$),{u_texsize_icon:C,u_texture_icon:1}),nf=(d,i,a,f)=>({u_matrix:d,u_emissive_strength:i,u_opacity:a,u_color:f}),u0=(d,i,a,f,_,v,w,E)=>r.Q(function(D,C,P,O,F){let{width:z,height:U}=O.imageManager.getPixelSize(C),$=Math.pow(2,F.tileID.overscaledZ),G=F.tileSize*Math.pow(2,O.transform.tileZoom)/$,H=G*(F.tileID.canonical.x+F.tileID.wrap*$),K=G*F.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[z,U],u_pattern_size:P.displaySize,u_tile_units_to_pixels:1/r.bD(F,1,O.transform.tileZoom),u_pixel_coord_upper:[H>>16,K>>16],u_pixel_coord_lower:[65535&H,65535&K]}}(0,v,w,f,E),{u_matrix:d,u_emissive_strength:i,u_opacity:a}),Li=new Float32Array(r.ae.identity([])),js=(d,i,a,f,_,v,w,E,D,C,P,O,F,z=[0,0,0],U)=>{let $=_.style.light,G=$.properties.get("position"),H=[-G.x,-G.y,G.z],K=r.bE.create();$.properties.get("anchor")==="viewport"&&(r.bE.fromRotation(K,-_.transform.angle),r.$.transformMat3(H,H,K));let J=P.alphaMode==="MASK",Q=$.properties.get("color").toRenderColor(null),se=F.paint.get("model-ambient-occlusion-intensity"),te=F.paint.get("model-color").constantOr(r.C.white).toRenderColor(null),ne=F.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:d,u_lighting_matrix:i,u_normal_matrix:a,u_node_matrix:f||Li,u_lightpos:H,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[Q.r,Q.g,Q.b],u_camera_pos:z,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+J,u_alphaCutoff:P.alphaCutoff,u_baseColorFactor:[w.r,w.g,w.b,w.a],u_emissiveFactor:[E[0],E[1],E[2],1],u_metallicFactor:D,u_roughnessFactor:C,u_baseColorTexture:Or.BaseColor,u_metallicRoughnessTexture:Or.MetallicRoughness,u_normalTexture:Or.Normal,u_occlusionTexture:Or.Occlusion,u_emissionTexture:Or.Emission,u_lutTexture:Or.LUT,u_color_mix:[te.r,te.g,te.b,ne],u_aoIntensity:se,u_emissive_strength:O,u_occlusionTextureTransform:U||[0,0,0,0]}},rf=(d,i=Li,a=Li)=>({u_matrix:d,u_instance:i,u_node_matrix:a}),Om={fillExtrusion:d=>({u_matrix:new r.a7(d),u_lightpos:new r.ar(d),u_lightintensity:new r.ab(d),u_lightcolor:new r.ar(d),u_vertical_gradient:new r.ab(d),u_opacity:new r.ab(d),u_edge_radius:new r.ab(d),u_alignment:new r.ab(d),u_width_scale:new r.ab(d),u_ao:new r.a9(d),u_tile_id:new r.ar(d),u_zoom_transition:new r.ab(d),u_inv_rot_matrix:new r.a7(d),u_merc_center:new r.a9(d),u_up_dir:new r.ar(d),u_height_lift:new r.ab(d),u_flood_light_color:new r.ar(d),u_vertical_scale:new r.ab(d),u_flood_light_intensity:new r.ab(d),u_ground_shadow_factor:new r.ar(d),u_emissive_strength:new r.ab(d)}),fillExtrusionDepth:d=>({u_matrix:new r.a7(d),u_edge_radius:new r.ab(d),u_alignment:new r.ab(d),u_width_scale:new r.ab(d),u_vertical_scale:new r.ab(d)}),fillExtrusionPattern:d=>({u_matrix:new r.a7(d),u_lightpos:new r.ar(d),u_lightintensity:new r.ab(d),u_lightcolor:new r.ar(d),u_vertical_gradient:new r.ab(d),u_height_factor:new r.ab(d),u_edge_radius:new r.ab(d),u_alignment:new r.ab(d),u_width_scale:new r.ab(d),u_ao:new r.a9(d),u_tile_id:new r.ar(d),u_zoom_transition:new r.ab(d),u_inv_rot_matrix:new r.a7(d),u_merc_center:new r.a9(d),u_up_dir:new r.ar(d),u_height_lift:new r.ab(d),u_image:new r.a8(d),u_texsize:new r.a9(d),u_pixel_coord_upper:new r.a9(d),u_pixel_coord_lower:new r.a9(d),u_tile_units_to_pixels:new r.ab(d),u_opacity:new r.ab(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new r.a7(d),u_opacity:new r.ab(d),u_ao_pass:new r.ab(d),u_meter_to_tile:new r.ab(d),u_ao:new r.a9(d),u_flood_light_intensity:new r.ab(d),u_flood_light_color:new r.ar(d),u_attenuation:new r.ab(d),u_edge_radius:new r.ab(d),u_fb:new r.a8(d),u_fb_size:new r.ab(d)}),fill:d=>({u_matrix:new r.a7(d),u_emissive_strength:new r.ab(d)}),fillPattern:d=>({u_matrix:new r.a7(d),u_emissive_strength:new r.ab(d),u_image:new r.a8(d),u_texsize:new r.a9(d),u_pixel_coord_upper:new r.a9(d),u_pixel_coord_lower:new r.a9(d),u_tile_units_to_pixels:new r.ab(d)}),fillOutline:d=>({u_matrix:new r.a7(d),u_emissive_strength:new r.ab(d),u_world:new r.a9(d)}),fillOutlinePattern:d=>({u_matrix:new r.a7(d),u_emissive_strength:new r.ab(d),u_world:new r.a9(d),u_image:new r.a8(d),u_texsize:new r.a9(d),u_pixel_coord_upper:new r.a9(d),u_pixel_coord_lower:new r.a9(d),u_tile_units_to_pixels:new r.ab(d)}),circle:r.bK,collisionBox:d=>({u_matrix:new r.a7(d),u_camera_to_center_distance:new r.ab(d),u_extrude_scale:new r.a9(d)}),collisionCircle:d=>({u_matrix:new r.a7(d),u_inv_matrix:new r.a7(d),u_camera_to_center_distance:new r.ab(d),u_viewport_size:new r.a9(d)}),debug:d=>({u_color:new r.aa(d),u_matrix:new r.a7(d),u_overlay:new r.a8(d),u_overlay_scale:new r.ab(d)}),clippingMask:d=>({u_matrix:new r.a7(d)}),heatmap:d=>({u_extrude_scale:new r.ab(d),u_intensity:new r.ab(d),u_matrix:new r.a7(d),u_inv_rot_matrix:new r.a7(d),u_merc_center:new r.a9(d),u_tile_id:new r.ar(d),u_zoom_transition:new r.ab(d),u_up_dir:new r.ar(d)}),heatmapTexture:d=>({u_image:new r.a8(d),u_color_ramp:new r.a8(d),u_opacity:new r.ab(d)}),hillshade:d=>({u_matrix:new r.a7(d),u_image:new r.a8(d),u_latrange:new r.a9(d),u_light:new r.a9(d),u_shadow:new r.aa(d),u_highlight:new r.aa(d),u_emissive_strength:new r.ab(d),u_accent:new r.aa(d)}),hillshadePrepare:d=>({u_matrix:new r.a7(d),u_image:new r.a8(d),u_dimension:new r.a9(d),u_zoom:new r.ab(d)}),line:r.bL,linePattern:r.bM,raster:d=>({u_matrix:new r.a7(d),u_normalize_matrix:new r.a7(d),u_globe_matrix:new r.a7(d),u_merc_matrix:new r.a7(d),u_grid_matrix:new r.as(d),u_tl_parent:new r.a9(d),u_scale_parent:new r.ab(d),u_fade_t:new r.ab(d),u_opacity:new r.ab(d),u_image0:new r.a8(d),u_image1:new r.a8(d),u_brightness_low:new r.ab(d),u_brightness_high:new r.ab(d),u_saturation_factor:new r.ab(d),u_contrast_factor:new r.ab(d),u_spin_weights:new r.ar(d),u_perspective_transform:new r.a9(d),u_raster_elevation:new r.ab(d),u_zoom_transition:new r.ab(d),u_merc_center:new r.a9(d),u_cutoff_params:new r.at(d),u_colorization_mix:new r.at(d),u_colorization_offset:new r.ab(d),u_color_ramp:new r.a8(d),u_texture_offset:new r.a9(d),u_texture_res:new r.a9(d),u_emissive_strength:new r.ab(d)}),rasterParticle:d=>({u_matrix:new r.a7(d),u_normalize_matrix:new r.a7(d),u_globe_matrix:new r.a7(d),u_merc_matrix:new r.a7(d),u_grid_matrix:new r.as(d),u_tl_parent:new r.a9(d),u_scale_parent:new r.ab(d),u_fade_t:new r.ab(d),u_opacity:new r.ab(d),u_image0:new r.a8(d),u_image1:new r.a8(d),u_raster_elevation:new r.ab(d),u_zoom_transition:new r.ab(d),u_merc_center:new r.a9(d),u_cutoff_params:new r.at(d)}),rasterParticleTexture:d=>({u_texture:new r.a8(d),u_opacity:new r.ab(d)}),rasterParticleDraw:d=>({u_particle_texture:new r.a8(d),u_particle_texture_side_len:new r.ab(d),u_tile_offset:new r.a9(d),u_velocity:new r.a8(d),u_color_ramp:new r.a8(d),u_velocity_res:new r.a9(d),u_max_speed:new r.ab(d),u_uv_offset:new r.a9(d),u_data_scale:new r.a9(d),u_data_offset:new r.ab(d),u_particle_pos_scale:new r.ab(d),u_particle_pos_offset:new r.a9(d)}),rasterParticleUpdate:d=>({u_particle_texture:new r.a8(d),u_particle_texture_side_len:new r.ab(d),u_velocity:new r.a8(d),u_velocity_res:new r.a9(d),u_max_speed:new r.ab(d),u_speed_factor:new r.ab(d),u_reset_rate:new r.ab(d),u_rand_seed:new r.ab(d),u_uv_offset:new r.a9(d),u_data_scale:new r.a9(d),u_data_offset:new r.ab(d),u_particle_pos_scale:new r.ab(d),u_particle_pos_offset:new r.a9(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new r.a8(d),u_is_size_feature_constant:new r.a8(d),u_size_t:new r.ab(d),u_size:new r.ab(d),u_camera_to_center_distance:new r.ab(d),u_rotate_symbol:new r.a8(d),u_aspect_ratio:new r.ab(d),u_fade_change:new r.ab(d),u_matrix:new r.a7(d),u_label_plane_matrix:new r.a7(d),u_coord_matrix:new r.a7(d),u_is_text:new r.a8(d),u_pitch_with_map:new r.a8(d),u_texsize:new r.a9(d),u_tile_id:new r.ar(d),u_zoom_transition:new r.ab(d),u_inv_rot_matrix:new r.a7(d),u_merc_center:new r.a9(d),u_camera_forward:new r.ar(d),u_tile_matrix:new r.a7(d),u_up_vector:new r.ar(d),u_ecef_origin:new r.ar(d),u_texture:new r.a8(d),u_icon_transition:new r.ab(d),u_color_adj_mat:new r.a7(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new r.a8(d),u_is_size_feature_constant:new r.a8(d),u_size_t:new r.ab(d),u_size:new r.ab(d),u_camera_to_center_distance:new r.ab(d),u_rotate_symbol:new r.a8(d),u_aspect_ratio:new r.ab(d),u_fade_change:new r.ab(d),u_matrix:new r.a7(d),u_label_plane_matrix:new r.a7(d),u_coord_matrix:new r.a7(d),u_is_text:new r.a8(d),u_pitch_with_map:new r.a8(d),u_texsize:new r.a9(d),u_texture:new r.a8(d),u_gamma_scale:new r.ab(d),u_device_pixel_ratio:new r.ab(d),u_tile_id:new r.ar(d),u_zoom_transition:new r.ab(d),u_inv_rot_matrix:new r.a7(d),u_merc_center:new r.a9(d),u_camera_forward:new r.ar(d),u_tile_matrix:new r.a7(d),u_up_vector:new r.ar(d),u_ecef_origin:new r.ar(d),u_is_halo:new r.a8(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new r.a8(d),u_is_size_feature_constant:new r.a8(d),u_size_t:new r.ab(d),u_size:new r.ab(d),u_camera_to_center_distance:new r.ab(d),u_rotate_symbol:new r.a8(d),u_aspect_ratio:new r.ab(d),u_fade_change:new r.ab(d),u_matrix:new r.a7(d),u_label_plane_matrix:new r.a7(d),u_coord_matrix:new r.a7(d),u_is_text:new r.a8(d),u_pitch_with_map:new r.a8(d),u_texsize:new r.a9(d),u_texsize_icon:new r.a9(d),u_texture:new r.a8(d),u_texture_icon:new r.a8(d),u_gamma_scale:new r.ab(d),u_device_pixel_ratio:new r.ab(d),u_is_halo:new r.a8(d)}),background:d=>({u_matrix:new r.a7(d),u_emissive_strength:new r.ab(d),u_opacity:new r.ab(d),u_color:new r.aa(d)}),backgroundPattern:d=>({u_matrix:new r.a7(d),u_emissive_strength:new r.ab(d),u_opacity:new r.ab(d),u_image:new r.a8(d),u_pattern_tl:new r.a9(d),u_pattern_br:new r.a9(d),u_texsize:new r.a9(d),u_pattern_size:new r.a9(d),u_pixel_coord_upper:new r.a9(d),u_pixel_coord_lower:new r.a9(d),u_tile_units_to_pixels:new r.ab(d)}),terrainRaster:d=>({u_matrix:new r.a7(d),u_image0:new r.a8(d),u_skirt_height:new r.ab(d),u_ground_shadow_factor:new r.ar(d)}),skybox:d=>({u_matrix:new r.a7(d),u_sun_direction:new r.ar(d),u_cubemap:new r.a8(d),u_opacity:new r.ab(d),u_temporal_offset:new r.ab(d)}),skyboxGradient:d=>({u_matrix:new r.a7(d),u_color_ramp:new r.a8(d),u_center_direction:new r.ar(d),u_radius:new r.ab(d),u_opacity:new r.ab(d),u_temporal_offset:new r.ab(d)}),skyboxCapture:d=>({u_matrix_3f:new r.as(d),u_sun_direction:new r.ar(d),u_sun_intensity:new r.ab(d),u_color_tint_r:new r.at(d),u_color_tint_m:new r.at(d),u_luminance:new r.ab(d)}),globeRaster:d=>({u_proj_matrix:new r.a7(d),u_globe_matrix:new r.a7(d),u_normalize_matrix:new r.a7(d),u_merc_matrix:new r.a7(d),u_zoom_transition:new r.ab(d),u_merc_center:new r.a9(d),u_image0:new r.a8(d),u_grid_matrix:new r.as(d),u_skirt_height:new r.ab(d),u_far_z_cutoff:new r.ab(d),u_frustum_tl:new r.ar(d),u_frustum_tr:new r.ar(d),u_frustum_br:new r.ar(d),u_frustum_bl:new r.ar(d),u_globe_pos:new r.ar(d),u_globe_radius:new r.ab(d),u_viewport:new r.a9(d)}),globeAtmosphere:d=>({u_frustum_tl:new r.ar(d),u_frustum_tr:new r.ar(d),u_frustum_br:new r.ar(d),u_frustum_bl:new r.ar(d),u_horizon:new r.ab(d),u_transition:new r.ab(d),u_fadeout_range:new r.ab(d),u_color:new r.at(d),u_high_color:new r.at(d),u_space_color:new r.at(d),u_temporal_offset:new r.ab(d),u_horizon_angle:new r.ab(d)}),model:d=>({u_matrix:new r.a7(d),u_lighting_matrix:new r.a7(d),u_normal_matrix:new r.a7(d),u_node_matrix:new r.a7(d),u_lightpos:new r.ar(d),u_lightintensity:new r.ab(d),u_lightcolor:new r.ar(d),u_camera_pos:new r.ar(d),u_opacity:new r.ab(d),u_baseColorFactor:new r.at(d),u_emissiveFactor:new r.at(d),u_metallicFactor:new r.ab(d),u_roughnessFactor:new r.ab(d),u_baseTextureIsAlpha:new r.a8(d),u_alphaMask:new r.a8(d),u_alphaCutoff:new r.ab(d),u_baseColorTexture:new r.a8(d),u_metallicRoughnessTexture:new r.a8(d),u_normalTexture:new r.a8(d),u_occlusionTexture:new r.a8(d),u_emissionTexture:new r.a8(d),u_lutTexture:new r.a8(d),u_color_mix:new r.at(d),u_aoIntensity:new r.ab(d),u_emissive_strength:new r.ab(d),u_occlusionTextureTransform:new r.at(d)}),modelDepth:d=>({u_matrix:new r.a7(d),u_instance:new r.a7(d),u_node_matrix:new r.a7(d)}),groundShadow:d=>({u_matrix:new r.a7(d),u_ground_shadow_factor:new r.ar(d)}),stars:d=>({u_matrix:new r.a7(d),u_up:new r.ar(d),u_right:new r.ar(d),u_intensity_multiplier:new r.ab(d)}),occlusion:d=>({u_matrix:new r.a7(d),u_anchorPos:new r.ar(d),u_screenSizePx:new r.a9(d),u_occluderSizePx:new r.a9(d),u_color:new r.at(d)})};function Vs(d,i,a){let f=i.createTileMatrix(d,d.worldSize,a.toUnwrapped());return r.ae.multiply(new Float32Array(16),d.projMatrix,f)}function Lm(d,i,a){if(i.projection.name===a.projection.name)return d.projMatrix;let f=a.clone();return f.setProjection(i.projection),Vs(f,i.getProjection(),d)}function of(d,i,a){return i.name===a.projection.name?d.projMatrix:Vs(a,i,d)}let ja;function km(d,i,a,f,_,v,w){let E=d.context,D=E.gl,C=d.transform,P=d.getOrCreateProgram("collisionBox"),O=[],F=0,z=0;for(let Q=0;Q<f.length;Q++){let se=f[Q],te=i.getTile(se),ne=te.getBucket(a);if(!ne)continue;let ce=Lm(se,ne,C),he=ce;_[0]===0&&_[1]===0||(he=d.translatePosMatrix(ce,te,_,v));let xe=w?ne.textCollisionBox:ne.iconCollisionBox,de=ne.collisionCircleArray;if(de.length>0){let oe=r.ae.create(),Me=he;r.ae.mul(oe,ne.placementInvProjMatrix,C.glCoordMatrix),r.ae.mul(oe,oe,ne.placementViewportMatrix),O.push({circleArray:de,circleOffset:z,transform:Me,invTransform:oe,projection:ne.getProjection()}),F+=de.length/4,z=F}xe&&(d.terrain&&d.terrain.setupElevationDraw(te,P),P.draw(d,D.LINES,r.af.disabled,r.ah.disabled,d.colorModeForRenderPass(),r.ag.disabled,za(he,C,te,ne.getProjection()),a.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,null,C.zoom,null,[xe.collisionVertexBuffer,xe.collisionVertexBufferExt]))}if(!w||!O.length)return;let U=d.getOrCreateProgram("collisionCircle"),$=new r.bN;$.resize(4*F),$._trim();let G=0;for(let Q of O)for(let se=0;se<Q.circleArray.length/4;se++){let te=4*se,ne=Q.circleArray[te+0],ce=Q.circleArray[te+1],he=Q.circleArray[te+2],xe=Q.circleArray[te+3];$.emplace(G++,ne,ce,he,xe,0),$.emplace(G++,ne,ce,he,xe,1),$.emplace(G++,ne,ce,he,xe,2),$.emplace(G++,ne,ce,he,xe,3)}(!ja||ja.length<2*F)&&(ja=function(Q){let se=2*Q,te=new r.bw;te.resize(se),te._trim();for(let ne=0;ne<se;ne++){let ce=6*ne;te.uint16[ce+0]=4*ne+0,te.uint16[ce+1]=4*ne+1,te.uint16[ce+2]=4*ne+2,te.uint16[ce+3]=4*ne+2,te.uint16[ce+4]=4*ne+3,te.uint16[ce+5]=4*ne+0}return te}(F));let H=E.createIndexBuffer(ja,!0),K=E.createVertexBuffer($,r.bO.members,!0);for(let Q of O){let se={u_matrix:Q.transform,u_inv_matrix:Q.invTransform,u_camera_to_center_distance:(J=C).getCameraToCenterDistance(Q.projection),u_viewport_size:[J.width,J.height]};U.draw(d,D.TRIANGLES,r.af.disabled,r.ah.disabled,d.colorModeForRenderPass(),r.ag.disabled,se,a.id,K,H,r.b.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,C.zoom)}var J;K.destroy(),H.destroy()}let lc=r.ae.create();function Fm(d){let i=d._camera.getWorldToCamera(d.worldSize,1),a=r.ae.multiply([],i,d.globeMatrix);r.ae.invert(a,a);let f=[0,0,0],_=[0,1,0,0];return r.aB.transformMat4(_,_,a),f[0]=_[0],f[1]=_[1],f[2]=_[2],r.$.normalize(f,f),f}function Nm({width:d,height:i,anchor:a,textOffset:f,textScale:_},v){let{horizontalAlign:w,verticalAlign:E}=r.bS(a),D=-(w-.5)*d,C=-(E-.5)*i,P=r.bR(a,f);return new r.P((D/_+P[0])*v,(C/_+P[1])*v)}function h0(d,i,a,f,_,v,w,E,D,C,P){let O=d.text.placedSymbolArray,F=d.text.dynamicLayoutVertexArray,z=d.icon.dynamicLayoutVertexArray,U={},$=d.getProjection(),G=of(E,$,v),H=v.elevation,K=$.upVectorScale(E.canonical,v.center.lat,v.worldSize).metersToTile;F.clear();for(let J=0;J<O.length;J++){let Q=O.get(J),{tileAnchorX:se,tileAnchorY:te,numGlyphs:ne}=Q,ce=Q.hidden||!Q.crossTileID||d.allowVerticalPlacement&&!Q.placedOrientation?null:f[Q.crossTileID];if(ce){let he=0,xe=0,de=0;if(H){let fe=H?H.getAtTileOffset(E,se,te):0,[Ne,Be,Ke]=$.upVector(E.canonical,se,te);he=fe*Ne*K,xe=fe*Be*K,de=fe*Ke*K}let[oe,Me,Ee,me]=Wi(Q.projectedAnchorX+he,Q.projectedAnchorY+xe,Q.projectedAnchorZ+de,a?G:w),je=jt(v.getCameraToCenterDistance($),me),Fe=_.evaluateSizeForFeature(d.textSizeData,C,Q)*je/r.bP;a&&(Fe*=d.tilePixelRatio/D);let be=Nm(ce,Fe);a?({x:oe,y:Me,z:Ee}=$.projectTilePoint(se+be.x,te+be.y,E.canonical),[oe,Me,Ee]=Wi(oe+he,Me+xe,Ee+de,w)):(i&&be._rotate(-v.angle),oe+=be.x,Me+=be.y,Ee=0);let Ae=d.allowVerticalPlacement&&Q.placedOrientation===r.aF.vertical?Math.PI/2:0;for(let fe=0;fe<ne;fe++)r.aI(F,oe,Me,Ee,Ae);P&&Q.associatedIconIndex>=0&&(U[Q.associatedIconIndex]={x:oe,y:Me,z:Ee,angle:Ae})}else zs(ne,F)}if(P){z.clear();let J=d.icon.placedSymbolArray;for(let Q=0;Q<J.length;Q++){let se=J.get(Q),{numGlyphs:te}=se,ne=U[Q];if(se.hidden||!ne)zs(te,z);else{let{x:ce,y:he,z:xe,angle:de}=ne;for(let oe=0;oe<te;oe++)r.aI(z,ce,he,xe,de)}}d.icon.dynamicLayoutVertexBuffer.updateData(z)}d.text.dynamicLayoutVertexBuffer.updateData(F)}function cc(d,i,a,f,_,v,w={}){let E=a.paint.get("icon-translate"),D=a.paint.get("text-translate"),C=a.paint.get("icon-translate-anchor"),P=a.paint.get("text-translate-anchor"),O=a.layout.get("icon-rotation-alignment"),F=a.layout.get("text-rotation-alignment"),z=a.layout.get("icon-pitch-alignment"),U=a.layout.get("text-pitch-alignment"),$=a.layout.get("icon-keep-upright"),G=a.layout.get("text-keep-upright"),H=a.paint.get("icon-color-saturation"),K=a.paint.get("icon-color-contrast"),J=a.paint.get("icon-color-brightness-min"),Q=a.paint.get("icon-color-brightness-max");a.paint.get("icon-occlusion-opacity").constantOr(0),a.paint.get("text-occlusion-opacity").constantOr(0);let se=d.context,te=se.gl,ne=d.transform,ce=O==="map",he=F==="map",xe=z==="map",de=U==="map",oe=a.layout.get("symbol-sort-key").constantOr(1)!==void 0,Me=!1,Ee=d.depthModeForSublayer(0,r.af.ReadOnly),me=[r.ak(ne.center.lng),r.al(ne.center.lat)],je=a.layout.get("text-variable-anchor"),Fe=ne.projection.name==="globe",be=[],Ae=[0,-1,0];for(let fe of f){let Ne=i.getTile(fe),Be=Ne.getBucket(a);if(!Be||Be.projection.name==="mercator"&&Fe||Be.fullyClipped)continue;let Ke=Be.projection.name==="globe",et=Ke?r.a2(ne.zoom):0,at=of(fe,Be.getProjection(),ne),nt=ne.calculatePixelsToTileUnitsMatrix(Ne),mt=je&&Be.hasTextData(),At=Be.hasIconTextFit()&&mt&&Be.hasIconData(),_t=Be.getProjection().createInversionMatrix(ne,fe.canonical),kt=tn=>{ne.depthOcclusionForSymbolsAndCircles&&(a.hasInitialOcclusionOpacityProperties||d.terrain)&&(tn.push("DEPTH_D24"),tn.push("DEPTH_OCCLUSION"))},Ht=()=>{let tn=ce&&a.layout.get("symbol-placement")!=="point",Ut=[];kt(Ut);let xt=tn||At,ir=a.paint.get("icon-image-cross-fade").constantOr(0);d.terrainRenderModeElevated()&&xe&&Ut.push("PITCH_WITH_MAP_TERRAIN"),Ke&&(Ut.push("PROJECTION_GLOBE_VIEW"),xt&&Ut.push("PROJECTED_POS_ON_VIEWPORT")),ir>0&&Ut.push("ICON_TRANSITION"),Be.icon.zOffsetVertexBuffer&&Ut.push("Z_OFFSET"),H===0&&K===0&&J===0&&Q===1||Ut.push("COLOR_ADJUSTMENT");let or=Be.icon.programConfigurations.get(a.id),zr=d.getOrCreateProgram(Be.sdfIcons?"symbolSDF":"symbolIcon",{config:or,defines:Ut}),Br,Ir=Ne.imageAtlasTexture?Ne.imageAtlasTexture.size:[0,0],jr=Be.iconSizeData,yr=r.aE(jr,ne.zoom),Mr=xe||ne.pitch!==0,He=Zl(at,Ne.tileID.canonical,xe,ce,ne,Be.getProjection(),nt),ct=Ou(at,Ne.tileID.canonical,xe,ce,ne,Be.getProjection(),nt),Yr=d.translatePosMatrix(ct,Ne,E,C,!0),Rn=d.translatePosMatrix(at,Ne,E,C),Ie=xt?lc:He,Po=ce&&!xe&&!tn,Yi=Ae;!Fe&&!ne.mercatorFromTransition||ce||(Yi=Fm(ne));let Ro=Ke?Yi:Ae;if(Be.sdfIcons&&!Be.iconsInText)Br=ac(jr.kind,yr,Po,xe,d,Rn,Ie,Yr,!1,Ir,!0,fe,et,me,_t,Ro,Be.getProjection());else{let Ys=a.getColorAdjustmentMatrix(H,K,J,Q);Br=Ba(jr.kind,yr,Po,xe,d,Rn,Ie,Yr,!1,Ir,fe,et,me,_t,Ro,Be.getProjection(),Ys,ir)}let Oo=Ne.imageAtlasTexture?Ne.imageAtlasTexture:null,ph=a.layout.get("icon-size").constantOr(0)!==1||Be.iconsNeedLinear,mh=Be.sdfIcons||d.options.rotating||d.options.zooming||ph||Mr?te.LINEAR:te.NEAREST,hs=Be.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,Pf=d.terrain&&xe&&tn?r.ae.invert(r.ae.create(),He):lc;if(tn&&Be.icon){let Ys=ne.elevation,gh=Ys?Ys.getAtTileOffsetFunc(fe,ne.center.lat,ne.worldSize,Be.getProjection()):null,Ka=Ru(at,Ne.tileID.canonical,xe,ce,ne,Be.getProjection(),nt);La(Be,at,d,!1,Ka,ct,xe,$,gh,fe)}return{program:zr,buffers:Be.icon,uniformValues:Br,atlasTexture:Oo,atlasTextureIcon:null,atlasInterpolation:mh,atlasInterpolationIcon:null,isSDF:Be.sdfIcons,hasHalo:hs,tile:Ne,labelPlaneMatrixInv:Pf}},kn=()=>{let tn=he&&a.layout.get("symbol-placement")!=="point",Ut=[],xt=tn||je||At;d.terrainRenderModeElevated()&&de&&Ut.push("PITCH_WITH_MAP_TERRAIN"),Ke&&(Ut.push("PROJECTION_GLOBE_VIEW"),xt&&Ut.push("PROJECTED_POS_ON_VIEWPORT")),Be.text.zOffsetVertexBuffer&&Ut.push("Z_OFFSET"),kt(Ut);let ir=Be.text.programConfigurations.get(a.id),or=d.getOrCreateProgram(Be.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:ir,defines:Ut}),zr,Br=[0,0],Ir=null,jr=Be.textSizeData;Be.iconsInText&&(Br=Ne.imageAtlasTexture?Ne.imageAtlasTexture.size:[0,0],Ir=Ne.imageAtlasTexture?Ne.imageAtlasTexture:null,zr=de||ne.pitch!==0||d.options.rotating||d.options.zooming||jr.kind==="composite"||jr.kind==="camera"?te.LINEAR:te.NEAREST);let yr=Ne.glyphAtlasTexture?Ne.glyphAtlasTexture.size:[0,0],Mr=r.aE(jr,ne.zoom),He=Zl(at,Ne.tileID.canonical,de,he,ne,Be.getProjection(),nt),ct=Ou(at,Ne.tileID.canonical,de,he,ne,Be.getProjection(),nt),Yr=d.translatePosMatrix(ct,Ne,D,P,!0),Rn=d.translatePosMatrix(at,Ne,D,P),Ie=xt?lc:He,Po=he&&!de&&!tn,Yi=Ae;!Fe&&!ne.mercatorFromTransition||he||(Yi=Fm(ne));let Ro=Ke?Yi:Ae,Oo;Oo=Be.iconsInText?tf(jr.kind,Mr,Po,de,d,Rn,Ie,Yr,yr,Br,fe,et,me,_t,Ro,Be.getProjection()):ac(jr.kind,Mr,Po,de,d,Rn,Ie,Yr,!0,yr,!0,fe,et,me,_t,Ro,Be.getProjection());let ph=Ne.glyphAtlasTexture?Ne.glyphAtlasTexture:null,mh=te.LINEAR,hs=a.paint.get("text-halo-width").constantOr(1)!==0,Pf=d.terrain&&de&&tn?r.ae.invert(r.ae.create(),He):lc;if(tn&&Be.text){let Ys=ne.elevation,gh=Ys?Ys.getAtTileOffsetFunc(fe,ne.center.lat,ne.worldSize,Be.getProjection()):null,Ka=Ru(at,Ne.tileID.canonical,de,he,ne,Be.getProjection(),nt);La(Be,at,d,!0,Ka,ct,de,G,gh,fe)}return{program:or,buffers:Be.text,uniformValues:Oo,atlasTexture:ph,atlasTextureIcon:Ir,atlasInterpolation:mh,atlasInterpolationIcon:zr,isSDF:!0,hasHalo:hs,tile:Ne,labelPlaneMatrixInv:Pf}},In=Be.icon.segments.get().length,Wt=Be.text.segments.get().length,Tn=In&&!w.onlyText?Ht():null,Bt=Wt&&!w.onlyIcons?kn():null,Vt=a.paint.get("icon-opacity").constantOr(1),Pt=a.paint.get("text-opacity").constantOr(1);if(oe&&Be.canOverlap){Me=!0;let tn=Vt&&!w.onlyText?Be.icon.segments.get():[],Ut=Pt&&!w.onlyIcons?Be.text.segments.get():[];for(let xt of tn)be.push({segments:new r.b([xt]),sortKey:xt.sortKey,state:Tn});for(let xt of Ut)be.push({segments:new r.b([xt]),sortKey:xt.sortKey,state:Bt})}else w.onlyText||be.push({segments:Vt?Be.icon.segments:new r.b([]),sortKey:0,state:Tn}),w.onlyIcons||be.push({segments:Pt?Be.text.segments:new r.b([]),sortKey:0,state:Bt})}Me&&be.sort((fe,Ne)=>fe.sortKey-Ne.sortKey);for(let fe of be){let Ne=fe.state;if(Ne)if(d.terrain?d.terrain.setupElevationDraw(Ne.tile,Ne.program,{useDepthForOcclusion:ne.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ne.labelPlaneMatrixInv}):d.setupDepthForOcclusion(ne.depthOcclusionForSymbolsAndCircles,Ne.program),se.activeTexture.set(te.TEXTURE0),Ne.atlasTexture&&Ne.atlasTexture.bind(Ne.atlasInterpolation,te.CLAMP_TO_EDGE,!0),Ne.atlasTextureIcon&&(se.activeTexture.set(te.TEXTURE1),Ne.atlasTextureIcon&&Ne.atlasTextureIcon.bind(Ne.atlasInterpolationIcon,te.CLAMP_TO_EDGE,!0)),d.uploadCommonLightUniforms(d.context,Ne.program),Ne.hasHalo){let Be=Ne.uniformValues;Be.u_is_halo=1,sf(Ne.buffers,fe.segments,a,d,Ne.program,Ee,_,v,Be,2),Be.u_is_halo=0}else{if(Ne.isSDF){let Be=Ne.uniformValues;Ne.hasHalo&&(Be.u_is_halo=1,sf(Ne.buffers,fe.segments,a,d,Ne.program,Ee,_,v,Be,1)),Be.u_is_halo=0}sf(Ne.buffers,fe.segments,a,d,Ne.program,Ee,_,v,Ne.uniformValues,1)}}}function sf(d,i,a,f,_,v,w,E,D,C){let P=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer];_.draw(f,f.context.gl.TRIANGLES,v,w,E,r.ag.disabled,D,a.id,d.layoutVertexBuffer,d.indexBuffer,i,a.paint,f.transform.zoom,d.programConfigurations.get(a.id),P,C)}function uc(d,i,a,f,_,v,w){let E=d.context.gl,D=a.paint.get("fill-pattern"),C=D&&D.constantOr(1),P,O,F,z,U;w?(O=C&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",P=E.LINES):(O=C?"fillPattern":"fill",P=E.TRIANGLES);for(let $ of f){let G=i.getTile($);if(C&&!G.patternsLoaded())continue;let H=G.getBucket(a);if(!H)continue;d.prepareDrawTile();let K=H.programConfigurations.get(a.id),J=d.isTileAffectedByFog($),Q=d.getOrCreateProgram(O,{config:K,overrideFog:J});C&&(d.context.activeTexture.set(E.TEXTURE0),G.imageAtlasTexture&&G.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),K.updatePaintBuffers());let se=D.constantOr(null);if(se&&G.imageAtlas){let ce=G.imageAtlas.patternPositions[se.toString()];ce&&K.setConstantPatternPositions(ce)}let te=d.translatePosMatrix($.projMatrix,G,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),ne=a.paint.get("fill-emissive-strength");if(w){z=H.indexBuffer2,U=H.segments2;let ce=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];F=O==="fillOutlinePattern"&&C?ic(te,ne,d,G,ce):Vu(te,ne,ce)}else z=H.indexBuffer,U=H.segments,F=C?ju(te,ne,d,G):rc(te,ne);d.uploadCommonUniforms(d.context,Q,$.toUnwrapped()),Q.draw(d,P,_,d.stencilModeForClipping($),v,r.ag.disabled,F,a.id,H.layoutVertexBuffer,z,U,a.paint,d.transform.zoom,K,void 0)}}function Us(d,i,a,f,_,v,w,E){a.resetLayerRenderingStats(d);let D=d.context,C=D.gl,P=d.transform,O=a.paint.get("fill-extrusion-pattern"),F=O.constantOr(1),z=a.paint.get("fill-extrusion-opacity"),U=d.style.enable3dLights(),$=a.paint.get(U&&!F?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),G=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),$],H=a.layout.get("fill-extrusion-edge-radius"),K=H>0&&!a.paint.get("fill-extrusion-rounded-roof"),J=K?0:H,Q=P.projection.name==="globe"?r.b_():0,se=P.projection.name==="globe",te=se?r.a2(P.zoom):0,ne=[r.ak(P.center.lng),r.al(P.center.lat)],ce=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(a.lut).toArray01().slice(0,3),he=a.paint.get("fill-extrusion-flood-light-intensity"),xe=a.paint.get("fill-extrusion-vertical-scale"),de=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,oe=ni(d,a.paint.get("fill-extrusion-cutoff-fade-range")),Me=a.paint.get("fill-extrusion-emissive-strength"),Ee=[];se&&Ee.push("PROJECTION_GLOBE_VIEW"),G[0]>0&&Ee.push("FAUX_AO"),K&&Ee.push("ZERO_ROOF_RADIUS"),E&&Ee.push("HAS_CENTROID"),he>0&&Ee.push("FLOOD_LIGHT"),oe.shouldRenderCutoff&&Ee.push("RENDER_CUTOFF"),de&&Ee.push("RENDER_WALL_MODE");let me=(()=>{let Ke=a.paint.get("fill-extrusion-line-alignment");switch(Ke){case"inside":return 1;case"outside":return-1;case"center":return 0;default:return r.w(`Unsupported value for fill-extrusion-line-alignment: ${Ke}`),0}})(),je,Fe=d.renderPass==="shadow",be=d.shadowRenderer,Ae=Fe&&!!be;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let fe=[0,0,0];if(be){let Ke=d.style.directionalLight,et=d.style.ambientLight;Ke&&et&&(fe=Kl(d.style,Ke,et)),je=Ee.concat(["SHADOWS_SINGLE_CASCADE"])}let Ne=Ae?"fillExtrusionDepth":F?"fillExtrusionPattern":"fillExtrusion",Be=a.getLayerRenderingStats();for(let Ke of f){let et=i.getTile(Ke),at=et.getBucket(a);if(!at||at.projection.name!==P.projection.name)continue;let nt=!1;be&&(nt=be.getMaxCascadeForTile(Ke.toUnwrapped())===0);let mt=d.isTileAffectedByFog(Ke),At=at.programConfigurations.get(a.id),_t=d.getOrCreateProgram(Ne,{config:At,defines:nt?je:Ee,overrideFog:mt});if(d.terrain&&d.terrain.setupElevationDraw(et,_t,{useMeterToDem:!0}),!at.centroidVertexBuffer){let Bt=_t.attributes.a_centroid_pos;Bt!==void 0&&C.vertexAttrib2f(Bt,0,0)}!Fe&&be&&be.setupShadows(et.tileID.toUnwrapped(),_t,"vector-tile",et.tileID.overscaledZ),F&&(d.context.activeTexture.set(C.TEXTURE0),et.imageAtlasTexture&&et.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),At.updatePaintBuffers());let kt=O.constantOr(null);if(kt&&et.imageAtlas){let Bt=et.imageAtlas.patternPositions[kt.toString()];Bt&&At.setConstantPatternPositions(Bt)}let Ht=a.paint.get("fill-extrusion-vertical-gradient"),kn=1/at.tileToMeter,In;if(Fe&&be){if(co(et.tileID,at,d))continue;let Bt=be.calculateShadowPassMatrixFromTile(et.tileID.toUnwrapped());In=Bu(Bt,J,me,kn,xe)}else{let Bt=d.translatePosMatrix(Ke.expandedProjMatrix,et,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Vt=P.projection.createInversionMatrix(P,Ke.canonical);In=F?Sm(Bt,d,Ht,z,G,J,me,kn,Ke,et,Q,te,ne,Vt,ce,xe):ao(Bt,d,Ht,z,G,J,me,kn,Ke,Q,te,ne,Vt,ce,xe,he,fe,Me)}d.uploadCommonUniforms(D,_t,Ke.toUnwrapped(),null,oe);let Wt=at.segments;if(P.projection.name==="mercator"&&!Fe&&(Wt=at.getVisibleSegments(et.tileID,d.terrain,d.transform.getFrustum(0)),!Wt.get().length))continue;if(Be)if(Fe)for(let Bt of Wt.get())Be.numRenderedVerticesInShadowPass+=Bt.primitiveLength;else for(let Bt of Wt.get())Be.numRenderedVerticesInTransparentPass+=Bt.primitiveLength;let Tn=[];(d.terrain||E)&&Tn.push(at.centroidVertexBuffer),se&&Tn.push(at.layoutVertexExtBuffer),de&&Tn.push(at.wallVertexBuffer),_t.draw(d,D.gl.TRIANGLES,_,v,w,r.ag.backCCW,In,a.id,at.layoutVertexBuffer,at.indexBuffer,Wt,a.paint,d.transform.zoom,At,Tn)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}function Va(d,i,a,f,_,v,w,E,D,C,P,O,F,z,U,$,G,H,K){let J=d.context,Q=J.gl,se=d.transform,te=d.transform.zoom,ne=[],ce=ni(d,a.paint.get("fill-extrusion-cutoff-fade-range"));C==="clear"?(ne.push("CLEAR_SUBPASS"),K&&(ne.push("CLEAR_FROM_TEXTURE"),J.activeTexture.set(Q.TEXTURE0),K.bind(Q.LINEAR,Q.CLAMP_TO_EDGE))):C==="sdf"&&ne.push("SDF_SUBPASS"),G&&ne.push("HAS_CENTROID"),ce.shouldRenderCutoff&&ne.push("RENDER_CUTOFF");let he=a.layout.get("fill-extrusion-edge-radius"),xe=(de,oe,Me,Ee,me)=>{let je=oe.programConfigurations.get(a.id),Fe=d.isTileAffectedByFog(de),be=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:je,defines:ne,overrideFog:Fe}),Ae=((Ne,Be,Ke,et,at,nt,mt,At,_t,kt,Ht)=>({u_matrix:Be,u_opacity:Ke,u_ao_pass:et?1:0,u_meter_to_tile:at,u_ao:nt,u_flood_light_intensity:mt,u_flood_light_color:At,u_attenuation:_t,u_edge_radius:kt,u_fb:0,u_fb_size:Ht}))(0,Ee,P,D,me,[O,F*me],z,U,$,te>=17?0:he*me,K?K.size[0]:0),fe=[];G&&fe.push(oe.hiddenByLandmarkVertexBuffer),d.uploadCommonUniforms(J,be,de.toUnwrapped(),null,ce),be.draw(d,J.gl.TRIANGLES,_,v,w,E,Ae,a.id,oe.vertexBuffer,oe.indexBuffer,Me,a.paint,te,je,fe)};for(let de of f){let oe=i.getTile(de),Me=oe.getBucket(a);if(!Me||Me.projection.name!==se.projection.name||!Me.groundEffect||Me.groundEffect&&!Me.groundEffect.hasData())continue;let Ee=Me.groundEffect,me=1/Me.tileToMeter;{let je=d.translatePosMatrix(de.projMatrix,oe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Fe=Ee.getDefaultSegment();xe(de,Ee,Fe,je,me)}if(H)for(let je=0;je<4;je++){let Fe=r.b$[je](de),be=i.getTile(Fe);if(!be)continue;let Ae=be.getBucket(a);if(!Ae||Ae.projection.name!==se.projection.name||!Ae.groundEffect||Ae.groundEffect&&!Ae.groundEffect.hasData())continue;let fe=Ae.groundEffect,Ne,Be;je===0?(Ne=[-r.a4,0,0],Be=1):je===1?(Ne=[r.a4,0,0],Be=0):je===2?(Ne=[0,-r.a4,0],Be=3):(Ne=[0,r.a4,0],Be=2);let Ke=fe.regionSegments[Be];if(!Ke)continue;let et=new Float32Array(16);r.ae.translate(et,de.projMatrix,Ne),xe(de,fe,Ke,d.translatePosMatrix(et,oe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),me)}}}function d0(d,i,a,f,_,v,w){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();let E=v?v.findDEMTileFor(a):null;if(!(E&&E.dem||w))return;let D=H=>new r.P(Math.ceil((H+r.c2)*r.c3),0),C=H=>{let K=i.getSource().minzoom,J=se=>{let te=i.getTileByID(se);if(te&&te.hasData())return te.getBucket(_)},Q=[0,-1,1];for(let se of Q){if(H.overscaledZ+se<K)continue;let te=J(H.calculateScaledKey(H.overscaledZ+se));if(te)return te}},P=[0,0,0],O=(H,K)=>(P[0]=Math.min(H.min.y,K.min.y),P[1]=Math.max(H.max.y,K.max.y),P[2]=r.a4-K.min.x>H.max.x?K.min.x-r.a4:H.max.x,P),F=(H,K)=>(P[0]=Math.min(H.min.x,K.min.x),P[1]=Math.max(H.max.x,K.max.x),P[2]=r.a4-K.min.y>H.max.y?K.min.y-r.a4:H.max.y,P),z=[(H,K)=>O(H,K),(H,K)=>O(K,H),(H,K)=>F(H,K),(H,K)=>F(K,H)],U=(H,K,J,Q,se,te,ne)=>{if(!v)return 0;let ce=[[te?J:H,te?H:J,0],[te?J:K,te?K:J,0]],he=ne<0?r.a4+ne:ne,xe=[te?he:(H+K)/2,te?(H+K)/2:he,0];return J===0&&ne<0||J!==0&&ne>0?v.getForTilePoints(se,[xe],!0,Q):ce.push(xe),v.getForTilePoints(a,ce,!0,E),Math.max(ce[0][2],ce[1][2],xe[2])/v.exaggeration()};for(let H=0;H<4;H++){let K=f.borderFeatureIndices[H];if(K.length===0)continue;let J=r.b$[H](a),Q=C(J);if(!(Q&&Q instanceof r.c0)||f.borderDoneWithNeighborZ[H]===Q.canonical.z)continue;Q.centroidVertexArray.length===0&&Q.createCentroidsBuffer();let se=v?v.findDEMTileFor(J):null;if(!(se&&se.dem||w))continue;let te=(H<2?1:5)-H,ne=Q.borderDoneWithNeighborZ[te]!==f.canonical.z,ce=Q.borderFeatureIndices[te],he=0;if(f.canonical.z!==Q.canonical.z){for(let xe of K)f.showCentroid(f.featuresOnBorder[xe]);if(ne)for(let xe of ce)Q.showCentroid(Q.featuresOnBorder[xe]);f.borderDoneWithNeighborZ[H]=Q.canonical.z,Q.borderDoneWithNeighborZ[te]=f.canonical.z}for(let xe of K){let de=f.featuresOnBorder[xe],oe=f.centroidData[de.centroidDataIndex],Me=de.borders[H],Ee;for(;he<ce.length;){Ee=Q.featuresOnBorder[ce[he]];let me=Ee.borders[te];if(me[1]>Me[0]+3||me[0]>Me[0]-3)break;Q.showCentroid(Ee),he++}if(Ee&&he<ce.length){let me=he,je=0;for(;!(Ee.borders[te][0]>Me[1]-3)&&(je++,++he!==ce.length);)Ee=Q.featuresOnBorder[ce[he]];if(Ee=Q.featuresOnBorder[ce[me]],je>1){let Ae=Ee.borders[te];Math.abs(Me[0]-Ae[0])<3&&Math.abs(Me[1]-Ae[1])<3&&(je=1,he=me+1)}else if(je===0){f.showCentroid(de);continue}let Fe=Q.centroidData[Ee.centroidDataIndex];w&&je===1&&((($=oe).flags|(G=Fe).flags)&r.c1?($.flags|=r.c1,G.flags|=r.c1):($.flags&=~r.c1,G.flags&=~r.c1));let be=de.intersectsCount()>1||Ee.intersectsCount()>1;if(je>1)he=me,oe.centroidXY=Fe.centroidXY=new r.P(0,0);else if(se&&se.dem&&!be){let Ae=z[H](oe,Fe),fe=H%2?r.a4-1:0,Ne=U(Ae[0],Math.min(r.a4-1,Ae[1]),fe,se,J,H<2,Ae[2]);oe.centroidXY=Fe.centroidXY=D(Ne)}else be?oe.centroidXY=Fe.centroidXY=new r.P(0,0):(oe.centroidXY=f.encodeBorderCentroid(de),Fe.centroidXY=Q.encodeBorderCentroid(Ee));f.writeCentroidToBuffer(oe),Q.writeCentroidToBuffer(Fe)}else f.showCentroid(de)}f.borderDoneWithNeighborZ[H]=Q.canonical.z,Q.borderDoneWithNeighborZ[te]=f.canonical.z}var $,G;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(d)}let zm=[1,0,0],f0=[0,1,0],Gu=[0,0,1];function co(d,i,a){let f=a.transform,_=a.shadowRenderer;if(!_)return!0;let v=d.toUnwrapped(),w=f.tileSize*_._cascades[a.currentShadowCascade].scale,E=i.maxHeight;if(f.elevation){let $=f.elevation.getMinMaxForTile(d);$&&(E+=$.max)}let D=[..._.shadowDirection];D[2]=-D[2];let C=_.computeSimplifiedTileShadowVolume(v,E,w,D);if(!C)return!1;let P=[zm,f0,Gu,D,[D[0],0,D[2]],[0,D[1],D[2]]],O=f.projection.name==="globe",F=f.scaleZoom(w),z=r.aM.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,F,!O),U=_.getCurrentCascadeFrustum();return z.intersectsPrecise(C.vertices,C.planes,P)===0||U.intersectsPrecise(C.vertices,C.planes,P)===0}function hc(d){return[d[0]*r.c4,d[1]*r.c4,d[2]*r.c4,0]}function Hu(d,i,a,f,_,v,w,E,D){let C=f.getSource(),P=a.globeSharedBuffers;if(!P)return;let O,F,z;if(i&&(O=f.getTile(i)),C instanceof r.bo?(F=C.texture,z=r.bj(0,0,a.transform)):O&&i&&(F=O.texture,z=r.bj(i.canonical.z,i.canonical.x,a.transform)),!F||!z)return;d||(z=r.ae.scale(r.ae.create(),z,[1,-1,1]));let U=a.context,$=U.gl,G=_.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR,H=a.colorModeForDrapableLayerRenderPass(v),K=w.defines;K.push("GLOBE_POLES");let J=new r.af($.LEQUAL,r.af.ReadWrite,a.depthRangeFor3D),Q=Float32Array.from(a.transform.expandedFarZProjMatrix),se=Float32Array.from(r.bh(r.bi(new r.aO(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),U.activeTexture.set($.TEXTURE0),F.bind(G,$.CLAMP_TO_EDGE),U.activeTexture.set($.TEXTURE1),F.bind(G,$.CLAMP_TO_EDGE),F.useMipmap&&U.extTextureFilterAnisotropic&&a.transform.pitch>20&&$.texParameterf($.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);let[te,ne,ce,he]=i?P.getPoleBuffers(i.canonical.z,!1):P.getPoleBuffers(0,!0),xe=_.paint.get("raster-elevation"),de;d?(de=te,a.renderDefaultNorthPole=xe!==0):(de=ne,a.renderDefaultSouthPole=xe!==0);let oe=hc(w.mix),Me=((me,je,Fe,be,Ae,fe,Ne,Be,Ke,et,at,nt,mt)=>$u(me,je,Fe,new Float32Array(16),new Float32Array(9),[0,0],be,[0,0],[0,0,0,0],1,{opacity:1,mix:0},fe,[0,0],Be,2,et,at,nt,1,0,mt))(Q,se,z,r.a2(a.transform.zoom),0,_,0,xe,0,oe,w.offset,w.range,v),Ee=a.getOrCreateProgram("raster",{defines:K});a.uploadCommonUniforms(U,Ee,null),Ee.draw(a,$.TRIANGLES,J,D,H,E,Me,_.id,de,ce,he)}function af(d){let i=d._nearZ,a=d.projection.farthestPixelDistance(d),f=a-i,_=.2*d.height,v=i+_;return[i,a,(v-_-i)/f,(v-i)/f]}function $s(d,i,a,f){if(d)return i instanceof os&&d instanceof r.c5?i.getTextureDescriptor(d,a,!0):{texture:d.texture,mix:hc(f.mix),offset:f.offset,buffer:0,tileSize:1}}function Bm(d,i,a){if(!d)return null;let f=i.getTextureDescriptor(d,a,!0);if(!f)return null;let{texture:_,mix:v,offset:w,tileSize:E,buffer:D,format:C}=f;if(!_||!C)return null;let P=!1;return C==="uint32"&&(P=!0,v[3]=0,v=Jd(r.c6,v,[0,a.paint.get("raster-particle-max-speed")]),w=oc(r.c6,w,[0,a.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[D/(E+2*D),E/(E+2*D)],tileSize:E,scalarData:P,scale:v,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[C]]}}function qu(d){let i=d._nearZ,a=d.projection.farthestPixelDistance(d),f=a-i,_=.2*d.height,v=i+_;return[i,a,(v-_-i)/f,(v-i)/f]}let lf=new r.C(1,0,0,1),Wu=new r.C(0,1,0,1),cf=new r.C(0,0,1,1),hn=new r.C(1,0,1,1),p0=new r.C(0,1,1,1);function gt(d,i,a,f,_,v,w){let E=d.context,D=d.transform,C=E.gl,P=D.projection.name==="globe",O=P?["PROJECTION_GLOBE_VIEW"]:[],F=r.ae.clone(a.projMatrix);if(P&&r.a2(D.zoom)>0){let oe=r.c7(a.canonical,D),Me=r.c8(oe);F=r.ae.multiply(new Float32Array(16),D.globeMatrix,Me),r.ae.multiply(F,D.projMatrix,F)}let z=r.ae.create();z[12]+=2*_/(r.e.devicePixelRatio*D.width),z[13]+=2*v/(r.e.devicePixelRatio*D.height),r.ae.multiply(F,z,F);let U=d.getOrCreateProgram("debug",{defines:O}),$=i.getTileByID(a.key);d.terrain&&d.terrain.setupElevationDraw($,U);let G=r.af.disabled,H=r.ah.disabled,K=d.colorModeForRenderPass(),J="$debug";E.activeTexture.set(C.TEXTURE0),d.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),P?$._makeGlobeTileDebugBuffers(d.context,D):$._makeDebugTileBoundsBuffers(d.context,D.projection);let Q=$._tileDebugBuffer||d.debugBuffer,se=$._tileDebugIndexBuffer||d.debugIndexBuffer,te=$._tileDebugSegments||d.debugSegments;if(U.draw(d,C.LINE_STRIP,G,H,K,r.ag.disabled,Uu(F,f),J,Q,se,te,null,null,null,[$._globeTileDebugBorderBuffer]),w){let oe=$.latestRawTileData,Me=Math.floor((oe&&oe.byteLength||0)/1024),Ee=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Ee+=` => ${a.overscaledZ}`),Ee+=` ${$.state}`,Ee+=` ${Me}kb`,function(me,je){me.initDebugOverlayCanvas();let Fe=me.debugOverlayCanvas,be=me.context.gl,Ae=me.debugOverlayCanvas.getContext("2d");Ae.clearRect(0,0,Fe.width,Fe.height),Ae.shadowColor="white",Ae.shadowBlur=2,Ae.lineWidth=1.5,Ae.strokeStyle="white",Ae.textBaseline="top",Ae.font="bold 36px Open Sans, sans-serif",Ae.fillText(je,5,5),Ae.strokeText(je,5,5),me.debugOverlayTexture.update(Fe),me.debugOverlayTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE)}(d,Ee)}let ne=i.getTile(a).tileSize,ce=512/Math.min(ne,512)*(a.overscaledZ/D.zoom)*.5,he=$._tileDebugTextBuffer||d.debugBuffer,xe=$._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,de=$._tileDebugTextSegments||d.debugSegments;U.draw(d,C.TRIANGLES,G,H,r.a.alphaBlended,r.ag.disabled,Uu(F,r.C.transparent,ce),J,he,xe,de,null,null,null,[$._globeTileDebugTextBuffer])}function uf(d,i,a,f){Ua(d,0,i+a/2,d.transform.width,a,f)}function dc(d,i,a,f){Ua(d,i-a/2,0,a,d.transform.height,f)}function Ua(d,i,a,f,_,v){let w=d.context,E=w.gl;E.enable(E.SCISSOR_TEST),E.scissor(i*r.e.devicePixelRatio,a*r.e.devicePixelRatio,f*r.e.devicePixelRatio,_*r.e.devicePixelRatio),w.clear({color:v}),E.disable(E.SCISSOR_TEST)}let uo=r.c9([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:hf}=uo;function mi(d,i,a,f){d.emplaceBack(i,a,f)}class st{constructor(i){this.vertexArray=new r.ca,this.indices=new r.bw,mi(this.vertexArray,-1,-1,1),mi(this.vertexArray,1,-1,1),mi(this.vertexArray,-1,1,1),mi(this.vertexArray,1,1,1),mi(this.vertexArray,-1,-1,-1),mi(this.vertexArray,1,-1,-1),mi(this.vertexArray,-1,1,-1),mi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,hf),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=r.b.simpleSegment(0,0,36,12)}}function Kt(d,i,a,f,_,v){let w=d.context.gl,E=i.paint.get("sky-atmosphere-color"),D=i.paint.get("sky-atmosphere-halo-color"),C=i.paint.get("sky-atmosphere-sun-intensity"),P=((O,F,z,U,$)=>({u_matrix_3f:O,u_sun_direction:F,u_sun_intensity:z,u_color_tint_r:[U.r,U.g,U.b,U.a],u_color_tint_m:[$.r,$.g,$.b,$.a],u_luminance:5e-5}))(r.bE.fromMat4(r.bE.create(),f),_,C,E,D);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+v,i.skyboxTexture,0),a.draw(d,w.TRIANGLES,r.af.disabled,r.ah.disabled,r.a.unblended,r.ag.frontCW,P,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}let pn=r.c9([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ki{constructor(i){let a=new r.cb;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);let f=new r.bw;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(a,pn.members),this.indexBuffer=i.createIndexBuffer(f),this.segments=r.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let $a=r.c9([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class ln{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Zu{constructor(i){this.colorModeAlphaBlendedWriteRGB=new r.a([r.cc,r.cd,r.cc,r.cd],r.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new r.a([r.cc,r.ce,r.cc,r.ce],r.C.transparent,[!1,!1,!1,!0]),this.params=new ln,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){let a=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ki(a);let f=this.params.sizeRange,_=this.params.intensityRange,v=function(P){let O=r.ch(30),F=[];for(let z=0;z<P;++z){let U=2*Math.PI*O(),$=Math.acos(1-2*O())-.5*Math.PI;F.push(r.$.fromValues(Math.cos($)*Math.cos(U),Math.cos($)*Math.sin(U),Math.sin($)))}return F}(this.params.starsCount),w=r.ch(300),E=new r.cf,D=new r.bw,C=0;for(let P=0;P<v.length;++P){let O=r.$.scale([],v[P],200),F=Math.max(0,1+.01*f*(1*w()-.5)),z=Math.max(0,1+.01*_*(1*w()-.5));E.emplaceBack(O[0],O[1],O[2],-1,-1,F,z),E.emplaceBack(O[0],O[1],O[2],1,-1,F,z),E.emplaceBack(O[0],O[1],O[2],1,1,F,z),E.emplaceBack(O[0],O[1],O[2],-1,1,F,z),D.emplaceBack(C+0,C+1,C+2),D.emplaceBack(C+0,C+2,C+3),C+=4}this.starsVx=a.createVertexBuffer(E,$a.members),this.starsIdx=a.createIndexBuffer(D),this.starsSegments=r.b.simpleSegment(0,0,E.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,a){let f=i.context,_=f.gl,v=i.transform,w=new r.af(_.LEQUAL,r.af.ReadOnly,[0,1]),E=r.a2(v.zoom),D=i.style.getLut(a.scope),C=a.properties.get("color").toRenderColor(D).toArray01(),P=a.properties.get("high-color").toRenderColor(D).toArray01(),O=a.properties.get("space-color").toRenderColor(D).toArray01PremultipliedAlpha(),F=5e-4,z=r.cg(a.properties.get("horizon-blend"),0,1,F,.25),U=r.bc(i,f,v)&&z===F?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,$=i.frameCounter/1e3%1,G=r.$.length(v.globeCenterInViewSpace),H=Math.sqrt(Math.pow(G,2)-Math.pow(U,2)),K=Math.acos(H/G),J=Q=>{let se=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Q&&se.push("ALPHA_PASS");let te=i.getOrCreateProgram("globeAtmosphere",{defines:se}),ne=((he,xe,de,oe,Me,Ee,me,je,Fe,be,Ae,fe)=>({u_frustum_tl:he,u_frustum_tr:xe,u_frustum_br:de,u_frustum_bl:oe,u_horizon:Me,u_transition:Ee,u_fadeout_range:me,u_color:je,u_high_color:Fe,u_space_color:be,u_temporal_offset:Ae,u_horizon_angle:fe}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,E,z,C,P,O,$,K);i.uploadCommonUniforms(f,te);let ce=this.atmosphereBuffer;ce&&te.draw(i,_.TRIANGLES,w,r.ah.disabled,Q?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,r.ag.backCW,ne,Q?"atmosphere_glow_alpha":"atmosphere_glow",ce.vertexBuffer,ce.indexBuffer,ce.segments)};J(!1),J(!0)}drawStars(i,a){let f=r.au(a.properties.get("star-intensity"),0,1);if(f===0)return;let _=i.context,v=_.gl,w=i.transform,E=i.getOrCreateProgram("stars"),D=r.aw.identity([]);r.aw.rotateX(D,D,-w._pitch),r.aw.rotateZ(D,D,-w.angle),r.aw.rotateX(D,D,r.ac(w._center.lat)),r.aw.rotateY(D,D,-r.ac(w._center.lng));let C=r.ae.fromQuat(new Float32Array(16),D),P=r.ae.multiply([],w.starsProjMatrix,C),O=r.bE.fromMat4([],C),F=r.bE.invert([],O),z=[0,1,0];r.$.transformMat3(z,z,F),r.$.scale(z,z,this.params.sizeMultiplier);let U=[1,0,0];r.$.transformMat3(U,U,F),r.$.scale(U,U,this.params.sizeMultiplier);let $=(G=z,H=U,K=f,{u_matrix:Float32Array.from(P),u_up:G,u_right:H,u_intensity_multiplier:K});var G,H,K;i.uploadCommonUniforms(_,E),this.starsVx&&this.starsIdx&&E.draw(i,v.TRIANGLES,r.af.disabled,r.ah.disabled,this.colorModeAlphaBlendedWriteRGB,r.ag.disabled,$,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Ga(d,i){let a=[...d],f=i.cameraWorldSizeForFog/i.worldSize,_=r.ae.identity([]);return r.ae.scale(_,_,[f,f,1]),r.ae.multiply(a,_,a),r.ae.multiply(a,i.worldToFogMatrix,a),a}function Gs(d,i,a,f,_){let v=a.material,w=f.context,{baseColorTexture:E,metallicRoughnessTexture:D}=v.pbrMetallicRoughness,{normalTexture:C,occlusionTexture:P,emissionTexture:O}=v;function F(z,U,$){if(z&&(d.push(U),w.activeTexture.set(w.gl.TEXTURE0+$),z.gfxTexture)){let{minFilter:G,magFilter:H,wrapS:K,wrapT:J}=z.sampler;z.gfxTexture.bindExtraParam(G,H,K,J)}}F(E,"HAS_TEXTURE_u_baseColorTexture",Or.BaseColor),F(D,"HAS_TEXTURE_u_metallicRoughnessTexture",Or.MetallicRoughness),F(C,"HAS_TEXTURE_u_normalTexture",Or.Normal),F(P,"HAS_TEXTURE_u_occlusionTexture",Or.Occlusion),F(O,"HAS_TEXTURE_u_emissionTexture",Or.Emission),_&&(_.texture||(_.texture=new r.cj(f.context,_.image,[_.image.height,_.image.height,_.image.height],w.gl.RGBA)),w.activeTexture.set(w.gl.TEXTURE0+Or.LUT),_.texture&&_.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(a.texcoordBuffer)),a.colorBuffer&&(d.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(a.colorBuffer)),a.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(a.normalBuffer)),a.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(a.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||d.push("DIFFUSE_SHADED"),d.push("USE_STANDARD_DERIVATIVES")}function Fr(d,i,a,f,_,v){let w=a.paint.get("model-opacity"),E=i.context,D=new r.af(i.context.gl.LEQUAL,r.af.ReadWrite,i.depthRangeFor3D),C=i.transform,P=d.mesh,O=P.material,F=O.pbrMetallicRoughness,z=i.style.fog,U;U=i.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:r.ae.multiply([],f.zScaleMatrix,d.nodeModelMatrix),r.ae.multiply(U,f.negCameraPosMatrix,U);let $=r.ae.invert([],U);r.ae.transpose($,$);let G=a.paint.get("model-emissive-strength").constantOr(0),H=js(new Float32Array(d.worldViewProjection),new Float32Array(U),new Float32Array($),null,i,w,F.baseColorFactor.toRenderColor(null),O.emissiveFactor,F.metallicFactor,F.roughnessFactor,O,G,a),K={defines:[]},J=[];Gs(K.defines,J,P,i,a.lut);let Q=i.shadowRenderer;Q&&(Q.useNormalOffset=!1);let se=null;if(z){let ce=Ga(d.nodeModelMatrix,i.transform);if(se=new Float32Array(ce),C.projection.name!=="globe"){let he=P.aabb.min,xe=P.aabb.max,[de,oe]=z.getOpacityForBounds(ce,he[0],he[1],xe[0],xe[1]);K.overrideFog=de>=an||oe>=an}}let te=ni(i,a.paint.get("model-cutoff-fade-range"));te.shouldRenderCutoff&&K.defines.push("RENDER_CUTOFF");let ne=i.getOrCreateProgram("model",K);i.uploadCommonUniforms(E,ne,null,se,te),i.renderPass!=="shadow"&&Q&&Q.setupShadowsFromMatrix(d.nodeModelMatrix,ne),ne.draw(i,E.gl.TRIANGLES,D,_,v,P.material.doubleSided?r.ag.disabled:r.ag.backCCW,H,a.id,P.vertexBuffer,P.indexBuffer,P.segments,a.paint,i.transform.zoom,void 0,J)}function Qn(d,i,a,f,_,v,w){let E;E=d.projection.name==="globe"?r.ck(a,d):[...a],r.ae.multiply(E,E,i.matrix);let D=r.ae.multiply([],f,E);if(i.meshes)for(let C of i.meshes){if(C.material.alphaMode!=="BLEND"){w.push({mesh:C,depth:0,modelIndex:_,worldViewProjection:D,nodeModelMatrix:E});continue}let P=r.$.transformMat4([],C.centroid,D);P[2]>0&&v.push({mesh:C,depth:P[2],modelIndex:_,worldViewProjection:D,nodeModelMatrix:E})}if(i.children)for(let C of i.children)Qn(d,C,a,f,_,v,w)}function df(d,i,a,f){let _=a.shadowRenderer;if(!_)return;let v=_.getShadowPassDepthMode(),w=_.getShadowPassColorMode(),E=_.calculateShadowPassMatrixFromMatrix(i),D=rf(E);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,v,r.ah.disabled,w,r.ag.backCCW,D,f.id,d.vertexBuffer,d.indexBuffer,d.segments,f.paint,a.transform.zoom,void 0,void 0)}function fc(d,i,a){let f=i.updateZoomBasedPaintProperties(),_=function(v,w,E){let D,C,P,O=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&O>0){let F=v.terrain,z=F.findDEMTileFor(E);z&&z.dem?D=r.cm.create(F,E,z):O=0}if(O===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),O===w.validForExaggeration&&(O===0||D&&D._demTile&&D._demTile.tileID===w.validForDEMTile.id&&D._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(let F in w.instancesPerModel){let z=w.instancesPerModel[F];for(let U=0;U<z.instancedDataArray.length;++U){let $=(D?O*D.getElevationAt(0|z.instancedDataArray.float32[16*U],0|z.instancedDataArray.float32[16*U+1],!0,!0):0)+z.instancesEvaluatedElevation[U];z.instancedDataArray.float32[16*U+6]=$,C=C?Math.min(w.terrainElevationMin,$):$,P=P?Math.max(w.terrainElevationMax,$):$}}return w.terrainElevationMin=C||0,w.terrainElevationMax=P||0,w.validForExaggeration=O,w.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,i,a);(f||_)&&(i.uploaded=!1,i.upload(d.context))}let Fi={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.b8([0,0,0],[r.a4,r.a4,0])};function pc(d,i){let a=1<<d.canonical.z,f=i.getFreeCameraOptions().position,_=i.elevation,v=d.canonical.x/a,w=(d.canonical.x+1)/a,E=d.canonical.y/a,D=(d.canonical.y+1)/a,C=i._centerAltitude;if(_){let z=_.getMinMaxForTile(d);z&&z.max>C&&(C=z.max)}let P=r.au(f.x,v,w)-f.x,O=r.au(f.y,E,D)-f.y,F=r.ay(C,i.center.lat)-f.z;return i._zoomFromMercatorZ(Math.sqrt(P*P+O*O+F*F))}function Xu(d,i,a,f,_,v,w){let E=d.context,D=d.renderPass==="shadow",C=d.shadowRenderer,P=D&&C?C.getShadowPassDepthMode():new r.af(E.gl.LEQUAL,r.af.ReadWrite,d.depthRangeFor3D),O=d.isTileAffectedByFog(v);if(a.meshes)for(let F of a.meshes){let z=["MODEL_POSITION_ON_GPU"],U=[],$,G,H;f.instancedDataArray.length>20&&z.push("INSTANCED_ARRAYS");let K=ni(d,i.paint.get("model-cutoff-fade-range"));if(K.shouldRenderCutoff&&z.push("RENDER_CUTOFF"),D&&C)$=d.getOrCreateProgram("modelDepth",{defines:z}),G=rf(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(a.matrix)),H=C.getShadowPassColorMode();else{Gs(z,U,F,d,i.lut),$=d.getOrCreateProgram("model",{defines:z,overrideFog:O});let Q=F.material,se=Q.pbrMetallicRoughness,te=i.paint.get("model-opacity"),ne=i.paint.get("model-emissive-strength").constantOr(0);G=js(v.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,d,te,se.baseColorFactor.toRenderColor(null),Q.emissiveFactor,se.metallicFactor,se.roughnessFactor,Q,ne,i,_),C&&(w.shadowUniformsInitialized?$.setShadowUniformValues(E,C.getShadowUniformValues()):(C.setupShadows(v.toUnwrapped(),$,"model-tile",v.overscaledZ),w.shadowUniformsInitialized=!0)),H=K.shouldRenderCutoff||te<1||Q.alphaMode!=="OPAQUE"?r.a.alphaBlended:r.a.unblended}d.uploadCommonUniforms(E,$,v.toUnwrapped(),null,K);let J=F.material.doubleSided?r.ag.disabled:r.ag.backCCW;if(f.instancedDataArray.length>20)U.push(f.instancedDataBuffer),$.draw(d,E.gl.TRIANGLES,P,r.ah.disabled,H,J,G,i.id,F.vertexBuffer,F.indexBuffer,F.segments,i.paint,d.transform.zoom,void 0,U,f.instancedDataArray.length);else{let Q=D?"u_instance":"u_normal_matrix";for(let se=0;se<f.instancedDataArray.length;++se)G[Q]=new Float32Array(f.instancedDataArray.arrayBuffer,64*se,16),$.draw(d,E.gl.TRIANGLES,P,r.ah.disabled,H,J,G,i.id,F.vertexBuffer,F.indexBuffer,F.segments,i.paint,d.transform.zoom,void 0,U)}}if(a.children)for(let F of a.children)Xu(d,i,F,f,_,v,w)}let Yu=[1,-1,1];function Xr(d,i,a,f){if(!a.modelManager)return!0;let _=a.modelManager;if(!a.shadowRenderer)return!0;let v=a.shadowRenderer,w=i.aabb,E=!0,D=d.maxHeight;if(D===0){let P=0;for(let O in d.instancesPerModel){let F=_.getModel(O,f);F?P=Math.max(P,Math.max(Math.max(F.aabb.max[0],F.aabb.max[1]),F.aabb.max[2])):E=!1}D=d.maxScale*P*1.41+d.maxVerticalOffset,E&&(d.maxHeight=D)}w.max[2]=D,w.min[2]+=d.terrainElevationMin,w.max[2]+=d.terrainElevationMax,r.$.transformMat4(w.min,w.min,i.tileMatrix),r.$.transformMat4(w.max,w.max,i.tileMatrix);let C=w.intersects(v.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=C===2),C===0}function gi(d,i){let a=d.uniformValues.u_cutoff_params[0],f=d.uniformValues.u_cutoff_params[1],_=d.uniformValues.u_cutoff_params[2],v=d.uniformValues.u_cutoff_params[3];return f===a||v===_?1:r.au(((i-a)/(f-a)-_)/(v-_),0,1)}function jm(d,i,a,f){if(i.pitch<20)return 1;let _=i.getWorldToCameraMatrix(),v=r.ae.multiply([],_,d),w=[...a.min,1],E=r.aB.transformMat4([],w,v),D=E,C=E;w[1]=a.max[1],E=r.aB.transformMat4([],w,v),D=E[1]<D[1]?E:D,C=E[1]>C[1]?E:C,w[0]=a.max[0],E=r.aB.transformMat4([],w,v),D=E[1]<D[1]?E:D,C=E[1]>C[1]?E:C,w[1]=a.min[1],E=r.aB.transformMat4([],w,v),D=E[1]<D[1]?E:D,C=E[1]>C[1]?E:C;let P=r.au(f[0],0,1),O=100*i.pixelsPerMeter*r.au(f[1],0,1),F=r.au(f[2],0,1),z=r.$.lerp([],D,C,P),U=Math.tan(.5*i.fovX),$=-z[2]*U;if(O===0)return z[1]<-Math.abs($)?F:1;let G=(-Math.abs($)-z[1])/O,H=(J,Q,se)=>(1-se)*J+se*Q,K=r.au(H(1,F,G),F,1);return H(1,K,r.au((i.pitch-20)/20,0,1))}class Ha{}class ur{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,a,f){{let O=this._storage.get(a.id);if(O)return O.lastUsedFrameIdx=i,O.buf}let _=f.gl,v=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),w=new ArrayBuffer(v),E=new Int16Array(w);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));let D=new r.co;for(let O=0;O<v/2;O+=3){let F=E[O],z=E[O+1],U=E[O+2];D.emplaceBack(F,z),D.emplaceBack(z,U),D.emplaceBack(U,F)}let C=f.bindVertexArrayOES.current,P=new Ha;return P.buf=new r.I(f,D),P.lastUsedFrameIdx=i,this._storage.set(a.id,P),f.bindVertexArrayOES.set(C),P.buf}update(i){for(let[a,f]of this._storage)i-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(a))}destroy(){for(let[i,a]of this._storage)a.buf.destroy(),this._storage.delete(i)}}class Zi{constructor(i){this.occluderSize=30,this.depthOffset=-1e-4,i.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}let Xi={symbol:function(d,i,a,f,_){if(d.renderPass!=="translucent")return;let v=r.ah.disabled,w=d.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(C,P,O,F,z,U,$){let G=P.transform,H=z==="map",K=U==="map";for(let J of C){let Q=F.getTile(J),se=Q.getBucket(O);if(!se||!se.text||!se.text.segments.get().length)continue;let te=r.aE(se.textSizeData,G.zoom),ne=of(J,se.getProjection(),G),ce=G.calculatePixelsToTileUnitsMatrix(Q),he=Zl(ne,Q.tileID.canonical,K,H,G,se.getProjection(),ce),xe=se.hasIconTextFit()&&se.hasIconData();if(te){let de=Math.pow(2,G.zoom-Q.tileID.overscaledZ);h0(se,H,K,$,r.bQ,G,he,J,de,te,xe)}}}(f,d,a,i,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),_);let E=a.paint.get("icon-opacity").constantOr(1)!==0,D=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(E||D)?cc(d,i,a,f,v,w):(E&&cc(d,i,a,f,v,w,{onlyIcons:!0}),D&&cc(d,i,a,f,v,w,{onlyText:!0})),i.map.showCollisionBoxes&&(km(d,i,a,f,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),km(d,i,a,f,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(d,i,a,f){if(d.renderPass!=="translucent")return;let _=a.paint.get("circle-opacity"),v=a.paint.get("circle-stroke-width"),w=a.paint.get("circle-stroke-opacity"),E=a.layout.get("circle-sort-key").constantOr(1)!==void 0,D=a.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(v.constantOr(1)===0||w.constantOr(1)===0))return;let C=d.context,P=C.gl,O=d.transform,F=d.depthModeForSublayer(0,r.af.ReadOnly),z=r.ah.disabled,U=d.colorModeForDrapableLayerRenderPass(D),$=O.projection.name==="globe",G=[r.ak(O.center.lng),r.al(O.center.lat)],H=[];for(let J=0;J<f.length;J++){let Q=f[J],se=i.getTile(Q),te=se.getBucket(a);if(!te||te.projection.name!==O.projection.name)continue;let ne=te.programConfigurations.get(a.id),ce=r.bT(a),he=d.isTileAffectedByFog(Q);$&&ce.push("PROJECTION_GLOBE_VIEW"),ce.push("DEPTH_D24"),d.terrain&&O.depthOcclusionForSymbolsAndCircles&&ce.push("DEPTH_OCCLUSION");let xe=d.getOrCreateProgram("circle",{config:ne,defines:ce,overrideFog:he}),de=te.layoutVertexBuffer,oe=te.globeExtVertexBuffer,Me=te.indexBuffer,Ee=O.projection.createInversionMatrix(O,Q.canonical),me={programConfiguration:ne,program:xe,layoutVertexBuffer:de,globeExtVertexBuffer:oe,indexBuffer:Me,uniformValues:r.bU(d,Q,se,Ee,G,a),tile:se};if(E){let je=te.segments.get();for(let Fe of je)H.push({segments:new r.b([Fe]),sortKey:Fe.sortKey,state:me})}else H.push({segments:te.segments,sortKey:0,state:me})}E&&H.sort((J,Q)=>J.sortKey-Q.sortKey);let K={useDepthForOcclusion:O.depthOcclusionForSymbolsAndCircles};for(let J of H){let{programConfiguration:Q,program:se,layoutVertexBuffer:te,globeExtVertexBuffer:ne,indexBuffer:ce,uniformValues:he,tile:xe}=J.state,de=J.segments;d.terrain&&d.terrain.setupElevationDraw(xe,se,K),d.uploadCommonUniforms(C,se,xe.tileID.toUnwrapped()),se.draw(d,P.TRIANGLES,F,z,U,r.ag.disabled,he,a.id,te,ce,de,a.paint,O.zoom,Q,[ne])}},heatmap:function(d,i,a,f){if(a.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){let _=d.context,v=_.gl,w=r.ah.disabled,E=new r.a([v.ONE,v.ONE,v.ONE,v.ONE],r.C.transparent,[!0,!0,!0,!0]);(function(z,U,$,G){let H=z.gl,K=U.width*G,J=U.height*G;z.activeTexture.set(H.TEXTURE1),z.viewport.set([0,0,K,J]);let Q=$.heatmapFbo;if(!Q||Q&&(Q.width!==K||Q.height!==J)){Q&&Q.destroy();let se=H.createTexture();H.bindTexture(H.TEXTURE_2D,se),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MAG_FILTER,H.LINEAR),Q=$.heatmapFbo=z.createFramebuffer(K,J,!0,null),function(te,ne,ce,he,xe,de){let oe=te.gl;oe.texImage2D(oe.TEXTURE_2D,0,te.extRenderToTextureHalfFloat?oe.RGBA16F:oe.RGBA,xe,de,0,oe.RGBA,te.extRenderToTextureHalfFloat?oe.HALF_FLOAT:oe.UNSIGNED_BYTE,null),he.colorAttachment.set(ce)}(z,0,se,Q,K,J)}else H.bindTexture(H.TEXTURE_2D,Q.colorAttachment.get()),z.bindFramebuffer.set(Q.framebuffer)})(_,d,a,d.transform.projection.name==="globe"?.5:.25),_.clear({color:r.C.transparent});let D=d.transform,C=D.projection.name==="globe",P=C?["PROJECTION_GLOBE_VIEW"]:[],O=C?r.ag.frontCCW:r.ag.disabled,F=[r.ak(D.center.lng),r.al(D.center.lat)];for(let z=0;z<f.length;z++){let U=f[z];if(i.hasRenderableParent(U))continue;let $=i.getTile(U),G=$.getBucket(a);if(!G||G.projection.name!==D.projection.name)continue;let H=d.isTileAffectedByFog(U),K=G.programConfigurations.get(a.id),J=d.getOrCreateProgram("heatmap",{config:K,defines:P,overrideFog:H}),{zoom:Q}=d.transform;d.terrain&&d.terrain.setupElevationDraw($,J),d.uploadCommonUniforms(_,J,U.toUnwrapped());let se=D.projection.createInversionMatrix(D,U.canonical);J.draw(d,v.TRIANGLES,r.af.disabled,w,E,O,Pm(d,U,$,se,F,Q,a.paint.get("heatmap-intensity")),a.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,a.paint,d.transform.zoom,K,C?[G.globeExtVertexBuffer]:null)}_.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(_,v){let w=_.context,E=w.gl,D=v.heatmapFbo;if(!D)return;w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,D.colorAttachment.get()),w.activeTexture.set(E.TEXTURE1);let C=v.colorRampTexture;C||(C=v.colorRampTexture=new r.T(w,v.colorRamp,E.RGBA)),C.bind(E.LINEAR,E.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,E.TRIANGLES,r.af.disabled,r.ah.disabled,_.colorModeForRenderPass(),r.ag.disabled,((P,O,F,z)=>({u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}))(0,v),v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(d,a))},line:function(d,i,a,f){if(d.renderPass!=="translucent")return;let _=a.paint.get("line-opacity"),v=a.paint.get("line-width");if(_.constantOr(1)===0||v.constantOr(1)===0)return;let w=a.paint.get("line-emissive-strength"),E=a.paint.get("line-occlusion-opacity"),D=d.context,C=D.gl,P=a.layout.get("line-z-offset"),O=!P.isConstant()||!!P.constantOr(0),F=O?new r.af(d.depthOcclusion?C.GREATER:C.LEQUAL,r.af.ReadOnly,d.depthRangeFor3D):d.depthModeForSublayer(0,r.af.ReadOnly),z=d.colorModeForDrapableLayerRenderPass(w),U=d.terrain&&d.terrain.renderingToTexture,$=U?1:r.e.devicePixelRatio,G=a.paint.get("line-dasharray"),H=G.constantOr(1),K=a.layout.get("line-cap"),J=G.constantOr(null),Q=K.constantOr(null),se=a.paint.get("line-pattern"),te=se.constantOr(1),ne=se.constantOr(null),ce=a.paint.get("line-opacity").constantOr(1),he=!te&&ce!==1||d.depthOcclusion&&E>0&&E<1,xe=a.paint.get("line-gradient"),de=te?"linePattern":"line",oe=r.bV(a),Me;if(U&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(he=!1),E!==0&&d.depthOcclusion){let me=a.paint._values["line-opacity"];me&&me.value&&me.value.kind==="constant"?Me=me.value:r.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}if(O&&(d.forceTerrainMode=!0),!O&&E!==0&&d.terrain&&!U)return void r.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has non-zero line-z-offset.`);let Ee=he&&O?d.stencilModeFor3D():r.ah.disabled;for(let me of f){let je=i.getTile(me);if(te&&!je.patternsLoaded())continue;let Fe=je.getBucket(a);if(!Fe)continue;d.prepareDrawTile();let be=Fe.programConfigurations.get(a.id),Ae=d.isTileAffectedByFog(me),fe=d.getOrCreateProgram(de,{config:be,defines:O?[...oe,"ELEVATED"]:oe,overrideFog:Ae});if(ne&&je.imageAtlas){let nt=je.imageAtlas.patternPositions[ne.toString()];nt&&be.setConstantPatternPositions(nt)}if(!te&&J&&Q&&je.lineAtlas){let nt=je.lineAtlas.getDash(J,Q);nt&&be.setConstantPatternPositions(nt)}let[Ne,Be]=a.paint.get("line-trim-offset");(Q==="round"||Q==="square")&&Ne!==Be&&(Ne===0&&(Ne-=1),Be===1&&(Be+=1));let Ke=U?me.projMatrix:null,et=te?r.bW(d,je,a,Ke,$,[Ne,Be]):r.bX(d,je,a,Ke,Fe.lineClipsArray.length,$,[Ne,Be]);if(xe){let nt=Fe.gradients[a.id],mt=nt.texture;if(a.gradientVersion!==nt.version){let At=256;if(a.stepInterpolant){let _t=i.getSource().maxzoom,kt=me.canonical.z===_t?Math.ceil(1<<d.transform.maxZoom-me.canonical.z):1;At=r.au(r.bY(Fe.maxLineLength/r.a4*1024*kt),256,D.maxTextureSize)}nt.gradient=r.bZ({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:At,image:nt.gradient||void 0,clips:Fe.lineClipsArray}),nt.texture?nt.texture.update(nt.gradient):nt.texture=new r.T(D,nt.gradient,C.RGBA),nt.version=a.gradientVersion,mt=nt.texture}D.activeTexture.set(C.TEXTURE1),mt.bind(a.stepInterpolant?C.NEAREST:C.LINEAR,C.CLAMP_TO_EDGE)}H&&(D.activeTexture.set(C.TEXTURE0),je.lineAtlasTexture&&je.lineAtlasTexture.bind(C.LINEAR,C.REPEAT),be.updatePaintBuffers()),te&&(D.activeTexture.set(C.TEXTURE0),je.imageAtlasTexture&&je.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),be.updatePaintBuffers()),O&&d.terrain.setupElevationDraw(je,fe),d.uploadCommonUniforms(D,fe,me.toUnwrapped());let at=nt=>{Me!=null&&(Me.value=ce*E),fe.draw(d,C.TRIANGLES,F,nt,z,r.ag.disabled,et,a.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,a.paint,d.transform.zoom,be,[Fe.layoutVertexBuffer2,Fe.patternVertexBuffer,Fe.zOffsetVertexBuffer]),Me!=null&&(Me.value=ce)};if(he&&!O){let nt=d.stencilModeForClipping(me).ref;nt===0&&U&&D.clear({stencil:0});let mt={func:C.EQUAL,mask:255};et.u_alpha_discard_threshold=.8,at(new r.ah(mt,nt,255,C.KEEP,C.KEEP,C.INVERT)),et.u_alpha_discard_threshold=0,at(new r.ah(mt,nt,255,C.KEEP,C.KEEP,C.KEEP))}else he&&O&&(et.u_alpha_discard_threshold=.001),at(O?Ee:d.stencilModeForClipping(me))}he&&(d.resetStencilClippingMasks(),U&&D.clear({stencil:0})),E===0||d.depthOcclusion||U||d.layersWithOcclusionOpacity.push(d.currentLayer),O&&(d.forceTerrainMode=!1)},fill:function(d,i,a,f){let _=a.paint.get("fill-color"),v=a.paint.get("fill-opacity");if(v.constantOr(1)===0)return;let w=a.paint.get("fill-emissive-strength"),E=d.colorModeForDrapableLayerRenderPass(w),D=a.paint.get("fill-pattern"),C=d.opaquePassEnabledForLayer()&&!D.constantOr(1)&&_.constantOr(r.C.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===C){let P=d.depthModeForSublayer(1,d.renderPass==="opaque"?r.af.ReadWrite:r.af.ReadOnly);uc(d,i,a,f,P,E,!1)}if(d.renderPass==="translucent"&&a.paint.get("fill-antialias")){let P=d.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,r.af.ReadOnly);uc(d,i,a,f,P,E,!0)}},"fill-extrusion":function(d,i,a,f){let _=a.paint.get("fill-extrusion-opacity"),v=d.context,w=v.gl,E=d.terrain,D=E&&E.renderingToTexture;if(_===0)return;let C=d.conflationActive&&d.style.isLayerClipped(a,i.getSource()),P=d.style.order.indexOf(a.fqid);if(C&&function(O,F,z,U,$){for(let G of U){let H=F.getTile(G).getBucket(z);H&&(H.updateReplacement(G,O.replacementSource,$),H.uploadCentroid(O.context))}}(d,i,a,f,P),E||C)for(let O of f){let F=i.getTile(O).getBucket(a);F&&d0(d.context,i,O,F,a,E,C)}if(d.renderPass==="shadow"&&d.shadowRenderer){let O=d.shadowRenderer;if(E&&_<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.Z)return;let F=O.getShadowPassDepthMode(),z=O.getShadowPassColorMode();Us(d,i,a,f,F,r.ah.disabled,z,C)}else if(d.renderPass==="translucent"){let O=!a.paint.get("fill-extrusion-pattern").constantOr(1),F=a.paint.get("fill-extrusion-color").constantOr(r.C.white);if(!D&&F.a!==0){let z=new r.af(d.context.gl.LEQUAL,r.af.ReadWrite,d.depthRangeFor3D);_===1&&O?Us(d,i,a,f,z,r.ah.disabled,r.a.unblended,C):(Us(d,i,a,f,z,r.ah.disabled,r.a.disabled,C),Us(d,i,a,f,z,d.stencilModeFor3D(),d.colorModeForRenderPass(),C),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&O&&(!E&&d.transform.projection.name!=="globe"||D)){let z=a.paint.get("fill-extrusion-opacity"),U=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),$=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),G=a.paint.get("fill-extrusion-flood-light-intensity"),H=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(a.lut).toArray01().slice(0,3),K=U>0&&$>0,J=G>0,Q=(te,ne,ce)=>(1-ce)*te+ce*ne,se=te=>{let ne=d.depthModeForSublayer(1,r.af.ReadOnly,w.LEQUAL,!0),ce=a.paint.get(te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),he=Q(.1,3,ce),xe=d._showOverdrawInspector;if(!xe){let de=new r.ah({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),oe=new r.a([w.ONE,w.ONE,w.ONE,w.ONE],r.C.transparent,[!1,!1,!1,!0],w.MIN);Va(d,i,a,f,ne,de,oe,r.ag.disabled,te,"sdf",z,U,$,G,H,he,C,!1)}{let de=xe?r.ah.disabled:new r.ah({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),oe=xe?d.colorModeForRenderPass():new r.a([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],r.C.transparent,[!0,!0,!0,!0]);Va(d,i,a,f,ne,de,oe,r.ag.disabled,te,"color",z,U,$,G,H,he,C,!1)}};if(D){let te=(ne,ce,he)=>{let xe=d.depthModeForSublayer(1,r.af.ReadOnly,w.LEQUAL,!1),de=a.paint.get(ne?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),oe=Q(.1,3,de);{let Me=new r.a([w.ONE,w.ONE,w.ONE,w.ONE],r.C.transparent,[!1,!1,!1,!0]);Va(d,i,a,f,xe,r.ah.disabled,Me,r.ag.disabled,ne,"clear",z,U,$,G,H,oe,C,ce)}{let Me=new r.ah({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Ee=new r.a([w.ONE,w.ONE,w.ONE,w.ONE],r.C.transparent,[!1,!1,!1,!0],w.MIN);Va(d,i,a,f,xe,Me,Ee,r.ag.disabled,ne,"sdf",z,U,$,G,H,oe,C,ce)}{let Me=ne?w.ZERO:w.ONE_MINUS_DST_ALPHA,Ee=new r.ah({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),me=new r.a([Me,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],r.C.transparent,[!0,!0,!0,!0]);Va(d,i,a,f,xe,Ee,me,r.ag.disabled,ne,"color",z,U,$,G,H,oe,C,ce)}{let Me=new r.a([w.ONE,w.ONE,w.ONE,ne?w.ZERO:w.ONE],r.C.transparent,[!1,!1,!1,!0],ne?w.FUNC_ADD:w.MAX);Va(d,i,a,f,xe,r.ah.disabled,Me,r.ag.disabled,ne,"clear",z,U,$,G,H,oe,C,ce,he)}};if(K||J){let ne;if(d.prepareDrawTile(),E){let ce=E.drapeBufferSize[0],he=E.drapeBufferSize[1];ne=E.framebufferCopyTexture,ne&&(!ne||ne.size[0]===ce&&ne.size[1]===he)||(ne&&ne.destroy(),ne=E.framebufferCopyTexture=new r.T(v,new r.j({width:ce,height:he}),w.RGBA)),ne.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexImage2D(w.TEXTURE_2D,0,w.RGBA,0,0,ce,he,0)}K&&te(!0,!1,ne),J&&te(!1,!0,ne)}}else K&&se(!0),J&&se(!1),(K||J)&&d.resetStencilClippingMasks()}}},hillshade:function(d,i,a,f){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;let _=d.context,v=d.terrain&&d.terrain.renderingToTexture,[w,E]=d.renderPass!=="translucent"||v?[{},f]:d.stencilConfigForOverlap(f);for(let D of E){let C=i.getTile(D);if(C.needsHillshadePrepare&&d.renderPass==="offscreen")a0(d,C,a);else if(d.renderPass==="translucent"){let P=d.depthModeForSublayer(0,r.af.ReadOnly),O=a.paint.get("hillshade-emissive-strength"),F=d.colorModeForDrapableLayerRenderPass(O),z=v&&d.terrain?d.terrain.stencilModeForRTTOverlap(D):w[D.overscaledZ];s0(d,D,C,a,P,z,F)}}_.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,i,a,f,_,v){if(d.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;let w=d.transform.projection.name==="globe",E=a.paint.get("raster-elevation")!==0,D=E&&w;if(d.renderElevatedRasterBackface&&!D)return;let C=d.context,P=C.gl,O=i.getSource(),F=function(te,ne,ce,he){let xe=ne.paint.get("raster-color"),de=te.type==="raster-array",oe=[],Me=ne.paint.get("raster-resampling"),Ee=ne.paint.get("raster-color-mix"),me=ne.paint.get("raster-color-range"),je=[Ee[0],Ee[1],Ee[2],0],Fe=Ee[3],be=Me==="nearest"?he.NEAREST:he.LINEAR;if(de&&(oe.push("RASTER_ARRAY"),xe||oe.push("RASTER_COLOR"),Me==="linear"&&oe.push("RASTER_ARRAY_LINEAR"),be=he.NEAREST,!me&&te.rasterLayers)){let Ae=te.rasterLayers.find(({id:fe})=>fe===ne.sourceLayer);Ae&&Ae.fields&&Ae.fields.range&&(me=Ae.fields.range)}if(me=me||[0,1],xe){oe.push("RASTER_COLOR"),ce.activeTexture.set(he.TEXTURE2),ne.updateColorRamp(me);let Ae=ne.colorRampTexture;Ae||(Ae=ne.colorRampTexture=new r.T(ce,ne.colorRamp,he.RGBA)),Ae.bind(he.LINEAR,he.CLAMP_TO_EDGE)}return{mix:je,range:me,offset:Fe,defines:oe,resampling:be}}(O,a,C,P);if(O instanceof r.bo&&!f.length&&!w)return;let z=a.paint.get("raster-emissive-strength"),U=d.colorModeForDrapableLayerRenderPass(z),$=d.terrain&&d.terrain.renderingToTexture,G=!d.options.moving,H=a.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;if(O instanceof r.bo&&!f.length&&(O.onNorthPole||O.onSouthPole)){let te=E?d.stencilModeFor3D():r.ah.disabled;return void Hu(!!O.onNorthPole,null,d,i,a,z,F,r.ag.disabled,te)}if(!f.length)return;let[K,J]=O instanceof r.bo||$?[{},f]:d.stencilConfigForOverlap(f),Q=J[J.length-1].overscaledZ;D&&F.defines.push("PROJECTION_GLOBE_VIEW"),E&&F.defines.push("RENDER_CUTOFF");let se=(te,ne,ce)=>{for(let he of te){let xe=he.toUnwrapped(),de=i.getTile(he);if($&&(!de||!de.hasData()))continue;C.activeTexture.set(P.TEXTURE0);let oe=$s(de,O,a,F);if(!oe||!oe.texture)continue;let{texture:Me,mix:Ee,offset:me,tileSize:je,buffer:Fe}=oe,be,Ae;$?(be=r.af.disabled,Ae=he.projMatrix):E?(be=new r.af(P.LEQUAL,r.af.ReadWrite,d.depthRangeFor3D),Ae=w?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(xe,G)):(be=d.depthModeForSublayer(he.overscaledZ-Q,a.paint.get("raster-opacity")===1?r.af.ReadWrite:r.af.ReadOnly,P.LESS),Ae=d.transform.calculateProjMatrix(xe,G));let fe=d.terrain&&$?d.terrain.stencilModeForRTTOverlap(he):K[he.overscaledZ],Ne=v?0:a.paint.get("raster-fade-duration");de.registerFadeDuration(Ne);let Be=i.findLoadedParent(he,0),Ke=Fu(de,Be,i,d.transform,Ne),et,at;d.terrain&&d.terrain.prepareDrawTile(),C.activeTexture.set(P.TEXTURE0),Me.bind(H,P.CLAMP_TO_EDGE),C.activeTexture.set(P.TEXTURE1),Be?(Be.texture&&Be.texture.bind(H,P.CLAMP_TO_EDGE),et=Math.pow(2,Be.tileID.overscaledZ-de.tileID.overscaledZ),at=[de.tileID.canonical.x*et%1,de.tileID.canonical.y*et%1]):Me.bind(H,P.CLAMP_TO_EDGE),Me.useMipmap&&C.extTextureFilterAnisotropic&&d.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);let nt=d.transform,mt,At=E?af(nt):[0,0,0,0],_t,kt,Ht,kn,In,Wt=0;if(D&&O instanceof r.bo&&O.coordinates.length>3)_t=Float32Array.from(r.bh(r.bi(new r.aO(0,0,0)))),kt=Float32Array.from(nt.globeMatrix),Ht=Float32Array.from(r.bd(nt)),kn=[r.ak(nt.center.lng),r.al(nt.center.lat)],mt=O.elevatedGlobePerspectiveTransform,In=O.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){let Pt=r.be(he.canonical);Wt=r.bf(Pt.getCenter().lat),_t=Float32Array.from(r.bh(r.bi(he.canonical))),kt=Float32Array.from(nt.globeMatrix),Ht=Float32Array.from(r.bd(nt)),kn=[r.ak(nt.center.lng),r.al(nt.center.lat)],mt=[0,0],In=Float32Array.from(r.bg(he.canonical,Pt,Wt,nt.worldSize/nt._pixelsPerMercatorPixel))}else mt=O instanceof r.bo?O.perspectiveTransform:[0,0],_t=new Float32Array(16),kt=new Float32Array(9),Ht=new Float32Array(16),kn=[0,0],In=new Float32Array(9);let Tn=$u(Ae,_t,kt,Ht,In,at||[0,0],r.a2(d.transform.zoom),kn,At,et||1,Ke,a,mt,E?a.paint.get("raster-elevation"):0,2,Ee,me,F.range,je,Fe,z),Bt=d.isTileAffectedByFog(he),Vt=d.getOrCreateProgram("raster",{defines:F.defines,overrideFog:Bt});if(d.uploadCommonUniforms(C,Vt,xe),O instanceof r.bo){let Pt=O.elevatedGlobeVertexBuffer,tn=O.elevatedGlobeIndexBuffer;if($||!w)O.boundsBuffer&&O.boundsSegments&&Vt.draw(d,P.TRIANGLES,be,r.ah.disabled,U,r.ag.disabled,Tn,a.id,O.boundsBuffer,d.quadTriangleIndexBuffer,O.boundsSegments);else if(Pt&&tn){let Ut=nt.zoom<=r.b3?O.elevatedGlobeSegments:O.getSegmentsForLongitude(nt.center.lng);Ut&&Vt.draw(d,P.TRIANGLES,be,r.ah.disabled,U,ne,Tn,a.id,Pt,tn,Ut)}}else if(D){be=new r.af(P.LEQUAL,r.af.ReadOnly,d.depthRangeFor3D);let Pt=d.globeSharedBuffers;if(Pt){let[tn,Ut,xt]=Pt.getGridBuffers(Wt,!1);Vt.draw(d,P.TRIANGLES,be,ce||fe,d.colorModeForRenderPass(),ne,Tn,a.id,tn,Ut,xt)}}else{let{tileBoundsBuffer:Pt,tileBoundsIndexBuffer:tn,tileBoundsSegments:Ut}=d.getTileBoundsBuffers(de);Vt.draw(d,P.TRIANGLES,be,fe,U,r.ag.disabled,Tn,a.id,Pt,tn,Ut)}}if(!(O instanceof r.bo)&&D)for(let he of te){let xe=he.canonical.y===(1<<he.canonical.z)-1;he.canonical.y===0&&Hu(!0,he,d,i,a,z,F,ne,ce||r.ah.disabled),xe&&Hu(!1,he,d,i,a,z,F,ne===r.ag.frontCW?r.ag.backCW:r.ag.frontCW,ce||r.ah.disabled)}};D?se(J,d.renderElevatedRasterBackface?r.ag.backCW:r.ag.frontCW,d.stencilModeFor3D()):se(J,r.ag.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,i,a,f,_,v){d.renderPass==="offscreen"&&function(w,E,D,C){if(!C.length)return;let P=w.context,O=P.gl,F=E.getSource();if(!(F instanceof os))return;let z=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count"))),U=D.particlePositionRGBAImage;if(!U||U.width!==z){let J=function(Q){let se=Q*Q,te=new Uint8Array(4*se),ne=function(he){return he|=0,he=Math.imul(2747636419^he,2654435769),he=Math.imul(he^he>>>16,2654435769),((he=Math.imul(he^he>>>16,2654435769))>>>0)/4294967296},ce=1/1.1;for(let he=0;he<se;he++){let xe=ce*(ne(2*he+0)+lo),de=ce*(ne(2*he+1)+lo),oe=255*xe%1,Me=255*de%1,Ee=oe,me=de-Me/255,je=Me;te[4*he+0]=255*(xe-oe/255),te[4*he+1]=255*Ee,te[4*he+2]=255*me,te[4*he+3]=255*je}return te}(z);U=D.particlePositionRGBAImage=new r.j({width:z,height:z},J)}let $=D.particleFramebuffer;$?$.width!==z&&($.destroy(),$=D.particleFramebuffer=P.createFramebuffer(z,z,!0,null)):$=D.particleFramebuffer=P.createFramebuffer(z,z,!0,null);let G=[];for(let J of C){let Q=E.getTile(J);if(!(Q instanceof r.c5))continue;let se=Bm(Q,F,D);if(!se)continue;let te=[Q.tileSize,Q.tileSize],ne=D.tileFramebuffer;ne||(ne=D.tileFramebuffer=P.createFramebuffer(te[0],te[1],!0,null));let ce=Q.rasterParticleState;ce||(ce=Q.rasterParticleState=new Bl(P,J,te,U));let he=ce.update(D.lastInvalidatedAt);ce.particleTextureDimension!==z&&ce.updateParticleTexture(J,U);let xe=ce.targetColorTexture;ce.targetColorTexture=ce.backgroundColorTexture,ce.backgroundColorTexture=xe;let de=ce.particleTexture0;ce.particleTexture0=ce.particleTexture1,ce.particleTexture1=de,G.push([J,se,ce,he])}if(G.length===0)return;let H=r.e.now(),K=D.previousDrawTimestamp?.001*(H-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=H,D.hasColorMap()){P.activeTexture.set(O.TEXTURE0+2);let J=D.colorRampTexture;J||(J=D.colorRampTexture=new r.T(P,D.colorRamp,O.RGBA)),J.bind(O.LINEAR,O.CLAMP_TO_EDGE)}P.bindFramebuffer.set(D.tileFramebuffer.framebuffer),function(J,Q,se){let te=J.context,ne=te.gl,ce=Q.tileFramebuffer;te.activeTexture.set(ne.TEXTURE0);let he={u_texture:0,u_opacity:1.05*(de=Q.paint.get("raster-particle-fade-opacity-factor"))/(de+.05)},xe=J.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var de;for(let oe of se){let[,,Me,Ee]=oe;ce.colorAttachment.set(Me.targetColorTexture.texture),te.viewport.set([0,0,ce.width,ce.height]),te.clear({color:r.C.transparent}),Ee&&(Me.backgroundColorTexture.bind(ne.NEAREST,ne.CLAMP_TO_EDGE),xe.draw(J,ne.TRIANGLES,r.af.disabled,r.ah.disabled,r.a.alphaBlended,r.ag.disabled,he,Q.id,J.viewportBuffer,J.quadTriangleIndexBuffer,J.viewportSegments))}}(w,D,G),function(J,Q,se,te){let ne=J.context,ce=ne.gl,he=se.tileFramebuffer,xe=J.transform.projection.name==="globe",de=se.paint.get("raster-particle-max-speed");for(let oe of te){let[Me,Ee,me]=oe;ne.activeTexture.set(ce.TEXTURE0+0),Ee.texture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE),he.colorAttachment.set(me.targetColorTexture.texture);let je=J.getOrCreateProgram("rasterParticleDraw",{defines:Ee.defines,overrideFog:!1});ne.activeTexture.set(ce.TEXTURE0+1);let Fe=Ee.scalarData?[]:[0,1,2,3].map(fe=>r.b$[fe](Me));Fe.push(Me);let be=Me.canonical.x,Ae=Me.canonical.y;for(let fe of Fe){let Ne=Q.getTile(xe?fe.wrapped():fe);if(!Ne)continue;let Be=Ne.rasterParticleState;if(!Be)continue;let Ke=fe.canonical.x+(1<<fe.canonical.z)*(fe.wrap-Me.wrap),et=fe.canonical.y;Be.particleTexture0.bind(ce.NEAREST,ce.CLAMP_TO_EDGE);let at=c0(1,Be.particleTexture0.size[0],[Ke-be,et-Ae],0,Ee.texture.size,2,de,Ee.textureOffset,Ee.scale,Ee.offset);je.draw(J,ce.POINTS,r.af.disabled,r.ah.disabled,r.a.alphaBlended,r.ag.disabled,at,se.id,Be.particleIndexBuffer,void 0,Be.particleSegment)}}}(w,E,D,G),P.bindFramebuffer.set(D.particleFramebuffer.framebuffer),function(J,Q,se,te){let ne=J.context,ce=ne.gl,he=Q.paint.get("raster-particle-max-speed"),xe=te*Q.paint.get("raster-particle-speed-factor")*.15,de=function(Me){return Math.pow(Me,6)}(.01+1*Q.paint.get("raster-particle-reset-rate-factor")),oe=Q.particleFramebuffer;ne.viewport.set([0,0,oe.width,oe.height]);for(let Me of se){let[,Ee,me]=Me;ne.activeTexture.set(ce.TEXTURE0+0),Ee.texture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE),ne.activeTexture.set(ce.TEXTURE0+1);let je=me.particleTexture0;je.bind(ce.NEAREST,ce.CLAMP_TO_EDGE);let Fe=Rm(1,je.size[0],0,Ee.texture.size,he,xe,de,Ee.textureOffset,Ee.scale,Ee.offset);oe.colorAttachment.set(me.particleTexture1.texture),ne.clear({color:r.C.transparent}),J.getOrCreateProgram("rasterParticleUpdate",{defines:Ee.defines}).draw(J,ce.TRIANGLES,r.af.disabled,r.ah.disabled,r.a.unblended,r.ag.disabled,Fe,Q.id,J.viewportBuffer,J.quadTriangleIndexBuffer,J.viewportSegments)}}(w,D,G,K)}(d,i,a,f),d.renderPass==="translucent"&&(function(w,E,D,C,P){let O=w.context,F=O.gl,z=E.getSource().tileSize,U=5*(1-r.a0(r.aV,r.aV+1,w.transform.zoom))*z+D.paint.get("raster-particle-elevation"),$=!w.options.moving,G=w.transform.projection.name==="globe";if(!C.length)return;let[H,K]=w.stencilConfigForOverlap(C),J=[];G&&J.push("PROJECTION_GLOBE_VIEW");let Q=w.stencilModeFor3D();for(let se of K){let te=se.toUnwrapped(),ne=E.getTile(se);if(!ne.rasterParticleState)continue;let ce=ne.rasterParticleState,he=100;ne.registerFadeDuration(he);let xe=E.findLoadedParent(se,0),de=Fu(ne,xe,E,w.transform,he),oe,Me;w.terrain&&w.terrain.prepareDrawTile(),O.activeTexture.set(F.TEXTURE0),ce.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),O.activeTexture.set(F.TEXTURE1),xe&&xe.rasterParticleState?(xe.rasterParticleState.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),oe=Math.pow(2,xe.tileID.overscaledZ-ne.tileID.overscaledZ),Me=[ne.tileID.canonical.x*oe%1,ne.tileID.canonical.y*oe%1]):ce.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);let Ee=G?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(te,$),me=w.transform,je=qu(me),Fe=r.be(se.canonical),be=r.bf(Fe.getCenter().lat),Ae,fe,Ne,Be,Ke;G?(Ae=Float32Array.from(r.bh(r.bi(se.canonical))),fe=Float32Array.from(me.globeMatrix),Ne=Float32Array.from(r.bd(me)),Be=[r.ak(me.center.lng),r.al(me.center.lat)],Ke=Float32Array.from(r.bg(se.canonical,Fe,be,me.worldSize/me._pixelsPerMercatorPixel))):(Ae=new Float32Array(16),fe=new Float32Array(9),Ne=new Float32Array(16),Be=[0,0],Ke=new Float32Array(9));let et=Bs(Ee,Ae,fe,Ne,Ke,Me||[0,0],r.a2(w.transform.zoom),Be,je,oe||1,de,U),at=w.isTileAffectedByFog(se),nt=w.getOrCreateProgram("rasterParticle",{defines:J,overrideFog:at});if(w.uploadCommonUniforms(O,nt,te),G){let mt=new r.af(F.LEQUAL,r.af.ReadOnly,w.depthRangeFor3D),At=0,_t=w.globeSharedBuffers;if(_t){let[kt,Ht,kn]=_t.getGridBuffers(be,At!==0);nt.draw(w,F.TRIANGLES,mt,Q,r.a.alphaBlended,w.renderElevatedRasterBackface?r.ag.frontCCW:r.ag.backCCW,et,D.id,kt,Ht,kn)}}else{let mt=w.depthModeForSublayer(0,r.af.ReadOnly),At=H[se.overscaledZ],{tileBoundsBuffer:_t,tileBoundsIndexBuffer:kt,tileBoundsSegments:Ht}=w.getTileBoundsBuffers(ne);nt.draw(w,F.TRIANGLES,mt,At,r.a.alphaBlended,r.ag.disabled,et,D.id,_t,kt,Ht)}}w.resetStencilClippingMasks()}(d,i,a,f),d.style.map.triggerRepaint())},background:function(d,i,a,f){let _=a.paint.get("background-color"),v=a.paint.get("background-opacity"),w=a.paint.get("background-emissive-strength");if(v===0)return;let E=d.context,D=E.gl,C=d.transform,P=C.tileSize,O=a.paint.get("background-pattern"),F;if(O!==void 0&&(O===null||(F=d.imageManager.getPattern(O.toString(),a.scope,d.style.getLut(a.scope)),!F)))return;let z=!O&&_.a===1&&v===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==z)return;let U=r.ah.disabled,$=d.depthModeForSublayer(0,z==="opaque"?r.af.ReadWrite:r.af.ReadOnly),G=d.colorModeForDrapableLayerRenderPass(w),H=O?"backgroundPattern":"background",K,J=f;J||(K=d.getBackgroundTiles(),J=Object.values(K).map(Q=>Q.tileID)),O&&(E.activeTexture.set(D.TEXTURE0),d.imageManager.bind(d.context,a.scope));for(let Q of J){let se=d.isTileAffectedByFog(Q),te=d.getOrCreateProgram(H,{overrideFog:se}),ne=Q.toUnwrapped(),ce=f?Q.projMatrix:d.transform.calculateProjMatrix(ne);d.prepareDrawTile();let he=i?i.getTile(Q):K?K[Q.key]:new r.bA(Q,P,C.zoom,d),xe=O?u0(ce,w,v,d,0,a.scope,F,{tileID:Q,tileSize:P}):nf(ce,w,v,_.toRenderColor(a.lut));d.uploadCommonUniforms(E,te,ne);let{tileBoundsBuffer:de,tileBoundsIndexBuffer:oe,tileBoundsSegments:Me}=d.getTileBoundsBuffers(he);te.draw(d,D.TRIANGLES,$,U,G,r.ag.disabled,xe,a.id,de,oe,Me)}},sky:function(d,i,a){let f=d._atmosphere?r.a2(d.transform.zoom):1,_=a.paint.get("sky-opacity")*f;if(_===0)return;let v=d.context,w=a.paint.get("sky-type"),E=new r.af(v.gl.LEQUAL,r.af.ReadOnly,[0,1]),D=d.frameCounter/1e3%1;w==="atmosphere"?d.renderPass==="offscreen"?a.needsSkyboxCapture(d)&&(function(C,P,O,F){let z=C.context,U=z.gl,$=P.skyboxFbo;if(!$){$=P.skyboxFbo=z.createFramebuffer(32,32,!0,null),P.skyboxGeometry=new st(z),P.skyboxTexture=z.gl.createTexture(),U.bindTexture(U.TEXTURE_CUBE_MAP,P.skyboxTexture),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MAG_FILTER,U.LINEAR);for(let J=0;J<6;++J)U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+J,0,U.RGBA,32,32,0,U.RGBA,U.UNSIGNED_BYTE,null)}z.bindFramebuffer.set($.framebuffer),z.viewport.set([0,0,32,32]);let G=P.getCenter(C,!0),H=C.getOrCreateProgram("skyboxCapture"),K=new Float64Array(16);r.ae.identity(K),r.ae.rotateY(K,K,.5*-Math.PI),Kt(C,P,H,K,G,0),r.ae.identity(K),r.ae.rotateY(K,K,.5*Math.PI),Kt(C,P,H,K,G,1),r.ae.identity(K),r.ae.rotateX(K,K,.5*-Math.PI),Kt(C,P,H,K,G,2),r.ae.identity(K),r.ae.rotateX(K,K,.5*Math.PI),Kt(C,P,H,K,G,3),r.ae.identity(K),Kt(C,P,H,K,G,4),r.ae.identity(K),r.ae.rotateY(K,K,Math.PI),Kt(C,P,H,K,G,5),z.viewport.set([0,0,C.width,C.height])}(d,a),a.markSkyboxValid(d)):d.renderPass==="sky"&&function(C,P,O,F,z){let U=C.context,$=U.gl,G=C.transform,H=C.getOrCreateProgram("skybox");U.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_CUBE_MAP,P.skyboxTexture);let K=((J,Q,se,te,ne)=>({u_matrix:J,u_sun_direction:Q,u_cubemap:0,u_opacity:te,u_temporal_offset:ne}))(G.skyboxMatrix,P.getCenter(C,!1),0,F,z);C.uploadCommonUniforms(U,H),H.draw(C,$.TRIANGLES,O,r.ah.disabled,C.colorModeForRenderPass(),r.ag.backCW,K,"skybox",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(d,a,E,_,D):w==="gradient"&&d.renderPass==="sky"&&function(C,P,O,F,z){let U=C.context,$=U.gl,G=C.transform,H=C.getOrCreateProgram("skyboxGradient");P.skyboxGeometry||(P.skyboxGeometry=new st(U)),U.activeTexture.set($.TEXTURE0);let K=P.colorRampTexture;K||(K=P.colorRampTexture=new r.T(U,P.colorRamp,$.RGBA)),K.bind($.LINEAR,$.CLAMP_TO_EDGE);let J=((Q,se,te,ne,ce)=>({u_matrix:Q,u_color_ramp:0,u_center_direction:se,u_radius:r.ac(te),u_opacity:ne,u_temporal_offset:ce}))(G.skyboxMatrix,P.getCenter(C,!1),P.paint.get("sky-gradient-radius"),F,z);C.uploadCommonUniforms(U,H),H.draw(C,$.TRIANGLES,O,r.ah.disabled,C.colorModeForRenderPass(),r.ag.backCW,J,"skyboxGradient",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(d,a,E,_,D)},debug:function(d,i,a,f,_,v){for(let w=0;w<a.length;w++)if(_){let C=new r.C(f.r*.8,f.g*.8,f.b*.8,1);gt(d,i,a[w],f,-1,-1,v),gt(d,i,a[w],f,-1,1,v),gt(d,i,a[w],f,1,1,v),gt(d,i,a[w],f,1,-1,v),gt(d,i,a[w],C,0,0,v)}else gt(d,i,a[w],f,0,0,v)},custom:function(d,i,a,f){let _=d.context,v=a.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&a.isDraped(i)){if(d.renderPass==="offscreen"){let w=v.prerender;if(w){if(d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){let E=d.transform.pointMerc;w.call(v,_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),r.a2(d.transform.zoom),[E.x,E.y],d.transform.pixelsPerMeterRatio)}else w.call(v,_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){let E=v.renderToTile;if(E){let D=f[0].canonical,C=new r._(D.x+f[0].wrap*(1<<D.z),D.y,D.z);_.setDepthMode(r.af.disabled),_.setStencilMode(r.ah.disabled),_.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),E.call(v,_.gl,C),_.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),_.setStencilMode(r.ah.disabled);let w=v.renderingMode==="3d"?new r.af(d.context.gl.LEQUAL,r.af.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,r.af.ReadOnly);if(_.setDepthMode(w),d.transform.projection.name==="globe"){let E=d.transform.pointMerc;v.render(_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),r.a2(d.transform.zoom),[E.x,E.y],d.transform.pixelsPerMeterRatio)}else v.render(_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState(),_.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,i,a,f){if(d.renderPass==="opaque")return;let _=a.paint.get("model-opacity");if(_===0)return;let v=a.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!v||d.terrain&&_<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof r.Z))return;let w=d.shadowRenderer,E=a.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,E||(w.enabled=!1));let D=()=>{w&&(w.useNormalOffset=!0,E||(w.enabled=!0))},C=i.getSource();if(d.renderPass==="light-beam"&&C.type!=="batched-model")return;if(C.type==="vector"||C.type==="geojson")return function(H,K,J,Q,se){let te=H.transform;if(te.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${te.projection.name} projection is not yet implemented`);let ne=te.getFreeCameraOptions().position;if(!H.modelManager)return;let ce=H.modelManager;J.modelManager=ce;let he=H.shadowRenderer;if(!J._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let xe=J._unevaluatedLayout._values["model-id"],de=Rt({},J.layout.get("model-id").parameters),oe=H.style.order.indexOf(J.fqid);for(let Me of Q){let Ee=K.getTile(Me).getBucket(J);if(!Ee||Ee.projection.name!==te.projection.name)continue;let me=Ee.getModelUris();me&&!Ee.modelsRequested&&(ce.addModelsFromBucket(me,se),Ee.modelsRequested=!0);let je=pc(Me,te);de.zoom=je;let Fe=xe.possiblyEvaluate(de);if(fc(H,Ee,Me),Fi.shadowUniformsInitialized=!1,Fi.useSingleShadowCascade=!!he&&he.getMaxCascadeForTile(Me.toUnwrapped())===0,H.renderPass==="shadow"&&he){if(H.currentShadowCascade===1&&Ee.isInsideFirstShadowMapFrustum)continue;let fe=te.calculatePosMatrix(Me.toUnwrapped(),te.worldSize);if(Fi.tileMatrix.set(fe),Fi.shadowTileMatrix=Float32Array.from(he.calculateShadowPassMatrixFromMatrix(fe)),Fi.aabb.min.fill(0),Fi.aabb.max[0]=Fi.aabb.max[1]=r.a4,Fi.aabb.max[2]=0,Xr(Ee,Fi,H,J.scope))continue}let be=1<<Me.canonical.z,Ae=[((ne.x-Me.wrap)*be-Me.canonical.x)*r.a4,(ne.y*be-Me.canonical.y)*r.a4,ne.z*be*r.a4];H.conflationActive&&Object.keys(Ee.instancesPerModel).length>0&&H.style.isLayerClipped(J,K.getSource())&&Ee.updateReplacement(Me,H.replacementSource,oe,se)&&(Ee.uploaded=!1,Ee.upload(H.context));for(let fe in Ee.instancesPerModel){let Ne=Ee.instancesPerModel[fe];Ne.features.length>0&&(fe=Fe.evaluate(Ne.features[0].feature,{}));let Be=ce.getModel(fe,se);if(Be&&Be.uploaded)for(let Ke of Be.nodes)Xu(H,J,Ke,Ne,Ae,Me,Fi)}}}(d,i,a,f,C.type==="vector"?a.scope:""),void D();if(!C.loaded())return;if(C.type==="batched-model")return function(H,K,J,Q){J.resetLayerRenderingStats(H);let se=H.context,te=H.transform,ne=H.style.fog,ce=H.shadowRenderer;if(te.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${te.projection.name} projection is not yet implemented`);let he=H.transform.getFreeCameraOptions().position,xe=r.$.scale([],[he.x,he.y,he.z],H.transform.worldSize);r.$.negate(xe,xe);let de=r.ae.identity([]),oe=r.ci(te.center.lat,te.zoom),Me=r.ae.fromScaling([],[1,1,1/oe]);r.ae.translate(de,de,xe);let Ee=J.paint.get("model-opacity"),me=new r.af(se.gl.LEQUAL,r.af.ReadWrite,H.depthRangeFor3D),je=new r.af(se.gl.LEQUAL,r.af.ReadOnly,H.depthRangeFor3D),Fe=new r.b8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),be=H.renderPass==="shadow",Ae=be&&ce?ce.getCurrentCascadeFrustum():te.getFrustum(te.scaleZoom(te.worldSize)),fe=J.paint.get("model-front-cutoff"),Ne=fe[2]<1,Be=ni(H,J.paint.get("model-cutoff-fade-range")),Ke=J.getLayerRenderingStats();(function(et,at,nt,mt){let At=et.terrain?et.terrain.exaggeration():0,_t=et.transform.zoom;for(let kt of mt){let Ht=at.getTile(kt).getBucket(nt);Ht&&(et.conflationActive&&Ht.updateReplacement(kt,et.replacementSource),Ht.evaluateScale(et,nt),et.terrain&&At>0&&Ht.elevationUpdate(et.terrain,At,kt,nt.source),Ht.needsReEvaluation(et,_t,nt)&&Ht.evaluate(nt))}})(H,K,J,Q),function(){let et,at,nt;Ne?(et=Q.length-1,at=-1,nt=-1):(et=0,at=Q.length,nt=1);for(let mt=et;mt!==at;mt+=nt){let At=Q[mt],_t=K.getTile(At).getBucket(J);if(!_t||!_t.uploaded)continue;let kt=!1;ce&&(kt=ce.getMaxCascadeForTile(At.toUnwrapped())===0);let Ht=te.calculatePosMatrix(At.toUnwrapped(),te.worldSize),kn=_t.modelTraits,In=[];for(let Wt of _t.getNodesInfo()){if(Wt.hiddenByReplacement||!Wt.node.meshes)continue;let Tn=Wt.node,Bt=0;H.terrain&&Tn.elevation&&(Bt=Tn.elevation*H.terrain.exaggeration());let Vt=Wt.evaluatedScale;if(Vt[0]<=1&&Vt[1]<=1&&Vt[2]<=1&&(()=>{let Ir=Wt.aabb;return Fe.min=[...Ir.min],Fe.max=[...Ir.max],Fe.min[2]+=Bt,Fe.max[2]+=Bt,r.$.transformMat4(Fe.min,Fe.min,Ht),r.$.transformMat4(Fe.max,Fe.max,Ht),Fe})().intersects(Ae)===0)continue;let Pt=[...Ht],tn=Tn.anchor?Tn.anchor[0]:0,Ut=Tn.anchor?Tn.anchor[1]:0;r.ae.translate(Pt,Pt,[tn*(Vt[0]-1),Ut*(Vt[1]-1),Bt]),r.$.exactEquals(Vt,r.cl)||r.ae.scale(Pt,Pt,Vt);let xt=r.ae.multiply([],Pt,Tn.matrix),ir=r.ae.multiply([],te.expandedFarZProjMatrix,xt),or=r.ae.multiply([],te.expandedFarZProjMatrix,Pt),zr=r.aB.transformMat4([],[tn,Ut,Bt,1],ir)[2];Tn.hidden=!1;let Br=Ee;be||(Ne&&(Br*=jm(Pt,te,Wt.aabb,fe)),Br*=gi(Be,zr)),Br!==0?In.push({nodeInfo:Wt,depth:zr,opacity:Br,wvpForNode:ir,wvpForTile:or,nodeModelMatrix:xt,tileModelMatrix:Pt}):Tn.hidden=!0}be||In.sort((Wt,Tn)=>!Ne||Wt.opacity===1&&Tn.opacity===1?Wt.depth<Tn.depth?-1:1:Wt.opacity===1?-1:Tn.opacity===1?1:Wt.depth>Tn.depth?-1:1);for(let Wt of In){let Tn=Wt.nodeInfo,Bt=Tn.node,Vt=r.ae.multiply([],Me,Wt.tileModelMatrix);r.ae.multiply(Vt,de,Vt);let Pt=r.ae.invert([],Vt);r.ae.transpose(Pt,Pt),r.ae.scale(Pt,Pt,Yu),Vt=r.ae.multiply(Vt,Vt,Bt.matrix);let tn=H.renderPass==="light-beam",Ut=kn&r.cn.HasMapboxMeshFeatures,xt=Ut?0:Tn.evaluatedRMEA[0][2];for(let ir=0;ir<Bt.meshes.length;++ir){let or=Bt.meshes[ir],zr=ir===Bt.lightMeshIndex,Br=Wt.wvpForNode;if(zr){if(!tn&&!H.terrain&&H.shadowRenderer){H.currentLayer<H.firstLightBeamLayer&&(H.firstLightBeamLayer=H.currentLayer);continue}Br=Wt.wvpForTile}else if(tn)continue;let Ir={defines:[]},jr=[];if(Gs(Ir.defines,jr,or,H,J.lut),Ut||Ir.defines.push("DIFFUSE_SHADED"),kt&&Ir.defines.push("SHADOWS_SINGLE_CASCADE"),Ke&&(be?Ke.numRenderedVerticesInShadowPass+=or.vertexArray.length:Ke.numRenderedVerticesInTransparentPass+=or.vertexArray.length),be){df(or,Wt.nodeModelMatrix,H,J);continue}let yr=null;if(ne){let Ie=Ga(Wt.nodeModelMatrix,H.transform);if(yr=new Float32Array(Ie),te.projection.name!=="globe"){let Po=or.aabb.min,Yi=or.aabb.max,[Ro,Oo]=ne.getOpacityForBounds(Ie,Po[0],Po[1],Yi[0],Yi[1]);Ir.overrideFog=Ro>=an||Oo>=an}}let Mr=or.material,He;Mr.occlusionTexture&&Mr.occlusionTexture.offsetScale&&(He=Mr.occlusionTexture.offsetScale,Ir.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!be&&ce&&(ce.useNormalOffset=!!or.normalBuffer);let ct=H.getOrCreateProgram("model",Ir);!be&&ce&&ce.setupShadowsFromMatrix(Wt.tileModelMatrix,ct,ce.useNormalOffset),H.uploadCommonUniforms(se,ct,null,yr);let Yr=Mr.pbrMetallicRoughness;Yr.metallicFactor=.9,Yr.roughnessFactor=.5;let Rn=js(new Float32Array(Br),new Float32Array(Vt),new Float32Array(Pt),new Float32Array(Bt.matrix),H,Wt.opacity,Yr.baseColorFactor.toRenderColor(null),Mr.emissiveFactor,Yr.metallicFactor,Yr.roughnessFactor,Mr,xt,J,[0,0,0],He);!zr&&(Tn.hasTranslucentParts||Wt.opacity<1)&&ct.draw(H,se.gl.TRIANGLES,me,r.ah.disabled,r.a.disabled,r.ag.backCCW,Rn,J.id,or.vertexBuffer,or.indexBuffer,or.segments,J.paint,H.transform.zoom,void 0,jr),ct.draw(H,se.gl.TRIANGLES,zr?je:me,r.ah.disabled,zr||Wt.opacity<1||Tn.hasTranslucentParts?r.a.alphaBlended:r.a.unblended,r.ag.backCCW,Rn,J.id,or.vertexBuffer,or.indexBuffer,or.segments,J.paint,H.transform.zoom,void 0,jr)}}}}()}(d,i,a,f),void D();if(C.type!=="model")return;let P=C.getModels(),O=[],F=d.transform.getFreeCameraOptions().position,z=r.$.scale([],[F.x,F.y,F.z],d.transform.worldSize);r.$.negate(z,z);let U=[],$=[],G=0;for(let H of P){let K=a.paint.get("model-rotation").constantOr(null),J=a.paint.get("model-scale").constantOr(null),Q=a.paint.get("model-translation").constantOr(null);H.computeModelMatrix(d,K,J,Q,!0,!0,!1);let se=r.ae.identity([]),te=r.ci(H.position.lat,d.transform.zoom),ne=r.ae.fromScaling([],[1,1,1/te]);r.ae.translate(se,se,z),O.push({zScaleMatrix:ne,negCameraPosMatrix:se});for(let ce of H.nodes)Qn(d.transform,ce,H.matrix,d.transform.expandedFarZProjMatrix,G,U,$);G++}if(U.sort((H,K)=>K.depth-H.depth),d.renderPass!=="shadow"){if(_===1)for(let H of $)Fr(H,d,a,O[H.modelIndex],r.ah.disabled,d.colorModeForRenderPass());else{for(let H of $)Fr(H,d,a,O[H.modelIndex],r.ah.disabled,r.a.disabled);for(let H of $)Fr(H,d,a,O[H.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(let H of U)Fr(H,d,a,O[H.modelIndex],r.ah.disabled,d.colorModeForRenderPass());D()}else{for(let H of $)df(H.mesh,H.nodeModelMatrix,d,a);for(let H of U)df(H.mesh,H.nodeModelMatrix,d,a);D()}}},dr={model:function(d,i,a){let f=i.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,f.type==="vector"?d.scope:""));if(f.type==="batched-model"||f.type!=="model")return;let _=f.getModels();for(let v of _)v.upload(a.context)},raster:function(d,i,a){let f=i.getSource();if(!(f instanceof os&&f.loaded()))return;let _=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;let v=d.paint.get("raster-array-band")||f.getInitialBand(_);if(v==null)return;let w=i.getIds().map(E=>i.getTileByID(E));for(let E of w)E.updateNeeded(_,v)&&f.prepareTile(E,_,v)},"raster-particle":function(d,i,a){let f=i.getSource();if(!(f instanceof os&&f.loaded()))return;let _=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;let v=d.paint.get("raster-particle-array-band")||f.getInitialBand(_);if(v==null)return;let w=i.getIds().map(E=>i.getTileByID(E));for(let E of w)E.updateNeeded(_,v)&&f.prepareTile(E,_,v)}};class ff{constructor(i,a,f,_){this.context=new ba(i,a),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=r.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let v=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let E of v)this._debugParams.enabledLayers[E]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let E of v)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],E);this.occlusionParams=new Zi(_),this.setup(),this.numSublayers=r.bx.maxUnderzooming+r.bx.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.cp,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new l0(this),this._wireframeDebugCache=new ur,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];let w=new r.j({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,w,i.RGBA)}updateTerrain(i,a){let f=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new kr(this,i));let _=this._terrain;this.transform.elevation=f?_:null,_.update(i,this.transform,a),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(i){let a=i.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[f,_]=a.getFovAdjustedRange(this.transform._fov);if(f>_)return void(this.transform.fogCullDistSq=null);let v=f+.78*(_-f);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new kr(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,a){if(this.width=i*r.e.devicePixelRatio,this.height=a*r.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let f of this.style.order)this.style._mergedLayers[f].resize()}setup(){let i=this.context,a=new r.bv;a.emplaceBack(0,0),a.emplaceBack(r.a4,0),a.emplaceBack(0,r.a4),a.emplaceBack(r.a4,r.a4),this.tileExtentBuffer=i.createVertexBuffer(a,r.bt.members),this.tileExtentSegments=r.b.simpleSegment(0,0,4,2);let f=new r.bv;f.emplaceBack(0,0),f.emplaceBack(r.a4,0),f.emplaceBack(0,r.a4),f.emplaceBack(r.a4,r.a4),this.debugBuffer=i.createVertexBuffer(f,r.bt.members),this.debugSegments=r.b.simpleSegment(0,0,4,5);let _=new r.bv;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(_,r.bt.members),this.viewportSegments=r.b.simpleSegment(0,0,4,2);let v=new r.cq;v.emplaceBack(0,0,0,0),v.emplaceBack(r.a4,0,r.a4,0),v.emplaceBack(0,r.a4,0,r.a4),v.emplaceBack(r.a4,r.a4,r.a4,r.a4),this.mercatorBoundsBuffer=i.createVertexBuffer(v,r.cr.members),this.mercatorBoundsSegments=r.b.simpleSegment(0,0,4,2);let w=new r.bw;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(w);let E=new r.cs;for(let C of[0,1,3,2,0])E.emplaceBack(C);this.debugIndexBuffer=i.createIndexBuffer(E),this.emptyTexture=new r.T(i,new r.j({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=r.ae.create();let D=this.context.gl;this.stencilClearMode=new r.ah({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,r.af.disabled,this.stencilClearMode,r.a.disabled,r.ag.disabled,nc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,a,f){if(!a||this.currentStencilSource===a.id||!i.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(let D of f)if(this._tileClippingMaskIDs[D.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=a.id;let _=this.context,v=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(r.a.disabled),_.setDepthMode(r.af.disabled);let w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let E of f){let D=a.getTile(E),C=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:O,tileBoundsSegments:F}=this.getTileBoundsBuffers(D);w.draw(this,v.TRIANGLES,r.af.disabled,new r.ah({func:v.ALWAYS,mask:0},C,255,v.KEEP,v.KEEP,v.REPLACE),r.a.disabled,r.ag.disabled,nc(E.projMatrix),"$clipping",P,O,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let i=this.nextStencilID++,a=this.context.gl;return new r.ah({func:a.NOTEQUAL,mask:255},i,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);let a=this.context.gl;return new r.ah({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(i){let a=this.context.gl,f=i.sort((w,E)=>E.overscaledZ-w.overscaledZ),_=f[f.length-1].overscaledZ,v=f[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();let w={};for(let E=0;E<v;E++)w[E+_]=new r.ah({func:a.GEQUAL,mask:255},E+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=v,[w,f]}return[{[_]:r.ah.disabled},f]}colorModeForRenderPass(){let i=this.context.gl;return this._showOverdrawInspector?new r.a([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new r.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?r.a.unblended:r.a.alphaBlended}colorModeForDrapableLayerRenderPass(i){let a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new r.a([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new r.C(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,a,f,_=!1){if(this.depthOcclusion)return new r.af(this.context.gl.GREATER,r.af.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return r.af.disabled;let v=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new r.af(f||this.context.gl.LEQUAL,a,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){let i=this.context.gl,a=Math.ceil(this.width),f=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),v=i.getParameter(i.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&f!==0&&(this.depthFBO=new Jo(this.context,a,f,!1,"texture"),this.depthTexture=new r.T(this.context,{width:a,height:f,data:null},i.DEPTH_STENCIL),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),i.bindTexture(i.TEXTURE_2D,v),this.depthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),i.blitFramebuffer(0,0,a,f,0,0,a,f,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,a)=>i+a/this._fpsHistory.length,0))}render(i,a){let f=r.e.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=a;let _=this.style._mergedLayers,v=this.style.order.filter(de=>{let oe=_[de];return!(oe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[oe.type]}),w=!1,E=!1;for(let de of v){let oe=_[de];oe.type==="circle"&&(w=!0),oe.type==="symbol"&&(oe.hasInitialOcclusionOpacityProperties?E=!0:w=!0)}let D=v.map(de=>_[de]),C=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(r.e.now()),this.imageManager.beginFrame();let P=0,O=!1;for(let de in C){let oe=C[de];oe.used&&(oe.prepare(this.context),oe.getSource().usedInConflation&&++P)}let F=!1;for(let de of D)de.isHidden(this.transform.zoom)||(de.type==="clip"&&(F=!0),this.prepareLayer(de));let z={},U={},$={},G={},H={};for(let de in C){let oe=C[de];z[de]=oe.getVisibleCoordinates(),U[de]=z[de].slice().reverse(),$[de]=oe.getVisibleCoordinates(!0).reverse(),G[de]=oe.getShadowCasterCoordinates(),H[de]=oe.sortCoordinatesByDistance(z[de])}let K=de=>{let oe=this.style.getLayerSourceCache(de);return oe&&oe.used?oe.getSource():null};if(P||F){let de=[],oe=[],Me=0;for(let Ee of D)this.isSourceForClippingOrConflation(Ee,K(Ee))&&(de.push(Ee),oe.push(Me)),Me++;if(de&&(F||de.length>1)){let Ee=[];for(let me=0;me<de.length;me++){let je=de[me],Fe=oe[me],be=this.style.getLayerSourceCache(je);if(!be||!be.used||!be.getSource().usedInConflation&&je.type!=="clip")continue;let Ae=r.cv,fe=r.cw.None,Ne=[];if(je.type==="clip"){Ae=Fe;for(let Be of je.layout.get("clip-layer-types"))fe|=Be==="model"?r.cw.Model:Be==="symbol"?r.cw.Symbol:r.cw.FillExtrusion;for(let Be of je.layout.get("clip-layer-scope"))Ne.push(Be)}Ee.push({layer:je.fqid,cache:be,order:Ae,clipMask:fe,clipScope:Ne})}this.replacementSource.setSources(Ee),O=!0}}O||this.replacementSource.clear(),this.conflationActive=O,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let de=0;de<D.length;de++){let oe=D[de],Me=oe.cutoffRange();if(this.longestCutoffRange=Math.max(Me,this.longestCutoffRange),Me>0){let Ee=K(oe);Ee&&(this.minCutoffZoom=Math.max(Ee.minzoom,this.minCutoffZoom)),oe.minzoom&&(this.minCutoffZoom=Math.max(oe.minzoom,this.minCutoffZoom))}oe.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=de),this._lastOcclusionLayer=de)}let J=this.style&&this.style.fog;J?(this._fogVisible=J.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=J.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding($),this.opaquePassCutoff=0);let Q=this._shadowRenderer;if(Q){Q.updateShadowParameters(this.transform,this.style.directionalLight);for(let de in C)for(let oe of z[de]){let Me={min:0,max:0};this.terrain&&(Me=this.terrain.getMinMaxForTile(oe)||Me),Q.addShadowReceiver(oe.toUnwrapped(),Me.min,Me.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.ct(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Zu(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!r.cu(this.context.gl))return;this.renderPass="offscreen";for(let de of D){let oe=i.getLayerSourceCache(de);if(!de.hasOffscreenPass()||de.isHidden(this.transform.zoom))continue;let Me=oe?U[oe.id]:void 0;(de.type==="custom"||de.type==="raster"||de.type==="raster-particle"||de.isSky()||Me&&Me.length)&&this.renderLayer(this,oe,de,Me)}this.depthRangeFor3D=[0,1-(D.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,G)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let se=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),te=(()=>{if(a.showOverdrawInspector)return r.C.black;let de=this.style.fog;if(de&&this.transform.projection.supportsFog){let oe=this.style.getLut(de.scope);if(!se){let Me=de.properties.get("color").toRenderColor(oe).toArray01();return new r.C(...Me)}if(se){let Me=de.properties.get("space-color").toRenderColor(oe).toArray01();return new r.C(...Me)}}return r.C.transparent})();if(this.context.clear({color:te,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&se&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){let de=D[this.currentLayer],oe=i.getLayerSourceCache(de);if(de.isSky())continue;let Me=oe?(de.is3D()?H:U)[oe.id]:void 0;this._renderTileClippingMasks(de,oe,Me),this.renderLayer(this,oe,de,Me)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&se&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.a2(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){let de=D[this.currentLayer],oe=i.getLayerSourceCache(de);de.isSky()&&this.renderLayer(this,oe,de,oe?U[oe.id]:void 0)}function ne(de,oe){let Me;return oe&&(Me=(de.type==="symbol"?$:de.is3D()?H:U)[oe.id]),Me}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<v.length;){let de=D[this.currentLayer];if(de.type==="raster"||de.type==="raster-particle"){let oe=i.getLayerSourceCache(de);this.renderLayer(this,oe,de,ne(de,oe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ce=0;Q&&(ce=Q.getShadowCastingLayerCount());let he=!1,xe=-1;for(let de=0;de<v.length;++de){let oe=D[de];oe.isHidden(this.transform.zoom)||oe.is3D()&&(xe=de)}for(E&&xe===-1&&(w=!0);this.currentLayer<v.length;){let de=D[this.currentLayer],oe=i.getLayerSourceCache(de);if(de.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(de)){if(de.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(w&&!he&&this.terrain&&!this.transform.isOrthographic&&(he=!0,this.blitDepth()),E&&xe!==-1&&this.currentLayer===xe+1&&!this.transform.isOrthographic&&this.blitDepth(),de.is3D()||this.terrain||this._renderTileClippingMasks(de,oe,oe?z[oe.id]:void 0),this.renderLayer(this,oe,de,ne(de,oe)),!this.terrain&&Q&&ce>0&&de.hasShadowPass()&&--ce==0&&(Q.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let Me=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Me;this.currentLayer++){let Ee=D[this.currentLayer];if(!Ee.hasLightBeamPass())continue;let me=i.getLayerSourceCache(Ee);this.renderLayer(this,me,Ee,me?U[me.id]:void 0)}this.currentLayer=Me,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let Me=this.currentLayer;this.depthOcclusion=!0;for(let Ee of this.layersWithOcclusionOpacity){this.currentLayer=Ee;let me=D[this.currentLayer],je=i.getLayerSourceCache(me),Fe=je?U[je.id]:void 0;me.is3D()||this.terrain||this._renderTileClippingMasks(me,je,je?z[je.id]:void 0),this.renderLayer(this,je,me,Fe)}this.depthOcclusion=!1,this.currentLayer=Me,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let de=null;D.forEach(oe=>{let Me=i.getLayerSourceCache(oe);Me&&!oe.isHidden(this.transform.zoom)&&Me.getVisibleCoordinates().length&&(!de||de.getSource().maxzoom<Me.getSource().maxzoom)&&(de=Me)}),de&&this.options.showTileBoundaries&&Xi.debug(this,de,de.getVisibleCoordinates(),r.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Xi.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(de){let oe=de.transform.padding;uf(de,de.transform.height-(oe.top||0),3,lf),uf(de,oe.bottom||0,3,Wu),dc(de,oe.left||0,3,cf),dc(de,de.transform.width-(oe.right||0),3,hn);let Me=de.transform.centerPoint;(function(Ee,me,je,Fe){Ua(Ee,me-1,je-10,2,20,Fe),Ua(Ee,me-10,je-1,20,2,Fe)})(de,Me.x,de.transform.height-Me.y,p0)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),O||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);let{unsupportedLayers:a}=this.transform.projection,f=!a||!a.includes(i.type);if(dr[i.type]&&(f||this.terrain&&i.type==="custom")){let _=this.style.getLayerSourceCache(i);dr[i.type](i,_,this)}this.gpuTimingEnd()}renderLayer(i,a,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||_&&_.length)&&(this.id=f.id,this.gpuTimingStart(f),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(f.type)&&(!i.terrain||f.type!=="custom")||f.type==="clip"||Xi[f.type](i,a,f,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;let a=this.context.extTimerQuery,f=this.context.gl,_=this.gpuTimers[i.id];_||(_=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:f.createQuery()}),_.calls++,f.beginQuery(a.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let i=this.context.extTimerQuery,a=this.context.gl,f=a.createQuery();this.deferredRenderGpuTimeQueries.push(f),a.beginQuery(i.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){let i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){let a={};for(let f in i){let _=i[f],v=this.context.extTimerQuery,w=v.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(_.query),a[f]=w}return a}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;let a=this.context.extTimerQuery,f=this.context.gl,_=0;for(let v of i)_+=a.getQueryParameter(v,f.QUERY_RESULT)/1e6,a.deleteQueryEXT(v);return _}translatePosMatrix(i,a,f,_,v){if(!f[0]&&!f[1])return i;let w=v?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(w){let C=Math.sin(w),P=Math.cos(w);f=[f[0]*P-f[1]*C,f[0]*C+f[1]*P]}let E=[v?f[0]:r.bD(a,f[0],this.transform.zoom),v?f[1]:r.bD(a,f[1],this.transform.zoom),0],D=new Float32Array(16);return r.ae.translate(D,i,E),D}saveTileTexture(i){let a=i.size[0],f=this._tileTextures[a];f?f.push(i):this._tileTextures[a]=[i]}getTileTexture(i){let a=this._tileTextures[i];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,a,f){let _=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,v=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||v.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?v.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):v.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||_||a!==void 0&&!a||v.push("FOG","FOG_DITHERING"),_&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(i,a){this.cache=this.cache||{};let f=a&&a.defines||[],_=a&&a.config,v=this.currentGlobalDefines(i,a&&a.overrideFog,a&&a.overrideRtt).concat(f),w=Qd.cacheKey(ym[i],i,v,_);return this.cache[w]||(this.cache[w]=new Qd(this.context,i,ym[i],_,Om[i],v)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,a){if(this.style.enable3dLights()){let f=this.style.directionalLight,_=this.style.ambientLight;if(f&&_){let v=((w,E,D)=>{let C=w.properties.get("direction"),P=w.properties.get("color").toRenderColor(D.getLut(w.scope)).toArray01(),O=w.properties.get("intensity"),F=E.properties.get("color").toRenderColor(D.getLut(E.scope)).toArray01(),z=E.properties.get("intensity"),U=[C.x,C.y,C.z],$=r.bC(F,z),G=r.bC(P,O);return{u_lighting_ambient_color:$,u_lighting_directional_dir:U,u_lighting_directional_color:G,u_ground_radiance:Mm(U,G,$)}})(f,_,this.style);a.setLightsUniformValues(i,v)}}}uploadCommonUniforms(i,a,f,_,v){if(this.uploadCommonLightUniforms(i,a),this.terrain&&this.terrain.renderingToTexture)return;let w=this.style.fog;if(w){let E=w.getOpacity(this.transform.pitch),D=((C,P,O,F,z,U,$,G,H,K,J,Q)=>{let se=C.transform,te=P.properties.get("color").toRenderColor(C.style.getLut(P.scope)).toArray01();te[3]=F;let ne=C.frameCounter/1e3%1,[ce,he]=P.properties.get("vertical-range");return{u_fog_matrix:O?se.calculateFogTileMatrix(O):Q||C.identityMat,u_fog_range:P.getFovAdjustedRange(se._fov),u_fog_color:te,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ce,he),he],u_fog_temporal_offset:ne,u_frustum_tl:z,u_frustum_tr:U,u_frustum_br:$,u_frustum_bl:G,u_globe_pos:H,u_globe_radius:K,u_viewport:J,u_globe_transition:r.a2(se.zoom),u_is_globe:+(se.projection.name==="globe")}})(this,w,f,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.e.devicePixelRatio,this.transform.height*r.e.devicePixelRatio],_);a.setFogUniformValues(i,D)}v&&a.setCutoffUniformValues(i,v.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){let i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){let i=this.context.gl,a=i.createTexture();return i.bindTexture(i.TEXTURE_2D,a),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let i=this._backgroundTiles,a=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(let _ of f)a[_.key]=i[_.key]||new r.bA(_,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,a){return!(!i.is3D()||i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||i.sourceLayer!=="building")&&i.type!=="clip"&&(!a||a.type!=="batched-model"))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[i.key];return a||(this._cachedTileFogOpacities[i.key]=a=this.style.fog.getOpacityForTile(i)),a[0]>=an||a[1]>=an}setupDepthForOcclusion(i,a,f){let _=this.context,v=_.gl,w=!!f;var E;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(v.TEXTURE3),i&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((E=this.depthRangeFor3D)[1]-E[0]),-1-2*E[0]/(E[1]-E[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),_.activeTexture.set(v.TEXTURE0),w||a.setTerrainUniformValues(_,f)}}class _i{constructor(i,a,f,_){this.screenBounds=i,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(i,a){let f,_;if(i instanceof r.P||typeof i[0]=="number"){let v=r.P.convert(i);f=[v],_=a.isPointAboveHorizon(v)}else{let v=r.P.convert(i[0]),w=r.P.convert(i[1]);f=[v,w],_=r.cx(v,w).every(E=>a.isPointAboveHorizon(E))}return new _i(f,a.getCameraPoint(),_,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return r.cx(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){let a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],_=r.cx(a,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<f.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?_[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(_[3]=this.cameraPoint)),r.cy(_,i)}bufferedCameraGeometryGlobe(i){let a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],_=r.cx(a,f,i),v=this.cameraPoint.clone();switch(3*((v.y>a.y)+(v.y>f.y))+((v.x>a.x)+(v.x>f.x))){case 0:_[0]=v,_[4]=v.clone();break;case 1:_.splice(1,0,v);break;case 2:_[1]=v;break;case 3:_.splice(4,0,v);break;case 5:_.splice(2,0,v);break;case 6:_[3]=v;break;case 7:_.splice(3,0,v);break;case 8:_[2]=v}return _}containsTile(i,a,f,_=0){let v=i.queryPadding/a._pixelsPerMercatorPixel+1,w=f?this._bufferedCameraMercator(v,a):this._bufferedScreenMercator(v,a),E=i.tileID.wrap+(w.unwrapped?_:0),D=w.polygon.map(G=>r.cz(i.tileTransform,G,E));if(!r.cA(D,0,0,r.a4,r.a4))return;E=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);let C=this.screenGeometryMercator.polygon.map(G=>r.cB(i.tileTransform,G,E)),P=C.map(G=>new r.P(G[0],G[1])),O=a.getFreeCameraOptions().position||new r._(0,0,0),F=r.cB(i.tileTransform,O,E),z=C.map(G=>{let H=r.$.sub(G,G,F);return r.$.normalize(H,H),new r.aU(F,H)}),U=r.bD(i,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:z,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:($=r.cC(D),$.min.x=r.au($.min.x,0,r.a4),$.min.y=r.au($.min.y,0,r.a4),$.max.x=r.au($.max.x,0,r.a4),$.max.y=r.au($.max.y,0,r.a4),$),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:U};var $}_bufferedScreenMercator(i,a){let f=ss(i);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let _;return _=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),a):{polygon:this.bufferedScreenGeometry(i).map(v=>a.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[f]=_,_}}_bufferedCameraMercator(i,a){let f=ss(i);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let _;return _=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),a):{polygon:this.bufferedCameraGeometry(i).map(v=>a.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[f]=_,_}}_projectAndResample(i,a){let f=function(v,w){let E=r.ae.multiply([],w.pixelMatrix,w.globeMatrix),D=[0,-r.cF,0,1],C=[0,r.cF,0,1],P=[0,0,0,1];r.aB.transformMat4(D,D,E),r.aB.transformMat4(C,C,E),r.aB.transformMat4(P,P,E);let O=new r.P(D[0]/D[3],D[1]/D[3]),F=new r.P(C[0]/C[3],C[1]/C[3]),z=r.cD(v,O)&&D[3]<P[3],U=r.cD(v,F)&&C[3]<P[3];if(!z&&!U)return null;let $=function(ne,ce,he){for(let xe=1;xe<ne.length;xe++){let de=Do(ce.pointCoordinate3D(ne[xe-1]).x),oe=Do(ce.pointCoordinate3D(ne[xe]).x);if(he<0){if(de<oe)return{idx:xe,t:-de/(oe-1-de)}}else if(oe<de)return{idx:xe,t:(1-de)/(oe+1-de)}}return null}(v,w,z?-1:1);if(!$)return null;let{idx:G,t:H}=$,K=G>1?Hs(v.slice(0,G),w):[],J=G<v.length?Hs(v.slice(G),w):[];K=K.map(ne=>new r.P(Do(ne.x),ne.y)),J=J.map(ne=>new r.P(Do(ne.x),ne.y));let Q=[...K];Q.length===0&&Q.push(J[J.length-1]);let se=r.a3(Q[Q.length-1].y,(J.length===0?K[0]:J[0]).y,H),te;return te=z?[new r.P(0,se),new r.P(0,0),new r.P(1,0),new r.P(1,se)]:[new r.P(1,se),new r.P(1,1),new r.P(0,1),new r.P(0,se)],Q.push(...te),J.length===0?Q.push(K[0]):Q.push(...J),{polygon:Q.map(ne=>new r._(ne.x,ne.y)),unwrapped:!1}}(i,a);if(f)return f;let _=function(v,w){let E=!1,D=-1/0,C=0;for(let O=0;O<v.length-1;O++)v[O].x>D&&(D=v[O].x,C=O);for(let O=0;O<v.length-1;O++){let F=(C+O)%(v.length-1),z=v[F],U=v[F+1];Math.abs(z.x-U.x)>.5&&(z.x<U.x?(z.x+=1,F===0&&(v[v.length-1].x+=1)):(U.x+=1,F+1===v.length-1&&(v[0].x+=1)),E=!0)}let P=r.ak(w.center.lng);return E&&P<Math.abs(P-1)&&v.forEach(O=>{O.x-=1}),{polygon:v,unwrapped:E}}(Hs(i,a).map(v=>new r.P(Do(v.x),v.y)),a);return{polygon:_.polygon.map(v=>new r._(v.x,v.y)),unwrapped:_.unwrapped}}}function Hs(d,i){return r.cE(d,a=>{let f=i.pointCoordinate3D(a);a.x=f.x,a.y=f.y},1/256)}function Do(d){return d<0?1+d%1:d%1}function ss(d){return 100*d|0}function m0(d,i){let a=r.ae.identity([]);return r.ae.scale(a,a,[.5*d.width,.5*-d.height,1]),r.ae.translate(a,a,[1,-1,0]),r.ae.multiply(a,a,d.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(a)}function Co(d,i,a,f,_,v,w,E=!1){let D=d.tilesIn(f,w,E);D.sort(pf);let C=[];for(let O of D)C.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(i,a,d._state,O,_,v,m0(d.transform,O.tile.tileID),E)});let P=function(O){let F={},z={};for(let U of O){let $=U.queryResults,G=U.wrappedTileID,H=z[G]=z[G]||{};for(let K in $){let J=$[K],Q=H[K]=H[K]||{},se=F[K]=F[K]||[];for(let te of J)Q[te.featureIndex]||(Q[te.featureIndex]=!0,se.push(te))}}return F}(C);for(let O in P)P[O].forEach(F=>{let z=F.feature,U=z.layer;U&&U.type!=="background"&&U.type!=="sky"&&U.type!=="slot"&&(z.source=U.source,U["source-layer"]&&(z.sourceLayer=U["source-layer"]),z.state=z.id!==void 0?d.getFeatureState(U["source-layer"],z.id):{})});return P}function g0(d,i){let a=d.getRenderableIds().map(v=>d.getTileByID(v)),f=[],_={};for(let v=0;v<a.length;v++){let w=a[v],E=w.tileID.canonical.key;_[E]||(_[E]=!0,w.querySourceFeatures(f,i))}return f}function pf(d,i){let a=d.tileID,f=i.tileID;return a.overscaledZ-f.overscaledZ||a.canonical.y-f.canonical.y||a.wrap-f.wrap||a.canonical.x-f.canonical.x}class ai{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let i=!1,a=!1;for(let f in this.style._mergedLayers){let _=this.style._mergedLayers[f];if(_.type==="fill-extrusion")this.layers.push({layer:_,visible:i,visibilityChanged:a});else if(_.type==="model"){let v=this.style.getLayerSource(_);v&&v.type==="batched-model"&&this.layers.push({layer:_,visible:i,visibilityChanged:a})}}}onNewFrame(i){this.layersGotHidden=!1;for(let a of this.layers){let f=a.layer,_=!1;f.type==="fill-extrusion"?_=!f.isHidden(i)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="model"&&(_=!f.isHidden(i)&&f.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!_&&a.visible,a.visible=_}}updateZOffset(i,a){this.currentBuildingBuckets=[];for(let _ of this.layers){let v=_.layer,w=this.style.getLayerSourceCache(v),E=1;v.type==="fill-extrusion"&&(E=_.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let D=w?w.getTile(a):null;if(!D&&w&&a.canonical.z>w.getSource().minzoom){let C=a.scaledTo(Math.min(w.getSource().maxzoom,a.overscaledZ-1));for(;C.overscaledZ>=w.getSource().minzoom&&(D=w.getTile(C),!D&&C.overscaledZ!==0);)C=C.scaledTo(C.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:D?D.getBucket(v):null,tileID:D?D.tileID:a,verticalScale:E})}i.hasAnyZOffset=!1;let f=!1;for(let _=0;_<i.symbolInstances.length;_++){let v=i.symbolInstances.get(_),w=v.zOffset,E=this._getHeightAtTileOffset(a,v.tileAnchorX,v.tileAnchorY);v.zOffset=E!==Number.NEGATIVE_INFINITY?E:w,f||w===v.zOffset||(f=!0),i.hasAnyZOffset||v.zOffset===0||(i.hasAnyZOffset=!0)}f&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,a,f,_){let v=a,w=f;if(i.canonical.z!==_.canonical.z){let E=_.canonical,D=1/(1<<i.canonical.z-E.z);v=(a+i.canonical.x*r.a4)*D-E.x*r.a4|0,w=(f+i.canonical.y*r.a4)*D-E.y*r.a4|0}return{tileX:v,tileY:w}}_getHeightAtTileOffset(i,a,f){let _,v;for(let w=0;w<this.layers.length;++w){if(this.layers[w].layer.type!=="fill-extrusion")continue;let{bucket:E,tileID:D,verticalScale:C}=this.currentBuildingBuckets[w];if(!E)continue;let{tileX:P,tileY:O}=this._mapCoordToOverlappingTile(i,a,f,D),F=E.getHeightAtTileCoord(P,O);F&&F.height!==void 0&&(F.hidden?_=F.height:v=Math.max(F.height*C,v||0))}if(v!==void 0)return v;for(let w=0;w<this.layers.length;++w){let E=this.layers[w];if(E.layer.type!=="model"||!E.visible)continue;let{bucket:D,tileID:C}=this.currentBuildingBuckets[w];if(!D)continue;let{tileX:P,tileY:O}=this._mapCoordToOverlappingTile(i,a,f,C),F=D.getHeightAtTileCoord(P,O);if(F&&!F.hidden)return F.height===void 0&&_!==void 0?Math.min(F.maxHeight,_)*F.verticalScale:F.height?F.height*F.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function _0(d,i){let a={};for(let f in d)f!=="ref"&&(a[f]=d[f]);return r.cG.forEach(f=>{f in i&&(a[f]=i[f])}),a}function mc(d){d=d.slice();let i=Object.create(null);for(let a=0;a<d.length;a++)i[d[a].id]=d[a];for(let a=0;a<d.length;a++)"ref"in d[a]&&(d[a]=_0(d[a],i[d[a].ref]));return d}let dn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function qa(d,i,a){a.push({command:dn.addSource,args:[d,i[d]]})}function Vm(d,i,a){i.push({command:dn.removeSource,args:[d]}),a[d]=!0}function y0(d,i,a,f){Vm(d,a,f),qa(d,i,a)}function gc(d,i,a){let f;for(f in d[a])if(d[a].hasOwnProperty(f)&&f!=="data"&&!r.d(d[a][f],i[a][f]))return!1;for(f in i[a])if(i[a].hasOwnProperty(f)&&f!=="data"&&!r.d(d[a][f],i[a][f]))return!1;return!0}function as(d,i,a,f,_,v){let w;for(w in i=i||{},d=d||{})d.hasOwnProperty(w)&&(r.d(d[w],i[w])||a.push({command:v,args:[f,w,i[w],_]}));for(w in i)i.hasOwnProperty(w)&&!d.hasOwnProperty(w)&&(r.d(d[w],i[w])||a.push({command:v,args:[f,w,i[w],_]}))}function Qu(d){return d.id}function So(d,i){return d[i.id]=i,d}class Um{constructor(i,a){this.reset(i,a)}reset(i,a){this.points=i||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=r.au(i,0,1);let a=1,f=this._distances[a],_=i*this.paddedLength+this.padding;for(;f<_&&a<this._distances.length;)f=this._distances[++a];let v=a-1,w=this._distances[v],E=f-w,D=E>0?(_-w)/E:0;return this.points[v].mult(1-D).add(this.points[a].mult(D))}}class _c{constructor(i,a,f){let _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(i/f),this.yCellCount=Math.ceil(a/f);for(let w=0;w<this.xCellCount*this.yCellCount;w++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=a,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,a,f,_,v){this._forEachCell(a,f,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(a),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(i,a,f,_){this._forEachCell(a-_,f-_,a+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(a),this.circles.push(f),this.circles.push(_)}_insertBoxCell(i,a,f,_,v,w){this.boxCells[v].push(w)}_insertCircleCell(i,a,f,_,v,w){this.circleCells[v].push(w)}_query(i,a,f,_,v,w){if(f<0||i>this.width||_<0||a>this.height)return!v&&[];let E=[];if(i<=0&&a<=0&&this.width<=f&&this.height<=_){if(v)return!0;for(let D=0;D<this.boxKeys.length;D++)E.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){let C=this.circles[3*D],P=this.circles[3*D+1],O=this.circles[3*D+2];E.push({key:this.circleKeys[D],x1:C-O,y1:P-O,x2:C+O,y2:P+O})}return w?E.filter(w):E}return this._forEachCell(i,a,f,_,this._queryCell,E,{hitTest:v,seenUids:{box:{},circle:{}}},w),v?E.length>0:E}_queryCircle(i,a,f,_,v){let w=i-f,E=i+f,D=a-f,C=a+f;if(E<0||w>this.width||C<0||D>this.height)return!_&&[];let P=[];return this._forEachCell(w,D,E,C,this._queryCellCircle,P,{hitTest:_,circle:{x:i,y:a,radius:f},seenUids:{box:{},circle:{}}},v),_?P.length>0:P}query(i,a,f,_,v){return this._query(i,a,f,_,!1,v)}hitTest(i,a,f,_,v){return this._query(i,a,f,_,!0,v)}hitTestCircle(i,a,f,_){return this._queryCircle(i,a,f,!0,_)}_queryCell(i,a,f,_,v,w,E,D){let C=E.seenUids,P=this.boxCells[v];if(P!==null){let F=this.bboxes;for(let z of P)if(!C.box[z]){C.box[z]=!0;let U=4*z;if(i<=F[U+2]&&a<=F[U+3]&&f>=F[U+0]&&_>=F[U+1]&&(!D||D(this.boxKeys[z]))){if(E.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[z],x1:F[U],y1:F[U+1],x2:F[U+2],y2:F[U+3]})}}}let O=this.circleCells[v];if(O!==null){let F=this.circles;for(let z of O)if(!C.circle[z]){C.circle[z]=!0;let U=3*z;if(this._circleAndRectCollide(F[U],F[U+1],F[U+2],i,a,f,_)&&(!D||D(this.circleKeys[z]))){if(E.hitTest)return w.push(!0),!0;{let $=F[U],G=F[U+1],H=F[U+2];w.push({key:this.circleKeys[z],x1:$-H,y1:G-H,x2:$+H,y2:G+H})}}}}}_queryCellCircle(i,a,f,_,v,w,E,D){let C=E.circle,P=E.seenUids,O=this.boxCells[v];if(O!==null){let z=this.bboxes;for(let U of O)if(!P.box[U]){P.box[U]=!0;let $=4*U;if(this._circleAndRectCollide(C.x,C.y,C.radius,z[$+0],z[$+1],z[$+2],z[$+3])&&(!D||D(this.boxKeys[U])))return w.push(!0),!0}}let F=this.circleCells[v];if(F!==null){let z=this.circles;for(let U of F)if(!P.circle[U]){P.circle[U]=!0;let $=3*U;if(this._circlesCollide(z[$],z[$+1],z[$+2],C.x,C.y,C.radius)&&(!D||D(this.circleKeys[U])))return w.push(!0),!0}}}_forEachCell(i,a,f,_,v,w,E,D){let C=this._convertToXCellCoord(i),P=this._convertToYCellCoord(a),O=this._convertToXCellCoord(f),F=this._convertToYCellCoord(_);for(let z=C;z<=O;z++)for(let U=P;U<=F;U++)if(v.call(this,i,a,f,_,this.xCellCount*U+z,w,E,D))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,a,f,_,v,w){let E=_-i,D=v-a,C=f+w;return C*C>E*E+D*D}_circleAndRectCollide(i,a,f,_,v,w,E){let D=(w-_)/2,C=Math.abs(i-(_+D));if(C>D+f)return!1;let P=(E-v)/2,O=Math.abs(a-(v+P));if(O>P+f)return!1;if(C<=D||O<=P)return!0;let F=C-D,z=O-P;return F*F+z*z<=f*f}}let Nr=100;class v0{constructor(i,a,f=new _c(i.width+200,i.height+200,25),_=new _c(i.width+200,i.height+200,25)){this.transform=i,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Nr,this.screenBottomBoundary=i.height+Nr,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=a}placeCollisionBox(i,a,f,_,v,w,E,D){let C=f.projectedAnchorX,P=f.projectedAnchorY,O=f.projectedAnchorZ,F=f.elevation,z=f.tileID,U=i.getProjection();if(F&&z){let[te,ne,ce]=U.upVector(z.canonical,f.tileAnchorX,f.tileAnchorY),he=U.upVectorScale(z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;C+=te*F*he,P+=ne*F*he,O+=ce*F*he}let $=this.projectAndGetPerspectiveRatio(E,C,P,O,f.tileID,U.name==="globe"||!!F||this.transform.pitch>0,U),G=w*$.perspectiveRatio,H=(f.x1*a+_.x-f.padding)*G+$.point.x,K=(f.y1*a+_.y-f.padding)*G+$.point.y,J=(f.x2*a+_.x+f.padding)*G+$.point.x,Q=(f.y2*a+_.y+f.padding)*G+$.point.y,se=$.perspectiveRatio<=.55||$.occluded;return!this.isInsideGrid(H,K,J,Q)||!v&&this.grid.hitTest(H,K,J,Q,D)||se?{box:[],offscreen:!1,occluded:$.occluded}:{box:[H,K,J,Q],offscreen:this.isOffscreen(H,K,J,Q),occluded:!1}}placeCollisionCircles(i,a,f,_,v,w,E,D,C,P,O,F,z,U,$){let G=[],H=this.transform.elevation,K=i.getProjection(),J=H?H.getAtTileOffsetFunc($,this.transform.center.lat,this.transform.worldSize,K):null,Q=new r.P(f.tileAnchorX,f.tileAnchorY),{x:se,y:te,z:ne}=K.projectTilePoint(Q.x,Q.y,$.canonical);if(J){let[Fe,be,Ae]=J(Q);se+=Fe,te+=be,ne+=Ae}let ce=K.name==="globe",he=this.projectAndGetPerspectiveRatio(E,se,te,ne,$,ce||!!H||this.transform.pitch>0,K),{perspectiveRatio:xe}=he,de=(O?w/xe:w*xe)/r.bP,oe=Wi(se,te,ne,D),Me=he.signedDistanceFromCamera>0?Xl(de,v,f.lineOffsetX*de,f.lineOffsetY*de,!1,oe,Q,f,_,D,{},H&&!O?J:null,O&&!!H,K,$,O):null,Ee=!1,me=!1,je=!0;if(Me&&!he.occluded){let Fe=.5*z*xe+U,be=new r.P(-100,-100),Ae=new r.P(this.screenRightBoundary,this.screenBottomBoundary),fe=new Um,{first:Ne,last:Be}=Me,Ke=Ne.path.length,et=[];for(let mt=Ke-1;mt>=1;mt--)et.push(Ne.path[mt]);for(let mt=1;mt<Be.path.length;mt++)et.push(Be.path[mt]);let at=2.5*Fe;C&&(et=et.map(([mt,At,_t],kt)=>(J&&!ce&&(_t=J(kt<Ke-1?Ne.tilePath[Ke-1-kt]:Be.tilePath[kt-Ke+2])[2]),Wi(mt,At,_t,C))),et.some(mt=>mt[3]<=0)&&(et=[]));let nt=[];if(et.length>0){let mt=1/0,At=-1/0,_t=1/0,kt=-1/0;for(let Ht of et)mt=Math.min(mt,Ht[0]),_t=Math.min(_t,Ht[1]),At=Math.max(At,Ht[0]),kt=Math.max(kt,Ht[1]);At>=be.x&&mt<=Ae.x&&kt>=be.y&&_t<=Ae.y&&(nt=[et.map(Ht=>new r.P(Ht[0],Ht[1]))],(mt<be.x||At>Ae.x||_t<be.y||kt>Ae.y)&&(nt=r.cH(nt,be.x,be.y,Ae.x,Ae.y)))}for(let mt of nt){fe.reset(mt,.25*Fe);let At=0;At=fe.length<=.5*Fe?1:Math.ceil(fe.paddedLength/at)+1;for(let _t=0;_t<At;_t++){let kt=_t/Math.max(At-1,1),Ht=fe.lerp(kt),kn=Ht.x+Nr,In=Ht.y+Nr;G.push(kn,In,Fe,0);let Wt=kn-Fe,Tn=In-Fe,Bt=kn+Fe,Vt=In+Fe;if(je=je&&this.isOffscreen(Wt,Tn,Bt,Vt),me=me||this.isInsideGrid(Wt,Tn,Bt,Vt),!a&&this.grid.hitTestCircle(kn,In,Fe,F)&&(Ee=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Ee,occluded:!1}}}}return{circles:!P&&Ee||!me?[]:G,offscreen:je,collisionDetected:Ee,occluded:he.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let a=[],f=1/0,_=1/0,v=-1/0,w=-1/0;for(let P of i){let O=new r.P(P.x+Nr,P.y+Nr);f=Math.min(f,O.x),_=Math.min(_,O.y),v=Math.max(v,O.x),w=Math.max(w,O.y),a.push(O)}let E=this.grid.query(f,_,v,w).concat(this.ignoredGrid.query(f,_,v,w)),D={},C={};for(let P of E){let O=P.key;if(D[O.bucketInstanceId]===void 0&&(D[O.bucketInstanceId]={}),D[O.bucketInstanceId][O.featureIndex])continue;let F=[new r.P(P.x1,P.y1),new r.P(P.x2,P.y1),new r.P(P.x2,P.y2),new r.P(P.x1,P.y2)];r.cI(a,F)&&(D[O.bucketInstanceId][O.featureIndex]=!0,C[O.bucketInstanceId]===void 0&&(C[O.bucketInstanceId]=[]),C[O.bucketInstanceId].push(O.featureIndex))}return C}insertCollisionBox(i,a,f,_,v){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:v},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,a,f,_,v){let w=a?this.ignoredGrid:this.grid,E={bucketInstanceId:f,featureIndex:_,collisionGroupID:v};for(let D=0;D<i.length;D+=4)w.insertCircle(E,i[D],i[D+1],i[D+2])}projectAndGetPerspectiveRatio(i,a,f,_,v,w,E){let D=[a,f,_,1],C=!1;_||this.transform.pitch>0?(r.aB.transformMat4(D,D,i),this.fogState&&v&&E.name!=="globe"&&(C=function(F,z,U,$,G,H){let K=H.calculateFogTileMatrix(G),J=[z,U,$];return r.$.transformMat4(J,J,K),Yt(F,r.$.length(J),H.pitch,H._fov)}(this.fogState,a,f,_,v.toUnwrapped(),this.transform)>.9)):Wd(D,D,i);let P=D[3];return{point:new r.P((D[0]/P+1)/2*this.transform.width+Nr,(-D[1]/P+1)/2*this.transform.height+Nr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/P*.5,1.5),signedDistanceFromCamera:P,occluded:w&&D[2]>P||C}}isOffscreen(i,a,f,_){return f<Nr||i>=this.screenRightBoundary||_<Nr||a>this.screenBottomBoundary}isInsideGrid(i,a,f,_){return f>=0&&i<this.gridRightBoundary&&_>=0&&a<this.gridBottomBoundary}getViewportMatrix(){let i=r.ae.identity([]);return r.ae.translate(i,i,[-100,-100,0]),i}}class $m{constructor(i,a,f,_){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?a:-a))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class yc{constructor(i,a,f,_,v,w=!1){this.text=new $m(i?i.text:null,a,f,v),this.icon=new $m(i?i.icon:null,a,_,v),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ku{constructor(i,a,f,_=!1){this.text=i,this.icon=a,this.skipFade=f,this.clipped=_}}class x0{constructor(){this.invProjMatrix=r.ae.create(),this.viewportMatrix=r.ae.create(),this.circles=[]}}class mf{constructor(i,a,f,_,v){this.bucketInstanceId=i,this.featureIndex=a,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=v}}class Gm{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){let a=++this.maxGroupID;this.collisionGroups[i]={ID:a,predicate:f=>f.collisionGroupID===a}}return this.collisionGroups[i]}}function gf(d,i,a,f,_){let{horizontalAlign:v,verticalAlign:w}=r.bS(d),E=-(v-.5)*i,D=-(w-.5)*a,C=r.bR(d,f);return new r.P(E+C[0]*_,D+C[1]*_)}function Ju(d,i,a,f,_){let v=new r.P(d,i);return a&&v._rotate(f?_:-_),v}class Hm{constructor(i,a,f,_,v,w){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new v0(this.transform,v),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Gm(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,a,f,_){let v=f.getBucket(a),w=f.latestFeatureIndex;if(!v||!w||a.fqid!==v.layerIds[0])return;let E=v.layers[0].layout,D=f.collisionBoxArray,C=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),P=f.tileSize/r.a4,O=f.tileID.toUnwrapped();this.transform.setProjection(v.projection);let F=(z=f.tileID,U=v.getProjection(),$=this.transform,U.name===this.projection?$.calculateProjMatrix(z.toUnwrapped()):Vs($,U,z));var z,U,$;let G=E.get("text-pitch-alignment")==="map",H=E.get("text-rotation-alignment")==="map";a.compileFilter();let K=a.dynamicFilter(),J=a.dynamicFilterNeedsFeature(),Q=this.transform.calculatePixelsToTileUnitsMatrix(f),se=Ru(F,f.tileID.canonical,G,H,this.transform,v.getProjection(),Q),te=null;if(G){let he=Ou(F,f.tileID.canonical,G,H,this.transform,v.getProjection(),Q);te=r.ae.multiply([],this.transform.labelPlaneMatrix,he)}let ne=null;K&&f.latestFeatureIndex&&(ne={unwrappedTileID:O,dynamicFilter:K,dynamicFilterNeedsFeature:J,featureIndex:f.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new mf(v.bucketInstanceId,w,v.sourceLayerIndex,v.index,f.tileID);let ce={bucket:v,layout:E,posMatrix:F,textLabelPlaneMatrix:se,labelToScreenMatrix:te,clippingData:ne,scale:C,textPixelRatio:P,holdingForFade:f.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:r.aE(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.aE(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(_)for(let he of v.sortKeyRanges){let{sortKey:xe,symbolInstanceStart:de,symbolInstanceEnd:oe}=he;i.push({sortKey:xe,symbolInstanceStart:de,symbolInstanceEnd:oe,parameters:ce})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ce})}attemptAnchorPlacement(i,a,f,_,v,w,E,D,C,P,O,F,z,U,$,G,H,K){let{textOffset0:J,textOffset1:Q,crossTileID:se}=F,te=[J,Q],ne=gf(i,f,_,te,v),ce=this.collisionIndex.placeCollisionBox(U,v,a,Ju(ne.x,ne.y,w,E,this.transform.angle),O,D,C,P.predicate);if(G){let he=U.getSymbolInstanceIconSize(K,this.transform.zoom,F.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(U,he,G,Ju(ne.x,ne.y,w,E,this.transform.angle),O,D,C,P.predicate).box.length===0)return}if(ce.box.length>0){let he;return this.prevPlacement&&this.prevPlacement.variableOffsets[se]&&this.prevPlacement.placements[se]&&this.prevPlacement.placements[se].text&&(he=this.prevPlacement.variableOffsets[se].anchor),this.variableOffsets[se]={textOffset:te,width:f,height:_,anchor:i,textScale:v,prevAnchor:he},this.markUsedJustification(U,i,F,$),U.allowVerticalPlacement&&(this.markUsedOrientation(U,$,F),this.placedOrientations[se]=$),{shift:ne,placedGlyphBoxes:ce}}}placeLayerBucketPart(i,a,f,_){let{bucket:v,layout:w,posMatrix:E,textLabelPlaneMatrix:D,labelToScreenMatrix:C,clippingData:P,textPixelRatio:O,holdingForFade:F,collisionBoxArray:z,partiallyEvaluatedTextSize:U,partiallyEvaluatedIconSize:$,collisionGroup:G}=i.parameters,H=w.get("text-optional"),K=w.get("icon-optional"),J=w.get("text-allow-overlap"),Q=w.get("icon-allow-overlap"),se=w.get("text-rotation-alignment")==="map",te=w.get("text-pitch-alignment")==="map",ne=w.get("symbol-z-order")==="viewport-y",ce=w.get("symbol-z-elevate");this.transform.setProjection(v.projection);let he=J&&(Q||!v.hasIconData()||K),xe=Q&&(J||!v.hasTextData()||H);!v.collisionArrays&&z&&v.deserializeCollisionBoxes(z),f&&_&&v.updateCollisionDebugBuffers(this.transform.zoom,z);let de=(oe,Me,Ee)=>{let{crossTileID:me,numVerticalGlyphVertices:je}=oe;if(P){let Bt={zoom:this.transform.zoom,pitch:this.transform.pitch},Vt=null;if(P.dynamicFilterNeedsFeature){let Pt=this.retainedQueryData[v.bucketInstanceId];Vt=P.featureIndex.loadFeature({featureIndex:oe.featureIndex,bucketIndex:Pt.bucketIndex,sourceLayerIndex:Pt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,P.dynamicFilter)(Bt,Vt,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new r.P(oe.tileAnchorX,oe.tileAnchorY),this.transform.calculateDistanceTileData(P.unwrappedTileID)))return this.placements[me]=new Ku(!1,!1,!1,!0),void a.add(me)}if(a.has(me))return;if(F)return void(this.placements[me]=new Ku(!1,!1,!1));let Fe=!1,be=!1,Ae=!0,fe=!1,Ne=!1,Be=null,Ke={box:null,offscreen:null,occluded:null},et={box:null,offscreen:null,occluded:null},at=null,nt=null,mt=null,At=0,_t=0,kt=0;Ee.textFeatureIndex?At=Ee.textFeatureIndex:oe.useRuntimeCollisionCircles&&(At=oe.featureIndex),Ee.verticalTextFeatureIndex&&(_t=Ee.verticalTextFeatureIndex);let Ht=Bt=>{Bt.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;let Vt=this.transform.elevation;Bt.elevation=oe.zOffset+(Vt?Vt.getAtTileOffset(Bt.tileID,Bt.tileAnchorX,Bt.tileAnchorY):0)},kn=Ee.textBox;if(kn){Ht(kn);let Bt=Pt=>{let tn=r.aF.horizontal;if(v.allowVerticalPlacement&&!Pt&&this.prevPlacement){let Ut=this.prevPlacement.placedOrientations[me];Ut&&(this.placedOrientations[me]=Ut,tn=Ut,this.markUsedOrientation(v,tn,oe))}return tn},Vt=(Pt,tn)=>{if(v.allowVerticalPlacement&&je>0&&Ee.verticalTextBox){for(let Ut of v.writingModes)if(Ut===r.aF.vertical?(Ke=tn(),et=Ke):Ke=Pt(),Ke&&Ke.box&&Ke.box.length)break}else Ke=Pt()};if(w.get("text-variable-anchor")){let Pt=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[me]){let xt=this.prevPlacement.variableOffsets[me];Pt.indexOf(xt.anchor)>0&&(Pt=Pt.filter(ir=>ir!==xt.anchor),Pt.unshift(xt.anchor))}let tn=(xt,ir,or)=>{let zr=v.getSymbolInstanceTextSize(U,oe,this.transform.zoom,Me),Br=(xt.x2-xt.x1)*zr+2*xt.padding,Ir=(xt.y2-xt.y1)*zr+2*xt.padding,jr=oe.hasIconTextFit&&!Q?ir:null;jr&&Ht(jr);let yr={box:[],offscreen:!1,occluded:!1},Mr=J?2*Pt.length:Pt.length;for(let He=0;He<Mr;++He){let ct=this.attemptAnchorPlacement(Pt[He%Pt.length],xt,Br,Ir,zr,se,te,O,E,G,He>=Pt.length,oe,Me,v,or,jr,U,$);if(ct&&(yr=ct.placedGlyphBoxes,yr&&yr.box&&yr.box.length)){Fe=!0,Be=ct.shift;break}}return yr};Vt(()=>tn(kn,Ee.iconBox,r.aF.horizontal),()=>{let xt=Ee.verticalTextBox;return xt&&Ht(xt),v.allowVerticalPlacement&&!(Ke&&Ke.box&&Ke.box.length)&&je>0&&xt?tn(xt,Ee.verticalIconBox,r.aF.vertical):{box:null,offscreen:null,occluded:null}}),Ke&&(Fe=Ke.box,Ae=Ke.offscreen,fe=Ke.occluded);let Ut=Bt(!(!Ke||!Ke.box));if(!Fe&&this.prevPlacement){let xt=this.prevPlacement.variableOffsets[me];xt&&(this.variableOffsets[me]=xt,this.markUsedJustification(v,xt.anchor,oe,Ut))}}else{let Pt=(tn,Ut)=>{let xt=v.getSymbolInstanceTextSize(U,oe,this.transform.zoom,Me),ir=this.collisionIndex.placeCollisionBox(v,xt,tn,new r.P(0,0),J,O,E,G.predicate);return ir&&ir.box&&ir.box.length&&(this.markUsedOrientation(v,Ut,oe),this.placedOrientations[me]=Ut),ir};Vt(()=>Pt(kn,r.aF.horizontal),()=>{let tn=Ee.verticalTextBox;return v.allowVerticalPlacement&&je>0&&tn?(Ht(tn),Pt(tn,r.aF.vertical)):{box:null,offscreen:null,occluded:null}}),Bt(!!(Ke&&Ke.box&&Ke.box.length))}}if(at=Ke,Fe=at&&at.box&&at.box.length>0,Ae=at&&at.offscreen,fe=at&&at.occluded,oe.useRuntimeCollisionCircles){let Bt=v.text.placedSymbolArray.get(oe.centerJustifiedTextSymbolIndex>=0?oe.centerJustifiedTextSymbolIndex:oe.verticalPlacedTextSymbolIndex),Vt=r.aG(v.textSizeData,U,Bt),Pt=w.get("text-padding");nt=this.collisionIndex.placeCollisionCircles(v,J,Bt,v.lineVertexArray,v.glyphOffsetArray,Vt,E,D,C,f,te,G.predicate,oe.collisionCircleDiameter*Vt/r.bP,Pt,this.retainedQueryData[v.bucketInstanceId].tileID),Fe=J||nt.circles.length>0&&!nt.collisionDetected,Ae=Ae&&nt.offscreen,fe=nt.occluded}if(Ee.iconFeatureIndex&&(kt=Ee.iconFeatureIndex),Ee.iconBox){let Bt=Vt=>{Ht(Vt);let Pt=oe.hasIconTextFit&&Be?Ju(Be.x,Be.y,se,te,this.transform.angle):new r.P(0,0),tn=v.getSymbolInstanceIconSize($,this.transform.zoom,oe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,tn,Vt,Pt,Q,O,E,G.predicate)};et&&et.box&&et.box.length&&Ee.verticalIconBox?(mt=Bt(Ee.verticalIconBox),be=mt.box.length>0):(mt=Bt(Ee.iconBox),be=mt.box.length>0),Ae=Ae&&mt.offscreen,Ne=mt.occluded}let In=H||oe.numHorizontalGlyphVertices===0&&je===0,Wt=K||oe.numIconVertices===0;if(In||Wt?Wt?In||(be=be&&Fe):Fe=be&&Fe:be=Fe=be&&Fe,Fe&&at&&at.box&&this.collisionIndex.insertCollisionBox(at.box,w.get("text-ignore-placement"),v.bucketInstanceId,et&&et.box&&_t?_t:At,G.ID),be&&mt&&this.collisionIndex.insertCollisionBox(mt.box,w.get("icon-ignore-placement"),v.bucketInstanceId,kt,G.ID),nt&&(Fe&&this.collisionIndex.insertCollisionCircles(nt.circles,w.get("text-ignore-placement"),v.bucketInstanceId,At,G.ID),f)){let Bt=v.bucketInstanceId,Vt=this.collisionCircleArrays[Bt];Vt===void 0&&(Vt=this.collisionCircleArrays[Bt]=new x0);for(let Pt=0;Pt<nt.circles.length;Pt+=4)Vt.circles.push(nt.circles[Pt+0]),Vt.circles.push(nt.circles[Pt+1]),Vt.circles.push(nt.circles[Pt+2]),Vt.circles.push(nt.collisionDetected?1:0)}let Tn=v.projection.name!=="globe";he=he&&(Tn||!fe),xe=xe&&(Tn||!Ne),this.placements[me]=new Ku(Fe||he,be||xe,Ae||v.justReloaded),a.add(me)};if(ce&&this.buildingIndex&&(this.buildingIndex.updateZOffset(v,this.retainedQueryData[v.bucketInstanceId].tileID),v.updateZOffset()),ne){let oe=v.getSortedSymbolIndexes(this.transform.angle);for(let Me=oe.length-1;Me>=0;--Me){let Ee=oe[Me];de(v.symbolInstances.get(Ee),Ee,v.collisionArrays[Ee])}v.hasAnyZOffset&&r.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){let oe=v.getSortedIndexesByZOffset();for(let Me=0;Me<oe.length;++Me){let Ee=oe[Me];de(v.symbolInstances.get(Ee),Ee,v.collisionArrays[Ee])}}else for(let oe=i.symbolInstanceStart;oe<i.symbolInstanceEnd;oe++)de(v.symbolInstances.get(oe),oe,v.collisionArrays[oe]);if(f&&v.bucketInstanceId in this.collisionCircleArrays){let oe=this.collisionCircleArrays[v.bucketInstanceId];r.ae.invert(oe.invProjMatrix,E),oe.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(i,a,f,_){let{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:D,crossTileID:C}=f,P=r.cM(a),O=_===r.aF.vertical?D:P==="left"?v:P==="center"?w:P==="right"?E:-1;v>=0&&(i.text.placedSymbolArray.get(v).crossTileID=O>=0&&v!==O?0:C),w>=0&&(i.text.placedSymbolArray.get(w).crossTileID=O>=0&&w!==O?0:C),E>=0&&(i.text.placedSymbolArray.get(E).crossTileID=O>=0&&E!==O?0:C),D>=0&&(i.text.placedSymbolArray.get(D).crossTileID=O>=0&&D!==O?0:C)}markUsedOrientation(i,a,f){let _=a===r.aF.horizontal||a===r.aF.horizontalOnly?a:0,v=a===r.aF.vertical?a:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:C}=f,P=i.text.placedSymbolArray;w>=0&&(P.get(w).placedOrientation=_),E>=0&&(P.get(E).placedOrientation=_),D>=0&&(P.get(D).placedOrientation=_),C>=0&&(P.get(C).placedOrientation=v)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;let a=this.prevPlacement,f=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;let _=a?a.symbolFadeChange(i):1,v=a?a.opacities:{},w=a?a.variableOffsets:{},E=a?a.placedOrientations:{};for(let D in this.placements){let C=this.placements[D],P=v[D];P?(this.opacities[D]=new yc(P,_,C.text,C.icon,null,C.clipped),f=f||C.text!==P.text.placed||C.icon!==P.icon.placed):(this.opacities[D]=new yc(null,_,C.text,C.icon,C.skipFade,C.clipped),f=f||C.text||C.icon)}for(let D in v){let C=v[D];if(!this.opacities[D]){let P=new yc(C,_,!1,!1);P.isHidden()||(this.opacities[D]=P,f=f||C.text.placed||C.icon.placed)}}for(let D in w)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=w[D]);for(let D in E)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=E[D]);f?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:i)}updateLayerOpacities(i,a,f,_){let v=new Set;for(let w of a){let E=w.getBucket(i);E&&w.latestFeatureIndex&&i.fqid===E.layerIds[0]&&(this.updateBucketOpacities(E,v,w.collisionBoxArray,f,_,w.tileID,i.scope),E.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(E,w.tileID),E.updateZOffset()))}}updateBucketOpacities(i,a,f,_,v,w,E){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();let D=i.layers[0].layout,C=!!i.layers[0].dynamicFilter(),P=new yc(null,0,!1,!1,!0),O=D.get("text-allow-overlap"),F=D.get("icon-allow-overlap"),z=D.get("text-variable-anchor"),U=D.get("text-rotation-alignment")==="map",$=D.get("text-pitch-alignment")==="map",G=new yc(null,0,O&&(F||!i.hasIconData()||D.get("icon-optional")),F&&(O||!i.hasTextData()||D.get("text-optional")),!0);!i.collisionArrays&&f&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(f);let H=(J,Q,se)=>{for(let te=0;te<Q/4;te++)J.opacityVertexArray.emplaceBack(se)},K=0;v&&i.updateReplacement(w,v);for(let J=0;J<i.symbolInstances.length;J++){let Q=i.symbolInstances.get(J),{numHorizontalGlyphVertices:se,numVerticalGlyphVertices:te,crossTileID:ne,numIconVertices:ce,tileAnchorX:he,tileAnchorY:xe}=Q,de=a.has(ne),oe=this.opacities[ne];de?oe=P:oe||(oe=G,this.opacities[ne]=oe),a.add(ne);let Me=se>0||te>0,Ee=ce>0,me=this.placedOrientations[ne],je=me===r.aF.vertical,Fe=me===r.aF.horizontal||me===r.aF.horizontalOnly;!Me&&!Ee||oe.isHidden()||K++;let be=!1;if((Me||Ee)&&v)for(let Ae of i.activeReplacements){if(r.cJ(Ae,_,r.cw.Symbol,E)||Ae.min.x>he||he>Ae.max.x||Ae.min.y>xe||xe>Ae.max.y)continue;let fe=r.cK(he,xe,w.canonical,Ae.footprintTileId.canonical);if(be=r.cL(fe,Ae),be)break}if(Me){let Ae=be?ls:yi(oe.text);H(i.text,se,je?ls:Ae),H(i.text,te,Fe?ls:Ae);let fe=oe.text.isHidden(),{leftJustifiedTextSymbolIndex:Ne,centerJustifiedTextSymbolIndex:Be,rightJustifiedTextSymbolIndex:Ke,verticalPlacedTextSymbolIndex:et}=Q,at=i.text.placedSymbolArray,nt=fe||je?1:0;Ne>=0&&(at.get(Ne).hidden=nt),Be>=0&&(at.get(Be).hidden=nt),Ke>=0&&(at.get(Ke).hidden=nt),et>=0&&(at.get(et).hidden=fe||Fe?1:0);let mt=this.variableOffsets[ne];mt&&this.markUsedJustification(i,mt.anchor,Q,me);let At=this.placedOrientations[ne];At&&(this.markUsedJustification(i,"left",Q,At),this.markUsedOrientation(i,At,Q))}if(Ee){let Ae=be?ls:yi(oe.icon),{placedIconSymbolIndex:fe,verticalPlacedIconSymbolIndex:Ne}=Q,Be=i.icon.placedSymbolArray,Ke=oe.icon.isHidden()?1:0;fe>=0&&(H(i.icon,ce,je?ls:Ae),Be.get(fe).hidden=Ke),Ne>=0&&(H(i.icon,Q.numVerticalIconVertices,Fe?ls:Ae),Be.get(Ne).hidden=Ke)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){let Ae=i.collisionArrays[J];if(Ae){let fe=new r.P(0,0),Ne=!0;if(Ae.textBox||Ae.verticalTextBox){if(z){let Ke=this.variableOffsets[ne];Ke?(fe=gf(Ke.anchor,Ke.width,Ke.height,Ke.textOffset,Ke.textScale),U&&fe._rotate($?this.transform.angle:-this.transform.angle)):Ne=!1}C&&(Ne=!oe.clipped),Ae.textBox&&ho(i.textCollisionBox.collisionVertexArray,oe.text.placed,!Ne||je,fe.x,fe.y),Ae.verticalTextBox&&ho(i.textCollisionBox.collisionVertexArray,oe.text.placed,!Ne||Fe,fe.x,fe.y)}let Be=Ne&&!!(!Fe&&Ae.verticalIconBox);Ae.iconBox&&ho(i.iconCollisionBox.collisionVertexArray,oe.icon.placed,Be,Q.hasIconTextFit?fe.x:0,Q.hasIconTextFit?fe.y:0),Ae.verticalIconBox&&ho(i.iconCollisionBox.collisionVertexArray,oe.icon.placed,!Be,Q.hasIconTextFit?fe.x:0,Q.hasIconTextFit?fe.y:0)}}}if(i.fullyClipped=K===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){let J=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=J.invProjMatrix,i.placementViewportMatrix=J.viewportMatrix,i.collisionCircleArray=J.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,a){let f=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*f>i}setStale(){this.stale=!0}}function ho(d,i,a,f,_){d.emplaceBack(i?1:0,a?1:0,f||0,_||0),d.emplaceBack(i?1:0,a?1:0,f||0,_||0),d.emplaceBack(i?1:0,a?1:0,f||0,_||0),d.emplaceBack(i?1:0,a?1:0,f||0,_||0)}let eh=Math.pow(2,25),qm=Math.pow(2,24),Wm=Math.pow(2,17),vc=Math.pow(2,16),xc=Math.pow(2,9),Zm=Math.pow(2,8),_f=Math.pow(2,1);function yi(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;let i=d.placed?1:0,a=Math.floor(127*d.opacity);return a*eh+i*qm+a*Wm+i*vc+a*xc+i*Zm+a*_f+i}let ls=0;class Xe{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,a,f,_,v){let w=this._bucketParts;for(;this._currentTileIndex<i.length;)if(a.getBucketParts(w,_,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((E,D)=>E.sortKey-D.sortKey));this._currentPartIndex<w.length;){let E=w[this._currentPartIndex];if(a.placeLayerBucketPart(E,this._seenCrossTileIDs,f,E.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class Xm{constructor(i,a,f,_,v,w,E,D,C){this.placement=new Hm(i,v,w,E,D,C),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(i,a,f,_){let v=r.e.now(),w=()=>{let E=r.e.now()-v;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){let E=a[i[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=D)&&(!E.maxzoom||E.maxzoom>D)){let C=E,P=C.layout.get("symbol-z-elevate"),O=this._inProgressLayer=this._inProgressLayer||new Xe(C),F=r.am(E.source,E.scope);if(O.continuePlacement(P?_[F]:f[F],this.placement,this._showCollisionBoxes,E,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}let bc=512/r.a4/2;class yf{constructor(i,a,f){this.tileID=i,this.bucketInstanceId=f,this.index=new r.cN(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let _=i.canonical.x*r.a4,v=i.canonical.y*r.a4;for(let w=0;w<a.length;w++){let{key:E,crossTileID:D,tileAnchorX:C,tileAnchorY:P}=a.get(w),O=Math.floor((_+C)*bc),F=Math.floor((v+P)*bc);this.index.add(O,F),this.keys.push(E),this.crossTileIDs.push(D)}this.index.finish()}findMatches(i,a,f){let _=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),v=bc/Math.pow(2,a.canonical.z-this.tileID.canonical.z),w=a.canonical.x*r.a4,E=a.canonical.y*r.a4;for(let D=0;D<i.length;D++){let C=i.get(D);if(C.crossTileID)continue;let{key:P,tileAnchorX:O,tileAnchorY:F}=C,z=Math.floor((w+O)*v),U=Math.floor((E+F)*v),$=this.index.range(z-_,U-_,z+_,U+_);for(let G of $){let H=this.crossTileIDs[G];if(this.keys[G]===P&&!f.has(H)){f.add(H),C.crossTileID=H;break}}}}}class Ym{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class th{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){let a=Math.round((i-this.lng)/360);if(a!==0)for(let f in this.indexes){let _=this.indexes[f],v={};for(let w in _){let E=_[w];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+a),v[E.tileID.key]=E}this.indexes[f]=v}this.lng=i}addBucket(i,a,f){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let v=0;v<a.symbolInstances.length;v++)a.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);let _=this.usedCrossTileIDs[i.overscaledZ];for(let v in this.indexes){let w=this.indexes[v];if(Number(v)>i.overscaledZ)for(let E in w){let D=w[E];D.tileID.isChildOf(i)&&D.findMatches(a.symbolInstances,i,_)}else{let E=w[i.scaledTo(Number(v)).key];E&&E.findMatches(a.symbolInstances,i,_)}}for(let v=0;v<a.symbolInstances.length;v++){let w=a.symbolInstances.get(v);w.crossTileID||(w.crossTileID=f.generate(),_.add(w.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new yf(i,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(i,a){for(let f of a.crossTileIDs)this.usedCrossTileIDs[i].delete(f)}removeStaleBuckets(i){let a=!1;for(let f in this.indexes){let _=this.indexes[f];for(let v in _)i[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[v]),delete _[v],a=!0)}return a}}class Ao{constructor(){this.layerIndexes={},this.crossTileIDs=new Ym,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,a,f,_){let v=this.layerIndexes[i.fqid];v===void 0&&(v=this.layerIndexes[i.fqid]=new th);let w=!1,E={};_.name!=="globe"&&v.handleWrapJump(f);for(let D of a){let C=D.getBucket(i);C&&i.fqid===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(D.tileID,C,this.crossTileIDs)&&(w=!0),E[C.bucketInstanceId]=!0)}return v.removeStaleBuckets(E)&&(w=!0),w}pruneUnusedLayers(i){let a={};i.forEach(f=>{a[f]=!0});for(let f in this.layerIndexes)a[f]||delete this.layerIndexes[f]}}let vf=new r.U({data:new r.W(r.N.colorTheme.data)}),vi=(d,i)=>pt(d,i&&i.filter(a=>a.identifier!=="source.canvas")),nh=r.ai(dn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Wa=r.ai(dn,["setCenter","setZoom","setBearing","setPitch"]),Qm={version:8,layers:[],sources:{}},Km={duration:300,delay:0};class xi extends r.E{constructor(i,a={}){super(),this.map=i,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=r.Q({},Km),this._buildingIndex=new ai(this),this.crossTileSymbolIndex=new Ao,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new Sr,this.dispatcher=a.dispatcher?a.dispatcher:new r.by(r.bz(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new Ai,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new r.cP(i._requestManager,a.localFontFamily?r.cQ.all:a.localIdeographFontFamily?r.cQ.ideographs:r.cQ.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new wa(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",r.cR());let f=this;this._rtlTextPluginCallback=xi.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,w)=>{if(r.cS(v),w&&w.every(E=>E))for(let E in f._sourceCaches){let D=f._sourceCaches[E],C=D.getSource().type;C!=="vector"&&C!=="geojson"||D.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;let v=this.getOwnSource(_.sourceId);if(v&&v.vectorLayerIds)for(let w in this._layers){let E=this._layers[w];E.source===v.id&&this._validateLayer(E)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(r.cT(i))return i;let a=r.cU(i);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${r.cV(JSON.stringify(i))}`}_diffStyle(i,a,f){this.globalId=this._getGlobalId(i);let _=(v,w)=>{try{w(null,this.setState(v,f))}catch(E){w(E,!1)}};if(typeof i=="string"){let v=this.map._requestManager.normalizeStyleURL(i),w=this.map._requestManager.transformRequest(v,r.R.Style);r.h(w,(E,D)=>{E?this.fire(new r.f(E)):D&&_(D,a)})}else typeof i=="object"&&_(i,a)}loadURL(i,a={}){this.fire(new r.g("dataloading",{dataType:"style"}));let f=typeof a.validate=="boolean"?a.validate:!r.cT(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,a.accessToken),this.resolvedImports.add(i);let _=this.importsCache.get(i);if(_)return this._load(_,f);let v=this.map._requestManager.transformRequest(i,r.R.Style);this._request=r.h(v,(w,E)=>{if(this._request=null,w)this.fire(new r.f(w));else if(E)return this.importsCache.set(i,E),this._load(E,f)})}loadJSON(i,a={}){this.fire(new r.g("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=r.e.frame(()=>{this._request=null,this._load(i,a.validate!==!1)})}loadEmpty(){this.fire(new r.g("dataloading",{dataType:"style"})),this._load(Qm,!1)}_loadImports(i,a,f){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let _=[];for(let v of i){let w=this._createFragmentStyle(v),E=new Promise(P=>{w.once("style.import.load",P),w.once("error",P)}).then(()=>this.mergeAll());if(_.push(E),this.resolvedImports.has(v.url)){w.loadEmpty();continue}let D=v.data||this.importsCache.get(v.url);D?(w.loadJSON(D,{validate:a}),this._isInternalStyle(D)&&(w.globalId=null)):v.url?w.loadURL(v.url,{validate:a}):w.loadEmpty();let C={style:w,id:v.id,config:v.config};if(f){let P=this.fragments.findIndex(({id:O})=>O===f);this.fragments=this.fragments.slice(0,P).concat(C).concat(this.fragments.slice(P))}else this.fragments.push(C)}return Promise.allSettled(_)}getImportGlobalIds(i=this,a=new Set){for(let f of i.fragments)f.style.globalId&&a.add(f.style.globalId),this.getImportGlobalIds(f.style,a);return[...a.values()]}_createFragmentStyle(i){let a=this.scope?r.am(i.id,this.scope):i.id,f,_=this._initialConfig&&this._initialConfig[a];(i.config||_)&&(f=r.Q({},i.config,_));let v=new xi(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,a){let f=i.schema;if(this._isInternalStyle(i)){let w=r.Q({},Qm,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(w,a)}if(this.updateConfig(this._config,f),a&&vi(this,j(i)))return;this._loaded=!0,this.stylesheet=r.cW(i);let _=()=>{for(let C in i.sources)this.addSource(C,i.sources[C],{validate:!1,isInitialLoad:!0});i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);let w=mc(this.stylesheet.layers);if(this._order=w.map(C=>C.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let C=this.stylesheet.lights[0];this.light=new sn(C.properties,C.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new sn(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let C of w){let P=r.c$(C,this.scope,this._styleColorTheme.lut,this.options);P.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid),P.setEventedParent(this,{layer:{id:P.id}}),this._layers[P.id]=P,this._serializedLayers[P.id]=P.serialize();let O=this.getOwnLayerSourceCache(P),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();O&&P.canCastShadows()&&F&&(O.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let E=this.stylesheet.terrain;E&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(E,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.g("data",{dataType:"style"}));let D=this.isRootStyle();i.imports?this._loadImports(i.imports,a).then(()=>{this._reloadImports(),this.fire(new r.g(D?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.g(D?"style.load":"style.import.load")))},v=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=v,v){let w=this._evaluateColorThemeData(v);this._loadColorTheme(w).then(()=>{_()}).catch(E=>{r.w(`Couldn't load color theme from the stylesheet: ${E}`),_()})}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,a,f,_,v,w,E,D,C={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(P=>{if(P.stylesheet){if(P.light!=null&&(i=P.light),P.stylesheet.lights)for(let O of P.stylesheet.lights)O.type==="ambient"&&P.ambientLight!=null&&(a=P.ambientLight),O.type==="directional"&&P.directionalLight!=null&&(f=P.directionalLight);_=this._prioritizeTerrain(_,P.terrain,P.stylesheet.terrain),P.stylesheet.fog&&P.fog!=null&&(v=P.fog),P.stylesheet.camera!=null&&(D=P.stylesheet.camera),P.stylesheet.projection!=null&&(w=P.stylesheet.projection),P.stylesheet.transition!=null&&(E=P.stylesheet.transition),C[P.scope]=P._styleColorTheme}}),this.light=i,this.ambientLight=a,this.directionalLight=f,this.fog=v,this._styleColorThemeForScope=C,_===null?delete this.terrain:this.terrain=_,this.camera=D||{"camera-projection":"perspective"},this.projection=w||{name:"mercator"},this.transition=r.Q({},Km,E),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){let a=f=>{for(let _ of f.fragments)a(_.style);i(f)};a(this)}_prioritizeTerrain(i,a,f){let _=i&&i.drapeRenderMode===0;return f===null?a&&a.drapeRenderMode===0?a:_?i:null:a!=null&&(!i||_||a&&a.drapeRenderMode===1)?a:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{i=this._prioritizeTerrain(i,a.terrain,a.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(i=a.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){let i={},a={},f={};this.forEachFragmentStyle(_=>{for(let v in _._sourceCaches){let w=r.am(v,_.scope);i[w]=_._sourceCaches[v]}for(let v in _._otherSourceCaches){let w=r.am(v,_.scope);a[w]=_._otherSourceCaches[v]}for(let v in _._symbolSourceCaches){let w=r.am(v,_.scope);f[w]=_._symbolSourceCaches[v]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=f}mergeLayers(){let i={},a=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(let E of w._order){let D=w._layers[E];if(D.type==="slot"){let C=r.cX(E);if(i[C])continue;i[C]=[]}D.slot&&i[D.slot]?i[D.slot].push(D):a.push(D)}}),this._mergedOrder=[],this._clipLayerIndices=[];let _=0,v=(w=[])=>{for(let E of w)if(E.type==="slot"){let D=r.cX(E.id);i[D]&&v(i[D]),this._mergedSlots.push(D)}else{let D=r.am(E.id,E.scope);this._mergedOrder.push(D),f[D]=E,E.is3D()&&(this._has3DLayers=!0),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&this._clipLayerIndices.push(_),_++}};v(a),this._mergedOrder.sort((w,E)=>{let D=f[w],C=f[E];return D.hasInitialOcclusionOpacityProperties?C.is3D()?1:0:D.is3D()&&C.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=r.Q({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?function(a,f,_){let v=r.Q({},f);for(let E of Object.keys(r.N.colorTheme))v[E]===void 0&&(v[E]=r.N.colorTheme[E].default);let w=new r.O(vf,a,new Map(_));return w.setTransitionOrValue(v,_),w.untransitioned().possiblyEvaluate(new r.Y(0))}(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;let a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((f,_)=>{let v="data:image/png;base64,";if(!i||i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let w=i;w.startsWith(v)||(w=v+w);let E="mapbox-reserved-lut",D=new Image;D.src=w,D.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},D.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void f();this._styleColorTheme.lutLoading=!1;let{width:C,height:P,data:O}=r.e.getImageData(D);if(P>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(C!==P*P)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(E)&&this.removeImage(E),this.addImage(E,{data:new r.j({width:C,height:P},O),pixelRatio:1,sdf:!1,version:0});let F=this.imageManager.getImage(E,this.scope);F?(this._styleColorTheme.lut={image:F.data,data:i},f()):_(new Error("Missing LUT image."))}})}getLut(i){let a=this._styleColorThemeForScope[i];return a?a.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(a,f,_){let v,w,E,D=r.e.devicePixelRatio>1?"@2x":"",C=r.h(f.transformRequest(f.normalizeSpriteURL(a,D,".json"),r.R.SpriteJSON),(F,z)=>{C=null,E||(E=F,v=z,O())}),P=r.i(f.transformRequest(f.normalizeSpriteURL(a,D,".png"),r.R.SpriteImage),(F,z)=>{P=null,E||(E=F,w=z,O())});function O(){if(E)_(E);else if(v&&w){let F=r.e.getImageData(w),z={};for(let U in v){let{width:$,height:G,x:H,y:K,sdf:J,pixelRatio:Q,stretchX:se,stretchY:te,content:ne}=v[U],ce=new r.j({width:$,height:G});r.j.copy(F,ce,{x:H,y:K},{x:0,y:0},{width:$,height:G},null),z[U]={data:ce,pixelRatio:Q,sdf:J,stretchX:se,stretchY:te,content:ne}}_(null,z)}}return{cancel(){C&&(C.cancel(),C=null),P&&(P.cancel(),P=null)}}}(i,this.map._requestManager,(a,f)=>{if(this._spriteRequest=null,a)this.fire(new r.f(a));else if(f)for(let _ in f)this.imageManager.addImage(_,this.scope,f[_]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.g("data",{dataType:"style"}))})}_validateLayer(i){let a=this.getOwnSource(i.source);if(!a)return;let f=i.sourceLayer;f&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(f)===-1)&&this.fire(new r.f(new Error(`Source layer "${f}" does not exist on source "${a.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,a)=>{let f=this.fragments[a];return f&&f.style&&(i.data=f.style.serialize()),i})}_serializeSources(){let i={};for(let a in this._sourceCaches){let f=this._sourceCaches[a].getSource();i[f.id]||(i[f.id]=f.serialize())}return i}_serializeLayers(i){let a=[];for(let f of i){let _=this._layers[f];_&&_.type!=="custom"&&a.push(_.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(let i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){let a=this.getOwnLayer(i);if(a)return a;this.fire(new r.f(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){let a=this.getOwnSource(i);if(a)return a;this.fire(new r.f(new Error(`The source '${i}' does not exist in the map's style.`)))}precompilePrograms(i,a){let f=this.map.painter;if(f)for(let _=i.minzoom||0;_<(i.maxzoom||25.5);_++){let v=i.getProgramIds();if(v)for(let w of v){let E=i.getDefaultProgramParams(w,a.zoom,this._styleColorTheme.lut);E&&(f.style=this,this.fog&&(f._fogVisible=!0,E.overrideFog=!0,f.getOrCreateProgram(w,E)),f._fogVisible=!1,E.overrideFog=!1,f.getOrCreateProgram(w,E),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(E.overrideRtt=!0,f.getOrCreateProgram(w,E)))}}}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);let a=this.calculateLightsBrightness();i.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a));let f=this._changes.isDirty(),_=!1;if(this._changes.isDirty()){let w=this._changes.getLayerUpdatesByScope();for(let E in w){let{updatedIds:D,removedIds:C}=w[E];(D||C)&&(this._updateWorkerLayers(E,D,C),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._changes.reset()}let v={};for(let w in this._mergedSourceCaches){let E=this._mergedSourceCaches[w];v[w]=E.used,E.used=!1,E.tileCoverLift=0}for(let w of this._mergedOrder){let E=this._mergedLayers[w];if(E.recalculate(i,this._availableImages),!E.isHidden(i.zoom)){let D=this.getLayerSourceCache(E);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,E.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(E,i)}):this.precompilePrograms(E,i))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();for(let w in v){let E=this._mergedSourceCaches[w];v[w]!==E.used&&E.getSource().fire(new r.g("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new r.g("data",{dataType:"style"}))}_updateTilesForChangedImages(){let i=this._changes.getUpdatedImages();if(i.length){for(let a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,a,f){let _=this.getFragmentStyle(i);_&&this.dispatcher.broadcast("updateLayers",{layers:a?_._serializeLayers(a):[],scope:i,removedIds:f||[],options:_.options})}setState(i,a){if(this._checkLoaded(),vi(this,j(i)))return!1;(i=r.cW(i)).layers=mc(i.layers);let f=function(w,E){if(!w)return[{command:dn.setStyle,args:[E]}];let D=[];try{if(!r.d(w.version,E.version))return[{command:dn.setStyle,args:[E]}];if(r.d(w.center,E.center)||D.push({command:dn.setCenter,args:[E.center]}),r.d(w.zoom,E.zoom)||D.push({command:dn.setZoom,args:[E.zoom]}),r.d(w.bearing,E.bearing)||D.push({command:dn.setBearing,args:[E.bearing]}),r.d(w.pitch,E.pitch)||D.push({command:dn.setPitch,args:[E.pitch]}),r.d(w.sprite,E.sprite)||D.push({command:dn.setSprite,args:[E.sprite]}),r.d(w.glyphs,E.glyphs)||D.push({command:dn.setGlyphs,args:[E.glyphs]}),r.d(w.imports,E.imports)||function(z=[],U=[],$){U=U||[];let G=(z=z||[]).map(Qu),H=U.map(Qu),K=z.reduce(So,{}),J=U.reduce(So,{}),Q=G.slice(),se,te,ne,ce;for(se=0,te=0;se<G.length;se++)ne=G[se],J.hasOwnProperty(ne)?te++:($.push({command:dn.removeImport,args:[ne]}),Q.splice(Q.indexOf(ne,te),1));for(se=0,te=0;se<H.length;se++)ne=H[H.length-1-se],Q[Q.length-1-se]!==ne&&(K.hasOwnProperty(ne)?($.push({command:dn.removeImport,args:[ne]}),Q.splice(Q.lastIndexOf(ne,Q.length-te),1)):te++,ce=Q[Q.length-se],$.push({command:dn.addImport,args:[J[ne],ce]}),Q.splice(Q.length-se,0,ne));for(let he of U){let xe=K[he.id];xe&&!r.d(xe,he)&&$.push({command:dn.updateImport,args:[he.id,he]})}}(w.imports,E.imports,D),r.d(w.transition,E.transition)||D.push({command:dn.setTransition,args:[E.transition]}),r.d(w.light,E.light)||D.push({command:dn.setLight,args:[E.light]}),r.d(w.fog,E.fog)||D.push({command:dn.setFog,args:[E.fog]}),r.d(w.projection,E.projection)||D.push({command:dn.setProjection,args:[E.projection]}),r.d(w.lights,E.lights)||D.push({command:dn.setLights,args:[E.lights]}),r.d(w.camera,E.camera)||D.push({command:dn.setCamera,args:[E.camera]}),!r.d(w["color-theme"],E["color-theme"]))return[{command:dn.setStyle,args:[E]}];let C={},P=[];(function(z,U,$,G){let H;for(H in U=U||{},z=z||{})z.hasOwnProperty(H)&&(U.hasOwnProperty(H)||Vm(H,$,G));for(H in U){if(!U.hasOwnProperty(H))continue;let K=U[H];z.hasOwnProperty(H)?r.d(z[H],K)||(z[H].type==="geojson"&&K.type==="geojson"&&gc(z,U,H)?$.push({command:dn.setGeoJSONSourceData,args:[H,K.data]}):y0(H,U,$,G)):qa(H,U,$)}})(w.sources,E.sources,P,C);let O=[];w.layers&&w.layers.forEach(z=>{z.source&&C[z.source]?D.push({command:dn.removeLayer,args:[z.id]}):O.push(z)});let F=w.terrain;F&&C[F.source]&&(D.push({command:dn.setTerrain,args:[void 0]}),F=void 0),D=D.concat(P),r.d(F,E.terrain)||D.push({command:dn.setTerrain,args:[E.terrain]}),function(z,U,$){U=U||[];let G=(z=z||[]).map(Qu),H=U.map(Qu),K=z.reduce(So,{}),J=U.reduce(So,{}),Q=G.slice(),se=Object.create(null),te,ne,ce,he,xe,de,oe;for(te=0,ne=0;te<G.length;te++)ce=G[te],J.hasOwnProperty(ce)?ne++:($.push({command:dn.removeLayer,args:[ce]}),Q.splice(Q.indexOf(ce,ne),1));for(te=0,ne=0;te<H.length;te++)ce=H[H.length-1-te],Q[Q.length-1-te]!==ce&&(K.hasOwnProperty(ce)?($.push({command:dn.removeLayer,args:[ce]}),Q.splice(Q.lastIndexOf(ce,Q.length-ne),1)):ne++,de=Q[Q.length-te],$.push({command:dn.addLayer,args:[J[ce],de]}),Q.splice(Q.length-te,0,ce),se[ce]=!0);for(te=0;te<H.length;te++)if(ce=H[te],he=K[ce],xe=J[ce],!se[ce]&&!r.d(he,xe))if(r.d(he.source,xe.source)&&r.d(he["source-layer"],xe["source-layer"])&&r.d(he.type,xe.type)){for(oe in as(he.layout,xe.layout,$,ce,null,dn.setLayoutProperty),as(he.paint,xe.paint,$,ce,null,dn.setPaintProperty),r.d(he.slot,xe.slot)||$.push({command:dn.setSlot,args:[ce,xe.slot]}),r.d(he.filter,xe.filter)||$.push({command:dn.setFilter,args:[ce,xe.filter]}),r.d(he.minzoom,xe.minzoom)&&r.d(he.maxzoom,xe.maxzoom)||$.push({command:dn.setLayerZoomRange,args:[ce,xe.minzoom,xe.maxzoom]}),he)he.hasOwnProperty(oe)&&oe!=="layout"&&oe!=="paint"&&oe!=="filter"&&oe!=="metadata"&&oe!=="minzoom"&&oe!=="maxzoom"&&oe!=="slot"&&(oe.indexOf("paint.")===0?as(he[oe],xe[oe],$,ce,oe.slice(6),dn.setPaintProperty):r.d(he[oe],xe[oe])||$.push({command:dn.setLayerProperty,args:[ce,oe,xe[oe]]}));for(oe in xe)xe.hasOwnProperty(oe)&&!he.hasOwnProperty(oe)&&oe!=="layout"&&oe!=="paint"&&oe!=="filter"&&oe!=="metadata"&&oe!=="minzoom"&&oe!=="maxzoom"&&oe!=="slot"&&(oe.indexOf("paint.")===0?as(he[oe],xe[oe],$,ce,oe.slice(6),dn.setPaintProperty):r.d(he[oe],xe[oe])||$.push({command:dn.setLayerProperty,args:[ce,oe,xe[oe]]}))}else $.push({command:dn.removeLayer,args:[ce]}),de=Q[Q.lastIndexOf(ce)+1],$.push({command:dn.addLayer,args:[xe,de]})}(O,E.layers,D)}catch(C){console.warn("Unable to compute style diff:",C),D=[{command:dn.setStyle,args:[E]}]}return D}(this.serialize(),i).filter(w=>!(w.command in Wa));if(f.length===0)return!1;let _=f.filter(w=>!(w.command in nh));if(_.length>0)throw new Error(`Unimplemented: ${_.map(w=>w.command).join(", ")}.`);let v=[];return f.forEach(w=>{v.push(this[w.command].apply(this,w.args))}),a&&Promise.all(v).then(a),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,a){return this.getImage(i)?this.fire(new r.f(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,a),this._afterImageUpdated(i),this)}updateImage(i,a){this.imageManager.updateImage(i,this.scope,a)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new r.f(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.g("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,a,f={}){return this._checkLoaded(),this._validate(Ve,`models.${i}`,a,null,f)||(this.modelManager.addModel(i,a,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new r.f(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,a,f={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(q,`sources.${i}`,a,null,f))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);let _=zu(i,a,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));let v=w=>{let E=(w?"symbol:":"other:")+_.id,D=r.am(E,this.scope),C=this._sourceCaches[E]=new r.bx(D,_,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=C,C.onAdd(this.map)};v(!1),a.type!=="vector"&&a.type!=="geojson"||v(!0),_.onAdd&&_.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();let a=this.getOwnSource(i);if(!a)throw new Error("There is no source with this ID");for(let _ in this._layers)if(this._layers[_].source===i)return this.fire(new r.f(new Error(`Source "${i}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new r.f(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));let f=this.getOwnSourceCaches(i);for(let _ of f){let v=r.cX(_.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(_.id),_.fire(new r.g("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,a){this._checkLoaded(),this.getOwnSource(i).setData(a),this._changes.setDirty()}getOwnSource(i){let a=this.getOwnSourceCache(i);return a&&a.getSource()}getOwnSources(){let i=[];for(let a in this._otherSourceCaches){let f=this.getOwnSourceCache(a);f&&i.push(f.getSource())}return i}areTilesLoaded(){let i=this._mergedSourceCaches;for(let a in i){let f=i[a]._tiles;for(let _ in f){let v=f[_];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;let a=this._getTransitionParameters();for(let _ of i){if(this._validate(ue,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){let v=this.ambientLight;v.set(_),v.updateTransitions(a)}else this.ambientLight=new Fs(_,Ld||(Ld=new r.U({color:new r.W(r.N.properties_light_ambient.color),intensity:new r.W(r.N.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){let v=this.directionalLight;v.set(_),v.updateTransitions(a)}else this.directionalLight=new Fs(_,kd||(kd=new r.U({direction:new r.a6(r.N.properties_light_directional.direction),color:new r.W(r.N.properties_light_directional.color),intensity:new r.W(r.N.properties_light_directional.intensity),"cast-shadows":new r.W(r.N.properties_light_directional["cast-shadows"]),"shadow-intensity":new r.W(r.N.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}let f=new r.Y(this.z||0,a);this.ambientLight&&this.ambientLight.recalculate(f),this.directionalLight&&this.directionalLight.recalculate(f),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let i=this.directionalLight,a=this.ambientLight;if(!i||!a)return;let f=O=>.2126*(O[0]<=.03928?O[0]/12.92:Math.pow((O[0]+.055)/1.055,2.4))+.7152*(O[1]<=.03928?O[1]/12.92:Math.pow((O[1]+.055)/1.055,2.4))+.0722*(O[2]<=.03928?O[2]/12.92:Math.pow((O[2]+.055)/1.055,2.4)),_=i.properties.get("color").toRenderColor(null).toArray01(),v=i.properties.get("intensity"),w=i.properties.get("direction"),E=1-r.ad(w.x,w.y,w.z)[2]/90,D=f(_)*v*E,C=a.properties.get("color").toRenderColor(null).toArray01(),P=a.properties.get("intensity");return(D+f(C)*P)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(r.cY(i)){let a=r.cZ(i),f=this.fragments.find(({id:v})=>v===a);if(!f)throw new Error(`Style import not found: ${i}`);let _=r.cX(i);return f.style.getFragmentStyle(_)}{let a=this.fragments.find(({id:f})=>f===i);if(!a)throw new Error(`Style import not found: ${i}`);return a.style}}getConfigProperty(i,a){let f=this.getFragmentStyle(i);if(!f)return null;let _=r.am(a,f.scope),v=f.options.get(_),w=v?v.value||v.default:null;return w?w.serialize():null}setConfigProperty(i,a,f){let _=this.getFragmentStyle(i);if(!_)return;let v=_.stylesheet.schema;if(!v||!v[a])return;let w=r.z(f);if(w.result!=="success")return void vi(this,w.value);let E=w.value.expression,D=r.am(a,_.scope),C=_.options.get(D);if(!C)return;let P,{minValue:O,maxValue:F,stepValue:z,type:U,values:$}=v[a],G=r.z(v[a].default);G.result==="success"&&(P=G.value.expression),P?(this.options.set(D,gr(Rt({},C),{value:E,default:P,minValue:O,maxValue:F,stepValue:z,type:U,values:$})),this.updateConfigDependencies(a)):this.fire(new r.f(new Error(`No schema defined for the config option "${a}" in the "${i}" fragment.`)))}getConfig(i){let a=this.getFragmentStyle(i);if(!a)return null;let f=a.stylesheet.schema;if(!f)return null;let _={};for(let v in f){let w=r.am(v,a.scope),E=a.options.get(w),D=E?E.value||E.default:null;_[v]=D?D.serialize():null}return _}setConfig(i,a){let f=this.getFragmentStyle(i);f&&(f.updateConfig(a,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){let a=this.getFragmentStyle(i);return a?a.stylesheet.schema:null}setSchema(i,a){let f=this.getFragmentStyle(i);f&&(f.stylesheet.schema=a,f.updateConfig(f._config,a),this.updateConfigDependencies())}updateConfig(i,a){if(this._config=i,i||a)if(a)for(let f in a){let _,v,w=r.z(a[f].default);if(w.result==="success"&&(_=w.value.expression),i&&i[f]!==void 0){let F=r.z(i[f]);F.result==="success"&&(v=F.value.expression)}let{minValue:E,maxValue:D,stepValue:C,type:P,values:O}=a[f];if(_){let F=r.am(f,this.scope);this.options.set(F,{default:_,value:v,minValue:E,maxValue:D,stepValue:C,type:P,values:O})}else this.fire(new r.f(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new r.f(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(i){for(let a of this._configDependentLayers){let f=this.getLayer(a);if(f){if(i&&!f.configDependencies.has(i))continue;f.possiblyEvaluateVisibility(),this._updateLayer(f)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(a=>{if(a._styleColorTheme.colorTheme){let f=a._evaluateColorThemeData(a._styleColorTheme.colorTheme);(!a._styleColorTheme.lut&&f!==""||a._styleColorTheme.lut&&f!==a._styleColorTheme.lut.data)&&a.setColorTheme(a._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(i,a,f={}){this._checkLoaded();let _=i.id;if(this._layers[_])return void this.fire(new r.f(new Error(`Layer with id "${_}" already exists on this map`)));let v;if(i.type==="custom"){if(vi(this,r.c_(i)))return;v=r.c$(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(_,i.source),i=r.cW(i),i=r.Q(i,{source:_})),this._validate(Se,`layers.${_}`,i,{arrayIndex:-1},f))return;v=r.c$(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[v.id]=v.serialize()}v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid);let w=this._order.length;if(a){let P=this._order.indexOf(a);if(P===-1)return void this.fire(new r.f(new Error(`Layer with id "${a}" does not exist on this map.`)));v.slot===this._layers[a].slot?w=P:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=v;let E=this.getOwnLayerSourceCache(v),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();E&&v.canCastShadows()&&D&&(E.castsShadows=!0);let C=this._changes.getRemovedLayer(v);if(C&&v.source&&E&&v.type!=="custom"){this._changes.discardLayerRemoval(v);let P=r.am(v.source,v.scope);C.type!==v.type?this._changes.updateSourceCache(P,"clear"):(this._changes.updateSourceCache(P,"reload"),E.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(i,a){this._checkLoaded();let f=this._checkLayer(i);if(!f||i===a)return;let _=this._order.indexOf(i);this._order.splice(_,1);let v=this._order.length;if(a){let w=this._order.indexOf(a);if(w===-1)return void this.fire(new r.f(new Error(`Layer with id "${a}" does not exist on this map.`)));f.slot===this._layers[a].slot?v=w:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();let a=this._checkLayer(i);if(!a)return;a.setEventedParent(null);let f=this._order.indexOf(i);this._order.splice(f,1),delete this._layers[i],delete this._serializedLayers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);let _=this.getOwnLayerSourceCache(a);if(_&&_.castsShadows){let v=!1;for(let w in this._layers)if(this._layers[w].source===a.source&&this._layers[w].canCastShadows()){v=!0;break}_.castsShadows=v}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(let a in this._layers)if(this._layers[a].type===i)return!0;return!1}setLayerZoomRange(i,a,f){this._checkLoaded();let _=this._checkLayer(i);_&&(_.minzoom===a&&_.maxzoom===f||(a!=null&&(_.minzoom=a),f!=null&&(_.maxzoom=f),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,a){this._checkLoaded();let f=this._checkLayer(i);f&&f.slot!==a&&(f.slot=a,this._updateLayer(f))}setFilter(i,a,f={}){this._checkLoaded();let _=this._checkLayer(i);if(_&&!r.d(_.filter,a))return a==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(_e,`layers.${_.id}.filter`,a,{layerType:_.type},f)||(_.filter=r.cW(a),this._updateLayer(_)))}getFilter(i){let a=this._checkLayer(i);if(a)return r.cW(a.filter)}setLayoutProperty(i,a,f,_={}){this._checkLoaded();let v=this._checkLayer(i);if(v&&!r.d(v.getLayoutProperty(a),f)){if(f!=null&&(!_||_.validate!==!1)&&vi(v,Ue.call(j,{key:`layers.${i}.layout.${a}`,layerType:v.type,objectKey:a,value:f,styleSpec:r.N,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(a,f),v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(i,a){let f=this._checkLayer(i);if(f)return f.getLayoutProperty(a)}setPaintProperty(i,a,f,_={}){this._checkLoaded();let v=this._checkLayer(i);if(!v||r.d(v.getPaintProperty(a),f)||f!=null&&(!_||_.validate!==!1)&&vi(v,De.call(j,{key:`layers.${i}.paint.${a}`,layerType:v.type,objectKey:a,value:f,styleSpec:r.N})))return;let w=v.setPaintProperty(a,f);v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),w&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(i,a){let f=this._checkLayer(i);if(f)return f.getPaintProperty(a)}setFeatureState(i,a){this._checkLoaded();let f=i.source,_=i.sourceLayer,v=this._checkSource(f);if(!v)return;let w=v.type;if(w==="geojson"&&_)return void this.fire(new r.f(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!_)return void this.fire(new r.f(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new r.f(new Error("The feature id parameter must be provided.")));let E=this.getOwnSourceCaches(f);for(let D of E)D.setFeatureState(_,i.id,a)}removeFeatureState(i,a){this._checkLoaded();let f=i.source,_=this._checkSource(f);if(!_)return;let v=_.type,w=v==="vector"?i.sourceLayer:void 0;if(v==="vector"&&!w)return void this.fire(new r.f(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new r.f(new Error("A feature id is required to remove its specific state property.")));let E=this.getOwnSourceCaches(f);for(let D of E)D.removeFeatureState(w,i.id,a)}getFeatureState(i){this._checkLoaded();let a=i.source,f=i.sourceLayer,_=this._checkSource(a);if(_){if(_.type!=="vector"||f)return i.id===void 0&&this.fire(new r.f(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(f,i.id);this.fire(new r.f(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=r.Q({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return r.Q({},this.stylesheet.transition)}serialize(){this._checkLoaded();let i=this.getTerrain(),a=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return r.d0({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateLayer(i){this._changes.updateLayer(i);let a=this.getLayerSourceCache(i),f=r.am(i.source,i.scope),_=this._changes.getUpdatedSourceCaches();i.source&&!_[f]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),a.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){let a=E=>this._mergedLayers[E].type==="fill-extrusion"||this._mergedLayers[E].type==="model",f=this.order,_={},v=[];for(let E=f.length-1;E>=0;E--){let D=f[E];if(a(D)){_[D]=E;for(let C of i){let P=C[D];if(P)for(let O of P)v.push(O)}}}v.sort((E,D)=>D.intersectionZ-E.intersectionZ);let w=[];for(let E=f.length-1;E>=0;E--){let D=f[E];if(a(D))for(let C=v.length-1;C>=0;C--){let P=v[C].feature;if(P.layer&&_[P.layer.id]<E)break;w.push(P),v.pop()}else for(let C of i){let P=C[D];if(P)for(let O of P)w.push(O.feature)}}return w}queryRenderedFeatures(i,a,f){a&&a.filter&&this._validate(_e,"queryRenderedFeatures.filter",a.filter,null,a),a.scope=this.scope,a.availableImages=this._availableImages,a.serializedLayers=this._serializedLayers;let _={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new r.f(new Error("parameters.layers must be an Array."))),[];for(let C of a.layers){let P=this._mergedLayers[C];if(!P)return this.fire(new r.f(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];_[P.source]=!0}}let v=[],w=a.serializedLayers||{},E=a&&a.layers?a.layers.some(C=>{let P=this.getLayer(C);return P&&P.is3D()}):this.has3DLayers(),D=_i.createFromScreenPoints(i,f);for(let C in this._mergedSourceCaches){let P=this._mergedSourceCaches[C].getSource();if(!P||P.scope!==a.scope)continue;let O=this._mergedSourceCaches[C].getSource().id;a.layers&&!_[O]||v.push(Co(this._mergedSourceCaches[C],this._mergedLayers,w,D,a,f,E,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(C,P,O,F,z,U,$){let G={},H=U.queryRenderedSymbols(F),K=[];for(let J of Object.keys(H).map(Number))K.push($[J]);K.sort(pf);for(let J of K){let Q=J.featureIndex.lookupSymbolFeatures(H[J.bucketInstanceId],P,J.bucketIndex,J.sourceLayerIndex,z.filter,z.layers,z.availableImages,C);for(let se in Q){let te=G[se]=G[se]||[],ne=Q[se];ne.sort((ce,he)=>{let xe=J.featureSortOrder;if(xe){let de=xe.indexOf(ce.featureIndex);return xe.indexOf(he.featureIndex)-de}return he.featureIndex-ce.featureIndex});for(let ce of ne)te.push(ce)}}for(let J in G)G[J].forEach(Q=>{let se=Q.feature,te=O(C[J]);if(!te)return;let ne=te.getFeatureState(se.layer["source-layer"],se.id);se.source=se.layer.source,se.layer["source-layer"]&&(se.sourceLayer=se.layer["source-layer"]),se.state=ne});return G}(this._mergedLayers,w,this.getLayerSourceCache.bind(this),D.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(i,a){a&&a.filter&&this._validate(_e,"querySourceFeatures.filter",a.filter,null,a);let f=this.getOwnSourceCaches(i),_=[];for(let v of f)_=_.concat(g0(v,a));return _}addSourceType(i,a,f){return xi.getSourceType(i)?f(new Error(`A source type called "${i}" already exists.`)):(xi.setSourceType(i,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:a.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,a,f={}){this._checkLoaded();let _=this.light.getLight(),v=!1;for(let E in i)if(!r.d(i[E],_[E])){v=!0;break}if(!v)return;let w=this._getTransitionParameters();this.light.setLight(i,a,f),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,a=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=i,_=i.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof f.source=="object"){let E="terrain-dem-src";this.addSource(E,f.source),f=r.cW(f),f=r.Q(f,{source:E})}let v=r.Q({},f),w={};if(this.terrain&&_){v.source=this.terrain.get().source;let E=this.terrain?this.getFragmentStyle(this.terrain.scope):null;E&&(w.style=E.serialize())}if(this._validate(ae,"terrain",v,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&a!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,a),this.fire(new r.g("data",{dataType:"style"}))}else{let v=this.terrain,w=v.get();for(let E of Object.keys(r.N.terrain))!f.hasOwnProperty(E)&&r.N.terrain[E].default&&(f[E]=r.N.terrain[E].default);for(let E in i)if(!r.d(i[E],w[E])){v.set(i,this.options),this.stylesheet.terrain=i;let D=this._getTransitionParameters({duration:0});v.updateTransitions(D),this.fire(new r.g("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){let a=this.fog=new Zr(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();let f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let a=this.fog;if(!r.d(a.get(),i)){a.set(i,this.options),this.stylesheet.fog=a.get();let f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}}else this._createFog(i);this._markersNeedUpdate=!0}setColorTheme(i){this._checkLoaded();let a=()=>{for(let _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(let _ in this._sourceCaches)this._sourceCaches[_].clearTiles()};if(this._styleColorTheme.colorTheme=i,!i)return this._styleColorTheme.lut=null,void a();let f=this._evaluateColorThemeData(i);this._loadColorTheme(f).then(()=>{this.fire(new r.g("colorthemeset")),a()}).catch(_=>{r.w(`Couldn't set color theme: ${_}`)})}_getTransitionParameters(i){return{now:r.e.now(),transition:r.Q(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;let i=[],a=[];for(let f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?i.push(f):a.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...a)}_createTerrain(i,a){let f=this.terrain=new en(i,a,this.scope,this.options);a===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_force3DLayerUpdate(){for(let i in this._layers){let a=this._layers[i];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(let i in this._layers){let a=this._layers[i];a.type==="symbol"&&this._updateLayer(a)}}_validate(i,a,f,_,v={}){if(v&&v.validate===!1)return!1;let w=r.Q({},this.serialize());return vi(this,i.call(j,r.Q({key:a,style:w,value:f,styleSpec:r.N},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.d1.off("pluginStateChange",this._rtlTextPluginCallback);for(let i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(let i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){let a=this.getSourceCaches(i);for(let f of a)f.clearTiles()}clearSources(){for(let i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){let a=this.getSourceCaches(i);for(let f of a)f.resume(),f.reload()}reloadSources(){for(let i of this.getSources())i.reload&&i.reload()}updateSources(i){let a;this.directionalLight&&(a=Na(this.directionalLight));for(let f in this._mergedSourceCaches)this._mergedSourceCaches[f].update(i,void 0,void 0,a)}_generateCollisionBoxes(){for(let i in this._sourceCaches){let a=this._sourceCaches[i];a.resume(),a.reload()}}_updatePlacement(i,a,f,_,v,w,E=!1){let D=!1,C=!1,P={},O={};for(let F of this._mergedOrder){let z=this._mergedLayers[F];if(z.type!=="symbol")continue;let U=r.am(z.source,z.scope),$=P[U];if(!$){let H=this.getLayerSourceCache(z);if(!H)continue;let K=H.getRenderableIds(!0).map(J=>H.getTileByID(J));O[U]=K.slice(),$=P[U]=K.sort((J,Q)=>Q.tileID.overscaledZ-J.tileID.overscaledZ||(J.tileID.isLessThan(Q.tileID)?-1:1))}let G=this.crossTileSymbolIndex.addLayer(z,$,a.center.lng,a.projection);D=D||G}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),E=E||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new r.g("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.e.now(),a.zoom))&&(this.pauseablePlacement=new Xm(a,this._mergedOrder,E,f,_,v,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,P,O),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.e.now()),C=!0),D&&this.pauseablePlacement.placement.setStale()),C||D){this._buildingIndex.onNewFrame(a.zoom);for(let F=0;F<this._mergedOrder.length;F++){let z=this._mergedLayers[this._mergedOrder[F]];if(z.type!=="symbol")continue;let U=this.isLayerClipped(z)&&this._clipLayerIndices.some($=>F<$);this.placement.updateLayerOpacities(z,P[r.am(z.source,z.scope)],F,U?w:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.e.now())}}_releaseSymbolFadeTiles(){for(let i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,a){this._checkLoaded();let f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:v})=>v===i.id)!==-1)return void this.fire(new r.f(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!a)return f.push(i),this._loadImports([i],!0);let _=f.findIndex(({id:v})=>v===a);return _===-1&&this.fire(new r.f(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,_).concat(i).concat(f.slice(_)),this._loadImports([i],!0,a)}updateImport(i,a){this._checkLoaded();let f=this.stylesheet.imports||[],_=this.getImportIndex(i);return _===-1?this:typeof a=="string"?(this.setImportUrl(i,a),this):(a.url&&a.url!==f[_].url&&this.setImportUrl(i,a.url),r.d(a.config,f[_].config)||this.setImportConfig(i,a.config),r.d(a.data,f[_].data)||this.setImportData(i,a.data),this)}moveImport(i,a){this._checkLoaded();let f=this.stylesheet.imports||[],_=this.getImportIndex(i);if(_===-1)return this;let v=this.getImportIndex(a);if(v===-1)return this;let w=f[_],E=this.fragments[_];return f=f.filter(({id:D})=>D!==i),this.fragments=this.fragments.filter(({id:D})=>D!==i),this.stylesheet.imports=f.slice(0,v).concat(w).concat(f.slice(v)),this.fragments=this.fragments.slice(0,v).concat(E).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(i,a){this._checkLoaded();let f=this.stylesheet.imports||[],_=this.getImportIndex(i);if(_===-1)return this;f[_].url=a;let v=this.fragments[_];return v.style=this._createFragmentStyle(f[_]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(a),this}setImportData(i,a){this._checkLoaded();let f=this.getImportIndex(i),_=this.stylesheet.imports||[];return f===-1?this:a?(this.fragments[f].style.setState(a),this._reloadImports(),this):(delete _[f].data,this.setImportUrl(i,_[f].url))}setImportConfig(i,a){this._checkLoaded();let f=this.getImportIndex(i),_=this.stylesheet.imports||[];if(f===-1)return this;a?_[f].config=a:delete _[f].config;let v=this.fragments[f],w=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=a,v.style.updateConfig(a,w),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();let a=this.stylesheet.imports||[],f=this.getImportIndex(i);f!==-1&&(a.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(i){let a=(this.stylesheet.imports||[]).findIndex(f=>f.id===i);return a===-1&&this.fire(new r.f(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),a}getLayer(i){return this._mergedLayers[i]}getSources(){let i=[];for(let a in this._mergedOtherSourceCaches){let f=this._mergedOtherSourceCaches[a];f&&i.push(f.getSource())}return i}getSource(i,a){let f=this.getSourceCache(i,a);return f&&f.getSource()}getLayerSource(i){let a=this.getLayerSourceCache(i);return a&&a.getSource()}getSourceCache(i,a){let f=r.am(i,a);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(i){let a=r.am(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);let a=[];return this._mergedOtherSourceCaches[i]&&a.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&a.push(this._mergedSymbolSourceCaches[i]),a}updateSourceCaches(){let i=this._changes.getUpdatedSourceCaches();for(let a in i){let f=i[a];f==="reload"?this.reloadSource(a):f==="clear"&&this.clearSource(a)}}updateLayers(i){let a=this._changes.getUpdatedPaintProperties();for(let f of a){let _=this.getLayer(f);_&&_.updateTransitions(i)}}getImages(i,a,f){this.imageManager.getImages(a.icons,a.scope,f),this._updateTilesForChangedImages();let _=v=>{v&&v.setDependencies(a.tileID.key,a.type,a.icons)};_(this._otherSourceCaches[a.source]),_(this._symbolSourceCaches[a.source])}getGlyphs(i,a,f){this.glyphManager.getGlyphs(a.stacks,a.scope,f)}getResource(i,a,f){return r.d2(a,f)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){let a=[];return this._otherSourceCaches[i]&&a.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&a.push(this._symbolSourceCaches[i]),a}_isSourceCacheLoaded(i){let a=this.getOwnSourceCaches(i);return a.length===0?(this.fire(new r.f(new Error(`There is no source with ID '${i}'`))),!1):a.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,a){if(this._clipLayerIndices.length===0&&i.type!=="fill-extrusion")return!1;let f=i.type==="fill-extrusion"&&i.sourceLayer==="building",_=0;if(i.is3D()){if(f||a&&a.type==="batched-model")return!0;i.type==="model"&&(_=r.cw.Model)}else i.type==="symbol"&&(_=r.cw.Symbol);for(let v of this._clipLayerIndices){let w=this._mergedLayers[this._mergedOrder[v]];if(!w)continue;let E=[];for(let D of w.layout.get("clip-layer-types"))E.push(D==="model"?r.cw.Model:D==="symbol"?r.cw.Symbol:r.cw.FillExtrusion);for(let D of E)if(_&D)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Jm(d,i){let a=!1,f=null,_=()=>{f=null,a&&(d(),f=setTimeout(_,i),a=!1)};return()=>(a=!0,f||_(),f)}xi.getSourceType=function(d){return Nu[d]},xi.setSourceType=function(d,i){Nu[d]=i},xi.registerForPluginStateChange=r.cO;class eg{constructor(i){this._hashName=i&&encodeURIComponent(i),r.br(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Jm(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let i=this._map;if(!i)return"";let a=xf(i);if(this._hashName){let f=this._hashName,_=!1,v=location.hash.slice(1).split("&").map(w=>{let E=w.split("=")[0];return E===f?(_=!0,`${E}=${a}`):w}).filter(w=>w);return _||v.push(`${f}=${a}`),`#${v.join("&")}`}return`#${a}`}_getCurrentHash(){let i=location.hash.replace("#","");if(this._hashName){let a;return i.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(a=f)}),(a&&a[1]||"").split("/")}return i.split("/")}_onHashChange(){let i=this._map;if(!i)return!1;let a=this._getCurrentHash();if(a.length>=3&&!a.some(f=>isNaN(f))){let f=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(a[3]||0):i.getBearing();return i.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:f,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function xf(d,i){let a=d.getCenter(),f=Math.round(100*d.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),w=Math.round(a.lng*v)/v,E=Math.round(a.lat*v)/v,D=d.getBearing(),C=d.getPitch(),P=i?`/${w}/${E}/${f}`:`${f}/${E}/${w}`;return(D||C)&&(P+="/"+Math.round(10*D)/10),C&&(P+=`/${Math.round(C)}`),P}let Za={linearity:.3,easing:r.d3(0,0,.3,1)},b0=r.Q({deceleration:2500,maxSpeed:1400},Za),w0=r.Q({deceleration:20,maxSpeed:1400},Za),T0=r.Q({deceleration:1e3,maxSpeed:360},Za),E0=r.Q({deceleration:1e3,maxSpeed:90},Za);class tg{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.e.now(),settings:i})}_drainInertiaBuffer(){let i=this._inertiaBuffer,a=r.e.now();for(;i.length>0&&a-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let a={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:v}of this._inertiaBuffer)a.zoom+=v.zoomDelta||0,a.bearing+=v.bearingDelta||0,a.pitch+=v.pitchDelta||0,v.panDelta&&a.pan._add(v.panDelta),v.around&&(a.around=v.around),v.pinchAround&&(a.pinchAround=v.pinchAround);let f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(a.pan.mag()){let v=qs(a.pan.mag(),f,r.Q({},b0,i||{}));_.offset=a.pan.mult(v.amount/a.pan.mag()),_.center=this._map.transform.center,rh(_,v)}if(a.zoom){let v=qs(a.zoom,f,w0);_.zoom=this._map.transform.zoom+v.amount,rh(_,v)}if(a.bearing){let v=qs(a.bearing,f,T0);_.bearing=this._map.transform.bearing+r.au(v.amount,-179,179),rh(_,v)}if(a.pitch){let v=qs(a.pitch,f,E0);_.pitch=this._map.transform.pitch+v.amount,rh(_,v)}if(_.zoom||_.bearing){let v=a.pinchAround===void 0?a.around:a.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function rh(d,i){(!d.duration||d.duration<i.duration)&&(d.duration=i.duration,d.easing=i.easing)}function qs(d,i,a){let{maxSpeed:f,linearity:_,deceleration:v}=a,w=r.au(d*_/(i/1e3),-f,f),E=Math.abs(w)/(v*_);return{easing:a.easing,duration:1e3*E,amount:w*(E/2)}}class bi extends r.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,f,_={}){let v=rn(a.getCanvasContainer(),f),w=a.unproject(v);super(i,r.Q({point:v,lngLat:w,originalEvent:f},_)),this._defaultPrevented=!1,this.target=a}}class wc extends r.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,f){let _=i==="touchend"?f.changedTouches:f.touches,v=on(a.getCanvasContainer(),_),w=v.map(D=>a.unproject(D)),E=v.reduce((D,C,P,O)=>D.add(C.div(O.length)),new r.P(0,0));super(i,{points:v,point:E,lngLats:w,lngLat:a.unproject(E),originalEvent:f}),this._defaultPrevented=!1}}class bf extends r.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class ih{constructor(i,a){this._map=i,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new bf(this._map,i))}mousedown(i,a){return this._mousedownPos=a,this._firePreventable(new bi(i.type,this._map,i))}mouseup(i){this._map.fire(new bi(i.type,this._map,i))}preclick(i){let a=r.Q({},i);a.type="preclick",this._map.fire(new bi(a.type,this._map,a))}click(i,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(i),this._map.fire(new bi(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new bi(i.type,this._map,i))}mouseover(i){this._map.fire(new bi(i.type,this._map,i))}mouseout(i){this._map.fire(new bi(i.type,this._map,i))}touchstart(i){return this._firePreventable(new wc(i.type,this._map,i))}touchmove(i){this._map.fire(new wc(i.type,this._map,i))}touchend(i){this._map.fire(new wc(i.type,this._map,i))}touchcancel(i){this._map.fire(new wc(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wf{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new bi(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new bi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new bi(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ws{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,a){this.isEnabled()&&i.shiftKey&&i.button===0&&(Ot(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(i,a){if(!this._active)return;let f=a,_=this._startPos,v=this._lastPos;if(!_||!v||v.equals(f)||!this._box&&f.dist(_)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=Y("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));let w=Math.min(_.x,f.x),E=Math.max(_.x,f.x),D=Math.min(_.y,f.y),C=Math.max(_.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${D}px)`,this._box.style.width=E-w+"px",this._box.style.height=C-D+"px")})}mouseupWindow(i,a){if(!this._active)return;let f=this._startPos,_=a;if(f&&i.button===0){if(this.reset(),Ft(),f.x!==_.x||f.y!==_.y)return this._map.fire(new r.g("boxzoomend",{originalEvent:i})),{cameraAnimation:v=>v.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Jt(),delete this._startPos,delete this._lastPos}_fireEvent(i,a){return this._map.fire(new r.g(i,{originalEvent:a}))}}function Tc(d,i){let a={};for(let f=0;f<d.length;f++)a[d[f].identifier]=i[f];return a}class ng{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,a,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),f.length===this.numTouches&&(this.centroid=function(_){let v=new r.P(0,0);for(let w of _)v._add(w);return v.div(_.length)}(a),this.touches=Tc(f,a)))}touchmove(i,a,f){if(this.aborted||!this.centroid)return;let _=Tc(f,a);for(let v in this.touches){let w=_[v];(!w||w.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(i,a,f){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){let _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class cs{constructor(i){this.singleTap=new ng(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,a,f){this.singleTap.touchstart(i,a,f)}touchmove(i,a,f){this.singleTap.touchmove(i,a,f)}touchend(i,a,f){let _=this.singleTap.touchend(i,a,f);if(_){let v=i.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(_)<30;if(v&&w||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Ec{constructor(){this._zoomIn=new cs({numTouches:1,numTaps:2}),this._zoomOut=new cs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,a,f){this._zoomIn.touchstart(i,a,f),this._zoomOut.touchstart(i,a,f)}touchmove(i,a,f){this._zoomIn.touchmove(i,a,f),this._zoomOut.touchmove(i,a,f)}touchend(i,a,f){let _=this._zoomIn.touchend(i,a,f),v=this._zoomOut.touchend(i,a,f);return _?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(_)},{originalEvent:i})}):v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(v)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let oh={0:1,2:2};class Ic{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,a){return!1}_move(i,a){return{}}mousedown(i,a){if(this._lastPoint)return;let f=Ln(i);this._correctButton(i,f)&&(this._lastPoint=a,this._eventButton=f)}mousemoveWindow(i,a){let f=this._lastPoint;if(f){if(i.preventDefault(),this._eventButton!=null&&function(_,v){let w=oh[v];return _.buttons===void 0||(_.buttons&w)!==w}(i,this._eventButton))this.reset();else if(this._moved||!(a.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(f,a)}}mouseupWindow(i){this._lastPoint&&Ln(i)===this._eventButton&&(this._moved&&Ft(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mc extends Ic{mousedown(i,a){super.mousedown(i,a),this._lastPoint&&(this._active=!0)}_correctButton(i,a){return a===0&&!i.ctrlKey}_move(i,a){return{around:a,panDelta:a.sub(i)}}}class Dc extends Ic{_correctButton(i,a){return a===0&&i.ctrlKey||a===2}_move(i,a){let f=.8*(a.x-i.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(i){i.preventDefault()}}class sh extends Ic{_correctButton(i,a){return a===0&&i.ctrlKey||a===2}_move(i,a){let f=-.5*(a.y-i.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(i){i.preventDefault()}}class rg{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),r.br(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(i,a,f){return this._calculateTransform(i,a,f)}touchmove(i,a,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!r.d4())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,a,f)}}touchend(i,a,f){this._calculateTransform(i,a,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,a,f){f.length>0&&(this._active=!0);let _=Tc(f,a),v=new r.P(0,0),w=new r.P(0,0),E=0;for(let C in _){let P=_[C],O=this._touches[C];O&&(v._add(P),w._add(P.sub(O)),E++,_[C]=P)}if(this._touches=_,E<this._minTouches||!w.mag())return;let D=w.div(E);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(E),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Y("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Cc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,a,f){return{}}touchstart(i,a,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([a[0],a[1]]))}touchmove(i,a,f){let _=this._firstTwoTouches;if(!_)return;i.preventDefault();let[v,w]=_,E=Zs(f,a,v),D=Zs(f,a,w);if(!E||!D)return;let C=this._aroundCenter?null:E.add(D).div(2);return this._move([E,D],C,i)}touchend(i,a,f){if(!this._firstTwoTouches)return;let[_,v]=this._firstTwoTouches,w=Zs(f,a,_),E=Zs(f,a,v);w&&E||(this._active&&Ft(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Zs(d,i,a){for(let f=0;f<d.length;f++)if(d[f].identifier===a)return i[f]}function Xa(d,i){return Math.log(d/i)/Math.LN2}class ig extends Cc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,a){let f=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Xa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xa(this._distance,f),pinchAround:a}}}function Tf(d,i){return 180*d.angleWith(i)/Math.PI}class og extends Cc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,a){let f=this._vector;if(this._vector=i[0].sub(i[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Tf(this._vector,f),pinchAround:a}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());let a=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;let _=Tf(i,f);return Math.abs(_)<a}}function us(d){return Math.abs(d.y)>Math.abs(d.x)}class sg extends Cc{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,us(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,a,f){let _=this._lastPoints;if(!_)return;let v=i[0].sub(_[0]),w=i[1].sub(_[1]);return this._map._cooperativeGestures&&!r.d4()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(v,w,f.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(v.y+w.y)/2*-.5})}gestureBeginsVertically(i,a,f){if(this._valid!==void 0)return this._valid;let _=i.mag()>=2,v=a.mag()>=2;if(!_&&!v)return;if(!_||!v)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;let w=i.y>0==a.y>0;return us(i)&&us(a)&&w}}let I0={panStep:100,bearingStep:15,pitchStep:10};class M0{constructor(){let i=I0;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let a=0,f=0,_=0,v=0,w=0;switch(i.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:i.shiftKey?f=-1:(i.preventDefault(),v=-1);break;case 39:i.shiftKey?f=1:(i.preventDefault(),v=1);break;case 38:i.shiftKey?_=1:(i.preventDefault(),w=-1);break;case 40:i.shiftKey?_=-1:(i.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:E=>{let D=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:D0,zoom:a?Math.round(D)+a*(i.shiftKey?2:1):D,bearing:E.getBearing()+f*this._bearingStep,pitch:E.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-w*this._panStep],center:E.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function D0(d){return d*(2-d)}let ah=4.000244140625,Ef=1/450;class If{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ef,r.br(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||r.d4()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY,f=r.e.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,a!==0&&a%ah==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(_*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),i.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=i,this._delta-=a,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let a=rn(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let a=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){let C=this._type==="wheel"&&Math.abs(this._delta)>ah?this._wheelZoomRate:this._defaultZoomRate,P=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&P!==0&&(P=1/P);let O=a(),F=Math.pow(2,O),z=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(z*P))),this._type==="wheel"&&(this._startZoom=O,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let f=typeof this._targetZoom=="number"?this._targetZoom:a(),_=this._startZoom,v=this._easing,w,E=!1;if(this._type==="wheel"&&_&&v){let C=Math.min((r.e.now()-this._lastWheelEventTime)/200,1),P=v(C);w=r.a3(_,f,P),C<1?this._frameId||(this._frameId=!0):E=!0}else w=f,E=!0;this._active=!0,E&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let D=w-a();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!E,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let a=r.d5;if(this._prevEase){let f=this._prevEase,_=(r.e.now()-f.start)/f.duration,v=f.easing(_+.01)-f.easing(_),w=.27/Math.sqrt(v*v+1e-4)*.01,E=Math.sqrt(.0729-w*w);a=r.d3(w,E,.25,1)}return this._prevEase={start:r.e.now(),duration:i,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Y("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Mf{constructor(i,a){this._clickZoom=i,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ag{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,a){return i.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(i.shiftKey?-1:1),around:f.unproject(a)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lg{constructor(){this._tap=new cs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,a,f){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=a[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(i,a,f))}touchmove(i,a,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;let _=a[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,i.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(i,a,f)}touchend(i,a,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(i,a,f)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class C0{constructor(i,a,f){this._el=i,this._mousePan=a,this._touchPan=f}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sc{constructor(i,a,f){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=a,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ac{constructor(i,a,f,_){this._el=i,this._touchZoom=a,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Pc=d=>d.zoom||d.drag||d.pitch||d.rotate;class wi extends r.g{}class Df{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,a){let f=r.$.sub([],a,i);this.radius=r.$.length(f[2]<0?r.$.div([],f,this.constants):[f[0],f[1],0])}projectRay(i){r.$.div(i,i,this.constants),r.$.normalize(i,i),r.$.mul(i,i,this.constants);let a=r.$.scale([],i,this.radius);if(a[2]>0){let f=r.$.scale([],[0,0,1],r.$.dot(a,[0,0,1])),_=r.$.scale([],r.$.normalize([],[a[0],a[1],0]),this.radius),v=r.$.add([],a,r.$.scale([],r.$.sub([],r.$.add([],_,f),a),2));a[0]=v[0],a[1]=v[1]}return a}}function Xs(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class lh{constructor(i,a){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tg(i),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Df,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),r.br(["handleEvent","handleWindowEvent"],this);let f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(let[_,v,w]of this._listeners){let E=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(v,E,w)}}destroy(){for(let[i,a,f]of this._listeners){let _=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(a,_,f)}}_addDefaultHandlers(i){let a=this._map,f=a.getCanvasContainer();this._add("mapEvent",new ih(a,i));let _=a.boxZoom=new Ws(a,i);this._add("boxZoom",_);let v=new Ec,w=new ag;a.doubleClickZoom=new Mf(w,v),this._add("tapZoom",v),this._add("clickZoom",w);let E=new lg;this._add("tapDragZoom",E);let D=a.touchPitch=new sg(a);this._add("touchPitch",D);let C=new Dc(i),P=new sh(i);a.dragRotate=new Sc(i,C,P),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);let O=new Mc(i),F=new rg(a,i);a.dragPan=new C0(f,O,F),this._add("mousePan",O),this._add("touchPan",F,["touchZoom","touchRotate"]);let z=new og,U=new ig;a.touchZoomRotate=new Ac(f,U,z,E),this._add("touchRotate",z,["touchPan","touchZoom"]),this._add("touchZoom",U,["touchPan","touchRotate"]),this._add("blockableMapEvent",new wf(a));let $=a.scrollZoom=new If(a,this);this._add("scrollZoom",$,["mousePan"]);let G=a.keyboard=new M0;this._add("keyboard",G);for(let H of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[H]&&a[H].enable(i[H])}_add(i,a,f){this._handlers.push({handlerName:i,handler:a,allowed:f}),this._handlersById[i]=a}stop(i){if(!this._updatingCamera){for(let{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Pc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,a,f){for(let _ in i)if(_!==f&&(!a||a.indexOf(_)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){let a=[];for(let f of i)this._el.contains(f.target)&&a.push(f);return a}handleEvent(i,a){this._updatingCamera=!0;let f=i.type==="renderFrame",_=f?void 0:i,v={needsRenderFrame:!1},w={},E={},D=i.touches?this._getMapTouches(i.touches):void 0,C=D?on(this._el,D):f?void 0:rn(this._el,i);for(let{handlerName:F,handler:z,allowed:U}of this._handlers){if(!z.isEnabled())continue;let $;this._blockedByActive(E,U,F)?z.reset():z[a||i.type]&&($=z[a||i.type](i,C,D),this.mergeHandlerResult(v,w,$,F,_),$&&$.needsRenderFrame&&this._triggerRenderFrame()),($||z.isActive())&&(E[F]=z)}let P={};for(let F in this._previousActiveHandlers)E[F]||(P[F]=_);this._previousActiveHandlers=E,(Object.keys(P).length||Xs(v))&&(this._changes.push([v,w,P]),this._triggerRenderFrame()),(Object.keys(E).length||Xs(v))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:O}=v;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(i,a,f,_,v){if(!f)return;r.Q(i,f);let w={handlerName:_,originalEvent:f.originalEvent||v};f.zoomDelta!==void 0&&(a.zoom=w),f.panDelta!==void 0&&(a.drag=w),f.pitchDelta!==void 0&&(a.pitch=w),f.bearingDelta!==void 0&&(a.rotate=w)}_applyChanges(){let i={},a={},f={};for(let[_,v,w]of this._changes)_.panDelta&&(i.panDelta=(i.panDelta||new r.P(0,0))._add(_.panDelta)),_.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(i.around=_.around),_.aroundCoord!==void 0&&(i.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(i.pinchAround=_.pinchAround),_.noInertia&&(i.noInertia=_.noInertia),r.Q(a,v),r.Q(f,w);this._updateMapTransform(i,a,f),this._changes=[]}_updateMapTransform(i,a,f){let _=this._map,v=_.transform,w=K=>[K.x,K.y,K.z];if((K=>{let J=this._eventsInProgress.drag;return J&&!this._handlersById[J.handlerName].isActive()})()&&!Xs(i)){let K=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),K!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&_._stop(!0),!Xs(i))return void this._fireEvents(a,f,!0);let{panDelta:E,zoomDelta:D,bearingDelta:C,pitchDelta:P,around:O,aroundCoord:F,pinchAround:z}=i;v._isCameraConstrained&&(D>0&&(D=0),v._isCameraConstrained=!1),z!==void 0&&(O=z),(D||(K=>a[K]&&!this._eventsInProgress[K])("drag"))&&O&&(this._dragOrigin=w(v.pointCoordinate3D(O)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",_._stop(!0),O=O||_.transform.centerPoint,C&&(v.bearing+=C),P&&(v.pitch+=P),v._updateCameraState();let U=[0,0,0];if(E)if(v.projection.name==="mercator"){let K=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(O).dir),J=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(O.sub(E)).dir);U[0]=J[0]-K[0],U[1]=J[1]-K[1]}else{let K=v.pointCoordinate(O);if(v.projection.name==="globe"){E=E.rotate(-v.angle);let J=v._pixelsPerMercatorPixel/v.worldSize;U[0]=-E.x*r.d6(r.az(K.y))*J,U[1]=-E.y*r.d6(v.center.lat)*J}else{let J=v.pointCoordinate(O.sub(E));K&&J&&(U[0]=J.x-K.x,U[1]=J.y-K.y)}}let $=v.zoom,G=[0,0,0];if(D){let K=w(F||v.pointCoordinate3D(O)),J={dir:r.$.normalize([],r.$.sub([],K,v._camera.position))};if(J.dir[2]<0){let Q=v.zoomDeltaToMovement(K,D);r.$.scale(G,J.dir,Q)}}let H=r.$.add(U,U,G);v._translateCameraConstrained(H),D&&Math.abs(v.zoom-$)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(a,f,!0)}_fireEvents(i,a,f){let _=Pc(this._eventsInProgress),v=Pc(i),w={};for(let P in i){let{originalEvent:O}=i[P];this._eventsInProgress[P]||(w[`${P}start`]=O),this._eventsInProgress[P]=i[P]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(let P in w)this._fireEvent(P,w[P]);v&&this._fireEvent("move",v.originalEvent);for(let P in i){let{originalEvent:O}=i[P];this._fireEvent(P,O)}let E={},D;for(let P in this._eventsInProgress){let{handlerName:O,originalEvent:F}=this._eventsInProgress[P];this._handlersById[O].isActive()||(delete this._eventsInProgress[P],D=a[O]||F,E[`${P}end`]=D)}for(let P in E)this._fireEvent(P,E[P]);let C=Pc(this._eventsInProgress);if(f&&(_||v)&&!C){this._updatingCamera=!0;let P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;P?(O(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:D})):(this._map.fire(new r.g("moveend",{originalEvent:D})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,a){this._map.fire(new r.g(i,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new wi("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let ch="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Cf extends r.E{constructor(i,a){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,r.br(["_renderFrameCallback"],this)}getCenter(){return new r.aJ(this.transform.center.lng,this.transform.center.lat)}setCenter(i,a){return this.jumpTo({center:i},a)}panBy(i,a,f){return i=r.P.convert(i).mult(-1),this.panTo(this.transform.center,r.Q({offset:i},a),f)}panTo(i,a,f){return this.easeTo(r.Q({center:i},a),f)}getZoom(){return this.transform.zoom}setZoom(i,a){return this.jumpTo({zoom:i},a),this}zoomTo(i,a,f){return this.easeTo(r.Q({zoom:i},a),f)}zoomIn(i,a){return this.zoomTo(this.getZoom()+1,i,a),this}zoomOut(i,a){return this.zoomTo(this.getZoom()-1,i,a),this}getBearing(){return this.transform.bearing}setBearing(i,a){return this.jumpTo({bearing:i},a),this}getPadding(){return this.transform.padding}setPadding(i,a){return this.jumpTo({padding:i},a),this}rotateTo(i,a,f){return this.easeTo(r.Q({bearing:i},a),f)}resetNorth(i,a){return this.rotateTo(0,r.Q({duration:1e3},i),a),this}resetNorthPitch(i,a){return this.easeTo(r.Q({bearing:0,pitch:0,duration:1e3},i),a),this}snapToNorth(i,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,a):this}getPitch(){return this.transform.pitch}setPitch(i,a){return this.jumpTo({pitch:i},a),this}cameraForBounds(i,a){i=r.aj.convert(i);let f=a&&a.bearing||0,_=a&&a.pitch||0,v=i.getNorthWest(),w=i.getSouthEast();return this._cameraForBounds(this.transform,v,w,f,_,a)}_extendPadding(i){let a={top:0,right:0,bottom:0,left:0};return i==null?r.Q({},a,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:r.Q({},a,i)}_extendCameraOptions(i){return(i=r.Q({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,a){let f=a.max[0]-a.min[0],_=a.max[1]-a.min[1];return f/_>i.aspect?f/(2*Math.tan(.5*i.fovX)*i.aspect):_/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,a,f,_,v,w){let E=i.clone(),D=this._extendCameraOptions(w);E.bearing=_,E.pitch=v;let C=r.aJ.convert(a),P=r.aJ.convert(f),O=.5*(C.lat+P.lat),F=.5*(C.lng+P.lng),z=r.d7(O,F),U=r.$.normalize([],z),$=r.$.normalize([],r.$.cross([],U,[0,1,0])),G=r.$.cross([],$,U),H=[$[0],$[1],$[2],0,G[0],G[1],G[2],0,U[0],U[1],U[2],0,0,0,0,1],K=[z,r.d7(C.lat,C.lng),r.d7(P.lat,C.lng),r.d7(P.lat,P.lng),r.d7(C.lat,P.lng),r.d7(O,C.lng),r.d7(O,P.lng),r.d7(C.lat,F),r.d7(P.lat,F)],J=r.b8.fromPoints(K.map(fe=>[r.$.dot($,fe),r.$.dot(G,fe),r.$.dot(U,fe)])),Q=r.$.transformMat4([],J.center,H);r.$.squaredLength(Q)===0&&r.$.set(Q,0,0,1),r.$.normalize(Q,Q),r.$.scale(Q,Q,r.cF),E.center=r.d8(Q);let se=E.getWorldToCameraMatrix(),te=r.ae.invert(new Float64Array(16),se);J=r.b8.applyTransform(J,r.ae.multiply([],se,H));let ne=this._extendAABB(J,E,D,_);if(!ne)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");J=ne,r.$.transformMat4(Q,Q,se);let ce=.5*(J.max[2]-J.min[2]),he=this._minimumAABBFrustumDistance(E,J),xe=r.$.scale([],[0,0,1],ce),de=r.$.add(xe,Q,xe),oe=he+(E.pitch===0?0:r.$.distance(Q,de)),Me=E.globeCenterInViewSpace,Ee=r.$.sub([],Q,[Me[0],Me[1],Me[2]]);r.$.normalize(Ee,Ee),r.$.scale(Ee,Ee,oe);let me=r.$.add([],Q,Ee);r.$.transformMat4(me,me,te);let je=r.da/r.cF,Fe=r.$.length(me),be=r.ay(Math.max(Fe*je-r.da,Number.EPSILON),0),Ae=Math.min(E.zoomFromMercatorZAdjusted(be),D.maxZoom);return Ae>.5*(r.b3+r.aV)?(E.setProjection({name:"mercator"}),E.zoom=Ae,this._cameraForBounds(E,a,f,_,v,w)):{center:E.center,zoom:Ae,bearing:_,pitch:v}}_extendAABB(i,a,f,_){let v=.5*((f.padding.left||0)+(f.padding.right||0)),w=.5*((f.padding.top||0)+(f.padding.bottom||0)),E=w,D=v,C=v,P=w,O=a.width-(D+C),F=a.height-(E+P),z=r.$.sub([],i.max,i.min),U=Math.min(O/z[0],F/z[1]),$=Math.min(a.scaleZoom(a.scale*U),f.maxZoom);if(isNaN($))return null;let G=a.scale/a.zoomScale($),H=new r.b8([i.min[0]-D*G,i.min[1]-P*G,i.min[2]],[i.max[0]+C*G,i.max[1]+E*G,i.max[2]]),K=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new r.P(f.offset.x,f.offset.y):r.P.convert(f.offset)).rotate(-r.ac(_));return H.center[0]-=K.x*G,H.center[1]+=K.y*G,H}queryTerrainElevation(i,a){let f=this.transform.elevation;return f?(a=r.Q({},{exaggerated:!0},a),f.getAtPoint(r._.fromLngLat(i),null,a.exaggerated)):null}_cameraForBounds(i,a,f,_,v,w){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,a,f,_,v,w);let E=i.clone(),D=this._extendCameraOptions(w);E.bearing=_,E.pitch=v;let C=r.aJ.convert(a),P=r.aJ.convert(f),O=new r.aJ(C.lng,P.lat),F=new r.aJ(P.lng,C.lat),z=E.project(C),U=E.project(P),$=this.queryTerrainElevation(C),G=this.queryTerrainElevation(P),H=this.queryTerrainElevation(O),K=this.queryTerrainElevation(F),J=[[z.x,z.y,Math.min($||0,G||0,H||0,K||0)],[U.x,U.y,Math.max($||0,G||0,H||0,K||0)]],Q=r.b8.fromPoints(J),se=E.getWorldToCameraMatrix(),te=r.ae.invert(new Float64Array(16),se);Q=r.b8.applyTransform(Q,se);let ne=this._extendAABB(Q,E,D,_);if(!ne)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Q=ne;let ce=.5*r.$.sub([],Q.max,Q.min)[2],he=this._minimumAABBFrustumDistance(E,Q),xe=[0,0,1,0];r.aB.transformMat4(xe,xe,se),r.aB.normalize(xe,xe);let de=r.$.scale([],xe,he+ce),oe=r.$.add([],Q.center,de);r.$.transformMat4(Q.center,Q.center,te),r.$.transformMat4(oe,oe,te);let Me=[Q.center[0],Q.center[1],oe[2]*E.pixelsPerMeter];r.$.scale(Me,Me,1/E.worldSize);let Ee=r.d9(Me[0]),me=r.az(Me[1]),je=Math.min(E._zoomFromMercatorZ(Me[2]),D.maxZoom),Fe=new r.aJ(Ee,me);return E.mercatorFromTransition&&je<.5*(r.b3+r.aV)?(E.setProjection({name:"globe"}),E.zoom=je,this._cameraForBounds(E,a,f,_,v,w)):{center:Fe,zoom:je,bearing:_,pitch:v}}fitBounds(i,a,f){let _=this.cameraForBounds(i,a);return this._fitInternal(_,a,f)}fitScreenCoordinates(i,a,f,_,v){let w=r.P.convert(i),E=r.P.convert(a),D=new r.P(Math.min(w.x,E.x),Math.min(w.y,E.y)),C=new r.P(Math.max(w.x,E.x),Math.max(w.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,E))return this;let P=this.transform.pointLocation3D(D),O=this.transform.pointLocation3D(C),F=this.transform.pointLocation3D(new r.P(D.x,C.y)),z=this.transform.pointLocation3D(new r.P(C.x,D.y)),U=[Math.min(P.lng,O.lng,F.lng,z.lng),Math.min(P.lat,O.lat,F.lat,z.lat)],$=[Math.max(P.lng,O.lng,F.lng,z.lng),Math.max(P.lat,O.lat,F.lat,z.lat)],G=_&&_.pitch?_.pitch:this.getPitch(),H=this._cameraForBounds(this.transform,U,$,f,G,_);return this._fitInternal(H,_,v)}_fitInternal(i,a,f){return i?(a=r.Q(i,a)).linear?this.easeTo(a,f):this.flyTo(a,f):this}jumpTo(i,a){this.stop();let f=i.preloadOnly?this.transform.clone():this.transform,_=!1,v=!1,w=!1;if("zoom"in i&&f.zoom!==+i.zoom&&(_=!0,f.zoom=+i.zoom),i.center!==void 0&&(f.center=r.aJ.convert(i.center)),"bearing"in i&&f.bearing!==+i.bearing&&(v=!0,f.bearing=+i.bearing),"pitch"in i&&f.pitch!==+i.pitch&&(w=!0,f.pitch=+i.pitch),i.padding!=null){let E=typeof i.padding=="number"?this._extendPadding(i.padding):i.padding;f.isPaddingEqual(E)||(f.padding=E)}return i.preloadOnly?(this._preloadTiles(f),this):(this.fire(new r.g("movestart",a)).fire(new r.g("move",a)),_&&this.fire(new r.g("zoomstart",a)).fire(new r.g("zoom",a)).fire(new r.g("zoomend",a)),v&&this.fire(new r.g("rotatestart",a)).fire(new r.g("rotate",a)).fire(new r.g("rotateend",a)),w&&this.fire(new r.g("pitchstart",a)).fire(new r.g("pitch",a)).fire(new r.g("pitchend",a)),this.fire(new r.g("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(ch),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,a){let f=this.transform;if(!f.projection.supportsFreeCamera)return r.w(ch),this;this.stop();let _=f.zoom,v=f.pitch,w=f.bearing;f.setFreeCameraOptions(i);let E=_!==f.zoom,D=v!==f.pitch,C=w!==f.bearing;return this.fire(new r.g("movestart",a)).fire(new r.g("move",a)),E&&this.fire(new r.g("zoomstart",a)).fire(new r.g("zoom",a)).fire(new r.g("zoomend",a)),C&&this.fire(new r.g("rotatestart",a)).fire(new r.g("rotate",a)).fire(new r.g("rotateend",a)),D&&this.fire(new r.g("pitchstart",a)).fire(new r.g("pitch",a)).fire(new r.g("pitchend",a)),this.fire(new r.g("moveend",a)),this}easeTo(i,a){this._stop(!1,i.easeId),((i=r.Q({offset:[0,0],duration:500,easing:r.d5},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);let f=this.transform,_=this.getZoom(),v=this.getBearing(),w=this.getPitch(),E=this.getPadding(),D="zoom"in i?+i.zoom:_,C="bearing"in i?this._normalizeBearing(i.bearing,v):v,P="pitch"in i?+i.pitch:w,O=this._extendPadding(i.padding),F=r.P.convert(i.offset),z,U,$;if(f.projection.name==="globe"){let he=r._.fromLngLat(f.center),xe=F.rotate(-f.angle);he.x+=xe.x/f.worldSize,he.y+=xe.y/f.worldSize;let de=he.toLngLat(),oe=r.aJ.convert(i.center||de);this._normalizeCenter(oe),z=f.centerPoint.add(xe),U=new r.P(he.x,he.y).mult(f.worldSize),$=new r.P(r.ak(oe.lng),r.al(oe.lat)).mult(f.worldSize).sub(U)}else{z=f.centerPoint.add(F);let he=f.pointLocation(z),xe=r.aJ.convert(i.center||he);this._normalizeCenter(xe),U=f.project(he),$=f.project(xe).sub(U)}let G=f.zoomScale(D-_),H,K;i.around&&(H=r.aJ.convert(i.around),K=f.locationPoint(H));let J=this._zooming||D!==_,Q=this._rotating||v!==C,se=this._pitching||P!==w,te=!f.isPaddingEqual(O),ne=he=>xe=>{if(J&&(he.zoom=r.a3(_,D,xe)),Q&&(he.bearing=r.a3(v,C,xe)),se&&(he.pitch=r.a3(w,P,xe)),te&&(he.interpolatePadding(E,O,xe),z=he.centerPoint.add(F)),H)he.setLocationAtPoint(H,K);else{let de=he.zoomScale(he.zoom-_),oe=D>_?Math.min(2,G):Math.max(.5,G),Me=Math.pow(oe,1-xe),Ee=he.unproject(U.add($.mult(xe*Me)).mult(de));he.setLocationAtPoint(he.renderWorldCopies?Ee.wrap():Ee,z)}return i.preloadOnly||this._fireMoveEvents(a),he};if(i.preloadOnly){let he=this._emulate(ne,i.duration,f);return this._preloadTiles(he),this}let ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=J,this._rotating=Q,this._pitching=se,this._padding=te,this._easeId=i.easeId,this._prepareEase(a,i.noMoveStart,ce),this._ease(ne(f),he=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(a,he)},i),this}_prepareEase(i,a,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||f.moving||this.fire(new r.g("movestart",i)),this._zooming&&!f.zooming&&this.fire(new r.g("zoomstart",i)),this._rotating&&!f.rotating&&this.fire(new r.g("rotatestart",i)),this._pitching&&!f.pitching&&this.fire(new r.g("pitchstart",i))}_fireMoveEvents(i){this.fire(new r.g("move",i)),this._zooming&&this.fire(new r.g("zoom",i)),this._rotating&&this.fire(new r.g("rotate",i)),this._pitching&&this.fire(new r.g("pitch",i))}_afterEase(i,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let f=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new r.g("zoomend",i)),_&&this.fire(new r.g("rotateend",i)),v&&this.fire(new r.g("pitchend",i)),this.fire(new r.g("moveend",i))}flyTo(i,a){if(this._prefersReducedMotion(i)){let Ae=r.ai(i,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(Ae,a)}this.stop(),i=r.Q({offset:[0,0],speed:1.2,curve:1.42,easing:r.d5},i);let f=this.transform,_=this.getZoom(),v=this.getBearing(),w=this.getPitch(),E=this.getPadding(),D="zoom"in i?r.au(+i.zoom,f.minZoom,f.maxZoom):_,C="bearing"in i?this._normalizeBearing(i.bearing,v):v,P="pitch"in i?+i.pitch:w,O=this._extendPadding(i.padding),F=f.zoomScale(D-_),z=r.P.convert(i.offset),U=f.centerPoint.add(z),$=f.pointLocation(U),G=r.aJ.convert(i.center||$);this._normalizeCenter(G);let H=f.project($),K=f.project(G).sub(H),J=i.curve,Q=Math.max(f.width,f.height),se=Q/F,te=K.mag();if("minZoom"in i){let Ae=r.au(Math.min(i.minZoom,_,D),f.minZoom,f.maxZoom),fe=Q/f.zoomScale(Ae-_);J=Math.sqrt(fe/te*2)}let ne=J*J;function ce(Ae){let fe=(se*se-Q*Q+(Ae?-1:1)*ne*ne*te*te)/(2*(Ae?se:Q)*ne*te);return Math.log(Math.sqrt(fe*fe+1)-fe)}function he(Ae){return(Math.exp(Ae)-Math.exp(-Ae))/2}function xe(Ae){return(Math.exp(Ae)+Math.exp(-Ae))/2}let de=ce(0),oe=function(Ae){return xe(de)/xe(de+J*Ae)},Me=function(Ae){return Q*((xe(de)*(he(fe=de+J*Ae)/xe(fe))-he(de))/ne)/te;var fe},Ee=(ce(1)-de)/J;if(Math.abs(te)<1e-6||!isFinite(Ee)){if(Math.abs(Q-se)<1e-6)return this.easeTo(i,a);let Ae=se<Q?-1:1;Ee=Math.abs(Math.log(se/Q))/J,Me=function(){return 0},oe=function(fe){return Math.exp(Ae*J*fe)}}i.duration="duration"in i?+i.duration:1e3*Ee/("screenSpeed"in i?+i.screenSpeed/J:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);let me=v!==C,je=P!==w,Fe=!f.isPaddingEqual(O),be=Ae=>fe=>{let Ne=fe*Ee,Be=1/oe(Ne);Ae.zoom=fe===1?D:_+Ae.scaleZoom(Be),me&&(Ae.bearing=r.a3(v,C,fe)),je&&(Ae.pitch=r.a3(w,P,fe)),Fe&&(Ae.interpolatePadding(E,O,fe),U=Ae.centerPoint.add(z));let Ke=fe===1?G:Ae.unproject(H.add(K.mult(Me(Ne))).mult(Be));return Ae.setLocationAtPoint(Ae.renderWorldCopies?Ke.wrap():Ke,U),Ae._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(a),Ae};if(i.preloadOnly){let Ae=this._emulate(be,i.duration,f);return this._preloadTiles(Ae),this}return this._zooming=!0,this._rotating=me,this._pitching=je,this._padding=Fe,this._prepareEase(a,!1),this._ease(be(f),()=>this._afterEase(a),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,a)}if(!i){let f=this.handlers;f&&f.stop(!1)}return this}_ease(i,a,f){f.animate===!1||f.duration===0?(i(1),a()):(this._easeStart=r.e.now(),this._easeOptions=f,this._onEaseFrame=i,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let i=Math.min((r.e.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,a){i=r.av(i,-180,180);let f=Math.abs(i-a);return Math.abs(i-360-a)<f&&(i-=360),Math.abs(i+360-a)<f&&(i+=360),i}_normalizeCenter(i){let a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;let f=i.lng-a.center.lng;i.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&r.e.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,a,f){let _=Math.ceil(15*a/1e3),v=[],w=i(f.clone());for(let E=0;E<=_;E++){let D=w(E/_);v.push(D.clone())}return v}_preloadTiles(i,a){}}class Rc{constructor(i={}){this.options=i,r.br(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){let a=this.options&&this.options.compact,f=i._getUIString("AttributionControl.ToggleAttribution");this._map=i,this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Y("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);let _=Y("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",f),this._innerContainer=Y("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));let a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.db.ACCESS_TOKEN}];if(i){let f=a.reduce((_,v,w)=>(v.value&&(_+=`${v.key}=${v.value}${w<a.length-1?"&":""}`),_),"?");i.href=`${r.db.FEEDBACK_URL}/${f}#${xf(this._map,!0)}`,i.rel="noopener nofollow"}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){let _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}let a=this._map.style._mergedSourceCaches;for(let _ in a){let v=a[_];if(v.used){let w=v.getSource();w.attribution&&i.indexOf(w.attribution)<0&&i.push(w.attribution)}}i.sort((_,v)=>_.length-v.length),i=i.filter((_,v)=>{for(let w=v+1;w<i.length;w++)if(i[w].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));let f=i.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,i.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class uh{constructor(){r.br(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=Y("div","mapboxgl-ctrl");let a=Y("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(let a in i){let f=i[a].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){let i=this._container.children;if(i.length){let a=i[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class hh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){let a=++this._id;return this._queue.push({callback:i,id:a,cancelled:!1}),a}remove(i){let a=this._currentlyRunning,f=a?this._queue.concat(a):this._queue;for(let _ of f)if(_.id===i)return void(_.cancelled=!0)}run(i=0){let a=this._currentlyRunning=this._queue;this._queue=[];for(let f of a)if(!f.cancelled&&(f.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Oc(d,i,a){if(d=new r.aJ(d.lng,d.lat),i){let f=new r.aJ(d.lng-360,d.lat),_=new r.aJ(d.lng+360,d.lat),v=360*Math.ceil(Math.abs(d.lng-a.center.lng)/360),w=a.locationPoint(d).distSqr(i),E=i.x<0||i.y<0||i.x>a.width||i.y>a.height;a.locationPoint(f).distSqr(i)<w&&(E||Math.abs(f.lng-a.center.lng)<v)?d=f:a.locationPoint(_).distSqr(i)<w&&(E||Math.abs(_.lng-a.center.lng)<v)&&(d=_)}for(;Math.abs(d.lng-a.center.lng)>180;){let f=a.locationPoint(d);if(f.x>=0&&f.y>=0&&f.x<=a.width&&f.y<=a.height)break;d.lng>a.center.lng?d.lng-=360:d.lng+=360}return d}let dh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class fh extends r.E{constructor(i,a){if(super(),(i instanceof HTMLElement||a)&&(i=r.Q({element:i},a)),r.br(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=r.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=Y("div");let v=41,w=27,E=ve("svg",{display:"block",height:v*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${v}`},this._element),D=ve("radialGradient",{id:"shadowGradient"},ve("defs",{},E));ve("stop",{offset:"10%","stop-opacity":.4},D),ve("stop",{offset:"100%","stop-opacity":.05},D),ve("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),ve("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),ve("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),ve("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=r.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});let f=this._element.classList;for(let v in dh)f.remove(`mapboxgl-marker-anchor-${v}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`);let _=i&&i.className?i.className.trim().split(/\s+/):[];f.add(..._),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){let i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=r.aJ.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){let _=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){let a=i.code,f=i.charCode||i.keyCode;a!=="Space"&&a!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(i){let a=i.originalEvent.target,f=this._element;this._popup&&(a===f||f.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let i=this._map,a=this._pos;if(!i||!a)return!1;let f=i.unproject(a),_=i.getFreeCameraOptions();if(!_.position)return!1;let v=_.position.toLngLat();return v.distanceTo(f)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){let i=this._map;if(!i)return;let a=this._pos;if(!a||a.x<0||a.x>i.transform.width||a.y<0||a.y>i.transform.height)return void this._clearFadeTimer();let f=i.unproject(a),_;i._showingGlobe()&&r.dc(i.transform,this._lngLat)?_=0:(_=1-i._queryFogOpacity(f),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let i=this._pos;if(!i||!this._map)return;let a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${dh[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){let i=this._pos,a=this._map,f=this.getPitchAlignment();if(!a||!i||f!=="map")return"";if(!a._showingGlobe()){let D=a.getPitch();return D?`rotateX(${D}deg)`:""}let _=r.b1(r.dd(a.transform,this._lngLat)),v=i.sub(r.de(a.transform)),w=Math.abs(v.x)+Math.abs(v.y);if(w===0)return"";let E=_/w;return`rotateX(${-v.y*E}deg) rotateY(${v.x*E}deg)`}_calculateZTransform(){let i=this._pos,a=this._map;if(!a||!i)return"";let f=0,_=this.getRotationAlignment();if(_==="map")if(a._showingGlobe()){let v=a.project(new r.aJ(this._lngLat.lng,this._lngLat.lat+.001)),w=a.project(new r.aJ(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);f=r.b1(Math.atan2(w.y,w.x))-90}else f=-a.getBearing();else if(_==="horizon"){let v=r.a0(4,6,a.getZoom()),w=r.de(a.transform);w.y+=v*a.transform.height;let E=i.sub(w),D=r.b1(Math.atan2(E.y,E.x));f=(D>90?D-270:D+90)*(1-v)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);let a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Oc(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=r.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){let a=this._map;if(!a)return;let f=this._pointerdownPos,_=this._positionDelta;if(f&&_){if(!this._isDragging){let v=this._clickTolerance||a._clickTolerance;if(i.point.dist(f)<v)return;this._isDragging=!0}this._pos=i.point.sub(_),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.g("dragstart"))),this.fire(new r.g("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.g("dragend")),this._state="inactive"}_addDragHandler(i){let a=this._map,f=this._pos;a&&f&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(f),this._pointerdownPos=i.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;let a=this._map;return a&&(i?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let Ya={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},S0=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function cg(d=new r.P(0,0),i="bottom"){if(typeof d=="number"){let a=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(i){case"top":return new r.P(0,d);case"top-left":return new r.P(a,a);case"top-right":return new r.P(-a,a);case"bottom":return new r.P(0,-d);case"bottom-left":return new r.P(a,-a);case"bottom-right":return new r.P(-a,-a);case"left":return new r.P(d,0);case"right":return new r.P(-d,0)}return new r.P(0,0)}return d instanceof r.P||Array.isArray(d)?r.P.convert(d):r.P.convert(d[i]||[0,0])}class A0{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;let a=r.bb((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,a,f){this._start=this.getValue(a),this._end=i,this._startTime=a,this._endTime=a+f}}let P0={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class R0{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let O0={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},Sf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Af{constructor(i,a,f=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Dc({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,f&&(this.mousePitch=new sh({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),r.br(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(i,a){this.mouseRotate.mousedown(i,a),this.mousePitch&&this.mousePitch.mousedown(i,a),Ot()}move(i,a){let f=this.map,_=this.mouseRotate.mousemoveWindow(i,a),v=_&&_.bearingDelta;if(v&&f.setBearing(f.getBearing()+v),this.mousePitch){let w=this.mousePitch.mousemoveWindow(i,a),E=w&&w.pitchDelta;E&&f.setPitch(f.getPitch()+E)}}off(){let i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Jt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(r.Q({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),rn(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,rn(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=on(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=on(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let ug={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Qa={maxWidth:100,unit:"metric"},hg={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:r.dw,supported:A,setRTLTextPlugin:r.dy,getRTLTextPluginStatus:r.dz,Map:class extends Cf{constructor(d){r.df.mark(r.dg.create);let i=d;if((d=r.Q({},O0,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&r.dh(window)&&(d.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ql(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new hh,this._domRenderTaskQueue=new hh,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.di(),this._locale=r.Q({},P0,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new A0(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new r.dj(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?Rt({},d.contextCreateOptions):{},typeof d.container=="string"){let a=document.getElementById(d.container);if(!a)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=a}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),r.br(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new R0),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new lh(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||r.db.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),d.hash&&(this._hash=new eg(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});let a=d.bounds;a&&(this.resize(),this.fitBounds(a,r.Q({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new Rc({customAttribution:d.customAttribution})),this._logoControl=new uh,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new r.g(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new r.g(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(d,i){if(i===void 0&&(i=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new r.f(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let a=d.onAdd(this);this._controls.push(d);let f=this._controlPositions[i];return i.indexOf("bottom")!==-1?f.insertBefore(a,f.firstChild):f.appendChild(a),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new r.f(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let i=this._controls.indexOf(d);return i>-1&&this._controls.splice(i,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let i=!this._moving;return i&&this.fire(new r.g("movestart",d)).fire(new r.g("move",d)),this.fire(new r.g("resize",d)),i&&this.fire(new r.g("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(r.aj.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new r.g("zoomstart")).fire(new r.g("zoom")).fire(new r.g("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new r.g("zoomstart")).fire(new r.g("zoom")).fire(new r.g("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new r.g("pitchstart")).fire(new r.g("pitch")).fire(new r.g("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new r.g("pitchstart")).fire(new r.g("pitch")).fire(new r.g("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(i=>i==="auto"?navigator.language:i):d}setLanguage(d){let i=this._parseLanguage(d);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(let a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let d=this.transform,i=d.projection.name,a;i==="globe"&&d.zoom>=r.aV?(d.setMercatorFromTransition(),a=!0):i==="mercator"&&d.zoom<r.aV&&(d.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,i){return this._updateProjection(d||i||{name:"mercator"})}_updateProjection(d){let i;return i=d.name==="globe"&&this.transform.zoom>=r.aV?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d){return this.transform.locationPoint3D(r.aJ.convert(d))}unproject(d){return this.transform.pointLocation3D(r.P.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,i,a){if(d==="mouseenter"||d==="mouseover"){let f=!1,_=w=>{let E=i.filter(C=>this.getLayer(C)),D=E.length?this.queryRenderedFeatures(w.point,{layers:E}):[];D.length?f||(f=!0,a.call(this,new bi(d,this,w.originalEvent,{features:D}))):f=!1},v=()=>{f=!1};return{layers:new Set(i),listener:a,delegates:{mousemove:_,mouseout:v}}}if(d==="mouseleave"||d==="mouseout"){let f=!1,_=w=>{let E=i.filter(D=>this.getLayer(D));(E.length?this.queryRenderedFeatures(w.point,{layers:E}):[]).length?f=!0:f&&(f=!1,a.call(this,new bi(d,this,w.originalEvent)))},v=w=>{f&&(f=!1,a.call(this,new bi(d,this,w.originalEvent)))};return{layers:new Set(i),listener:a,delegates:{mousemove:_,mouseout:v}}}{let f=_=>{let v=i.filter(E=>this.getLayer(E)),w=v.length?this.queryRenderedFeatures(_.point,{layers:v}):[];w.length&&(_.features=w,a.call(this,_),delete _.features)};return{layers:new Set(i),listener:a,delegates:{[d]:f}}}}on(d,i,a){if(typeof i=="function"||a===void 0)return super.on(d,i);if(Array.isArray(i)||(i=[i]),i){for(let _ of i)if(!this._isValidId(_))return this}let f=this._createDelegatedListener(d,i,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(let _ in f.delegates)this.on(_,f.delegates[_]);return this}once(d,i,a){if(typeof i=="function"||a===void 0)return super.once(d,i);if(Array.isArray(i)||(i=[i]),i){for(let _ of i)if(!this._isValidId(_))return this}let f=this._createDelegatedListener(d,i,a);for(let _ in f.delegates)this.once(_,f.delegates[_]);return this}off(d,i,a){if(typeof i=="function"||a===void 0)return super.off(d,i);let f=new Set(Array.isArray(i)?i:[i]);for(let w of f)if(!this._isValidId(w))return this;let _=(w,E)=>{if(w.size!==E.size)return!1;for(let D of w)if(!E.has(D))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[d]:void 0;return v&&(w=>{for(let E=0;E<w.length;E++){let D=w[E];if(D.listener===a&&_(D.layers,f)){for(let C in D.delegates)this.off(C,D.delegates[C]);return w.splice(E,1),this}}})(v),this}queryRenderedFeatures(d,i){if(!this.style)return[];if(i!==void 0||d===void 0||d instanceof r.P||Array.isArray(d)||(i=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers)){for(let a of i.layers)if(!this._isValidId(a))return[]}return this.style.queryRenderedFeatures(d,i,this.transform)}querySourceFeatures(d,i){return this._isValidId(d)?this.style.querySourceFeatures(d,i):[]}isPointOnSurface(d){let{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&r.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(d))}setStyle(d,i){return i=r.Q({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&d&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(d,(a,f)=>{a?(r.w(`Unable to perform style diff: ${String(a.message||a.error||a)}. Rebuilding the style from scratch.`),this._updateStyle(d,i)):f&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(d,i))}_getUIString(d){let i=this._locale[d];if(i==null)throw new Error(`Missing UI string '${d}'`);return i}_updateStyle(d,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){let a=r.Q({},i);i&&i.config&&(a.initialConfig=i.config,delete a.config),this.style=new xi(this,a).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new xi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new r.f(new Error("IDs can't be empty."))),!1):!r.cY(d)||(this.fire(new r.f(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}addSource(d,i){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,i),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,i,a){this._lazyInitEmptyStyle(),this.style.addSourceType(d,i,a)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,i,{pixelRatio:a=1,sdf:f=!1,stretchX:_,stretchY:v,content:w}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){let{width:E,height:D,data:C}=r.e.getImageData(i);this.style.addImage(d,{data:new r.j({width:E,height:D},C),pixelRatio:a,stretchX:_,stretchY:v,content:w,sdf:f,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new r.f(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:E,height:D}=i,C=i;this.style.addImage(d,{data:new r.j({width:E,height:D},new Uint8Array(C.data)),pixelRatio:a,stretchX:_,stretchY:v,content:w,sdf:f,version:0,userImage:C}),C.onAdd&&C.onAdd(this,d)}}updateImage(d,i){this._lazyInitEmptyStyle();let a=this.style.getImage(d);if(!a)return void this.fire(new r.f(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let f=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?r.e.getImageData(i):i,{width:_,height:v,data:w}=f;if(_===void 0||v===void 0)return void this.fire(new r.f(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==a.data.width||v!==a.data.height)return void this.fire(new r.f(new Error(`The width and height of the updated image (${_}, ${v})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`)));let E=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);a.data.replace(w,E),this.style.updateImage(d,a)}hasImage(d){return d?!!this.style&&!!this.style.getImage(d):(this.fire(new r.f(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,i){r.i(this._requestManager.transformRequest(d,r.R.Image),(a,f)=>{i(a,f instanceof HTMLImageElement?r.e.getImageData(f):f)})}listImages(){return this.style.listImages()}addModel(d,i){this._lazyInitEmptyStyle(),this.style.addModel(d,i)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new r.f(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,i){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,i),this._update(!0)):this}getSlot(d){let i=this.getLayer(d);return i&&i.slot||null}setSlot(d,i){return this.style.setSlot(d,i),this.style.mergeLayers(),this._update(!0)}addImport(d,i){return this.style.addImport(d,i),this}updateImport(d,i){return typeof i!="string"&&i.id!==d?(this.removeImport(d),this.addImport(i)):(this.style.updateImport(d,i),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,i){return this.style.moveImport(d,i),this._update(!0)}moveLayer(d,i){return this._isValidId(d)?(this.style.moveLayer(d,i),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;let i=this.style.getOwnLayer(d);return i?i.type==="custom"?i.implementation:i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,i,a){return this._isValidId(d)?(this.style.setLayerZoomRange(d,i,a),this._update(!0)):this}setFilter(d,i,a={}){return this._isValidId(d)?(this.style.setFilter(d,i,a),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,i,a,f={}){return this._isValidId(d)?(this.style.setPaintProperty(d,i,a,f),this._update(!0)):this}getPaintProperty(d,i){return this._isValidId(d)?this.style.getPaintProperty(d,i):null}setLayoutProperty(d,i,a,f={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,i,a,f),this._update(!0)):this}getLayoutProperty(d,i){return this._isValidId(d)?this.style.getLayoutProperty(d,i):null}getSchema(d){return this.style.getSchema(d)}setSchema(d,i){return this.style.setSchema(d,i),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,i){return this.style.setConfig(d,i),this._update(!0)}getConfigProperty(d,i){return this.style.getConfigProperty(d,i)}setConfigProperty(d,i,a){return this.style.setConfigProperty(d,i,a),this._update(!0)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){let i=d[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aJ.convert(d),this.transform):0}setFeatureState(d,i){return this._isValidId(d.source)?(this.style.setFeatureState(d,i),this._update()):this}removeFeatureState(d,i){return this._isValidId(d.source)?(this.style.removeFeatureState(d,i),this._update()):this}getFeatureState(d){return this._isValidId(d.source)?this.style.getFeatureState(d):null}_updateContainerDimensions(){if(!this._container)return;let d=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300,a,f,_,v=this._container;for(;v&&(!f||!_);){let w=window.getComputedStyle(v).transform;w&&w!=="none"&&(a=w.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(f=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(_=a[3])),v=v.parentElement}this._containerWidth=f?Math.abs(d/f):d,this._containerHeight=_?Math.abs(i/_):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=Y("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();let i=this._canvasContainer=Y("div","mapboxgl-canvas-container",d);this._canvas=Y("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let a=this._controlContainer=Y("div","mapboxgl-control-container",d),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{f[_]=Y("div",`mapboxgl-ctrl-${_}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,i){let a=r.e.devicePixelRatio||1;this._canvas.width=a*Math.ceil(d),this._canvas.height=a*Math.ceil(i),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${i}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){let i=this._markers.indexOf(d);i!==-1&&this._markers.splice(i,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){let i=this._popups.indexOf(d);i!==-1&&this._popups.splice(i,1)}_setupPainter(){let d=r.Q({},A.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",d);i?(r.dk(i,!0),this.painter=new ff(i,this._contextCreateOptions,this.transform,this._tp),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.dl.testSupport(i)):this.fire(new r.f(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.g("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new r.g("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let i;this.fire(new r.g("renderstart")),++this._frameId;let a=this.painter.context.extTimerQuery,f=r.e.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=_.createQuery(),_.beginQuery(a.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();let v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let C=this.transform.zoom,P=this.transform.pitch,O=r.e.now(),F=new r.Y(C,{now:O,fadeDuration:v,pitch:P,transition:this.style.transition});this.style.update(F)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(f),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(f);let E=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource);if(E&&(this._placementDirty=E.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.g("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,r.df.mark(r.dg.load),this.fire(new r.g("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){let C=r.e.now()-f;_.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{let P=_.getQueryParameter(i,_.QUERY_RESULT)/1e6;_.deleteQuery(i),this.fire(new r.g("gpu-timing-frame",{cpuTime:C,gpuTime:P}))},50)}if(this.listens("gpu-timing-layer")){let C=this.painter.collectGpuTimers();setTimeout(()=>{let P=this.painter.queryGpuTimers(C);this.fire(new r.g("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){let C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let P=this.painter.queryGpuTimeDeferredRender(C);this.fire(new r.g("gpu-timing-deferred-render",{gpuTime:P}))},50)}let D=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(D||this._repaint)this.triggerRepaint();else{let C=this.idle();if(C&&(w=this._updateAverageElevation(f,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new r.g("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let P=this._calculateSpeedIndex();this.fire(new r.g("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,r.df.mark(r.dg.fullLoad),this._performanceMetricsCollection&&r.dm(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(let i of this._markers)d&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(let i of this._popups)!d||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(d,i=!1){let a=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);let f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(i||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){let _=this.transform.averageElevation,v=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=d;let w=Math.abs(_-v);if(w>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(v),a(v);this._averageElevation.easeTo(v,d,300)}else if(w>1e-4)return this._averageElevation.jumpTo(v),a(v)}return!!this._averageElevation.isEasing(d)&&a(this._averageElevation.getValue(d))}_authenticate(){r.dn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===r.dp||d.status===401)){let i=this.painter.context.gl;r.dk(i,!1),this._logoControl instanceof uh&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.f(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.dq(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&r.dr(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){let d=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());let a=this.painter.context.gl,f=a.createFramebuffer();function _(v){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,v,0);let w=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,w),w}return a.bindFramebuffer(a.FRAMEBUFFER,f),this._canvasPixelComparison(_(d),i.canvasCopies.map(_),i.timeStamps)}_canvasPixelComparison(d,i,a){let f=a[1]-a[0],_=d.length/4;for(let v=0;v<i.length;v++){let w=i[v],E=0;for(let D=0;D<w.length;D+=4)w[D]===d[D]&&w[D+1]===d[D+1]&&w[D+2]===d[D+2]&&w[D+3]===d[D+3]&&(E+=1);f+=(a[v+2]-a[v+1])*(1-E/_)}return f}remove(){this._hash&&this._hash.remove();for(let i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.ds(this.painter.context.gl),r.dt.remove(),r.du.remove(),this._removed=!0,this.fire(new r.g("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=r.e.frame(i=>{let a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(i)}))}_preloadTiles(d){let i=this.style?this.style.getSourceCaches():[];return r.dv(i,(a,f)=>a._preloadTiles(d,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,i){r.dx(d,i)}get version(){return r.dw}},NavigationControl:class{constructor(d={}){this.options=r.Q({},Sf,d),this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(r.br(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),Y("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),Y("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.br(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{let a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:i}):a.resetNorth({},{originalEvent:i}))}),this._compassIcon=Y("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let d=this._map;if(!d)return;let i=d.getZoom(),a=i===d.getMaxZoom(),f=i===d.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){let d=this._map;if(!d)return;let i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Af(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){let d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,i){let a=Y("button",d,this._container);return a.type="button",a.addEventListener("click",i),a}_setButtonTitle(d,i){if(!this._map)return;let a=this._map._getUIString(`NavigationControl.${i}`);d.setAttribute("aria-label",a),d.firstElementChild&&d.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends r.E{constructor(d={}){super();let i=navigator.geolocation;this.options=r.Q({geolocation:i},ug,d),r.br(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Jm(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){let i=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,d(a)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>i(a.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(d){let i=this._map.getMaxBounds(),a=d.coords;return!!i&&(a.longitude<i.getWest()||a.longitude>i.getEast()||a.latitude<i.getSouth()||a.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new r.g("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.g("geolocate",d)),this._finish()}}_updateCamera(d){let i=new r.aJ(d.coords.longitude,d.coords.latitude),a=d.coords.accuracy,f=this._map.getBearing(),_=r.Q({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(a),_,{geolocateSource:!0})}_updateMarker(d){if(d){let i=new r.aJ(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let d=this._map.transform,i=r.ay(1,d._center.lat)*d.worldSize,a=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.g("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=Y("button","mapboxgl-ctrl-geolocate",this._container),Y("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");let i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{let i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Y("div","mapboxgl-user-location"),this._dotElement.appendChild(Y("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Y("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new fh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Y("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new fh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.g("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.g("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.g("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.g("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Rc,ScaleControl:class{constructor(d={}){this.options=r.Q({},Qa,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.br(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let d=this.options.maxWidth||100,i=this._map,a=i._containerHeight/2,f=i._containerWidth/2-d/2,_=i.unproject([f,a]),v=i.unproject([f+d,a]),w=_.distanceTo(v);if(this.options.unit==="imperial"){let E=3.2808*w;E>5280?this._setScale(d,E/5280,"mile"):this._setScale(d,E,"foot")}else this.options.unit==="nautical"?this._setScale(d,w/1852,"nautical-mile"):w>=1e3?this._setScale(d,w/1e3,"kilometer"):this._setScale(d,w,"meter")}_setScale(d,i,a){this._map._requestDomTask(()=>{let f=function(v){let w=Math.pow(10,`${Math.floor(v)}`.length-1),E=v/w;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(D){let C=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*C)/C}(E),w*E}(i),_=f/i;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(f):`${f}&nbsp;${hg[a]}`,this._container.style.width=d*_+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:r.w("Full screen control 'container' must be a DOM element.")),r.br(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let d=this._fullscreenButton=Y("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Y("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(d){super(),this.options=r.Q(Object.create(Ya),d),r.br(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new r.g("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new r.g("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=r.aJ.convert(d),this._pos=null,this._trackPointer=!1,this._update();let i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){let i=document.createDocumentFragment(),a=document.createElement("body"),f;for(a.innerHTML=d;f=a.firstChild,f;)i.appendChild(f);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=Y("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(d),this.options.closeButton){let a=this._closeButton=Y("button","mapboxgl-popup-close-button",i);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let i;return this._classList.delete(d)?i=!1:(this._classList.add(d),i=!0),this._updateClassList(),i}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;let i=this._map,a=this._container,f=this._pos;if(!i||!a||!f)return"bottom";let _=a.offsetWidth,v=a.offsetHeight,w=f.x<_/2,E=f.x>i.transform.width-_/2;if(f.y+d<v)return w?"top-left":E?"top-right":"top";if(f.y>i.transform.height-v){if(w)return"bottom-left";if(E)return"bottom-right"}return w?"left":E?"right":"bottom"}_updateClassList(){let d=this._container;if(!d)return;let i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),d.className=i.join(" ")}_update(d){let i=this._map,a=this._content;if(!i||!this._lngLat&&!this._trackPointer||!a)return;let f=this._container;if(f||(f=this._container=Y("div","mapboxgl-popup",i.getContainer()),this._tip=Y("div","mapboxgl-popup-tip",f),f.appendChild(a)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Oc(this._lngLat,this._pos,i.transform)),!this._trackPointer||d){let _=this._pos=this._trackPointer&&d instanceof r.P?d:i.project(this._lngLat),v=cg(this.options.offset),w=this._anchor=this._getAnchor(v.y),E=cg(this.options.offset,w),D=_.add(E).round();i._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${dh[w]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&i._showingGlobe()){let _=r.dc(i.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let d=this._container.querySelector(S0);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:fh,Style:xi,LngLat:r.aJ,LngLatBounds:r.aj,Point:r.P,MercatorCoordinate:r._,FreeCameraOptions:wm,Evented:r.E,config:r.db,prewarm:r.dA,clearPrewarmedResources:r.dB,get accessToken(){return r.db.ACCESS_TOKEN},set accessToken(d){r.db.ACCESS_TOKEN=d},get baseApiUrl(){return r.db.API_URL},set baseApiUrl(d){r.db.API_URL=d},get workerCount(){return r.dC.workerCount},set workerCount(d){r.dC.workerCount=d},get maxParallelImageRequests(){return r.db.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){r.db.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){r.dD(d)},get workerUrl(){return r.dE.workerUrl},set workerUrl(d){r.dE.workerUrl=d},get workerClass(){return r.dE.workerClass},set workerClass(d){r.dE.workerClass=d},get workerParams(){return r.dE.workerParams},set workerParams(d){r.dE.workerParams=d},get dracoUrl(){return r.dF()},set dracoUrl(d){r.dG(d)},get meshoptUrl(){return r.dH()},set meshoptUrl(d){r.dI(d)},setNow:r.e.setNow,restoreNow:r.e.restoreNow}});var b=g;return b})});var tD=null;var Ix=1,nD=Symbol("SIGNAL");function qn(l){let c=tD;return tD=l,c}var rD={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function bL(l){if(!(Cx(l)&&!l.dirty)&&!(!l.dirty&&l.lastCleanEpoch===Ix)){if(!l.producerMustRecompute(l)&&!Mx(l)){l.dirty=!1,l.lastCleanEpoch=Ix;return}l.producerRecomputeValue(l),l.dirty=!1,l.lastCleanEpoch=Ix}}function iD(l){return l&&(l.nextProducerIndex=0),qn(l)}function oD(l,c){if(qn(c),!(!l||l.producerNode===void 0||l.producerIndexOfThis===void 0||l.producerLastReadVersion===void 0)){if(Cx(l))for(let g=l.nextProducerIndex;g<l.producerNode.length;g++)Dx(l.producerNode[g],l.producerIndexOfThis[g]);for(;l.producerNode.length>l.nextProducerIndex;)l.producerNode.pop(),l.producerLastReadVersion.pop(),l.producerIndexOfThis.pop()}}function Mx(l){x_(l);for(let c=0;c<l.producerNode.length;c++){let g=l.producerNode[c],p=l.producerLastReadVersion[c];if(p!==g.version||(bL(g),p!==g.version))return!0}return!1}function sD(l){if(x_(l),Cx(l))for(let c=0;c<l.producerNode.length;c++)Dx(l.producerNode[c],l.producerIndexOfThis[c]);l.producerNode.length=l.producerLastReadVersion.length=l.producerIndexOfThis.length=0,l.liveConsumerNode&&(l.liveConsumerNode.length=l.liveConsumerIndexOfThis.length=0)}function Dx(l,c){if(wL(l),x_(l),l.liveConsumerNode.length===1)for(let p=0;p<l.producerNode.length;p++)Dx(l.producerNode[p],l.producerIndexOfThis[p]);let g=l.liveConsumerNode.length-1;if(l.liveConsumerNode[c]=l.liveConsumerNode[g],l.liveConsumerIndexOfThis[c]=l.liveConsumerIndexOfThis[g],l.liveConsumerNode.length--,l.liveConsumerIndexOfThis.length--,c<l.liveConsumerNode.length){let p=l.liveConsumerIndexOfThis[c],b=l.liveConsumerNode[c];x_(b),b.producerIndexOfThis[p]=c}}function Cx(l){return l.consumerIsAlwaysLive||(l?.liveConsumerNode?.length??0)>0}function x_(l){l.producerNode??=[],l.producerIndexOfThis??=[],l.producerLastReadVersion??=[]}function wL(l){l.liveConsumerNode??=[],l.liveConsumerIndexOfThis??=[]}function TL(){throw new Error}var EL=TL;function aD(l){EL=l}function _n(l){return typeof l=="function"}function $h(l){let g=l(p=>{Error.call(p),p.stack=new Error().stack});return g.prototype=Object.create(Error.prototype),g.prototype.constructor=g,g}var b_=$h(l=>function(g){l(this),this.message=g?`${g.length} errors occurred during unsubscription:
${g.map((p,b)=>`${b+1}) ${p.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=g});function wp(l,c){if(l){let g=l.indexOf(c);0<=g&&l.splice(g,1)}}var $r=class l{constructor(c){this.initialTeardown=c,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let c;if(!this.closed){this.closed=!0;let{_parentage:g}=this;if(g)if(this._parentage=null,Array.isArray(g))for(let r of g)r.remove(this);else g.remove(this);let{initialTeardown:p}=this;if(_n(p))try{p()}catch(r){c=r instanceof b_?r.errors:[r]}let{_finalizers:b}=this;if(b){this._finalizers=null;for(let r of b)try{lD(r)}catch(A){c=c??[],A instanceof b_?c=[...c,...A.errors]:c.push(A)}}if(c)throw new b_(c)}}add(c){var g;if(c&&c!==this)if(this.closed)lD(c);else{if(c instanceof l){if(c.closed||c._hasParent(this))return;c._addParent(this)}(this._finalizers=(g=this._finalizers)!==null&&g!==void 0?g:[]).push(c)}}_hasParent(c){let{_parentage:g}=this;return g===c||Array.isArray(g)&&g.includes(c)}_addParent(c){let{_parentage:g}=this;this._parentage=Array.isArray(g)?(g.push(c),g):g?[g,c]:c}_removeParent(c){let{_parentage:g}=this;g===c?this._parentage=null:Array.isArray(g)&&wp(g,c)}remove(c){let{_finalizers:g}=this;g&&wp(g,c),c instanceof l&&c._removeParent(this)}};$r.EMPTY=(()=>{let l=new $r;return l.closed=!0,l})();var Sx=$r.EMPTY;function w_(l){return l instanceof $r||l&&"closed"in l&&_n(l.remove)&&_n(l.add)&&_n(l.unsubscribe)}function lD(l){_n(l)?l():l.unsubscribe()}var Go={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Gh={setTimeout(l,c,...g){let{delegate:p}=Gh;return p?.setTimeout?p.setTimeout(l,c,...g):setTimeout(l,c,...g)},clearTimeout(l){let{delegate:c}=Gh;return(c?.clearTimeout||clearTimeout)(l)},delegate:void 0};function T_(l){Gh.setTimeout(()=>{let{onUnhandledError:c}=Go;if(c)c(l);else throw l})}function Tp(){}var cD=Ax("C",void 0,void 0);function uD(l){return Ax("E",void 0,l)}function hD(l){return Ax("N",l,void 0)}function Ax(l,c,g){return{kind:l,value:c,error:g}}var Yc=null;function Hh(l){if(Go.useDeprecatedSynchronousErrorHandling){let c=!Yc;if(c&&(Yc={errorThrown:!1,error:null}),l(),c){let{errorThrown:g,error:p}=Yc;if(Yc=null,g)throw p}}else l()}function dD(l){Go.useDeprecatedSynchronousErrorHandling&&Yc&&(Yc.errorThrown=!0,Yc.error=l)}var Qc=class extends $r{constructor(c){super(),this.isStopped=!1,c?(this.destination=c,w_(c)&&c.add(this)):this.destination=DL}static create(c,g,p){return new qh(c,g,p)}next(c){this.isStopped?Rx(hD(c),this):this._next(c)}error(c){this.isStopped?Rx(uD(c),this):(this.isStopped=!0,this._error(c))}complete(){this.isStopped?Rx(cD,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(c){this.destination.next(c)}_error(c){try{this.destination.error(c)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},IL=Function.prototype.bind;function Px(l,c){return IL.call(l,c)}var Ox=class{constructor(c){this.partialObserver=c}next(c){let{partialObserver:g}=this;if(g.next)try{g.next(c)}catch(p){E_(p)}}error(c){let{partialObserver:g}=this;if(g.error)try{g.error(c)}catch(p){E_(p)}else E_(c)}complete(){let{partialObserver:c}=this;if(c.complete)try{c.complete()}catch(g){E_(g)}}},qh=class extends Qc{constructor(c,g,p){super();let b;if(_n(c)||!c)b={next:c??void 0,error:g??void 0,complete:p??void 0};else{let r;this&&Go.useDeprecatedNextContext?(r=Object.create(c),r.unsubscribe=()=>this.unsubscribe(),b={next:c.next&&Px(c.next,r),error:c.error&&Px(c.error,r),complete:c.complete&&Px(c.complete,r)}):b=c}this.destination=new Ox(b)}};function E_(l){Go.useDeprecatedSynchronousErrorHandling?dD(l):T_(l)}function ML(l){throw l}function Rx(l,c){let{onStoppedNotification:g}=Go;g&&Gh.setTimeout(()=>g(l,c))}var DL={closed:!0,next:Tp,error:ML,complete:Tp};var Wh=typeof Symbol=="function"&&Symbol.observable||"@@observable";function eo(l){return l}function Lx(...l){return kx(l)}function kx(l){return l.length===0?eo:l.length===1?l[0]:function(g){return l.reduce((p,b)=>b(p),g)}}var Wn=(()=>{class l{constructor(g){g&&(this._subscribe=g)}lift(g){let p=new l;return p.source=this,p.operator=g,p}subscribe(g,p,b){let r=SL(g)?g:new qh(g,p,b);return Hh(()=>{let{operator:A,source:N}=this;r.add(A?A.call(r,N):N?this._subscribe(r):this._trySubscribe(r))}),r}_trySubscribe(g){try{return this._subscribe(g)}catch(p){g.error(p)}}forEach(g,p){return p=fD(p),new p((b,r)=>{let A=new qh({next:N=>{try{g(N)}catch(V){r(V),A.unsubscribe()}},error:r,complete:b});this.subscribe(A)})}_subscribe(g){var p;return(p=this.source)===null||p===void 0?void 0:p.subscribe(g)}[Wh](){return this}pipe(...g){return kx(g)(this)}toPromise(g){return g=fD(g),new g((p,b)=>{let r;this.subscribe(A=>r=A,A=>b(A),()=>p(r))})}}return l.create=c=>new l(c),l})();function fD(l){var c;return(c=l??Go.Promise)!==null&&c!==void 0?c:Promise}function CL(l){return l&&_n(l.next)&&_n(l.error)&&_n(l.complete)}function SL(l){return l&&l instanceof Qc||CL(l)&&w_(l)}function Fx(l){return _n(l?.lift)}function Bn(l){return c=>{if(Fx(c))return c.lift(function(g){try{return l(g,this)}catch(p){this.error(p)}});throw new TypeError("Unable to lift unknown Observable type")}}function jn(l,c,g,p,b){return new Nx(l,c,g,p,b)}var Nx=class extends Qc{constructor(c,g,p,b,r,A){super(c),this.onFinalize=r,this.shouldUnsubscribe=A,this._next=g?function(N){try{g(N)}catch(V){c.error(V)}}:super._next,this._error=b?function(N){try{b(N)}catch(V){c.error(V)}finally{this.unsubscribe()}}:super._error,this._complete=p?function(){try{p()}catch(N){c.error(N)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var c;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:g}=this;super.unsubscribe(),!g&&((c=this.onFinalize)===null||c===void 0||c.call(this))}}};function Zh(){return Bn((l,c)=>{let g=null;l._refCount++;let p=jn(c,void 0,void 0,void 0,()=>{if(!l||l._refCount<=0||0<--l._refCount){g=null;return}let b=l._connection,r=g;g=null,b&&(!r||b===r)&&b.unsubscribe(),c.unsubscribe()});l.subscribe(p),p.closed||(g=l.connect())})}var Xh=class extends Wn{constructor(c,g){super(),this.source=c,this.subjectFactory=g,this._subject=null,this._refCount=0,this._connection=null,Fx(c)&&(this.lift=c.lift)}_subscribe(c){return this.getSubject().subscribe(c)}getSubject(){let c=this._subject;return(!c||c.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:c}=this;this._subject=this._connection=null,c?.unsubscribe()}connect(){let c=this._connection;if(!c){c=this._connection=new $r;let g=this.getSubject();c.add(this.source.subscribe(jn(g,void 0,()=>{this._teardown(),g.complete()},p=>{this._teardown(),g.error(p)},()=>this._teardown()))),c.closed&&(this._connection=null,c=$r.EMPTY)}return c}refCount(){return Zh()(this)}};var pD=$h(l=>function(){l(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Mi=(()=>{class l extends Wn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(g){let p=new I_(this,this);return p.operator=g,p}_throwIfClosed(){if(this.closed)throw new pD}next(g){Hh(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let p of this.currentObservers)p.next(g)}})}error(g){Hh(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=g;let{observers:p}=this;for(;p.length;)p.shift().error(g)}})}complete(){Hh(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:g}=this;for(;g.length;)g.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var g;return((g=this.observers)===null||g===void 0?void 0:g.length)>0}_trySubscribe(g){return this._throwIfClosed(),super._trySubscribe(g)}_subscribe(g){return this._throwIfClosed(),this._checkFinalizedStatuses(g),this._innerSubscribe(g)}_innerSubscribe(g){let{hasError:p,isStopped:b,observers:r}=this;return p||b?Sx:(this.currentObservers=null,r.push(g),new $r(()=>{this.currentObservers=null,wp(r,g)}))}_checkFinalizedStatuses(g){let{hasError:p,thrownError:b,isStopped:r}=this;p?g.error(b):r&&g.complete()}asObservable(){let g=new Wn;return g.source=this,g}}return l.create=(c,g)=>new I_(c,g),l})(),I_=class extends Mi{constructor(c,g){super(),this.destination=c,this.source=g}next(c){var g,p;(p=(g=this.destination)===null||g===void 0?void 0:g.next)===null||p===void 0||p.call(g,c)}error(c){var g,p;(p=(g=this.destination)===null||g===void 0?void 0:g.error)===null||p===void 0||p.call(g,c)}complete(){var c,g;(g=(c=this.destination)===null||c===void 0?void 0:c.complete)===null||g===void 0||g.call(c)}_subscribe(c){var g,p;return(p=(g=this.source)===null||g===void 0?void 0:g.subscribe(c))!==null&&p!==void 0?p:Sx}};var ri=class extends Mi{constructor(c){super(),this._value=c}get value(){return this.getValue()}_subscribe(c){let g=super._subscribe(c);return!g.closed&&c.next(this._value),g}getValue(){let{hasError:c,thrownError:g,_value:p}=this;if(c)throw g;return this._throwIfClosed(),p}next(c){super.next(this._value=c)}};var to=new Wn(l=>l.complete());function mD(l){return l&&_n(l.schedule)}function gD(l){return l[l.length-1]}function _D(l){return _n(gD(l))?l.pop():void 0}function yl(l){return mD(gD(l))?l.pop():void 0}function vD(l,c,g,p){function b(r){return r instanceof g?r:new g(function(A){A(r)})}return new(g||(g=Promise))(function(r,A){function N(ve){try{Y(p.next(ve))}catch(Pe){A(Pe)}}function V(ve){try{Y(p.throw(ve))}catch(Pe){A(Pe)}}function Y(ve){ve.done?r(ve.value):b(ve.value).then(N,V)}Y((p=p.apply(l,c||[])).next())})}function yD(l){var c=typeof Symbol=="function"&&Symbol.iterator,g=c&&l[c],p=0;if(g)return g.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")}function Kc(l){return this instanceof Kc?(this.v=l,this):new Kc(l)}function xD(l,c,g){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=g.apply(l,c||[]),b,r=[];return b={},N("next"),N("throw"),N("return",A),b[Symbol.asyncIterator]=function(){return this},b;function A(rt){return function(Ot){return Promise.resolve(Ot).then(rt,Pe)}}function N(rt,Ot){p[rt]&&(b[rt]=function(Jt){return new Promise(function(qt,Ft){r.push([rt,Jt,qt,Ft])>1||V(rt,Jt)})},Ot&&(b[rt]=Ot(b[rt])))}function V(rt,Ot){try{Y(p[rt](Ot))}catch(Jt){tt(r[0][3],Jt)}}function Y(rt){rt.value instanceof Kc?Promise.resolve(rt.value.v).then(ve,Pe):tt(r[0][2],rt)}function ve(rt){V("next",rt)}function Pe(rt){V("throw",rt)}function tt(rt,Ot){rt(Ot),r.shift(),r.length&&V(r[0][0],r[0][1])}}function bD(l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=l[Symbol.asyncIterator],g;return c?c.call(l):(l=typeof yD=="function"?yD(l):l[Symbol.iterator](),g={},p("next"),p("throw"),p("return"),g[Symbol.asyncIterator]=function(){return this},g);function p(r){g[r]=l[r]&&function(A){return new Promise(function(N,V){A=l[r](A),b(N,V,A.done,A.value)})}}function b(r,A,N,V){Promise.resolve(V).then(function(Y){r({value:Y,done:N})},A)}}var M_=l=>l&&typeof l.length=="number"&&typeof l!="function";function D_(l){return _n(l?.then)}function C_(l){return _n(l[Wh])}function S_(l){return Symbol.asyncIterator&&_n(l?.[Symbol.asyncIterator])}function A_(l){return new TypeError(`You provided ${l!==null&&typeof l=="object"?"an invalid object":`'${l}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function AL(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var P_=AL();function R_(l){return _n(l?.[P_])}function O_(l){return xD(this,arguments,function*(){let g=l.getReader();try{for(;;){let{value:p,done:b}=yield Kc(g.read());if(b)return yield Kc(void 0);yield yield Kc(p)}}finally{g.releaseLock()}})}function L_(l){return _n(l?.getReader)}function Kr(l){if(l instanceof Wn)return l;if(l!=null){if(C_(l))return PL(l);if(M_(l))return RL(l);if(D_(l))return OL(l);if(S_(l))return wD(l);if(R_(l))return LL(l);if(L_(l))return kL(l)}throw A_(l)}function PL(l){return new Wn(c=>{let g=l[Wh]();if(_n(g.subscribe))return g.subscribe(c);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function RL(l){return new Wn(c=>{for(let g=0;g<l.length&&!c.closed;g++)c.next(l[g]);c.complete()})}function OL(l){return new Wn(c=>{l.then(g=>{c.closed||(c.next(g),c.complete())},g=>c.error(g)).then(null,T_)})}function LL(l){return new Wn(c=>{for(let g of l)if(c.next(g),c.closed)return;c.complete()})}function wD(l){return new Wn(c=>{FL(l,c).catch(g=>c.error(g))})}function kL(l){return wD(O_(l))}function FL(l,c){var g,p,b,r;return vD(this,void 0,void 0,function*(){try{for(g=bD(l);p=yield g.next(),!p.done;){let A=p.value;if(c.next(A),c.closed)return}}catch(A){b={error:A}}finally{try{p&&!p.done&&(r=g.return)&&(yield r.call(g))}finally{if(b)throw b.error}}c.complete()})}function Vi(l,c,g,p=0,b=!1){let r=c.schedule(function(){g(),b?l.add(this.schedule(null,p)):this.unsubscribe()},p);if(l.add(r),!b)return r}function k_(l,c=0){return Bn((g,p)=>{g.subscribe(jn(p,b=>Vi(p,l,()=>p.next(b),c),()=>Vi(p,l,()=>p.complete(),c),b=>Vi(p,l,()=>p.error(b),c)))})}function F_(l,c=0){return Bn((g,p)=>{p.add(l.schedule(()=>g.subscribe(p),c))})}function TD(l,c){return Kr(l).pipe(F_(c),k_(c))}function ED(l,c){return Kr(l).pipe(F_(c),k_(c))}function ID(l,c){return new Wn(g=>{let p=0;return c.schedule(function(){p===l.length?g.complete():(g.next(l[p++]),g.closed||this.schedule())})})}function MD(l,c){return new Wn(g=>{let p;return Vi(g,c,()=>{p=l[P_](),Vi(g,c,()=>{let b,r;try{({value:b,done:r}=p.next())}catch(A){g.error(A);return}r?g.complete():g.next(b)},0,!0)}),()=>_n(p?.return)&&p.return()})}function N_(l,c){if(!l)throw new Error("Iterable cannot be null");return new Wn(g=>{Vi(g,c,()=>{let p=l[Symbol.asyncIterator]();Vi(g,c,()=>{p.next().then(b=>{b.done?g.complete():g.next(b.value)})},0,!0)})})}function DD(l,c){return N_(O_(l),c)}function CD(l,c){if(l!=null){if(C_(l))return TD(l,c);if(M_(l))return ID(l,c);if(D_(l))return ED(l,c);if(S_(l))return N_(l,c);if(R_(l))return MD(l,c);if(L_(l))return DD(l,c)}throw A_(l)}function br(l,c){return c?CD(l,c):Kr(l)}function fn(...l){let c=yl(l);return br(l,c)}function Yh(l,c){let g=_n(l)?l:()=>l,p=b=>b.error(g());return new Wn(c?b=>c.schedule(p,0,b):p)}function zx(l){return!!l&&(l instanceof Wn||_n(l.lift)&&_n(l.subscribe))}var sa=$h(l=>function(){l(this),this.name="EmptyError",this.message="no elements in sequence"});function Mn(l,c){return Bn((g,p)=>{let b=0;g.subscribe(jn(p,r=>{p.next(l.call(c,r,b++))}))})}var{isArray:NL}=Array;function zL(l,c){return NL(c)?l(...c):l(c)}function SD(l){return Mn(c=>zL(l,c))}var{isArray:BL}=Array,{getPrototypeOf:jL,prototype:VL,keys:UL}=Object;function AD(l){if(l.length===1){let c=l[0];if(BL(c))return{args:c,keys:null};if($L(c)){let g=UL(c);return{args:g.map(p=>c[p]),keys:g}}}return{args:l,keys:null}}function $L(l){return l&&typeof l=="object"&&jL(l)===VL}function PD(l,c){return l.reduce((g,p,b)=>(g[p]=c[b],g),{})}function z_(...l){let c=yl(l),g=_D(l),{args:p,keys:b}=AD(l);if(p.length===0)return br([],c);let r=new Wn(GL(p,c,b?A=>PD(b,A):eo));return g?r.pipe(SD(g)):r}function GL(l,c,g=eo){return p=>{RD(c,()=>{let{length:b}=l,r=new Array(b),A=b,N=b;for(let V=0;V<b;V++)RD(c,()=>{let Y=br(l[V],c),ve=!1;Y.subscribe(jn(p,Pe=>{r[V]=Pe,ve||(ve=!0,N--),N||p.next(g(r.slice()))},()=>{--A||p.complete()}))},p)},p)}}function RD(l,c,g){l?Vi(g,l,c):c()}function OD(l,c,g,p,b,r,A,N){let V=[],Y=0,ve=0,Pe=!1,tt=()=>{Pe&&!V.length&&!Y&&c.complete()},rt=Jt=>Y<p?Ot(Jt):V.push(Jt),Ot=Jt=>{r&&c.next(Jt),Y++;let qt=!1;Kr(g(Jt,ve++)).subscribe(jn(c,Ft=>{b?.(Ft),r?rt(Ft):c.next(Ft)},()=>{qt=!0},void 0,()=>{if(qt)try{for(Y--;V.length&&Y<p;){let Ft=V.shift();A?Vi(c,A,()=>Ot(Ft)):Ot(Ft)}tt()}catch(Ft){c.error(Ft)}}))};return l.subscribe(jn(c,rt,()=>{Pe=!0,tt()})),()=>{N?.()}}function Gr(l,c,g=1/0){return _n(c)?Gr((p,b)=>Mn((r,A)=>c(p,r,b,A))(Kr(l(p,b))),g):(typeof c=="number"&&(g=c),Bn((p,b)=>OD(p,b,l,g)))}function Bx(l=1/0){return Gr(eo,l)}function LD(){return Bx(1)}function Qh(...l){return LD()(br(l,yl(l)))}function B_(l){return new Wn(c=>{Kr(l()).subscribe(c)})}function no(l,c){return Bn((g,p)=>{let b=0;g.subscribe(jn(p,r=>l.call(c,r,b++)&&p.next(r)))})}function vl(l){return Bn((c,g)=>{let p=null,b=!1,r;p=c.subscribe(jn(g,void 0,void 0,A=>{r=Kr(l(A,vl(l)(c))),p?(p.unsubscribe(),p=null,r.subscribe(g)):b=!0})),b&&(p.unsubscribe(),p=null,r.subscribe(g))})}function kD(l,c,g,p,b){return(r,A)=>{let N=g,V=c,Y=0;r.subscribe(jn(A,ve=>{let Pe=Y++;V=N?l(V,ve,Pe):(N=!0,ve),p&&A.next(V)},b&&(()=>{N&&A.next(V),A.complete()})))}}function xl(l,c){return _n(c)?Gr(l,c,1):Gr(l,1)}function bl(l){return Bn((c,g)=>{let p=!1;c.subscribe(jn(g,b=>{p=!0,g.next(b)},()=>{p||g.next(l),g.complete()}))})}function aa(l){return l<=0?()=>to:Bn((c,g)=>{let p=0;c.subscribe(jn(g,b=>{++p<=l&&(g.next(b),l<=p&&g.complete())}))})}function jx(l){return Mn(()=>l)}function j_(l=HL){return Bn((c,g)=>{let p=!1;c.subscribe(jn(g,b=>{p=!0,g.next(b)},()=>p?g.complete():g.error(l())))})}function HL(){return new sa}function wl(l){return Bn((c,g)=>{try{c.subscribe(g)}finally{g.add(l)}})}function vs(l,c){let g=arguments.length>=2;return p=>p.pipe(l?no((b,r)=>l(b,r,p)):eo,aa(1),g?bl(c):j_(()=>new sa))}function Kh(l){return l<=0?()=>to:Bn((c,g)=>{let p=[];c.subscribe(jn(g,b=>{p.push(b),l<p.length&&p.shift()},()=>{for(let b of p)g.next(b);g.complete()},void 0,()=>{p=null}))})}function Vx(l,c){let g=arguments.length>=2;return p=>p.pipe(l?no((b,r)=>l(b,r,p)):eo,Kh(1),g?bl(c):j_(()=>new sa))}function Ux(l,c){return Bn(kD(l,c,arguments.length>=2,!0))}function $x(...l){let c=yl(l);return Bn((g,p)=>{(c?Qh(l,g,c):Qh(l,g)).subscribe(p)})}function ro(l,c){return Bn((g,p)=>{let b=null,r=0,A=!1,N=()=>A&&!b&&p.complete();g.subscribe(jn(p,V=>{b?.unsubscribe();let Y=0,ve=r++;Kr(l(V,ve)).subscribe(b=jn(p,Pe=>p.next(c?c(V,Pe,ve,Y++):Pe),()=>{b=null,N()}))},()=>{A=!0,N()}))})}function Gx(l){return Bn((c,g)=>{Kr(l).subscribe(jn(g,()=>g.complete(),Tp)),!g.closed&&c.subscribe(g)})}function Jr(l,c,g){let p=_n(l)||c||g?{next:l,error:c,complete:g}:l;return p?Bn((b,r)=>{var A;(A=p.subscribe)===null||A===void 0||A.call(p);let N=!0;b.subscribe(jn(r,V=>{var Y;(Y=p.next)===null||Y===void 0||Y.call(p,V),r.next(V)},()=>{var V;N=!1,(V=p.complete)===null||V===void 0||V.call(p),r.complete()},V=>{var Y;N=!1,(Y=p.error)===null||Y===void 0||Y.call(p,V),r.error(V)},()=>{var V,Y;N&&((V=p.unsubscribe)===null||V===void 0||V.call(p)),(Y=p.finalize)===null||Y===void 0||Y.call(p)}))}):eo}var qL="https://g.co/ng/security#xss",un=class extends Error{constructor(c,g){super(uy(c,g)),this.code=c}};function uy(l,c){return`${`NG0${Math.abs(l)}`}${c?": "+c:""}`}function hy(l){return{toString:l}.toString()}var Ep=globalThis;function er(l){for(let c in l)if(l[c]===er)return c;throw Error("Could not find renamed property on target object.")}function Di(l){if(typeof l=="string")return l;if(Array.isArray(l))return"["+l.map(Di).join(", ")+"]";if(l==null)return""+l;if(l.overriddenName)return`${l.overriddenName}`;if(l.name)return`${l.name}`;let c=l.toString();if(c==null)return""+c;let g=c.indexOf(`
`);return g===-1?c:c.substring(0,g)}function FD(l,c){return l==null||l===""?c===null?"":c:c==null||c===""?l:l+" "+c}var WL=er({__forward_ref__:er});function _C(l){return l.__forward_ref__=_C,l.toString=function(){return Di(this())},l}function bo(l){return yC(l)?l():l}function yC(l){return typeof l=="function"&&l.hasOwnProperty(WL)&&l.__forward_ref__===_C}function Xt(l){return{token:l.token,providedIn:l.providedIn||null,factory:l.factory,value:void 0}}function hd(l){return{providers:l.providers||[],imports:l.imports||[]}}function dy(l){return ND(l,xC)||ND(l,bC)}function vC(l){return dy(l)!==null}function ND(l,c){return l.hasOwnProperty(c)?l[c]:null}function ZL(l){let c=l&&(l[xC]||l[bC]);return c||null}function zD(l){return l&&(l.hasOwnProperty(BD)||l.hasOwnProperty(XL))?l[BD]:null}var xC=er({\u0275prov:er}),BD=er({\u0275inj:er}),bC=er({ngInjectableDef:er}),XL=er({ngInjectorDef:er}),yn=class{constructor(c,g){this._desc=c,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof g=="number"?this.__NG_ELEMENT_ID__=g:g!==void 0&&(this.\u0275prov=Xt({token:this,providedIn:g.providedIn||"root",factory:g.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function wC(l){return l&&!!l.\u0275providers}var YL=er({\u0275cmp:er}),QL=er({\u0275dir:er}),KL=er({\u0275pipe:er}),JL=er({\u0275mod:er}),Z_=er({\u0275fac:er}),Ip=er({__NG_ELEMENT_ID__:er}),jD=er({__NG_ENV_ID__:er});function TC(l){return typeof l=="string"?l:l==null?"":String(l)}function ek(l){return typeof l=="function"?l.name||l.toString():typeof l=="object"&&l!=null&&typeof l.type=="function"?l.type.name||l.type.toString():TC(l)}function tk(l,c){let g=c?`. Dependency path: ${c.join(" > ")} > ${l}`:"";throw new un(-200,l)}function H1(l,c){throw new un(-201,!1)}var Sn=function(l){return l[l.Default=0]="Default",l[l.Host=1]="Host",l[l.Self=2]="Self",l[l.SkipSelf=4]="SkipSelf",l[l.Optional=8]="Optional",l}(Sn||{}),i1;function EC(){return i1}function xo(l){let c=i1;return i1=l,c}function IC(l,c,g){let p=dy(l);if(p&&p.providedIn=="root")return p.value===void 0?p.value=p.factory():p.value;if(g&Sn.Optional)return null;if(c!==void 0)return c;H1(l,"Injector")}var nk={},Mp=nk,rk="__NG_DI_FLAG__",X_="ngTempTokenPath",ik="ngTokenPath",ok=/\n/gm,sk="\u0275",VD="__source",nd;function ak(){return nd}function Tl(l){let c=nd;return nd=l,c}function lk(l,c=Sn.Default){if(nd===void 0)throw new un(-203,!1);return nd===null?IC(l,void 0,c):nd.get(l,c&Sn.Optional?null:void 0,c)}function bn(l,c=Sn.Default){return(EC()||lk)(bo(l),c)}function bt(l,c=Sn.Default){return bn(l,fy(c))}function fy(l){return typeof l>"u"||typeof l=="number"?l:0|(l.optional&&8)|(l.host&&1)|(l.self&&2)|(l.skipSelf&&4)}function o1(l){let c=[];for(let g=0;g<l.length;g++){let p=bo(l[g]);if(Array.isArray(p)){if(p.length===0)throw new un(900,!1);let b,r=Sn.Default;for(let A=0;A<p.length;A++){let N=p[A],V=ck(N);typeof V=="number"?V===-1?b=N.token:r|=V:b=N}c.push(bn(b,r))}else c.push(bn(p))}return c}function ck(l){return l[rk]}function uk(l,c,g,p){let b=l[X_];throw c[VD]&&b.unshift(c[VD]),l.message=hk(`
`+l.message,b,g,p),l[ik]=b,l[X_]=null,l}function hk(l,c,g,p=null){l=l&&l.charAt(0)===`
`&&l.charAt(1)==sk?l.slice(2):l;let b=Di(c);if(Array.isArray(c))b=c.map(Di).join(" -> ");else if(typeof c=="object"){let r=[];for(let A in c)if(c.hasOwnProperty(A)){let N=c[A];r.push(A+":"+(typeof N=="string"?JSON.stringify(N):Di(N)))}b=`{${r.join(", ")}}`}return`${g}${p?"("+p+")":""}[${b}]: ${l.replace(ok,`
  `)}`}function id(l,c){let g=l.hasOwnProperty(Z_);return g?l[Z_]:null}function dk(l,c,g){if(l.length!==c.length)return!1;for(let p=0;p<l.length;p++){let b=l[p],r=c[p];if(g&&(b=g(b),r=g(r)),r!==b)return!1}return!0}function fk(l){return l.flat(Number.POSITIVE_INFINITY)}function q1(l,c){l.forEach(g=>Array.isArray(g)?q1(g,c):c(g))}function MC(l,c,g){c>=l.length?l.push(g):l.splice(c,0,g)}function Y_(l,c){return c>=l.length-1?l.pop():l.splice(c,1)[0]}function pk(l,c,g,p){let b=l.length;if(b==c)l.push(g,p);else if(b===1)l.push(p,l[0]),l[0]=g;else{for(b--,l.push(l[b-1],l[b]);b>c;){let r=b-2;l[b]=l[r],b--}l[c]=g,l[c+1]=p}}function mk(l,c,g){let p=zp(l,c);return p>=0?l[p|1]=g:(p=~p,pk(l,p,c,g)),p}function Hx(l,c){let g=zp(l,c);if(g>=0)return l[g|1]}function zp(l,c){return gk(l,c,1)}function gk(l,c,g){let p=0,b=l.length>>g;for(;b!==p;){let r=p+(b-p>>1),A=l[r<<g];if(c===A)return r<<g;A>c?b=r:p=r+1}return~(b<<g)}var Dp={},qo=[],od=new yn(""),DC=new yn("",-1),CC=new yn(""),Q_=class{get(c,g=Mp){if(g===Mp){let p=new Error(`NullInjectorError: No provider for ${Di(c)}!`);throw p.name="NullInjectorError",p}return g}},SC=function(l){return l[l.OnPush=0]="OnPush",l[l.Default=1]="Default",l}(SC||{}),ws=function(l){return l[l.Emulated=0]="Emulated",l[l.None=2]="None",l[l.ShadowDom=3]="ShadowDom",l}(ws||{}),la=function(l){return l[l.None=0]="None",l[l.SignalBased=1]="SignalBased",l[l.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",l}(la||{});function _k(l,c,g){let p=l.length;for(;;){let b=l.indexOf(c,g);if(b===-1)return b;if(b===0||l.charCodeAt(b-1)<=32){let r=c.length;if(b+r===p||l.charCodeAt(b+r)<=32)return b}g=b+1}}function s1(l,c,g){let p=0;for(;p<g.length;){let b=g[p];if(typeof b=="number"){if(b!==0)break;p++;let r=g[p++],A=g[p++],N=g[p++];l.setAttribute(c,A,N,r)}else{let r=b,A=g[++p];vk(r)?l.setProperty(c,r,A):l.setAttribute(c,r,A),p++}}return p}function yk(l){return l===3||l===4||l===6}function vk(l){return l.charCodeAt(0)===64}function W1(l,c){if(!(c===null||c.length===0))if(l===null||l.length===0)l=c.slice();else{let g=-1;for(let p=0;p<c.length;p++){let b=c[p];typeof b=="number"?g=b:g===0||(g===-1||g===2?UD(l,g,b,null,c[++p]):UD(l,g,b,null,null))}}return l}function UD(l,c,g,p,b){let r=0,A=l.length;if(c===-1)A=-1;else for(;r<l.length;){let N=l[r++];if(typeof N=="number"){if(N===c){A=-1;break}else if(N>c){A=r-1;break}}}for(;r<l.length;){let N=l[r];if(typeof N=="number")break;if(N===g){if(p===null){b!==null&&(l[r+1]=b);return}else if(p===l[r+1]){l[r+2]=b;return}}r++,p!==null&&r++,b!==null&&r++}A!==-1&&(l.splice(A,0,c),r=A+1),l.splice(r++,0,g),p!==null&&l.splice(r++,0,p),b!==null&&l.splice(r++,0,b)}var AC="ng-template";function xk(l,c,g,p){let b=0;if(p){for(;b<c.length&&typeof c[b]=="string";b+=2)if(c[b]==="class"&&_k(c[b+1].toLowerCase(),g,0)!==-1)return!0}else if(Z1(l))return!1;if(b=c.indexOf(1,b),b>-1){let r;for(;++b<c.length&&typeof(r=c[b])=="string";)if(r.toLowerCase()===g)return!0}return!1}function Z1(l){return l.type===4&&l.value!==AC}function bk(l,c,g){let p=l.type===4&&!g?AC:l.value;return c===p}function wk(l,c,g){let p=4,b=l.attrs,r=b!==null?Ik(b):0,A=!1;for(let N=0;N<c.length;N++){let V=c[N];if(typeof V=="number"){if(!A&&!Ho(p)&&!Ho(V))return!1;if(A&&Ho(V))continue;A=!1,p=V|p&1;continue}if(!A)if(p&4){if(p=2|p&1,V!==""&&!bk(l,V,g)||V===""&&c.length===1){if(Ho(p))return!1;A=!0}}else if(p&8){if(b===null||!xk(l,b,V,g)){if(Ho(p))return!1;A=!0}}else{let Y=c[++N],ve=Tk(V,b,Z1(l),g);if(ve===-1){if(Ho(p))return!1;A=!0;continue}if(Y!==""){let Pe;if(ve>r?Pe="":Pe=b[ve+1].toLowerCase(),p&2&&Y!==Pe){if(Ho(p))return!1;A=!0}}}}return Ho(p)||A}function Ho(l){return(l&1)===0}function Tk(l,c,g,p){if(c===null)return-1;let b=0;if(p||!g){let r=!1;for(;b<c.length;){let A=c[b];if(A===l)return b;if(A===3||A===6)r=!0;else if(A===1||A===2){let N=c[++b];for(;typeof N=="string";)N=c[++b];continue}else{if(A===4)break;if(A===0){b+=4;continue}}b+=r?1:2}return-1}else return Mk(c,l)}function Ek(l,c,g=!1){for(let p=0;p<c.length;p++)if(wk(l,c[p],g))return!0;return!1}function Ik(l){for(let c=0;c<l.length;c++){let g=l[c];if(yk(g))return c}return l.length}function Mk(l,c){let g=l.indexOf(4);if(g>-1)for(g++;g<l.length;){let p=l[g];if(typeof p=="number")return-1;if(p===c)return g;g++}return-1}function $D(l,c){return l?":not("+c.trim()+")":c}function Dk(l){let c=l[0],g=1,p=2,b="",r=!1;for(;g<l.length;){let A=l[g];if(typeof A=="string")if(p&2){let N=l[++g];b+="["+A+(N.length>0?'="'+N+'"':"")+"]"}else p&8?b+="."+A:p&4&&(b+=" "+A);else b!==""&&!Ho(A)&&(c+=$D(r,b),b=""),p=A,r=r||!Ho(p);g++}return b!==""&&(c+=$D(r,b)),c}function Ck(l){return l.map(Dk).join(",")}function Sk(l){let c=[],g=[],p=1,b=2;for(;p<l.length;){let r=l[p];if(typeof r=="string")b===2?r!==""&&c.push(r,l[++p]):b===8&&g.push(r);else{if(!Ho(b))break;b=r}p++}return{attrs:c,classes:g}}function To(l){return hy(()=>{let c=kC(l),g=gr(Rt({},c),{decls:l.decls,vars:l.vars,template:l.template,consts:l.consts||null,ngContentSelectors:l.ngContentSelectors,onPush:l.changeDetection===SC.OnPush,directiveDefs:null,pipeDefs:null,dependencies:c.standalone&&l.dependencies||null,getStandaloneInjector:null,signals:l.signals??!1,data:l.data||{},encapsulation:l.encapsulation||ws.Emulated,styles:l.styles||qo,_:null,schemas:l.schemas||null,tView:null,id:""});FC(g);let p=l.dependencies;return g.directiveDefs=HD(p,!1),g.pipeDefs=HD(p,!0),g.id=Rk(g),g})}function Ak(l){return tu(l)||PC(l)}function Pk(l){return l!==null}function dd(l){return hy(()=>({type:l.type,bootstrap:l.bootstrap||qo,declarations:l.declarations||qo,imports:l.imports||qo,exports:l.exports||qo,transitiveCompileScopes:null,schemas:l.schemas||null,id:l.id||null}))}function GD(l,c){if(l==null)return Dp;let g={};for(let p in l)if(l.hasOwnProperty(p)){let b=l[p],r,A,N=la.None;Array.isArray(b)?(N=b[0],r=b[1],A=b[2]??r):(r=b,A=b),c?(g[r]=N!==la.None?[p,N]:p,c[r]=A):g[r]=p}return g}function Bp(l){return hy(()=>{let c=kC(l);return FC(c),c})}function tu(l){return l[YL]||null}function PC(l){return l[QL]||null}function RC(l){return l[KL]||null}function OC(l){let c=tu(l)||PC(l)||RC(l);return c!==null?c.standalone:!1}function LC(l,c){let g=l[JL]||null;if(!g&&c===!0)throw new Error(`Type ${Di(l)} does not have '\u0275mod' property.`);return g}function kC(l){let c={};return{type:l.type,providersResolver:null,factory:null,hostBindings:l.hostBindings||null,hostVars:l.hostVars||0,hostAttrs:l.hostAttrs||null,contentQueries:l.contentQueries||null,declaredInputs:c,inputTransforms:null,inputConfig:l.inputs||Dp,exportAs:l.exportAs||null,standalone:l.standalone===!0,signals:l.signals===!0,selectors:l.selectors||qo,viewQuery:l.viewQuery||null,features:l.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:GD(l.inputs,c),outputs:GD(l.outputs),debugInfo:null}}function FC(l){l.features?.forEach(c=>c(l))}function HD(l,c){if(!l)return null;let g=c?RC:Ak;return()=>(typeof l=="function"?l():l).map(p=>g(p)).filter(Pk)}function Rk(l){let c=0,g=[l.selectors,l.ngContentSelectors,l.hostVars,l.hostAttrs,l.consts,l.vars,l.decls,l.encapsulation,l.standalone,l.signals,l.exportAs,JSON.stringify(l.inputs),JSON.stringify(l.outputs),Object.getOwnPropertyNames(l.type.prototype),!!l.contentQueries,!!l.viewQuery].join("|");for(let b of g)c=Math.imul(31,c)+b.charCodeAt(0)<<0;return c+=2147483648,"c"+c}function fd(l){return{\u0275providers:l}}function Ok(...l){return{\u0275providers:NC(!0,l),\u0275fromNgModule:!0}}function NC(l,...c){let g=[],p=new Set,b,r=A=>{g.push(A)};return q1(c,A=>{let N=A;a1(N,r,[],p)&&(b||=[],b.push(N))}),b!==void 0&&zC(b,r),g}function zC(l,c){for(let g=0;g<l.length;g++){let{ngModule:p,providers:b}=l[g];X1(b,r=>{c(r,p)})}}function a1(l,c,g,p){if(l=bo(l),!l)return!1;let b=null,r=zD(l),A=!r&&tu(l);if(!r&&!A){let V=l.ngModule;if(r=zD(V),r)b=V;else return!1}else{if(A&&!A.standalone)return!1;b=l}let N=p.has(b);if(A){if(N)return!1;if(p.add(b),A.dependencies){let V=typeof A.dependencies=="function"?A.dependencies():A.dependencies;for(let Y of V)a1(Y,c,g,p)}}else if(r){if(r.imports!=null&&!N){p.add(b);let Y;try{q1(r.imports,ve=>{a1(ve,c,g,p)&&(Y||=[],Y.push(ve))})}finally{}Y!==void 0&&zC(Y,c)}if(!N){let Y=id(b)||(()=>new b);c({provide:b,useFactory:Y,deps:qo},b),c({provide:CC,useValue:b,multi:!0},b),c({provide:od,useValue:()=>bn(b),multi:!0},b)}let V=r.providers;if(V!=null&&!N){let Y=l;X1(V,ve=>{c(ve,Y)})}}else return!1;return b!==l&&l.providers!==void 0}function X1(l,c){for(let g of l)wC(g)&&(g=g.\u0275providers),Array.isArray(g)?X1(g,c):c(g)}var Lk=er({provide:String,useValue:er});function BC(l){return l!==null&&typeof l=="object"&&Lk in l}function kk(l){return!!(l&&l.useExisting)}function Fk(l){return!!(l&&l.useFactory)}function l1(l){return typeof l=="function"}var py=new yn(""),U_={},Nk={},qx;function Y1(){return qx===void 0&&(qx=new Q_),qx}var Ui=class{},Cp=class extends Ui{get destroyed(){return this._destroyed}constructor(c,g,p,b){super(),this.parent=g,this.source=p,this.scopes=b,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,u1(c,A=>this.processProvider(A)),this.records.set(DC,Jh(void 0,this)),b.has("environment")&&this.records.set(Ui,Jh(void 0,this));let r=this.records.get(py);r!=null&&typeof r.value=="string"&&this.scopes.add(r.value),this.injectorDefTypes=new Set(this.get(CC,qo,Sn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let c=qn(null);try{for(let p of this._ngOnDestroyHooks)p.ngOnDestroy();let g=this._onDestroyHooks;this._onDestroyHooks=[];for(let p of g)p()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),qn(c)}}onDestroy(c){return this.assertNotDestroyed(),this._onDestroyHooks.push(c),()=>this.removeOnDestroy(c)}runInContext(c){this.assertNotDestroyed();let g=Tl(this),p=xo(void 0),b;try{return c()}finally{Tl(g),xo(p)}}get(c,g=Mp,p=Sn.Default){if(this.assertNotDestroyed(),c.hasOwnProperty(jD))return c[jD](this);p=fy(p);let b,r=Tl(this),A=xo(void 0);try{if(!(p&Sn.SkipSelf)){let V=this.records.get(c);if(V===void 0){let Y=$k(c)&&dy(c);Y&&this.injectableDefInScope(Y)?V=Jh(c1(c),U_):V=null,this.records.set(c,V)}if(V!=null)return this.hydrate(c,V)}let N=p&Sn.Self?Y1():this.parent;return g=p&Sn.Optional&&g===Mp?null:g,N.get(c,g)}catch(N){if(N.name==="NullInjectorError"){if((N[X_]=N[X_]||[]).unshift(Di(c)),r)throw N;return uk(N,c,"R3InjectorError",this.source)}else throw N}finally{xo(A),Tl(r)}}resolveInjectorInitializers(){let c=qn(null),g=Tl(this),p=xo(void 0),b;try{let r=this.get(od,qo,Sn.Self);for(let A of r)A()}finally{Tl(g),xo(p),qn(c)}}toString(){let c=[],g=this.records;for(let p of g.keys())c.push(Di(p));return`R3Injector[${c.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new un(205,!1)}processProvider(c){c=bo(c);let g=l1(c)?c:bo(c&&c.provide),p=Bk(c);if(!l1(c)&&c.multi===!0){let b=this.records.get(g);b||(b=Jh(void 0,U_,!0),b.factory=()=>o1(b.multi),this.records.set(g,b)),g=c,b.multi.push(c)}this.records.set(g,p)}hydrate(c,g){let p=qn(null);try{return g.value===U_&&(g.value=Nk,g.value=g.factory()),typeof g.value=="object"&&g.value&&Uk(g.value)&&this._ngOnDestroyHooks.add(g.value),g.value}finally{qn(p)}}injectableDefInScope(c){if(!c.providedIn)return!1;let g=bo(c.providedIn);return typeof g=="string"?g==="any"||this.scopes.has(g):this.injectorDefTypes.has(g)}removeOnDestroy(c){let g=this._onDestroyHooks.indexOf(c);g!==-1&&this._onDestroyHooks.splice(g,1)}};function c1(l){let c=dy(l),g=c!==null?c.factory:id(l);if(g!==null)return g;if(l instanceof yn)throw new un(204,!1);if(l instanceof Function)return zk(l);throw new un(204,!1)}function zk(l){if(l.length>0)throw new un(204,!1);let g=ZL(l);return g!==null?()=>g.factory(l):()=>new l}function Bk(l){if(BC(l))return Jh(void 0,l.useValue);{let c=jk(l);return Jh(c,U_)}}function jk(l,c,g){let p;if(l1(l)){let b=bo(l);return id(b)||c1(b)}else if(BC(l))p=()=>bo(l.useValue);else if(Fk(l))p=()=>l.useFactory(...o1(l.deps||[]));else if(kk(l))p=()=>bn(bo(l.useExisting));else{let b=bo(l&&(l.useClass||l.provide));if(Vk(l))p=()=>new b(...o1(l.deps));else return id(b)||c1(b)}return p}function Jh(l,c,g=!1){return{factory:l,value:c,multi:g?[]:void 0}}function Vk(l){return!!l.deps}function Uk(l){return l!==null&&typeof l=="object"&&typeof l.ngOnDestroy=="function"}function $k(l){return typeof l=="function"||typeof l=="object"&&l instanceof yn}function u1(l,c){for(let g of l)Array.isArray(g)?u1(g,c):g&&wC(g)?u1(g.\u0275providers,c):c(g)}function da(l,c){l instanceof Cp&&l.assertNotDestroyed();let g,p=Tl(l),b=xo(void 0);try{return c()}finally{Tl(p),xo(b)}}function Gk(){return EC()!==void 0||ak()!=null}function Hk(l){return typeof l=="function"}var fa=0,An=1,nn=2,ii=3,Wo=4,Zo=5,K_=6,Sp=7,Ts=8,sd=9,Es=10,hi=11,Ap=12,qD=13,pd=14,Is=15,jp=16,ed=17,ca=18,my=19,jC=20,El=21,Wx=22,nu=23,Il=25,VC=1;var ru=7,J_=8,ad=9,io=10,Q1=function(l){return l[l.None=0]="None",l[l.HasTransplantedViews=2]="HasTransplantedViews",l}(Q1||{});function Jc(l){return Array.isArray(l)&&typeof l[VC]=="object"}function pa(l){return Array.isArray(l)&&l[VC]===!0}function UC(l){return(l.flags&4)!==0}function gy(l){return l.componentOffset>-1}function K1(l){return(l.flags&1)===1}function Vp(l){return!!l.template}function qk(l){return(l[nn]&512)!==0}var h1=class{constructor(c,g,p){this.previousValue=c,this.currentValue=g,this.firstChange=p}isFirstChange(){return this.firstChange}};function $C(l,c,g,p){c!==null?c.applyValueToInputSignal(c,p):l[g]=p}function _y(){return GC}function GC(l){return l.type.prototype.ngOnChanges&&(l.setInput=Zk),Wk}_y.ngInherit=!0;function Wk(){let l=qC(this),c=l?.current;if(c){let g=l.previous;if(g===Dp)l.previous=c;else for(let p in c)g[p]=c[p];l.current=null,this.ngOnChanges(c)}}function Zk(l,c,g,p,b){let r=this.declaredInputs[p],A=qC(l)||Xk(l,{previous:Dp,current:null}),N=A.current||(A.current={}),V=A.previous,Y=V[r];N[r]=new h1(Y&&Y.currentValue,g,V===Dp),$C(l,c,b,g)}var HC="__ngSimpleChanges__";function qC(l){return l[HC]||null}function Xk(l,c){return l[HC]=c}var WD=null;var xs=function(l,c,g){WD?.(l,c,g)},Yk="svg",Qk="math",Kk=!1;function Jk(){return Kk}function Ms(l){for(;Array.isArray(l);)l=l[fa];return l}function WC(l,c){return Ms(c[l])}function Xo(l,c){return Ms(c[l.index])}function ZC(l,c){return l.data[c]}function Dl(l,c){let g=c[l];return Jc(g)?g:g[fa]}function eF(l){return(l[nn]&4)===4}function J1(l){return(l[nn]&128)===128}function tF(l){return pa(l[ii])}function ey(l,c){return c==null?null:l[c]}function XC(l){l[ed]=0}function nF(l){l[nn]&1024||(l[nn]|=1024,J1(l)&&Pp(l))}function rF(l,c){for(;l>0;)c=c[pd],l--;return c}function eb(l){return!!(l[nn]&9216||l[nu]?.dirty)}function d1(l){l[Es].changeDetectionScheduler?.notify(1),eb(l)?Pp(l):l[nn]&64&&(Jk()?(l[nn]|=1024,Pp(l)):l[Es].changeDetectionScheduler?.notify())}function Pp(l){l[Es].changeDetectionScheduler?.notify();let c=Rp(l);for(;c!==null&&!(c[nn]&8192||(c[nn]|=8192,!J1(c)));)c=Rp(c)}function YC(l,c){if((l[nn]&256)===256)throw new un(911,!1);l[El]===null&&(l[El]=[]),l[El].push(c)}function iF(l,c){if(l[El]===null)return;let g=l[El].indexOf(c);g!==-1&&l[El].splice(g,1)}function Rp(l){let c=l[ii];return pa(c)?c[ii]:c}var Nn={lFrame:iS(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function oF(){return Nn.lFrame.elementDepthCount}function sF(){Nn.lFrame.elementDepthCount++}function aF(){Nn.lFrame.elementDepthCount--}function QC(){return Nn.bindingsEnabled}function lF(){return Nn.skipHydrationRootTNode!==null}function cF(l){return Nn.skipHydrationRootTNode===l}function uF(){Nn.skipHydrationRootTNode=null}function _r(){return Nn.lFrame.lView}function Ds(){return Nn.lFrame.tView}function Yo(){let l=KC();for(;l!==null&&l.type===64;)l=l.parent;return l}function KC(){return Nn.lFrame.currentTNode}function hF(){let l=Nn.lFrame,c=l.currentTNode;return l.isParent?c:c.parent}function Up(l,c){let g=Nn.lFrame;g.currentTNode=l,g.isParent=c}function JC(){return Nn.lFrame.isParent}function dF(){Nn.lFrame.isParent=!1}function fF(l){return Nn.lFrame.bindingIndex=l}function eS(){return Nn.lFrame.bindingIndex++}function pF(l){let c=Nn.lFrame,g=c.bindingIndex;return c.bindingIndex=c.bindingIndex+l,g}function mF(){return Nn.lFrame.inI18n}function gF(l,c){let g=Nn.lFrame;g.bindingIndex=g.bindingRootIndex=l,f1(c)}function _F(){return Nn.lFrame.currentDirectiveIndex}function f1(l){Nn.lFrame.currentDirectiveIndex=l}function yF(l){let c=Nn.lFrame.currentDirectiveIndex;return c===-1?null:l[c]}function tS(){return Nn.lFrame.currentQueryIndex}function tb(l){Nn.lFrame.currentQueryIndex=l}function vF(l){let c=l[An];return c.type===2?c.declTNode:c.type===1?l[Zo]:null}function nS(l,c,g){if(g&Sn.SkipSelf){let b=c,r=l;for(;b=b.parent,b===null&&!(g&Sn.Host);)if(b=vF(r),b===null||(r=r[pd],b.type&10))break;if(b===null)return!1;c=b,l=r}let p=Nn.lFrame=rS();return p.currentTNode=c,p.lView=l,!0}function nb(l){let c=rS(),g=l[An];Nn.lFrame=c,c.currentTNode=g.firstChild,c.lView=l,c.tView=g,c.contextLView=l,c.bindingIndex=g.bindingStartIndex,c.inI18n=!1}function rS(){let l=Nn.lFrame,c=l===null?null:l.child;return c===null?iS(l):c}function iS(l){let c={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:l,child:null,inI18n:!1};return l!==null&&(l.child=c),c}function oS(){let l=Nn.lFrame;return Nn.lFrame=l.parent,l.currentTNode=null,l.lView=null,l}var sS=oS;function rb(){let l=oS();l.isParent=!0,l.tView=null,l.selectedIndex=-1,l.contextLView=null,l.elementDepthCount=0,l.currentDirectiveIndex=-1,l.currentNamespace=null,l.bindingRootIndex=-1,l.bindingIndex=-1,l.currentQueryIndex=0}function xF(l){return(Nn.lFrame.contextLView=rF(l,Nn.lFrame.contextLView))[Ts]}function md(){return Nn.lFrame.selectedIndex}function iu(l){Nn.lFrame.selectedIndex=l}function bF(){let l=Nn.lFrame;return ZC(l.tView,l.selectedIndex)}function wF(){return Nn.lFrame.currentNamespace}var aS=!0;function ib(){return aS}function ob(l){aS=l}function TF(l,c,g){let{ngOnChanges:p,ngOnInit:b,ngDoCheck:r}=c.type.prototype;if(p){let A=GC(c);(g.preOrderHooks??=[]).push(l,A),(g.preOrderCheckHooks??=[]).push(l,A)}b&&(g.preOrderHooks??=[]).push(0-l,b),r&&((g.preOrderHooks??=[]).push(l,r),(g.preOrderCheckHooks??=[]).push(l,r))}function sb(l,c){for(let g=c.directiveStart,p=c.directiveEnd;g<p;g++){let r=l.data[g].type.prototype,{ngAfterContentInit:A,ngAfterContentChecked:N,ngAfterViewInit:V,ngAfterViewChecked:Y,ngOnDestroy:ve}=r;A&&(l.contentHooks??=[]).push(-g,A),N&&((l.contentHooks??=[]).push(g,N),(l.contentCheckHooks??=[]).push(g,N)),V&&(l.viewHooks??=[]).push(-g,V),Y&&((l.viewHooks??=[]).push(g,Y),(l.viewCheckHooks??=[]).push(g,Y)),ve!=null&&(l.destroyHooks??=[]).push(g,ve)}}function $_(l,c,g){lS(l,c,3,g)}function G_(l,c,g,p){(l[nn]&3)===g&&lS(l,c,g,p)}function Zx(l,c){let g=l[nn];(g&3)===c&&(g&=16383,g+=1,l[nn]=g)}function lS(l,c,g,p){let b=p!==void 0?l[ed]&65535:0,r=p??-1,A=c.length-1,N=0;for(let V=b;V<A;V++)if(typeof c[V+1]=="number"){if(N=c[V],p!=null&&N>=p)break}else c[V]<0&&(l[ed]+=65536),(N<r||r==-1)&&(EF(l,g,c,V),l[ed]=(l[ed]&4294901760)+V+2),V++}function ZD(l,c){xs(4,l,c);let g=qn(null);try{c.call(l)}finally{qn(g),xs(5,l,c)}}function EF(l,c,g,p){let b=g[p]<0,r=g[p+1],A=b?-g[p]:g[p],N=l[A];b?l[nn]>>14<l[ed]>>16&&(l[nn]&3)===c&&(l[nn]+=16384,ZD(N,r)):ZD(N,r)}var rd=-1,Op=class{constructor(c,g,p){this.factory=c,this.resolving=!1,this.canSeeViewProviders=g,this.injectImpl=p}};function IF(l){return l instanceof Op}function MF(l){return(l.flags&8)!==0}function DF(l){return(l.flags&16)!==0}function cS(l){return l!==rd}function ty(l){return l&32767}function CF(l){return l>>16}function ny(l,c){let g=CF(l),p=c;for(;g>0;)p=p[pd],g--;return p}var p1=!0;function XD(l){let c=p1;return p1=l,c}var SF=256,uS=SF-1,hS=5,AF=0,bs={};function PF(l,c,g){let p;typeof g=="string"?p=g.charCodeAt(0)||0:g.hasOwnProperty(Ip)&&(p=g[Ip]),p==null&&(p=g[Ip]=AF++);let b=p&uS,r=1<<b;c.data[l+(b>>hS)]|=r}function dS(l,c){let g=fS(l,c);if(g!==-1)return g;let p=c[An];p.firstCreatePass&&(l.injectorIndex=c.length,Xx(p.data,l),Xx(c,null),Xx(p.blueprint,null));let b=ab(l,c),r=l.injectorIndex;if(cS(b)){let A=ty(b),N=ny(b,c),V=N[An].data;for(let Y=0;Y<8;Y++)c[r+Y]=N[A+Y]|V[A+Y]}return c[r+8]=b,r}function Xx(l,c){l.push(0,0,0,0,0,0,0,0,c)}function fS(l,c){return l.injectorIndex===-1||l.parent&&l.parent.injectorIndex===l.injectorIndex||c[l.injectorIndex+8]===null?-1:l.injectorIndex}function ab(l,c){if(l.parent&&l.parent.injectorIndex!==-1)return l.parent.injectorIndex;let g=0,p=null,b=c;for(;b!==null;){if(p=yS(b),p===null)return rd;if(g++,b=b[pd],p.injectorIndex!==-1)return p.injectorIndex|g<<16}return rd}function RF(l,c,g){PF(l,c,g)}function pS(l,c,g){if(g&Sn.Optional||l!==void 0)return l;H1(c,"NodeInjector")}function mS(l,c,g,p){if(g&Sn.Optional&&p===void 0&&(p=null),!(g&(Sn.Self|Sn.Host))){let b=l[sd],r=xo(void 0);try{return b?b.get(c,p,g&Sn.Optional):IC(c,p,g&Sn.Optional)}finally{xo(r)}}return pS(p,c,g)}function gS(l,c,g,p=Sn.Default,b){if(l!==null){if(c[nn]&2048&&!(p&Sn.Self)){let A=FF(l,c,g,p,bs);if(A!==bs)return A}let r=_S(l,c,g,p,bs);if(r!==bs)return r}return mS(c,g,p,b)}function _S(l,c,g,p,b){let r=LF(g);if(typeof r=="function"){if(!nS(c,l,p))return p&Sn.Host?pS(b,g,p):mS(c,g,p,b);try{let A;if(A=r(p),A==null&&!(p&Sn.Optional))H1(g);else return A}finally{sS()}}else if(typeof r=="number"){let A=null,N=fS(l,c),V=rd,Y=p&Sn.Host?c[Is][Zo]:null;for((N===-1||p&Sn.SkipSelf)&&(V=N===-1?ab(l,c):c[N+8],V===rd||!QD(p,!1)?N=-1:(A=c[An],N=ty(V),c=ny(V,c)));N!==-1;){let ve=c[An];if(YD(r,N,ve.data)){let Pe=OF(N,c,g,A,p,Y);if(Pe!==bs)return Pe}V=c[N+8],V!==rd&&QD(p,c[An].data[N+8]===Y)&&YD(r,N,c)?(A=ve,N=ty(V),c=ny(V,c)):N=-1}}return b}function OF(l,c,g,p,b,r){let A=c[An],N=A.data[l+8],V=p==null?gy(N)&&p1:p!=A&&(N.type&3)!==0,Y=b&Sn.Host&&r===N,ve=H_(N,A,g,V,Y);return ve!==null?ld(c,A,ve,N):bs}function H_(l,c,g,p,b){let r=l.providerIndexes,A=c.data,N=r&1048575,V=l.directiveStart,Y=l.directiveEnd,ve=r>>20,Pe=p?N:N+ve,tt=b?N+ve:Y;for(let rt=Pe;rt<tt;rt++){let Ot=A[rt];if(rt<V&&g===Ot||rt>=V&&Ot.type===g)return rt}if(b){let rt=A[V];if(rt&&Vp(rt)&&rt.type===g)return V}return null}function ld(l,c,g,p){let b=l[g],r=c.data;if(IF(b)){let A=b;A.resolving&&tk(ek(r[g]));let N=XD(A.canSeeViewProviders);A.resolving=!0;let V,Y=A.injectImpl?xo(A.injectImpl):null,ve=nS(l,p,Sn.Default);try{b=l[g]=A.factory(void 0,r,l,p),c.firstCreatePass&&g>=p.directiveStart&&TF(g,r[g],c)}finally{Y!==null&&xo(Y),XD(N),A.resolving=!1,sS()}}return b}function LF(l){if(typeof l=="string")return l.charCodeAt(0)||0;let c=l.hasOwnProperty(Ip)?l[Ip]:void 0;return typeof c=="number"?c>=0?c&uS:kF:c}function YD(l,c,g){let p=1<<l;return!!(g[c+(l>>hS)]&p)}function QD(l,c){return!(l&Sn.Self)&&!(l&Sn.Host&&c)}var eu=class{constructor(c,g){this._tNode=c,this._lView=g}get(c,g,p){return gS(this._tNode,this._lView,c,fy(p),g)}};function kF(){return new eu(Yo(),_r())}function lb(l){return hy(()=>{let c=l.prototype.constructor,g=c[Z_]||m1(c),p=Object.prototype,b=Object.getPrototypeOf(l.prototype).constructor;for(;b&&b!==p;){let r=b[Z_]||m1(b);if(r&&r!==g)return r;b=Object.getPrototypeOf(b)}return r=>new r})}function m1(l){return yC(l)?()=>{let c=m1(bo(l));return c&&c()}:id(l)}function FF(l,c,g,p,b){let r=l,A=c;for(;r!==null&&A!==null&&A[nn]&2048&&!(A[nn]&512);){let N=_S(r,A,g,p|Sn.Self,bs);if(N!==bs)return N;let V=r.parent;if(!V){let Y=A[jC];if(Y){let ve=Y.get(g,bs,p);if(ve!==bs)return ve}V=yS(A),A=A[pd]}r=V}return b}function yS(l){let c=l[An],g=c.type;return g===2?c.declTNode:g===1?l[Zo]:null}function KD(l,c=null,g=null,p){let b=vS(l,c,g,p);return b.resolveInjectorInitializers(),b}function vS(l,c=null,g=null,p,b=new Set){let r=[g||qo,Ok(l)];return p=p||(typeof l=="object"?void 0:Di(l)),new Cp(r,c||Y1(),p||null,b)}var lu=(()=>{let c=class c{static create(p,b){if(Array.isArray(p))return KD({name:""},b,p,"");{let r=p.name??"";return KD({name:r},p.parent,p.providers,r)}}};c.THROW_IF_NOT_FOUND=Mp,c.NULL=new Q_,c.\u0275prov=Xt({token:c,providedIn:"any",factory:()=>bn(DC)}),c.__NG_ELEMENT_ID__=-1;let l=c;return l})();var NF="ngOriginalError";function Yx(l){return l[NF]}var ua=class{constructor(){this._console=console}handleError(c){let g=this._findOriginalError(c);this._console.error("ERROR",c),g&&this._console.error("ORIGINAL ERROR",g)}_findOriginalError(c){let g=c&&Yx(c);for(;g&&Yx(g);)g=Yx(g);return g||null}},xS=new yn("",{providedIn:"root",factory:()=>bt(ua).handleError.bind(void 0)}),bS=(()=>{let c=class c{};c.__NG_ELEMENT_ID__=zF,c.__NG_ENV_ID__=p=>p;let l=c;return l})(),g1=class extends bS{constructor(c){super(),this._lView=c}onDestroy(c){return YC(this._lView,c),()=>iF(this._lView,c)}};function zF(){return new g1(_r())}function BF(){return gd(Yo(),_r())}function gd(l,c){return new Cl(Xo(l,c))}var Cl=(()=>{let c=class c{constructor(p){this.nativeElement=p}};c.__NG_ELEMENT_ID__=BF;let l=c;return l})();function jF(l){return l instanceof Cl?l.nativeElement:l}var _1=class extends Mi{constructor(c=!1){super(),this.destroyRef=void 0,this.__isAsync=c,Gk()&&(this.destroyRef=bt(bS,{optional:!0})??void 0)}emit(c){let g=qn(null);try{super.next(c)}finally{qn(g)}}subscribe(c,g,p){let b=c,r=g||(()=>null),A=p;if(c&&typeof c=="object"){let V=c;b=V.next?.bind(V),r=V.error?.bind(V),A=V.complete?.bind(V)}this.__isAsync&&(r=Qx(r),b&&(b=Qx(b)),A&&(A=Qx(A)));let N=super.subscribe({next:b,error:r,complete:A});return c instanceof $r&&c.add(N),N}};function Qx(l){return c=>{setTimeout(l,void 0,c)}}var wo=_1;function VF(){return this._results[Symbol.iterator]()}var y1=class l{get changes(){return this._changes??=new wo}constructor(c=!1){this._emitDistinctChangesOnly=c,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let g=l.prototype;g[Symbol.iterator]||(g[Symbol.iterator]=VF)}get(c){return this._results[c]}map(c){return this._results.map(c)}filter(c){return this._results.filter(c)}find(c){return this._results.find(c)}reduce(c,g){return this._results.reduce(c,g)}forEach(c){this._results.forEach(c)}some(c){return this._results.some(c)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(c,g){this.dirty=!1;let p=fk(c);(this._changesDetected=!dk(this._results,p,g))&&(this._results=p,this.length=p.length,this.last=p[this.length-1],this.first=p[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(c){this._onDirty=c}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}};function wS(l){return(l.flags&128)===128}var TS=new Map,UF=0;function $F(){return UF++}function GF(l){TS.set(l[my],l)}function HF(l){TS.delete(l[my])}var JD="__ngContext__";function ou(l,c){Jc(c)?(l[JD]=c[my],GF(c)):l[JD]=c}function ES(l){return MS(l[Ap])}function IS(l){return MS(l[Wo])}function MS(l){for(;l!==null&&!pa(l);)l=l[Wo];return l}var v1;function DS(l){v1=l}function qF(){if(v1!==void 0)return v1;if(typeof document<"u")return document;throw new un(210,!1)}var cb=new yn("",{providedIn:"root",factory:()=>WF}),WF="ng",ub=new yn(""),Sl=new yn("",{providedIn:"platform",factory:()=>"unknown"});var hb=new yn("",{providedIn:"root",factory:()=>qF().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var ZF="h",XF="b";var YF=()=>null;function db(l,c,g=!1){return YF(l,c,g)}var CS=!1,QF=new yn("",{providedIn:"root",factory:()=>CS});var x1=class{constructor(c){this.changingThisBreaksApplicationSecurity=c}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${qL})`}};function fb(l){return l instanceof x1?l.changingThisBreaksApplicationSecurity:l}function SS(l){return l instanceof Function?l():l}var ha=function(l){return l[l.Important=1]="Important",l[l.DashCase=2]="DashCase",l}(ha||{}),KF;function pb(l,c){return KF(l,c)}function td(l,c,g,p,b){if(p!=null){let r,A=!1;pa(p)?r=p:Jc(p)&&(A=!0,p=p[fa]);let N=Ms(p);l===0&&g!==null?b==null?LS(c,g,N):ry(c,g,N,b||null,!0):l===1&&g!==null?ry(c,g,N,b||null,!0):l===2?mN(c,N,A):l===3&&c.destroyNode(N),r!=null&&_N(c,l,r,g,b)}}function JF(l,c){return l.createText(c)}function eN(l,c,g){l.setValue(c,g)}function AS(l,c,g){return l.createElement(c,g)}function tN(l,c){PS(l,c),c[fa]=null,c[Zo]=null}function nN(l,c,g,p,b,r){p[fa]=b,p[Zo]=c,yy(l,p,g,1,b,r)}function PS(l,c){c[Es].changeDetectionScheduler?.notify(1),yy(l,c,c[hi],2,null,null)}function rN(l){let c=l[Ap];if(!c)return Kx(l[An],l);for(;c;){let g=null;if(Jc(c))g=c[Ap];else{let p=c[io];p&&(g=p)}if(!g){for(;c&&!c[Wo]&&c!==l;)Jc(c)&&Kx(c[An],c),c=c[ii];c===null&&(c=l),Jc(c)&&Kx(c[An],c),g=c&&c[Wo]}c=g}}function iN(l,c,g,p){let b=io+p,r=g.length;p>0&&(g[b-1][Wo]=c),p<r-io?(c[Wo]=g[b],MC(g,io+p,c)):(g.push(c),c[Wo]=null),c[ii]=g;let A=c[jp];A!==null&&g!==A&&oN(A,c);let N=c[ca];N!==null&&N.insertView(l),d1(c),c[nn]|=128}function oN(l,c){let g=l[ad],b=c[ii][ii][Is];c[Is]!==b&&(l[nn]|=Q1.HasTransplantedViews),g===null?l[ad]=[c]:g.push(c)}function RS(l,c){let g=l[ad],p=g.indexOf(c);g.splice(p,1)}function b1(l,c){if(l.length<=io)return;let g=io+c,p=l[g];if(p){let b=p[jp];b!==null&&b!==l&&RS(b,p),c>0&&(l[g-1][Wo]=p[Wo]);let r=Y_(l,io+c);tN(p[An],p);let A=r[ca];A!==null&&A.detachView(r[An]),p[ii]=null,p[Wo]=null,p[nn]&=-129}return p}function OS(l,c){if(!(c[nn]&256)){let g=c[hi];g.destroyNode&&yy(l,c,g,3,null,null),rN(c)}}function Kx(l,c){if(c[nn]&256)return;let g=qn(null);try{c[nn]&=-129,c[nn]|=256,c[nu]&&sD(c[nu]),aN(l,c),sN(l,c),c[An].type===1&&c[hi].destroy();let p=c[jp];if(p!==null&&pa(c[ii])){p!==c[ii]&&RS(p,c);let b=c[ca];b!==null&&b.detachView(l)}HF(c)}finally{qn(g)}}function sN(l,c){let g=l.cleanup,p=c[Sp];if(g!==null)for(let r=0;r<g.length-1;r+=2)if(typeof g[r]=="string"){let A=g[r+3];A>=0?p[A]():p[-A].unsubscribe(),r+=2}else{let A=p[g[r+1]];g[r].call(A)}p!==null&&(c[Sp]=null);let b=c[El];if(b!==null){c[El]=null;for(let r=0;r<b.length;r++){let A=b[r];A()}}}function aN(l,c){let g;if(l!=null&&(g=l.destroyHooks)!=null)for(let p=0;p<g.length;p+=2){let b=c[g[p]];if(!(b instanceof Op)){let r=g[p+1];if(Array.isArray(r))for(let A=0;A<r.length;A+=2){let N=b[r[A]],V=r[A+1];xs(4,N,V);try{V.call(N)}finally{xs(5,N,V)}}else{xs(4,b,r);try{r.call(b)}finally{xs(5,b,r)}}}}}function lN(l,c,g){return cN(l,c.parent,g)}function cN(l,c,g){let p=c;for(;p!==null&&p.type&40;)c=p,p=c.parent;if(p===null)return g[fa];{let{componentOffset:b}=p;if(b>-1){let{encapsulation:r}=l.data[p.directiveStart+b];if(r===ws.None||r===ws.Emulated)return null}return Xo(p,g)}}function ry(l,c,g,p,b){l.insertBefore(c,g,p,b)}function LS(l,c,g){l.appendChild(c,g)}function eC(l,c,g,p,b){p!==null?ry(l,c,g,p,b):LS(l,c,g)}function uN(l,c,g,p){l.removeChild(c,g,p)}function mb(l,c){return l.parentNode(c)}function hN(l,c){return l.nextSibling(c)}function dN(l,c,g){return pN(l,c,g)}function fN(l,c,g){return l.type&40?Xo(l,g):null}var pN=fN,tC;function gb(l,c,g,p){let b=lN(l,p,c),r=c[hi],A=p.parent||c[Zo],N=dN(A,p,c);if(b!=null)if(Array.isArray(g))for(let V=0;V<g.length;V++)eC(r,b,g[V],N,!1);else eC(r,b,g,N,!1);tC!==void 0&&tC(r,p,c,g,b)}function q_(l,c){if(c!==null){let g=c.type;if(g&3)return Xo(c,l);if(g&4)return w1(-1,l[c.index]);if(g&8){let p=c.child;if(p!==null)return q_(l,p);{let b=l[c.index];return pa(b)?w1(-1,b):Ms(b)}}else{if(g&32)return pb(c,l)()||Ms(l[c.index]);{let p=kS(l,c);if(p!==null){if(Array.isArray(p))return p[0];let b=Rp(l[Is]);return q_(b,p)}else return q_(l,c.next)}}}return null}function kS(l,c){if(c!==null){let p=l[Is][Zo],b=c.projection;return p.projection[b]}return null}function w1(l,c){let g=io+l+1;if(g<c.length){let p=c[g],b=p[An].firstChild;if(b!==null)return q_(p,b)}return c[ru]}function mN(l,c,g){let p=mb(l,c);p&&uN(l,p,c,g)}function _b(l,c,g,p,b,r,A){for(;g!=null;){let N=p[g.index],V=g.type;if(A&&c===0&&(N&&ou(Ms(N),p),g.flags|=2),(g.flags&32)!==32)if(V&8)_b(l,c,g.child,p,b,r,!1),td(c,l,b,N,r);else if(V&32){let Y=pb(g,p),ve;for(;ve=Y();)td(c,l,b,ve,r);td(c,l,b,N,r)}else V&16?gN(l,c,p,g,b,r):td(c,l,b,N,r);g=A?g.projectionNext:g.next}}function yy(l,c,g,p,b,r){_b(g,p,l.firstChild,c,b,r,!1)}function gN(l,c,g,p,b,r){let A=g[Is],V=A[Zo].projection[p.projection];if(Array.isArray(V))for(let Y=0;Y<V.length;Y++){let ve=V[Y];td(c,l,b,ve,r)}else{let Y=V,ve=A[ii];wS(p)&&(Y.flags|=128),_b(l,c,Y,ve,b,r,!0)}}function _N(l,c,g,p,b){let r=g[ru],A=Ms(g);r!==A&&td(c,l,p,r,b);for(let N=io;N<g.length;N++){let V=g[N];yy(V[An],V,l,c,p,r)}}function yN(l,c,g,p,b){if(c)b?l.addClass(g,p):l.removeClass(g,p);else{let r=p.indexOf("-")===-1?void 0:ha.DashCase;b==null?l.removeStyle(g,p,r):(typeof b=="string"&&b.endsWith("!important")&&(b=b.slice(0,-10),r|=ha.Important),l.setStyle(g,p,b,r))}}function vN(l,c,g){l.setAttribute(c,"style",g)}function FS(l,c,g){g===""?l.removeAttribute(c,"class"):l.setAttribute(c,"class",g)}function NS(l,c,g){let{mergedAttrs:p,classes:b,styles:r}=g;p!==null&&s1(l,c,p),b!==null&&FS(l,c,b),r!==null&&vN(l,c,r)}var _d={};function Cs(l=1){zS(Ds(),_r(),md()+l,!1)}function zS(l,c,g,p){if(!p)if((c[nn]&3)===3){let r=l.preOrderCheckHooks;r!==null&&$_(c,r,g)}else{let r=l.preOrderHooks;r!==null&&G_(c,r,0,g)}iu(g)}function Ci(l,c=Sn.Default){let g=_r();if(g===null)return bn(l,c);let p=Yo();return gS(p,g,bo(l),c)}function BS(l,c,g,p,b,r){let A=qn(null);try{let N=null;b&la.SignalBased&&(N=c[p][nD]),N!==null&&N.transformFn!==void 0&&(r=N.transformFn(r)),b&la.HasDecoratorInputTransform&&(r=l.inputTransforms[p].call(c,r)),l.setInput!==null?l.setInput(c,N,r,g,p):$C(c,N,p,r)}finally{qn(A)}}function xN(l,c){let g=l.hostBindingOpCodes;if(g!==null)try{for(let p=0;p<g.length;p++){let b=g[p];if(b<0)iu(~b);else{let r=b,A=g[++p],N=g[++p];gF(A,r);let V=c[r];N(2,V)}}}finally{iu(-1)}}function vy(l,c,g,p,b,r,A,N,V,Y,ve){let Pe=c.blueprint.slice();return Pe[fa]=b,Pe[nn]=p|4|128|8|64,(Y!==null||l&&l[nn]&2048)&&(Pe[nn]|=2048),XC(Pe),Pe[ii]=Pe[pd]=l,Pe[Ts]=g,Pe[Es]=A||l&&l[Es],Pe[hi]=N||l&&l[hi],Pe[sd]=V||l&&l[sd]||null,Pe[Zo]=r,Pe[my]=$F(),Pe[K_]=ve,Pe[jC]=Y,Pe[Is]=c.type==2?l[Is]:Pe,Pe}function xy(l,c,g,p,b){let r=l.data[c];if(r===null)r=bN(l,c,g,p,b),mF()&&(r.flags|=32);else if(r.type&64){r.type=g,r.value=p,r.attrs=b;let A=hF();r.injectorIndex=A===null?-1:A.injectorIndex}return Up(r,!0),r}function bN(l,c,g,p,b){let r=KC(),A=JC(),N=A?r:r&&r.parent,V=l.data[c]=DN(l,N,g,c,p,b);return l.firstChild===null&&(l.firstChild=V),r!==null&&(A?r.child==null&&V.parent!==null&&(r.child=V):r.next===null&&(r.next=V,V.prev=r)),V}function jS(l,c,g,p){if(g===0)return-1;let b=c.length;for(let r=0;r<g;r++)c.push(p),l.blueprint.push(p),l.data.push(null);return b}function VS(l,c,g,p,b){let r=md(),A=p&2;try{iu(-1),A&&c.length>Il&&zS(l,c,Il,!1),xs(A?2:0,b),g(p,b)}finally{iu(r),xs(A?3:1,b)}}function US(l,c,g){if(UC(c)){let p=qn(null);try{let b=c.directiveStart,r=c.directiveEnd;for(let A=b;A<r;A++){let N=l.data[A];if(N.contentQueries){let V=g[A];N.contentQueries(1,V,A)}}}finally{qn(p)}}}function $S(l,c,g){QC()&&(LN(l,c,g,Xo(g,c)),(g.flags&64)===64&&ZS(l,c,g))}function GS(l,c,g=Xo){let p=c.localNames;if(p!==null){let b=c.index+1;for(let r=0;r<p.length;r+=2){let A=p[r+1],N=A===-1?g(c,l):l[A];l[b++]=N}}}function HS(l){let c=l.tView;return c===null||c.incompleteFirstPass?l.tView=yb(1,null,l.template,l.decls,l.vars,l.directiveDefs,l.pipeDefs,l.viewQuery,l.schemas,l.consts,l.id):c}function yb(l,c,g,p,b,r,A,N,V,Y,ve){let Pe=Il+p,tt=Pe+b,rt=wN(Pe,tt),Ot=typeof Y=="function"?Y():Y;return rt[An]={type:l,blueprint:rt,template:g,queries:null,viewQuery:N,declTNode:c,data:rt.slice().fill(null,Pe),bindingStartIndex:Pe,expandoStartIndex:tt,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof r=="function"?r():r,pipeRegistry:typeof A=="function"?A():A,firstChild:null,schemas:V,consts:Ot,incompleteFirstPass:!1,ssrId:ve}}function wN(l,c){let g=[];for(let p=0;p<c;p++)g.push(p<l?null:_d);return g}function TN(l,c,g,p){let r=p.get(QF,CS)||g===ws.ShadowDom,A=l.selectRootElement(c,r);return EN(A),A}function EN(l){IN(l)}var IN=()=>null;function MN(l,c,g,p){let b=QS(c);b.push(g),l.firstCreatePass&&KS(l).push(p,b.length-1)}function DN(l,c,g,p,b,r){let A=c?c.injectorIndex:-1,N=0;return lF()&&(N|=128),{type:g,index:p,insertBeforeIndex:null,injectorIndex:A,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:N,providerIndexes:0,value:b,attrs:r,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:c,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function nC(l,c,g,p,b){for(let r in c){if(!c.hasOwnProperty(r))continue;let A=c[r];if(A===void 0)continue;p??={};let N,V=la.None;Array.isArray(A)?(N=A[0],V=A[1]):N=A;let Y=r;if(b!==null){if(!b.hasOwnProperty(r))continue;Y=b[r]}l===0?rC(p,g,Y,N,V):rC(p,g,Y,N)}return p}function rC(l,c,g,p,b){let r;l.hasOwnProperty(g)?(r=l[g]).push(c,p):r=l[g]=[c,p],b!==void 0&&r.push(b)}function CN(l,c,g){let p=c.directiveStart,b=c.directiveEnd,r=l.data,A=c.attrs,N=[],V=null,Y=null;for(let ve=p;ve<b;ve++){let Pe=r[ve],tt=g?g.get(Pe):null,rt=tt?tt.inputs:null,Ot=tt?tt.outputs:null;V=nC(0,Pe.inputs,ve,V,rt),Y=nC(1,Pe.outputs,ve,Y,Ot);let Jt=V!==null&&A!==null&&!Z1(c)?$N(V,ve,A):null;N.push(Jt)}V!==null&&(V.hasOwnProperty("class")&&(c.flags|=8),V.hasOwnProperty("style")&&(c.flags|=16)),c.initialInputs=N,c.inputs=V,c.outputs=Y}function SN(l){return l==="class"?"className":l==="for"?"htmlFor":l==="formaction"?"formAction":l==="innerHtml"?"innerHTML":l==="readonly"?"readOnly":l==="tabindex"?"tabIndex":l}function AN(l,c,g,p,b,r,A,N){let V=Xo(c,g),Y=c.inputs,ve;!N&&Y!=null&&(ve=Y[p])?(vb(l,g,ve,p,b),gy(c)&&PN(g,c.index)):c.type&3?(p=SN(p),b=A!=null?A(b,c.value||"",p):b,r.setProperty(V,p,b)):c.type&12}function PN(l,c){let g=Dl(c,l);g[nn]&16||(g[nn]|=64)}function qS(l,c,g,p){if(QC()){let b=p===null?null:{"":-1},r=FN(l,g),A,N;r===null?A=N=null:[A,N]=r,A!==null&&WS(l,c,g,A,b,N),b&&NN(g,p,b)}g.mergedAttrs=W1(g.mergedAttrs,g.attrs)}function WS(l,c,g,p,b,r){for(let Y=0;Y<p.length;Y++)RF(dS(g,c),l,p[Y].type);BN(g,l.data.length,p.length);for(let Y=0;Y<p.length;Y++){let ve=p[Y];ve.providersResolver&&ve.providersResolver(ve)}let A=!1,N=!1,V=jS(l,c,p.length,null);for(let Y=0;Y<p.length;Y++){let ve=p[Y];g.mergedAttrs=W1(g.mergedAttrs,ve.hostAttrs),jN(l,g,c,V,ve),zN(V,ve,b),ve.contentQueries!==null&&(g.flags|=4),(ve.hostBindings!==null||ve.hostAttrs!==null||ve.hostVars!==0)&&(g.flags|=64);let Pe=ve.type.prototype;!A&&(Pe.ngOnChanges||Pe.ngOnInit||Pe.ngDoCheck)&&((l.preOrderHooks??=[]).push(g.index),A=!0),!N&&(Pe.ngOnChanges||Pe.ngDoCheck)&&((l.preOrderCheckHooks??=[]).push(g.index),N=!0),V++}CN(l,g,r)}function RN(l,c,g,p,b){let r=b.hostBindings;if(r){let A=l.hostBindingOpCodes;A===null&&(A=l.hostBindingOpCodes=[]);let N=~c.index;ON(A)!=N&&A.push(N),A.push(g,p,r)}}function ON(l){let c=l.length;for(;c>0;){let g=l[--c];if(typeof g=="number"&&g<0)return g}return 0}function LN(l,c,g,p){let b=g.directiveStart,r=g.directiveEnd;gy(g)&&VN(c,g,l.data[b+g.componentOffset]),l.firstCreatePass||dS(g,c),ou(p,c);let A=g.initialInputs;for(let N=b;N<r;N++){let V=l.data[N],Y=ld(c,l,N,g);if(ou(Y,c),A!==null&&UN(c,N-b,Y,V,g,A),Vp(V)){let ve=Dl(g.index,c);ve[Ts]=ld(c,l,N,g)}}}function ZS(l,c,g){let p=g.directiveStart,b=g.directiveEnd,r=g.index,A=_F();try{iu(r);for(let N=p;N<b;N++){let V=l.data[N],Y=c[N];f1(N),(V.hostBindings!==null||V.hostVars!==0||V.hostAttrs!==null)&&kN(V,Y)}}finally{iu(-1),f1(A)}}function kN(l,c){l.hostBindings!==null&&l.hostBindings(1,c)}function FN(l,c){let g=l.directiveRegistry,p=null,b=null;if(g)for(let r=0;r<g.length;r++){let A=g[r];if(Ek(c,A.selectors,!1))if(p||(p=[]),Vp(A))if(A.findHostDirectiveDefs!==null){let N=[];b=b||new Map,A.findHostDirectiveDefs(A,N,b),p.unshift(...N,A);let V=N.length;T1(l,c,V)}else p.unshift(A),T1(l,c,0);else b=b||new Map,A.findHostDirectiveDefs?.(A,p,b),p.push(A)}return p===null?null:[p,b]}function T1(l,c,g){c.componentOffset=g,(l.components??=[]).push(c.index)}function NN(l,c,g){if(c){let p=l.localNames=[];for(let b=0;b<c.length;b+=2){let r=g[c[b+1]];if(r==null)throw new un(-301,!1);p.push(c[b],r)}}}function zN(l,c,g){if(g){if(c.exportAs)for(let p=0;p<c.exportAs.length;p++)g[c.exportAs[p]]=l;Vp(c)&&(g[""]=l)}}function BN(l,c,g){l.flags|=1,l.directiveStart=c,l.directiveEnd=c+g,l.providerIndexes=c}function jN(l,c,g,p,b){l.data[p]=b;let r=b.factory||(b.factory=id(b.type,!0)),A=new Op(r,Vp(b),Ci);l.blueprint[p]=A,g[p]=A,RN(l,c,p,jS(l,g,b.hostVars,_d),b)}function VN(l,c,g){let p=Xo(c,l),b=HS(g),r=l[Es].rendererFactory,A=16;g.signals?A=4096:g.onPush&&(A=64);let N=by(l,vy(l,b,null,A,p,c,null,r.createRenderer(p,g),null,null,null));l[c.index]=N}function UN(l,c,g,p,b,r){let A=r[c];if(A!==null)for(let N=0;N<A.length;){let V=A[N++],Y=A[N++],ve=A[N++],Pe=A[N++];BS(p,g,V,Y,ve,Pe)}}function $N(l,c,g){let p=null,b=0;for(;b<g.length;){let r=g[b];if(r===0){b+=4;continue}else if(r===5){b+=2;continue}if(typeof r=="number")break;if(l.hasOwnProperty(r)){p===null&&(p=[]);let A=l[r];for(let N=0;N<A.length;N+=3)if(A[N]===c){p.push(r,A[N+1],A[N+2],g[b+1]);break}}b+=2}return p}function XS(l,c,g,p){return[l,!0,0,c,null,p,null,g,null,null]}function YS(l,c){let g=l.contentQueries;if(g!==null){let p=qn(null);try{for(let b=0;b<g.length;b+=2){let r=g[b],A=g[b+1];if(A!==-1){let N=l.data[A];tb(r),N.contentQueries(2,c[A],A)}}}finally{qn(p)}}}function by(l,c){return l[Ap]?l[qD][Wo]=c:l[Ap]=c,l[qD]=c,c}function E1(l,c,g){tb(0);let p=qn(null);try{c(l,g)}finally{qn(p)}}function QS(l){return l[Sp]||(l[Sp]=[])}function KS(l){return l.cleanup||(l.cleanup=[])}function JS(l,c){let g=l[sd],p=g?g.get(ua,null):null;p&&p.handleError(c)}function vb(l,c,g,p,b){for(let r=0;r<g.length;){let A=g[r++],N=g[r++],V=g[r++],Y=c[A],ve=l.data[A];BS(ve,Y,p,N,V,b)}}function GN(l,c,g){let p=WC(c,l);eN(l[hi],p,g)}function HN(l,c){let g=Dl(c,l),p=g[An];qN(p,g);let b=g[fa];b!==null&&g[K_]===null&&(g[K_]=db(b,g[sd])),xb(p,g,g[Ts])}function qN(l,c){for(let g=c.length;g<l.blueprint.length;g++)c.push(l.blueprint[g])}function xb(l,c,g){nb(c);try{let p=l.viewQuery;p!==null&&E1(1,p,g);let b=l.template;b!==null&&VS(l,c,b,1,g),l.firstCreatePass&&(l.firstCreatePass=!1),c[ca]?.finishViewCreation(l),l.staticContentQueries&&YS(l,c),l.staticViewQueries&&E1(2,l.viewQuery,g);let r=l.components;r!==null&&WN(c,r)}catch(p){throw l.firstCreatePass&&(l.incompleteFirstPass=!0,l.firstCreatePass=!1),p}finally{c[nn]&=-5,rb()}}function WN(l,c){for(let g=0;g<c.length;g++)HN(l,c[g])}function ZN(l,c,g,p){let b=qn(null);try{let r=c.tView,N=l[nn]&4096?4096:16,V=vy(l,r,g,N,null,c,null,null,p?.injector??null,p?.embeddedViewInjector??null,p?.dehydratedView??null),Y=l[c.index];V[jp]=Y;let ve=l[ca];return ve!==null&&(V[ca]=ve.createEmbeddedView(r)),xb(r,V,g),V}finally{qn(b)}}function iC(l,c){return!c||c.firstChild===null||wS(l)}function XN(l,c,g,p=!0){let b=c[An];if(iN(b,c,l,g),p){let A=w1(g,l),N=c[hi],V=mb(N,l[ru]);V!==null&&nN(b,l[Zo],N,c,V,A)}let r=c[K_];r!==null&&r.firstChild!==null&&(r.firstChild=null)}function iy(l,c,g,p,b=!1){for(;g!==null;){let r=c[g.index];r!==null&&p.push(Ms(r)),pa(r)&&YN(r,p);let A=g.type;if(A&8)iy(l,c,g.child,p);else if(A&32){let N=pb(g,c),V;for(;V=N();)p.push(V)}else if(A&16){let N=kS(c,g);if(Array.isArray(N))p.push(...N);else{let V=Rp(c[Is]);iy(V[An],V,N,p,!0)}}g=b?g.projectionNext:g.next}return p}function YN(l,c){for(let g=io;g<l.length;g++){let p=l[g],b=p[An].firstChild;b!==null&&iy(p[An],p,b,c)}l[ru]!==l[fa]&&c.push(l[ru])}var e2=[];function QN(l){return l[nu]??KN(l)}function KN(l){let c=e2.pop()??Object.create(e3);return c.lView=l,c}function JN(l){l.lView[nu]!==l&&(l.lView=null,e2.push(l))}var e3=gr(Rt({},rD),{consumerIsAlwaysLive:!0,consumerMarkedDirty:l=>{Pp(l.lView)},consumerOnSignalRead(){this.lView[nu]=this}}),t2=100;function n2(l,c=!0,g=0){let p=l[Es],b=p.rendererFactory,r=!1;r||b.begin?.();try{t3(l,g)}catch(A){throw c&&JS(l,A),A}finally{r||(b.end?.(),p.inlineEffectRunner?.flush())}}function t3(l,c){I1(l,c);let g=0;for(;eb(l);){if(g===t2)throw new un(103,!1);g++,I1(l,1)}}function n3(l,c,g,p){let b=c[nn];if((b&256)===256)return;let r=!1;!r&&c[Es].inlineEffectRunner?.flush(),nb(c);let A=null,N=null;!r&&r3(l)&&(N=QN(c),A=iD(N));try{XC(c),fF(l.bindingStartIndex),g!==null&&VS(l,c,g,2,p);let V=(b&3)===3;if(!r)if(V){let Pe=l.preOrderCheckHooks;Pe!==null&&$_(c,Pe,null)}else{let Pe=l.preOrderHooks;Pe!==null&&G_(c,Pe,0,null),Zx(c,0)}if(i3(c),r2(c,0),l.contentQueries!==null&&YS(l,c),!r)if(V){let Pe=l.contentCheckHooks;Pe!==null&&$_(c,Pe)}else{let Pe=l.contentHooks;Pe!==null&&G_(c,Pe,1),Zx(c,1)}xN(l,c);let Y=l.components;Y!==null&&o2(c,Y,0);let ve=l.viewQuery;if(ve!==null&&E1(2,ve,p),!r)if(V){let Pe=l.viewCheckHooks;Pe!==null&&$_(c,Pe)}else{let Pe=l.viewHooks;Pe!==null&&G_(c,Pe,2),Zx(c,2)}if(l.firstUpdatePass===!0&&(l.firstUpdatePass=!1),c[Wx]){for(let Pe of c[Wx])Pe();c[Wx]=null}r||(c[nn]&=-73)}catch(V){throw Pp(c),V}finally{N!==null&&(oD(N,A),JN(N)),rb()}}function r3(l){return l.type!==2}function r2(l,c){for(let g=ES(l);g!==null;g=IS(g))for(let p=io;p<g.length;p++){let b=g[p];i2(b,c)}}function i3(l){for(let c=ES(l);c!==null;c=IS(c)){if(!(c[nn]&Q1.HasTransplantedViews))continue;let g=c[ad];for(let p=0;p<g.length;p++){let b=g[p],r=b[ii];nF(b)}}}function o3(l,c,g){let p=Dl(c,l);i2(p,g)}function i2(l,c){J1(l)&&I1(l,c)}function I1(l,c){let p=l[An],b=l[nn],r=l[nu],A=!!(c===0&&b&16);if(A||=!!(b&64&&c===0),A||=!!(b&1024),A||=!!(r?.dirty&&Mx(r)),r&&(r.dirty=!1),l[nn]&=-9217,A)n3(p,l,p.template,l[Ts]);else if(b&8192){r2(l,1);let N=p.components;N!==null&&o2(l,N,1)}}function o2(l,c,g){for(let p=0;p<c.length;p++)o3(l,c[p],g)}function bb(l){for(l[Es].changeDetectionScheduler?.notify();l;){l[nn]|=64;let c=Rp(l);if(qk(l)&&!c)return l;l=c}return null}var su=class{get rootNodes(){let c=this._lView,g=c[An];return iy(g,c,g.firstChild,[])}constructor(c,g,p=!0){this._lView=c,this._cdRefInjectingView=g,this.notifyErrorHandler=p,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Ts]}set context(c){this._lView[Ts]=c}get destroyed(){return(this._lView[nn]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let c=this._lView[ii];if(pa(c)){let g=c[J_],p=g?g.indexOf(this):-1;p>-1&&(b1(c,p),Y_(g,p))}this._attachedToViewContainer=!1}OS(this._lView[An],this._lView)}onDestroy(c){YC(this._lView,c)}markForCheck(){bb(this._cdRefInjectingView||this._lView)}detach(){this._lView[nn]&=-129}reattach(){d1(this._lView),this._lView[nn]|=128}detectChanges(){this._lView[nn]|=1024,n2(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new un(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,PS(this._lView[An],this._lView)}attachToAppRef(c){if(this._attachedToViewContainer)throw new un(902,!1);this._appRef=c,d1(this._lView)}},cd=(()=>{let c=class c{};c.__NG_ELEMENT_ID__=l3;let l=c;return l})(),s3=cd,a3=class extends s3{constructor(c,g,p){super(),this._declarationLView=c,this._declarationTContainer=g,this.elementRef=p}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(c,g){return this.createEmbeddedViewImpl(c,g)}createEmbeddedViewImpl(c,g,p){let b=ZN(this._declarationLView,this._declarationTContainer,c,{embeddedViewInjector:g,dehydratedView:p});return new su(b)}};function l3(){return wb(Yo(),_r())}function wb(l,c){return l.type&4?new a3(c,l,gd(l,c)):null}var x8=new RegExp(`^(\\d+)*(${XF}|${ZF})*(.*)`);var c3=()=>null;function oC(l,c){return c3(l,c)}var M1=class{},D1=class{},oy=class{};function u3(l){let c=Error(`No component factory found for ${Di(l)}.`);return c[h3]=l,c}var h3="ngComponent";var C1=class{resolveComponentFactory(c){throw u3(c)}},yd=(()=>{let c=class c{};c.NULL=new C1;let l=c;return l})(),Lp=class{},wy=(()=>{let c=class c{constructor(){this.destroyNode=null}};c.__NG_ELEMENT_ID__=()=>d3();let l=c;return l})();function d3(){let l=_r(),c=Yo(),g=Dl(c.index,l);return(Jc(g)?g:l)[hi]}var f3=(()=>{let c=class c{};c.\u0275prov=Xt({token:c,providedIn:"root",factory:()=>null});let l=c;return l})(),Jx={};var sC=new Set;function Tb(l){sC.has(l)||(sC.add(l),performance?.mark?.("mark_feature_usage",{detail:{feature:l}}))}function aC(...l){}function p3(){let l=typeof Ep.requestAnimationFrame=="function",c=Ep[l?"requestAnimationFrame":"setTimeout"],g=Ep[l?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&c&&g){let p=c[Zone.__symbol__("OriginalDelegate")];p&&(c=p);let b=g[Zone.__symbol__("OriginalDelegate")];b&&(g=b)}return{nativeRequestAnimationFrame:c,nativeCancelAnimationFrame:g}}var wr=class l{constructor({enableLongStackTrace:c=!1,shouldCoalesceEventChangeDetection:g=!1,shouldCoalesceRunChangeDetection:p=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new wo(!1),this.onMicrotaskEmpty=new wo(!1),this.onStable=new wo(!1),this.onError=new wo(!1),typeof Zone>"u")throw new un(908,!1);Zone.assertZonePatched();let b=this;b._nesting=0,b._outer=b._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(b._inner=b._inner.fork(new Zone.TaskTrackingZoneSpec)),c&&Zone.longStackTraceZoneSpec&&(b._inner=b._inner.fork(Zone.longStackTraceZoneSpec)),b.shouldCoalesceEventChangeDetection=!p&&g,b.shouldCoalesceRunChangeDetection=p,b.lastRequestAnimationFrameId=-1,b.nativeRequestAnimationFrame=p3().nativeRequestAnimationFrame,_3(b)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!l.isInAngularZone())throw new un(909,!1)}static assertNotInAngularZone(){if(l.isInAngularZone())throw new un(909,!1)}run(c,g,p){return this._inner.run(c,g,p)}runTask(c,g,p,b){let r=this._inner,A=r.scheduleEventTask("NgZoneEvent: "+b,c,m3,aC,aC);try{return r.runTask(A,g,p)}finally{r.cancelTask(A)}}runGuarded(c,g,p){return this._inner.runGuarded(c,g,p)}runOutsideAngular(c){return this._outer.run(c)}},m3={};function Eb(l){if(l._nesting==0&&!l.hasPendingMicrotasks&&!l.isStable)try{l._nesting++,l.onMicrotaskEmpty.emit(null)}finally{if(l._nesting--,!l.hasPendingMicrotasks)try{l.runOutsideAngular(()=>l.onStable.emit(null))}finally{l.isStable=!0}}}function g3(l){l.isCheckStableRunning||l.lastRequestAnimationFrameId!==-1||(l.lastRequestAnimationFrameId=l.nativeRequestAnimationFrame.call(Ep,()=>{l.fakeTopEventTask||(l.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{l.lastRequestAnimationFrameId=-1,S1(l),l.isCheckStableRunning=!0,Eb(l),l.isCheckStableRunning=!1},void 0,()=>{},()=>{})),l.fakeTopEventTask.invoke()}),S1(l))}function _3(l){let c=()=>{g3(l)};l._inner=l._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(g,p,b,r,A,N)=>{if(y3(N))return g.invokeTask(b,r,A,N);try{return lC(l),g.invokeTask(b,r,A,N)}finally{(l.shouldCoalesceEventChangeDetection&&r.type==="eventTask"||l.shouldCoalesceRunChangeDetection)&&c(),cC(l)}},onInvoke:(g,p,b,r,A,N,V)=>{try{return lC(l),g.invoke(b,r,A,N,V)}finally{l.shouldCoalesceRunChangeDetection&&c(),cC(l)}},onHasTask:(g,p,b,r)=>{g.hasTask(b,r),p===b&&(r.change=="microTask"?(l._hasPendingMicrotasks=r.microTask,S1(l),Eb(l)):r.change=="macroTask"&&(l.hasPendingMacrotasks=r.macroTask))},onHandleError:(g,p,b,r)=>(g.handleError(b,r),l.runOutsideAngular(()=>l.onError.emit(r)),!1)})}function S1(l){l._hasPendingMicrotasks||(l.shouldCoalesceEventChangeDetection||l.shouldCoalesceRunChangeDetection)&&l.lastRequestAnimationFrameId!==-1?l.hasPendingMicrotasks=!0:l.hasPendingMicrotasks=!1}function lC(l){l._nesting++,l.isStable&&(l.isStable=!1,l.onUnstable.emit(null))}function cC(l){l._nesting--,Eb(l)}function y3(l){return!Array.isArray(l)||l.length!==1?!1:l[0].data?.__ignore_ng_zone__===!0}var s2=(()=>{let c=class c{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let p=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let b of p)b()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};c.\u0275prov=Xt({token:c,providedIn:"root",factory:()=>new c});let l=c;return l})();function A1(l,c,g){let p=g?l.styles:null,b=g?l.classes:null,r=0;if(c!==null)for(let A=0;A<c.length;A++){let N=c[A];if(typeof N=="number")r=N;else if(r==1)b=FD(b,N);else if(r==2){let V=N,Y=c[++A];p=FD(p,V+": "+Y+";")}}g?l.styles=p:l.stylesWithoutHost=p,g?l.classes=b:l.classesWithoutHost=b}var sy=class extends yd{constructor(c){super(),this.ngModule=c}resolveComponentFactory(c){let g=tu(c);return new kp(g,this.ngModule)}};function uC(l){let c=[];for(let g in l){if(!l.hasOwnProperty(g))continue;let p=l[g];p!==void 0&&c.push({propName:Array.isArray(p)?p[0]:p,templateName:g})}return c}function v3(l){let c=l.toLowerCase();return c==="svg"?Yk:c==="math"?Qk:null}var P1=class{constructor(c,g){this.injector=c,this.parentInjector=g}get(c,g,p){p=fy(p);let b=this.injector.get(c,Jx,p);return b!==Jx||g===Jx?b:this.parentInjector.get(c,g,p)}},kp=class extends oy{get inputs(){let c=this.componentDef,g=c.inputTransforms,p=uC(c.inputs);if(g!==null)for(let b of p)g.hasOwnProperty(b.propName)&&(b.transform=g[b.propName]);return p}get outputs(){return uC(this.componentDef.outputs)}constructor(c,g){super(),this.componentDef=c,this.ngModule=g,this.componentType=c.type,this.selector=Ck(c.selectors),this.ngContentSelectors=c.ngContentSelectors?c.ngContentSelectors:[],this.isBoundToModule=!!g}create(c,g,p,b){let r=qn(null);try{b=b||this.ngModule;let A=b instanceof Ui?b:b?.injector;A&&this.componentDef.getStandaloneInjector!==null&&(A=this.componentDef.getStandaloneInjector(A)||A);let N=A?new P1(c,A):c,V=N.get(Lp,null);if(V===null)throw new un(407,!1);let Y=N.get(f3,null),ve=N.get(s2,null),Pe=N.get(M1,null),tt={rendererFactory:V,sanitizer:Y,inlineEffectRunner:null,afterRenderEventManager:ve,changeDetectionScheduler:Pe},rt=V.createRenderer(null,this.componentDef),Ot=this.componentDef.selectors[0][0]||"div",Jt=p?TN(rt,p,this.componentDef.encapsulation,N):AS(rt,Ot,v3(Ot)),qt=512;this.componentDef.signals?qt|=4096:this.componentDef.onPush||(qt|=16);let Ft=null;Jt!==null&&(Ft=db(Jt,N,!0));let rn=yb(0,null,null,1,0,null,null,null,null,null,null),on=vy(null,rn,null,qt,null,null,tt,rt,N,null,Ft);nb(on);let Ln,Cr;try{let Sr=this.componentDef,di,Dn=null;Sr.findHostDirectiveDefs?(di=[],Dn=new Map,Sr.findHostDirectiveDefs(Sr,di,Dn),di.push(Sr)):di=[Sr];let vn=x3(on,Jt),fi=b3(vn,Jt,Sr,di,on,tt,rt);Cr=ZC(rn,Il),Jt&&E3(rt,Sr,Jt,p),g!==void 0&&I3(Cr,this.ngContentSelectors,g),Ln=T3(fi,Sr,di,Dn,on,[M3]),xb(rn,on,null)}finally{rb()}return new R1(this.componentType,Ln,gd(Cr,on),on,Cr)}finally{qn(r)}}},R1=class extends D1{constructor(c,g,p,b,r){super(),this.location=p,this._rootLView=b,this._tNode=r,this.previousInputValues=null,this.instance=g,this.hostView=this.changeDetectorRef=new su(b,void 0,!1),this.componentType=c}setInput(c,g){let p=this._tNode.inputs,b;if(p!==null&&(b=p[c])){if(this.previousInputValues??=new Map,this.previousInputValues.has(c)&&Object.is(this.previousInputValues.get(c),g))return;let r=this._rootLView;vb(r[An],r,b,c,g),this.previousInputValues.set(c,g);let A=Dl(this._tNode.index,r);bb(A)}}get injector(){return new eu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(c){this.hostView.onDestroy(c)}};function x3(l,c){let g=l[An],p=Il;return l[p]=c,xy(g,p,2,"#host",null)}function b3(l,c,g,p,b,r,A){let N=b[An];w3(p,l,c,A);let V=null;c!==null&&(V=db(c,b[sd]));let Y=r.rendererFactory.createRenderer(c,g),ve=16;g.signals?ve=4096:g.onPush&&(ve=64);let Pe=vy(b,HS(g),null,ve,b[l.index],l,r,Y,null,null,V);return N.firstCreatePass&&T1(N,l,p.length-1),by(b,Pe),b[l.index]=Pe}function w3(l,c,g,p){for(let b of l)c.mergedAttrs=W1(c.mergedAttrs,b.hostAttrs);c.mergedAttrs!==null&&(A1(c,c.mergedAttrs,!0),g!==null&&NS(p,g,c))}function T3(l,c,g,p,b,r){let A=Yo(),N=b[An],V=Xo(A,b);WS(N,b,A,g,null,p);for(let ve=0;ve<g.length;ve++){let Pe=A.directiveStart+ve,tt=ld(b,N,Pe,A);ou(tt,b)}ZS(N,b,A),V&&ou(V,b);let Y=ld(b,N,A.directiveStart+A.componentOffset,A);if(l[Ts]=b[Ts]=Y,r!==null)for(let ve of r)ve(Y,c);return US(N,A,b),Y}function E3(l,c,g,p){if(p)s1(l,g,["ng-version","17.3.12"]);else{let{attrs:b,classes:r}=Sk(c.selectors[0]);b&&s1(l,g,b),r&&r.length>0&&FS(l,g,r.join(" "))}}function I3(l,c,g){let p=l.projection=[];for(let b=0;b<c.length;b++){let r=g[b];p.push(r!=null?Array.from(r):null)}}function M3(){let l=Yo();sb(_r()[An],l)}var cu=(()=>{let c=class c{};c.__NG_ELEMENT_ID__=D3;let l=c;return l})();function D3(){let l=Yo();return l2(l,_r())}var C3=cu,a2=class extends C3{constructor(c,g,p){super(),this._lContainer=c,this._hostTNode=g,this._hostLView=p}get element(){return gd(this._hostTNode,this._hostLView)}get injector(){return new eu(this._hostTNode,this._hostLView)}get parentInjector(){let c=ab(this._hostTNode,this._hostLView);if(cS(c)){let g=ny(c,this._hostLView),p=ty(c),b=g[An].data[p+8];return new eu(b,g)}else return new eu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(c){let g=hC(this._lContainer);return g!==null&&g[c]||null}get length(){return this._lContainer.length-io}createEmbeddedView(c,g,p){let b,r;typeof p=="number"?b=p:p!=null&&(b=p.index,r=p.injector);let A=oC(this._lContainer,c.ssrId),N=c.createEmbeddedViewImpl(g||{},r,A);return this.insertImpl(N,b,iC(this._hostTNode,A)),N}createComponent(c,g,p,b,r){let A=c&&!Hk(c),N;if(A)N=g;else{let Ot=g||{};N=Ot.index,p=Ot.injector,b=Ot.projectableNodes,r=Ot.environmentInjector||Ot.ngModuleRef}let V=A?c:new kp(tu(c)),Y=p||this.parentInjector;if(!r&&V.ngModule==null){let Jt=(A?Y:this.parentInjector).get(Ui,null);Jt&&(r=Jt)}let ve=tu(V.componentType??{}),Pe=oC(this._lContainer,ve?.id??null),tt=Pe?.firstChild??null,rt=V.create(Y,b,tt,r);return this.insertImpl(rt.hostView,N,iC(this._hostTNode,Pe)),rt}insert(c,g){return this.insertImpl(c,g,!0)}insertImpl(c,g,p){let b=c._lView;if(tF(b)){let N=this.indexOf(c);if(N!==-1)this.detach(N);else{let V=b[ii],Y=new a2(V,V[Zo],V[ii]);Y.detach(Y.indexOf(c))}}let r=this._adjustIndex(g),A=this._lContainer;return XN(A,b,r,p),c.attachToViewContainerRef(),MC(e1(A),r,c),c}move(c,g){return this.insert(c,g)}indexOf(c){let g=hC(this._lContainer);return g!==null?g.indexOf(c):-1}remove(c){let g=this._adjustIndex(c,-1),p=b1(this._lContainer,g);p&&(Y_(e1(this._lContainer),g),OS(p[An],p))}detach(c){let g=this._adjustIndex(c,-1),p=b1(this._lContainer,g);return p&&Y_(e1(this._lContainer),g)!=null?new su(p):null}_adjustIndex(c,g=0){return c??this.length+g}};function hC(l){return l[J_]}function e1(l){return l[J_]||(l[J_]=[])}function l2(l,c){let g,p=c[l.index];return pa(p)?g=p:(g=XS(p,c,null,l),c[l.index]=g,by(c,g)),A3(g,c,l,p),new a2(g,l,c)}function S3(l,c){let g=l[hi],p=g.createComment(""),b=Xo(c,l),r=mb(g,b);return ry(g,r,p,hN(g,b),!1),p}var A3=O3,P3=()=>!1;function R3(l,c,g){return P3(l,c,g)}function O3(l,c,g,p){if(l[ru])return;let b;g.type&8?b=Ms(p):b=S3(c,g),l[ru]=b}var O1=class l{constructor(c){this.queryList=c,this.matches=null}clone(){return new l(this.queryList)}setDirty(){this.queryList.setDirty()}},L1=class l{constructor(c=[]){this.queries=c}createEmbeddedView(c){let g=c.queries;if(g!==null){let p=c.contentQueries!==null?c.contentQueries[0]:g.length,b=[];for(let r=0;r<p;r++){let A=g.getByIndex(r),N=this.queries[A.indexInDeclarationView];b.push(N.clone())}return new l(b)}return null}insertView(c){this.dirtyQueriesWithMatches(c)}detachView(c){this.dirtyQueriesWithMatches(c)}finishViewCreation(c){this.dirtyQueriesWithMatches(c)}dirtyQueriesWithMatches(c){for(let g=0;g<this.queries.length;g++)Ib(c,g).matches!==null&&this.queries[g].setDirty()}},k1=class{constructor(c,g,p=null){this.flags=g,this.read=p,typeof c=="string"?this.predicate=V3(c):this.predicate=c}},F1=class l{constructor(c=[]){this.queries=c}elementStart(c,g){for(let p=0;p<this.queries.length;p++)this.queries[p].elementStart(c,g)}elementEnd(c){for(let g=0;g<this.queries.length;g++)this.queries[g].elementEnd(c)}embeddedTView(c){let g=null;for(let p=0;p<this.length;p++){let b=g!==null?g.length:0,r=this.getByIndex(p).embeddedTView(c,b);r&&(r.indexInDeclarationView=p,g!==null?g.push(r):g=[r])}return g!==null?new l(g):null}template(c,g){for(let p=0;p<this.queries.length;p++)this.queries[p].template(c,g)}getByIndex(c){return this.queries[c]}get length(){return this.queries.length}track(c){this.queries.push(c)}},N1=class l{constructor(c,g=-1){this.metadata=c,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=g}elementStart(c,g){this.isApplyingToNode(g)&&this.matchTNode(c,g)}elementEnd(c){this._declarationNodeIndex===c.index&&(this._appliesToNextNode=!1)}template(c,g){this.elementStart(c,g)}embeddedTView(c,g){return this.isApplyingToNode(c)?(this.crossesNgTemplate=!0,this.addMatch(-c.index,g),new l(this.metadata)):null}isApplyingToNode(c){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let g=this._declarationNodeIndex,p=c.parent;for(;p!==null&&p.type&8&&p.index!==g;)p=p.parent;return g===(p!==null?p.index:-1)}return this._appliesToNextNode}matchTNode(c,g){let p=this.metadata.predicate;if(Array.isArray(p))for(let b=0;b<p.length;b++){let r=p[b];this.matchTNodeWithReadOption(c,g,L3(g,r)),this.matchTNodeWithReadOption(c,g,H_(g,c,r,!1,!1))}else p===cd?g.type&4&&this.matchTNodeWithReadOption(c,g,-1):this.matchTNodeWithReadOption(c,g,H_(g,c,p,!1,!1))}matchTNodeWithReadOption(c,g,p){if(p!==null){let b=this.metadata.read;if(b!==null)if(b===Cl||b===cu||b===cd&&g.type&4)this.addMatch(g.index,-2);else{let r=H_(g,c,b,!1,!1);r!==null&&this.addMatch(g.index,r)}else this.addMatch(g.index,p)}}addMatch(c,g){this.matches===null?this.matches=[c,g]:this.matches.push(c,g)}};function L3(l,c){let g=l.localNames;if(g!==null){for(let p=0;p<g.length;p+=2)if(g[p]===c)return g[p+1]}return null}function k3(l,c){return l.type&11?gd(l,c):l.type&4?wb(l,c):null}function F3(l,c,g,p){return g===-1?k3(c,l):g===-2?N3(l,c,p):ld(l,l[An],g,c)}function N3(l,c,g){if(g===Cl)return gd(c,l);if(g===cd)return wb(c,l);if(g===cu)return l2(c,l)}function c2(l,c,g,p){let b=c[ca].queries[p];if(b.matches===null){let r=l.data,A=g.matches,N=[];for(let V=0;A!==null&&V<A.length;V+=2){let Y=A[V];if(Y<0)N.push(null);else{let ve=r[Y];N.push(F3(c,ve,A[V+1],g.metadata.read))}}b.matches=N}return b.matches}function z1(l,c,g,p){let b=l.queries.getByIndex(g),r=b.matches;if(r!==null){let A=c2(l,c,b,g);for(let N=0;N<r.length;N+=2){let V=r[N];if(V>0)p.push(A[N/2]);else{let Y=r[N+1],ve=c[-V];for(let Pe=io;Pe<ve.length;Pe++){let tt=ve[Pe];tt[jp]===tt[ii]&&z1(tt[An],tt,Y,p)}if(ve[ad]!==null){let Pe=ve[ad];for(let tt=0;tt<Pe.length;tt++){let rt=Pe[tt];z1(rt[An],rt,Y,p)}}}}}return p}function z3(l,c){return l[ca].queries[c].queryList}function B3(l,c,g){let p=new y1((g&4)===4);return MN(l,c,p,p.destroy),(c[ca]??=new L1).queries.push(new O1(p))-1}function j3(l,c,g){let p=Ds();return p.firstCreatePass&&(U3(p,new k1(l,c,g),-1),(c&2)===2&&(p.staticViewQueries=!0)),B3(p,_r(),c)}function V3(l){return l.split(",").map(c=>c.trim())}function U3(l,c,g){l.queries===null&&(l.queries=new F1),l.queries.track(new N1(c,g))}function Ib(l,c){return l.queries.getByIndex(c)}function $3(l,c){let g=l[An],p=Ib(g,c);return p.crossesNgTemplate?z1(g,l,c,[]):c2(g,l,p,c)}var Ml=class{},Fp=class{};var B1=class extends Ml{constructor(c,g,p){super(),this._parent=g,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new sy(this);let b=LC(c);this._bootstrapComponents=SS(b.bootstrap),this._r3Injector=vS(c,g,[{provide:Ml,useValue:this},{provide:yd,useValue:this.componentFactoryResolver},...p],Di(c),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(c)}get injector(){return this._r3Injector}destroy(){let c=this._r3Injector;!c.destroyed&&c.destroy(),this.destroyCbs.forEach(g=>g()),this.destroyCbs=null}onDestroy(c){this.destroyCbs.push(c)}},j1=class extends Fp{constructor(c){super(),this.moduleType=c}create(c){return new B1(this.moduleType,c,[])}};var ay=class extends Ml{constructor(c){super(),this.componentFactoryResolver=new sy(this),this.instance=null;let g=new Cp([...c.providers,{provide:Ml,useValue:this},{provide:yd,useValue:this.componentFactoryResolver}],c.parent||Y1(),c.debugName,new Set(["environment"]));this.injector=g,c.runEnvironmentInitializers&&g.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(c){this.injector.onDestroy(c)}};function Mb(l,c,g=null){return new ay({providers:l,parent:c,debugName:g,runEnvironmentInitializers:!0}).injector}var uu=(()=>{let c=class c{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new ri(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let p=this.taskId++;return this.pendingTasks.add(p),p}remove(p){this.pendingTasks.delete(p),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})();function Db(l,c,g){let p=l[c];return Object.is(p,g)?!1:(l[c]=g,!0)}function G3(l){return(l.flags&32)===32}function H3(l,c,g,p,b,r,A,N,V){let Y=c.consts,ve=xy(c,l,4,A||null,ey(Y,N));qS(c,g,ve,ey(Y,V)),sb(c,ve);let Pe=ve.tView=yb(2,ve,p,b,r,c.directiveRegistry,c.pipeRegistry,null,c.schemas,Y,null);return c.queries!==null&&(c.queries.template(c,ve),Pe.queries=c.queries.embeddedTView(ve)),ve}function Ty(l,c,g,p,b,r,A,N){let V=_r(),Y=Ds(),ve=l+Il,Pe=Y.firstCreatePass?H3(ve,Y,V,c,g,p,b,r,A):Y.data[ve];Up(Pe,!1);let tt=q3(Y,V,Pe,l);ib()&&gb(Y,V,tt,Pe),ou(tt,V);let rt=XS(tt,V,tt,Pe);return V[ve]=rt,by(V,rt),R3(rt,Pe,V),K1(Pe)&&$S(Y,V,Pe),A!=null&&GS(V,Pe,N),Ty}var q3=W3;function W3(l,c,g,p){return ob(!0),c[hi].createComment("")}function Z3(l,c,g,p){return Db(l,eS(),g)?c+TC(g)+p:_d}function V_(l,c){return l<<17|c<<2}function au(l){return l>>17&32767}function X3(l){return(l&2)==2}function Y3(l,c){return l&131071|c<<17}function V1(l){return l|2}function ud(l){return(l&131068)>>2}function t1(l,c){return l&-131069|c<<2}function Q3(l){return(l&1)===1}function U1(l){return l|1}function K3(l,c,g,p,b,r){let A=r?c.classBindings:c.styleBindings,N=au(A),V=ud(A);l[p]=g;let Y=!1,ve;if(Array.isArray(g)){let Pe=g;ve=Pe[1],(ve===null||zp(Pe,ve)>0)&&(Y=!0)}else ve=g;if(b)if(V!==0){let tt=au(l[N+1]);l[p+1]=V_(tt,N),tt!==0&&(l[tt+1]=t1(l[tt+1],p)),l[N+1]=Y3(l[N+1],p)}else l[p+1]=V_(N,0),N!==0&&(l[N+1]=t1(l[N+1],p)),N=p;else l[p+1]=V_(V,0),N===0?N=p:l[V+1]=t1(l[V+1],p),V=p;Y&&(l[p+1]=V1(l[p+1])),dC(l,ve,p,!0),dC(l,ve,p,!1),J3(c,ve,l,p,r),A=V_(N,V),r?c.classBindings=A:c.styleBindings=A}function J3(l,c,g,p,b){let r=b?l.residualClasses:l.residualStyles;r!=null&&typeof c=="string"&&zp(r,c)>=0&&(g[p+1]=U1(g[p+1]))}function dC(l,c,g,p){let b=l[g+1],r=c===null,A=p?au(b):ud(b),N=!1;for(;A!==0&&(N===!1||r);){let V=l[A],Y=l[A+1];ez(V,c)&&(N=!0,l[A+1]=p?U1(Y):V1(Y)),A=p?au(Y):ud(Y)}N&&(l[g+1]=p?V1(b):U1(b))}function ez(l,c){return l===null||c==null||(Array.isArray(l)?l[1]:l)===c?!0:Array.isArray(l)&&typeof c=="string"?zp(l,c)>=0:!1}function Al(l,c,g){let p=_r(),b=eS();if(Db(p,b,c)){let r=Ds(),A=bF();AN(r,A,p,l,c,p[hi],g,!1)}return Al}function fC(l,c,g,p,b){let r=c.inputs,A=b?"class":"style";vb(l,g,r[A],A,p)}function $p(l,c,g){return tz(l,c,g,!1),$p}function tz(l,c,g,p){let b=_r(),r=Ds(),A=pF(2);if(r.firstUpdatePass&&rz(r,l,A,p),c!==_d&&Db(b,A,c)){let N=r.data[md()];lz(r,N,b,b[hi],l,b[A+1]=cz(c,g),p,A)}}function nz(l,c){return c>=l.expandoStartIndex}function rz(l,c,g,p){let b=l.data;if(b[g+1]===null){let r=b[md()],A=nz(l,g);uz(r,p)&&c===null&&!A&&(c=!1),c=iz(b,r,c,p),K3(b,r,c,g,A,p)}}function iz(l,c,g,p){let b=yF(l),r=p?c.residualClasses:c.residualStyles;if(b===null)(p?c.classBindings:c.styleBindings)===0&&(g=n1(null,l,c,g,p),g=Np(g,c.attrs,p),r=null);else{let A=c.directiveStylingLast;if(A===-1||l[A]!==b)if(g=n1(b,l,c,g,p),r===null){let V=oz(l,c,p);V!==void 0&&Array.isArray(V)&&(V=n1(null,l,c,V[1],p),V=Np(V,c.attrs,p),sz(l,c,p,V))}else r=az(l,c,p)}return r!==void 0&&(p?c.residualClasses=r:c.residualStyles=r),g}function oz(l,c,g){let p=g?c.classBindings:c.styleBindings;if(ud(p)!==0)return l[au(p)]}function sz(l,c,g,p){let b=g?c.classBindings:c.styleBindings;l[au(b)]=p}function az(l,c,g){let p,b=c.directiveEnd;for(let r=1+c.directiveStylingLast;r<b;r++){let A=l[r].hostAttrs;p=Np(p,A,g)}return Np(p,c.attrs,g)}function n1(l,c,g,p,b){let r=null,A=g.directiveEnd,N=g.directiveStylingLast;for(N===-1?N=g.directiveStart:N++;N<A&&(r=c[N],p=Np(p,r.hostAttrs,b),r!==l);)N++;return l!==null&&(g.directiveStylingLast=N),p}function Np(l,c,g){let p=g?1:2,b=-1;if(c!==null)for(let r=0;r<c.length;r++){let A=c[r];typeof A=="number"?b=A:b===p&&(Array.isArray(l)||(l=l===void 0?[]:["",l]),mk(l,A,g?!0:c[++r]))}return l===void 0?null:l}function lz(l,c,g,p,b,r,A,N){if(!(c.type&3))return;let V=l.data,Y=V[N+1],ve=Q3(Y)?pC(V,c,g,b,ud(Y),A):void 0;if(!ly(ve)){ly(r)||X3(Y)&&(r=pC(V,null,g,b,N,A));let Pe=WC(md(),g);yN(p,A,Pe,b,r)}}function pC(l,c,g,p,b,r){let A=c===null,N;for(;b>0;){let V=l[b],Y=Array.isArray(V),ve=Y?V[1]:V,Pe=ve===null,tt=g[b+1];tt===_d&&(tt=Pe?qo:void 0);let rt=Pe?Hx(tt,p):ve===p?tt:void 0;if(Y&&!ly(rt)&&(rt=Hx(V,p)),ly(rt)&&(N=rt,A))return N;let Ot=l[b+1];b=A?au(Ot):ud(Ot)}if(c!==null){let V=r?c.residualClasses:c.residualStyles;V!=null&&(N=Hx(V,p))}return N}function ly(l){return l!==void 0}function cz(l,c){return l==null||l===""||(typeof c=="string"?l=l+c:typeof l=="object"&&(l=Di(fb(l)))),l}function uz(l,c){return(l.flags&(c?8:16))!==0}function hz(l,c,g,p,b,r){let A=c.consts,N=ey(A,b),V=xy(c,l,2,p,N);return qS(c,g,V,ey(A,r)),V.attrs!==null&&A1(V,V.attrs,!1),V.mergedAttrs!==null&&A1(V,V.mergedAttrs,!0),c.queries!==null&&c.queries.elementStart(c,V),V}function Hr(l,c,g,p){let b=_r(),r=Ds(),A=Il+l,N=b[hi],V=r.firstCreatePass?hz(A,r,b,c,g,p):r.data[A],Y=dz(r,b,V,N,c,l);b[A]=Y;let ve=K1(V);return Up(V,!0),NS(N,Y,V),!G3(V)&&ib()&&gb(r,b,Y,V),oF()===0&&ou(Y,b),sF(),ve&&($S(r,b,V),US(r,V,b)),p!==null&&GS(b,V),Hr}function qr(){let l=Yo();JC()?dF():(l=l.parent,Up(l,!1));let c=l;cF(c)&&uF(),aF();let g=Ds();return g.firstCreatePass&&(sb(g,l),UC(l)&&g.queries.elementEnd(l)),c.classesWithoutHost!=null&&MF(c)&&fC(g,c,_r(),c.classesWithoutHost,!0),c.stylesWithoutHost!=null&&DF(c)&&fC(g,c,_r(),c.stylesWithoutHost,!1),qr}function Tr(l,c,g,p){return Hr(l,c,g,p),qr(),Tr}var dz=(l,c,g,p,b,r)=>(ob(!0),AS(p,b,wF()));var cy="en-US";var fz=cy;function pz(l){typeof l=="string"&&(fz=l.toLowerCase().replace(/_/g,"-"))}function ma(l,c,g,p){let b=_r(),r=Ds(),A=Yo();return gz(r,b,b[hi],A,l,c,p),ma}function mz(l,c,g,p){let b=l.cleanup;if(b!=null)for(let r=0;r<b.length-1;r+=2){let A=b[r];if(A===g&&b[r+1]===p){let N=c[Sp],V=b[r+2];return N.length>V?N[V]:null}typeof A=="string"&&(r+=2)}return null}function gz(l,c,g,p,b,r,A){let N=K1(p),Y=l.firstCreatePass&&KS(l),ve=c[Ts],Pe=QS(c),tt=!0;if(p.type&3||A){let Jt=Xo(p,c),qt=A?A(Jt):Jt,Ft=Pe.length,rn=A?Ln=>A(Ms(Ln[p.index])):p.index,on=null;if(!A&&N&&(on=mz(l,c,b,p.index)),on!==null){let Ln=on.__ngLastListenerFn__||on;Ln.__ngNextListenerFn__=r,on.__ngLastListenerFn__=r,tt=!1}else{r=gC(p,c,ve,r,!1);let Ln=g.listen(qt,b,r);Pe.push(r,Ln),Y&&Y.push(b,rn,Ft,Ft+1)}}else r=gC(p,c,ve,r,!1);let rt=p.outputs,Ot;if(tt&&rt!==null&&(Ot=rt[b])){let Jt=Ot.length;if(Jt)for(let qt=0;qt<Jt;qt+=2){let Ft=Ot[qt],rn=Ot[qt+1],Cr=c[Ft][rn].subscribe(r),Sr=Pe.length;Pe.push(r,Cr),Y&&Y.push(b,p.index,Sr,-(Sr+1))}}}function mC(l,c,g,p){let b=qn(null);try{return xs(6,c,g),g(p)!==!1}catch(r){return JS(l,r),!1}finally{xs(7,c,g),qn(b)}}function gC(l,c,g,p,b){return function r(A){if(A===Function)return p;let N=l.componentOffset>-1?Dl(l.index,c):c;bb(N);let V=mC(c,g,p,A),Y=r.__ngNextListenerFn__;for(;Y;)V=mC(c,g,Y,A)&&V,Y=Y.__ngNextListenerFn__;return b&&V===!1&&A.preventDefault(),V}}function Cb(l=1){return xF(l)}function u2(l,c,g){j3(l,c,g)}function Sb(l){let c=_r(),g=Ds(),p=tS();tb(p+1);let b=Ib(g,p);if(l.dirty&&eF(c)===((b.metadata.flags&2)===2)){if(b.matches===null)l.reset([]);else{let r=$3(c,p);l.reset(r,jF),l.notifyOnChanges()}return!0}return!1}function Ab(){return z3(_r(),tS())}function Gp(l,c=""){let g=_r(),p=Ds(),b=l+Il,r=p.firstCreatePass?xy(p,b,1,c,null):p.data[b],A=_z(p,g,r,c,l);g[b]=A,ib()&&gb(p,g,A,r),Up(r,!1)}var _z=(l,c,g,p,b)=>(ob(!0),JF(c[hi],p));function Pb(l){return Ey("",l,""),Pb}function Ey(l,c,g){let p=_r(),b=Z3(p,l,c,g);return b!==_d&&GN(p,md(),b),Ey}var yz=(()=>{let c=class c{constructor(p){this._injector=p,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(p){if(!p.standalone)return null;if(!this.cachedInjectors.has(p)){let b=NC(!1,p.type),r=b.length>0?Mb([b],this._injector,`Standalone[${p.type.name}]`):null;this.cachedInjectors.set(p,r)}return this.cachedInjectors.get(p)}ngOnDestroy(){try{for(let p of this.cachedInjectors.values())p!==null&&p.destroy()}finally{this.cachedInjectors.clear()}}};c.\u0275prov=Xt({token:c,providedIn:"environment",factory:()=>new c(bn(Ui))});let l=c;return l})();function Eo(l){Tb("NgStandalone"),l.getStandaloneInjector=c=>c.get(yz).getOrCreateStandaloneInjector(l)}var Iy=(()=>{let c=class c{log(p){console.log(p)}warn(p){console.warn(p)}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"platform"});let l=c;return l})();var h2=new yn("");function Hp(l){return!!l&&typeof l.then=="function"}function d2(l){return!!l&&typeof l.subscribe=="function"}var f2=new yn(""),p2=(()=>{let c=class c{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((p,b)=>{this.resolve=p,this.reject=b}),this.appInits=bt(f2,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let p=[];for(let r of this.appInits){let A=r();if(Hp(A))p.push(A);else if(d2(A)){let N=new Promise((V,Y)=>{A.subscribe({complete:V,error:Y})});p.push(N)}}let b=()=>{this.done=!0,this.resolve()};Promise.all(p).then(()=>{b()}).catch(r=>{this.reject(r)}),p.length===0&&b(),this.initialized=!0}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})(),My=new yn("");function vz(){aD(()=>{throw new un(600,!1)})}function xz(l){return l.isBoundToModule}function bz(l,c,g){try{let p=g();return Hp(p)?p.catch(b=>{throw c.runOutsideAngular(()=>l.handleError(b)),b}):p}catch(p){throw c.runOutsideAngular(()=>l.handleError(p)),p}}var vd=(()=>{let c=class c{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=bt(xS),this.afterRenderEffectManager=bt(s2),this.externalTestViews=new Set,this.beforeRender=new Mi,this.afterTick=new Mi,this.componentTypes=[],this.components=[],this.isStable=bt(uu).hasPendingTasks.pipe(Mn(p=>!p)),this._injector=bt(Ui)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(p,b){let r=p instanceof oy;if(!this._injector.get(p2).done){let rt=!r&&OC(p),Ot=!1;throw new un(405,Ot)}let N;r?N=p:N=this._injector.get(yd).resolveComponentFactory(p),this.componentTypes.push(N.componentType);let V=xz(N)?void 0:this._injector.get(Ml),Y=b||N.selector,ve=N.create(lu.NULL,[],Y,V),Pe=ve.location.nativeElement,tt=ve.injector.get(h2,null);return tt?.registerApplication(Pe),ve.onDestroy(()=>{this.detachView(ve.hostView),r1(this.components,ve),tt?.unregisterApplication(Pe)}),this._loadComponent(ve),ve}tick(){this._tick(!0)}_tick(p){if(this._runningTick)throw new un(101,!1);let b=qn(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(p)}catch(r){this.internalErrorHandler(r)}finally{this.afterTick.next(),this._runningTick=!1,qn(b)}}detectChangesInAttachedViews(p){let b=0,r=this.afterRenderEffectManager;for(;;){if(b===t2)throw new un(103,!1);if(p){let A=b===0;this.beforeRender.next(A);for(let{_lView:N,notifyErrorHandler:V}of this._views)wz(N,A,V)}if(b++,r.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:A})=>$1(A))&&(r.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:A})=>$1(A))))break}}attachView(p){let b=p;this._views.push(b),b.attachToAppRef(this)}detachView(p){let b=p;r1(this._views,b),b.detachFromAppRef()}_loadComponent(p){this.attachView(p.hostView),this.tick(),this.components.push(p);let b=this._injector.get(My,[]);[...this._bootstrapListeners,...b].forEach(r=>r(p))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(p=>p()),this._views.slice().forEach(p=>p.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(p){return this._destroyListeners.push(p),()=>r1(this._destroyListeners,p)}destroy(){if(this._destroyed)throw new un(406,!1);let p=this._injector;p.destroy&&!p.destroyed&&p.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})();function r1(l,c){let g=l.indexOf(c);g>-1&&l.splice(g,1)}function wz(l,c,g){!c&&!$1(l)||Tz(l,g,c)}function $1(l){return eb(l)}function Tz(l,c,g){let p;g?(p=0,l[nn]|=1024):l[nn]&64?p=0:p=1,n2(l,c,p)}var G1=class{constructor(c,g){this.ngModuleFactory=c,this.componentFactories=g}},Rb=(()=>{let c=class c{compileModuleSync(p){return new j1(p)}compileModuleAsync(p){return Promise.resolve(this.compileModuleSync(p))}compileModuleAndAllComponentsSync(p){let b=this.compileModuleSync(p),r=LC(p),A=SS(r.declarations).reduce((N,V)=>{let Y=tu(V);return Y&&N.push(new kp(Y)),N},[]);return new G1(b,A)}compileModuleAndAllComponentsAsync(p){return Promise.resolve(this.compileModuleAndAllComponentsSync(p))}clearCache(){}clearCacheFor(p){}getModuleId(p){}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})();var Ez=(()=>{let c=class c{constructor(){this.zone=bt(wr),this.applicationRef=bt(vd)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})();function Iz(l){return[{provide:wr,useFactory:l},{provide:od,multi:!0,useFactory:()=>{let c=bt(Ez,{optional:!0});return()=>c.initialize()}},{provide:od,multi:!0,useFactory:()=>{let c=bt(Sz);return()=>{c.initialize()}}},{provide:xS,useFactory:Mz}]}function Mz(){let l=bt(wr),c=bt(ua);return g=>l.runOutsideAngular(()=>c.handleError(g))}function Dz(l){let c=Iz(()=>new wr(Cz(l)));return fd([[],c])}function Cz(l){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:l?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:l?.runCoalescing??!1}}var Sz=(()=>{let c=class c{constructor(){this.subscription=new $r,this.initialized=!1,this.zone=bt(wr),this.pendingTasks=bt(uu)}initialize(){if(this.initialized)return;this.initialized=!0;let p=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(p=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{wr.assertNotInAngularZone(),queueMicrotask(()=>{p!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(p),p=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{wr.assertInAngularZone(),p??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})();function Az(){return typeof $localize<"u"&&$localize.locale||cy}var Ob=new yn("",{providedIn:"root",factory:()=>bt(Ob,Sn.Optional|Sn.SkipSelf)||Az()});var m2=new yn("");var W_=null;function Pz(l=[],c){return lu.create({name:c,providers:[{provide:py,useValue:"platform"},{provide:m2,useValue:new Set([()=>W_=null])},...l]})}function Rz(l=[]){if(W_)return W_;let c=Pz(l);return W_=c,vz(),Oz(c),c}function Oz(l){l.get(ub,null)?.forEach(g=>g())}var qp=(()=>{let c=class c{};c.__NG_ELEMENT_ID__=Lz;let l=c;return l})();function Lz(l){return kz(Yo(),_r(),(l&16)===16)}function kz(l,c,g){if(gy(l)&&!g){let p=Dl(l.index,c);return new su(p,p)}else if(l.type&47){let p=c[Is];return new su(p,c)}return null}function g2(l){try{let{rootComponent:c,appProviders:g,platformProviders:p}=l,b=Rz(p),r=[Dz(),...g||[]],N=new ay({providers:r,parent:b,debugName:"",runEnvironmentInitializers:!1}).injector,V=N.get(wr);return V.run(()=>{N.resolveInjectorInitializers();let Y=N.get(ua,null),ve;V.runOutsideAngular(()=>{ve=V.onError.subscribe({next:rt=>{Y.handleError(rt)}})});let Pe=()=>N.destroy(),tt=b.get(m2);return tt.add(Pe),N.onDestroy(()=>{ve.unsubscribe(),tt.delete(Pe)}),bz(Y,V,()=>{let rt=N.get(p2);return rt.runInitializers(),rt.donePromise.then(()=>{let Ot=N.get(Ob,cy);pz(Ot||cy);let Jt=N.get(vd);return c!==void 0&&Jt.bootstrap(c),Jt})})})}catch(c){return Promise.reject(c)}}var w2=null;function xd(){return w2}function T2(l){w2??=l}var Dy=class{};var $i=new yn(""),E2=(()=>{let c=class c{historyGo(p){throw new Error("")}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:()=>bt(Bz),providedIn:"platform"});let l=c;return l})();var Bz=(()=>{let c=class c extends E2{constructor(){super(),this._doc=bt($i),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return xd().getBaseHref(this._doc)}onPopState(p){let b=xd().getGlobalEventTarget(this._doc,"window");return b.addEventListener("popstate",p,!1),()=>b.removeEventListener("popstate",p)}onHashChange(p){let b=xd().getGlobalEventTarget(this._doc,"window");return b.addEventListener("hashchange",p,!1),()=>b.removeEventListener("hashchange",p)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(p){this._location.pathname=p}pushState(p,b,r){this._history.pushState(p,b,r)}replaceState(p,b,r){this._history.replaceState(p,b,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(p=0){this._history.go(p)}getState(){return this._history.state}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:()=>new c,providedIn:"platform"});let l=c;return l})();function I2(l,c){if(l.length==0)return c;if(c.length==0)return l;let g=0;return l.endsWith("/")&&g++,c.startsWith("/")&&g++,g==2?l+c.substring(1):g==1?l+c:l+"/"+c}function _2(l){let c=l.match(/#|\?|$/),g=c&&c.index||l.length,p=g-(l[g-1]==="/"?1:0);return l.slice(0,p)+l.slice(g)}function hu(l){return l&&l[0]!=="?"?"?"+l:l}var Cy=(()=>{let c=class c{historyGo(p){throw new Error("")}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:()=>bt(M2),providedIn:"root"});let l=c;return l})(),jz=new yn(""),M2=(()=>{let c=class c extends Cy{constructor(p,b){super(),this._platformLocation=p,this._removeListenerFns=[],this._baseHref=b??this._platformLocation.getBaseHrefFromDOM()??bt($i).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(p){this._removeListenerFns.push(this._platformLocation.onPopState(p),this._platformLocation.onHashChange(p))}getBaseHref(){return this._baseHref}prepareExternalUrl(p){return I2(this._baseHref,p)}path(p=!1){let b=this._platformLocation.pathname+hu(this._platformLocation.search),r=this._platformLocation.hash;return r&&p?`${b}${r}`:b}pushState(p,b,r,A){let N=this.prepareExternalUrl(r+hu(A));this._platformLocation.pushState(p,b,N)}replaceState(p,b,r,A){let N=this.prepareExternalUrl(r+hu(A));this._platformLocation.replaceState(p,b,N)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(p=0){this._platformLocation.historyGo?.(p)}};c.\u0275fac=function(b){return new(b||c)(bn(E2),bn(jz,8))},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})();var Wp=(()=>{let c=class c{constructor(p){this._subject=new wo,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=p;let b=this._locationStrategy.getBaseHref();this._basePath=$z(_2(y2(b))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(p=!1){return this.normalize(this._locationStrategy.path(p))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(p,b=""){return this.path()==this.normalize(p+hu(b))}normalize(p){return c.stripTrailingSlash(Uz(this._basePath,y2(p)))}prepareExternalUrl(p){return p&&p[0]!=="/"&&(p="/"+p),this._locationStrategy.prepareExternalUrl(p)}go(p,b="",r=null){this._locationStrategy.pushState(r,"",p,b),this._notifyUrlChangeListeners(this.prepareExternalUrl(p+hu(b)),r)}replaceState(p,b="",r=null){this._locationStrategy.replaceState(r,"",p,b),this._notifyUrlChangeListeners(this.prepareExternalUrl(p+hu(b)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(p=0){this._locationStrategy.historyGo?.(p)}onUrlChange(p){return this._urlChangeListeners.push(p),this._urlChangeSubscription??=this.subscribe(b=>{this._notifyUrlChangeListeners(b.url,b.state)}),()=>{let b=this._urlChangeListeners.indexOf(p);this._urlChangeListeners.splice(b,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(p="",b){this._urlChangeListeners.forEach(r=>r(p,b))}subscribe(p,b,r){return this._subject.subscribe({next:p,error:b,complete:r})}};c.normalizeQueryParams=hu,c.joinWithSlash=I2,c.stripTrailingSlash=_2,c.\u0275fac=function(b){return new(b||c)(bn(Cy))},c.\u0275prov=Xt({token:c,factory:()=>Vz(),providedIn:"root"});let l=c;return l})();function Vz(){return new Wp(bn(Cy))}function Uz(l,c){if(!l||!c.startsWith(l))return c;let g=c.substring(l.length);return g===""||["/",";","?","#"].includes(g[0])?g:c}function y2(l){return l.replace(/\/index.html$/,"")}function $z(l){if(new RegExp("^(https?:)?//").test(l)){let[,g]=l.split(/\/\/[^\/]+/);return g}return l}function Sy(l,c){c=encodeURIComponent(c);for(let g of l.split(";")){let p=g.indexOf("="),[b,r]=p==-1?[g,""]:[g.slice(0,p),g.slice(p+1)];if(b.trim()===c)return decodeURIComponent(r)}return null}var Lb=/\s+/,v2=[],D2=(()=>{let c=class c{constructor(p,b){this._ngEl=p,this._renderer=b,this.initialClasses=v2,this.stateMap=new Map}set klass(p){this.initialClasses=p!=null?p.trim().split(Lb):v2}set ngClass(p){this.rawClass=typeof p=="string"?p.trim().split(Lb):p}ngDoCheck(){for(let b of this.initialClasses)this._updateState(b,!0);let p=this.rawClass;if(Array.isArray(p)||p instanceof Set)for(let b of p)this._updateState(b,!0);else if(p!=null)for(let b of Object.keys(p))this._updateState(b,!!p[b]);this._applyStateDiff()}_updateState(p,b){let r=this.stateMap.get(p);r!==void 0?(r.enabled!==b&&(r.changed=!0,r.enabled=b),r.touched=!0):this.stateMap.set(p,{enabled:b,changed:!0,touched:!0})}_applyStateDiff(){for(let p of this.stateMap){let b=p[0],r=p[1];r.changed?(this._toggleClass(b,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(b,!1),this.stateMap.delete(b)),r.touched=!1}}_toggleClass(p,b){p=p.trim(),p.length>0&&p.split(Lb).forEach(r=>{b?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}};c.\u0275fac=function(b){return new(b||c)(Ci(Cl),Ci(wy))},c.\u0275dir=Bp({type:c,selectors:[["","ngClass",""]],inputs:{klass:[la.None,"class","klass"],ngClass:"ngClass"},standalone:!0});let l=c;return l})();var C2=(()=>{let c=class c{constructor(p,b){this._viewContainer=p,this._context=new kb,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=b}set ngIf(p){this._context.$implicit=this._context.ngIf=p,this._updateView()}set ngIfThen(p){x2("ngIfThen",p),this._thenTemplateRef=p,this._thenViewRef=null,this._updateView()}set ngIfElse(p){x2("ngIfElse",p),this._elseTemplateRef=p,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(p,b){return!0}};c.\u0275fac=function(b){return new(b||c)(Ci(cu),Ci(cd))},c.\u0275dir=Bp({type:c,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let l=c;return l})(),kb=class{constructor(){this.$implicit=null,this.ngIf=null}};function x2(l,c){if(!!!(!c||c.createEmbeddedView))throw new Error(`${l} must be a TemplateRef, but received '${Di(c)}'.`)}var du=(()=>{let c=class c{};c.\u0275fac=function(b){return new(b||c)},c.\u0275mod=dd({type:c}),c.\u0275inj=hd({});let l=c;return l})(),S2="browser",Gz="server";function Ay(l){return l===Gz}var bd=class{};var Xp=class{},Ry=class{},fu=class l{constructor(c){this.normalizedNames=new Map,this.lazyUpdate=null,c?typeof c=="string"?this.lazyInit=()=>{this.headers=new Map,c.split(`
`).forEach(g=>{let p=g.indexOf(":");if(p>0){let b=g.slice(0,p),r=b.toLowerCase(),A=g.slice(p+1).trim();this.maybeSetNormalizedName(b,r),this.headers.has(r)?this.headers.get(r).push(A):this.headers.set(r,[A])}})}:typeof Headers<"u"&&c instanceof Headers?(this.headers=new Map,c.forEach((g,p)=>{this.setHeaderEntries(p,g)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(c).forEach(([g,p])=>{this.setHeaderEntries(g,p)})}:this.headers=new Map}has(c){return this.init(),this.headers.has(c.toLowerCase())}get(c){this.init();let g=this.headers.get(c.toLowerCase());return g&&g.length>0?g[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(c){return this.init(),this.headers.get(c.toLowerCase())||null}append(c,g){return this.clone({name:c,value:g,op:"a"})}set(c,g){return this.clone({name:c,value:g,op:"s"})}delete(c,g){return this.clone({name:c,value:g,op:"d"})}maybeSetNormalizedName(c,g){this.normalizedNames.has(g)||this.normalizedNames.set(g,c)}init(){this.lazyInit&&(this.lazyInit instanceof l?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(c=>this.applyUpdate(c)),this.lazyUpdate=null))}copyFrom(c){c.init(),Array.from(c.headers.keys()).forEach(g=>{this.headers.set(g,c.headers.get(g)),this.normalizedNames.set(g,c.normalizedNames.get(g))})}clone(c){let g=new l;return g.lazyInit=this.lazyInit&&this.lazyInit instanceof l?this.lazyInit:this,g.lazyUpdate=(this.lazyUpdate||[]).concat([c]),g}applyUpdate(c){let g=c.name.toLowerCase();switch(c.op){case"a":case"s":let p=c.value;if(typeof p=="string"&&(p=[p]),p.length===0)return;this.maybeSetNormalizedName(c.name,g);let b=(c.op==="a"?this.headers.get(g):void 0)||[];b.push(...p),this.headers.set(g,b);break;case"d":let r=c.value;if(!r)this.headers.delete(g),this.normalizedNames.delete(g);else{let A=this.headers.get(g);if(!A)return;A=A.filter(N=>r.indexOf(N)===-1),A.length===0?(this.headers.delete(g),this.normalizedNames.delete(g)):this.headers.set(g,A)}break}}setHeaderEntries(c,g){let p=(Array.isArray(g)?g:[g]).map(r=>r.toString()),b=c.toLowerCase();this.headers.set(b,p),this.maybeSetNormalizedName(c,b)}forEach(c){this.init(),Array.from(this.normalizedNames.keys()).forEach(g=>c(this.normalizedNames.get(g),this.headers.get(g)))}};var zb=class{encodeKey(c){return A2(c)}encodeValue(c){return A2(c)}decodeKey(c){return decodeURIComponent(c)}decodeValue(c){return decodeURIComponent(c)}};function Wz(l,c){let g=new Map;return l.length>0&&l.replace(/^\?/,"").split("&").forEach(b=>{let r=b.indexOf("="),[A,N]=r==-1?[c.decodeKey(b),""]:[c.decodeKey(b.slice(0,r)),c.decodeValue(b.slice(r+1))],V=g.get(A)||[];V.push(N),g.set(A,V)}),g}var Zz=/%(\d[a-f0-9])/gi,Xz={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function A2(l){return encodeURIComponent(l).replace(Zz,(c,g)=>Xz[g]??c)}function Py(l){return`${l}`}var Pl=class l{constructor(c={}){if(this.updates=null,this.cloneFrom=null,this.encoder=c.encoder||new zb,c.fromString){if(c.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=Wz(c.fromString,this.encoder)}else c.fromObject?(this.map=new Map,Object.keys(c.fromObject).forEach(g=>{let p=c.fromObject[g],b=Array.isArray(p)?p.map(Py):[Py(p)];this.map.set(g,b)})):this.map=null}has(c){return this.init(),this.map.has(c)}get(c){this.init();let g=this.map.get(c);return g?g[0]:null}getAll(c){return this.init(),this.map.get(c)||null}keys(){return this.init(),Array.from(this.map.keys())}append(c,g){return this.clone({param:c,value:g,op:"a"})}appendAll(c){let g=[];return Object.keys(c).forEach(p=>{let b=c[p];Array.isArray(b)?b.forEach(r=>{g.push({param:p,value:r,op:"a"})}):g.push({param:p,value:b,op:"a"})}),this.clone(g)}set(c,g){return this.clone({param:c,value:g,op:"s"})}delete(c,g){return this.clone({param:c,value:g,op:"d"})}toString(){return this.init(),this.keys().map(c=>{let g=this.encoder.encodeKey(c);return this.map.get(c).map(p=>g+"="+this.encoder.encodeValue(p)).join("&")}).filter(c=>c!=="").join("&")}clone(c){let g=new l({encoder:this.encoder});return g.cloneFrom=this.cloneFrom||this,g.updates=(this.updates||[]).concat(c),g}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(c=>this.map.set(c,this.cloneFrom.map.get(c))),this.updates.forEach(c=>{switch(c.op){case"a":case"s":let g=(c.op==="a"?this.map.get(c.param):void 0)||[];g.push(Py(c.value)),this.map.set(c.param,g);break;case"d":if(c.value!==void 0){let p=this.map.get(c.param)||[],b=p.indexOf(Py(c.value));b!==-1&&p.splice(b,1),p.length>0?this.map.set(c.param,p):this.map.delete(c.param)}else{this.map.delete(c.param);break}}}),this.cloneFrom=this.updates=null)}};var Bb=class{constructor(){this.map=new Map}set(c,g){return this.map.set(c,g),this}get(c){return this.map.has(c)||this.map.set(c,c.defaultValue()),this.map.get(c)}delete(c){return this.map.delete(c),this}has(c){return this.map.has(c)}keys(){return this.map.keys()}};function Yz(l){switch(l){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function P2(l){return typeof ArrayBuffer<"u"&&l instanceof ArrayBuffer}function R2(l){return typeof Blob<"u"&&l instanceof Blob}function O2(l){return typeof FormData<"u"&&l instanceof FormData}function Qz(l){return typeof URLSearchParams<"u"&&l instanceof URLSearchParams}var Zp=class l{constructor(c,g,p,b){this.url=g,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=c.toUpperCase();let r;if(Yz(this.method)||b?(this.body=p!==void 0?p:null,r=b):r=p,r&&(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.context&&(this.context=r.context),r.params&&(this.params=r.params),this.transferCache=r.transferCache),this.headers??=new fu,this.context??=new Bb,!this.params)this.params=new Pl,this.urlWithParams=g;else{let A=this.params.toString();if(A.length===0)this.urlWithParams=g;else{let N=g.indexOf("?"),V=N===-1?"?":N<g.length-1?"&":"";this.urlWithParams=g+V+A}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||P2(this.body)||R2(this.body)||O2(this.body)||Qz(this.body)?this.body:this.body instanceof Pl?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||O2(this.body)?null:R2(this.body)?this.body.type||null:P2(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof Pl?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(c={}){let g=c.method||this.method,p=c.url||this.url,b=c.responseType||this.responseType,r=c.transferCache??this.transferCache,A=c.body!==void 0?c.body:this.body,N=c.withCredentials??this.withCredentials,V=c.reportProgress??this.reportProgress,Y=c.headers||this.headers,ve=c.params||this.params,Pe=c.context??this.context;return c.setHeaders!==void 0&&(Y=Object.keys(c.setHeaders).reduce((tt,rt)=>tt.set(rt,c.setHeaders[rt]),Y)),c.setParams&&(ve=Object.keys(c.setParams).reduce((tt,rt)=>tt.set(rt,c.setParams[rt]),ve)),new l(g,p,A,{params:ve,headers:Y,context:Pe,reportProgress:V,responseType:b,withCredentials:N,transferCache:r})}},wd=function(l){return l[l.Sent=0]="Sent",l[l.UploadProgress=1]="UploadProgress",l[l.ResponseHeader=2]="ResponseHeader",l[l.DownloadProgress=3]="DownloadProgress",l[l.Response=4]="Response",l[l.User=5]="User",l}(wd||{}),Yp=class{constructor(c,g=ky.Ok,p="OK"){this.headers=c.headers||new fu,this.status=c.status!==void 0?c.status:g,this.statusText=c.statusText||p,this.url=c.url||null,this.ok=this.status>=200&&this.status<300}},jb=class l extends Yp{constructor(c={}){super(c),this.type=wd.ResponseHeader}clone(c={}){return new l({headers:c.headers||this.headers,status:c.status!==void 0?c.status:this.status,statusText:c.statusText||this.statusText,url:c.url||this.url||void 0})}},Oy=class l extends Yp{constructor(c={}){super(c),this.type=wd.Response,this.body=c.body!==void 0?c.body:null}clone(c={}){return new l({body:c.body!==void 0?c.body:this.body,headers:c.headers||this.headers,status:c.status!==void 0?c.status:this.status,statusText:c.statusText||this.statusText,url:c.url||this.url||void 0})}},Ly=class extends Yp{constructor(c){super(c,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${c.url||"(unknown url)"}`:this.message=`Http failure response for ${c.url||"(unknown url)"}: ${c.status} ${c.statusText}`,this.error=c.error||null}},ky=function(l){return l[l.Continue=100]="Continue",l[l.SwitchingProtocols=101]="SwitchingProtocols",l[l.Processing=102]="Processing",l[l.EarlyHints=103]="EarlyHints",l[l.Ok=200]="Ok",l[l.Created=201]="Created",l[l.Accepted=202]="Accepted",l[l.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",l[l.NoContent=204]="NoContent",l[l.ResetContent=205]="ResetContent",l[l.PartialContent=206]="PartialContent",l[l.MultiStatus=207]="MultiStatus",l[l.AlreadyReported=208]="AlreadyReported",l[l.ImUsed=226]="ImUsed",l[l.MultipleChoices=300]="MultipleChoices",l[l.MovedPermanently=301]="MovedPermanently",l[l.Found=302]="Found",l[l.SeeOther=303]="SeeOther",l[l.NotModified=304]="NotModified",l[l.UseProxy=305]="UseProxy",l[l.Unused=306]="Unused",l[l.TemporaryRedirect=307]="TemporaryRedirect",l[l.PermanentRedirect=308]="PermanentRedirect",l[l.BadRequest=400]="BadRequest",l[l.Unauthorized=401]="Unauthorized",l[l.PaymentRequired=402]="PaymentRequired",l[l.Forbidden=403]="Forbidden",l[l.NotFound=404]="NotFound",l[l.MethodNotAllowed=405]="MethodNotAllowed",l[l.NotAcceptable=406]="NotAcceptable",l[l.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",l[l.RequestTimeout=408]="RequestTimeout",l[l.Conflict=409]="Conflict",l[l.Gone=410]="Gone",l[l.LengthRequired=411]="LengthRequired",l[l.PreconditionFailed=412]="PreconditionFailed",l[l.PayloadTooLarge=413]="PayloadTooLarge",l[l.UriTooLong=414]="UriTooLong",l[l.UnsupportedMediaType=415]="UnsupportedMediaType",l[l.RangeNotSatisfiable=416]="RangeNotSatisfiable",l[l.ExpectationFailed=417]="ExpectationFailed",l[l.ImATeapot=418]="ImATeapot",l[l.MisdirectedRequest=421]="MisdirectedRequest",l[l.UnprocessableEntity=422]="UnprocessableEntity",l[l.Locked=423]="Locked",l[l.FailedDependency=424]="FailedDependency",l[l.TooEarly=425]="TooEarly",l[l.UpgradeRequired=426]="UpgradeRequired",l[l.PreconditionRequired=428]="PreconditionRequired",l[l.TooManyRequests=429]="TooManyRequests",l[l.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",l[l.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",l[l.InternalServerError=500]="InternalServerError",l[l.NotImplemented=501]="NotImplemented",l[l.BadGateway=502]="BadGateway",l[l.ServiceUnavailable=503]="ServiceUnavailable",l[l.GatewayTimeout=504]="GatewayTimeout",l[l.HttpVersionNotSupported=505]="HttpVersionNotSupported",l[l.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",l[l.InsufficientStorage=507]="InsufficientStorage",l[l.LoopDetected=508]="LoopDetected",l[l.NotExtended=510]="NotExtended",l[l.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",l}(ky||{});function Nb(l,c){return{body:c,headers:l.headers,context:l.context,observe:l.observe,params:l.params,reportProgress:l.reportProgress,responseType:l.responseType,withCredentials:l.withCredentials,transferCache:l.transferCache}}var Kz=(()=>{let c=class c{constructor(p){this.handler=p}request(p,b,r={}){let A;if(p instanceof Zp)A=p;else{let Y;r.headers instanceof fu?Y=r.headers:Y=new fu(r.headers);let ve;r.params&&(r.params instanceof Pl?ve=r.params:ve=new Pl({fromObject:r.params})),A=new Zp(p,b,r.body!==void 0?r.body:null,{headers:Y,context:r.context,params:ve,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache})}let N=fn(A).pipe(xl(Y=>this.handler.handle(Y)));if(p instanceof Zp||r.observe==="events")return N;let V=N.pipe(no(Y=>Y instanceof Oy));switch(r.observe||"body"){case"body":switch(A.responseType){case"arraybuffer":return V.pipe(Mn(Y=>{if(Y.body!==null&&!(Y.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return Y.body}));case"blob":return V.pipe(Mn(Y=>{if(Y.body!==null&&!(Y.body instanceof Blob))throw new Error("Response is not a Blob.");return Y.body}));case"text":return V.pipe(Mn(Y=>{if(Y.body!==null&&typeof Y.body!="string")throw new Error("Response is not a string.");return Y.body}));case"json":default:return V.pipe(Mn(Y=>Y.body))}case"response":return V;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(p,b={}){return this.request("DELETE",p,b)}get(p,b={}){return this.request("GET",p,b)}head(p,b={}){return this.request("HEAD",p,b)}jsonp(p,b){return this.request("JSONP",p,{params:new Pl().append(b,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(p,b={}){return this.request("OPTIONS",p,b)}patch(p,b,r={}){return this.request("PATCH",p,Nb(r,b))}post(p,b,r={}){return this.request("POST",p,Nb(r,b))}put(p,b,r={}){return this.request("PUT",p,Nb(r,b))}};c.\u0275fac=function(b){return new(b||c)(bn(Xp))},c.\u0275prov=Xt({token:c,factory:c.\u0275fac});let l=c;return l})();function N2(l,c){return c(l)}function Jz(l,c){return(g,p)=>c.intercept(g,{handle:b=>l(b,p)})}function eB(l,c,g){return(p,b)=>da(g,()=>c(p,r=>l(r,b)))}var tB=new yn(""),Vb=new yn(""),nB=new yn(""),rB=new yn("");function iB(){let l=null;return(c,g)=>{l===null&&(l=(bt(tB,{optional:!0})??[]).reduceRight(Jz,N2));let p=bt(uu),b=p.add();return l(c,g).pipe(wl(()=>p.remove(b)))}}var L2=(()=>{let c=class c extends Xp{constructor(p,b){super(),this.backend=p,this.injector=b,this.chain=null,this.pendingTasks=bt(uu);let r=bt(rB,{optional:!0});this.backend=r??p}handle(p){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(Vb),...this.injector.get(nB,[])]));this.chain=r.reduceRight((A,N)=>eB(A,N,this.injector),N2)}let b=this.pendingTasks.add();return this.chain(p,r=>this.backend.handle(r)).pipe(wl(()=>this.pendingTasks.remove(b)))}};c.\u0275fac=function(b){return new(b||c)(bn(Ry),bn(Ui))},c.\u0275prov=Xt({token:c,factory:c.\u0275fac});let l=c;return l})();var oB=/^\)\]\}',?\n/;function sB(l){return"responseURL"in l&&l.responseURL?l.responseURL:/^X-Request-URL:/m.test(l.getAllResponseHeaders())?l.getResponseHeader("X-Request-URL"):null}var k2=(()=>{let c=class c{constructor(p){this.xhrFactory=p}handle(p){if(p.method==="JSONP")throw new un(-2800,!1);let b=this.xhrFactory;return(b.\u0275loadImpl?br(b.\u0275loadImpl()):fn(null)).pipe(ro(()=>new Wn(A=>{let N=b.build();if(N.open(p.method,p.urlWithParams),p.withCredentials&&(N.withCredentials=!0),p.headers.forEach((qt,Ft)=>N.setRequestHeader(qt,Ft.join(","))),p.headers.has("Accept")||N.setRequestHeader("Accept","application/json, text/plain, */*"),!p.headers.has("Content-Type")){let qt=p.detectContentTypeHeader();qt!==null&&N.setRequestHeader("Content-Type",qt)}if(p.responseType){let qt=p.responseType.toLowerCase();N.responseType=qt!=="json"?qt:"text"}let V=p.serializeBody(),Y=null,ve=()=>{if(Y!==null)return Y;let qt=N.statusText||"OK",Ft=new fu(N.getAllResponseHeaders()),rn=sB(N)||p.url;return Y=new jb({headers:Ft,status:N.status,statusText:qt,url:rn}),Y},Pe=()=>{let{headers:qt,status:Ft,statusText:rn,url:on}=ve(),Ln=null;Ft!==ky.NoContent&&(Ln=typeof N.response>"u"?N.responseText:N.response),Ft===0&&(Ft=Ln?ky.Ok:0);let Cr=Ft>=200&&Ft<300;if(p.responseType==="json"&&typeof Ln=="string"){let Sr=Ln;Ln=Ln.replace(oB,"");try{Ln=Ln!==""?JSON.parse(Ln):null}catch(di){Ln=Sr,Cr&&(Cr=!1,Ln={error:di,text:Ln})}}Cr?(A.next(new Oy({body:Ln,headers:qt,status:Ft,statusText:rn,url:on||void 0})),A.complete()):A.error(new Ly({error:Ln,headers:qt,status:Ft,statusText:rn,url:on||void 0}))},tt=qt=>{let{url:Ft}=ve(),rn=new Ly({error:qt,status:N.status||0,statusText:N.statusText||"Unknown Error",url:Ft||void 0});A.error(rn)},rt=!1,Ot=qt=>{rt||(A.next(ve()),rt=!0);let Ft={type:wd.DownloadProgress,loaded:qt.loaded};qt.lengthComputable&&(Ft.total=qt.total),p.responseType==="text"&&N.responseText&&(Ft.partialText=N.responseText),A.next(Ft)},Jt=qt=>{let Ft={type:wd.UploadProgress,loaded:qt.loaded};qt.lengthComputable&&(Ft.total=qt.total),A.next(Ft)};return N.addEventListener("load",Pe),N.addEventListener("error",tt),N.addEventListener("timeout",tt),N.addEventListener("abort",tt),p.reportProgress&&(N.addEventListener("progress",Ot),V!==null&&N.upload&&N.upload.addEventListener("progress",Jt)),N.send(V),A.next({type:wd.Sent}),()=>{N.removeEventListener("error",tt),N.removeEventListener("abort",tt),N.removeEventListener("load",Pe),N.removeEventListener("timeout",tt),p.reportProgress&&(N.removeEventListener("progress",Ot),V!==null&&N.upload&&N.upload.removeEventListener("progress",Jt)),N.readyState!==N.DONE&&N.abort()}})))}};c.\u0275fac=function(b){return new(b||c)(bn(bd))},c.\u0275prov=Xt({token:c,factory:c.\u0275fac});let l=c;return l})(),z2=new yn(""),aB="XSRF-TOKEN",lB=new yn("",{providedIn:"root",factory:()=>aB}),cB="X-XSRF-TOKEN",uB=new yn("",{providedIn:"root",factory:()=>cB}),Fy=class{},hB=(()=>{let c=class c{constructor(p,b,r){this.doc=p,this.platform=b,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let p=this.doc.cookie||"";return p!==this.lastCookieString&&(this.parseCount++,this.lastToken=Sy(p,this.cookieName),this.lastCookieString=p),this.lastToken}};c.\u0275fac=function(b){return new(b||c)(bn($i),bn(Sl),bn(lB))},c.\u0275prov=Xt({token:c,factory:c.\u0275fac});let l=c;return l})();function dB(l,c){let g=l.url.toLowerCase();if(!bt(z2)||l.method==="GET"||l.method==="HEAD"||g.startsWith("http://")||g.startsWith("https://"))return c(l);let p=bt(Fy).getToken(),b=bt(uB);return p!=null&&!l.headers.has(b)&&(l=l.clone({headers:l.headers.set(b,p)})),c(l)}var B2=function(l){return l[l.Interceptors=0]="Interceptors",l[l.LegacyInterceptors=1]="LegacyInterceptors",l[l.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",l[l.NoXsrfProtection=3]="NoXsrfProtection",l[l.JsonpSupport=4]="JsonpSupport",l[l.RequestsMadeViaParent=5]="RequestsMadeViaParent",l[l.Fetch=6]="Fetch",l}(B2||{});function fB(l,c){return{\u0275kind:l,\u0275providers:c}}function Ub(...l){let c=[Kz,k2,L2,{provide:Xp,useExisting:L2},{provide:Ry,useExisting:k2},{provide:Vb,useValue:dB,multi:!0},{provide:z2,useValue:!0},{provide:Fy,useClass:hB}];for(let g of l)c.push(...g.\u0275providers);return fd(c)}var F2=new yn("");function pB(){return fB(B2.LegacyInterceptors,[{provide:F2,useFactory:iB},{provide:Vb,useExisting:F2,multi:!0}])}var j2=(()=>{let c=class c{};c.\u0275fac=function(b){return new(b||c)},c.\u0275mod=dd({type:c}),c.\u0275inj=hd({providers:[Ub(pB())]});let l=c;return l})();var Hb=class extends Dy{constructor(){super(...arguments),this.supportsDOMEvents=!0}},qb=class l extends Hb{static makeCurrent(){T2(new l)}onAndCancel(c,g,p){return c.addEventListener(g,p),()=>{c.removeEventListener(g,p)}}dispatchEvent(c,g){c.dispatchEvent(g)}remove(c){c.parentNode&&c.parentNode.removeChild(c)}createElement(c,g){return g=g||this.getDefaultDocument(),g.createElement(c)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(c){return c.nodeType===Node.ELEMENT_NODE}isShadowRoot(c){return c instanceof DocumentFragment}getGlobalEventTarget(c,g){return g==="window"?window:g==="document"?c:g==="body"?c.body:null}getBaseHref(c){let g=gB();return g==null?null:_B(g)}resetBaseElement(){Qp=null}getUserAgent(){return window.navigator.userAgent}getCookie(c){return Sy(document.cookie,c)}},Qp=null;function gB(){return Qp=Qp||document.querySelector("base"),Qp?Qp.getAttribute("href"):null}function _B(l){return new URL(l,document.baseURI).pathname}var yB=(()=>{let c=class c{build(){return new XMLHttpRequest}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:c.\u0275fac});let l=c;return l})(),Wb=new yn(""),G2=(()=>{let c=class c{constructor(p,b){this._zone=b,this._eventNameToPlugin=new Map,p.forEach(r=>{r.manager=this}),this._plugins=p.slice().reverse()}addEventListener(p,b,r){return this._findPluginFor(b).addEventListener(p,b,r)}getZone(){return this._zone}_findPluginFor(p){let b=this._eventNameToPlugin.get(p);if(b)return b;if(b=this._plugins.find(A=>A.supports(p)),!b)throw new un(5101,!1);return this._eventNameToPlugin.set(p,b),b}};c.\u0275fac=function(b){return new(b||c)(bn(Wb),bn(wr))},c.\u0275prov=Xt({token:c,factory:c.\u0275fac});let l=c;return l})(),Ny=class{constructor(c){this._doc=c}},$b="ng-app-id",H2=(()=>{let c=class c{constructor(p,b,r,A={}){this.doc=p,this.appId=b,this.nonce=r,this.platformId=A,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Ay(A),this.resetHostNodes()}addStyles(p){for(let b of p)this.changeUsageCount(b,1)===1&&this.onStyleAdded(b)}removeStyles(p){for(let b of p)this.changeUsageCount(b,-1)<=0&&this.onStyleRemoved(b)}ngOnDestroy(){let p=this.styleNodesInDOM;p&&(p.forEach(b=>b.remove()),p.clear());for(let b of this.getAllStyles())this.onStyleRemoved(b);this.resetHostNodes()}addHost(p){this.hostNodes.add(p);for(let b of this.getAllStyles())this.addStyleToHost(p,b)}removeHost(p){this.hostNodes.delete(p)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(p){for(let b of this.hostNodes)this.addStyleToHost(b,p)}onStyleRemoved(p){let b=this.styleRef;b.get(p)?.elements?.forEach(r=>r.remove()),b.delete(p)}collectServerRenderedStyles(){let p=this.doc.head?.querySelectorAll(`style[${$b}="${this.appId}"]`);if(p?.length){let b=new Map;return p.forEach(r=>{r.textContent!=null&&b.set(r.textContent,r)}),b}return null}changeUsageCount(p,b){let r=this.styleRef;if(r.has(p)){let A=r.get(p);return A.usage+=b,A.usage}return r.set(p,{usage:b,elements:[]}),b}getStyleElement(p,b){let r=this.styleNodesInDOM,A=r?.get(b);if(A?.parentNode===p)return r.delete(b),A.removeAttribute($b),A;{let N=this.doc.createElement("style");return this.nonce&&N.setAttribute("nonce",this.nonce),N.textContent=b,this.platformIsServer&&N.setAttribute($b,this.appId),p.appendChild(N),N}}addStyleToHost(p,b){let r=this.getStyleElement(p,b),A=this.styleRef,N=A.get(b)?.elements;N?N.push(r):A.set(b,{elements:[r],usage:1})}resetHostNodes(){let p=this.hostNodes;p.clear(),p.add(this.doc.head)}};c.\u0275fac=function(b){return new(b||c)(bn($i),bn(cb),bn(hb,8),bn(Sl))},c.\u0275prov=Xt({token:c,factory:c.\u0275fac});let l=c;return l})(),Gb={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Xb=/%COMP%/g,q2="%COMP%",vB=`_nghost-${q2}`,xB=`_ngcontent-${q2}`,bB=!0,wB=new yn("",{providedIn:"root",factory:()=>bB});function TB(l){return xB.replace(Xb,l)}function EB(l){return vB.replace(Xb,l)}function W2(l,c){return c.map(g=>g.replace(Xb,l))}var V2=(()=>{let c=class c{constructor(p,b,r,A,N,V,Y,ve=null){this.eventManager=p,this.sharedStylesHost=b,this.appId=r,this.removeStylesOnCompDestroy=A,this.doc=N,this.platformId=V,this.ngZone=Y,this.nonce=ve,this.rendererByCompId=new Map,this.platformIsServer=Ay(V),this.defaultRenderer=new Kp(p,N,Y,this.platformIsServer)}createRenderer(p,b){if(!p||!b)return this.defaultRenderer;this.platformIsServer&&b.encapsulation===ws.ShadowDom&&(b=gr(Rt({},b),{encapsulation:ws.Emulated}));let r=this.getOrCreateRenderer(p,b);return r instanceof zy?r.applyToHost(p):r instanceof Jp&&r.applyStyles(),r}getOrCreateRenderer(p,b){let r=this.rendererByCompId,A=r.get(b.id);if(!A){let N=this.doc,V=this.ngZone,Y=this.eventManager,ve=this.sharedStylesHost,Pe=this.removeStylesOnCompDestroy,tt=this.platformIsServer;switch(b.encapsulation){case ws.Emulated:A=new zy(Y,ve,b,this.appId,Pe,N,V,tt);break;case ws.ShadowDom:return new Zb(Y,ve,p,b,N,V,this.nonce,tt);default:A=new Jp(Y,ve,b,Pe,N,V,tt);break}r.set(b.id,A)}return A}ngOnDestroy(){this.rendererByCompId.clear()}};c.\u0275fac=function(b){return new(b||c)(bn(G2),bn(H2),bn(cb),bn(wB),bn($i),bn(Sl),bn(wr),bn(hb))},c.\u0275prov=Xt({token:c,factory:c.\u0275fac});let l=c;return l})(),Kp=class{constructor(c,g,p,b){this.eventManager=c,this.doc=g,this.ngZone=p,this.platformIsServer=b,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(c,g){return g?this.doc.createElementNS(Gb[g]||g,c):this.doc.createElement(c)}createComment(c){return this.doc.createComment(c)}createText(c){return this.doc.createTextNode(c)}appendChild(c,g){(U2(c)?c.content:c).appendChild(g)}insertBefore(c,g,p){c&&(U2(c)?c.content:c).insertBefore(g,p)}removeChild(c,g){c&&c.removeChild(g)}selectRootElement(c,g){let p=typeof c=="string"?this.doc.querySelector(c):c;if(!p)throw new un(-5104,!1);return g||(p.textContent=""),p}parentNode(c){return c.parentNode}nextSibling(c){return c.nextSibling}setAttribute(c,g,p,b){if(b){g=b+":"+g;let r=Gb[b];r?c.setAttributeNS(r,g,p):c.setAttribute(g,p)}else c.setAttribute(g,p)}removeAttribute(c,g,p){if(p){let b=Gb[p];b?c.removeAttributeNS(b,g):c.removeAttribute(`${p}:${g}`)}else c.removeAttribute(g)}addClass(c,g){c.classList.add(g)}removeClass(c,g){c.classList.remove(g)}setStyle(c,g,p,b){b&(ha.DashCase|ha.Important)?c.style.setProperty(g,p,b&ha.Important?"important":""):c.style[g]=p}removeStyle(c,g,p){p&ha.DashCase?c.style.removeProperty(g):c.style[g]=""}setProperty(c,g,p){c!=null&&(c[g]=p)}setValue(c,g){c.nodeValue=g}listen(c,g,p){if(typeof c=="string"&&(c=xd().getGlobalEventTarget(this.doc,c),!c))throw new Error(`Unsupported event target ${c} for event ${g}`);return this.eventManager.addEventListener(c,g,this.decoratePreventDefault(p))}decoratePreventDefault(c){return g=>{if(g==="__ngUnwrap__")return c;(this.platformIsServer?this.ngZone.runGuarded(()=>c(g)):c(g))===!1&&g.preventDefault()}}};function U2(l){return l.tagName==="TEMPLATE"&&l.content!==void 0}var Zb=class extends Kp{constructor(c,g,p,b,r,A,N,V){super(c,r,A,V),this.sharedStylesHost=g,this.hostEl=p,this.shadowRoot=p.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let Y=W2(b.id,b.styles);for(let ve of Y){let Pe=document.createElement("style");N&&Pe.setAttribute("nonce",N),Pe.textContent=ve,this.shadowRoot.appendChild(Pe)}}nodeOrShadowRoot(c){return c===this.hostEl?this.shadowRoot:c}appendChild(c,g){return super.appendChild(this.nodeOrShadowRoot(c),g)}insertBefore(c,g,p){return super.insertBefore(this.nodeOrShadowRoot(c),g,p)}removeChild(c,g){return super.removeChild(this.nodeOrShadowRoot(c),g)}parentNode(c){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(c)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Jp=class extends Kp{constructor(c,g,p,b,r,A,N,V){super(c,r,A,N),this.sharedStylesHost=g,this.removeStylesOnCompDestroy=b,this.styles=V?W2(V,p.styles):p.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},zy=class extends Jp{constructor(c,g,p,b,r,A,N,V){let Y=b+"-"+p.id;super(c,g,p,r,A,N,V,Y),this.contentAttr=TB(Y),this.hostAttr=EB(Y)}applyToHost(c){this.applyStyles(),this.setAttribute(c,this.hostAttr,"")}createElement(c,g){let p=super.createElement(c,g);return super.setAttribute(p,this.contentAttr,""),p}},IB=(()=>{let c=class c extends Ny{constructor(p){super(p)}supports(p){return!0}addEventListener(p,b,r){return p.addEventListener(b,r,!1),()=>this.removeEventListener(p,b,r)}removeEventListener(p,b,r){return p.removeEventListener(b,r)}};c.\u0275fac=function(b){return new(b||c)(bn($i))},c.\u0275prov=Xt({token:c,factory:c.\u0275fac});let l=c;return l})(),$2=["alt","control","meta","shift"],MB={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},DB={alt:l=>l.altKey,control:l=>l.ctrlKey,meta:l=>l.metaKey,shift:l=>l.shiftKey},CB=(()=>{let c=class c extends Ny{constructor(p){super(p)}supports(p){return c.parseEventName(p)!=null}addEventListener(p,b,r){let A=c.parseEventName(b),N=c.eventCallback(A.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>xd().onAndCancel(p,A.domEventName,N))}static parseEventName(p){let b=p.toLowerCase().split("."),r=b.shift();if(b.length===0||!(r==="keydown"||r==="keyup"))return null;let A=c._normalizeKey(b.pop()),N="",V=b.indexOf("code");if(V>-1&&(b.splice(V,1),N="code."),$2.forEach(ve=>{let Pe=b.indexOf(ve);Pe>-1&&(b.splice(Pe,1),N+=ve+".")}),N+=A,b.length!=0||A.length===0)return null;let Y={};return Y.domEventName=r,Y.fullKey=N,Y}static matchEventFullKeyCode(p,b){let r=MB[p.key]||p.key,A="";return b.indexOf("code.")>-1&&(r=p.code,A="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),$2.forEach(N=>{if(N!==r){let V=DB[N];V(p)&&(A+=N+".")}}),A+=r,A===b)}static eventCallback(p,b,r){return A=>{c.matchEventFullKeyCode(A,p)&&r.runGuarded(()=>b(A))}}static _normalizeKey(p){return p==="esc"?"escape":p}};c.\u0275fac=function(b){return new(b||c)(bn($i))},c.\u0275prov=Xt({token:c,factory:c.\u0275fac});let l=c;return l})();function Z2(l,c){return g2(Rt({rootComponent:l},SB(c)))}function SB(l){return{appProviders:[...LB,...l?.providers??[]],platformProviders:OB}}function AB(){qb.makeCurrent()}function PB(){return new ua}function RB(){return DS(document),document}var OB=[{provide:Sl,useValue:S2},{provide:ub,useValue:AB,multi:!0},{provide:$i,useFactory:RB,deps:[]}];var LB=[{provide:py,useValue:"root"},{provide:ua,useFactory:PB,deps:[]},{provide:Wb,useClass:IB,multi:!0,deps:[$i,wr,Sl]},{provide:Wb,useClass:CB,multi:!0,deps:[$i]},V2,H2,G2,{provide:Lp,useExisting:V2},{provide:bd,useClass:yB,deps:[]},[]];var X2=(()=>{let c=class c{constructor(p){this._doc=p}getTitle(){return this._doc.title}setTitle(p){this._doc.title=p||""}};c.\u0275fac=function(b){return new(b||c)(bn($i))},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})();var En="primary",pm=Symbol("RouteTitle"),ew=class{constructor(c){this.params=c||{}}has(c){return Object.prototype.hasOwnProperty.call(this.params,c)}get(c){if(this.has(c)){let g=this.params[c];return Array.isArray(g)?g[0]:g}return null}getAll(c){if(this.has(c)){let g=this.params[c];return Array.isArray(g)?g:[g]}return[]}get keys(){return Object.keys(this.params)}};function Dd(l){return new ew(l)}function FB(l,c,g){let p=g.path.split("/");if(p.length>l.length||g.pathMatch==="full"&&(c.hasChildren()||p.length<l.length))return null;let b={};for(let r=0;r<p.length;r++){let A=p[r],N=l[r];if(A.startsWith(":"))b[A.substring(1)]=N;else if(A!==N.path)return null}return{consumed:l.slice(0,p.length),posParams:b}}function NB(l,c){if(l.length!==c.length)return!1;for(let g=0;g<l.length;++g)if(!Ss(l[g],c[g]))return!1;return!0}function Ss(l,c){let g=l?tw(l):void 0,p=c?tw(c):void 0;if(!g||!p||g.length!=p.length)return!1;let b;for(let r=0;r<g.length;r++)if(b=g[r],!tA(l[b],c[b]))return!1;return!0}function tw(l){return[...Object.keys(l),...Object.getOwnPropertySymbols(l)]}function tA(l,c){if(Array.isArray(l)&&Array.isArray(c)){if(l.length!==c.length)return!1;let g=[...l].sort(),p=[...c].sort();return g.every((b,r)=>p[r]===b)}else return l===c}function nA(l){return l.length>0?l[l.length-1]:null}function Ll(l){return zx(l)?l:Hp(l)?br(Promise.resolve(l)):fn(l)}var zB={exact:iA,subset:oA},rA={exact:BB,subset:jB,ignored:()=>!0};function Y2(l,c,g){return zB[g.paths](l.root,c.root,g.matrixParams)&&rA[g.queryParams](l.queryParams,c.queryParams)&&!(g.fragment==="exact"&&l.fragment!==c.fragment)}function BB(l,c){return Ss(l,c)}function iA(l,c,g){if(!mu(l.segments,c.segments)||!Vy(l.segments,c.segments,g)||l.numberOfChildren!==c.numberOfChildren)return!1;for(let p in c.children)if(!l.children[p]||!iA(l.children[p],c.children[p],g))return!1;return!0}function jB(l,c){return Object.keys(c).length<=Object.keys(l).length&&Object.keys(c).every(g=>tA(l[g],c[g]))}function oA(l,c,g){return sA(l,c,c.segments,g)}function sA(l,c,g,p){if(l.segments.length>g.length){let b=l.segments.slice(0,g.length);return!(!mu(b,g)||c.hasChildren()||!Vy(b,g,p))}else if(l.segments.length===g.length){if(!mu(l.segments,g)||!Vy(l.segments,g,p))return!1;for(let b in c.children)if(!l.children[b]||!oA(l.children[b],c.children[b],p))return!1;return!0}else{let b=g.slice(0,l.segments.length),r=g.slice(l.segments.length);return!mu(l.segments,b)||!Vy(l.segments,b,p)||!l.children[En]?!1:sA(l.children[En],c,r,p)}}function Vy(l,c,g){return c.every((p,b)=>rA[g](l[b].parameters,p.parameters))}var Rl=class{constructor(c=new Xn([],{}),g={},p=null){this.root=c,this.queryParams=g,this.fragment=p}get queryParamMap(){return this._queryParamMap??=Dd(this.queryParams),this._queryParamMap}toString(){return $B.serialize(this)}},Xn=class{constructor(c,g){this.segments=c,this.children=g,this.parent=null,Object.values(g).forEach(p=>p.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Uy(this)}},pu=class{constructor(c,g){this.path=c,this.parameters=g}get parameterMap(){return this._parameterMap??=Dd(this.parameters),this._parameterMap}toString(){return lA(this)}};function VB(l,c){return mu(l,c)&&l.every((g,p)=>Ss(g.parameters,c[p].parameters))}function mu(l,c){return l.length!==c.length?!1:l.every((g,p)=>g.path===c[p].path)}function UB(l,c){let g=[];return Object.entries(l.children).forEach(([p,b])=>{p===En&&(g=g.concat(c(b,p)))}),Object.entries(l.children).forEach(([p,b])=>{p!==En&&(g=g.concat(c(b,p)))}),g}var Dw=(()=>{let c=class c{};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:()=>new Gy,providedIn:"root"});let l=c;return l})(),Gy=class{parse(c){let g=new rw(c);return new Rl(g.parseRootSegment(),g.parseQueryParams(),g.parseFragment())}serialize(c){let g=`/${em(c.root,!0)}`,p=qB(c.queryParams),b=typeof c.fragment=="string"?`#${GB(c.fragment)}`:"";return`${g}${p}${b}`}},$B=new Gy;function Uy(l){return l.segments.map(c=>lA(c)).join("/")}function em(l,c){if(!l.hasChildren())return Uy(l);if(c){let g=l.children[En]?em(l.children[En],!1):"",p=[];return Object.entries(l.children).forEach(([b,r])=>{b!==En&&p.push(`${b}:${em(r,!1)}`)}),p.length>0?`${g}(${p.join("//")})`:g}else{let g=UB(l,(p,b)=>b===En?[em(l.children[En],!1)]:[`${b}:${em(p,!1)}`]);return Object.keys(l.children).length===1&&l.children[En]!=null?`${Uy(l)}/${g[0]}`:`${Uy(l)}/(${g.join("//")})`}}function aA(l){return encodeURIComponent(l).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function By(l){return aA(l).replace(/%3B/gi,";")}function GB(l){return encodeURI(l)}function nw(l){return aA(l).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function $y(l){return decodeURIComponent(l)}function Q2(l){return $y(l.replace(/\+/g,"%20"))}function lA(l){return`${nw(l.path)}${HB(l.parameters)}`}function HB(l){return Object.entries(l).map(([c,g])=>`;${nw(c)}=${nw(g)}`).join("")}function qB(l){let c=Object.entries(l).map(([g,p])=>Array.isArray(p)?p.map(b=>`${By(g)}=${By(b)}`).join("&"):`${By(g)}=${By(p)}`).filter(g=>g);return c.length?`?${c.join("&")}`:""}var WB=/^[^\/()?;#]+/;function Yb(l){let c=l.match(WB);return c?c[0]:""}var ZB=/^[^\/()?;=#]+/;function XB(l){let c=l.match(ZB);return c?c[0]:""}var YB=/^[^=?&#]+/;function QB(l){let c=l.match(YB);return c?c[0]:""}var KB=/^[^&#]+/;function JB(l){let c=l.match(KB);return c?c[0]:""}var rw=class{constructor(c){this.url=c,this.remaining=c}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Xn([],{}):new Xn([],this.parseChildren())}parseQueryParams(){let c={};if(this.consumeOptional("?"))do this.parseQueryParam(c);while(this.consumeOptional("&"));return c}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let c=[];for(this.peekStartsWith("(")||c.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),c.push(this.parseSegment());let g={};this.peekStartsWith("/(")&&(this.capture("/"),g=this.parseParens(!0));let p={};return this.peekStartsWith("(")&&(p=this.parseParens(!1)),(c.length>0||Object.keys(g).length>0)&&(p[En]=new Xn(c,g)),p}parseSegment(){let c=Yb(this.remaining);if(c===""&&this.peekStartsWith(";"))throw new un(4009,!1);return this.capture(c),new pu($y(c),this.parseMatrixParams())}parseMatrixParams(){let c={};for(;this.consumeOptional(";");)this.parseParam(c);return c}parseParam(c){let g=XB(this.remaining);if(!g)return;this.capture(g);let p="";if(this.consumeOptional("=")){let b=Yb(this.remaining);b&&(p=b,this.capture(p))}c[$y(g)]=$y(p)}parseQueryParam(c){let g=QB(this.remaining);if(!g)return;this.capture(g);let p="";if(this.consumeOptional("=")){let A=JB(this.remaining);A&&(p=A,this.capture(p))}let b=Q2(g),r=Q2(p);if(c.hasOwnProperty(b)){let A=c[b];Array.isArray(A)||(A=[A],c[b]=A),A.push(r)}else c[b]=r}parseParens(c){let g={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let p=Yb(this.remaining),b=this.remaining[p.length];if(b!=="/"&&b!==")"&&b!==";")throw new un(4010,!1);let r;p.indexOf(":")>-1?(r=p.slice(0,p.indexOf(":")),this.capture(r),this.capture(":")):c&&(r=En);let A=this.parseChildren();g[r]=Object.keys(A).length===1?A[En]:new Xn([],A),this.consumeOptional("//")}return g}peekStartsWith(c){return this.remaining.startsWith(c)}consumeOptional(c){return this.peekStartsWith(c)?(this.remaining=this.remaining.substring(c.length),!0):!1}capture(c){if(!this.consumeOptional(c))throw new un(4011,!1)}};function cA(l){return l.segments.length>0?new Xn([],{[En]:l}):l}function uA(l){let c={};for(let[p,b]of Object.entries(l.children)){let r=uA(b);if(p===En&&r.segments.length===0&&r.hasChildren())for(let[A,N]of Object.entries(r.children))c[A]=N;else(r.segments.length>0||r.hasChildren())&&(c[p]=r)}let g=new Xn(l.segments,c);return e4(g)}function e4(l){if(l.numberOfChildren===1&&l.children[En]){let c=l.children[En];return new Xn(l.segments.concat(c.segments),c.children)}return l}function Cd(l){return l instanceof Rl}function t4(l,c,g=null,p=null){let b=hA(l);return dA(b,c,g,p)}function hA(l){let c;function g(r){let A={};for(let V of r.children){let Y=g(V);A[V.outlet]=Y}let N=new Xn(r.url,A);return r===l&&(c=N),N}let p=g(l.root),b=cA(p);return c??b}function dA(l,c,g,p){let b=l;for(;b.parent;)b=b.parent;if(c.length===0)return Qb(b,b,b,g,p);let r=n4(c);if(r.toRoot())return Qb(b,b,new Xn([],{}),g,p);let A=r4(r,b,l),N=A.processChildren?rm(A.segmentGroup,A.index,r.commands):pA(A.segmentGroup,A.index,r.commands);return Qb(b,A.segmentGroup,N,g,p)}function Hy(l){return typeof l=="object"&&l!=null&&!l.outlets&&!l.segmentPath}function sm(l){return typeof l=="object"&&l!=null&&l.outlets}function Qb(l,c,g,p,b){let r={};p&&Object.entries(p).forEach(([V,Y])=>{r[V]=Array.isArray(Y)?Y.map(ve=>`${ve}`):`${Y}`});let A;l===c?A=g:A=fA(l,c,g);let N=cA(uA(A));return new Rl(N,r,b)}function fA(l,c,g){let p={};return Object.entries(l.children).forEach(([b,r])=>{r===c?p[b]=g:p[b]=fA(r,c,g)}),new Xn(l.segments,p)}var qy=class{constructor(c,g,p){if(this.isAbsolute=c,this.numberOfDoubleDots=g,this.commands=p,c&&p.length>0&&Hy(p[0]))throw new un(4003,!1);let b=p.find(sm);if(b&&b!==nA(p))throw new un(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function n4(l){if(typeof l[0]=="string"&&l.length===1&&l[0]==="/")return new qy(!0,0,l);let c=0,g=!1,p=l.reduce((b,r,A)=>{if(typeof r=="object"&&r!=null){if(r.outlets){let N={};return Object.entries(r.outlets).forEach(([V,Y])=>{N[V]=typeof Y=="string"?Y.split("/"):Y}),[...b,{outlets:N}]}if(r.segmentPath)return[...b,r.segmentPath]}return typeof r!="string"?[...b,r]:A===0?(r.split("/").forEach((N,V)=>{V==0&&N==="."||(V==0&&N===""?g=!0:N===".."?c++:N!=""&&b.push(N))}),b):[...b,r]},[]);return new qy(g,c,p)}var Id=class{constructor(c,g,p){this.segmentGroup=c,this.processChildren=g,this.index=p}};function r4(l,c,g){if(l.isAbsolute)return new Id(c,!0,0);if(!g)return new Id(c,!1,NaN);if(g.parent===null)return new Id(g,!0,0);let p=Hy(l.commands[0])?0:1,b=g.segments.length-1+p;return i4(g,b,l.numberOfDoubleDots)}function i4(l,c,g){let p=l,b=c,r=g;for(;r>b;){if(r-=b,p=p.parent,!p)throw new un(4005,!1);b=p.segments.length}return new Id(p,!1,b-r)}function o4(l){return sm(l[0])?l[0].outlets:{[En]:l}}function pA(l,c,g){if(l??=new Xn([],{}),l.segments.length===0&&l.hasChildren())return rm(l,c,g);let p=s4(l,c,g),b=g.slice(p.commandIndex);if(p.match&&p.pathIndex<l.segments.length){let r=new Xn(l.segments.slice(0,p.pathIndex),{});return r.children[En]=new Xn(l.segments.slice(p.pathIndex),l.children),rm(r,0,b)}else return p.match&&b.length===0?new Xn(l.segments,{}):p.match&&!l.hasChildren()?iw(l,c,g):p.match?rm(l,0,b):iw(l,c,g)}function rm(l,c,g){if(g.length===0)return new Xn(l.segments,{});{let p=o4(g),b={};if(Object.keys(p).some(r=>r!==En)&&l.children[En]&&l.numberOfChildren===1&&l.children[En].segments.length===0){let r=rm(l.children[En],c,g);return new Xn(l.segments,r.children)}return Object.entries(p).forEach(([r,A])=>{typeof A=="string"&&(A=[A]),A!==null&&(b[r]=pA(l.children[r],c,A))}),Object.entries(l.children).forEach(([r,A])=>{p[r]===void 0&&(b[r]=A)}),new Xn(l.segments,b)}}function s4(l,c,g){let p=0,b=c,r={match:!1,pathIndex:0,commandIndex:0};for(;b<l.segments.length;){if(p>=g.length)return r;let A=l.segments[b],N=g[p];if(sm(N))break;let V=`${N}`,Y=p<g.length-1?g[p+1]:null;if(b>0&&V===void 0)break;if(V&&Y&&typeof Y=="object"&&Y.outlets===void 0){if(!J2(V,Y,A))return r;p+=2}else{if(!J2(V,{},A))return r;p++}b++}return{match:!0,pathIndex:b,commandIndex:p}}function iw(l,c,g){let p=l.segments.slice(0,c),b=0;for(;b<g.length;){let r=g[b];if(sm(r)){let V=a4(r.outlets);return new Xn(p,V)}if(b===0&&Hy(g[0])){let V=l.segments[c];p.push(new pu(V.path,K2(g[0]))),b++;continue}let A=sm(r)?r.outlets[En]:`${r}`,N=b<g.length-1?g[b+1]:null;A&&N&&Hy(N)?(p.push(new pu(A,K2(N))),b+=2):(p.push(new pu(A,{})),b++)}return new Xn(p,{})}function a4(l){let c={};return Object.entries(l).forEach(([g,p])=>{typeof p=="string"&&(p=[p]),p!==null&&(c[g]=iw(new Xn([],{}),0,p))}),c}function K2(l){let c={};return Object.entries(l).forEach(([g,p])=>c[g]=`${p}`),c}function J2(l,c,g){return l==g.path&&Ss(c,g.parameters)}var im="imperative",oi=function(l){return l[l.NavigationStart=0]="NavigationStart",l[l.NavigationEnd=1]="NavigationEnd",l[l.NavigationCancel=2]="NavigationCancel",l[l.NavigationError=3]="NavigationError",l[l.RoutesRecognized=4]="RoutesRecognized",l[l.ResolveStart=5]="ResolveStart",l[l.ResolveEnd=6]="ResolveEnd",l[l.GuardsCheckStart=7]="GuardsCheckStart",l[l.GuardsCheckEnd=8]="GuardsCheckEnd",l[l.RouteConfigLoadStart=9]="RouteConfigLoadStart",l[l.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",l[l.ChildActivationStart=11]="ChildActivationStart",l[l.ChildActivationEnd=12]="ChildActivationEnd",l[l.ActivationStart=13]="ActivationStart",l[l.ActivationEnd=14]="ActivationEnd",l[l.Scroll=15]="Scroll",l[l.NavigationSkipped=16]="NavigationSkipped",l}(oi||{}),Io=class{constructor(c,g){this.id=c,this.url=g}},am=class extends Io{constructor(c,g,p="imperative",b=null){super(c,g),this.type=oi.NavigationStart,this.navigationTrigger=p,this.restoredState=b}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},gu=class extends Io{constructor(c,g,p){super(c,g),this.urlAfterRedirects=p,this.type=oi.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},so=function(l){return l[l.Redirect=0]="Redirect",l[l.SupersededByNewNavigation=1]="SupersededByNewNavigation",l[l.NoDataFromResolver=2]="NoDataFromResolver",l[l.GuardRejected=3]="GuardRejected",l}(so||{}),ow=function(l){return l[l.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",l[l.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",l}(ow||{}),Ol=class extends Io{constructor(c,g,p,b){super(c,g),this.reason=p,this.code=b,this.type=oi.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},_u=class extends Io{constructor(c,g,p,b){super(c,g),this.reason=p,this.code=b,this.type=oi.NavigationSkipped}},lm=class extends Io{constructor(c,g,p,b){super(c,g),this.error=p,this.target=b,this.type=oi.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Wy=class extends Io{constructor(c,g,p,b){super(c,g),this.urlAfterRedirects=p,this.state=b,this.type=oi.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},sw=class extends Io{constructor(c,g,p,b){super(c,g),this.urlAfterRedirects=p,this.state=b,this.type=oi.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},aw=class extends Io{constructor(c,g,p,b,r){super(c,g),this.urlAfterRedirects=p,this.state=b,this.shouldActivate=r,this.type=oi.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},lw=class extends Io{constructor(c,g,p,b){super(c,g),this.urlAfterRedirects=p,this.state=b,this.type=oi.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},cw=class extends Io{constructor(c,g,p,b){super(c,g),this.urlAfterRedirects=p,this.state=b,this.type=oi.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},uw=class{constructor(c){this.route=c,this.type=oi.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},hw=class{constructor(c){this.route=c,this.type=oi.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},dw=class{constructor(c){this.snapshot=c,this.type=oi.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},fw=class{constructor(c){this.snapshot=c,this.type=oi.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},pw=class{constructor(c){this.snapshot=c,this.type=oi.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},mw=class{constructor(c){this.snapshot=c,this.type=oi.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var cm=class{},um=class{constructor(c){this.url=c}};var gw=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Jy,this.attachRef=null}},Jy=(()=>{let c=class c{constructor(){this.contexts=new Map}onChildOutletCreated(p,b){let r=this.getOrCreateContext(p);r.outlet=b,this.contexts.set(p,r)}onChildOutletDestroyed(p){let b=this.getContext(p);b&&(b.outlet=null,b.attachRef=null)}onOutletDeactivated(){let p=this.contexts;return this.contexts=new Map,p}onOutletReAttached(p){this.contexts=p}getOrCreateContext(p){let b=this.getContext(p);return b||(b=new gw,this.contexts.set(p,b)),b}getContext(p){return this.contexts.get(p)||null}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})(),Zy=class{constructor(c){this._root=c}get root(){return this._root.value}parent(c){let g=this.pathFromRoot(c);return g.length>1?g[g.length-2]:null}children(c){let g=_w(c,this._root);return g?g.children.map(p=>p.value):[]}firstChild(c){let g=_w(c,this._root);return g&&g.children.length>0?g.children[0].value:null}siblings(c){let g=yw(c,this._root);return g.length<2?[]:g[g.length-2].children.map(b=>b.value).filter(b=>b!==c)}pathFromRoot(c){return yw(c,this._root).map(g=>g.value)}};function _w(l,c){if(l===c.value)return c;for(let g of c.children){let p=_w(l,g);if(p)return p}return null}function yw(l,c){if(l===c.value)return[c];for(let g of c.children){let p=yw(l,g);if(p.length)return p.unshift(c),p}return[]}var oo=class{constructor(c,g){this.value=c,this.children=g}toString(){return`TreeNode(${this.value})`}};function Ed(l){let c={};return l&&l.children.forEach(g=>c[g.value.outlet]=g),c}var Xy=class extends Zy{constructor(c,g){super(c),this.snapshot=g,Sw(this,c)}toString(){return this.snapshot.toString()}};function mA(l){let c=l4(l),g=new ri([new pu("",{})]),p=new ri({}),b=new ri({}),r=new ri({}),A=new ri(""),N=new Sd(g,p,r,A,b,En,l,c.root);return N.snapshot=c.root,new Xy(new oo(N,[]),c)}function l4(l){let c={},g={},p={},b="",r=new hm([],c,p,b,g,En,l,null,{});return new Yy("",new oo(r,[]))}var Sd=class{constructor(c,g,p,b,r,A,N,V){this.urlSubject=c,this.paramsSubject=g,this.queryParamsSubject=p,this.fragmentSubject=b,this.dataSubject=r,this.outlet=A,this.component=N,this._futureSnapshot=V,this.title=this.dataSubject?.pipe(Mn(Y=>Y[pm]))??fn(void 0),this.url=c,this.params=g,this.queryParams=p,this.fragment=b,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Mn(c=>Dd(c))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Mn(c=>Dd(c))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Cw(l,c,g="emptyOnly"){let p,{routeConfig:b}=l;return c!==null&&(g==="always"||b?.path===""||!c.component&&!c.routeConfig?.loadComponent)?p={params:Rt(Rt({},c.params),l.params),data:Rt(Rt({},c.data),l.data),resolve:Rt(Rt(Rt(Rt({},l.data),c.data),b?.data),l._resolvedData)}:p={params:Rt({},l.params),data:Rt({},l.data),resolve:Rt(Rt({},l.data),l._resolvedData??{})},b&&_A(b)&&(p.resolve[pm]=b.title),p}var hm=class{get title(){return this.data?.[pm]}constructor(c,g,p,b,r,A,N,V,Y){this.url=c,this.params=g,this.queryParams=p,this.fragment=b,this.data=r,this.outlet=A,this.component=N,this.routeConfig=V,this._resolve=Y}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Dd(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Dd(this.queryParams),this._queryParamMap}toString(){let c=this.url.map(p=>p.toString()).join("/"),g=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${c}', path:'${g}')`}},Yy=class extends Zy{constructor(c,g){super(g),this.url=c,Sw(this,g)}toString(){return gA(this._root)}};function Sw(l,c){c.value._routerState=l,c.children.forEach(g=>Sw(l,g))}function gA(l){let c=l.children.length>0?` { ${l.children.map(gA).join(", ")} } `:"";return`${l.value}${c}`}function Kb(l){if(l.snapshot){let c=l.snapshot,g=l._futureSnapshot;l.snapshot=g,Ss(c.queryParams,g.queryParams)||l.queryParamsSubject.next(g.queryParams),c.fragment!==g.fragment&&l.fragmentSubject.next(g.fragment),Ss(c.params,g.params)||l.paramsSubject.next(g.params),NB(c.url,g.url)||l.urlSubject.next(g.url),Ss(c.data,g.data)||l.dataSubject.next(g.data)}else l.snapshot=l._futureSnapshot,l.dataSubject.next(l._futureSnapshot.data)}function vw(l,c){let g=Ss(l.params,c.params)&&VB(l.url,c.url),p=!l.parent!=!c.parent;return g&&!p&&(!l.parent||vw(l.parent,c.parent))}function _A(l){return typeof l.title=="string"||l.title===null}var Aw=(()=>{let c=class c{constructor(){this.activated=null,this._activatedRoute=null,this.name=En,this.activateEvents=new wo,this.deactivateEvents=new wo,this.attachEvents=new wo,this.detachEvents=new wo,this.parentContexts=bt(Jy),this.location=bt(cu),this.changeDetector=bt(qp),this.environmentInjector=bt(Ui),this.inputBinder=bt(Pw,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(p){if(p.name){let{firstChange:b,previousValue:r}=p.name;if(b)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(p){return this.parentContexts.getContext(p)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let p=this.parentContexts.getContext(this.name);p?.route&&(p.attachRef?this.attach(p.attachRef,p.route):this.activateWith(p.route,p.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new un(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new un(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new un(4012,!1);this.location.detach();let p=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(p.instance),p}attach(p,b){this.activated=p,this._activatedRoute=b,this.location.insert(p.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(p.instance)}deactivate(){if(this.activated){let p=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(p)}}activateWith(p,b){if(this.isActivated)throw new un(4013,!1);this._activatedRoute=p;let r=this.location,N=p.snapshot.component,V=this.parentContexts.getOrCreateContext(this.name).children,Y=new xw(p,V,r.injector);this.activated=r.createComponent(N,{index:r.length,injector:Y,environmentInjector:b??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};c.\u0275fac=function(b){return new(b||c)},c.\u0275dir=Bp({type:c,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[_y]});let l=c;return l})(),xw=class l{__ngOutletInjector(c){return new l(this.route,this.childContexts,c)}constructor(c,g,p){this.route=c,this.childContexts=g,this.parent=p}get(c,g){return c===Sd?this.route:c===Jy?this.childContexts:this.parent.get(c,g)}},Pw=new yn("");function c4(l,c,g){let p=dm(l,c._root,g?g._root:void 0);return new Xy(p,c)}function dm(l,c,g){if(g&&l.shouldReuseRoute(c.value,g.value.snapshot)){let p=g.value;p._futureSnapshot=c.value;let b=u4(l,c,g);return new oo(p,b)}else{if(l.shouldAttach(c.value)){let r=l.retrieve(c.value);if(r!==null){let A=r.route;return A.value._futureSnapshot=c.value,A.children=c.children.map(N=>dm(l,N)),A}}let p=h4(c.value),b=c.children.map(r=>dm(l,r));return new oo(p,b)}}function u4(l,c,g){return c.children.map(p=>{for(let b of g.children)if(l.shouldReuseRoute(p.value,b.value.snapshot))return dm(l,p,b);return dm(l,p)})}function h4(l){return new Sd(new ri(l.url),new ri(l.params),new ri(l.queryParams),new ri(l.fragment),new ri(l.data),l.outlet,l.component,l)}var yA="ngNavigationCancelingError";function vA(l,c){let{redirectTo:g,navigationBehaviorOptions:p}=Cd(c)?{redirectTo:c,navigationBehaviorOptions:void 0}:c,b=xA(!1,so.Redirect);return b.url=g,b.navigationBehaviorOptions=p,b}function xA(l,c){let g=new Error(`NavigationCancelingError: ${l||""}`);return g[yA]=!0,g.cancellationCode=c,g}function d4(l){return bA(l)&&Cd(l.url)}function bA(l){return!!l&&l[yA]}var f4=(()=>{let c=class c{};c.\u0275fac=function(b){return new(b||c)},c.\u0275cmp=To({type:c,selectors:[["ng-component"]],standalone:!0,features:[Eo],decls:1,vars:0,template:function(b,r){b&1&&Tr(0,"router-outlet")},dependencies:[Aw],encapsulation:2});let l=c;return l})();function p4(l,c){return l.providers&&!l._injector&&(l._injector=Mb(l.providers,c,`Route: ${l.path}`)),l._injector??c}function Rw(l){let c=l.children&&l.children.map(Rw),g=c?gr(Rt({},l),{children:c}):Rt({},l);return!g.component&&!g.loadComponent&&(c||g.loadChildren)&&g.outlet&&g.outlet!==En&&(g.component=f4),g}function As(l){return l.outlet||En}function m4(l,c){let g=l.filter(p=>As(p)===c);return g.push(...l.filter(p=>As(p)!==c)),g}function mm(l){if(!l)return null;if(l.routeConfig?._injector)return l.routeConfig._injector;for(let c=l.parent;c;c=c.parent){let g=c.routeConfig;if(g?._loadedInjector)return g._loadedInjector;if(g?._injector)return g._injector}return null}var g4=(l,c,g,p)=>Mn(b=>(new bw(c,b.targetRouterState,b.currentRouterState,g,p).activate(l),b)),bw=class{constructor(c,g,p,b,r){this.routeReuseStrategy=c,this.futureState=g,this.currState=p,this.forwardEvent=b,this.inputBindingEnabled=r}activate(c){let g=this.futureState._root,p=this.currState?this.currState._root:null;this.deactivateChildRoutes(g,p,c),Kb(this.futureState.root),this.activateChildRoutes(g,p,c)}deactivateChildRoutes(c,g,p){let b=Ed(g);c.children.forEach(r=>{let A=r.value.outlet;this.deactivateRoutes(r,b[A],p),delete b[A]}),Object.values(b).forEach(r=>{this.deactivateRouteAndItsChildren(r,p)})}deactivateRoutes(c,g,p){let b=c.value,r=g?g.value:null;if(b===r)if(b.component){let A=p.getContext(b.outlet);A&&this.deactivateChildRoutes(c,g,A.children)}else this.deactivateChildRoutes(c,g,p);else r&&this.deactivateRouteAndItsChildren(g,p)}deactivateRouteAndItsChildren(c,g){c.value.component&&this.routeReuseStrategy.shouldDetach(c.value.snapshot)?this.detachAndStoreRouteSubtree(c,g):this.deactivateRouteAndOutlet(c,g)}detachAndStoreRouteSubtree(c,g){let p=g.getContext(c.value.outlet),b=p&&c.value.component?p.children:g,r=Ed(c);for(let A of Object.values(r))this.deactivateRouteAndItsChildren(A,b);if(p&&p.outlet){let A=p.outlet.detach(),N=p.children.onOutletDeactivated();this.routeReuseStrategy.store(c.value.snapshot,{componentRef:A,route:c,contexts:N})}}deactivateRouteAndOutlet(c,g){let p=g.getContext(c.value.outlet),b=p&&c.value.component?p.children:g,r=Ed(c);for(let A of Object.values(r))this.deactivateRouteAndItsChildren(A,b);p&&(p.outlet&&(p.outlet.deactivate(),p.children.onOutletDeactivated()),p.attachRef=null,p.route=null)}activateChildRoutes(c,g,p){let b=Ed(g);c.children.forEach(r=>{this.activateRoutes(r,b[r.value.outlet],p),this.forwardEvent(new mw(r.value.snapshot))}),c.children.length&&this.forwardEvent(new fw(c.value.snapshot))}activateRoutes(c,g,p){let b=c.value,r=g?g.value:null;if(Kb(b),b===r)if(b.component){let A=p.getOrCreateContext(b.outlet);this.activateChildRoutes(c,g,A.children)}else this.activateChildRoutes(c,g,p);else if(b.component){let A=p.getOrCreateContext(b.outlet);if(this.routeReuseStrategy.shouldAttach(b.snapshot)){let N=this.routeReuseStrategy.retrieve(b.snapshot);this.routeReuseStrategy.store(b.snapshot,null),A.children.onOutletReAttached(N.contexts),A.attachRef=N.componentRef,A.route=N.route.value,A.outlet&&A.outlet.attach(N.componentRef,N.route.value),Kb(N.route.value),this.activateChildRoutes(c,null,A.children)}else{let N=mm(b.snapshot);A.attachRef=null,A.route=b,A.injector=N,A.outlet&&A.outlet.activateWith(b,A.injector),this.activateChildRoutes(c,null,A.children)}}else this.activateChildRoutes(c,null,p)}},Qy=class{constructor(c){this.path=c,this.route=this.path[this.path.length-1]}},Md=class{constructor(c,g){this.component=c,this.route=g}};function _4(l,c,g){let p=l._root,b=c?c._root:null;return tm(p,b,g,[p.value])}function y4(l){let c=l.routeConfig?l.routeConfig.canActivateChild:null;return!c||c.length===0?null:{node:l,guards:c}}function Pd(l,c){let g=Symbol(),p=c.get(l,g);return p===g?typeof l=="function"&&!vC(l)?l:c.get(l):p}function tm(l,c,g,p,b={canDeactivateChecks:[],canActivateChecks:[]}){let r=Ed(c);return l.children.forEach(A=>{v4(A,r[A.value.outlet],g,p.concat([A.value]),b),delete r[A.value.outlet]}),Object.entries(r).forEach(([A,N])=>om(N,g.getContext(A),b)),b}function v4(l,c,g,p,b={canDeactivateChecks:[],canActivateChecks:[]}){let r=l.value,A=c?c.value:null,N=g?g.getContext(l.value.outlet):null;if(A&&r.routeConfig===A.routeConfig){let V=x4(A,r,r.routeConfig.runGuardsAndResolvers);V?b.canActivateChecks.push(new Qy(p)):(r.data=A.data,r._resolvedData=A._resolvedData),r.component?tm(l,c,N?N.children:null,p,b):tm(l,c,g,p,b),V&&N&&N.outlet&&N.outlet.isActivated&&b.canDeactivateChecks.push(new Md(N.outlet.component,A))}else A&&om(c,N,b),b.canActivateChecks.push(new Qy(p)),r.component?tm(l,null,N?N.children:null,p,b):tm(l,null,g,p,b);return b}function x4(l,c,g){if(typeof g=="function")return g(l,c);switch(g){case"pathParamsChange":return!mu(l.url,c.url);case"pathParamsOrQueryParamsChange":return!mu(l.url,c.url)||!Ss(l.queryParams,c.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!vw(l,c)||!Ss(l.queryParams,c.queryParams);case"paramsChange":default:return!vw(l,c)}}function om(l,c,g){let p=Ed(l),b=l.value;Object.entries(p).forEach(([r,A])=>{b.component?c?om(A,c.children.getContext(r),g):om(A,null,g):om(A,c,g)}),b.component?c&&c.outlet&&c.outlet.isActivated?g.canDeactivateChecks.push(new Md(c.outlet.component,b)):g.canDeactivateChecks.push(new Md(null,b)):g.canDeactivateChecks.push(new Md(null,b))}function gm(l){return typeof l=="function"}function b4(l){return typeof l=="boolean"}function w4(l){return l&&gm(l.canLoad)}function T4(l){return l&&gm(l.canActivate)}function E4(l){return l&&gm(l.canActivateChild)}function I4(l){return l&&gm(l.canDeactivate)}function M4(l){return l&&gm(l.canMatch)}function wA(l){return l instanceof sa||l?.name==="EmptyError"}var jy=Symbol("INITIAL_VALUE");function Ad(){return ro(l=>z_(l.map(c=>c.pipe(aa(1),$x(jy)))).pipe(Mn(c=>{for(let g of c)if(g!==!0){if(g===jy)return jy;if(g===!1||g instanceof Rl)return g}return!0}),no(c=>c!==jy),aa(1)))}function D4(l,c){return Gr(g=>{let{targetSnapshot:p,currentSnapshot:b,guards:{canActivateChecks:r,canDeactivateChecks:A}}=g;return A.length===0&&r.length===0?fn(gr(Rt({},g),{guardsResult:!0})):C4(A,p,b,l).pipe(Gr(N=>N&&b4(N)?S4(p,r,l,c):fn(N)),Mn(N=>gr(Rt({},g),{guardsResult:N})))})}function C4(l,c,g,p){return br(l).pipe(Gr(b=>L4(b.component,b.route,g,c,p)),vs(b=>b!==!0,!0))}function S4(l,c,g,p){return br(c).pipe(xl(b=>Qh(P4(b.route.parent,p),A4(b.route,p),O4(l,b.path,g),R4(l,b.route,g))),vs(b=>b!==!0,!0))}function A4(l,c){return l!==null&&c&&c(new pw(l)),fn(!0)}function P4(l,c){return l!==null&&c&&c(new dw(l)),fn(!0)}function R4(l,c,g){let p=c.routeConfig?c.routeConfig.canActivate:null;if(!p||p.length===0)return fn(!0);let b=p.map(r=>B_(()=>{let A=mm(c)??g,N=Pd(r,A),V=T4(N)?N.canActivate(c,l):da(A,()=>N(c,l));return Ll(V).pipe(vs())}));return fn(b).pipe(Ad())}function O4(l,c,g){let p=c[c.length-1],r=c.slice(0,c.length-1).reverse().map(A=>y4(A)).filter(A=>A!==null).map(A=>B_(()=>{let N=A.guards.map(V=>{let Y=mm(A.node)??g,ve=Pd(V,Y),Pe=E4(ve)?ve.canActivateChild(p,l):da(Y,()=>ve(p,l));return Ll(Pe).pipe(vs())});return fn(N).pipe(Ad())}));return fn(r).pipe(Ad())}function L4(l,c,g,p,b){let r=c&&c.routeConfig?c.routeConfig.canDeactivate:null;if(!r||r.length===0)return fn(!0);let A=r.map(N=>{let V=mm(c)??b,Y=Pd(N,V),ve=I4(Y)?Y.canDeactivate(l,c,g,p):da(V,()=>Y(l,c,g,p));return Ll(ve).pipe(vs())});return fn(A).pipe(Ad())}function k4(l,c,g,p){let b=c.canLoad;if(b===void 0||b.length===0)return fn(!0);let r=b.map(A=>{let N=Pd(A,l),V=w4(N)?N.canLoad(c,g):da(l,()=>N(c,g));return Ll(V)});return fn(r).pipe(Ad(),TA(p))}function TA(l){return Lx(Jr(c=>{if(Cd(c))throw vA(l,c)}),Mn(c=>c===!0))}function F4(l,c,g,p){let b=c.canMatch;if(!b||b.length===0)return fn(!0);let r=b.map(A=>{let N=Pd(A,l),V=M4(N)?N.canMatch(c,g):da(l,()=>N(c,g));return Ll(V)});return fn(r).pipe(Ad(),TA(p))}var fm=class{constructor(c){this.segmentGroup=c||null}},Ky=class extends Error{constructor(c){super(),this.urlTree=c}};function Td(l){return Yh(new fm(l))}function N4(l){return Yh(new un(4e3,!1))}function z4(l){return Yh(xA(!1,so.GuardRejected))}var ww=class{constructor(c,g){this.urlSerializer=c,this.urlTree=g}lineralizeSegments(c,g){let p=[],b=g.root;for(;;){if(p=p.concat(b.segments),b.numberOfChildren===0)return fn(p);if(b.numberOfChildren>1||!b.children[En])return N4(c.redirectTo);b=b.children[En]}}applyRedirectCommands(c,g,p){let b=this.applyRedirectCreateUrlTree(g,this.urlSerializer.parse(g),c,p);if(g.startsWith("/"))throw new Ky(b);return b}applyRedirectCreateUrlTree(c,g,p,b){let r=this.createSegmentGroup(c,g.root,p,b);return new Rl(r,this.createQueryParams(g.queryParams,this.urlTree.queryParams),g.fragment)}createQueryParams(c,g){let p={};return Object.entries(c).forEach(([b,r])=>{if(typeof r=="string"&&r.startsWith(":")){let N=r.substring(1);p[b]=g[N]}else p[b]=r}),p}createSegmentGroup(c,g,p,b){let r=this.createSegments(c,g.segments,p,b),A={};return Object.entries(g.children).forEach(([N,V])=>{A[N]=this.createSegmentGroup(c,V,p,b)}),new Xn(r,A)}createSegments(c,g,p,b){return g.map(r=>r.path.startsWith(":")?this.findPosParam(c,r,b):this.findOrReturn(r,p))}findPosParam(c,g,p){let b=p[g.path.substring(1)];if(!b)throw new un(4001,!1);return b}findOrReturn(c,g){let p=0;for(let b of g){if(b.path===c.path)return g.splice(p),b;p++}return c}},Tw={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function B4(l,c,g,p,b){let r=Ow(l,c,g);return r.matched?(p=p4(c,p),F4(p,c,g,b).pipe(Mn(A=>A===!0?r:Rt({},Tw)))):fn(r)}function Ow(l,c,g){if(c.path==="**")return j4(g);if(c.path==="")return c.pathMatch==="full"&&(l.hasChildren()||g.length>0)?Rt({},Tw):{matched:!0,consumedSegments:[],remainingSegments:g,parameters:{},positionalParamSegments:{}};let b=(c.matcher||FB)(g,l,c);if(!b)return Rt({},Tw);let r={};Object.entries(b.posParams??{}).forEach(([N,V])=>{r[N]=V.path});let A=b.consumed.length>0?Rt(Rt({},r),b.consumed[b.consumed.length-1].parameters):r;return{matched:!0,consumedSegments:b.consumed,remainingSegments:g.slice(b.consumed.length),parameters:A,positionalParamSegments:b.posParams??{}}}function j4(l){return{matched:!0,parameters:l.length>0?nA(l).parameters:{},consumedSegments:l,remainingSegments:[],positionalParamSegments:{}}}function eA(l,c,g,p){return g.length>0&&$4(l,g,p)?{segmentGroup:new Xn(c,U4(p,new Xn(g,l.children))),slicedSegments:[]}:g.length===0&&G4(l,g,p)?{segmentGroup:new Xn(l.segments,V4(l,g,p,l.children)),slicedSegments:g}:{segmentGroup:new Xn(l.segments,l.children),slicedSegments:g}}function V4(l,c,g,p){let b={};for(let r of g)if(e0(l,c,r)&&!p[As(r)]){let A=new Xn([],{});b[As(r)]=A}return Rt(Rt({},p),b)}function U4(l,c){let g={};g[En]=c;for(let p of l)if(p.path===""&&As(p)!==En){let b=new Xn([],{});g[As(p)]=b}return g}function $4(l,c,g){return g.some(p=>e0(l,c,p)&&As(p)!==En)}function G4(l,c,g){return g.some(p=>e0(l,c,p))}function e0(l,c,g){return(l.hasChildren()||c.length>0)&&g.pathMatch==="full"?!1:g.path===""}function H4(l,c,g,p){return As(l)!==p&&(p===En||!e0(c,g,l))?!1:Ow(c,l,g).matched}function q4(l,c,g){return c.length===0&&!l.children[g]}var Ew=class{};function W4(l,c,g,p,b,r,A="emptyOnly"){return new Iw(l,c,g,p,b,A,r).recognize()}var Z4=31,Iw=class{constructor(c,g,p,b,r,A,N){this.injector=c,this.configLoader=g,this.rootComponentType=p,this.config=b,this.urlTree=r,this.paramsInheritanceStrategy=A,this.urlSerializer=N,this.applyRedirects=new ww(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(c){return new un(4002,`'${c.segmentGroup}'`)}recognize(){let c=eA(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(c).pipe(Mn(g=>{let p=new hm([],Object.freeze({}),Object.freeze(Rt({},this.urlTree.queryParams)),this.urlTree.fragment,{},En,this.rootComponentType,null,{}),b=new oo(p,g),r=new Yy("",b),A=t4(p,[],this.urlTree.queryParams,this.urlTree.fragment);return A.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(A),this.inheritParamsAndData(r._root,null),{state:r,tree:A}}))}match(c){return this.processSegmentGroup(this.injector,this.config,c,En).pipe(vl(p=>{if(p instanceof Ky)return this.urlTree=p.urlTree,this.match(p.urlTree.root);throw p instanceof fm?this.noMatchError(p):p}))}inheritParamsAndData(c,g){let p=c.value,b=Cw(p,g,this.paramsInheritanceStrategy);p.params=Object.freeze(b.params),p.data=Object.freeze(b.data),c.children.forEach(r=>this.inheritParamsAndData(r,p))}processSegmentGroup(c,g,p,b){return p.segments.length===0&&p.hasChildren()?this.processChildren(c,g,p):this.processSegment(c,g,p,p.segments,b,!0).pipe(Mn(r=>r instanceof oo?[r]:[]))}processChildren(c,g,p){let b=[];for(let r of Object.keys(p.children))r==="primary"?b.unshift(r):b.push(r);return br(b).pipe(xl(r=>{let A=p.children[r],N=m4(g,r);return this.processSegmentGroup(c,N,A,r)}),Ux((r,A)=>(r.push(...A),r)),bl(null),Vx(),Gr(r=>{if(r===null)return Td(p);let A=EA(r);return X4(A),fn(A)}))}processSegment(c,g,p,b,r,A){return br(g).pipe(xl(N=>this.processSegmentAgainstRoute(N._injector??c,g,N,p,b,r,A).pipe(vl(V=>{if(V instanceof fm)return fn(null);throw V}))),vs(N=>!!N),vl(N=>{if(wA(N))return q4(p,b,r)?fn(new Ew):Td(p);throw N}))}processSegmentAgainstRoute(c,g,p,b,r,A,N){return H4(p,b,r,A)?p.redirectTo===void 0?this.matchSegmentAgainstRoute(c,b,p,r,A):this.allowRedirects&&N?this.expandSegmentAgainstRouteUsingRedirect(c,b,g,p,r,A):Td(b):Td(b)}expandSegmentAgainstRouteUsingRedirect(c,g,p,b,r,A){let{matched:N,consumedSegments:V,positionalParamSegments:Y,remainingSegments:ve}=Ow(g,b,r);if(!N)return Td(g);b.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>Z4&&(this.allowRedirects=!1));let Pe=this.applyRedirects.applyRedirectCommands(V,b.redirectTo,Y);return this.applyRedirects.lineralizeSegments(b,Pe).pipe(Gr(tt=>this.processSegment(c,p,g,tt.concat(ve),A,!1)))}matchSegmentAgainstRoute(c,g,p,b,r){let A=B4(g,p,b,c,this.urlSerializer);return p.path==="**"&&(g.children={}),A.pipe(ro(N=>N.matched?(c=p._injector??c,this.getChildConfig(c,p,b).pipe(ro(({routes:V})=>{let Y=p._loadedInjector??c,{consumedSegments:ve,remainingSegments:Pe,parameters:tt}=N,rt=new hm(ve,tt,Object.freeze(Rt({},this.urlTree.queryParams)),this.urlTree.fragment,Q4(p),As(p),p.component??p._loadedComponent??null,p,K4(p)),{segmentGroup:Ot,slicedSegments:Jt}=eA(g,ve,Pe,V);if(Jt.length===0&&Ot.hasChildren())return this.processChildren(Y,V,Ot).pipe(Mn(Ft=>Ft===null?null:new oo(rt,Ft)));if(V.length===0&&Jt.length===0)return fn(new oo(rt,[]));let qt=As(p)===r;return this.processSegment(Y,V,Ot,Jt,qt?En:r,!0).pipe(Mn(Ft=>new oo(rt,Ft instanceof oo?[Ft]:[])))}))):Td(g)))}getChildConfig(c,g,p){return g.children?fn({routes:g.children,injector:c}):g.loadChildren?g._loadedRoutes!==void 0?fn({routes:g._loadedRoutes,injector:g._loadedInjector}):k4(c,g,p,this.urlSerializer).pipe(Gr(b=>b?this.configLoader.loadChildren(c,g).pipe(Jr(r=>{g._loadedRoutes=r.routes,g._loadedInjector=r.injector})):z4(g))):fn({routes:[],injector:c})}};function X4(l){l.sort((c,g)=>c.value.outlet===En?-1:g.value.outlet===En?1:c.value.outlet.localeCompare(g.value.outlet))}function Y4(l){let c=l.value.routeConfig;return c&&c.path===""}function EA(l){let c=[],g=new Set;for(let p of l){if(!Y4(p)){c.push(p);continue}let b=c.find(r=>p.value.routeConfig===r.value.routeConfig);b!==void 0?(b.children.push(...p.children),g.add(b)):c.push(p)}for(let p of g){let b=EA(p.children);c.push(new oo(p.value,b))}return c.filter(p=>!g.has(p))}function Q4(l){return l.data||{}}function K4(l){return l.resolve||{}}function J4(l,c,g,p,b,r){return Gr(A=>W4(l,c,g,p,A.extractedUrl,b,r).pipe(Mn(({state:N,tree:V})=>gr(Rt({},A),{targetSnapshot:N,urlAfterRedirects:V}))))}function e5(l,c){return Gr(g=>{let{targetSnapshot:p,guards:{canActivateChecks:b}}=g;if(!b.length)return fn(g);let r=new Set(b.map(V=>V.route)),A=new Set;for(let V of r)if(!A.has(V))for(let Y of IA(V))A.add(Y);let N=0;return br(A).pipe(xl(V=>r.has(V)?t5(V,p,l,c):(V.data=Cw(V,V.parent,l).resolve,fn(void 0))),Jr(()=>N++),Kh(1),Gr(V=>N===A.size?fn(g):to))})}function IA(l){let c=l.children.map(g=>IA(g)).flat();return[l,...c]}function t5(l,c,g,p){let b=l.routeConfig,r=l._resolve;return b?.title!==void 0&&!_A(b)&&(r[pm]=b.title),n5(r,l,c,p).pipe(Mn(A=>(l._resolvedData=A,l.data=Cw(l,l.parent,g).resolve,null)))}function n5(l,c,g,p){let b=tw(l);if(b.length===0)return fn({});let r={};return br(b).pipe(Gr(A=>r5(l[A],c,g,p).pipe(vs(),Jr(N=>{r[A]=N}))),Kh(1),jx(r),vl(A=>wA(A)?to:Yh(A)))}function r5(l,c,g,p){let b=mm(c)??p,r=Pd(l,b),A=r.resolve?r.resolve(c,g):da(b,()=>r(c,g));return Ll(A)}function Jb(l){return ro(c=>{let g=l(c);return g?br(g).pipe(Mn(()=>c)):fn(c)})}var MA=(()=>{let c=class c{buildTitle(p){let b,r=p.root;for(;r!==void 0;)b=this.getResolvedTitleForRoute(r)??b,r=r.children.find(A=>A.outlet===En);return b}getResolvedTitleForRoute(p){return p.data[pm]}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:()=>bt(i5),providedIn:"root"});let l=c;return l})(),i5=(()=>{let c=class c extends MA{constructor(p){super(),this.title=p}updateTitle(p){let b=this.buildTitle(p);b!==void 0&&this.title.setTitle(b)}};c.\u0275fac=function(b){return new(b||c)(bn(X2))},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})(),Lw=new yn("",{providedIn:"root",factory:()=>({})}),kw=new yn(""),o5=(()=>{let c=class c{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=bt(Rb)}loadComponent(p){if(this.componentLoaders.get(p))return this.componentLoaders.get(p);if(p._loadedComponent)return fn(p._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(p);let b=Ll(p.loadComponent()).pipe(Mn(DA),Jr(A=>{this.onLoadEndListener&&this.onLoadEndListener(p),p._loadedComponent=A}),wl(()=>{this.componentLoaders.delete(p)})),r=new Xh(b,()=>new Mi).pipe(Zh());return this.componentLoaders.set(p,r),r}loadChildren(p,b){if(this.childrenLoaders.get(b))return this.childrenLoaders.get(b);if(b._loadedRoutes)return fn({routes:b._loadedRoutes,injector:b._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(b);let A=s5(b,this.compiler,p,this.onLoadEndListener).pipe(wl(()=>{this.childrenLoaders.delete(b)})),N=new Xh(A,()=>new Mi).pipe(Zh());return this.childrenLoaders.set(b,N),N}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})();function s5(l,c,g,p){return Ll(l.loadChildren()).pipe(Mn(DA),Gr(b=>b instanceof Fp||Array.isArray(b)?fn(b):br(c.compileModuleAsync(b))),Mn(b=>{p&&p(l);let r,A,N=!1;return Array.isArray(b)?(A=b,N=!0):(r=b.create(g).injector,A=r.get(kw,[],{optional:!0,self:!0}).flat()),{routes:A.map(Rw),injector:r}}))}function a5(l){return l&&typeof l=="object"&&"default"in l}function DA(l){return a5(l)?l.default:l}var Fw=(()=>{let c=class c{};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:()=>bt(l5),providedIn:"root"});let l=c;return l})(),l5=(()=>{let c=class c{shouldProcessUrl(p){return!0}extract(p){return p}merge(p,b){return p}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})(),c5=new yn("");var u5=(()=>{let c=class c{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Mi,this.transitionAbortSubject=new Mi,this.configLoader=bt(o5),this.environmentInjector=bt(Ui),this.urlSerializer=bt(Dw),this.rootContexts=bt(Jy),this.location=bt(Wp),this.inputBindingEnabled=bt(Pw,{optional:!0})!==null,this.titleStrategy=bt(MA),this.options=bt(Lw,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=bt(Fw),this.createViewTransition=bt(c5,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>fn(void 0),this.rootComponentType=null;let p=r=>this.events.next(new uw(r)),b=r=>this.events.next(new hw(r));this.configLoader.onLoadEndListener=b,this.configLoader.onLoadStartListener=p}complete(){this.transitions?.complete()}handleNavigationRequest(p){let b=++this.navigationId;this.transitions?.next(gr(Rt(Rt({},this.transitions.value),p),{id:b}))}setupNavigations(p,b,r){return this.transitions=new ri({id:0,currentUrlTree:b,currentRawUrl:b,extractedUrl:this.urlHandlingStrategy.extract(b),urlAfterRedirects:this.urlHandlingStrategy.extract(b),rawUrl:b,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:im,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(no(A=>A.id!==0),Mn(A=>gr(Rt({},A),{extractedUrl:this.urlHandlingStrategy.extract(A.rawUrl)})),ro(A=>{let N=!1,V=!1;return fn(A).pipe(ro(Y=>{if(this.navigationId>A.id)return this.cancelNavigationTransition(A,"",so.SupersededByNewNavigation),to;this.currentTransition=A,this.currentNavigation={id:Y.id,initialUrl:Y.rawUrl,extractedUrl:Y.extractedUrl,trigger:Y.source,extras:Y.extras,previousNavigation:this.lastSuccessfulNavigation?gr(Rt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let ve=!p.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),Pe=Y.extras.onSameUrlNavigation??p.onSameUrlNavigation;if(!ve&&Pe!=="reload"){let tt="";return this.events.next(new _u(Y.id,this.urlSerializer.serialize(Y.rawUrl),tt,ow.IgnoredSameUrlNavigation)),Y.resolve(null),to}if(this.urlHandlingStrategy.shouldProcessUrl(Y.rawUrl))return fn(Y).pipe(ro(tt=>{let rt=this.transitions?.getValue();return this.events.next(new am(tt.id,this.urlSerializer.serialize(tt.extractedUrl),tt.source,tt.restoredState)),rt!==this.transitions?.getValue()?to:Promise.resolve(tt)}),J4(this.environmentInjector,this.configLoader,this.rootComponentType,p.config,this.urlSerializer,this.paramsInheritanceStrategy),Jr(tt=>{A.targetSnapshot=tt.targetSnapshot,A.urlAfterRedirects=tt.urlAfterRedirects,this.currentNavigation=gr(Rt({},this.currentNavigation),{finalUrl:tt.urlAfterRedirects});let rt=new Wy(tt.id,this.urlSerializer.serialize(tt.extractedUrl),this.urlSerializer.serialize(tt.urlAfterRedirects),tt.targetSnapshot);this.events.next(rt)}));if(ve&&this.urlHandlingStrategy.shouldProcessUrl(Y.currentRawUrl)){let{id:tt,extractedUrl:rt,source:Ot,restoredState:Jt,extras:qt}=Y,Ft=new am(tt,this.urlSerializer.serialize(rt),Ot,Jt);this.events.next(Ft);let rn=mA(this.rootComponentType).snapshot;return this.currentTransition=A=gr(Rt({},Y),{targetSnapshot:rn,urlAfterRedirects:rt,extras:gr(Rt({},qt),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=rt,fn(A)}else{let tt="";return this.events.next(new _u(Y.id,this.urlSerializer.serialize(Y.extractedUrl),tt,ow.IgnoredByUrlHandlingStrategy)),Y.resolve(null),to}}),Jr(Y=>{let ve=new sw(Y.id,this.urlSerializer.serialize(Y.extractedUrl),this.urlSerializer.serialize(Y.urlAfterRedirects),Y.targetSnapshot);this.events.next(ve)}),Mn(Y=>(this.currentTransition=A=gr(Rt({},Y),{guards:_4(Y.targetSnapshot,Y.currentSnapshot,this.rootContexts)}),A)),D4(this.environmentInjector,Y=>this.events.next(Y)),Jr(Y=>{if(A.guardsResult=Y.guardsResult,Cd(Y.guardsResult))throw vA(this.urlSerializer,Y.guardsResult);let ve=new aw(Y.id,this.urlSerializer.serialize(Y.extractedUrl),this.urlSerializer.serialize(Y.urlAfterRedirects),Y.targetSnapshot,!!Y.guardsResult);this.events.next(ve)}),no(Y=>Y.guardsResult?!0:(this.cancelNavigationTransition(Y,"",so.GuardRejected),!1)),Jb(Y=>{if(Y.guards.canActivateChecks.length)return fn(Y).pipe(Jr(ve=>{let Pe=new lw(ve.id,this.urlSerializer.serialize(ve.extractedUrl),this.urlSerializer.serialize(ve.urlAfterRedirects),ve.targetSnapshot);this.events.next(Pe)}),ro(ve=>{let Pe=!1;return fn(ve).pipe(e5(this.paramsInheritanceStrategy,this.environmentInjector),Jr({next:()=>Pe=!0,complete:()=>{Pe||this.cancelNavigationTransition(ve,"",so.NoDataFromResolver)}}))}),Jr(ve=>{let Pe=new cw(ve.id,this.urlSerializer.serialize(ve.extractedUrl),this.urlSerializer.serialize(ve.urlAfterRedirects),ve.targetSnapshot);this.events.next(Pe)}))}),Jb(Y=>{let ve=Pe=>{let tt=[];Pe.routeConfig?.loadComponent&&!Pe.routeConfig._loadedComponent&&tt.push(this.configLoader.loadComponent(Pe.routeConfig).pipe(Jr(rt=>{Pe.component=rt}),Mn(()=>{})));for(let rt of Pe.children)tt.push(...ve(rt));return tt};return z_(ve(Y.targetSnapshot.root)).pipe(bl(null),aa(1))}),Jb(()=>this.afterPreactivation()),ro(()=>{let{currentSnapshot:Y,targetSnapshot:ve}=A,Pe=this.createViewTransition?.(this.environmentInjector,Y.root,ve.root);return Pe?br(Pe).pipe(Mn(()=>A)):fn(A)}),Mn(Y=>{let ve=c4(p.routeReuseStrategy,Y.targetSnapshot,Y.currentRouterState);return this.currentTransition=A=gr(Rt({},Y),{targetRouterState:ve}),this.currentNavigation.targetRouterState=ve,A}),Jr(()=>{this.events.next(new cm)}),g4(this.rootContexts,p.routeReuseStrategy,Y=>this.events.next(Y),this.inputBindingEnabled),aa(1),Jr({next:Y=>{N=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new gu(Y.id,this.urlSerializer.serialize(Y.extractedUrl),this.urlSerializer.serialize(Y.urlAfterRedirects))),this.titleStrategy?.updateTitle(Y.targetRouterState.snapshot),Y.resolve(!0)},complete:()=>{N=!0}}),Gx(this.transitionAbortSubject.pipe(Jr(Y=>{throw Y}))),wl(()=>{!N&&!V&&this.cancelNavigationTransition(A,"",so.SupersededByNewNavigation),this.currentTransition?.id===A.id&&(this.currentNavigation=null,this.currentTransition=null)}),vl(Y=>{if(V=!0,bA(Y))this.events.next(new Ol(A.id,this.urlSerializer.serialize(A.extractedUrl),Y.message,Y.cancellationCode)),d4(Y)?this.events.next(new um(Y.url)):A.resolve(!1);else{this.events.next(new lm(A.id,this.urlSerializer.serialize(A.extractedUrl),Y,A.targetSnapshot??void 0));try{A.resolve(p.errorHandler(Y))}catch(ve){this.options.resolveNavigationPromiseOnError?A.resolve(!1):A.reject(ve)}}return to}))}))}cancelNavigationTransition(p,b,r){let A=new Ol(p.id,this.urlSerializer.serialize(p.extractedUrl),b,r);this.events.next(A),p.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})();function h5(l){return l!==im}var d5=(()=>{let c=class c{};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:()=>bt(f5),providedIn:"root"});let l=c;return l})(),Mw=class{shouldDetach(c){return!1}store(c,g){}shouldAttach(c){return!1}retrieve(c){return null}shouldReuseRoute(c,g){return c.routeConfig===g.routeConfig}},f5=(()=>{let c=class c extends Mw{};c.\u0275fac=(()=>{let p;return function(r){return(p||(p=lb(c)))(r||c)}})(),c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})(),CA=(()=>{let c=class c{};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:()=>bt(p5),providedIn:"root"});let l=c;return l})(),p5=(()=>{let c=class c extends CA{constructor(){super(...arguments),this.location=bt(Wp),this.urlSerializer=bt(Dw),this.options=bt(Lw,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=bt(Fw),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Rl,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=mA(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(p){return this.location.subscribe(b=>{b.type==="popstate"&&p(b.url,b.state)})}handleRouterEvent(p,b){if(p instanceof am)this.stateMemento=this.createStateMemento();else if(p instanceof _u)this.rawUrlTree=b.initialUrl;else if(p instanceof Wy){if(this.urlUpdateStrategy==="eager"&&!b.extras.skipLocationChange){let r=this.urlHandlingStrategy.merge(b.finalUrl,b.initialUrl);this.setBrowserUrl(r,b)}}else p instanceof cm?(this.currentUrlTree=b.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(b.finalUrl,b.initialUrl),this.routerState=b.targetRouterState,this.urlUpdateStrategy==="deferred"&&(b.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,b))):p instanceof Ol&&(p.code===so.GuardRejected||p.code===so.NoDataFromResolver)?this.restoreHistory(b):p instanceof lm?this.restoreHistory(b,!0):p instanceof gu&&(this.lastSuccessfulId=p.id,this.currentPageId=this.browserPageId)}setBrowserUrl(p,b){let r=this.urlSerializer.serialize(p);if(this.location.isCurrentPathEqualTo(r)||b.extras.replaceUrl){let A=this.browserPageId,N=Rt(Rt({},b.extras.state),this.generateNgRouterState(b.id,A));this.location.replaceState(r,"",N)}else{let A=Rt(Rt({},b.extras.state),this.generateNgRouterState(b.id,this.browserPageId+1));this.location.go(r,"",A)}}restoreHistory(p,b=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,A=this.currentPageId-r;A!==0?this.location.historyGo(A):this.currentUrlTree===p.finalUrl&&A===0&&(this.resetState(p),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(b&&this.resetState(p),this.resetUrlToCurrentUrlTree())}resetState(p){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,p.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(p,b){return this.canceledNavigationResolution==="computed"?{navigationId:p,\u0275routerPageId:b}:{navigationId:p}}};c.\u0275fac=(()=>{let p;return function(r){return(p||(p=lb(c)))(r||c)}})(),c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})(),nm=function(l){return l[l.COMPLETE=0]="COMPLETE",l[l.FAILED=1]="FAILED",l[l.REDIRECTING=2]="REDIRECTING",l}(nm||{});function m5(l,c){l.events.pipe(no(g=>g instanceof gu||g instanceof Ol||g instanceof lm||g instanceof _u),Mn(g=>g instanceof gu||g instanceof _u?nm.COMPLETE:(g instanceof Ol?g.code===so.Redirect||g.code===so.SupersededByNewNavigation:!1)?nm.REDIRECTING:nm.FAILED),no(g=>g!==nm.REDIRECTING),aa(1)).subscribe(()=>{c()})}function g5(l){throw l}var _5={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},y5={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},t0=(()=>{let c=class c{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=bt(Iy),this.stateManager=bt(CA),this.options=bt(Lw,{optional:!0})||{},this.pendingTasks=bt(uu),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=bt(u5),this.urlSerializer=bt(Dw),this.location=bt(Wp),this.urlHandlingStrategy=bt(Fw),this._events=new Mi,this.errorHandler=this.options.errorHandler||g5,this.navigated=!1,this.routeReuseStrategy=bt(d5),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=bt(kw,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!bt(Pw,{optional:!0}),this.eventsSubscription=new $r,this.isNgZoneEnabled=bt(wr)instanceof wr&&wr.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:p=>{this.console.warn(p)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let p=this.navigationTransitions.events.subscribe(b=>{try{let r=this.navigationTransitions.currentTransition,A=this.navigationTransitions.currentNavigation;if(r!==null&&A!==null){if(this.stateManager.handleRouterEvent(b,A),b instanceof Ol&&b.code!==so.Redirect&&b.code!==so.SupersededByNewNavigation)this.navigated=!0;else if(b instanceof gu)this.navigated=!0;else if(b instanceof um){let N=this.urlHandlingStrategy.merge(b.url,r.currentRawUrl),V={info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||h5(r.source)};this.scheduleNavigation(N,im,null,V,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}x5(b)&&this._events.next(b)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(p)}resetRootComponentType(p){this.routerState.root.component=p,this.navigationTransitions.rootComponentType=p}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),im,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((p,b)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(p,"popstate",b)},0)})}navigateToSyncWithBrowser(p,b,r){let A={replaceUrl:!0},N=r?.navigationId?r:null;if(r){let Y=Rt({},r);delete Y.navigationId,delete Y.\u0275routerPageId,Object.keys(Y).length!==0&&(A.state=Y)}let V=this.parseUrl(p);this.scheduleNavigation(V,b,N,A)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(p){this.config=p.map(Rw),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(p,b={}){let{relativeTo:r,queryParams:A,fragment:N,queryParamsHandling:V,preserveFragment:Y}=b,ve=Y?this.currentUrlTree.fragment:N,Pe=null;switch(V){case"merge":Pe=Rt(Rt({},this.currentUrlTree.queryParams),A);break;case"preserve":Pe=this.currentUrlTree.queryParams;break;default:Pe=A||null}Pe!==null&&(Pe=this.removeEmptyProps(Pe));let tt;try{let rt=r?r.snapshot:this.routerState.snapshot.root;tt=hA(rt)}catch{(typeof p[0]!="string"||!p[0].startsWith("/"))&&(p=[]),tt=this.currentUrlTree.root}return dA(tt,p,Pe,ve??null)}navigateByUrl(p,b={skipLocationChange:!1}){let r=Cd(p)?p:this.parseUrl(p),A=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(A,im,null,b)}navigate(p,b={skipLocationChange:!1}){return v5(p),this.navigateByUrl(this.createUrlTree(p,b),b)}serializeUrl(p){return this.urlSerializer.serialize(p)}parseUrl(p){try{return this.urlSerializer.parse(p)}catch{return this.urlSerializer.parse("/")}}isActive(p,b){let r;if(b===!0?r=Rt({},_5):b===!1?r=Rt({},y5):r=b,Cd(p))return Y2(this.currentUrlTree,p,r);let A=this.parseUrl(p);return Y2(this.currentUrlTree,A,r)}removeEmptyProps(p){return Object.entries(p).reduce((b,[r,A])=>(A!=null&&(b[r]=A),b),{})}scheduleNavigation(p,b,r,A,N){if(this.disposed)return Promise.resolve(!1);let V,Y,ve;N?(V=N.resolve,Y=N.reject,ve=N.promise):ve=new Promise((tt,rt)=>{V=tt,Y=rt});let Pe=this.pendingTasks.add();return m5(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(Pe))}),this.navigationTransitions.handleNavigationRequest({source:b,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:p,extras:A,resolve:V,reject:Y,promise:ve,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),ve.catch(tt=>Promise.reject(tt))}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})();function v5(l){for(let c=0;c<l.length;c++)if(l[c]==null)throw new un(4008,!1)}function x5(l){return!(l instanceof cm)&&!(l instanceof um)}var b5=new yn("");function SA(l,...c){return fd([{provide:kw,multi:!0,useValue:l},[],{provide:Sd,useFactory:w5,deps:[t0]},{provide:My,multi:!0,useFactory:T5},c.map(g=>g.\u0275providers)])}function w5(l){return l.routerState.root}function T5(){let l=bt(lu);return c=>{let g=l.get(vd);if(c!==g.components[0])return;let p=l.get(t0),b=l.get(E5);l.get(I5)===1&&p.initialNavigation(),l.get(M5,null,Sn.Optional)?.setUpPreloading(),l.get(b5,null,Sn.Optional)?.init(),p.resetRootComponentType(g.componentTypes[0]),b.closed||(b.next(),b.complete(),b.unsubscribe())}}var E5=new yn("",{factory:()=>new Mi}),I5=new yn("",{providedIn:"root",factory:()=>1});var M5=new yn("");var jw=eD(Bw());function C5(l,c){if(l&1&&(Hr(0,"div",5),Gp(1),qr()),l&2){let g=Cb();Cs(),Pb(g.locationCount)}}function S5(l,c){if(l&1&&(Hr(0,"div",6),Gp(1),qr()),l&2){let g=Cb();Cs(),Ey(" ",g.alarmCount," ")}}var PA=(()=>{let c=class c{constructor(){this.scale=.2,this.locationCount=5,this.alarmCount=3,this.indicatorState=Rd.CLUSTERED,this.IndicatorState=Rd}showAlarmCount(){return this.alarmCount!==0&&![Rd.SUBMENU,Rd.DEVICES,Rd.INACTIVE].includes(this.indicatorState)}};c.\u0275fac=function(b){return new(b||c)},c.\u0275cmp=To({type:c,selectors:[["app-marker"]],inputs:{scale:"scale",locationCount:"locationCount",alarmCount:"alarmCount",indicatorState:"indicatorState"},standalone:!0,features:[Eo],decls:5,vars:6,consts:[[1,"container"],["class","location-count",4,"ngIf"],["src","../../../assets/indicator.svg","alt","",1,"indicator"],["src","../../../assets/indiciator-shadow.svg",1,"shadow"],["class","alarm-count",4,"ngIf"],[1,"location-count"],[1,"alarm-count"]],template:function(b,r){b&1&&(Hr(0,"div",0),Ty(1,C5,2,1,"div",1),Tr(2,"img",2)(3,"img",3),Ty(4,S5,2,1,"div",4),qr()),b&2&&($p("scale",r.scale),Cs(),Al("ngIf",r.indicatorState===r.IndicatorState.CLUSTERED&&r.locationCount>1),Cs(),$p("opacity",r.indicatorState===r.IndicatorState.INACTIVE?.5:1),Cs(2),Al("ngIf",r.showAlarmCount()))},dependencies:[du,C2],styles:[".container[_ngcontent-%COMP%]{width:130px;height:130px;position:static;z-index:1000;cursor:pointer}.container[_ngcontent-%COMP%]   .indicator[_ngcontent-%COMP%]{width:100%;height:100%}.container[_ngcontent-%COMP%]   .shadow[_ngcontent-%COMP%]{position:relative;width:100%;display:flex;top:-35px;align-items:center;align-content:center}.container[_ngcontent-%COMP%]   .location-count[_ngcontent-%COMP%]{color:#918b8b;color:#918b8be0;float:left;position:absolute;display:flex;width:100%;height:100%;font-size:80px;margin-top:-15px;justify-content:center;align-items:center}.container[_ngcontent-%COMP%]   .alarm-count[_ngcontent-%COMP%]{background:radial-gradient(circle,#f43939,#ca0f0f 50%);width:70px;height:70px;position:absolute;top:-25px;right:-25px;border-radius:50%;color:#fff;display:flex;font-size:50px;justify-content:center;align-items:center}"],changeDetection:0});let l=c;return l})(),Rd=function(l){return l.CLUSTERED="clustered",l.LOCATION="location",l.DEVICES="devices",l.SUBMENU="submenu",l.INACTIVE="inactive",l}(Rd||{});var A5=[{id:"1",latitude:50.05423456789012,longitude:19.93845678901234},{id:"2",latitude:50.051601681737964,longitude:19.94527204613522},{id:"3",latitude:50.05773375024379,longitude:19.943222265625},{id:"4",latitude:50.05490381469543,longitude:19.93778991699219},{id:"5",latitude:50.05760487599164,longitude:19.937191009521484},{id:"6",latitude:50.05824547073284,longitude:19.930737670577457},{id:"7",latitude:50.05684123456789,longitude:19.93645678012345},{id:"8",latitude:50.05567891234567,longitude:19.94123456789012},{id:"9",latitude:50.05345678901234,longitude:19.93987654321098},{id:"10",latitude:50.05234567890123,longitude:19.93876543210987},{id:"11",latitude:50.05123456789012,longitude:19.94098765432109},{id:"12",latitude:50.05987654321098,longitude:19.93567890123456},{id:"13",latitude:50.05876543210987,longitude:19.94456789012345},{id:"14",latitude:50.05432109876543,longitude:19.94234567890123},{id:"15",latitude:50.05543210987654,longitude:19.94345678901234},{id:"16",latitude:50.05754321098765,longitude:19.94198765432109},{id:"17",latitude:50.05643210987654,longitude:19.93912345678901},{id:"18",latitude:50.05321098765432,longitude:19.9380123456789},{id:"19",latitude:50.05210987654321,longitude:19.93765432109876},{id:"20",latitude:50.05198765432109,longitude:19.93654321098765},{id:"21",latitude:50.05123456789012,longitude:19.93712345678901},{id:"22",latitude:50.05234567890123,longitude:19.94123456789012},{id:"23",latitude:50.05345678901234,longitude:19.94234567890123},{id:"24",latitude:50.05456789012345,longitude:19.93845678901234},{id:"25",latitude:50.05567890123456,longitude:19.93956789012345},{id:"26",latitude:50.05678901234567,longitude:19.94067890123456},{id:"27",latitude:50.05789012345678,longitude:19.93578901234567},{id:"28",latitude:50.05890123456789,longitude:19.93689012345678},{id:"29",latitude:50.0590123456789,longitude:19.94112345678901},{id:"30",latitude:50.05112345678901,longitude:19.94323456789012},{id:"31",latitude:50.05223456789012,longitude:19.93734567890123},{id:"32",latitude:50.05334567890123,longitude:19.94245678901234},{id:"33",latitude:50.05445678901234,longitude:19.93856789012345},{id:"34",latitude:50.05556789012345,longitude:19.93967890123456},{id:"35",latitude:50.05667890123456,longitude:19.94078901234567},{id:"36",latitude:50.05778901234567,longitude:19.93589012345678},{id:"37",latitude:50.05889012345678,longitude:19.93690123456789},{id:"38",latitude:50.05990123456789,longitude:19.9410123456789},{id:"39",latitude:50.0510123456789,longitude:19.94312345678901},{id:"40",latitude:50.05212345678901,longitude:19.93723456789012},{id:"41",latitude:50.05323456789012,longitude:19.94234567890123},{id:"42",latitude:50.05434567890123,longitude:19.93845678901234},{id:"43",latitude:50.05545678901234,longitude:19.93956789012345},{id:"44",latitude:50.05656789012345,longitude:19.94067890123456},{id:"45",latitude:50.05767890123456,longitude:19.93578901234567},{id:"46",latitude:50.05878901234567,longitude:19.93689012345678},{id:"47",latitude:50.05989012345678,longitude:19.9410123456789},{id:"48",latitude:50.05190123456789,longitude:19.94312345678901},{id:"49",latitude:50.0520123456789,longitude:19.93723456789012},{id:"50",latitude:50.05312345678901,longitude:19.94234567890123}],RA=A5;var OA=(()=>{let c=class c{constructor(){this.url="http://localhost:3000/places",this.dev="http://demo.dev.sencity.ai/devices/search/geospatial-map"}getAllLocations(){return bp(this,null,function*(){let b=yield(yield fetch(this.url)).text();return JSON.parse(b)??[]})}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})();var LA=eD(Bw());var n0=(()=>{let c=class c{constructor(){this.ACCESS_TOKEN="pk.eyJ1IjoiY2V6YXJ5a3V6bmlhcnoiLCJhIjoiY2x6aWdpd2k5MGJsdDJ4czFuYXhkdXBjZCJ9.574g_uNi81hRSz3gg7CTmg",this.mapStyle="mapbox://styles/cezarykuzniarz/cm03j6upu00c501phcmvjemfd",this.map=null}setMap(p){this.map||(this.map=p)}initializeMap(p){let V=p,{container:b,zoom:r,center:A}=V,N=Uh(V,["container","zoom","center"]);return this.map=new LA.default.Map(Rt({accessToken:this.ACCESS_TOKEN,container:b,style:this.mapStyle,zoom:r??12,center:A},N)),this.map}updateZoom(p){let b=this.map.getCenter(),r=this.map.getZoom();this.map.easeTo({center:b,zoom:p,duration:2e3,linear:!0})}updatePitch(p){let b=this.map.getCenter(),r=this.map.getZoom();this.map.easeTo({center:b,zoom:r,pitch:p,duration:1e3,linear:!0})}};c.\u0275fac=function(b){return new(b||c)},c.\u0275prov=Xt({token:c,factory:c.\u0275fac,providedIn:"root"});let l=c;return l})();var R5=["mapContainer"],FA=(()=>{let c=class c{constructor(p,b,r,A){this.resolver=p,this.injector=b,this.mockService=r,this.mapService=A,this.ACCESS_TOKEN="pk.eyJ1IjoiY2V6YXJ5a3V6bmlhcnoiLCJhIjoiY2x6aWdpd2k5MGJsdDJ4czFuYXhkdXBjZCJ9.574g_uNi81hRSz3gg7CTmg",this.mapStyle="mapbox://styles/cezarykuzniarz/cm03j6upu00c501phcmvjemfd",this.markersReferenceArray=[]}ngOnInit(){jw.default.accessToken=this.ACCESS_TOKEN,this.map=this.mapService.initializeMap({container:this.mapContainer.nativeElement,center:[19.944544,50.04968],pitch:60,zoom:12,minZoom:6})}ngAfterViewInit(){this.mockService.getAllLocations().then(p=>{p.forEach(b=>{})}).catch(p=>{console.log(p),this.mockData=RA,this.mockData.forEach(b=>{this.addCustomMarker([b.longitude,b.latitude],b.id)})})}ngOnDestroy(){this.map.remove()}addCustomMarker(p,b){let A=this.resolver.resolveComponentFactory(PA).create(this.injector);A.setInput("locationCount",1),A.setInput("alarmCount",parseInt(b)),this.markersReferenceArray.push(A),A.hostView.detectChanges();let N=A.hostView.rootNodes[0];new jw.default.Marker(N).setLngLat(p).addTo(this.map)}};c.\u0275fac=function(b){return new(b||c)(Ci(yd),Ci(lu),Ci(OA),Ci(n0))},c.\u0275cmp=To({type:c,selectors:[["app-map-view"]],viewQuery:function(b,r){if(b&1&&u2(R5,7),b&2){let A;Sb(A=Ab())&&(r.mapContainer=A.first)}},standalone:!0,features:[Eo],decls:3,vars:0,consts:[["mapContainer",""],[1,"match-parent"],["id","map",2,"position","absolute","z-index","200","width","100vw","height","100vh"]],template:function(b,r){b&1&&Tr(0,"div",1)(1,"div",2,0)},dependencies:[j2],styles:['.match-parent[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute}#map[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;z-index:10;pointer-events:none;-webkit-box-shadow:inset 0 0 70px 60px white;-moz-box-shadow:inset 0 0 70px 60px white;box-shadow:inset 0 0 70px 60px #fff}']});let l=c;return l})();var NA=[{path:"",redirectTo:"map",pathMatch:"full"},{path:"map",component:FA}];var zA={providers:[SA(NA),Ub()]};var BA=(()=>{let c=class c{constructor(p,b){this.router=p,this.mapService=b,this.ViewState=r0,this.currentPitch=60,this.mapState=r0.MAP_VIEW}ngOnInit(){}handleActiveItem(p){let b=p.target.id;this.mapState=r0[b]}handleZoomChange(p){this.mapService.updateZoom(p)}handlePitchChange(p){this.mapService.updatePitch(p)}};c.\u0275fac=function(b){return new(b||c)(Ci(t0),Ci(n0))},c.\u0275cmp=To({type:c,selectors:[["app-toolbar"]],standalone:!0,features:[Eo],decls:17,vars:3,consts:[[1,"container"],[1,"map-control"],[1,"img-container",3,"click"],["src","../../../assets/map-2d-control.svg"],["src","../../../assets/map-location-control.svg"],["src","../../../assets/map-devices-control.svg"],[1,"view-control"],["id","MAP_VIEW",1,"img-container",3,"click","ngClass"],["id","MAP_VIEW","src","../../../assets/menu-map.svg"],["id","BUBBLE_VIEW",1,"img-container",3,"click","ngClass"],["id","BUBBLE_VIEW","src","../../../assets/bubble-menu-item.svg"],["id","DEVICE_VIEW",1,"img-container",3,"click","ngClass"],["id","DEVICE_VIEW","src","../../../assets/map-cluster-control.svg"],[1,"ai-control"],["src","../../../assets/ai-ball.svg",1,"ai-ball"]],template:function(b,r){b&1&&(Hr(0,"div",0)(1,"div",1)(2,"div",2),ma("click",function(){return r.handlePitchChange(0)}),Tr(3,"img",3),qr(),Hr(4,"div",2),ma("click",function(){return r.handleZoomChange(15)}),Tr(5,"img",4),qr(),Hr(6,"div",2),ma("click",function(){return r.handleZoomChange(11)}),Tr(7,"img",5),qr()(),Hr(8,"div",6)(9,"div",7),ma("click",function(N){return r.handleActiveItem(N)}),Tr(10,"img",8),qr(),Hr(11,"div",9),ma("click",function(N){return r.handleActiveItem(N)}),Tr(12,"img",10),qr(),Hr(13,"div",11),ma("click",function(N){return r.handleActiveItem(N)}),Tr(14,"img",12),qr()(),Hr(15,"div",13),Tr(16,"img",14),qr()()),b&2&&(Cs(9),Al("ngClass",r.mapState===r.ViewState.MAP_VIEW?"active":"not-active"),Cs(2),Al("ngClass",r.mapState===r.ViewState.BUBBLE_VIEW?"active":"not-active"),Cs(2),Al("ngClass",r.mapState===r.ViewState.DEVICE_VIEW?"active":"not-active"))},dependencies:[du,D2],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:absolute;justify-content:space-between;bottom:24px;left:32px;width:48px;height:352px;z-index:800}.container[_ngcontent-%COMP%]   .map-control[_ngcontent-%COMP%]{height:128px;border-radius:8px;width:48px;height:144px;display:flex;flex-direction:column;box-sizing:border-box;justify-content:space-between;align-items:center;padding:8px}.container[_ngcontent-%COMP%]   .map-control[_ngcontent-%COMP%]   .img-container[_ngcontent-%COMP%]{cursor:pointer;border-radius:4px;display:flex;justify-content:center;align-items:center;width:32px;height:32px}.container[_ngcontent-%COMP%]   .map-control[_ngcontent-%COMP%]   .img-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:24px;width:24px}.container[_ngcontent-%COMP%]   .view-control[_ngcontent-%COMP%]{background:linear-gradient(90deg,#fff,#f7f7f7 50%);box-shadow:0 0 3px 1px #dad3d3;border-radius:8px;width:48px;height:144px;display:flex;flex-direction:column;box-sizing:border-box;justify-content:space-between;align-items:center;padding:8px}.container[_ngcontent-%COMP%]   .view-control[_ngcontent-%COMP%]   .img-container[_ngcontent-%COMP%]{cursor:pointer;border-radius:4px;display:flex;justify-content:center;align-items:center;width:32px;height:32px}.container[_ngcontent-%COMP%]   .view-control[_ngcontent-%COMP%]   .img-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:24px;width:24px}.container[_ngcontent-%COMP%]   .ai-control[_ngcontent-%COMP%]{background:linear-gradient(90deg,#fff,#f7f7f7 50%);box-shadow:0 0 3px 1px #dad3d3;border-radius:8px;width:48px;height:48px;display:flex;align-items:center;justify-content:center}.container[_ngcontent-%COMP%]   .ai-control[_ngcontent-%COMP%]   .ai-ball[_ngcontent-%COMP%]{width:80%;height:80%}.active[_ngcontent-%COMP%]{box-shadow:0 0 3px 2px #dad3d3;background-color:#fff;transition:all .5s}.not-active[_ngcontent-%COMP%]{box-shadow:none;background-color:transparent;transition:all .5s}"]});let l=c;return l})(),r0=function(l){return l.MAP_VIEW="mapView",l.BUBBLE_VIEW="bubbleView",l.DEVICE_VIEW="deviceView",l}(r0||{});var jA=(()=>{let c=class c{constructor(){}ngOnInit(){}};c.\u0275fac=function(b){return new(b||c)},c.\u0275cmp=To({type:c,selectors:[["app-topbar"]],standalone:!0,features:[Eo],decls:7,vars:0,consts:[[1,"container"],[1,"regions"],["src","../../assets/topbar-regions.svg"],[1,"filters-profile"],["src","../../assets/topbar-filters.svg"],["src","../../assets/topbar-profile.svg"]],template:function(b,r){b&1&&(Hr(0,"div",0)(1,"div",1),Tr(2,"img",2),Gp(3," Regiony "),qr(),Hr(4,"div",3),Tr(5,"img",4)(6,"img",5),qr()())},styles:[".container[_ngcontent-%COMP%]{position:absolute;top:32px;left:32px;z-index:800;width:236px;height:48px;display:flex;justify-content:space-between;align-items:center}.container[_ngcontent-%COMP%]   .regions[_ngcontent-%COMP%]{width:118px;height:48px;border-radius:8px;background-color:#fff;box-shadow:0 0 2px 1px #dad3d3;display:flex;font-size:large;justify-content:space-evenly;align-items:center;cursor:pointer}.container[_ngcontent-%COMP%]   .filters-profile[_ngcontent-%COMP%]{width:104px;height:48px;display:flex;justify-content:space-around;align-items:center}.container[_ngcontent-%COMP%]   .filters-profile[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{cursor:pointer}"]});let l=c;return l})();var VA=(()=>{let c=class c{constructor(){this.title="sencity"}};c.\u0275fac=function(b){return new(b||c)},c.\u0275cmp=To({type:c,selectors:[["app-root"]],standalone:!0,features:[Eo],decls:4,vars:0,consts:[["id","main",2,"height","100%","width","100%","position","absolute","top","0","left","0"]],template:function(b,r){b&1&&(Hr(0,"div",0),Tr(1,"router-outlet"),qr(),Tr(2,"app-toolbar")(3,"app-topbar"))},dependencies:[du,Aw,BA,jA]});let l=c;return l})();Z2(VA,zA).catch(l=>console.error(l));
