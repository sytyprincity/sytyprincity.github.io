var n3=Object.create;var ib=Object.defineProperty,r3=Object.defineProperties,i3=Object.getOwnPropertyDescriptor,o3=Object.getOwnPropertyDescriptors,s3=Object.getOwnPropertyNames,by=Object.getOwnPropertySymbols,a3=Object.getPrototypeOf,ob=Object.prototype.hasOwnProperty,mS=Object.prototype.propertyIsEnumerable;var pS=(s,a,f)=>a in s?ib(s,a,{enumerable:!0,configurable:!0,writable:!0,value:f}):s[a]=f,kt=(s,a)=>{for(var f in a||={})ob.call(a,f)&&pS(s,f,a[f]);if(by)for(var f of by(a))mS.call(a,f)&&pS(s,f,a[f]);return s},_r=(s,a)=>r3(s,o3(a));var sb=(s,a)=>{var f={};for(var p in s)ob.call(s,p)&&a.indexOf(p)<0&&(f[p]=s[p]);if(s!=null&&by)for(var p of by(s))a.indexOf(p)<0&&mS.call(s,p)&&(f[p]=s[p]);return f};var l3=(s,a)=>()=>(a||s((a={exports:{}}).exports,a),a.exports);var c3=(s,a,f,p)=>{if(a&&typeof a=="object"||typeof a=="function")for(let _ of s3(a))!ob.call(s,_)&&_!==f&&ib(s,_,{get:()=>a[_],enumerable:!(p=i3(a,_))||p.enumerable});return s};var gS=(s,a,f)=>(f=s!=null?n3(a3(s)):{},c3(a||!s||!s.__esModule?ib(f,"default",{value:s,enumerable:!0}):f,s));var FE=l3((kE,LE)=>{"use strict";(function(s,a){typeof kE=="object"&&typeof LE<"u"?LE.exports=a():typeof define=="function"&&define.amd?define(a):(s=typeof globalThis<"u"?globalThis:s||self,s.mapboxgl=a())})(kE,function(){"use strict";var s,a,f;function p(r,C){if(!s)s=C;else if(!a)a=C;else{var A="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+a+")(sharedChunk); self.onerror = null;",k={};s(k),f=C(k),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(f.workerUrl=window.URL.createObjectURL(new Blob([A],{type:"text/javascript"})))}}p(["exports"],function(r){var C="3.5.0";let A,k={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(A==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{A=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{A=t}}return A},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!k.API_URL)return null;try{let t=new URL(k.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function B(t){return k.API_URL_REGEX.test(t)}function Z(t){return t.indexOf("mapbox:")===0}function he(t){return k.API_CDN_URL_REGEX.test(t)}function xe(t){return k.API_SPRITE_REGEX.test(t)}function _e(t){return k.API_STYLE_REGEX.test(t)&&!xe(t)}let Je={create:"create",load:"load",fullLoad:"fullLoad"},Ge={mark(t){performance.mark(t)},measure(t,e,n){performance.measure(t,e,n)}};function Ve(t){let e=t.name.split("?")[0];return he(e)&&e.includes("mapbox-gl.js")?"javascript":he(e)&&e.includes("mapbox-gl.css")?"css":function(n){return k.API_FONTS_REGEX.test(n)}(e)?"fontRange":xe(e)?"sprite":_e(e)?"style":function(n){return k.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function We(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ct={},gt={};Object.defineProperty(gt,"__esModule",{value:!0}),gt.setMatrixArrayType=function(t){gt.ARRAY_TYPE=St=t},gt.toRadian=function(t){return t*dn},gt.equals=function(t,e){return Math.abs(t-e)<=Be*Math.max(1,Math.abs(t),Math.abs(e))},gt.RANDOM=gt.ARRAY_TYPE=gt.EPSILON=void 0;var Be=1e-6;gt.EPSILON=Be;var St=typeof Float32Array<"u"?Float32Array:Array;gt.ARRAY_TYPE=St;var qt=Math.random;gt.RANDOM=qt;var dn=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Tt={};function Gn(t){return Gn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gn(t)}Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.create=function(){var t=new wt.ARRAY_TYPE(4);return wt.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Tt.clone=function(t){var e=new wt.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Tt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Tt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Tt.fromValues=function(t,e,n,o){var l=new wt.ARRAY_TYPE(4);return l[0]=t,l[1]=e,l[2]=n,l[3]=o,l},Tt.set=function(t,e,n,o,l){return t[0]=e,t[1]=n,t[2]=o,t[3]=l,t},Tt.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Tt.invert=function(t,e){var n=e[0],o=e[1],l=e[2],u=e[3],h=n*u-l*o;return h?(t[0]=u*(h=1/h),t[1]=-o*h,t[2]=-l*h,t[3]=n*h,t):null},Tt.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},Tt.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Tt.multiply=jr,Tt.rotate=function(t,e,n){var o=e[0],l=e[1],u=e[2],h=e[3],g=Math.sin(n),y=Math.cos(n);return t[0]=o*y+u*g,t[1]=l*y+h*g,t[2]=o*-g+u*y,t[3]=l*-g+h*y,t},Tt.scale=function(t,e,n){var o=e[1],l=e[2],u=e[3],h=n[0],g=n[1];return t[0]=e[0]*h,t[1]=o*h,t[2]=l*g,t[3]=u*g,t},Tt.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=-n,t[3]=o,t},Tt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Tt.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Tt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Tt.LDU=function(t,e,n,o){return t[2]=o[2]/o[0],n[0]=o[0],n[1]=o[1],n[3]=o[3]-t[2]*n[1],[t,e,n]},Tt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Tt.subtract=Ur,Tt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Tt.equals=function(t,e){var n=t[0],o=t[1],l=t[2],u=t[3],h=e[0],g=e[1],y=e[2],b=e[3];return Math.abs(n-h)<=wt.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-g)<=wt.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(l-y)<=wt.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(u-b)<=wt.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))},Tt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Tt.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t},Tt.sub=Tt.mul=void 0;var wt=function(t,e){if(t&&t.__esModule)return t;if(t===null||Gn(t)!=="object"&&typeof t!="function")return{default:t};var n=ar(void 0);if(n&&n.has(t))return n.get(t);var o={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(gt);function ar(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ar=function(o){return o?n:e})(t)}function jr(t,e,n){var o=e[0],l=e[1],u=e[2],h=e[3],g=n[0],y=n[1],b=n[2],T=n[3];return t[0]=o*g+u*y,t[1]=l*g+h*y,t[2]=o*b+u*T,t[3]=l*b+h*T,t}function Ur(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}Tt.mul=jr,Tt.sub=Ur;var En={};function Hs(t){return Hs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hs(t)}Object.defineProperty(En,"__esModule",{value:!0}),En.create=function(){var t=new ni.ARRAY_TYPE(6);return ni.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},En.clone=function(t){var e=new ni.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},En.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},En.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},En.fromValues=function(t,e,n,o,l,u){var h=new ni.ARRAY_TYPE(6);return h[0]=t,h[1]=e,h[2]=n,h[3]=o,h[4]=l,h[5]=u,h},En.set=function(t,e,n,o,l,u,h){return t[0]=e,t[1]=n,t[2]=o,t[3]=l,t[4]=u,t[5]=h,t},En.invert=function(t,e){var n=e[0],o=e[1],l=e[2],u=e[3],h=e[4],g=e[5],y=n*u-o*l;return y?(t[0]=u*(y=1/y),t[1]=-o*y,t[2]=-l*y,t[3]=n*y,t[4]=(l*g-u*h)*y,t[5]=(o*h-n*g)*y,t):null},En.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},En.multiply=Ws,En.rotate=function(t,e,n){var o=e[0],l=e[1],u=e[2],h=e[3],g=e[4],y=e[5],b=Math.sin(n),T=Math.cos(n);return t[0]=o*T+u*b,t[1]=l*T+h*b,t[2]=o*-b+u*T,t[3]=l*-b+h*T,t[4]=g,t[5]=y,t},En.scale=function(t,e,n){var o=e[1],l=e[2],u=e[3],h=e[4],g=e[5],y=n[0],b=n[1];return t[0]=e[0]*y,t[1]=o*y,t[2]=l*b,t[3]=u*b,t[4]=h,t[5]=g,t},En.translate=function(t,e,n){var o=e[0],l=e[1],u=e[2],h=e[3],g=e[4],y=e[5],b=n[0],T=n[1];return t[0]=o,t[1]=l,t[2]=u,t[3]=h,t[4]=o*b+u*T+g,t[5]=l*b+h*T+y,t},En.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=-n,t[3]=o,t[4]=0,t[5]=0,t},En.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},En.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},En.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},En.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},En.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},En.subtract=mo,En.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},En.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t},En.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},En.equals=function(t,e){var n=t[0],o=t[1],l=t[2],u=t[3],h=t[4],g=t[5],y=e[0],b=e[1],T=e[2],I=e[3],D=e[4],P=e[5];return Math.abs(n-y)<=ni.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-b)<=ni.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(l-T)<=ni.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(u-I)<=ni.EPSILON*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(h-D)<=ni.EPSILON*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(g-P)<=ni.EPSILON*Math.max(1,Math.abs(g),Math.abs(P))},En.sub=En.mul=void 0;var ni=function(t,e){if(t&&t.__esModule)return t;if(t===null||Hs(t)!=="object"&&typeof t!="function")return{default:t};var n=qs(void 0);if(n&&n.has(t))return n.get(t);var o={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(gt);function qs(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(qs=function(o){return o?n:e})(t)}function Ws(t,e,n){var o=e[0],l=e[1],u=e[2],h=e[3],g=e[4],y=e[5],b=n[0],T=n[1],I=n[2],D=n[3],P=n[4],R=n[5];return t[0]=o*b+u*T,t[1]=l*b+h*T,t[2]=o*I+u*D,t[3]=l*I+h*D,t[4]=o*P+u*R+g,t[5]=l*P+h*R+y,t}function mo(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}En.mul=Ws,En.sub=mo;var fn={};function Va(t){return Va=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Va(t)}Object.defineProperty(fn,"__esModule",{value:!0}),fn.create=function(){var t=new $r.ARRAY_TYPE(9);return $r.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},fn.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},fn.clone=function(t){var e=new $r.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fn.fromValues=function(t,e,n,o,l,u,h,g,y){var b=new $r.ARRAY_TYPE(9);return b[0]=t,b[1]=e,b[2]=n,b[3]=o,b[4]=l,b[5]=u,b[6]=h,b[7]=g,b[8]=y,b},fn.set=function(t,e,n,o,l,u,h,g,y,b){return t[0]=e,t[1]=n,t[2]=o,t[3]=l,t[4]=u,t[5]=h,t[6]=g,t[7]=y,t[8]=b,t},fn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fn.transpose=function(t,e){if(t===e){var n=e[1],o=e[2],l=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=o,t[7]=l}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},fn.invert=function(t,e){var n=e[0],o=e[1],l=e[2],u=e[3],h=e[4],g=e[5],y=e[6],b=e[7],T=e[8],I=T*h-g*b,D=-T*u+g*y,P=b*u-h*y,R=n*I+o*D+l*P;return R?(t[0]=I*(R=1/R),t[1]=(-T*o+l*b)*R,t[2]=(g*o-l*h)*R,t[3]=D*R,t[4]=(T*n-l*y)*R,t[5]=(-g*n+l*u)*R,t[6]=P*R,t[7]=(-b*n+o*y)*R,t[8]=(h*n-o*u)*R,t):null},fn.adjoint=function(t,e){var n=e[0],o=e[1],l=e[2],u=e[3],h=e[4],g=e[5],y=e[6],b=e[7],T=e[8];return t[0]=h*T-g*b,t[1]=l*b-o*T,t[2]=o*g-l*h,t[3]=g*y-u*T,t[4]=n*T-l*y,t[5]=l*u-n*g,t[6]=u*b-h*y,t[7]=o*y-n*b,t[8]=n*h-o*u,t},fn.determinant=function(t){var e=t[3],n=t[4],o=t[5],l=t[6],u=t[7],h=t[8];return t[0]*(h*n-o*u)+t[1]*(-h*e+o*l)+t[2]*(u*e-n*l)},fn.multiply=ih,fn.translate=function(t,e,n){var o=e[0],l=e[1],u=e[2],h=e[3],g=e[4],y=e[5],b=e[6],T=e[7],I=e[8],D=n[0],P=n[1];return t[0]=o,t[1]=l,t[2]=u,t[3]=h,t[4]=g,t[5]=y,t[6]=D*o+P*h+b,t[7]=D*l+P*g+T,t[8]=D*u+P*y+I,t},fn.rotate=function(t,e,n){var o=e[0],l=e[1],u=e[2],h=e[3],g=e[4],y=e[5],b=e[6],T=e[7],I=e[8],D=Math.sin(n),P=Math.cos(n);return t[0]=P*o+D*h,t[1]=P*l+D*g,t[2]=P*u+D*y,t[3]=P*h-D*o,t[4]=P*g-D*l,t[5]=P*y-D*u,t[6]=b,t[7]=T,t[8]=I,t},fn.scale=function(t,e,n){var o=n[0],l=n[1];return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=l*e[3],t[4]=l*e[4],t[5]=l*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},fn.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=-n,t[4]=o,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fn.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},fn.fromQuat=function(t,e){var n=e[0],o=e[1],l=e[2],u=e[3],h=n+n,g=o+o,y=l+l,b=n*h,T=o*h,I=o*g,D=l*h,P=l*g,R=l*y,L=u*h,N=u*g,j=u*y;return t[0]=1-I-R,t[3]=T-j,t[6]=D+N,t[1]=T+j,t[4]=1-b-R,t[7]=P-L,t[2]=D-N,t[5]=P+L,t[8]=1-b-I,t},fn.normalFromMat4=function(t,e){var n=e[0],o=e[1],l=e[2],u=e[3],h=e[4],g=e[5],y=e[6],b=e[7],T=e[8],I=e[9],D=e[10],P=e[11],R=e[12],L=e[13],N=e[14],j=e[15],Y=n*g-o*h,X=n*y-l*h,K=n*b-u*h,ae=o*y-l*g,oe=o*b-u*g,fe=l*b-u*y,me=T*L-I*R,we=T*N-D*R,Pe=T*j-P*R,Ce=I*N-D*L,Le=I*j-P*L,Ye=D*j-P*N,Oe=Y*Ye-X*Le+K*Ce+ae*Pe-oe*we+fe*me;return Oe?(t[0]=(g*Ye-y*Le+b*Ce)*(Oe=1/Oe),t[1]=(y*Pe-h*Ye-b*we)*Oe,t[2]=(h*Le-g*Pe+b*me)*Oe,t[3]=(l*Le-o*Ye-u*Ce)*Oe,t[4]=(n*Ye-l*Pe+u*we)*Oe,t[5]=(o*Pe-n*Le-u*me)*Oe,t[6]=(L*fe-N*oe+j*ae)*Oe,t[7]=(N*K-R*fe-j*X)*Oe,t[8]=(R*oe-L*K+j*Y)*Oe,t):null},fn.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},fn.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},fn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},fn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},fn.subtract=oh,fn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},fn.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t[6]=e[6]+n[6]*o,t[7]=e[7]+n[7]*o,t[8]=e[8]+n[8]*o,t},fn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},fn.equals=function(t,e){var n=t[0],o=t[1],l=t[2],u=t[3],h=t[4],g=t[5],y=t[6],b=t[7],T=t[8],I=e[0],D=e[1],P=e[2],R=e[3],L=e[4],N=e[5],j=e[6],Y=e[7],X=e[8];return Math.abs(n-I)<=$r.EPSILON*Math.max(1,Math.abs(n),Math.abs(I))&&Math.abs(o-D)<=$r.EPSILON*Math.max(1,Math.abs(o),Math.abs(D))&&Math.abs(l-P)<=$r.EPSILON*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(u-R)<=$r.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(h-L)<=$r.EPSILON*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(g-N)<=$r.EPSILON*Math.max(1,Math.abs(g),Math.abs(N))&&Math.abs(y-j)<=$r.EPSILON*Math.max(1,Math.abs(y),Math.abs(j))&&Math.abs(b-Y)<=$r.EPSILON*Math.max(1,Math.abs(b),Math.abs(Y))&&Math.abs(T-X)<=$r.EPSILON*Math.max(1,Math.abs(T),Math.abs(X))},fn.sub=fn.mul=void 0;var $r=function(t,e){if(t&&t.__esModule)return t;if(t===null||Va(t)!=="object"&&typeof t!="function")return{default:t};var n=rh(void 0);if(n&&n.has(t))return n.get(t);var o={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(gt);function rh(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(rh=function(o){return o?n:e})(t)}function ih(t,e,n){var o=e[0],l=e[1],u=e[2],h=e[3],g=e[4],y=e[5],b=e[6],T=e[7],I=e[8],D=n[0],P=n[1],R=n[2],L=n[3],N=n[4],j=n[5],Y=n[6],X=n[7],K=n[8];return t[0]=D*o+P*h+R*b,t[1]=D*l+P*g+R*T,t[2]=D*u+P*y+R*I,t[3]=L*o+N*h+j*b,t[4]=L*l+N*g+j*T,t[5]=L*u+N*y+j*I,t[6]=Y*o+X*h+K*b,t[7]=Y*l+X*g+K*T,t[8]=Y*u+X*y+K*I,t}function oh(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}fn.mul=ih,fn.sub=oh;var Pt={};function ja(t){return ja=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ja(t)}Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.create=function(){var t=new Hn.ARRAY_TYPE(16);return Hn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Pt.clone=function(t){var e=new Hn.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Pt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Pt.fromValues=function(t,e,n,o,l,u,h,g,y,b,T,I,D,P,R,L){var N=new Hn.ARRAY_TYPE(16);return N[0]=t,N[1]=e,N[2]=n,N[3]=o,N[4]=l,N[5]=u,N[6]=h,N[7]=g,N[8]=y,N[9]=b,N[10]=T,N[11]=I,N[12]=D,N[13]=P,N[14]=R,N[15]=L,N},Pt.set=function(t,e,n,o,l,u,h,g,y,b,T,I,D,P,R,L,N){return t[0]=e,t[1]=n,t[2]=o,t[3]=l,t[4]=u,t[5]=h,t[6]=g,t[7]=y,t[8]=b,t[9]=T,t[10]=I,t[11]=D,t[12]=P,t[13]=R,t[14]=L,t[15]=N,t},Pt.identity=ah,Pt.transpose=function(t,e){if(t===e){var n=e[1],o=e[2],l=e[3],u=e[6],h=e[7],g=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=o,t[9]=u,t[11]=e[14],t[12]=l,t[13]=h,t[14]=g}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Pt.invert=function(t,e){var n=e[0],o=e[1],l=e[2],u=e[3],h=e[4],g=e[5],y=e[6],b=e[7],T=e[8],I=e[9],D=e[10],P=e[11],R=e[12],L=e[13],N=e[14],j=e[15],Y=n*g-o*h,X=n*y-l*h,K=n*b-u*h,ae=o*y-l*g,oe=o*b-u*g,fe=l*b-u*y,me=T*L-I*R,we=T*N-D*R,Pe=T*j-P*R,Ce=I*N-D*L,Le=I*j-P*L,Ye=D*j-P*N,Oe=Y*Ye-X*Le+K*Ce+ae*Pe-oe*we+fe*me;return Oe?(t[0]=(g*Ye-y*Le+b*Ce)*(Oe=1/Oe),t[1]=(l*Le-o*Ye-u*Ce)*Oe,t[2]=(L*fe-N*oe+j*ae)*Oe,t[3]=(D*oe-I*fe-P*ae)*Oe,t[4]=(y*Pe-h*Ye-b*we)*Oe,t[5]=(n*Ye-l*Pe+u*we)*Oe,t[6]=(N*K-R*fe-j*X)*Oe,t[7]=(T*fe-D*K+P*X)*Oe,t[8]=(h*Le-g*Pe+b*me)*Oe,t[9]=(o*Pe-n*Le-u*me)*Oe,t[10]=(R*oe-L*K+j*Y)*Oe,t[11]=(I*K-T*oe-P*Y)*Oe,t[12]=(g*we-h*Ce-y*me)*Oe,t[13]=(n*Ce-o*we+l*me)*Oe,t[14]=(L*X-R*ae-N*Y)*Oe,t[15]=(T*ae-I*X+D*Y)*Oe,t):null},Pt.adjoint=function(t,e){var n=e[0],o=e[1],l=e[2],u=e[3],h=e[4],g=e[5],y=e[6],b=e[7],T=e[8],I=e[9],D=e[10],P=e[11],R=e[12],L=e[13],N=e[14],j=e[15];return t[0]=g*(D*j-P*N)-I*(y*j-b*N)+L*(y*P-b*D),t[1]=-(o*(D*j-P*N)-I*(l*j-u*N)+L*(l*P-u*D)),t[2]=o*(y*j-b*N)-g*(l*j-u*N)+L*(l*b-u*y),t[3]=-(o*(y*P-b*D)-g*(l*P-u*D)+I*(l*b-u*y)),t[4]=-(h*(D*j-P*N)-T*(y*j-b*N)+R*(y*P-b*D)),t[5]=n*(D*j-P*N)-T*(l*j-u*N)+R*(l*P-u*D),t[6]=-(n*(y*j-b*N)-h*(l*j-u*N)+R*(l*b-u*y)),t[7]=n*(y*P-b*D)-h*(l*P-u*D)+T*(l*b-u*y),t[8]=h*(I*j-P*L)-T*(g*j-b*L)+R*(g*P-b*I),t[9]=-(n*(I*j-P*L)-T*(o*j-u*L)+R*(o*P-u*I)),t[10]=n*(g*j-b*L)-h*(o*j-u*L)+R*(o*b-u*g),t[11]=-(n*(g*P-b*I)-h*(o*P-u*I)+T*(o*b-u*g)),t[12]=-(h*(I*N-D*L)-T*(g*N-y*L)+R*(g*D-y*I)),t[13]=n*(I*N-D*L)-T*(o*N-l*L)+R*(o*D-l*I),t[14]=-(n*(g*N-y*L)-h*(o*N-l*L)+R*(o*y-l*g)),t[15]=n*(g*D-y*I)-h*(o*D-l*I)+T*(o*y-l*g),t},Pt.determinant=function(t){var e=t[0],n=t[1],o=t[2],l=t[3],u=t[4],h=t[5],g=t[6],y=t[7],b=t[8],T=t[9],I=t[10],D=t[11],P=t[12],R=t[13],L=t[14],N=t[15];return(e*h-n*u)*(I*N-D*L)-(e*g-o*u)*(T*N-D*R)+(e*y-l*u)*(T*L-I*R)+(n*g-o*h)*(b*N-D*P)-(n*y-l*h)*(b*L-I*P)+(o*y-l*g)*(b*R-T*P)},Pt.multiply=lh,Pt.translate=function(t,e,n){var o,l,u,h,g,y,b,T,I,D,P,R,L=n[0],N=n[1],j=n[2];return e===t?(t[12]=e[0]*L+e[4]*N+e[8]*j+e[12],t[13]=e[1]*L+e[5]*N+e[9]*j+e[13],t[14]=e[2]*L+e[6]*N+e[10]*j+e[14],t[15]=e[3]*L+e[7]*N+e[11]*j+e[15]):(l=e[1],u=e[2],h=e[3],g=e[4],y=e[5],b=e[6],T=e[7],I=e[8],D=e[9],P=e[10],R=e[11],t[0]=o=e[0],t[1]=l,t[2]=u,t[3]=h,t[4]=g,t[5]=y,t[6]=b,t[7]=T,t[8]=I,t[9]=D,t[10]=P,t[11]=R,t[12]=o*L+g*N+I*j+e[12],t[13]=l*L+y*N+D*j+e[13],t[14]=u*L+b*N+P*j+e[14],t[15]=h*L+T*N+R*j+e[15]),t},Pt.scale=function(t,e,n){var o=n[0],l=n[1],u=n[2];return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*l,t[5]=e[5]*l,t[6]=e[6]*l,t[7]=e[7]*l,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Pt.rotate=function(t,e,n,o){var l,u,h,g,y,b,T,I,D,P,R,L,N,j,Y,X,K,ae,oe,fe,me,we,Pe,Ce,Le=o[0],Ye=o[1],Oe=o[2],He=Math.hypot(Le,Ye,Oe);return He<Hn.EPSILON?null:(Le*=He=1/He,Ye*=He,Oe*=He,l=Math.sin(n),u=Math.cos(n),y=e[1],b=e[2],T=e[3],D=e[5],P=e[6],R=e[7],N=e[9],j=e[10],Y=e[11],X=Le*Le*(h=1-u)+u,oe=Le*Ye*h-Oe*l,fe=Ye*Ye*h+u,me=Oe*Ye*h+Le*l,we=Le*Oe*h+Ye*l,Pe=Ye*Oe*h-Le*l,Ce=Oe*Oe*h+u,t[0]=(g=e[0])*X+(I=e[4])*(K=Ye*Le*h+Oe*l)+(L=e[8])*(ae=Oe*Le*h-Ye*l),t[1]=y*X+D*K+N*ae,t[2]=b*X+P*K+j*ae,t[3]=T*X+R*K+Y*ae,t[4]=g*oe+I*fe+L*me,t[5]=y*oe+D*fe+N*me,t[6]=b*oe+P*fe+j*me,t[7]=T*oe+R*fe+Y*me,t[8]=g*we+I*Pe+L*Ce,t[9]=y*we+D*Pe+N*Ce,t[10]=b*we+P*Pe+j*Ce,t[11]=T*we+R*Pe+Y*Ce,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Pt.rotateX=function(t,e,n){var o=Math.sin(n),l=Math.cos(n),u=e[4],h=e[5],g=e[6],y=e[7],b=e[8],T=e[9],I=e[10],D=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*l+b*o,t[5]=h*l+T*o,t[6]=g*l+I*o,t[7]=y*l+D*o,t[8]=b*l-u*o,t[9]=T*l-h*o,t[10]=I*l-g*o,t[11]=D*l-y*o,t},Pt.rotateY=function(t,e,n){var o=Math.sin(n),l=Math.cos(n),u=e[0],h=e[1],g=e[2],y=e[3],b=e[8],T=e[9],I=e[10],D=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*l-b*o,t[1]=h*l-T*o,t[2]=g*l-I*o,t[3]=y*l-D*o,t[8]=u*o+b*l,t[9]=h*o+T*l,t[10]=g*o+I*l,t[11]=y*o+D*l,t},Pt.rotateZ=function(t,e,n){var o=Math.sin(n),l=Math.cos(n),u=e[0],h=e[1],g=e[2],y=e[3],b=e[4],T=e[5],I=e[6],D=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*l+b*o,t[1]=h*l+T*o,t[2]=g*l+I*o,t[3]=y*l+D*o,t[4]=b*l-u*o,t[5]=T*l-h*o,t[6]=I*l-g*o,t[7]=D*l-y*o,t},Pt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Pt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Pt.fromRotation=function(t,e,n){var o,l,u,h=n[0],g=n[1],y=n[2],b=Math.hypot(h,g,y);return b<Hn.EPSILON?null:(h*=b=1/b,g*=b,y*=b,o=Math.sin(e),l=Math.cos(e),t[0]=h*h*(u=1-l)+l,t[1]=g*h*u+y*o,t[2]=y*h*u-g*o,t[3]=0,t[4]=h*g*u-y*o,t[5]=g*g*u+l,t[6]=y*g*u+h*o,t[7]=0,t[8]=h*y*u+g*o,t[9]=g*y*u-h*o,t[10]=y*y*u+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Pt.fromXRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Pt.fromYRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Pt.fromZRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Pt.fromRotationTranslation=mc,Pt.fromQuat2=function(t,e){var n=new Hn.ARRAY_TYPE(3),o=-e[0],l=-e[1],u=-e[2],h=e[3],g=e[4],y=e[5],b=e[6],T=e[7],I=o*o+l*l+u*u+h*h;return I>0?(n[0]=2*(g*h+T*o+y*u-b*l)/I,n[1]=2*(y*h+T*l+b*o-g*u)/I,n[2]=2*(b*h+T*u+g*l-y*o)/I):(n[0]=2*(g*h+T*o+y*u-b*l),n[1]=2*(y*h+T*l+b*o-g*u),n[2]=2*(b*h+T*u+g*l-y*o)),mc(t,e,n),t},Pt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Pt.getScaling=Ua,Pt.getRotation=function(t,e){var n=new Hn.ARRAY_TYPE(3);Ua(n,e);var o=1/n[0],l=1/n[1],u=1/n[2],h=e[0]*o,g=e[1]*l,y=e[2]*u,b=e[4]*o,T=e[5]*l,I=e[6]*u,D=e[8]*o,P=e[9]*l,R=e[10]*u,L=h+T+R,N=0;return L>0?(N=2*Math.sqrt(L+1),t[3]=.25*N,t[0]=(I-P)/N,t[1]=(D-y)/N,t[2]=(g-b)/N):h>T&&h>R?(N=2*Math.sqrt(1+h-T-R),t[3]=(I-P)/N,t[0]=.25*N,t[1]=(g+b)/N,t[2]=(D+y)/N):T>R?(N=2*Math.sqrt(1+T-h-R),t[3]=(D-y)/N,t[0]=(g+b)/N,t[1]=.25*N,t[2]=(I+P)/N):(N=2*Math.sqrt(1+R-h-T),t[3]=(g-b)/N,t[0]=(D+y)/N,t[1]=(I+P)/N,t[2]=.25*N),t},Pt.fromRotationTranslationScale=function(t,e,n,o){var l=e[0],u=e[1],h=e[2],g=e[3],y=l+l,b=u+u,T=h+h,I=l*y,D=l*b,P=l*T,R=u*b,L=u*T,N=h*T,j=g*y,Y=g*b,X=g*T,K=o[0],ae=o[1],oe=o[2];return t[0]=(1-(R+N))*K,t[1]=(D+X)*K,t[2]=(P-Y)*K,t[3]=0,t[4]=(D-X)*ae,t[5]=(1-(I+N))*ae,t[6]=(L+j)*ae,t[7]=0,t[8]=(P+Y)*oe,t[9]=(L-j)*oe,t[10]=(1-(I+R))*oe,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},Pt.fromRotationTranslationScaleOrigin=function(t,e,n,o,l){var u=e[0],h=e[1],g=e[2],y=e[3],b=u+u,T=h+h,I=g+g,D=u*b,P=u*T,R=u*I,L=h*T,N=h*I,j=g*I,Y=y*b,X=y*T,K=y*I,ae=o[0],oe=o[1],fe=o[2],me=l[0],we=l[1],Pe=l[2],Ce=(1-(L+j))*ae,Le=(P+K)*ae,Ye=(R-X)*ae,Oe=(P-K)*oe,He=(1-(D+j))*oe,Re=(N+Y)*oe,qe=(R+X)*fe,Qe=(N-Y)*fe,Ze=(1-(D+L))*fe;return t[0]=Ce,t[1]=Le,t[2]=Ye,t[3]=0,t[4]=Oe,t[5]=He,t[6]=Re,t[7]=0,t[8]=qe,t[9]=Qe,t[10]=Ze,t[11]=0,t[12]=n[0]+me-(Ce*me+Oe*we+qe*Pe),t[13]=n[1]+we-(Le*me+He*we+Qe*Pe),t[14]=n[2]+Pe-(Ye*me+Re*we+Ze*Pe),t[15]=1,t},Pt.fromQuat=function(t,e){var n=e[0],o=e[1],l=e[2],u=e[3],h=n+n,g=o+o,y=l+l,b=n*h,T=o*h,I=o*g,D=l*h,P=l*g,R=l*y,L=u*h,N=u*g,j=u*y;return t[0]=1-I-R,t[1]=T+j,t[2]=D-N,t[3]=0,t[4]=T-j,t[5]=1-b-R,t[6]=P+L,t[7]=0,t[8]=D+N,t[9]=P-L,t[10]=1-b-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Pt.frustum=function(t,e,n,o,l,u,h){var g=1/(n-e),y=1/(l-o),b=1/(u-h);return t[0]=2*u*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*u*y,t[6]=0,t[7]=0,t[8]=(n+e)*g,t[9]=(l+o)*y,t[10]=(h+u)*b,t[11]=-1,t[12]=0,t[13]=0,t[14]=h*u*2*b,t[15]=0,t},Pt.perspectiveNO=Yi,Pt.perspectiveZO=function(t,e,n,o,l){var u,h=1/Math.tan(e/2);return t[0]=h/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=l*(u=1/(o-l)),t[14]=l*o*u):(t[10]=-1,t[14]=-o),t},Pt.perspectiveFromFieldOfView=function(t,e,n,o){var l=Math.tan(e.upDegrees*Math.PI/180),u=Math.tan(e.downDegrees*Math.PI/180),h=Math.tan(e.leftDegrees*Math.PI/180),g=Math.tan(e.rightDegrees*Math.PI/180),y=2/(h+g),b=2/(l+u);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=b,t[6]=0,t[7]=0,t[8]=-(h-g)*y*.5,t[9]=(l-u)*b*.5,t[10]=o/(n-o),t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n/(n-o),t[15]=0,t},Pt.orthoNO=Xi,Pt.orthoZO=function(t,e,n,o,l,u,h){var g=1/(e-n),y=1/(o-l),b=1/(u-h);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=b,t[11]=0,t[12]=(e+n)*g,t[13]=(l+o)*y,t[14]=u*b,t[15]=1,t},Pt.lookAt=function(t,e,n,o){var l,u,h,g,y,b,T,I,D,P,R=e[0],L=e[1],N=e[2],j=o[0],Y=o[1],X=o[2],K=n[0],ae=n[1],oe=n[2];return Math.abs(R-K)<Hn.EPSILON&&Math.abs(L-ae)<Hn.EPSILON&&Math.abs(N-oe)<Hn.EPSILON?ah(t):(T=R-K,I=L-ae,D=N-oe,l=Y*(D*=P=1/Math.hypot(T,I,D))-X*(I*=P),u=X*(T*=P)-j*D,h=j*I-Y*T,(P=Math.hypot(l,u,h))?(l*=P=1/P,u*=P,h*=P):(l=0,u=0,h=0),g=I*h-D*u,y=D*l-T*h,b=T*u-I*l,(P=Math.hypot(g,y,b))?(g*=P=1/P,y*=P,b*=P):(g=0,y=0,b=0),t[0]=l,t[1]=g,t[2]=T,t[3]=0,t[4]=u,t[5]=y,t[6]=I,t[7]=0,t[8]=h,t[9]=b,t[10]=D,t[11]=0,t[12]=-(l*R+u*L+h*N),t[13]=-(g*R+y*L+b*N),t[14]=-(T*R+I*L+D*N),t[15]=1,t)},Pt.targetTo=function(t,e,n,o){var l=e[0],u=e[1],h=e[2],g=o[0],y=o[1],b=o[2],T=l-n[0],I=u-n[1],D=h-n[2],P=T*T+I*I+D*D;P>0&&(T*=P=1/Math.sqrt(P),I*=P,D*=P);var R=y*D-b*I,L=b*T-g*D,N=g*I-y*T;return(P=R*R+L*L+N*N)>0&&(R*=P=1/Math.sqrt(P),L*=P,N*=P),t[0]=R,t[1]=L,t[2]=N,t[3]=0,t[4]=I*N-D*L,t[5]=D*R-T*N,t[6]=T*L-I*R,t[7]=0,t[8]=T,t[9]=I,t[10]=D,t[11]=0,t[12]=l,t[13]=u,t[14]=h,t[15]=1,t},Pt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Pt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Pt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},Pt.subtract=gc,Pt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},Pt.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t[6]=e[6]+n[6]*o,t[7]=e[7]+n[7]*o,t[8]=e[8]+n[8]*o,t[9]=e[9]+n[9]*o,t[10]=e[10]+n[10]*o,t[11]=e[11]+n[11]*o,t[12]=e[12]+n[12]*o,t[13]=e[13]+n[13]*o,t[14]=e[14]+n[14]*o,t[15]=e[15]+n[15]*o,t},Pt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Pt.equals=function(t,e){var n=t[0],o=t[1],l=t[2],u=t[3],h=t[4],g=t[5],y=t[6],b=t[7],T=t[8],I=t[9],D=t[10],P=t[11],R=t[12],L=t[13],N=t[14],j=t[15],Y=e[0],X=e[1],K=e[2],ae=e[3],oe=e[4],fe=e[5],me=e[6],we=e[7],Pe=e[8],Ce=e[9],Le=e[10],Ye=e[11],Oe=e[12],He=e[13],Re=e[14],qe=e[15];return Math.abs(n-Y)<=Hn.EPSILON*Math.max(1,Math.abs(n),Math.abs(Y))&&Math.abs(o-X)<=Hn.EPSILON*Math.max(1,Math.abs(o),Math.abs(X))&&Math.abs(l-K)<=Hn.EPSILON*Math.max(1,Math.abs(l),Math.abs(K))&&Math.abs(u-ae)<=Hn.EPSILON*Math.max(1,Math.abs(u),Math.abs(ae))&&Math.abs(h-oe)<=Hn.EPSILON*Math.max(1,Math.abs(h),Math.abs(oe))&&Math.abs(g-fe)<=Hn.EPSILON*Math.max(1,Math.abs(g),Math.abs(fe))&&Math.abs(y-me)<=Hn.EPSILON*Math.max(1,Math.abs(y),Math.abs(me))&&Math.abs(b-we)<=Hn.EPSILON*Math.max(1,Math.abs(b),Math.abs(we))&&Math.abs(T-Pe)<=Hn.EPSILON*Math.max(1,Math.abs(T),Math.abs(Pe))&&Math.abs(I-Ce)<=Hn.EPSILON*Math.max(1,Math.abs(I),Math.abs(Ce))&&Math.abs(D-Le)<=Hn.EPSILON*Math.max(1,Math.abs(D),Math.abs(Le))&&Math.abs(P-Ye)<=Hn.EPSILON*Math.max(1,Math.abs(P),Math.abs(Ye))&&Math.abs(R-Oe)<=Hn.EPSILON*Math.max(1,Math.abs(R),Math.abs(Oe))&&Math.abs(L-He)<=Hn.EPSILON*Math.max(1,Math.abs(L),Math.abs(He))&&Math.abs(N-Re)<=Hn.EPSILON*Math.max(1,Math.abs(N),Math.abs(Re))&&Math.abs(j-qe)<=Hn.EPSILON*Math.max(1,Math.abs(j),Math.abs(qe))},Pt.sub=Pt.mul=Pt.ortho=Pt.perspective=void 0;var Hn=function(t,e){if(t&&t.__esModule)return t;if(t===null||ja(t)!=="object"&&typeof t!="function")return{default:t};var n=sh(void 0);if(n&&n.has(t))return n.get(t);var o={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(gt);function sh(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(sh=function(o){return o?n:e})(t)}function ah(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lh(t,e,n){var o=e[0],l=e[1],u=e[2],h=e[3],g=e[4],y=e[5],b=e[6],T=e[7],I=e[8],D=e[9],P=e[10],R=e[11],L=e[12],N=e[13],j=e[14],Y=e[15],X=n[0],K=n[1],ae=n[2],oe=n[3];return t[0]=X*o+K*g+ae*I+oe*L,t[1]=X*l+K*y+ae*D+oe*N,t[2]=X*u+K*b+ae*P+oe*j,t[3]=X*h+K*T+ae*R+oe*Y,t[4]=(X=n[4])*o+(K=n[5])*g+(ae=n[6])*I+(oe=n[7])*L,t[5]=X*l+K*y+ae*D+oe*N,t[6]=X*u+K*b+ae*P+oe*j,t[7]=X*h+K*T+ae*R+oe*Y,t[8]=(X=n[8])*o+(K=n[9])*g+(ae=n[10])*I+(oe=n[11])*L,t[9]=X*l+K*y+ae*D+oe*N,t[10]=X*u+K*b+ae*P+oe*j,t[11]=X*h+K*T+ae*R+oe*Y,t[12]=(X=n[12])*o+(K=n[13])*g+(ae=n[14])*I+(oe=n[15])*L,t[13]=X*l+K*y+ae*D+oe*N,t[14]=X*u+K*b+ae*P+oe*j,t[15]=X*h+K*T+ae*R+oe*Y,t}function mc(t,e,n){var o=e[0],l=e[1],u=e[2],h=e[3],g=o+o,y=l+l,b=u+u,T=o*g,I=o*y,D=o*b,P=l*y,R=l*b,L=u*b,N=h*g,j=h*y,Y=h*b;return t[0]=1-(P+L),t[1]=I+Y,t[2]=D-j,t[3]=0,t[4]=I-Y,t[5]=1-(T+L),t[6]=R+N,t[7]=0,t[8]=D+j,t[9]=R-N,t[10]=1-(T+P),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Ua(t,e){var n=e[4],o=e[5],l=e[6],u=e[8],h=e[9],g=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,o,l),t[2]=Math.hypot(u,h,g),t}function Yi(t,e,n,o,l){var u,h=1/Math.tan(e/2);return t[0]=h/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=(l+o)*(u=1/(o-l)),t[14]=2*l*o*u):(t[10]=-1,t[14]=-2*o),t}function Xi(t,e,n,o,l,u,h){var g=1/(e-n),y=1/(o-l),b=1/(u-h);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*b,t[11]=0,t[12]=(e+n)*g,t[13]=(l+o)*y,t[14]=(h+u)*b,t[15]=1,t}function gc(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}Pt.perspective=Yi,Pt.ortho=Xi,Pt.mul=lh,Pt.sub=gc;var Mt={},Rt={};function $a(t){return $a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$a(t)}Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.create=Ga,Rt.clone=function(t){var e=new _i.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Rt.length=Ha,Rt.fromValues=function(t,e,n){var o=new _i.ARRAY_TYPE(3);return o[0]=t,o[1]=e,o[2]=n,o},Rt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Rt.set=function(t,e,n,o){return t[0]=e,t[1]=n,t[2]=o,t},Rt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},Rt.subtract=_c,Rt.multiply=cs,Rt.divide=Ys,Rt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Rt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Rt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},Rt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},Rt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Rt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},Rt.scaleAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t},Rt.distance=qa,Rt.squaredDistance=yc,Rt.squaredLength=Wa,Rt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Rt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Rt.normalize=function(t,e){var n=e[0],o=e[1],l=e[2],u=n*n+o*o+l*l;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t[2]=e[2]*u,t},Rt.dot=Za,Rt.cross=function(t,e,n){var o=e[0],l=e[1],u=e[2],h=n[0],g=n[1],y=n[2];return t[0]=l*y-u*g,t[1]=u*h-o*y,t[2]=o*g-l*h,t},Rt.lerp=function(t,e,n,o){var l=e[0],u=e[1],h=e[2];return t[0]=l+o*(n[0]-l),t[1]=u+o*(n[1]-u),t[2]=h+o*(n[2]-h),t},Rt.hermite=function(t,e,n,o,l,u){var h=u*u,g=h*(2*u-3)+1,y=h*(u-2)+u,b=h*(u-1),T=h*(3-2*u);return t[0]=e[0]*g+n[0]*y+o[0]*b+l[0]*T,t[1]=e[1]*g+n[1]*y+o[1]*b+l[1]*T,t[2]=e[2]*g+n[2]*y+o[2]*b+l[2]*T,t},Rt.bezier=function(t,e,n,o,l,u){var h=1-u,g=h*h,y=u*u,b=g*h,T=3*u*g,I=3*y*h,D=y*u;return t[0]=e[0]*b+n[0]*T+o[0]*I+l[0]*D,t[1]=e[1]*b+n[1]*T+o[1]*I+l[1]*D,t[2]=e[2]*b+n[2]*T+o[2]*I+l[2]*D,t},Rt.random=function(t,e){e=e||1;var n=2*_i.RANDOM()*Math.PI,o=2*_i.RANDOM()-1,l=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(n)*l,t[1]=Math.sin(n)*l,t[2]=o*e,t},Rt.transformMat4=function(t,e,n){var o=e[0],l=e[1],u=e[2],h=n[3]*o+n[7]*l+n[11]*u+n[15];return t[0]=(n[0]*o+n[4]*l+n[8]*u+n[12])/(h=h||1),t[1]=(n[1]*o+n[5]*l+n[9]*u+n[13])/h,t[2]=(n[2]*o+n[6]*l+n[10]*u+n[14])/h,t},Rt.transformMat3=function(t,e,n){var o=e[0],l=e[1],u=e[2];return t[0]=o*n[0]+l*n[3]+u*n[6],t[1]=o*n[1]+l*n[4]+u*n[7],t[2]=o*n[2]+l*n[5]+u*n[8],t},Rt.transformQuat=function(t,e,n){var o=n[0],l=n[1],u=n[2],h=e[0],g=e[1],y=e[2],b=l*y-u*g,T=u*h-o*y,I=o*g-l*h,D=l*I-u*T,P=u*b-o*I,R=o*T-l*b,L=2*n[3];return T*=L,I*=L,P*=2,R*=2,t[0]=h+(b*=L)+(D*=2),t[1]=g+T+P,t[2]=y+I+R,t},Rt.rotateX=function(t,e,n,o){var l=[],u=[];return l[0]=e[0]-n[0],l[1]=e[1]-n[1],l[2]=e[2]-n[2],u[0]=l[0],u[1]=l[1]*Math.cos(o)-l[2]*Math.sin(o),u[2]=l[1]*Math.sin(o)+l[2]*Math.cos(o),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},Rt.rotateY=function(t,e,n,o){var l=[],u=[];return l[0]=e[0]-n[0],l[1]=e[1]-n[1],l[2]=e[2]-n[2],u[0]=l[2]*Math.sin(o)+l[0]*Math.cos(o),u[1]=l[1],u[2]=l[2]*Math.cos(o)-l[0]*Math.sin(o),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},Rt.rotateZ=function(t,e,n,o){var l=[],u=[];return l[0]=e[0]-n[0],l[1]=e[1]-n[1],l[2]=e[2]-n[2],u[0]=l[0]*Math.cos(o)-l[1]*Math.sin(o),u[1]=l[0]*Math.sin(o)+l[1]*Math.cos(o),u[2]=l[2],t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},Rt.angle=function(t,e){var n=t[0],o=t[1],l=t[2],u=e[0],h=e[1],g=e[2],y=Math.sqrt(n*n+o*o+l*l)*Math.sqrt(u*u+h*h+g*g),b=y&&Za(t,e)/y;return Math.acos(Math.min(Math.max(b,-1),1))},Rt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Rt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Rt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Rt.equals=function(t,e){var n=t[0],o=t[1],l=t[2],u=e[0],h=e[1],g=e[2];return Math.abs(n-u)<=_i.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-h)<=_i.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(l-g)<=_i.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))},Rt.forEach=Rt.sqrLen=Rt.len=Rt.sqrDist=Rt.dist=Rt.div=Rt.mul=Rt.sub=void 0;var _i=function(t,e){if(t&&t.__esModule)return t;if(t===null||$a(t)!=="object"&&typeof t!="function")return{default:t};var n=Zs(void 0);if(n&&n.has(t))return n.get(t);var o={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(gt);function Zs(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Zs=function(o){return o?n:e})(t)}function Ga(){var t=new _i.ARRAY_TYPE(3);return _i.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ha(t){return Math.hypot(t[0],t[1],t[2])}function _c(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function cs(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Ys(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function qa(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function yc(t,e){var n=e[0]-t[0],o=e[1]-t[1],l=e[2]-t[2];return n*n+o*o+l*l}function Wa(t){var e=t[0],n=t[1],o=t[2];return e*e+n*n+o*o}function Za(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Rt.sub=_c,Rt.mul=cs,Rt.div=Ys,Rt.dist=qa,Rt.sqrDist=yc,Rt.len=Ha,Rt.sqrLen=Wa;var Ri,ch=(Ri=Ga(),function(t,e,n,o,l,u){var h,g;for(e||(e=3),n||(n=0),g=o?Math.min(o*e+n,t.length):t.length,h=n;h<g;h+=e)Ri[0]=t[h],Ri[1]=t[h+1],Ri[2]=t[h+2],l(Ri,Ri,u),t[h]=Ri[0],t[h+1]=Ri[1],t[h+2]=Ri[2];return t});Rt.forEach=ch;var Ot={};function vc(t){return vc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vc(t)}Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.create=Xs,Ot.clone=function(t){var e=new ir.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Ot.fromValues=function(t,e,n,o){var l=new ir.ARRAY_TYPE(4);return l[0]=t,l[1]=e,l[2]=n,l[3]=o,l},Ot.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ot.set=function(t,e,n,o,l){return t[0]=e,t[1]=n,t[2]=o,t[3]=l,t},Ot.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Ot.subtract=go,Ot.multiply=_o,Ot.divide=xc,Ot.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Ot.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Ot.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},Ot.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},Ot.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Ot.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Ot.scaleAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t},Ot.distance=us,Ot.squaredDistance=hs,Ot.length=Xa,Ot.squaredLength=Ka,Ot.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Ot.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Ot.normalize=function(t,e){var n=e[0],o=e[1],l=e[2],u=e[3],h=n*n+o*o+l*l+u*u;return h>0&&(h=1/Math.sqrt(h)),t[0]=n*h,t[1]=o*h,t[2]=l*h,t[3]=u*h,t},Ot.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Ot.cross=function(t,e,n,o){var l=n[0]*o[1]-n[1]*o[0],u=n[0]*o[2]-n[2]*o[0],h=n[0]*o[3]-n[3]*o[0],g=n[1]*o[2]-n[2]*o[1],y=n[1]*o[3]-n[3]*o[1],b=n[2]*o[3]-n[3]*o[2],T=e[0],I=e[1],D=e[2],P=e[3];return t[0]=I*b-D*y+P*g,t[1]=-T*b+D*h-P*u,t[2]=T*y-I*h+P*l,t[3]=-T*g+I*u-D*l,t},Ot.lerp=function(t,e,n,o){var l=e[0],u=e[1],h=e[2],g=e[3];return t[0]=l+o*(n[0]-l),t[1]=u+o*(n[1]-u),t[2]=h+o*(n[2]-h),t[3]=g+o*(n[3]-g),t},Ot.random=function(t,e){var n,o,l,u,h,g;e=e||1;do h=(n=2*ir.RANDOM()-1)*n+(o=2*ir.RANDOM()-1)*o;while(h>=1);do g=(l=2*ir.RANDOM()-1)*l+(u=2*ir.RANDOM()-1)*u;while(g>=1);var y=Math.sqrt((1-h)/g);return t[0]=e*n,t[1]=e*o,t[2]=e*l*y,t[3]=e*u*y,t},Ot.transformMat4=function(t,e,n){var o=e[0],l=e[1],u=e[2],h=e[3];return t[0]=n[0]*o+n[4]*l+n[8]*u+n[12]*h,t[1]=n[1]*o+n[5]*l+n[9]*u+n[13]*h,t[2]=n[2]*o+n[6]*l+n[10]*u+n[14]*h,t[3]=n[3]*o+n[7]*l+n[11]*u+n[15]*h,t},Ot.transformQuat=function(t,e,n){var o=e[0],l=e[1],u=e[2],h=n[0],g=n[1],y=n[2],b=n[3],T=b*o+g*u-y*l,I=b*l+y*o-h*u,D=b*u+h*l-g*o,P=-h*o-g*l-y*u;return t[0]=T*b+P*-h+I*-y-D*-g,t[1]=I*b+P*-g+D*-h-T*-y,t[2]=D*b+P*-y+T*-g-I*-h,t[3]=e[3],t},Ot.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Ot.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Ot.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Ot.equals=function(t,e){var n=t[0],o=t[1],l=t[2],u=t[3],h=e[0],g=e[1],y=e[2],b=e[3];return Math.abs(n-h)<=ir.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-g)<=ir.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(l-y)<=ir.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(u-b)<=ir.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))},Ot.forEach=Ot.sqrLen=Ot.len=Ot.sqrDist=Ot.dist=Ot.div=Ot.mul=Ot.sub=void 0;var ir=function(t,e){if(t&&t.__esModule)return t;if(t===null||vc(t)!=="object"&&typeof t!="function")return{default:t};var n=Ya(void 0);if(n&&n.has(t))return n.get(t);var o={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(gt);function Ya(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Ya=function(o){return o?n:e})(t)}function Xs(){var t=new ir.ARRAY_TYPE(4);return ir.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function go(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function _o(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function xc(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function us(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function hs(t,e){var n=e[0]-t[0],o=e[1]-t[1],l=e[2]-t[2],u=e[3]-t[3];return n*n+o*o+l*l+u*u}function Xa(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Ka(t){var e=t[0],n=t[1],o=t[2],l=t[3];return e*e+n*n+o*o+l*l}Ot.sub=go,Ot.mul=_o,Ot.div=xc,Ot.dist=us,Ot.sqrDist=hs,Ot.len=Xa,Ot.sqrLen=Ka;var uh=function(){var t=Xs();return function(e,n,o,l,u,h){var g,y;for(n||(n=4),o||(o=0),y=l?Math.min(l*n+o,e.length):e.length,g=o;g<y;g+=n)t[0]=e[g],t[1]=e[g+1],t[2]=e[g+2],t[3]=e[g+3],u(t,t,h),e[g]=t[0],e[g+1]=t[1],e[g+2]=t[2],e[g+3]=t[3];return e}}();function Qa(t){return Qa=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qa(t)}Ot.forEach=uh,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.create=Ja,Mt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Mt.setAxisAngle=bc,Mt.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),o=Math.sin(n/2);return o>Oi.EPSILON?(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o):(t[0]=1,t[1]=0,t[2]=0),n},Mt.getAngle=function(t,e){var n=de(t,e);return Math.acos(2*n*n-1)},Mt.multiply=el,Mt.rotateX=function(t,e,n){n*=.5;var o=e[0],l=e[1],u=e[2],h=e[3],g=Math.sin(n),y=Math.cos(n);return t[0]=o*y+h*g,t[1]=l*y+u*g,t[2]=u*y-l*g,t[3]=h*y-o*g,t},Mt.rotateY=function(t,e,n){n*=.5;var o=e[0],l=e[1],u=e[2],h=e[3],g=Math.sin(n),y=Math.cos(n);return t[0]=o*y-u*g,t[1]=l*y+h*g,t[2]=u*y+o*g,t[3]=h*y-l*g,t},Mt.rotateZ=function(t,e,n){n*=.5;var o=e[0],l=e[1],u=e[2],h=e[3],g=Math.sin(n),y=Math.cos(n);return t[0]=o*y+l*g,t[1]=l*y-o*g,t[2]=u*y+h*g,t[3]=h*y-u*g,t},Mt.calculateW=function(t,e){var n=e[0],o=e[1],l=e[2];return t[0]=n,t[1]=o,t[2]=l,t[3]=Math.sqrt(Math.abs(1-n*n-o*o-l*l)),t},Mt.exp=ge,Mt.ln=U,Mt.pow=function(t,e,n){return U(t,e),ue(t,t,n),ge(t,t),t},Mt.slerp=W,Mt.random=function(t){var e=Oi.RANDOM(),n=Oi.RANDOM(),o=Oi.RANDOM(),l=Math.sqrt(1-e),u=Math.sqrt(e);return t[0]=l*Math.sin(2*Math.PI*n),t[1]=l*Math.cos(2*Math.PI*n),t[2]=u*Math.sin(2*Math.PI*o),t[3]=u*Math.cos(2*Math.PI*o),t},Mt.invert=function(t,e){var n=e[0],o=e[1],l=e[2],u=e[3],h=n*n+o*o+l*l+u*u,g=h?1/h:0;return t[0]=-n*g,t[1]=-o*g,t[2]=-l*g,t[3]=u*g,t},Mt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Mt.fromMat3=ie,Mt.fromEuler=function(t,e,n,o){var l=.5*Math.PI/180;e*=l,n*=l,o*=l;var u=Math.sin(e),h=Math.cos(e),g=Math.sin(n),y=Math.cos(n),b=Math.sin(o),T=Math.cos(o);return t[0]=u*y*T-h*g*b,t[1]=h*g*T+u*y*b,t[2]=h*y*b-u*g*T,t[3]=h*y*T+u*g*b,t},Mt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Mt.setAxes=Mt.sqlerp=Mt.rotationTo=Mt.equals=Mt.exactEquals=Mt.normalize=Mt.sqrLen=Mt.squaredLength=Mt.len=Mt.length=Mt.lerp=Mt.dot=Mt.scale=Mt.mul=Mt.add=Mt.set=Mt.copy=Mt.fromValues=Mt.clone=void 0;var Oi=Ks(gt),ds=Ks(fn),ki=Ks(Rt),Ar=Ks(Ot);function hh(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(hh=function(o){return o?n:e})(t)}function Ks(t,e){if(t&&t.__esModule)return t;if(t===null||Qa(t)!=="object"&&typeof t!="function")return{default:t};var n=hh(e);if(n&&n.has(t))return n.get(t);var o={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}function Ja(){var t=new Oi.ARRAY_TYPE(4);return Oi.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function bc(t,e,n){n*=.5;var o=Math.sin(n);return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=Math.cos(n),t}function el(t,e,n){var o=e[0],l=e[1],u=e[2],h=e[3],g=n[0],y=n[1],b=n[2],T=n[3];return t[0]=o*T+h*g+l*b-u*y,t[1]=l*T+h*y+u*g-o*b,t[2]=u*T+h*b+o*y-l*g,t[3]=h*T-o*g-l*y-u*b,t}function ge(t,e){var n=e[0],o=e[1],l=e[2],u=e[3],h=Math.sqrt(n*n+o*o+l*l),g=Math.exp(u),y=h>0?g*Math.sin(h)/h:0;return t[0]=n*y,t[1]=o*y,t[2]=l*y,t[3]=g*Math.cos(h),t}function U(t,e){var n=e[0],o=e[1],l=e[2],u=e[3],h=Math.sqrt(n*n+o*o+l*l),g=h>0?Math.atan2(h,u)/h:0;return t[0]=n*g,t[1]=o*g,t[2]=l*g,t[3]=.5*Math.log(n*n+o*o+l*l+u*u),t}function W(t,e,n,o){var l,u,h,g,y,b=e[0],T=e[1],I=e[2],D=e[3],P=n[0],R=n[1],L=n[2],N=n[3];return(u=b*P+T*R+I*L+D*N)<0&&(u=-u,P=-P,R=-R,L=-L,N=-N),1-u>Oi.EPSILON?(l=Math.acos(u),h=Math.sin(l),g=Math.sin((1-o)*l)/h,y=Math.sin(o*l)/h):(g=1-o,y=o),t[0]=g*b+y*P,t[1]=g*T+y*R,t[2]=g*I+y*L,t[3]=g*D+y*N,t}function ie(t,e){var n,o=e[0]+e[4]+e[8];if(o>0)n=Math.sqrt(o+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var l=0;e[4]>e[0]&&(l=1),e[8]>e[3*l+l]&&(l=2);var u=(l+1)%3,h=(l+2)%3;n=Math.sqrt(e[3*l+l]-e[3*u+u]-e[3*h+h]+1),t[l]=.5*n,t[3]=(e[3*u+h]-e[3*h+u])*(n=.5/n),t[u]=(e[3*u+l]+e[3*l+u])*n,t[h]=(e[3*h+l]+e[3*l+h])*n}return t}Mt.clone=Ar.clone,Mt.fromValues=Ar.fromValues,Mt.copy=Ar.copy,Mt.set=Ar.set,Mt.add=Ar.add,Mt.mul=el;var ue=Ar.scale;Mt.scale=ue;var de=Ar.dot;Mt.dot=de,Mt.lerp=Ar.lerp;var be=Ar.length;Mt.length=be,Mt.len=be;var Se=Ar.squaredLength;Mt.squaredLength=Se,Mt.sqrLen=Se;var ye=Ar.normalize;Mt.normalize=ye,Mt.exactEquals=Ar.exactEquals,Mt.equals=Ar.equals;var Me,nt,Ke,_t=(Me=ki.create(),nt=ki.fromValues(1,0,0),Ke=ki.fromValues(0,1,0),function(t,e,n){var o=ki.dot(e,n);return o<-.999999?(ki.cross(Me,nt,e),ki.len(Me)<1e-6&&ki.cross(Me,Ke,e),ki.normalize(Me,Me),bc(t,Me,Math.PI),t):o>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ki.cross(Me,e,n),t[0]=Me[0],t[1]=Me[1],t[2]=Me[2],t[3]=1+o,ye(t,t))});Mt.rotationTo=_t;var Ct,Gt,Wt=(Ct=Ja(),Gt=Ja(),function(t,e,n,o,l,u){return W(Ct,e,l,u),W(Gt,n,o,u),W(t,Ct,Gt,2*u*(1-u)),t});Mt.sqlerp=Wt;var Nt,Jt=(Nt=ds.create(),function(t,e,n,o){return Nt[0]=n[0],Nt[3]=n[1],Nt[6]=n[2],Nt[1]=o[0],Nt[4]=o[1],Nt[7]=o[2],Nt[2]=-e[0],Nt[5]=-e[1],Nt[8]=-e[2],ye(t,ie(t,Nt))});Mt.setAxes=Jt;var pt={};function qn(t){return qn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qn(t)}Object.defineProperty(pt,"__esModule",{value:!0}),pt.create=function(){var t=new An.ARRAY_TYPE(8);return An.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},pt.clone=function(t){var e=new An.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},pt.fromValues=function(t,e,n,o,l,u,h,g){var y=new An.ARRAY_TYPE(8);return y[0]=t,y[1]=e,y[2]=n,y[3]=o,y[4]=l,y[5]=u,y[6]=h,y[7]=g,y},pt.fromRotationTranslationValues=function(t,e,n,o,l,u,h){var g=new An.ARRAY_TYPE(8);g[0]=t,g[1]=e,g[2]=n,g[3]=o;var y=.5*l,b=.5*u,T=.5*h;return g[4]=y*o+b*n-T*e,g[5]=b*o+T*t-y*n,g[6]=T*o+y*e-b*t,g[7]=-y*t-b*e-T*n,g},pt.fromRotationTranslation=Gr,pt.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},pt.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},pt.fromMat4=function(t,e){var n=sn.create();lr.getRotation(n,e);var o=new An.ARRAY_TYPE(3);return lr.getTranslation(o,e),Gr(t,n,o),t},pt.copy=Hr,pt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},pt.set=function(t,e,n,o,l,u,h,g,y){return t[0]=e,t[1]=n,t[2]=o,t[3]=l,t[4]=u,t[5]=h,t[6]=g,t[7]=y,t},pt.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},pt.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},pt.getTranslation=function(t,e){var n=e[4],o=e[5],l=e[6],u=e[7],h=-e[0],g=-e[1],y=-e[2],b=e[3];return t[0]=2*(n*b+u*h+o*y-l*g),t[1]=2*(o*b+u*g+l*h-n*y),t[2]=2*(l*b+u*y+n*g-o*h),t},pt.translate=function(t,e,n){var o=e[0],l=e[1],u=e[2],h=e[3],g=.5*n[0],y=.5*n[1],b=.5*n[2],T=e[4],I=e[5],D=e[6],P=e[7];return t[0]=o,t[1]=l,t[2]=u,t[3]=h,t[4]=h*g+l*b-u*y+T,t[5]=h*y+u*g-o*b+I,t[6]=h*b+o*y-l*g+D,t[7]=-o*g-l*y-u*b+P,t},pt.rotateX=function(t,e,n){var o=-e[0],l=-e[1],u=-e[2],h=e[3],g=e[4],y=e[5],b=e[6],T=e[7],I=g*h+T*o+y*u-b*l,D=y*h+T*l+b*o-g*u,P=b*h+T*u+g*l-y*o,R=T*h-g*o-y*l-b*u;return sn.rotateX(t,e,n),t[4]=I*(h=t[3])+R*(o=t[0])+D*(u=t[2])-P*(l=t[1]),t[5]=D*h+R*l+P*o-I*u,t[6]=P*h+R*u+I*l-D*o,t[7]=R*h-I*o-D*l-P*u,t},pt.rotateY=function(t,e,n){var o=-e[0],l=-e[1],u=-e[2],h=e[3],g=e[4],y=e[5],b=e[6],T=e[7],I=g*h+T*o+y*u-b*l,D=y*h+T*l+b*o-g*u,P=b*h+T*u+g*l-y*o,R=T*h-g*o-y*l-b*u;return sn.rotateY(t,e,n),t[4]=I*(h=t[3])+R*(o=t[0])+D*(u=t[2])-P*(l=t[1]),t[5]=D*h+R*l+P*o-I*u,t[6]=P*h+R*u+I*l-D*o,t[7]=R*h-I*o-D*l-P*u,t},pt.rotateZ=function(t,e,n){var o=-e[0],l=-e[1],u=-e[2],h=e[3],g=e[4],y=e[5],b=e[6],T=e[7],I=g*h+T*o+y*u-b*l,D=y*h+T*l+b*o-g*u,P=b*h+T*u+g*l-y*o,R=T*h-g*o-y*l-b*u;return sn.rotateZ(t,e,n),t[4]=I*(h=t[3])+R*(o=t[0])+D*(u=t[2])-P*(l=t[1]),t[5]=D*h+R*l+P*o-I*u,t[6]=P*h+R*u+I*l-D*o,t[7]=R*h-I*o-D*l-P*u,t},pt.rotateByQuatAppend=function(t,e,n){var o=n[0],l=n[1],u=n[2],h=n[3],g=e[0],y=e[1],b=e[2],T=e[3];return t[0]=g*h+T*o+y*u-b*l,t[1]=y*h+T*l+b*o-g*u,t[2]=b*h+T*u+g*l-y*o,t[3]=T*h-g*o-y*l-b*u,t[4]=(g=e[4])*h+(T=e[7])*o+(y=e[5])*u-(b=e[6])*l,t[5]=y*h+T*l+b*o-g*u,t[6]=b*h+T*u+g*l-y*o,t[7]=T*h-g*o-y*l-b*u,t},pt.rotateByQuatPrepend=function(t,e,n){var o=e[0],l=e[1],u=e[2],h=e[3],g=n[0],y=n[1],b=n[2],T=n[3];return t[0]=o*T+h*g+l*b-u*y,t[1]=l*T+h*y+u*g-o*b,t[2]=u*T+h*b+o*y-l*g,t[3]=h*T-o*g-l*y-u*b,t[4]=o*(T=n[7])+h*(g=n[4])+l*(b=n[6])-u*(y=n[5]),t[5]=l*T+h*y+u*g-o*b,t[6]=u*T+h*b+o*y-l*g,t[7]=h*T-o*g-l*y-u*b,t},pt.rotateAroundAxis=function(t,e,n,o){if(Math.abs(o)<An.EPSILON)return Hr(t,e);var l=Math.hypot(n[0],n[1],n[2]);o*=.5;var u=Math.sin(o),h=u*n[0]/l,g=u*n[1]/l,y=u*n[2]/l,b=Math.cos(o),T=e[0],I=e[1],D=e[2],P=e[3];t[0]=T*b+P*h+I*y-D*g,t[1]=I*b+P*g+D*h-T*y,t[2]=D*b+P*y+T*g-I*h,t[3]=P*b-T*h-I*g-D*y;var R=e[4],L=e[5],N=e[6],j=e[7];return t[4]=R*b+j*h+L*y-N*g,t[5]=L*b+j*g+N*h-R*y,t[6]=N*b+j*y+R*g-L*h,t[7]=j*b-R*h-L*g-N*y,t},pt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},pt.multiply=Qs,pt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},pt.lerp=function(t,e,n,o){var l=1-o;return mf(e,n)<0&&(o=-o),t[0]=e[0]*l+n[0]*o,t[1]=e[1]*l+n[1]*o,t[2]=e[2]*l+n[2]*o,t[3]=e[3]*l+n[3]*o,t[4]=e[4]*l+n[4]*o,t[5]=e[5]*l+n[5]*o,t[6]=e[6]*l+n[6]*o,t[7]=e[7]*l+n[7]*o,t},pt.invert=function(t,e){var n=wc(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},pt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},pt.normalize=function(t,e){var n=wc(e);if(n>0){n=Math.sqrt(n);var o=e[0]/n,l=e[1]/n,u=e[2]/n,h=e[3]/n,g=e[4],y=e[5],b=e[6],T=e[7],I=o*g+l*y+u*b+h*T;t[0]=o,t[1]=l,t[2]=u,t[3]=h,t[4]=(g-o*I)/n,t[5]=(y-l*I)/n,t[6]=(b-u*I)/n,t[7]=(T-h*I)/n}return t},pt.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},pt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},pt.equals=function(t,e){var n=t[0],o=t[1],l=t[2],u=t[3],h=t[4],g=t[5],y=t[6],b=t[7],T=e[0],I=e[1],D=e[2],P=e[3],R=e[4],L=e[5],N=e[6],j=e[7];return Math.abs(n-T)<=An.EPSILON*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(o-I)<=An.EPSILON*Math.max(1,Math.abs(o),Math.abs(I))&&Math.abs(l-D)<=An.EPSILON*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(u-P)<=An.EPSILON*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(h-R)<=An.EPSILON*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(g-L)<=An.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(y-N)<=An.EPSILON*Math.max(1,Math.abs(y),Math.abs(N))&&Math.abs(b-j)<=An.EPSILON*Math.max(1,Math.abs(b),Math.abs(j))},pt.sqrLen=pt.squaredLength=pt.len=pt.length=pt.dot=pt.mul=pt.setReal=pt.getReal=void 0;var An=pr(gt),sn=pr(Mt),lr=pr(Pt);function Wn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Wn=function(o){return o?n:e})(t)}function pr(t,e){if(t&&t.__esModule)return t;if(t===null||qn(t)!=="object"&&typeof t!="function")return{default:t};var n=Wn(e);if(n&&n.has(t))return n.get(t);var o={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}function Gr(t,e,n){var o=.5*n[0],l=.5*n[1],u=.5*n[2],h=e[0],g=e[1],y=e[2],b=e[3];return t[0]=h,t[1]=g,t[2]=y,t[3]=b,t[4]=o*b+l*y-u*g,t[5]=l*b+u*h-o*y,t[6]=u*b+o*g-l*h,t[7]=-o*h-l*g-u*y,t}function Hr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Qs(t,e,n){var o=e[0],l=e[1],u=e[2],h=e[3],g=n[4],y=n[5],b=n[6],T=n[7],I=e[4],D=e[5],P=e[6],R=e[7],L=n[0],N=n[1],j=n[2],Y=n[3];return t[0]=o*Y+h*L+l*j-u*N,t[1]=l*Y+h*N+u*L-o*j,t[2]=u*Y+h*j+o*N-l*L,t[3]=h*Y-o*L-l*N-u*j,t[4]=o*T+h*g+l*b-u*y+I*Y+R*L+D*j-P*N,t[5]=l*T+h*y+u*g-o*b+D*Y+R*N+P*L-I*j,t[6]=u*T+h*b+o*y-l*g+P*Y+R*j+I*N-D*L,t[7]=h*T-o*g-l*y-u*b+R*Y-I*L-D*N-P*j,t}pt.getReal=sn.copy,pt.setReal=sn.copy,pt.mul=Qs;var mf=sn.dot;pt.dot=mf;var yg=sn.length;pt.length=yg,pt.len=yg;var wc=sn.squaredLength;pt.squaredLength=wc,pt.sqrLen=wc;var Ut={};function gf(t){return gf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gf(t)}Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.create=yf,Ut.clone=function(t){var e=new fs.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Ut.fromValues=function(t,e){var n=new fs.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},Ut.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Ut.set=function(t,e,n){return t[0]=e,t[1]=n,t},Ut.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},Ut.subtract=vf,Ut.multiply=xf,Ut.divide=bf,Ut.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Ut.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Ut.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},Ut.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},Ut.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Ut.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},Ut.scaleAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t},Ut.distance=wf,Ut.squaredDistance=Tf,Ut.length=Ef,Ut.squaredLength=If,Ut.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Ut.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Ut.normalize=function(t,e){var n=e[0],o=e[1],l=n*n+o*o;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t},Ut.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Ut.cross=function(t,e,n){var o=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=o,t},Ut.lerp=function(t,e,n,o){var l=e[0],u=e[1];return t[0]=l+o*(n[0]-l),t[1]=u+o*(n[1]-u),t},Ut.random=function(t,e){e=e||1;var n=2*fs.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},Ut.transformMat2=function(t,e,n){var o=e[0],l=e[1];return t[0]=n[0]*o+n[2]*l,t[1]=n[1]*o+n[3]*l,t},Ut.transformMat2d=function(t,e,n){var o=e[0],l=e[1];return t[0]=n[0]*o+n[2]*l+n[4],t[1]=n[1]*o+n[3]*l+n[5],t},Ut.transformMat3=function(t,e,n){var o=e[0],l=e[1];return t[0]=n[0]*o+n[3]*l+n[6],t[1]=n[1]*o+n[4]*l+n[7],t},Ut.transformMat4=function(t,e,n){var o=e[0],l=e[1];return t[0]=n[0]*o+n[4]*l+n[12],t[1]=n[1]*o+n[5]*l+n[13],t},Ut.rotate=function(t,e,n,o){var l=e[0]-n[0],u=e[1]-n[1],h=Math.sin(o),g=Math.cos(o);return t[0]=l*g-u*h+n[0],t[1]=l*h+u*g+n[1],t},Ut.angle=function(t,e){var n=t[0],o=t[1],l=e[0],u=e[1],h=Math.sqrt(n*n+o*o)*Math.sqrt(l*l+u*u);return Math.acos(Math.min(Math.max(h&&(n*l+o*u)/h,-1),1))},Ut.zero=function(t){return t[0]=0,t[1]=0,t},Ut.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Ut.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Ut.equals=function(t,e){var n=t[0],o=t[1],l=e[0],u=e[1];return Math.abs(n-l)<=fs.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-u)<=fs.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))},Ut.forEach=Ut.sqrLen=Ut.sqrDist=Ut.dist=Ut.div=Ut.mul=Ut.sub=Ut.len=void 0;var fs=function(t,e){if(t&&t.__esModule)return t;if(t===null||gf(t)!=="object"&&typeof t!="function")return{default:t};var n=_f(void 0);if(n&&n.has(t))return n.get(t);var o={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(gt);function _f(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(_f=function(o){return o?n:e})(t)}function yf(){var t=new fs.ARRAY_TYPE(2);return fs.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function vf(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function xf(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function bf(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function wf(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Tf(t,e){var n=e[0]-t[0],o=e[1]-t[1];return n*n+o*o}function Ef(t){return Math.hypot(t[0],t[1])}function If(t){var e=t[0],n=t[1];return e*e+n*n}Ut.len=Ef,Ut.sub=vf,Ut.mul=xf,Ut.div=bf,Ut.dist=wf,Ut.sqrDist=Tf,Ut.sqrLen=If;var vg=function(){var t=yf();return function(e,n,o,l,u,h){var g,y;for(n||(n=2),o||(o=0),y=l?Math.min(l*n+o,e.length):e.length,g=o;g<y;g+=n)t[0]=e[g],t[1]=e[g+1],u(t,t,h),e[g]=t[0],e[g+1]=t[1];return e}}();function tl(t){return tl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tl(t)}Ut.forEach=vg,Object.defineProperty(ct,"__esModule",{value:!0}),r.aA=ct.vec4=r._=ct.vec3=ct.vec2=ct.quat2=r.av=ct.quat=r.ad=ct.mat4=r.bC=ct.mat3=ct.mat2d=r.aC=ct.mat2=ct.glMatrix=void 0;var dh=yo(gt);ct.glMatrix=dh;var fh=yo(Tt);r.aC=ct.mat2=fh;var xg=yo(En);ct.mat2d=xg;var bg=yo(fn);r.bC=ct.mat3=bg;var wg=yo(Pt);r.ad=ct.mat4=wg;var nl=yo(Mt);r.av=ct.quat=nl;var Xt=yo(pt);ct.quat2=Xt;var Wv=yo(Ut);ct.vec2=Wv;var Zv=yo(Rt);r._=ct.vec3=Zv;var Yv=yo(Ot);function Cf(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Cf=function(o){return o?n:e})(t)}function yo(t,e){if(t&&t.__esModule)return t;if(t===null||tl(t)!=="object"&&typeof t!="function")return{default:t};var n=Cf(e);if(n&&n.has(t))return n.get(t);var o={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(o,u,h):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}r.aA=ct.vec4=Yv;var Df=Tc;function Tc(t,e,n,o){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=o}Tc.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,o=0;o<8;o++){var l=this.sampleCurveX(n)-t;if(Math.abs(l)<e)return n;var u=this.sampleCurveDerivativeX(n);if(Math.abs(u)<1e-6)break;n-=l/u}var h=0,g=1;for(n=t,o=0;o<20&&(l=this.sampleCurveX(n),!(Math.abs(l-t)<e));o++)t>l?h=n:g=n,n=.5*(g-h)+h;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Ec=We(Df),ph=Js;function Js(t,e){this.x=t,this.y=e}Js.prototype={clone:function(){return new Js(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround:function(t,e){var n=Math.cos(t),o=Math.sin(t),l=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Js.convert=function(t){return t instanceof Js?t:Array.isArray(t)?new Js(t[0],t[1]):t};var at=We(ph);let Tg=Math.PI/180,Ic=180/Math.PI;function en(t){return t*Tg}function qr(t){return t*Ic}let Eg=[[0,0],[1,0],[1,1],[0,1]];function Sf(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Cc(t,e,n,o){let l=new Ec(t,e,n,o);return function(u){return l.solve(u)}}let rl=Cc(.25,.1,.25,1);function Ht(t,e,n){return Math.min(n,Math.max(e,t))}function ea(t,e,n){return(n=Ht((n-t)/(e-t),0,1))*n*(3-2*n)}function ta(t,e,n){let o=n-e,l=((t-e)%o+o)%o+e;return l===e?n:l}function il(t,e,n){if(!t.length)return n(null,[]);let o=t.length,l=new Array(t.length),u=null;t.forEach((h,g)=>{e(h,(y,b)=>{y&&(u=y),l[g]=b,--o==0&&n(u,l)})})}function Li(t){let e=[];for(let n in t)e.push(t[n]);return e}function Wr(t,...e){for(let n of e)for(let o in n)t[o]=n[o];return t}let Xv=1;function mh(){return Xv++}function gh(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Mf(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Af(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function _h(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Dc(t,e){return t.indexOf(e,t.length-e.length)!==-1}function ol(t,e,n){let o={};for(let l in t)o[l]=e.call(this,t[l],l,t);return o}function na(t,e,n){let o={};for(let l in t)e.call(this,t[l],l,t)&&(o[l]=t[l]);return o}function vo(t){return Array.isArray(t)?t.map(vo):typeof t=="object"&&t?ol(t,vo):t}let Pf={};function cr(t){Pf[t]||(typeof console<"u"&&console.warn(t),Pf[t]=!0)}function xo(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function ri(t){let e=0;for(let n,o,l=0,u=t.length,h=u-1;l<u;h=l++)n=t[l],o=t[h],e+=(o.x-n.x)*(n.y+o.y);return e}function ko([t,e,n]){let o=en(e+90),l=en(n);return{x:t*Math.cos(o)*Math.sin(l),y:t*Math.sin(o)*Math.sin(l),z:t*Math.cos(l),azimuthal:e,polar:n}}function Pr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Rf(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,l,u)=>{let h=l||u;return e[o]=!h||h.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Of,yh,sl,Sc,Lo,Mc,vh=null;function ra(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ac(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function kf(t,e,n,o){for(;e<n;){let l=e+n>>1;t[l]<o?e=l+1:n=l}return e}function Ig(t,e,n,o){for(;e<n;){let l=e+n>>1;t[l]<=o?e=l+1:n=l}return e}function xh(t){return t>0?1/(1.001-t):1+t}function bh(t){return t>0?1-1/(1.001-t):-t}function al(){return Of==null&&(Of=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Of}let Rr={now:()=>Sc!==void 0?Sc:performance.now(),setNow(t){Sc=t},restoreNow(){Sc=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:n,height:o}=t;Lo||(Lo=document.createElement("canvas"));let l=Lo.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(n>Lo.width||o>Lo.height)&&(Lo.width=n,Lo.height=o),l.clearRect(-e,-e,n+2*e,o+2*e),l.drawImage(t,0,0,n,o),l.getImageData(-e,-e,n+2*e,o+2*e)},resolveURL:t=>(yh||(yh=document.createElement("a")),yh.href=t,yh.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(sl==null&&(sl=window.matchMedia("(prefers-reduced-motion: reduce)")),sl.matches)},hasCanvasFingerprintNoise(){if(Mc!==void 0)return Mc;if(!al())return Mc=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),n=0;for(let l=0;l<t.width;++l)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(l,0,1,1);let o=e.getImageData(0,0,t.width,t.height);n=0;for(let l=0;l<o.data.length;++l)if(l%4!=3&&n++!==o.data[l])return Mc=!0,!0;return Mc=!1,!1}};function wh(t,e){let n=t.indexOf("?");if(n<0)return`${t}?${new URLSearchParams(e).toString()}`;let o=new URLSearchParams(t.slice(n));for(let l in e)o.set(l,e[l]);return`${t.slice(0,n)}?${o.toString()}`}function Lf(t,e={persistentParams:[]}){let n=t.indexOf("?");if(n<0)return t;let o=new URLSearchParams,l=new URLSearchParams(t.slice(n));for(let h of e.persistentParams){let g=l.get(h);g&&o.set(h,g)}let u=o.toString();return`${t.slice(0,n)}${u.length>0?`?${u}`:""}`}let Cg="mapbox-tiles",Ff=500,Nf=50,Fo,Th;function Dg(){try{return caches}catch{}}function Pc(){let t=Dg();t&&!Fo&&(Fo=t.open(Cg))}let Eh=1/0,Ih={supported:!1,testSupport:function(t){!zf&&cl&&(Bf?Sg(t):ll=t)}},ll,cl,zf=!1,Bf=!1,Vf=typeof self<"u"?self:{};function Sg(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,cl),t.isContextLost())return;Ih.supported=!0}catch{}t.deleteTexture(e),zf=!0}Vf.document&&(cl=Vf.document.createElement("img"),cl.onload=function(){ll&&Sg(ll),ll=null,Bf=!0},cl.onerror=function(){zf=!0,ll=null},cl.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Ch={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Ch);class jf extends Error{constructor(e,n,o){n===401&&B(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Dh=Pr()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Rc=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Dh())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,l){let u=new AbortController,h=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Dh(),referrerPolicy:o.referrerPolicy,signal:u.signal}),g=!1,y=!1,b=(T=h.url).indexOf("sku=")>0&&B(T);var T;o.type==="json"&&h.headers.set("Accept","application/json");let I=(P,R,L)=>{if(y)return;if(P&&P.message!=="SecurityError"&&cr(P.toString()),R&&L)return D(R);let N=Date.now();fetch(h).then(j=>{if(j.ok){let Y=b?j.clone():null;return D(j,Y,N)}return l(new jf(j.statusText,j.status,o.url))}).catch(j=>{j.name!=="AbortError"&&l(new Error(`${j.message} ${o.url}`))})},D=(P,R,L)=>{(o.type==="arrayBuffer"?P.arrayBuffer():o.type==="json"?P.json():P.text()).then(N=>{y||(R&&L&&function(j,Y,X){if(Pc(),!Fo)return;let K=Rf(Y.headers.get("Cache-Control")||"");if(K["no-store"])return;let ae={status:Y.status,statusText:Y.statusText,headers:new Headers};Y.headers.forEach((me,we)=>ae.headers.set(we,me)),K["max-age"]&&ae.headers.set("Expires",new Date(X+1e3*K["max-age"]).toUTCString());let oe=ae.headers.get("Expires");if(!oe||new Date(oe).getTime()-X<42e4)return;let fe=Lf(j.url,{persistentParams:["language","worldview"]});if(Y.status===206){let me=j.headers.get("Range");if(!me)return;ae.status=200,fe=wh(fe,{range:me})}(function(me,we){if(Th===void 0)try{new Response(new ReadableStream),Th=!0}catch{Th=!1}Th?we(me.body):me.blob().then(we)})(Y,me=>{let we=new Response((Pe=Y.status)!==200&&Pe!==404&&[101,103,204,205,304].includes(Pe)?null:me,ae);var Pe;Pc(),Fo&&Fo.then(Ce=>Ce.put(fe,we)).catch(Ce=>cr(Ce.message))})}(h,R,L),g=!0,l(null,N,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch(N=>{y||l(new Error(N.message))})};return b?function(P,R){if(Pc(),!Fo)return R(null);Fo.then(L=>{let N=Lf(P.url,{persistentParams:["language","worldview"]}),j=P.headers.get("Range");j&&(N=wh(N,{range:j})),L.match(N).then(Y=>{let X=function(K){if(!K)return!1;let ae=new Date(K.headers.get("Expires")||0),oe=Rf(K.headers.get("Cache-Control")||"");return ae>Date.now()&&!oe["no-cache"]}(Y);L.delete(N),X&&L.put(N,Y.clone()),R(null,Y,X)}).catch(R)}).catch(R)}(h,I):I(null,null),{cancel:()=>{y=!0,g||u.abort()}}}(t,e);if(Pr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(o,l){let u=new XMLHttpRequest;u.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(let h in o.headers)u.setRequestHeader(h,o.headers[h]);return o.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=o.credentials==="include",u.onerror=()=>{l(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let h=u.response;if(o.type==="json")try{h=JSON.parse(u.response)}catch(g){return l(g)}l(null,h,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else l(new jf(u.statusText,u.status,o.url))},u.send(o.body),{cancel:()=>u.abort()}}(t,e)},ia=function(t,e){return Rc(Wr(t,{type:"arrayBuffer"}),e)};function Mg(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let Uf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Oc,kc;Oc=[],kc=0;let ps=function(t,e){if(Ih.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),kc>=k.MAX_PARALLEL_IMAGE_REQUESTS){let u={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Oc.push(u),u}kc++;let n=!1,o=()=>{if(!n)for(n=!0,kc--;Oc.length&&kc<k.MAX_PARALLEL_IMAGE_REQUESTS;){let u=Oc.shift(),{requestParameters:h,callback:g,cancelled:y}=u;y||(u.cancel=ps(h,g).cancel)}},l=ia(t,(u,h,g,y)=>{o(),u?e(u):h&&(self.createImageBitmap?function(b,T){let I=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(I).then(D=>{T(null,D)}).catch(D=>{T(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(b,T)=>e(b,T,g,y)):function(b,T){let I=new Image;I.onload=()=>{T(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=Uf})},I.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let D=new Blob([new Uint8Array(b)],{type:"image/png"});I.src=b.byteLength?URL.createObjectURL(D):Uf}(h,(b,T)=>e(b,T,g,y)))});return{cancel:()=>{l.cancel(),o()}}},$f="01",Gf="NO_ACCESS_TOKEN",Kv=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ki(t){let e=t.match(Kv);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ul(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let Sh="mapbox.eventData";function Ag(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Lc{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=Ag(k.ACCESS_TOKEN),o="";return o=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(l,u)=>String.fromCharCode(+("0x"+u)))):k.ACCESS_TOKEN||"",e?`${Sh}.${e}:${o}`:`${Sh}:${o}`}fetchEventData(){let e=ra("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{let l=localStorage.getItem(n);l&&(this.eventData=JSON.parse(l));let u=localStorage.getItem(o);u&&(this.anonId=u)}catch{cr("Unable to read from LocalStorage")}}saveEventData(){let e=ra("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid"),l=this.anonId;if(e&&l)try{localStorage.setItem(o,l),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{cr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,o,l){if(!k.EVENTS_URL)return;let u=Ki(k.EVENTS_URL);u.params.push(`access_token=${l||k.ACCESS_TOKEN||""}`);let h={event:this.type,created:new Date(e).toISOString()},g=n?Wr(h,n):h,y={url:ul(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=function(b,T){return Rc(Wr(b,{method:"POST"}),T)}(y,b=>{this.pendingRequest=null,o(b),this.saveEventData(),this.processRequests(l)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let Pg=new class extends Lc{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){k.EVENTS_URL&&k.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>Z(n)||B(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=Ag(k.ACCESS_TOKEN),n=e?e.u:k.ACCESS_TOKEN,o=n!==this.eventData.tokenU;Af(this.anonId)||(this.anonId=gh(),o=!0);let l=this.queue.shift();if(this.eventData.lastSuccess){let u=new Date(this.eventData.lastSuccess),h=new Date(l),g=(l-this.eventData.lastSuccess)/864e5;o=o||g>=1||g<-1||u.getDate()!==h.getDate()}else o=!0;o?this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:$f,"enabled.telemetry":!1,userId:this.anonId},u=>{u||(this.eventData.lastSuccess=l,this.eventData.tokenU=n)},t):this.processRequests()}},Hf=Pg.postTurnstileEvent.bind(Pg),Fc=new class extends Lc{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,o){this.skuToken=e,this.errorCb=o,k.EVENTS_URL&&(n||k.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Gf)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Af(this.anonId)||(this.anonId=gh()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:$f,skuToken:this.skuToken,userId:this.anonId},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},Rg=Fc.postMapLoadEvent.bind(Fc),Og=new class extends Lc{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=gh(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){let e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){let{map:n,style:o,importedStyles:l}=e;if(!k.EVENTS_URL||!t&&!k.ACCESS_TOKEN)return;let u=this.getMapInstanceId(n),h={mapInstanceId:u,eventId:this.getEventId(u),style:o};l.length&&(h.importedStyles=l),this.queueRequest({timestamp:Date.now(),payload:h},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:n}=this.queue.shift();this.postEvent(e,n,()=>{},t)}},Qv=Og.postStyleLoadEvent.bind(Og),Mh=new class extends Lc{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){k.EVENTS_URL&&(t||k.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),o=function(l){let u=performance.getEntriesByType("resource"),h=performance.getEntriesByType("mark"),g=function(P){let R={};if(P){for(let L in P)if(L!=="other")for(let N of P[L]){let j=`${L}ResolveRangeMin`,Y=`${L}ResolveRangeMax`,X=`${L}RequestCount`,K=`${L}RequestCachedCount`;R[j]=Math.min(R[j]||1/0,N.startTime),R[Y]=Math.max(R[Y]||-1/0,N.responseEnd);let ae=oe=>{R[oe]===void 0&&(R[oe]=0),++R[oe]};N.transferSize!==void 0&&N.transferSize===0&&ae(K),ae(X)}}return R}(function(P,R){let L={};if(P)for(let N of P){let j=R(N);L[j]===void 0&&(L[j]=[]),L[j].push(N)}return L}(u,Ve)),y=window.devicePixelRatio,b=navigator.connection||navigator.mozConnection||navigator.webkitConnection,T=b?b.effectiveType:void 0,I={counters:[],metadata:[],attributes:[]},D=(P,R,L)=>{L!=null&&P.push({name:R,value:L.toString()})};for(let P in g)D(I.counters,P,g[P]);if(l.interactionRange[0]!==1/0&&l.interactionRange[1]!==-1/0&&(D(I.counters,"interactionRangeMin",l.interactionRange[0]),D(I.counters,"interactionRangeMax",l.interactionRange[1])),h)for(let P of Object.keys(Je)){let R=Je[P],L=h.find(N=>N.name===R);L&&D(I.counters,R,L.startTime)}return D(I.counters,"visibilityHidden",l.visibilityHidden),D(I.attributes,"style",function(P){if(P)for(let R of P){let L=R.name.split("?")[0];if(_e(L)){let N=L.split("/").slice(-2);if(N.length===2)return`mapbox://styles/${N[0]}/${N[1]}`}}}(u)),D(I.attributes,"terrainEnabled",l.terrainEnabled?"true":"false"),D(I.attributes,"fogEnabled",l.fogEnabled?"true":"false"),D(I.attributes,"projection",l.projection),D(I.attributes,"zoom",l.zoom),D(I.metadata,"devicePixelRatio",y),D(I.metadata,"connectionEffectiveType",T),D(I.metadata,"navigatorUserAgent",navigator.userAgent),D(I.metadata,"screenWidth",window.screen.width),D(I.metadata,"screenHeight",window.screen.height),D(I.metadata,"windowWidth",window.innerWidth),D(I.metadata,"windowHeight",window.innerHeight),D(I.metadata,"mapWidth",l.width/y),D(I.metadata,"mapHeight",l.height/y),D(I.metadata,"webglRenderer",l.renderer),D(I.metadata,"webglVendor",l.vendor),D(I.metadata,"sdkVersion",C),D(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(n);for(let l of o.metadata);for(let l of o.counters);for(let l of o.attributes);this.postEvent(e,o,()=>{},t)}},Jv=Mh.postPerformanceEvent.bind(Mh),hl=new class extends Lc{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,o){if(!k.API_URL||!k.SESSION_PATH)return;let l=Ki(k.API_URL+k.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${o||k.ACCESS_TOKEN||""}`);let u={url:ul(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(h,g){return Rc(Wr(h,{method:"GET"}),g)}(u,h=>{this.pendingRequest=null,n(h),this.saveEventData(),this.processRequests(o)})}getSessionAPI(t,e,n,o){this.skuToken=e,this.errorCb=o,k.SESSION_PATH&&k.API_URL&&(n||k.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Gf)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},Ah=hl.getSessionAPI.bind(hl),Nc=new Set;var oa={exports:{}},kg={exports:function(t,e){var n,o,l,u,h,g,y,b;for(o=t.length-(n=3&t.length),l=e,h=3432918353,g=461845907,b=0;b<o;)y=255&t.charCodeAt(b)|(255&t.charCodeAt(++b))<<8|(255&t.charCodeAt(++b))<<16|(255&t.charCodeAt(++b))<<24,++b,l=27492+(65535&(u=5*(65535&(l=(l^=y=(65535&(y=(y=(65535&y)*h+(((y>>>16)*h&65535)<<16)&4294967295)<<15|y>>>17))*g+(((y>>>16)*g&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(u>>>16)&65535)<<16);switch(y=0,n){case 3:y^=(255&t.charCodeAt(b+2))<<16;case 2:y^=(255&t.charCodeAt(b+1))<<8;case 1:l^=y=(65535&(y=(y=(65535&(y^=255&t.charCodeAt(b)))*h+(((y>>>16)*h&65535)<<16)&4294967295)<<15|y>>>17))*g+(((y>>>16)*g&65535)<<16)&4294967295}return l^=t.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0}},ex={exports:function(t,e){for(var n,o=t.length,l=e^o,u=0;o>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(u)|(255&t.charCodeAt(++u))<<8|(255&t.charCodeAt(++u))<<16|(255&t.charCodeAt(++u))<<24))+((1540483477*(n>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++u;switch(o){case 3:l^=(255&t.charCodeAt(u+2))<<16;case 2:l^=(255&t.charCodeAt(u+1))<<8;case 1:l=1540483477*(65535&(l^=255&t.charCodeAt(u)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0}},Lg=kg.exports,qf=ex.exports;oa.exports=Lg,oa.exports.murmur3=Lg,oa.exports.murmur2=qf;var dl=We(oa.exports);function Wf(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function fl(t,e,n){if(n&&n[t]){let o=n[t].indexOf(e);o!==-1&&n[t].splice(o,1)}}class ci{constructor(e,n={}){Wr(this,n),this.type=e}}class Ph extends ci{constructor(e,n={}){super("error",Wr({error:e},n))}}class sa{on(e,n){return this._listeners=this._listeners||{},Wf(e,n,this._listeners),this}off(e,n){return fl(e,n,this._listeners),fl(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Wf(e,n,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,n){typeof e=="string"&&(e=new ci(e,n||{}));let o=e.type;if(this.listens(o)){e.target=this;let l=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(let g of l)g.call(this,e);let u=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(let g of u)fl(o,g,this._oneTimeListeners),g.call(this,e);let h=this._eventedParent;h&&(Wr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),h.fire(e))}else e instanceof Ph&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}r.F=void 0;var Fg={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Rh(t){return(t=Math.round(t))<0?0:t>255?255:t}function Zf(t){return Rh(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function zc(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Bc(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{r.F={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Fg)return Fg[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var o=n.indexOf("("),l=n.indexOf(")");if(o!==-1&&l+1===n.length){var u=n.substr(0,o),h=n.substr(o+1,l-(o+1)).split(","),g=1;switch(u){case"rgba":if(h.length!==4)return null;g=zc(h.pop());case"rgb":return h.length!==3?null:[Zf(h[0]),Zf(h[1]),Zf(h[2]),g];case"hsla":if(h.length!==4)return null;g=zc(h.pop());case"hsl":if(h.length!==3)return null;var y=(parseFloat(h[0])%360+360)%360/360,b=zc(h[1]),T=zc(h[2]),I=T<=.5?T*(b+1):T+b-T*b,D=2*T-I;return[Rh(255*Bc(D,I,y+1/3)),Rh(255*Bc(D,I,y)),Rh(255*Bc(D,I,y-1/3)),g];default:return null}}return null}}catch{}class pn{constructor(e,n,o,l=1){this.r=e,this.g=n,this.b=o,this.a=l}static parse(e){if(!e)return;if(e instanceof pn)return e;if(typeof e!="string")return;let n=r.F(e);return n?new pn(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,o,l]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(o)},${l})`}toRenderColor(e){let{r:n,g:o,b:l,a:u}=this;return new tx(e,n,o,l,u)}}class tx{constructor(e,n,o,l,u){if(e){let h=e.image.height,g=h*h;n=u===0?0:n/u*(h-1),o=u===0?0:o/u*(h-1),l=u===0?0:l/u*(h-1);let y=Math.floor(n),b=Math.floor(o),T=Math.floor(l),I=Math.ceil(n),D=Math.ceil(o),P=Math.ceil(l),R=n-y,L=o-b,N=l-T,j=e.image.data,Y=4*(y+b*g+T*h),X=4*(y+b*g+P*h),K=4*(y+D*g+T*h),ae=4*(y+D*g+P*h),oe=4*(I+b*g+T*h),fe=4*(I+b*g+P*h),me=4*(I+D*g+T*h),we=4*(I+D*g+P*h);if(Y<0||we>=j.length)throw new Error("out of range");this.r=bt(bt(bt(j[Y],j[X],N),bt(j[K],j[ae],N),L),bt(bt(j[oe],j[fe],N),bt(j[me],j[we],N),L),R)/255*u,this.g=bt(bt(bt(j[Y+1],j[X+1],N),bt(j[K+1],j[ae+1],N),L),bt(bt(j[oe+1],j[fe+1],N),bt(j[me+1],j[we+1],N),L),R)/255*u,this.b=bt(bt(bt(j[Y+2],j[X+2],N),bt(j[K+2],j[ae+2],N),L),bt(bt(j[oe+2],j[fe+2],N),bt(j[me+2],j[we+2],N),L),R)/255*u,this.a=u}else this.r=n,this.g=o,this.b=l,this.a=u}toArray(){let{r:e,g:n,b:o,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*n/l,255*o/l,l]}toArray01(){let{r:e,g:n,b:o,a:l}=this;return l===0?[0,0,0,0]:[e/l,n/l,o/l,l]}toArray01Scaled(e){let{r:n,g:o,b:l,a:u}=this;return u===0?[0,0,0]:[n/u*e,o/u*e,l/u*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:o,a:l}=this;return[e,n,o,l]}toArray01Linear(){let{r:e,g:n,b:o,a:l}=this;return l===0?[0,0,0,0]:[Math.pow(e/l,2.2),Math.pow(n/l,2.2),Math.pow(o/l,2.2),l]}}function bt(t,e,n){return t*(1-n)+e*n}function Ng(t,e,n){return t.map((o,l)=>bt(o,e[l],n))}pn.black=new pn(0,0,0,1),pn.white=new pn(1,1,1,1),pn.transparent=new pn(0,0,0,0),pn.red=new pn(1,0,0,1),pn.blue=new pn(0,0,1,1);var Oh=Object.freeze({__proto__:null,array:Ng,color:function(t,e,n){return new pn(bt(t.r,e.r,n),bt(t.g,e.g,n),bt(t.b,e.b,n),bt(t.a,e.a,n))},number:bt});function Yf(t,...e){for(let n of e)for(let o in n)t[o]=n[o];return t}class bo extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Xf{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[o,l]of n)this.bindings[o]=l}concat(e){return new Xf(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let pl={kind:"null"},dt={kind:"number"},mn={kind:"string"},gn={kind:"boolean"},ui={kind:"color"},ml={kind:"object"},ln={kind:"value"},Qi={kind:"collator"},gl={kind:"formatted"},wo={kind:"resolvedImage"};function yi(t,e){return{kind:"array",itemType:t,N:e}}function ur(t){if(t.kind==="array"){let e=ur(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let nx=[pl,dt,mn,gn,ui,gl,ml,yi(ln),wo];function Vc(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Vc(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let n of nx)if(!Vc(n,e))return null}}return`Expected ${ur(t)} but found ${ur(e)} instead.`}function Kf(t,e){return e.some(n=>n.kind===t.kind)}function _l(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}class jc{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class aa{constructor(e,n,o,l,u){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=o,this.fontStack=l,this.textColor=u}}class Zr{constructor(e){this.sections=e}static fromString(e){return new Zr([new aa(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Zr?e:Zr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let o={};n.fontStack&&(o["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(o["font-scale"]=n.scale),n.textColor&&(o["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),e.push(o)}return e}}class hi{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new hi({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function zg(t,e,n,o){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[t,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[t,e,n,o]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function di(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof pn||t instanceof jc||t instanceof Zr||t instanceof hi)return!0;if(Array.isArray(t)){for(let e of t)if(!di(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!di(t[e]))return!1;return!0}return!1}function mr(t){if(t===null)return pl;if(typeof t=="string")return mn;if(typeof t=="boolean")return gn;if(typeof t=="number")return dt;if(t instanceof pn)return ui;if(t instanceof jc)return Qi;if(t instanceof Zr)return gl;if(t instanceof hi)return wo;if(Array.isArray(t)){let e=t.length,n;for(let o of t){let l=mr(o);if(n){if(n===l)continue;n=ln;break}n=l}return yi(n||ln,e)}return ml}function Fi(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof pn||t instanceof Zr||t instanceof hi?t.toString():JSON.stringify(t)}class No{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!di(e[1]))return n.error("invalid value");let o=e[1],l=mr(o),u=n.expectedType;return l.kind!=="array"||l.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(l=u),new No(l,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof pn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Zr?this.value.serialize():this.value}}class wr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let Qf={string:mn,number:dt,boolean:gn,object:ml};class Ji{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,l=1,u=e[0];if(u==="array"){let g,y;if(e.length>2){let b=e[1];if(typeof b!="string"||!(b in Qf)||b==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);g=Qf[b],l++}else g=ln;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],l++}o=yi(g,y)}else o=Qf[u];let h=[];for(;l<e.length;l++){let g=n.parse(e[l],l,ln);if(!g)return null;h.push(g)}return new Ji(o,h)}evaluate(e){for(let n=0;n<this.args.length;n++){let o=this.args[n].evaluate(e);if(!Vc(this.type,mr(o)))return o;if(n===this.args.length-1)throw new wr(`Expected value to be of type ${ur(this.type)}, but found ${ur(mr(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){n.push(o.kind);let l=e.N;(typeof l=="number"||this.args.length>1)&&n.push(l)}}return n.concat(this.args.map(o=>o.serialize()))}}class Uc{constructor(e){this.type=gl,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");let l=[],u=!1;for(let h=1;h<=e.length-1;++h){let g=e[h];if(u&&typeof g=="object"&&!Array.isArray(g)){u=!1;let y=null;if(g["font-scale"]&&(y=n.parse(g["font-scale"],1,dt),!y))return null;let b=null;if(g["text-font"]&&(b=n.parse(g["text-font"],1,yi(mn)),!b))return null;let T=null;if(g["text-color"]&&(T=n.parse(g["text-color"],1,ui),!T))return null;let I=l[l.length-1];I.scale=y,I.font=b,I.textColor=T}else{let y=n.parse(e[h],1,ln);if(!y)return null;let b=y.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:y,scale:null,font:null,textColor:null})}}return new Uc(l)}evaluate(e){return new Zr(this.sections.map(n=>{let o=n.content.evaluate(e);return mr(o)===wo?new aa("",o,null,null,null):new aa(Fi(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let o={};n.scale&&(o["font-scale"]=n.scale.serialize()),n.font&&(o["text-font"]=n.font.serialize()),n.textColor&&(o["text-color"]=n.textColor.serialize()),e.push(o)}return e}}class $c{constructor(e,n){this.type=wo,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let o=n.parse(e[1],1,mn);if(!o)return n.error("No image name provided.");if(e.length===2)return new $c(o);let l=n.parse(e[2],1,mn);return l?new $c(o,l):n.error("Secondary image variant is not a string.")}evaluate(e){let n=hi.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function la(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let rx={"to-boolean":gn,"to-color":ui,"to-number":dt,"to-string":mn};class eo{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o=e[0],l=[],u=pl;if(o==="to-array"){if(!Array.isArray(e[1]))return null;let h=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);u=yi(n.expectedType.itemType,h)}else{if(!(h>0&&di(e[1][0])))return null;u=yi(mr(e[1][0]),h)}for(let g=0;g<h;g++){let y=e[1][g],b;if(la(y)==="array")b=n.parse(y,void 0,u.itemType);else{let T=la(y);if(T!==u.itemType.kind)return n.error(`Expected ${u.itemType.kind} but found ${T}.`);b=n.registry.literal.parse(["literal",y===void 0?null:y],n)}if(!b)return null;l.push(b)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");u=rx[o];for(let h=1;h<e.length;h++){let g=n.parse(e[h],h,ln);if(!g)return null;l.push(g)}}return new eo(u,l)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,o;for(let l of this.args){if(n=l.evaluate(e),o=null,n instanceof pn)return n;if(typeof n=="string"){let u=e.parseColor(n);if(u)return u}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:zg(n[0],n[1],n[2],n[3]),!o))return new pn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new wr(o||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let o of this.args){if(n=o.evaluate(e),n===null)return 0;let l=Number(n);if(!isNaN(l))return l}throw new wr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Zr.fromString(Fi(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?hi.fromString(Fi(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Fi(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Uc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new $c(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}let Bg=["Unknown","Point","LineString","Polygon"];class Vg{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Bg[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:o,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*n-e[0])+this.featureDistanceData.bearing[1]*(l*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=pn.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class ii{constructor(e,n,o,l,u){this.name=e,this.type=n,this._evaluate=o,this.args=l,this._overloadIndex=u}evaluate(e){if(!this._evaluate){let n=ii.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let o=e[0],l=ii.definitions[o];if(!l)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);let u=Array.isArray(l)?l[0]:l.type,h=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,g=[],y=null,b=-1;for(let[T,I]of h){if(Array.isArray(T)&&T.length!==e.length-1)continue;g.push(T),b++,y=new Kg(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);let D=[],P=!1;for(let R=1;R<e.length;R++){let L=e[R],N=Array.isArray(T)?T[R-1]:T.type,j=y.parse(L,1+D.length,N);if(!j){P=!0;break}D.push(j)}if(!P)if(Array.isArray(T)&&T.length!==D.length)y.error(`Expected ${T.length} arguments, but found ${D.length} instead.`);else{for(let R=0;R<D.length;R++){let L=Array.isArray(T)?T[R]:T.type,N=D[R];y.concat(R+1).checkSubtype(L,N.type)}if(y.errors.length===0)return new ii(o,u,I,D,b)}}if(g.length===1)n.errors.push(...y.errors);else{let T=(g.length?g:h.map(([D])=>D)).map(Jf).join(" | "),I=[];for(let D=1;D<e.length;D++){let P=n.parse(e[D],1+I.length);if(!P)return null;I.push(ur(P.type))}n.error(`Expected arguments of type ${T}, but found (${I.join(", ")}) instead.`)}return null}static register(e,n){ii.definitions=n;for(let o in n)e[o]=ii}}function Jf(t){return Array.isArray(t)?`(${t.map(ur).join(", ")})`:`(${ur(t.type)}...)`}class ms{constructor(e,n,o){this.type=Qi,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");let l=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,gn);if(!l)return null;let u=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,gn);if(!u)return null;let h=null;return o.locale&&(h=n.parse(o.locale,1,mn),!h)?null:new ms(l,u,h)}evaluate(e){return new jc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var ep={exports:{}};ep.exports=function(){function t(o,l,u,h,g){for(;h>u;){if(h-u>600){var y=h-u+1,b=l-u+1,T=Math.log(y),I=.5*Math.exp(2*T/3),D=.5*Math.sqrt(T*I*(y-I)/y)*(b-y/2<0?-1:1);t(o,l,Math.max(u,Math.floor(l-b*I/y+D)),Math.min(h,Math.floor(l+(y-b)*I/y+D)),g)}var P=o[l],R=u,L=h;for(e(o,u,l),g(o[h],P)>0&&e(o,u,h);R<L;){for(e(o,R,L),R++,L--;g(o[R],P)<0;)R++;for(;g(o[L],P)>0;)L--}g(o[u],P)===0?e(o,u,L):e(o,++L,h),L<=l&&(u=L+1),l<=L&&(h=L-1)}}function e(o,l,u){var h=o[l];o[l]=o[u],o[u]=h}function n(o,l){return o<l?-1:o>l?1:0}return function(o,l,u,h,g){t(o,l,u||0,h||o.length-1,g||n)}}();var ix=We(ep.exports);function ox(t){let e=0;for(let n,o,l=0,u=t.length,h=u-1;l<u;h=l++)n=t[l],o=t[h],e+=(o.x-n.x)*(n.y+o.y);return e}function Gc(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function yl(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function sx(t,e,n){let o=t[0]-e[0],l=t[1]-e[1],u=t[0]-n[0],h=t[1]-n[1];return o*h-u*l==0&&o*u<=0&&l*h<=0}function vl(t,e,n=!1){let o=!1;for(let g=0,y=e.length;g<y;g++){let b=e[g];for(let T=0,I=b.length,D=I-1;T<I;D=T++){let P=b[D],R=b[T];if(sx(t,P,R))return n;(u=P)[1]>(l=t)[1]!=(h=R)[1]>l[1]&&l[0]<(h[0]-u[0])*(l[1]-u[1])/(h[1]-u[1])+u[0]&&(o=!o)}}var l,u,h;return o}function tp(t,e,n,o){let l=o[0]-n[0],u=o[1]-n[1],h=(t[0]-n[0])*u-l*(t[1]-n[1]),g=(e[0]-n[0])*u-l*(e[1]-n[1]);return h>0&&g<0||h<0&&g>0}function an(t,e,n,o){return(l=[o[0]-n[0],o[1]-n[1]])[0]*(u=[e[0]-t[0],e[1]-t[1]])[1]-l[1]*u[0]!=0&&!(!tp(t,e,n,o)||!tp(n,o,t,e));var l,u}let zo=8192;function jg(t,e){let n=(180+t[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(n*l*zo),Math.round(o*l*zo)]}function ax(t,e){for(let n=0;n<e.length;n++)if(vl(t,e[n]))return!0;return!1}function lx(t,e,n){for(let o of n)for(let l=0,u=o.length,h=u-1;l<u;h=l++)if(an(t,e,o[h],o[l]))return!0;return!1}function Hc(t,e){for(let n=0;n<t.length;++n)if(!vl(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(lx(t[n],t[n+1],e))return!1;return!0}function kh(t,e){for(let n=0;n<e.length;n++)if(Hc(t,e[n]))return!0;return!1}function xl(t,e,n){let o=[];for(let l=0;l<t.length;l++){let u=[];for(let h=0;h<t[l].length;h++){let g=jg(t[l][h],n);Gc(e,g),u.push(g)}o.push(u)}return o}function Ug(t,e,n){let o=[];for(let l=0;l<t.length;l++){let u=xl(t[l],e,n);o.push(u)}return o}function np(t,e,n,o){if(t[0]<n[0]||t[0]>n[2]){let l=.5*o,u=t[0]-n[0]>l?-o:n[0]-t[0]>l?o:0;u===0&&(u=t[0]-n[2]>l?-o:n[2]-t[0]>l?o:0),t[0]+=u}Gc(e,t)}function to(t,e,n,o){let l=Math.pow(2,o.z)*zo,u=[o.x*zo,o.y*zo],h=[];if(!t)return h;for(let g of t)for(let y of g){let b=[y.x+u[0],y.y+u[1]];np(b,e,n,l),h.push(b)}return h}function $g(t,e,n,o){let l=Math.pow(2,o.z)*zo,u=[o.x*zo,o.y*zo],h=[];if(!t)return h;for(let y of t){let b=[];for(let T of y){let I=[T.x+u[0],T.y+u[1]];Gc(e,I),b.push(I)}h.push(b)}if(e[2]-e[0]<=l/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(let y of h)for(let b of y)np(b,e,n,l)}var g;return h}class gs{constructor(e,n){this.type=gn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(di(e[1])){let o=e[1];if(o.type==="FeatureCollection")for(let l=0;l<o.features.length;++l){let u=o.features[l].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new gs(o,o.features[l].geometry)}else if(o.type==="Feature"){let l=o.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new gs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new gs(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){let l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=n.canonicalID();if(!h)return!1;if(o.type==="Polygon"){let g=xl(o.coordinates,u,h),y=to(n.geometry(),l,u,h);if(!yl(l,u))return!1;for(let b of y)if(!vl(b,g))return!1}if(o.type==="MultiPolygon"){let g=Ug(o.coordinates,u,h),y=to(n.geometry(),l,u,h);if(!yl(l,u))return!1;for(let b of y)if(!ax(b,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){let l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=n.canonicalID();if(!h)return!1;if(o.type==="Polygon"){let g=xl(o.coordinates,u,h),y=$g(n.geometry(),l,u,h);if(!yl(l,u))return!1;for(let b of y)if(!Hc(b,g))return!1}if(o.type==="MultiPolygon"){let g=Ug(o.coordinates,u,h),y=$g(n.geometry(),l,u,h);if(!yl(l,u))return!1;for(let b of y)if(!kh(b,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let _s={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Lh=1/298.257223563,Gg=Lh*(2-Lh),qc=Math.PI/180;class Wc{static fromTile(e,n,o){let l=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),u=Math.atan(.5*(Math.exp(l)-Math.exp(-l)))/qc;return new Wc(u,o)}static get units(){return _s}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!_s[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(_s).join(", ")}`);let o=6378.137*qc*(n?_s[n]:1),l=Math.cos(e*qc),u=1/(1-Gg*(1-l*l)),h=Math.sqrt(u);this.kx=o*h*l,this.ky=o*h*u*(1-Gg)}distance(e,n){let o=Ni(e[0]-n[0])*this.kx,l=(e[1]-n[1])*this.ky;return Math.sqrt(o*o+l*l)}bearing(e,n){let o=Ni(n[0]-e[0])*this.kx;return Math.atan2(o,(n[1]-e[1])*this.ky)/qc}destination(e,n,o){let l=o*qc;return this.offset(e,Math.sin(l)*n,Math.cos(l)*n)}offset(e,n,o){return[e[0]+n/this.kx,e[1]+o/this.ky]}lineDistance(e){let n=0;for(let o=0;o<e.length-1;o++)n+=this.distance(e[o],e[o+1]);return n}area(e){let n=0;for(let o=0;o<e.length;o++){let l=e[o];for(let u=0,h=l.length,g=h-1;u<h;g=u++)n+=Ni(l[u][0]-l[g][0])*(l[u][1]+l[g][1])*(o?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let o=0;if(n<=0)return e[0];for(let l=0;l<e.length-1;l++){let u=e[l],h=e[l+1],g=this.distance(u,h);if(o+=g,o>n)return Zc(u,h,(n-(o-g))/g)}return e[e.length-1]}pointToSegmentDistance(e,n,o){let[l,u]=n,h=Ni(o[0]-l)*this.kx,g=(o[1]-u)*this.ky;if(h!==0||g!==0){let y=(Ni(e[0]-l)*this.kx*h+(e[1]-u)*this.ky*g)/(h*h+g*g);y>1?(l=o[0],u=o[1]):y>0&&(l+=h/this.kx*y,u+=g/this.ky*y)}return h=Ni(e[0]-l)*this.kx,g=(e[1]-u)*this.ky,Math.sqrt(h*h+g*g)}pointOnLine(e,n){let o=1/0,l=e[0][0],u=e[0][1],h=0,g=0;for(let y=0;y<e.length-1;y++){let b=e[y][0],T=e[y][1],I=Ni(e[y+1][0]-b)*this.kx,D=(e[y+1][1]-T)*this.ky,P=0;I===0&&D===0||(P=(Ni(n[0]-b)*this.kx*I+(n[1]-T)*this.ky*D)/(I*I+D*D),P>1?(b=e[y+1][0],T=e[y+1][1]):P>0&&(b+=I/this.kx*P,T+=D/this.ky*P)),I=Ni(n[0]-b)*this.kx,D=(n[1]-T)*this.ky;let R=I*I+D*D;R<o&&(o=R,l=b,u=T,h=y,g=P)}return{point:[l,u],index:h,t:Math.max(0,Math.min(1,g))}}lineSlice(e,n,o){let l=this.pointOnLine(o,e),u=this.pointOnLine(o,n);if(l.index>u.index||l.index===u.index&&l.t>u.t){let b=l;l=u,u=b}let h=[l.point],g=l.index+1,y=u.index;!rp(o[g],h[0])&&g<=y&&h.push(o[g]);for(let b=g+1;b<=y;b++)h.push(o[b]);return rp(o[y],u.point)||h.push(u.point),h}lineSliceAlong(e,n,o){let l=0,u=[];for(let h=0;h<o.length-1;h++){let g=o[h],y=o[h+1],b=this.distance(g,y);if(l+=b,l>e&&u.length===0&&u.push(Zc(g,y,(e-(l-b))/b)),l>=n)return u.push(Zc(g,y,(n-(l-b))/b)),u;l>e&&u.push(y)}return u}bufferPoint(e,n){let o=n/this.ky,l=n/this.kx;return[e[0]-l,e[1]-o,e[0]+l,e[1]+o]}bufferBBox(e,n){let o=n/this.ky,l=n/this.kx;return[e[0]-l,e[1]-o,e[2]+l,e[3]+o]}insideBBox(e,n){return Ni(e[0]-n[0])>=0&&Ni(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function rp(t,e){return t[0]===e[0]&&t[1]===e[1]}function Zc(t,e,n){let o=Ni(e[0]-t[0]);return[t[0]+o*n,t[1]+(e[1]-t[1])*n]}function Ni(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}var Yc={exports:{}};(function(t,e){t.exports=function(){var n=function(l,u){if(l===void 0&&(l=[]),u===void 0&&(u=o),this.data=l,this.length=this.data.length,this.compare=u,this.length>0)for(var h=(this.length>>1)-1;h>=0;h--)this._down(h)};function o(l,u){return l<u?-1:l>u?1:0}return n.prototype.push=function(l){this.data.push(l),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(this.length!==0){var l=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),l}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(l){for(var u=this.data,h=this.compare,g=u[l];l>0;){var y=l-1>>1,b=u[y];if(h(g,b)>=0)break;u[l]=b,l=y}u[l]=g},n.prototype._down=function(l){for(var u=this.data,h=this.compare,g=this.length>>1,y=u[l];l<g;){var b=1+(l<<1),T=u[b],I=b+1;if(I<this.length&&h(u[I],T)<0&&(b=I,T=u[I]),h(T,y)>=0)break;u[l]=T,l=b}u[l]=y},n}()})(Yc);var ip=We(Yc.exports),rt=8192;function Hg(t,e){return e.dist-t.dist}let op=100,sp=50;function qg(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Fh(t){return t[1]-t[0]+1}function To(t,e){let n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function ys(t,e){if(t[0]>t[1])return[null,null];let n=Fh(t);if(e){if(n===2)return[t,null];let o=Math.floor(n/2);return[[t[0],t[0]+o],[t[0]+o,t[1]]]}{if(n===1)return[t,null];let o=Math.floor(n/2)-1;return[[t[0],t[0]+o],[t[0]+o+1,t[1]]]}}function ca(t,e){let n=[1/0,1/0,-1/0,-1/0];if(!To(e,t.length))return n;for(let o=e[0];o<=e[1];++o)Gc(n,t[o]);return n}function Nh(t){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let o=0;o<t[n].length;++o)Gc(e,t[n][o]);return e}function vs(t,e,n){if(qg(t)||qg(e))return NaN;let o=0,l=0;return t[2]<e[0]&&(o=e[0]-t[2]),t[0]>e[2]&&(o=t[0]-e[2]),t[1]>e[3]&&(l=t[1]-e[3]),t[3]<e[1]&&(l=e[1]-t[3]),n.distance([0,0],[o,l])}function cx(t){return 360*t-180}function ux(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function ap(t,e){let n=Math.pow(2,e.z),o=(t.y/rt+e.y)/n;return[cx((t.x/rt+e.x)/n),ux(o)]}function hx(t,e){let n=[];for(let o=0;o<t.length;++o)n.push(ap(t[o],e));return n}function Wg(t,e,n){let o=n.pointOnLine(e,t).point;return n.distance(t,o)}function xs(t,e,n,o,l){let u=n.slice(o[0],o[1]+1),h=1/0;for(let g=e[0];g<=e[1];++g)if((h=Math.min(h,Wg(t[g],u,l)))===0)return 0;return h}function lp(t,e,n,o,l){let u=Math.min(l.pointToSegmentDistance(t,n,o),l.pointToSegmentDistance(e,n,o)),h=Math.min(l.pointToSegmentDistance(n,t,e),l.pointToSegmentDistance(o,t,e));return Math.min(u,h)}function dx(t,e,n,o,l){if(!To(e,t.length)||!To(o,n.length))return NaN;let u=1/0;for(let h=e[0];h<e[1];++h)for(let g=o[0];g<o[1];++g){if(an(t[h],t[h+1],n[g],n[g+1]))return 0;u=Math.min(u,lp(t[h],t[h+1],n[g],n[g+1],l))}return u}function Zg(t,e,n,o,l){if(!To(e,t.length)||!To(o,n.length))return NaN;let u=1/0;for(let h=e[0];h<=e[1];++h)for(let g=o[0];g<=o[1];++g)if((u=Math.min(u,l.distance(t[h],n[g])))===0)return u;return u}function Yg(t,e,n){if(vl(t,e,!0))return 0;let o=1/0;for(let l of e){let u=l.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(l[0]!==l[u-1]&&(o=Math.min(o,n.pointToSegmentDistance(t,l[u-1],l[0])))===0||(o=Math.min(o,Wg(t,l,n)))===0)return o}return o}function no(t,e,n,o){if(!To(e,t.length))return NaN;for(let u=e[0];u<=e[1];++u)if(vl(t[u],n,!0))return 0;let l=1/0;for(let u=e[0];u<e[1];++u)for(let h of n)for(let g=0,y=h.length,b=y-1;g<y;b=g++){if(an(t[u],t[u+1],h[b],h[g]))return 0;l=Math.min(l,lp(t[u],t[u+1],h[b],h[g],o))}return l}function cp(t,e){for(let n of t)for(let o=0;o<=n.length-1;++o)if(vl(n[o],e,!0))return!0;return!1}function fx(t,e,n,o=1/0){let l=Nh(t),u=Nh(e);if(o!==1/0&&vs(l,u,n)>=o)return o;if(yl(l,u)){if(cp(t,e))return 0}else if(cp(e,t))return 0;let h=o;for(let g of t)for(let y=0,b=g.length,T=b-1;y<b;T=y++)for(let I of e)for(let D=0,P=I.length,R=P-1;D<P;R=D++){if(an(g[T],g[y],I[R],I[D]))return 0;h=Math.min(h,lp(g[T],g[y],I[R],I[D],n))}return h}function Xc(t,e,n,o,l,u,h){if(u===null||h===null)return;let g=vs(ca(o,u),ca(l,h),n);g<e&&t.push({dist:g,range1:u,range2:h})}function zh(t,e,n,o,l=1/0){let u=Math.min(o.distance(t[0],n[0][0]),l);if(u===0)return u;let h=new ip([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Hg),g=e?sp:op,y=Nh(n);for(;h.length;){let b=h.pop();if(b.dist>=u)continue;let T=b.range1;if(Fh(T)<=g){if(!To(T,t.length))return NaN;if(e){let I=no(t,T,n,o);if((u=Math.min(u,I))===0)return u}else for(let I=T[0];I<=T[1];++I){let D=Yg(t[I],n,o);if((u=Math.min(u,D))===0)return u}}else{let I=ys(T,e);if(I[0]!==null){let D=vs(ca(t,I[0]),y,o);D<u&&h.push({dist:D,range1:I[0],range2:[0,0]})}if(I[1]!==null){let D=vs(ca(t,I[1]),y,o);D<u&&h.push({dist:D,range1:I[1],range2:[0,0]})}}}return u}function Xg(t,e,n,o,l,u=1/0){let h=Math.min(u,l.distance(t[0],n[0]));if(h===0)return h;let g=new ip([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],Hg),y=e?sp:op,b=o?sp:op;for(;g.length;){let T=g.pop();if(T.dist>=h)continue;let I=T.range1,D=T.range2;if(Fh(I)<=y&&Fh(D)<=b){if(!To(I,t.length)||!To(D,n.length))return NaN;if(e&&o?h=Math.min(h,dx(t,I,n,D,l)):e||o?e&&!o?h=Math.min(h,xs(n,D,t,I,l)):!e&&o&&(h=Math.min(h,xs(t,I,n,D,l))):h=Math.min(h,Zg(t,I,n,D,l)),h===0)return h}else{let P=ys(I,e),R=ys(D,o);Xc(g,h,l,t,n,P[0],R[0]),Xc(g,h,l,t,n,P[0],R[1]),Xc(g,h,l,t,n,P[1],R[0]),Xc(g,h,l,t,n,P[1],R[1])}}return h}function up(t,e,n,o,l=1/0){let u=l,h=ca(t,[0,t.length-1]);for(let g of n)if(!(u!==1/0&&vs(h,ca(g,[0,g.length-1]),o)>=u)&&(u=Math.min(u,Xg(t,e,g,!0,o,u)),u===0))return u;return u}function Bh(t,e,n,o,l=1/0){let u=l,h=ca(t,[0,t.length-1]);for(let g of n){if(u!==1/0&&vs(h,Nh(g),o)>=u)continue;let y=zh(t,e,g,o,u);if(isNaN(y))return y;if((u=Math.min(u,y))===0)return u}return u}function hp(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class ua{constructor(e,n){this.type=dt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(di(e[1])){let o=e[1];if(o.type==="FeatureCollection"){for(let l=0;l<o.features.length;++l)if(hp(o.features[l].geometry.type))return new ua(o,o.features[l].geometry)}else if(o.type==="Feature"){if(hp(o.geometry.type))return new ua(o,o.geometry)}else if(hp(o.type))return new ua(o,o)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),o=e.canonicalID();if(n!=null&&o!=null){if(e.geometryType()==="Point")return function(l,u,h){let g=[];for(let b of l)for(let T of b)g.push(ap(T,u));let y=new Wc(g[0][1],"meters");return h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString"?Xg(g,!1,h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",y):h.type==="MultiLineString"?up(g,!1,h.coordinates,y):h.type==="Polygon"||h.type==="MultiPolygon"?Bh(g,!1,h.type==="Polygon"?[h.coordinates]:h.coordinates,y):null}(n,o,this.geometries);if(e.geometryType()==="LineString")return function(l,u,h){let g=[];for(let b of l){let T=[];for(let I of b)T.push(ap(I,u));g.push(T)}let y=new Wc(g[0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return up(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",g,y);if(h.type==="MultiLineString"){let b=1/0;for(let T=0;T<h.coordinates.length;T++){let I=up(h.coordinates[T],!0,g,y,b);if(isNaN(I))return I;if((b=Math.min(b,I))===0)return b}return b}if(h.type==="Polygon"||h.type==="MultiPolygon"){let b=1/0;for(let T=0;T<g.length;T++){let I=Bh(g[T],!0,h.type==="Polygon"?[h.coordinates]:h.coordinates,y,b);if(isNaN(I))return I;if((b=Math.min(b,I))===0)return b}return b}return null}(n,o,this.geometries);if(e.geometryType()==="Polygon")return function(l,u,h){let g=[];for(let b of function(T,I){let D=T.length;if(D<=1)return[T];let P=[],R,L;for(let N=0;N<D;N++){let j=ox(T[N]);j!==0&&(T[N].area=Math.abs(j),L===void 0&&(L=j<0),L===j<0?(R&&P.push(R),R=[T[N]]):R.push(T[N]))}return R&&P.push(R),P}(l)){let T=[];for(let I=0;I<b.length;++I)T.push(hx(b[I],u));g.push(T)}let y=new Wc(g[0][0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return Bh(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",g,y);if(h.type==="MultiLineString"){let b=1/0;for(let T=0;T<h.coordinates.length;T++){let I=Bh(h.coordinates[T],!0,g,y,b);if(isNaN(I))return I;if((b=Math.min(b,I))===0)return b}return b}return h.type==="Polygon"||h.type==="MultiPolygon"?function(b,T,I){let D=1/0;for(let P of b)for(let R of T){let L=fx(P,R,I,D);if(isNaN(L))return L;if((D=Math.min(D,L))===0)return D}return D}(h.type==="Polygon"?[h.coordinates]:h.coordinates,g,y):null}(n,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function bl(t,e){switch(t){case"string":return Fi(e);case"number":return+e;case"boolean":return!!e;case"color":return pn.parse(e);case"formatted":return Zr.fromString(Fi(e));case"resolvedImage":return hi.fromString(Fi(e))}return e}function Kc(t,e,n,o){return o!==void 0&&(t=o*Math.round(t/o)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}class Or{constructor(e,n,o){this.type=e,this.key=n,this.scope=o}static parse(e,n){let o=n.expectedType;if(o==null&&(o=ln),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");let l=n.parse(e[1],1);if(!(l instanceof No))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let u=n.parse(e[2],2);return u instanceof No?new Or(o,Fi(l.value),Fi(u.value)):n.error("Scope of 'config' expression must be a string literal.")}return new Or(o,Fi(l.value))}evaluate(e){let n=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(n);if(!o)return null;let{type:l,value:u,values:h,minValue:g,maxValue:y,stepValue:b}=o,T=o.default.evaluate(e),I=T;if(u){let D=e.scope;e.scope=(D||"").split("").slice(1).join(""),I=u.evaluate(e),e.scope=D}return l&&(I=bl(l,I)),I===void 0||g===void 0&&y===void 0&&b===void 0||(typeof I=="number"?I=Kc(I,g,y,b):Array.isArray(I)&&(I=I.map(D=>typeof D=="number"?Kc(D,g,y,b):D))),u!==void 0&&I!==void 0&&h&&!h.includes(I)&&(I=T,l&&(I=bl(l,I))),(l&&l!==this.type||I!==void 0&&mr(I)!==this.type)&&(I=bl(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function bs(t){if(t instanceof ii&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof gs||t instanceof ua)return!1;let e=!0;return t.eachChild(n=>{e&&!bs(n)&&(e=!1)}),e}function Vh(t){if(t instanceof ii&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!Vh(n)&&(e=!1)}),e}function dp(t){if(t instanceof Or)return!1;let e=!0;return t.eachChild(n=>{e&&!dp(n)&&(e=!1)}),e}function Qc(t,e){if(t instanceof ii&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(o=>{n&&!Qc(o,e)&&(n=!1)}),n}class jh{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let o=e[1];return n.scope.has(o)?new jh(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Jc{constructor(e,n=[],o,l=new Xf,u=[],h,g){this.registry=e,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=l,this.errors=u,this.expectedType=o,this._scope=h,this.options=g}parse(e,n,o,l,u={}){return n||o?this.concat(n,o,l)._parse(e,u):this._parse(e,u)}_parse(e,n){function o(l,u,h){return h==="assert"?new Ji(u,[l]):h==="coerce"?new eo(u,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let l=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(l){let u=l.parse(e,this);if(!u)return null;if(this.expectedType){let h=this.expectedType,g=u.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||g.kind!=="value")if(h.kind!=="color"&&h.kind!=="formatted"&&h.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(h,g))return null}else u=o(u,h,n.typeAnnotation||"coerce");else u=o(u,h,n.typeAnnotation||"assert")}if(!(u instanceof No)&&u.type.kind!=="resolvedImage"&&eu(u)){let h=new Vg(this._scope,this.options);try{u=new No(u.type,u.evaluate(h))}catch(g){return this.error(g.message),null}}return u}return eo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){let l=typeof e=="number"?this.path.concat(e):this.path,u=o?this.scope.concat(o):this.scope;return new Jc(this.registry,l,n||null,u,this.errors,this._scope,this.options)}error(e,...n){let o=`${this.key}${n.map(l=>`[${l}]`).join("")}`;this.errors.push(new bo(o,e))}checkSubtype(e,n){let o=Vc(e,n);return o&&this.error(o),o}}var Kg=Jc;function eu(t){if(t instanceof jh)return eu(t.boundExpression);if(t instanceof ii&&t.name==="error"||t instanceof ms||t instanceof gs||t instanceof ua||t instanceof Or)return!1;let e=t instanceof eo||t instanceof Ji,n=!0;return t.eachChild(o=>{n=e?n&&eu(o):n&&o instanceof No}),!!n&&bs(t)&&Qc(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Uh(t,e){let n=t.length-1,o,l,u=0,h=n,g=0;for(;u<=h;)if(g=Math.floor((u+h)/2),o=t[g],l=t[g+1],o<=e){if(g===n||e<l)return g;u=g+1}else{if(!(o>e))throw new wr("Input is not a number.");h=g-1}return 0}class tu{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[l,u]of o)this.labels.push(l),this.outputs.push(u)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let o=n.parse(e[1],1,dt);if(!o)return null;let l=[],u=null;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);for(let h=1;h<e.length;h+=2){let g=h===1?-1/0:e[h],y=e[h+1],b=h,T=h+1;if(typeof g!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(l.length&&l[l.length-1][0]>=g)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);let I=n.parse(y,T,u);if(!I)return null;u=u||I.type,l.push([g,I])}return new tu(u,o,l)}evaluate(e){let n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);let l=this.input.evaluate(e);if(l<=n[0])return o[0].evaluate(e);let u=n.length;return l>=n[u-1]?o[u-1].evaluate(e):o[Uh(n,l)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}let $h=.95047,Qg=1.08883,fp=4/29,ha=6/29,Jg=3*ha*ha,pp=ha*ha*ha,Gh=Math.PI/180,e_=180/Math.PI;function mp(t){return t>pp?Math.pow(t,1/3):t/Jg+fp}function Hh(t){return t>ha?t*t*t:Jg*(t-fp)}function gp(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function nu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function t_(t){let e=nu(t.r),n=nu(t.g),o=nu(t.b),l=mp((.4124564*e+.3575761*n+.1804375*o)/$h),u=mp((.2126729*e+.7151522*n+.072175*o)/1);return{l:116*u-16,a:500*(l-u),b:200*(u-mp((.0193339*e+.119192*n+.9503041*o)/Qg)),alpha:t.a}}function n_(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,o=isNaN(t.b)?e:e-t.b/200;return e=1*Hh(e),n=$h*Hh(n),o=Qg*Hh(o),new pn(gp(3.2404542*n-1.5371385*e-.4985314*o),gp(-.969266*n+1.8760108*e+.041556*o),gp(.0556434*n-.2040259*e+1.0572252*o),t.alpha)}function px(t,e,n){let o=e-t;return t+n*(o>180||o<-180?o-360*Math.round(o/360):o)}let ru={forward:t_,reverse:n_,interpolate:function(t,e,n){return{l:bt(t.l,e.l,n),a:bt(t.a,e.a,n),b:bt(t.b,e.b,n),alpha:bt(t.alpha,e.alpha,n)}}},wl={forward:function(t){let{l:e,a:n,b:o}=t_(t),l=Math.atan2(o,n)*e_;return{h:l<0?l+360:l,c:Math.sqrt(n*n+o*o),l:e,alpha:t.a}},reverse:function(t){let e=t.h*Gh,n=t.c;return n_({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:px(t.h,e.h,n),c:bt(t.c,e.c,n),l:bt(t.l,e.l,n),alpha:bt(t.alpha,e.alpha,n)}}};var r_=Object.freeze({__proto__:null,hcl:wl,lab:ru});class Ii{constructor(e,n,o,l,u){this.type=e,this.operator=n,this.interpolation=o,this.input=l,this.labels=[],this.outputs=[];for(let[h,g]of u)this.labels.push(h),this.outputs.push(g)}static interpolationFactor(e,n,o,l){let u=0;if(e.name==="exponential")u=_p(n,e.base,o,l);else if(e.name==="linear")u=_p(n,1,o,l);else if(e.name==="cubic-bezier"){let h=e.controlPoints;u=new Ec(h[0],h[1],h[2],h[3]).solve(_p(n,1,o,l))}return u}static parse(e,n){let[o,l,u,...h]=e;if(!Array.isArray(l)||l.length===0)return n.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){let b=l[1];if(typeof b!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:b}}else{if(l[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(l[0])}`,1,0);{let b=l.slice(1);if(b.length!==4||b.some(T=>typeof T!="number"||T<0||T>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(u=n.parse(u,2,dt),!u)return null;let g=[],y=null;o==="interpolate-hcl"||o==="interpolate-lab"?y=ui:n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let b=0;b<h.length;b+=2){let T=h[b],I=h[b+1],D=b+3,P=b+4;if(typeof T!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(g.length&&g[g.length-1][0]>=T)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);let R=n.parse(I,P,y);if(!R)return null;y=y||R.type,g.push([T,R])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new Ii(y,o,l,u,g):n.error(`Type ${ur(y)} is not interpolatable.`)}evaluate(e){let n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);let l=this.input.evaluate(e);if(l<=n[0])return o[0].evaluate(e);let u=n.length;if(l>=n[u-1])return o[u-1].evaluate(e);let h=Uh(n,l),g=Ii.interpolationFactor(this.interpolation,l,n[h],n[h+1]),y=o[h].evaluate(e),b=o[h+1].evaluate(e);return this.operator==="interpolate"?Oh[this.type.kind.toLowerCase()](y,b,g):this.operator==="interpolate-hcl"?wl.reverse(wl.interpolate(wl.forward(y),wl.forward(b),g)):ru.reverse(ru.interpolate(ru.forward(y),ru.forward(b),g))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)n.push(this.labels[o],this.outputs[o].serialize());return n}}function _p(t,e,n,o){let l=o-n,u=t-n;return l===0?0:e===1?u/l:(Math.pow(e,u)-1)/(Math.pow(e,l)-1)}class qh{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let o=null,l=n.expectedType;l&&l.kind!=="value"&&(o=l);let u=[];for(let g of e.slice(1)){let y=n.parse(g,1+u.length,o,void 0,{typeAnnotation:"omit"});if(!y)return null;o=o||y.type,u.push(y)}let h=l&&u.some(g=>Vc(l,g.type));return new qh(h?ln:o,u)}evaluate(e){let n,o=null,l=0;for(let u of this.args){if(l++,o=u.evaluate(e),o&&o instanceof hi&&!o.available&&(n||(n=o),o=null,l===this.args.length))return n;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Wh{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let o=[];for(let u=1;u<e.length-1;u+=2){let h=e[u];if(typeof h!="string")return n.error(`Expected string, but found ${typeof h} instead.`,u);if(/[^a-zA-Z0-9_]/.test(h))return n.error("Variable names must contain only alphanumeric characters or '_'.",u);let g=n.parse(e[u+1],u+1);if(!g)return null;o.push([h,g])}let l=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return l?new Wh(o,l):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,o]of this.bindings)e.push(n,o.serialize());return e.push(this.result.serialize()),e}}class yp{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,dt),l=n.parse(e[2],2,yi(n.expectedType||ln));return o&&l?new yp(l.type.itemType,o,l):null}evaluate(e){let n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new wr(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new wr(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new wr(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class vp{constructor(e,n){this.type=gn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,ln),l=n.parse(e[2],2,ln);return o&&l?Kf(o.type,[gn,mn,dt,pl,ln])?new vp(o,l):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ur(o.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!_l(n,["boolean","string","number","null"]))throw new wr(`Expected first argument to be of type boolean, string, number or null, but found ${ur(mr(n))} instead.`);if(!_l(o,["string","array"]))throw new wr(`Expected second argument to be of type array or string, but found ${ur(mr(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Zh{constructor(e,n,o){this.type=dt,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,ln),l=n.parse(e[2],2,ln);if(!o||!l)return null;if(!Kf(o.type,[gn,mn,dt,pl,ln]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ur(o.type)} instead`);if(e.length===4){let u=n.parse(e[3],3,dt);return u?new Zh(o,l,u):null}return new Zh(o,l)}evaluate(e){let n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!_l(n,["boolean","string","number","null"]))throw new wr(`Expected first argument to be of type boolean, string, number or null, but found ${ur(mr(n))} instead.`);if(!_l(o,["string","array"]))throw new wr(`Expected second argument to be of type array or string, but found ${ur(mr(o))} instead.`);if(this.fromIndex){let l=this.fromIndex.evaluate(e);return o.indexOf(n,l)}return o.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Tl{constructor(e,n,o,l,u,h){this.inputType=e,this.type=n,this.input=o,this.cases=l,this.outputs=u,this.otherwise=h}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);let u={},h=[];for(let b=2;b<e.length-1;b+=2){let T=e[b],I=e[b+1];Array.isArray(T)||(T=[T]);let D=n.concat(b);if(T.length===0)return D.error("Expected at least one branch label.");for(let R of T){if(typeof R!="number"&&typeof R!="string")return D.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return D.error("Numeric branch labels must be integer values.");if(o){if(D.checkSubtype(o,mr(R)))return null}else o=mr(R);if(u[String(R)]!==void 0)return D.error("Branch labels must be unique.");u[String(R)]=h.length}let P=n.parse(I,b,l);if(!P)return null;l=l||P.type,h.push(P)}let g=n.parse(e[1],1,ln);if(!g)return null;let y=n.parse(e[e.length-1],e.length-1,l);return y?g.type.kind!=="value"&&n.concat(1).checkSubtype(o,g.type)?null:new Tl(o,l,g,u,h,y):null}evaluate(e){let n=this.input.evaluate(e);return(mr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),o=[],l={};for(let h of n){let g=l[this.cases[h]];g===void 0?(l[this.cases[h]]=o.length,o.push([this.cases[h],[h]])):o[g][1].push(h)}let u=h=>this.inputType.kind==="number"?Number(h):h;for(let[h,g]of o)e.push(g.length===1?u(g[0]):g.map(u)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}class xp{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);let l=[];for(let h=1;h<e.length-1;h+=2){let g=n.parse(e[h],h,gn);if(!g)return null;let y=n.parse(e[h+1],h+1,o);if(!y)return null;l.push([g,y]),o=o||y.type}let u=n.parse(e[e.length-1],e.length-1,o);return u?new xp(o,l,u):null}evaluate(e){for(let[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Yh{constructor(e,n,o,l){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,ln),l=n.parse(e[2],2,dt);if(!o||!l)return null;if(!Kf(o.type,[yi(ln),mn,ln]))return n.error(`Expected first argument to be of type array or string, but found ${ur(o.type)} instead`);if(e.length===4){let u=n.parse(e[3],3,dt);return u?new Yh(o.type,o,l,u):null}return new Yh(o.type,o,l)}evaluate(e){let n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!_l(n,["string","array"]))throw new wr(`Expected first argument to be of type array or string, but found ${ur(mr(n))} instead.`);if(this.endIndex){let l=this.endIndex.evaluate(e);return n.slice(o,l)}return n.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function iu(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function i_(t,e,n,o){return o.compare(e,n)===0}function da(t,e,n){let o=t!=="=="&&t!=="!=";return class uk{constructor(u,h,g){this.type=gn,this.lhs=u,this.rhs=h,this.collator=g,this.hasUntypedArgument=u.type.kind==="value"||h.type.kind==="value"}static parse(u,h){if(u.length!==3&&u.length!==4)return h.error("Expected two or three arguments.");let g=u[0],y=h.parse(u[1],1,ln);if(!y)return null;if(!iu(g,y.type))return h.concat(1).error(`"${g}" comparisons are not supported for type '${ur(y.type)}'.`);let b=h.parse(u[2],2,ln);if(!b)return null;if(!iu(g,b.type))return h.concat(2).error(`"${g}" comparisons are not supported for type '${ur(b.type)}'.`);if(y.type.kind!==b.type.kind&&y.type.kind!=="value"&&b.type.kind!=="value")return h.error(`Cannot compare types '${ur(y.type)}' and '${ur(b.type)}'.`);o&&(y.type.kind==="value"&&b.type.kind!=="value"?y=new Ji(b.type,[y]):y.type.kind!=="value"&&b.type.kind==="value"&&(b=new Ji(y.type,[b])));let T=null;if(u.length===4){if(y.type.kind!=="string"&&b.type.kind!=="string"&&y.type.kind!=="value"&&b.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(T=h.parse(u[3],3,Qi),!T)return null}return new uk(y,b,T)}evaluate(u){let h=this.lhs.evaluate(u),g=this.rhs.evaluate(u);if(o&&this.hasUntypedArgument){let y=mr(h),b=mr(g);if(y.kind!==b.kind||y.kind!=="string"&&y.kind!=="number")throw new wr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${b.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){let y=mr(h),b=mr(g);if(y.kind!=="string"||b.kind!=="string")return e(u,h,g)}return this.collator?n(u,h,g,this.collator.evaluate(u)):e(u,h,g)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){let u=[t];return this.eachChild(h=>{u.push(h.serialize())}),u}}}let mx=da("==",function(t,e,n){return e===n},i_),o_=da("!=",function(t,e,n){return e!==n},function(t,e,n,o){return!i_(0,e,n,o)}),s_=da("<",function(t,e,n){return e<n},function(t,e,n,o){return o.compare(e,n)<0}),a_=da(">",function(t,e,n){return e>n},function(t,e,n,o){return o.compare(e,n)>0}),l_=da("<=",function(t,e,n){return e<=n},function(t,e,n,o){return o.compare(e,n)<=0}),bp=da(">=",function(t,e,n){return e>=n},function(t,e,n,o){return o.compare(e,n)>=0});class ou{constructor(e,n,o,l,u,h){this.type=mn,this.number=e,this.locale=n,this.currency=o,this.unit=l,this.minFractionDigits=u,this.maxFractionDigits=h}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let o=n.parse(e[1],1,dt);if(!o)return null;let l=e[2];if(typeof l!="object"||Array.isArray(l))return n.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=n.parse(l.locale,1,mn),!u))return null;let h=null;if(l.currency&&(h=n.parse(l.currency,1,mn),!h))return null;let g=null;if(l.unit&&(g=n.parse(l.unit,1,mn),!g))return null;let y=null;if(l["min-fraction-digits"]&&(y=n.parse(l["min-fraction-digits"],1,dt),!y))return null;let b=null;return l["max-fraction-digits"]&&(b=n.parse(l["max-fraction-digits"],1,dt),!b)?null:new ou(o,u,h,g,y,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class wp{constructor(e){this.type=dt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${ur(o.type)} instead.`):new wp(o):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new wr(`Expected value to be of type string or array, but found ${ur(mr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function c_(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let fa={"==":mx,"!=":o_,">":a_,"<":s_,">=":bp,"<=":l_,array:Ji,at:yp,boolean:Ji,case:xp,coalesce:qh,collator:ms,format:Uc,image:$c,in:vp,"index-of":Zh,interpolate:Ii,"interpolate-hcl":Ii,"interpolate-lab":Ii,length:wp,let:Wh,literal:No,match:Tl,number:Ji,"number-format":ou,object:Ji,slice:Yh,step:tu,string:Ji,"to-boolean":eo,"to-color":eo,"to-number":eo,"to-string":eo,var:jh,within:gs,distance:ua,config:Or};function u_(t,[e,n,o,l]){e=e.evaluate(t),n=n.evaluate(t),o=o.evaluate(t);let u=l?l.evaluate(t):1,h=zg(e,n,o,u);if(h)throw new wr(h);return new pn(e/255*u,n/255*u,o/255*u,u)}function h_(t,[e,n,o,l]){e=e.evaluate(t),n=n.evaluate(t),o=o.evaluate(t);let u=l?l.evaluate(t):1,h=function(b,T,I,D){return typeof b=="number"&&b>=0&&b<=360?typeof T=="number"&&T>=0&&T<=100&&typeof I=="number"&&I>=0&&I<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[b,T,I,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[b,T,I,D]:[b,T,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[b,T,I,D]:[b,T,I]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,o,u);if(h)throw new wr(h);let g=`hsla(${e}, ${n}%, ${o}%, ${u})`,y=pn.parse(g);if(!y)throw new wr(`Failed to parse HSLA color: ${g}`);return y}function d_(t,e){return t in e}function Tp(t,e){let n=e[t];return n===void 0?null:n}function pa(t){return{type:t}}function f_(t){return{result:"success",value:t}}function ma(t){return{result:"error",value:t}}function p_(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Xh(t){return t["property-type"]==="data-driven"}function gx(t){return p_(t.expression,"measure-light")}function d(t){return p_(t.expression,"zoom")}function i(t){return!!t.expression&&t.expression.interpolated}function c(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function m(t){return t}function v(t,e){let n=e.type==="color",o=t.stops&&typeof t.stops[0][0]=="object",l=o||!(o||t.property!==void 0),u=t.type||(i(e)?"exponential":"interval");if(n&&((t=Yf({},t)).stops&&(t.stops=t.stops.map(b=>[b[0],pn.parse(b[1])])),t.default=pn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!r_[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let h,g,y;if(u==="exponential")h=S;else if(u==="interval")h=E;else if(u==="categorical"){h=w,g=Object.create(null);for(let b of t.stops)g[b[0]]=b[1];y=typeof t.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);h=M}if(o){let b={},T=[];for(let P=0;P<t.stops.length;P++){let R=t.stops[P],L=R[0].zoom;b[L]===void 0&&(b[L]={zoom:L,type:t.type,property:t.property,default:t.default,stops:[]},T.push(L)),b[L].stops.push([R[0].value,R[1]])}let I=[];for(let P of T)I.push([b[P].zoom,v(b[P],e)]);let D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:Ii.interpolationFactor.bind(void 0,D),zoomStops:I.map(P=>P[0]),evaluate:({zoom:P},R)=>S({stops:I,base:t.base},e,P).evaluate(P,R)}}if(l){let b=u==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:Ii.interpolationFactor.bind(void 0,b),zoomStops:t.stops.map(T=>T[0]),evaluate:({zoom:T})=>h(t,e,T,g,y)}}return{kind:"source",evaluate(b,T){let I=T&&T.properties?T.properties[t.property]:void 0;return I===void 0?x(t.default,e.default):h(t,e,I,g,y)}}}function x(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function w(t,e,n,o,l){return x(typeof n===l?o[n]:void 0,t.default,e.default)}function E(t,e,n){if(la(n)!=="number")return x(t.default,e.default);let o=t.stops.length;if(o===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[o-1][0])return t.stops[o-1][1];let l=Uh(t.stops.map(u=>u[0]),n);return t.stops[l][1]}function S(t,e,n){let o=t.base!==void 0?t.base:1;if(la(n)!=="number")return x(t.default,e.default);let l=t.stops.length;if(l===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[l-1][0])return t.stops[l-1][1];let u=Uh(t.stops.map(T=>T[0]),n),h=function(T,I,D,P){let R=P-D,L=T-D;return R===0?0:I===1?L/R:(Math.pow(I,L)-1)/(Math.pow(I,R)-1)}(n,o,t.stops[u][0],t.stops[u+1][0]),g=t.stops[u][1],y=t.stops[u+1][1],b=Oh[e.type]||m;if(t.colorSpace&&t.colorSpace!=="rgb"){let T=r_[t.colorSpace];b=(I,D)=>T.reverse(T.interpolate(T.forward(I),T.forward(D),h))}return typeof g.evaluate=="function"?{evaluate(...T){let I=g.evaluate.apply(void 0,T),D=y.evaluate.apply(void 0,T);if(I!==void 0&&D!==void 0)return b(I,D,h)}}:b(g,y,h)}function M(t,e,n){return e.type==="color"?n=pn.parse(n):e.type==="formatted"?n=Zr.fromString(n.toString()):e.type==="resolvedImage"?n=hi.fromString(n.toString()):la(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),x(n,t.default,e.default)}ii.register(fa,{error:[{kind:"error"},[mn],(t,[e])=>{throw new wr(e.evaluate(t))}],typeof:[mn,[ln],(t,[e])=>ur(mr(e.evaluate(t)))],"to-rgba":[yi(dt,4),[ui],(t,[e])=>e.evaluate(t).toRenderColor(null).toArray()],rgb:[ui,[dt,dt,dt],u_],rgba:[ui,[dt,dt,dt,dt],u_],hsl:[ui,[dt,dt,dt],h_],hsla:[ui,[dt,dt,dt,dt],h_],has:{type:gn,overloads:[[[mn],(t,[e])=>d_(e.evaluate(t),t.properties())],[[mn,ml],(t,[e,n])=>d_(e.evaluate(t),n.evaluate(t))]]},get:{type:ln,overloads:[[[mn],(t,[e])=>Tp(e.evaluate(t),t.properties())],[[mn,ml],(t,[e,n])=>Tp(e.evaluate(t),n.evaluate(t))]]},"feature-state":[ln,[mn],(t,[e])=>Tp(e.evaluate(t),t.featureState||{})],properties:[ml,[],t=>t.properties()],"geometry-type":[mn,[],t=>t.geometryType()],id:[ln,[],t=>t.id()],zoom:[dt,[],t=>t.globals.zoom],pitch:[dt,[],t=>t.globals.pitch||0],"distance-from-center":[dt,[],t=>t.distanceFromCenter()],"measure-light":[dt,[mn],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[dt,[],t=>t.globals.heatmapDensity||0],"line-progress":[dt,[],t=>t.globals.lineProgress||0],"raster-value":[dt,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[dt,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[dt,[],t=>t.globals.skyRadialProgress||0],accumulated:[ln,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[dt,pa(dt),(t,e)=>{let n=0;for(let o of e)n+=o.evaluate(t);return n}],"*":[dt,pa(dt),(t,e)=>{let n=1;for(let o of e)n*=o.evaluate(t);return n}],"-":{type:dt,overloads:[[[dt,dt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[dt],(t,[e])=>-e.evaluate(t)]]},"/":[dt,[dt,dt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[dt,[dt,dt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[dt,[dt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))],log2:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[dt,[dt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[dt,[dt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[dt,[dt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[dt,[dt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[dt,[dt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[dt,[dt],(t,[e])=>Math.atan(e.evaluate(t))],min:[dt,pa(dt),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[dt,pa(dt),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[dt,[dt],(t,[e])=>Math.abs(e.evaluate(t))],round:[dt,[dt],(t,[e])=>{let n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[dt,[dt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[dt,[dt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[gn,[mn,ln],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[gn,[ln],(t,[e])=>t.id()===e.value],"filter-type-==":[gn,[mn],(t,[e])=>t.geometryType()===e.value],"filter-<":[gn,[mn,ln],(t,[e,n])=>{let o=t.properties()[e.value],l=n.value;return typeof o==typeof l&&o<l}],"filter-id-<":[gn,[ln],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[gn,[mn,ln],(t,[e,n])=>{let o=t.properties()[e.value],l=n.value;return typeof o==typeof l&&o>l}],"filter-id->":[gn,[ln],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[gn,[mn,ln],(t,[e,n])=>{let o=t.properties()[e.value],l=n.value;return typeof o==typeof l&&o<=l}],"filter-id-<=":[gn,[ln],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[gn,[mn,ln],(t,[e,n])=>{let o=t.properties()[e.value],l=n.value;return typeof o==typeof l&&o>=l}],"filter-id->=":[gn,[ln],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[gn,[ln],(t,[e])=>e.value in t.properties()],"filter-has-id":[gn,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[gn,[yi(mn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[gn,[yi(ln)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[gn,[mn,yi(ln)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[gn,[mn,yi(ln)],(t,[e,n])=>function(o,l,u,h){for(;u<=h;){let g=u+h>>1;if(l[g]===o)return!0;l[g]>o?h=g-1:u=g+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:gn,overloads:[[[gn,gn],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[pa(gn),(t,e)=>{for(let n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:gn,overloads:[[[gn,gn],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[pa(gn),(t,e)=>{for(let n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[gn,[gn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[gn,[mn],(t,[e])=>{let n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[mn,[mn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[mn,[mn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[mn,pa(ln),(t,e)=>e.map(n=>Fi(n.evaluate(t))).join("")],"resolved-locale":[mn,[Qi],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[dt,[dt,dt,ln],(t,e)=>{let[n,o,l]=e.map(h=>h.evaluate(t));if(n>o||n===o)return n;let u;if(typeof l=="string")u=function(h){let g=0;if(h.length===0)return g;for(let y=0;y<h.length;y++)g=(g<<5)-g+h.charCodeAt(y),g|=0;return g}(l);else{if(typeof l!="number")throw new wr(`Invalid seed input: ${l}`);u=l}return n+c_(u)()*(o-n)}]});class O{constructor(e,n,o,l){this.expression=e,this._warningHistory={},this._evaluator=new Vg(o,l),this._defaultValue=n?function(u){return u.type==="color"&&(c(u.default)||Array.isArray(u.default))?new pn(0,0,0,0):u.type==="color"?pn.parse(u.default)||null:u.default===void 0?null:u.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,o,l,u,h,g,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,l,u,h,g,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=y||null;try{let b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new wr(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function F(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in fa}function z(t,e,n,o){let l=new Kg(fa,[],e?function(h){let g={color:ui,string:mn,number:dt,enum:mn,boolean:gn,formatted:gl,resolvedImage:wo};return h.type==="array"?yi(g[h.value]||ln,h.length):g[h.type]}(e):void 0,void 0,void 0,n,o),u=l.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?f_(new O(u,e,n,o)):ma(l.errors)}class V{constructor(e,n,o){this.kind=e,this._styleExpression=n,this.isLightConstant=o,this.isStateDependent=e!=="constant"&&!Vh(n.expression),this.isConfigDependent=!dp(n.expression)}evaluateWithoutErrorHandling(e,n,o,l,u,h){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,l,u,h)}evaluate(e,n,o,l,u,h){return this._styleExpression.evaluate(e,n,o,l,u,h)}}class ${constructor(e,n,o,l,u){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Vh(n.expression),this.isLightConstant=u,this.isConfigDependent=!dp(n.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,n,o,l,u,h){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,l,u,h)}evaluate(e,n,o,l,u,h){return this._styleExpression.evaluate(e,n,o,l,u,h)}interpolationFactor(e,n,o){return this.interpolationType?Ii.interpolationFactor(this.interpolationType,e,n,o):0}}function G(t,e,n,o){if((t=z(t,e,n,o)).result==="error")return t;let l=t.value.expression,u=bs(l);if(!u&&!Xh(e))return ma([new bo("","data expressions not supported")]);let h=Qc(l,["zoom","pitch","distance-from-center"]);if(!h&&!d(e))return ma([new bo("","zoom expressions not supported")]);let g=Qc(l,["measure-light"]);if(!g&&!gx(e))return ma([new bo("","measure-light expression not supported")]);let y=e.expression&&e.expression.relaxZoomRestriction,b=q(l);return b||h||y?b instanceof bo?ma([b]):b instanceof Ii&&!i(e)?ma([new bo("",'"interpolate" expressions cannot be used with this property')]):f_(b?new $(u?"camera":"composite",t.value,b.labels,b instanceof Ii?b.interpolation:void 0,g):new V(u?"constant":"source",t.value,g)):ma([new bo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class H{constructor(e,n){this._parameters=e,this._specification=n,Yf(this,v(this._parameters,this._specification))}static deserialize(e){return new H(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function q(t){let e=null;if(t instanceof Wh)e=q(t.result);else if(t instanceof qh){for(let n of t.args)if(e=q(n),e)break}else(t instanceof tu||t instanceof Ii)&&t.input instanceof ii&&t.input.name==="zoom"&&(e=t);return e instanceof bo||t.eachChild(n=>{let o=q(n);o instanceof bo?e=o:e&&o&&e!==o&&(e=new bo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var J=te,ee=3;function te(t,e,n){var o=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var l=new Int32Array(this.arrayBuffer);t=l[0],this.d=(e=l[1])+2*(n=l[2]);for(var u=0;u<this.d*this.d;u++){var h=l[ee+u],g=l[ee+u+1];o.push(h===g?null:l.subarray(h,g))}var y=l[ee+o.length+1];this.keys=l.subarray(l[ee+o.length],y),this.bboxes=l.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var b=0;b<this.d*this.d;b++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var T=n/e*t;this.min=-T,this.max=t+T}te.prototype.insert=function(t,e,n,o,l){this._forEachCell(e,n,o,l,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(l)},te.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},te.prototype._insertCell=function(t,e,n,o,l,u){this.cells[l].push(u)},te.prototype.query=function(t,e,n,o,l){var u=this.min,h=this.max;if(t<=u&&e<=u&&h<=n&&h<=o&&!l)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(t,e,n,o,this._queryCell,g,{},l),g},te.prototype._queryCell=function(t,e,n,o,l,u,h,g){var y=this.cells[l];if(y!==null)for(var b=this.keys,T=this.bboxes,I=0;I<y.length;I++){var D=y[I];if(h[D]===void 0){var P=4*D;(g?g(T[P+0],T[P+1],T[P+2],T[P+3]):t<=T[P+2]&&e<=T[P+3]&&n>=T[P+0]&&o>=T[P+1])?(h[D]=!0,u.push(b[D])):h[D]=!1}}},te.prototype._forEachCell=function(t,e,n,o,l,u,h,g){for(var y=this._convertToCellCoord(t),b=this._convertToCellCoord(e),T=this._convertToCellCoord(n),I=this._convertToCellCoord(o),D=y;D<=T;D++)for(var P=b;P<=I;P++){var R=this.d*P+D;if((!g||g(this._convertFromCellCoord(D),this._convertFromCellCoord(P),this._convertFromCellCoord(D+1),this._convertFromCellCoord(P+1)))&&l.call(this,t,e,n,o,R,u,h,g))return}},te.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},te.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},te.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=ee+this.cells.length+1+1,n=0,o=0;o<this.cells.length;o++)n+=this.cells[o].length;var l=new Int32Array(e+n+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var u=e,h=0;h<t.length;h++){var g=t[h];l[ee+h]=u,l.set(g,u),u+=g.length}return l[ee+t.length]=u,l.set(this.keys,u),l[ee+t.length+1]=u+=this.keys.length,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer};var ce=We(J);let le={};function Q(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),le[e]={klass:t,omit:n.omit||[]}}Q(Object,"Object"),ce.serialize=function(t,e){let n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},ce.deserialize=function(t){return new ce(t.buffer)},Object.defineProperty(ce,"name",{value:"Grid"}),Q(ce,"Grid"),Q(pn,"Color"),Q(Error,"Error"),Q(Zr,"Formatted"),Q(aa,"FormattedSection"),Q(jf,"AJAXError"),Q(hi,"ResolvedImage"),Q(H,"StylePropertyFunction"),Q(O,"StyleExpression",{omit:["_evaluator"]}),Q($,"ZoomDependentExpression"),Q(V,"ZoomConstantExpression"),Q(ii,"CompoundExpression",{omit:["_evaluate"]});for(let t in fa)le[fa[t]._classRegistryKey]||Q(fa[t],`Expression${t}`);function ne(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function re(t){return self.ImageBitmap&&t instanceof ImageBitmap}function pe(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(ne(t)||re(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let n=[];for(let o of t)n.push(pe(o,e));return n}if(t instanceof Map){let n={$name:"Map"};for(let[o,l]of t.entries())n[o]=pe(l);return n}if(typeof t=="object"){let n=t.constructor,o=n._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);let l=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(let u in t)t.hasOwnProperty(u)&&(le[o].omit.indexOf(u)>=0||(l[u]=pe(t[u],e)));t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(l.$name=o),l}throw new Error("can't serialize object of type "+typeof t)}function Ee(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||ne(t)||re(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Ee);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let l=new Map;for(let u of Object.keys(t))u!=="$name"&&l.set(u,Ee(t[u]));return l}let{klass:n}=le[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);let o=Object.create(n.prototype);for(let l of Object.keys(t))l!=="$name"&&(o[l]=Ee(t[l]));return o}throw new Error("can't deserialize object of type "+typeof t)}let se={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Ie(t){for(let e of t)if(Ue(e.charCodeAt(0)))return!0;return!1}function De(t){for(let e of t)if(!je(e.charCodeAt(0)))return!1;return!0}function je(t){return!(se.Arabic(t)||se["Arabic Supplement"](t)||se["Arabic Extended-A"](t)||se["Arabic Presentation Forms-A"](t)||se["Arabic Presentation Forms-B"](t))}function Ue(t){return!(t!==746&&t!==747&&(t<4352||!(se["Bopomofo Extended"](t)||se.Bopomofo(t)||se["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||se["CJK Compatibility Ideographs"](t)||se["CJK Compatibility"](t)||se["CJK Radicals Supplement"](t)||se["CJK Strokes"](t)||!(!se["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||se["CJK Unified Ideographs Extension A"](t)||se["CJK Unified Ideographs"](t)||se["Enclosed CJK Letters and Months"](t)||se["Hangul Compatibility Jamo"](t)||se["Hangul Jamo Extended-A"](t)||se["Hangul Jamo Extended-B"](t)||se["Hangul Jamo"](t)||se["Hangul Syllables"](t)||se.Hiragana(t)||se["Ideographic Description Characters"](t)||se.Kanbun(t)||se["Kangxi Radicals"](t)||se["Katakana Phonetic Extensions"](t)||se.Katakana(t)&&t!==12540||!(!se["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!se["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||se["Unified Canadian Aboriginal Syllabics"](t)||se["Unified Canadian Aboriginal Syllabics Extended"](t)||se["Vertical Forms"](t)||se["Yijing Hexagram Symbols"](t)||se["Yi Syllables"](t)||se["Yi Radicals"](t))))}function Ne(t){return!(Ue(t)||function(e){return!!(se["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||se["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||se["Letterlike Symbols"](e)||se["Number Forms"](e)||se["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||se["Control Pictures"](e)&&e!==9251||se["Optical Character Recognition"](e)||se["Enclosed Alphanumerics"](e)||se["Geometric Shapes"](e)||se["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||se["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||se["CJK Symbols and Punctuation"](e)||se.Katakana(e)||se["Private Use Area"](e)||se["CJK Compatibility Forms"](e)||se["Small Form Variants"](e)||se["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function ve(t){return t>=1424&&t<=2303||se["Arabic Presentation Forms-A"](t)||se["Arabic Presentation Forms-B"](t)}function Ae(t,e){return!(!e&&ve(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||se.Khmer(t))}function ke(t){for(let e of t)if(ve(e.charCodeAt(0)))return!0;return!1}let it="deferred",lt="loading",st="loaded",ze=null,$e="unavailable",ot=null,ft=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&($e="error"),ze&&ze(t)};function At(){Bt.fire(new ci("pluginStateChange",{pluginStatus:$e,pluginURL:ot}))}let Bt=new sa,tn=function(){return $e},Kt=function(){if($e!==it||!ot)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$e=lt,At(),ot&&ia({url:ot},t=>{t?ft(t):($e=st,At())})},In={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>$e===st||In.applyArabicShaping!=null,isLoading:()=>$e===lt,setState(t){$e=t.pluginStatus,ot=t.pluginURL},isParsed:()=>In.applyArabicShaping!=null&&In.processBidirectionalText!=null&&In.processStyledBidirectionalText!=null,getPluginURL:()=>ot};class Lt{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,o){for(let l of n)if(!Ae(l.charCodeAt(0),o))return!1;return!0}(e,In.isLoaded())}}class bn{constructor(e,n,o,l){this.property=e,this.value=n,this.expression=function(u,h,g,y){if(c(u))return new H(u,h);if(F(u)||Array.isArray(u)&&u.length>0){let b=G(u,h,g,y);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));return b.value}{let b=u;return typeof u=="string"&&h.type==="color"&&(b=pn.parse(u)),{kind:"constant",isConfigDependent:!1,evaluate:()=>b}}}(n===void 0?e.specification.default:n,e.specification,o,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class kn{constructor(e,n,o){this.property=e,this.value=new bn(e,void 0,n,o)}transitioned(e,n){return new Zt(this.property,this.value,n,Wr({},e.transition,this.transition),e.now)}untransitioned(){return new Zt(this.property,this.value,null,{},0)}}class Dn{constructor(e,n,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=o,this.isConfigDependent=!1}getValue(e){return vo(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new kn(this._values[e].property,this._scope,this._options)),this._values[e].value=new bn(this._values[e].property,n===null?void 0:vo(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let o=this._properties.properties;if(e)for(let l in e){let u=e[l];if(Dc(l,"-transition")){let h=l.slice(0,-11);o[h]&&this.setTransition(h,u)}else o.hasOwnProperty(l)&&this.setValue(l,u)}}getTransition(e){return vo(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new kn(this._values[e].property)),this._values[e].transition=vo(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let o=this.getValue(n);o!==void 0&&(e[n]=o);let l=this.getTransition(n);l!==void 0&&(e[`${n}-transition`]=l)}return e}transitioned(e,n){let o=new Ft(this._properties);for(let l of Object.keys(this._values))o._values[l]=this._values[l].transitioned(e,n._values[l]);return o}untransitioned(){let e=new Ft(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Zt{constructor(e,n,o,l,u){let h=l.delay||0,g=l.duration||0;u=u||0,this.property=e,this.value=n,this.begin=u+h,this.end=this.begin+g,e.specification.transition&&(l.delay||l.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){let l=e.now||0,u=this.value.possiblyEvaluate(e,n,o),h=this.prior;if(h){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return h.possiblyEvaluate(e,n,o);{let g=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,n,o),u,Sf(g))}}return u}}class Ft{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){let l=new nn(this._properties);for(let u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,n,o);return l}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Vn{constructor(e,n,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=o,this.isConfigDependent=!1}getValue(e){return vo(this._values[e].value)}setValue(e,n){this._values[e]=new bn(this._values[e].property,n===null?void 0:vo(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){let l=new nn(this._properties);for(let u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,n,o);return l}}class $n{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,l){return this.property.evaluate(this.value,this.parameters,e,n,o,l)}}class nn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Fe{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,o){let l=Oh[this.specification.type];return l?l(e,n,o):e}}class ut{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,l){return new $n(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,l)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new $n(this,{kind:"constant",value:void 0},e.parameters);let l=Oh[this.specification.type];return l?new $n(this,{kind:"constant",value:l(e.value.value,n.value.value,o)},e.parameters):e}evaluate(e,n,o,l,u,h){return e.kind==="constant"?e.value:e.evaluate(n,o,l,u,h)}}class vr{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,l){return!!e.expression.evaluate(n,null,{},o,l)}interpolate(){return!1}}class Cn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new Lt(0,{});for(let o in e){let l=e[o];l.specification.overridable&&this.overridableProperties.push(o);let u=this.defaultPropertyValues[o]=new bn(l,void 0),h=this.defaultTransitionablePropertyValues[o]=new kn(l);this.defaultTransitioningPropertyValues[o]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=u.possiblyEvaluate(n)}}}Q(ut,"DataDrivenProperty"),Q(Fe,"DataConstantProperty"),Q(vr,"ColorRampProperty");var Te=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function fi(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Yr(t){if(Array.isArray(t))return t.map(Yr);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let n in t)e[n]=Yr(t[n]);return e}return fi(t)}function Tr(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!Tr(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function oi(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Tr(t)||(t=Eo(t));let n=t,o=!0;try{o=function(b){if(!Ci(b))return b;let T=Yr(b);return zi(T),T=vi(T),T}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let l=Te[`filter_${e}`],u=z(o,l),h=null;if(u.result==="error")throw new Error(u.value.map(b=>`${b.key}: ${b.message}`).join(", "));h=(b,T,I)=>u.value.evaluate(b,T,{},I);let g=null,y=null;if(o!==n){let b=z(n,l);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));g=(T,I,D,P,R)=>b.value.evaluate(T,I,{},D,void 0,void 0,P,R),y=!bs(b.value.expression)}return{filter:h,dynamicFilter:g||void 0,needGeometry:Bo(o),needFeature:!!y}}function vi(t){if(!Array.isArray(t))return t;let e=function(n){if(ws.has(n[0])){for(let o=1;o<n.length;o++)if(Ci(n[o]))return!0}return n}(t);return e===!0?e:e.map(n=>vi(n))}function zi(t){let e=!1,n=[];if(t[0]==="case"){for(let o=1;o<t.length-1;o+=2)e=e||Ci(t[o]),n.push(t[o+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||Ci(t[1]);for(let o=2;o<t.length-1;o+=2)n.push(t[o+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||Ci(t[1]);for(let o=1;o<t.length-1;o+=2)n.push(t[o+1])}e&&(t.length=0,t.push("any",...n));for(let o=1;o<t.length;o++)zi(t[o])}function Ci(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(Ci(t[n]))return!0;return!1}let ws=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ts(t,e){return t<e?-1:t>e?1:0}function Bo(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Bo(t[e]))return!0;return!1}function Eo(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?Vo(t[1],t[2],"=="):e==="!="?Il(Vo(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Vo(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(Eo))):e==="all"?["all"].concat(t.slice(1).map(Eo)):e==="none"?["all"].concat(t.slice(1).map(Eo).map(Il)):e==="in"?El(t[1],t.slice(2)):e==="!in"?Il(El(t[1],t.slice(2))):e==="has"?su(t[1]):e!=="!has"||Il(su(t[1]));var n}function Vo(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function El(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Ts)]]:["filter-in-small",t,["literal",e]]}}function su(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Il(t){return["!",t]}let Cl="";function Kh(t,e){return e?`${t}${Cl}${e}`:t}let Qh="-transition",ga=new Set(["fill","line","background","hillshade","raster"]);class Xr extends sa{constructor(e,n,o,l,u){if(super(),this.id=e.id,this.fqid=Kh(this.id,o),this.type=e.type,this.scope=o,this.lut=l,this.options=u,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new Vn(n.layout,this.scope,u),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new Dn(n.paint,this.scope,u);for(let h in e.paint)this.setPaintProperty(h,e.paint[h]);for(let h in e.layout)this.setLayoutProperty(h,e.layout[h]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new nn(n.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return ga.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,n),this.isConfigDependent=this.isConfigDependent||o.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Dc(e,Qh)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){let o=this._transitionablePaint,l=o._properties.properties;if(Dc(e,Qh)){let I=e.slice(0,-11);return l[I]&&o.setTransition(I,n||void 0),!1}if(!l[e])return!1;let u=o._values[e],h=u.value.isDataDriven(),g=u.value;o.setValue(e,n),this.isConfigDependent=this.isConfigDependent||o.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let y=o._values[e].value,b=y.isDataDriven(),T=Dc(e,"pattern")||e==="line-dasharray";return b||h||T||this._handleOverridablePaintPropertyUpdate(e,g,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,o){return null}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return na({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof $n&&Xh(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=oi(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,o,l,u,h,g,y,b){}queryIntersectsMatchingFeature(e,n,o,l){}}let Ep={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class m_{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Zn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function wn(t,e=1){let n=0,o=0;return{members:t.map(l=>{let u=Ep[l.type].BYTES_PER_ELEMENT,h=n=zE(n,Math.max(e,u)),g=l.components||1;return o=Math.max(o,u),n+=u*g,{name:l.name,type:l.type,components:g,offset:h}}),size:zE(n,Math.max(o,e)),alignment:e}}function zE(t,e){return Math.ceil(t/e)*e}class jo extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){let l=2*e;return this.int16[l+0]=n,this.int16[l+1]=o,e}}jo.prototype.bytesPerElement=4,Q(jo,"StructArrayLayout2i4");class g_ extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,o)}emplace(e,n,o,l){let u=3*e;return this.int16[u+0]=n,this.int16[u+1]=o,this.int16[u+2]=l,e}}g_.prototype.bytesPerElement=6,Q(g_,"StructArrayLayout3i6");class Dl extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,l)}emplace(e,n,o,l,u){let h=4*e;return this.int16[h+0]=n,this.int16[h+1]=o,this.int16[h+2]=l,this.int16[h+3]=u,e}}Dl.prototype.bytesPerElement=8,Q(Dl,"StructArrayLayout4i8");class _x extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,l,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,o,l,u)}emplace(e,n,o,l,u,h){let g=5*e;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=l,this.int16[g+3]=u,this.int16[g+4]=h,e}}_x.prototype.bytesPerElement=10,Q(_x,"StructArrayLayout5i10");class yx extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,l,u,h,g){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,l,u,h,g)}emplace(e,n,o,l,u,h,g,y){let b=6*e,T=12*e,I=3*e;return this.int16[b+0]=n,this.int16[b+1]=o,this.uint8[T+4]=l,this.uint8[T+5]=u,this.uint8[T+6]=h,this.uint8[T+7]=g,this.float32[I+2]=y,e}}yx.prototype.bytesPerElement=12,Q(yx,"StructArrayLayout2i4ub1f12");class Sl extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,l)}emplace(e,n,o,l,u){let h=4*e;return this.float32[h+0]=n,this.float32[h+1]=o,this.float32[h+2]=l,this.float32[h+3]=u,e}}Sl.prototype.bytesPerElement=16,Q(Sl,"StructArrayLayout4f16");class Ml extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,o)}emplace(e,n,o,l){let u=3*e;return this.float32[u+0]=n,this.float32[u+1]=o,this.float32[u+2]=l,e}}Ml.prototype.bytesPerElement=12,Q(Ml,"StructArrayLayout3f12");class Al extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,l,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,o,l,u)}emplace(e,n,o,l,u,h){let g=6*e,y=3*e;return this.uint16[g+0]=n,this.uint16[g+1]=o,this.uint16[g+2]=l,this.uint16[g+3]=u,this.float32[y+2]=h,e}}Al.prototype.bytesPerElement=12,Q(Al,"StructArrayLayout4ui1f12");class __ extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,l)}emplace(e,n,o,l,u){let h=4*e;return this.uint16[h+0]=n,this.uint16[h+1]=o,this.uint16[h+2]=l,this.uint16[h+3]=u,e}}__.prototype.bytesPerElement=8,Q(__,"StructArrayLayout4ui8");class y_ extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,l,u,h){let g=this.length;return this.resize(g+1),this.emplace(g,e,n,o,l,u,h)}emplace(e,n,o,l,u,h,g){let y=6*e;return this.int16[y+0]=n,this.int16[y+1]=o,this.int16[y+2]=l,this.int16[y+3]=u,this.int16[y+4]=h,this.int16[y+5]=g,e}}y_.prototype.bytesPerElement=12,Q(y_,"StructArrayLayout6i12");class vx extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,l,u,h,g,y,b,T,I,D){let P=this.length;return this.resize(P+1),this.emplace(P,e,n,o,l,u,h,g,y,b,T,I,D)}emplace(e,n,o,l,u,h,g,y,b,T,I,D,P){let R=12*e;return this.int16[R+0]=n,this.int16[R+1]=o,this.int16[R+2]=l,this.int16[R+3]=u,this.uint16[R+4]=h,this.uint16[R+5]=g,this.uint16[R+6]=y,this.uint16[R+7]=b,this.int16[R+8]=T,this.int16[R+9]=I,this.int16[R+10]=D,this.int16[R+11]=P,e}}vx.prototype.bytesPerElement=24,Q(vx,"StructArrayLayout4i4ui4i24");class xx extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,l,u,h){let g=this.length;return this.resize(g+1),this.emplace(g,e,n,o,l,u,h)}emplace(e,n,o,l,u,h,g){let y=10*e,b=5*e;return this.int16[y+0]=n,this.int16[y+1]=o,this.int16[y+2]=l,this.float32[b+2]=u,this.float32[b+3]=h,this.float32[b+4]=g,e}}xx.prototype.bytesPerElement=20,Q(xx,"StructArrayLayout3i3f20");class bx extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}bx.prototype.bytesPerElement=4,Q(bx,"StructArrayLayout1ul4");class au extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}au.prototype.bytesPerElement=4,Q(au,"StructArrayLayout1f4");class Pl extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){let l=2*e;return this.uint16[l+0]=n,this.uint16[l+1]=o,e}}Pl.prototype.bytesPerElement=4,Q(Pl,"StructArrayLayout2ui4");class wx extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,l,u,h,g,y,b,T,I,D,P){let R=this.length;return this.resize(R+1),this.emplace(R,e,n,o,l,u,h,g,y,b,T,I,D,P)}emplace(e,n,o,l,u,h,g,y,b,T,I,D,P,R){let L=20*e,N=10*e;return this.int16[L+0]=n,this.int16[L+1]=o,this.int16[L+2]=l,this.int16[L+3]=u,this.int16[L+4]=h,this.float32[N+3]=g,this.float32[N+4]=y,this.float32[N+5]=b,this.float32[N+6]=T,this.int16[L+14]=I,this.uint32[N+8]=D,this.uint16[L+18]=P,this.uint16[L+19]=R,e}}wx.prototype.bytesPerElement=40,Q(wx,"StructArrayLayout5i4f1i1ul2ui40");class v_ extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,l,u,h,g){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,l,u,h,g)}emplace(e,n,o,l,u,h,g,y){let b=8*e;return this.int16[b+0]=n,this.int16[b+1]=o,this.int16[b+2]=l,this.int16[b+4]=u,this.int16[b+5]=h,this.int16[b+6]=g,this.int16[b+7]=y,e}}v_.prototype.bytesPerElement=16,Q(v_,"StructArrayLayout3i2i2i16");class Tx extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,l,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,o,l,u)}emplace(e,n,o,l,u,h){let g=4*e,y=8*e;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=l,this.int16[y+6]=u,this.int16[y+7]=h,e}}Tx.prototype.bytesPerElement=16,Q(Tx,"StructArrayLayout2f1f2i16");class Ex extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,l)}emplace(e,n,o,l,u){let h=12*e,g=3*e;return this.uint8[h+0]=n,this.uint8[h+1]=o,this.float32[g+1]=l,this.float32[g+2]=u,e}}Ex.prototype.bytesPerElement=12,Q(Ex,"StructArrayLayout2ub2f12");class Ir extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,o)}emplace(e,n,o,l){let u=3*e;return this.uint16[u+0]=n,this.uint16[u+1]=o,this.uint16[u+2]=l,e}}Ir.prototype.bytesPerElement=6,Q(Ir,"StructArrayLayout3ui6");class Ix extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,l,u,h,g,y,b,T,I,D,P,R,L,N,j,Y,X,K,ae){let oe=this.length;return this.resize(oe+1),this.emplace(oe,e,n,o,l,u,h,g,y,b,T,I,D,P,R,L,N,j,Y,X,K,ae)}emplace(e,n,o,l,u,h,g,y,b,T,I,D,P,R,L,N,j,Y,X,K,ae,oe){let fe=30*e,me=15*e,we=60*e;return this.int16[fe+0]=n,this.int16[fe+1]=o,this.int16[fe+2]=l,this.float32[me+2]=u,this.float32[me+3]=h,this.uint16[fe+8]=g,this.uint16[fe+9]=y,this.uint32[me+5]=b,this.uint32[me+6]=T,this.uint32[me+7]=I,this.uint16[fe+16]=D,this.uint16[fe+17]=P,this.uint16[fe+18]=R,this.float32[me+10]=L,this.float32[me+11]=N,this.uint8[we+48]=j,this.uint8[we+49]=Y,this.uint8[we+50]=X,this.uint32[me+13]=K,this.int16[fe+28]=ae,this.uint8[we+58]=oe,e}}Ix.prototype.bytesPerElement=60,Q(Ix,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Cx extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,l,u,h,g,y,b,T,I,D,P,R,L,N,j,Y,X,K,ae,oe,fe,me,we,Pe,Ce,Le,Ye,Oe,He,Re,qe,Qe){let Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,e,n,o,l,u,h,g,y,b,T,I,D,P,R,L,N,j,Y,X,K,ae,oe,fe,me,we,Pe,Ce,Le,Ye,Oe,He,Re,qe,Qe)}emplace(e,n,o,l,u,h,g,y,b,T,I,D,P,R,L,N,j,Y,X,K,ae,oe,fe,me,we,Pe,Ce,Le,Ye,Oe,He,Re,qe,Qe,Ze){let ht=22*e,Xe=44*e,tt=88*e;return this.float32[ht+0]=n,this.float32[ht+1]=o,this.int16[Xe+4]=l,this.int16[Xe+5]=u,this.int16[Xe+6]=h,this.int16[Xe+7]=g,this.int16[Xe+8]=y,this.int16[Xe+9]=b,this.int16[Xe+10]=T,this.int16[Xe+11]=I,this.int16[Xe+12]=D,this.uint16[Xe+13]=P,this.uint16[Xe+14]=R,this.uint16[Xe+15]=L,this.uint16[Xe+16]=N,this.uint16[Xe+17]=j,this.uint16[Xe+18]=Y,this.uint16[Xe+19]=X,this.uint16[Xe+20]=K,this.uint16[Xe+21]=ae,this.uint16[Xe+22]=oe,this.uint16[Xe+23]=fe,this.uint16[Xe+24]=me,this.uint16[Xe+25]=we,this.uint16[Xe+26]=Pe,this.uint16[Xe+27]=Ce,this.uint32[ht+14]=Le,this.float32[ht+15]=Ye,this.float32[ht+16]=Oe,this.float32[ht+17]=He,this.float32[ht+18]=Re,this.float32[ht+19]=qe,this.float32[ht+20]=Qe,this.uint8[tt+84]=Ze,e}}Cx.prototype.bytesPerElement=88,Q(Cx,"StructArrayLayout2f9i15ui1ul6f1ub88");class lu extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,l,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,o,l,u)}emplace(e,n,o,l,u,h){let g=5*e;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=l,this.float32[g+3]=u,this.float32[g+4]=h,e}}lu.prototype.bytesPerElement=20,Q(lu,"StructArrayLayout5f20");class Dx extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,l,u,h,g){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,l,u,h,g)}emplace(e,n,o,l,u,h,g,y){let b=7*e;return this.float32[b+0]=n,this.float32[b+1]=o,this.float32[b+2]=l,this.float32[b+3]=u,this.float32[b+4]=h,this.float32[b+5]=g,this.float32[b+6]=y,e}}Dx.prototype.bytesPerElement=28,Q(Dx,"StructArrayLayout7f28");class Jh extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){let l=2*e;return this.float32[l+0]=n,this.float32[l+1]=o,e}}Jh.prototype.bytesPerElement=8,Q(Jh,"StructArrayLayout2f8");class Sx extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,l)}emplace(e,n,o,l,u){let h=6*e;return this.uint32[3*e+0]=n,this.uint16[h+2]=o,this.uint16[h+3]=l,this.uint16[h+4]=u,e}}Sx.prototype.bytesPerElement=12,Q(Sx,"StructArrayLayout1ul3ui12");class Ip extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Ip.prototype.bytesPerElement=2,Q(Ip,"StructArrayLayout1ui2");class Mx extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,l,u,h,g,y,b,T,I,D,P,R,L,N){let j=this.length;return this.resize(j+1),this.emplace(j,e,n,o,l,u,h,g,y,b,T,I,D,P,R,L,N)}emplace(e,n,o,l,u,h,g,y,b,T,I,D,P,R,L,N,j){let Y=16*e;return this.float32[Y+0]=n,this.float32[Y+1]=o,this.float32[Y+2]=l,this.float32[Y+3]=u,this.float32[Y+4]=h,this.float32[Y+5]=g,this.float32[Y+6]=y,this.float32[Y+7]=b,this.float32[Y+8]=T,this.float32[Y+9]=I,this.float32[Y+10]=D,this.float32[Y+11]=P,this.float32[Y+12]=R,this.float32[Y+13]=L,this.float32[Y+14]=N,this.float32[Y+15]=j,e}}Mx.prototype.bytesPerElement=64,Q(Mx,"StructArrayLayout16f64");class x_ extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,l,u,h,g){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,l,u,h,g)}emplace(e,n,o,l,u,h,g,y){let b=10*e,T=5*e;return this.uint16[b+0]=n,this.uint16[b+1]=o,this.uint16[b+2]=l,this.uint16[b+3]=u,this.float32[T+2]=h,this.float32[T+3]=g,this.float32[T+4]=y,e}}x_.prototype.bytesPerElement=20,Q(x_,"StructArrayLayout4ui3f20");class Ax extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}Ax.prototype.bytesPerElement=2,Q(Ax,"StructArrayLayout1i2");class Px extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}Px.prototype.bytesPerElement=1,Q(Px,"StructArrayLayout1ub1");class BE extends m_{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}BE.prototype.size=40;class Rx extends wx{get(e){return new BE(this,e)}}Q(Rx,"CollisionBoxArray");class VE extends m_{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}VE.prototype.size=60;class jE extends Ix{get(e){return new VE(this,e)}}Q(jE,"PlacedSymbolArray");class UE extends m_{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}UE.prototype.size=88;class $E extends Cx{get(e){return new UE(this,e)}}Q($E,"SymbolInstanceArray");class GE extends au{getoffsetX(e){return this.float32[1*e+0]}}Q(GE,"GlyphOffsetArray");class HE extends jo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Q(HE,"SymbolLineVertexArray");class qE extends m_{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}qE.prototype.size=12;class WE extends Sx{get(e){return new qE(this,e)}}Q(WE,"FeatureIndexArray");class ZE extends Pl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Q(ZE,"FillExtrusionCentroidArray");let _k=wn([{name:"a_pos",components:2,type:"Int16"}],4),yk=wn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Jn{constructor(e=[]){this.segments=e}_prepareSegment(e,n,o,l){let u=this.segments[this.segments.length-1];return e>Jn.MAX_VERTEX_ARRAY_LENGTH&&cr(`Max vertices per segment is ${Jn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>Jn.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:n,primitiveOffset:o,vertexLength:0,primitiveLength:0},l!==void 0&&(u.sortKey=l),this.segments.push(u)),u}prepareSegment(e,n,o,l){return this._prepareSegment(e,n.length,o.length,l)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,l){return new Jn([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:l,vaos:{},sortKey:0}])}}function YE(t,e){return 256*(t=Ht(Math.floor(t),0,255))+Ht(Math.floor(e),0,255)}Jn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Q(Jn,"SegmentVector");let vk=wn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),xk=wn([{name:"a_dash",components:4,type:"Uint16"}]);class Cp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,o,l){this.ids.push(XE(e)),this.positions.push(n,o,l)}eachPosition(e,n){let o=XE(e),l=0,u=this.ids.length-1;for(;l<u;){let h=l+u>>1;this.ids[h]>=o?u=h:l=h+1}for(;this.ids[l]===o;)n(this.positions[3*l],this.positions[3*l+1],this.positions[3*l+2]),l++}static serialize(e,n){let o=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Ox(o,l,0,o.length-1),n&&(n.add(o.buffer),n.add(l.buffer)),{ids:o,positions:l}}static deserialize(e){let n=new Cp,o;n.ids=e.ids,n.positions=e.positions;for(let l of n.ids)l!==o&&n.uniqueIds.push(l),o=l;return n.indexed=!0,n}}function XE(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:dl(String(t))}function Ox(t,e,n,o){for(;n<o;){let l=t[n+o>>1],u=n-1,h=o+1;for(;;){do u++;while(t[u]<l);do h--;while(t[h]>l);if(u>=h)break;b_(t,u,h),b_(e,3*u,3*h),b_(e,3*u+1,3*h+1),b_(e,3*u+2,3*h+2)}h-n<o-h?(Ox(t,e,n,h),n=h+1):(Ox(t,e,h+1,o),o=h)}}function b_(t,e,n){let o=t[e];t[e]=t[n],t[n]=o}Q(Cp,"FeaturePositionMap");class _a{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class w_ extends _a{constructor(e){super(e),this.current=0}set(e,n,o){this.fetchUniformLocation(e,n)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class xi extends _a{constructor(e){super(e),this.current=0}set(e,n,o){this.fetchUniformLocation(e,n)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class ya extends _a{constructor(e){super(e),this.current=[0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class kx extends _a{constructor(e){super(e),this.current=[0,0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class Lx extends _a{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class KE extends _a{constructor(e){super(e),this.current=pn.transparent.toRenderColor(null)}set(e,n,o){this.fetchUniformLocation(e,n)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}let bk=new Float32Array(16);class Dp extends _a{constructor(e){super(e),this.current=bk}set(e,n,o){if(this.fetchUniformLocation(e,n)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let l=1;l<16;l++)if(o[l]!==this.current[l]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}let wk=new Float32Array(9),Tk=new Float32Array(4);class Fx extends _a{constructor(e){super(e),this.current=Tk}set(e,n,o){if(this.fetchUniformLocation(e,n)){for(let l=0;l<4;l++)if(o[l]!==this.current[l]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function Nx(t){return[YE(255*t.r,255*t.g),YE(255*t.b,255*t.a)]}class Sp{constructor(e,n,o,l){this.value=e,this.uniformNames=n.map(u=>`u_${u}`),this.type=o,this.context=l}setUniform(e,n,o,l,u){let h=l.constantOr(this.value);n.set(e,u,h instanceof pn?h.toRenderColor(this.context.lut):h)}getBinding(e,n){return this.type==="color"?new KE(e):new xi(e)}}class ed{constructor(e,n){this.uniformNames=n.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,o,l,u){let h=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;h&&n.set(e,u,h)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new Lx(e):new xi(e)}}class va{constructor(e,n,o,l){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(u=>({name:`a_${u}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,n,o,l,u,h,g){let y=this.paintVertexArray.length,b=this.expression.evaluate(new Lt(0,{brightness:h}),n,{},u,l,g);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b,this.context)}updatePaintArray(e,n,o,l,u,h,g){let y=this.expression.evaluate({zoom:0,brightness:g},o,l,void 0,u);this._setPaintValue(e,n,y,this.context)}_setPaintValue(e,n,o,l){if(this.type==="color"){let u=Nx(o.toRenderColor(l.lut));for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,u[0],u[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Uo{constructor(e,n,o,l,u,h){this.expression=e,this.uniformNames=n.map(g=>`u_${g}_t`),this.type=o,this.useIntegerZoom=l,this.context=u,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,n,o,l,u,h,g){let y=this.expression.evaluate(new Lt(this.context.zoom,{brightness:h}),n,{},u,l,g),b=this.expression.evaluate(new Lt(this.context.zoom+1,{brightness:h}),n,{},u,l,g),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,y,b,this.context)}updatePaintArray(e,n,o,l,u,h,g){let y=this.expression.evaluate({zoom:this.context.zoom,brightness:g},o,l,void 0,u),b=this.expression.evaluate({zoom:this.context.zoom+1,brightness:g},o,l,void 0,u);this._setPaintValue(e,n,y,b,this.context)}_setPaintValue(e,n,o,l,u){if(this.type==="color"){let h=Nx(o.toRenderColor(u.lut)),g=Nx(o.toRenderColor(u.lut));for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,h[0],h[1],g[0],g[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,o,l);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,o,l,u){let h=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,g=Ht(this.expression.interpolationFactor(h,this.context.zoom,this.context.zoom+1),0,1);n.set(e,u,g)}getBinding(e,n){return new xi(e)}}class Rl{constructor(e,n,o,l,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(o==="array"?xk:vk).members;for(let h=0;h<n.length;++h);this.paintVertexArray=new l}populatePaintArray(e,n,o,l){let u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(e,n,o,l,u,h,g){this._setPaintValues(e,n,o.patterns&&o.patterns[this.layerId],h)}_setPaintValues(e,n,o,l){if(!l||!o)return;let u=l[o];if(!u)return;let{tl:h,br:g,pixelRatio:y}=u;for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,h[0],h[1],g[0],g[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cu{constructor(e,n,o=()=>!0){this.binders={},this._buffers=[],this.context=n;let l=[];for(let u in e.paint._values){let h=e.paint.get(u);if(!o(u)||!(h instanceof $n&&Xh(h.property.specification)))continue;let g=Ik(u,e.type),y=h.value,b=h.property.specification.type,T=!!h.property.useIntegerZoom,I=u==="line-dasharray"||u.endsWith("pattern"),D=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||D)if(y.kind==="source"||D||I){let P=QE(u,b,"source");this.binders[u]=I?new Rl(y,g,b,P,e.id):new va(y,g,b,P),l.push(`/a_${u}`)}else{let P=QE(u,b,"composite");this.binders[u]=new Uo(y,g,b,T,n,P),l.push(`/z_${u}`)}else this.binders[u]=I?new ed(y.value,g):new Sp(y.value,g,b,n),l.push(`/u_${u}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof va||n instanceof Uo?n.maxValue:0}populatePaintArrays(e,n,o,l,u,h,g){for(let y in this.binders){let b=this.binders[y];b.context=this.context,(b instanceof va||b instanceof Uo||b instanceof Rl)&&b.populatePaintArray(e,n,o,l,u,h,g)}}setConstantPatternPositions(e){for(let n in this.binders){let o=this.binders[n];o instanceof ed&&o.setConstantPatternPositions(e)}}updatePaintArrays(e,n,o,l,u,h,g,y){let b=!1,T=Object.keys(e),I=T.length!==0,D=I?T:n.uniqueIds;this.context.lut=u.lut;for(let P in this.binders){let R=this.binders[P];if(R.context=this.context,(R instanceof va||R instanceof Uo||R instanceof Rl)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){let L=u.paint.get(P);R.expression=L.value;for(let N of D){let j=e[N.toString()];n.eachPosition(N,(Y,X,K)=>{let ae=l.feature(Y);R.updatePaintArray(X,K,ae,j,h,g,y)})}if(!I)for(let N of o.uniqueIds){let j=e[N.toString()];o.eachPosition(N,(Y,X,K)=>{let ae=l.feature(Y);R.updatePaintArray(X,K,ae,j,h,g,y)})}b=!0}}return b}defines(){let e=[];for(let n in this.binders){let o=this.binders[n];(o instanceof Sp||o instanceof ed)&&e.push(...o.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let o=this.binders[n];if(o instanceof va||o instanceof Uo||o instanceof Rl)for(let l=0;l<o.paintVertexAttributes.length;l++)e.push(o.paintVertexAttributes[l].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let o=this.binders[n];if(o instanceof Sp||o instanceof ed||o instanceof Uo)for(let l of o.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let o in this.binders){let l=this.binders[o];if(l instanceof Sp||l instanceof ed||l instanceof Uo)for(let u of l.uniformNames)n.push({name:u,property:o,binding:l.getBinding(e,u)})}return n}setUniforms(e,n,o,l,u){for(let{name:h,property:g,binding:y}of o)this.binders[g].setUniform(e,y,u,l.get(g),h)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof va||n instanceof Uo||n instanceof Rl)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let o=this.binders[n];(o instanceof va||o instanceof Uo||o instanceof Rl)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof va||n instanceof Uo||n instanceof Rl)&&n.destroy()}}}class Ol{constructor(e,n,o=()=>!0){this.programConfigurations={};for(let l of e)this.programConfigurations[l.id]=new cu(l,n,o);this.needsUpload=!1,this._featureMap=new Cp,this._featureMapWithoutIds=new Cp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,o,l,u,h,g,y){for(let b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,n,l,u,h,g,y);n.id!==void 0?this._featureMap.add(n.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,l,u,h){for(let g of o)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,g,l,u,h||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let Ek={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ik(t,e){return Ek[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let Ck={"line-pattern":{source:Al,composite:Al},"fill-pattern":{source:Al,composite:Al},"fill-extrusion-pattern":{source:Al,composite:Al},"line-dasharray":{source:__,composite:__}},Dk={color:{source:Jh,composite:Sl},number:{source:au,composite:Jh}};function QE(t,e,n){let o=Ck[t];return o&&o[n]||Dk[e][n]}Q(Sp,"ConstantBinder"),Q(ed,"PatternConstantBinder"),Q(va,"SourceExpressionBinder"),Q(Rl,"PatternCompositeBinder"),Q(Uo,"CompositeExpressionBinder"),Q(cu,"ProgramConfiguration",{omit:["_buffers"]}),Q(Ol,"ProgramConfigurationSet");let bi=rt/Math.PI/2,zx=5,JE=6,Sk=16383,td=64,Bx=[td,32,16],Io=-bi,Co=bi;function nd(t,e,n,o=bi){return n=en(n),[t*Math.sin(n)*o,-e*o,t*Math.cos(n)*o]}function uu(t,e,n){return nd(Math.cos(en(t)),Math.sin(en(t)),e,n)}let rd=63710088e-1,Vx=2*Math.PI*rd;class cn{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new cn(ta(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,o=this.lat*n,l=e.lat*n,u=Math.sin(o)*Math.sin(l)+Math.cos(o)*Math.cos(l)*Math.cos((e.lng-this.lng)*n);return rd*Math.acos(Math.min(u,1))}toBounds(e=0){let n=360*e/40075017,o=n/Math.cos(Math.PI/180*this.lat);return new kl({lng:this.lng-o,lat:this.lat-n},{lng:this.lng+o,lat:this.lat+n})}toEcef(e){return uu(this.lat,this.lng,bi+e*bi/rd)}static convert(e){if(e instanceof cn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new cn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new cn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class kl{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){let o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{let o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof cn?new cn(e.lng,e.lat):cn.convert(e),this}setSouthWest(e){return this._sw=e instanceof cn?new cn(e.lng,e.lat):cn.convert(e),this}extend(e){let n=this._sw,o=this._ne,l,u;if(e instanceof cn)l=e,u=e;else{if(!(e instanceof kl))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(kl.convert(e)):this.extend(cn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(cn.convert(e)):this;if(l=e._sw,u=e._ne,!l||!u)return this}return n||o?(n.lng=Math.min(l.lng,n.lng),n.lat=Math.min(l.lat,n.lat),o.lng=Math.max(u.lng,o.lng),o.lat=Math.max(u.lat,o.lat)):(this._sw=new cn(l.lng,l.lat),this._ne=new cn(u.lng,u.lat)),this}getCenter(){return new cn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new cn(this.getWest(),this.getNorth())}getSouthEast(){return new cn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:o}=cn.convert(e),l=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&l}static convert(e){return!e||e instanceof kl?e:new kl(e)}}var eI={};(function(t,e){(function(n){function o(u,h,g){var y=l(256*u,256*(h=Math.pow(2,g)-h-1),g),b=l(256*(u+1),256*(h+1),g);return y[0]+","+y[1]+","+b[0]+","+b[1]}function l(u,h,g){var y=2*Math.PI*6378137/256/Math.pow(2,g);return[u*y-2*Math.PI*6378137/2,h*y-2*Math.PI*6378137/2]}n.getURL=function(u,h,g,y,b,T){return T=T||{},u+"?"+["bbox="+o(g,y,b),"format="+(T.format||"image/png"),"service="+(T.service||"WMS"),"version="+(T.version||"1.1.1"),"request="+(T.request||"GetMap"),"srs="+(T.srs||"EPSG:3857"),"width="+(T.width||256),"height="+(T.height||256),"layers="+h].join("&")},n.getTileBBox=o,n.getMercCoords=l,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,eI);var Mk=eI;class hu{constructor(e,n,o){this.z=e,this.x=n,this.y=o,this.key=Mp(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let o=Mk.getTileBBox(this.x,this.y,this.z),l=function(u,h,g){let y,b="";for(let T=u;T>0;T--)y=1<<T-1,b+=(h&y?1:0)+(g&y?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class tI{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Mp(e,n.z,n.z,n.x,n.y)}}class xr{constructor(e,n,o,l,u){this.overscaledZ=e,this.wrap=n,this.canonical=new hu(o,+l,+u),this.key=n===0&&e===o?this.canonical.key:Mp(n,e,o,l,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new xr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new xr(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Mp(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let o=this.canonical.z-e;return Mp(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new xr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,o=2*this.canonical.x,l=2*this.canonical.y;return[new xr(n,this.wrap,n,o,l),new xr(n,this.wrap,n,o+1,l),new xr(n,this.wrap,n,o,l+1),new xr(n,this.wrap,n,o+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new xr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new xr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new tI(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Mp(t,e,n,o,l){let u=1<<Math.min(n,22),h=u*(l%u)+o%u;return t&&n<22&&(h+=u*u*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*h+n)+(e-n)}let Ak=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new xr(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new xr(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new xr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new xr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];Q(hu,"CanonicalTileID"),Q(xr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let Pk=0,Rk=25.5;function jx(t){return Vx*Math.cos(t*Math.PI/180)}function Es(t){return(180+t)/360}function Is(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function wi(t,e){return t/jx(e)}function Di(t){return 360*t-180}function kr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function nI(t,e){return t*jx(kr(e))}let hr=85.051129;function rI(t){return Math.cos(en(Ht(t,-hr,hr)))}function du(t,e){let n=Ht(e,Pk,Rk),o=Math.pow(2,n);return rI(t)*Vx/(512*o)}function iI(t){return 1/Math.cos(t*Math.PI/180)}function T_(t,e=0){let n=Math.exp(Math.PI*(1-(t.y+e/rt)/(1<<t.z)*2));return 80150034*n/(n*n+1)/rt/(1<<t.z)}class si{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){let o=cn.convert(e);return new si(Es(o.lng),Is(o.lat),wi(n,o.lat))}toLngLat(){return new cn(Di(this.x),kr(this.y))}toAltitude(){return nI(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Vx*iI(kr(this.y))}}function Ux(t,e,n,o,l,u,h,g,y){let b=(e+o)/2,T=(n+l)/2,I=new at(b,T);g(I),function(D,P,R,L,N,j){let Y=R-N,X=L-j;return Math.abs((L-P)*Y-(R-D)*X)/Math.hypot(Y,X)}(I.x,I.y,u.x,u.y,h.x,h.y)>=y?(Ux(t,e,n,b,T,u,I,g,y),Ux(t,b,T,o,l,I,h,g,y)):t.push(h)}function oI(t,e,n){let o=t[0],l=o.x,u=o.y;e(o);let h=[o];for(let g=1;g<t.length;g++){let y=t[g],{x:b,y:T}=y;e(y),Ux(h,l,u,b,T,o,y,e,n),l=b,u=T,o=y}return h}function $x(t,e,n,o){if(o(e,n)){let l=e.add(n)._mult(.5);$x(t,e,l,o),$x(t,l,n,o)}else t.push(n)}function Ok(t,e){let n=t[0],o=[n];for(let l=1;l<t.length;l++){let u=t[l];$x(o,n,u,e),n=u}return o}let Gx=Math.pow(2,14)-1,sI=-Gx-1;function kk(t,e){let n=Math.round(t.x*e),o=Math.round(t.y*e);return t.x=Ht(n,sI,Gx),t.y=Ht(o,sI,Gx),(n<t.x||n>t.x+1||o<t.y||o>t.y+1)&&cr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function $o(t,e,n){let o=t.loadGeometry(),l=t.extent,u=rt/l;if(e&&n&&n.projection.isReprojectedInTileSpace){let h=1<<e.z,{scale:g,x:y,y:b,projection:T}=n,I=D=>{let P=Di((e.x+D.x/l)/h),R=kr((e.y+D.y/l)/h),L=T.project(P,R);D.x=(L.x*g-y)*l,D.y=(L.y*g-b)*l};for(let D=0;D<o.length;D++)if(t.type!==1)o[D]=oI(o[D],I,1);else{let P=[];for(let R of o[D])R.x<0||R.x>=l||R.y<0||R.y>=l||(I(R),P.push(R));o[D]=P}}for(let h of o)for(let g of h)kk(g,u);return o}function xa(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?$o(t):[]}}function E_(t,e,n,o,l){t.emplaceBack(2*e+(o+1)/2,2*n+(l+1)/2)}function I_(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Hx{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new jo,this.indexArray=new Ir,this.segments=new Jn,this.programConfigurations=new Ol(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(e,n){}populate(e,n,o,l){let u=this.layers[0],h=[],g=null;u.type==="circle"&&(g=u.layout.get("circle-sort-key"));for(let{feature:b,id:T,index:I,sourceLayerIndex:D}of e){let P=this.layers[0]._featureFilter.needGeometry,R=xa(b,P);if(!this.layers[0]._featureFilter.filter(new Lt(this.zoom),R,o))continue;let L=g?g.evaluate(R,{},o):void 0,N={id:T,properties:b.properties,type:b.type,sourceLayerIndex:D,index:I,geometry:P?R.geometry:$o(b,o,l),patterns:{},sortKey:L};h.push(N)}g&&h.sort((b,T)=>b.sortKey-T.sortKey);let y=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new y_,y=l.projection);for(let b of h){let{geometry:T,index:I,sourceLayerIndex:D}=b,P=e[I].feature;this.addFeature(b,T,I,n.availableImages,o,y,n.brightness),n.featureIndex.insert(P,T,I,D,this.index)}}update(e,n,o,l,u){let h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,h?this.stateDependentLayers:this.layers,o,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_k.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,yk.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,o,l,u,h,g){for(let y of n)for(let b of y){let T=b.x,I=b.y;if(T<0||T>=rt||I<0||I>=rt)continue;if(h){let R=h.projectTilePoint(T,I,u),L=h.upVector(u,T,I),N=this.globeExtVertexArray;I_(N,R,L),I_(N,R,L),I_(N,R,L),I_(N,R,L)}let D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=D.vertexLength;E_(this.layoutVertexArray,T,I,-1,-1),E_(this.layoutVertexArray,T,I,1,-1),E_(this.layoutVertexArray,T,I,1,1),E_(this.layoutVertexArray,T,I,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},l,u,g)}}function qx(t,e){for(let n=0;n<t.length;n++)if(Ll(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Ll(t,e[n]))return!0;return!!Wx(t,e)}function Lk(t,e,n){return!!Ll(t,e)||!!Zx(e,t,n)}function aI(t,e){if(t.length===1)return cI(e,t[0]);for(let n=0;n<e.length;n++){let o=e[n];for(let l=0;l<o.length;l++)if(Ll(t,o[l]))return!0}for(let n=0;n<t.length;n++)if(cI(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Wx(t,e[n]))return!0;return!1}function Fk(t,e,n){if(t.length>1){if(Wx(t,e))return!0;for(let o=0;o<e.length;o++)if(Zx(e[o],t,n))return!0}for(let o=0;o<t.length;o++)if(Zx(t[o],e,n))return!0;return!1}function Wx(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){let o=t[n],l=t[n+1];for(let u=0;u<e.length-1;u++)if(Nk(o,l,e[u],e[u+1]))return!0}return!1}function Nk(t,e,n,o){return xo(t,n,o)!==xo(e,n,o)&&xo(t,e,n)!==xo(t,e,o)}function Zx(t,e,n){let o=n*n;if(e.length===1)return t.distSqr(e[0])<o;for(let l=1;l<e.length;l++)if(lI(t,e[l-1],e[l])<o)return!0;return!1}function lI(t,e,n){let o=e.distSqr(n);if(o===0)return t.distSqr(e);let l=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/o;return t.distSqr(l<0?e:l>1?n:n.sub(e)._mult(l)._add(e))}function cI(t,e){let n,o,l,u=!1;for(let h=0;h<t.length;h++){n=t[h];for(let g=0,y=n.length-1;g<n.length;y=g++)o=n[g],l=n[y],o.y>e.y!=l.y>e.y&&e.x<(l.x-o.x)*(e.y-o.y)/(l.y-o.y)+o.x&&(u=!u)}return u}function Ll(t,e){let n=!1;for(let o=0,l=t.length-1;o<t.length;l=o++){let u=t[o],h=t[l];u.y>e.y!=h.y>e.y&&e.x<(h.x-u.x)*(e.y-u.y)/(h.y-u.y)+u.x&&(n=!n)}return n}function uI(t,e,n,o,l){for(let h of t)if(e<=h.x&&n<=h.y&&o>=h.x&&l>=h.y)return!0;let u=[new at(e,n),new at(e,l),new at(o,l),new at(o,n)];if(t.length>2){for(let h of u)if(Ll(t,h))return!0}for(let h=0;h<t.length-1;h++)if(zk(t[h],t[h+1],u))return!0;return!1}function zk(t,e,n){let o=n[0],l=n[2];if(t.x<o.x&&e.x<o.x||t.x>l.x&&e.x>l.x||t.y<o.y&&e.y<o.y||t.y>l.y&&e.y>l.y)return!1;let u=xo(t,e,n[0]);return u!==xo(t,e,n[1])||u!==xo(t,e,n[2])||u!==xo(t,e,n[3])}function id(t,e,n,o,l,u){let h=e.y-t.y,g=t.x-e.x;if(u=u||0){let y=h*h+g*g;if(y===0)return!0;let b=Math.sqrt(y);h/=b,g/=b}return!((n.x-t.x)*h+(n.y-t.y)*g-u<0||(o.x-t.x)*h+(o.y-t.y)*g-u<0||(l.x-t.x)*h+(l.y-t.y)*g-u<0)}function Yx(t,e,n,o,l,u,h){return!(id(t,e,o,l,u,h)||id(e,n,o,l,u,h)||id(n,t,o,l,u,h)||id(o,l,t,e,n,h)||id(l,u,t,e,n,h)||id(u,o,t,e,n,h))}function od(t,e,n){let o=e.paint.get(t).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(t)}function C_(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function hI(t,e,n,o,l){if(!e[0]&&!e[1])return t;let u=at.convert(e)._mult(l);n==="viewport"&&u._rotate(-o);let h=[];for(let g=0;g<t.length;g++)h.push(t[g].sub(u));return h}function dI(t,e,n,o){let l=at.convert(t)._mult(o);return e==="viewport"&&l._rotate(-n),l}Q(Hx,"CircleBucket",{omit:["layers"]});let Bk=new Cn({"circle-sort-key":new ut(Te.layout_circle["circle-sort-key"]),visibility:new Fe(Te.layout_circle.visibility)});var Vk={paint:new Cn({"circle-radius":new ut(Te.paint_circle["circle-radius"]),"circle-color":new ut(Te.paint_circle["circle-color"]),"circle-blur":new ut(Te.paint_circle["circle-blur"]),"circle-opacity":new ut(Te.paint_circle["circle-opacity"]),"circle-translate":new Fe(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new Fe(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Fe(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Fe(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ut(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ut(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ut(Te.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Fe(Te.paint_circle["circle-emissive-strength"])}),layout:Bk};class Xx{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,o){let l=r._.dot(n,this.dir);if(Math.abs(l)<1e-6)return!1;let u=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/l;return o[0]=this.pos[0]+this.dir[0]*u,o[1]=this.pos[1]+this.dir[1]*u,o[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,n,o){if(r._.equals(this.pos,e)||n===0)return o[0]=o[1]=o[2]=0,!1;let[l,u,h]=this.dir,g=this.pos[0]-e[0],y=this.pos[1]-e[1],b=this.pos[2]-e[2],T=l*l+u*u+h*h,I=2*(g*l+y*u+b*h),D=I*I-4*T*(g*g+y*y+b*b-n*n);if(D<0){let P=Math.max(-I/2,0),R=g+l*P,L=y+u*P,N=b+h*P,j=Math.hypot(R,L,N);return o[0]=R*n/j,o[1]=L*n/j,o[2]=N*n/j,!1}{let P=(-I-Math.sqrt(D))/(2*T);if(P<0){let R=Math.hypot(g,y,b);return o[0]=g*n/R,o[1]=y*n/R,o[2]=b*n/R,!1}return o[0]=g+l*P,o[1]=y+u*P,o[2]=b+h*P,!0}}}class Kx{constructor(e,n,o,l,u){this.TL=e,this.TR=n,this.BR=o,this.BL=l,this.horizon=u}static fromInvProjectionMatrix(e,n,o){let l=[-1,1,1],u=[1,1,1],h=[1,-1,1],g=[-1,-1,1],y=r._.transformMat4(l,l,e),b=r._.transformMat4(u,u,e),T=r._.transformMat4(h,h,e),I=r._.transformMat4(g,g,e);return new Kx(y,b,T,I,n/o)}}function Ap(t,e,n){let o=1/0,l=-1/0,u=[];for(let h of t){r._.sub(u,h,e);let g=r._.dot(u,n);o=Math.min(o,g),l=Math.max(l,g)}return[o,l]}function fI(t,e){let n=!0;for(let o=0;o<t.planes.length;o++){let l=t.planes[o],u=0;for(let h=0;h<e.length;h++)u+=r._.dot(l,e[h])+l[3]>=0;if(u===0)return 0;u!==e.length&&(n=!1)}return n?2:1}function pI(t,e){for(let n of t.projections){let o=Ap(e,t.points[0],n.axis);if(n.projection[1]<o[0]||n.projection[0]>o[1])return 0}return 1}function mI(t,e){let n=0,o=[0,0,0,0];for(let l=0;l<t.length;l++)o[0]=t[l][0],o[1]=t[l][1],o[2]=t[l][2],o[3]=1,r.aA.dot(o,e)>=0&&n++;return n}class Qx{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=er.fromPoints(this.points),this.projections=[],this.frustumEdges=[r._.sub([],this.points[2],this.points[3]),r._.sub([],this.points[0],this.points[3]),r._.sub([],this.points[4],this.points[0]),r._.sub([],this.points[5],this.points[1]),r._.sub([],this.points[6],this.points[2]),r._.sub([],this.points[7],this.points[3])];for(let o of this.frustumEdges){let l=[0,-o[2],o[1]],u=[o[2],0,-o[0]];this.projections.push({axis:l,projection:Ap(this.points,this.points[0],l)}),this.projections.push({axis:u,projection:Ap(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,n,o,l){let u=Math.pow(2,o),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{let T=r.aA.transformMat4([],b,e),I=1/T[3]/n*u;return r.aA.mul(T,T,[I,I,l?1/T[3]:I,I])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{let T=r._.sub([],h[b[0]],h[b[1]]),I=r._.sub([],h[b[2]],h[b[1]]),D=r._.normalize([],r._.cross([],T,I)),P=-r._.dot(D,h[b[1]]);return D.concat(P)}),y=[];for(let b=0;b<h.length;b++)y.push([h[b][0],h[b][1],h[b][2]]);return new Qx(y,g)}intersectsPrecise(e,n,o){for(let l=0;l<n.length;l++)if(!mI(e,n[l]))return 0;for(let l=0;l<this.planes.length;l++)if(!mI(e,this.planes[l]))return 0;for(let l of o)for(let u of this.frustumEdges){let h=r._.cross([],l,u),g=r._.length(h);if(g===0)continue;r._.scale(h,h,1/g);let y=Ap(this.points,this.points[0],h),b=Ap(e,this.points[0],h);if(y[0]>b[1]||b[0]>y[1])return 0}return 1}}class er{static fromPoints(e){let n=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(let l of e)r._.min(n,n,l),r._.max(o,o,l);return new er(n,o)}static fromTileIdAndHeight(e,n,o){let l=1<<e.canonical.z,u=e.canonical.x,h=e.canonical.y;return new er([u/l,h/l,n],[(u+1)/l,(h+1)/l,o])}static applyTransform(e,n){let o=e.getCorners();for(let l=0;l<o.length;++l)r._.transformMat4(o[l],o[l],n);return er.fromPoints(o)}static projectAabbCorners(e,n){let o=e.getCorners();for(let l=0;l<o.length;++l)r._.transformMat4(o[l],o[l],n);return o}constructor(e,n){this.min=e,this.max=n,this.center=r._.scale([],r._.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],o=r._.clone(this.min),l=r._.clone(this.max);for(let u=0;u<n.length;u++)o[u]=n[u]?this.min[u]:this.center[u],l[u]=n[u]?this.center[u]:this.max[u];return l[2]=this.max[2],new er(o,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?fI(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?fI(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?pI(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?pI(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Q(er,"Aabb");let jk=wn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:D_}=jk,gI=wn([{name:"a_pos_3",components:3,type:"Int16"}]);var Pp=wn([{name:"a_pos",type:"Int16",components:2}]);function S_(t){return t*bi/rd}let Uk=[new er([Io,Io,Io],[Co,Co,Co]),new er([Io,Io,Io],[0,0,Co]),new er([0,Io,Io],[Co,0,Co]),new er([Io,0,Io],[0,Co,Co]),new er([0,0,Io],[Co,Co,Co])];function _I(t,e,n,o=!0){let l=r._.scale([],t._camera.position,t.worldSize),u=[e,n,1,1];r.aA.transformMat4(u,u,t.pixelMatrixInverse),r.aA.scale(u,u,1/u[3]);let h=r._.sub([],u,l),g=r._.normalize([],h),y=t.globeMatrix,b=[y[12],y[13],y[14]],T=r._.sub([],b,l),I=r._.length(T),D=r._.normalize([],T),P=t.worldSize/(2*Math.PI),R=r._.dot(D,g),L=Math.asin(P/I);if(L<Math.acos(R)){if(!o)return null;let Ce=[],Le=[];r._.scale(Ce,g,I/R),r._.normalize(Le,r._.sub(Le,Ce,T)),r._.normalize(g,r._.add(g,T,r._.scale(g,Le,Math.tan(L)*I)))}let N=[];new Xx(l,g).closestPointOnSphere(b,P,N);let j=r._.normalize([],Ac(y,0)),Y=r._.normalize([],Ac(y,1)),X=r._.normalize([],Ac(y,2)),K=r._.dot(j,N),ae=r._.dot(Y,N),oe=r._.dot(X,N),fe=qr(Math.asin(-ae/P)),me=qr(Math.atan2(K,oe));me=t.center.lng+function(Ce,Le){let Ye=(Le-Ce+180)%360-180;return Ye<-180?Ye+360:Ye}(t.center.lng,me);let we=Es(me),Pe=Ht(Is(fe),0,1);return new si(we,Pe)}class $k{constructor(e,n,o){this.a=r._.sub([],e,o),this.b=r._.sub([],n,o),this.center=o;let l=r._.normalize([],this.a),u=r._.normalize([],this.b);this.angle=Math.acos(r._.dot(l,u))}}function Jx(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(o,l,u,h){let g=Math.sin(u);return o*(Math.sin((1-h)*u)/g)+l*(Math.sin(h*u)/g)}(t.a[e],t.b[e],t.angle,Ht(n,0,1))+t.center[e]}function Cs(t){if(t.z<=1)return Uk[t.z+2*t.y+t.x];let e=e1(M_(t));return er.fromPoints(e)}function ba(t,e,n){return r._.scale(t,t,1-n),r._.scaleAndAdd(t,t,e,n)}function yI(t,e){let n=wa(e.zoom);if(n===0)return Cs(t);let o=M_(t),l=e1(o),u=Es(o.getWest())*e.worldSize,h=Es(o.getEast())*e.worldSize,g=Is(o.getNorth())*e.worldSize,y=Is(o.getSouth())*e.worldSize,b=[u,g,0],T=[h,g,0],I=[u,y,0],D=[h,y,0],P=r.ad.invert([],e.globeMatrix);return r._.transformMat4(b,b,P),r._.transformMat4(T,T,P),r._.transformMat4(I,I,P),r._.transformMat4(D,D,P),l[0]=ba(l[0],I,n),l[1]=ba(l[1],D,n),l[2]=ba(l[2],T,n),l[3]=ba(l[3],b,n),er.fromPoints(l)}function vI(t,e,n){for(let o of t)r._.transformMat4(o,o,e),r._.scale(o,o,n)}function xI(t,e,n,o){let l=e/t.worldSize,u=t.globeMatrix;if(n.z<=1){let we=Cs(n).getCorners();return vI(we,u,l),er.fromPoints(we)}let h=M_(n,o),g=e1(h,bi+S_(t._tileCoverLift));vI(g,u,l);let y=Number.MAX_VALUE,b=[-y,-y,-y],T=[y,y,y];if(h.contains(t.center)){for(let Ce of g)r._.min(T,T,Ce),r._.max(b,b,Ce);b[2]=0;let we=t.point,Pe=[we.x*l,we.y*l,0];return r._.min(T,T,Pe),r._.max(b,b,Pe),new er(T,b)}if(t._tileCoverLift>0){for(let we of g)r._.min(T,T,we),r._.max(b,b,we);return new er(T,b)}let I=[u[12]*l,u[13]*l,u[14]*l],D=h.getCenter(),P=Ht(t.center.lat,-hr,hr),R=Ht(D.lat,-hr,hr),L=Es(t.center.lng),N=Is(P),j=L-Es(D.lng),Y=N-Is(R);j>.5?j-=1:j<-.5&&(j+=1);let X=0;if(Math.abs(j)>Math.abs(Y))X=j>=0?1:3;else{X=Y>=0?0:2;let we=[u[4]*l,u[5]*l,u[6]*l],Pe=-Math.sin(en(Y>=0?h.getSouth():h.getNorth()))*bi;r._.scaleAndAdd(I,I,we,Pe)}let K=g[X],ae=g[(X+1)%4],oe=new $k(K,ae,I),fe=[Jx(oe,0)||K[0],Jx(oe,1)||K[1],Jx(oe,2)||K[2]],me=wa(t.zoom);if(me>0){let we=function({x:Ce,y:Le,z:Ye},Oe,He,Re,qe){let Qe=1/(1<<Ye),Ze=Ce*Qe,ht=Ze+Qe,Xe=Le*Qe,tt=Xe+Qe,vt=0,yt=(Ze+ht)/2-Re;return yt>.5?vt=-1:yt<-.5&&(vt=1),Ze=((Ze+vt)*Oe-(Re*=Oe))*He+Re,ht=((ht+vt)*Oe-Re)*He+Re,Xe=(Xe*Oe-(qe*=Oe))*He+qe,tt=(tt*Oe-qe)*He+qe,[[Ze,tt,0],[ht,tt,0],[ht,Xe,0],[Ze,Xe,0]]}(n,e,t._pixelsPerMercatorPixel,L,N);for(let Ce=0;Ce<g.length;Ce++)ba(g[Ce],we[Ce],me);let Pe=r._.add([],we[X],we[(X+1)%4]);r._.scale(Pe,Pe,.5),ba(fe,Pe,me)}for(let we of g)r._.min(T,T,we),r._.max(b,b,we);return T[2]=Math.min(K[2],ae[2]),r._.min(T,T,fe),r._.max(b,b,fe),new er(T,b)}function M_({x:t,y:e,z:n},o=!1){let l=1/(1<<n),u=new cn(Di(t*l),e===(1<<n)-1&&o?-90:kr((e+1)*l)),h=new cn(Di((t+1)*l),e===0&&o?90:kr(e*l));return new kl(u,h)}function e1(t,e=bi){let n=en(t.getNorth()),o=en(t.getSouth()),l=Math.cos(n),u=Math.cos(o),h=Math.sin(n),g=Math.sin(o),y=t.getWest(),b=t.getEast();return[nd(u,g,y,e),nd(u,g,b,e),nd(l,h,b,e),nd(l,h,y,e)]}function Rp(t,e,n,o){let l=1<<n.z,u=(t/rt+n.x)/l;return uu(kr((e/rt+n.y)/l),Di(u),o)}function A_({min:t,max:e}){return Sk/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let bI=new Float64Array(16);function Op(t){let e=A_(t),n=r.ad.fromScaling(bI,[e,e,e]);return r.ad.translate(n,n,r._.negate([],t.min))}function t1(t){let e=r.ad.fromTranslation(bI,t.min),n=1/A_(t);return r.ad.scale(e,e,[n,n,n])}function n1(t){let e=rt/(2*Math.PI);return t/(2*Math.PI)/e}function wI(t,e){return rt/(512*Math.pow(2,t))*A_(Cs(e))}function TI(t,e,n,o,l){let u=n1(n),h=[t,e,-n/(2*Math.PI)],g=r.ad.identity(new Float64Array(16));return r.ad.translate(g,g,h),r.ad.scale(g,g,[u,u,u]),r.ad.rotateX(g,g,en(-l)),r.ad.rotateY(g,g,en(-o)),g}function wa(t){return ea(zx,JE,t)}function EI(t,e){let n=uu(e.lat,e.lng),o=function(u){let h=uu(u._center.lat,u._center.lng),g=r._.fromValues(0,1,0),y=r._.cross([],g,h),b=r.ad.fromRotation([],-u.angle,h);y=r._.transformMat4(y,y,b),r.ad.fromRotation(b,-u._pitch,y);let T=r._.normalize([],h);return r._.scale(T,T,S_(u.cameraToCenterDistance/u.pixelsPerMeter)),r._.transformMat4(T,T,b),r._.add([],h,T)}(t),l=r._.subtract([],o,n);return r._.angle(l,n)}function r1(t,e){return EI(t,e)>Math.PI/2*1.01}let II=en(85),Gk=Math.cos(II),Hk=Math.sin(II),qk=r.ad.create(),CI=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function DI(t,e,n,o,l,u,h,g,y){if(u&&t.queryGeometry.isAboveHorizon)return!1;u&&(y*=t.pixelToTileUnitsFactor);let b=t.tileID.canonical,T=n.projection.upVectorScale(b,n.center.lat,n.worldSize).metersToTile;for(let I of e)for(let D of I){let P=D.add(g),R=l&&n.elevation?n.elevation.exaggeration()*l.getElevationAt(P.x,P.y,!0):0,L=n.projection.projectTilePoint(P.x,P.y,b);if(R>0){let X=n.projection.upVector(b,P.x,P.y);L.x+=X[0]*T*R,L.y+=X[1]*T*R,L.z+=X[2]*T*R}let N=u?P:Wk(L.x,L.y,L.z,o),j=u?t.tilespaceRays.map(X=>Yk(X,R)):t.queryGeometry.screenGeometry,Y=r.aA.transformMat4([],[L.x,L.y,L.z,1],o);if(!h&&u?y*=Y[3]/n.cameraToCenterDistance:h&&!u&&(y*=n.cameraToCenterDistance/Y[3]),u){let X=kr((D.y/rt+b.y)/(1<<b.z));y/=n.projection.pixelsPerMeter(X,1)/wi(1,X)}if(Lk(j,N,y))return!0}return!1}function Wk(t,e,n,o){let l=r.aA.transformMat4([],[t,e,n,1],o);return new at(l[0]/l[3],l[1]/l[3])}let SI=r._.fromValues(0,0,0),Zk=r._.fromValues(0,0,1);function Yk(t,e){let n=r._.create();return SI[2]=e,t.intersectsPlane(SI,Zk,n),new at(n[0],n[1])}class MI extends Hx{}function AI(t,{width:e,height:n},o,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*n*o)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*n*o);return t.width=e,t.height=n,t.data=l,t}function PI(t,e,n){let{width:o,height:l}=e;o===t.width&&l===t.height||(i1(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,o),height:Math.min(t.height,l)},n,null),t.width=o,t.height=l,t.data=e.data)}function i1(t,e,n,o,l,u,h,g){if(l.width===0||l.height===0)return e;if(l.width>t.width||l.height>t.height||n.x>t.width-l.width||n.y>t.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||o.x>e.width-l.width||o.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");let y=t.data,b=e.data,T=u===4&&g;for(let I=0;I<l.height;I++){let D=((n.y+I)*t.width+n.x)*u,P=((o.y+I)*e.width+o.x)*u;if(T)for(let R=0;R<l.width;R++){let L=D+R*u+3,N=P+R*u;b[N+0]=255,b[N+1]=255,b[N+2]=255,b[N+3]=y[L]}else if(h)for(let R=0;R<l.width;R++){let L=D+R*u,N=P+R*u,j=y[L+3],Y=new pn(y[L+0]/255*j,y[L+1]/255*j,y[L+2]/255*j,j).toRenderColor(h).toArray();b[N+0]=Y[0],b[N+1]=Y[1],b[N+2]=Y[2],b[N+3]=Y[3]}else for(let R=0;R<l.width*u;R++)b[P+R]=y[D+R]}return e}Q(MI,"HeatmapBucket",{omit:["layers"]});class Fl{constructor(e,n){AI(this,e,1,n)}resize(e){PI(this,new Fl(e),1)}clone(){return new Fl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,l,u){i1(e,n,o,l,u,1,null)}}class ro{constructor(e,n){AI(this,e,4,n)}resize(e){PI(this,new ro(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ro({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,l,u,h,g){i1(e,n,o,l,u,4,h,g)}}class RI{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}Q(Fl,"AlphaImage"),Q(ro,"RGBAImage");let Xk=new Cn({visibility:new Fe(Te.layout_heatmap.visibility)});var Kk={paint:new Cn({"heatmap-radius":new ut(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ut(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Fe(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new vr(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Fe(Te.paint_heatmap["heatmap-opacity"])}),layout:Xk};function kp(t){let e={},n=t.resolution||256,o=t.clips?t.clips.length:1,l=t.image||new ro({width:n,height:o}),u=(h,g,y)=>{e[t.evaluationKey]=y;let b=t.expression.evaluate(e);b&&(l.data[h+g+0]=Math.floor(255*b.r/b.a),l.data[h+g+1]=Math.floor(255*b.g/b.a),l.data[h+g+2]=Math.floor(255*b.b/b.a),l.data[h+g+3]=Math.floor(255*b.a))};if(t.clips)for(let h=0,g=0;h<o;++h,g+=4*n)for(let y=0,b=0;y<n;y++,b+=4){let T=y/(n-1),{start:I,end:D}=t.clips[h];u(g,b,I*(1-T)+D*T)}else for(let h=0,g=0;h<n;h++,g+=4)u(0,g,h/(n-1));return l}let Qk=new Cn({visibility:new Fe(Te.layout_hillshade.visibility)});var Jk={paint:new Cn({"hillshade-illumination-direction":new Fe(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Fe(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Fe(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Fe(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Fe(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Fe(Te.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Fe(Te.paint_hillshade["hillshade-emissive-strength"])}),layout:Qk};let eL=wn([{name:"a_pos",components:2,type:"Int16"}],4),{members:tL}=eL;function Lp(t,e,n=2){let o=e&&e.length,l=o?e[0]*n:t.length,u=OI(t,0,l,n,!0),h=[];if(!u||u.next===u.prev)return h;let g,y,b;if(o&&(u=function(T,I,D,P){let R=[];for(let L=0,N=I.length;L<N;L++){let j=OI(T,I[L]*P,L<N-1?I[L+1]*P:T.length,P,!1);j===j.next&&(j.steiner=!0),R.push(cL(j))}R.sort(sL);for(let L=0;L<R.length;L++)D=aL(R[L],D);return D}(t,e,u,n)),t.length>80*n){g=1/0,y=1/0;let T=-1/0,I=-1/0;for(let D=n;D<l;D+=n){let P=t[D],R=t[D+1];P<g&&(g=P),R<y&&(y=R),P>T&&(T=P),R>I&&(I=R)}b=Math.max(T-g,I-y),b=b!==0?32767/b:0}return Fp(u,h,n,g,y,b,0),h}function OI(t,e,n,o,l){let u;if(l===function(h,g,y,b){let T=0;for(let I=g,D=y-b;I<y;I+=b)T+=(h[D]-h[I])*(h[I+1]+h[D+1]),D=I;return T}(t,e,n,o)>0)for(let h=e;h<n;h+=o)u=FI(h/o|0,t[h],t[h+1],u);else for(let h=n-o;h>=e;h-=o)u=FI(h/o|0,t[h],t[h+1],u);return u&&P_(u,u.next)&&(zp(u),u=u.next),u}function fu(t,e){if(!t)return t;e||(e=t);let n,o=t;do if(n=!1,o.steiner||!P_(o,o.next)&&br(o.prev,o,o.next)!==0)o=o.next;else{if(zp(o),o=e=o.prev,o===o.next)break;n=!0}while(n||o!==e);return e}function Fp(t,e,n,o,l,u,h){if(!t)return;!h&&u&&function(y,b,T,I){let D=y;do D.z===0&&(D.z=o1(D.x,D.y,b,T,I)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==y);D.prevZ.nextZ=null,D.prevZ=null,function(P){let R,L=1;do{let N,j=P;P=null;let Y=null;for(R=0;j;){R++;let X=j,K=0;for(let oe=0;oe<L&&(K++,X=X.nextZ,X);oe++);let ae=L;for(;K>0||ae>0&&X;)K!==0&&(ae===0||!X||j.z<=X.z)?(N=j,j=j.nextZ,K--):(N=X,X=X.nextZ,ae--),Y?Y.nextZ=N:P=N,N.prevZ=Y,Y=N;j=X}Y.nextZ=null,L*=2}while(R>1)}(D)}(t,o,l,u);let g=t;for(;t.prev!==t.next;){let y=t.prev,b=t.next;if(u?rL(t,o,l,u):nL(t))e.push(y.i,t.i,b.i),zp(t),t=b.next,g=b.next;else if((t=b)===g){h?h===1?Fp(t=iL(fu(t),e),e,n,o,l,u,2):h===2&&oL(t,e,n,o,l,u):Fp(fu(t),e,n,o,l,u,1);break}}}function nL(t){let e=t.prev,n=t,o=t.next;if(br(e,n,o)>=0)return!1;let l=e.x,u=n.x,h=o.x,g=e.y,y=n.y,b=o.y,T=l<u?l<h?l:h:u<h?u:h,I=g<y?g<b?g:b:y<b?y:b,D=l>u?l>h?l:h:u>h?u:h,P=g>y?g>b?g:b:y>b?y:b,R=o.next;for(;R!==e;){if(R.x>=T&&R.x<=D&&R.y>=I&&R.y<=P&&sd(l,g,u,y,h,b,R.x,R.y)&&br(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function rL(t,e,n,o){let l=t.prev,u=t,h=t.next;if(br(l,u,h)>=0)return!1;let g=l.x,y=u.x,b=h.x,T=l.y,I=u.y,D=h.y,P=g<y?g<b?g:b:y<b?y:b,R=T<I?T<D?T:D:I<D?I:D,L=g>y?g>b?g:b:y>b?y:b,N=T>I?T>D?T:D:I>D?I:D,j=o1(P,R,e,n,o),Y=o1(L,N,e,n,o),X=t.prevZ,K=t.nextZ;for(;X&&X.z>=j&&K&&K.z<=Y;){if(X.x>=P&&X.x<=L&&X.y>=R&&X.y<=N&&X!==l&&X!==h&&sd(g,T,y,I,b,D,X.x,X.y)&&br(X.prev,X,X.next)>=0||(X=X.prevZ,K.x>=P&&K.x<=L&&K.y>=R&&K.y<=N&&K!==l&&K!==h&&sd(g,T,y,I,b,D,K.x,K.y)&&br(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;X&&X.z>=j;){if(X.x>=P&&X.x<=L&&X.y>=R&&X.y<=N&&X!==l&&X!==h&&sd(g,T,y,I,b,D,X.x,X.y)&&br(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;K&&K.z<=Y;){if(K.x>=P&&K.x<=L&&K.y>=R&&K.y<=N&&K!==l&&K!==h&&sd(g,T,y,I,b,D,K.x,K.y)&&br(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function iL(t,e){let n=t;do{let o=n.prev,l=n.next.next;!P_(o,l)&&kI(o,n,n.next,l)&&Np(o,l)&&Np(l,o)&&(e.push(o.i,n.i,l.i),zp(n),zp(n.next),n=t=l),n=n.next}while(n!==t);return fu(n)}function oL(t,e,n,o,l,u){let h=t;do{let g=h.next.next;for(;g!==h.prev;){if(h.i!==g.i&&uL(h,g)){let y=LI(h,g);return h=fu(h,h.next),y=fu(y,y.next),Fp(h,e,n,o,l,u,0),void Fp(y,e,n,o,l,u,0)}g=g.next}h=h.next}while(h!==t)}function sL(t,e){return t.x-e.x}function aL(t,e){let n=function(l,u){let h=u,g=l.x,y=l.y,b,T=-1/0;do{if(y<=h.y&&y>=h.next.y&&h.next.y!==h.y){let L=h.x+(y-h.y)*(h.next.x-h.x)/(h.next.y-h.y);if(L<=g&&L>T&&(T=L,b=h.x<h.next.x?h:h.next,L===g))return b}h=h.next}while(h!==u);if(!b)return null;let I=b,D=b.x,P=b.y,R=1/0;h=b;do{if(g>=h.x&&h.x>=D&&g!==h.x&&sd(y<P?g:T,y,D,P,y<P?T:g,y,h.x,h.y)){let L=Math.abs(y-h.y)/(g-h.x);Np(h,l)&&(L<R||L===R&&(h.x>b.x||h.x===b.x&&lL(b,h)))&&(b=h,R=L)}h=h.next}while(h!==I);return b}(t,e);if(!n)return e;let o=LI(n,t);return fu(o,o.next),fu(n,n.next)}function lL(t,e){return br(t.prev,t,e.prev)<0&&br(e.next,t,t.next)<0}function o1(t,e,n,o,l){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function cL(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function sd(t,e,n,o,l,u,h,g){return(l-h)*(e-g)>=(t-h)*(u-g)&&(t-h)*(o-g)>=(n-h)*(e-g)&&(n-h)*(u-g)>=(l-h)*(o-g)}function uL(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,o){let l=n;do{if(l.i!==n.i&&l.next.i!==n.i&&l.i!==o.i&&l.next.i!==o.i&&kI(l,l.next,n,o))return!0;l=l.next}while(l!==n);return!1}(t,e)&&(Np(t,e)&&Np(e,t)&&function(n,o){let l=n,u=!1,h=(n.x+o.x)/2,g=(n.y+o.y)/2;do l.y>g!=l.next.y>g&&l.next.y!==l.y&&h<(l.next.x-l.x)*(g-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next;while(l!==n);return u}(t,e)&&(br(t.prev,t,e.prev)||br(t,e.prev,e))||P_(t,e)&&br(t.prev,t,t.next)>0&&br(e.prev,e,e.next)>0)}function br(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function P_(t,e){return t.x===e.x&&t.y===e.y}function kI(t,e,n,o){let l=O_(br(t,e,n)),u=O_(br(t,e,o)),h=O_(br(n,o,t)),g=O_(br(n,o,e));return l!==u&&h!==g||!(l!==0||!R_(t,n,e))||!(u!==0||!R_(t,o,e))||!(h!==0||!R_(n,t,o))||!(g!==0||!R_(n,e,o))}function R_(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function O_(t){return t>0?1:t<0?-1:0}function Np(t,e){return br(t.prev,t,t.next)<0?br(t,e,t.next)>=0&&br(t,t.prev,e)>=0:br(t,e,t.prev)<0||br(t,t.next,e)<0}function LI(t,e){let n=s1(t.i,t.x,t.y),o=s1(e.i,e.x,e.y),l=t.next,u=e.prev;return t.next=e,e.prev=t,n.next=l,l.prev=n,o.next=n,n.prev=o,u.next=o,o.prev=u,o}function FI(t,e,n,o){let l=s1(t,e,n);return o?(l.next=o.next,l.prev=o,o.next.prev=l,o.next=l):(l.prev=l,l.next=l),l}function zp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function s1(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function k_(t,e){let n=t.length;if(n<=1)return[t];let o=[],l,u;for(let h=0;h<n;h++){let g=ri(t[h]);g!==0&&(t[h].area=Math.abs(g),u===void 0&&(u=g<0),u===g<0?(l&&o.push(l),l=[t[h]]):l.push(t[h]))}if(l&&o.push(l),e>1)for(let h=0;h<o.length;h++)o[h].length<=e||(ix(o[h],e,1,o[h].length-1,hL),o[h]=o[h].slice(0,e));return o}function hL(t,e){return e.area-t.area}function a1(t,e,n){let o=n.patternDependencies,l=!1;for(let u of e){let h=u.paint.get(`${t}-pattern`);h.isConstant()||(l=!0);let g=h.constantOr(null);g&&(l=!0,o[g]=!0)}return l}function l1(t,e,n,o,l){let u=l.patternDependencies;for(let h of e){let g=h.paint.get(`${t}-pattern`).value;if(g.kind!=="constant"){let y=g.evaluate({zoom:o},n,{},l.availableImages);y=y&&y.name?y.name:y,u[y]=!0,n.patterns[h.id]=y}}return n}class L_{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new jo,this.indexArray=new Ir,this.indexArray2=new Pl,this.programConfigurations=new Ol(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Jn,this.segments2=new Jn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}updateFootprints(e,n){}populate(e,n,o,l){this.hasPattern=a1("fill",this.layers,n);let u=this.layers[0].layout.get("fill-sort-key"),h=[];for(let{feature:g,id:y,index:b,sourceLayerIndex:T}of e){let I=this.layers[0]._featureFilter.needGeometry,D=xa(g,I);if(!this.layers[0]._featureFilter.filter(new Lt(this.zoom),D,o))continue;let P=u?u.evaluate(D,{},o,n.availableImages):void 0,R={id:y,properties:g.properties,type:g.type,sourceLayerIndex:T,index:b,geometry:I?D.geometry:$o(g,o,l),patterns:{},sortKey:P};h.push(R)}u&&h.sort((g,y)=>g.sortKey-y.sortKey);for(let g of h){let{geometry:y,index:b,sourceLayerIndex:T}=g;if(this.hasPattern){let I=l1("fill",this.layers,g,this.zoom,n);this.patternFeatures.push(I)}else this.addFeature(g,y,b,o,{},n.availableImages,n.brightness);n.featureIndex.insert(e[b].feature,y,b,T,this.index)}}update(e,n,o,l,u){let h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,h?this.stateDependentLayers:this.layers,o,l,u)}addFeatures(e,n,o,l,u,h){for(let g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,n,o,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tL),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,l,u,h=[],g){for(let y of k_(n,500)){let b=0;for(let L of y)b+=L.length;let T=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),I=T.vertexLength,D=[],P=[];for(let L of y){if(L.length===0)continue;L!==y[0]&&P.push(D.length/2);let N=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),j=N.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(j+L.length-1,j),D.push(L[0].x),D.push(L[0].y);for(let Y=1;Y<L.length;Y++)this.layoutVertexArray.emplaceBack(L[Y].x,L[Y].y),this.indexArray2.emplaceBack(j+Y-1,j+Y),D.push(L[Y].x),D.push(L[Y].y);N.vertexLength+=L.length,N.primitiveLength+=L.length}let R=Lp(D,P);for(let L=0;L<R.length;L+=3)this.indexArray.emplaceBack(I+R[L],I+R[L+1],I+R[L+2]);T.vertexLength+=b,T.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,h,l,g)}}Q(L_,"FillBucket",{omit:["layers","patternFeatures"]});let dL=new Cn({"fill-sort-key":new ut(Te.layout_fill["fill-sort-key"]),visibility:new Fe(Te.layout_fill.visibility)});var fL={paint:new Cn({"fill-antialias":new Fe(Te.paint_fill["fill-antialias"]),"fill-opacity":new ut(Te.paint_fill["fill-opacity"]),"fill-color":new ut(Te.paint_fill["fill-color"]),"fill-outline-color":new ut(Te.paint_fill["fill-outline-color"]),"fill-translate":new Fe(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new Fe(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new ut(Te.paint_fill["fill-pattern"]),"fill-emissive-strength":new Fe(Te.paint_fill["fill-emissive-strength"])}),layout:dL};class c1{constructor(e,n,o,l){if(this.triangleCount=n.length/3,this.min=new at(0,0),this.max=new at(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[u,h]=[e[0].clone(),e[0].clone()];for(let I=1;I<e.length;++I){let D=e[I];u.x=Math.min(u.x,D.x),u.y=Math.min(u.y,D.y),h.x=Math.max(h.x,D.x),h.y=Math.max(h.y,D.y)}if(l){let I=Math.ceil(Math.max(h.x-u.x,h.y-u.y)/l);o=Math.max(o,I)}if(o===0)return;this.min=u,this.max=h;let g=this.max.sub(this.min);g.x=Math.max(g.x,1),g.y=Math.max(g.y,1);let y=Math.max(g.x,g.y)/o;this.cellsX=Math.max(1,Math.ceil(g.x/y)),this.cellsY=Math.max(1,Math.ceil(g.y/y)),this.xScale=1/y,this.yScale=1/y;let b=[];for(let I=0;I<this.triangleCount;I++){let D=e[n[3*I+0]].sub(this.min),P=e[n[3*I+1]].sub(this.min),R=e[n[3*I+2]].sub(this.min),L=Ds(Math.floor(Math.min(D.x,P.x,R.x)),this.xScale,this.cellsX),N=Ds(Math.floor(Math.max(D.x,P.x,R.x)),this.xScale,this.cellsX),j=Ds(Math.floor(Math.min(D.y,P.y,R.y)),this.yScale,this.cellsY),Y=Ds(Math.floor(Math.max(D.y,P.y,R.y)),this.yScale,this.cellsY),X=new at(0,0),K=new at(0,0),ae=new at(0,0),oe=new at(0,0);for(let fe=j;fe<=Y;++fe){X.y=K.y=fe*y,ae.y=oe.y=(fe+1)*y;for(let me=L;me<=N;++me)X.x=ae.x=me*y,K.x=oe.x=(me+1)*y,(Yx(D,P,R,X,K,oe)||Yx(D,P,R,X,oe,ae))&&b.push({cellIdx:fe*this.cellsX+me,triIdx:I})}}if(b.length===0)return;b.sort((I,D)=>I.cellIdx-D.cellIdx||I.triIdx-D.triIdx);let T=0;for(;T<b.length;){let I=b[T].cellIdx,D={start:this.payload.length,len:0};for(;T<b.length&&b[T].cellIdx===I;)++D.len,this.payload.push(b[T++].triIdx);this.cells[I]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let o=Ds(e.x-this.min.x,this.xScale,this.cellsX),l=Ds(e.y-this.min.y,this.yScale,this.cellsY),u=this.cells[l*this.cellsX+o];if(u){this._lazyInitLookup();for(let h=0;h<u.len;h++){let g=this.payload[u.start+h],y=Math.floor(g/8),b=1<<g%8;if(!(this.lookup[y]&b)&&(this.lookup[y]|=b,n.push(g),n.length===this.triangleCount))return}}}query(e,n,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();let l=Ds(e.x-this.min.x,this.xScale,this.cellsX),u=Ds(n.x-this.min.x,this.xScale,this.cellsX),h=Ds(e.y-this.min.y,this.yScale,this.cellsY),g=Ds(n.y-this.min.y,this.yScale,this.cellsY);for(let y=h;y<=g;y++)for(let b=l;b<=u;b++){let T=this.cells[y*this.cellsX+b];if(T)for(let I=0;I<T.len;I++){let D=this.payload[T.start+I],P=Math.floor(D/8),R=1<<D%8;if(!(this.lookup[P]&R)&&(this.lookup[P]|=R,o.push(D),o.length===this.triangleCount))return}}}}function Ds(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}Q(c1,"TriangleGridIndex");class NI{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(e,n){for(let o of this.footprints)n.push({footprint:o,id:e})}populate(e,n,o,l){let u=[];for(let{feature:h,id:g,index:y,sourceLayerIndex:b}of e){let T=this.layers[0]._featureFilter.needGeometry,I=xa(h,T);if(!this.layers[0]._featureFilter.filter(new Lt(this.zoom),I,o))continue;let D={id:g,properties:h.properties,type:h.type,sourceLayerIndex:b,index:y,geometry:T?I.geometry:$o(h,o,l),patterns:{}};u.push(D)}for(let h of u){let{geometry:g,index:y,sourceLayerIndex:b}=h;this.addFeature(h,g,y,o,{},n.availableImages,n.brightness),n.featureIndex.insert(e[y].feature,g,y,b,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,o,l,u){}destroy(){}addFeature(e,n,o,l,u,h=[],g){for(let y of k_(n,2)){let b=[],T=[],I=[],D=new at(1/0,1/0),P=new at(-1/0,-1/0);for(let N of y)if(N.length!==0){N!==y[0]&&I.push(T.length/2);for(let j=0;j<N.length;j++)T.push(N[j].x),T.push(N[j].y),b.push(N[j]),D.x=Math.min(D.x,N[j].x),D.y=Math.min(D.y,N[j].y),P.x=Math.max(P.x,N[j].x),P.y=Math.max(P.y,N[j].y)}let R=Lp(T,I),L=new c1(b,R,8,256);this.footprints.push({vertices:b,indices:R,grid:L,min:D,max:P})}}}Q(NI,"ClipBucket",{omit:["layers"]});let pL=new Cn({"clip-layer-types":new Fe(Te.layout_clip["clip-layer-types"])});var mL={paint:new Cn({}),layout:pL};let gL=wn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),_L=wn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),yL=wn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),vL=wn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),xL=wn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:bL}=gL;var F_={},wL=ph,zI=ad;function ad(t,e,n,o,l){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=o,this._values=l,t.readFields(TL,this,e)}function TL(t,e,n){t==1?e.id=n.readVarint():t==2?function(o,l){for(var u=o.readVarint()+o.pos;o.pos<u;){var h=l._keys[o.readVarint()],g=l._values[o.readVarint()];l.properties[h]=g}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function EL(t){for(var e,n,o=0,l=0,u=t.length,h=u-1;l<u;h=l++)o+=((n=t[h]).x-(e=t[l]).x)*(e.y+n.y);return o}ad.types=["Unknown","Point","LineString","Polygon"],ad.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,o=1,l=0,u=0,h=0,g=[];t.pos<n;){if(l<=0){var y=t.readVarint();o=7&y,l=y>>3}if(l--,o===1||o===2)u+=t.readSVarint(),h+=t.readSVarint(),o===1&&(e&&g.push(e),e=[]),e.push(new wL(u,h));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&g.push(e),g},ad.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,o=0,l=0,u=0,h=1/0,g=-1/0,y=1/0,b=-1/0;t.pos<e;){if(o<=0){var T=t.readVarint();n=7&T,o=T>>3}if(o--,n===1||n===2)(l+=t.readSVarint())<h&&(h=l),l>g&&(g=l),(u+=t.readSVarint())<y&&(y=u),u>b&&(b=u);else if(n!==7)throw new Error("unknown command "+n)}return[h,y,g,b]},ad.prototype.toGeoJSON=function(t,e,n){var o,l,u=this.extent*Math.pow(2,n),h=this.extent*t,g=this.extent*e,y=this.loadGeometry(),b=ad.types[this.type];function T(P){for(var R=0;R<P.length;R++){var L=P[R];P[R]=[360*(L.x+h)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(L.y+g)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(o=0;o<y.length;o++)I[o]=y[o][0];T(y=I);break;case 2:for(o=0;o<y.length;o++)T(y[o]);break;case 3:for(y=function(P){var R=P.length;if(R<=1)return[P];for(var L,N,j=[],Y=0;Y<R;Y++){var X=EL(P[Y]);X!==0&&(N===void 0&&(N=X<0),N===X<0?(L&&j.push(L),L=[P[Y]]):L.push(P[Y]))}return L&&j.push(L),j}(y),o=0;o<y.length;o++)for(l=0;l<y[o].length;l++)T(y[o][l])}y.length===1?y=y[0]:b="Multi"+b;var D={type:"Feature",geometry:{type:b,coordinates:y},properties:this.properties};return"id"in this&&(D.id=this.id),D};var IL=zI,BI=VI;function VI(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(CL,this,e),this.length=this._features.length}function CL(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(o){for(var l=null,u=o.readVarint()+o.pos;o.pos<u;){var h=o.readVarint()>>3;l=h===1?o.readString():h===2?o.readFloat():h===3?o.readDouble():h===4?o.readVarint64():h===5?o.readVarint():h===6?o.readSVarint():h===7?o.readBoolean():null}return l}(n))}VI.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new IL(this._pbf,e,this.extent,this._keys,this._values)};var DL=BI;function SL(t,e,n){if(t===3){var o=new DL(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}var u1=F_.VectorTile=function(t,e){this.layers=t.readFields(SL,{},e)},N_=F_.VectorTileFeature=zI;F_.VectorTileLayer=BI;class pu extends at{constructor(e,n,o){super(e,n),this.z=o}}class jI extends pu{constructor(e,n,o,l){super(e,n,o),this.w=l}}function z_(t,e,n,o){let l=[],u=o===0?(h,g,y,b,T,I)=>{h.push(new at(I,y+(I-g)/(b-g)*(T-y)))}:(h,g,y,b,T,I)=>{h.push(new at(g+(I-y)/(T-y)*(b-g),I))};for(let h of t){let g=[];for(let y of h){if(y.length<=2)continue;let b=[];for(let D=0;D<y.length-1;D++){let P=y[D].x,R=y[D].y,L=y[D+1].x,N=y[D+1].y,j=o===0?P:R,Y=o===0?L:N;j<e?Y>e&&u(b,P,R,L,N,e):j>n?Y<n&&u(b,P,R,L,N,n):b.push(y[D]),Y<e&&j>=e&&u(b,P,R,L,N,e),Y>n&&j<=n&&u(b,P,R,L,N,n)}let T=y[y.length-1],I=o===0?T.x:T.y;I>=e&&I<=n&&b.push(T),b.length&&(T=b[b.length-1],b[0].x===T.x&&b[0].y===T.y||b.push(b[0]),g.push(b))}g.length&&l.push(g)}return l}function UI(t,e,n,o){let l=n==="x"?"y":"x",u=(o-t[n])/(e[n]-t[n]);t[l]=t[l]+(e[l]-t[l])*u,t[n]=o,t.hasOwnProperty("z")&&(t.z=bt(t.z,e.z,u)),t.hasOwnProperty("w")&&(t.w=bt(t.w,e.w,u))}function $I(t,e,n,o){let l=n,u=o;for(let h of["x","y"]){let g=t,y=e;g[h]>=y[h]&&(g=e,y=t),g[h]<l&&y[h]>l&&UI(g,y,h,l),g[h]<u&&y[h]>u&&UI(y,g,h,u)}}function B_(t,e){return t.x-e.x||t.y-e.y}function GI(t,e){return B_(t.min,e.min)===0&&B_(t.max,e.max)===0}function h1(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function d1(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n].sourceId!==e[n].sourceId||!GI(t[n],e[n])||t[n].order!==e[n].order||t[n].clipMask!==e[n].clipMask)return!1;return!0}function HI(t,e,n){let o=1/rt,l=1/(1<<n.canonical.z),u=(e.x*o+n.canonical.x)*l+n.wrap,h=(e.y*o+n.canonical.y)*l;return{min:new at((t.x*o+n.canonical.x)*l+n.wrap,(t.y*o+n.canonical.y)*l),max:new at(u,h)}}function ML(t,e,n){let o=1<<n.canonical.z,l=((e.x-n.wrap)*o-n.canonical.x)*rt,u=(e.y*o-n.canonical.y)*rt;return{min:new at(((t.x-n.wrap)*o-n.canonical.x)*rt,(t.y*o-n.canonical.y)*rt),max:new at(l,u)}}function qI(t,e,n,o,l,u,h){let g=t.indices,y=t.vertices,b=[];for(let T=o;T<o+l;T+=3){let I=e[n[T+0]+u],D=e[n[T+1]+u],P=e[n[T+2]+u],R=Math.min(I.x,D.x,P.x),L=Math.max(I.x,D.x,P.x),N=Math.min(I.y,D.y,P.y),j=Math.max(I.y,D.y,P.y);b.length=0,t.grid.query(new at(R,N),new at(L,j),b);for(let Y=0;Y<b.length;Y++){let X=b[Y];if(Yx(y[g[3*X+0]],y[g[3*X+1]],y[g[3*X+2]],I,D,P,h))return!0}}return!1}function WI(t,e,n,o){if(!t||!n)return!1;let l=t.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(n.vertices.length<t.vertices.length)return WI(n,o,t,e);let u=e.canonical,h=o.canonical,g=Math.pow(2,h.z-u.z);l=t.vertices.map(y=>new at((y.x+u.x*rt)*g-h.x*rt,(y.y+u.y*rt)*g-h.y*rt))}return qI(n,l,t.indices,0,t.indices.length,0,0)}function ZI(t,e,n,o){let l=Math.pow(2,o.z-n.z);return new at((t+n.x*rt)*l-o.x*rt,(e+n.y*rt)*l-o.y*rt)}function YI(t,e){let n=[];e.footprint.grid.queryPoint(t,n);let o=e.footprint.indices,l=e.footprint.vertices;for(let u=0;u<n.length;u++){let h=n[u];if(Ll([l[o[3*h+0]],l[o[3*h+1]],l[o[3*h+2]]],t))return!0}return!1}class XI{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let o=this.toIdx(e,n);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function KI(t,e,n,o){let l=0,u=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(o[h])<1e-15){if(n[h]<t[h]||n[h]>e[h])return null}else{let g=1/o[h],y=(t[h]-n[h])*g,b=(e[h]-n[h])*g;if(y>b){let T=y;y=b,b=T}if(y>l&&(l=y),b<u&&(u=b),l>u)return null}return l}function QI(t,e,n,o,l,u,h,g,y,b,T){let I=o-t,D=l-e,P=u-n,R=h-t,L=g-e,N=y-n,j=T[1]*N-T[2]*L,Y=T[2]*R-T[0]*N,X=T[0]*L-T[1]*R,K=I*j+D*Y+P*X;if(Math.abs(K)<1e-15)return null;let ae=1/K,oe=b[0]-t,fe=b[1]-e,me=b[2]-n,we=(oe*j+fe*Y+me*X)*ae;if(we<0||we>1)return null;let Pe=fe*P-me*D,Ce=me*I-oe*P,Le=oe*D-fe*I,Ye=(T[0]*Pe+T[1]*Ce+T[2]*Le)*ae;return Ye<0||we+Ye>1?null:(R*Pe+L*Ce+N*Le)*ae}function JI(t,e,n){return(t-e)/(n-e)}function eC(t,e,n,o,l,u,h,g,y){let b=1<<n,T=u-o,I=h-l,D=(t+1)/b*T+o,P=(e+0)/b*I+l,R=(e+1)/b*I+l;g[0]=(t+0)/b*T+o,g[1]=P,y[0]=D,y[1]=R}class tC{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(u){let h=Math.ceil(Math.log2(u.dim/8)),g=[],y=Math.ceil(Math.pow(2,h)),b=1/y,T=(P,R,L,N,j)=>{let Y=N?1:0,X=(P+1)*L-Y,K=R*L,ae=(R+1)*L-Y;j[0]=P*L,j[1]=K,j[2]=X,j[3]=ae},I=new XI(y),D=[];for(let P=0;P<y*y;P++){T(P%y,Math.floor(P/y),b,!1,D);let R=Nl(D[0],D[1],u),L=Nl(D[2],D[1],u),N=Nl(D[2],D[3],u),j=Nl(D[0],D[3],u);I.minimums.push(Math.min(R,L,N,j)),I.maximums.push(Math.max(R,L,N,j)),I.leaves.push(1)}for(g.push(I),y/=2;y>=1;y/=2){let P=g[g.length-1];I=new XI(y);for(let R=0;R<y*y;R++){T(R%y,Math.floor(R/y),2,!0,D);let L=P.getElevation(D[0],D[1]),N=P.getElevation(D[2],D[1]),j=P.getElevation(D[2],D[3]),Y=P.getElevation(D[0],D[3]),X=P.isLeaf(D[0],D[1]),K=P.isLeaf(D[2],D[1]),ae=P.isLeaf(D[2],D[3]),oe=P.isLeaf(D[0],D[3]),fe=Math.min(L.min,N.min,j.min,Y.min),me=Math.max(L.max,N.max,j.max,Y.max),we=X&&K&&ae&&oe;I.maximums.push(me),I.minimums.push(fe),I.leaves.push(me-fe<=5&&we?1:0)}g.push(I)}return g}(this.dem),o=n.length-1,l=n[o];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(n,0,0,o,0)}raycastRoot(e,n,o,l,u,h,g=1){return KI([e,n,-100],[o,l,this.maximums[0]*g],u,h)}raycast(e,n,o,l,u,h,g=1){if(!this.nodeCount)return null;let y=this.raycastRoot(e,n,o,l,u,h,g);if(y==null)return null;let b=[],T=[],I=[],D=[],P=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;P.length>0;){let{idx:R,t:L,nodex:N,nodey:j,depth:Y}=P.pop();if(this.leaves[R]){eC(N,j,Y,e,n,o,l,I,D);let K=1<<Y,ae=(N+0)/K,oe=(N+1)/K,fe=(j+0)/K,me=(j+1)/K,we=Nl(ae,fe,this.dem)*g,Pe=Nl(oe,fe,this.dem)*g,Ce=Nl(oe,me,this.dem)*g,Le=Nl(ae,me,this.dem)*g,Ye=QI(I[0],I[1],we,D[0],I[1],Pe,D[0],D[1],Ce,u,h),Oe=QI(D[0],D[1],Ce,I[0],D[1],Le,I[0],I[1],we,u,h),He=Math.min(Ye!==null?Ye:Number.MAX_VALUE,Oe!==null?Oe:Number.MAX_VALUE);if(He!==Number.MAX_VALUE)return He;{let Re=r._.scaleAndAdd([],u,h,L);if(nC(we,Pe,Le,Ce,JI(Re[0],I[0],D[0]),JI(Re[1],I[1],D[1]))>=Re[2])return L}continue}let X=0;for(let K=0;K<this._siblingOffset.length;K++){eC((N<<1)+this._siblingOffset[K][0],(j<<1)+this._siblingOffset[K][1],Y+1,e,n,o,l,I,D),I[2]=-100,D[2]=this.maximums[this.childOffsets[R]+K]*g;let ae=KI(I,D,u,h);if(ae!=null){let oe=ae;b[K]=oe;let fe=!1;for(let me=0;me<X&&!fe;me++)oe>=b[T[me]]&&(T.splice(me,0,K),fe=!0);fe||(T[X]=K),X++}}for(let K=0;K<X;K++){let ae=T[K];P.push({idx:this.childOffsets[R]+ae,t:b[ae],nodex:(N<<1)+this._siblingOffset[ae][0],nodey:(j<<1)+this._siblingOffset[ae][1],depth:Y+1})}}return null}_addNode(e,n,o){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,o,l,u){if(e[l].isLeaf(n,o)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);let h=l-1,g=e[h],y=0,b=0;for(let T=0;T<this._siblingOffset.length;T++){let I=2*n+this._siblingOffset[T][0],D=2*o+this._siblingOffset[T][1],P=g.getElevation(I,D),R=g.isLeaf(I,D),L=this._addNode(P.min,P.max,R);R&&(y|=1<<T),b||(b=L)}for(let T=0;T<this._siblingOffset.length;T++)y&1<<T||this._construct(e,2*n+this._siblingOffset[T][0],2*o+this._siblingOffset[T][1],h,b+T)}}function nC(t,e,n,o,l,u){return bt(bt(t,n,u),bt(e,o,u),l)}function Nl(t,e,n){let o=n.dim,l=Ht(t*o-.5,0,o-1),u=Ht(e*o-.5,0,o-1),h=Math.floor(l),g=Math.floor(u),y=Math.min(h+1,o-1),b=Math.min(g+1,o-1);return nC(n.get(h,g),n.get(y,g),n.get(h,b),n.get(y,b),l-h,u-g)}let AL={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function PL(t,e,n){return(256*t*256+256*e+n)/10-1e4}function RL(t,e,n){return 256*t+e+n/256-32768}class V_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,o,l=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return cr(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let u=this.dim=n.height-2,h=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=l,this._modifiedForSources={},!l){for(let y=0;y<u;y++)h[this._idx(-1,y)]=h[this._idx(0,y)],h[this._idx(u,y)]=h[this._idx(u-1,y)],h[this._idx(y,-1)]=h[this._idx(y,0)],h[this._idx(y,u)]=h[this._idx(y,u-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(u,-1)]=h[this._idx(u-1,0)],h[this._idx(-1,u)]=h[this._idx(0,u-1)],h[this._idx(u,u)]=h[this._idx(u-1,u-1)]}let g=o==="terrarium"?RL:PL;for(let y=0;y<h.length;++y){let b=4*y;this.floatView[y]=g(this.pixels[b],this.pixels[b+1],this.pixels[b+2])}this._timestamp=Rr.now()}_buildQuadTree(){this._tree=new tC(this)}get(e,n,o=!1){o&&(e=Ht(e,-1,this.dim),n=Ht(n,-1,this.dim));let l=this._idx(e,n);return this.floatView[l]}set(e,n,o){let l=this._idx(e,n),u=this.floatView[l];return this.floatView[l]=o,o-u}static getUnpackVector(e){return AL[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let o=[0,0,0,0],l=V_.getUnpackVector(n),u=Math.floor((e+l[3])/l[2]);return o[2]=u%256,u=Math.floor(u/256),o[1]=u%256,u=Math.floor(u/256),o[0]=u,o}getPixels(){return new RI({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=n*this.dim,u=n*this.dim+this.dim,h=o*this.dim,g=o*this.dim+this.dim;switch(n){case-1:l=u-1;break;case 1:u=l+1}switch(o){case-1:h=g-1;break;case 1:g=h+1}let y=-n*this.dim,b=-o*this.dim;for(let T=h;T<g;T++)for(let I=l;I<u;I++){let D=4*this._idx(I,T),P=4*this._idx(I+y,T+b);this.pixels[D+0]=e.pixels[P+0],this.pixels[D+1]=e.pixels[P+1],this.pixels[D+2]=e.pixels[P+2],this.pixels[D+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Q(V_,"DEMData"),Q(tC,"DemMinMaxQuadTree",{omit:["dem"]});class ld{constructor(e,n,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=o}static create(e,n,o){let l=o||e.findDEMTileFor(n);if(!l||!l.dem)return;let u=l.dem,h=l.tileID,g=1<<n.canonical.z-h.canonical.z;return new ld(l,u.dim/rt/g,[(n.canonical.x/g-h.canonical.x)*u.dim,(n.canonical.y/g-h.canonical.y)*u.dim])}tileCoordToPixel(e,n){let o=n*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(o);return new at(l,u)}getElevationAt(e,n,o,l){let u=e*this._scale+this._offset[0],h=n*this._scale+this._offset[1],g=Math.floor(u),y=Math.floor(h),b=this._dem;return l=!!l,o?bt(bt(b.get(g,y,l),b.get(g,y+1,l),h-y),bt(b.get(g+1,y,l),b.get(g+1,y+1,l),h-y),u-g):b.get(g,y,l)}getElevationAtPixel(e,n,o){return this._dem.get(e,n,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*wi(1,e)*this._dem.stride}}let rC={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},OL=N_.types,kL=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],LL=["fill-extrusion-flood-light-ground-radius"],FL=Math.pow(2,13),NL=Math.pow(2,15)-1,iC=new at(0,1),zl=2147483648;function Bp(t,e,n,o,l,u,h,g){t.emplaceBack((e<<1)+h,(n<<1)+u,(Math.floor(o*FL)<<1)+l,Math.round(g))}function j_(t,e,n,o,l,u){t.emplaceBack(e.x,e.y,(n.x<<1)+o,(n.y<<1)+l,u)}function Vp(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class oC{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class sC{constructor(){this.centroidXY=new at(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new at(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new at(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new at(this.max.x-this.min.x,this.max.y-this.min.y)}}class aC{constructor(){this.acc=new at(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,o){this.accCount++,this.acc._add(n);let l=!!this.borders;n.x<e.min.x?(e.min.x=n.x,l=!0):n.x>e.max.x&&(e.max.x=n.x,l=!0),n.y<e.min.y?(e.min.y=n.y,l=!0):n.y>e.max.y&&(e.max.y=n.y,l=!0),((n.x===0||n.x===rt)&&n.x===o.x)!=((n.y===0||n.y===rt)&&n.y===o.y)&&this.processBorderOverlap(n,o),l&&this.checkBorderIntersection(n,o)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,bt(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>rt!=e.x>rt&&this.addBorderIntersection(1,bt(n.y,e.y,(rt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,bt(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>rt!=e.y>rt&&this.addBorderIntersection(3,bt(n.x,e.x,(rt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let o=this.borders[e];n<o[0]&&(o[0]=n),n>o[1]&&(o[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let o=e.x===0?0:1;this.addBorderIntersection(o,n.y),this.addBorderIntersection(o,e.y)}else{let o=e.y===0?2:3;this.addBorderIntersection(o,n.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new at(0,0):new at(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function lC(t,e){let n=t.add(e)._unit(),o=Ht(t.x*n.x+t.y*n.y,-1,1);var l,u,h;return l=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(l)))/4*NL*((u=t).x*(h=e).y-u.y*h.x<0?-1:1)}let zL=[t=>t.x<0,t=>t.x>rt,t=>t.y<0,t=>t.y>rt];function BL(t,e,n,o){let l=[4];if(o===0)return l;n._mult(o);let u=t.sub(n),h=e.sub(n),g=[t,e,u,h];for(let y=0;y<4;y++)for(let b of g)if(zL[y](b)){l.push(y);break}return l}class cC{constructor(e){this.vertexArray=new _x,this.indexArray=new Ir,this.programConfigurations=new Ol(e.layers,{zoom:e.zoom,lut:e.lut},n=>LL.includes(n)),this._segments=new Jn,this.hiddenByLandmarkVertexArray=new Px,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Jn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,o,l=!1){let u=e.length;if(u>2){let h=Math.max(0,this._segments.get().length-1),g=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[h].length),y;h!==this._segments.get().length-1&&(h++,this._segmentToGroundQuads[h]=[],this._segmentToRegionTriCounts[h]=[0,0,0,0,0]);{let b=e[0],T=e[1];y=lC(b.sub(e[u-1])._perp()._unit(),T.sub(b)._perp()._unit())}for(let b=0;b<u;b++){let T=b===u-1?0:b+1,I=e[b],D=e[T],P=e[T===u-1?0:T+1],R=D.sub(I)._perp()._unit(),L=lC(R,P.sub(D)._perp()._unit()),N=y,j=L;if(f1(I,D,n)||l&&dC(I,n)&&dC(D,n)){y=L;continue}let Y=g.vertexLength;j_(this.vertexArray,I,D,1,1,N),j_(this.vertexArray,I,D,1,0,N),j_(this.vertexArray,I,D,0,1,j),j_(this.vertexArray,I,D,0,0,j),g.vertexLength+=4;let X=BL(I,D,R,o);for(let K of X)this._segmentToGroundQuads[h].push({id:Y,region:K}),this._segmentToRegionTriCounts[h][K]+=2,g.primitiveLength+=2;y=L}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let o=0;o<n;o++)this._segmentToGroundQuads[o].sort((l,u)=>l.region-u.region);for(let o=0;o<n;o++){let l=this._segmentToGroundQuads[o],u=e[o],h=this._segmentToRegionTriCounts[o];h.reduce((y,b)=>y+b,0);let g=0;for(let y=0;y<=4;y++){let b=h[y];if(b!==0){let T=this.regionSegments[y];T||(T=this.regionSegments[y]=new Jn);let I={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+g,vertexLength:u.vertexLength,primitiveLength:b};T.get().push(I)}g+=b}for(let y=0;y<l.length;y++){let b=l[y].id;this.indexArray.emplaceBack(b,b+1,b+3),this.indexArray.emplaceBack(b,b+3,b+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,o,l,u,h){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,o,l,u,h)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,_L.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,o,l,u,h){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,o,l,u,h)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let o=e.flags&zl?1:0;for(let l=e.groundVertexArrayOffset;l<n;++l)this.hiddenByLandmarkVertexArray.emplace(l,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,vL.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class U_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ir,this.footprintVertices=new jo,this.footprintSegments=[],this.layoutVertexArray=new Dl,this.centroidVertexArray=new ZE,this.indexArray=new Ir,this.programConfigurations=new Ol(e.layers,{zoom:e.zoom,lut:e.lut},n=>kL.includes(n)),this.segments=new Jn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new cC(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,n){}populate(e,n,o,l){this.features=[],this.hasPattern=a1("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=T_(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:u,id:h,index:g,sourceLayerIndex:y}of e){let b=this.layers[0]._featureFilter.needGeometry,T=xa(u,b);if(!this.layers[0]._featureFilter.filter(new Lt(this.zoom),T,o))continue;let I={id:h,sourceLayerIndex:y,index:g,geometry:b?T.geometry:$o(u,o,l),properties:u.properties,type:u.type,patterns:{}},D=this.layoutVertexArray.length;this.hasPattern?this.features.push(l1("fill-extrusion",this.layers,I,this.zoom,n)):this.addFeature(I,I.geometry,g,o,{},n.availableImages,l,n.brightness),n.featureIndex.insert(u,I.geometry,g,y,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,o,l,u,h){for(let g of this.features){let{geometry:y}=g;this.addFeature(g,y,g.index,n,o,l,u,h)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,o,l,u){let h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;let g=h?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,g,o,l,u),this.groundEffect.update(e,n,g,o,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bL),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,xL.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,yL.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,l,u,h,g,y){let b=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,T=[new at(0,0),new at(rt,rt)],I=g.projection,D=I.name==="globe",P=OL[e.type]==="Polygon",R=new aC;R.centroidDataIndex=this.centroidData.length;let L=new sC,N=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},l)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},l);L.height=j,L.vertexArrayOffset=this.layoutVertexArray.length,L.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new y_);let Y=k_(n,500);for(let me=Y.length-1;me>=0;me--){let we=Y[me];(we.length===0||(X=we[0]).every(Pe=>Pe.x<=0)||X.every(Pe=>Pe.x>=rt)||X.every(Pe=>Pe.y<=0)||X.every(Pe=>Pe.y>=rt))&&Y.splice(me,1)}var X;let K;if(D)K=gC(Y,T,l);else{K=[];for(let me of Y)K.push({polygon:me,bounds:T})}let ae=P?this.edgeRadius:0,oe=ae>0&&this.zoom<17,fe=(me,we)=>{if(me.length===0)return!1;let Pe=me[me.length-1];return we.x===Pe.x&&we.y===Pe.y};for(let{polygon:me,bounds:we}of K){let Pe=0,Ce=0;for(let He of me)P&&!He[0].equals(He[He.length-1])&&He.push(He[0]),Ce+=P?He.length-1:He.length;let Le=this.segments.prepareSegment((P?5:4)*Ce,this.layoutVertexArray,this.indexArray);L.footprintSegIdx<0&&(L.footprintSegIdx=this.footprintSegments.length),L.polygonSegIdx<0&&(L.polygonSegIdx=this.polygonSegments.length);let Ye={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Oe=new oC;if(Oe.vertexOffset=this.footprintVertices.length,Oe.indexOffset=3*this.footprintIndices.length,Oe.ringIndices=[],P){let He=[],Re=[];Pe=Le.vertexLength;for(let Qe=0;Qe<me.length;Qe++){let Ze=me[Qe];Ze.length&&Qe!==0&&Re.push(He.length/2);let ht=[],Xe,tt;Xe=Ze[1].sub(Ze[0])._perp()._unit(),Oe.ringIndices.push(Ze.length-1);for(let vt=1;vt<Ze.length;vt++){let yt=Ze[vt],mt=Ze[vt===Ze.length-1?1:vt+1],et=yt.clone();if(ae){tt=mt.sub(yt)._perp()._unit();let xt=Xe.add(tt)._unit(),Vt=ae*Math.min(4,1/(Xe.x*xt.x+Xe.y*xt.y));et.x+=Vt*xt.x,et.y+=Vt*xt.y,et.x=Math.round(et.x),et.y=Math.round(et.y),Xe=tt}!N||ae!==0&&!oe||fe(ht,et)||ht.push(et),Bp(this.layoutVertexArray,et.x,et.y,0,0,1,1,0),Le.vertexLength++,this.footprintVertices.emplaceBack(yt.x,yt.y),He.push(yt.x,yt.y),D&&Vp(this.layoutVertexExtArray,I.projectTilePoint(et.x,et.y,l),I.upVector(l,et.x,et.y))}N&&(ae===0||oe)&&(ht.length!==0&&fe(ht,ht[0])&&ht.pop(),this.groundEffect.addData(ht,we,b))}let qe=Lp(He,Re);for(let Qe=0;Qe<qe.length;Qe+=3)this.footprintIndices.emplaceBack(Oe.vertexOffset+qe[Qe+0],Oe.vertexOffset+qe[Qe+1],Oe.vertexOffset+qe[Qe+2]),this.indexArray.emplaceBack(Pe+qe[Qe],Pe+qe[Qe+2],Pe+qe[Qe+1]),Le.primitiveLength++;Oe.indexCount+=qe.length,Oe.vertexCount+=this.footprintVertices.length-Oe.vertexOffset}for(let He=0;He<me.length;He++){let Re=me[He];R.startRing(L,Re[0]);let qe=Re.length>4&&fC(Re[Re.length-2],Re[0],Re[1]),Qe=ae?VL(Re[Re.length-2],Re[0],Re[1],ae):0,Ze=[],ht,Xe,tt;Xe=Re[1].sub(Re[0])._perp()._unit();let vt=!0;for(let yt=1,mt=0;yt<Re.length;yt++){let et=Re[yt-1],xt=Re[yt],Vt=Re[yt===Re.length-1?1:yt+1];if(R.appendEdge(L,xt,et),f1(xt,et,we)){ae&&(Xe=Vt.sub(xt)._perp()._unit(),vt=!vt);continue}let Dt=xt.sub(et)._perp(),$t=Dt.x/(Math.abs(Dt.x)+Math.abs(Dt.y)),jt=Dt.y>0?1:0,Yt=et.dist(xt);if(mt+Yt>32768&&(mt=0),ae){tt=Vt.sub(xt)._perp()._unit();let _n=hC(et,xt,Vt,uC(Xe,tt),ae);isNaN(_n)&&(_n=0);let rn=xt.sub(et)._unit();et=et.add(rn.mult(Qe))._round(),xt=xt.add(rn.mult(-_n))._round(),Qe=_n,Xe=tt,N&&this.zoom>=17&&(fe(Ze,et)||Ze.push(et),fe(Ze,xt)||Ze.push(xt))}let Et=Le.vertexLength,Rn=Re.length>4&&fC(et,xt,Vt),Pn=pC(mt,qe,vt);if(Bp(this.layoutVertexArray,et.x,et.y,$t,jt,0,0,Pn),Bp(this.layoutVertexArray,et.x,et.y,$t,jt,0,1,Pn),mt+=Yt,Pn=pC(mt,Rn,!vt),qe=Rn,Bp(this.layoutVertexArray,xt.x,xt.y,$t,jt,0,0,Pn),Bp(this.layoutVertexArray,xt.x,xt.y,$t,jt,0,1,Pn),Le.vertexLength+=4,this.indexArray.emplaceBack(Et+0,Et+1,Et+2),this.indexArray.emplaceBack(Et+1,Et+3,Et+2),Le.primitiveLength+=2,ae){let _n=Pe+(yt===1?Re.length-2:yt-2),rn=yt===1?Pe:_n+1;if(this.indexArray.emplaceBack(Et+1,_n,Et+3),this.indexArray.emplaceBack(_n,rn,Et+3),Le.primitiveLength+=2,ht===void 0&&(ht=Et),!f1(Vt,Re[yt],we)){let yn=yt===Re.length-1?ht:Le.vertexLength;this.indexArray.emplaceBack(Et+2,Et+3,yn),this.indexArray.emplaceBack(Et+3,yn+1,yn),this.indexArray.emplaceBack(Et+3,rn,yn+1),Le.primitiveLength+=3}vt=!vt}if(D){let _n=this.layoutVertexExtArray,rn=I.projectTilePoint(et.x,et.y,l),yn=I.projectTilePoint(xt.x,xt.y,l),jn=I.upVector(l,et.x,et.y),Ln=I.upVector(l,xt.x,xt.y);Vp(_n,rn,jn),Vp(_n,rn,jn),Vp(_n,yn,Ln),Vp(_n,yn,Ln)}}P&&(Pe+=Re.length-1),N&&ae&&this.zoom>=17&&(Ze.length!==0&&fe(Ze,Ze[0])&&Ze.pop(),this.groundEffect.addData(Ze,we,b,ae>0))}this.footprintSegments.push(Oe),Ye.triangleCount=this.indexArray.length-Ye.triangleArrayOffset,this.polygonSegments.push(Ye),++L.footprintSegLen,++L.polygonSegLen}if(L.vertexCount=this.layoutVertexArray.length-L.vertexArrayOffset,L.groundVertexCount=this.groundEffect.vertexArray.length-L.groundVertexArrayOffset,L.vertexCount!==0){if(L.centroidXY=R.borders?iC:this.encodeCentroid(R,L),this.centroidData.push(L),R.borders){this.featuresOnBorder.push(R);let me=this.featuresOnBorder.length-1;for(let we=0;we<R.borders.length;we++)R.borders[we][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[we].push(me)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,h,l,y),this.groundEffect.addPaintPropertiesData(e,o,u,h,l,y),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,o)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){let e=[];for(let g=0;g<this.centroidData.length;g++){let y=this.centroidData[g],b=+(y.min.y+y.max.y>rt),T=2*b+(+(y.min.x+y.max.x>rt)^b);for(let I=0;I<y.polygonSegLen;I++){let D=y.polygonSegIdx+I;e.push({centroidIdx:g,subtile:T,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}let n=new Ir;e.sort((g,y)=>g.triangleSegmentIdx===y.triangleSegmentIdx?g.subtile-y.subtile:g.triangleSegmentIdx-y.triangleSegmentIdx);let o=0,l=0,u=0;for(let g of e){if(g.triangleSegmentIdx!==o)break;u++}let h=e.length;for(;l!==e.length;){o=e[l].triangleSegmentIdx;let g=0,y=l,b=l;for(let T=y;T<u&&e[T].subtile===g;T++)b++;for(;y!==u;){let T=e[y];g=T.subtile;let I=this.centroidData[T.centroidIdx].min.clone(),D=this.centroidData[T.centroidIdx].max.clone(),P={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=y;R<b;R++){let L=e[R],N=this.polygonSegments[L.polygonSegmentIdx],j=this.centroidData[L.centroidIdx].min,Y=this.centroidData[L.centroidIdx].max,X=this.indexArray.uint16;for(let K=N.triangleArrayOffset;K<N.triangleArrayOffset+N.triangleCount;K++)n.emplaceBack(X[3*K],X[3*K+1],X[3*K+2]);P.primitiveLength+=N.triangleCount,I.x=Math.min(I.x,j.x),I.y=Math.min(I.y,j.y),D.x=Math.max(D.x,Y.x),D.y=Math.max(D.y,Y.y)}P.primitiveLength>0&&this.triangleSubSegments.push({segment:P,min:I,max:D}),y=b;for(let R=y;R<u&&e[R].subtile===e[y].subtile;R++)b++}l=u;for(let T=l;T<h&&e[T].triangleSegmentIdx===e[l].triangleSegmentIdx;T++)u++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,o){let l=0,u=0,h=1<<e.canonical.z;if(n){let L=n.getMinMaxForTile(e);L&&(l=L.min,u=L.max)}u+=this.maxHeight;let g=e.toUnwrapped(),y,b=[g.canonical.x/h+g.wrap,g.canonical.y/h],T=[(g.canonical.x+1)/h+g.wrap,(g.canonical.y+1)/h],I=new Jn,D=(L,N,j)=>[L[0]*(1-j[0])+N[0]*j[0],L[1]*(1-j[1])+N[1]*j[1]],P=[],R=[];for(let L of this.triangleSubSegments){P[0]=L.min.x/rt,P[1]=L.min.y/rt,R[0]=L.max.x/rt,R[1]=L.max.y/rt;let N=D(b,T,P),j=D(b,T,R);if(new er([N[0],N[1],l],[j[0],j[1],u]).intersectsPrecise(o)===0){y&&(I.segments.push(y),y=void 0);continue}let Y=L.segment;y&&y.vertexOffset!==Y.vertexOffset&&(I.segments.push(y),y=void 0),y?(y.vertexLength+=Y.vertexLength,y.primitiveLength+=Y.primitiveLength):y={vertexOffset:Y.vertexOffset,primitiveLength:Y.primitiveLength,vertexLength:Y.vertexLength,primitiveOffset:Y.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&I.segments.push(y),I}encodeCentroid(e,n){let o=e.centroid(),l=n.span(),u=Math.min(7,Math.round(l.x*this.tileToMeter/10)),h=Math.min(7,Math.round(l.y*this.tileToMeter/10));return new at(Ht(o.x,1,rt-1)<<3|u,Ht(o.y,1,rt-1)<<3|h)}encodeBorderCentroid(e){if(!e.borders)return new at(0,0);let n=e.borders,o=Number.MAX_VALUE;if(n[0][0]!==o||n[1][0]!==o){let l=n[0][0]!==o?0:1;return new at(6|(n[0][0]!==o?0:65528),(n[l][0]+n[l][1])/2<<3|6)}{let l=n[2][0]!==o?2:3;return new at((n[l][0]+n[l][1])/2<<3|6,6|(n[2][0]!==o?0:65528))}}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=zl,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,l=e.flags&zl?iC:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==l.y||u!==l.x){for(let h=n;h<o;++h)this.centroidVertexArray.emplace(h,l.x,l.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,o){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let l=n.getReplacementRegionsForTile(e.toUnwrapped());if(d1(this.activeReplacements,l))return;if(this.activeReplacements=l,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let h of this.centroidData)h.flags&=2147483647;let u=[];for(let h of this.activeReplacements){if(h.order<o)continue;let g=Math.pow(2,h.footprintTileId.canonical.z-e.canonical.z);for(let y of this.centroidData)if(!(y.flags&zl||h.min.x>y.max.x||y.min.x>h.max.x||h.min.y>y.max.y||y.min.y>h.max.y))for(let b=0;b<y.footprintSegLen;b++){let T=this.footprintSegments[y.footprintSegIdx+b];if(u.length=0,jL(this.footprintVertices,T.vertexOffset,T.vertexCount,h.footprintTileId.canonical,e.canonical,u),qI(h.footprint,u,this.footprintIndices.uint16,T.indexOffset,T.indexCount,-T.vertexOffset,-g)){y.flags|=zl;break}}}for(let h of this.centroidData)this.writeCentroidToBuffer(h);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,o){let l=!1;for(let u=0;u<o.footprintSegLen;u++){let h=this.footprintSegments[o.footprintSegIdx+u],g=0;for(let y of h.ringIndices){for(let b=g,T=y+g-1;b<y+g;T=b++){let I=this.footprintVertices.int16[2*(b+h.vertexOffset)+0],D=this.footprintVertices.int16[2*(b+h.vertexOffset)+1],P=this.footprintVertices.int16[2*(T+h.vertexOffset)+1];D>n!=P>n&&e<(this.footprintVertices.int16[2*(T+h.vertexOffset)+0]-I)*(n-D)/(P-D)+I&&(l=!l)}g=y}}return l}getHeightAtTileCoord(e,n){let o=Number.NEGATIVE_INFINITY,l=!0,u=4*(e+rt)*rt+(n+rt);if(this.partLookup.hasOwnProperty(u)){let h=this.partLookup[u];return h?{height:h.height,hidden:!!(h.flags&zl)}:void 0}for(let h of this.centroidData)e>h.max.x||h.min.x>e||n>h.max.y||h.min.y>n||this.footprintContainsPoint(e,n,h)&&h&&h.height>o&&(o=h.height,this.partLookup[u]=h,l=!!(h.flags&zl));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:l};this.partLookup[u]=void 0}}function uC(t,e){let n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function VL(t,e,n,o){let l=e.sub(t)._perp()._unit(),u=n.sub(e)._perp()._unit();return hC(t,e,n,uC(l,u),o)}function hC(t,e,n,o,l){let u=Math.sqrt(1-o*o);return Math.min(t.dist(e)/3,e.dist(n)/3,l*u/o)}function f1(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function dC(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function fC(t,e,n){if(t.x<0||t.x>=rt||e.x<0||e.x>=rt||n.x<0||n.x>=rt)return!1;let o=n.sub(e),l=o.perp(),u=t.sub(e);return(o.x*u.x+o.y*u.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(u.x*u.x+u.y*u.y))>-.866&&l.x*u.x+l.y*u.y<0}function pC(t,e,n){let o=e?2|t:-3&t;return n?1|o:-2&o}function mC(){let t=Math.PI/32,e=Math.tan(t),n=rd;return n*Math.sqrt(1+2*e*e)-n}function gC(t,e,n){let o=1<<n.z,l=Di(n.x/o),u=Di((n.x+1)/o),h=kr(n.y/o),g=kr((n.y+1)/o);return function(y,b,T,I,D=0,P){let R=[];if(!y.length||!T||!I)return R;let L=(oe,fe)=>{for(let me of oe)R.push({polygon:me,bounds:fe})},N=Math.ceil(Math.log2(T)),j=Math.ceil(Math.log2(I)),Y=N-j,X=[];for(let oe=0;oe<Math.abs(Y);oe++)X.push(Y>0?0:1);for(let oe=0;oe<Math.min(N,j);oe++)X.push(0),X.push(1);let K=y;if(K=z_(K,b[0].y-D,b[1].y+D,1),K=z_(K,b[0].x-D,b[1].x+D,0),!K.length)return R;let ae=[];for(X.length?ae.push({polygons:K,bounds:b,depth:0}):L(K,b);ae.length;){let oe=ae.pop(),fe=oe.depth,me=X[fe],we=oe.bounds[0],Pe=oe.bounds[1],Ce=me===0?we.x:we.y,Le=me===0?Pe.x:Pe.y,Ye=P?P(me,Ce,Le):.5*(Ce+Le),Oe=z_(oe.polygons,Ce-D,Ye+D,me),He=z_(oe.polygons,Ye-D,Le+D,me);if(Oe.length){let Re=[we,new at(me===0?Ye:Pe.x,me===1?Ye:Pe.y)];X.length>fe+1?ae.push({polygons:Oe,bounds:Re,depth:fe+1}):L(Oe,Re)}if(He.length){let Re=[new at(me===0?Ye:we.x,me===1?Ye:we.y),Pe];X.length>fe+1?ae.push({polygons:He,bounds:Re,depth:fe+1}):L(He,Re)}}return R}(t,e,Math.ceil((u-l)/11.25),Math.ceil((h-g)/11.25),1,(y,b,T)=>{if(y===0)return .5*(b+T);{let I=kr((n.y+b/rt)/o);return(Is(.5*(kr((n.y+T/rt)/o)+I))*o-n.y)*rt}})}function jL(t,e,n,o,l,u){let h=Math.pow(2,o.z-l.z);for(let g=0;g<n;g++){let y=t.int16[2*(g+e)+0],b=t.int16[2*(g+e)+1];y=(y+l.x*rt)*h-o.x*rt,b=(b+l.y*rt)*h-o.y*rt,u.push(new at(y,b))}}Q(U_,"FillExtrusionBucket",{omit:["layers","features"]}),Q(sC,"PartData"),Q(oC,"FootprintSegment"),Q(aC,"BorderCentroidData"),Q(cC,"GroundEffect");let UL=new Cn({visibility:new Fe(Te["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Fe(Te["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var $L={paint:new Cn({"fill-extrusion-opacity":new Fe(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ut(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Fe(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Fe(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ut(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ut(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ut(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Fe(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Fe(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Fe(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Fe(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Fe(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Fe(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Fe(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Fe(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ut(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ut(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Fe(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Fe(Te["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Fe(Te["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Fe(Te["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Fe(Te["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:UL};function jp(t,e){return t.x*e.x+t.y*e.y}function _C(t,e){if(t.length===1){let n=0,o=e[n++],l;for(;!l||o.equals(l);)if(l=e[n++],!l)return 1/0;for(;n<e.length;n++){let u=e[n],h=t[0],g=l.sub(o),y=u.sub(o),b=h.sub(o),T=jp(g,g),I=jp(g,y),D=jp(y,y),P=jp(b,g),R=jp(b,y),L=T*D-I*I,N=(D*P-I*R)/L,j=(T*R-I*P)/L,Y=o.z*(1-N-j)+l.z*N+u.z*j;if(isFinite(Y))return Y}return 1/0}{let n=1/0;for(let o of e)n=Math.min(n,o.z);return n}}function yC(t,e,n,o,l,u,h,g){let y=h*l.getElevationAt(t,e,!0,!0),b=u[0]!==0,T=b?u[1]===0?h*(u[0]/7-450):h*function(I,D,P){let R=Math.floor(D[0]/8),L=Math.floor(D[1]/8),N=10*(D[0]-8*R),j=10*(D[1]-8*L),Y=I.getElevationAt(R,L,!0,!0),X=I.getMeterToDEM(P),K=Math.floor(.5*(N*X-1)),ae=Math.floor(.5*(j*X-1)),oe=I.tileCoordToPixel(R,L),fe=2*K+1,me=2*ae+1,we=function(He,Re,qe,Qe,Ze){return[He.getElevationAtPixel(Re,qe,!0),He.getElevationAtPixel(Re+Ze,qe,!0),He.getElevationAtPixel(Re,qe+Ze,!0),He.getElevationAtPixel(Re+Qe,qe+Ze,!0)]}(I,oe.x-K,oe.y-ae,fe,me),Pe=Math.abs(we[0]-we[1]),Ce=Math.abs(we[2]-we[3]),Le=Math.abs(we[0]-we[2])+Math.abs(we[1]-we[3]),Ye=Math.min(.25,.5*X*(Pe+Ce)/fe),Oe=Math.min(.25,.5*X*Le/me);return Y+Math.max(Ye*N,Oe*j)}(l,u,g):y;return{base:y+(n===0)?-1:n,top:b?Math.max(T+o,y+n+2):y+o}}let GL=wn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:HL}=GL,qL=wn([{name:"a_packed",components:4,type:"Float32"}]),{members:WL}=qL,ZL=wn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:YL}=ZL,XL=wn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),KL=wn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),QL=wn([{name:"a_projected_pos",components:4,type:"Float32"}],4);wn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let p1=wn([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),vC=wn([{name:"a_z_offset",components:1,type:"Float32"}],4),JL=wn([{name:"a_texb",components:2,type:"Uint16"}]),eF=wn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),tF=wn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);wn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let xC=wn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nF=wn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);wn([{name:"triangle",components:3,type:"Uint16"}]),wn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),wn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),wn([{type:"Float32",name:"offsetX"}]),wn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class bC{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Fl({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let o=this.getKey(e,n);return this.positions[o]}trim(){let e=this.width,n=this.height=Mf(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,o){let l=[],u=e.length%2==1?-e[e.length-1]*o:0,h=e[0]*o,g=!0;l.push({left:u,right:h,isDash:g,zeroLength:e[0]===0});let y=e[0];for(let b=1;b<e.length;b++){g=!g;let T=e[b];u=y*o,y+=T,h=y*o,l.push({left:u,right:h,isDash:g,zeroLength:T===0})}return l}addRoundDash(e,n,o){let l=n/2;for(let u=-o;u<=o;u++){let h=this.width*(this.nextRow+o+u),g=0,y=e[g];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++g]);let T=Math.abs(b-y.left),I=Math.abs(b-y.right),D=Math.min(T,I),P,R=u/o*(l+1);if(y.isDash){let L=l-Math.abs(R);P=Math.sqrt(D*D+L*L)}else P=l-Math.sqrt(D*D+R*R);this.image.data[h+b]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,n){for(let y=e.length-1;y>=0;--y){let b=e[y],T=e[y+1];b.zeroLength?e.splice(y,1):T&&T.isDash===b.isDash&&(T.left=b.left,e.splice(y,1))}let o=e[0],l=e[e.length-1];o.isDash===l.isDash&&(o.left=l.left-this.width,l.right=o.right+this.width);let u=this.width*this.nextRow,h=0,g=e[h];for(let y=0;y<this.width;y++){y/g.right>1&&(g=e[++h]);let b=Math.abs(y-g.left),T=Math.abs(y-g.right),I=Math.min(b,T);this.image.data[u+y]=Math.max(0,Math.min(255,(g.isDash?I:-I)+n+128))}}addDash(e,n){let o=this.getKey(e,n);if(this.positions[o])return this.positions[o];let l=n==="round",u=l?7:0,h=2*u+1;if(this.nextRow+h>this.height)return cr("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let T=0;T<e.length;T++)e[T]<0&&(cr("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),g+=e[T];if(g!==0){let T=this.width/g,I=this.getDashRanges(e,this.width,T);l?this.addRoundDash(I,T,u):this.addRegularDash(I,n==="square"?.5*T:0)}let y=this.nextRow+u;this.nextRow+=h;let b={tl:[y,u],br:[g,0]};return this.positions[o]=b,b}}Q(bC,"LineAtlas");let rF=N_.types,iF=Math.cos(Math.PI/180*37.5),oF=Math.cos(Math.PI/180*5);class $_{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new yx,this.layoutVertexArray2=new Sl,this.patternVertexArray=new Ml,this.indexArray=new Ir,this.programConfigurations=new Ol(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Jn,this.maxLineLength=0,this.zOffsetVertexArray=new au,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:rt/64}updateFootprints(e,n){}populate(e,n,o,l){this.hasPattern=a1("line",this.layers,n);let u=this.layers[0].layout.get("line-sort-key"),h=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!h.isConstant()||!!h.constantOr(0);let g=[];for(let{feature:I,id:D,index:P,sourceLayerIndex:R}of e){let L=this.layers[0]._featureFilter.needGeometry,N=xa(I,L);if(!this.layers[0]._featureFilter.filter(new Lt(this.zoom),N,o))continue;let j=u?u.evaluate(N,{},o):void 0,Y={id:D,properties:I.properties,type:I.type,sourceLayerIndex:R,index:P,geometry:L?N.geometry:$o(I,o,l),patterns:{},sortKey:j};g.push(Y)}u&&g.sort((I,D)=>I.sortKey-D.sortKey);let{lineAtlas:y,featureIndex:b}=n,T=this.addConstantDashes(y);for(let I of g){let{geometry:D,index:P,sourceLayerIndex:R}=I;if(T&&this.addFeatureDashes(I,y),this.hasPattern){let L=l1("line",this.layers,I,this.zoom,n);this.patternFeatures.push(L)}else this.addFeature(I,D,P,o,y.positions,n.availableImages,n.brightness);b.insert(e[P].feature,D,P,R,this.index)}}addConstantDashes(e){let n=!1;for(let o of this.layers){let l=o.paint.get("line-dasharray").value,u=o.layout.get("line-cap").value;if(l.kind!=="constant"||u.kind!=="constant")n=!0;else{let h=u.value,g=l.value;if(!g)continue;e.addDash(g,h)}}return n}addFeatureDashes(e,n){let o=this.zoom;for(let l of this.layers){let u=l.paint.get("line-dasharray").value,h=l.layout.get("line-cap").value;if(u.kind==="constant"&&h.kind==="constant")continue;let g,y;if(u.kind==="constant"){if(g=u.value,!g)continue}else g=u.evaluate({zoom:o},e);y=h.kind==="constant"?h.value:h.evaluate({zoom:o},e),n.addDash(g,y),e.patterns[l.id]=n.getKey(g,y)}}update(e,n,o,l,u){let h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,h?this.stateDependentLayers:this.layers,o,l,u)}addFeatures(e,n,o,l,u,h){for(let g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,n,o,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,WL)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,YL)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,vC.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,HL),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,l,u,h,g){let y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),T=y.get("line-cap").evaluate(e,{}),I=y.get("line-miter-limit"),D=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let P of n)this.addLine(P,e,l,b,T,I,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,h,l,g)}addLine(e,n,o,l,u,h,g){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;let y={zoom:this.zoom,lineProgress:void 0},b=this.layers[0].layout,T=l==="none";if(this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let oe=0;oe<e.length-1;oe++)this.totalDistance+=e[oe].dist(e[oe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let I=rF[n.type]==="Polygon",D=e.length;for(;D>=2&&e[D-1].equals(e[D-2]);)D--;let P=0;for(;P<D-1&&e[P].equals(e[P+1]);)P++;if(D<(I?3:2))return;l==="bevel"&&(h=1.05);let R=this.overscaling<=16?15*rt/(512*this.overscaling):0,L=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),N,j,Y,X,K,ae;this.e1=this.e2=-1,I&&(N=e[D-2],K=e[P].sub(N)._unit()._perp());for(let oe=P;oe<D;oe++){if(Y=oe===D-1?I?e[P+1]:void 0:e[oe+1],Y&&e[oe].equals(Y))continue;if(K&&(X=K),N&&(j=N),N=e[oe],this.hasZOffset){let Re=b.get("line-z-offset").value;if(Re.kind==="constant")ae=Re.value;else{if(this.lineClips){let qe=this.totalDistance/(this.lineClips.end-this.lineClips.start);y.lineProgress=(qe*this.lineClips.start+this.distance+(j?j.dist(N):0))/qe}else cr(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),y.lineProgress=0;ae=Re.evaluate(y,n)}ae=ae||0}K=Y?Y.sub(N)._unit()._perp():X,X=X||K;let fe=j&&Y,me=fe?l:I||T?"butt":u,we=X.x*K.x+X.y*K.y;if(T){let Re=function(qe){if(qe.patternJoinNone){let Qe=qe.segmentPoints.length/2,Ze=qe.lineSoFar-qe.segmentStart;for(let ht=0;ht<Qe;++ht){let Xe=qe.segmentPoints[2*ht+1],tt=Math.round(qe.segmentPoints[2*ht])+.5+.25*Xe;qe.patternVertexArray.emplaceBack(tt,Ze,qe.segmentStart),qe.patternVertexArray.emplaceBack(tt,Ze,qe.segmentStart)}qe.segmentPoints.length=0}qe.e1=qe.e2=-1};if(fe&&we<oF){this.updateDistance(j,N),this.addCurrentVertex(N,X,1,1,L,ae),Re(this),this.addCurrentVertex(N,K,-1,-1,L,ae);continue}if(j){if(!Y){this.updateDistance(j,N),this.addCurrentVertex(N,X,1,1,L,ae),Re(this);continue}me="miter"}}let Pe=X.add(K);Pe.x===0&&Pe.y===0||Pe._unit();let Ce=Pe.x*K.x+Pe.y*K.y,Le=Ce!==0?1/Ce:1/0,Ye=2*Math.sqrt(2-2*Ce),Oe=Ce<iF&&j&&Y,He=X.x*K.y-X.y*K.x>0;if(Oe&&oe>P){let Re=N.dist(j);if(Re>2*R){let qe=N.sub(N.sub(j)._mult(R/Re)._round());this.updateDistance(j,qe),this.addCurrentVertex(qe,X,0,0,L,ae),j=qe}}if(fe&&me==="round"&&(Le<g?me="miter":Le<=2&&(me="fakeround")),me==="miter"&&Le>h&&(me="bevel"),me==="bevel"&&(Le>2&&(me="flipbevel"),Le<h&&(me="miter")),j&&this.updateDistance(j,N),me==="miter")Pe._mult(Le),this.addCurrentVertex(N,Pe,0,0,L,ae);else if(me==="flipbevel"){if(Le>100)Pe=K.mult(-1);else{let Re=Le*X.add(K).mag()/X.sub(K).mag();Pe._perp()._mult(Re*(He?-1:1))}this.addCurrentVertex(N,Pe,0,0,L,ae),this.addCurrentVertex(N,Pe.mult(-1),0,0,L,ae)}else if(me==="bevel"||me==="fakeround"){let Re=-Math.sqrt(Le*Le-1),qe=He?Re:0,Qe=He?0:Re;if(j&&this.addCurrentVertex(N,X,qe,Qe,L,ae),me==="fakeround"){let Ze=Math.round(180*Ye/Math.PI/20);for(let ht=1;ht<Ze;ht++){let Xe=ht/Ze;if(Xe!==.5){let vt=Xe-.5;Xe+=Xe*vt*(Xe-1)*((1.0904+we*(we*(3.55645-1.43519*we)-3.2452))*vt*vt+(.848013+we*(.215638*we-1.06021)))}let tt=K.sub(X)._mult(Xe)._add(X)._unit()._mult(He?-1:1);this.addHalfVertex(N,tt.x,tt.y,!1,He,0,L,ae)}}Y&&this.addCurrentVertex(N,K,-qe,-Qe,L,ae)}else me==="butt"?this.addCurrentVertex(N,Pe,0,0,L,ae):me==="square"?(j||this.addCurrentVertex(N,Pe,-1,-1,L,ae),this.addCurrentVertex(N,Pe,0,0,L,ae),j&&this.addCurrentVertex(N,Pe,1,1,L,ae)):me==="round"&&(j&&(this.addCurrentVertex(N,X,0,0,L,ae),this.addCurrentVertex(N,X,1,1,L,ae,!0)),Y&&(this.addCurrentVertex(N,K,-1,-1,L,ae,!0),this.addCurrentVertex(N,K,0,0,L,ae)));if(Oe&&oe<D-1){let Re=N.dist(Y);if(Re>2*R){let qe=N.add(Y.sub(N)._mult(R/Re)._round());this.updateDistance(N,qe),this.addCurrentVertex(qe,K,0,0,L,ae),N=qe}}}}addVerticesTo(e,n,o,l,u,h,g,y,b,T){let I=(n.w-e.w)/this.tessellationStep|0;if(I>1){this.lineSoFar=e.w;let D=(n.x-e.x)/I,P=(n.y-e.y)/I,R=(n.z-e.z)/I,L=(n.w-e.w)/I;for(let N=1;N<I;++N)e.x+=D,e.y+=P,e.z+=R,this.lineSoFar+=L,this.addHalfVertex(e,o,l,T,!1,g,b,e.z),this.addHalfVertex(e,u,h,T,!0,-y,b,e.z)}this.lineSoFar=n.w,this.addHalfVertex(n,o,l,T,!1,g,b,n.z),this.addHalfVertex(n,u,h,T,!0,-y,b,n.z)}addCurrentVertex(e,n,o,l,u,h,g=!1){let y=n.x+n.y*o,b=n.y-n.x*o,T=n.y*l-n.x,I=-n.y-n.x*l;if(h!=null){let P=rt+10,R=h,L=new jI(e.x,e.y,R,this.lineSoFar),N=wC(e,-10,P),j=this.lineSoFar;if(this.currentVertex)if(N){let Y=this.currentVertexIsOutside,X=this.currentVertex,K=new jI(e.x,e.y,R,this.lineSoFar);$I(X,K,-10,P),wC(K,-10,P)||(Y&&(this.e1=this.e2=-1,this.lineSoFar=X.w,this.addHalfVertex(X,y,b,g,!1,o,u,X.z),this.addHalfVertex(X,T,I,g,!0,-l,u,X.z)),this.addVerticesTo(X,K,y,b,T,I,o,l,u,g))}else{let Y=this.currentVertex;this.currentVertexIsOutside&&($I(Y,L,-10,P),this.e1=this.e2=-1,this.lineSoFar=Y.w,this.addHalfVertex(Y,y,b,g,!1,o,u,Y.z),this.addHalfVertex(Y,T,I,g,!0,-l,u,Y.z)),this.addVerticesTo(Y,L,y,b,T,I,o,l,u,g)}else N||(this.addHalfVertex(e,y,b,g,!1,o,u,h),this.addHalfVertex(e,T,I,g,!0,-l,u,h));this.currentVertex=L,this.currentVertexIsOutside=N,this.lineSoFar=j}else this.addHalfVertex(e,y,b,g,!1,o,u,h),this.addHalfVertex(e,T,I,g,!0,-l,u,h)}addHalfVertex({x:e,y:n},o,l,u,h,g,y,b){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),h||this.segmentPoints.push(this.lineSoFar-this.segmentStart,g)),this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(n<<1)+(h?1:0),Math.round(63*o)+128,Math.round(63*l)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let T=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),y.primitiveLength++),h?this.e2=T:this.e1=T,b!=null&&this.zOffsetVertexArray.emplaceBack(b)}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}function wC(t,e,n){return t.x<e||t.x>n||t.y<e||t.y>n}Q($_,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let sF=new Cn({"line-cap":new ut(Te.layout_line["line-cap"]),"line-join":new ut(Te.layout_line["line-join"]),"line-miter-limit":new Fe(Te.layout_line["line-miter-limit"]),"line-round-limit":new Fe(Te.layout_line["line-round-limit"]),"line-sort-key":new ut(Te.layout_line["line-sort-key"]),"line-z-offset":new ut(Te.layout_line["line-z-offset"]),visibility:new Fe(Te.layout_line.visibility)});var G_={paint:new Cn({"line-opacity":new ut(Te.paint_line["line-opacity"]),"line-color":new ut(Te.paint_line["line-color"]),"line-translate":new Fe(Te.paint_line["line-translate"]),"line-translate-anchor":new Fe(Te.paint_line["line-translate-anchor"]),"line-width":new ut(Te.paint_line["line-width"]),"line-gap-width":new ut(Te.paint_line["line-gap-width"]),"line-offset":new ut(Te.paint_line["line-offset"]),"line-blur":new ut(Te.paint_line["line-blur"]),"line-dasharray":new ut(Te.paint_line["line-dasharray"]),"line-pattern":new ut(Te.paint_line["line-pattern"]),"line-gradient":new vr(Te.paint_line["line-gradient"]),"line-trim-offset":new Fe(Te.paint_line["line-trim-offset"]),"line-trim-fade-range":new Fe(Te.paint_line["line-trim-fade-range"]),"line-trim-color":new Fe(Te.paint_line["line-trim-color"]),"line-emissive-strength":new Fe(Te.paint_line["line-emissive-strength"]),"line-border-width":new ut(Te.paint_line["line-border-width"]),"line-border-color":new ut(Te.paint_line["line-border-color"]),"line-occlusion-opacity":new Fe(Te.paint_line["line-occlusion-opacity"])}),layout:sF};function TC(t,e,n){return e*(rt/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function EC(t,e){return 1/TC(t,1,e.tileZoom)}function IC(t,e,n,o){return t.translatePosMatrix(o||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let CC=t=>{let e=[];DC(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=t.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let o=t.layout.get("line-join").constantOr("miter")==="none",l=!!t.paint.get("line-pattern").constantOr(1);return o&&l&&e.push("LINE_JOIN_NONE"),e};function DC(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class SC{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var aF={read:function(t,e,n,o,l){var u,h,g=8*l-o-1,y=(1<<g)-1,b=y>>1,T=-7,I=n?l-1:0,D=n?-1:1,P=t[e+I];for(I+=D,u=P&(1<<-T)-1,P>>=-T,T+=g;T>0;u=256*u+t[e+I],I+=D,T-=8);for(h=u&(1<<-T)-1,u>>=-T,T+=o;T>0;h=256*h+t[e+I],I+=D,T-=8);if(u===0)u=1-b;else{if(u===y)return h?NaN:1/0*(P?-1:1);h+=Math.pow(2,o),u-=b}return(P?-1:1)*h*Math.pow(2,u-o)},write:function(t,e,n,o,l,u){var h,g,y,b=8*u-l-1,T=(1<<b)-1,I=T>>1,D=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=o?0:u-1,R=o?1:-1,L=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,h=T):(h=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-h))<1&&(h--,y*=2),(e+=h+I>=1?D/y:D*Math.pow(2,1-I))*y>=2&&(h++,y/=2),h+I>=T?(g=0,h=T):h+I>=1?(g=(e*y-1)*Math.pow(2,l),h+=I):(g=e*Math.pow(2,I-1)*Math.pow(2,l),h=0));l>=8;t[n+P]=255&g,P+=R,g/=256,l-=8);for(h=h<<l|g,b+=l;b>0;t[n+P]=255&h,P+=R,h/=256,b-=8);t[n+P-R]|=128*L}},MC=Yn,H_=aF;function Yn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Yn.Varint=0,Yn.Fixed64=1,Yn.Bytes=2,Yn.Fixed32=5;var m1=4294967296,AC=1/m1,PC=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ta(t){return t.type===Yn.Bytes?t.readVarint()+t.pos:t.pos+1}function cd(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function RC(t,e,n){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(var l=n.pos-1;l>=t;l--)n.buf[l+o]=n.buf[l]}function lF(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function cF(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function uF(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function hF(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function dF(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function fF(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function pF(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function mF(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function gF(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function q_(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function ud(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function OC(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Yn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),l=o>>3,u=this.pos;this.type=7&o,t(l,e,this),this.pos===u&&this.skip(o)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=q_(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=OC(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=q_(this.buf,this.pos)+q_(this.buf,this.pos+4)*m1;return this.pos+=8,t},readSFixed64:function(){var t=q_(this.buf,this.pos)+OC(this.buf,this.pos+4)*m1;return this.pos+=8,t},readFloat:function(){var t=H_.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=H_.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,o=this.buf;return e=127&(n=o[this.pos++]),n<128?e:(e|=(127&(n=o[this.pos++]))<<7,n<128?e:(e|=(127&(n=o[this.pos++]))<<14,n<128?e:(e|=(127&(n=o[this.pos++]))<<21,n<128?e:function(l,u,h){var g,y,b=h.buf;if(g=(112&(y=b[h.pos++]))>>4,y<128||(g|=(127&(y=b[h.pos++]))<<3,y<128)||(g|=(127&(y=b[h.pos++]))<<10,y<128)||(g|=(127&(y=b[h.pos++]))<<17,y<128)||(g|=(127&(y=b[h.pos++]))<<24,y<128)||(g|=(1&(y=b[h.pos++]))<<31,y<128))return cd(l,g,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=o[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&PC?function(n,o,l){return PC.decode(n.subarray(o,l))}(this.buf,e,t):function(n,o,l){for(var u="",h=o;h<l;){var g,y,b,T=n[h],I=null,D=T>239?4:T>223?3:T>191?2:1;if(h+D>l)break;D===1?T<128&&(I=T):D===2?(192&(g=n[h+1]))==128&&(I=(31&T)<<6|63&g)<=127&&(I=null):D===3?(y=n[h+2],(192&(g=n[h+1]))==128&&(192&y)==128&&((I=(15&T)<<12|(63&g)<<6|63&y)<=2047||I>=55296&&I<=57343)&&(I=null)):D===4&&(y=n[h+2],b=n[h+3],(192&(g=n[h+1]))==128&&(192&y)==128&&(192&b)==128&&((I=(15&T)<<18|(63&g)<<12|(63&y)<<6|63&b)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,D=1):I>65535&&(I-=65536,u+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),u+=String.fromCharCode(I),h+=D}return u}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Yn.Bytes)return t.push(this.readVarint(e));var n=Ta(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Yn.Bytes)return t.push(this.readSVarint());var e=Ta(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Yn.Bytes)return t.push(this.readBoolean());var e=Ta(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Yn.Bytes)return t.push(this.readFloat());var e=Ta(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Yn.Bytes)return t.push(this.readDouble());var e=Ta(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Yn.Bytes)return t.push(this.readFixed32());var e=Ta(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Yn.Bytes)return t.push(this.readSFixed32());var e=Ta(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Yn.Bytes)return t.push(this.readFixed64());var e=Ta(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Yn.Bytes)return t.push(this.readSFixed64());var e=Ta(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Yn.Varint)for(;this.buf[this.pos++]>127;);else if(e===Yn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Yn.Fixed32)this.pos+=4;else{if(e!==Yn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),ud(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),ud(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),ud(this.buf,-1&t,this.pos),ud(this.buf,Math.floor(t*AC),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),ud(this.buf,-1&t,this.pos),ud(this.buf,Math.floor(t*AC),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var o,l;if(e>=0?(o=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(u,h,g){g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,g.buf[g.pos]=127&(u>>>=7)}(o,0,n),function(u,h){var g=(7&u)<<4;h.buf[h.pos++]|=g|((u>>>=3)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u)))))}(l,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(o,l,u){for(var h,g,y=0;y<l.length;y++){if((h=l.charCodeAt(y))>55295&&h<57344){if(!g){h>56319||y+1===l.length?(o[u++]=239,o[u++]=191,o[u++]=189):g=h;continue}if(h<56320){o[u++]=239,o[u++]=191,o[u++]=189,g=h;continue}h=g-55296<<10|h-56320|65536,g=null}else g&&(o[u++]=239,o[u++]=191,o[u++]=189,g=null);h<128?o[u++]=h:(h<2048?o[u++]=h>>6|192:(h<65536?o[u++]=h>>12|224:(o[u++]=h>>18|240,o[u++]=h>>12&63|128),o[u++]=h>>6&63|128),o[u++]=63&h|128)}return u}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&RC(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),H_.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),H_.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var o=this.pos-n;o>=128&&RC(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(t,e,n){this.writeTag(t,Yn.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,lF,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,cF,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,dF,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,uF,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,hF,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,fF,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,pF,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,mF,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,gF,e)},writeBytesField:function(t,e){this.writeTag(t,Yn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Yn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Yn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Yn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Yn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Yn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Yn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Yn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Yn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Yn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var hd=We(MC);let _F=["id","tile","layer","source","sourceLayer","state"];class kC{constructor(e,n,o,l,u){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=o,this._y=l,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let n of _F)this[n]!==void 0&&(e[n]=this[n]);return e}}class yF{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,o){let l=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},Wr(this.stateChanges[e][l],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(let u in this.state[e])u!==l&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(let u in this.state[e][l])o[u]||(this.deletedStates[e][l][u]=null)}else for(let u in o)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][u]===null&&delete this.deletedStates[e][l][u]}removeFeatureState(e,n,o){if(this.deletedStates[e]===null)return;let l=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&n!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][o]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(o in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][o]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,n){let o=String(n),l=Wr({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let u=this.deletedStates[e][n];if(u===null)return{};for(let h in u)delete l[h]}return l}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let o={};for(let l in this.stateChanges){this.state[l]=this.state[l]||{};let u={};for(let h in this.stateChanges[l])this.state[l][h]||(this.state[l][h]={}),Wr(this.state[l][h],this.stateChanges[l][h]),u[h]=this.state[l][h];o[l]=u}for(let l in this.deletedStates){this.state[l]=this.state[l]||{};let u={};if(this.deletedStates[l]===null)for(let h in this.state[l])u[h]={},this.state[l][h]={};else for(let h in this.deletedStates[l]){if(this.deletedStates[l][h]===null)this.state[l][h]={};else if(this.state[l][h])for(let g of Object.keys(this.deletedStates[l][h]))delete this.state[l][h][g];u[h]=this.state[l][h]}o[l]=o[l]||{},Wr(o[l],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(let l in e)e[l].setFeatureState(o,n)}}class LC{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ce(rt,16,0),this.featureIndexArray=new WE,this.promoteId=n,this.is3DTile=!1}insert(e,n,o,l,u,h=0,g=0){let y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,l,u,h);let b=this.grid;for(let T=0;T<n.length;T++){let I=n[T],D=[1/0,1/0,-1/0,-1/0];for(let P=0;P<I.length;P++){let R=I[P];D[0]=Math.min(D[0],R.x),D[1]=Math.min(D[1],R.y),D[2]=Math.max(D[2],R.x),D[3]=Math.max(D[3],R.y)}g!==0&&(D[0]-=g,D[1]-=g,D[2]+=g,D[3]+=g),D[0]<rt&&D[1]<rt&&D[2]>=0&&D[3]>=0&&b.insert(y,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new u1(new hd(this.rawTileData)).layers,this.sourceLayerCoder=new SC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,o,l){this.loadVTLayers();let u=e.params||{},h=oi(u.filter),g=e.tileResult,y=e.transform,b=g.bufferedTilespaceBounds,T=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(R,L,N,j)=>uI(g.bufferedTilespaceGeometry,R,L,N,j));T.sort(vF);let I=null;y.elevation&&T.length>0&&(I=ld.create(y.elevation,this.tileID));let D={},P;for(let R=0;R<T.length;R++){let L=T[R];if(L===P)continue;P=L;let N=this.featureIndexArray.get(L),j=null;if(this.is3DTile){let Y=this.bucketLayerIDs[0][0],X=n[Y];if(X.type!=="model")continue;let{queryFeature:K,intersectionZ:ae}=X.queryIntersectsMatchingFeature(g,N.featureIndex,h,y);K&&this.appendToResult(D,Y,N.featureIndex,K,ae)}else this.loadMatchingFeature(D,N,h,u.layers,u.availableImages,n,o,l,(Y,X,K,ae=0)=>(j||(j=$o(Y,this.tileID.canonical,e.tileTransform)),X.queryIntersectsFeature(g,Y,K,j,this.z,e.transform,e.pixelPosMatrix,I,ae)))}return D}loadMatchingFeature(e,n,o,l,u,h,g,y,b){let{featureIndex:T,bucketIndex:I,sourceLayerIndex:D,layoutVertexArrayOffset:P}=n,R=this.bucketLayerIDs[I];if(l&&!function(Y,X){for(let K=0;K<Y.length;K++)if(X.indexOf(Y[K])>=0)return!0;return!1}(l,R))return;let L=this.sourceLayerCoder.decode(D),N=this.vtLayers[L].feature(T);if(o.needGeometry){let Y=xa(N,!0);if(!o.filter(new Lt(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!o.filter(new Lt(this.tileID.overscaledZ),N))return;let j=this.getId(N,L);for(let Y=0;Y<R.length;Y++){let X=R[Y];if(l&&l.indexOf(X)<0)continue;let K=h[X];if(!K)continue;let ae={};j!==void 0&&y&&(ae=y.getState(K.sourceLayer||"_geojsonTileLayer",j));let oe=!b||b(N,K,ae,P);if(!oe)continue;let fe=new kC(N,this.z,this.x,this.y,j),me=Wr({},g[X]);me.paint=FC(me.paint,K.paint,N,ae,u),me.layout=FC(me.layout,K.layout,N,ae,u),fe.layer=me,this.appendToResult(e,X,T,fe,oe)}}appendToResult(e,n,o,l,u){let h=e[n];h===void 0&&(h=e[n]=[]),h.push({featureIndex:o,feature:l,intersectionZ:u})}lookupSymbolFeatures(e,n,o,l,u,h,g,y){let b={};this.loadVTLayers();let T=oi(u);for(let I of e)this.loadMatchingFeature(b,{bucketIndex:o,sourceLayerIndex:l,featureIndex:I,layoutVertexArrayOffset:0},T,h,g,y,n);return b}loadFeature(e){let{featureIndex:n,sourceLayerIndex:o}=e;this.loadVTLayers();let l=this.sourceLayerCoder.decode(o),u=this.vtFeatures[l];if(u[n])return u[n];let h=this.vtLayers[l].feature(n);return u[n]=h,h}hasLayer(e){for(let n of this.bucketLayerIDs)for(let o of n)if(e===o)return!0;return!1}getId(e,n){let o=e.id;if(this.promoteId){let l=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];l!=null&&(o=e.properties[l]),typeof o=="boolean"&&(o=Number(o))}return o}}function FC(t,e,n,o,l){return ol(t,(u,h)=>{let g=e instanceof nn?e.get(h):null;return g&&g.evaluate?g.evaluate(n,o,l):g})}function vF(t,e){return e-t}Q(LC,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var Kr=24;let Go=128;function g1(t,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Lt(t+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:o,interpolationType:l}=n,u=0;for(;u<o.length&&o[u]<=t;)u++;u=Math.max(0,u-1);let h=u;for(;h<o.length&&o[h]<t+1;)h++;h=Math.min(o.length-1,h);let g=o[u],y=o[h];return n.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:y,interpolationType:l}:{kind:"camera",minZoom:g,maxZoom:y,minSize:n.evaluate(new Lt(g)),maxSize:n.evaluate(new Lt(y)),interpolationType:l}}}function W_(t,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:l}){return t.kind==="source"?o/Go:t.kind==="composite"?bt(o/Go,l/Go,n):e}function dd(t,e){let n=0,o=0;if(t.kind==="constant")o=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:l,minZoom:u,maxZoom:h}=t,g=l?Ht(Ii.interpolationFactor(l,e,u,h),0,1):0;t.kind==="camera"?o=bt(t.minSize,t.maxSize,g):n=g}return{uSizeT:n,uSize:o}}var xF=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Go,evaluateSizeForFeature:W_,evaluateSizeForZoom:dd,getSizeData:g1});function bF(t,e,n){return t.sections.forEach(o=>{o.text=function(l,u,h){let g=u.layout.get("text-transform").evaluate(h,{});return g==="uppercase"?l=l.toLocaleUpperCase():g==="lowercase"&&(l=l.toLocaleLowerCase()),In.applyArabicShaping&&(l=In.applyArabicShaping(l)),l}(o.text,e,n)}),t}let Up={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function wF(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function TF(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}let _1=3;function EF(t,e,n){e.glyphs=[],t===1&&n.readMessage(IF,e)}function IF(t,e,n){if(t===3){let{id:o,bitmap:l,width:u,height:h,left:g,top:y,advance:b}=n.readMessage(CF,{});e.glyphs.push({id:o,bitmap:new Fl({width:u+2*_1,height:h+2*_1},l),metrics:{width:u,height:h,left:g,top:y,advance:b}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function CF(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}let NC=_1,io={horizontal:1,vertical:2,horizontalOnly:3};class $p{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let o=new $p;return o.scale=e||1,o.fontStack=n,o}static forImage(e){let n=new $p;return n.imageName=e,n}}class fd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let o=new fd;for(let l=0;l<e.sections.length;l++){let u=e.sections[l];u.image?o.addImageSection(u):o.addTextSection(u,n)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,o){let l="";for(let u=0;u<n.length;u++){let h=n.charCodeAt(u+1)||null,g=n.charCodeAt(u-1)||null;l+=!o&&(h&&Ne(h)&&!Up[n[u+1]]||g&&Ne(g)&&!Up[n[u-1]])||!Up[n[u]]?n[u]:Up[n[u]]}return l}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&Z_[this.text.charCodeAt(o)];o++)e++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Z_[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let o=new fd;return o.text=this.text.substring(e,n),o.sectionIndex=this.sectionIndex.slice(e,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push($p.forText(e.scale,e.fontStack||n));let o=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(o)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void cr("Can't add FormattedSection with an empty image.");let o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push($p.forImage(n)),this.sectionIndex.push(this.sections.length-1)):cr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function y1(t,e,n,o,l,u,h,g,y,b,T,I,D,P,R){let L=fd.fromFeature(t,l);I===io.vertical&&L.verticalizePunctuation(D);let N=[],j=function(oe,fe,me,we,Pe,Ce){if(!oe)return[];let Le=[],Ye=function(qe,Qe,Ze,ht,Xe,tt){let vt=0;for(let yt=0;yt<qe.length();yt++){let mt=qe.getSection(yt);vt+=zC(qe.getCodePoint(yt),mt,ht,Xe,Qe,tt)}return vt/Math.max(1,Math.ceil(vt/Ze))}(oe,fe,me,we,Pe,Ce),Oe=oe.text.indexOf("\u200B")>=0,He=0;for(let qe=0;qe<oe.length();qe++){let Qe=oe.getSection(qe),Ze=oe.getCodePoint(qe);if(Z_[Ze]||(He+=zC(Ze,Qe,we,Pe,fe,Ce)),qe<oe.length()-1){let ht=!((Re=Ze)<11904||!(se["Bopomofo Extended"](Re)||se.Bopomofo(Re)||se["CJK Compatibility Forms"](Re)||se["CJK Compatibility Ideographs"](Re)||se["CJK Compatibility"](Re)||se["CJK Radicals Supplement"](Re)||se["CJK Strokes"](Re)||se["CJK Symbols and Punctuation"](Re)||se["CJK Unified Ideographs Extension A"](Re)||se["CJK Unified Ideographs"](Re)||se["Enclosed CJK Letters and Months"](Re)||se["Halfwidth and Fullwidth Forms"](Re)||se.Hiragana(Re)||se["Ideographic Description Characters"](Re)||se["Kangxi Radicals"](Re)||se["Katakana Phonetic Extensions"](Re)||se.Katakana(Re)||se["Vertical Forms"](Re)||se["Yi Radicals"](Re)||se["Yi Syllables"](Re)));(DF[Ze]||ht||Qe.imageName)&&Le.push(VC(qe+1,He,Ye,Le,SF(Ze,oe.getCodePoint(qe+1),ht&&Oe),!1))}}var Re;return jC(VC(oe.length(),He,Ye,Le,0,!0))}(L,b,u,e,o,P),{processBidirectionalText:Y,processStyledBidirectionalText:X}=In;if(Y&&L.sections.length===1){let oe=Y(L.toString(),j);for(let fe of oe){let me=new fd;me.text=fe,me.sections=L.sections;for(let we=0;we<fe.length;we++)me.sectionIndex.push(0);N.push(me)}}else if(X){let oe=X(L.text,L.sectionIndex,j);for(let fe of oe){let me=new fd;me.text=fe[0],me.sectionIndex=fe[1],me.sections=L.sections,N.push(me)}}else N=function(oe,fe){let me=[],we=oe.text,Pe=0;for(let Ce of fe)me.push(oe.substring(Pe,Ce)),Pe=Ce;return Pe<we.length&&me.push(oe.substring(Pe,we.length)),me}(L,j);let K=[],ae={positionedLines:K,text:L.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(oe,fe,me,we,Pe,Ce,Le,Ye,Oe,He,Re,qe){let Qe=0,Ze=0,ht=0,Xe=Ye==="right"?1:Ye==="left"?0:.5,tt=!1;for(let Vt of Pe){let Dt=Vt.getSections();for(let $t of Dt){if($t.imageName)continue;let jt=fe[$t.fontStack];if(jt&&(tt=jt.ascender!==void 0&&jt.descender!==void 0,!tt))break}if(!tt)break}let vt=0;for(let Vt of Pe){Vt.trim();let Dt=Vt.getMaxScale(),$t=(Dt-1)*Kr,jt={positionedGlyphs:[],lineOffset:0};oe.positionedLines[vt]=jt;let Yt=jt.positionedGlyphs,Et=0;if(!Vt.length()){Ze+=Ce,++vt;continue}let Rn=0,Pn=0;for(let rn=0;rn<Vt.length();rn++){let yn=Vt.getSection(rn),jn=Vt.getSectionIndex(rn),Ln=Vt.getCodePoint(rn),rr=yn.scale,tr=null,ai=null,or=null,Xn=Kr,gr=0,Lr=!(Oe===io.horizontal||!Re&&!Ue(Ln)||Re&&(Z_[Ln]||(yt=Ln,se.Arabic(yt)||se["Arabic Supplement"](yt)||se["Arabic Extended-A"](yt)||se["Arabic Presentation Forms-A"](yt)||se["Arabic Presentation Forms-B"](yt))));if(yn.imageName){let Fr=we[yn.imageName];if(!Fr)continue;or=yn.imageName,oe.iconsInText=oe.iconsInText||!0,ai=Fr.paddedRect;let Nn=Fr.displaySize;rr=rr*Kr/qe,tr={width:Nn[0],height:Nn[1],left:0,top:-NC,advance:Lr?Nn[1]:Nn[0],localGlyph:!1},gr=tt?-tr.height*rr:Dt*Kr-17-Nn[1]*rr,Xn=tr.advance;let Ti=(Lr?Nn[0]:Nn[1])*rr-Kr*Dt;Ti>0&&Ti>Et&&(Et=Ti)}else{let Fr=me[yn.fontStack];if(!Fr)continue;Fr[Ln]&&(ai=Fr[Ln]);let Nn=fe[yn.fontStack];if(!Nn)continue;let Ti=Nn.glyphs[Ln];if(!Ti)continue;if(tr=Ti.metrics,Xn=Ln!==8203?Kr:0,tt){let Ia=Nn.ascender!==void 0?Math.abs(Nn.ascender):0,Mo=Nn.descender!==void 0?Math.abs(Nn.descender):0,Ko=(Ia+Mo)*rr;Rn<Ko&&(Rn=Ko,Pn=(Ia-Mo)/2*rr),gr=-Ia*rr}else gr=(Dt-rr)*Kr-17}Lr?(oe.verticalizable=!0,Yt.push({glyph:Ln,imageName:or,x:Qe,y:Ze+gr,vertical:Lr,scale:rr,localGlyph:tr.localGlyph,fontStack:yn.fontStack,sectionIndex:jn,metrics:tr,rect:ai}),Qe+=Xn*rr+He):(Yt.push({glyph:Ln,imageName:or,x:Qe,y:Ze+gr,vertical:Lr,scale:rr,localGlyph:tr.localGlyph,fontStack:yn.fontStack,sectionIndex:jn,metrics:tr,rect:ai}),Qe+=tr.advance*rr+He)}Yt.length!==0&&(ht=Math.max(Qe-He,ht),tt?UC(Yt,Xe,Et,Pn,Ce*Dt/2):UC(Yt,Xe,Et,0,Ce/2)),Qe=0;let _n=Ce*Dt+Et;jt.lineOffset=Math.max(Et,$t),Ze+=_n,++vt}var yt;let mt=Ze,{horizontalAlign:et,verticalAlign:xt}=v1(Le);(function(Vt,Dt,$t,jt,Yt,Et){let Rn=(Dt-$t)*Yt,Pn=-Et*jt;for(let _n of Vt)for(let rn of _n.positionedGlyphs)rn.x+=Rn,rn.y+=Pn})(oe.positionedLines,Xe,et,xt,ht,mt),oe.top+=-xt*mt,oe.bottom=oe.top+mt,oe.left+=-et*ht,oe.right=oe.left+ht,oe.hasBaseline=tt}(ae,e,n,o,N,h,g,y,I,b,D,R),!function(oe){for(let fe of oe)if(fe.positionedGlyphs.length!==0)return!1;return!0}(K)&&ae}let Z_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},DF={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function zC(t,e,n,o,l,u){if(e.imageName){let h=o[e.imageName];return h?h.displaySize[0]*e.scale*Kr/u+l:0}{let h=n[e.fontStack],g=h&&h.glyphs[t];return g?g.metrics.advance*e.scale+l:0}}function BC(t,e,n,o){let l=Math.pow(t-e,2);return o?t<e?l/2:2*l:l+Math.abs(n)*n}function SF(t,e,n){let o=0;return t===10&&(o-=1e4),n&&(o+=150),t!==40&&t!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function VC(t,e,n,o,l,u){let h=null,g=BC(e,n,l,u);for(let y of o){let b=BC(e-y.x,n,l,u)+y.badness;b<=g&&(h=y,g=b)}return{index:t,x:e,priorBreak:h,badness:g}}function jC(t){return t?jC(t.priorBreak).concat(t.index):[]}function v1(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function UC(t,e,n,o,l){if(!(e||n||o||l))return;let u=t.length-1,h=t[u],g=(h.x+h.metrics.advance*h.scale)*e;for(let y=0;y<=u;y++)t[y].x-=g,t[y].y+=n+o+l}function MF(t,e,n,o){let{horizontalAlign:l,verticalAlign:u}=v1(o),h=n[0]-t.displaySize[0]*l,g=n[1]-t.displaySize[1]*u;return{imagePrimary:t,imageSecondary:e,top:g,bottom:g+t.displaySize[1],left:h,right:h+t.displaySize[0]}}function $C(t,e,n,o,l,u){let h=t.imagePrimary,g;if(h.content){let N=h.content,j=h.pixelRatio||1;g=[N[0]/j,N[1]/j,h.displaySize[0]-N[2]/j,h.displaySize[1]-N[3]/j]}let y=e.left*u,b=e.right*u,T,I,D,P;n==="width"||n==="both"?(P=l[0]+y-o[3],I=l[0]+b+o[1]):(P=l[0]+(y+b-h.displaySize[0])/2,I=P+h.displaySize[0]);let R=e.top*u,L=e.bottom*u;return n==="height"||n==="both"?(T=l[1]+R-o[0],D=l[1]+L+o[2]):(T=l[1]+(R+L-h.displaySize[1])/2,D=T+h.displaySize[1]),{imagePrimary:h,imageSecondary:void 0,top:T,right:I,bottom:D,left:P,collisionPadding:g}}class Ea extends at{constructor(e,n,o,l,u){super(e,n),this.angle=l,this.z=o,u!==void 0&&(this.segment=u)}clone(){return new Ea(this.x,this.y,this.z,this.angle,this.segment)}}function GC(t,e,n,o,l){if(e.segment===void 0)return!0;let u=e,h=e.segment+1,g=0;for(;g>-n/2;){if(h--,h<0)return!1;g-=t[h].dist(u),u=t[h]}g+=t[h].dist(t[h+1]),h++;let y=[],b=0;for(;g<n/2;){let T=t[h],I=t[h+1];if(!I)return!1;let D=t[h-1].angleTo(T)-T.angleTo(I);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:g,angleDelta:D}),b+=D;g-y[0].distance>o;)b-=y.shift().angleDelta;if(b>l)return!1;h++,g+=T.dist(I)}return!0}function HC(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function qC(t,e,n){return t?.6*e*n:0}function WC(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function AF(t,e,n,o,l,u){let h=qC(n,l,u),g=WC(n,o)*u,y=0,b=HC(t)/2;for(let T=0;T<t.length-1;T++){let I=t[T],D=t[T+1],P=I.dist(D);if(y+P>b){let R=(b-y)/P,L=bt(I.x,D.x,R),N=bt(I.y,D.y,R),j=new Ea(L,N,0,D.angleTo(I),T);return!h||GC(t,j,g,h,e)?j:void 0}y+=P}}function PF(t,e,n,o,l,u,h,g,y){let b=qC(o,u,h),T=WC(o,l),I=T*h,D=t[0].x===0||t[0].x===y||t[0].y===0||t[0].y===y;return e-I<e/4&&(e=I+e/4),ZC(t,D?e/2*g%e:(T/2+2*u)*h*g%e,e,b,n,I,D,!1,y)}function ZC(t,e,n,o,l,u,h,g,y){let b=u/2,T=HC(t),I=0,D=e-n,P=[];for(let R=0;R<t.length-1;R++){let L=t[R],N=t[R+1],j=L.dist(N),Y=N.angleTo(L);for(;D+n<I+j;){D+=n;let X=(D-I)/j,K=bt(L.x,N.x,X),ae=bt(L.y,N.y,X);if(K>=0&&K<y&&ae>=0&&ae<y&&D-b>=0&&D+b<=T){let oe=new Ea(K,ae,0,Y,R);o&&!GC(t,oe,u,o,l)||P.push(oe)}}I+=j}return g||P.length||h||(P=ZC(t,I/2,n,o,l,u,h,!0,y)),P}function YC(t,e,n,o,l){let u=[];for(let h=0;h<t.length;h++){let g=t[h],y;for(let b=0;b<g.length-1;b++){let T=g[b],I=g[b+1];T.x<e&&I.x<e||(T.x<e?T=new at(e,T.y+(e-T.x)/(I.x-T.x)*(I.y-T.y))._round():I.x<e&&(I=new at(e,T.y+(e-T.x)/(I.x-T.x)*(I.y-T.y))._round()),T.y<n&&I.y<n||(T.y<n?T=new at(T.x+(n-T.y)/(I.y-T.y)*(I.x-T.x),n)._round():I.y<n&&(I=new at(T.x+(n-T.y)/(I.y-T.y)*(I.x-T.x),n)._round()),T.x>=o&&I.x>=o||(T.x>=o?T=new at(o,T.y+(o-T.x)/(I.x-T.x)*(I.y-T.y))._round():I.x>=o&&(I=new at(o,T.y+(o-T.x)/(I.x-T.x)*(I.y-T.y))._round()),T.y>=l&&I.y>=l||(T.y>=l?T=new at(T.x+(l-T.y)/(I.y-T.y)*(I.x-T.x),l)._round():I.y>=l&&(I=new at(T.x+(l-T.y)/(I.y-T.y)*(I.x-T.x),l)._round()),y&&T.equals(y[y.length-1])||(y=[T],u.push(y)),y.push(I)))))}}return u}function XC(t){let e=0,n=0;for(let h of t)e+=h.w*h.h,n=Math.max(n,h.w);t.sort((h,g)=>g.h-h.h);let o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],l=0,u=0;for(let h of t)for(let g=o.length-1;g>=0;g--){let y=o[g];if(!(h.w>y.w||h.h>y.h)){if(h.x=y.x,h.y=y.y,u=Math.max(u,h.y+h.h),l=Math.max(l,h.x+h.w),h.w===y.w&&h.h===y.h){let b=o.pop();g<o.length&&(o[g]=b)}else h.h===y.h?(y.x+=h.w,y.w-=h.w):h.w===y.w?(y.y+=h.h,y.h-=h.h):(o.push({x:y.x+h.w,y:y.y,w:y.w-h.w,h:h.h}),y.y+=h.h,y.h-=h.h);break}}return{w:l,h:u,fill:e/(l*u)||0}}Q(Ea,"Anchor");let Bi=1;class x1{constructor(e,{pixelRatio:n,version:o,stretchX:l,stretchY:u,content:h}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=l,this.stretchY=u,this.content=h,this.version=o}get tl(){return[this.paddedRect.x+Bi,this.paddedRect.y+Bi]}get br(){return[this.paddedRect.x+this.paddedRect.w-Bi,this.paddedRect.y+this.paddedRect.h-Bi]}get displaySize(){return[(this.paddedRect.w-2*Bi)/this.pixelRatio,(this.paddedRect.h-2*Bi)/this.pixelRatio]}}class KC{constructor(e,n,o){let l={},u={};this.haveRenderCallbacks=[];let h=[];this.addImages(e,l,h),this.addImages(n,u,h);let{w:g,h:y}=XC(h),b=new ro({width:g||1,height:y||1});for(let T in e){let I=e[T],D=l[T].paddedRect;ro.copy(I.data,b,{x:0,y:0},{x:D.x+Bi,y:D.y+Bi},I.data,o,I.sdf)}for(let T in n){let I=n[T],D=u[T].paddedRect,P=D.x+Bi,R=D.y+Bi,L=I.data.width,N=I.data.height;ro.copy(I.data,b,{x:0,y:0},{x:P,y:R},I.data,o),ro.copy(I.data,b,{x:0,y:N-1},{x:P,y:R-1},{width:L,height:1},o),ro.copy(I.data,b,{x:0,y:0},{x:P,y:R+N},{width:L,height:1},o),ro.copy(I.data,b,{x:L-1,y:0},{x:P-1,y:R},{width:1,height:N},o),ro.copy(I.data,b,{x:0,y:0},{x:P+L,y:R},{width:1,height:N},o)}this.image=b,this.iconPositions=l,this.patternPositions=u}addImages(e,n,o){for(let l in e){let u=e[l],h={x:0,y:0,w:u.data.width+2*Bi,h:u.data.height+2*Bi};o.push(h),n[l]=new x1(h,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,n,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(let l in e.getUpdatedImages(o))this.patchUpdatedImage(this.iconPositions[l],e.getImage(l,o),n),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l,o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;let[l,u]=e.tl,h=!!Object.keys(this.patternPositions).length;o.update(n.data,{useMipmap:h},{x:l,y:u})}}Q(x1,"ImagePosition"),Q(KC,"ImageAtlas");let Gp=1e20;function QC(t,e,n,o,l,u,h,g,y){for(let b=e;b<e+o;b++)JC(t,n*u+b,u,l,h,g,y);for(let b=n;b<n+l;b++)JC(t,b*u+e,1,o,h,g,y)}function JC(t,e,n,o,l,u,h){u[0]=0,h[0]=-Gp,h[1]=Gp,l[0]=t[e];for(let g=1,y=0,b=0;g<o;g++){l[g]=t[e+g*n];let T=g*g;do{let I=u[y];b=(l[g]-l[I]+T-I*I)/(g-I)/2}while(b<=h[y]&&--y>-1);y++,u[y]=g,h[y]=b,h[y+1]=Gp}for(let g=0,y=0;g<o;g++){for(;h[y+1]<g;)y++;let b=u[y],T=g-b;t[e+g*n]=l[b]+T*T}}let Ho=2,b1={none:0,ideographs:1,all:2};class pd{constructor(e,n,o){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,o){let l=[],u=this.urls[n]||k.GLYPHS_URL;for(let h in e)for(let g of e[h])l.push({stack:h,id:g});il(l,({stack:h,id:g},y)=>{let b=this.entries[h];b||(b=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=b.glyphs[g];if(T!==void 0)return void y(null,{stack:h,id:g,glyph:T});if(T=this._tinySDF(b,h,g),T)return b.glyphs[g]=T,void y(null,{stack:h,id:g,glyph:T});let I=Math.floor(g/256);if(256*I>65535)return void y(new Error("glyphs > 65535 not supported"));if(b.ranges[I])return void y(null,{stack:h,id:g,glyph:T});let D=b.requests[I];D||(D=b.requests[I]=[],pd.loadGlyphRange(h,I,u,this.requestManager,(P,R)=>{if(R){b.ascender=R.ascender,b.descender=R.descender;for(let L in R.glyphs)this._doesCharSupportLocalGlyph(+L)||(b.glyphs[+L]=R.glyphs[+L]);b.ranges[I]=!0}for(let L of D)L(P,R);delete b.requests[I]})),D.push((P,R)=>{P?y(P):R&&y(null,{stack:h,id:g,glyph:R.glyphs[g]||null})})},(h,g)=>{if(h)o(h);else if(g){let y={};for(let{stack:b,id:T,glyph:I}of g)y[b]===void 0&&(y[b]={}),y[b].glyphs===void 0&&(y[b].glyphs={}),y[b].glyphs[T]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},y[b].ascender=this.entries[b].ascender,y[b].descender=this.entries[b].descender;o(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==b1.none&&(this.localGlyphMode===b1.all?!!this.localFontFamily:!!this.localFontFamily&&(se["CJK Unified Ideographs"](e)||se["Hangul Syllables"](e)||se.Hiragana(e)||se.Katakana(e)||se["CJK Symbols and Punctuation"](e)||se["CJK Unified Ideographs Extension A"](e)||se["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,o){let l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(o))return;let u=e.tinySDF;if(!u){let L="400";/bold/i.test(n)?L="900":/medium/i.test(n)?L="500":/light/i.test(n)&&(L="200"),u=e.tinySDF=new pd.TinySDF({fontFamily:l,fontWeight:L,fontSize:24*Ho,buffer:3*Ho,radius:8*Ho}),u.fontWeight=L}if(this.localGlyphs[u.fontWeight][o])return this.localGlyphs[u.fontWeight][o];let h=String.fromCodePoint(o),{data:g,width:y,height:b,glyphWidth:T,glyphHeight:I,glyphLeft:D,glyphTop:P,glyphAdvance:R}=u.draw(h);return this.localGlyphs[u.fontWeight][o]={id:o,bitmap:new Fl({width:y,height:b},g),metrics:{width:T/Ho,height:I/Ho,left:D/Ho,top:P/Ho-27,advance:R/Ho,localGlyph:!0}}}}pd.loadGlyphRange=function(t,e,n,o,l){let u=256*e,h=u+255,g=o.transformRequest(o.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${u}-${h}`),Ch.Glyphs);ia(g,(y,b)=>{if(y)l(y);else if(b){let T={},I=function(D){return new hd(D).readFields(EF,{})}(b);for(let D of I.glyphs)T[D.id]=D;l(null,{glyphs:T,ascender:I.ascender,descender:I.descender})}})},pd.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:o=.25,fontFamily:l="sans-serif",fontWeight:u="normal",fontStyle:h="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=n;let g=this.size=t+4*e,y=this._createCanvas(g),b=this.ctx=y.getContext("2d",{willReadFrequently:!0});b.font=`${h} ${u} ${t}px ${l}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:l,actualBoundingBoxRight:u}=this.ctx.measureText(t),h=Math.ceil(n),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-l))),y=Math.min(this.size-this.buffer,h+Math.ceil(o)),b=g+2*this.buffer,T=y+2*this.buffer,I=Math.max(b*T,0),D=new Uint8ClampedArray(I),P={data:D,width:b,height:T,glyphWidth:g,glyphHeight:y,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(g===0||y===0)return P;let{ctx:R,buffer:L,gridInner:N,gridOuter:j}=this;R.clearRect(L,L,g,y),R.fillText(t,L,L+h);let Y=R.getImageData(L,L,g,y);j.fill(Gp,0,I),N.fill(0,0,I);for(let X=0;X<y;X++)for(let K=0;K<g;K++){let ae=Y.data[4*(X*g+K)+3]/255;if(ae===0)continue;let oe=(X+L)*b+K+L;if(ae===1)j[oe]=0,N[oe]=Gp;else{let fe=.5-ae;j[oe]=fe>0?fe*fe:0,N[oe]=fe<0?fe*fe:0}}QC(j,0,0,b,T,b,this.f,this.v,this.z),QC(N,L,L,g,y,b,this.f,this.v,this.z);for(let X=0;X<I;X++){let K=Math.sqrt(j[X])-Math.sqrt(N[X]);D[X]=Math.round(255-255*(K/this.radius+this.cutoff))}return P}};let Bl=Bi;function eD(t,e,n,o){let l=[],u=t.imagePrimary,h=u.pixelRatio,g=u.paddedRect.w-2*Bl,y=u.paddedRect.h-2*Bl,b=t.right-t.left,T=t.bottom-t.top,I=u.stretchX||[[0,g]],D=u.stretchY||[[0,y]],P=(Ce,Le)=>Ce+Le[1]-Le[0],R=I.reduce(P,0),L=D.reduce(P,0),N=g-R,j=y-L,Y=0,X=R,K=0,ae=L,oe=0,fe=N,me=0,we=j;if(u.content&&o){let Ce=u.content;Y=Y_(I,0,Ce[0]),K=Y_(D,0,Ce[1]),X=Y_(I,Ce[0],Ce[2]),ae=Y_(D,Ce[1],Ce[3]),oe=Ce[0]-Y,me=Ce[1]-K,fe=Ce[2]-Ce[0]-X,we=Ce[3]-Ce[1]-ae}let Pe=(Ce,Le,Ye,Oe)=>{let He=X_(Ce.stretch-Y,X,b,t.left),Re=K_(Ce.fixed-oe,fe,Ce.stretch,R),qe=X_(Le.stretch-K,ae,T,t.top),Qe=K_(Le.fixed-me,we,Le.stretch,L),Ze=X_(Ye.stretch-Y,X,b,t.left),ht=K_(Ye.fixed-oe,fe,Ye.stretch,R),Xe=X_(Oe.stretch-K,ae,T,t.top),tt=K_(Oe.fixed-me,we,Oe.stretch,L),vt=new at(He,qe),yt=new at(Ze,qe),mt=new at(Ze,Xe),et=new at(He,Xe),xt=new at(Re/h,Qe/h),Vt=new at(ht/h,tt/h),Dt=e*Math.PI/180;if(Dt){let Pn=Math.sin(Dt),_n=Math.cos(Dt),rn=[_n,-Pn,Pn,_n];vt._matMult(rn),yt._matMult(rn),et._matMult(rn),mt._matMult(rn)}let $t=Ce.stretch+Ce.fixed,jt=Ye.stretch+Ye.fixed,Yt=Le.stretch+Le.fixed,Et=Oe.stretch+Oe.fixed,Rn=t.imageSecondary;return{tl:vt,tr:yt,bl:et,br:mt,texPrimary:{x:u.paddedRect.x+Bl+$t,y:u.paddedRect.y+Bl+Yt,w:jt-$t,h:Et-Yt},texSecondary:Rn?{x:Rn.paddedRect.x+Bl+$t,y:Rn.paddedRect.y+Bl+Yt,w:jt-$t,h:Et-Yt}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xt,pixelOffsetBR:Vt,minFontScaleX:fe/h/b,minFontScaleY:we/h/T,isSDF:n}};if(o&&(u.stretchX||u.stretchY)){let Ce=tD(I,N,R),Le=tD(D,j,L);for(let Ye=0;Ye<Ce.length-1;Ye++){let Oe=Ce[Ye],He=Ce[Ye+1];for(let Re=0;Re<Le.length-1;Re++)l.push(Pe(Oe,Le[Re],He,Le[Re+1]))}}else l.push(Pe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:y+1}));return l}function Y_(t,e,n){let o=0;for(let l of t)o+=Math.max(e,Math.min(n,l[1]))-Math.max(e,Math.min(n,l[0]));return o}function tD(t,e,n){let o=[{fixed:-Bl,stretch:0}];for(let[l,u]of t){let h=o[o.length-1];o.push({fixed:l-h.stretch,stretch:h.stretch}),o.push({fixed:l-h.stretch,stretch:h.stretch+(u-l)})}return o.push({fixed:e+Bl,stretch:n}),o}function X_(t,e,n,o){return t/e*n+o}function K_(t,e,n,o){return t-e*n/o}function RF(t,e,n,o){let l=e+t.positionedLines[o].lineOffset;return o===0?n+l/2:n+(l+(e+t.positionedLines[o-1].lineOffset))/2}function OF(t,e=1,n=!1){let o=1/0,l=1/0,u=-1/0,h=-1/0,g=t[0];for(let P=0;P<g.length;P++){let R=g[P];(!P||R.x<o)&&(o=R.x),(!P||R.y<l)&&(l=R.y),(!P||R.x>u)&&(u=R.x),(!P||R.y>h)&&(h=R.y)}let y=Math.min(u-o,h-l),b=y/2,T=new ip([],kF);if(y===0)return new at(o,l);for(let P=o;P<u;P+=y)for(let R=l;R<h;R+=y)T.push(new md(P+b,R+b,b,t));let I=function(P){let R=0,L=0,N=0,j=P[0];for(let Y=0,X=j.length,K=X-1;Y<X;K=Y++){let ae=j[Y],oe=j[K],fe=ae.x*oe.y-oe.x*ae.y;L+=(ae.x+oe.x)*fe,N+=(ae.y+oe.y)*fe,R+=3*fe}return new md(L/R,N/R,0,P)}(t),D=T.length;for(;T.length;){let P=T.pop();(P.d>I.d||!I.d)&&(I=P,n&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,D)),P.max-I.d<=e||(b=P.h/2,T.push(new md(P.p.x-b,P.p.y-b,b,t)),T.push(new md(P.p.x+b,P.p.y-b,b,t)),T.push(new md(P.p.x-b,P.p.y+b,b,t)),T.push(new md(P.p.x+b,P.p.y+b,b,t)),D+=4)}return n&&(console.log(`num probes: ${D}`),console.log(`best distance: ${I.d}`)),I.p}function kF(t,e){return e.max-t.max}class md{constructor(e,n,o,l){this.p=new at(e,n),this.h=o,this.d=function(u,h){let g=!1,y=1/0;for(let b=0;b<h.length;b++){let T=h[b];for(let I=0,D=T.length,P=D-1;I<D;P=I++){let R=T[I],L=T[P];R.y>u.y!=L.y>u.y&&u.x<(L.x-R.x)*(u.y-R.y)/(L.y-R.y)+R.x&&(g=!g),y=Math.min(y,lI(u,R,L))}}return(g?1:-1)*Math.sqrt(y)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}let w1=Number.POSITIVE_INFINITY,LF=Math.sqrt(2);function nD(t,[e,n]){let o=0,l=0;if(n===w1){e<0&&(e=0);let u=e/LF;switch(t){case"top-right":case"top-left":l=u-7;break;case"bottom-right":case"bottom-left":l=7-u;break;case"bottom":l=7-e;break;case"top":l=e-7}switch(t){case"top-right":case"bottom-right":o=-u;break;case"top-left":case"bottom-left":o=u;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":l=n-7;break;case"bottom-right":case"bottom-left":case"bottom":l=7-n}switch(t){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,l]}function T1(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function FF(t,e,n,o,l,u,h,g,y,b,T,I,D,P,R){let L=u.textMaxSize.evaluate(e,{},I);L===void 0&&(L=h);let N=t.layers[0].layout,j=N.get("icon-offset").evaluate(e,{},I),Y=iD(n.horizontal)||n.vertical,X=D.name==="globe",K=Kr,ae=h/K,oe=t.tilePixelRatio*L/K,fe=(He=t.overscaling,t.zoom>18&&He>2&&(He>>=1),Math.max(rt/(512*He),1)*N.get("symbol-spacing")),me=N.get("text-padding")*t.tilePixelRatio,we=N.get("icon-padding")*t.tilePixelRatio,Pe=en(N.get("text-max-angle")),Ce=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Le=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Ye=N.get("symbol-placement"),Oe=fe/2;var He;let Re=N.get("icon-text-fit").evaluate(e,{},I),qe=N.get("icon-text-fit-padding").evaluate(e,{},I),Qe=Re!=="none",Ze;t.hasAnyIconTextFit===!1&&Qe&&(t.hasAnyIconTextFit=!0),o&&Qe&&(t.allowVerticalPlacement&&n.vertical&&(Ze=$C(o,n.vertical,Re,qe,j,ae)),Y&&(o=$C(o,Y,Re,qe,j,ae)));let ht=(Xe,tt,vt)=>{if(tt.x<0||tt.x>=rt||tt.y<0||tt.y>=rt)return;let yt=null;if(X){let{x:mt,y:et,z:xt}=D.projectTilePoint(tt.x,tt.y,vt);yt={anchor:new Ea(mt,et,xt,0,void 0),up:D.upVector(vt,tt.x,tt.y)}}(function(mt,et,xt,Vt,Dt,$t,jt,Yt,Et,Rn,Pn,_n,rn,yn,jn,Ln,rr,tr,ai,or,Xn,gr,Lr,Fr,Nn,Ti,Ia){let Mo=mt.addToLineVertexArray(et,Vt),Ko,ql,Wl,xu,oS,sS,aS,lS=0,cS=0,uS=0,hS=0,Q1=-1,J1=-1,As={},dS=dl(""),bu=xt?xt.anchor:et,eb=Et.layout.get("icon-text-fit").evaluate(Xn,{},Nn)!=="none",tb=0,nb=0;if(Et._unevaluatedLayout.getValue("text-radial-offset")===void 0?[tb,nb]=Et.layout.get("text-offset").evaluate(Xn,{},Nn).map(ji=>ji*Kr):(tb=Et.layout.get("text-radial-offset").evaluate(Xn,{},Nn)*Kr,nb=w1),mt.allowVerticalPlacement&&Dt.vertical){let ji=Dt.vertical;if(jn)sS=E1(ji),Yt&&(aS=E1(Yt));else{let Ui=Et.layout.get("text-rotate").evaluate(Xn,{},Nn)+90;Wl=Q_(Rn,bu,et,Pn,_n,rn,ji,yn,Ui,Ln),Yt&&(xu=Q_(Rn,bu,et,Pn,_n,rn,Yt,tr,Ui))}}if($t){let ji=Et.layout.get("icon-rotate").evaluate(Xn,{},Nn),Ui=eD($t,ji,Lr,eb),Ed=Yt?eD(Yt,ji,Lr,eb):void 0;ql=Q_(Rn,bu,et,Pn,_n,rn,$t,tr,ji),lS=4*Ui.length;let fS=mt.iconSizeData,wu=null;fS.kind==="source"?(wu=[Go*Et.layout.get("icon-size").evaluate(Xn,{},Nn)],wu[0]>Vl&&cr(`${mt.layerIds[0]}: Value for "icon-size" is >= ${Hp}. Reduce your "icon-size".`)):fS.kind==="composite"&&(wu=[Go*gr.compositeIconSizes[0].evaluate(Xn,{},Nn),Go*gr.compositeIconSizes[1].evaluate(Xn,{},Nn)],(wu[0]>Vl||wu[1]>Vl)&&cr(`${mt.layerIds[0]}: Value for "icon-size" is >= ${Hp}. Reduce your "icon-size".`)),mt.addSymbols(mt.icon,Ui,wu,or,ai,Xn,!1,xt,et,Mo.lineStartIndex,Mo.lineLength,-1,Fr,Nn,Ti,Ia),Q1=mt.icon.placedSymbolArray.length-1,Ed&&(cS=4*Ed.length,mt.addSymbols(mt.icon,Ed,wu,or,ai,Xn,io.vertical,xt,et,Mo.lineStartIndex,Mo.lineLength,-1,Fr,Nn,Ti,Ia),J1=mt.icon.placedSymbolArray.length-1)}for(let ji in Dt.horizontal){let Ui=Dt.horizontal[ji];Ko||(dS=dl(Ui.text),jn?oS=E1(Ui):Ko=Q_(Rn,bu,et,Pn,_n,rn,Ui,yn,Et.layout.get("text-rotate").evaluate(Xn,{},Nn),Ln));let Ed=Ui.positionedLines.length===1;if(uS+=rD(mt,xt,et,Ui,jt,Et,jn,Xn,Ln,Mo,Dt.vertical?io.horizontal:io.horizontalOnly,Ed?Object.keys(Dt.horizontal):[ji],As,Q1,gr,Fr,Nn,Ti),Ed)break}Dt.vertical&&(hS+=rD(mt,xt,et,Dt.vertical,jt,Et,jn,Xn,Ln,Mo,io.vertical,["vertical"],As,J1,gr,Fr,Nn,Ti));let Zl=-1,rb=(ji,Ui)=>ji?Math.max(ji,Ui):Ui;Zl=rb(oS,Zl),Zl=rb(sS,Zl),Zl=rb(aS,Zl);let t3=Zl>-1?1:0;mt.glyphOffsetArray.length>=65535&&cr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Xn.sortKey!==void 0&&mt.addToSortKeyRanges(mt.symbolInstances.length,Xn.sortKey),mt.symbolInstances.emplaceBack(et.x,et.y,bu.x,bu.y,bu.z,As.right>=0?As.right:-1,As.center>=0?As.center:-1,As.left>=0?As.left:-1,As.vertical>=0?As.vertical:-1,Q1,J1,dS,Ko!==void 0?Ko:mt.collisionBoxArray.length,Ko!==void 0?Ko+1:mt.collisionBoxArray.length,Wl!==void 0?Wl:mt.collisionBoxArray.length,Wl!==void 0?Wl+1:mt.collisionBoxArray.length,ql!==void 0?ql:mt.collisionBoxArray.length,ql!==void 0?ql+1:mt.collisionBoxArray.length,xu||mt.collisionBoxArray.length,xu?xu+1:mt.collisionBoxArray.length,Pn,uS,hS,lS,cS,t3,0,tb,nb,Zl,0,1,1,eb?1:0)})(t,tt,yt,Xe,n,o,l,Ze,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,me,Ce,y,0,we,Le,j,e,u,b,T,I,P,R)};if(Ye==="line")for(let Xe of YC(e.geometry,0,0,rt,rt)){let tt=PF(Xe,fe,Pe,n.vertical||Y,o,K,oe,t.overscaling,rt);for(let vt of tt)Y&&NF(t,Y.text,Oe,vt)||ht(Xe,vt,I)}else if(Ye==="line-center"){for(let Xe of e.geometry)if(Xe.length>1){let tt=AF(Xe,Pe,n.vertical||Y,o,K,oe);tt&&ht(Xe,tt,I)}}else if(e.type==="Polygon")for(let Xe of k_(e.geometry,0)){let tt=OF(Xe,16);ht(Xe[0],new Ea(tt.x,tt.y,0,0,void 0),I)}else if(e.type==="LineString")for(let Xe of e.geometry)ht(Xe,new Ea(Xe[0].x,Xe[0].y,0,0,void 0),I);else if(e.type==="Point")for(let Xe of e.geometry)for(let tt of Xe)ht([tt],new Ea(tt.x,tt.y,0,0,void 0),I)}let Hp=255,Vl=Hp*Go;function rD(t,e,n,o,l,u,h,g,y,b,T,I,D,P,R,L,N,j){let Y=function(ae,oe,fe,me,we,Pe,Ce,Le){let Ye=[];if(oe.positionedLines.length===0)return Ye;let Oe=me.layout.get("text-rotate").evaluate(Pe,{})*Math.PI/180,He=function(ht){let Xe=ht[0],tt=ht[1],vt=Xe*tt;return vt>0?[Xe,-tt]:vt<0?[-Xe,tt]:Xe===0?[tt,Xe]:[tt,-Xe]}(fe),Re=Math.abs(oe.top-oe.bottom);for(let ht of oe.positionedLines)Re-=ht.lineOffset;let qe=oe.positionedLines.length,Qe=Re/qe,Ze=oe.top-fe[1];for(let ht=0;ht<qe;++ht){let Xe=oe.positionedLines[ht];Ze=RF(oe,Qe,Ze,ht);for(let tt of Xe.positionedGlyphs){if(!tt.rect)continue;let vt=tt.rect||{},yt=NC+1,mt=!0,et=1,xt=0;if(tt.imageName){let or=Ce[tt.imageName];if(!or)continue;if(or.sdf){cr("SDF images are not supported in formatted text and will be ignored.");continue}mt=!1,et=or.pixelRatio,yt=Bi/et}let Vt=(we||Le)&&tt.vertical,Dt=tt.metrics.advance*tt.scale/2,$t=tt.metrics,jt=tt.rect;if(jt===null)continue;Le&&oe.verticalizable&&(xt=tt.imageName?Dt-tt.metrics.width*tt.scale/2:0);let Yt=we?[tt.x+Dt,tt.y]:[0,0],Et=[0,0],Rn=[0,0],Pn=!1;we||(Vt?(Rn=[tt.x+Dt+He[0],tt.y+He[1]-xt],Pn=!0):Et=[tt.x+Dt+fe[0],tt.y+fe[1]-xt]);let _n=jt.w*tt.scale/(et*(tt.localGlyph?Ho:1)),rn=jt.h*tt.scale/(et*(tt.localGlyph?Ho:1)),yn,jn,Ln,rr;if(Vt){let or=tt.y-Ze,Xn=new at(-Dt,Dt-or),gr=-Math.PI/2,Lr=new at(...Rn);yn=new at(-Dt+Et[0],Et[1]),yn._rotateAround(gr,Xn)._add(Lr),yn.x+=-or+Dt,yn.y-=($t.left-yt)*tt.scale;let Fr=tt.imageName?$t.advance*tt.scale:Kr*tt.scale,Nn=String.fromCodePoint(tt.glyph);wF(Nn)?yn.x+=(1-yt)*tt.scale:TF(Nn)?yn.x+=Fr-$t.height*tt.scale+(-yt-1)*tt.scale:yn.x+=tt.imageName||$t.width+2*yt===jt.w&&$t.height+2*yt===jt.h?(Fr-rn)/2:(Fr-($t.height+2*yt)*tt.scale)/2,jn=new at(yn.x,yn.y-_n),Ln=new at(yn.x+rn,yn.y),rr=new at(yn.x+rn,yn.y-_n)}else{let or=($t.left-yt)*tt.scale-Dt+Et[0],Xn=(-$t.top-yt)*tt.scale+Et[1],gr=or+_n,Lr=Xn+rn;yn=new at(or,Xn),jn=new at(gr,Xn),Ln=new at(or,Lr),rr=new at(gr,Lr)}if(Oe){let or;or=we?new at(0,0):Pn?new at(He[0],He[1]):new at(fe[0],fe[1]),yn._rotateAround(Oe,or),jn._rotateAround(Oe,or),Ln._rotateAround(Oe,or),rr._rotateAround(Oe,or)}let tr=new at(0,0),ai=new at(0,0);Ye.push({tl:yn,tr:jn,bl:Ln,br:rr,texPrimary:vt,texSecondary:void 0,writingMode:oe.writingMode,glyphOffset:Yt,sectionIndex:tt.sectionIndex,isSDF:mt,pixelOffsetTL:tr,pixelOffsetBR:ai,minFontScaleX:0,minFontScaleY:0})}}return Ye}(0,o,y,u,h,g,l,t.allowVerticalPlacement),X=t.textSizeData,K=null;X.kind==="source"?(K=[Go*u.layout.get("text-size").evaluate(g,{},N)],K[0]>Vl&&cr(`${t.layerIds[0]}: Value for "text-size" is >= ${Hp}. Reduce your "text-size".`)):X.kind==="composite"&&(K=[Go*R.compositeTextSizes[0].evaluate(g,{},N),Go*R.compositeTextSizes[1].evaluate(g,{},N)],(K[0]>Vl||K[1]>Vl)&&cr(`${t.layerIds[0]}: Value for "text-size" is >= ${Hp}. Reduce your "text-size".`)),t.addSymbols(t.text,Y,K,y,h,g,T,e,n,b.lineStartIndex,b.lineLength,P,L,N,j,!1);for(let ae of I)D[ae]=t.text.placedSymbolArray.length-1;return 4*Y.length}function iD(t){for(let e in t)return t[e];return null}function Q_(t,e,n,o,l,u,h,g,y,b){let T=h.top,I=h.bottom,D=h.left,P=h.right,R=h.collisionPadding;if(R&&(D-=R[0],T-=R[1],P+=R[2],I+=R[3]),y){let L=new at(D,T),N=new at(P,T),j=new at(D,I),Y=new at(P,I),X=en(y),K=new at(0,0);b&&(K=new at(b[0],b[1])),L._rotateAround(X,K),N._rotateAround(X,K),j._rotateAround(X,K),Y._rotateAround(X,K),D=Math.min(L.x,N.x,j.x,Y.x),P=Math.max(L.x,N.x,j.x,Y.x),T=Math.min(L.y,N.y,j.y,Y.y),I=Math.max(L.y,N.y,j.y,Y.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,D,T,P,I,g,o,l,u),t.length-1}function E1(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function NF(t,e,n,o){let l=t.compareText;if(e in l){let u=l[e];for(let h=u.length-1;h>=0;h--)if(o.dist(u[h])<n)return!0}else l[e]=[];return l[e].push(o),!1}function oD(t,e){let n=t.fovAboveCenter,o=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,l=(t._camera.position[2]*t.worldSize-o)/Math.cos(t._pitch),u=Math.sin(n)*l/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),h=Math.sin(t._pitch)*u+l;return Math.min(1.01*h,l*(1/t._horizonShift))}function mu(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let n=Math.pow(2,-t.z),o=t.x*n,l=(t.x+1)*n,u=t.y*n,h=(t.y+1)*n,g=Di(o),y=Di(l),b=kr(u),T=kr(h),I=e.project(g,b),D=e.project(y,b),P=e.project(y,T),R=e.project(g,T),L=Math.min(I.x,D.x,P.x,R.x),N=Math.min(I.y,D.y,P.y,R.y),j=Math.max(I.x,D.x,P.x,R.x),Y=Math.max(I.y,D.y,P.y,R.y),X=n/16;function K(oe,fe,me,we,Pe,Ce){let Le=(me+Pe)/2,Ye=(we+Ce)/2,Oe=e.project(Di(Le),kr(Ye)),He=Math.max(0,L-Oe.x,N-Oe.y,Oe.x-j,Oe.y-Y);L=Math.min(L,Oe.x),j=Math.max(j,Oe.x),N=Math.min(N,Oe.y),Y=Math.max(Y,Oe.y),He>X&&(K(oe,Oe,me,we,Le,Ye),K(Oe,fe,Le,Ye,Pe,Ce))}K(I,D,o,u,l,u),K(D,P,l,u,l,h),K(P,R,l,h,o,h),K(R,I,o,h,o,u),L-=X,N-=X,j+=X,Y+=X;let ae=1/Math.max(j-L,Y-N);return{scale:ae,x:L*ae,y:N*ae,x2:j*ae,y2:Y*ae,projection:e}}function sD(t,{x:e,y:n},o=0){return new at(((e-o)*t.scale-t.x)*rt,(n*t.scale-t.y)*rt)}let zF=r.ad.identity(new Float32Array(16));class jl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new cn(0,0)}projectTilePoint(e,n,o){return{x:e,y:n,z:0}}locationPoint(e,n,o=!0){return e._coordinatePoint(e.locationCoordinate(n),o)}pixelsPerMeter(e,n){return wi(1,e)*n}pixelSpaceConversion(e,n,o){return 1}farthestPixelDistance(e){return oD(e,e.pixelsPerMeter)}pointCoordinate(e,n,o,l){let u=e.horizonLineFromTop(!1),h=new at(n,Math.max(u,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(h,l))}pointCoordinate3D(e,n,o){let l=new at(n,o);if(e.elevation)return e.elevation.pointCoordinate(l);{let u=this.pointCoordinate(e,l.x,l.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);let o=e.horizonLineFromTop();return n.y<o}createInversionMatrix(e,n){return zF}createTileMatrix(e,n,o){let l,u,h,g=o.canonical,y=r.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let b=mu(g,this);l=1,u=b.x+o.wrap*b.scale,h=b.y,r.ad.scale(y,y,[l/b.scale,l/b.scale,e.pixelsPerMeter/n])}else l=n/e.zoomScale(g.z),u=(g.x+Math.pow(2,g.z)*o.wrap)*l,h=g.y*l;return r.ad.translate(y,y,[u,h,0]),r.ad.scale(y,y,[l/rt,l/rt,1]),y}upVector(e,n,o){return[0,0,1]}upVectorScale(e,n,o){return{metersToTile:1}}}class BF extends jl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,o]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(en(n));this.n=(l+Math.sin(en(o)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:o,c:l,r0:u}=this,h=en(e-this.center[0]),g=en(n),y=Math.sqrt(l-2*o*Math.sin(g))/o;return{x:y*Math.sin(h*o),y:y*Math.cos(h*o)-u,z:0}}unproject(e,n){let{n:o,c:l,r0:u}=this,h=u+n,g=Math.atan2(e,Math.abs(h))*Math.sign(h);h*o<0&&(g-=Math.PI*Math.sign(e)*Math.sign(h));let y=en(this.center[0])*o;g=ta(g,-Math.PI-y,Math.PI-y);let b=Ht(qr(g/o)+this.center[0],-180,180),T=Math.asin(Ht((l-(e*e+h*h)*o*o)/(2*o),-1,1)),I=Ht(qr(T),-hr,hr);return new cn(b,I)}}let qp=1.340264,Wp=-.081106,Zp=893e-6,Yp=.003796,J_=Math.sqrt(3)/2;class VF extends jl{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let o=Math.asin(J_*Math.sin(n)),l=o*o,u=l*l*l;return{x:.5*(e*Math.cos(o)/(J_*(qp+3*Wp*l+u*(7*Zp+9*Yp*l)))/Math.PI+.5),y:1-.5*(o*(qp+Wp*l+u*(Zp+Yp*l))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,l=o*o,u=l*l*l;for(let T,I,D,P=0;P<12&&(I=o*(qp+Wp*l+u*(Zp+Yp*l))-n,D=qp+3*Wp*l+u*(7*Zp+9*Yp*l),T=I/D,o=Ht(o-T,-Math.PI/3,Math.PI/3),l=o*o,u=l*l*l,!(Math.abs(T)<1e-12));++P);let h=J_*e*(qp+3*Wp*l+u*(7*Zp+9*Yp*l))/Math.cos(o),g=Math.asin(Math.sin(o)/J_),y=Ht(180*h/Math.PI,-180,180),b=Ht(180*g/Math.PI,-hr,hr);return new cn(y,b)}}class jF extends jl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let o=360*(e-.5),l=Ht(360*(.5-n),-hr,hr);return new cn(o,l)}}let gd=Math.PI/2;function ey(t){return Math.tan((gd+t)/2)}class UF extends jl{constructor(e){super(e),this.center=e.center||[0,30];let[n,o]=this.parallels=e.parallels||[30,30],l=en(n),u=en(o);this.southernCenter=l+u<0,this.southernCenter&&(l=-l,u=-u);let h=Math.cos(l),g=ey(l);this.n=l===u?Math.sin(l):Math.log(h/Math.cos(u))/Math.log(ey(u)/g),this.f=h*Math.pow(ey(l),this.n)/this.n}project(e,n){n=en(n),this.southernCenter&&(n=-n),e=en(e-this.center[0]);let o=1e-6,{n:l,f:u}=this;u>0?n<-gd+o&&(n=-gd+o):n>gd-o&&(n=gd-o);let h=u/Math.pow(ey(n),l),g=h*Math.sin(l*e),y=u-h*Math.cos(l*e);return g=.5*(g/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:g,y:this.southernCenter?y:1-y,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:o,f:l}=this,u=l-n,h=Math.sign(u),g=Math.sign(o)*Math.sqrt(e*e+u*u),y=Math.atan2(e,Math.abs(u))*h;u*o<0&&(y-=Math.PI*Math.sign(e)*h);let b=Ht(qr(y/o)+this.center[0],-180,180),T=Ht(qr(2*Math.atan(Math.pow(l/g,1/o))-gd),-hr,hr);return new cn(b,this.southernCenter?-T:T)}}class aD extends jl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Es(e),y:Is(n),z:0}}unproject(e,n){let o=Di(e),l=kr(n);return new cn(o,l)}}let lD=en(hr);class $F extends jl{project(e,n){let o=(n=en(n))*n,l=o*o;return{x:.5*((e=en(e))*(.8707-.131979*o+l*(l*(.003971*o-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+o*(.015085+l*(.028874*o-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,l=25,u=0,h=o*o;do{h=o*o;let b=h*h;u=(o*(1.007226+h*(.015085+b*(.028874*h-.044475-.005916*b)))-n)/(1.007226+h*(.045255+b*(.259866*h-.311325-.005916*11*b))),o=Ht(o-u,-lD,lD)}while(Math.abs(u)>1e-6&&--l>0);h=o*o;let g=Ht(qr(e/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),y=qr(o);return new cn(g,y)}}let cD=en(hr);class GF extends jl{project(e,n){n=en(n),e=en(e);let o=Math.cos(n),l=2/Math.PI,u=Math.acos(o*Math.cos(e/2)),h=Math.sin(u)/u,g=.5*(e*l+2*o*Math.sin(e/2)/h)||0,y=.5*(n+Math.sin(n)/h)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,n){let o=e=(2*e-.5)*Math.PI,l=n=(2*(1-n)-1)*Math.PI,u=25,h=1e-6,g=0,y=0;do{let b=Math.cos(l),T=Math.sin(l),I=2*T*b,D=T*T,P=b*b,R=Math.cos(o/2),L=Math.sin(o/2),N=2*R*L,j=L*L,Y=1-P*R*R,X=Y?1/Y:0,K=Y?Math.acos(b*R)*Math.sqrt(1/Y):0,ae=.5*(2*K*b*L+2*o/Math.PI)-e,oe=.5*(K*T+l)-n,fe=.5*X*(P*j+K*b*R*D)+1/Math.PI,me=X*(N*I/4-K*T*L),we=.125*X*(I*L-K*T*P*N),Pe=.5*X*(D*R+K*j*b)+.5,Ce=me*we-Pe*fe;g=(oe*me-ae*Pe)/Ce,y=(ae*we-oe*fe)/Ce,o=Ht(o-g,-Math.PI,Math.PI),l=Ht(l-y,-cD,cD)}while((Math.abs(g)>h||Math.abs(y)>h)&&--u>0);return new cn(qr(o),qr(l))}}class uD extends jl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(en(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:o,cosPhi:l}=this;return{x:en(e)*l*o+.5,y:-Math.sin(en(n))/l*o+.5,z:0}}unproject(e,n){let{scale:o,cosPhi:l}=this,u=-(n-.5)/o,h=Ht(qr((e-.5)/o)/l,-180,180),g=Math.asin(Ht(u*l,-1,1)),y=Ht(qr(g),-hr,hr);return new cn(h,y)}}class HF extends aD{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,o){let l=Rp(e,n,o),u=Op(Cs(o));return r._.transformMat4(l,l,u),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,n){let o=uu(n.lat,n.lng),l=r._.normalize([],o),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,h=wi(1,0)*rt*u;r._.scaleAndAdd(o,o,l,h);let g=r.ad.identity(new Float64Array(16));return r.ad.multiply(g,e.pixelMatrix,e.globeMatrix),r._.transformMat4(o,o,g),new at(o[0],o[1])}pixelsPerMeter(e,n){return wi(1,0)*n}pixelSpaceConversion(e,n,o){let l=wi(1,e)*n,u=bt(wi(1,45)*n,l,o);return this.pixelsPerMeter(e,n)/u}createTileMatrix(e,n,o){let l=t1(Cs(o.canonical));return r.ad.multiply(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,n){let{center:o}=e,l=Op(Cs(n));return r.ad.rotateY(l,l,en(o.lng)),r.ad.rotateX(l,l,en(o.lat)),r.ad.scale(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,n,o,l){return _I(e,n,o,!0)||new si(0,0)}pointCoordinate3D(e,n,o){let l=this.pointCoordinate(e,n,o,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,n){return!_I(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(l,u){let h=l.cameraToCenterDistance,g=l._centerAltitude*u,y=l._camera,b=l._camera.forward(),T=r._.add([],r._.scale([],b,-h),[0,0,g]),I=l.worldSize/(2*Math.PI),D=[0,0,-I],P=l.width/l.height,R=Math.tan(l.fovAboveCenter),L=r._.scale([],y.up(),R),N=r._.scale([],y.right(),R*P),j=r._.normalize([],r._.add([],r._.add([],b,L),N)),Y=[],X;if(new Xx(T,j).closestPointOnSphere(D,I,Y)){let K=r._.add([],Y,D),ae=r._.sub([],K,T);X=Math.cos(l.fovAboveCenter)*r._.length(ae)}else{let K=r._.sub([],T,D),ae=r._.sub([],D,T);r._.normalize(ae,ae);let oe=r._.length(K)-I;X=Math.sqrt(oe*(oe+2*I));let fe=Math.acos(X/(I+oe))-Math.acos(r._.dot(b,ae));X*=Math.cos(fe)}return 1.01*X}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=wa(e.zoom);if(o>0){let l=oD(e,wi(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),h=Math.max(e.width,e.height)/e.worldSize*Math.PI;return bt(n,l+u*(1-Math.cos(h)),Math.pow(o,10))}return n}upVector(e,n,o){return Rp(n,o,e,1)}upVectorScale(e){return{metersToTile:S_(A_(Cs(e)))}}}function hD(t){let e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new aD(t);case"equirectangular":return new jF(t);case"naturalEarth":return new $F(t);case"equalEarth":return new VF(t);case"winkelTripel":return new GF(t);case"albers":return n?new uD(t):new BF(t);case"lambertConformalConic":return n?new uD(t):new UF(t);case"globe":return new HF(t)}throw new Error(`Invalid projection name: ${t.name}`)}let qF=(()=>{class t{constructor(n,o,l,u){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=n;let h=n.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||u||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;let o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})();class _d{constructor(e,n,o){this.func=e,this.mask=n,this.range=o}}_d.ReadOnly=!1,_d.ReadWrite=!0,_d.disabled=new _d(519,_d.ReadOnly,[0,1]);let I1=7680;class C1{constructor(e,n,o,l,u,h){this.test=e,this.ref=n,this.mask=o,this.fail=l,this.depthFail=u,this.pass=h}}C1.disabled=new C1({func:519,mask:0},0,0,I1,I1,I1);let Xp=771;class Vi{constructor(e,n,o,l){this.blendFunction=e,this.blendColor=n,this.mask=o,this.blendEquation=l}}Vi.Replace=[1,0,1,0],Vi.disabled=new Vi(Vi.Replace,pn.transparent,[!1,!1,!1,!1]),Vi.unblended=new Vi(Vi.Replace,pn.transparent,[!0,!0,!0,!0]),Vi.alphaBlended=new Vi([1,Xp,1,Xp],pn.transparent,[!0,!0,!0,!0]),Vi.alphaBlendedNonPremultiplied=new Vi([770,Xp,770,Xp],pn.transparent,[!0,!0,!0,!0]),Vi.multiply=new Vi([774,0,774,0],pn.transparent,[!0,!0,!0,!0]);let D1=1029,S1=2305;class qo{constructor(e,n,o){this.enable=e,this.mode=n,this.frontFace=o}}qo.disabled=new qo(!1,D1,S1),qo.backCCW=new qo(!0,D1,S1),qo.backCW=new qo(!0,D1,2304),qo.frontCW=new qo(!0,1028,2304),qo.frontCCW=new qo(!0,1028,S1);let WF=N_.types,ZF=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ty(t,e,n,o,l,u,h,g,y,b,T,I,D){let P=g?Math.min(Vl,Math.round(g[0])):0,R=g?Math.min(Vl,Math.round(g[1])):0;t.emplaceBack(e,n,Math.round(32*o),Math.round(32*l),u,h,(P<<1)+(y?1:0),R,16*b,16*T,256*I,256*D)}function ny(t,e,n){t.emplaceBack(e,n)}function ry(t,e,n,o,l,u,h){t.emplaceBack(e,n,o,l,u,h)}function iy(t,e,n,o,l){t.emplaceBack(e,n,o,l),t.emplaceBack(e,n,o,l),t.emplaceBack(e,n,o,l),t.emplaceBack(e,n,o,l)}function YF(t){for(let e of t.sections)if(ke(e.text))return!0;return!1}class M1{constructor(e){this.layoutVertexArray=new vx,this.indexArray=new Ir,this.programConfigurations=e,this.segments=new Jn,this.dynamicLayoutVertexArray=new Sl,this.opacityVertexArray=new bx,this.occlusionQueryOpacityVertexArray=new au,this.placedSymbolArray=new jE,this.iconTransitioningVertexArray=new Pl,this.globeExtVertexArray=new xx,this.zOffsetVertexArray=new au}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,o,l,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,XL.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,QL.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ZF,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,p1.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,JL.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,KL.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,vC.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Q(M1,"SymbolBuffers");class A1{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new Jn,this.collisionVertexArray=new Ex,this.collisionVertexArrayExt=new Sl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,eF.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,tF.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Q(A1,"CollisionBuffers");class yd{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=r.ad.identity([]),this.placementViewportMatrix=r.ad.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=g1(this.zoom,n["text-size"]),this.iconSizeData=g1(this.zoom,n["icon-size"]);let o=this.layers[0].layout,l=o.get("symbol-sort-key"),u=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(h=>io[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new M1(new Ol(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new M1(new Ol(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new GE,this.lineVertexArray=new HE,this.symbolInstances=new $E}calculateGlyphDependencies(e,n,o,l,u){for(let h=0;h<e.length;h++){let g=e.codePointAt(h);if(g===void 0)break;if(n[g]=!0,l&&u&&g<=65535){let y=Up[e.charAt(h)];y&&(n[y.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let o=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!d1(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,n,o,l){let u=this.layers[0],h=u.layout,g=this.projection.name==="globe",y=h.get("text-font"),b=h.get("text-field"),T=h.get("icon-image"),I=(b.value.kind!=="constant"||b.value.value instanceof Zr&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),D=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,P=h.get("symbol-sort-key");if(this.features=[],!I&&!D)return;let R=n.iconDependencies,L=n.glyphDependencies,N=n.availableImages,j=new Lt(this.zoom);for(let{feature:Y,id:X,index:K,sourceLayerIndex:ae}of e){let oe=u._featureFilter.needGeometry,fe=xa(Y,oe);if(!u._featureFilter.filter(j,fe,o))continue;if(oe||(fe.geometry=$o(Y,o,l)),g&&Y.type!==1&&o.z<=5){let Ce=fe.geometry,Le=.98078528056,Ye=(Oe,He)=>{let Re=Rp(Oe.x,Oe.y,o,1),qe=Rp(He.x,He.y,o,1);return r._.dot(Re,qe)<Le};for(let Oe=0;Oe<Ce.length;Oe++)Ce[Oe]=Ok(Ce[Oe],Ye)}let me,we;if(I){let Ce=u.getValueAndResolveTokens("text-field",fe,o,N),Le=Zr.factory(Ce);YF(Le)&&(this.hasRTLText=!0),(!this.hasRTLText||tn()==="unavailable"||this.hasRTLText&&In.isParsed())&&(me=bF(Le,u,fe))}if(D){let Ce=u.getValueAndResolveTokens("icon-image",fe,o,N);we=Ce instanceof hi?Ce:hi.fromString(Ce)}if(!me&&!we)continue;let Pe=this.sortFeaturesByKey?P.evaluate(fe,{},o):void 0;if(this.features.push({id:X,text:me,icon:we,index:K,sourceLayerIndex:ae,geometry:fe.geometry,properties:Y.properties,type:WF[Y.type],sortKey:Pe}),we&&(R[we.namePrimary]=!0,we.nameSecondary&&(R[we.nameSecondary]=!0)),me){let Ce=y.evaluate(fe,{},o).join(","),Le=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(io.vertical)>=0;for(let Ye of me.sections)if(Ye.image)R[Ye.image.namePrimary]=!0;else{let Oe=Ie(me.toString()),He=Ye.fontStack||Ce,Re=L[He]=L[He]||{};this.calculateGlyphDependencies(Ye.text,Re,Le,this.allowVerticalPlacement,Oe)}}}h.get("symbol-placement")==="line"&&(this.features=function(Y){let X={},K={},ae=[],oe=0;function fe(Ce){ae.push(Y[Ce]),oe++}function me(Ce,Le,Ye){let Oe=K[Ce];return delete K[Ce],K[Le]=Oe,ae[Oe].geometry[0].pop(),ae[Oe].geometry[0]=ae[Oe].geometry[0].concat(Ye[0]),Oe}function we(Ce,Le,Ye){let Oe=X[Le];return delete X[Le],X[Ce]=Oe,ae[Oe].geometry[0].shift(),ae[Oe].geometry[0]=Ye[0].concat(ae[Oe].geometry[0]),Oe}function Pe(Ce,Le,Ye){let Oe=Ye?Le[0][Le[0].length-1]:Le[0][0];return`${Ce}:${Oe.x}:${Oe.y}`}for(let Ce=0;Ce<Y.length;Ce++){let Le=Y[Ce],Ye=Le.geometry,Oe=Le.text?Le.text.toString():null;if(!Oe){fe(Ce);continue}let He=Pe(Oe,Ye),Re=Pe(Oe,Ye,!0);if(He in K&&Re in X&&K[He]!==X[Re]){let qe=we(He,Re,Ye),Qe=me(He,Re,ae[qe].geometry);delete X[He],delete K[Re],K[Pe(Oe,ae[Qe].geometry,!0)]=Qe,ae[qe].geometry=null}else He in K?me(He,Re,Ye):Re in X?we(He,Re,Ye):(fe(Ce),X[He]=oe-1,K[Re]=oe-1)}return ae.filter(Ce=>Ce.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Y,X)=>Y.sortKey-X.sortKey)}update(e,n,o,l,u){let h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;let g=h?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,g,o,l,u),this.icon.programConfigurations.updatePaintArrays(e,n,g,o,l,u)}updateOcclusionOpacities(e,n,o){if(!n.useOcclusionQueries)return!1;let l=this;if(l.projection.name==="globe")return!1;let u=!1;l.hasTextData()&&(u=u||l.text.occlusionQueryOpacityVertexArray.length!==0),l.hasIconData()&&(u=u||l.icon.occlusionQueryOpacityVertexArray.length!==0);let h=l.layers[0].paint,g=h.get("icon-occlusion-opacity").constantOr(0)!==1,y=h.get("text-occlusion-opacity").constantOr(0)!==1;if(!g&&!y)return!1;let b=!u;for(let P=0;P<l.symbolInstances.length;P++){let R=l.symbolInstances.get(P),L=R.occlusionOpacity;R.occlusionOpacity+=(R.occlusionState>.5?1:-1)*n.fadeSpeed*o*.001,R.occlusionOpacity=Ht(R.occlusionOpacity,0,1),b=b||R.occlusionOpacity!==L}if(!b)return!1;let T=0,I=0,D=(P,R,L,N)=>{let j=0,Y=0;L?(j=I,I+=N,Y=I):(j=T,T+=N,Y=T),Y>R.occlusionQueryOpacityVertexArray.length&&R.occlusionQueryOpacityVertexArray.resize(Y);let X=P.occlusionOpacity;for(let K=0;K<N;K++)R.occlusionQueryOpacityVertexArray.emplace(K+j,X)};for(let P=0;P<l.symbolInstances.length;P++){let R=l.symbolInstances.get(P),{numHorizontalGlyphVertices:L,numVerticalGlyphVertices:N,numIconVertices:j}=R,Y=j>0;if((L>0||N>0)&&(D(R,l.text,!1,L),D(R,l.text,!1,N)),Y){let{placedIconSymbolIndex:X,verticalPlacedIconSymbolIndex:K}=R;X>=0&&D(R,l.icon,!0,j),K>=0&&D(R,l.icon,!0,R.numVerticalIconVertices)}}return l.hasTextData()&&l.text.occlusionQueryOpacityVertexBuffer&&(l.text.occlusionQueryOpacityVertexBuffer.length<l.text.occlusionQueryOpacityVertexArray.length?l.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(l.text.occlusionQueryOpacityVertexArray,p1.members,!0):l.text.occlusionQueryOpacityVertexBuffer.updateData(l.text.occlusionQueryOpacityVertexArray)),l.hasIconData()&&l.icon.occlusionQueryOpacityVertexBuffer&&(l.icon.occlusionQueryOpacityVertexBuffer.length<l.icon.occlusionQueryOpacityVertexArray.length?l.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(l.icon.occlusionQueryOpacityVertexArray,p1.members,!0):l.icon.occlusionQueryOpacityVertexBuffer.updateData(l.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){let e=(u,h,g)=>{o+=h,o>u.length&&u.resize(o);for(let y=-h;y<0;y++)u.emplace(y+o,g)},n=(u,h,g)=>{l+=h,l>u.length&&u.resize(l);for(let y=-h;y<0;y++)u.emplace(y+l,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,l=0;for(let u=0;u<this.symbolInstances.length;u++){let h=this.symbolInstances.get(u),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:y,numIconVertices:b}=h,T=h.zOffset,I=b>0;if((g>0||y>0)&&(e(this.text.zOffsetVertexArray,g,T),e(this.text.zOffsetVertexArray,y,T)),I){let{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:P}=h;D>=0&&n(this.icon.zOffsetVertexArray,b,T),P>=0&&n(this.icon.zOffsetVertexArray,h.numVerticalIconVertices,T)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=hD(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(let e of this.queries.values())e.destroy()}addToLineVertexArray(e,n){let o=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:l,y:u}of n)this.lineVertexArray.emplaceBack(l,u);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,l,u,h,g,y,b,T,I,D,P,R,L,N){let j=e.indexArray,Y=e.layoutVertexArray,X=e.globeExtVertexArray,K=e.segments.prepareSegment(4*n.length,Y,j,this.canOverlap?h.sortKey:void 0),ae=this.glyphOffsetArray.length,oe=K.vertexLength,fe=this.allowVerticalPlacement&&g===io.vertical?Math.PI/2:0,me=h.text&&h.text.sections;for(let Pe=0;Pe<n.length;Pe++){let{tl:Ce,tr:Le,bl:Ye,br:Oe,texPrimary:He,texSecondary:Re,pixelOffsetTL:qe,pixelOffsetBR:Qe,minFontScaleX:Ze,minFontScaleY:ht,glyphOffset:Xe,isSDF:tt,sectionIndex:vt}=n[Pe],yt=K.vertexLength,mt=Xe[1];if(ty(Y,b.x,b.y,Ce.x,mt+Ce.y,He.x,He.y,o,tt,qe.x,qe.y,Ze,ht),ty(Y,b.x,b.y,Le.x,mt+Le.y,He.x+He.w,He.y,o,tt,Qe.x,qe.y,Ze,ht),ty(Y,b.x,b.y,Ye.x,mt+Ye.y,He.x,He.y+He.h,o,tt,qe.x,Qe.y,Ze,ht),ty(Y,b.x,b.y,Oe.x,mt+Oe.y,He.x+He.w,He.y+He.h,o,tt,Qe.x,Qe.y,Ze,ht),y){let{x:et,y:xt,z:Vt}=y.anchor,[Dt,$t,jt]=y.up;ry(X,et,xt,Vt,Dt,$t,jt),ry(X,et,xt,Vt,Dt,$t,jt),ry(X,et,xt,Vt,Dt,$t,jt),ry(X,et,xt,Vt,Dt,$t,jt),iy(e.dynamicLayoutVertexArray,et,xt,Vt,fe)}else iy(e.dynamicLayoutVertexArray,b.x,b.y,b.z,fe);if(N){let et=Re||He;ny(e.iconTransitioningVertexArray,et.x,et.y),ny(e.iconTransitioningVertexArray,et.x+et.w,et.y),ny(e.iconTransitioningVertexArray,et.x,et.y+et.h),ny(e.iconTransitioningVertexArray,et.x+et.w,et.y+et.h)}j.emplaceBack(yt,yt+1,yt+2),j.emplaceBack(yt+1,yt+2,yt+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Xe[0]),Pe!==n.length-1&&vt===n[Pe+1].sectionIndex||e.programConfigurations.populatePaintArrays(Y.length,h,h.index,{},P,R,L,me&&me[vt])}let we=y?y.anchor:b;e.placedSymbolArray.emplaceBack(we.x,we.y,we.z,b.x,b.y,ae,this.glyphOffsetArray.length-ae,oe,T,I,b.segment,o?o[0]:0,o?o[1]:0,l[0],l[1],g,0,!1,0,D,0)}_commitLayoutVertex(e,n,o,l,u,h,g){e.emplaceBack(n,o,l,u,h,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,n,o,l,u,h,g){let y=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),b=y.vertexLength,T=g.tileAnchorX,I=g.tileAnchorY;for(let P=0;P<4;P++)o.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,n,e.padding,g.zOffset),this._commitLayoutVertex(o.layoutVertexArray,l,u,h,T,I,new at(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,l,u,h,T,I,new at(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,l,u,h,T,I,new at(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,l,u,h,T,I,new at(e.x1,e.y2)),y.vertexLength+=4;let D=o.indexArray;D.emplaceBack(b,b+1),D.emplaceBack(b+1,b+2),D.emplaceBack(b+2,b+3),D.emplaceBack(b+3,b),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,o,l,u,h){for(let g=l;g<u;g++){let y=o.get(g),b=this.getSymbolInstanceTextSize(e,h,n,g);this._addCollisionDebugVertices(y,b,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,n,o,l,u,h){for(let g=l;g<u;g++){let y=o.get(g),b=this.getSymbolInstanceIconSize(e,n,h.placedIconSymbolIndex);this._addCollisionDebugVertices(y,b,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new A1(v_,xC.members,Pl),this.iconCollisionBox=new A1(v_,xC.members,Pl);let o=dd(this.iconSizeData,e),l=dd(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){let h=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(l,e,n,h.textBoxStartIndex,h.textBoxEndIndex,h),this._addTextDebugCollisionBoxes(l,e,n,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._addIconDebugCollisionBoxes(o,e,n,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._addIconDebugCollisionBoxes(o,e,n,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}}getSymbolInstanceTextSize(e,n,o,l){let u=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:l),h=W_(this.textSizeData,e,u)/Kr;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,n,o){let l=this.icon.placedSymbolArray.get(o),u=W_(this.iconSizeData,e,l);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,n,o,l){e.emplaceBack(n,-o,-o,l),e.emplaceBack(n,o,-o,l),e.emplaceBack(n,o,o,l),e.emplaceBack(n,-o,o,l)}_updateTextDebugCollisionBoxes(e,n,o,l,u,h){for(let g=l;g<u;g++){let y=o.get(g),b=this.getSymbolInstanceTextSize(e,h,n,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,y.padding,h.zOffset)}}_updateIconDebugCollisionBoxes(e,n,o,l,u,h){for(let g=l;g<u;g++){let y=o.get(g),b=this.getSymbolInstanceIconSize(e,n,h.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,y.padding,h.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let o=dd(this.iconSizeData,e),l=dd(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){let h=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(l,e,n,h.textBoxStartIndex,h.textBoxEndIndex,h),this._updateTextDebugCollisionBoxes(l,e,n,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._updateIconDebugCollisionBoxes(o,e,n,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._updateIconDebugCollisionBoxes(o,e,n,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,o,l,u,h,g,y,b){let T={};if(n<o){let{x1:I,y1:D,x2:P,y2:R,padding:L,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K,featureIndex:ae}=e.get(n);T.textBox={x1:I,y1:D,x2:P,y2:R,padding:L,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K},T.textFeatureIndex=ae}if(l<u){let{x1:I,y1:D,x2:P,y2:R,padding:L,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K,featureIndex:ae}=e.get(l);T.verticalTextBox={x1:I,y1:D,x2:P,y2:R,padding:L,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K},T.verticalTextFeatureIndex=ae}if(h<g){let{x1:I,y1:D,x2:P,y2:R,padding:L,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K,featureIndex:ae}=e.get(h);T.iconBox={x1:I,y1:D,x2:P,y2:R,padding:L,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K},T.iconFeatureIndex=ae}if(y<b){let{x1:I,y1:D,x2:P,y2:R,padding:L,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K,featureIndex:ae}=e.get(y);T.verticalIconBox={x1:I,y1:D,x2:P,y2:R,padding:L,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Y,tileAnchorX:X,tileAnchorY:K},T.verticalIconFeatureIndex=ae}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let o=e.placedSymbolArray.get(n),l=o.vertexStartIndex+4*o.numGlyphs;for(let u=o.vertexStartIndex;u<l;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),o=Math.cos(e),l=[],u=[],h=[];for(let g=0;g<this.symbolInstances.length;++g){h.push(g);let y=this.symbolInstances.get(g);l.push(0|Math.round(n*y.tileAnchorX+o*y.tileAnchorY)),u.push(y.featureIndex)}return h.sort((g,y)=>l[g]-l[y]||u[y]-u[g]),h}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex);let{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:b}=o;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),u>=0&&u!==l&&this.addIndicesForPlacedSymbol(this.text,u),h>=0&&h!==u&&h!==l&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Q(yd,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),yd.addDynamicAttributes=iy;class Do{constructor(e,n,o,l){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(n,l)}update(e,n,o){let{width:l,height:u}=e,{context:h}=this,{gl:g}=h;if(g.bindTexture(g.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!n||n.premultiply!==!1)),o||this.size&&this.size[0]===l&&this.size[1]===u){let{x:y,y:b}=o||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)g.texSubImage2D(g.TEXTURE_2D,0,y,b,g.RGBA,g.UNSIGNED_BYTE,e);else{let T=this.format,I=g.UNSIGNED_BYTE;this.format===g.R32F&&(T=g.RED,I=g.FLOAT),g.texSubImage2D(g.TEXTURE_2D,0,y,b,l,u,T,I,e.data)}}else if(this.size=[l,u],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===g.R8&&(y=g.RED),g.texImage2D(g.TEXTURE_2D,0,this.format,y,g.UNSIGNED_BYTE,e)}else{let y=this.format,b=this.format,T=g.UNSIGNED_BYTE;this.format===g.DEPTH_COMPONENT&&(y=g.DEPTH_COMPONENT16,T=g.UNSIGNED_SHORT),this.format===g.R8&&(b=g.RED),this.format===g.R32F&&(T=g.FLOAT,b=g.RED),g.texImage2D(g.TEXTURE_2D,0,y,l,u,0,b,T,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,n,o=!1){let{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,o,l){let{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),n!==this.magFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),this.wrapS=o),l!==this.wrapT&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,l),this.wrapT=l)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class oy{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:o}=this,{gl:l}=o;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,n),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,n),this.wrapS=n)}}let So=32,Ss=33,Ul=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,o=0,l=0,u=0,h=0,g=0;for(1&e?l=u=h=So:n=o=g=So;(e>>=1)>1;){let b=n+l>>1,T=o+u>>1;1&e?(l=n,u=o,n=h,o=g):(n=l,o=u,l=h,u=g),h=b,g=T}let y=4*t;Ul[y+0]=n,Ul[y+1]=o,Ul[y+2]=l,Ul[y+3]=u}let Ms=new Uint16Array(2178),$l=new Uint8Array(1089),sy=new Uint16Array(1089);function dD(t){return t===0?-.03125:t===32?.03125:0}var ay=wn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),XF=wn([{name:"a_index",type:"Int16",components:1}]);let fD={type:2,extent:rt,loadGeometry:()=>[[new at(0,0),new at(rt+1,0),new at(rt+1,rt+1),new at(0,rt+1),new at(0,0)]]};class ly{constructor(e,n,o,l,u){this.tileID=e,this.uid=mh(),this.uses=0,this.tileSize=n,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,l&&l.style&&(this._lastUpdatedBrightness=l.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){let n=e+this.timeAdded;n<Rr.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=mu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,o){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,u){let h={};if(!u)return h;for(let g of l){let y=g.layerIds.map(b=>u.getLayer(b)).filter(Boolean);if(y.length!==0){g.layers=y,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(b=>y.filter(T=>T.id===b)[0]));for(let b of y)h[b.fqid]=g}}return h}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let l in this.buckets){let u=this.buckets[l];if(u instanceof yd){if(this.hasSymbolBuckets=!0,!o)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let l in this.buckets){let u=this.buckets[l];if(u instanceof yd&&u.hasRTLText){this.hasRTLText=!0,In.isLoading()||In.isLoaded()||tn()!=="deferred"||Kt();break}}this.queryPadding=0;for(let l in this.buckets){let u=this.buckets[l],h=n.style.getOwnLayer(l);if(!h)continue;let g=h.queryRadius(u);this.queryPadding=Math.max(this.queryPadding,g)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new Rx}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let l in this.buckets){let u=this.buckets[l];u.uploadPending()&&u.upload(e)}let n=e.gl,o=this.imageAtlas;if(o&&!o.uploaded){let l=!!Object.keys(o.patternPositions).length;this.imageAtlasTexture=new Do(e,o.image,n.RGBA,{useMipmap:l}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Do(e,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Do(e,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,n,o){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,o),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let l=n.style.getBrightness();(this._lastUpdatedBrightness||l)&&(this._lastUpdatedBrightness&&l&&Math.abs(this._lastUpdatedBrightness-l)<.001||(this._lastUpdatedBrightness=l,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,o,l,u,h,g,y){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:g,transform:h,params:u,tileTransform:this.tileTransform},e,n,o):{}}querySourceFeatures(e,n){let o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;let l=o.loadVTLayers(),u=n?n.sourceLayer:"",h=l._geojsonTileLayer||l[u];if(!h)return;let g=oi(n&&n.filter),{z:y,x:b,y:T}=this.tileID.canonical,I={z:y,x:b,y:T};for(let D=0;D<h.length;D++){let P=h.feature(D);if(g.needGeometry){let N=xa(P,!0);if(!g.filter(new Lt(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!g.filter(new Lt(this.tileID.overscaledZ),P))continue;let R=o.getId(P,u),L=new kC(P,y,b,T,R);L.tile=I,e.push(L)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let o=Rf(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let o=Date.now(),l=!1;if(this.expirationTime>o)l=!1;else if(n)if(this.expirationTime<n)l=!0;else{let u=this.expirationTime-n;u?this.expirationTime=o+Math.max(u,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;let o=this.latestFeatureIndex.loadVTLayers(),l=n.style.listImages(),u=n.style.getBrightness();for(let h in this.buckets){if(!n.style.hasLayer(h))continue;let g=this.buckets[h],y=g.layers[0].sourceLayer||"_geojsonTileLayer",b=o[y],T={};if(e&&(T=e[y],!b||!T||Object.keys(T).length===0))continue;if(g.update(T,b,l,this.imageAtlas&&this.imageAtlas.patternPositions||{},u),g instanceof $_||g instanceof L_){let D=n.style.getOwnSourceCache(g.layers[0].source);n._terrain&&n._terrain.enabled&&D&&g.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(D.id,this.tileID)}let I=n&&n.style&&n.style.getOwnLayer(h);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Rr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Rr.now()+e}setTexture(e,n){let o=n.context,l=o.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Do?this.texture.update(e,{useMipmap:!0}):(this.texture=new Do(o,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE))}setDependencies(e,n){let o={};for(let l of n)o[l]=!0;this.dependencies[e]=o}hasDependency(e,n){for(let o of e){let l=this.dependencies[o];if(l){for(let u of n)if(l[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;let o=$o(fD,this.tileID.canonical,this.tileTransform)[0],l=new jo,u=new Ip;for(let h=0;h<o.length;h++){let{x:g,y}=o[h];l.emplaceBack(g,y),u.emplaceBack(h)}u.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(l,Pp.members),this._tileDebugSegments=Jn.simpleSegment(0,0,l.length,u.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;let o=$o(fD,this.tileID.canonical,this.tileTransform)[0],l,u;if(this.isRaster){let h=function(g,y){let b=mu(g,y),T=Math.pow(2,g.z);for(let N=0;N<Ss;N++)for(let j=0;j<Ss;j++){let Y=Di((g.x+(j+dD(j))/So)/T),X=kr((g.y+(N+dD(N))/So)/T),K=y.project(Y,X),ae=N*Ss+j;Ms[2*ae+0]=Math.round((K.x*b.scale-b.x)*rt),Ms[2*ae+1]=Math.round((K.y*b.scale-b.y)*rt)}$l.fill(0),sy.fill(0);for(let N=2045;N>=0;N--){let j=4*N,Y=Ul[j+0],X=Ul[j+1],K=Ul[j+2],ae=Ul[j+3],oe=Y+K>>1,fe=X+ae>>1,me=oe+fe-X,we=fe+Y-oe,Pe=X*Ss+Y,Ce=ae*Ss+K,Le=fe*Ss+oe,Ye=Math.hypot((Ms[2*Pe+0]+Ms[2*Ce+0])/2-Ms[2*Le+0],(Ms[2*Pe+1]+Ms[2*Ce+1])/2-Ms[2*Le+1])>=16;$l[Le]=$l[Le]||(Ye?1:0),N<1022&&($l[Le]=$l[Le]||$l[(X+we>>1)*Ss+(Y+me>>1)]||$l[(ae+we>>1)*Ss+(K+me>>1)])}let I=new Dl,D=new Ir,P=0;function R(N,j){let Y=j*Ss+N;return sy[Y]===0&&(I.emplaceBack(Ms[2*Y+0],Ms[2*Y+1],N*rt/So,j*rt/So),sy[Y]=++P),sy[Y]-1}function L(N,j,Y,X,K,ae){let oe=N+Y>>1,fe=j+X>>1;if(Math.abs(N-K)+Math.abs(j-ae)>1&&$l[fe*Ss+oe])L(K,ae,N,j,oe,fe),L(Y,X,K,ae,oe,fe);else{let me=R(N,j),we=R(Y,X),Pe=R(K,ae);D.emplaceBack(me,we,Pe)}}return L(0,0,So,So,So,0),L(So,So,0,0,0,So),{vertices:I,indices:D}}(this.tileID.canonical,n);l=h.vertices,u=h.indices}else{l=new Dl,u=new Ir;for(let{x:g,y}of o)l.emplaceBack(g,y,0,0);let h=Lp(l.int16,void 0,4);for(let g=0;g<h.length;g+=3)u.emplaceBack(h[g],h[g+1],h[g+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,ay.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(u),this._tileBoundsSegments=Jn.simpleSegment(0,0,l.length,u.length)}_makeGlobeTileDebugBuffers(e,n){let o=n.projection;if(!o||o.name!=="globe"||n.freezeTileCoverage)return;let l=this.tileID.canonical,u=Op(yI(l,n)),h=wa(n.zoom),g;h>0&&(g=r.ad.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,l,n,u,g,h),this._makeGlobeTileDebugTextBuffer(e,l,n,u,g,h)}_globePoint(e,n,o,l,u,h,g){let y=Rp(e,n,o);if(h){let b=1<<o.z,T=Es(l.center.lng),I=Is(l.center.lat),D=(o.x+.5)/b-T,P=0;D>.5?P=-1:D<-.5&&(P=1);let R=(e/rt+o.x)/b+P,L=(n/rt+o.y)/b;R=(R-T)*l._pixelsPerMercatorPixel+T,L=(L-I)*l._pixelsPerMercatorPixel+I;let N=[R*l.worldSize,L*l.worldSize,0];r._.transformMat4(N,N,h),y=ba(y,N,g)}return r._.transformMat4(y,y,u)}_makeGlobeTileDebugBorderBuffer(e,n,o,l,u,h){let g=new jo,y=new Ip,b=new g_,T=(D,P,R,L,N)=>{let j=(R-D)/(N-1),Y=(L-P)/(N-1),X=g.length;for(let K=0;K<N;K++){let ae=D+K*j,oe=P+K*Y;g.emplaceBack(ae,oe);let fe=this._globePoint(ae,oe,n,o,l,u,h);b.emplaceBack(fe[0],fe[1],fe[2]),y.emplaceBack(X+K)}},I=rt;T(0,0,I,0,16),T(I,0,I,I,16),T(I,I,0,I,16),T(0,I,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(g,Pp.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(b,gI.members),this._tileDebugSegments=Jn.simpleSegment(0,0,g.length,y.length)}_makeGlobeTileDebugTextBuffer(e,n,o,l,u,h){let g=rt/4,y=new jo,b=new Ir,T=new g_,I=25;b.reserve(32),y.reserve(I),T.reserve(I);let D=(P,R)=>I*P+R;for(let P=0;P<I;P++){let R=P*g;for(let L=0;L<I;L++){let N=L*g;y.emplaceBack(N,R);let j=this._globePoint(N,R,n,o,l,u,h);T.emplaceBack(j[0],j[1],j[2])}}for(let P=0;P<4;P++)for(let R=0;R<4;R++){let L=D(P,R),N=D(P,R+1),j=D(P+1,R),Y=D(P+1,R+1);b.emplaceBack(L,N,j),b.emplaceBack(j,N,Y)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(b),this._tileDebugTextBuffer=e.createVertexBuffer(y,Pp.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(T,gI.members),this._tileDebugTextSegments=Jn.simpleSegment(0,0,I,32)}destroy(e=!1){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof Do&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let zt={read:function(t,e){return t.readFields(zt._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,n){t===1?e.header_length=n.readFixed32():t===2?e.x=n.readVarint():t===3?e.y=n.readVarint():t===4?e.z=n.readVarint():t===5&&e.layers.push(zt.Layer.read(n,n.readVarint()+n.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};zt.Filter.read=function(t,e){return t.readFields(zt.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},zt.Filter._readField=function(t,e,n){t===1?(e.delta_filter=zt.Filter.Delta.read(n,n.readVarint()+n.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=zt.Filter.Zigzag.read(n,n.readVarint()+n.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=zt.Filter.BitShuffle.read(n,n.readVarint()+n.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=zt.Filter.ByteShuffle.read(n,n.readVarint()+n.pos),e.filter="byteshuffle_filter")},zt.Filter.Delta={},zt.Filter.Delta.read=function(t,e){return t.readFields(zt.Filter.Delta._readField,{block_size:0},e)},zt.Filter.Delta._readField=function(t,e,n){t===1&&(e.block_size=n.readVarint())},zt.Filter.Zigzag={},zt.Filter.Zigzag.read=function(t,e){return t.readFields(zt.Filter.Zigzag._readField,{},e)},zt.Filter.Zigzag._readField=function(t,e,n){},zt.Filter.BitShuffle={},zt.Filter.BitShuffle.read=function(t,e){return t.readFields(zt.Filter.BitShuffle._readField,{},e)},zt.Filter.BitShuffle._readField=function(t,e,n){},zt.Filter.ByteShuffle={},zt.Filter.ByteShuffle.read=function(t,e){return t.readFields(zt.Filter.ByteShuffle._readField,{},e)},zt.Filter.ByteShuffle._readField=function(t,e,n){},zt.Codec={},zt.Codec.read=function(t,e){return t.readFields(zt.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},zt.Codec._readField=function(t,e,n){t===1?(e.gzip_data=zt.Codec.GzipData.read(n,n.readVarint()+n.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=zt.Codec.JpegImage.read(n,n.readVarint()+n.pos),e.codec="jpeg_image"):t===3?(e.webp_image=zt.Codec.WebpImage.read(n,n.readVarint()+n.pos),e.codec="webp_image"):t===4&&(e.png_image=zt.Codec.PngImage.read(n,n.readVarint()+n.pos),e.codec="png_image")},zt.Codec.GzipData={},zt.Codec.GzipData.read=function(t,e){return t.readFields(zt.Codec.GzipData._readField,{},e)},zt.Codec.GzipData._readField=function(t,e,n){},zt.Codec.JpegImage={},zt.Codec.JpegImage.read=function(t,e){return t.readFields(zt.Codec.JpegImage._readField,{},e)},zt.Codec.JpegImage._readField=function(t,e,n){},zt.Codec.WebpImage={},zt.Codec.WebpImage.read=function(t,e){return t.readFields(zt.Codec.WebpImage._readField,{},e)},zt.Codec.WebpImage._readField=function(t,e,n){},zt.Codec.PngImage={},zt.Codec.PngImage.read=function(t,e){return t.readFields(zt.Codec.PngImage._readField,{},e)},zt.Codec.PngImage._readField=function(t,e,n){},zt.DataIndexEntry={},zt.DataIndexEntry.read=function(t,e){return t.readFields(zt.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},zt.DataIndexEntry._readField=function(t,e,n){t===1?e.first_byte=n.readFixed64():t===2?e.last_byte=n.readFixed64():t===3?e.filters.push(zt.Filter.read(n,n.readVarint()+n.pos)):t===4?e.codec=zt.Codec.read(n,n.readVarint()+n.pos):t===5?e.offset=n.readFloat():t===6?e.scale=n.readFloat():t===7&&e.bands.push(n.readString())},zt.Layer={},zt.Layer.read=function(t,e){return t.readFields(zt.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},zt.Layer._readField=function(t,e,n){t===1?e.version=n.readVarint():t===2?e.name=n.readString():t===3?e.units=n.readString():t===4?e.tilesize=n.readVarint():t===5?e.buffer=n.readVarint():t===6?e.pixel_format=n.readVarint():t===7&&e.data_index.push(zt.DataIndexEntry.read(n,n.readVarint()+n.pos))};let Wo={read:function(t,e){return t.readFields(Wo._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,n){t===2?(e.uint32_values=Wo.Uint32Values.read(n,n.readVarint()+n.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=Wo.Fixed32Values.read(n,n.readVarint()+n.pos),e.values="fixed32_values")},Uint32Values:{}};Wo.Uint32Values.read=function(t,e){return t.readFields(Wo.Uint32Values._readField,{values:[]},e)},Wo.Uint32Values._readField=function(t,e,n){t===1&&(e.readValuesInto=function(o){if(o.type!==2)throw new Error(`Unsupported pbf type "${o.type}"`);let l=function(h){return h.type===2?h.readVarint()+h.pos:h.pos+1}(o),u=o.pos;return o.pos=l,function(h){o.pos=u;let g=0;for(;o.pos<l;){let y=o.readVarint();h[g++]=y}return h}}(n))},Wo.Fixed32Values={},Wo.Fixed32Values.read=function(t,e){return t.readFields(Wo.Fixed32Values._readField,{values:[]},e)},Wo.Fixed32Values._readField=function(t,e,n){throw new Error("Not implemented")};class KF{constructor(e=0,n=0,o=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=o,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let n=this.items[e];delete this.items[e],this.size--,n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){let n=this.first;delete this.items[n.key],--this.size==0?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){let o=this.items[e];this.ttl>0&&o.expiry<=Date.now()?this.delete(e):(n=o.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){let e=[],n=this.first;for(;n!==null;)e.push(n.key),n=n.next;return e}set(e,n,o=!1,l=this.resetTtl){let u;if(o||this.has(e)){if(u=this.items[e],u.value=n,o===!1&&l&&(u.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==u){let h=this.last,g=u.next,y=u.prev;this.first===u&&(this.first=u.next),u.next=null,u.prev=this.last,h.next=u,y!==null&&(y.next=g),g!==null&&(g.prev=y)}}else this.max>0&&this.size===this.max&&this.evict(!0),u=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},++this.size==1?this.first=u:this.last.next=u;return this.last=u,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function QF(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let o=2;o>=1;o--){let l=o===1?1:0,u=o===2?1:0;for(let h=0;h<e[0];h++){let g=e[1]*h;for(let y=l;y<e[1];y++){let b=e[2]*(y+g);for(let T=u;T<e[2];T++){let I=e[3]*(T+b);for(let D=0;D<e[3];D++){let P=I+D;t[P]+=t[P-n]}}}}n*=e[o]}return t}function JF(t){for(let e=0,n=t.length;e<n;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function eN(t,e){switch(e){case"uint32":return t;case"uint16":for(let n=0;n<t.length;n+=2){let o=t[n],l=t[n+1];t[n]=(240&o)>>4|(61440&o)>>8|(240&l)<<4|61440&l,t[n+1]=15&o|(3840&o)>>4|(15&l)<<8|(3840&l)<<4}return t;case"uint8":for(let n=0;n<t.length;n+=4){let o=t[n],l=t[n+1],u=t[n+2],h=t[n+3];t[n+0]=(192&o)>>6|(192&l)>>4|(192&u)>>2|192&h,t[n+1]=(48&o)>>4|(48&l)>>2|48&u|(48&h)<<2,t[n+2]=(12&o)>>2|12&l|(12&u)<<2|(12&h)<<4,t[n+3]=3&o|(3&l)<<2|(3&u)<<4|(3&h)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Gl extends Error{constructor(e){super(e),this.name="MRTError"}}var oo=Uint8Array,vd=Uint16Array,tN=Int32Array,pD=new oo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),mD=new oo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),nN=new oo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gD=function(t,e){for(var n=new vd(31),o=0;o<31;++o)n[o]=e+=1<<t[o-1];var l=new tN(n[30]);for(o=1;o<30;++o)for(var u=n[o];u<n[o+1];++u)l[u]=u-n[o]<<5|o;return{b:n,r:l}},_D=gD(pD,2),yD=_D.b,rN=_D.r;yD[28]=258,rN[258]=28;for(var iN=gD(mD,0).b,P1=new vd(32768),fr=0;fr<32768;++fr){var xd=(43690&fr)>>1|(21845&fr)<<1;P1[fr]=((65280&(xd=(61680&(xd=(52428&xd)>>2|(13107&xd)<<2))>>4|(3855&xd)<<4))>>8|(255&xd)<<8)>>1}var Kp=function(t,e,n){for(var o=t.length,l=0,u=new vd(e);l<o;++l)t[l]&&++u[t[l]-1];var h,g=new vd(e);for(l=1;l<e;++l)g[l]=g[l-1]+u[l-1]<<1;if(n){h=new vd(1<<e);var y=15-e;for(l=0;l<o;++l)if(t[l])for(var b=l<<4|t[l],T=e-t[l],I=g[t[l]-1]++<<T,D=I|(1<<T)-1;I<=D;++I)h[P1[I]>>y]=b}else for(h=new vd(o),l=0;l<o;++l)t[l]&&(h[l]=P1[g[t[l]-1]++]>>15-t[l]);return h},Qp=new oo(288);for(fr=0;fr<144;++fr)Qp[fr]=8;for(fr=144;fr<256;++fr)Qp[fr]=9;for(fr=256;fr<280;++fr)Qp[fr]=7;for(fr=280;fr<288;++fr)Qp[fr]=8;var vD=new oo(32);for(fr=0;fr<32;++fr)vD[fr]=5;var oN=Kp(Qp,9,1),sN=Kp(vD,5,1),R1=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},Zo=function(t,e,n){var o=e/8|0;return(t[o]|t[o+1]<<8)>>(7&e)&n},O1=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},aN=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Yo=function(t,e,n){var o=new Error(e||aN[t]);if(o.code=t,Error.captureStackTrace&&Error.captureStackTrace(o,Yo),!n)throw o;return o},lN=new oo(0),cN=typeof TextDecoder<"u"&&new TextDecoder;try{cN.decode(lN,{stream:!0})}catch{}let uN={gzip_data:"gzip"},hN={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},dN={uint32:1,uint16:2,uint8:4},fN={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class k1{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let n=new Uint8Array(e),o=new DataView(e);if(n[0]!==13)throw new Gl("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){let n=new Uint8Array(e),o=this.getHeaderLength(e);if(n.length<o)throw new Gl(`Expected header with length >= ${o} but got buffer of length ${n.length}`);let l=new hd(n.subarray(0,o)),u=zt.read(l);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new Gl(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(let h of u.layers)this.layers[h.name]=new pN(h,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let n=[],o=this.getLayer(e.layerName);for(let l=0;l<o.dataIndex.length;l++){let u=o.dataIndex[l],h=u.first_byte-e.firstByte,g=u.last_byte+1-e.firstByte;if(l<e.firstBlock||l>e.lastBlock||o._blocksInProgress.has(l))continue;let y={layerName:o.name,firstByte:h,lastByte:g,pixelFormat:o.pixelFormat,blockIndex:l,blockShape:[u.bands.length].concat(o.bandShape),buffer:o.buffer,codec:u.codec.codec,filters:u.filters.map(b=>b.filter)};o._blocksInProgress.add(l),n.push(y)}return new xD(n,()=>{n.forEach(l=>o._blocksInProgress.delete(l.blockIndex))},(l,u)=>{if(n.forEach(h=>o._blocksInProgress.delete(h.blockIndex)),l)throw l;u.forEach(h=>{this.getLayer(h.layerName).processDecodedData(h)})})}}class pN{constructor({version:e,name:n,units:o,tilesize:l,pixel_format:u,buffer:h,data_index:g},y){if(this.version=e,this.version!==1)throw new Gl(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=o,this.tileSize=l,this.buffer=h,this.pixelFormat=hN[u],this.dataIndex=g,this.bandShape=[l+2*h,l+2*h,dN[this.pixelFormat]],this._decodedBlocks=function(b=1e3,T=0,I=!1){if(isNaN(b)||b<0)throw new TypeError("Invalid max value");if(isNaN(T)||T<0)throw new TypeError("Invalid ttl value");if(typeof I!="boolean")throw new TypeError("Invalid resetTtl value");return new KF(b,T,I)}(y?y.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(let[o,l]of this.dataIndex.entries()){for(let[u,h]of l.bands.entries())if(h===e)return{bandIndex:n+u,blockIndex:o,blockBandIndex:u};n+=l.bands.length}break;case"number":for(let[o,l]of this.dataIndex.entries()){if(e>=n&&e<n+l.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-n};n+=l.bands.length}break;default:throw new Gl(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Gl(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,o=-1/0,l=1/0,u=-1/0;for(let h of e){let{blockIndex:g}=this.getBlockForBand(h);if(g<0)throw new Gl(`Invalid band: ${JSON.stringify(h)}`);let y=this.dataIndex[g];l=Math.min(l,g),u=Math.max(u,g),n=Math.min(n,y.first_byte),o=Math.max(o,y.last_byte)}return{layerName:this.name,firstByte:n,lastByte:o,firstBlock:l,lastBlock:u}}hasBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){let{blockIndex:n,blockBandIndex:o}=this.getBlockForBand(e),l=this._decodedBlocks.get(n.toString());if(!l)throw new Gl(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let u=this.dataIndex[n],h=this.bandShape.reduce((b,T)=>b*T,1),g=o*h,y=l.subarray(g,g+h);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:u.offset,scale:u.scale}}}class xD{constructor(e,n,o){this.tasks=e,this._onCancel=n,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}k1.performDecoding=function(t,e){return Promise.all(e.tasks.map(n=>{let{layerName:o,firstByte:l,lastByte:u,pixelFormat:h,blockShape:g,blockIndex:y,filters:b,codec:T}=n,I=new Uint8Array(t).subarray(l,u+1),D=new Uint32Array(g[0]*g[1]*g[2]),P;if(T!=="gzip_data")throw new Error(`Unhandled codec: ${T}`);return P=function(R,L){if(!globalThis.DecompressionStream&&L==="gzip_data")return Promise.resolve(((X=function(oe){oe[0]==31&&oe[1]==139&&oe[2]==8||Yo(6,"invalid gzip data");var fe=oe[3],me=10;4&fe&&(me+=2+(oe[10]|oe[11]<<8));for(var we=(fe>>3&1)+(fe>>4&1);we>0;we-=!oe[me++]);return me+(2&fe)}(Y=R))+8>Y.length&&Yo(6,"invalid gzip data"),function(oe,fe,me,we){var Pe=oe.length;if(!Pe||fe.f&&!fe.l)return me||new oo(0);var Ce=!me,Le=Ce||fe.i!=2,Ye=fe.i;Ce&&(me=new oo(3*Pe));var Oe,He,Re=function(ql){var Wl=me.length;if(ql>Wl){var xu=new oo(Math.max(2*Wl,ql));xu.set(me),me=xu}},qe=fe.f||0,Qe=fe.p||0,Ze=fe.b||0,ht=fe.l,Xe=fe.d,tt=fe.m,vt=fe.n,yt=8*Pe;do{if(!ht){qe=Zo(oe,Qe,1);var mt=Zo(oe,Qe+1,3);if(Qe+=3,!mt){var et=oe[(rn=4+((Qe+7)/8|0))-4]|oe[rn-3]<<8,xt=rn+et;if(xt>Pe){Ye&&Yo(0);break}Le&&Re(Ze+et),me.set(oe.subarray(rn,xt),Ze),fe.b=Ze+=et,fe.p=Qe=8*xt,fe.f=qe;continue}if(mt==1)ht=oN,Xe=sN,tt=9,vt=5;else if(mt==2){var Vt=Zo(oe,Qe,31)+257,Dt=Zo(oe,Qe+10,15)+4,$t=Vt+Zo(oe,Qe+5,31)+1;Qe+=14;for(var jt=new oo($t),Yt=new oo(19),Et=0;Et<Dt;++Et)Yt[nN[Et]]=Zo(oe,Qe+3*Et,7);Qe+=3*Dt;var Rn=R1(Yt),Pn=(1<<Rn)-1,_n=Kp(Yt,Rn,1);for(Et=0;Et<$t;){var rn,yn=_n[Zo(oe,Qe,Pn)];if(Qe+=15&yn,(rn=yn>>4)<16)jt[Et++]=rn;else{var jn=0,Ln=0;for(rn==16?(Ln=3+Zo(oe,Qe,3),Qe+=2,jn=jt[Et-1]):rn==17?(Ln=3+Zo(oe,Qe,7),Qe+=3):rn==18&&(Ln=11+Zo(oe,Qe,127),Qe+=7);Ln--;)jt[Et++]=jn}}var rr=jt.subarray(0,Vt),tr=jt.subarray(Vt);tt=R1(rr),vt=R1(tr),ht=Kp(rr,tt,1),Xe=Kp(tr,vt,1)}else Yo(1);if(Qe>yt){Ye&&Yo(0);break}}Le&&Re(Ze+131072);for(var ai=(1<<tt)-1,or=(1<<vt)-1,Xn=Qe;;Xn=Qe){var gr=(jn=ht[O1(oe,Qe)&ai])>>4;if((Qe+=15&jn)>yt){Ye&&Yo(0);break}if(jn||Yo(2),gr<256)me[Ze++]=gr;else{if(gr==256){Xn=Qe,ht=null;break}var Lr=gr-254;gr>264&&(Lr=Zo(oe,Qe,(1<<(Ti=pD[Et=gr-257]))-1)+yD[Et],Qe+=Ti);var Fr=Xe[O1(oe,Qe)&or],Nn=Fr>>4;if(Fr||Yo(3),Qe+=15&Fr,tr=iN[Nn],Nn>3){var Ti=mD[Nn];tr+=O1(oe,Qe)&(1<<Ti)-1,Qe+=Ti}if(Qe>yt){Ye&&Yo(0);break}Le&&Re(Ze+131072);var Ia=Ze+Lr;if(Ze<tr){var Mo=0-tr,Ko=Math.min(tr,Ia);for(Mo+Ze<0&&Yo(3);Ze<Ko;++Ze)me[Ze]=(void 0)[Mo+Ze]}for(;Ze<Ia;++Ze)me[Ze]=me[Ze-tr]}}fe.l=ht,fe.p=Xn,fe.b=Ze,fe.f=qe,ht&&(qe=1,fe.m=tt,fe.d=Xe,fe.n=vt)}while(!qe);return Ze!=me.length&&Ce?(Oe=me,((He=Ze)==null||He>Oe.length)&&(He=Oe.length),new oo(Oe.subarray(0,He))):me.subarray(0,Ze)}(Y.subarray(X,-8),{i:2},new oo(((N=Y)[(j=N.length)-4]|N[j-3]<<8|N[j-2]<<16|N[j-1]<<24)>>>0))));var N,j,Y,X;let K=uN[L];if(!K)throw new Error(`Unhandled codec: ${L}`);let ae=new globalThis.DecompressionStream(K);return new Response(new Blob([R]).stream().pipeThrough(ae)).arrayBuffer().then(oe=>new Uint8Array(oe))}(I,T).then(R=>{let L=Wo.read(new hd(R));if(L.values==="uint32_values")return L.uint32_values.readValuesInto(D),new fN[h](D.buffer);throw new Error(`Unhandled numeric data "${L.values}"`)}),P.then(R=>{for(let L=b.length-1;L>=0;L--)switch(b[L]){case"delta_filter":QF(R,g);break;case"zigzag_filter":JF(R);break;case"bitshuffle_filter":eN(R,h);break;default:throw new Error(`Unhandled filter "${b[L]}"`)}return{layerName:o,blockIndex:y,data:R}}).catch(R=>{throw R})}))};class bD extends ly{constructor(e,n,o,l,u){super(e,n,o,l,u),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,n){let o=n.context,l=o.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Do?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new Do(o,e,l.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,n){let o=this._mrt=new k1(30),l=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=ia(l,(u,h,g,y)=>{if(u)n(u);else try{let b=o.getHeaderLength(h);if(b>e)return void(this.request=this.fetchHeader(b,n));o.parseHeader(h),this._isHeaderLoaded=!0;let T=0;for(let I of Object.values(o.layers))T=Math.max(T,I.dataIndex[I.dataIndex.length-1].last_byte);h.byteLength>=T&&(this.entireBuffer=h),n(null,this.entireBuffer||h,g,y)}catch(b){n(b)}}),this.request}fetchBand(e,n,o){let l=this._mrt;if(!this._isHeaderLoaded||!l)return void o(new Error("Tile header is not ready"));let u=this.actor;if(!u)return void o(new Error("Can't fetch tile band without an actor"));let h,g=(I,D)=>{h.complete(I,D),I?o(I):(this.updateTextureDescriptor(e,n),o(null,this.textureDescriptor&&this.textureDescriptor.img))},y=(I,D)=>{if(I)return o(I);let P=u.send("decodeRasterArray",{buffer:D,task:h},g,void 0,!0);this._workQueue.push(()=>{P&&P.cancel(),h.cancel()})},b=l.getLayer(e);if(!b)return void o(new Error(`Unknown sourceLayer "${e}"`));if(b.hasDataForBand(n))return this.updateTextureDescriptor(e,n),void o(null,this.textureDescriptor?this.textureDescriptor.img:null);let T=b.getDataRange([n]);if(h=l.createDecodingTask(T),!h||h.tasks.length)if(this.flushQueues(),this.entireBuffer)y(null,this.entireBuffer.slice(T.firstByte,T.lastByte+1));else{let I=Object.assign({},this.requestParams,{headers:{Range:`bytes=${T.firstByte}-${T.lastByte}`}}),D=ia(I,y);this._fetchQueue.push(()=>{D.cancel(),h.cancel()})}else o(null)}updateNeeded(e,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,n){if(!this._mrt)return;let o=this._mrt.getLayer(e);if(!o||!o.hasBand(n)||!o.hasDataForBand(n))return;let{bytes:l,tileSize:u,buffer:h,offset:g,scale:y}=o.getBandView(n),b=u+2*h,T={data:l,width:b,height:b},I=this.texture;I&&I instanceof Do&&I.update(T,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:n,img:T,buffer:h,offset:g,tileSize:u,format:o.pixelFormat,mix:[y,256*y,65536*y,16777216*y]}}}class mN{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,o){let l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);let u={value:n,timeout:void 0};if(o!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},o)),this.data[l].push(u),this.order.push(l),this.order.length>this.max){let h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let o=e.wrapped().key,l=n===void 0?0:this.data[o].indexOf(n),u=this.data[o][l];return this.data[o].splice(l,1),u.timeout&&clearTimeout(u.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(u.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let o in this.data)for(let l of this.data[o])e(l.value)||n.push(l);for(let o of n)this.remove(o.value.tileID,o)}}class gu extends sa{constructor(e,n,o){super(),this.id=e,this._onlySymbols=o,n.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new mN(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new yF,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let o=this._tiles[n];o.upload(e),o.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Li(this._tiles).map(e=>e.tileID).sort(wD).map(e=>e.key)}getRenderableIds(e,n){let o=[];for(let l in this._tiles)this._isIdRenderable(+l,e,n)&&o.push(this._tiles[l]);return e?o.sort((l,u)=>{let h=l.tileID,g=u.tileID,y=new at(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),b=new at(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-g.overscaledZ||b.y-y.y||b.x-y.x}).map(l=>l.tileID.key):o.map(l=>l.tileID).sort(wD).map(l=>l.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(o||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){let o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=n),this._loadTile(o,this._tileLoaded.bind(this,o,e,n)))}_tileLoaded(e,n,o,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new Ph(l,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new ci("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Rr.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new ci("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let n=this.getRenderableIds();for(let l=0;l<n.length;l++){let u=n[l];if(e.neighboringTiles&&e.neighboringTiles[u]){let h=this.getTileByID(u);o(e,h),o(h,e)}}function o(l,u){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let h=u.tileID.canonical.x-l.tileID.canonical.x,g=u.tileID.canonical.y-l.tileID.canonical.y,y=Math.pow(2,l.tileID.canonical.z),b=u.tileID.key;h===0&&g===0||Math.abs(g)>1||(Math.abs(h)>1&&(Math.abs(h+y)===1?h+=y:Math.abs(h-y)===1&&(h-=y)),u.dem&&l.dem&&(l.dem.backfillBorder(u.dem,h,g),l.neighboringTiles&&l.neighboringTiles[b]&&(l.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,o,l){for(let u in this._tiles){let h=this._tiles[u];if(l[u]||!h.hasData()||h.tileID.overscaledZ<=n||h.tileID.overscaledZ>o)continue;let g=h.tileID;for(;h&&h.tileID.overscaledZ>n+1;){let b=h.tileID.scaledTo(h.tileID.overscaledZ-1);h=this._tiles[b.key],h&&h.hasData()&&(g=b)}let y=g;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){l[g.key]=g;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=e.overscaledZ-1;o>=n;o--){let l=e.scaledTo(o),u=this._getLoadedTile(l);if(u)return u}}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;let o=Math.ceil(e.width/n)+1,l=Math.ceil(e.height/n)+1,u=Math.floor(o*l*5),h=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(g)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let o={};for(let l in this._tiles){let u=this._tiles[l];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+n),o[u.tileID.key]=u}this._tiles=o;for(let l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(let l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,n,o,l){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!o)return;let u;if(this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new xr(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y));else if(this.tileCoverLift!==0){let y=e.clone();y.tileCoverLift=this.tileCoverLift,u=y.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&e.projection.name==="globe"&&(u.push(new xr(1,0,1,0,0)),u.push(new xr(1,0,1,1,0)),u.push(new xr(1,0,1,0,1)),u.push(new xr(1,0,1,1,1)))}else if(u=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){let y=this._source.hasTile.bind(this._source);u=u.filter(b=>y(b))}}else u=[];if(u.length>0&&this.castsShadows&&l&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!L1(this._source.type)){let y=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!o}),b=Math.min(y,this._source.maxzoom),T=e.extendTileCoverForShadows(u,l,b);for(let I of T)this._shadowCasterTiles[I.key]=!0,u.push(I)}let h=this._updateRetainedTiles(u);if(L1(this._source.type)&&u.length!==0){let y={},b={},T=Object.keys(h);for(let D of T){let P=h[D],R=this._tiles[D];if(!R||R.fadeEndTime&&R.fadeEndTime<=Rr.now())continue;let L=this.findLoadedParent(P,Math.max(P.overscaledZ-gu.maxOverzooming,this._source.minzoom));L&&(this._addTile(L.tileID),y[L.tileID.key]=L.tileID),b[D]=P}let I=u[u.length-1].overscaledZ;for(let D in this._tiles){let P=this._tiles[D];if(h[D]||!P.hasData())continue;let R=P.tileID;for(;R.overscaledZ>I;){R=R.scaledTo(R.overscaledZ-1);let L=this._tiles[R.key];if(L&&L.hasData()&&b[R.key]){h[D]=P.tileID;break}}}for(let D in y)h[D]||(this._coveredTiles[D]=!0,h[D]=y[D])}for(let y in h)this._tiles[y].clearFadeHold();let g=function(y,b){let T=[];for(let I in y)I in b||T.push(I);return T}(this._tiles,h);for(let y of g){let b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let n={};if(e.length===0)return n;let o={},l=e.reduce((b,T)=>Math.min(b,T.overscaledZ),1/0),u=e[0].overscaledZ,h=Math.max(u-gu.maxOverzooming,this._source.minzoom),g=Math.max(u+gu.maxUnderzooming,this._source.minzoom),y={};for(let b of e){let T=this._addTile(b);n[b.key]=b,T.hasData()||l<this._source.maxzoom&&(y[b.key]=b)}this._retainLoadedChildren(y,l,g,n);for(let b of e){let T=this._tiles[b.key];if(T.hasData())continue;if(b.canonical.z>=this._source.maxzoom){let D=b.children(this._source.maxzoom)[0],P=this.getTile(D);if(P&&P.hasData()){n[D.key]=D;continue}}else{let D=b.children(this._source.maxzoom);if(n[D[0].key]&&n[D[1].key]&&n[D[2].key]&&n[D[3].key])continue}let I=T.wasRequested();for(let D=b.overscaledZ-1;D>=h;--D){let P=b.scaledTo(D);if(o[P.key]||(o[P.key]=!0,T=this.getTile(P),!T&&I&&(T=this._addTile(P)),T&&(n[P.key]=P,I=T.wasRequested(),T.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],o,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){o=this._loadedParentTiles[l.key];break}n.push(l.key);let u=l.scaledTo(l.overscaledZ-1);if(o=this._getLoadedTile(u),o)break;l=u}for(let u of n)this._loadedParentTiles[u]=o}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let o=!!n;if(!o){let l=this.map?this.map.painter:null,u=this._source.tileSize*e.overscaleFactor();n=this._source.type==="raster-array"?new bD(e,u,this.transform.tileZoom,l,this._isRaster):new ly(e,u,this.transform.tileZoom,l,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,o||this._source.fire(new ci("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let o=n.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,o){let l=[],u=this.transform;if(!u)return l;let h=u.projection.name==="globe",g=Es(u.center.lng);for(let y in this._tiles){let b=this._tiles[y];if(o&&b.clearQueryDebugViz(),b.holdingForFade())continue;let T;if(h){let I=b.tileID.canonical;if(I.z===0){let D=[Math.abs(Ht(g,...Jp(I,-1))-g),Math.abs(Ht(g,...Jp(I,1))-g)];T=[0,2*D.indexOf(Math.min(...D))-1]}else{let D=[Math.abs(Ht(g,...Jp(I,-1))-g),Math.abs(Ht(g,...Jp(I,0))-g),Math.abs(Ht(g,...Jp(I,1))-g)];T=[D.indexOf(Math.min(...D))-1]}}else T=[0];for(let I of T){let D=e.containsTile(b,u,n,I);D&&l.push(D)}}return l}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){let o=this.getRenderableIds(e,n).map(u=>this._tiles[u].tileID),l=this.transform.projection.name==="globe";for(let u of o)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped()),u.expandedProjMatrix=l?this.transform.calculateProjMatrix(u.toUnwrapped(),!1,!0):u.projMatrix;return o}sortCoordinatesByDistance(e){let n=e.slice(),o=this.transform._camera.position,l=this.transform._camera.forward(),u={};for(let h of n){let g=1/(1<<h.canonical.z);u[h.key]=((h.canonical.x+.5)*g+h.wrap-o[0])*l[0]+((h.canonical.y+.5)*g-o[1])*l[1]-o[2]*l[2]}return n.sort((h,g)=>u[h.key]-u[g.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(L1(this._source.type))for(let e in this._tiles){let n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=Rr.now())return!0}return!1}setFeatureState(e,n,o){this._state.updateState(e=e||"_geojsonTileLayer",n,o)}removeFeatureState(e,n,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,o)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,o){let l=this._tiles[e];l&&l.setDependencies(n,o)}reloadTilesForDependencies(e,n){for(let o in this._tiles)this._tiles[o].hasDependency(e,n)&&this._reloadTile(+o,"reloading");this._cache.filter(o=>!o.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){let g=()=>{this._sourceLoaded&&(this._source.off("data",g),this._preloadTiles(e,n))};return void this._source.on("data",g)}let o=new Map,l=Array.isArray(e)?e:[e],u=this.map.painter.terrain,h=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(let g of l){let y=g.coveringTiles({tileSize:h,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let b of y)o.set(b.key,b);this.usedForTerrain&&g.updateElevation(!1)}il(Array.from(o.values()),(g,y)=>{let b=new ly(g,this._source.tileSize*g.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(b,T=>{this._source.type==="raster-dem"&&b.dem&&this._backfillDEM(b),y(T,b)})},n)}}function wD(t,e){let n=Math.abs(2*t.wrap)-+(t.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||o-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function L1(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function Jp(t,e){let n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}gu.maxOverzooming=10,gu.maxUnderzooming=3;let TD=new class extends ut{possiblyEvaluate(t,e){return e=new Lt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,o){return e=Wr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,o)}}(G_.paint.properties["line-width"].specification);function ED(t,e){return e>0?e+2*t:t}TD.useIntegerZoom=!0;let gN=new Cn({"symbol-placement":new Fe(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new Fe(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Fe(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ut(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Fe(Te.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Fe(Te.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Fe(Te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Fe(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Fe(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Fe(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new ut(Te.layout_symbol["icon-size"]),"icon-text-fit":new ut(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ut(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new ut(Te.layout_symbol["icon-image"]),"icon-rotate":new ut(Te.layout_symbol["icon-rotate"]),"icon-padding":new Fe(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new Fe(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new ut(Te.layout_symbol["icon-offset"]),"icon-anchor":new ut(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Fe(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Fe(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Fe(Te.layout_symbol["text-rotation-alignment"]),"text-field":new ut(Te.layout_symbol["text-field"]),"text-font":new ut(Te.layout_symbol["text-font"]),"text-size":new ut(Te.layout_symbol["text-size"]),"text-max-width":new ut(Te.layout_symbol["text-max-width"]),"text-line-height":new ut(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new ut(Te.layout_symbol["text-letter-spacing"]),"text-justify":new ut(Te.layout_symbol["text-justify"]),"text-radial-offset":new ut(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Fe(Te.layout_symbol["text-variable-anchor"]),"text-anchor":new ut(Te.layout_symbol["text-anchor"]),"text-max-angle":new Fe(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new Fe(Te.layout_symbol["text-writing-mode"]),"text-rotate":new ut(Te.layout_symbol["text-rotate"]),"text-padding":new Fe(Te.layout_symbol["text-padding"]),"text-keep-upright":new Fe(Te.layout_symbol["text-keep-upright"]),"text-transform":new ut(Te.layout_symbol["text-transform"]),"text-offset":new ut(Te.layout_symbol["text-offset"]),"text-allow-overlap":new Fe(Te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Fe(Te.layout_symbol["text-ignore-placement"]),"text-optional":new Fe(Te.layout_symbol["text-optional"]),visibility:new Fe(Te.layout_symbol.visibility)});var F1={paint:new Cn({"icon-opacity":new ut(Te.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ut(Te.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ut(Te.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ut(Te.paint_symbol["text-emissive-strength"]),"icon-color":new ut(Te.paint_symbol["icon-color"]),"icon-halo-color":new ut(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new ut(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ut(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new Fe(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Fe(Te.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ut(Te.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ut(Te.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ut(Te.paint_symbol["text-occlusion-opacity"]),"text-color":new ut(Te.paint_symbol["text-color"],{runtimeType:ui,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ut(Te.paint_symbol["text-halo-color"]),"text-halo-width":new ut(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new ut(Te.paint_symbol["text-halo-blur"]),"text-translate":new Fe(Te.paint_symbol["text-translate"]),"text-translate-anchor":new Fe(Te.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Fe(Te.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Fe(Te.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Fe(Te.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Fe(Te.paint_symbol["icon-color-brightness-max"])}),layout:gN};class ID{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:pl,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Q(ID,"FormatSectionOverride",{omit:["defaultValue"]});class cy extends Xr{constructor(e,n,o,l){super(e,F1,n,o,l),this._colorAdjustmentMatrix=r.ad.identity([])}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let o=this.layout.get("text-writing-mode");if(o){let l=[];for(let u of o)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,o,l){return this._saturation===e&&this._contrast===n&&this._brightnessMin===o&&this._brightnessMax===l||(this._colorAdjustmentMatrix=function(u,h,g,y){u=bh(u),h=xh(h);let b=r.ad.create(),T=u/3,I=1-2*T,D=[I,T,T,0,T,I,T,0,T,T,I,0,0,0,0,1],P=.5-.5*h,R=y-g;return r.ad.multiply(b,[R,0,0,0,0,R,0,0,0,0,R,0,g,g,g,1],[h,0,0,0,0,h,0,0,0,0,h,0,P,P,P,1]),r.ad.multiply(b,b,D),b}(e,n,o,l),this._saturation=e,this._contrast=n,this._brightnessMin=o,this._brightnessMax=l),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,o,l){let u=this.layout.get(e).evaluate(n,{},o,l),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||F(h.value)||!u?u:function(g,y){return y.replace(/{([^{}]+)}/g,(b,T)=>T in g?String(g[T]):"")}(n.properties,u)}createBucket(e){return new yd(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of F1.paint.overridableProperties){if(!cy.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),o=new ID(n),l=new O(o,n.property.specification,this.scope,this.options),u=null;u=n.value.kind==="constant"||n.value.kind==="source"?new V("source",l):new $("composite",l,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new $n(n.property,u,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&cy.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let o=e.get("text-field"),l=F1.paint.properties[n],u=!1,h=g=>{for(let y of g)if(l.overrides&&l.overrides.hasOverride(y))return void(u=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Zr)h(o.value.value.sections);else if(o.value.kind==="source"){let g=b=>{u||(b instanceof No&&mr(b.value)===gl?h(b.value.sections):b instanceof Uc?h(b.sections):b.eachChild(g))},y=o.value;y._styleExpression&&g(y._styleExpression.expression)}return u}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,o=[];return e&&o.push("symbolIcon"),n&&o.push("symbolSDF"),o}getDefaultProgramParams(e,n,o){return{config:new cu(this,{zoom:n,lut:o}),overrideFog:!1}}}let _N=new Cn({visibility:new Fe(Te.layout_background.visibility)});var yN={paint:new Cn({"background-color":new Fe(Te.paint_background["background-color"]),"background-pattern":new Fe(Te.paint_background["background-pattern"]),"background-opacity":new Fe(Te.paint_background["background-opacity"]),"background-emissive-strength":new Fe(Te.paint_background["background-emissive-strength"])}),layout:_N};let vN=new Cn({visibility:new Fe(Te.layout_raster.visibility)});var xN={paint:new Cn({"raster-opacity":new Fe(Te.paint_raster["raster-opacity"]),"raster-color":new vr(Te.paint_raster["raster-color"]),"raster-color-mix":new Fe(Te.paint_raster["raster-color-mix"]),"raster-color-range":new Fe(Te.paint_raster["raster-color-range"]),"raster-hue-rotate":new Fe(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Fe(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Fe(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new Fe(Te.paint_raster["raster-saturation"]),"raster-contrast":new Fe(Te.paint_raster["raster-contrast"]),"raster-resampling":new Fe(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new Fe(Te.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Fe(Te.paint_raster["raster-emissive-strength"]),"raster-array-band":new Fe(Te.paint_raster["raster-array-band"]),"raster-elevation":new Fe(Te.paint_raster["raster-elevation"])}),layout:vN};function uy(t,e,n,o,l,u,h,g){let y=[t,e,1,n,o,1,l,u,1],b=[h,g,1],T=r.bC.adjoint([],y),[I,D,P]=r._.transformMat3(b,b,T);return r.bC.multiply(y,y,[I,0,0,0,D,0,0,0,P])}function CD(t,e,n,o,l,u,h,g){let y=function(b,T,I,D,P,R,L,N){let j=uy(0,0,1,0,1,1,0,1),Y=uy(b,T,I,D,P,R,L,N),X=r.bC.adjoint([],j);return r.bC.multiply(Y,Y,X)}(t,e,n,o,l,u,h,g);return[y[2]/y[8]/rt,y[5]/y[8]/rt]}function hy(t){return[t[0],Math.min(Math.max(t[1],-hr),hr)]}class DD extends sa{constructor(e,n,o,l){super(),this.id=e,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(l),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new ci("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=ps(this.map._requestManager.transformRequest(this.url,Ch.Image),(o,l)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new Ph(o)):l&&(this.image=l instanceof HTMLImageElement?Rr.getImageData(l):l,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new oy(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ci("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof oy||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],o=e[0][1];for(let u of e)u[1]>o&&(o=u[1]),u[1]<n&&(n=u[1]);let l=(o+n)/2;if(l>hr?this.onNorthPole=!0:l<-hr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let u=e.map(si.fromLngLat);this.tileID=function(h){let g=1/0,y=1/0,b=-1/0,T=-1/0;for(let L of h)g=Math.min(g,L.x),y=Math.min(y,L.y),b=Math.max(b,L.x),T=Math.max(T,L.y);let I=Math.max(b-g,T-y),D=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),P=Math.pow(2,D),R=Math.floor((g+b)/2*P);return R>1&&(R-=1),new hu(D,R,Math.floor((y+T)/2*P))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ci("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let N in this.tiles){let j=this.tiles[N];j.state!=="loaded"&&(j.state="loaded",j.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let n=mu(new hu(0,0,0),this.map.transform.projection),o=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(N){let j=N[1].x-N[0].x,Y=N[1].y-N[0].y,X=N[2].x-N[1].x,K=N[2].y-N[1].y,ae=N[3].x-N[2].x,oe=N[3].y-N[2].y,fe=N[0].x-N[3].x,me=N[0].y-N[3].y,we=j*K-X*Y,Pe=X*oe-ae*K,Ce=ae*me-fe*oe,Le=fe*Y-j*me;return we>0&&Pe>0&&Ce>0&&Le>0||we<0&&Pe<0&&Ce<0&&Le<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let l=mu(this.tileID,this.map.transform.projection),[u,h,g,y]=this.coordinates.map(N=>{let j=l.projection.project(N[0],N[1]);return sD(l,j)._round()});this.perspectiveTransform=CD(u.x,u.y,h.x,h.y,g.x,g.y,y.x,y.y);let b=this._boundsArray=new Dl;b.emplaceBack(u.x,u.y,0,0),b.emplaceBack(h.x,h.y,rt,0),b.emplaceBack(y.x,y.y,0,rt),b.emplaceBack(g.x,g.y,rt,rt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(b,ay.members),this.boundsSegments=Jn.simpleSegment(0,0,4,2);let T=[],I=function(N){return[hy(N[0]),hy(N[1]),hy(N[2]),hy(N[3])]}(this.coordinates),[D,P,R,L]=function(N){let j=N[0][0],Y=j,X=N[0][1],K=X;for(let ae=1;ae<N.length;ae++)N[ae][0]<j?j=N[ae][0]:N[ae][0]>Y&&(Y=N[ae][0]),N[ae][1]<X?X=N[ae][1]:N[ae][1]>K&&(K=N[ae][1]);return[j,X,Y-j,K-X]}(I);{let N=new Dl,[j,Y,X,K]=function(Re){let qe=Re[0].x,Qe=qe,Ze=Re[0].y,ht=Ze;for(let Xe=1;Xe<Re.length;Xe++)Re[Xe].x<qe?qe=Re[Xe].x:Re[Xe].x>Qe&&(Qe=Re[Xe].x),Re[Xe].y<Ze?Ze=Re[Xe].y:Re[Xe].y>ht&&(ht=Re[Xe].y);return[qe,Ze,Qe-qe,ht-Ze]}(o),ae=Re=>[(Re.x-j)/X,(Re.y-Y)/K],[oe,fe,me,we]=o.map(ae),Pe=function(Re,qe,Qe,Ze,ht,Xe,tt,vt){let yt=uy(0,0,1,0,1,1,0,1),mt=uy(Re,qe,Qe,Ze,ht,Xe,tt,vt),et=r.bC.adjoint([],mt);return r.bC.multiply(yt,yt,et)}(oe[0],oe[1],fe[0],fe[1],me[0],me[1],we[0],we[1]);this.elevatedGlobePerspectiveTransform=CD(oe[0],oe[1],fe[0],fe[1],me[0],me[1],we[0],we[1]);let Ce=(Re,qe)=>{T.push(Re.lng);let Qe=Math.round((Re.lng-D)/R*rt),Ze=Math.round((Re.lat-P)/L*rt),ht=ae(qe),Xe=r._.transformMat3([],[ht[0],ht[1],1],Pe),tt=Math.round(Xe[0]/Xe[2]*rt),vt=Math.round(Xe[1]/Xe[2]*rt);N.emplaceBack(Qe,Ze,tt,vt)},Le=o[3].x-o[0].x,Ye=o[3].y-o[0].y,Oe=o[2].x-o[1].x,He=o[2].y-o[1].y;for(let Re=0;Re<65;Re++){let qe=Re/64,Qe=[o[0].x+qe*Le,o[0].y+qe*Ye],Ze=[o[1].x+qe*Oe,o[1].y+qe*He],ht=Ze[0]-Qe[0],Xe=Ze[1]-Qe[1];for(let tt=0;tt<65;tt++){let vt=tt/64,yt={x:Qe[0]+ht*vt,y:Qe[1]+Xe*vt,z:0};Ce(n.projection.unproject(yt.x,yt.y),yt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(N,ay.members)}{this.maxLongitudeTriangleSize=0;let N=[],j=new Ir,Y=(X,K,ae)=>{j.emplaceBack(X,K,ae);let oe=T[X],fe=T[K],me=T[ae],we=Math.min(Math.min(oe,fe),me),Pe=Math.max(Math.max(oe,fe),me)-we;Pe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Pe),N.push(we+Pe/2)};for(let X=0;X<64;X++)for(let K=0;K<64;K++){let ae=65*X+K,oe=ae+1,fe=ae+65,me=fe+1;Y(ae,fe,oe),Y(oe,fe,me)}[N,j]=function(X,K){let ae=Array.from({length:X.length},(me,we)=>we);ae.sort((me,we)=>X[me]-X[we]);let oe=[],fe=new Ir;for(let me=0;me<ae.length;me++){let we=ae[me];oe.push(X[we]);let Pe=3*we,Ce=Pe+1;fe.emplaceBack(K.uint16[Pe],K.uint16[Ce],K.uint16[Ce+1])}return[oe,fe]}(N,j),this.elevatedGlobeTrianglesCenterLongitudes=N,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(j)}this.elevatedGlobeSegments=Jn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/rt,0,L/rt,0,0,P,D,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,o=n.gl;!this._dirty||this.texture instanceof oy||(this.texture?this.texture.update(this.image):(this.texture=new Do(n,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;let o=this.elevatedGlobeTrianglesCenterLongitudes,l=(u=e+180)+360*Math.round((o[0]-u)/360);var u;let h=new Jn,g=(I,D)=>{h.segments.push({vertexOffset:0,primitiveOffset:I,vertexLength:n.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-l)<=y){let I=Ig(o,0,o.length,l+y);return I===o.length||g(I,kf(o,I+1,o.length,l+360-y)-I),h}l<o[0]&&(l+=360);let b=kf(o,0,o.length,l-y);if(b===o.length)return g(0,o.length),h;g(0,b-0);let T=Ig(o,b+1,o.length,l+y);return T!==o.length&&g(T,o.length-T),h}}let bN=(Math.pow(256,2)-1)/16907520;class SD extends Xr{constructor(e,n,o,l){super(e,xN,n,o,l),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof DD&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let n=this._transitionablePaint._values["raster-color"].value.expression,[o,l]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(l)||o===this._curRampRange[0]&&l===this._curRampRange[1]||(this.colorRamp=kp({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:l}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,l])}}let wN=new Cn({visibility:new Fe(Te["layout_raster-particle"].visibility)});var TN={paint:new Cn({"raster-particle-array-band":new Fe(Te["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Fe(Te["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new vr(Te["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Fe(Te["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Fe(Te["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Fe(Te["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Fe(Te["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:wN};class MD extends Xr{constructor(e,n,o,l){super(e,TN,n,o,l),this._updateColorRamp(),this.lastInvalidatedAt=Rr.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=kp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Rr.now()}}class EN extends Xr{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let IN=new Cn({visibility:new Fe(Te.layout_sky.visibility)});var CN={paint:new Cn({"sky-type":new Fe(Te.paint_sky["sky-type"]),"sky-atmosphere-sun":new Fe(Te.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Fe(Te.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Fe(Te.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Fe(Te.paint_sky["sky-gradient-radius"]),"sky-gradient":new vr(Te.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Fe(Te.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Fe(Te.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Fe(Te.paint_sky["sky-opacity"])}),layout:IN};function N1(t,e,n){let o=[0,0,1],l=r.av.identity([]);return r.av.rotateY(l,l,n?-en(t)+Math.PI:en(t)),r.av.rotateX(l,l,-en(e)),r._.transformQuat(o,o,l),r._.normalize(o,o)}var DN={paint:new Cn({})};function AD(t,e){let n=dy(t.projection,t.zoom,t.width,t.height),o=function(u,h,g,y,b){let T=new cn(g.lng-180*Hl,g.lat),I=new cn(g.lng+180*Hl,g.lat),D=u.project(T.lng,T.lat),P=u.project(I.lng,I.lat),R=-Math.atan2(P.y-D.y,P.x-D.x),L=si.fromLngLat(g);L.y=Ht(L.y,-1+Hl,1-Hl);let N=L.toLngLat(),j=u.project(N.lng,N.lat),Y=si.fromLngLat(N);Y.x+=Hl;let X=Y.toLngLat(),K=u.project(X.lng,X.lat),ae=OD(K.x-j.x,K.y-j.y,R),oe=si.fromLngLat(N);oe.y+=Hl;let fe=oe.toLngLat(),me=u.project(fe.lng,fe.lat),we=OD(me.x-j.x,me.y-j.y,R),Pe=Math.abs(ae.x)/Math.abs(we.y),Ce=r.ad.identity([]);r.ad.rotateZ(Ce,Ce,-R*(1-(b?0:y)));let Le=r.ad.identity([]);return r.ad.scale(Le,Le,[1,1-(1-Pe)*y,1]),Le[4]=-we.x/we.y*y,r.ad.rotateZ(Le,Le,R),r.ad.multiply(Le,Ce,Le),Le}(t.projection,0,t.center,n,e),l=PD(t);return r.ad.scale(o,o,[l,l,1]),o}function PD(t){let e=t.projection,n=dy(t.projection,t.zoom,t.width,t.height),o=RD(e,t.center),l=RD(e,cn.convert(e.center));return Math.pow(2,o*n+(1-n)*l)}function dy(t,e,n,o,l=1/0){let u=t.range;if(!u)return 0;let h=Math.min(l,Math.max(n,o)),g=Math.log(h/1024)/Math.LN2;return ea(u[0]+g,u[1]+g,e)}let Hl=1/4e4;function RD(t,e){let n=Ht(e.lat,-hr,hr),o=new cn(e.lng-180*Hl,n),l=new cn(e.lng+180*Hl,n),u=t.project(o.lng,n),h=t.project(l.lng,n),g=si.fromLngLat(o),y=si.fromLngLat(l),b=h.x-u.x,T=h.y-u.y,I=y.x-g.x,D=y.y-g.y,P=Math.sqrt((I*I+D*D)/(b*b+T*T));return Math.log(P)/Math.LN2}function OD(t,e,n){let o=Math.cos(n),l=Math.sin(n);return{x:t*o-e*l,y:t*l+e*o}}function kD(t,e,n){r.ad.identity(t),r.ad.rotateZ(t,t,en(e[2])),r.ad.rotateX(t,t,en(e[0])),r.ad.rotateY(t,t,en(e[1])),r.ad.scale(t,t,n),r.ad.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function fy(t,e,n,o,l,u,h,g){let y=[n[0]-e[0],n[1]-e[1],0],b=[o[0]-e[0],o[1]-e[1],0];if(r._.length(y)<1e-12||r._.length(b)<1e-12)return r.av.identity(t);let T=r._.cross([],y,b);r._.normalize(T,T),r._.subtract(b,o,e),y[2]=(u-l)*g,b[2]=(h-l)*g;let I=y;return r._.cross(I,y,b),r._.normalize(I,I),r.av.rotationTo(t,T,I)}function z1(t,e,n=!1){let o=wa(e.zoom),l=function(u,h,g){let y=h.worldSize,b=[u[12],u[13],u[14]],T=kr(b[1]/y),I=Di(b[0]/y),D=r.ad.identity([]),P=wi(1,T)*y,R=wi(1,0)*y*du(T,h.zoom),L=1/n1(y),N=R*L;if(g){let K=dy(h.projection,h.zoom,h.width,h.height,1024);N=L*h.projection.pixelSpaceConversion(h.center.lat,y,K)}let j=uu(T,I);r._.add(j,j,r._.scale([],r._.normalize([],j),P*N*b[2]));let Y=function(K){let ae=[K[0],K[1],K[2]],oe=[0,1,0],fe=r._.cross([],oe,ae);return r._.cross(oe,ae,fe),r._.squaredLength(oe)===0&&(oe=[0,1,0],r._.cross(fe,ae,oe)),r._.normalize(fe,fe),r._.normalize(oe,oe),r._.normalize(ae,ae),[fe[0],fe[1],fe[2],0,oe[0],oe[1],oe[2],0,ae[0],ae[1],ae[2],0,K[0],K[1],K[2],1]}(j);r.ad.scale(D,D,[N,N,N*P]),r.ad.translate(D,D,[-b[0],-b[1],-b[2]]);let X=r.ad.multiply([],h.globeMatrix,Y);return r.ad.multiply(X,X,D),r.ad.multiply(X,X,u),X}(t,e,n);if(o>0){let u=function(h,g){let y=g.worldSize,b=wi(1,0)*y*du(g.center.lat,g.zoom)/n1(y),T=wi(1,g.center.lat)*y,I=r.ad.identity([]);return r.ad.rotateY(I,I,en(g.center.lng)),r.ad.rotateX(I,I,en(g.center.lat)),r.ad.translate(I,I,[0,0,bi]),r.ad.scale(I,I,[b,b,b*T]),r.ad.translate(I,I,[g.point.x-.5*y,g.point.y-.5*y,0]),r.ad.multiply(I,I,h),r.ad.multiply(I,g.globeMatrix,I)}(t,e);return function(h,g,y){let b=(R,L,N)=>{let j=r._.length(R),Y=r._.length(L),X=ba(R,L,N);return r._.scale(X,X,1/r._.length(X)*bt(j,Y,N))},T=b([h[0],h[1],h[2]],[g[0],g[1],g[2]],y),I=b([h[4],h[5],h[6]],[g[4],g[5],g[6]],y),D=b([h[8],h[9],h[10]],[g[8],g[9],g[10]],y),P=ba([h[12],h[13],h[14]],[g[12],g[13],g[14]],y);return[T[0],T[1],T[2],0,I[0],I[1],I[2],0,D[0],D[1],D[2],0,P[0],P[1],P[2],1]}(l,u,o)}return l}function LD(t,e,n,o){let l=er.projectAabbCorners(o,n),u=Number.MAX_VALUE,h=-1;for(let b=0;b<l.length;++b){let T=l[b];T[0]=(.5*T[0]+.5)*e.width,T[1]=(.5-.5*T[1])*e.height,T[2]<u&&(h=b,u=T[2])}let g=b=>new at(l[b][0],l[b][1]),y;switch(h){case 0:case 6:y=[g(1),g(5),g(4),g(7),g(3),g(2),g(1)];break;case 1:case 7:y=[g(0),g(4),g(5),g(6),g(2),g(3),g(0)];break;case 3:case 5:y=[g(1),g(0),g(4),g(7),g(6),g(2),g(1)];break;default:y=[g(1),g(5),g(6),g(7),g(3),g(0),g(1)]}if(qx(t,y))return u}let SN=wn([{name:"a_pos_3f",components:3,type:"Float32"}]),MN=wn([{name:"a_color_3f",components:3,type:"Float32"}]),AN=wn([{name:"a_color_4f",components:4,type:"Float32"}]),PN=wn([{name:"a_uv_2f",components:2,type:"Float32"}]),RN=wn([{name:"a_normal_3f",components:3,type:"Float32"}]),ON=wn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),kN=wn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class py{constructor(e,n,o,l){this.message=(e?`${e}: `:"")+o,l&&(this.identifier=l),n!=null&&n.__line__&&(this.line=n.__line__)}}function FD(t,e){let n=t.indexOf("://")===-1;try{return new URL(t,n&&e?"http://example.com":void 0),!0}catch{return!1}}class ND{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class zD{constructor(){this.instancedDataArray=new Mx,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class B1{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,n){}populate(e,n,o,l){this.tileToMeter=T_(o);let u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:h,id:g,index:y,sourceLayerIndex:b}of e){let T=g??(h.properties&&h.properties.hasOwnProperty("id")?h.properties.id:void 0),I=xa(h,u);if(!this.layers[0]._featureFilter.filter(new Lt(this.zoom),I,o))continue;let D={id:T,sourceLayerIndex:b,index:y,geometry:u?I.geometry:$o(h,o,l),properties:h.properties,type:h.type,patterns:{}},P=this.addFeature(D,D.geometry,I);P&&n.featureIndex.insert(h,D.geometry,y,b,this.index,this.instancesPerModel[P].instancedDataArray.length,rt/32)}this.lookup=null}update(e,n,o,l){for(let u in this.instancesPerModel){let h=this.instancesPerModel[u];for(let g in e)h.idToFeaturesIndex.hasOwnProperty(g)&&(this.evaluate(h.features[h.idToFeaturesIndex[g]],e[g],h,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let o=this.instancesPerModel[n];for(let l of o.features){let u=this.layers[0],h=l.feature,g=this.canonical,y=u.paint.get("model-rotation").evaluate(h,{},g),b=u.paint.get("model-scale").evaluate(h,{},g),T=u.paint.get("model-translation").evaluate(h,{},g);r._.exactEquals(l.rotation,y)&&r._.exactEquals(l.scale,b)&&r._.exactEquals(l.translation,T)||(this.evaluate(l,l.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,n,o){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let l=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(d1(this.activeReplacements,l))return!1;this.activeReplacements=l;let u=!1;for(let h in this.instancesPerModel){let g=this.instancesPerModel[h],y=g.instancedDataArray;for(let b of g.features){let T=b.instancedDataOffset,I=b.instancedDataCount;for(let D=0;D<I;D++){let P=16*(D+T),R=y.float32[P+0];R=R>rt?R-rt:R;let L=Math.floor(R),N=y.float32[P+1],j=!1;for(let Y of this.activeReplacements)if(!(Y.order<o||Y.order===1/0)&&Y.clipMask&rC.Model&&!(Y.min.x>L||L>Y.max.x||Y.min.y>N||N>Y.max.y)&&(j=YI(ZI(L,N,e.canonical,Y.footprintTileId.canonical),Y),j))break;y.float32[P]=j?R+rt:R,u=u||j}}}return u}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let o=this.instancesPerModel[n];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,ON.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let n in this.instancesPerModel){let o=this.instancesPerModel[n];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,o){let l=this.layers[0],u=l.layout.get("model-id").evaluate(o,{},this.canonical);if(!u)return cr(`modelId is not evaluated for layer ${l.id} and it is not going to get rendered.`),u;FD(u,!1)&&(this.modelUris.includes(u)||this.modelUris.push(u)),this.instancesPerModel[u]||(this.instancesPerModel[u]=new zD);let h=this.instancesPerModel[u],g=h.instancedDataArray,y=new ND(o,g.length);for(let b of n)for(let T of b){if(T.x<0||T.x>=rt||T.y<0||T.y>=rt)continue;let I=(this.lookupDim-1)/rt,D=this.lookupDim*(T.y*I|0)+T.x*I|0;if(this.lookup){if(this.lookup[D]!==0)continue;this.lookup[D]=1}this.instanceCount++;let P=g.length;g.resize(P+1),h.instancesEvaluatedElevation.push(0),g.float32[16*P]=T.x,g.float32[16*P+1]=T.y}return y.instancedDataCount=h.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(h.idToFeaturesIndex[e.id]=h.features.length),h.features.push(y),this.evaluate(y,{},h,!1)),u}getModelUris(){return this.modelUris}evaluate(e,n,o,l){let u=this.layers[0],h=e.feature,g=this.canonical,y=e.rotation=u.paint.get("model-rotation").evaluate(h,n,g),b=e.scale=u.paint.get("model-scale").evaluate(h,n,g),T=e.translation=u.paint.get("model-translation").evaluate(h,n,g),I=u.paint.get("model-color").evaluate(h,n,g);I.a=u.paint.get("model-color-mix-intensity").evaluate(h,n,g);let D=[];this.maxVerticalOffset<T[2]&&(this.maxVerticalOffset=T[2]),this.maxScale=Math.max(Math.max(this.maxScale,b[0]),Math.max(b[1],b[2])),kD(D,y,b);let P=Math.round(100*I.a)+I.b/1.05;for(let R=0;R<e.instancedDataCount;++R){let L=e.instancedDataOffset+R,N=16*L,j=o.instancedDataArray.float32,Y=0;l&&(Y=j[N+6]-o.instancesEvaluatedElevation[L]);let X=0|j[N+1];j[N]=(0|j[N])+I.r/1.05,j[N+1]=X+I.g/1.05,j[N+2]=P,j[N+3]=1/(g.z>10?this.tileToMeter:T_(g,X)),j[N+4]=T[0],j[N+5]=T[1],j[N+6]=T[2]+Y,j[N+7]=D[0],j[N+8]=D[1],j[N+9]=D[2],j[N+10]=D[4],j[N+11]=D[5],j[N+12]=D[6],j[N+13]=D[8],j[N+14]=D[9],j[N+15]=D[10],o.instancesEvaluatedElevation[L]=T[2]}}}Q(B1,"ModelBucket",{omit:["layers"]}),Q(zD,"PerModelAttributes"),Q(ND,"ModelFeature");let LN=new Cn({visibility:new Fe(Te.layout_model.visibility),"model-id":new ut(Te.layout_model["model-id"])});var FN={paint:new Cn({"model-opacity":new Fe(Te.paint_model["model-opacity"]),"model-rotation":new ut(Te.paint_model["model-rotation"]),"model-scale":new ut(Te.paint_model["model-scale"]),"model-translation":new ut(Te.paint_model["model-translation"]),"model-color":new ut(Te.paint_model["model-color"]),"model-color-mix-intensity":new ut(Te.paint_model["model-color-mix-intensity"]),"model-type":new Fe(Te.paint_model["model-type"]),"model-cast-shadows":new Fe(Te.paint_model["model-cast-shadows"]),"model-receive-shadows":new Fe(Te.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Fe(Te.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ut(Te.paint_model["model-emissive-strength"]),"model-roughness":new ut(Te.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ut(Te.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Fe(Te.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Fe(Te.paint_model["model-front-cutoff"])}),layout:LN};let _u=64,bd={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function BD(t,e,n,o,l,u,h,g,y,b=!1){let T=n.zoom,I=n.project(o),D=du(o.lat,T),P=1/D;r.ad.identity(t),r.ad.translate(t,t,[I.x+h[0]*P,I.y+h[1]*P,h[2]]);let R=1,L=1,N=n.worldSize;if(b){if(n.projection.name==="mercator"){let K=0;n.elevation&&(K=n.elevation.getAtPointOrZero(new si(I.x/N,I.y/N),0));let ae=r.aA.transformMat4([],[I.x,I.y,K,1],n.projMatrix)[3]/n.cameraToCenterDistance;R=ae,L=ae*du(n.center.lat,T)}else if(n.projection.name==="globe"){let K=z1(t,n),ae=r.ad.multiply([],n.projMatrix,K),oe=[0,0,0,1];r.aA.transformMat4(oe,oe,ae);let fe=oe[3]/n.cameraToCenterDistance,me=wa(T),we=n.projection.pixelsPerMeter(o.lat,N)*du(o.lat,T),Pe=n.projection.pixelsPerMeter(n.center.lat,N)*du(n.center.lat,T);R=fe/bt(we,rI(n.center.lat),me),L=fe*D/we,R*=Pe,L*=Pe}}else R=P;r.ad.scale(t,t,[R,R,L]);let j=[...t],Y=e.orientation,X=[];if(kD(X,[Y[0]+l[0],Y[1]+l[1],Y[2]+l[2]],u),r.ad.multiply(t,j,X),g&&n.elevation){let K=0,ae=[];if(y&&n.elevation){K=function(me,we,Pe,Ce,Le){let Ye=we.elevation;if(!Ye)return 0;let Oe=er.projectAabbCorners(Pe,Ce),He=wi(1,Le.lat)*we.worldSize,Re=function(xt,Vt){let Dt=[0,0,1],$t=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let jt of $t){let Yt=xt[jt.corners[0]],Et=xt[jt.corners[1]],Rn=xt[jt.corners[2]],Pn=[Et[0]-Yt[0],Et[1]-Yt[1],Vt*(Et[2]-Yt[2])],_n=r._.cross(Pn,Pn,[Rn[0]-Yt[0],Rn[1]-Yt[1],Vt*(Rn[2]-Yt[2])]);r._.normalize(_n,_n),jt.dotProductWithUp=r._.dot(_n,Dt)}return $t.sort((jt,Yt)=>jt.dotProductWithUp-Yt.dotProductWithUp),$t[0].corners}(Oe,He),qe=Oe[Re[0]],Qe=Oe[Re[1]],Ze=Oe[Re[2]],ht=Oe[Re[3]],Xe=Ye.getAtPointOrZero(new si(qe[0]/we.worldSize,qe[1]/we.worldSize),0),tt=Ye.getAtPointOrZero(new si(Qe[0]/we.worldSize,Qe[1]/we.worldSize),0),vt=Ye.getAtPointOrZero(new si(Ze[0]/we.worldSize,Ze[1]/we.worldSize),0),yt=Ye.getAtPointOrZero(new si(ht[0]/we.worldSize,ht[1]/we.worldSize),0),mt=(Xe+yt)/2,et=(tt+vt)/2;return mt>et?tt<vt?fy(me,Qe,ht,qe,tt,yt,Xe,He):fy(me,Ze,qe,ht,vt,Xe,yt,He):Xe<yt?fy(me,qe,Qe,Ze,Xe,tt,vt,He):fy(me,ht,Ze,Qe,yt,vt,tt,He),Math.max(mt,et)}(ae,n,e.aabb,t,o);let oe=r.ad.fromQuat([],ae),fe=r.ad.multiply([],oe,X);r.ad.multiply(t,j,fe)}else K=n.elevation.getAtPointOrZero(new si(I.x/N,I.y/N),0);K!==0&&(t[14]+=K)}}function em(t,e,n=!1){t.uploaded||(t.gfxTexture=new Do(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function NN(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,SN.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,RN.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,PN.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?MN:AN).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,kN.members,!0)),t.segments=Jn.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let o=t.material;o.pbrMetallicRoughness.baseColorTexture&&em(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&em(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&em(o.normalTexture,e),o.occlusionTexture&&em(o.occlusionTexture,e,n),o.emissionTexture&&em(o.emissionTexture,e)}function V1(t,e,n){if(t.meshes)for(let o of t.meshes)NN(o,e,n);if(t.children)for(let o of t.children)V1(o,e,n)}function my(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)my(e)}function j1(t){if(t.meshes)for(let n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let n of t.children)j1(n)}class zN{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class BN{constructor(){this.tasks={},this.taskQueue=[],_h(["process"],this),this.invoker=new zN(this.process),this.nextId=0}add(e,n){let o=this.nextId++,l=function({type:u,isSymbolTile:h,zoom:g}){return g=g||0,u==="message"?0:u!=="maybePrepare"||h?u!=="parseTile"||h?u==="parseTile"&&h?300-g:u==="maybePrepare"&&h?400-g:500:200-g:100-g}(n);if(l===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:n,priority:l,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let l=0;l<this.taskQueue.length;l++){let u=this.tasks[this.taskQueue[l]];u.priority<n&&(n=u.priority,e=l)}if(e===null)return null;let o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class VD{constructor(e,n,o){this.target=e,this.parent=n,this.mapId=o,this.callbacks={},this.cancelCallbacks={},_h(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new BN}send(e,n,o,l,u=!1,h){let g=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=h,this.callbacks[g]=o);let y=new Set;return this.target.postMessage({id:g,type:e,hasCallback:!!o,targetMapId:l,mustQueue:u,sourceMapId:this.mapId,data:pe(n,y)},y),{cancel:()=>{o&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(e){let n=e.data,o=n.id;if(o&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let l=this.cancelCallbacks[o];delete this.cancelCallbacks[o],l&&l.cancel()}else if(n.mustQueue||Pr()){let l=this.callbacks[o],u=this.scheduler.add(()=>this.processTask(o,n),l&&l.metadata||{type:"message"});u&&(this.cancelCallbacks[o]=u)}else this.processTask(o,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){let o=this.callbacks[e];delete this.callbacks[e],o&&(n.error?o(Ee(n.error)):o(null,Ee(n.data)))}else{let o=new Set,l=n.hasCallback?(h,g)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:h?pe(h):null,data:pe(g,o)},o)}:h=>{},u=Ee(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,u,l);else if(this.parent.getWorkerSource){let h=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,h[0],u.source,u.scope)[h[1]](u,l)}else l(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let U1=(()=>{class t{constructor(n,o){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=mh();let l=this.workerPool.acquire(this.id);for(let u=0;u<l.length;u++){let h=new t.Actor(l[u],o,this.id);h.name=`Worker ${u}`,this.actors.push(h)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,o,l){il(this.actors,(u,h)=>{u.send(n,o,h)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=VD,t})();var tm={workerUrl:"",workerClass:null,workerParams:void 0};function VN(){return tm.workerClass!=null?new tm.workerClass:new self.Worker(tm.workerUrl,tm.workerParams)}let $1="mapboxgl_preloaded_worker_pool";class nm{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<nm.workerCount;)this.workers.push(new VN);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[$1]}numActive(){return Object.keys(this.active).length}}let rm;function gy(){return rm||(rm=new nm),rm}nm.workerCount=2;let _y,G1,Xo,wd,H1,Td=null;function jD(){return Pr()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:G1||k.DRACO_URL}function UD(){if(Pr()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(wd)return wd;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return wd=WebAssembly.validate(t)?k.MESHOPT_SIMD_URL:k.MESHOPT_URL,wd}let yy={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},jN={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},im={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function $D(t,e,n){let o=n.json.bufferViews.length,l=n.buffers.length;e.bufferView=o,n.json.bufferViews[o]={buffer:l,byteLength:t.byteLength},n.buffers[l]=t}let q1="KHR_draco_mesh_compression";function UN(t,e){let n=t.extensions&&t.extensions[q1];if(!n)return;let o=new Xo.Decoder,l=WD(e,n.bufferView),u=new Xo.Mesh;if(!o.DecodeArrayToMesh(l,l.byteLength,u))throw new Error("Failed to decode Draco mesh");let h=e.json.accessors[t.indices],g=yy[h.componentType],y=h.count*g.BYTES_PER_ELEMENT,b=Xo._malloc(y);g===Uint16Array?o.GetTrianglesUInt16Array(u,y,b):o.GetTrianglesUInt32Array(u,y,b),$D(Xo.memory.buffer.slice(b,b+y),h,e),Xo._free(b);for(let T of Object.keys(n.attributes)){let I=o.GetAttributeByUniqueId(u,n.attributes[T]),D=e.json.accessors[t.attributes[T]],P=jN[D.componentType],R=D.count*im[D.type]*yy[D.componentType].BYTES_PER_ELEMENT,L=Xo._malloc(R);o.GetAttributeDataArrayForAllPoints(u,I,Xo[P],R,L),$D(Xo.memory.buffer.slice(L,L+R),D,e),Xo._free(L)}o.destroy(),u.destroy(),delete t.extensions[q1]}let vy="EXT_meshopt_compression";function $N(t,e){if(!t.extensions||!t.extensions[vy])return;let n=t.extensions[vy],o=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),l=new Uint8Array(n.count*n.byteStride);H1.decodeGltfBuffer(l,n.count,n.byteStride,o,n.mode,n.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=l.buffer,delete t.extensions[vy]}let GD=1179937895,HD=new TextDecoder("utf8");function qD(t,e){return new URL(t,e).href}function GN(t,e,n,o){return fetch(qD(t.uri,o)).then(l=>l.arrayBuffer()).then(l=>{e.buffers[n]=l})}function WD(t,e){let n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function HN(t,e,n,o){if(t.uri){let l=qD(t.uri,o);return fetch(l).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{e.images[n]=u})}if(t.bufferView!==void 0){let l=WD(e,t.bufferView),u=new Blob([l],{type:t.mimeType});return createImageBitmap(u).then(h=>{e.images[n]=h})}}function ZD(t,e=0,n){let o={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===GD){let T=new Uint32Array(t,e),I=2,D=(T[I++]>>2)-3,P=T[I++]>>2;if(I++,o.json=JSON.parse(HD.decode(T.subarray(I,I+P))),I+=P,I<D){let R=T[I++];I++;let L=e+(I<<2);o.buffers[0]=t.slice(L,L+R)}}else o.json=JSON.parse(HD.decode(new Uint8Array(t,e)));let{buffers:l,images:u,meshes:h,extensionsUsed:g,bufferViews:y}=o.json,b=Promise.resolve();if(l){let T=[];for(let I=0;I<l.length;I++){let D=l[I];D.uri?T.push(GN(D,o,I,n)):o.buffers[I]||(o.buffers[I]=null)}b=Promise.all(T)}return b.then(()=>{let T=[],I=g&&g.includes(q1),D=g&&g.includes(vy);if(I&&T.push(function(){if(!Xo)return _y||(_y=function(P){let R,L=null;function N(){R=new Uint8Array(L.buffer)}function j(){throw new Error("Unexpected Draco error.")}let Y={a:{a:j,d:function(X,K,ae){return R.copyWithin(X,K,K+ae)},c:function(X){let K=R.length,ae=Math.max(X>>>0,Math.ceil(1.2*K)),oe=Math.ceil((ae-K)/65536);try{return L.grow(oe),N(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(P,Y):P.then(X=>X.arrayBuffer()).then(X=>WebAssembly.instantiate(X,Y))).then(X=>{let{Rb:K,Qb:ae,P:oe,T:fe,X:me,Ja:we,La:Pe,Qa:Ce,Va:Le,Wa:Ye,eb:Oe,jb:He,f:Re,e:qe,yb:Qe,zb:Ze,Ab:ht,Bb:Xe,Db:tt,Gb:vt}=X.instance.exports;L=qe;let yt=(()=>{let mt=0,et=0,xt=0,Vt=0;return Dt=>{xt&&(K(Vt),K(mt),et+=xt,xt=mt=0),mt||(et+=128,mt=ae(et));let $t=Dt.length+7&-8,jt=mt;$t>=et&&(xt=$t,jt=Vt=ae($t));for(let Yt=0;Yt<Dt.length;Yt++)R[jt+Yt]=Dt[Yt];return jt}})();return N(),Re(),{memory:qe,_free:K,_malloc:ae,Mesh:class{constructor(){this.ptr=oe()}destroy(){fe(this.ptr)}},Decoder:class{constructor(){this.ptr=we()}destroy(){He(this.ptr)}DecodeArrayToMesh(mt,et,xt){let Vt=yt(mt),Dt=Pe(this.ptr,Vt,et,xt.ptr);return!!me(Dt)}GetAttributeByUniqueId(mt,et){return{ptr:Ce(this.ptr,mt.ptr,et)}}GetTrianglesUInt16Array(mt,et,xt){Le(this.ptr,mt.ptr,et,xt)}GetTrianglesUInt32Array(mt,et,xt){Ye(this.ptr,mt.ptr,et,xt)}GetAttributeDataArrayForAllPoints(mt,et,xt,Vt,Dt){Oe(this.ptr,mt.ptr,et.ptr,xt,Vt,Dt)}},DT_INT8:Qe(),DT_UINT8:Ze(),DT_INT16:ht(),DT_UINT16:Xe(),DT_UINT32:tt(),DT_FLOAT32:vt()}})}(fetch(jD())),_y.then(P=>{Xo=P,_y=void 0}))}()),D&&T.push(function(){if(H1)return;let P=function(R){let L,N=WebAssembly.instantiateStreaming(R,{}).then(X=>{L=X.instance,L.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Y={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:N,supported:!0,decodeGltfBuffer(X,K,ae,oe,fe,me){(function(we,Pe,Ce,Le,Ye,Oe,He){let Re=we.exports.sbrk,qe=Le+3&-4,Qe=Re(qe*Ye),Ze=Re(Oe.length),ht=new Uint8Array(we.exports.memory.buffer);ht.set(Oe,Ze);let Xe=Pe(Qe,Le,Ye,Ze,Oe.length);if(Xe===0&&He&&He(Qe,qe,Ye),Ce.set(ht.subarray(Qe,Qe+Le*Ye)),Re(Qe-Re(0)),Xe!==0)throw new Error(`Malformed buffer data: ${Xe}`)})(L,L.exports[Y[fe]],X,K,ae,oe,L.exports[j[me]])}}}(fetch(UD()));return P.ready.then(()=>{H1=P})}()),u)for(let P=0;P<u.length;P++)T.push(HN(u[P],o,P,n));return(T.length?Promise.all(T):Promise.resolve()).then(()=>{if(I&&h)for(let{primitives:P}of h)for(let R of P)UN(R,o);if(D&&h&&y)for(let P of y)$N(P,o);return o})})}function yu(t,e){let n=t.json.bufferViews[e.bufferView],o=yy[e.componentType];return new o(t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==im[e.type]*o.BYTES_PER_ELEMENT?n.byteStride/o.BYTES_PER_ELEMENT:im[e.type]))}function W1(t,e,n,o){let l=yy[e.componentType],u=function(T){switch(T){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(l),h=t.json.bufferViews[e.bufferView],g=h.byteStride?h.byteStride/l.BYTES_PER_ELEMENT:im[e.type],y=n.float32,b=y.length/n.capacity;for(let T=0,I=0;T<e.count*g;T+=g,I+=b)for(let D=0;D<b;D++)y[I+D]=o[T+D]*u;n._trim()}function qN(t,e,n){let o=t.indices,l=t.attributes,u={};u.indexArray=new Ir;let h=e.json.accessors[o],g=h.count/3;u.indexArray.reserve(g);let y=yu(e,h);for(let D=0;D<g;D++)u.indexArray.emplaceBack(y[3*D],y[3*D+1],y[3*D+2]);u.indexArray._trim(),u.vertexArray=new Ml;let b=e.json.accessors[l.POSITION];u.vertexArray.reserve(b.count);let T=yu(e,b);for(let D=0;D<b.count;D++)u.vertexArray.emplaceBack(T[3*D],T[3*D+1],T[3*D+2]);if(u.vertexArray._trim(),u.aabb=new er(b.min,b.max),u.centroid=function(D,P){let R=[0,0,0],L=D.length;if(L>0){for(let N=0;N<L;N++){let j=3*D[N];R[0]+=P[j],R[1]+=P[j+1],R[2]+=P[j+2]}R[0]/=L,R[1]/=L,R[2]/=L}return R}(y,T),l.COLOR_0!==void 0){let D=e.json.accessors[l.COLOR_0],P=im[D.type],R=yu(e,D);u.colorArray=P===3?new Ml:new Sl,u.colorArray.resize(D.count),W1(e,D,u.colorArray,R)}if(l.NORMAL!==void 0){u.normalArray=new Ml;let D=e.json.accessors[l.NORMAL];u.normalArray.resize(D.count);let P=yu(e,D);W1(e,D,u.normalArray,P)}if(l.TEXCOORD_0!==void 0&&n.length>0){u.texcoordArray=new Jh;let D=e.json.accessors[l.TEXCOORD_0];u.texcoordArray.resize(D.count);let P=yu(e,D);W1(e,D,u.texcoordArray,P)}if(l._FEATURE_ID_RGBA4444!==void 0){let D=e.json.accessors[l._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=yu(e,D))}l._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(yu(e,e.json.accessors[l._FEATURE_RGBA4444]).buffer));let I=t.material;return u.material=function(D,P){let{emissiveFactor:R=[0,0,0],alphaMode:L="OPAQUE",alphaCutoff:N=.5,normalTexture:j,occlusionTexture:Y,emissiveTexture:X,doubleSided:K}=D,{baseColorFactor:ae=[1,1,1,1],metallicFactor:oe=1,roughnessFactor:fe=1,baseColorTexture:me,metallicRoughnessTexture:we}=D.pbrMetallicRoughness||{},Pe=Y?P[Y.index]:void 0;if(Y&&Y.extensions&&Y.extensions.KHR_texture_transform&&Pe){let Ce=Y.extensions.KHR_texture_transform;Pe.offsetScale=[Ce.offset[0],Ce.offset[1],Ce.scale[0],Ce.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new pn(...ae),metallicFactor:oe,roughnessFactor:fe,baseColorTexture:me?P[me.index]:void 0,metallicRoughnessTexture:we?P[we.index]:void 0},doubleSided:K,emissiveFactor:R,alphaMode:L,alphaCutoff:N,normalTexture:j?P[j.index]:void 0,occlusionTexture:Pe,emissionTexture:X?P[X.index]:void 0,defined:D.defined===void 0}}(I!==void 0?e.json.materials[I]:{defined:!1},n),u}function YD(t,e,n){let{matrix:o,rotation:l,translation:u,scale:h,mesh:g,extras:y,children:b}=t,T={};if(T.matrix=o||r.ad.fromRotationTranslationScale([],l||[0,0,0,1],u||[0,0,0],h||[1,1,1]),g!==void 0){T.meshes=n[g];let I=T.anchor=[0,0];for(let D of T.meshes){let{min:P,max:R}=D.aabb;I[0]+=P[0]+R[0],I[1]+=P[1]+R[1]}I[0]=Math.floor(I[0]/T.meshes.length/2),I[1]=Math.floor(I[1]/T.meshes.length/2)}if(y&&(y.id&&(T.id=y.id),y.lights&&(T.lights=function(I){if(!I.length)return[];let D=function(j){let Y=atob(j),X=new Uint8Array(Y.length);for(let K=0;K<Y.length;K++)X[K]=Y.codePointAt(K);return X}(I),P=[],R=D.length/24,L=new Uint16Array(D.buffer),N=new Float32Array(D.buffer);for(let j=0;j<R;j++){let Y=L[2*j*6]/30,X=L[2*j*6+1]/30,K=L[2*j*6+10]/100,ae=N[6*j+1],oe=N[6*j+2],fe=N[6*j+3],me=N[6*j+4],we=fe-ae,Pe=me-oe,Ce=Math.hypot(we,Pe);P.push({pos:[ae+.5*we,oe+.5*Pe,X],normal:[Pe/Ce,-we/Ce,0],width:Ce,height:Y,depth:K,points:[ae,oe,fe,me]})}return P}(y.lights))),b){let I=[];for(let D of b)I.push(YD(e.json.nodes[D],e,n));T.children=I}return T}function WN(t){if(t.vertices.length===0||t.indices.length===0)return null;let e=new c1(t.vertices,t.indices,8,256),[n,o]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:n,max:o}}function ZN(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let o=[];for(let h of n){if(!Array.isArray(h)||h.length!==2)continue;let g=h[0],y=h[1];typeof g=="number"&&typeof y=="number"&&o.push(new at(g,y))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let l=0;for(let h=0;h<o.length;h++){let g=o[h],y=o[(h+1)%o.length],b=o[(h+2)%o.length];l+=(g.x-y.x)*(b.y-y.y)-(b.x-y.x)*(g.y-y.y)}l>0&&o.reverse();let u=Lp(o.flatMap(h=>[h.x,h.y]),[]);return u.length===0?null:{vertices:o,indices:u}}function YN(t,e){let n=[],o=[],l=0,u=[];for(let h of t){l=n.length;let g=h.vertexArray.float32,y=h.indexArray.uint16;for(let b=0;b<h.vertexArray.length;b++)u[0]=g[3*b+0],u[1]=g[3*b+1],u[2]=g[3*b+2],r._.transformMat4(u,u,e),n.push(new at(u[0],u[1]));for(let b=0;b<3*h.indexArray.length;b++)o.push(y[b]+l)}if(o.length%3!=0)return null;for(let h=0;h<o.length;h+=3){let g=n[o[h+0]],y=n[o[h+1]],b=n[o[h+2]];(g.x-y.x)*(b.y-y.y)-(b.x-y.x)*(g.y-y.y)>0&&([o[h+1],o[h+2]]=[o[h+2],o[h+1]])}return{vertices:n,indices:o}}function XD(t){let e=function(y,b){let T=[],I=WebGL2RenderingContext;if(y.json.textures)for(let D of y.json.textures){let P={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};D.sampler!==void 0&&Object.assign(P,y.json.samplers[D.sampler]),T.push({image:b[D.source],sampler:P,uploaded:!1})}return T}(t,t.images),n=function(y,b){let T=[];for(let I of y.json.meshes){let D=[];for(let P of I.primitives)D.push(qN(P,y,b));T.push(D)}return T}(t,e),{scenes:o,scene:l,nodes:u}=t.json,h=o?o[l||0].nodes:u,g=[];for(let y of h)g.push(YD(u[y],t,n));return function(y,b,T){let I={},D=new Set;for(let P=0;P<y.length;P++){let R=T[b[P]];if(!R.extras)continue;let L=R.extras["mapbox:footprint:version"],N=R.extras["mapbox:footprint:id"];(L||N)&&D.add(P),L==="1.0.0"&&N&&(I[N]=P)}for(let P=0;P<y.length;P++){if(D.has(P))continue;let R=y[P],L=T[b[P]];if(!L.extras)continue;let N=null;R.id in I&&(N=YN(y[I[R.id]].meshes,R.matrix)),N||(N=ZN(L)),N&&(R.footprint=WN(N))}if(D.size>0){let P=Array.from(D.values()).sort((R,L)=>R-L);for(let R=P.length-1;R>=0;R--)y.splice(P[R],1)}}(g,h,t.json.nodes),g}function XN(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,n=t.aabb.min[0]-1,o=t.aabb.min[1]-1,l=_u/(t.aabb.max[0]-n+2),u=_u/(t.aabb.max[1]-o+2);for(let h=0;h<e.length;h+=3){let g=e[h+2],y=(e[h+0]-n)*l|0,b=(e[h+1]-o)*u|0;g>t.heightmap[b*_u+y]&&(t.heightmap[b*_u+y]=g)}}function KN(t,e){let n={};n.indexArray=new Ir,n.indexArray.reserve(4*t.length),n.vertexArray=new Ml,n.vertexArray.reserve(10*t.length),n.colorArray=new Sl,n.vertexArray.reserve(10*t.length);let o=0;for(let h of t){let g=Math.min(10,Math.max(4,1.3*h.height))*e,y=[-h.normal[1],h.normal[0],0],b=Math.min(.29,.1*h.width/h.depth),T=h.width-2*h.depth*e*(b+.01),I=r._.scaleAndAdd([],h.pos,y,T/2),D=r._.scaleAndAdd([],h.pos,y,-T/2),P=[I[0],I[1],I[2]+h.height],R=[D[0],D[1],D[2]+h.height],L=r._.scaleAndAdd([],h.normal,y,b);r._.scale(L,L,g);let N=r._.scaleAndAdd([],h.normal,y,-b);r._.scale(N,N,g),r._.add(L,I,L),r._.add(N,D,N),I[2]+=.1,D[2]+=.1,n.vertexArray.emplaceBack(L[0],L[1],L[2]),n.vertexArray.emplaceBack(N[0],N[1],N[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(P[0],P[1],P[2]),n.vertexArray.emplaceBack(R[0],R[1],R[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(L[0],L[1],L[2]),n.vertexArray.emplaceBack(N[0],N[1],N[2]);let j=T/g/2;n.colorArray.emplaceBack(-j-b,-1,j,.8),n.colorArray.emplaceBack(j+b,-1,j,.8),n.colorArray.emplaceBack(-j,0,j,1.3),n.colorArray.emplaceBack(j,0,j,1.3),n.colorArray.emplaceBack(j+b,-.8,j,.7),n.colorArray.emplaceBack(j+b,-.8,j,.7),n.colorArray.emplaceBack(0,0,j,1.3),n.colorArray.emplaceBack(0,0,j,1.3),n.colorArray.emplaceBack(j+b,-1.2,j,.8),n.colorArray.emplaceBack(j+b,-1.2,j,.8),n.indexArray.emplaceBack(6+o,4+o,8+o),n.indexArray.emplaceBack(7+o,9+o,5+o),n.indexArray.emplaceBack(0+o,1+o,2+o),n.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}let l={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=pn.white,l.pbrMetallicRoughness=u,n.material=l,n.aabb=new er([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}let Z1=new Float32Array(262144),vu=new Uint8Array(262144);function KD(t){let e=0;if(t.meshes)for(let n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(let n of t.children)e=Math.max(e,KD(n));return e}function QD(t,e,n){if(t.meshes)for(let o of t.meshes)o.aabb.min[0]!==1/0&&n.insert(e,o.aabb.min[0],o.aabb.min[1],o.aabb.max[0],o.aabb.max[1]);if(t.children)for(let o of t.children)QD(o,e,n)}let JD=["","wall","door","roof","window","lamp","logo"];class eS{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:KD(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new er([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,n=new er([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=er.applyTransform(o.aabb,this.node.matrix),n.encapsulate(o.transformedAabb)),e++;this.aabb=n}return this.aabb}}class xy{constructor(e,n,o,l,u,h){this.id=n,this.modelTraits|=bd.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,o&&(this.modelTraits|=bd.HasMapboxMeshFeatures),l&&(this.modelTraits|=bd.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=u,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let g of e)this.nodesInfo.push(new eS(g)),QD(g,h.featureIndexArray.length,h.grid),h.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,h.bucketLayerIDs.length-1,0)}updateFootprints(e,n){for(let o of this.getNodesInfo()){let l=o.node;l.footprint&&n.push({footprint:l.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let o of n){let l=o.node;this.uploaded?this.updatePbrBuffer(l):V1(l,e,!0)}for(let o of n)my(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),n=!0);return n}needsReEvaluation(e,n,o){let l=e.transform.projectionOptions,u=e.style.getBrightness(),h=this.brightness!==u;return!!(!this.uploaded||this.dirty||l.name!==this.projection.name||om(o.paint.get("model-color").value,h)||om(o.paint.get("model-color-mix-intensity").value,h)||om(o.paint.get("model-roughness").value,h)||om(o.paint.get("model-emissive-strength").value,h)||om(o.paint.get("model-height-based-emissive-strength-multiplier").value,h))&&(this.projection=l,this.brightness=u,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let o=this.getNodesInfo(),l=this.id.canonical;for(let u of o){let h=u.feature;u.evaluatedScale=n.paint.get("model-scale").evaluate(h,{},l)}}evaluate(e){let n=this.getNodesInfo();for(let o of n){if(!o.node.meshes)continue;let l=o.feature,u=o.node.meshes&&o.node.meshes[0].featureData,h=o.evaluatedColor[2],g=o.evaluatedRMEA[2],y=this.id.canonical;if(o.hasTranslucentParts=!1,u){for(let b=0;b<JD.length;b++){let T=JD[b];T.length&&(l.properties.part=T);let I=e.paint.get("model-color").evaluate(l,{},y).toRenderColor(null),D=e.paint.get("model-color-mix-intensity").evaluate(l,{},y);o.evaluatedColor[b]=[I.r,I.g,I.b,D],o.evaluatedRMEA[b][0]=e.paint.get("model-roughness").evaluate(l,{},y),o.evaluatedRMEA[b][2]=e.paint.get("model-emissive-strength").evaluate(l,{},y),o.evaluatedRMEA[b][3]=I.a,o.emissionHeightBasedParams[b]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(l,{},y),!o.hasTranslucentParts&&I.a<1&&(o.hasTranslucentParts=!0)}delete l.properties.part,JN(o,h!==o.evaluatedColor[2]||g!==o.evaluatedRMEA[2],this.modelTraits)}else o.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(l,{},y);o.evaluatedScale=e.paint.get("model-scale").evaluate(l,{},y),this.updatePbrBuffer(o.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,o,l){let u=e.findDEMTileFor(o);if(u&&(u.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;let h=ld.create(e,o,u);if(!h)return;this.modelTraits&bd.HasMapboxMeshFeatures&&this.updateDEM(e,h,o,l);for(let g of this.getNodesInfo()){let y=g.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;let b=y.footprint.vertices,T=h.getElevationAt(b[0].x,b[0].y,!0,!0);for(let I=1;I<b.length;I++)T=Math.min(T,h.getElevationAt(b[I].x,b[I].y,!0,!0));y.elevation=T}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,o,l){let u=n._dem._modifiedForSources[l];if(u===void 0&&(n._dem._modifiedForSources[l]=[],u=n._dem._modifiedForSources[l]),u.includes(o.canonical))return;let h=n._dem.dim;u.push(o.canonical);let g=!1;for(let y of this.getNodesInfo()){let b=y.node;if(!b.footprint||!b.footprint.grid)continue;let T=b.footprint.grid,I=n.tileCoordToPixel(T.min.x,T.min.y),D=n.tileCoordToPixel(T.max.x,T.max.y),P=Math.min(Math.min(h-D.y,I.x),Math.min(I.y,h-D.x));if(P<0)continue;let R=Ht(P,2,5),L=Math.max(0,I.x-R),N=Math.max(0,I.y-R),j=Math.min(D.x+R,h-1),Y=Math.min(D.y+R,h-1);for(let oe=N;oe<=Y;++oe)for(let fe=L;fe<=j;++fe)vu[oe*h+fe]=255;let X=0,K=0;for(let oe=0;oe<T.cellsY;++oe)for(let fe=0;fe<T.cellsX;++fe){if(!T.cells[oe*T.cellsX+fe])continue;let me=n.tileCoordToPixel(T.min.x+fe/T.xScale,T.min.y+oe/T.yScale),we=n.tileCoordToPixel(T.min.x+(fe+1)/T.xScale,T.min.y+(oe+1)/T.yScale);for(let Pe=me.y;Pe<=Math.min(we.y+1,h-1);++Pe)for(let Ce=me.x;Ce<=Math.min(we.x+1,h-1);++Ce)vu[Pe*h+Ce]===255&&(vu[Pe*h+Ce]=0,X+=n.getElevationAtPixel(Ce,Pe),K++)}let ae=X/K;L=Math.max(1,I.x-R),N=Math.max(1,I.y-R),j=Math.min(D.x+R,h-2),Y=Math.min(D.y+R,h-2),g=!0;for(let oe=N;oe<=Y;++oe)for(let fe=L;fe<=j;++fe)vu[oe*h+fe]===0&&(Z1[oe*h+fe]=n._dem.set(fe,oe,ae));for(let oe=1;oe<R;++oe){L=Math.max(1,I.x-oe),N=Math.max(1,I.y-oe),j=Math.min(D.x+oe,h-2),Y=Math.min(D.y+oe,h-2);for(let fe=N;fe<=Y;++fe)for(let me=L;me<=j;++me){let we=fe*h+me;if(vu[we]===255){let Pe=0,Ce=0,Le=-1,Ye=-1;for(let Oe=-1;Oe<=1;++Oe)for(let He=-1;He<=1;++He){let Re=(fe+Oe)*h+me+He;if(vu[Re]>=oe)continue;let qe=Z1[Re],Qe=Math.abs(qe);Qe>Ce&&(Pe=qe,Ce=Qe,Le=He,Ye=Oe)}if(Ce>.1){let Oe=1-(oe+.5*Math.abs(Le*Ye))/R,He=n._dem.get(me,fe)+Pe*Oe,Re=n._dem.get(me+Le,fe+Ye),qe=n._dem.get(me-Le,fe-Ye,!0);(He-Re)*(He-qe)>0&&(He=(Re+qe)/2),Z1[we]=n._dem.set(me,fe,He),vu[we]=oe}}}}}g&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Rr.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let n of e)my(n.node),j1(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let o=n.getReplacementRegionsForTile(e.toUnwrapped()),l=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){let h=l[u].node;l[u].hiddenByReplacement=!!h.footprint&&!o.find(g=>g.footprint===h.footprint)}}getHeightAtTileCoord(e,n){let o=this.getNodesInfo(),l=[],u=[0,0,0],h=r.ad.identity([]);for(let g=0;g<this.nodesInfo.length;g++){let y=o[g],b=y.node.meshes[0],T=b.transformedAabb;if(e<T.min[0]||n<T.min[1]||e>T.max[0]||n>T.max[1])continue;if(y.node.hidden===!0)return{height:0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};r.ad.invert(h,y.node.matrix),u[0]=e,u[1]=n,r._.transformMat4(u,u,h);let I=(u[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*_u|0,D=Math.min(63,(u[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*_u|0)*_u+Math.min(63,I),P=b.heightmap[D];if(!(P<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:P,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new at(e,n),new at(e,n),l),l.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function om(t,e){return!t.isLightConstant&&e}function QN(t,e,n,o,l,u,h,g){let y=(61440&e|(61440&e)>>4)>>8,b=(3840&e|(3840&e)>>4)>>4,T=240&e|(240&e)>>4;n[3]>0&&(y=bt(y,255*n[0],n[3]),b=bt(b,255*n[1],n[3]),T=bt(T,255*n[2],n[3]));let I=y<<8|b,D=T<<8|Math.floor(255*o[3]),P=function(oe){let fe=Ht(oe,0,2);return Math.min(Math.round(.5*fe*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],R=Ht(l[0],0,1),L=Ht(l[1],0,1),N=Ht(l[2],0,1),j=Ht(l[3],0,1),Y,X,K,ae;if(R!==L&&h!==u&&L!==R){let oe=h-u;X=1/(oe*(L-R)),K=-(u+oe*R)/(oe*(L-R));let fe=Ht(l[4],-1,1);ae=Math.pow(10,fe),Y=255*N<<8|255*j}else Y=65535,X=0,K=1,ae=1;if(t.emplaceBack(I,D,P,Y,X,K,ae),g){let oe=g.length;g.clear();for(let fe=0;fe<oe;fe++)g.emplaceBack(I,D,P,Y,X,K,ae)}}function JN(t,e,n){let o=t.node,l=0,u=n&bd.HasMeshoptCompression;for(let h of o.meshes){if(o.lights&&o.lightMeshIndex===l||!h.featureData)continue;h.featureArray=new x_,h.featureArray.reserve(h.featureData.length);let g=e;for(let y of h.featureData){let b=u?65535&y:y>>16&65535,T=u?y>>16&65535:65535&y,I=(15&T)<8?15&T:0,D=t.evaluatedRMEA[I],P=t.evaluatedColor[I],R=t.emissionHeightBasedParams[I],L;if(g&&I===2&&o.lights&&(L=new x_,L.resize(10*o.lights.length)),QN(h.featureArray,b,P,D,R,h.aabb.min[2],h.aabb.max[2],L),L&&g){g=!1;let N=o.meshes[o.lightMeshIndex];N.featureArray=L,N.featureArray._trim()}}h.featureArray._trim(),l++}}function tS(t,e,n,o){let l=1<<t.z;e.lat=kr((o/rt+t.y)/l),e.lng=Di((n/rt+t.x)/l)}Q(xy,"Tiled3dModelBucket",{omit:["layers"]}),Q(eS,"Tiled3dModelFeature");let e3={circle:class extends Xr{constructor(t,e,n,o){super(t,Vk,e,n,o)}createBucket(t){return new Hx(t)}queryRadius(t){let e=t;return od("circle-radius",this,e)+od("circle-stroke-width",this,e)+C_(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,o,l,u,h,g){let y=dI(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return DI(t,o,u,h,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,b)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,n){let o=CI(this);return{config:new cu(this,{zoom:e,lut:n}),defines:o,overrideFog:!1}}},heatmap:class extends Xr{createBucket(t){return new MI(t)}constructor(t,e,n,o){super(t,Kk,e,n,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=kp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return od("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,o,l,u,h,g){let y=this.paint.get("heatmap-radius").evaluate(e,n);return DI(t,o,u,h,g,!0,!0,new at(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,n){return t==="heatmap"?{config:new cu(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends Xr{constructor(t,e,n,o){super(t,Jk,e,n,o)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},fill:class extends Xr{constructor(t,e,n,o){super(t,fL,e,n,o)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e,n){return{config:new cu(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new L_(t)}queryRadius(){return C_(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,o,l,u){return!t.queryGeometry.isAboveHorizon&&aI(hI(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends Xr{constructor(t,e,n,o){super(t,$L,e,n,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new U_(t)}queryRadius(){return C_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,o,l,u,h,g,y){let b=dI(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,n),I=this.paint.get("fill-extrusion-base").evaluate(e,n),D=[0,0],P=g&&u.elevation,R=u.elevation?u.elevation.exaggeration():1,L=t.tile.getBucket(this);if(P&&L instanceof U_){let K=L.centroidVertexArray,ae=y+1;ae<K.length&&(D[0]=K.geta_centroid_pos0(ae),D[1]=K.geta_centroid_pos1(ae))}if(D[0]===0&&D[1]===1)return!1;u.projection.name==="globe"&&(o=gC([o],[new at(0,0),new at(rt,rt)],t.tileID.canonical).map(K=>K.polygon).flat());let N=P?g:null,[j,Y]=function(K,ae,oe,fe,me,we,Pe,Ce,Le,Ye,Oe){return K.projection.name==="globe"?function(He,Re,qe,Qe,Ze,ht,Xe,tt,vt,yt,mt){let et=[],xt=[],Vt=He.projection.upVectorScale(mt,He.center.lat,He.worldSize).metersToTile,Dt=[0,0,0,1],$t=[0,0,0,1],jt=(Et,Rn,Pn,_n)=>{Et[0]=Rn,Et[1]=Pn,Et[2]=_n,Et[3]=1},Yt=mC();qe>0&&(qe+=Yt),Qe+=Yt;for(let Et of Re){let Rn=[],Pn=[];for(let _n of Et){let rn=_n.x+Ze.x,yn=_n.y+Ze.y,jn=He.projection.projectTilePoint(rn,yn,mt),Ln=He.projection.upVector(mt,_n.x,_n.y),rr=qe,tr=Qe;if(Xe){let ai=yC(rn,yn,qe,Qe,Xe,tt,vt,yt);rr+=ai.base,tr+=ai.top}qe!==0?jt(Dt,jn.x+Ln[0]*Vt*rr,jn.y+Ln[1]*Vt*rr,jn.z+Ln[2]*Vt*rr):jt(Dt,jn.x,jn.y,jn.z),jt($t,jn.x+Ln[0]*Vt*tr,jn.y+Ln[1]*Vt*tr,jn.z+Ln[2]*Vt*tr),r._.transformMat4(Dt,Dt,ht),r._.transformMat4($t,$t,ht),Rn.push(new pu(Dt[0],Dt[1],Dt[2])),Pn.push(new pu($t[0],$t[1],$t[2]))}et.push(Rn),xt.push(Pn)}return[et,xt]}(K,ae,oe,fe,me,we,Pe,Ce,Le,Ye,Oe):Pe?function(He,Re,qe,Qe,Ze,ht,Xe,tt,vt){let yt=[],mt=[],et=[0,0,0,1];for(let xt of He){let Vt=[],Dt=[];for(let $t of xt){let jt=$t.x+Qe.x,Yt=$t.y+Qe.y,Et=yC(jt,Yt,Re,qe,ht,Xe,tt,vt);et[0]=jt,et[1]=Yt,et[2]=Et.base,et[3]=1,r.aA.transformMat4(et,et,Ze),et[3]=Math.max(et[3],1e-5);let Rn=new pu(et[0]/et[3],et[1]/et[3],et[2]/et[3]);et[0]=jt,et[1]=Yt,et[2]=Et.top,et[3]=1,r.aA.transformMat4(et,et,Ze),et[3]=Math.max(et[3],1e-5);let Pn=new pu(et[0]/et[3],et[1]/et[3],et[2]/et[3]);Vt.push(Rn),Dt.push(Pn)}yt.push(Vt),mt.push(Dt)}return[yt,mt]}(ae,oe,fe,me,we,Pe,Ce,Le,Ye):function(He,Re,qe,Qe,Ze){let ht=[],Xe=[],tt=Ze[8]*Re,vt=Ze[9]*Re,yt=Ze[10]*Re,mt=Ze[11]*Re,et=Ze[8]*qe,xt=Ze[9]*qe,Vt=Ze[10]*qe,Dt=Ze[11]*qe;for(let $t of He){let jt=[],Yt=[];for(let Et of $t){let Rn=Et.x+Qe.x,Pn=Et.y+Qe.y,_n=Ze[0]*Rn+Ze[4]*Pn+Ze[12],rn=Ze[1]*Rn+Ze[5]*Pn+Ze[13],yn=Ze[2]*Rn+Ze[6]*Pn+Ze[14],jn=Ze[3]*Rn+Ze[7]*Pn+Ze[15],Ln=_n+tt,rr=rn+vt,tr=yn+yt,ai=Math.max(jn+mt,1e-5),or=_n+et,Xn=rn+xt,gr=yn+Vt,Lr=Math.max(jn+Dt,1e-5);jt.push(new pu(Ln/ai,rr/ai,tr/ai)),Yt.push(new pu(or/Lr,Xn/Lr,gr/Lr))}ht.push(jt),Xe.push(Yt)}return[ht,Xe]}(ae,oe,fe,me,we)}(u,o,I,T,b,h,N,D,R,u.center.lat,t.tileID.canonical),X=t.queryGeometry;return function(K,ae,oe){let fe=1/0;aI(oe,ae)&&(fe=_C(oe,ae[0]));for(let me=0;me<ae.length;me++){let we=ae[me],Pe=K[me];for(let Ce=0;Ce<we.length-1;Ce++){let Le=we[Ce],Ye=[Le,we[Ce+1],Pe[Ce+1],Pe[Ce],Le];qx(oe,Ye)&&(fe=Math.min(fe,_C(oe,Ye)))}}return fe!==1/0&&fe}(j,Y,X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends Xr{constructor(t,e,n,o){super(t,G_,e,n,o),G_.layout&&(this.layout=new nn(G_.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof tu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=TD.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new $_(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,n){let o=CC(this);return{config:new cu(this,{zoom:e,lut:n}),defines:o,overrideFog:!1}}queryRadius(t){let e=t,n=ED(od("line-width",this,e),od("line-gap-width",this,e)),o=od("line-offset",this,e);return n/2+Math.abs(o)+C_(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,o,l,u){if(t.queryGeometry.isAboveHorizon)return!1;let h=hI(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),g=t.pixelToTileUnitsFactor/2*ED(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),y=this.paint.get("line-offset").evaluate(e,n);return y&&(o=function(b,T){let I=[],D=new at(0,0);for(let P=0;P<b.length;P++){let R=b[P],L=[];for(let N=0;N<R.length;N++){let j=R[N],Y=R[N+1],X=N===0?D:j.sub(R[N-1])._unit()._perp(),K=N===R.length-1?D:Y.sub(j)._unit()._perp(),ae=X._add(K)._unit();ae._mult(1/(ae.x*K.x+ae.y*K.y)),L.push(ae._mult(T)._add(j))}I.push(L)}return I}(o,y*t.pixelToTileUnitsFactor)),function(b,T,I){for(let D=0;D<T.length;D++){let P=T[D];if(b.length>=3){for(let R=0;R<P.length;R++)if(Ll(b,P[R]))return!0}if(Fk(b,P,I))return!0}return!1}(h,o,g)}isTileClipped(){return!0}isDraped(t){let e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:cy,background:class extends Xr{constructor(t,e,n,o){super(t,yN,e,n,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},raster:SD,"raster-particle":MD,sky:class extends Xr{constructor(t,e,n,o){super(t,CN,e,n,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=kp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let o=this.paint.get("sky-atmosphere-sun"),l=!o,u=t.style.light,h=u.properties.get("position");return l&&u.properties.get("anchor")==="viewport"&&cr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?N1(h.azimuthal,90-h.polar,e):N1(o[0],90-o[1],e)}let n=this.paint.get("sky-gradient-center");return N1(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends Xr{constructor(t,e,n,o){super(t,DN,e,null)}},model:class extends Xr{constructor(t,e,n,o){super(t,FN,e,n,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new B1(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof xy?rt-1:0}queryIntersectsFeature(t,e,n,o,l,u){if(!this.modelManager)return!1;let h=this.modelManager,g=t.tile.getBucket(this);if(!(g&&g instanceof B1))return!1;let y=g;for(let b in y.instancesPerModel){let T=y.instancesPerModel[b],I=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(I)){let D=T.features[T.idToFeaturesIndex[I]],P=h.getModel(b,this.scope);if(!P)return!1;let R=r.ad.create(),L=new cn(0,0),N=y.canonical,j=Number.MAX_VALUE;for(let Y=0;Y<D.instancedDataCount;++Y){let X=16*(D.instancedDataOffset+Y),K=T.instancedDataArray.float32,ae=[K[X+4],K[X+5],K[X+6]];tS(N,L,K[X],0|K[X+1]),BD(R,P,u,L,D.rotation,D.scale,ae,!1,!1,!1),u.projection.name==="globe"&&(R=z1(R,u));let oe=r.ad.multiply([],u.projMatrix,R),fe=t.queryGeometry,me=LD(fe.isPointQuery()?fe.screenBounds:fe.screenGeometry,u,oe,P.aabb);me!=null&&(j=Math.min(me,j))}return j!==Number.MAX_VALUE&&j}}return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof $}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,n,o){let l=t.tile,u=l.getBucket(this),h=null,g=Number.MAX_VALUE;if(!(u&&u instanceof xy))return{queryFeature:h,intersectionZ:g};let y=u.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!n.filter(new Lt(l.tileID.overscaledZ),y.feature,l.tileID.canonical))return{queryFeature:h,intersectionZ:g};let b=y.node,T=o.calculatePosMatrix(l.tileID.toUnwrapped(),o.worldSize),I=y.evaluatedScale,D=0;o.elevation&&b.elevation&&(D=b.elevation*o.elevation.exaggeration()),r.ad.translate(T,T,[(b.anchor?b.anchor[0]:0)*(I[0]-1),(b.anchor?b.anchor[1]:0)*(I[1]-1),D]),r.ad.scale(T,T,I),r.ad.multiply(T,T,b.matrix);let P=t.queryGeometry,R=P.isPointQuery()?P.screenBounds:P.screenGeometry,L=function(j){let Y=r.ad.multiply([],T,j.matrix),X=r.ad.multiply(Y,o.expandedFarZProjMatrix,Y);for(let K=0;K<j.meshes.length;++K){let ae=j.meshes[K];if(K===j.lightMeshIndex)continue;let oe=LD(R,o,X,ae.aabb);oe!=null&&(g=Math.min(oe,g))}if(j.children)for(let K of j.children)L(K)};if(L(b),g===Number.MAX_VALUE)return{queryFeature:h,intersectionZ:g};let N=new cn(0,0);return tS(l.tileID.canonical,N,y.node.anchor[0],y.node.anchor[1]),h={type:"Feature",geometry:{type:"Point",coordinates:[N.lng,N.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:h,intersectionZ:g}}},clip:class extends Xr{constructor(t,e,n,o){super(t,mL,e,n,o)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new NI(t)}isTileClipped(){return!0}is3D(){return!0}}};Q(xD,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let nS=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Y1{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,o]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let l=o>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);let u=nS[15&o];if(!u)throw new Error("Unrecognized array type.");let[h]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new Y1(g,h,u,e)}constructor(e,n=64,o=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let u=nS.indexOf(this.ArrayType),h=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-g%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${o}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+h+g+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=n,o}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return X1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,o,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:h,nodeSize:g}=this,y=[0,u.length-1,0],b=[];for(;y.length;){let T=y.pop()||0,I=y.pop()||0,D=y.pop()||0;if(I-D<=g){for(let N=D;N<=I;N++){let j=h[2*N],Y=h[2*N+1];j>=e&&j<=o&&Y>=n&&Y<=l&&b.push(u[N])}continue}let P=D+I>>1,R=h[2*P],L=h[2*P+1];R>=e&&R<=o&&L>=n&&L<=l&&b.push(u[P]),(T===0?e<=R:n<=L)&&(y.push(D),y.push(P-1),y.push(1-T)),(T===0?o>=R:l>=L)&&(y.push(P+1),y.push(I),y.push(1-T))}return b}within(e,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:l,coords:u,nodeSize:h}=this,g=[0,l.length-1,0],y=[],b=o*o;for(;g.length;){let T=g.pop()||0,I=g.pop()||0,D=g.pop()||0;if(I-D<=h){for(let N=D;N<=I;N++)iS(u[2*N],u[2*N+1],e,n)<=b&&y.push(l[N]);continue}let P=D+I>>1,R=u[2*P],L=u[2*P+1];iS(R,L,e,n)<=b&&y.push(l[P]),(T===0?e-o<=R:n-o<=L)&&(g.push(D),g.push(P-1),g.push(1-T)),(T===0?e+o>=R:n+o>=L)&&(g.push(P+1),g.push(I),g.push(1-T))}return y}}function X1(t,e,n,o,l,u){if(l-o<=n)return;let h=o+l>>1;rS(t,e,h,o,l,u),X1(t,e,n,o,h-1,1-u),X1(t,e,n,h+1,l,1-u)}function rS(t,e,n,o,l,u){for(;l>o;){if(l-o>600){let b=l-o+1,T=n-o+1,I=Math.log(b),D=.5*Math.exp(2*I/3),P=.5*Math.sqrt(I*D*(b-D)/b)*(T-b/2<0?-1:1);rS(t,e,n,Math.max(o,Math.floor(n-T*D/b+P)),Math.min(l,Math.floor(n+(b-T)*D/b+P)),u)}let h=e[2*n+u],g=o,y=l;for(sm(t,e,o,n),e[2*l+u]>h&&sm(t,e,o,l);g<y;){for(sm(t,e,g,y),g++,y--;e[2*g+u]<h;)g++;for(;e[2*y+u]>h;)y--}e[2*o+u]===h?sm(t,e,o,y):(y++,sm(t,e,y,l)),y<=n&&(o=y+1),n<=y&&(l=y-1)}}function sm(t,e,n,o){K1(t,n,o),K1(e,2*n,2*o),K1(e,2*n+1,2*o+1)}function K1(t,e,n){let o=t[e];t[e]=t[n],t[n]=o}function iS(t,e,n,o){let l=t-n,u=e-o;return l*l+u*u}r.$=ea,r.A=Qc,r.B=bs,r.C=pn,r.D=ii,r.E=sa,r.G=Tr,r.H=c,r.I=qF,r.J=gx,r.K=function(t){let e=t.value,n=[];if(!e)return n;let o=la(e);return o!=="string"?(n=n.concat([new py(t.key,e,`string expected, "${o}" found`)]),n):(FD(e,!0)||(n=n.concat([new py(t.key,e,`invalid url "${e}"`)])),n)},r.L=Te,r.M=class{constructor(t,e,n,o){this.id=t,this.position=e!=null?new cn(e[0],e[1]):new cn(0,0),this.orientation=n??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new er([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(r.ad.multiply(t.matrix,e,t.matrix),t.meshes)for(let n of t.meshes){let o=er.applyTransform(n.aabb,t.matrix);this.aabb.encapsulate(o)}if(t.children)for(let n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){let t=r.ad.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,n,o,l,u,h=!1){BD(this.matrix,this,t.transform,this.position,e,n,o,l,u,h)}upload(t){if(!this.uploaded){for(let e of this.nodes)V1(e,t);for(let e of this.nodes)my(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)j1(t)}},r.N=Cn,r.O=Fe,r.P=at,r.Q=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return ko(t.expression.evaluate(e))}interpolate(t,e,n){return{x:bt(t.x,e.x,n),y:bt(t.y,e.y,n),z:bt(t.z,e.z,n),azimuthal:bt(t.azimuthal,e.azimuthal,n),polar:bt(t.polar,e.polar,n)}}},r.R=Ch,r.S=Ax,r.T=Do,r.U=Dn,r.V=py,r.W=Wr,r.X=Lt,r.Y=si,r.Z=$,r.a=Vi,r.a$=function(t){let{x:e,y:n}=t.point,{lng:o,lat:l}=t._center;return TI(e,n,t.worldSize,o,l)},r.a0=nn,r.a1=wa,r.a2=bt,r.a3=rt,r.a4=Ng,r.a5=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,o]){let l=ko([1,n,o]);return{x:l.x,y:l.y,z:l.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:bt(t.x,e.x,n),y:bt(t.y,e.y,n),z:bt(t.z,e.z,n)}}},r.a6=Dp,r.a7=w_,r.a8=ya,r.a9=KE,r.aB=function(t,e){let{x:n,y:o}=t.point,l=TI(n,o,t.worldSize/t._pixelsPerMercatorPixel,0,0);return r.ad.multiply(l,l,t1(Cs(e)))},r.aD=dd,r.aE=io,r.aF=W_,r.aG=function(t,e,n,o,l){let u=5*e+2;t.float32[u+0]=n,t.float32[u+1]=o,t.float32[u+2]=l},r.aH=iy,r.aI=cn,r.aJ=hD,r.aK=tI,r.aL=xr,r.aM=Qx,r.aN=PD,r.aO=hu,r.aP=xI,r.aQ=function(t,e,n,o,l,u,h,g,y){if(y.name==="globe")return xI(t,e,new hu(n,o,l),!1);let b=mu({z:n,x:o,y:l},y);return new er([(u+b.x/b.scale)*e,e*(b.y/b.scale),h],[(u+b.x2/b.scale)*e,e*(b.y2/b.scale),g])},r.aR=function(t,e,n){let o=0;for(let l=0;l<2;++l)t[l]>0&&(o+=(t[l]-0)*(t[l]-0)),e[l]<0&&(o+=(0-e[l])*(0-e[l]));return o},r.aS=hr,r.aT=Xx,r.aU=JE,r.aV=function(t){let e=r.ad.identity(new Float64Array(16));r.ad.multiply(e,t.pixelMatrix,t.globeMatrix);let n=[0,Io,0],o=[0,Co,0];return r._.transformMat4(n,n,e),r._.transformMat4(o,o,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!r1(t,new cn(t.center.lat,90)),o[0]>0&&o[0]<=t.width&&o[1]>0&&o[1]<=t.height&&!r1(t,new cn(t.center.lat,-90))]},r.aW=function(t,e){let{scale:n}=t.tileTransform,o=n*rt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return r.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},r.aX=dy,r.aY=AD,r.aZ=function(t){let e=AD(t,!0);return r.aC.invert([],[e[0],e[1],e[4],e[5]])},r.a_=Kx,r.aa=xi,r.ab=en,r.ac=function(t,e,n){let o=Math.sqrt(t*t+e*e+n*n),l=o>0?Math.acos(n/o)*Ic:0,u=t!==0||e!==0?Math.atan2(-e,-t)*Ic+90:0;return u<0&&(u+=360),[o,u,l]},r.ae=_d,r.af=qo,r.ag=C1,r.ah=function(t,e){let n={};for(let o=0;o<e.length;o++){let l=e[o];l in t&&(n[l]=t[l])}return n},r.ai=kl,r.aj=Es,r.ak=Is,r.al=Kh,r.am=function(t){Eh++,Eh>Nf&&(t.getActor().send("enforceCacheSizeLimit",Ff),Eh=0)},r.an=Hf,r.ao=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,o){let l=this.entries[t]=this.entries[t]||{callbacks:[]};if(l.result){let[u,h]=l.result;return this.scheduler?this.scheduler.add(()=>{o(u,h)},e):o(u,h),()=>{}}return l.callbacks.push(o),l.cancel||(l.cancel=n((u,h)=>{l.result=[u,h];for(let g of l.callbacks)this.scheduler?this.scheduler.add(()=>{g(u,h)},e):g(u,h);setTimeout(()=>delete this.entries[t],3e3)})),()=>{l.result||(l.callbacks=l.callbacks.filter(u=>u!==o),l.callbacks.length||(l.cancel(),delete this.entries[t]))}}},r.ap=function(t,e,n){let o=JSON.stringify(t.request);return t.data&&(this.deduped.entries[o]={result:[null,t.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},l=>{let u=ia(t.request,(h,g,y,b)=>{h?l(h):g&&l(null,{vectorTile:n?void 0:new u1(new hd(g)),rawData:g,cacheControl:y,expires:b})});return()=>{u.cancel(),l()}},e)},r.aq=kx,r.ar=class extends _a{constructor(t){super(t),this.current=wk}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let o=0;o<9;o++)if(n[o]!==this.current[o]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},r.as=Lx,r.at=Ht,r.au=ta,r.aw=Ac,r.ax=wi,r.ay=kr,r.az=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},r.b=Jn,r.b$=zl,r.b0=qr,r.b1=zx,r.b2=function(t){let e=Math.round((t+45+360)%360/90)%4;return Eg[e]},r.b3=45,r.b4=jx,r.b5=T_,r.b6=er,r.b7=ko,r.b8=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},r.b9=Sf,r.bA=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},r.bB=TC,r.bD=wI,r.bE=bh,r.bF=xh,r.bG=256,r.bH=function(t,e){let n=[0,0,0],o=Op(Cs(e.canonical));return r._.transformMat4(n,n,o),r._.transformMat4(n,n,t),n},r.bI=t=>({u_camera_to_center_distance:new xi(t),u_extrude_scale:new Fx(t),u_device_pixel_ratio:new xi(t),u_matrix:new Dp(t),u_inv_rot_matrix:new Dp(t),u_merc_center:new ya(t),u_tile_id:new kx(t),u_zoom_transition:new xi(t),u_up_dir:new kx(t),u_emissive_strength:new xi(t)}),r.bJ=t=>({u_matrix:new Dp(t),u_pixels_to_tile_units:new Fx(t),u_device_pixel_ratio:new xi(t),u_units_to_pixels:new ya(t),u_dash_image:new w_(t),u_gradient_image:new w_(t),u_image_height:new xi(t),u_texsize:new ya(t),u_tile_units_to_pixels:new xi(t),u_alpha_discard_threshold:new xi(t),u_trim_offset:new ya(t),u_trim_fade_range:new ya(t),u_trim_color:new Lx(t),u_emissive_strength:new xi(t)}),r.bK=t=>({u_matrix:new Dp(t),u_texsize:new ya(t),u_pixels_to_tile_units:new Fx(t),u_device_pixel_ratio:new xi(t),u_image:new w_(t),u_units_to_pixels:new ya(t),u_tile_units_to_pixels:new xi(t),u_alpha_discard_threshold:new xi(t),u_trim_offset:new ya(t)}),r.bL=Tx,r.bM=nF,r.bN=Kr,r.bO=xF,r.bP=nD,r.bQ=v1,r.bR=CI,r.bS=(t,e,n,o,l,u)=>{let h=t.transform,g=h.projection.name==="globe",y;if(u.paint.get("circle-pitch-alignment")==="map")if(g){let T=wI(h.zoom,e.canonical)*h._pixelsPerMercatorPixel;y=Float32Array.from([T,0,0,T])}else y=h.calculatePixelsToTileUnitsMatrix(n);else y=new Float32Array([h.pixelsToGLUnits[0],0,0,h.pixelsToGLUnits[1]]);let b={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(h.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Rr.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:qk,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(g){b.u_inv_rot_matrix=o,b.u_merc_center=l,b.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],b.u_zoom_transition=wa(h.zoom);let T=l[0]*rt,I=l[1]*rt;b.u_up_dir=h.projection.upVector(new hu(0,0,0),T,I)}return b},r.bT=CC,r.bU=(t,e,n,o,l,u)=>{let h=t.transform;return{u_matrix:IC(t,e,n,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:h.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:l,u_image:0,u_tile_units_to_pixels:EC(e,h),u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:u}},r.bV=(t,e,n,o,l,u,h)=>{let g=t.transform,y=g.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:IC(t,e,n,o),u_pixels_to_tile_units:y,u_device_pixel_ratio:u,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:l,u_texsize:DC(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:EC(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:h,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength")}},r.bW=Mf,r.bX=kp,r.bY=mC,r.bZ=Ak,r.b_=U_,r.ba=function(t,e,n){let o=wa(n.zoom),l=t.style.map._antialias,u=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return o===0&&!l&&!u},r.bb=function(t){let e=t.pixelsPerMeter,n=e/wi(1,t.center.lat),o=r.ad.identity(new Float64Array(16));return r.ad.translate(o,o,[t.point.x,t.point.y,0]),r.ad.scale(o,o,[n,n,e]),Float32Array.from(o)},r.bc=M_,r.bd=function(t){let e=hr-5;t=Ht(t,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(en(t))),3);return Math.round(n*(Bx.length-1))},r.be=function(t,e,n,o){let l=e.getNorth(),u=e.getSouth(),h=e.getWest(),g=e.getEast(),y=1<<t.z,b=g-h,T=l-u,I=b/td,D=-T/Bx[n],P=[0,I,0,D,0,0,l,h,0];if(t.z>0){let R=180/o;r.bC.multiply(P,P,[R/b+1,0,0,0,R/T+1,0,-.5*R/I,.5*R/D,1])}return P[2]=y,P[5]=t.x,P[8]=t.y,P},r.bf=Op,r.bg=Cs,r.bh=function(t,e,n){let o=r.ad.identity(new Float64Array(16)),l=(e/(1<<t)-.5)*Math.PI*2;return r.ad.rotateY(o,n.globeMatrix,l),Float32Array.from(o)},r.bi=al,r.bj=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.bk=SD,r.bl=MD,r.bm=DD,r.bn=function(t,e){let n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let o=0;o<t.length;o++){let l=document.createElement("source");Mg(t[o])||(n.crossOrigin="Anonymous"),l.src=t[o],n.appendChild(l)}return{cancel:()=>{}}},r.bo=oy,r.bp=_h,r.bq=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let n=e.getSource().maxzoom,o=1<<n,l=Math.floor(t.x),u=Math.floor((t.x-l)*o),h=Math.floor(t.y*o),g=this.findDEMTileFor(new xr(n,l,n,u,h));return!(!g||!g.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let o=this._source();if(!o||t.y<0||t.y>1)return e;let l=o.getSource().maxzoom,u=1<<l,h=Math.floor(t.x),g=t.x-h,y=new xr(l,h,l,Math.floor(g*u),Math.floor(t.y*u)),b=this.findDEMTileFor(y);if(!b||!b.dem)return e;let T=b.dem,I=1<<b.tileID.canonical.z,D=(g*I-b.tileID.canonical.x)*T.dim,P=(t.y*I-b.tileID.canonical.y)*T.dim,R=Math.floor(D),L=Math.floor(P);return(n?this.exaggeration():1)*bt(bt(T.get(R,L),T.get(R,L+1),P-L),bt(T.get(R+1,L),T.get(R+1,L+1),P-L),D-R)}getAtTileOffset(t,e,n){let o=1<<t.canonical.z;return this.getAtPointOrZero(new si(t.wrap+(t.canonical.x+e/rt)/o,(t.canonical.y+n/rt)/o))}getAtTileOffsetFunc(t,e,n,o){return l=>{let u=this.getAtTileOffset(t,l.x,l.y),h=o.upVector(t.canonical,l.x,l.y),g=o.upVectorScale(t.canonical,e,n).metersToTile;return r._.scale(h,h,u*g),h}}getForTilePoints(t,e,n,o){if(this.isUsingMockSource())return!1;let l=ld.create(this,t,o);return!!l&&(e.forEach(u=>{u[2]=this.exaggeration()*l.getElevationAt(u[0],u[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let n=e.dem.tree,o=e.tileID,l=1<<t.canonical.z-o.canonical.z,u=t.canonical.x/l-o.canonical.x,h=t.canonical.y/l-o.canonical.y,g=0;for(let y=0;y<t.canonical.z-o.canonical.z&&!n.leaves[g];y++){u*=2,h*=2;let b=2*Math.floor(h)+Math.floor(u);g=n.childOffsets[g]+b,u%=1,h%=1}return{min:this.exaggeration()*n.minimums[g],max:this.exaggeration()*n.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,n=Number.MAX_VALUE,o=Number.MIN_VALUE;for(let l of t){let u=this.getMinMaxForTile(l.tileID);u&&(n=Math.min(n,u.min),o=Math.max(o,u.max),e=!0)}return e?{min:n,max:o}:null}},r.br=Pp,r.bs=S_,r.bt=jo,r.bu=Ir,r.bv=gu,r.bw=U1,r.bx=gy,r.by=ly,r.bz=RI,r.c=XD,r.c$=Rc,r.c0=450,r.c1=7,r.c2=bN,r.c3=bD,r.c4=256,r.c5=yI,r.c6=t1,r.c7=wn,r.c8=Ml,r.c9=lu,r.cA=function(t){let e=1/0,n=1/0,o=-1/0,l=-1/0;for(let u of t)e=Math.min(e,u.x),n=Math.min(n,u.y),o=Math.max(o,u.x),l=Math.max(l,u.y);return{min:new at(e,n),max:new at(o,l)}},r.cB=Ll,r.cC=oI,r.cD=bi,r.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.cF=YC,r.cG=qx,r.cH=ZI,r.cI=YI,r.cJ=T1,r.cK=Y1,r.cL=function(t){return t({pluginStatus:$e,pluginURL:ot}),Bt.on("pluginStateChange",t),t},r.cM=pd,r.cN=b1,r.cO=Dh,r.cP=ft,r.cQ=Z,r.cR=Lf,r.cS=dl,r.cT=vo,r.cU=function(t){let e=t.indexOf(Cl);return e>=0?t.slice(0,e):t},r.cV=function(t){return t.indexOf(Cl)>=0},r.cW=function(t){let e=t.indexOf(Cl);return e>=0?t.slice(e+1):""},r.cX=function(t){let e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},r.cY=function(t,e,n,o){return t.type==="custom"?new EN(t,e):new e3[t.type](t,e,n,o)},r.cZ=na,r.c_=Bt,r.ca=1,r.cb=Xp,r.cc=0,r.cd=Dx,r.ce=function(t,e,n,o,l){return Ht((t-e)/(n-e)*(l-o)+o,o,l)},r.cf=c_,r.cg=du,r.ch=class{constructor(t,e,n,o){this.context=t,this.format=o,this.size=n,this.texture=t.gl.createTexture();let[l,u,h]=this.size,{gl:g}=t;g.bindTexture(g.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1);let y=this.format,b=g.UNSIGNED_BYTE;this.format===g.DEPTH_COMPONENT&&(y=g.DEPTH_COMPONENT16,b=g.UNSIGNED_SHORT),this.format===g.R8&&(o=g.RED),this.format===g.R32F&&(b=g.FLOAT,o=g.RED),g.texImage3D(g.TEXTURE_3D,0,y,l,u,h,0,o,b,e.data)}bind(t,e){let{context:n}=this,{gl:o}=n;o.bindTexture(o.TEXTURE_3D,this.texture),t!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,t),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},r.ci=z1,r.cj=[1,1,1],r.ck=ld,r.cl=bd,r.cm=Pl,r.cn=Jh,r.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new at(1/0,1/0),max:new at(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){let n=HI(new at(0,0),new at(rt,rt),t),o=[];if(e&&!h1(n,this._globalClipBounds))return o;for(let l of this._activeRegions){if(l.hiddenByOverlap||!h1(n,l))continue;let u=ML(l.min,l.max,t);o.push({min:u.min,max:u.max,sourceId:this._sourceIds[l.priority],footprint:l.footprint,footprintTileId:l.tileId,order:l.order,clipMask:l.clipMask})}return o}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let n=[];for(let o of e.cache.getVisibleCoordinates()){let l=e.cache.getTile(o).buckets[e.layer];l&&l.updateFootprints(o.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(t){let e=t.getFootprints();if(e.length===0)return;let n=t.getOrder(),o=t.getClipMask();for(let l of e){if(!l.footprint)continue;let u=HI(l.footprint.min,l.footprint.max,l.id);this._activeRegions.push({min:u.min,max:u.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:l.id,footprint:l.footprint,order:n,clipMask:o})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||B_(e.min,n.min)||B_(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){let n=this._activeRegions[e],o=this._prevRegions[e];t=n.priority!==o.priority||!GI(n,o)||n.order!==o.order||n.clipMask!==o.clipMask,++e}}if(t){++this._updateTime;for(let n of this._activeRegions)n.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));let e=n=>{let o=this._activeRegions;if(n>=o.length)return n;let l=o[n].priority;for(;n<o.length&&o[n].priority===l;)++n;return n};if(this._sourceIds.length>1){let n=0,o=e(n);for(;n!==o;){let l=n,u=n;for(;l!==o;){let h=this._activeRegions[l];h.hiddenByOverlap=!1;for(let g=0;g<u;g++){let y=this._activeRegions[g];if(!y.hiddenByOverlap&&h.order===1/0&&h1(h,y)&&(h.hiddenByOverlap=WI(h.footprint,h.tileId,y.footprint,y.tileId),h.hiddenByOverlap))break}++l}n=o,o=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},r.cp=Dl,r.cq=ay,r.cr=Ip,r.cs=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let n=new jo,o=new Ir,l=[],u=t+1+2,h=e[0]+1,g=e[0]+1+(1+e.length),y=(b,T,I)=>{let D=b===u-1?b-2:b===0?b:b-1;return D+=I?24575:0,[D,T]};for(let b=0;b<u;++b)n.emplaceBack(...y(b,0,!0));for(let b=0;b<h;++b)for(let T=0;T<u;++T)n.emplaceBack(...y(T,b,(T===0||T===u-1)&&!0));for(let b=0;b<e.length;++b){let T=e[b];for(let I=0;I<u;++I)n.emplaceBack(...y(I,T,!0))}for(let b=0;b<e.length;++b){let T=o.length,I=e[b]+1+2,D=new Ir;for(let L=0;L<I-1;L++){let N=L===I-2,j=N?u*(g-e.length+b-L):u;for(let Y=0;Y<u-1;Y++){let X=L*u+Y;L===0||N||Y===0||Y===u-2?(D.emplaceBack(X+1,X,X+j),D.emplaceBack(X+j,X+j+1,X+1)):(o.emplaceBack(X+1,X,X+j),o.emplaceBack(X+j,X+j+1,X+1))}}let P=Jn.simpleSegment(0,T,n.length,o.length-T);for(let L=0;L<D.uint16.length;L+=3)o.emplaceBack(D.uint16[L],D.uint16[L+1],D.uint16[L+2]);let R=Jn.simpleSegment(0,T,n.length,o.length-T);l.push({withoutSkirts:P,withSkirts:R})}return{vertices:n,indices:o,segments:l}}_createGrid(t){let e=this._fillGridMeshWithLods(td,Bx);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Pp.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new Ir;for(let h=0;h<=td;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let n=new lu,o=new lu,l=new lu,u=new lu;this._poleSegments=[];for(let h=0,g=0;h<zx;h++){let y=360/(1<<h);n.emplaceBack(0,-bi,0,.5,0),o.emplaceBack(0,-bi,0,.5,1),l.emplaceBack(0,-bi,0,.5,.5),u.emplaceBack(0,-bi,0,.5,.5);for(let b=0;b<=td;b++){let T=b/td,I=0,D=bt(0,y,T),[P,R,L]=nd(Gk,Hk,D,bi);n.emplaceBack(P,R,L,T,I),o.emplaceBack(P,R,L,T,1-I);let N=en(D);T=.5+.5*Math.sin(N),I=.5+.5*Math.cos(N),l.emplaceBack(P,R,L,T,I),u.emplaceBack(P,R,L,T,1-I)}this._poleSegments.push(Jn.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,D_,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(o,D_,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(l,D_,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(u,D_,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},r.ct=function(t){return Nc.has(t)},r.cu=rC,r.cv=function(t,e,n=0,o=!0){let l=new at(n,n),u=t.sub(l),h=e.add(l),g=[u,new at(h.x,u.y),h,new at(u.x,h.y)];return o&&g.push(u.clone()),g},r.cw=function(t,e){let n=[];for(let o=0;o<t.length;o++){let l=ta(o-1,-1,t.length-1),u=ta(o+1,-1,t.length-1),h=t[o],g=t[u],y=t[l].sub(h).unit(),b=g.sub(h).unit(),T=b.angleWithSep(y.x,y.y),I=y.add(b).unit().mult(-1*e/Math.sin(T/2));n.push(h.add(I))}return n},r.cx=sD,r.cy=uI,r.cz=function(t,e,n=0){return r._.fromValues(((e.x-n)*t.scale-t.x)*rt,(e.y*t.scale-t.y)*rt,nI(e.z,e.y))},r.d=Ph,r.d$=ph,r.d0=Cc,r.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.d2=rl,r.d3=iI,r.d4=uu,r.d5=function([t,e,n]){let o=Math.hypot(t,e,n),l=Math.atan2(t,n),u=.5*Math.PI-Math.acos(-e/o);return new cn(qr(l),qr(u))},r.d6=Di,r.d7=rd,r.d8=k,r.d9=r1,r.dA=function(t){let e=Dg();if(!e)return;let n=e.delete(Cg);t&&n.catch(t).then(()=>t())},r.dB=tm,r.dC=jD,r.dD=function(t){G1=Rr.resolveURL(t),Td||(Td=new U1(gy(),new sa)),Td.broadcast("setDracoUrl",G1)},r.dE=UD,r.dF=function(t){wd=Rr.resolveURL(t),Td||(Td=new U1(gy(),new sa)),Td.broadcast("setMeshoptUrl",wd)},r.dG=Li,r.dH=Q,r.dI=Fl,r.dJ=Ho,r.dK=mu,r.dL=Rx,r.dM=SC,r.dN=LC,r.dO=bC,r.dP=ol,r.dQ=KC,r.dR=yd,r.dS=function(t,e,n,o,l,u,h,g,y,b,T){t.createArrays(),t.tilePixelRatio=rt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let I=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,P={};if(t.textSizeData.kind==="composite"){let{minZoom:j,maxZoom:Y}=t.textSizeData;P.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Lt(j),g),D["text-size"].possiblyEvaluate(new Lt(Y),g)]}if(t.iconSizeData.kind==="composite"){let{minZoom:j,maxZoom:Y}=t.iconSizeData;P.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Lt(j),g),D["icon-size"].possiblyEvaluate(new Lt(Y),g)]}P.layoutTextSize=D["text-size"].possiblyEvaluate(new Lt(y+1),g),P.layoutIconSize=D["icon-size"].possiblyEvaluate(new Lt(y+1),g),P.textMaxSize=D["text-size"].possiblyEvaluate(new Lt(18),g);let R=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",L=I.get("text-size"),N=!1;for(let j of t.features)if(j.icon&&j.icon.nameSecondary){N=!0;break}for(let j of t.features){let Y=I.get("text-font").evaluate(j,{},g).join(","),X=L.evaluate(j,{},g),K=P.layoutTextSize.evaluate(j,{},g),ae=(P.layoutIconSize.evaluate(j,{},g),{horizontal:{},vertical:void 0}),oe=j.text,fe,me=[0,0];if(oe){let Ce=oe.toString(),Le=I.get("text-letter-spacing").evaluate(j,{},g)*Kr,Ye=I.get("text-line-height").evaluate(j,{},g)*Kr,Oe=De(Ce)?Le:0,He=I.get("text-anchor").evaluate(j,{},g),Re=I.get("text-variable-anchor");if(!Re){let Xe=I.get("text-radial-offset").evaluate(j,{},g);me=Xe?nD(He,[Xe*Kr,w1]):I.get("text-offset").evaluate(j,{},g).map(tt=>tt*Kr)}let qe=R?"center":I.get("text-justify").evaluate(j,{},g),Qe=I.get("symbol-placement")==="point",Ze=Qe?I.get("text-max-width").evaluate(j,{},g)*Kr:1/0,ht=Xe=>{t.allowVerticalPlacement&&Ie(Ce)&&(ae.vertical=y1(oe,e,n,l,Y,Ze,Ye,He,Xe,Oe,me,io.vertical,!0,K,X))};if(!R&&Re){let Xe=qe==="auto"?Re.map(vt=>T1(vt)):[qe],tt=!1;for(let vt=0;vt<Xe.length;vt++){let yt=Xe[vt];if(!ae.horizontal[yt])if(tt)ae.horizontal[yt]=ae.horizontal[0];else{let mt=y1(oe,e,n,l,Y,Ze,Ye,"center",yt,Oe,me,io.horizontal,!1,K,X);mt&&(ae.horizontal[yt]=mt,tt=mt.positionedLines.length===1)}}ht("left")}else{if(qe==="auto"&&(qe=T1(He)),Qe||I.get("text-writing-mode").indexOf("horizontal")>=0||!Ie(Ce)){let Xe=y1(oe,e,n,l,Y,Ze,Ye,He,qe,Oe,me,io.horizontal,!1,K,X);Xe&&(ae.horizontal[qe]=Xe)}ht(Qe?"left":qe)}}let we=!1;if(j.icon&&j.icon.namePrimary){let Ce=o[j.icon.namePrimary];Ce&&(fe=MF(l[j.icon.namePrimary],j.icon.nameSecondary?l[j.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate(j,{},g),I.get("icon-anchor").evaluate(j,{},g)),we=Ce.sdf,t.sdfIcons===void 0?t.sdfIcons=Ce.sdf:t.sdfIcons!==Ce.sdf&&cr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ce.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let Pe=iD(ae.horizontal)||ae.vertical;t.iconsInText||(t.iconsInText=!!Pe&&Pe.iconsInText),(Pe||fe)&&FF(t,j,ae,fe,o,P,K,0,me,we,h,g,b,T,N)}u&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)},r.dT=$_,r.dU=L_,r.dV=u1,r.dW=hd,r.dX=V_,r.dY=k1,r.dZ=N_,r.d_=F_,r.da=EI,r.db=function(t){let e=[0,0,0],n=r.ad.identity(new Float64Array(16));return r.ad.multiply(n,t.pixelMatrix,t.globeMatrix),r._.transformMat4(e,e,n),new at(e[0],e[1])},r.dc=Ge,r.dd=Je,r.de=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(vh==null){let o=n.navigator?n.navigator.userAgent:null;vh=!!n.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return vh}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.df=mh,r.dg=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",$f,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Z(t))return t;let n=Ki(t);return n.params.push(`sdk=js-${C}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Z(t))return t;let n=Ki(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!Z(t))return t;let n=Ki(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,o){if(!Z(t))return t;let l=Ki(t);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),n&&l.params.push(`language=${n}`),o&&l.params.push(`worldview=${o}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,o){let l=Ki(t);return Z(t)?(l.path=`/styles/v1${l.path}/sprite${e}${n}`,this._makeAPIURL(l,this._customAccessToken||o)):(l.path+=`${e}${n}`,ul(l))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Z(t))return t;let o=Ki(t);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&o.authority!=="raster"&&n===512?"@2x":""}${Ih.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${k.RASTER_URL_PREFIX}${o.path}`:o.authority==="rasterarrays"?o.path=`/${k.RASTERARRAYS_URL_PREFIX}${o.path}`:o.authority==="3dtiles"?o.path=`/${k.TILES3D_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${k.TILE_URL_VERSION}${o.path}`);let l=this._customAccessToken||function(u){for(let h of u){let g=h.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(o.params)||k.ACCESS_TOKEN;return k.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,l)}canonicalizeTileURL(t,e){let n=Ki(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let o="mapbox://";n.path.match(/^\/raster\/v1\//)?o+=`raster/${n.path.replace(`/${k.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?o+=`rasterarrays/${n.path.replace(`/${k.RASTERARRAYS_URL_PREFIX}/`,"")}`:o+=`tiles/${n.path.replace(`/${k.TILE_URL_VERSION}/`,"")}`;let l=n.params;return e&&(l=l.filter(u=>!u.match(/^access_token=/))),l.length&&(o+=`?${l.join("&")}`),o}canonicalizeTileset(t,e){let n=!!e&&Z(e),o=[];for(let l of t.tiles||[])B(l)?o.push(this.canonicalizeTileURL(l,n)):o.push(l);return o}_makeAPIURL(t,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",o=Ki(k.API_URL);if(t.protocol=o.protocol,t.authority=o.authority,t.protocol==="http"){let l=t.params.indexOf("secure");l>=0&&t.params.splice(l,1)}if(o.path!=="/"&&(t.path=`${o.path}${t.path}`),!k.REQUIRE_ACCESS_TOKEN)return ul(t);if(e=e||k.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(l=>l.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),ul(t)}},r.dh=function(t,e){e?Nc.add(t):Nc.delete(t)},r.di=Ih,r.dj=Jv,r.dk=Ah,r.dl=Gf,r.dm=Rg,r.dn=Qv,r.dp=function(t){Nc.delete(t)},r.dq=hl,r.dr=Fc,r.ds=il,r.dt=C,r.du=function(t,e){Ff=t,Nf=e},r.dv=function(t,e,n=!1){if($e===it||$e===lt||$e===st)throw new Error("setRTLTextPlugin cannot be called multiple times.");ot=Rr.resolveURL(t),$e=it,ze=e,At(),n||Kt()},r.dw=tn,r.dx=function(){gy().acquire($1)},r.dy=function(){let t=rm;t&&(t.isPreloaded()&&t.numActive()===1?(t.release($1),rm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dz=nm,r.e=Rr,r.e0=MC,r.e1=We,r.e2=ia,r.e3=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==GD){let n=new Uint32Array(t,0,7),[,,o,l,u,h]=n;e=n.byteLength+l+u+h+u,(o!==t.byteLength||e>=t.byteLength)&&cr("Invalid b3dm header information.")}return ZD(t,e)},r.e4=function(t,e){let n=XD(t);for(let o of n){for(let l of o.meshes)XN(l);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(KN(o.lights,e)))}return n},r.e5=xy,r.e6=VD,r.e7=In,r.e8=function(t){Pc(),Fo&&Fo.then(e=>{e.keys().then(n=>{for(let o=0;o<n.length-t;o++)e.delete(n[o])})})},r.f=ci,r.g=function(t,e){return Rc(Wr(t,{type:"json"}),e)},r.h=ps,r.i=ro,r.j=XC,r.k=x1,r.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>ZD(e,0,t))},r.m=class extends py{},r.n=la,r.o=Yf,r.p=XF,r.q=Xh,r.r=d,r.s=i,r.t=F,r.u=fi,r.v=Yr,r.w=cr,r.x=G,r.y=z,r.z=Vh}),p(["./shared"],function(r){function C(ge){let U=ge?ge.url.toString():void 0;return U?performance.getEntriesByName(U):[]}function A(ge){if(typeof ge=="number"||typeof ge=="boolean"||typeof ge=="string"||ge==null)return JSON.stringify(ge);if(Array.isArray(ge)){let W="[";for(let ie of ge)W+=`${A(ie)},`;return`${W}]`}let U="{";for(let W of Object.keys(ge).sort())U+=`${W}:${A(ge[W])},`;return`${U}}`}function k(ge){let U="";for(let W of r.cE)U+=`/${A(ge[W])}`;return U}class B{constructor(U){this.keyCache={},this._layers={},this._layerConfigs={},U&&this.replace(U)}replace(U,W){this._layerConfigs={},this._layers={},this.update(U,[],W)}update(U,W,ie){this._options=ie;for(let de of U)this._layerConfigs[de.id]=de,(this._layers[de.id]=r.cY(de,this.scope,null,this._options)).compileFilter(),this.keyCache[de.id]&&delete this.keyCache[de.id];for(let de of W)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};let ue=function(de,be){let Se={};for(let Me=0;Me<de.length;Me++){let nt=be&&be[de[Me].id]||k(de[Me]);be&&(be[de[Me].id]=nt);let Ke=Se[nt];Ke||(Ke=Se[nt]=[]),Ke.push(de[Me])}let ye=[];for(let Me in Se)ye.push(Se[Me]);return ye}(r.dG(this._layerConfigs),this.keyCache);for(let de of ue){let be=de.map(_t=>this._layers[_t.id]),Se=be[0];if(Se.visibility==="none")continue;let ye=Se.source||"",Me=this.familiesBySource[ye];Me||(Me=this.familiesBySource[ye]={});let nt=Se.sourceLayer||"_geojsonTileLayer",Ke=Me[nt];Ke||(Ke=Me[nt]=[]),Ke.push(be)}}}let Z=1*r.dJ;class he{constructor(U){let W={},ie=[];for(let Se in U){let ye=U[Se],Me=W[Se]={};for(let nt in ye.glyphs){let Ke=ye.glyphs[+nt];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;let _t=Ke.metrics.localGlyph?Z:1,Ct={x:0,y:0,w:Ke.bitmap.width+2*_t,h:Ke.bitmap.height+2*_t};ie.push(Ct),Me[nt]=Ct}}let{w:ue,h:de}=r.j(ie),be=new r.dI({width:ue||1,height:de||1});for(let Se in U){let ye=U[Se];for(let Me in ye.glyphs){let nt=ye.glyphs[+Me];if(!nt||nt.bitmap.width===0||nt.bitmap.height===0)continue;let Ke=W[Se][Me],_t=nt.metrics.localGlyph?Z:1;r.dI.copy(nt.bitmap,be,{x:0,y:0},{x:Ke.x+_t,y:Ke.y+_t},nt.bitmap)}}this.image=be,this.positions=W}}r.dH(he,"GlyphAtlas");class xe{constructor(U){this.tileID=new r.aL(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.tileZoom=U.tileZoom,this.uid=U.uid,this.zoom=U.zoom,this.lut=U.lut,this.canonical=U.tileID.canonical,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.scope=U.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=U.showCollisionBoxes,this.collectResourceTiming=!!U.collectResourceTiming,this.promoteId=U.promoteId,this.isSymbolTile=U.isSymbolTile,this.tileTransform=r.dK(U.tileID.canonical,U.projection),this.projection=U.projection,this.brightness=U.brightness,this.extraShadowCaster=!!U.extraShadowCaster,this.tessellationStep=U.tessellationStep}parse(U,W,ie,ue,de){this.status="parsing",this.data=U,this.collisionBoxArray=new r.dL;let be=new r.dM(Object.keys(U.layers).sort()),Se=new r.dN(this.tileID,this.promoteId);Se.bucketLayerIDs=[];let ye={},Me=new r.dO(256,256),nt={featureIndex:Se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Me,availableImages:ie,brightness:this.brightness},Ke=W.familiesBySource[this.source];for(let pt in Ke){let qn=U.layers[pt];if(!qn)continue;let An=!1,sn=!1,lr=!1;for(let Gr of Ke[pt])Gr[0].type==="symbol"?An=!0:sn=!0,Gr[0].is3D()&&Gr[0].type!=="model"&&(lr=!0);if(this.extraShadowCaster&&!lr||this.isSymbolTile===!0&&!An||this.isSymbolTile===!1&&!sn)continue;qn.version===1&&r.w(`Vector tile source "${this.source}" layer "${pt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Wn=be.encode(pt),pr=[];for(let Gr=0;Gr<qn.length;Gr++){let Hr=qn.feature(Gr),Qs=Se.getId(Hr,pt);pr.push({feature:Hr,id:Qs,index:Gr,sourceLayerIndex:Wn})}for(let Gr of Ke[pt]){let Hr=Gr[0];(!this.extraShadowCaster||Hr.is3D()&&Hr.type!=="model")&&(this.isSymbolTile!==void 0&&Hr.type==="symbol"!==this.isSymbolTile||Hr.minzoom&&this.zoom<Math.floor(Hr.minzoom)||Hr.maxzoom&&this.zoom>=Hr.maxzoom||Hr.visibility!=="none"&&(_e(Gr,this.zoom,nt.brightness,ie),(ye[Hr.id]=Hr.createBucket({index:Se.bucketLayerIDs.length,layers:Gr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Wn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(pr,nt,this.tileID.canonical,this.tileTransform),Se.bucketLayerIDs.push(Gr.map(Qs=>Qs.id))))}}let _t,Ct,Gt,Wt;Me.trim();let Nt={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Jt=()=>{if(_t)return this.status="done",de(_t);if(this.extraShadowCaster)this.status="done",de(null,{buckets:r.dG(ye).filter(pt=>!pt.isEmpty()),featureIndex:Se,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:nt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ct&&Gt&&Wt){let pt=new he(Ct),qn=new r.dQ(Gt,Wt,this.lut);for(let An in ye){let sn=ye[An];sn instanceof r.dR?(_e(sn.layers,this.zoom,nt.brightness,ie),r.dS(sn,Ct,pt.positions,Gt,qn.iconPositions,this.showCollisionBoxes,ie,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):sn.hasPattern&&(sn instanceof r.dT||sn instanceof r.dU||sn instanceof r.b_)&&(_e(sn.layers,this.zoom,nt.brightness,ie),sn.addFeatures(nt,this.tileID.canonical,qn.patternPositions,ie,this.tileTransform,this.brightness))}this.status="done",de(null,{buckets:r.dG(ye).filter(An=>!An.isEmpty()),featureIndex:Se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pt.image,lineAtlas:Me,imageAtlas:qn,brightness:nt.brightness})}};if(!this.extraShadowCaster){let pt=r.dP(nt.glyphDependencies,sn=>Object.keys(sn).map(Number));Object.keys(pt).length?ue.send("getGlyphs",{uid:this.uid,stacks:pt,scope:this.scope},(sn,lr)=>{_t||(_t=sn,Ct=lr,Jt())},void 0,!1,Nt):Ct={};let qn=Object.keys(nt.iconDependencies);qn.length?ue.send("getImages",{icons:qn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(sn,lr)=>{_t||(_t=sn,Gt=lr,Jt())},void 0,!1,Nt):Gt={};let An=Object.keys(nt.patternDependencies);An.length?ue.send("getImages",{icons:An,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(sn,lr)=>{_t||(_t=sn,Wt=lr,Jt())},void 0,!1,Nt):Wt={}}Jt()}}function _e(ge,U,W,ie){let ue=new r.X(U,{brightness:W});for(let de of ge)de.recalculate(ue,ie)}class Je extends r.E{constructor(U,W,ie,ue,de,be){super(),this.actor=U,this.layerIndex=W,this.availableImages=ie,this.loadVectorData=de||r.ap,this.loading={},this.loaded={},this.deduped=new r.ao(U.scheduler),this.isSpriteLoaded=ue,this.scheduler=U.scheduler,this.brightness=be}loadTile(U,W){let ie=U.uid,ue=U&&U.request,de=ue&&ue.collectResourceTiming,be=this.loading[ie]=new xe(U);be.abort=this.loadVectorData(U,(Se,ye)=>{let Me=!this.loading[ie];if(delete this.loading[ie],Me||Se||!ye)return be.status="done",Me||(this.loaded[ie]=be),W(Se);let nt=ye.rawData,Ke={};ye.expires&&(Ke.expires=ye.expires),ye.cacheControl&&(Ke.cacheControl=ye.cacheControl),be.vectorTile=ye.vectorTile||new r.dV(new r.dW(nt));let _t=()=>{be.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ct,Gt)=>{if(Ct||!Gt)return W(Ct);let Wt={};if(de){let Nt=C(ue);Nt.length>0&&(Wt.resourceTiming=JSON.parse(JSON.stringify(Nt)))}W(null,r.W({rawTileData:nt.slice(0)},Gt,Ke,Wt))})};this.isSpriteLoaded?_t():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(_t,{type:"parseTile",isSymbolTile:U.isSymbolTile,zoom:U.tileZoom}):_t()}),this.loaded=this.loaded||{},this.loaded[ie]=be})}reloadTile(U,W){let ie=this.loaded,ue=U.uid;if(ie&&ie[ue]){let de=ie[ue];de.showCollisionBoxes=U.showCollisionBoxes,de.projection=U.projection,de.brightness=U.brightness,de.tileTransform=r.dK(U.tileID.canonical,U.projection),de.extraShadowCaster=U.extraShadowCaster,de.lut=U.lut;let be=(Se,ye)=>{let Me=de.reloadCallback;Me&&(delete de.reloadCallback,de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor,Me)),W(Se,ye)};de.status==="parsing"?de.reloadCallback=be:de.status==="done"&&(de.vectorTile?de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor,be):be())}else W(null,void 0)}abortTile(U,W){let ie=U.uid,ue=this.loading[ie];ue&&(ue.abort&&ue.abort(),delete this.loading[ie]),W()}removeTile(U,W){let ie=this.loaded,ue=U.uid;ie&&ie[ue]&&delete ie[ue],W()}}class Ge{loadTile(U,W){let{uid:ie,encoding:ue,rawImageData:de,padding:be}=U,Se=ImageBitmap&&de instanceof ImageBitmap?this.getImageData(de,be):de;W(null,new r.dX(ie,Se,ue,be<1))}getImageData(U,W){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);let ie=this.offscreenCanvasContext.getImageData(-W,-W,U.width+2*W,U.height+2*W);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ie}}class Ve{decodeRasterArray({task:U,buffer:W},ie){r.dY.performDecoding(W,U).then(ue=>{ie(null,ue)},ue=>{ie(ue)})}}let We=r.dZ.prototype.toGeoJSON,ct=class{constructor(ge){this._feature=ge,this.extent=r.a3,this.type=ge.type,this.properties=ge.tags,"id"in ge&&!isNaN(ge.id)&&(this.id=parseInt(ge.id,10))}loadGeometry(){if(this._feature.type===1){let ge=[];for(let U of this._feature.geometry)ge.push([new r.P(U[0],U[1])]);return ge}{let ge=[];for(let U of this._feature.geometry){let W=[];for(let ie of U)W.push(new r.P(ie[0],ie[1]));ge.push(W)}return ge}}toGeoJSON(ge,U,W){return We.call(this,ge,U,W)}},gt=class{constructor(ge){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.a3,this.length=ge.length,this._features=ge}feature(ge){return new ct(this._features[ge])}},Be=64/4096;class St{constructor(){this.features=new Map}clear(){this.features.clear()}load(U=[],W){for(let ie of U){let ue=ie.id;if(ue==null)continue;let de=this.features.get(ue);de&&this.updateCache(de,W),ie.geometry?(de=dn(ie),this.updateCache(de,W),this.features.set(ue,de)):this.features.delete(ue),this.updateCache(de,W)}}updateCache(U,W){for(let{canonical:ie,uid:ue}of Object.values(W)){let{z:de,x:be,y:Se}=ie;qt(U,Math.pow(2,de),be,Se)&&delete W[ue]}}getTile(U,W,ie){let ue=Math.pow(2,U),de=[];for(let be of this.features.values())qt(be,ue,W,ie)&&de.push(ar(be,ue,W,ie));return{features:de}}getFeatures(){return[...this.features.values()]}}function qt({minX:ge,minY:U,maxX:W,maxY:ie},ue,de,be){return ge<(de+1+Be)/ue&&U<(be+1+Be)/ue&&W>(de-Be)/ue&&ie>(be-Be)/ue}function dn(ge){let{id:U,geometry:W,properties:ie}=ge;if(!W)return;if(W.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:ue,coordinates:de}=W,be={id:U,type:1,geometry:[],tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Se=be.geometry;if(ue==="Point")Tt(de,Se,be);else if(ue==="MultiPoint")for(let ye of de)Tt(ye,Se,be);else if(ue==="LineString")be.type=2,Gn(de,Se,be);else if(ue==="MultiLineString")be.type=2,wt(de,Se,be);else if(ue==="Polygon")be.type=3,wt(de,Se,be,!0);else{if(ue!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");be.type=3;for(let ye of de)wt(ye,Se,be,!0)}return be}function Tt([ge,U],W,ie){let ue=r.aj(ge),de=r.ak(U);de=de<0?0:de>1?1:de,W.push(ue,de),ie.minX=Math.min(ie.minX,ue),ie.minY=Math.min(ie.minY,de),ie.maxX=Math.max(ie.maxX,ue),ie.maxY=Math.max(ie.maxY,de)}function Gn(ge,U,W,ie=!1,ue=!1){let de=[];for(let be of ge)Tt(be,de,W);U.push(de),ie&&function(be,Se){let ye=0;for(let Me=0,nt=be.length,Ke=nt-2;Me<nt;Ke=Me,Me+=2)ye+=(be[Me]-be[Ke])*(be[Me+1]+be[Ke+1]);if(ye>0===Se)for(let Me=0,nt=be.length;Me<nt/2;Me+=2){let Ke=be[Me],_t=be[Me+1];be[Me]=be[nt-2-Me],be[Me+1]=be[nt-1-Me],be[nt-2-Me]=Ke,be[nt-1-Me]=_t}}(de,ue)}function wt(ge,U,W,ie=!1){for(let ue=0;ue<ge.length;ue++)Gn(ge[ue],U,W,ie,ue===0)}function ar(ge,U,W,ie){let{id:ue,type:de,geometry:be,tags:Se}=ge,ye=[];if(de===1)jr(be,U,W,ie,ye);else for(let Me of be)ye.push(jr(Me,U,W,ie));return{id:ue,type:de,geometry:ye,tags:Se}}function jr(ge,U,W,ie,ue=[]){for(let de=0;de<ge.length;de+=2)ue.push(Ur(ge[de],ge[de+1],U,W,ie));return ue}function Ur(ge,U,W,ie,ue){return[Math.round(r.a3*(ge*W-ie)),Math.round(r.a3*(U*W-ue))]}var En={exports:{}},Hs=r.d$,ni=r.d_.VectorTileFeature,qs=Ws;function Ws(ge,U){this.options=U||{},this.features=ge,this.length=ge.length}function mo(ge,U){this.id=typeof ge.id=="number"?ge.id:void 0,this.type=ge.type,this.rawGeometry=ge.type===1?[ge.geometry]:ge.geometry,this.properties=ge.tags,this.extent=U||4096}Ws.prototype.feature=function(ge){return new mo(this.features[ge],this.options.extent)},mo.prototype.loadGeometry=function(){var ge=this.rawGeometry;this.geometry=[];for(var U=0;U<ge.length;U++){for(var W=ge[U],ie=[],ue=0;ue<W.length;ue++)ie.push(new Hs(W[ue][0],W[ue][1]));this.geometry.push(ie)}return this.geometry},mo.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ge=this.geometry,U=1/0,W=-1/0,ie=1/0,ue=-1/0,de=0;de<ge.length;de++)for(var be=ge[de],Se=0;Se<be.length;Se++){var ye=be[Se];U=Math.min(U,ye.x),W=Math.max(W,ye.x),ie=Math.min(ie,ye.y),ue=Math.max(ue,ye.y)}return[U,ie,W,ue]},mo.prototype.toGeoJSON=ni.prototype.toGeoJSON;var fn=r.e0,Va=qs;function $r(ge){var U=new fn;return function(W,ie){for(var ue in W.layers)ie.writeMessage(3,rh,W.layers[ue])}(ge,U),U.finish()}function rh(ge,U){var W;U.writeVarintField(15,ge.version||1),U.writeStringField(1,ge.name||""),U.writeVarintField(5,ge.extent||4096);var ie={keys:[],values:[],keycache:{},valuecache:{}};for(W=0;W<ge.length;W++)ie.feature=ge.feature(W),U.writeMessage(2,ih,ie);var ue=ie.keys;for(W=0;W<ue.length;W++)U.writeStringField(3,ue[W]);var de=ie.values;for(W=0;W<de.length;W++)U.writeMessage(4,sh,de[W])}function ih(ge,U){var W=ge.feature;W.id!==void 0&&U.writeVarintField(1,W.id),U.writeMessage(2,oh,ge),U.writeVarintField(3,W.type),U.writeMessage(4,Hn,W)}function oh(ge,U){var W=ge.feature,ie=ge.keys,ue=ge.values,de=ge.keycache,be=ge.valuecache;for(var Se in W.properties){var ye=W.properties[Se],Me=de[Se];if(ye!==null){Me===void 0&&(ie.push(Se),de[Se]=Me=ie.length-1),U.writeVarint(Me);var nt=typeof ye;nt!=="string"&&nt!=="boolean"&&nt!=="number"&&(ye=JSON.stringify(ye));var Ke=nt+":"+ye,_t=be[Ke];_t===void 0&&(ue.push(ye),be[Ke]=_t=ue.length-1),U.writeVarint(_t)}}}function Pt(ge,U){return(U<<3)+(7&ge)}function ja(ge){return ge<<1^ge>>31}function Hn(ge,U){for(var W=ge.loadGeometry(),ie=ge.type,ue=0,de=0,be=W.length,Se=0;Se<be;Se++){var ye=W[Se],Me=1;ie===1&&(Me=ye.length),U.writeVarint(Pt(1,Me));for(var nt=ie===3?ye.length-1:ye.length,Ke=0;Ke<nt;Ke++){Ke===1&&ie!==1&&U.writeVarint(Pt(2,nt-1));var _t=ye[Ke].x-ue,Ct=ye[Ke].y-de;U.writeVarint(ja(_t)),U.writeVarint(ja(Ct)),ue+=_t,de+=Ct}ie===3&&U.writeVarint(Pt(7,1))}}function sh(ge,U){var W=typeof ge;W==="string"?U.writeStringField(1,ge):W==="boolean"?U.writeBooleanField(7,ge):W==="number"&&(ge%1!=0?U.writeDoubleField(3,ge):ge<0?U.writeSVarintField(6,ge):U.writeVarintField(5,ge))}En.exports=$r,En.exports.fromVectorTileJs=$r,En.exports.fromGeojsonVt=function(ge,U){U=U||{};var W={};for(var ie in ge)W[ie]=new Va(ge[ie].features,U),W[ie].name=ie,W[ie].version=U.version,W[ie].extent=U.extent;return $r({layers:W})},En.exports.GeoJSONWrapper=Va;var ah=r.e1(En.exports);let lh={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ge=>ge},mc=Math.fround||(Ua=new Float32Array(1),ge=>(Ua[0]=+ge,Ua[0]));var Ua;let Yi=3,Xi=5,gc=6;class Mt{constructor(U){this.options=Object.assign(Object.create(lh),U),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(U){let{log:W,minZoom:ie,maxZoom:ue}=this.options;W&&console.time("total time");let de=`prepare ${U.length} points`;W&&console.time(de),this.points=U;let be=[];for(let ye=0;ye<U.length;ye++){let Me=U[ye];if(!Me.geometry)continue;let[nt,Ke]=Me.geometry.coordinates,_t=mc(_i(nt)),Ct=mc(Zs(Ke));be.push(_t,Ct,1/0,ye,-1,1),this.options.reduce&&be.push(0)}let Se=this.trees[ue+1]=this._createTree(be);W&&console.timeEnd(de);for(let ye=ue;ye>=ie;ye--){let Me=+Date.now();Se=this.trees[ye]=this._createTree(this._cluster(Se,ye)),W&&console.log("z%d: %d clusters in %dms",ye,Se.numItems,+Date.now()-Me)}return W&&console.timeEnd("total time"),this}getClusters(U,W){let ie=((U[0]+180)%360+360)%360-180,ue=Math.max(-90,Math.min(90,U[1])),de=U[2]===180?180:((U[2]+180)%360+360)%360-180,be=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)ie=-180,de=180;else if(ie>de){let Ke=this.getClusters([ie,ue,180,be],W),_t=this.getClusters([-180,ue,de,be],W);return Ke.concat(_t)}let Se=this.trees[this._limitZoom(W)],ye=Se.range(_i(ie),Zs(be),_i(de),Zs(ue)),Me=Se.data,nt=[];for(let Ke of ye){let _t=this.stride*Ke;nt.push(Me[_t+Xi]>1?Rt(Me,_t,this.clusterProps):this.points[Me[_t+Yi]])}return nt}getChildren(U){let W=this._getOriginId(U),ie=this._getOriginZoom(U),ue="No cluster with the specified id.",de=this.trees[ie];if(!de)throw new Error(ue);let be=de.data;if(W*this.stride>=be.length)throw new Error(ue);let Se=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),ye=de.within(be[W*this.stride],be[W*this.stride+1],Se),Me=[];for(let nt of ye){let Ke=nt*this.stride;be[Ke+4]===U&&Me.push(be[Ke+Xi]>1?Rt(be,Ke,this.clusterProps):this.points[be[Ke+Yi]])}if(Me.length===0)throw new Error(ue);return Me}getLeaves(U,W,ie){let ue=[];return this._appendLeaves(ue,U,W=W||10,ie=ie||0,0),ue}getTile(U,W,ie){let ue=this.trees[this._limitZoom(U)],de=Math.pow(2,U),{extent:be,radius:Se}=this.options,ye=Se/be,Me=(ie-ye)/de,nt=(ie+1+ye)/de,Ke={features:[]};return this._addTileFeatures(ue.range((W-ye)/de,Me,(W+1+ye)/de,nt),ue.data,W,ie,de,Ke),W===0&&this._addTileFeatures(ue.range(1-ye/de,Me,1,nt),ue.data,de,ie,de,Ke),W===de-1&&this._addTileFeatures(ue.range(0,Me,ye/de,nt),ue.data,-1,ie,de,Ke),Ke.features.length?Ke:null}getClusterExpansionZoom(U){let W=this._getOriginZoom(U)-1;for(;W<=this.options.maxZoom;){let ie=this.getChildren(U);if(W++,ie.length!==1)break;U=ie[0].properties.cluster_id}return W}_appendLeaves(U,W,ie,ue,de){let be=this.getChildren(W);for(let Se of be){let ye=Se.properties;if(ye&&ye.cluster?de+ye.point_count<=ue?de+=ye.point_count:de=this._appendLeaves(U,ye.cluster_id,ie,ue,de):de<ue?de++:U.push(Se),U.length===ie)break}return de}_createTree(U){let W=new r.cK(U.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ie=0;ie<U.length;ie+=this.stride)W.add(U[ie],U[ie+1]);return W.finish(),W.data=U,W}_addTileFeatures(U,W,ie,ue,de,be){for(let Se of U){let ye=Se*this.stride,Me=W[ye+Xi]>1,nt,Ke,_t;if(Me)nt=$a(W,ye,this.clusterProps),Ke=W[ye],_t=W[ye+1];else{let Wt=this.points[W[ye+Yi]];nt=Wt.properties;let[Nt,Jt]=Wt.geometry.coordinates;Ke=_i(Nt),_t=Zs(Jt)}let Ct={type:1,geometry:[[Math.round(this.options.extent*(Ke*de-ie)),Math.round(this.options.extent*(_t*de-ue))]],tags:nt},Gt;Gt=Me||this.options.generateId?W[ye+Yi]:this.points[W[ye+Yi]].id,Gt!==void 0&&(Ct.id=Gt),be.features.push(Ct)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,W){let{radius:ie,extent:ue,reduce:de,minPoints:be}=this.options,Se=ie/(ue*Math.pow(2,W)),ye=U.data,Me=[],nt=this.stride;for(let Ke=0;Ke<ye.length;Ke+=nt){if(ye[Ke+2]<=W)continue;ye[Ke+2]=W;let _t=ye[Ke],Ct=ye[Ke+1],Gt=U.within(ye[Ke],ye[Ke+1],Se),Wt=ye[Ke+Xi],Nt=Wt;for(let Jt of Gt){let pt=Jt*nt;ye[pt+2]>W&&(Nt+=ye[pt+Xi])}if(Nt>Wt&&Nt>=be){let Jt,pt=_t*Wt,qn=Ct*Wt,An=-1,sn=(Ke/nt<<5)+(W+1)+this.points.length;for(let lr of Gt){let Wn=lr*nt;if(ye[Wn+2]<=W)continue;ye[Wn+2]=W;let pr=ye[Wn+Xi];pt+=ye[Wn]*pr,qn+=ye[Wn+1]*pr,ye[Wn+4]=sn,de&&(Jt||(Jt=this._map(ye,Ke,!0),An=this.clusterProps.length,this.clusterProps.push(Jt)),de(Jt,this._map(ye,Wn)))}ye[Ke+4]=sn,Me.push(pt/Nt,qn/Nt,1/0,sn,-1,Nt),de&&Me.push(An)}else{for(let Jt=0;Jt<nt;Jt++)Me.push(ye[Ke+Jt]);if(Nt>1)for(let Jt of Gt){let pt=Jt*nt;if(!(ye[pt+2]<=W)){ye[pt+2]=W;for(let qn=0;qn<nt;qn++)Me.push(ye[pt+qn])}}}}return Me}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,W,ie){if(U[W+Xi]>1){let be=this.clusterProps[U[W+gc]];return ie?Object.assign({},be):be}let ue=this.points[U[W+Yi]].properties,de=this.options.map(ue);return ie&&de===ue?Object.assign({},de):de}}function Rt(ge,U,W){return{type:"Feature",id:ge[U+Yi],properties:$a(ge,U,W),geometry:{type:"Point",coordinates:[(ie=ge[U],360*(ie-.5)),Ga(ge[U+1])]}};var ie}function $a(ge,U,W){let ie=ge[U+Xi],ue=ie>=1e4?`${Math.round(ie/1e3)}k`:ie>=1e3?Math.round(ie/100)/10+"k":ie,de=ge[U+gc],be=de===-1?{}:Object.assign({},W[de]);return Object.assign(be,{cluster:!0,cluster_id:ge[U+Yi],point_count:ie,point_count_abbreviated:ue})}function _i(ge){return ge/360+.5}function Zs(ge){let U=Math.sin(ge*Math.PI/180),W=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return W<0?0:W>1?1:W}function Ga(ge){let U=(180-360*ge)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function Ha(ge,U,W,ie){let ue=ie,de=U+(W-U>>1),be,Se=W-U,ye=ge[U],Me=ge[U+1],nt=ge[W],Ke=ge[W+1];for(let _t=U+3;_t<W;_t+=3){let Ct=_c(ge[_t],ge[_t+1],ye,Me,nt,Ke);if(Ct>ue)be=_t,ue=Ct;else if(Ct===ue){let Gt=Math.abs(_t-de);Gt<Se&&(be=_t,Se=Gt)}}ue>ie&&(be-U>3&&Ha(ge,U,be,ie),ge[be+2]=ue,W-be>3&&Ha(ge,be,W,ie))}function _c(ge,U,W,ie,ue,de){let be=ue-W,Se=de-ie;if(be!==0||Se!==0){let ye=((ge-W)*be+(U-ie)*Se)/(be*be+Se*Se);ye>1?(W=ue,ie=de):ye>0&&(W+=be*ye,ie+=Se*ye)}return be=ge-W,Se=U-ie,be*be+Se*Se}function cs(ge,U,W,ie){let ue={id:ge??null,type:U,geometry:W,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(U==="Point"||U==="MultiPoint"||U==="LineString")Ys(ue,W);else if(U==="Polygon")Ys(ue,W[0]);else if(U==="MultiLineString")for(let de of W)Ys(ue,de);else if(U==="MultiPolygon")for(let de of W)Ys(ue,de[0]);return ue}function Ys(ge,U){for(let W=0;W<U.length;W+=3)ge.minX=Math.min(ge.minX,U[W]),ge.minY=Math.min(ge.minY,U[W+1]),ge.maxX=Math.max(ge.maxX,U[W]),ge.maxY=Math.max(ge.maxY,U[W+1])}function qa(ge,U,W,ie){if(!U.geometry)return;let ue=U.geometry.coordinates;if(ue&&ue.length===0)return;let de=U.geometry.type,be=Math.pow(W.tolerance/((1<<W.maxZoom)*W.extent),2),Se=[],ye=U.id;if(W.promoteId?ye=U.properties[W.promoteId]:W.generateId&&(ye=ie||0),de==="Point")yc(ue,Se);else if(de==="MultiPoint")for(let Me of ue)yc(Me,Se);else if(de==="LineString")Wa(ue,Se,be,!1);else if(de==="MultiLineString"){if(W.lineMetrics){for(let Me of ue)Se=[],Wa(Me,Se,be,!1),ge.push(cs(ye,"LineString",Se,U.properties));return}Za(ue,Se,be,!1)}else if(de==="Polygon")Za(ue,Se,be,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(let Me of U.geometry.geometries)qa(ge,{id:ye,geometry:Me,properties:U.properties},W,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Me of ue){let nt=[];Za(Me,nt,be,!0),Se.push(nt)}}ge.push(cs(ye,de,Se,U.properties))}function yc(ge,U){U.push(Ri(ge[0]),ch(ge[1]),0)}function Wa(ge,U,W,ie){let ue,de,be=0;for(let ye=0;ye<ge.length;ye++){let Me=Ri(ge[ye][0]),nt=ch(ge[ye][1]);U.push(Me,nt,0),ye>0&&(be+=ie?(ue*nt-Me*de)/2:Math.sqrt(Math.pow(Me-ue,2)+Math.pow(nt-de,2))),ue=Me,de=nt}let Se=U.length-3;U[2]=1,Ha(U,0,Se,W),U[Se+2]=1,U.size=Math.abs(be),U.start=0,U.end=U.size}function Za(ge,U,W,ie){for(let ue=0;ue<ge.length;ue++){let de=[];Wa(ge[ue],de,W,ie),U.push(de)}}function Ri(ge){return ge/360+.5}function ch(ge){let U=Math.sin(ge*Math.PI/180),W=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return W<0?0:W>1?1:W}function Ot(ge,U,W,ie,ue,de,be,Se){if(ie/=U,de>=(W/=U)&&be<ie)return ge;if(be<W||de>=ie)return null;let ye=[];for(let Me of ge){let nt=Me.geometry,Ke=Me.type,_t=ue===0?Me.minX:Me.minY,Ct=ue===0?Me.maxX:Me.maxY;if(_t>=W&&Ct<ie){ye.push(Me);continue}if(Ct<W||_t>=ie)continue;let Gt=[];if(Ke==="Point"||Ke==="MultiPoint")vc(nt,Gt,W,ie,ue);else if(Ke==="LineString")ir(nt,Gt,W,ie,ue,!1,Se.lineMetrics);else if(Ke==="MultiLineString")Xs(nt,Gt,W,ie,ue,!1);else if(Ke==="Polygon")Xs(nt,Gt,W,ie,ue,!0);else if(Ke==="MultiPolygon")for(let Wt of nt){let Nt=[];Xs(Wt,Nt,W,ie,ue,!0),Nt.length&&Gt.push(Nt)}if(Gt.length){if(Se.lineMetrics&&Ke==="LineString"){for(let Wt of Gt)ye.push(cs(Me.id,Ke,Wt,Me.tags));continue}Ke!=="LineString"&&Ke!=="MultiLineString"||(Gt.length===1?(Ke="LineString",Gt=Gt[0]):Ke="MultiLineString"),Ke!=="Point"&&Ke!=="MultiPoint"||(Ke=Gt.length===3?"Point":"MultiPoint"),ye.push(cs(Me.id,Ke,Gt,Me.tags))}}return ye.length?ye:null}function vc(ge,U,W,ie,ue){for(let de=0;de<ge.length;de+=3){let be=ge[de+ue];be>=W&&be<=ie&&go(U,ge[de],ge[de+1],ge[de+2])}}function ir(ge,U,W,ie,ue,de,be){let Se=Ya(ge),ye=ue===0?_o:xc,Me,nt,Ke=ge.start;for(let Nt=0;Nt<ge.length-3;Nt+=3){let Jt=ge[Nt],pt=ge[Nt+1],qn=ge[Nt+2],An=ge[Nt+3],sn=ge[Nt+4],lr=ue===0?Jt:pt,Wn=ue===0?An:sn,pr=!1;be&&(Me=Math.sqrt(Math.pow(Jt-An,2)+Math.pow(pt-sn,2))),lr<W?Wn>W&&(nt=ye(Se,Jt,pt,An,sn,W),be&&(Se.start=Ke+Me*nt)):lr>ie?Wn<ie&&(nt=ye(Se,Jt,pt,An,sn,ie),be&&(Se.start=Ke+Me*nt)):go(Se,Jt,pt,qn),Wn<W&&lr>=W&&(nt=ye(Se,Jt,pt,An,sn,W),pr=!0),Wn>ie&&lr<=ie&&(nt=ye(Se,Jt,pt,An,sn,ie),pr=!0),!de&&pr&&(be&&(Se.end=Ke+Me*nt),U.push(Se),Se=Ya(ge)),be&&(Ke+=Me)}let _t=ge.length-3,Ct=ge[_t],Gt=ge[_t+1],Wt=ue===0?Ct:Gt;Wt>=W&&Wt<=ie&&go(Se,Ct,Gt,ge[_t+2]),_t=Se.length-3,de&&_t>=3&&(Se[_t]!==Se[0]||Se[_t+1]!==Se[1])&&go(Se,Se[0],Se[1],Se[2]),Se.length&&U.push(Se)}function Ya(ge){let U=[];return U.size=ge.size,U.start=ge.start,U.end=ge.end,U}function Xs(ge,U,W,ie,ue,de){for(let be of ge)ir(be,U,W,ie,ue,de,!1)}function go(ge,U,W,ie){ge.push(U,W,ie)}function _o(ge,U,W,ie,ue,de){let be=(de-U)/(ie-U);return go(ge,de,W+(ue-W)*be,1),be}function xc(ge,U,W,ie,ue,de){let be=(de-W)/(ue-W);return go(ge,U+(ie-U)*be,de,1),be}function us(ge,U){let W=[];for(let ie=0;ie<ge.length;ie++){let ue=ge[ie],de=ue.type,be;if(de==="Point"||de==="MultiPoint"||de==="LineString")be=hs(ue.geometry,U);else if(de==="MultiLineString"||de==="Polygon"){be=[];for(let Se of ue.geometry)be.push(hs(Se,U))}else if(de==="MultiPolygon"){be=[];for(let Se of ue.geometry){let ye=[];for(let Me of Se)ye.push(hs(Me,U));be.push(ye)}}W.push(cs(ue.id,de,be,ue.tags))}return W}function hs(ge,U){let W=[];W.size=ge.size,ge.start!==void 0&&(W.start=ge.start,W.end=ge.end);for(let ie=0;ie<ge.length;ie+=3)W.push(ge[ie]+U,ge[ie+1],ge[ie+2]);return W}function Xa(ge,U){if(ge.transformed)return ge;let W=1<<ge.z,ie=ge.x,ue=ge.y;for(let de of ge.features){let be=de.geometry,Se=de.type;if(de.geometry=[],Se===1)for(let ye=0;ye<be.length;ye+=2)de.geometry.push(Ka(be[ye],be[ye+1],U,W,ie,ue));else for(let ye=0;ye<be.length;ye++){let Me=[];for(let nt=0;nt<be[ye].length;nt+=2)Me.push(Ka(be[ye][nt],be[ye][nt+1],U,W,ie,ue));de.geometry.push(Me)}}return ge.transformed=!0,ge}function Ka(ge,U,W,ie,ue,de){return[Math.round(W*(ge*ie-ue)),Math.round(W*(U*ie-de))]}function uh(ge,U,W,ie,ue){let de=U===ue.maxZoom?0:ue.tolerance/((1<<U)*ue.extent),be={features:[],numPoints:0,numSimplified:0,numFeatures:ge.length,source:null,x:W,y:ie,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Se of ge)Qa(be,Se,de,ue);return be}function Qa(ge,U,W,ie){let ue=U.geometry,de=U.type,be=[];if(ge.minX=Math.min(ge.minX,U.minX),ge.minY=Math.min(ge.minY,U.minY),ge.maxX=Math.max(ge.maxX,U.maxX),ge.maxY=Math.max(ge.maxY,U.maxY),de==="Point"||de==="MultiPoint")for(let Se=0;Se<ue.length;Se+=3)be.push(ue[Se],ue[Se+1]),ge.numPoints++,ge.numSimplified++;else if(de==="LineString")Oi(be,ue,ge,W,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(let Se=0;Se<ue.length;Se++)Oi(be,ue[Se],ge,W,de==="Polygon",Se===0);else if(de==="MultiPolygon")for(let Se=0;Se<ue.length;Se++){let ye=ue[Se];for(let Me=0;Me<ye.length;Me++)Oi(be,ye[Me],ge,W,!0,Me===0)}if(be.length){let Se=U.tags||null;if(de==="LineString"&&ie.lineMetrics){Se={};for(let Me in U.tags)Se[Me]=U.tags[Me];Se.mapbox_clip_start=ue.start/ue.size,Se.mapbox_clip_end=ue.end/ue.size}let ye={geometry:be,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:Se};U.id!==null&&(ye.id=U.id),ge.features.push(ye)}}function Oi(ge,U,W,ie,ue,de){let be=ie*ie;if(ie>0&&U.size<(ue?be:ie))return void(W.numPoints+=U.length/3);let Se=[];for(let ye=0;ye<U.length;ye+=3)(ie===0||U[ye+2]>be)&&(W.numSimplified++,Se.push(U[ye],U[ye+1])),W.numPoints++;ue&&function(ye,Me){let nt=0;for(let Ke=0,_t=ye.length,Ct=_t-2;Ke<_t;Ct=Ke,Ke+=2)nt+=(ye[Ke]-ye[Ct])*(ye[Ke+1]+ye[Ct+1]);if(nt>0===Me)for(let Ke=0,_t=ye.length;Ke<_t/2;Ke+=2){let Ct=ye[Ke],Gt=ye[Ke+1];ye[Ke]=ye[_t-2-Ke],ye[Ke+1]=ye[_t-1-Ke],ye[_t-2-Ke]=Ct,ye[_t-1-Ke]=Gt}}(Se,de),ge.push(Se)}let ds={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ki{constructor(U,W){let ie=(W=this.options=function(de,be){for(let Se in be)de[Se]=be[Se];return de}(Object.create(ds),W)).debug;if(ie&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");let ue=function(de,be){let Se=[];if(de.type==="FeatureCollection")for(let ye=0;ye<de.features.length;ye++)qa(Se,de.features[ye],be,ye);else qa(Se,de.type==="Feature"?de:{geometry:de},be);return Se}(U,W);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ue=function(de,be){let Se=be.buffer/be.extent,ye=de,Me=Ot(de,1,-1-Se,Se,0,-1,2,be),nt=Ot(de,1,1-Se,2+Se,0,-1,2,be);return(Me||nt)&&(ye=Ot(de,1,-Se,1+Se,0,-1,2,be)||[],Me&&(ye=us(Me,1).concat(ye)),nt&&(ye=ye.concat(us(nt,-1)))),ye}(ue,W),ue.length&&this.splitTile(ue,0,0,0),ie&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(U,W,ie,ue,de,be,Se){let ye=[U,W,ie,ue],Me=this.options,nt=Me.debug;for(;ye.length;){ue=ye.pop(),ie=ye.pop(),W=ye.pop(),U=ye.pop();let Ke=1<<W,_t=Ar(W,ie,ue),Ct=this.tiles[_t];if(!Ct&&(nt>1&&console.time("creation"),Ct=this.tiles[_t]=uh(U,W,ie,ue,Me),this.tileCoords.push({z:W,x:ie,y:ue}),nt)){nt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,ie,ue,Ct.numFeatures,Ct.numPoints,Ct.numSimplified),console.timeEnd("creation"));let pr=`z${W}`;this.stats[pr]=(this.stats[pr]||0)+1,this.total++}if(Ct.source=U,de==null){if(W===Me.indexMaxZoom||Ct.numPoints<=Me.indexMaxPoints)continue}else{if(W===Me.maxZoom||W===de)continue;if(de!=null){let pr=de-W;if(ie!==be>>pr||ue!==Se>>pr)continue}}if(Ct.source=null,U.length===0)continue;nt>1&&console.time("clipping");let Gt=.5*Me.buffer/Me.extent,Wt=.5-Gt,Nt=.5+Gt,Jt=1+Gt,pt=null,qn=null,An=null,sn=null,lr=Ot(U,Ke,ie-Gt,ie+Nt,0,Ct.minX,Ct.maxX,Me),Wn=Ot(U,Ke,ie+Wt,ie+Jt,0,Ct.minX,Ct.maxX,Me);U=null,lr&&(pt=Ot(lr,Ke,ue-Gt,ue+Nt,1,Ct.minY,Ct.maxY,Me),qn=Ot(lr,Ke,ue+Wt,ue+Jt,1,Ct.minY,Ct.maxY,Me),lr=null),Wn&&(An=Ot(Wn,Ke,ue-Gt,ue+Nt,1,Ct.minY,Ct.maxY,Me),sn=Ot(Wn,Ke,ue+Wt,ue+Jt,1,Ct.minY,Ct.maxY,Me),Wn=null),nt>1&&console.timeEnd("clipping"),ye.push(pt||[],W+1,2*ie,2*ue),ye.push(qn||[],W+1,2*ie,2*ue+1),ye.push(An||[],W+1,2*ie+1,2*ue),ye.push(sn||[],W+1,2*ie+1,2*ue+1)}}getTile(U,W,ie){U=+U,W=+W,ie=+ie;let ue=this.options,{extent:de,debug:be}=ue;if(U<0||U>24)return null;let Se=1<<U,ye=Ar(U,W=W+Se&Se-1,ie);if(this.tiles[ye])return Xa(this.tiles[ye],de);be>1&&console.log("drilling down to z%d-%d-%d",U,W,ie);let Me,nt=U,Ke=W,_t=ie;for(;!Me&&nt>0;)nt--,Ke>>=1,_t>>=1,Me=this.tiles[Ar(nt,Ke,_t)];return Me&&Me.source?(be>1&&(console.log("found parent tile z%d-%d-%d",nt,Ke,_t),console.time("drilling down")),this.splitTile(Me.source,nt,Ke,_t,U,W,ie),be>1&&console.timeEnd("drilling down"),this.tiles[ye]?Xa(this.tiles[ye],de):null):null}}function Ar(ge,U,W){return 32*((1<<ge)*W+U)+ge}function hh(ge,U){let W=ge.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);let ie=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!ie)return U(null,null);let ue=new gt(ie.features),de=ah(ue);de.byteOffset===0&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),U(null,{vectorTile:ue,rawData:de.buffer})}class Ks extends Je{constructor(U,W,ie,ue,de,be){super(U,W,ie,ue,hh,be),de&&(this.loadGeoJSON=de),this._dynamicIndex=new St}loadData(U,W){let ie=U&&U.request,ue=ie&&ie.collectResourceTiming;this.loadGeoJSON(U,(de,be)=>{if(de||!be)return W(de);if(typeof be!="object")return W(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{try{if(U.filter){let ye=r.y(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ye.result==="error")throw new Error(ye.value.map(Me=>`${Me.key}: ${Me.message}`).join(", "));be.features=be.features.filter(Me=>ye.value.evaluate({zoom:0},Me))}U.dynamic?(be.type==="Feature"&&(be={type:"FeatureCollection",features:[be]}),U.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(be.features,this.loaded),U.cluster&&(be.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=U.cluster?new Mt(function({superclusterOptions:ye,clusterProperties:Me}){if(!Me||!ye)return ye;let nt={},Ke={},_t={accumulated:null,zoom:0},Ct={properties:null},Gt=Object.keys(Me);for(let Wt of Gt){let[Nt,Jt]=Me[Wt],pt=r.y(Jt),qn=r.y(typeof Nt=="string"?[Nt,["accumulated"],["get",Wt]]:Nt);nt[Wt]=pt.value,Ke[Wt]=qn.value}return ye.map=Wt=>{Ct.properties=Wt;let Nt={};for(let Jt of Gt)Nt[Jt]=nt[Jt].evaluate(_t,Ct);return Nt},ye.reduce=(Wt,Nt)=>{Ct.properties=Nt;for(let Jt of Gt)_t.accumulated=Wt[Jt],Wt[Jt]=Ke[Jt].evaluate(_t,Ct)},ye}(U)).load(be.features):U.dynamic?this._dynamicIndex:function(ye,Me){return new ki(ye,Me)}(be,U.geojsonVtOptions)}catch(ye){return W(ye)}let Se={};if(ue){let ye=C(ie);ye&&(Se.resourceTiming={},Se.resourceTiming[U.source]=JSON.parse(JSON.stringify(ye)))}W(null,Se)}})}reloadTile(U,W){let ie=this.loaded;return ie&&ie[U.uid]?U.partial?W(null,void 0):super.reloadTile(U,W):this.loadTile(U,W)}loadGeoJSON(U,W){if(U.request)r.g(U.request,W);else{if(typeof U.data!="string")return W(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));try{return W(null,JSON.parse(U.data))}catch{return W(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(U,W){try{W(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(ie){W(ie)}}getClusterChildren(U,W){try{W(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(ie){W(ie)}}getClusterLeaves(U,W){try{W(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(ie){W(ie)}}}class Ja{constructor(U,W){this.tileID=new r.aL(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.tileZoom=U.tileZoom,this.uid=U.uid,this.zoom=U.zoom,this.canonical=U.tileID.canonical,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=U.projection,this.brightness=W}parse(U,W,ie,ue){this.status="parsing";let de=new r.aL(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),be={},Se=W.familiesBySource[ie.source],ye=new r.dN(de,ie.promoteId);return ye.bucketLayerIDs=[],ye.is3DTile=!0,r.e3(U).then(Me=>{if(!Me)return ue(new Error("Could not parse tile"));let nt=r.e4(Me,1/r.b5(ie.tileID.canonical)),Ke=Me.json.extensionsUsed&&Me.json.extensionsUsed.includes("MAPBOX_mesh_features")||Me.json.asset.extras&&Me.json.asset.extras.MAPBOX_mesh_features,_t=Me.json.extensionsUsed&&Me.json.extensionsUsed.includes("EXT_meshopt_compression"),Ct=new r.X(this.zoom,{brightness:this.brightness});for(let Gt in Se)for(let Wt of Se[Gt]){let Nt=Wt[0];ye.bucketLayerIDs.push(Wt.map(pt=>pt.id)),Nt.recalculate(Ct,[]);let Jt=new r.e5(nt,de,Ke,_t,this.brightness,ye);Ke||(Jt.needsUpload=!0),be[Nt.fqid]=Jt,Jt.evaluate(Nt)}this.status="done",ue(null,{buckets:be,featureIndex:ye})}).catch(Me=>ue(new Error(Me.message)))}}class bc{constructor(U,W,ie,ue,de,be){this.actor=U,this.layerIndex=W,this.brightness=be,this.loading={},this.loaded={}}loadTile(U,W){let ie=U.uid,ue=this.loading[ie]=new Ja(U,this.brightness);r.e2(U.request,(de,be)=>{let Se=!this.loading[ie];return delete this.loading[ie],Se||de?(ue.status="done",Se||(this.loaded[ie]=ue),W(de)):be&&be.byteLength!==0?void ue.parse(be,this.layerIndex,U,(ye,Me)=>{ue.status="done",this.loaded=this.loaded||{},this.loaded[ie]=ue,ye||!Me?W(ye):W(null,Me)}):(ue.status="done",this.loaded[ie]=ue,W())})}reloadTile(U,W){let ie=this.loaded,ue=U.uid;if(ie&&ie[ue]){let de=ie[ue];de.projection=U.projection,de.brightness=U.brightness;let be=(Se,ye)=>{de.reloadCallback&&(delete de.reloadCallback,this.loadTile(U,W)),W(Se,ye)};de.status==="parsing"?de.reloadCallback=be:de.status==="done"&&this.loadTile(U,W)}}abortTile(U,W){let ie=U.uid;this.loading[ie]&&delete this.loading[ie],W()}removeTile(U,W){let ie=this.loaded,ue=U.uid;ie&&ie[ue]&&delete ie[ue],W()}}class el{constructor(U){this.self=U,this.actor=new r.e6(U,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.aJ({name:"mercator"}),this.workerSourceTypes={vector:Je,geojson:Ks,"batched-model":bc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(W,ie)=>{if(this.workerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.workerSourceTypes[W]=ie},this.self.registerRTLTextPlugin=W=>{if(r.e7.isParsed())throw new Error("RTL text plugin already registered.");r.e7.applyArabicShaping=W.applyArabicShaping,r.e7.processBidirectionalText=W.processBidirectionalText,r.e7.processStyledBidirectionalText=W.processStyledBidirectionalText}}clearCaches(U,W,ie){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U],delete this.rasterArrayWorkerSource,ie()}checkIfReady(U,W,ie){ie()}setReferrer(U,W){this.referrer=W}spriteLoaded(U,{scope:W,isLoaded:ie}){if(this.isSpriteLoaded[U]||(this.isSpriteLoaded[U]={}),this.isSpriteLoaded[U][W]=ie,this.workerSources[U]&&this.workerSources[U][W])for(let ue in this.workerSources[U][W]){let de=this.workerSources[U][W][ue];for(let be in de){let Se=de[be];Se instanceof Je&&(Se.isSpriteLoaded=ie,Se.fire(new r.f("isSpriteLoaded")))}}}setImages(U,{scope:W,images:ie},ue){if(this.availableImages[U]||(this.availableImages[U]={}),this.availableImages[U][W]=ie,this.workerSources[U]&&this.workerSources[U][W]){for(let de in this.workerSources[U][W]){let be=this.workerSources[U][W][de];for(let Se in be)be[Se].availableImages=ie}ue()}else ue()}setProjection(U,W){this.projections[U]=r.aJ(W)}setBrightness(U,W,ie){this.brightness=W,ie()}setLayers(U,W,ie){this.getLayerIndex(U,W.scope).replace(W.layers,W.options),ie()}updateLayers(U,W,ie){this.getLayerIndex(U,W.scope).update(W.layers,W.removedIds,W.options),ie()}loadTile(U,W,ie){W.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,W.type,W.source,W.scope).loadTile(W,ie)}loadDEMTile(U,W,ie){this.getDEMWorkerSource(U,W.source,W.scope).loadTile(W,ie)}decodeRasterArray(U,W,ie){this.getRasterArrayWorkerSource().decodeRasterArray(W,ie)}reloadTile(U,W,ie){W.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,W.type,W.source,W.scope).reloadTile(W,ie)}abortTile(U,W,ie){this.getWorkerSource(U,W.type,W.source,W.scope).abortTile(W,ie)}removeTile(U,W,ie){this.getWorkerSource(U,W.type,W.source,W.scope).removeTile(W,ie)}removeSource(U,W,ie){if(!(this.workerSources[U]&&this.workerSources[U][W.scope]&&this.workerSources[U][W.scope][W.type]&&this.workerSources[U][W.scope][W.type][W.source]))return;let ue=this.workerSources[U][W.scope][W.type][W.source];delete this.workerSources[U][W.scope][W.type][W.source],ue.removeSource!==void 0?ue.removeSource(W,ie):ie()}loadWorkerSource(U,W,ie){try{this.self.importScripts(W.url),ie()}catch(ue){ie(ue.toString())}}syncRTLPluginState(U,W,ie){try{r.e7.setState(W);let ue=r.e7.getPluginURL();if(r.e7.isLoaded()&&!r.e7.isParsed()&&ue!=null){this.self.importScripts(ue);let de=r.e7.isParsed();ie(de?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ue}`),de)}}catch(ue){ie(ue.toString())}}setDracoUrl(U,W){this.dracoUrl=W}getAvailableImages(U,W){this.availableImages[U]||(this.availableImages[U]={});let ie=this.availableImages[U][W];return ie||(ie=[]),ie}getLayerIndex(U,W){this.layerIndexes[U]||(this.layerIndexes[U]={});let ie=this.layerIndexes[U][W];return ie||(ie=this.layerIndexes[U][W]=new B,ie.scope=W),ie}getWorkerSource(U,W,ie,ue){return this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][ue]||(this.workerSources[U][ue]={}),this.workerSources[U][ue][W]||(this.workerSources[U][ue][W]={}),this.isSpriteLoaded[U]||(this.isSpriteLoaded[U]={}),this.workerSources[U][ue][W][ie]||(this.workerSources[U][ue][W][ie]=new this.workerSourceTypes[W]({send:(de,be,Se,ye,Me,nt)=>{this.actor.send(de,be,Se,U,Me,nt)},scheduler:this.actor.scheduler},this.getLayerIndex(U,ue),this.getAvailableImages(U,ue),this.isSpriteLoaded[U][ue],void 0,this.brightness)),this.workerSources[U][ue][W][ie]}getDEMWorkerSource(U,W,ie){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][ie]||(this.demWorkerSources[U][ie]={}),this.demWorkerSources[U][ie][W]||(this.demWorkerSources[U][ie][W]=new Ge),this.demWorkerSources[U][ie][W]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Ve),this.rasterArrayWorkerSource}enforceCacheSizeLimit(U,W){r.e8(W)}getWorkerPerformanceMetrics(U,W,ie){ie(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new el(self)),el}),p(["./shared"],function(r){function C(d,i){if(Array.isArray(d)){if(!Array.isArray(i)||d.length!==i.length)return!1;for(let c=0;c<d.length;c++)if(!C(d[c],i[c]))return!1;return!0}if(typeof d=="object"&&d!==null&&i!==null){if(typeof i!="object"||Object.keys(d).length!==Object.keys(i).length)return!1;for(let c in d)if(!C(d[c],i[c]))return!1;return!0}return d===i}var A=k;function k(d){return!function(i){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,v,x=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(x);try{v=new Worker(w),m=!0}catch{m=!1}return v&&v.terminate(),URL.revokeObjectURL(w),m}()?function(){var m=document.createElement("canvas");m.width=m.height=1;var v=m.getContext("2d");if(!v)return!1;var x=v.getImageData(0,0,1,1);return x&&x.width===m.width}()?(B[c=i&&i.failIfMajorPerformanceCaveat]===void 0&&(B[c]=function(m){var v,x=function(w){var E=document.createElement("canvas"),S=Object.create(k.webGLContextAttributes);return S.failIfMajorPerformanceCaveat=w,E.getContext("webgl2",S)}(m);if(!x)return!1;try{v=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!v||x.isContextLost())&&(x.shaderSource(v,"void main() {}"),x.compileShader(v),x.getShaderParameter(v,x.COMPILE_STATUS)===!0)}(c)),B[c]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var c}(d)}var B={};function Z(d,i,c){let m=document.createElement(d);return i!=null&&(m.className=i),c&&c.appendChild(m),m}function he(d,i,c){let m=document.createElementNS("http://www.w3.org/2000/svg",d);for(let v of Object.keys(i))m.setAttributeNS(null,v,String(i[v]));return c&&c.appendChild(m),m}k.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let xe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,_e=xe&&xe.userSelect!==void 0?"userSelect":"WebkitUserSelect",Je;function Ge(){xe&&_e&&(Je=xe[_e],xe[_e]="none")}function Ve(){xe&&_e&&(xe[_e]=Je)}function We(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",We,!0)}function ct(){window.addEventListener("click",We,!0),window.setTimeout(()=>{window.removeEventListener("click",We,!0)},0)}function gt(d,i){let c=d.getBoundingClientRect();return qt(d,c,i)}function Be(d,i){let c=d.getBoundingClientRect(),m=[];for(let v=0;v<i.length;v++)m.push(qt(d,c,i[v]));return m}function St(d){return window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function qt(d,i,c){let m=d.offsetWidth===i.width?1:d.offsetWidth/i.width;return new r.P((c.clientX-i.left)*m,(c.clientY-i.top)*m)}class dn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,c){this._updatedSourceCaches[i]=c,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){let c=i.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(i.id),this.setDirty()}removeLayer(i){let c=i.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][i.id]=i,this._updatedLayers[c].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){let i={};for(let c in this._updatedLayers)i[c]=i[c]||{},i[c].updatedIds=Array.from(this._updatedLayers[c].values());for(let c in this._removedLayers)i[c]=i[c]||{},i[c].removedIds=Object.keys(this._removedLayers[c]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let Tt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Gn{constructor(i,c,m,v,x,w){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=v,this.instanceCount=w,this.context=i;let E=i.gl;this.buffer=E.createBuffer(),i.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||x||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){let c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,c){for(let m=0;m<this.attributes.length;m++){let v=c.attributes[this.attributes[m].name];v!==void 0&&i.enableVertexAttribArray(v)}}setVertexAttribPointers(i,c,m){for(let v=0;v<this.attributes.length;v++){let x=this.attributes[v],w=c.attributes[x.name];w!==void 0&&i.vertexAttribPointer(w,x.components,i[Tt[x.type]],!1,this.itemSize,x.offset+this.itemSize*(m||0))}}setVertexAttribDivisor(i,c,m){for(let v=0;v<this.attributes.length;v++){let x=c.attributes[this.attributes[v].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(x,m)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class wt{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ar extends wt{getDefault(){return r.C.transparent}set(i){let c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class jr extends wt{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Ur extends wt{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class En extends wt{getDefault(){return[!0,!0,!0,!0]}set(i){let c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Hs extends wt{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class ni extends wt{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class qs extends wt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){let c=this.current;(i.func!==c.func||i.ref!==c.ref||i.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Ws extends wt{getDefault(){let i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){let c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class mo extends wt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let c=this.gl;i?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=i,this.dirty=!1}}class fn extends wt{getDefault(){return[0,1]}set(i){let c=this.current;(i[0]!==c[0]||i[1]!==c[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Va extends wt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let c=this.gl;i?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=i,this.dirty=!1}}class $r extends wt{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class rh extends wt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let c=this.gl;i?c.enable(c.BLEND):c.disable(c.BLEND),this.current=i,this.dirty=!1}}class ih extends wt{getDefault(){let i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){let c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class oh extends wt{getDefault(){return r.C.transparent}set(i){let c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Pt extends wt{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class ja extends wt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let c=this.gl;i?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=i,this.dirty=!1}}class Hn extends wt{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class sh extends wt{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let ah=class extends wt{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class lh extends wt{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class mc extends wt{getDefault(){let i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){let c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ua extends wt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;let c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Yi extends wt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;let c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Xi extends wt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;let c=this.gl;c.bindTexture(c.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class gc extends wt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;let c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Mt extends wt{getDefault(){return null}set(i){let c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Rt extends wt{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class $a extends wt{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class _i extends wt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Zs extends wt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Ga extends wt{constructor(i,c){super(i),this.context=i,this.parent=c}getDefault(){return null}}class Ha extends Ga{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class _c extends Ga{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class cs extends Ga{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Ys extends _c{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class qa{constructor(i,c,m,v,x){this.context=i,this.width=c,this.height=m;let w=this.framebuffer=i.gl.createFramebuffer();v&&(this.colorAttachment=new Ha(i,w)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new _c(i,w):new cs(i,w))}destroy(){let i=this.context.gl;if(this.colorAttachment){let c=this.colorAttachment.get();c&&i.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let c=this.depthAttachment.get();c&&i.deleteRenderbuffer(c)}else{let c=this.depthAttachment.get();c&&i.deleteTexture(c)}i.deleteFramebuffer(this.framebuffer)}}class yc{constructor(i,c){this.gl=i,this.clearColor=new ar(this),this.clearDepth=new jr(this),this.clearStencil=new Ur(this),this.colorMask=new En(this),this.depthMask=new Hs(this),this.stencilMask=new ni(this),this.stencilFunc=new qs(this),this.stencilOp=new Ws(this),this.stencilTest=new mo(this),this.depthRange=new fn(this),this.depthTest=new Va(this),this.depthFunc=new $r(this),this.blend=new rh(this),this.blendFunc=new ih(this),this.blendColor=new oh(this),this.blendEquation=new Pt(this),this.cullFace=new ja(this),this.cullFaceSide=new Hn(this),this.frontFace=new sh(this),this.program=new ah(this),this.activeTexture=new lh(this),this.viewport=new mc(this),this.bindFramebuffer=new Ua(this),this.bindRenderbuffer=new Yi(this),this.bindTexture=new Xi(this),this.bindVertexBuffer=new gc(this),this.bindElementBuffer=new Mt(this),this.bindVertexArrayOES=new Rt(this),this.pixelStoreUnpack=new $a(this),this.pixelStoreUnpackPremultiplyAlpha=new _i(this),this.pixelStoreUnpackFlipY=new Zs(this),this.options=c?kt({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,c,m){return new r.I(this,i,c,m)}createVertexBuffer(i,c,m,v,x){return new Gn(this,i,c,m,v,x)}createRenderbuffer(i,c,m){let v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,i,c,m),this.bindRenderbuffer.set(null),x}createFramebuffer(i,c,m,v){return new qa(this,i,c,m,v)}clear({color:i,depth:c,stencil:m,colorMask:v}){let x=this.gl,w=0;i&&(w|=x.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(v||[!0,!0,!0,!0])),c!==void 0&&(w|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),m!==void 0&&(w|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),x.clear(w)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){C(i.blendFunction,r.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Wa{constructor(i){this._gl=i.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){let i=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,i}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class Za{constructor(i){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,i.registerParameter(this,["Symbols"],"useOcclusionQueries"),i.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),i.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),i.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),i.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class Ri{constructor(i,c,m,v){let x={width:m[0],height:m[1],data:null},w=i.gl;this.targetColorTexture=new r.T(i,x,w.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new r.T(i,x,w.RGBA,{useMipmap:!1}),this.context=i,this.updateParticleTexture(c,v),this.lastInvalidatedAt=0}updateParticleTexture(i,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let m=this.context.gl,v=c.width*c.height;this.particleTexture0=new r.T(this.context,c,m.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,c,m.RGBA,{premultiply:!1,useMipmap:!1});let x=new r.S;x.reserve(v);for(let w=0;w<v;w++)x.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(x,r.p.members,!0),this.particleSegment=r.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=r.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class ch extends r.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.numModelsLoading={}}loadModel(i,c){return r.l(this.requestManager.transformRequest(c,r.R.Model).url).then(m=>{if(!m)return;let v=r.c(m),x=new r.M(i,void 0,void 0,v);return x.computeBoundsAndApplyParent(),x}).catch(m=>{if(m&&m.status===404)return null;this.fire(new r.d(new Error(`Could not load model ${i} from ${c}: ${m.message}`)))})}load(i,c){this.models[c]||(this.models[c]={});let m=Object.keys(i);this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+m.length;let v=[];for(let x of m)v.push(this.loadModel(x,i[x]));Promise.allSettled(v).then(x=>{for(let w=0;w<x.length;w++){let{status:E,value:S}=x[w];E==="fulfilled"&&S&&(this.models[c][m[w]]={model:S,numReferences:1})}this.numModelsLoading[c]-=m.length,this.fire(new r.f("data",{dataType:"style"}))}).catch(x=>{this.fire(new r.d(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(let i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,c){return!!this.getModel(i,c)}getModel(i,c){return this.models[c]||(this.models[c]={}),this.models[c][i]?this.models[c][i].model:void 0}addModel(i,c,m){this.models[m]||(this.models[m]={}),this.hasModel(i,m)&&this.models[m][i].numReferences++,this.load({[i]:this.requestManager.normalizeModelURL(c)},m)}addModels(i,c){this.models[c]||(this.models[c]={});let m={};for(let v in i)this.models[c][v]={},m[v]=this.requestManager.normalizeModelURL(i[v]);this.load(m,c)}addModelsFromBucket(i,c){this.models[c]||(this.models[c]={});let m={};for(let v of i)this.hasModel(v,c)?this.models[c][v].numReferences++:m[v]=this.requestManager.normalizeModelURL(v);this.load(m,c)}removeModel(i,c){if(this.models[c]&&this.models[c][i]&&(this.models[c][i].numReferences--,this.models[c][i].numReferences===0)){let m=this.models[c][i].model;delete this.models[c][i],m.destroy()}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,c){this.models[c]||(this.models[c]={});for(let m in this.models[c])this.models[c][m].model&&this.models[c][m].model.upload(i.context)}}function Ot(d){let{userImage:i}=d;return!!(i&&i.render&&i.render())&&(d.data.replace(new Uint8Array(i.data.buffer)),!0)}class vc extends r.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new r.i({width:1,height:1})}isLoaded(){for(let i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,c){if(this.loaded[c]!==i&&(this.loaded[c]=i,i)){for(let{ids:m,callback:v}of this.requestors)this._notify(m,c,v);this.requestors=[]}}hasImage(i,c){return!!this.getImage(i,c)}getImage(i,c){return this.images[c][i]}addImage(i,c,m){this._validate(i,m)&&(this.images[c][i]=m)}_validate(i,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new r.d(new Error(`Image "${i}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new r.d(new Error(`Image "${i}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new r.d(new Error(`Image "${i}" has invalid "content" value`))),m=!1),m}_validateStretch(i,c){if(!i)return!0;let m=0;for(let v of i){if(v[0]<m||v[1]<v[0]||c<v[1])return!1;m=v[1]}return!0}_validateContent(i,c){return!(i&&(i.length!==4||i[0]<0||c.data.width<i[0]||i[1]<0||c.data.height<i[1]||i[2]<0||c.data.width<i[2]||i[3]<0||c.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,c,m){m.version=this.images[c][i].version+1,this.images[c][i]=m,this.updatedImages[c][i]=!0}removeImage(i,c){let m=this.images[c][i];delete this.images[c][i],delete this.patterns[c][i],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,c,m){let v=!0,x=!!this.loaded[c];if(!x)for(let w of i)this.images[c][w]||(v=!1);x||v?this._notify(i,c,m):this.requestors.push({ids:i,scope:c,callback:m})}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,c,m){let v={};for(let x of i){this.images[c][x]||this.fire(new r.f("styleimagemissing",{id:x}));let w=this.images[c][x];w?v[x]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:r.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}m(null,v)}getPixelSize(i){let{width:c,height:m}=this.atlasImage[i];return{width:c,height:m}}getPattern(i,c,m){let v=this.patterns[c][i],x=this.getImage(i,c);if(!x)return null;if(v&&v.position.version===x.version)return v.position;if(v)v.position.version=x.version;else{let w={w:x.data.width+2,h:x.data.height+2,x:0,y:0},E=new r.k(w,x);this.patterns[c][i]={bin:w,position:E}}return this._updatePatternAtlas(c,m),this.patterns[c][i].position}bind(i,c){let m=i.gl,v=this.atlasTexture[c];v?this.dirty&&(v.update(this.atlasImage[c]),this.dirty=!1):(v=new r.T(i,this.atlasImage[c],m.RGBA),this.atlasTexture[c]=v),v.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(i,c){let m=[];for(let E in this.patterns[i])m.push(this.patterns[i][E].bin);let{w:v,h:x}=r.j(m),w=this.atlasImage[i];w.resize({width:v||1,height:x||1});for(let E in this.patterns[i]){let{bin:S}=this.patterns[i][E],M=S.x+1,O=S.y+1,F=this.images[i][E].data,z=F.width,V=F.height;r.i.copy(F,w,{x:0,y:0},{x:M,y:O},{width:z,height:V},c),r.i.copy(F,w,{x:0,y:V-1},{x:M,y:O-1},{width:z,height:1},c),r.i.copy(F,w,{x:0,y:0},{x:M,y:O+V},{width:z,height:1},c),r.i.copy(F,w,{x:z-1,y:0},{x:M-1,y:O},{width:1,height:V},c),r.i.copy(F,w,{x:0,y:0},{x:M+z,y:O},{width:1,height:V},c)}this.dirty=!0}beginFrame(){for(let i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,c){for(let m of i){if(this.callbackDispatchedThisFrame[c][m])continue;this.callbackDispatchedThisFrame[c][m]=!0;let v=this.images[c][m];Ot(v)&&this.updateImage(m,c,v)}}}function ir(d){let i=d.key,c=d.value,m=d.valueSpec||{},v=d.objectElementValidators||{},x=d.style,w=d.styleSpec,E=[],S=r.n(c);if(S!=="object")return[new r.V(i,c,`object expected, ${S} found`)];for(let M in c){let O=M.split(".")[0],F;v[O]?F=v[O]:m[O]?F=U:v["*"]?F=v["*"]:m["*"]&&(F=U),F?E=E.concat(F({key:(i&&`${i}.`)+M,value:c[M],valueSpec:m[O]||m["*"],style:x,styleSpec:w,object:c,objectKey:M},c)):E.push(new r.m(i,c[M],`unknown property "${M}"`))}for(let M in m)v[M]||m[M].required&&m[M].default===void 0&&c[M]===void 0&&E.push(new r.V(i,c,`missing required property "${M}"`));return E}function Ya(d){let i=d.value,c=d.valueSpec,m=d.style,v=d.styleSpec,x=d.key,w=d.arrayElementValidator||U;if(r.n(i)!=="array")return[new r.V(x,i,`array expected, ${r.n(i)} found`)];if(c.length&&i.length!==c.length)return[new r.V(x,i,`array length ${c.length} expected, length ${i.length} found`)];if(c["min-length"]&&i.length<c["min-length"])return[new r.V(x,i,`array length at least ${c["min-length"]} expected, length ${i.length} found`)];let E={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};v.$version<7&&(E.function=c.function),r.n(c.value)==="object"&&(E=c.value);let S=[];for(let M=0;M<i.length;M++)S=S.concat(w({array:i,arrayIndex:M,value:i[M],valueSpec:E,style:m,styleSpec:v,key:`${x}[${M}]`},!0));return S}function Xs(d){let i=d.key,c=d.value,m=d.valueSpec,v=r.n(c);if(v==="number"&&c!=c&&(v="NaN"),v!=="number")return[new r.V(i,c,`number expected, ${v} found`)];if("minimum"in m){let x=m.minimum;if(r.n(m.minimum)==="array"&&(x=m.minimum[d.arrayIndex]),c<x)return[new r.V(i,c,`${c} is less than the minimum value ${x}`)]}if("maximum"in m){let x=m.maximum;if(r.n(m.maximum)==="array"&&(x=m.maximum[d.arrayIndex]),c>x)return[new r.V(i,c,`${c} is greater than the maximum value ${x}`)]}return[]}function go(d){let i=d.valueSpec,c=r.u(d.value.type),m,v,x,w={},E=c!=="categorical"&&d.value.property===void 0,S=!E,M=r.n(d.value.stops)==="array"&&r.n(d.value.stops[0])==="array"&&r.n(d.value.stops[0][0])==="object",O=ir({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(V){if(c==="identity")return[new r.V(V.key,V.value,'identity function may not have a "stops" property')];let $=[],G=V.value;return $=$.concat(Ya({key:V.key,value:G,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:F})),r.n(G)==="array"&&G.length===0&&$.push(new r.V(V.key,G,"array must have at least one stop")),$},default:function(V){return U({key:V.key,value:V.value,valueSpec:i,style:V.style,styleSpec:V.styleSpec})}}});return c==="identity"&&E&&O.push(new r.V(d.key,d.value,'missing required property "property"')),c==="identity"||d.value.stops||O.push(new r.V(d.key,d.value,'missing required property "stops"')),c==="exponential"&&d.valueSpec.expression&&!r.s(d.valueSpec)&&O.push(new r.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(S&&!r.q(d.valueSpec)?O.push(new r.V(d.key,d.value,"property functions not supported")):E&&!r.r(d.valueSpec)&&O.push(new r.V(d.key,d.value,"zoom functions not supported"))),c!=="categorical"&&!M||d.value.property!==void 0||O.push(new r.V(d.key,d.value,'"property" property is required')),O;function F(V){let $=[],G=V.value,H=V.key;if(r.n(G)!=="array")return[new r.V(H,G,`array expected, ${r.n(G)} found`)];if(G.length!==2)return[new r.V(H,G,`array length 2 expected, length ${G.length} found`)];if(M){if(r.n(G[0])!=="object")return[new r.V(H,G,`object expected, ${r.n(G[0])} found`)];if(G[0].zoom===void 0)return[new r.V(H,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new r.V(H,G,"object stop key must have value")];let q=r.u(G[0].zoom);if(typeof q!="number")return[new r.V(H,G[0].zoom,"stop zoom values must be numbers")];if(x&&x>q)return[new r.V(H,G[0].zoom,"stop zoom values must appear in ascending order")];q!==x&&(x=q,v=void 0,w={}),$=$.concat(ir({key:`${H}[0]`,value:G[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Xs,value:z}}))}else $=$.concat(z({key:`${H}[0]`,value:G[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},G));return r.t(r.v(G[1]))?$.concat([new r.V(`${H}[1]`,G[1],"expressions are not allowed in function stops.")]):$.concat(U({key:`${H}[1]`,value:G[1],valueSpec:i,style:V.style,styleSpec:V.styleSpec}))}function z(V,$){let G=r.n(V.value),H=r.u(V.value),q=V.value!==null?V.value:$;if(m){if(G!==m)return[new r.V(V.key,q,`${G} stop domain type must match previous stop domain type ${m}`)]}else m=G;if(G!=="number"&&G!=="string"&&G!=="boolean"&&typeof H!="number"&&typeof H!="string"&&typeof H!="boolean")return[new r.V(V.key,q,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&c!=="categorical"){let J=`number expected, ${G} found`;return r.q(i)&&c===void 0&&(J+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(V.key,q,J)]}return c!=="categorical"||G!=="number"||typeof H=="number"&&isFinite(H)&&Math.floor(H)===H?c!=="categorical"&&G==="number"&&typeof H=="number"&&typeof v=="number"&&v!==void 0&&H<v?[new r.V(V.key,q,"stop domain values must appear in ascending order")]:(v=H,c==="categorical"&&H in w?[new r.V(V.key,q,"stop domain values must be unique")]:(w[H]=!0,[])):[new r.V(V.key,q,`integer expected, found ${String(H)}`)]}}function _o(d){let i=(d.expressionContext==="property"?r.x:r.y)(r.v(d.value),d.valueSpec);if(i.result==="error")return i.value.map(m=>new r.V(`${d.key}${m.key}`,d.value,m.message));let c=i.value.expression||i.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!c.outputDefined())return[new r.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!r.z(c))return[new r.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return xc(c,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!r.A(c,["zoom","feature-state"]))return[new r.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!r.B(c))return[new r.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xc(d,i){let c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(let v of i.valueSpec.expression.parameters)c.delete(v);if(c.size===0)return[];let m=[];return d instanceof r.D&&c.has(d.name)?[new r.V(i.key,i.value,`["${d.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(d.eachChild(v=>{m.push(...xc(v,i))}),m)}function us(d){let i=d.key,c=d.value,m=d.valueSpec,v=[];return Array.isArray(m.values)?m.values.indexOf(r.u(c))===-1&&v.push(new r.V(i,c,`expected one of [${m.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(m.values).indexOf(r.u(c))===-1&&v.push(new r.V(i,c,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(c)} found`)),v}function hs(d){return r.G(r.v(d.value))?_o(r.o({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):Xa(d)}function Xa(d){let i=d.value,c=d.key;if(r.n(i)!=="array")return[new r.V(c,i,`array expected, ${r.n(i)} found`)];let m=d.styleSpec,v,x=[];if(i.length<1)return[new r.V(c,i,"filter array must have at least 1 element")];switch(x=x.concat(us({key:`${c}[0]`,value:i[0],valueSpec:m.filter_operator,style:d.style,styleSpec:d.styleSpec})),r.u(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&r.u(i[1])==="$type"&&x.push(new r.V(c,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&x.push(new r.V(c,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(v=r.n(i[1]),v!=="string"&&x.push(new r.V(`${c}[1]`,i[1],`string expected, ${v} found`)));for(let w=2;w<i.length;w++)v=r.n(i[w]),r.u(i[1])==="$type"?x=x.concat(us({key:`${c}[${w}]`,value:i[w],valueSpec:m.geometry_type,style:d.style,styleSpec:d.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&x.push(new r.V(`${c}[${w}]`,i[w],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let w=1;w<i.length;w++)x=x.concat(Xa({key:`${c}[${w}]`,value:i[w],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":v=r.n(i[1]),i.length!==2?x.push(new r.V(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):v!=="string"&&x.push(new r.V(`${c}[1]`,i[1],`string expected, ${v} found`))}return x}function Ka(d,i){let c=d.key,m=d.style,v=d.layer,x=d.styleSpec,w=d.value,E=d.objectKey,S=x[`${i}_${d.layerType}`];if(!S)return[];let M=E.match(/^(.*)-transition$/);if(i==="paint"&&M&&S[M[1]]&&S[M[1]].transition)return U({key:c,value:w,valueSpec:x.transition,style:m,styleSpec:x});let O=d.valueSpec||S[E];if(!O)return[new r.m(c,w,`unknown property "${E}"`)];let F;if(r.n(w)==="string"&&r.q(O)&&!O.tokens&&(F=/^{([^}]+)}$/.exec(w))){let V=`\`{ "type": "identity", "property": ${F?JSON.stringify(F[1]):'"_"'} }\``;return[new r.V(c,w,`"${E}" does not support interpolation syntax
Use an identity property function instead: ${V}.`)]}let z=[];if(d.layerType==="symbol")E!=="text-field"||!m||m.glyphs||m.imports||z.push(new r.V(c,w,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&r.H(r.v(w))&&r.u(w.type)==="identity"&&z.push(new r.V(c,w,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&i==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&r.q(O)&&(r.J(O)||r.r(O))){let V=r.x(r.v(w),O),$=V.value.expression||V.value._styleExpression.expression;$&&!r.A($,["measure-light"])&&(E==="model-emissive-strength"&&r.B($)&&r.z($)||z.push(new r.V(c,w,`${E} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return z.concat(U({key:d.key,value:w,valueSpec:O,style:m,styleSpec:x,expressionContext:"property",propertyType:i,propertyKey:E}))}function uh(d){return Ka(d,"paint")}function Qa(d){return Ka(d,"layout")}function Oi(d){let i=[],c=d.value,m=d.key,v=d.style,x=d.styleSpec;c.type||c.ref||i.push(new r.V(m,c,'either "type" or "ref" is required'));let w=r.u(c.type),E=r.u(c.ref);if(c.id){let S=r.u(c.id);for(let M=0;M<d.arrayIndex;M++){let O=v.layers[M];r.u(O.id)===S&&i.push(new r.V(m,c.id,`duplicate layer id "${c.id}", previously used at line ${O.id.__line__}`))}}if("ref"in c){let S;["type","source","source-layer","filter","layout"].forEach(M=>{M in c&&i.push(new r.V(m,c[M],`"${M}" is prohibited for ref layers`))}),v.layers.forEach(M=>{r.u(M.id)===E&&(S=M)}),S?S.ref?i.push(new r.V(m,c.ref,"ref cannot reference another ref layer")):w=r.u(S.type):typeof E=="string"&&i.push(new r.V(m,c.ref,`ref layer "${E}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(c.source){let S=v.sources&&v.sources[c.source],M=S&&r.u(S.type);S?M==="vector"&&w==="raster"?i.push(new r.V(m,c.source,`layer "${c.id}" requires a raster source`)):M==="raster"&&w!=="raster"?i.push(new r.V(m,c.source,`layer "${c.id}" requires a vector source`)):M!=="vector"||c["source-layer"]?M==="raster-dem"&&w!=="hillshade"?i.push(new r.V(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="raster-array"||["raster","raster-particle"].includes(w)?w!=="line"||!c.paint||!c.paint["line-gradient"]&&!c.paint["line-trim-offset"]||M==="geojson"&&S.lineMetrics?w==="raster-particle"&&M!=="raster-array"&&i.push(new r.V(m,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):i.push(new r.V(m,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new r.V(m,c.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new r.V(m,c,`layer "${c.id}" must specify a "source-layer"`)):i.push(new r.V(m,c.source,`source "${c.source}" not found`))}else i.push(new r.V(m,c,'missing required property "source"'));return i=i.concat(ir({key:m,value:c,valueSpec:x.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>U({key:`${m}.type`,value:c.type,valueSpec:x.layer.type,style:d.style,styleSpec:d.styleSpec,object:c,objectKey:"type"}),filter:S=>hs(r.o({layerType:w},S)),layout:S=>ir({layer:c,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":M=>Qa(r.o({layerType:w},M))}}),paint:S=>ir({layer:c,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":M=>uh(r.o({layerType:w,layer:c},M))}})}})),i}function ds(d){let i=d.value,c=d.key,m=r.n(i);return m!=="string"?[new r.V(c,i,`string expected, ${m} found`)]:[]}let ki={promoteId:function({key:d,value:i}){if(r.n(i)==="string")return ds({key:d,value:i});{let c=[];for(let m in i)c.push(...ds({key:`${d}.${m}`,value:i[m]}));return c}}};function Ar(d){let i=d.value,c=d.key,m=d.styleSpec,v=d.style;if(!i.type)return[new r.V(c,i,'"type" is required')];let x=r.u(i.type),w=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(i.url||i.tiles||w.push(new r.m(c,i,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(ir({key:c,value:i,valueSpec:m[`source_${x.replace("-","_")}`],style:d.style,styleSpec:m,objectElementValidators:ki})),w;case"geojson":if(w=ir({key:c,value:i,valueSpec:m.source_geojson,style:v,styleSpec:m,objectElementValidators:ki}),i.cluster)for(let E in i.clusterProperties){let[S,M]=i.clusterProperties[E],O=typeof S=="string"?[S,["accumulated"],["get",E]]:S;w.push(..._o({key:`${c}.${E}.map`,value:M,expressionContext:"cluster-map"})),w.push(..._o({key:`${c}.${E}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return w;case"video":return ir({key:c,value:i,valueSpec:m.source_video,style:v,styleSpec:m});case"image":return ir({key:c,value:i,valueSpec:m.source_image,style:v,styleSpec:m});case"canvas":return[new r.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return us({key:`${c}.type`,value:i.type,valueSpec:{values:hh(m)},style:v,styleSpec:m})}}function hh(d){return d.source.reduce((i,c)=>{let m=d[c];return m.type.type==="enum"&&(i=i.concat(Object.keys(m.type.values))),i},[])}function Ks(d){let i=d.value,c=d.styleSpec,m=c.light,v=d.style,x=[],w=r.n(i);if(i===void 0)return x;if(w!=="object")return x=x.concat([new r.V("light",i,`object expected, ${w} found`)]),x;for(let E in i){let S=E.match(/^(.*)-transition$/);x=x.concat(S&&m[S[1]]&&m[S[1]].transition?U({key:E,value:i[E],valueSpec:c.transition,style:v,styleSpec:c}):m[E]?U({key:E,value:i[E],valueSpec:m[E],style:v,styleSpec:c}):[new r.V(E,i[E],`unknown property "${E}"`)])}return x}function Ja(d){let i=d.value,c=[];if(!i)return c;let m=r.n(i);if(m!=="object")return c=c.concat([new r.V("light-3d",i,`object expected, ${m} found`)]),c;let v=d.styleSpec,x=v["light-3d"],w=d.key,E=d.style,S=d.style.lights;for(let F of["type","id"])if(!(F in i))return c=c.concat([new r.V("light-3d",i,`missing property ${F} on light`)]),c;if(i.type&&S)for(let F=0;F<d.arrayIndex;F++){let z=r.u(i.type),V=S[F];r.u(V.type)===z&&c.push(new r.V(w,i.id,`duplicate light type "${i.type}", previously defined at line ${V.id.__line__}`))}let M=`properties_light_${i.type}`;if(!(M in v))return c=c.concat([new r.V("light-3d",i,`Invalid light type ${i.type}`)]),c;let O=v[M];for(let F in i)if(F==="properties"){let z=i[F],V=r.n(z);if(V!=="object")return c=c.concat([new r.V("properties",z,`object expected, ${V} found`)]),c;for(let $ in z)c=c.concat(O[$]?U({key:$,value:z[$],valueSpec:O[$],style:E,styleSpec:v}):[new r.m(d.key,z[$],`unknown property "${$}"`)])}else{let z=F.match(/^(.*)-transition$/);c=c.concat(z&&x[z[1]]&&x[z[1]].transition?U({key:F,value:i[F],valueSpec:v.transition,style:E,styleSpec:v}):x[F]?U({key:F,value:i[F],valueSpec:x[F],style:E,styleSpec:v}):[new r.m(F,i[F],`unknown property "${F}"`)])}return c}function bc(d){let i=d.value,c=d.key,m=d.style,v=d.styleSpec,x=v.terrain,w=[],E=r.n(i);if(i===void 0||E==="null")return w;if(E!=="object")return w=w.concat([new r.V("terrain",i,`object expected, ${E} found`)]),w;for(let S in i){let M=S.match(/^(.*)-transition$/);w=w.concat(M&&x[M[1]]&&x[M[1]].transition?U({key:S,value:i[S],valueSpec:v.transition,style:m,styleSpec:v}):x[S]?U({key:S,value:i[S],valueSpec:x[S],style:m,styleSpec:v}):[new r.m(S,i[S],`unknown property "${S}"`)])}if(i.source){let S=m.sources&&m.sources[i.source],M=S&&r.u(S.type);S?M!=="raster-dem"&&w.push(new r.V(c,i.source,`terrain cannot be used with a source of type ${String(M)}, it only be used with a "raster-dem" source type`)):w.push(new r.V(c,i.source,`source "${i.source}" not found`))}else w.push(new r.V(c,i,'terrain is missing required property "source"'));return w}function el(d){let i=d.value,c=d.style,m=d.styleSpec,v=m.fog,x=[],w=r.n(i);if(i===void 0)return x;if(w!=="object")return x=x.concat([new r.V("fog",i,`object expected, ${w} found`)]),x;for(let E in i){let S=E.match(/^(.*)-transition$/);x=x.concat(S&&v[S[1]]&&v[S[1]].transition?U({key:E,value:i[E],valueSpec:m.transition,style:c,styleSpec:m}):v[E]?U({key:E,value:i[E],valueSpec:v[E],style:c,styleSpec:m}):[new r.m(E,i[E],`unknown property "${E}"`)])}return x}let ge={"*":()=>[],array:Ya,boolean:function(d){let i=d.value,c=d.key,m=r.n(i);return m!=="boolean"?[new r.V(c,i,`boolean expected, ${m} found`)]:[]},number:Xs,color:function(d){let i=d.key,c=d.value,m=r.n(c);return m!=="string"?[new r.V(i,c,`color expected, ${m} found`)]:r.F(c)===null?[new r.V(i,c,`color expected, "${c}" found`)]:[]},enum:us,filter:hs,function:go,layer:Oi,object:ir,source:Ar,model:r.K,light:Ks,"light-3d":Ja,terrain:bc,fog:el,string:ds,formatted:function(d){return ds(d).length===0?[]:_o(d)},resolvedImage:function(d){return ds(d).length===0?[]:_o(d)},projection:function(d){let i=d.value,c=d.styleSpec,m=c.projection,v=d.style,x=[],w=r.n(i);if(w==="object")for(let E in i)x=x.concat(U({key:E,value:i[E],valueSpec:m[E],style:v,styleSpec:c}));else w!=="string"&&(x=x.concat([new r.V("projection",i,`object or string expected, ${w} found`)]));return x},import:function(d){let{value:i,styleSpec:c}=d,w=i,{data:m}=w,v=sb(w,["data"]);Object.defineProperty(v,"__line__",{value:i.__line__,enumerable:!1});let x=ir(r.o({},d,{value:v,valueSpec:c.import}));return r.u(v.id)===""&&x.push(new r.V(`${d.key}.id`,v,"import id can't be an empty string")),m&&(x=x.concat(ie(m,c,{key:`${d.key}.data`}))),x}};function U(d,i=!1){let c=d.value,m=d.valueSpec,v=d.styleSpec;if(m.expression&&r.H(r.u(c)))return go(d);if(m.expression&&r.t(r.v(c)))return _o(d);if(m.type&&ge[m.type]){let x=ge[m.type](d);return i===!0&&x.length>0&&r.n(d.value)==="array"?_o(d):x}return ir(r.o({},d,{valueSpec:m.type?v[m.type]:m}))}function W(d){let i=d.value,c=d.key,m=ds(d);return m.length||(i.indexOf("{fontstack}")===-1&&m.push(new r.V(c,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&m.push(new r.V(c,i,'"glyphs" url must include a "{range}" token'))),m}function ie(d,i=r.L,c={}){return U({key:c.key||"",value:d,valueSpec:i.$root,styleSpec:i,style:d,objectElementValidators:{glyphs:W,"*":()=>[]}})}function ue(d,i=r.L){return Wt(ie(d,i))}let de=d=>Wt(Ar(d)),be=d=>Wt(Ks(d)),Se=d=>Wt(Ja(d)),ye=d=>Wt(bc(d)),Me=d=>Wt(el(d)),nt=d=>Wt(Oi(d)),Ke=d=>Wt(hs(d)),_t=d=>Wt(uh(d)),Ct=d=>Wt(Qa(d)),Gt=d=>Wt(r.K(d));function Wt(d){return d.slice().sort((i,c)=>i.line&&c.line?i.line-c.line:0)}function Nt(d,i){let c=!1;if(i&&i.length)for(let m of i)m instanceof r.m?r.w(m.message):(d.fire(new r.d(new Error(m.message))),c=!0);return c}let Jt=new r.N({anchor:new r.O(r.L.light.anchor),position:new r.Q(r.L.light.position),color:new r.O(r.L.light.color),intensity:new r.O(r.L.light.intensity)});class pt extends r.E{constructor(i,c="flat"){super(),this._transitionable=new r.U(Jt),this.setLight(i,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,c,m={}){this._validate(be,i,m)||(this._transitionable.setTransitionOrValue(i),this.id=c)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,m){return(!m||m.validate!==!1)&&Nt(this,i.call(ue,r.W({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.L})))}}let qn=new r.N({source:new r.O(r.L.terrain.source),exaggeration:new r.O(r.L.terrain.exaggeration)}),An=class extends r.E{constructor(d,i,c,m){super(),this.scope=c,this._transitionable=new r.U(qn,c,m),this._transitionable.setTransitionOrValue(d,m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(d,i){this._transitionable.setTransitionOrValue(d,i)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new r.X(d)).get("exaggeration")}isZoomDependent(){let d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof r.Z}},sn=45,lr=65,Wn=.05;function pr(d,i,c,m){let v=r.$(sn,lr,c),[x,w]=Gr(d,m),E=1-Math.min(1,Math.exp((i-x)/(w-x)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*v*d.alpha}function Gr(d,i){let c=.5/Math.tan(.5*i);return[d.range[0]+c,d.range[1]+c]}function Hr(d,i,c,m,v){let x=r._.transformMat4([],[i,c,m],v.mercatorFogMatrix);return pr(d,r._.length(x),v.pitch,v._fov)}function Qs(d,i,c,m,v,x,w){let E=[[c,m,0],[v,m,0],[v,x,0],[c,x,0]],S=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let O of E){let F=r._.transformMat4([],O,i),z=r._.length(F);S=Math.min(S,z),M=Math.max(M,z)}return[pr(d,S,w.pitch,w._fov),pr(d,M,w.pitch,w._fov)]}let mf=new r.N({range:new r.O(r.L.fog.range),color:new r.O(r.L.fog.color),"high-color":new r.O(r.L.fog["high-color"]),"space-color":new r.O(r.L.fog["space-color"]),"horizon-blend":new r.O(r.L.fog["horizon-blend"]),"star-intensity":new r.O(r.L.fog["star-intensity"]),"vertical-range":new r.O(r.L.fog["vertical-range"])});class yg extends r.E{constructor(i,c,m,v){super(),this._transitionable=new r.U(mf,m,new Map(v)),this.set(i,v),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new r.a0(mf),this.scope=m}get state(){let i=this._transform,c=i.projection.name==="globe",m=r.a1(i.zoom),v=this.properties.get("range"),x=[.5,3];return{range:c?[r.a2(x[0],v[0],m),r.a2(x[1],v[1],m)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,c,m={}){if(this._validate(Me,i,m))return;let v=r.W({},i);for(let x of Object.keys(r.L.fog))v[x]===void 0&&(v[x]=r.L.fog[x].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;let c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.$(sn,lr,i))*c.a}getOpacityAtLatLng(i,c){return this._transform.projection.supportsFog?function(m,v,x){let w=r.Y.fromLngLat(v),E=x.elevation?x.elevation.getAtPointOrZero(w):0;return Hr(m,w.x,w.y,E,x)}(this.state,i,c):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];let c=this._transform.calculateFogTileMatrix(i.toUnwrapped());return Qs(this.state,c,0,0,r.a3,r.a3,this._transform)}getOpacityForBounds(i,c,m,v,x){return this._transform.projection.supportsFog?Qs(this.state,i,c,m,v,x,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?Gr(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;let c=[4,5,6,7];for(let m of c){let v=i.points[m],x;if(v[2]>=0)x=v;else{let w=i.points[m-4];x=r.a4(w,v,w[2]/(w[2]-v[2]))}if(Hr(this.state,x[0],x[1],0,this._transform)>=Wn)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,m){return(!m||m.validate!==!1)&&Nt(this,i.call(ue,r.W({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.L})))}}class wc extends r.E{constructor(i,c,m,v){super(),this.scope=m,this._options=i,this.properties=new r.a0(c),this._transitionable=new r.U(c,m,new Map(v)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,c){this._options=i,this._transitionable.setTransitionOrValue(i.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Ut=new r.N({color:new r.O(r.L.properties_light_ambient.color),intensity:new r.O(r.L.properties_light_ambient.intensity)}),gf=new r.N({direction:new r.a5(r.L.properties_light_directional.direction),color:new r.O(r.L.properties_light_directional.color),intensity:new r.O(r.L.properties_light_directional.intensity),"cast-shadows":new r.O(r.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new r.O(r.L.properties_light_directional["shadow-intensity"])});var fs=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,_f=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,yf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,vf="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",xf=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,bf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,wf=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Tf=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Ef=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,If=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,vg=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let tl=[];nl(fs,tl),nl(yf,tl),nl(_f,tl);let dh={"_prelude_fog.vertex.glsl":bf,"_prelude_terrain.vertex.glsl":xf,"_prelude_shadow.vertex.glsl":If,"_prelude_fog.fragment.glsl":wf,"_prelude_shadow.fragment.glsl":vg,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Tf,"_prelude_raster_particle.glsl":Ef},fh={};Xt("",xf),Xt(wf,bf),Xt(vg,If),Xt(Tf,""),Xt(Ef,"");let xg=Xt(_f,yf),bg=fs;var wg={background:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Xt("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xt(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Xt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Xt("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Xt("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Xt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Xt(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Xt(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Xt(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Xt(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Xt("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Xt("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Xt(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Xt(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:Xt(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Xt(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Xt("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Xt(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,vf),skyboxGradient:Xt(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,vf),skyboxCapture:Xt(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Xt(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Xt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#else
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Xt(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Xt(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:Xt("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function nl(d,i){let c=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of c)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let v=m.split(" ");for(let x of v)i.includes(x)||i.push(x)}}function Xt(d,i){let c=/#include\s+"([^"]+)"/g,m=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,v=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(M=>{let O=M.split(" ");return O[O.length-1]}),v=[...new Set(v)]);let x={},w=[],E=[];if(d=d.replace(c,(M,O)=>(E.push(O),"")),(i=i.replace(c,(M,O)=>(w.push(O),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let S=[...tl];nl(d,S),nl(i,S);for(let M of[...w,...E])dh[M]||console.error(`Undefined include: ${M}`),fh[M]||(fh[M]=[],nl(dh[M],fh[M])),S=[...S,...fh[M]];return{fragmentSource:d=d.replace(m,(M,O,F,z,V)=>(x[V]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${F} ${z} ${V};
#else
uniform ${F} ${z} u_${V};
#endif
`:O==="initialize"?`
#ifdef HAS_UNIFORM_u_${V}
    ${F} ${z} ${V} = u_${V};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${F} ${z} ${V};
#endif
`:O==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(m,(M,O,F,z,V)=>{let $=z==="float"?"vec2":z,G=V.match(/color/)?"color":$;return O==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${V}
in ${F} ${z} a_${V};
#endif
`:x[V]?O==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${F} ${$} a_${V};
out ${F} ${z} ${V};
#else
uniform ${F} ${z} u_${V};
#endif
`:O==="initialize"?G==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${F} ${z} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${G}(a_${V}, u_${V}_t);
#else
    ${F} ${z} ${V} = u_${V};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${F} ${z} a_${V};
    out ${F} ${z} ${V};
#endif
`:O==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${V} = a_${V};
#endif
`:void 0:O==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${F} ${$} a_${V};
#else
uniform ${F} ${z} u_${V};
#endif
`:O==="define-instanced"?G==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${V}0;
in vec4 a_${V}1;
in vec4 a_${V}2;
in vec4 a_${V}3;
#else
uniform ${F} ${z} u_${V};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${$} a_${V};
#else
uniform ${F} ${z} u_${V};
#endif
`:O==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${F} ${z} ${V} = a_${V};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${F} ${z} ${V} = a_${V};
#else
    ${F} ${z} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${F} ${z} ${V} = unpack_mix_${G}(a_${V}, u_${V}_t);
#else
    ${F} ${z} ${V} = u_${V};
#endif
`}),staticAttributes:v,usedDefines:S,vertexIncludes:w,fragmentIncludes:E}}class Wv{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,c,m,v,x,w,E,S){this.context=i;let M=this.boundPaintVertexBuffers.length!==v.length;for(let F=0;!M&&F<v.length;F++)this.boundPaintVertexBuffers[F]!==v[F]&&(M=!0);let O=this.boundDynamicVertexBuffers.length!==E.length;for(let F=0;!O&&F<E.length;F++)this.boundDynamicVertexBuffers[F]!==E[F]&&(O=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==m||M||O||this.boundIndexBuffer!==x||this.boundVertexOffset!==w)this.freshBind(c,m,v,x,w,E,S);else{i.bindVertexArrayOES.set(this.vao);for(let F of E)F&&(F.bind(),S&&F.instanceCount&&F.setVertexAttribDivisor(i.gl,c,S));x&&x.dynamicDraw&&x.bind()}}freshBind(i,c,m,v,x,w,E){let S=i.numAttributes,M=this.context,O=M.gl;this.vao&&this.destroy(),this.vao=M.gl.createVertexArray(),M.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=w,c.enableAttributes(O,i),c.bind(),c.setVertexAttribPointers(O,i,x);for(let F of m)F.enableAttributes(O,i),F.bind(),F.setVertexAttribPointers(O,i,x);for(let F of w)F&&(F.enableAttributes(O,i),F.bind(),F.setVertexAttribPointers(O,i,x),E&&F.instanceCount&&F.setVertexAttribDivisor(O,i,E));v&&v.bind(),M.currentNumAttributes=S}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Zv(d,i){let c=Math.pow(2,i.canonical.z),m=i.canonical.y;return[new r.Y(0,m/c).toLngLat().lat,new r.Y(0,(m+1)/c).toLngLat().lat]}function Yv(d,i,c,m,v,x,w){let E=d.context,S=E.gl,M=c.hillshadeFBO;if(!M)return;d.prepareDrawTile();let O=d.isTileAffectedByFog(i),F=d.getOrCreateProgram("hillshade",{overrideFog:O});E.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,M.colorAttachment.get());let z=((H,q,J,ee)=>{let te=J.paint.get("hillshade-shadow-color"),ce=J.paint.get("hillshade-highlight-color"),le=J.paint.get("hillshade-accent-color"),Q=J.paint.get("hillshade-emissive-strength"),ne=r.ab(J.paint.get("hillshade-illumination-direction"));if(J.paint.get("hillshade-illumination-anchor")==="viewport")ne-=H.transform.angle;else if(H.style&&H.style.enable3dLights()&&H.style.directionalLight){let pe=H.style.directionalLight.properties.get("direction"),Ee=r.ac(pe.x,pe.y,pe.z);ne=r.ab(Ee[1])}let re=!H.options.moving;return{u_matrix:ee||H.transform.calculateProjMatrix(q.tileID.toUnwrapped(),re),u_image:0,u_latrange:Zv(0,q.tileID),u_light:[J.paint.get("hillshade-exaggeration"),ne],u_shadow:te.toRenderColor(J.lut),u_highlight:ce.toRenderColor(J.lut),u_emissive_strength:Q,u_accent:le.toRenderColor(J.lut)}})(d,c,m,d.terrain?i.projMatrix:null);d.uploadCommonUniforms(E,F,i.toUnwrapped());let{tileBoundsBuffer:V,tileBoundsIndexBuffer:$,tileBoundsSegments:G}=d.getTileBoundsBuffers(c);F.draw(d,S.TRIANGLES,v,x,w,r.af.disabled,z,m.id,V,$,G)}function Cf(d,i,c){if(!i.needsDEMTextureUpload)return;let m=d.context,v=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||d.getTileTexture(c.stride);let x=c.getPixels();i.demTexture?i.demTexture.update(x,{premultiply:!1}):i.demTexture=new r.T(m,x,v.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function yo(d,i,c){let m=d.context,v=m.gl;if(!i.dem)return;let x=i.dem;if(m.activeTexture.set(v.TEXTURE1),Cf(d,i,x),!i.demTexture)return;i.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);let w=x.dim;m.activeTexture.set(v.TEXTURE0);let E=i.hillshadeFBO;if(!E){let z=new r.T(m,{width:w,height:w,data:null},v.RGBA);z.bind(v.LINEAR,v.CLAMP_TO_EDGE),E=i.hillshadeFBO=m.createFramebuffer(w,w,!0,"renderbuffer"),E.colorAttachment.set(z.texture)}m.bindFramebuffer.set(E.framebuffer),m.viewport.set([0,0,w,w]);let{tileBoundsBuffer:S,tileBoundsIndexBuffer:M,tileBoundsSegments:O}=d.getMercatorTileBoundsBuffers(),F=[];d.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(d,v.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.disabled,((z,V)=>{let $=V.stride,G=r.ad.create();return r.ad.ortho(G,0,r.a3,-r.a3,0,0,1),r.ad.translate(G,G,[0,-r.a3,0]),{u_matrix:G,u_image:1,u_dimension:[$,$],u_zoom:z.overscaledZ}})(i.tileID,x),c.id,S,M,O),i.needsHillshadePrepare=!1}function Df(d,i,c,m,v){let x=function(w,E){if(w)return v(w);if(E){if(d.url&&E.tiles&&d.tiles&&delete d.tiles,E.variants){if(!Array.isArray(E.variants))return v(new Error("variants must be an array"));for(let M of E.variants){if(M==null||typeof M!="object"||M.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(M.capabilities))return v(new Error("capabilities must be an array"));if(M.capabilities.length===1&&M.capabilities[0]==="meshopt"){E=r.W(E,M);break}}}let S=r.ah(r.W(E,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(S.vectorLayers=E.vector_layers,S.vectorLayerIds=S.vectorLayers.map(M=>M.id)),E.raster_layers&&(S.rasterLayers=E.raster_layers,S.rasterLayerIds=S.rasterLayers.map(M=>M.id)),S.tiles=i.canonicalizeTileset(S,d.url),v(null,S)}};return d.url?r.g(i.transformRequest(i.normalizeSourceURL(d.url,null,c,m),r.R.Source),x):r.e.frame(()=>x(null,d))}class Tc{constructor(i,c,m){this.bounds=r.ai.convert(this.validateBounds(i)),this.minzoom=c||0,this.maxzoom=m||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){let c=Math.pow(2,i.z),m=Math.floor(r.aj(this.bounds.getWest())*c),v=Math.floor(r.ak(this.bounds.getNorth())*c),x=Math.ceil(r.aj(this.bounds.getEast())*c),w=Math.ceil(r.ak(this.bounds.getSouth())*c);return i.x>=m&&i.x<x&&i.y>=v&&i.y<w}}class Ec extends r.E{constructor(i,c,m,v){super(),this.id=i,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.W({type:"raster"},c),r.W(this,r.ah(c,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"})),this._tileJSONRequest=Df(this._options,this.map._requestManager,null,null,(c,m)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new r.d(c)):m&&(r.W(this,m),m.bounds&&(this.tileBounds=new Tc(m.bounds,this.minzoom,this.maxzoom)),r.an(m.tiles),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),i&&i(c)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();let i=r.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return r.W({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,c){let m=r.e.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);i.request=r.h(this.map._requestManager.transformRequest(v,r.R.Tile),(x,w,E,S)=>(delete i.request,i.aborted?(i.state="unloaded",c(null)):x?(i.state="errored",c(x)):w?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:E,expires:S}),i.setTexture(w,this.map.painter),i.state="loaded",r.am(this.dispatcher),void c(null)):c(null)))}abortTile(i,c){i.request&&(i.request.cancel(),delete i.request),c&&c()}unloadTile(i,c){i.texture&&i.texture instanceof r.T?(i.destroy(!0),i.texture&&i.texture instanceof r.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ph extends r.E{constructor(i,c,m,v){if(super(),this.id=i,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.W(this,r.ah(c,["url","scheme","tileSize","promoteId"])),this._options=r.W({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new r.ao}load(i){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"}));let c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=Df(this._options,this.map._requestManager,c,m,(v,x)=>{this._tileJSONRequest=null,this._loaded=!0,v?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),m&&m.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new r.d(v))):x&&(r.W(this,x),x.bounds&&(this.tileBounds=new Tc(x.bounds,this.minzoom,this.maxzoom)),r.an(x.tiles,this.map._requestManager._customAccessToken),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),i&&i(v)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();let i=r.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return r.W({},this._options)}loadTile(i,c){let m=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),v=this.map._requestManager.transformRequest(m,r.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,w={request:v,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,lut:x?{image:x.image.clone()}:null,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(w.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=c:i.request=i.actor.send("reloadTile",w,E.bind(this));else if(i.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",w,E.bind(this),void 0,!0);else{let S=r.ap.call({deduped:this._deduped},w,(M,O)=>{M||!O?E.call(this,M):(w.data={cacheControl:O.cacheControl,expires:O.expires,rawData:O.rawData.slice(0)},i.actor&&i.actor.send("loadTile",w,E.bind(this),void 0,!0))},!0);i.request={cancel:S}}function E(S,M){return delete i.request,i.aborted?c(null):S&&S.status!==404?c(S):(M&&M.resourceTiming&&(i.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&i.setExpiryData(M),i.loadVectorData(M,this.map.painter),r.am(this.dispatcher),c(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,c){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let Js=d=>({u_matrix:new r.a6(d),u_image0:new r.a7(d),u_skirt_height:new r.aa(d),u_ground_shadow_factor:new r.aq(d)}),at=(d,i,c)=>({u_matrix:d,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:c}),Tg=(d,i,c,m,v,x,w,E,S,M,O,F,z,V,$,G)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:c,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:w,u_frustum_tr:E,u_frustum_br:S,u_frustum_bl:M,u_globe_pos:O,u_globe_radius:F,u_viewport:z,u_grid_matrix:G?Float32Array.from(G):new Float32Array(9),u_skirt_height:V,u_far_z_cutoff:$});class Ic{constructor(i=0,c=0,m=0,v=0){if(isNaN(i)||i<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=c,this.left=m,this.right=v}interpolate(i,c,m){return c.top!=null&&i.top!=null&&(this.top=r.a2(i.top,c.top,m)),c.bottom!=null&&i.bottom!=null&&(this.bottom=r.a2(i.bottom,c.bottom,m)),c.left!=null&&i.left!=null&&(this.left=r.a2(i.left,c.left,m)),c.right!=null&&i.right!=null&&(this.right=r.a2(i.right,c.right,m)),this}getCenter(i,c){let m=r.at((this.left+i-this.right)/2,0,i),v=r.at((this.top+c-this.bottom)/2,0,c);return new r.P(m,v)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Ic(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function en(d,i){let c=r.aw(d,3);r.ad.fromQuat(d,i),r.az(d,3,c)}function qr(d,i){let c=r.av.identity([]);return r.av.rotateZ(c,c,-i),r.av.rotateX(c,c,-d),c}function Eg(d,i){let c=[d[0],d[1],0],m=[i[0],i[1],0];if(r._.length(c)>=1e-15){let w=r._.normalize([],c);r._.scale(m,w,r._.dot(m,w)),i[0]=m[0],i[1]=m[1]}let v=r._.cross([],i,d);if(r._.len(v)<1e-15)return null;let x=Math.atan2(-v[1],v[0]);return qr(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),x)}class Sf{constructor(i,c){this.position=i,this.orientation=c}get position(){return this._position}set position(i){if(i){let c=i instanceof r.Y?i:new r.Y(i[0],i[1],i[2]);this._renderWorldCopies&&(c.x=r.au(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(i,c){if(this.orientation=null,!this.position)return;let m=this.position,v=this._elevation?this._elevation.getAtPointOrZero(r.Y.fromLngLat(i)):0,x=r.Y.fromLngLat(i,v),w=[x.x-m.x,x.y-m.y,x.z-m.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Eg(w,c)}setPitchBearing(i,c){this.orientation=qr(r.ab(i),r.ab(-c))}}class Cc{constructor(i,c){this._transform=r.ad.identity([]),this.orientation=c,this.position=i}get mercatorPosition(){let i=this.position;return new r.Y(i[0],i[1],i[2])}get position(){let i=r.aw(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var c;i&&r.az(this._transform,3,[(c=i)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||r.av.identity([]),i&&en(this._transform,this._orientation)}getPitchBearing(){let i=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,c){this._orientation=qr(i,c),en(this._transform,this._orientation)}forward(){let i=r.aw(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){let i=r.aw(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){let i=r.aw(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,c){let m=new Float64Array(16);return r.ad.invert(m,this.getWorldToCamera(i,c)),m}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,c,m){let v=this.position;r._.scale(v,v,-i);let x=new Float64Array(16);return r.ad.fromScaling(x,[m,m,m]),r.ad.translate(x,x,v),x[10]*=c,x}getWorldToCamera(i,c){let m=new Float64Array(16),v=new Float64Array(4),x=this.position;return r.av.conjugate(v,this._orientation),r._.scale(x,x,-i),r.ad.fromQuat(m,v),r.ad.translate(m,m,x),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(i,c,m,v){let x=new Float64Array(16);return r.ad.perspective(x,i,c,m,v),x}getCameraToClipOrthographic(i,c,m,v,x,w){let E=new Float64Array(16);return r.ad.ortho(E,i,c,m,v,x,w),E}getDistanceToElevation(i,c=!1){let m=i===0?0:r.ax(i,c?r.ay(this.position[1]):this.position[1]),v=this.forward();return(m-this.position[2])/v[2]}clone(){return new Cc([...this.position],[...this.orientation])}}let rl={unknown:0,flipRequired:1,flipNotRequired:2},Ht=Math.tan(85*Math.PI/180);function ea(d,i,c,m,v,x,w){let E=r.ad.create();if(c)if(x.name==="globe"){let S=r.aB(v,i);r.ad.multiply(E,E,S)}else{let S=r.aC.invert([],w);E[0]=S[0],E[1]=S[1],E[4]=S[2],E[5]=S[3],m||r.ad.rotateZ(E,E,v.angle)}else r.ad.multiply(E,v.labelPlaneMatrix,d);return E}function ta(d,i,c,m,v,x,w){let E=ea(d,i,c,m,v,x,w);return x.name==="globe"&&c||(E[2]=E[6]=E[10]=E[14]=0),E}function il(d,i,c,m,v,x,w){if(c){if(x.name==="globe"){let E=ea(d,i,c,m,v,x,w);return r.ad.invert(E,E),r.ad.multiply(E,d,E),E}{let E=r.ad.clone(d),S=r.ad.identity([]);return S[0]=w[0],S[1]=w[1],S[4]=w[2],S[5]=w[3],r.ad.multiply(E,E,S),m||r.ad.rotateZ(E,E,-v.angle),E}}return v.glCoordMatrix}function Li(d,i,c,m){let v=[d,i,c,1];c?r.aA.transformMat4(v,v,m):vo(v,v,m);let x=v[3];return v[0]/=x,v[1]/=x,v[2]/=x,v}function Wr(d,i){return Math.min(.5+d/i*.5,1.5)}function Xv(d,i){let c=d[0]/d[3],m=d[1]/d[3];return c>=-i[0]&&c<=i[0]&&m>=-i[1]&&m<=i[1]}function mh(d,i,c,m,v,x,w,E,S,M){let O=c.transform,F=m?d.textSizeData:d.iconSizeData,z=r.aD(F,c.transform.zoom),V=O.projection.name==="globe",$=[256/c.width*2+1,256/c.height*2+1],G=m?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;G.clear();let H=null;V&&(H=m?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);let q=d.lineVertexArray,J=m?d.text.placedSymbolArray:d.icon.placedSymbolArray,ee=c.transform.width/c.transform.height,te,ce=!1;for(let le=0;le<J.length;le++){let Q=J.get(le),{numGlyphs:ne,writingMode:re}=Q;if(re!==r.aE.vertical||ce||te===r.aE.horizontal||(ce=!0),te=re,(Q.hidden||re===r.aE.vertical)&&!ce){na(ne,G);continue}ce=!1;let pe=new r.P(Q.tileAnchorX,Q.tileAnchorY),{x:Ee,y:se,z:Ie}=O.projection.projectTilePoint(pe.x,pe.y,M.canonical);if(S){let[st,ze,$e]=S(pe);Ee+=st,se+=ze,Ie+=$e}let De=[Ee,se,Ie,1];if(r.aA.transformMat4(De,De,i),!Xv(De,$)){na(ne,G);continue}let je=De[3],Ue=Wr(c.transform.getCameraToCenterDistance(O.projection),je),Ne=r.aF(F,z,Q),ve=w?Ne/Ue:Ne*Ue,Ae=Li(Ee,se,Ie,v);if(Ae[3]<=0){na(ne,G);continue}let ke={},it=w?null:S,lt=Af(Q,ve,!1,E,i,v,x,d.glyphOffsetArray,q,G,H,Ae,pe,ke,ee,it,O.projection,M,w);ce=lt.useVertical,it&&lt.needsFlipping&&(ke={}),(lt.notEnoughRoom||ce||lt.needsFlipping&&Af(Q,ve,!0,E,i,v,x,d.glyphOffsetArray,q,G,H,Ae,pe,ke,ee,it,O.projection,M,w).notEnoughRoom)&&na(ne,G)}m?(d.text.dynamicLayoutVertexBuffer.updateData(G),H&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(H)):(d.icon.dynamicLayoutVertexBuffer.updateData(G),H&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(H))}function gh(d,i,c,m,v,x,w,E,S,M,O,F,z,V,$,G){let{lineStartIndex:H,glyphStartIndex:q,segment:J}=E,ee=q+E.numGlyphs,te=H+E.lineLength,ce=i.getoffsetX(q),le=i.getoffsetX(ee-1),Q=ol(d*ce,c,m,v,x,w,J,H,te,S,M,O,F,z,!0,V,$,G);if(!Q)return null;let ne=ol(d*le,c,m,v,x,w,J,H,te,S,M,O,F,z,!0,V,$,G);return ne?{first:Q,last:ne}:null}function Mf(d,i,c,m){return d===r.aE.horizontal&&Math.abs(m)>Math.abs(c)?{useVertical:!0}:d===r.aE.vertical?m>0?{needsFlipping:!0}:null:i!==rl.unknown&&function(v,x){return v===0||Math.abs(x/v)>Ht}(c,m)?i===rl.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Af(d,i,c,m,v,x,w,E,S,M,O,F,z,V,$,G,H,q,J){let ee=i/24,te=d.lineOffsetX*ee,ce=d.lineOffsetY*ee,{lineStartIndex:le,glyphStartIndex:Q,numGlyphs:ne,segment:re,writingMode:pe,flipState:Ee}=d,se=le+d.lineLength,Ie=De=>{if(O){let[ve,Ae,ke]=De.up,it=M.length;r.aG(O,it+0,ve,Ae,ke),r.aG(O,it+1,ve,Ae,ke),r.aG(O,it+2,ve,Ae,ke),r.aG(O,it+3,ve,Ae,ke)}let[je,Ue,Ne]=De.point;r.aH(M,je,Ue,Ne,De.angle)};if(ne>1){let De=gh(ee,E,te,ce,c,F,z,d,S,x,V,G,!1,H,q,J);if(!De)return{notEnoughRoom:!0};if(m&&!c){let[je,Ue,Ne]=De.first.point,[ve,Ae,ke]=De.last.point;[je,Ue]=Li(je,Ue,Ne,w),[ve,Ae]=Li(ve,Ae,ke,w);let it=Mf(pe,Ee,(ve-je)*$,Ae-Ue);if(d.flipState=it&&it.needsFlipping?rl.flipRequired:rl.flipNotRequired,it)return it}Ie(De.first);for(let je=Q+1;je<Q+ne-1;je++){let Ue=ol(ee*E.getoffsetX(je),te,ce,c,F,z,re,le,se,S,x,V,G,!1,!1,H,q,J);if(!Ue)return M.length-=4*(je-Q),{notEnoughRoom:!0};Ie(Ue)}Ie(De.last)}else{if(m&&!c){let je=Li(z.x,z.y,0,v),Ue=le+re+1,Ne=new r.P(S.getx(Ue),S.gety(Ue)),ve=Li(Ne.x,Ne.y,0,v),Ae=ve[3]>0?ve:Dc(z,Ne,je,1,v,void 0,H,q.canonical),ke=Mf(pe,Ee,(Ae[0]-je[0])*$,Ae[1]-je[1]);if(d.flipState=ke&&ke.needsFlipping?rl.flipRequired:rl.flipNotRequired,ke)return ke}let De=ol(ee*E.getoffsetX(Q),te,ce,c,F,z,re,le,se,S,x,V,G,!1,!1,H,q,J);if(!De)return{notEnoughRoom:!0};Ie(De)}return{}}function _h(d,i,c,m,v){let{x,y:w,z:E}=m.projectTilePoint(d.x,d.y,i);if(!v)return Li(x,w,E,c);let[S,M,O]=v(d);return Li(x+S,w+M,E+O,c)}function Dc(d,i,c,m,v,x,w,E){let S=_h(d.sub(i)._unit()._add(d),E,v,w,x);return r._.sub(S,c,S),r._.normalize(S,S),r._.scaleAndAdd(S,c,S,m)}function ol(d,i,c,m,v,x,w,E,S,M,O,F,z,V,$,G,H,q){let J=m?d-i:d+i,ee=J>0?1:-1,te=0;m&&(ee*=-1,te=Math.PI),ee<0&&(te+=Math.PI);let ce=E+w+(ee>0?0:1)|0,le=v,Q=v,ne=0,re=0,pe=Math.abs(J),Ee=[],se=[],Ie=x,De=Ie,je=()=>Dc(De,Ie,Q,pe-ne+1,O,z,G,H.canonical);for(;ne+re<=pe;){if(ce+=ee,ce<E||ce>=S)return null;if(Q=le,De=Ie,Ee.push(Q),V&&se.push(De),Ie=new r.P(M.getx(ce),M.gety(ce)),le=F[ce],!le){let ze=_h(Ie,H.canonical,O,G,z);le=ze[3]>0?F[ce]=ze:je()}ne+=re,re=r._.distance(Q,le)}$&&z&&(F[ce]&&(le=je(),re=r._.distance(Q,le)),F[ce]=le);let Ue=(pe-ne)/re,Ne=Ie.sub(De)._mult(Ue)._add(De),ve=r._.sub([],le,Q),Ae=r._.scaleAndAdd([],Q,ve,Ue),ke=[0,0,1],it=ve[0],lt=ve[1];if(q&&(ke=G.upVector(H.canonical,Ne.x,Ne.y),ke[0]!==0||ke[1]!==0||ke[2]!==1)){let ze=[ke[2],0,-ke[0]],$e=r._.cross([],ke,ze);r._.normalize(ze,ze),r._.normalize($e,$e),it=r._.dot(ve,ze),lt=r._.dot(ve,$e)}if(c){let ze=r._.cross([],ke,ve);r._.normalize(ze,ze),r._.scaleAndAdd(Ae,Ae,ze,c*ee)}let st=te+Math.atan2(lt,it);return Ee.push(Ae),V&&se.push(Ne),{point:Ae,angle:st,path:Ee,tilePath:se,up:ke}}function na(d,i){let c=i.length,m=c+4*d;i.resize(m),i.float32.fill(-1/0,4*c,4*m)}function vo(d,i,c){let m=i[0],v=i[1];return d[0]=c[0]*m+c[4]*v+c[12],d[1]=c[1]*m+c[5]*v+c[13],d[3]=c[3]*m+c[7]*v+c[15],d}let Pf=(d,i,c)=>(1-c)*d+c*i,cr=d=>d*d*d*d*d;class xo{constructor(i,c,m,v,x,w,E){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=i||0,this._maxZoom=c||22,this._minPitch=m??0,this._maxPitch=v??60,this.setProjection(w),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new r.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ic,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Cc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let i=new xo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,c=!1){let m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(i||m)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return r.ah(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};let c=this.projection?this.getProjection():void 0;this.projection=r.aJ(this.projectionOptions);let m=!C(c,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){let i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.aJ({name:"mercator"});let c=i!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){let i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.au(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){let c=-i*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=r.aC.create(),r.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){let c=r.at(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=r.ab(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){let c=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){let i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let m=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&m.exaggeration()&&this._centerAltitudeValidForExaggeration!==m.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*m.exaggeration(),this._centerAltitudeValidForExaggeration=m.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=m.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let i=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop(),v=0,x=0;for(let w=0;w<c.length;w++){let E=new r.P(c[w][0]*this.width,m+c[w][1]*(this.height-m)),S=i.pointCoordinate(E);if(!S)continue;let M=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);v+=S[3]*M,x+=M}return x===0?NaN:v/x}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let i=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*c,v=this._mercatorZfromZoom(i),x=this._mercatorZfromZoom(this._maxZoom),w=Math.max(v-m,x);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){let c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude())),m;m=i.z<this._camera.position[2]?[c.x,c.y,c.z]:[i.x,i.y,i.z];let v=r._.length(r._.sub([],this._camera.position,m));return r.at(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let c=!1;if(i.orientation&&!r.av.exactEquals(i.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(i.orientation)),i.position){let m=[i.position.x,i.position.y,i.position.z];r._.exactEquals(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let i=this._camera.position,c=new Sf;return c.position=new r.Y(i[0],i[1],i[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(i){if(!r.av.length(i))return!1;r.av.normalize(i,i);let c=r._.transformQuat([],[0,0,-1],i),m=r._.transformQuat([],[0,-1,0],i);if(m[2]<0)return!1;let v=Eg(c,m);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(i){let c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;i[2]=r.at(i[2],v/m,v/c),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,c,m){this._unmodified=!1,this._edgeInsets.interpolate(i,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){let c=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(i){let c=[new r.aK(0,i)];if(this.renderWorldCopies){let m=this.pointCoordinate(new r.P(0,0)),v=this.pointCoordinate(new r.P(this.width,0)),x=this.pointCoordinate(new r.P(this.width,this.height)),w=this.pointCoordinate(new r.P(0,this.height)),E=Math.floor(Math.min(m.x,v.x,x.x,w.x)),S=Math.floor(Math.max(m.x,v.x,x.x,w.x)),M=1;for(let O=E-M;O<=S+M;O++)O!==0&&c.push(new r.aK(O,i))}return c}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(i,c,m){let v=[];if(c[0]===0&&c[1]===0)return v;for(let w of i){let E=w.canonical,S=w.overscaledZ,M=w.wrap,O=1<<E.z,F=E.x+1<O,z=E.x>0,V=E.y+1<O,$=E.y>0,G=w.wrap-(z?0:1),H=w.wrap+(F?0:1),q=z?E.x-1:O-1,J=F?E.x+1:0;c[0]<0?(v.push(new r.aL(S,H,E.z,J,E.y)),c[1]<0&&V&&(v.push(new r.aL(S,M,E.z,E.x,E.y+1)),v.push(new r.aL(S,H,E.z,J,E.y+1))),c[1]>0&&$&&(v.push(new r.aL(S,M,E.z,E.x,E.y-1)),v.push(new r.aL(S,H,E.z,J,E.y-1)))):c[0]>0?(v.push(new r.aL(S,G,E.z,q,E.y)),c[1]<0&&V&&(v.push(new r.aL(S,M,E.z,E.x,E.y+1)),v.push(new r.aL(S,G,E.z,q,E.y+1))),c[1]>0&&$&&(v.push(new r.aL(S,M,E.z,E.x,E.y-1)),v.push(new r.aL(S,G,E.z,q,E.y-1)))):c[1]<0&&V?v.push(new r.aL(S,M,E.z,E.x,E.y+1)):$&&v.push(new r.aL(S,M,E.z,E.x,E.y-1))}if(v.length>1){v.sort((S,M)=>S.overscaledZ-M.overscaledZ||S.wrap-M.wrap||S.canonical.z-M.canonical.z||S.canonical.x-M.canonical.x||S.canonical.y-M.canonical.y);let w=0,E=0;for(;E<v.length;)v[E].equals(v[w])?++E:v[++w]=v[E++];v.length=w+1}let x=[];for(let w of v)v.some(E=>w.isChildOf(E))||x.push(w);return v=x.filter(w=>!i.some(E=>!!(w.overscaledZ<m&&E.isChildOf(w))||w.equals(E)||w.isChildOf(E))),v}coveringTiles(i){let c=this.coveringZoomLevel(i),m=c,v=this.elevation&&this.elevation.exaggeration(),x=v&&!i.isTerrainDEM,w=this.projection.name==="mercator";if(i.minzoom!==void 0&&c<i.minzoom)return[];i.maxzoom!==void 0&&c>i.maxzoom&&(c=i.maxzoom);let E=this.locationCoordinate(this.center),S=this.center.lat,M=1<<c,O=[M*E.x,M*E.y,0],F=this.projection.name==="globe",z=!F,V=r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,z),$=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=M*r.ax(1,this.center.lat),H=this._camera.position[2]/r.ax(1,this.center.lat),q=[M*$.x,M*$.y,H*(z?1:G)],J=F||v,ee=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),te=this.isLODDisabled(!0)?c:0,ce;if(this._elevation&&i.isTerrainDEM)ce=1e4*this._elevation.exaggeration();else if(this._elevation){let ve=this._elevation.getMinMaxForVisibleTiles();ce=ve?ve.max:this._centerAltitude}else ce=this._centerAltitude;let le=i.isTerrainDEM?-ce:this._elevation?this._elevation.getMinElevationBelowMSL():0,Q=this.projection.isReprojectedInTileSpace?r.aN(this):1,ne=ve=>{let ke=new r.Y(ve.x+25e-6,ve.y,ve.z),it=new r.Y(ve.x,ve.y+25e-6,ve.z),lt=ve.toLngLat(),st=ke.toLngLat(),ze=it.toLngLat(),$e=this.locationCoordinate(lt),ot=this.locationCoordinate(st),ft=this.locationCoordinate(ze),At=Math.hypot(ot.x-$e.x,ot.y-$e.y),Bt=Math.hypot(ft.x-$e.x,ft.y-$e.y);return Math.sqrt(At*Bt)*Q/25e-6},re=ve=>{let Ae=ce,ke=le;return{aabb:r.aQ(this,M,0,0,0,ve,ke,Ae,this.projection),zoom:0,x:0,y:0,minZ:ke,maxZ:Ae,wrap:ve,fullyVisible:!1}},pe=[],Ee=[],se=c,Ie=i.reparseOverscaled?m:c,De=ve=>ve*ve,je=De((H-this._centerAltitude)*G),Ue=ve=>{if(!this._elevation||!ve.tileID||!w)return;let Ae=this._elevation.getMinMaxForTile(ve.tileID),ke=ve.aabb;Ae?(ke.min[2]=Ae.min,ke.max[2]=Ae.max,ke.center[2]=(ke.min[2]+ke.max[2])/2):(ve.shouldSplit=Ne(ve),ve.shouldSplit||(ke.min[2]=ke.max[2]=ke.center[2]=this._centerAltitude))},Ne=ve=>{if(ve.zoom<te)return!0;if(ve.zoom===se)return!1;if(ve.shouldSplit!=null)return ve.shouldSplit;let Ae=ve.aabb.distanceX(q),ke=ve.aabb.distanceY(q),it=je,lt=1;if(F){it=De(ve.aabb.distanceZ(q));let $e=Math.pow(2,ve.zoom),ot=r.ay((ve.y+1)/$e),ft=r.ay(ve.y/$e),At=Math.min(Math.max(S,ot),ft),Bt=r.b4(At)/r.b4(S);if(lt=At===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Bt/this._mercatorScaleRatio),this.zoom<=r.b1&&ve.zoom===se-1&&Bt>=.9)return!0}else if(x&&(it=De(ve.aabb.distanceZ(q)*G)),this.projection.isReprojectedInTileSpace&&m<=5){let $e=Math.pow(2,ve.zoom),ot=ne(new r.Y((ve.x+.5)/$e,(ve.y+.5)/$e));lt=ot>.85?1:ot}let st=Ae*Ae+ke*ke+it,ze=De((1<<se-ve.zoom)*ee*lt*(($e,ot)=>{if(ot*De(.707)<$e)return 1;let ft=Math.sqrt(ot/$e);return ft/(1.4144271570014144+(Math.pow(1.1,ft-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(it,je),st));return st<ze};if(this.renderWorldCopies)for(let ve=1;ve<=3;ve++)pe.push(re(-ve)),pe.push(re(ve));for(pe.push(re(0));pe.length>0;){let ve=pe.pop(),Ae=ve.x,ke=ve.y,it=ve.fullyVisible,lt=()=>this.projection.name==="globe"&&(ve.y===0||ve.y===(1<<ve.zoom)-1);if(!it){let st=J?ve.aabb.intersects(V):ve.aabb.intersectsFlat(V);if(st===0&&lt()){let ze=new r.aO(ve.zoom,Ae,ke);st=r.aP(this,M,ze,!0).intersects(V)}if(st===0)continue;it=st===2}if(ve.zoom!==se&&Ne(ve))for(let st=0;st<4;st++){let ze=(Ae<<1)+st%2,$e=(ke<<1)+(st>>1),ot={aabb:w?ve.aabb.quadrant(st):r.aQ(this,M,ve.zoom+1,ze,$e,ve.wrap,ve.minZ,ve.maxZ,this.projection),zoom:ve.zoom+1,x:ze,y:$e,wrap:ve.wrap,fullyVisible:it,tileID:void 0,shouldSplit:void 0,minZ:ve.minZ,maxZ:ve.maxZ};x&&!F&&(ot.tileID=new r.aL(ve.zoom+1===se?Ie:ve.zoom+1,ve.wrap,ve.zoom+1,ze,$e),Ue(ot)),pe.push(ot)}else{let st=ve.zoom===se?Ie:ve.zoom;if(i.minzoom&&i.minzoom>st)continue;if(!it){let ft=J?ve.aabb.intersectsPrecise(V):ve.aabb.intersectsPreciseFlat(V);if(ft===0&&lt()){let At=new r.aO(ve.zoom,Ae,ke);ft=r.aP(this,M,At,!0).intersectsPrecise(V)}if(ft===0)continue}let ze=O[0]-(.5+Ae+(ve.wrap<<ve.zoom))*(1<<c-ve.zoom),$e=O[1]-.5-ke,ot=ve.tileID?ve.tileID:new r.aL(st,ve.wrap,ve.zoom,Ae,ke);Ee.push({tileID:ot,distanceSq:ze*ze+$e*$e})}}if(this.fogCullDistSq){let ve=this.fogCullDistSq,Ae=this.horizonLineFromTop();Ee=Ee.filter(ke=>{let it=[0,0,0,1],lt=[r.a3,r.a3,0,1],st=this.calculateFogTileMatrix(ke.tileID.toUnwrapped());r.aA.transformMat4(it,it,st),r.aA.transformMat4(lt,lt,st);let ze=r.aA.min([],it,lt),$e=r.aA.max([],it,lt),ot=r.aR(ze,$e);if(ot===0)return!0;let ft=!1,At=this._elevation;if(At&&ot>ve&&Ae!==0){let Bt=this.calculateProjMatrix(ke.tileID.toUnwrapped()),tn;i.isTerrainDEM||(tn=At.getMinMaxForTile(ke.tileID)),tn||(tn={min:le,max:ce});let Kt=r.b2(this.rotation),In=[Kt[0]*r.a3,Kt[1]*r.a3,tn.max];r._.transformMat4(In,In,Bt),ft=(1-In[1])*this.height*.5<Ae}return ot<ve||ft})}return Ee.sort((ve,Ae)=>ve.distanceSq-Ae.distanceSq).map(ve=>ve.tileID)}resize(i,c){this.width=i,this.height=c,this.pixelsToGLUnits=[2/i,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){let c=r.at(i.lat,-r.aS,r.aS),m=this.projection.project(i.lng,c);return new r.P(m.x*this.worldSize,m.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,c){let m,v,x=this.centerPoint;if(this.projection.name==="globe"){let E=this.worldSize;m=(c.x-x.x)/E,v=(c.y-x.y)/E}else{let E=this.pointCoordinate(c),S=this.pointCoordinate(x);m=E.x-S.x,v=E.y-S.y}let w=this.locationCoordinate(i);this.setLocation(new r.Y(w.x-m,w.y-v))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,c){let m=c?r.ax(c,i.lat):void 0,v=this.projection.project(i.lng,i.lat);return new r.Y(v.x,v.y,m)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,c){let m=c??this._centerAltitude,v=[i.x,i.y,0,1],x=[i.x,i.y,1,1];r.aA.transformMat4(v,v,this.pixelMatrixInverse),r.aA.transformMat4(x,x,this.pixelMatrixInverse);let w=x[3];r.aA.scale(v,v,1/v[3]),r.aA.scale(x,x,1/w);let E=v[2],S=x[2];return{p0:v,p1:x,t:E===S?0:(m-E)/(S-E)}}screenPointToMercatorRay(i){let c=[i.x,i.y,0,1],m=[i.x,i.y,1,1];return r.aA.transformMat4(c,c,this.pixelMatrixInverse),r.aA.transformMat4(m,m,this.pixelMatrixInverse),r.aA.scale(c,c,1/c[3]),r.aA.scale(m,m,1/m[3]),c[2]=r.ax(c[2],this._center.lat)*this.worldSize,m[2]=r.ax(m[2],this._center.lat)*this.worldSize,r.aA.scale(c,c,1/this.worldSize),r.aA.scale(m,m,1/this.worldSize),new r.aT([c[0],c[1],c[2]],r._.normalize([],r._.sub([],m,c)))}rayIntersectionCoordinate(i){let{p0:c,p1:m,t:v}=i,x=r.ax(c[2],this._center.lat),w=r.ax(m[2],this._center.lat);return new r.Y(r.a2(c[0],m[0],v)/this.worldSize,r.a2(c[1],m[1],v)/this.worldSize,r.a2(x,w,v))}pointCoordinate(i,c=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,c)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let c=this.projection.pointCoordinate3D(this,i.x,i.y);if(c)return new r.Y(c[0],c[1],c[2]);let m=0,v=this.horizonLineFromTop();if(i.y>v)return this.pointCoordinate(i);let x=.02*v,w=i.clone();for(let E=0;E<10&&v-m>x;E++){w.y=r.a2(m,v,.66);let S=this.projection.pointCoordinate3D(this,w.x,w.y);S?(v=w.y,c=S):m=w.y}return c?new r.Y(c[0],c[1],c[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=r.aU)return!this.isPointAboveHorizon(i);let c=this.pointCoordinate(i);return c.y>=0&&c.y<=1}_coordinatePoint(i,c){let m=c&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,v=[i.x*this.worldSize,i.y*this.worldSize,m+i.toAltitude(),1];return r.aA.transformMat4(v,v,this.pixelMatrix),v[3]>0?new r.P(v[0]/v[3],v[1]/v[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:i,left:c}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,x=this.pointLocation3D(new r.P(c,i)),w=this.pointLocation3D(new r.P(v,i)),E=this.pointLocation3D(new r.P(v,m)),S=this.pointLocation3D(new r.P(c,m)),M=Math.min(x.lng,w.lng,E.lng,S.lng),O=Math.max(x.lng,w.lng,E.lng,S.lng),F=Math.min(x.lat,w.lat,E.lat,S.lat),z=Math.max(x.lat,w.lat,E.lat,S.lat),V=Math.pow(2,-this.zoom)/16*270,$=this.projection.name==="globe"?1:4,G=(H,q,J,ee,te)=>{let ce=(H+J)/2,le=(q+ee)/2,Q=new r.P(ce,le),{lng:ne,lat:re}=this.pointLocation3D(Q),pe=Math.max(0,M-ne,F-re,ne-O,re-z);M=Math.min(M,ne),O=Math.max(O,ne),F=Math.min(F,re),z=Math.max(z,re),(te<$||pe>V)&&(G(H,q,ce,le,te+1),G(ce,le,J,ee,te+1))};if(G(c,i,v,i,1),G(v,i,v,m,1),G(v,m,c,m,1),G(c,m,c,i,1),this.projection.name==="globe"){let[H,q]=r.aV(this);H?(z=90,O=180,M=-180):q&&(F=-90,O=180,M=-180)}return new r.ai(new r.aI(M,F),new r.aI(O,z))}_getBoundsRectangular(i,c){let{top:m,left:v}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,E=new r.P(v,m),S=new r.P(w,m),M=new r.P(w,x),O=new r.P(v,x),F=this.pointCoordinate(E,i),z=this.pointCoordinate(S,i),V=this.pointCoordinate(M,c),$=this.pointCoordinate(O,c),G=(H,q)=>(q.y-H.y)/(q.x-H.x);return F.y>1&&z.y>=0?F=new r.Y((1-$.y)/G($,F)+$.x,1):F.y<0&&z.y<=1&&(F=new r.Y(-$.y/G($,F)+$.x,0)),z.y>1&&F.y>=0?z=new r.Y((1-V.y)/G(V,z)+V.x,1):z.y<0&&F.y<=1&&(z=new r.Y(-V.y/G(V,z)+V.x,0)),new r.ai().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(V))}_getBoundsRectangularTerrain(){let i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);let c=i.visibleDemTiles.reduce((m,v)=>{if(v.dem){let x=v.dem.tree;m.min=Math.min(m.min,x.minimums[0]),m.max=Math.max(m.max,x.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*i.exaggeration(),c.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){let c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return i?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-r.aS,this.maxLat=r.aS,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aj(this.minLng)*this.tileSize,this.worldMaxX=r.aj(this.maxLng)*this.tileSize,this.worldMinY=r.ak(this.maxLat)*this.tileSize,this.worldMaxY=r.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,c){return this.projection.createTileMatrix(this,c,i)}calculateDistanceTileData(i){let c=i.key,m=this._distanceTileDataCache;if(m[c])return m[c];let v=i.canonical,x=1/this.height,w=this.cameraWorldSize,E=w/this.zoomScale(v.z),S=(v.x+Math.pow(2,v.z)*i.wrap)*E,M=v.y*E,O=this.point;O.x*=w/this.worldSize,O.y*=w/this.worldSize;let F=this.angle,z=Math.sin(-F),V=-Math.cos(-F);return m[c]={bearing:[z,V],center:[(O.x-S)*x,(O.y-M)*x],scale:E/r.a3*x},m[c]}calculateFogTileMatrix(i){let c=i.key,m=this._fogTileMatrixCache;if(m[c])return m[c];let v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return r.ad.multiply(v,this.worldToFogMatrix,v),m[c]=new Float32Array(v),m[c]}calculateProjMatrix(i,c=!1,m=!1){let v=i.key,x;if(x=m?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,x[v])return x[v];let w=this.calculatePosMatrix(i,this.worldSize),E;return E=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,r.ad.multiply(w,E,w),x[v]=new Float32Array(w),x[v]}calculatePixelsToTileUnitsMatrix(i){let c=i.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];let v=r.aW(i,this);return m[c]=v,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let i=1/this.worldSize,c=r.ad.fromScaling([],[i,i,i]);return r.ad.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let i=this._elevation;this._updateCameraState();let c=r.ax(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),v=this._camera.forward(),x=r.ax(1,this._center.lat);m[2]/=x,v[2]/=x,r._.normalize(v,v);let w=i.raycast(m,v,i.exaggeration());if(w){let E=r._.scaleAndAdd([],m,v,w),S=new r.Y(E[0],E[1],r.ax(E[2],r.ay(E[1]))),M=(S.z+r._.length([S.x-m[0],S.y-m[1],S.z-m[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(M),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;let c=this._elevation,m=r.ax(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(m),x=c.getAtPointOrZero(new r.Y(...v)),w=this.pixelsPerMeter/this.worldSize*x,E=this._minimumHeightOverTerrain(),S=v[2]-w;if(S<=E)if(S<0||i){let M=this.locationCoordinate(this._center,this._centerAltitude),O=[v[0],v[1],M.z-v[2]],F=r._.length(O);O[2]-=(E-S)/this._pixelsPerMercatorPixel;let z=r._.length(O);if(z===0)return;r._.scale(O,O,F/z*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],M.z*this._pixelsPerMercatorPixel-O[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){let z=this.center;return z.lat=r.at(z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(z.lng=r.at(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}let c=this._unmodified,{x:m,y:v}=this.point,x=0,w=m,E=v,S=this.width/2,M=this.height/2,O=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(v-M<O&&(E=O+M),v+M>F&&(E=F-M),F-O<this.height&&(x=Math.max(x,this.height/(F-O)),E=(F+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let z=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,$=this.worldSize/2-(z+V)/2;w=(m+$+this.worldSize)%this.worldSize-$,w-S<z&&(w=z+S),w+S>V&&(w=V-S),V-z<this.width&&(x=Math.max(x,this.width/(V-z)),w=(V+z)/2)}w===m&&E===v||(this.center=this.unproject(new r.P(w,E))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let i=this.centerOffset,c=this.projection.name==="globe",m=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.ax(1,this.center.lat)/r.ax(1,r.b3));let v=r.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let x=this.projection.zAxisUnit==="meters"?m:1,w=this._camera.getWorldToCamera(this.worldSize,x),E,S=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(S[8]=2*-i.x/this.width,S[9]=2*i.y/this.height,this.isOrthographic){let re=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),pe=re*this.aspect,Ee=-pe,se=-re;pe-=i.x,Ee-=i.x,re+=i.y,se+=i.y,E=this._camera.getCameraToClipOrthographic(Ee,pe,se,re,this._nearZ,this._farZ),((Ie,De,je,Ue)=>{for(let Ne=0;Ne<16;Ne++)Ie[Ne]=Pf(De[Ne],je[Ne],Ue)})(E,E,S,cr(this.pitch>=15?1:this.pitch/15))}else E=S;let M=r.ad.mul([],S,w),O=r.ad.mul([],E,w);if(this.projection.isReprojectedInTileSpace){let re=this.locationCoordinate(this.center),pe=r.ad.identity([]);r.ad.translate(pe,pe,[re.x*this.worldSize,re.y*this.worldSize,0]),r.ad.multiply(pe,pe,r.aY(this)),r.ad.translate(pe,pe,[-re.x*this.worldSize,-re.y*this.worldSize,0]),r.ad.multiply(O,O,pe),r.ad.multiply(M,M,pe),this.inverseAdjustmentMatrix=r.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.ad.scale([],O,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=O,this.invProjMatrix=r.ad.invert(new Float64Array(16),this.projMatrix),c){let re=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);re[8]=2*-i.x/this.width,re[9]=2*i.y/this.height,this.expandedFarZProjMatrix=r.ad.mul([],re,w)}else this.expandedFarZProjMatrix=this.projMatrix;let F=r.ad.invert([],E);this.frustumCorners=r.a_.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);let z=new Float32Array(16);r.ad.identity(z),r.ad.scale(z,z,[1,-1,1]),r.ad.rotateX(z,z,this._pitch),r.ad.rotateZ(z,z,this.angle);let V=r.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.ad.clone(V);let $=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;V[8]=2*-i.x/this.width,V[9]=2*(i.y+$)/this.height,this.skyboxMatrix=r.ad.multiply(z,V,z);let G=this.point,H=G.x,q=G.y,J=this.width%2/2,ee=this.height%2/2,te=Math.cos(this.angle),ce=Math.sin(this.angle),le=H-Math.round(H)+te*J+ce*ee,Q=q-Math.round(q)+te*ee+ce*J,ne=new Float64Array(O);if(r.ad.translate(ne,ne,[le>.5?le-1:le,Q>.5?Q-1:Q,0]),this.alignedProjMatrix=ne,O=r.ad.create(),r.ad.scale(O,O,[this.width/2,-this.height/2,1]),r.ad.translate(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=r.ad.create(),r.ad.scale(O,O,[1,-1,1]),r.ad.translate(O,O,[-1,-1,0]),r.ad.scale(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=r.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,M),this._calcFogMatrices(),this._distanceTileDataCache={},O=r.ad.invert(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.a$(this);let re=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r._.transformMat4(re,re,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let i=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,m=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[i,i,c];r._.scale(x,x,v),r._.scale(m,m,-1),r._.multiply(m,m,x);let w=r.ad.create();r.ad.translate(w,w,m),r.ad.scale(w,w,x),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,c,v)}_computeCameraPosition(i){let c=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-i/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-m[0]*x,v.y/this.worldSize-m[1]*x,i/this.worldSize*this._centerAltitude-m[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){let c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],v=i[2],x=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(x=Math.min((c-m)/v,1)),this._camera.position=r._.scaleAndAdd([],this._camera.position,i,x),this._updateStateFromCamera()}_updateStateFromCamera(){let i=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:v}=this._camera.getPitchBearing(),x=r.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.ab(this._maxPitch)),E=Math.max((i[2]-x)/Math.cos(m),w),S=this._zoomFromMercatorZ(E);r._.scaleAndAdd(i,i,c,E),this._pitch=r.at(m,r.ab(this.minPitch),r.ab(this.maxPitch)),this.angle=r.au(v,-Math.PI,Math.PI),this._setZoom(r.at(S,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.Y(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){let i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let c=0,m=r.aU,v=0,x=1/0;for(;m-c>1e-6&&m>c;){let w=c+.5*(m-c),E=this.tileSize*Math.pow(2,w),S=this.getCameraToCenterDistance(this.projection,w,E),M=this.scaleZoom(S/(i*this.tileSize)),O=Math.abs(w-M);O<x&&(x=O,v=w),w<M?c=w:m=w}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,c){let m=Math.min(i.x,c.x),v=Math.max(i.x,c.x),x=Math.min(i.y,c.y),w=Math.max(i.y,c.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let E=[new r.P(m,x),new r.P(v,w),new r.P(m,w),new r.P(v,x)],S=this.renderWorldCopies?-3:0,M=this.renderWorldCopies?4:1;for(let O of E){let F=this.pointRayIntersection(O);if(F.t<0)return!0;let z=this.rayIntersectionCoordinate(F);if(z.x<S||z.y<0||z.x>M||z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(i,c){let m=r._.length(r._.sub([],this._camera.position,i)),v=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){let i=function([c,m,v],x){let w=[c,m,v,1];r.aA.transformMat4(w,w,x);let E=w[3]=Math.max(w[3],1e-6);return w[0]/=E,w[1]/=E,w[2]/=E,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(i[0],i[1])}{let i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,i))}}getCameraToCenterDistance(i,c=this.zoom,m=this.worldSize){let v=r.aX(i,c,this.width,this.height,1024),x=i.pixelSpaceConversion(this.center.lat,m,v),w=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(w=Pf(1,w,cr(this.pitch>=15?1:this.pitch/15))),w}getWorldToCameraMatrix(){let i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.ad.multiply(i,i,this.globeMatrix),i}getFrustum(i){return r.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}let ri={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},ko=(d,i)=>{if(i>0&&d.terrain&&r.w("Cutoff is currently disabled on terrain"),i<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let c=d.transform,m=Math.max(Math.abs(c._zoom-(d.minCutoffZoom-1)),1),v=c.isLODDisabled(!1)?r.$(60,45,c.pitch):r.$(30,15,c.pitch),x=c._farZ-c._nearZ,w=i*c.height,E=((1-(S=v))*c.cameraToCenterDistance+S*(c._farZ+w))*m;var S;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(E-c._nearZ)/x,(E-w-c._nearZ)/x]}}},Pr={cascadeCount:2,shadowMapResolution:2048};class Rf{constructor(i,c){this.aabb=i,this.lastCascade=c}}class Of{add(i,c){let m=this.receivers[i.key];m!==void 0?(m.aabb.min[0]=Math.min(m.aabb.min[0],c.min[0]),m.aabb.min[1]=Math.min(m.aabb.min[1],c.min[1]),m.aabb.min[2]=Math.min(m.aabb.min[2],c.min[2]),m.aabb.max[0]=Math.max(m.aabb.max[0],c.max[0]),m.aabb.max[1]=Math.max(m.aabb.max[1],c.max[1]),m.aabb.max[2]=Math.max(m.aabb.max[2],c.max[2])):this.receivers[i.key]=new Rf(c,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,c,m){let v=r.b6.fromPoints(i.points),x=0;for(let w in this.receivers){let E=this.receivers[w];if(!E||!v.intersectsAabb(E.aabb))continue;E.aabb.min=v.closestPoint(E.aabb.min),E.aabb.max=v.closestPoint(E.aabb.max);let S=E.aabb.getCorners();for(let M=0;M<m.length;M++){let O=!0;for(let F of S){let z=[F[0]*c,F[1]*c,F[2]];if(r._.transformMat4(z,z,m[M].matrix),z[0]<-1||z[0]>1||z[1]<-1||z[1]>1){O=!1;break}}if(E.lastCascade=M,x=Math.max(x,M),O)break}}return x+1}}class yh{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Of,this._depthMode=new r.ae(i.context.gl.LEQUAL,r.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(Pr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(Pr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,c){let m=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;let v=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||v<=0||(this._shadowLayerCount=m.style.order.reduce(($,G)=>{let H=m.style._mergedLayers[G];return $+(H.hasShadowPass()&&!H.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let x=m.context,w=Pr.shadowMapResolution,E=Pr.shadowMapResolution;if(this._cascades.length===0||Pr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let $=0;$<Pr.cascadeCount;++$){let G=m._shadowMapDebug,H=x.gl,q=x.createFramebuffer(w,E,G,"texture"),J=new r.T(x,{width:w,height:E,data:null},H.DEPTH_COMPONENT);if(q.depthAttachment.set(J.texture),G){let ee=new r.T(x,{width:w,height:E,data:null},H.RGBA);q.colorAttachment.set(ee.texture)}this._cascades.push({framebuffer:q,texture:J,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.aM,scale:0})}}this.shadowDirection=Sc(c);let S=0;if(i.elevation){let $=i.elevation,G=[1e4,-1e4];$.visibleDemTiles.filter(H=>H.dem).forEach(H=>{let q=H.dem.tree;G[0]=Math.min(G[0],q.minimums[0]),G[1]=Math.max(G[1],q.maximums[0])}),G[0]!==1e4&&(S=(G[1]-G[0])*$.exaggeration())}let M=1.5*i.cameraToCenterDistance,O=3*M,F=new Float64Array(16);for(let $=0;$<this._cascades.length;++$){let G=this._cascades[$],H=i.height/50,q=1;Pr.cascadeCount===1?q=O:$===0?q=M:(H=M,q=O);let[J,ee]=Mc(i,this.shadowDirection,H,q,Pr.shadowMapResolution,S);G.scale=i.scale,G.matrix=J,G.boundingSphereRadius=ee,r.ad.invert(F,G.matrix),G.frustum=r.aM.fromInvProjectionMatrix(F,1,0,!0),G.far=q}let z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[z].far,this._cascades[z].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Pr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Pr.shadowMapResolution,this._uniformValues.u_shadowmap_0=ri.ShadowMap0,this._uniformValues.u_shadowmap_1=ri.ShadowMap0+1,this._groundShadowTiles=m.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let V=m.transform.elevation;for(let $ of this._groundShadowTiles){let G={min:0,max:0};if(V){let H=V.getMinMaxForTile($);H&&(G=H)}this.addShadowReceiver($.toUnwrapped(),G.min,G.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,c){if(!this.enabled)return;let m=this.painter,v=m.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(m.transform.getFrustum(0),m.transform.worldSize,this._cascades),v.viewport.set([0,0,Pr.shadowMapResolution,Pr.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){m.currentShadowCascade=x,v.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),v.clear({color:r.C.white,depth:1});for(let w of i.order){let E=i._mergedLayers[w];if(!E.hasShadowPass()||E.isHidden(m.transform.zoom))continue;let S=i.getLayerSourceCache(E),M=S?c[S.id]:void 0;(E.type==="model"||M&&M.length)&&m.renderLayer(m,S,E,M)}}m.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let i=this.painter,c=i.style,m=i.context,v=c.directionalLight,x=c.ambientLight;if(!v||!x)return;let w=[],E=ko(i,i.longestCutoffRange);E.shouldRenderCutoff&&w.push("RENDER_CUTOFF");let S=Lo(c,v,x),M=new r.ae(m.gl.LEQUAL,r.ae.ReadOnly,i.depthRangeFor3D);for(let O of this._groundShadowTiles){let F=O.toUnwrapped(),z=i.isTileAffectedByFog(O),V=i.getOrCreateProgram("groundShadow",{defines:w,overrideFog:z});this.setupShadows(F,V),i.uploadCommonUniforms(m,V,F,null,E);let $={u_matrix:i.transform.calculateProjMatrix(F),u_ground_shadow_factor:S};V.draw(i,m.gl.TRIANGLES,M,r.ag.disabled,r.a.multiply,r.af.disabled,$,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?r.a.unblended:r.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){let c=this.painter.transform,m=c.calculatePosMatrix(i,c.worldSize);return r.ad.multiply(m,this._cascades[this.painter.currentShadowCascade].matrix,m),Float32Array.from(m)}calculateShadowPassMatrixFromMatrix(i){return r.ad.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,c,m,v=0){if(!this.enabled)return;let x=this.painter.transform,w=this.painter.context,E=w.gl,S=this._uniformValues,M=new Float64Array(16),O=x.calculatePosMatrix(i,x.worldSize);for(let F=0;F<this._cascades.length;F++)r.ad.multiply(M,this._cascades[F].matrix,O),S[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),w.activeTexture.set(E.TEXTURE0+ri.ShadowMap0+F),this._cascades[F].texture.bind(E.NEAREST,E.CLAMP_TO_EDGE);if(this.useNormalOffset=!!m,this.useNormalOffset){let F=r.b5(i.canonical),z=2/x.tileSize*r.a3/Pr.shadowMapResolution,V=z*this._cascades[0].boundingSphereRadius,$=z*this._cascades[this._cascades.length-1].boundingSphereRadius,G=(m==="vector-tile"?1:3)/Math.pow(2,v-i.canonical.z-(1-x.zoom+Math.floor(x.zoom)));S.u_shadow_normal_offset=[F,V*G,$*G],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(w,S)}setupShadowsFromMatrix(i,c,m=!1){if(!this.enabled)return;let v=this.painter.context,x=v.gl,w=this._uniformValues,E=new Float64Array(16);for(let S=0;S<Pr.cascadeCount;S++)r.ad.multiply(E,this._cascades[S].matrix,i),w[S===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),v.activeTexture.set(x.TEXTURE0+ri.ShadowMap0+S),this._cascades[S].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);this.useNormalOffset=m,m?(w.u_shadow_normal_offset=[1,5,5],w.u_shadow_bias=[6e-5,.0012,.012]):w.u_shadow_bias=[36e-5,.0012,.012],c.setShadowUniformValues(v,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,c,m,v){if(v[2]>=0)return{};let x=function(S,M,O){let F=O/(1<<S.canonical.z);return new r.b6([S.canonical.x*F+S.wrap*O,S.canonical.y*F+S.wrap*O,0],[(S.canonical.x+1)*F+S.wrap*O,(S.canonical.y+1)*F+S.wrap*O,M])}(i,c,m).getCorners(),w=c/-v[2];v[0]<0?(r._.add(x[0],x[0],[v[0]*w,0,0]),r._.add(x[3],x[3],[v[0]*w,0,0])):v[0]>0&&(r._.add(x[1],x[1],[v[0]*w,0,0]),r._.add(x[2],x[2],[v[0]*w,0,0])),v[1]<0?(r._.add(x[0],x[0],[0,v[1]*w,0]),r._.add(x[1],x[1],[0,v[1]*w,0])):v[1]>0&&(r._.add(x[2],x[2],[0,v[1]*w,0]),r._.add(x[3],x[3],[0,v[1]*w,0]));let E={};return E.vertices=x,E.planes=[sl(x[1],x[0],x[4]),sl(x[2],x[1],x[5]),sl(x[3],x[2],x[6]),sl(x[0],x[3],x[7])],E}addShadowReceiver(i,c,m){this._receivers.add(i,r.b6.fromTileIdAndHeight(i,c,m))}getMaxCascadeForTile(i){let c=this._receivers.get(i);return c&&c.lastCascade?c.lastCascade:0}}function sl(d,i,c){let m=r._.sub([],c,i),v=r._.sub([],d,i),x=r._.cross([],m,v),w=r._.length(x);return w===0?[0,0,1,0]:(r._.scale(x,x,1/w),[x[0],x[1],x[2],-r._.dot(x,i)])}function Sc(d){let i=d.properties.get("direction"),c=r.ac(i.x,i.y,i.z);c[2]=r.at(c[2],0,75);let m=r.b7([c[0],c[1],c[2]]);return r._.fromValues(m.x,m.y,m.z)}function Lo(d,i,c){let m=i.properties.get("color"),v=i.properties.get("intensity"),x=i.properties.get("direction"),w=[x.x,x.y,x.z],E=c.properties.get("color"),S=c.properties.get("intensity"),M=Math.max(r._.dot([0,0,1],w),0),O=[0,0,0];r._.scale(O,E.toRenderColor(d.getLut(i.scope)).toArray01Linear().slice(0,3),S);let F=[0,0,0];return r._.scale(F,m.toRenderColor(d.getLut(c.scope)).toArray01Linear().slice(0,3),M*v),r.b8([O[0]>0?O[0]/(O[0]+F[0]):0,O[1]>0?O[1]/(O[1]+F[1]):0,O[2]>0?O[2]/(O[2]+F[2]):0])}function Mc(d,i,c,m,v,x){let w=d.zoom,E=d.scale,S=d.worldSize,M=1/S,O=d.aspect,F=Math.sqrt(1+O*O)*Math.tan(.5*d.fovX),z=F*F,V=m-c,$=m+c,G,H;z>V/$?(G=m,H=m*F):(G=.5*$*(1+z),H=.5*Math.sqrt(V*V+2*(m*m+c*c)*z+$*$*z*z));let q=d.projection.pixelsPerMeter(d.center.lat,S),J=d._camera.getCameraToWorldMercator(),ee=[0,0,-G*M];r._.transformMat4(ee,ee,J);let te=H*M,ce=d._edgeInsets;if(!(ce.left===0&&ce.top===0&&ce.right===0&&ce.bottom===0||ce.left===ce.right&&ce.top===ce.bottom)){let it=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?q:1),lt=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,c,m);lt[8]=2*-d.centerOffset.x/d.width,lt[9]=2*d.centerOffset.y/d.height;let st=new Float64Array(16);r.ad.mul(st,lt,it);let ze=new Float64Array(16);r.ad.invert(ze,st);let $e=r.aM.fromInvProjectionMatrix(ze,S,w,!0);for(let ot of $e.points){let ft=((le=ot)[0]/=E,le[1]/=E,le[2]=r.ax(le[2],d._center.lat),le);te=Math.max(te,r._.len(r._.subtract([],ee,ft)))}}var le;te*=v/(v-1);let Q=Math.acos(i[2]),ne=Math.atan2(-i[0],-i[1]),re=new Cc;re.position=ee,re.setPitchBearing(Q,ne);let pe=re.getWorldToCamera(S,q),Ee=te*S,se=Math.min(d._mercatorZfromZoom(17)*S*-2,-2*Ee),Ie=re.getCameraToClipOrthographic(-Ee,Ee,-Ee,Ee,se,(Ee+x*q)/i[2]),De=new Float64Array(16);r.ad.multiply(De,Ie,pe);let je=r._.fromValues(Math.floor(1e6*ee[0])/1e6*S,Math.floor(1e6*ee[1])/1e6*S,0),Ue=.5*v,Ne=[0,0,0];r._.transformMat4(Ne,je,De),r._.scale(Ne,Ne,Ue);let ve=[Math.floor(Ne[0]),Math.floor(Ne[1]),Math.floor(Ne[2])],Ae=[0,0,0];r._.sub(Ae,Ne,ve),r._.scale(Ae,Ae,-1/Ue);let ke=new Float64Array(16);return r.ad.identity(ke),r.ad.translate(ke,ke,Ae),r.ad.multiply(De,ke,De),[De,Ee]}function vh(d,i){return d!=null&&i!=null&&!(!d.hasData()||!i.hasData())&&d.demTexture!=null&&i.demTexture!=null&&d.tileID.key!==i.tileID.key}let ra=new class{constructor(){this.operations={}}newMorphing(d,i,c,m,v){if(d in this.operations){let x=this.operations[d];x.to.tileID.key!==c.tileID.key&&(x.queued=c)}else this.operations[d]={startTime:m,phase:0,duration:v,from:i,to:c,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;let i=this.operations[d];return{from:i.from,to:i.to,phase:i.phase}}update(d){for(let i in this.operations){let c=this.operations[i];for(c.phase=(d-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,d)){delete this.operations[i];break}}}_nextOp(d,i){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=i,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Ac={0:null,1:"TERRAIN_VERTEX_MORPHING"};function kf(d,i,c){if(i===0)return 0;let m=i<1&&c===514?.25/i:1;return 6*Math.pow(1.5,22-d)*Math.max(i,1)*m}function Ig(d,i){let c=1<<d.z;return!i&&(d.x===0||d.x===c-1)||d.y===0||d.y===c-1}let xh=d=>({u_matrix:d});function bh(d,i,c,m,v){if(v>0){let x=r.e.now(),w=(x-d.timeAdded)/v,E=i?(x-i.timeAdded)/v:-1,S=c.getSource(),M=m.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),O=!i||Math.abs(i.tileID.overscaledZ-M)>Math.abs(d.tileID.overscaledZ-M),F=O&&d.refreshedUponExpiration?1:r.at(O?w:1-E,0,1);return d.refreshedUponExpiration&&w>=1&&(d.refreshedUponExpiration=!1),i?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class al extends Ec{constructor(i,c,m,v){super(i,c,m,v),this.type="raster-array",this.maxzoom=22,this._options=r.W({type:"raster-array"},c)}triggerRepaint(i){let c=this.map.painter._terrain,m=this.map.style.getSourceCache(this.id);c&&c.enabled&&m&&c._clearRenderCacheForTile(m.id,i.tileID),this.map.triggerRepaint()}loadTile(i,c){let m=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(m,r.R.Tile);i.requestParams=v,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(x,w,E,S)=>{if(delete i.request,i.aborted)return i.state="unloaded",c(null);if(x)return x.code===20?void 0:(i.state="errored",c(x));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:E,expires:S}),i.state="empty",c(null)})}unloadTile(i,c){let m=i.texture;m&&m instanceof r.T?(i.destroy(!0),this.map.painter.saveTileTexture(m)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,c,m){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(c,m,(v,x)=>{if(v)return i.state="errored",this.fire(new r.d(v)),void this.triggerRepaint(i);x&&(i.setTexture(x,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;let c=this.rasterLayers.find(({id:x})=>x===i),m=c&&c.fields,v=m&&m.bands&&m.bands;return v?v[0]:0}getTextureDescriptor(i,c,m){if(!i)return;let v=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let x=null;c instanceof r.bk?x=c.paint.get("raster-array-band"):c instanceof r.bl&&(x=c.paint.get("raster-particle-array-band"));let w=x||this.getInitialBand(v);if(w!=null)if(i.textureDescriptor){if(!i.updateNeeded(v,w)||m)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,v,w)}}let Rr={vector:ph,raster:Ec,"raster-dem":class extends Ec{constructor(d,i,c,m){super(d,i,c,m),this.type="raster-dem",this.maxzoom=22,this._options=r.W({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(d,i){let c=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(v,x){v&&(d.state="errored",i(v)),x&&(d.dem=x,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",i(null))}d.request=r.h(this.map._requestManager.transformRequest(c,r.R.Tile),(function(v,x,w,E){if(delete d.request,d.aborted)d.state="unloaded",i(null);else if(v)d.state="errored",i(v);else if(x){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:w,expires:E});let S=ImageBitmap&&x instanceof ImageBitmap&&r.bi(),M=1-(x.width-r.bj(x.width))/2;M<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));let O=S?x:r.e.getImageData(x,M),F={uid:d.uid,coord:d.tileID,source:this.id,scope:this.scope,rawImageData:O,encoding:this.encoding,padding:M};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",F,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){let i=d.canonical,c=Math.pow(2,i.z),m=(i.x-1+c)%c,v=i.x===0?d.wrap-1:d.wrap,x=(i.x+1+c)%c,w=i.x+1===c?d.wrap+1:d.wrap,E={};return E[new r.aL(d.overscaledZ,v,i.z,m,i.y).key]={backfilled:!1},E[new r.aL(d.overscaledZ,w,i.z,x,i.y).key]={backfilled:!1},i.y>0&&(E[new r.aL(d.overscaledZ,v,i.z,m,i.y-1).key]={backfilled:!1},E[new r.aL(d.overscaledZ,d.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},E[new r.aL(d.overscaledZ,w,i.z,x,i.y-1).key]={backfilled:!1}),i.y+1<c&&(E[new r.aL(d.overscaledZ,v,i.z,m,i.y+1).key]={backfilled:!1},E[new r.aL(d.overscaledZ,d.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},E[new r.aL(d.overscaledZ,w,i.z,x,i.y+1).key]={backfilled:!1}),E}},"raster-array":al,geojson:class extends r.E{constructor(d,i,c,m){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=i.data,this._options=r.W({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;let v=r.a3/this.tileSize;this.workerOptions=r.W({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*v,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*v,extent:r.a3,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:r.a3,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*v,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){return this._options.dynamic?typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection")?this.fire(new r.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"?this._data.features.push(...d.features):this._data=d,this._updateWorkerData(!0),this):this.fire(new r.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(d,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},i),this}getClusterChildren(d,i){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},i),this}getClusterLeaves(d,i,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:i,offset:c},m),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.f("dataloading",{dataType:"source"})),this._loaded=!1;let i=r.W({append:d},this.workerOptions);i.scope=this.scope;let c=this._data;typeof c=="string"?(i.request=this.map._requestManager.transformRequest(r.e.resolveURL(c),r.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(m,v)=>{if(this._loaded=!0,this._pendingLoad=null,m)this.fire(new r.d(m));else{let x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(x.resourceTiming=v.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new r.f("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,i){let c=d.actor?"reloadTile":"loadTile";d.actor=this.actor;let m=this.map.style?this.map.style.getLut(this.scope):null,v=this._partialReload,x={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:m?{image:m.image.clone()}:null,scope:this.scope,pixelRatio:r.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:v};d.request=this.actor.send(c,x,(w,E)=>v&&!E?(d.state="loaded",i(null)):(delete d.request,d.destroy(),d.aborted?i(null):w?i(w):(d.loadVectorData(E,this.map.painter,c==="reloadTile"),i(null))),void 0,c==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,i){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.bm{constructor(d,i,c,m){super(d,i,c,m),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;let d=this.options;this.urls=[];for(let i of d.urls)this.urls.push(this.map._requestManager.transformRequest(i,r.R.Source).url);r.bn(this.urls,(i,c)=>{this._loaded=!0,i?this.fire(new r.d(i)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){let i=this.video.seekable;d<i.start(0)||d>i.end(0)?this.fire(new r.d(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let d=this.map.painter.context,i=d.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(d,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.bm,model:class extends r.E{constructor(d,i,c,m){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){let d=[];for(let i in this._options.models){let c=this._options.models[i],m=r.l(this.map._requestManager.transformRequest(c.uri,r.R.Model).url).then(v=>{if(!v)return;let x=r.c(v),w=new r.M(i,c.position,c.orientation,x);w.computeBoundsAndApplyParent(),this.models.push(w)}).catch(v=>{this.fire(new r.d(new Error(`Could not load model ${i} from ${c.uri}: ${v.message}`)))});d.push(m)}return Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new r.d(new Error(`Could not load models: ${i.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,i){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(d,i,c,m){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(m)}onAdd(d){this.map=d,this.load()}load(d){this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"}));let i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map._worldview;this._tileJSONRequest=Df(this._options,this.map._requestManager,i,c,(m,v)=>{this._tileJSONRequest=null,this._loaded=!0,m?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new r.d(m))):v&&(r.W(this,v),v.bounds&&(this.tileBounds=new Tc(v.bounds,this.minzoom,this.maxzoom)),r.an(v.tiles,this.map._requestManager._customAccessToken),this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))),d&&d(m)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,i){let c=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(c,r.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=i;else{if(d.buckets){let x=Object.values(d.buckets);for(let w of x)w.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",m,v.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",m,v.bind(this),void 0,!0);function v(x,w){return d.aborted?i(null):x&&x.status!==404?i(x):(w&&(w.resourceTiming&&(d.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&d.setExpiryData(w),d.buckets=kt(kt({},d.buckets),w.buckets),w.featureIndex&&(d.latestFeatureIndex=w.featureIndex)),d.state="loaded",void i(null))}}serialize(){return r.W({},this._options)}},canvas:class extends r.bm{constructor(d,i,c,m){super(d,i,c,m),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(x=>typeof x!="number"))||this.fire(new r.d(new r.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.d(new r.V(`sources.${d}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new r.d(new r.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new r.d(new r.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.d(new r.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let i=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof r.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends r.E{constructor(d,i,c,m){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=i,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Tc(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),r.W(this,r.ah(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new r.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){let{x:i,y:c,z:m}=d.canonical;return this._implementation.hasTile({x:i,y:c,z:m})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,i){let{x:c,y:m,z:v}=d.tileID.canonical,x=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:c,y:m,z:v},{signal:x.signal})).then((function(w){return delete d.request,d.aborted?(d.state="unloaded",i(null)):w===void 0?(d.state="errored",i(null)):w===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",i(null)):function(E){return E instanceof ImageData||E instanceof HTMLCanvasElement||E instanceof ImageBitmap||E instanceof HTMLImageElement}(w)?(this.loadTileData(d,w),d.state="loaded",void i(null)):(d.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.code!==20&&(d.state="errored",i(w))}),d.request.cancel=()=>x.abort()}loadTileData(d,i){d.setTexture(i,this._map.painter)}unloadTile(d,i){if(d.texture&&d.texture instanceof r.T?(d.destroy(!0),d.texture&&d.texture instanceof r.T&&this._map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){let{x:c,y:m,z:v}=d.tileID.canonical;this._implementation.unloadTile({x:c,y:m,z:v})}i&&i()}abortTile(d,i){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){let d=r.al(this.id,this.scope);this._map.style.clearSource(d)}_update(){this.fire(new r.f("data",{dataType:"source",sourceDataType:"content"}))}}},wh=function(d,i,c,m){let v=new Rr[i.type](d,i,c,m);if(v.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${v.id}`);return r.bp(["load","abort","unload","serialize","prepare"],v),v};class Lf extends r.bv{constructor(i){let c={type:"raster-dem",maxzoom:i.transform.maxZoom},m=new r.bw(r.bx(),null),v=wh("mock-dem",c,m,i.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,c){i.state="loaded",c(null)}}class Cg extends r.bv{constructor(i){let c=wh("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new r.bw(r.bx(),null),i.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,c,m){if(i.freezeTileCoverage)return;this.transform=i;let v=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,w)=>{if(x[w.key]="",!this._tiles[w.key]){let E=new r.by(w,this._source.tileSize*w.overscaleFactor(),i.tileZoom);E.state="loaded",this._tiles[w.key]=E}return x},{});for(let x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(i){let c=this.proxyCachedFBO[i];if(c!==void 0){let m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ff extends r.aL{constructor(i,c,m){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class Nf extends r.bq{constructor(i,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[m,v,x]=function(S){let M=new r.bt,O=new r.bu,F=131;M.reserve(17161),O.reserve(33800);let z=r.a3/128,V=r.a3+z/2,$=V+z;for(let H=-z;H<$;H+=z)for(let q=-z;q<$;q+=z){let J=q<0||q>V||H<0||H>V?24575:0,ee=r.at(Math.round(q),0,r.a3),te=r.at(Math.round(H),0,r.a3);M.emplaceBack(ee+J,te)}let G=(H,q)=>{let J=q*F+H;O.emplaceBack(J+1,J,J+F),O.emplaceBack(J+F,J+F+1,J+1)};for(let H=1;H<129;H++)for(let q=1;q<129;q++)G(q,H);return[0,129].forEach(H=>{for(let q=0;q<130;q++)G(q,H),G(H,q)}),[M,O,32768]}(),w=i.context;this.gridBuffer=w.createVertexBuffer(m,r.br.members),this.gridIndexBuffer=w.createIndexBuffer(v),this.gridSegments=r.b.simpleSegment(0,0,m.length,v.length),this.gridNoSkirtSegments=r.b.simpleSegment(0,0,m.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Cg(c.map),this.orthoMatrix=r.ad.create(),r.ad.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.a3,0,r.a3,0,1);let E=w.gl;this._overlapStencilMode=new r.ag({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Lf(c.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,c,m){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);let v=i.terrain.properties,x=i.terrain.drapeRenderMode===0,w=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.e.now();let E=i.terrain&&i.terrain.scope,S=v.get("source"),M=x?this._mockSourceCache:i.getSourceCache(S,E);if(!M)return void r.w(`Couldn't find terrain source "${S}".`);if(this.sourceCache=M,this._exaggeration=w?this.calculateExaggeration(c):v.get("exaggeration"),!c.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;let O=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let F=this.getScaledDemTileSize();this.sourceCache.update(c,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,O(),this._initializing=!0),O(),c.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(i){let c=this._previousCameraAltitude,m=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=m;let v=c!=null?m-c:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;let x=i.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(x);let E=x-this._previousZoom,S=this._previousUpdateTimestamp,M=x;this._evaluationZoom!=null&&(M=this._evaluationZoom,Math.abs(x-M)>.5&&(E=.5*(x-M+E)),E*v<0&&(M+=E)),this._evaluationZoom=M;let O=w.getExaggeration(M),F=O===w.getExaggeration(Math.max(0,M-.1));if(F&&Math.abs(O-this._exaggeration)<.01)return O;let z=Math.min(.1,.00375*(this._updateTimestamp-S));return(F||O<.1||Math.abs(E)<1e-4)&&(z=Math.min(.2,4*z)),r.a2(this._exaggeration,O,z)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(r.Y.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let v=this.proxyCoords=c.getIds().map(S=>{let M=c.getTileByID(S).tileID;return M.projMatrix=m.calculateProjMatrix(M.toUnwrapped()),M});(function(S,M){let O=M.transform.pointCoordinate(M.transform.getCameraPoint()),F=new r.P(O.x,O.y);S.sort((z,V)=>{if(V.overscaledZ-z.overscaledZ)return V.overscaledZ-z.overscaledZ;let $=new r.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),G=new r.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),H=F.mult(1<<z.canonical.z);return H.x-=.5,H.y-=.5,H.distSqr($)-H.distSqr(G)})})(v,this.painter);let x=this.proxyToSource||{};this.proxyToSource={},v.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};let w=this._style._mergedSourceCaches;for(let S in w){let M=w[S];if(!M.used||(M!==this.sourceCache&&this.resetTileLookupCache(M.id),this._setupProxiedCoordsForOrtho(M,i[S],x),M.usedForTerrain))continue;let O=i[S];M.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[c.id]=v.map(S=>new Ff(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;let E={};this._visibleDemTiles=[];for(let S of this.proxyCoords){let M=this.terrainTileForTile[S.key];if(!M)continue;let O=M.tileID.key;O in E||(this._visibleDemTiles.push(M),E[O]=O)}}_assignTerrainTiles(i){this._initializing||i.forEach(c=>{if(this.terrainTileForTile[c.key])return;let m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)})}_prepareDEMTextures(){let i=this.painter.context,c=i.gl;for(let m in this.terrainTileForTile){let v=this.terrainTileForTile[m],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(i.activeTexture.set(c.TEXTURE1),Cf(this.painter,v,x))}}_prepareDemTileUniforms(i,c,m,v){if(!c||c.demTexture==null)return!1;let x=i.tileID.canonical,w=Math.pow(2,c.tileID.canonical.z-x.z),E=v||"";return m[`u_dem_tl${E}`]=[x.x*w%1,x.y*w%1],m[`u_dem_scale${E}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let i=this.painter.context,c=i.gl;if(!this._emptyDepthBufferTexture){let m=new r.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.T(i,m,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0,c=this._visibleDemTiles.reduce((m,v)=>{if(!v.dem)return m;let x=v.dem.tree.minimums[0];return x>0&&i++,m+x},0);return i?c/i:0}_updateEmptyDEMTexture(){let i=this.painter.context,c=i.gl;i.activeTexture.set(c.TEXTURE2);let m=this._getLoadedAreaMinimum(),[v,x]=(()=>{let E=new r.bz({width:1,height:1},new Float32Array([m]));return[c.R32F,E]})();this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(x,{premultiply:!1}):w=this._emptyDEMTexture=new r.T(i,x,v,{premultiply:!1}),w}setupElevationDraw(i,c,m){let v=this.painter.context,x=v.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};w.u_exaggeration=this.exaggeration();let E=null,S=null,M=1;if(m&&m.morphing&&this._useVertexMorphing){let V=m.morphing.srcDemTile,$=m.morphing.dstDemTile;M=m.morphing.phase,V&&$&&(this._prepareDemTileUniforms(i,V,w,"_prev")&&(S=V),this._prepareDemTileUniforms(i,$,w)&&(E=$))}let O=V=>V&&V.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST,F=null;var z;if(this.enabled?S&&E?(F=E.demTexture,v.activeTexture.set(x.TEXTURE4),S.demTexture.bind(O(S),x.CLAMP_TO_EDGE),w.u_dem_lerp=M):(E=this.terrainTileForTile[i.tileID.key],F=this._prepareDemTileUniforms(i,E,w)?E.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,v.activeTexture.set(x.TEXTURE2),F&&(w.u_dem_size=(z=F).size[0]===1?1:z.size[0]-2,F.bind(O(E),x.CLAMP_TO_EDGE)),v.activeTexture.set(x.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(w.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),w.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&E){let V=(1<<E.tileID.canonical.z)*r.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=V}if(m&&m.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(v,w),this.painter.transform.projection.name==="globe"){let V=this.globeUniformValues(this.painter.transform,i.tileID.canonical,m&&m.useDenormalizedUpVectorScale);c.setGlobeUniformValues(v,V)}}globeUniformValues(i,c,m){let v=i.projection;return{u_tile_tl_up:v.upVector(c,0,0),u_tile_tr_up:v.upVector(c,r.a3,0),u_tile_br_up:v.upVector(c,r.a3,r.a3),u_tile_bl_up:v.upVector(c,0,r.a3),u_tile_up_scale:m?r.bs(1):v.upVectorScale(c,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){let c=this.painter,m=this.painter.context;i.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,w,E,S){if(v.transform.projection.name==="globe")(function(M,O,F,z,V){let $=M.context,G=$.gl,H,q,J=M.transform,ee=r.ba(M,$,J),te=(Ie,De)=>{if(q===De)return;let je=[Ac[De],"PROJECTION_GLOBE_VIEW"];ee&&je.push("CUSTOM_ANTIALIASING");let Ue=M.isTileAffectedByFog(Ie);H=M.getOrCreateProgram("globeRaster",{defines:je,overrideFog:Ue}),q=De},ce=M.colorModeForRenderPass(),le=new r.ae(G.LEQUAL,r.ae.ReadWrite,M.depthRangeFor3D);ra.update(V);let Q=r.bb(J),ne=[r.aj(J.center.lng),r.ak(J.center.lat)],re=M.globeSharedBuffers,pe=[J.width*r.e.devicePixelRatio,J.height*r.e.devicePixelRatio],Ee=Float32Array.from(J.globeMatrix),se={useDenormalizedUpVectorScale:!0};{let Ie=M.transform,De=kf(Ie.zoom,O.exaggeration(),O.sourceCache._source.tileSize);q=-1;let je=G.TRIANGLES;for(let Ue of z){let Ne=F.getTile(Ue),ve=r.ag.disabled,Ae=O.prevTerrainTileForTile[Ue.key],ke=O.terrainTileForTile[Ue.key];vh(Ae,ke)&&ra.newMorphing(Ue.key,Ae,ke,V,250),$.activeTexture.set(G.TEXTURE0),Ne.texture&&Ne.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let it=ra.getMorphValuesForProxy(Ue.key),lt=it?1:0;it&&r.o(se,{morphing:{srcDemTile:it.from,dstDemTile:it.to,phase:r.b9(it.phase)}});let st=r.bc(Ue.canonical),ze=r.bd(st.getCenter().lat),$e=r.be(Ue.canonical,st,ze,Ie.worldSize/Ie._pixelsPerMercatorPixel),ot=r.bf(r.bg(Ue.canonical)),ft=Tg(Ie.expandedFarZProjMatrix,Ee,Q,ot,r.a1(Ie.zoom),ne,Ie.frustumCorners.TL,Ie.frustumCorners.TR,Ie.frustumCorners.BR,Ie.frustumCorners.BL,Ie.globeCenterInViewSpace,Ie.globeRadius,pe,De,Ie._farZ,$e);if(te(Ue,lt),H&&(O.setupElevationDraw(Ne,H,se),M.uploadCommonUniforms($,H,Ue.toUnwrapped()),re)){let[At,Bt,tn]=re.getGridBuffers(ze,De!==0);H.draw(M,je,le,ve,ce,r.af.backCCW,ft,"globe_raster",At,Bt,tn)}}}if(re&&(M.renderDefaultNorthPole||M.renderDefaultSouthPole)){let Ie=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ee&&Ie.push("CUSTOM_ANTIALIASING"),H=M.getOrCreateProgram("globeRaster",{defines:Ie});for(let De of z){let{x:je,y:Ue,z:Ne}=De.canonical,ve=Ue===0,Ae=Ue===(1<<Ne)-1,[ke,it,lt,st]=re.getPoleBuffers(Ne,!1);if(st&&(ve||Ae)){let ze=F.getTile(De);$.activeTexture.set(G.TEXTURE0),ze.texture&&ze.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let $e=r.bh(Ne,je,J),ot=r.bf(r.bg(De.canonical)),ft=(At,Bt)=>At.draw(M,G.TRIANGLES,le,r.ag.disabled,ce,r.af.disabled,Tg(J.expandedFarZProjMatrix,$e,$e,ot,0,ne,J.frustumCorners.TL,J.frustumCorners.TR,J.frustumCorners.BR,J.frustumCorners.BL,J.globeCenterInViewSpace,J.globeRadius,pe,0,J._farZ),"globe_pole_raster",Bt,lt,st);O.setupElevationDraw(ze,H,se),M.uploadCommonUniforms($,H,De.toUnwrapped()),ve&&M.renderDefaultNorthPole&&ft(H,ke),Ae&&M.renderDefaultSouthPole&&($e=r.ad.scale(r.ad.create(),$e,[1,-1,1]),ft(H,it))}}}})(v,x,w,E,S);else{let M=v.context,O=M.gl,F,z,V=v.shadowRenderer,$=ko(v,v.longestCutoffRange),G=ce=>{if(z===ce)return;let le=[];le.push(Ac[ce]),$.shouldRenderCutoff&&le.push("RENDER_CUTOFF"),F=v.getOrCreateProgram("terrainRaster",{defines:le}),z=ce},H=v.colorModeForRenderPass(),q=new r.ae(O.LEQUAL,r.ae.ReadWrite,v.depthRangeFor3D);ra.update(S);let J=v.transform,ee=kf(J.zoom,x.exaggeration(),x.sourceCache._source.tileSize),te=[0,0,0];if(V){let ce=v.style.directionalLight,le=v.style.ambientLight;ce&&le&&(te=Lo(v.style,ce,le))}{z=-1;let ce=O.TRIANGLES,[le,Q]=[x.gridIndexBuffer,x.gridSegments];for(let ne of E){let re=w.getTile(ne),pe=r.ag.disabled,Ee=x.prevTerrainTileForTile[ne.key],se=x.terrainTileForTile[ne.key];vh(Ee,se)&&ra.newMorphing(ne.key,Ee,se,S,250),M.activeTexture.set(O.TEXTURE0),re.texture&&re.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE);let Ie=ra.getMorphValuesForProxy(ne.key),De=Ie?1:0,je;Ie&&(je={morphing:{srcDemTile:Ie.from,dstDemTile:Ie.to,phase:r.b9(Ie.phase)}});let Ue=at(ne.projMatrix,Ig(ne.canonical,J.renderWorldCopies)?ee/10:ee,te);if(G(De),!F)continue;x.setupElevationDraw(re,F,je);let Ne=ne.toUnwrapped();V&&V.setupShadows(Ne,F),v.uploadCommonUniforms(M,F,Ne,null,$),F.draw(v,ce,q,pe,H,r.af.backCCW,Ue,"terrain_raster",x.gridBuffer,le,Q)}}}}(c,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;let c=this.painter,m=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],w=this._drapedRenderBatches.shift(),E=c.style.order,S=[],M=0;for(let O of x){let F=v.getTileByID(O.proxyTileKey),z=v.proxyCachedFBO[O.key]?v.proxyCachedFBO[O.key][i]:void 0,V=z!==void 0?v.renderCache[z]:this.pool[M++],$=z!==void 0;if(F.texture=V.tex,$&&!V.dirty){S.push(F.tileID);continue}let G;m.bindFramebuffer.set(V.fb.framebuffer),this.renderedToTile=!1,V.dirty&&(m.clear({color:r.C.transparent,stencil:0}),V.dirty=!1);for(let H=w.start;H<=w.end;++H){let q=c.style._mergedLayers[E[H]];if(q.isHidden(c.transform.zoom))continue;let J=c.style.getLayerSourceCache(q),ee=J?this.proxyToSource[O.key][J.id]:[O];if(!ee)continue;let te=ee;m.viewport.set([0,0,V.fb.width,V.fb.height]),G!==(J?J.id:null)&&(this._setupStencil(V,ee,q,J),G=J?J.id:null),c.renderLayer(c,J,q,te)}if(this._drapedRenderBatches.length===0)for(let H of this._pendingGroundEffectLayers){let q=c.style._mergedLayers[E[H]];if(q.isHidden(c.transform.zoom))continue;let J=c.style.getLayerSourceCache(q),ee=J?this.proxyToSource[O.key][J.id]:[O];if(!ee)continue;let te=ee;m.viewport.set([0,0,V.fb.width,V.fb.height]),G!==(J?J.id:null)&&(this._setupStencil(V,ee,q,J),G=J?J.id:null),c.renderLayer(c,J,q,te)}this.renderedToTile?(V.dirty=!0,S.push(F.tileID)):$||--M,M===5&&(M=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),w.end+1}postRender(){}isLayerOrderingCorrect(i){let c=i.order.length,m=-1,v=c;for(let x=0;x<c;++x)this._style.isLayerDraped(i._mergedLayers[i.order[x]])?m=Math.max(m,x):v=Math.min(v,x);return v>m}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{i=Math.min(i,c.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,c,m){if(!this._visibleDemTiles)return null;let v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{let w=x.tileID,E=1<<w.overscaledZ,{x:S,y:M}=w.canonical,O=S/E,F=(S+1)/E,z=M/E,V=(M+1)/E;return{minx:O,miny:z,maxx:F,maxy:V,t:x.dem.tree.raycastRoot(O,z,F,V,i,c,m),tile:x}});v.sort((x,w)=>(x.t!==null?x.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(let x of v){if(x.t==null)return null;let w=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,i,c,m);if(w!=null)return w}return null}_createFBO(){let i=this.painter.context,c=i.gl,m=this.drapeBufferSize;i.activeTexture.set(c.TEXTURE0);let v=new r.T(i,{width:m[0],height:m[1],data:null},c.RGBA);v.bind(c.LINEAR,c.CLAMP_TO_EDGE);let x=i.createFramebuffer(m[0],m[1],!0,null);return x.colorAttachment.set(v.texture),x.depthAttachment=new Ys(i,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{let c=this._style._mergedLayers[i],m=c.isHidden(this.painter.transform.zoom);return c.type==="custom"?!m&&c.shouldRedrape():!m&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(let m of this._style.getSources())if(m instanceof ph){i=!0;break}if(!i)return;let c={};for(let m=0;m<this._style.order.length;++m){let v=this._style._mergedLayers[this._style.order[m]],x=this._style.getLayerSourceCache(v);if(x&&!c[x.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof r.Z){c[x.id]=!0;for(let w of this.proxyCoords){let E=this.proxyToSource[w.key][x.id];if(E)for(let S of E)this._clearRenderCacheForTile(x.id,S)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(let m in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[m]._source instanceof Ec){i=!0;break}if(!i)return;let c={};for(let m=0;m<this._style.order.length;++m){let v=this._style._mergedLayers[this._style.order[m]],x=this._style.getLayerSourceCache(v);if(!x||c[x.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;let w=v.paint.get("raster-fade-duration");for(let E of this.proxyCoords){let S=this.proxyToSource[E.key][x.id];if(S)for(let M of S){let O=bh(x.getTile(M),x.findLoadedParent(M,0),x,this.painter.transform,w);(O.opacity!==1||O.mix!==0)&&this._clearRenderCacheForTile(x.id,M)}}}}_setupDrapedRenderBatches(){let i=this._style.order,c=i.length;if(c===0)return;let m=[];this._pendingGroundEffectLayers=[];let v,x=0,w=this._style._mergedLayers[i[x]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++x<c;)w=this._style._mergedLayers[i[x]];for(;x<c;++x){let E=this._style._mergedLayers[i[x]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?v===void 0&&(v=x):(E.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),v!==void 0&&(m.push({start:v,end:x-1}),v=void 0)))}if(v!==void 0&&m.push({start:v,end:x-1}),m.length!==0){let E=m[m.length-1];this._pendingGroundEffectLayers.every(S=>S>E.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=m}_setupRenderCache(i){let c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){let w=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let E=0;E<w.length;++E){let S=Object.values(w[E]);c.renderCachePool.push(...S)}}return}this._clearRasterLayersFromRenderCache();let m=this.proxyCoords,v=this._tilesDirty;for(let w=m.length-1;w>=0;w--){let E=m[w];if(c.getTileByID(E.key),c.proxyCachedFBO[E.key]!==void 0){let S=i[E.key],M=this.proxyToSource[E.key],O=0;for(let F in M){let z=M[F],V=S[F];if(!V||V.length!==z.length||z.some(($,G)=>$!==V[G]||v[F]&&v[F].hasOwnProperty($.key))){O=-1;break}++O}for(let F in c.proxyCachedFBO[E.key])c.renderCache[c.proxyCachedFBO[E.key][F]].dirty=O<0||O!==Object.values(S).length}}let x=[...this._drapedRenderBatches];x.sort((w,E)=>E.end-E.start-(w.end-w.start));for(let w of x)for(let E of m){if(c.proxyCachedFBO[E.key])continue;let S=c.renderCachePool.pop();S===void 0&&c.renderCache.length<50&&(S=c.renderCache.length,c.renderCache.push(this._createFBO())),S!==void 0&&(c.proxyCachedFBO[E.key]={},c.proxyCachedFBO[E.key][w.start]=S,c.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(i,c,m,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let x=this.painter.context,w=x.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let E;if(m.isTileClipped())E=c.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):r.ag.disabled}_renderTileClippingMasks(i,c){let m=this.painter,v=this.painter.context,x=v.gl;m._tileClippingMaskIDs={},v.setColorMode(r.a.disabled),v.setDepthMode(r.ae.disabled);let w=m.getOrCreateProgram("clippingMask");for(let E of i){let S=m._tileClippingMaskIDs[E.key]=--c;w.draw(m,x.TRIANGLES,r.ae.disabled,new r.ag({func:x.ALWAYS,mask:0},S,255,x.KEEP,x.KEEP,x.REPLACE),r.a.disabled,r.af.disabled,xh(E.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(i){let c=this.painter.transform;if(i.x<0||i.x>c.width||i.y<0||i.y>c.height)return null;let m=[i.x,i.y,1,1];r.aA.transformMat4(m,m,c.pixelMatrixInverse),r.aA.scale(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;let v=c._camera.position,x=r.ax(1,c.center.lat),w=[v[0],v[1],v[2]/x,0],E=r._.subtract([],m.slice(0,3),w);r._.normalize(E,E);let S=this.raycast(w,E,this._exaggeration);return S!==null&&S?(r._.scaleAndAdd(w,w,E,S),w[3]=w[2],w[2]*=x,w):null}drawDepth(){let i=this.painter,c=i.context,m=this.proxySourceCache,v=Math.ceil(i.width),x=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let w=c.gl,E=c.createFramebuffer(v,x,!0,"renderbuffer");c.activeTexture.set(w.TEXTURE0);let S=new r.T(c,{width:v,height:x,data:null},w.RGBA);S.bind(w.NEAREST,w.CLAMP_TO_EDGE),E.colorAttachment.set(S.texture);let M=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,v,x);E.depthAttachment.set(M),this._depthFBO=E,this._depthTexture=S}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,v,x]),function(w,E,S,M){if(w.transform.projection.name==="globe")return;let O=w.context,F=O.gl;O.clear({depth:1});let z=w.getOrCreateProgram("terrainDepth"),V=new r.ae(F.LESS,r.ae.ReadWrite,w.depthRangeFor3D);for(let $ of M){let G=S.getTile($),H=at($.projMatrix,0,[0,0,0]);E.setupElevationDraw(G,z),z.draw(w,F.TRIANGLES,V,r.ag.disabled,r.a.unblended,r.af.backCCW,H,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(i,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,c,m){if(i.getSource()instanceof r.bm)return this._setupProxiedCoordsForImageSource(i,c,m);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};let v=this.proxiedCoords[i.id]=[],x=this.proxyCoords;for(let S=0;S<x.length;S++){let M=x[S],O=this._findTileCoveringTileID(M,i);if(O){let F=this._createProxiedId(M,O,m[M.key]&&m[M.key][i.id]);v.push(F),this.proxyToSource[M.key][i.id]=[F]}}let w=!1,E=new Set;for(let S=0;S<c.length;S++){let M=i.getTile(c[S]);if(!M||!M.hasData())continue;let O=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==M.tileID.canonical.z){let F=this.proxyToSource[O.tileID.key][i.id],z=this._createProxiedId(O.tileID,M,m[O.tileID.key]&&m[O.tileID.key][i.id]);F?F.splice(F.length-1,0,z):this.proxyToSource[O.tileID.key][i.id]=[z];let V=this.proxyToSource[O.tileID.key][i.id];E.has(V)||E.add(V),v.push(z),w=!0}}if(this._sourceTilesOverlap[i.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(let S of E)S.sort((M,O)=>O.overscaledZ-M.overscaledZ)}_setupProxiedCoordsForImageSource(i,c,m){if(!i.getSource().loaded())return;let v=this.proxiedCoords[i.id]=[],x=this.proxyCoords,w=i.getSource(),E=w.tileID;if(!E)return;let S=new r.P(E.x,E.y)._div(1<<E.z),M=w.coordinates.map(r.Y.fromLngLat).reduce((F,z)=>(F.min.x=Math.min(F.min.x,z.x-S.x),F.min.y=Math.min(F.min.y,z.y-S.y),F.max.x=Math.max(F.max.x,z.x-S.x),F.max.y=Math.max(F.max.y,z.y-S.y),F),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(F,z)=>{let V=F.wrap+F.canonical.x/(1<<F.canonical.z),$=F.canonical.y/(1<<F.canonical.z),G=r.a3/(1<<F.canonical.z),H=z.wrap+z.canonical.x/(1<<z.canonical.z),q=z.canonical.y/(1<<z.canonical.z);return V+G<H+M.min.x||V>H+M.max.x||$+G<q+M.min.y||$>q+M.max.y};for(let F=0;F<x.length;F++){let z=x[F];for(let V=0;V<c.length;V++){let $=i.getTile(c[V]);if(!$||!$.hasData()||O(z,$.tileID))continue;let G=this._createProxiedId(z,$,m[z.key]&&m[z.key][i.id]),H=this.proxyToSource[z.key][i.id];H?H.push(G):this.proxyToSource[z.key][i.id]=[G],v.push(G)}}}_createProxiedId(i,c,m){let v=this.orthoMatrix;if(m){let x=m.find(w=>w.key===c.tileID.key);if(x)return x}if(c.tileID.key!==i.key){let x=i.canonical.z-c.tileID.canonical.z,w,E,S;v=r.ad.create();let M=c.tileID.wrap-i.wrap<<i.overscaledZ;x>0?(w=r.a3>>x,E=w*((c.tileID.canonical.x<<x)-i.canonical.x+M),S=w*((c.tileID.canonical.y<<x)-i.canonical.y)):(w=r.a3<<-x,E=r.a3*(c.tileID.canonical.x-(i.canonical.x+M<<-x)),S=r.a3*(c.tileID.canonical.y-(i.canonical.y<<-x))),r.ad.ortho(v,0,w,0,w,0,1),r.ad.translate(v,v,[E,S,0])}return new Ff(c.tileID,i.key,v)}_findTileCoveringTileID(i,c){let m=c.getTile(i);if(m&&m.hasData())return m;let v=this._findCoveringTileCache[c.id],x=v[i.key];if(m=x?c.getTileByID(x):null,m&&m.hasData()||x===null)return m;let w=m?m.tileID:i,E=w.overscaledZ,S=c.getSource().minzoom,M=[];if(!x){let F=c.getSource().maxzoom;if(i.canonical.z>=F){let z=i.canonical.z-F;c.getSource().reparseOverscaled?(E=Math.max(i.canonical.z+2,c.transform.tileZoom),w=new r.aL(E,i.wrap,F,i.canonical.x>>z,i.canonical.y>>z)):z!==0&&(E=F,w=new r.aL(E,i.wrap,F,i.canonical.x>>z,i.canonical.y>>z))}w.key!==i.key&&(M.push(w.key),m=c.getTile(w))}let O=F=>{M.forEach(z=>{v[z]=F}),M.length=0};for(E-=1;E>=S&&(!m||!m.hasData());E--){m&&O(m.tileID.key);let F=w.calculateScaledKey(E);if(m=c.getTileByID(F),m&&m.hasData())break;let z=v[F];if(z===null)break;z===void 0?M.push(F):m=c.getTileByID(z)}return O(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,c){let m=this._tilesDirty[i];m||(m=this._tilesDirty[i]={}),m[c.key]=!0}}function Fo(d,i,c){let m=function(E,S,M){let O=r._.dot(S,E),F=r._.dot(M,[.2126,.7152,.0722]),z=($,G,H)=>(1-H)*$+H*G,V=z(1-.3*Math.min(F,1),1,Math.min(O+1,1));return z(.92,1,Math.asin(r.at(S[2],-1,1))/Math.PI+.5)*V}(d,[0,0,1],i),v=[0,0,0];r._.scale(v,c.slice(0,3),m);let x=[0,0,0];r._.scale(x,i.slice(0,3),d[2]);let w=[0,0,0];return r._.add(w,v,x),r.b8(w)}let Th=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Dg=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Pc{static cacheKey(i,c,m,v){let x=`${c}${v?v.cacheKey:""}`;for(let w of m)i.usedDefines.includes(w)&&(x+=`/${w}`);return x}constructor(i,c,m,v,x,w){let E=i.gl;this.program=E.createProgram(),this.configuration=v,this.name=c,this.fixedDefines=[...w];let S=v?v.getBinderAttributes():[],M=(m.staticAttributes||[]).concat(S),O=v?v.defines():[];O=O.concat(w.map(H=>`#define ${H}`));let F=`#version 300 es
`,z=F+O.concat("precision mediump float;",bg,xg.fragmentSource).join(`
`);for(let H of m.fragmentIncludes)z+=`
${dh[H]}`;z+=`
${m.fragmentSource}`;let V=F+O.concat("precision highp float;",bg,xg.vertexSource).join(`
`);for(let H of m.vertexIncludes)V+=`
${dh[H]}`;V+=`
${m.vertexSource}`;let $=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource($,z),E.compileShader($),E.attachShader(this.program,$);let G=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(G,V),E.compileShader(G),E.attachShader(this.program,G),this.attributes={},this.numAttributes=M.length;for(let H=0;H<this.numAttributes;H++)if(M[H]){let q=M[H].startsWith("a_")?M[H]:`a_${M[H]}`;E.bindAttribLocation(this.program,H,q),this.attributes[q]=H}E.linkProgram(this.program),E.deleteShader(G),E.deleteShader($),this.fixedUniforms=x(i),this.binderUniforms=v?v.getUniforms(i):[],w.includes("TERRAIN")&&(this.terrainUniforms=(H=>({u_dem:new r.a7(H),u_dem_prev:new r.a7(H),u_dem_tl:new r.a8(H),u_dem_scale:new r.aa(H),u_dem_tl_prev:new r.a8(H),u_dem_scale_prev:new r.aa(H),u_dem_size:new r.aa(H),u_dem_lerp:new r.aa(H),u_exaggeration:new r.aa(H),u_depth:new r.a7(H),u_depth_size_inv:new r.a8(H),u_meter_to_dem:new r.aa(H),u_label_plane_matrix_inv:new r.a6(H)}))(i)),w.includes("GLOBE")&&(this.globeUniforms=(H=>({u_tile_tl_up:new r.aq(H),u_tile_tr_up:new r.aq(H),u_tile_br_up:new r.aq(H),u_tile_bl_up:new r.aq(H),u_tile_up_scale:new r.aa(H)}))(i)),w.includes("FOG")&&(this.fogUniforms=(H=>({u_fog_matrix:new r.a6(H),u_fog_range:new r.a8(H),u_fog_color:new r.as(H),u_fog_horizon_blend:new r.aa(H),u_fog_vertical_limit:new r.a8(H),u_fog_temporal_offset:new r.aa(H),u_frustum_tl:new r.aq(H),u_frustum_tr:new r.aq(H),u_frustum_br:new r.aq(H),u_frustum_bl:new r.aq(H),u_globe_pos:new r.aq(H),u_globe_radius:new r.aa(H),u_globe_transition:new r.aa(H),u_is_globe:new r.a7(H),u_viewport:new r.a8(H)}))(i)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(H=>({u_cutoff_params:new r.as(H)}))(i)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(H=>({u_lighting_ambient_color:new r.aq(H),u_lighting_directional_dir:new r.aq(H),u_lighting_directional_color:new r.aq(H),u_ground_radiance:new r.aq(H)}))(i)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(H=>({u_light_matrix_0:new r.a6(H),u_light_matrix_1:new r.a6(H),u_fade_range:new r.a8(H),u_shadow_normal_offset:new r.aq(H),u_shadow_intensity:new r.aa(H),u_shadow_texel_size:new r.aa(H),u_shadow_map_resolution:new r.aa(H),u_shadow_direction:new r.aq(H),u_shadow_bias:new r.aq(H),u_shadowmap_0:new r.a7(H),u_shadowmap_1:new r.a7(H)}))(i))}}setTerrainUniformValues(i,c){if(!this.terrainUniforms)return;let m=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(let v in c)m[v]&&m[v].set(this.program,v,c[v])}}setGlobeUniformValues(i,c){if(!this.globeUniforms)return;let m=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(let v in c)m[v]&&m[v].set(this.program,v,c[v])}}setFogUniformValues(i,c){if(!this.fogUniforms)return;let m=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(let v in c)m[v].set(this.program,v,c[v])}}setCutoffUniformValues(i,c){if(!this.cutoffUniforms)return;let m=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(let v in c)m[v].set(this.program,v,c[v])}}setLightsUniformValues(i,c){if(!this.lightsUniforms)return;let m=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(let v in c)m[v].set(this.program,v,c[v])}}setShadowUniformValues(i,c){if(this.failedToCreate||!this.shadowUniforms)return;let m=this.shadowUniforms;i.program.set(this.program);for(let v in c)m[v].set(this.program,v,c[v])}_drawDebugWireframe(i,c,m,v,x,w,E,S,M,O){let F=i.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;let z=i.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||i._terrain&&i._terrain.renderingToTexture||!Th.includes(this.name))||!(!F.layers3D||!Dg.includes(this.name))))return;let V=z.gl,$=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,x,z);if(!$)return;let G=[...this.fixedDefines];G.push("DEBUG_WIREFRAME");let H=i.getOrCreateProgram(this.name,{config:this.configuration,defines:G});z.program.set(H.program);let q=(te,ce,le)=>{if(ce[te]&&le[te])for(let Q in ce[te])le[te][Q]&&le[te][Q].set(le.program,Q,ce[te][Q].current)};M&&M.setUniforms(H.program,z,H.binderUniforms,E,{zoom:S}),q("fixedUniforms",this,H),q("terrainUniforms",this,H),q("globeUniforms",this,H),q("fogUniforms",this,H),q("lightsUniforms",this,H),q("shadowUniforms",this,H),$.bind(),z.setColorMode(new r.a([V.ONE,V.ONE_MINUS_SRC_ALPHA,V.ZERO,V.ONE],r.C.transparent,[!0,!0,!0,!1])),z.setDepthMode(new r.ae(c.func===V.LESS?V.LEQUAL:c.func,r.ae.ReadOnly,c.range)),z.setStencilMode(r.ag.disabled);let J=3*w.primitiveLength*2,ee=3*w.primitiveOffset*2*2;O&&O>1?V.drawElementsInstanced(V.LINES,J,V.UNSIGNED_SHORT,ee,O):V.drawElements(V.LINES,J,V.UNSIGNED_SHORT,ee),x.bind(),z.program.set(this.program),z.setDepthMode(c),z.setStencilMode(m),z.setColorMode(v)}draw(i,c,m,v,x,w,E,S,M,O,F,z,V,$,G,H){let q=i.context,J=q.gl;if(this.failedToCreate)return;q.program.set(this.program),q.setDepthMode(m),q.setStencilMode(v),q.setColorMode(x),q.setCullFace(w);for(let ce of Object.keys(this.fixedUniforms))this.fixedUniforms[ce].set(this.program,ce,E[ce]);$&&$.setUniforms(this.program,q,this.binderUniforms,z,{zoom:V});let ee={[J.POINTS]:1,[J.LINES]:2,[J.TRIANGLES]:3,[J.LINE_STRIP]:1}[c],te=H&&H>0?1:void 0;for(let ce of F.get()){let le=ce.vaos||(ce.vaos={});(le[S]||(le[S]=new Wv)).bind(q,this,M,$?$.getPaintVertexBuffers():[],O,ce.vertexOffset,G||[],te),H&&H>1?J.drawElementsInstanced(c,ce.primitiveLength*ee,J.UNSIGNED_SHORT,ce.primitiveOffset*ee*2,H):O?J.drawElements(c,ce.primitiveLength*ee,J.UNSIGNED_SHORT,ce.primitiveOffset*ee*2):J.drawArrays(c,ce.vertexOffset,ce.vertexLength),c===J.TRIANGLES&&O&&this._drawDebugWireframe(i,m,v,x,O,ce,z,V,$,H)}}}function Eh(d,i){let c=Math.pow(2,i.tileID.overscaledZ),m=i.tileSize*Math.pow(2,d.transform.tileZoom)/c,v=m*(i.tileID.canonical.x+i.tileID.wrap*c),x=m*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.bB(i,1,d.transform.tileZoom),u_pixel_coord_upper:[v>>16,x>>16],u_pixel_coord_lower:[65535&v,65535&x]}}let Ih=r.ad.create(),ll=(d,i,c,m,v,x,w,E,S,M,O,F,z,V,$,G)=>{let H=i.style.light,q=H.properties.get("position"),J=[q.x,q.y,q.z],ee=r.bC.create();H.properties.get("anchor")==="viewport"&&(r.bC.fromRotation(ee,-i.transform.angle),r._.transformMat3(J,J,ee));let te=H.properties.get("color"),ce=i.transform,le={u_matrix:d,u_lightpos:J,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[te.r,te.g,te.b],u_vertical_gradient:+c,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ih,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:x,u_flood_light_color:F,u_vertical_scale:z,u_flood_light_intensity:V,u_ground_shadow_factor:$,u_emissive_strength:G};return ce.projection.name==="globe"&&(le.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],le.u_zoom_transition=S,le.u_inv_rot_matrix=O,le.u_merc_center=M,le.u_up_dir=ce.projection.upVector(new r.aO(0,0,0),M[0]*r.a3,M[1]*r.a3),le.u_height_lift=E),le},cl=(d,i,c)=>({u_matrix:d,u_edge_radius:i,u_vertical_scale:c}),zf=(d,i,c,m,v,x,w,E,S,M,O,F,z,V)=>{let $=ll(d,i,c,m,v,x,w,S,M,O,F,z,V,1,[0,0,0],0),G={u_height_factor:-Math.pow(2,w.overscaledZ)/E.tileSize/8};return r.W($,Eh(i,E),G)},Bf=(d,i)=>({u_matrix:d,u_emissive_strength:i}),Vf=(d,i,c,m)=>r.W(Bf(d,i),Eh(c,m)),Sg=(d,i,c)=>({u_matrix:d,u_world:c,u_emissive_strength:i}),Ch=(d,i,c,m,v)=>r.W(Vf(d,i,c,m),{u_world:v}),jf=(d,i,c,m)=>{let v=r.a3/c.tileSize;return{u_matrix:d,u_camera_to_center_distance:i.getCameraToCenterDistance(m),u_extrude_scale:[i.pixelsToGLUnits[0]/v,i.pixelsToGLUnits[1]/v]}},Dh=(d,i,c=1)=>({u_matrix:d,u_color:i.toRenderColor(null),u_overlay:0,u_overlay_scale:c}),Rc=r.ad.create(),ia=(d,i,c,m,v,x,w)=>{let E=d.transform,S=E.projection.name==="globe",M=S?r.bD(E.zoom,i.canonical)*E._pixelsPerMercatorPixel:r.bB(c,1,x),O={u_matrix:i.projMatrix,u_extrude_scale:M,u_intensity:w,u_inv_rot_matrix:Rc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){O.u_inv_rot_matrix=m,O.u_merc_center=v,O.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],O.u_zoom_transition=r.a1(E.zoom);let F=v[0]*r.a3,z=v[1]*r.a3;O.u_up_dir=E.projection.upVector(new r.aO(0,0,0),F,z)}return O};function Mg(d,[i,c,m,v],[x,w]){if(x===w)return[0,0,0,0];let E=255*(d-1)/(d*(w-x));return[i*E,c*E,m*E,v*E]}function Uf(d,i,[c,m]){return c===m?0:.5/d+(i-c)*(d-1)/(d*(m-c))}let Oc=(d,i,c,m,v,x,w,E,S,M,O,F,z,V,$,G,H,q,J,ee,te)=>({u_matrix:d,u_normalize_matrix:i,u_globe_matrix:c,u_merc_matrix:m,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:M,u_fade_t:O.mix,u_opacity:O.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:r.bE(F.paint.get("raster-saturation")),u_contrast_factor:r.bF(F.paint.get("raster-contrast")),u_spin_weights:kc(F.paint.get("raster-hue-rotate")),u_perspective_transform:z,u_raster_elevation:V,u_zoom_transition:w,u_merc_center:E,u_cutoff_params:S,u_colorization_mix:Mg(r.bG,G,q),u_colorization_offset:Uf(r.bG,H,q),u_color_ramp:$,u_texture_offset:[ee/(J+2*ee),J/(J+2*ee)],u_texture_res:[J+2*ee,J+2*ee],u_emissive_strength:te});function kc(d){d*=Math.PI/180;let i=Math.sin(d),c=Math.cos(d);return[(2*c+1)/3,(-Math.sqrt(3)*i-c+1)/3,(Math.sqrt(3)*i-c+1)/3]}let ps=.15,$f=(d,i,c,m,v,x,w,E,S,M,O,F)=>({u_matrix:d,u_normalize_matrix:i,u_globe_matrix:c,u_merc_matrix:m,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:M,u_fade_t:O.mix,u_opacity:O.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:w,u_merc_center:E,u_cutoff_params:S}),Gf=(d,i,c,m,v,x,w,E,S,M)=>({u_particle_texture:d,u_particle_texture_side_len:i,u_tile_offset:c,u_velocity:m,u_color_ramp:x,u_velocity_res:v,u_max_speed:w,u_uv_offset:E,u_data_scale:S,u_data_offset:M,u_particle_pos_scale:1.3,u_particle_pos_offset:[ps,ps]}),Kv=(d,i,c,m,v,x,w,E,S,M)=>({u_particle_texture:d,u_particle_texture_side_len:i,u_velocity:c,u_velocity_res:m,u_max_speed:v,u_speed_factor:x,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:E,u_data_scale:S,u_data_offset:M,u_particle_pos_scale:1.3,u_particle_pos_offset:[ps,ps]}),Ki=r.ad.create(),ul=(d,i,c,m,v,x,w,E,S,M,O,F,z,V,$,G,H,q)=>{let J=v.transform,ee={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:J.getCameraToCenterDistance(G),u_rotate_symbol:+c,u_aspect_ratio:J.width/J.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:w,u_coord_matrix:E,u_is_text:+S,u_pitch_with_map:+m,u_texsize:M,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ki,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ki,u_up_vector:[0,-1,0],u_color_adj_mat:H,u_icon_transition:q||0};return G.name==="globe"&&(ee.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],ee.u_zoom_transition=F,ee.u_inv_rot_matrix=V,ee.u_merc_center=z,ee.u_camera_forward=J._camera.forward(),ee.u_ecef_origin=r.bH(J.globeMatrix,O.toUnwrapped()),ee.u_tile_matrix=Float32Array.from(J.globeMatrix),ee.u_up_vector=$),ee},Sh=(d,i,c,m,v,x,w,E,S,M,O,F,z,V,$,G,H)=>r.W(ul(d,i,c,m,v,x,w,E,S,M,F,z,V,$,G,H),{u_gamma_scale:m?v.transform.getCameraToCenterDistance(H)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:r.e.devicePixelRatio,u_is_halo:+O,undefined:void 0}),Ag=(d,i,c,m,v,x,w,E,S,M,O,F,z,V,$,G)=>r.W(Sh(d,i,c,m,v,x,w,E,!0,S,!0,O,F,z,V,$,G),{u_texsize_icon:M,u_texture_icon:1}),Lc=(d,i,c,m)=>({u_matrix:d,u_emissive_strength:i,u_opacity:c,u_color:m}),Pg=(d,i,c,m,v,x,w,E)=>r.W(function(S,M,O,F,z){let{width:V,height:$}=F.imageManager.getPixelSize(M),G=Math.pow(2,z.tileID.overscaledZ),H=z.tileSize*Math.pow(2,F.transform.tileZoom)/G,q=H*(z.tileID.canonical.x+z.tileID.wrap*G),J=H*z.tileID.canonical.y;return{u_image:0,u_pattern_tl:O.tl,u_pattern_br:O.br,u_texsize:[V,$],u_pattern_size:O.displaySize,u_tile_units_to_pixels:1/r.bB(z,1,F.transform.tileZoom),u_pixel_coord_upper:[q>>16,J>>16],u_pixel_coord_lower:[65535&q,65535&J]}}(0,x,w,m,E),{u_matrix:d,u_emissive_strength:i,u_opacity:c}),Hf=new Float32Array(r.ad.identity([])),Fc=(d,i,c,m,v,x,w,E,S,M,O,F,z,V=[0,0,0],$)=>{let G=v.style.light,H=G.properties.get("position"),q=[-H.x,-H.y,H.z],J=r.bC.create();G.properties.get("anchor")==="viewport"&&(r.bC.fromRotation(J,-v.transform.angle),r._.transformMat3(q,q,J));let ee=O.alphaMode==="MASK",te=G.properties.get("color").toRenderColor(null),ce=z.paint.get("model-ambient-occlusion-intensity"),le=z.paint.get("model-color").constantOr(r.C.white).toRenderColor(null),Q=z.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:d,u_lighting_matrix:i,u_normal_matrix:c,u_node_matrix:m||Hf,u_lightpos:q,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[te.r,te.g,te.b],u_camera_pos:V,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+ee,u_alphaCutoff:O.alphaCutoff,u_baseColorFactor:[w.r,w.g,w.b,w.a],u_emissiveFactor:[E[0],E[1],E[2],1],u_metallicFactor:S,u_roughnessFactor:M,u_baseColorTexture:ri.BaseColor,u_metallicRoughnessTexture:ri.MetallicRoughness,u_normalTexture:ri.Normal,u_occlusionTexture:ri.Occlusion,u_emissionTexture:ri.Emission,u_lutTexture:ri.LUT,u_color_mix:[le.r,le.g,le.b,Q],u_aoIntensity:ce,u_emissive_strength:F,u_occlusionTextureTransform:$||[0,0,0,0]}},Rg=(d,i=Hf,c=Hf)=>({u_matrix:d,u_instance:i,u_node_matrix:c}),Og=(d,i,c,m,v)=>({u_matrix:Float32Array.from(d),u_anchorPos:i,u_screenSizePx:c,u_occluderSizePx:m,u_color:v}),Qv={fillExtrusion:d=>({u_matrix:new r.a6(d),u_lightpos:new r.aq(d),u_lightintensity:new r.aa(d),u_lightcolor:new r.aq(d),u_vertical_gradient:new r.aa(d),u_opacity:new r.aa(d),u_edge_radius:new r.aa(d),u_ao:new r.a8(d),u_tile_id:new r.aq(d),u_zoom_transition:new r.aa(d),u_inv_rot_matrix:new r.a6(d),u_merc_center:new r.a8(d),u_up_dir:new r.aq(d),u_height_lift:new r.aa(d),u_flood_light_color:new r.aq(d),u_vertical_scale:new r.aa(d),u_flood_light_intensity:new r.aa(d),u_ground_shadow_factor:new r.aq(d),u_emissive_strength:new r.aa(d)}),fillExtrusionDepth:d=>({u_matrix:new r.a6(d),u_edge_radius:new r.aa(d),u_vertical_scale:new r.aa(d)}),fillExtrusionPattern:d=>({u_matrix:new r.a6(d),u_lightpos:new r.aq(d),u_lightintensity:new r.aa(d),u_lightcolor:new r.aq(d),u_vertical_gradient:new r.aa(d),u_height_factor:new r.aa(d),u_edge_radius:new r.aa(d),u_ao:new r.a8(d),u_tile_id:new r.aq(d),u_zoom_transition:new r.aa(d),u_inv_rot_matrix:new r.a6(d),u_merc_center:new r.a8(d),u_up_dir:new r.aq(d),u_height_lift:new r.aa(d),u_image:new r.a7(d),u_texsize:new r.a8(d),u_pixel_coord_upper:new r.a8(d),u_pixel_coord_lower:new r.a8(d),u_tile_units_to_pixels:new r.aa(d),u_opacity:new r.aa(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new r.a6(d),u_opacity:new r.aa(d),u_ao_pass:new r.aa(d),u_meter_to_tile:new r.aa(d),u_ao:new r.a8(d),u_flood_light_intensity:new r.aa(d),u_flood_light_color:new r.aq(d),u_attenuation:new r.aa(d),u_edge_radius:new r.aa(d),u_fb:new r.a7(d),u_fb_size:new r.aa(d)}),fill:d=>({u_matrix:new r.a6(d),u_emissive_strength:new r.aa(d)}),fillPattern:d=>({u_matrix:new r.a6(d),u_emissive_strength:new r.aa(d),u_image:new r.a7(d),u_texsize:new r.a8(d),u_pixel_coord_upper:new r.a8(d),u_pixel_coord_lower:new r.a8(d),u_tile_units_to_pixels:new r.aa(d)}),fillOutline:d=>({u_matrix:new r.a6(d),u_emissive_strength:new r.aa(d),u_world:new r.a8(d)}),fillOutlinePattern:d=>({u_matrix:new r.a6(d),u_emissive_strength:new r.aa(d),u_world:new r.a8(d),u_image:new r.a7(d),u_texsize:new r.a8(d),u_pixel_coord_upper:new r.a8(d),u_pixel_coord_lower:new r.a8(d),u_tile_units_to_pixels:new r.aa(d)}),circle:r.bI,collisionBox:d=>({u_matrix:new r.a6(d),u_camera_to_center_distance:new r.aa(d),u_extrude_scale:new r.a8(d)}),collisionCircle:d=>({u_matrix:new r.a6(d),u_inv_matrix:new r.a6(d),u_camera_to_center_distance:new r.aa(d),u_viewport_size:new r.a8(d)}),debug:d=>({u_color:new r.a9(d),u_matrix:new r.a6(d),u_overlay:new r.a7(d),u_overlay_scale:new r.aa(d)}),clippingMask:d=>({u_matrix:new r.a6(d)}),heatmap:d=>({u_extrude_scale:new r.aa(d),u_intensity:new r.aa(d),u_matrix:new r.a6(d),u_inv_rot_matrix:new r.a6(d),u_merc_center:new r.a8(d),u_tile_id:new r.aq(d),u_zoom_transition:new r.aa(d),u_up_dir:new r.aq(d)}),heatmapTexture:d=>({u_image:new r.a7(d),u_color_ramp:new r.a7(d),u_opacity:new r.aa(d)}),hillshade:d=>({u_matrix:new r.a6(d),u_image:new r.a7(d),u_latrange:new r.a8(d),u_light:new r.a8(d),u_shadow:new r.a9(d),u_highlight:new r.a9(d),u_emissive_strength:new r.aa(d),u_accent:new r.a9(d)}),hillshadePrepare:d=>({u_matrix:new r.a6(d),u_image:new r.a7(d),u_dimension:new r.a8(d),u_zoom:new r.aa(d)}),line:r.bJ,linePattern:r.bK,raster:d=>({u_matrix:new r.a6(d),u_normalize_matrix:new r.a6(d),u_globe_matrix:new r.a6(d),u_merc_matrix:new r.a6(d),u_grid_matrix:new r.ar(d),u_tl_parent:new r.a8(d),u_scale_parent:new r.aa(d),u_fade_t:new r.aa(d),u_opacity:new r.aa(d),u_image0:new r.a7(d),u_image1:new r.a7(d),u_brightness_low:new r.aa(d),u_brightness_high:new r.aa(d),u_saturation_factor:new r.aa(d),u_contrast_factor:new r.aa(d),u_spin_weights:new r.aq(d),u_perspective_transform:new r.a8(d),u_raster_elevation:new r.aa(d),u_zoom_transition:new r.aa(d),u_merc_center:new r.a8(d),u_cutoff_params:new r.as(d),u_colorization_mix:new r.as(d),u_colorization_offset:new r.aa(d),u_color_ramp:new r.a7(d),u_texture_offset:new r.a8(d),u_texture_res:new r.a8(d),u_emissive_strength:new r.aa(d)}),rasterParticle:d=>({u_matrix:new r.a6(d),u_normalize_matrix:new r.a6(d),u_globe_matrix:new r.a6(d),u_merc_matrix:new r.a6(d),u_grid_matrix:new r.ar(d),u_tl_parent:new r.a8(d),u_scale_parent:new r.aa(d),u_fade_t:new r.aa(d),u_opacity:new r.aa(d),u_image0:new r.a7(d),u_image1:new r.a7(d),u_raster_elevation:new r.aa(d),u_zoom_transition:new r.aa(d),u_merc_center:new r.a8(d),u_cutoff_params:new r.as(d)}),rasterParticleTexture:d=>({u_texture:new r.a7(d),u_opacity:new r.aa(d)}),rasterParticleDraw:d=>({u_particle_texture:new r.a7(d),u_particle_texture_side_len:new r.aa(d),u_tile_offset:new r.a8(d),u_velocity:new r.a7(d),u_color_ramp:new r.a7(d),u_velocity_res:new r.a8(d),u_max_speed:new r.aa(d),u_uv_offset:new r.a8(d),u_data_scale:new r.as(d),u_data_offset:new r.aa(d),u_particle_pos_scale:new r.aa(d),u_particle_pos_offset:new r.a8(d)}),rasterParticleUpdate:d=>({u_particle_texture:new r.a7(d),u_particle_texture_side_len:new r.aa(d),u_velocity:new r.a7(d),u_velocity_res:new r.a8(d),u_max_speed:new r.aa(d),u_speed_factor:new r.aa(d),u_reset_rate:new r.aa(d),u_rand_seed:new r.aa(d),u_uv_offset:new r.a8(d),u_data_scale:new r.as(d),u_data_offset:new r.aa(d),u_particle_pos_scale:new r.aa(d),u_particle_pos_offset:new r.a8(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new r.a7(d),u_is_size_feature_constant:new r.a7(d),u_size_t:new r.aa(d),u_size:new r.aa(d),u_camera_to_center_distance:new r.aa(d),u_rotate_symbol:new r.a7(d),u_aspect_ratio:new r.aa(d),u_fade_change:new r.aa(d),u_matrix:new r.a6(d),u_label_plane_matrix:new r.a6(d),u_coord_matrix:new r.a6(d),u_is_text:new r.a7(d),u_pitch_with_map:new r.a7(d),u_texsize:new r.a8(d),u_tile_id:new r.aq(d),u_zoom_transition:new r.aa(d),u_inv_rot_matrix:new r.a6(d),u_merc_center:new r.a8(d),u_camera_forward:new r.aq(d),u_tile_matrix:new r.a6(d),u_up_vector:new r.aq(d),u_ecef_origin:new r.aq(d),u_texture:new r.a7(d),u_icon_transition:new r.aa(d),u_color_adj_mat:new r.a6(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new r.a7(d),u_is_size_feature_constant:new r.a7(d),u_size_t:new r.aa(d),u_size:new r.aa(d),u_camera_to_center_distance:new r.aa(d),u_rotate_symbol:new r.a7(d),u_aspect_ratio:new r.aa(d),u_fade_change:new r.aa(d),u_matrix:new r.a6(d),u_label_plane_matrix:new r.a6(d),u_coord_matrix:new r.a6(d),u_is_text:new r.a7(d),u_pitch_with_map:new r.a7(d),u_texsize:new r.a8(d),u_texture:new r.a7(d),u_gamma_scale:new r.aa(d),u_device_pixel_ratio:new r.aa(d),u_tile_id:new r.aq(d),u_zoom_transition:new r.aa(d),u_inv_rot_matrix:new r.a6(d),u_merc_center:new r.a8(d),u_camera_forward:new r.aq(d),u_tile_matrix:new r.a6(d),u_up_vector:new r.aq(d),u_ecef_origin:new r.aq(d),u_is_halo:new r.a7(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new r.a7(d),u_is_size_feature_constant:new r.a7(d),u_size_t:new r.aa(d),u_size:new r.aa(d),u_camera_to_center_distance:new r.aa(d),u_rotate_symbol:new r.a7(d),u_aspect_ratio:new r.aa(d),u_fade_change:new r.aa(d),u_matrix:new r.a6(d),u_label_plane_matrix:new r.a6(d),u_coord_matrix:new r.a6(d),u_is_text:new r.a7(d),u_pitch_with_map:new r.a7(d),u_texsize:new r.a8(d),u_texsize_icon:new r.a8(d),u_texture:new r.a7(d),u_texture_icon:new r.a7(d),u_gamma_scale:new r.aa(d),u_device_pixel_ratio:new r.aa(d),u_is_halo:new r.a7(d)}),background:d=>({u_matrix:new r.a6(d),u_emissive_strength:new r.aa(d),u_opacity:new r.aa(d),u_color:new r.a9(d)}),backgroundPattern:d=>({u_matrix:new r.a6(d),u_emissive_strength:new r.aa(d),u_opacity:new r.aa(d),u_image:new r.a7(d),u_pattern_tl:new r.a8(d),u_pattern_br:new r.a8(d),u_texsize:new r.a8(d),u_pattern_size:new r.a8(d),u_pixel_coord_upper:new r.a8(d),u_pixel_coord_lower:new r.a8(d),u_tile_units_to_pixels:new r.aa(d)}),terrainRaster:Js,terrainDepth:Js,skybox:d=>({u_matrix:new r.a6(d),u_sun_direction:new r.aq(d),u_cubemap:new r.a7(d),u_opacity:new r.aa(d),u_temporal_offset:new r.aa(d)}),skyboxGradient:d=>({u_matrix:new r.a6(d),u_color_ramp:new r.a7(d),u_center_direction:new r.aq(d),u_radius:new r.aa(d),u_opacity:new r.aa(d),u_temporal_offset:new r.aa(d)}),skyboxCapture:d=>({u_matrix_3f:new r.ar(d),u_sun_direction:new r.aq(d),u_sun_intensity:new r.aa(d),u_color_tint_r:new r.as(d),u_color_tint_m:new r.as(d),u_luminance:new r.aa(d)}),globeRaster:d=>({u_proj_matrix:new r.a6(d),u_globe_matrix:new r.a6(d),u_normalize_matrix:new r.a6(d),u_merc_matrix:new r.a6(d),u_zoom_transition:new r.aa(d),u_merc_center:new r.a8(d),u_image0:new r.a7(d),u_grid_matrix:new r.ar(d),u_skirt_height:new r.aa(d),u_far_z_cutoff:new r.aa(d),u_frustum_tl:new r.aq(d),u_frustum_tr:new r.aq(d),u_frustum_br:new r.aq(d),u_frustum_bl:new r.aq(d),u_globe_pos:new r.aq(d),u_globe_radius:new r.aa(d),u_viewport:new r.a8(d)}),globeAtmosphere:d=>({u_frustum_tl:new r.aq(d),u_frustum_tr:new r.aq(d),u_frustum_br:new r.aq(d),u_frustum_bl:new r.aq(d),u_horizon:new r.aa(d),u_transition:new r.aa(d),u_fadeout_range:new r.aa(d),u_color:new r.as(d),u_high_color:new r.as(d),u_space_color:new r.as(d),u_temporal_offset:new r.aa(d),u_horizon_angle:new r.aa(d)}),model:d=>({u_matrix:new r.a6(d),u_lighting_matrix:new r.a6(d),u_normal_matrix:new r.a6(d),u_node_matrix:new r.a6(d),u_lightpos:new r.aq(d),u_lightintensity:new r.aa(d),u_lightcolor:new r.aq(d),u_camera_pos:new r.aq(d),u_opacity:new r.aa(d),u_baseColorFactor:new r.as(d),u_emissiveFactor:new r.as(d),u_metallicFactor:new r.aa(d),u_roughnessFactor:new r.aa(d),u_baseTextureIsAlpha:new r.a7(d),u_alphaMask:new r.a7(d),u_alphaCutoff:new r.aa(d),u_baseColorTexture:new r.a7(d),u_metallicRoughnessTexture:new r.a7(d),u_normalTexture:new r.a7(d),u_occlusionTexture:new r.a7(d),u_emissionTexture:new r.a7(d),u_lutTexture:new r.a7(d),u_color_mix:new r.as(d),u_aoIntensity:new r.aa(d),u_emissive_strength:new r.aa(d),u_occlusionTextureTransform:new r.as(d)}),modelDepth:d=>({u_matrix:new r.a6(d),u_instance:new r.a6(d),u_node_matrix:new r.a6(d)}),groundShadow:d=>({u_matrix:new r.a6(d),u_ground_shadow_factor:new r.aq(d)}),stars:d=>({u_matrix:new r.a6(d),u_up:new r.aq(d),u_right:new r.aq(d),u_intensity_multiplier:new r.aa(d)}),occlusion:d=>({u_matrix:new r.a6(d),u_anchorPos:new r.aq(d),u_screenSizePx:new r.a8(d),u_occluderSizePx:new r.a8(d),u_color:new r.as(d)})};function Mh(d,i,c){let m=i.createTileMatrix(d,d.worldSize,c.toUnwrapped());return r.ad.multiply(new Float32Array(16),d.projMatrix,m)}function Jv(d,i,c){if(i.projection.name===c.projection.name)return d.projMatrix;let m=c.clone();return m.setProjection(i.projection),Mh(m,i.getProjection(),d)}function hl(d,i,c){return i.name===c.projection.name?d.projMatrix:Mh(c,i,d)}let Ah;function Nc(d,i,c,m,v,x,w){let E=d.context,S=E.gl,M=d.transform,O=d.getOrCreateProgram("collisionBox"),F=[],z=0,V=0;for(let te=0;te<m.length;te++){let ce=m[te],le=i.getTile(ce),Q=le.getBucket(c);if(!Q)continue;let ne=Jv(ce,Q,M),re=ne;v[0]===0&&v[1]===0||(re=d.translatePosMatrix(ne,le,v,x));let pe=w?Q.textCollisionBox:Q.iconCollisionBox,Ee=Q.collisionCircleArray;if(Ee.length>0){let se=r.ad.create(),Ie=re;r.ad.mul(se,Q.placementInvProjMatrix,M.glCoordMatrix),r.ad.mul(se,se,Q.placementViewportMatrix),F.push({circleArray:Ee,circleOffset:V,transform:Ie,invTransform:se,projection:Q.getProjection()}),z+=Ee.length/4,V=z}pe&&(d.terrain&&d.terrain.setupElevationDraw(le,O),O.draw(d,S.LINES,r.ae.disabled,r.ag.disabled,d.colorModeForRenderPass(),r.af.disabled,jf(re,M,le,Q.getProjection()),c.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,null,M.zoom,null,[pe.collisionVertexBuffer,pe.collisionVertexBufferExt]))}if(!w||!F.length)return;let $=d.getOrCreateProgram("collisionCircle"),G=new r.bL;G.resize(4*z),G._trim();let H=0;for(let te of F)for(let ce=0;ce<te.circleArray.length/4;ce++){let le=4*ce,Q=te.circleArray[le+0],ne=te.circleArray[le+1],re=te.circleArray[le+2],pe=te.circleArray[le+3];G.emplace(H++,Q,ne,re,pe,0),G.emplace(H++,Q,ne,re,pe,1),G.emplace(H++,Q,ne,re,pe,2),G.emplace(H++,Q,ne,re,pe,3)}(!Ah||Ah.length<2*z)&&(Ah=function(te){let ce=2*te,le=new r.bu;le.resize(ce),le._trim();for(let Q=0;Q<ce;Q++){let ne=6*Q;le.uint16[ne+0]=4*Q+0,le.uint16[ne+1]=4*Q+1,le.uint16[ne+2]=4*Q+2,le.uint16[ne+3]=4*Q+2,le.uint16[ne+4]=4*Q+3,le.uint16[ne+5]=4*Q+0}return le}(z));let q=E.createIndexBuffer(Ah,!0),J=E.createVertexBuffer(G,r.bM.members,!0);for(let te of F){let ce={u_matrix:te.transform,u_inv_matrix:te.invTransform,u_camera_to_center_distance:(ee=M).getCameraToCenterDistance(te.projection),u_viewport_size:[ee.width,ee.height]};$.draw(d,S.TRIANGLES,r.ae.disabled,r.ag.disabled,d.colorModeForRenderPass(),r.af.disabled,ce,c.id,J,q,r.b.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,M.zoom)}var ee;J.destroy(),q.destroy()}let oa=r.ad.create();function kg(d){let i=d._camera.getWorldToCamera(d.worldSize,1),c=r.ad.multiply([],i,d.globeMatrix);r.ad.invert(c,c);let m=[0,0,0],v=[0,1,0,0];return r.aA.transformMat4(v,v,c),m[0]=v[0],m[1]=v[1],m[2]=v[2],r._.normalize(m,m),m}function ex({width:d,height:i,anchor:c,textOffset:m,textScale:v},x){let{horizontalAlign:w,verticalAlign:E}=r.bQ(c),S=-(w-.5)*d,M=-(E-.5)*i,O=r.bP(c,m);return new r.P((S/v+O[0])*x,(M/v+O[1])*x)}function Lg(d,i,c,m,v,x,w,E,S,M,O){let F=d.text.placedSymbolArray,z=d.text.dynamicLayoutVertexArray,V=d.icon.dynamicLayoutVertexArray,$={},G=d.getProjection(),H=hl(E,G,x),q=x.elevation,J=G.upVectorScale(E.canonical,x.center.lat,x.worldSize).metersToTile;z.clear();for(let ee=0;ee<F.length;ee++){let te=F.get(ee),{tileAnchorX:ce,tileAnchorY:le,numGlyphs:Q}=te,ne=te.hidden||!te.crossTileID||d.allowVerticalPlacement&&!te.placedOrientation?null:m[te.crossTileID];if(ne){let re=0,pe=0,Ee=0;if(q){let ke=q?q.getAtTileOffset(E,ce,le):0,[it,lt,st]=G.upVector(E.canonical,ce,le);re=ke*it*J,pe=ke*lt*J,Ee=ke*st*J}let[se,Ie,De,je]=Li(te.projectedAnchorX+re,te.projectedAnchorY+pe,te.projectedAnchorZ+Ee,c?H:w),Ue=Wr(x.getCameraToCenterDistance(G),je),Ne=v.evaluateSizeForFeature(d.textSizeData,M,te)*Ue/r.bN;c&&(Ne*=d.tilePixelRatio/S);let ve=ex(ne,Ne);c?({x:se,y:Ie,z:De}=G.projectTilePoint(ce+ve.x,le+ve.y,E.canonical),[se,Ie,De]=Li(se+re,Ie+pe,De+Ee,w)):(i&&ve._rotate(-x.angle),se+=ve.x,Ie+=ve.y,De=0);let Ae=d.allowVerticalPlacement&&te.placedOrientation===r.aE.vertical?Math.PI/2:0;for(let ke=0;ke<Q;ke++)r.aH(z,se,Ie,De,Ae);O&&te.associatedIconIndex>=0&&($[te.associatedIconIndex]={x:se,y:Ie,z:De,angle:Ae})}else na(Q,z)}if(O){V.clear();let ee=d.icon.placedSymbolArray;for(let te=0;te<ee.length;te++){let ce=ee.get(te),{numGlyphs:le}=ce,Q=$[te];if(ce.hidden||!Q)na(le,V);else{let{x:ne,y:re,z:pe,angle:Ee}=Q;for(let se=0;se<le;se++)r.aH(V,ne,re,pe,Ee)}}d.icon.dynamicLayoutVertexBuffer.updateData(V)}d.text.dynamicLayoutVertexBuffer.updateData(z)}function qf(d,i,c,m,v,x,w={}){let E=c.paint.get("icon-translate"),S=c.paint.get("text-translate"),M=c.paint.get("icon-translate-anchor"),O=c.paint.get("text-translate-anchor"),F=c.layout.get("icon-rotation-alignment"),z=c.layout.get("text-rotation-alignment"),V=c.layout.get("icon-pitch-alignment"),$=c.layout.get("text-pitch-alignment"),G=c.layout.get("icon-keep-upright"),H=c.layout.get("text-keep-upright"),q=c.paint.get("icon-color-saturation"),J=c.paint.get("icon-color-contrast"),ee=c.paint.get("icon-color-brightness-min"),te=c.paint.get("icon-color-brightness-max"),ce=c.paint.get("icon-occlusion-opacity").constantOr(0),le=c.paint.get("text-occlusion-opacity").constantOr(0),Q=d.context,ne=Q.gl,re=d.transform,pe=F==="map",Ee=z==="map",se=V==="map",Ie=$==="map",De=ce!==1||le!==1,je=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ue=!1,Ne=d.depthModeForSublayer(0,r.ae.ReadOnly),ve=[r.aj(re.center.lng),r.ak(re.center.lat)],Ae=c.layout.get("text-variable-anchor"),ke=re.projection.name==="globe",it=[],lt=[0,-1,0];for(let st of m){let ze=i.getTile(st),$e=ze.getBucket(c);if(!$e||$e.projection.name==="mercator"&&ke||$e.fullyClipped)continue;let ot=$e.projection.name==="globe",ft=ot?r.a1(re.zoom):0,At=hl(st,$e.getProjection(),re),Bt=re.calculatePixelsToTileUnitsMatrix(ze),tn=Ae&&$e.hasTextData(),Kt=$e.hasIconTextFit()&&tn&&$e.hasIconData(),In=$e.getProjection().createInversionMatrix(re,st.canonical),Lt=()=>{let nn=pe&&c.layout.get("symbol-placement")!=="point",Fe=[];De&&d.symbolParams.useOcclusionQueries&&!ot&&!ke&&Fe.push("OCCLUSION_QUERIES");let ut=nn||Kt,vr=c.paint.get("icon-image-cross-fade").constantOr(0);d.terrainRenderModeElevated()&&se&&Fe.push("PITCH_WITH_MAP_TERRAIN"),ot&&(Fe.push("PROJECTION_GLOBE_VIEW"),ut&&Fe.push("PROJECTED_POS_ON_VIEWPORT")),vr>0&&Fe.push("ICON_TRANSITION"),$e.icon.zOffsetVertexBuffer&&Fe.push("Z_OFFSET"),q===0&&J===0&&ee===0&&te===1||Fe.push("COLOR_ADJUSTMENT");let Cn=$e.icon.programConfigurations.get(c.id),Te=d.getOrCreateProgram($e.sdfIcons?"symbolSDF":"symbolIcon",{config:Cn,defines:Fe}),fi,Yr=ze.imageAtlasTexture?ze.imageAtlasTexture.size:[0,0],Tr=$e.iconSizeData,oi=r.aD(Tr,re.zoom),vi=se||re.pitch!==0,zi=ea(At,ze.tileID.canonical,se,pe,re,$e.getProjection(),Bt),Ci=il(At,ze.tileID.canonical,se,pe,re,$e.getProjection(),Bt),ws=d.translatePosMatrix(Ci,ze,E,M,!0),Ts=d.translatePosMatrix(At,ze,E,M),Bo=ut?oa:zi,Eo=pe&&!se&&!nn,Vo=lt;!ke&&!re.mercatorFromTransition||pe||(Vo=kg(re));let El=ot?Vo:lt;if($e.sdfIcons&&!$e.iconsInText)fi=Sh(Tr.kind,oi,Eo,se,d,Ts,Bo,ws,!1,Yr,!0,st,ft,ve,In,El,$e.getProjection());else{let ga=c.getColorAdjustmentMatrix(q,J,ee,te);fi=ul(Tr.kind,oi,Eo,se,d,Ts,Bo,ws,!1,Yr,st,ft,ve,In,El,$e.getProjection(),ga,vr)}let su=ze.imageAtlasTexture?ze.imageAtlasTexture:null,Il=c.layout.get("icon-size").constantOr(0)!==1||$e.iconsNeedLinear,Cl=$e.sdfIcons||d.options.rotating||d.options.zooming||Il||vi?ne.LINEAR:ne.NEAREST,Kh=$e.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,Qh=d.terrain&&se&&nn?r.ad.invert(r.ad.create(),zi):oa;if(nn&&$e.icon){let ga=re.elevation,Xr=ga?ga.getAtTileOffsetFunc(st,re.center.lat,re.worldSize,$e.getProjection()):null,Ep=ta(At,ze.tileID.canonical,se,pe,re,$e.getProjection(),Bt);mh($e,At,d,!1,Ep,Ci,se,G,Xr,st)}return{program:Te,buffers:$e.icon,uniformValues:fi,atlasTexture:su,atlasTextureIcon:null,atlasInterpolation:Cl,atlasInterpolationIcon:null,isSDF:$e.sdfIcons,hasHalo:Kh,tile:ze,labelPlaneMatrixInv:Qh}},bn=()=>{let nn=Ee&&c.layout.get("symbol-placement")!=="point",Fe=[],ut=nn||Ae||Kt;De&&d.symbolParams.useOcclusionQueries&&!ot&&!ke&&Fe.push("OCCLUSION_QUERIES"),d.terrainRenderModeElevated()&&Ie&&Fe.push("PITCH_WITH_MAP_TERRAIN"),ot&&(Fe.push("PROJECTION_GLOBE_VIEW"),ut&&Fe.push("PROJECTED_POS_ON_VIEWPORT")),$e.text.zOffsetVertexBuffer&&Fe.push("Z_OFFSET");let vr=$e.text.programConfigurations.get(c.id),Cn=d.getOrCreateProgram($e.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:vr,defines:Fe}),Te,fi=[0,0],Yr=null,Tr=$e.textSizeData;$e.iconsInText&&(fi=ze.imageAtlasTexture?ze.imageAtlasTexture.size:[0,0],Yr=ze.imageAtlasTexture?ze.imageAtlasTexture:null,Te=Ie||re.pitch!==0||d.options.rotating||d.options.zooming||Tr.kind==="composite"||Tr.kind==="camera"?ne.LINEAR:ne.NEAREST);let oi=ze.glyphAtlasTexture?ze.glyphAtlasTexture.size:[0,0],vi=r.aD(Tr,re.zoom),zi=ea(At,ze.tileID.canonical,Ie,Ee,re,$e.getProjection(),Bt),Ci=il(At,ze.tileID.canonical,Ie,Ee,re,$e.getProjection(),Bt),ws=d.translatePosMatrix(Ci,ze,S,O,!0),Ts=d.translatePosMatrix(At,ze,S,O),Bo=ut?oa:zi,Eo=Ee&&!Ie&&!nn,Vo=lt;!ke&&!re.mercatorFromTransition||Ee||(Vo=kg(re));let El=ot?Vo:lt,su;su=$e.iconsInText?Ag(Tr.kind,vi,Eo,Ie,d,Ts,Bo,ws,oi,fi,st,ft,ve,In,El,$e.getProjection()):Sh(Tr.kind,vi,Eo,Ie,d,Ts,Bo,ws,!0,oi,!0,st,ft,ve,In,El,$e.getProjection());let Il=ze.glyphAtlasTexture?ze.glyphAtlasTexture:null,Cl=ne.LINEAR,Kh=c.paint.get("text-halo-width").constantOr(1)!==0,Qh=d.terrain&&Ie&&nn?r.ad.invert(r.ad.create(),zi):oa;if(nn&&$e.text){let ga=re.elevation,Xr=ga?ga.getAtTileOffsetFunc(st,re.center.lat,re.worldSize,$e.getProjection()):null,Ep=ta(At,ze.tileID.canonical,Ie,Ee,re,$e.getProjection(),Bt);mh($e,At,d,!0,Ep,Ci,Ie,H,Xr,st)}return{program:Cn,buffers:$e.text,uniformValues:su,atlasTexture:Il,atlasTextureIcon:Yr,atlasInterpolation:Cl,atlasInterpolationIcon:Te,isSDF:!0,hasHalo:Kh,tile:ze,labelPlaneMatrixInv:Qh}},kn=$e.icon.segments.get().length,Dn=$e.text.segments.get().length,Zt=kn&&!w.onlyText?Lt():null,Ft=Dn&&!w.onlyIcons?bn():null,Vn=c.paint.get("icon-opacity").constantOr(1),$n=c.paint.get("text-opacity").constantOr(1);if(je&&$e.canOverlap){Ue=!0;let nn=Vn&&!w.onlyText?$e.icon.segments.get():[],Fe=$n&&!w.onlyIcons?$e.text.segments.get():[];for(let ut of nn)it.push({segments:new r.b([ut]),sortKey:ut.sortKey,state:Zt});for(let ut of Fe)it.push({segments:new r.b([ut]),sortKey:ut.sortKey,state:Ft})}else w.onlyText||it.push({segments:Vn?$e.icon.segments:new r.b([]),sortKey:0,state:Zt}),w.onlyIcons||it.push({segments:$n?$e.text.segments:new r.b([]),sortKey:0,state:Ft})}Ue&&it.sort((st,ze)=>st.sortKey-ze.sortKey);for(let st of it){let ze=st.state;if(ze)if(d.terrain&&d.terrain.setupElevationDraw(ze.tile,ze.program,{useDepthForOcclusion:!1,labelPlaneMatrixInv:ze.labelPlaneMatrixInv}),Q.activeTexture.set(ne.TEXTURE0),ze.atlasTexture&&ze.atlasTexture.bind(ze.atlasInterpolation,ne.CLAMP_TO_EDGE,!0),ze.atlasTextureIcon&&(Q.activeTexture.set(ne.TEXTURE1),ze.atlasTextureIcon&&ze.atlasTextureIcon.bind(ze.atlasInterpolationIcon,ne.CLAMP_TO_EDGE,!0)),d.uploadCommonLightUniforms(d.context,ze.program),ze.hasHalo){let $e=ze.uniformValues;$e.u_is_halo=1,dl(ze.buffers,st.segments,c,d,ze.program,Ne,v,x,$e,2),$e.u_is_halo=0}else{if(ze.isSDF){let $e=ze.uniformValues;ze.hasHalo&&($e.u_is_halo=1,dl(ze.buffers,st.segments,c,d,ze.program,Ne,v,x,$e,1)),$e.u_is_halo=0}dl(ze.buffers,st.segments,c,d,ze.program,Ne,v,x,ze.uniformValues,1)}}}function dl(d,i,c,m,v,x,w,E,S,M){let O=m.context.gl,F=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer];d.occlusionQueryOpacityVertexBuffer.length>0&&F.push(d.occlusionQueryOpacityVertexBuffer),v.draw(m,O.TRIANGLES,x,w,E,r.af.disabled,S,c.id,d.layoutVertexBuffer,d.indexBuffer,i,c.paint,m.transform.zoom,d.programConfigurations.get(c.id),F,M)}function Wf(d,i,c,m,v,x,w){let E=d.context.gl,S=c.paint.get("fill-pattern"),M=S&&S.constantOr(1),O,F,z,V,$;w?(F=M&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=E.LINES):(F=M?"fillPattern":"fill",O=E.TRIANGLES);for(let G of m){let H=i.getTile(G);if(M&&!H.patternsLoaded())continue;let q=H.getBucket(c);if(!q)continue;d.prepareDrawTile();let J=q.programConfigurations.get(c.id),ee=d.isTileAffectedByFog(G),te=d.getOrCreateProgram(F,{config:J,overrideFog:ee});M&&(d.context.activeTexture.set(E.TEXTURE0),H.imageAtlasTexture&&H.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),J.updatePaintBuffers());let ce=S.constantOr(null);if(ce&&H.imageAtlas){let ne=H.imageAtlas.patternPositions[ce.toString()];ne&&J.setConstantPatternPositions(ne)}let le=d.translatePosMatrix(G.projMatrix,H,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),Q=c.paint.get("fill-emissive-strength");if(w){V=q.indexBuffer2,$=q.segments2;let ne=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];z=F==="fillOutlinePattern"&&M?Ch(le,Q,d,H,ne):Sg(le,Q,ne)}else V=q.indexBuffer,$=q.segments,z=M?Vf(le,Q,d,H):Bf(le,Q);d.uploadCommonUniforms(d.context,te,G.toUnwrapped()),te.draw(d,O,v,d.stencilModeForClipping(G),x,r.af.disabled,z,c.id,q.layoutVertexBuffer,V,$,c.paint,d.transform.zoom,J,void 0)}}function fl(d,i,c,m,v,x,w,E){c.resetLayerRenderingStats(d);let S=d.context,M=S.gl,O=d.transform,F=c.paint.get("fill-extrusion-pattern"),z=F.constantOr(1),V=c.paint.get("fill-extrusion-opacity"),$=d.style.enable3dLights(),G=c.paint.get($&&!z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),H=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),G],q=c.layout.get("fill-extrusion-edge-radius"),J=q>0&&!c.paint.get("fill-extrusion-rounded-roof"),ee=J?0:q,te=O.projection.name==="globe"?r.bY():0,ce=O.projection.name==="globe",le=ce?r.a1(O.zoom):0,Q=[r.aj(O.center.lng),r.ak(O.center.lat)],ne=c.paint.get("fill-extrusion-flood-light-color").toRenderColor(c.lut).toArray01().slice(0,3),re=c.paint.get("fill-extrusion-flood-light-intensity"),pe=c.paint.get("fill-extrusion-vertical-scale"),Ee=ko(d,c.paint.get("fill-extrusion-cutoff-fade-range")),se=c.paint.get("fill-extrusion-emissive-strength"),Ie=[],De;ce&&Ie.push("PROJECTION_GLOBE_VIEW"),H[0]>0&&Ie.push("FAUX_AO"),J&&Ie.push("ZERO_ROOF_RADIUS"),E&&Ie.push("HAS_CENTROID"),re>0&&Ie.push("FLOOD_LIGHT"),Ee.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF");let je=d.renderPass==="shadow",Ue=d.shadowRenderer,Ne=je&&!!Ue;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let ve=[0,0,0];if(Ue){let it=d.style.directionalLight,lt=d.style.ambientLight;it&&lt&&(ve=Lo(d.style,it,lt)),De=Ie.concat(["SHADOWS_SINGLE_CASCADE"])}let Ae=Ne?"fillExtrusionDepth":z?"fillExtrusionPattern":"fillExtrusion",ke=c.getLayerRenderingStats();for(let it of m){let lt=i.getTile(it),st=lt.getBucket(c);if(!st||st.projection.name!==O.projection.name)continue;let ze=!1;Ue&&(ze=Ue.getMaxCascadeForTile(it.toUnwrapped())===0);let $e=d.isTileAffectedByFog(it),ot=st.programConfigurations.get(c.id),ft=d.getOrCreateProgram(Ae,{config:ot,defines:ze?De:Ie,overrideFog:$e});if(d.terrain&&d.terrain.setupElevationDraw(lt,ft,{useMeterToDem:!0}),!st.centroidVertexBuffer){let Lt=ft.attributes.a_centroid_pos;Lt!==void 0&&M.vertexAttrib2f(Lt,0,0)}!je&&Ue&&Ue.setupShadows(lt.tileID.toUnwrapped(),ft,"vector-tile",lt.tileID.overscaledZ),z&&(d.context.activeTexture.set(M.TEXTURE0),lt.imageAtlasTexture&&lt.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ot.updatePaintBuffers());let At=F.constantOr(null);if(At&&lt.imageAtlas){let Lt=lt.imageAtlas.patternPositions[At.toString()];Lt&&ot.setConstantPatternPositions(Lt)}let Bt=c.paint.get("fill-extrusion-vertical-gradient"),tn;if(je&&Ue){if(Zf(lt.tileID,st,d))continue;let Lt=Ue.calculateShadowPassMatrixFromTile(lt.tileID.toUnwrapped());tn=cl(Lt,ee,pe)}else{let Lt=d.translatePosMatrix(it.expandedProjMatrix,lt,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),bn=O.projection.createInversionMatrix(O,it.canonical);tn=z?zf(Lt,d,Bt,V,H,ee,it,lt,te,le,Q,bn,ne,pe):ll(Lt,d,Bt,V,H,ee,it,te,le,Q,bn,ne,pe,re,ve,se)}d.uploadCommonUniforms(S,ft,it.toUnwrapped(),null,Ee);let Kt=st.segments;if(O.projection.name==="mercator"&&!je&&(Kt=st.getVisibleSegments(lt.tileID,d.terrain,d.transform.getFrustum(0)),!Kt.get().length))continue;if(ke)if(je)for(let Lt of Kt.get())ke.numRenderedVerticesInShadowPass+=Lt.primitiveLength;else for(let Lt of Kt.get())ke.numRenderedVerticesInTransparentPass+=Lt.primitiveLength;let In=[];(d.terrain||E)&&In.push(st.centroidVertexBuffer),ce&&In.push(st.layoutVertexExtBuffer),ft.draw(d,S.gl.TRIANGLES,v,x,w,r.af.backCCW,tn,c.id,st.layoutVertexBuffer,st.indexBuffer,Kt,c.paint,d.transform.zoom,ot,In)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}function ci(d,i,c,m,v,x,w,E,S,M,O,F,z,V,$,G,H,q,J){let ee=d.context,te=ee.gl,ce=d.transform,le=d.transform.zoom,Q=[],ne=ko(d,c.paint.get("fill-extrusion-cutoff-fade-range"));M==="clear"?(Q.push("CLEAR_SUBPASS"),J&&(Q.push("CLEAR_FROM_TEXTURE"),ee.activeTexture.set(te.TEXTURE0),J.bind(te.LINEAR,te.CLAMP_TO_EDGE))):M==="sdf"&&Q.push("SDF_SUBPASS"),H&&Q.push("HAS_CENTROID"),ne.shouldRenderCutoff&&Q.push("RENDER_CUTOFF");let re=c.layout.get("fill-extrusion-edge-radius"),pe=(Ee,se,Ie,De,je)=>{let Ue=se.programConfigurations.get(c.id),Ne=d.isTileAffectedByFog(Ee),ve=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ue,defines:Q,overrideFog:Ne}),Ae=((it,lt,st,ze,$e,ot,ft,At,Bt,tn,Kt)=>({u_matrix:lt,u_opacity:st,u_ao_pass:ze?1:0,u_meter_to_tile:$e,u_ao:ot,u_flood_light_intensity:ft,u_flood_light_color:At,u_attenuation:Bt,u_edge_radius:tn,u_fb:0,u_fb_size:Kt}))(0,De,O,S,je,[F,z*je],V,$,G,le>=17?0:re*je,J?J.size[0]:0),ke=[];H&&ke.push(se.hiddenByLandmarkVertexBuffer),d.uploadCommonUniforms(ee,ve,Ee.toUnwrapped(),null,ne),ve.draw(d,ee.gl.TRIANGLES,v,x,w,E,Ae,c.id,se.vertexBuffer,se.indexBuffer,Ie,c.paint,le,Ue,ke)};for(let Ee of m){let se=i.getTile(Ee),Ie=se.getBucket(c);if(!Ie||Ie.projection.name!==ce.projection.name||!Ie.groundEffect||Ie.groundEffect&&!Ie.groundEffect.hasData())continue;let De=Ie.groundEffect,je=1/Ie.tileToMeter;{let Ue=d.translatePosMatrix(Ee.projMatrix,se,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Ne=De.getDefaultSegment();pe(Ee,De,Ne,Ue,je)}if(q)for(let Ue=0;Ue<4;Ue++){let Ne=r.bZ[Ue](Ee),ve=i.getTile(Ne);if(!ve)continue;let Ae=ve.getBucket(c);if(!Ae||Ae.projection.name!==ce.projection.name||!Ae.groundEffect||Ae.groundEffect&&!Ae.groundEffect.hasData())continue;let ke=Ae.groundEffect,it,lt;Ue===0?(it=[-r.a3,0,0],lt=1):Ue===1?(it=[r.a3,0,0],lt=0):Ue===2?(it=[0,-r.a3,0],lt=3):(it=[0,r.a3,0],lt=2);let st=ke.regionSegments[lt];if(!st)continue;let ze=new Float32Array(16);r.ad.translate(ze,Ee.projMatrix,it),pe(Ee,ke,st,d.translatePosMatrix(ze,se,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),je)}}}function Ph(d,i,c,m,v,x,w){m.centroidVertexArray.length===0&&m.createCentroidsBuffer();let E=x?x.findDEMTileFor(c):null;if(!(E&&E.dem||w))return;let S=q=>new r.P(Math.ceil((q+r.c0)*r.c1),0),M=q=>{let J=i.getSource().minzoom,ee=ce=>{let le=i.getTileByID(ce);if(le&&le.hasData())return le.getBucket(v)},te=[0,-1,1];for(let ce of te){if(q.overscaledZ+ce<J)continue;let le=ee(q.calculateScaledKey(q.overscaledZ+ce));if(le)return le}},O=[0,0,0],F=(q,J)=>(O[0]=Math.min(q.min.y,J.min.y),O[1]=Math.max(q.max.y,J.max.y),O[2]=r.a3-J.min.x>q.max.x?J.min.x-r.a3:q.max.x,O),z=(q,J)=>(O[0]=Math.min(q.min.x,J.min.x),O[1]=Math.max(q.max.x,J.max.x),O[2]=r.a3-J.min.y>q.max.y?J.min.y-r.a3:q.max.y,O),V=[(q,J)=>F(q,J),(q,J)=>F(J,q),(q,J)=>z(q,J),(q,J)=>z(J,q)],$=(q,J,ee,te,ce,le,Q)=>{if(!x)return 0;let ne=[[le?ee:q,le?q:ee,0],[le?ee:J,le?J:ee,0]],re=Q<0?r.a3+Q:Q,pe=[le?re:(q+J)/2,le?(q+J)/2:re,0];return ee===0&&Q<0||ee!==0&&Q>0?x.getForTilePoints(ce,[pe],!0,te):ne.push(pe),x.getForTilePoints(c,ne,!0,E),Math.max(ne[0][2],ne[1][2],pe[2])/x.exaggeration()};for(let q=0;q<4;q++){let J=m.borderFeatureIndices[q];if(J.length===0)continue;let ee=r.bZ[q](c),te=M(ee);if(!(te&&te instanceof r.b_)||m.borderDoneWithNeighborZ[q]===te.canonical.z)continue;te.centroidVertexArray.length===0&&te.createCentroidsBuffer();let ce=x?x.findDEMTileFor(ee):null;if(!(ce&&ce.dem||w))continue;let le=(q<2?1:5)-q,Q=te.borderDoneWithNeighborZ[le]!==m.canonical.z,ne=te.borderFeatureIndices[le],re=0;if(m.canonical.z!==te.canonical.z){for(let pe of J)m.showCentroid(m.featuresOnBorder[pe]);if(Q)for(let pe of ne)te.showCentroid(te.featuresOnBorder[pe]);m.borderDoneWithNeighborZ[q]=te.canonical.z,te.borderDoneWithNeighborZ[le]=m.canonical.z}for(let pe of J){let Ee=m.featuresOnBorder[pe],se=m.centroidData[Ee.centroidDataIndex],Ie=Ee.borders[q],De;for(;re<ne.length;){De=te.featuresOnBorder[ne[re]];let je=De.borders[le];if(je[1]>Ie[0]+3||je[0]>Ie[0]-3)break;te.showCentroid(De),re++}if(De&&re<ne.length){let je=re,Ue=0;for(;!(De.borders[le][0]>Ie[1]-3)&&(Ue++,++re!==ne.length);)De=te.featuresOnBorder[ne[re]];if(De=te.featuresOnBorder[ne[je]],Ue>1){let Ae=De.borders[le];Math.abs(Ie[0]-Ae[0])<3&&Math.abs(Ie[1]-Ae[1])<3&&(Ue=1,re=je+1)}else if(Ue===0){m.showCentroid(Ee);continue}let Ne=te.centroidData[De.centroidDataIndex];w&&Ue===1&&(((G=se).flags|(H=Ne).flags)&r.b$?(G.flags|=r.b$,H.flags|=r.b$):(G.flags&=~r.b$,H.flags&=~r.b$));let ve=Ee.intersectsCount()>1||De.intersectsCount()>1;if(Ue>1)re=je,se.centroidXY=Ne.centroidXY=new r.P(0,0);else if(ce&&ce.dem&&!ve){let Ae=V[q](se,Ne),ke=q%2?r.a3-1:0,it=$(Ae[0],Math.min(r.a3-1,Ae[1]),ke,ce,ee,q<2,Ae[2]);se.centroidXY=Ne.centroidXY=S(it)}else ve?se.centroidXY=Ne.centroidXY=new r.P(0,0):(se.centroidXY=m.encodeBorderCentroid(Ee),Ne.centroidXY=te.encodeBorderCentroid(De));m.writeCentroidToBuffer(se),te.writeCentroidToBuffer(Ne)}else m.showCentroid(Ee)}m.borderDoneWithNeighborZ[q]=te.canonical.z,te.borderDoneWithNeighborZ[le]=m.canonical.z}var G,H;(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(d)}let sa=[1,0,0],Fg=[0,1,0],Rh=[0,0,1];function Zf(d,i,c){let m=c.transform,v=c.shadowRenderer;if(!v)return!0;let x=d.toUnwrapped(),w=m.tileSize*v._cascades[c.currentShadowCascade].scale,E=i.maxHeight;if(m.elevation){let G=m.elevation.getMinMaxForTile(d);G&&(E+=G.max)}let S=[...v.shadowDirection];S[2]=-S[2];let M=v.computeSimplifiedTileShadowVolume(x,E,w,S);if(!M)return!1;let O=[sa,Fg,Rh,S,[S[0],0,S[2]],[0,S[1],S[2]]],F=m.projection.name==="globe",z=m.scaleZoom(w),V=r.aM.fromInvProjectionMatrix(m.invProjMatrix,m.worldSize,z,!F),$=v.getCurrentCascadeFrustum();return V.intersectsPrecise(M.vertices,M.planes,O)===0||$.intersectsPrecise(M.vertices,M.planes,O)===0}function zc(d){return[d[0]*r.c2,d[1]*r.c2,d[2]*r.c2,0]}function Bc(d,i,c,m,v,x,w,E,S){let M=m.getSource(),O=c.globeSharedBuffers;if(!O)return;let F,z,V;if(i&&(F=m.getTile(i)),M instanceof r.bm?(z=M.texture,V=r.bh(0,0,c.transform)):F&&i&&(z=F.texture,V=r.bh(i.canonical.z,i.canonical.x,c.transform)),!z||!V)return;d||(V=r.ad.scale(r.ad.create(),V,[1,-1,1]));let $=c.context,G=$.gl,H=v.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR,q=c.colorModeForDrapableLayerRenderPass(x),J=w.defines;J.push("GLOBE_POLES");let ee=new r.ae(G.LEQUAL,r.ae.ReadWrite,c.depthRangeFor3D),te=Float32Array.from(c.transform.expandedFarZProjMatrix),ce=Float32Array.from(r.bf(r.bg(new r.aO(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),$.activeTexture.set(G.TEXTURE0),z.bind(H,G.CLAMP_TO_EDGE),$.activeTexture.set(G.TEXTURE1),z.bind(H,G.CLAMP_TO_EDGE),z.useMipmap&&$.extTextureFilterAnisotropic&&c.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);let[le,Q,ne,re]=i?O.getPoleBuffers(i.canonical.z,!1):O.getPoleBuffers(0,!0),pe=v.paint.get("raster-elevation"),Ee;d?(Ee=le,c.renderDefaultNorthPole=pe!==0):(Ee=Q,c.renderDefaultSouthPole=pe!==0);let se=zc(w.mix),Ie=((je,Ue,Ne,ve,Ae,ke,it,lt,st,ze,$e,ot,ft)=>Oc(je,Ue,Ne,new Float32Array(16),new Float32Array(9),[0,0],ve,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ke,[0,0],lt,2,ze,$e,ot,1,0,ft))(te,ce,V,r.a1(c.transform.zoom),0,v,0,pe,0,se,w.offset,w.range,x),De=c.getOrCreateProgram("raster",{defines:J});c.uploadCommonUniforms($,De,null),De.draw(c,G.TRIANGLES,ee,S,q,E,Ie,v.id,Ee,ne,re)}function pn(d){let i=d._nearZ,c=d.projection.farthestPixelDistance(d),m=c-i,v=.2*d.height,x=i+v;return[i,c,(x-v-i)/m,(x-i)/m]}function tx(d,i,c,m){if(d)return i instanceof al&&d instanceof r.c3?i.getTextureDescriptor(d,c,!0):{texture:d.texture,mix:zc(m.mix),offset:m.offset,buffer:0,tileSize:1}}function bt(d,i,c){if(!d)return null;let m=i.getTextureDescriptor(d,c,!0);if(!m)return null;let{texture:v,mix:x,offset:w,tileSize:E,buffer:S,format:M}=m;if(!v||!M)return null;let O=!1;return M==="uint32"&&(O=!0,x[3]=0,x=Mg(r.c4,x,[0,c.paint.get("raster-particle-max-speed")]),w=Uf(r.c4,w,[0,c.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[S/(E+2*S),E/(E+2*S)],tileSize:E,scalarData:O,scale:x,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[M]]}}function Ng(d){let i=d._nearZ,c=d.projection.farthestPixelDistance(d),m=c-i,v=.2*d.height,x=i+v;return[i,c,(x-v-i)/m,(x-i)/m]}let Oh=new r.C(1,0,0,1),Yf=new r.C(0,1,0,1),bo=new r.C(0,0,1,1),Xf=new r.C(1,0,1,1),pl=new r.C(0,1,1,1);function dt(d,i,c,m,v,x,w){let E=d.context,S=d.transform,M=E.gl,O=S.projection.name==="globe",F=O?["PROJECTION_GLOBE_VIEW"]:[],z=r.ad.clone(c.projMatrix);if(O&&r.a1(S.zoom)>0){let se=r.c5(c.canonical,S),Ie=r.c6(se);z=r.ad.multiply(new Float32Array(16),S.globeMatrix,Ie),r.ad.multiply(z,S.projMatrix,z)}let V=r.ad.create();V[12]+=2*v/(r.e.devicePixelRatio*S.width),V[13]+=2*x/(r.e.devicePixelRatio*S.height),r.ad.multiply(z,V,z);let $=d.getOrCreateProgram("debug",{defines:F}),G=i.getTileByID(c.key);d.terrain&&d.terrain.setupElevationDraw(G,$);let H=r.ae.disabled,q=r.ag.disabled,J=d.colorModeForRenderPass(),ee="$debug";E.activeTexture.set(M.TEXTURE0),d.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),O?G._makeGlobeTileDebugBuffers(d.context,S):G._makeDebugTileBoundsBuffers(d.context,S.projection);let te=G._tileDebugBuffer||d.debugBuffer,ce=G._tileDebugIndexBuffer||d.debugIndexBuffer,le=G._tileDebugSegments||d.debugSegments;if($.draw(d,M.LINE_STRIP,H,q,J,r.af.disabled,Dh(z,m),ee,te,ce,le,null,null,null,[G._globeTileDebugBorderBuffer]),w){let se=G.latestRawTileData,Ie=Math.floor((se&&se.byteLength||0)/1024),De=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(De+=` => ${c.overscaledZ}`),De+=` ${G.state}`,De+=` ${Ie}kb`,function(je,Ue){je.initDebugOverlayCanvas();let Ne=je.debugOverlayCanvas,ve=je.context.gl,Ae=je.debugOverlayCanvas.getContext("2d");Ae.clearRect(0,0,Ne.width,Ne.height),Ae.shadowColor="white",Ae.shadowBlur=2,Ae.lineWidth=1.5,Ae.strokeStyle="white",Ae.textBaseline="top",Ae.font="bold 36px Open Sans, sans-serif",Ae.fillText(Ue,5,5),Ae.strokeText(Ue,5,5),je.debugOverlayTexture.update(Ne),je.debugOverlayTexture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE)}(d,De)}let Q=i.getTile(c).tileSize,ne=512/Math.min(Q,512)*(c.overscaledZ/S.zoom)*.5,re=G._tileDebugTextBuffer||d.debugBuffer,pe=G._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Ee=G._tileDebugTextSegments||d.debugSegments;$.draw(d,M.TRIANGLES,H,q,r.a.alphaBlended,r.af.disabled,Dh(z,r.C.transparent,ne),ee,re,pe,Ee,null,null,null,[G._globeTileDebugTextBuffer])}function mn(d,i,c,m){ui(d,0,i+c/2,d.transform.width,c,m)}function gn(d,i,c,m){ui(d,i-c/2,0,c,d.transform.height,m)}function ui(d,i,c,m,v,x){let w=d.context,E=w.gl;E.enable(E.SCISSOR_TEST),E.scissor(i*r.e.devicePixelRatio,c*r.e.devicePixelRatio,m*r.e.devicePixelRatio,v*r.e.devicePixelRatio),w.clear({color:x}),E.disable(E.SCISSOR_TEST)}let ml=r.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ln}=ml;function Qi(d,i,c,m){d.emplaceBack(i,c,m)}class gl{constructor(i){this.vertexArray=new r.c8,this.indices=new r.bu,Qi(this.vertexArray,-1,-1,1),Qi(this.vertexArray,1,-1,1),Qi(this.vertexArray,-1,1,1),Qi(this.vertexArray,1,1,1),Qi(this.vertexArray,-1,-1,-1),Qi(this.vertexArray,1,-1,-1),Qi(this.vertexArray,-1,1,-1),Qi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,ln),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=r.b.simpleSegment(0,0,36,12)}}function wo(d,i,c,m,v,x){let w=d.context.gl,E=i.paint.get("sky-atmosphere-color"),S=i.paint.get("sky-atmosphere-halo-color"),M=i.paint.get("sky-atmosphere-sun-intensity"),O=((F,z,V,$,G)=>({u_matrix_3f:F,u_sun_direction:z,u_sun_intensity:V,u_color_tint_r:[$.r,$.g,$.b,$.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(r.bC.fromMat4(r.bC.create(),m),v,M,E,S);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+x,i.skyboxTexture,0),c.draw(d,w.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.frontCW,O,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}let yi=r.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ur{constructor(i){let c=new r.c9;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);let m=new r.bu;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(c,yi.members),this.indexBuffer=i.createIndexBuffer(m),this.segments=r.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let nx=r.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Vc{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Kf{constructor(i){this.colorModeAlphaBlendedWriteRGB=new r.a([r.ca,r.cb,r.ca,r.cb],r.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new r.a([r.ca,r.cc,r.ca,r.cc],r.C.transparent,[!1,!1,!1,!0]),this.params=new Vc,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){let c=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ur(c);let m=this.params.sizeRange,v=this.params.intensityRange,x=function(O){let F=r.cf(30),z=[];for(let V=0;V<O;++V){let $=2*Math.PI*F(),G=Math.acos(1-2*F())-.5*Math.PI;z.push(r._.fromValues(Math.cos(G)*Math.cos($),Math.cos(G)*Math.sin($),Math.sin(G)))}return z}(this.params.starsCount),w=r.cf(300),E=new r.cd,S=new r.bu,M=0;for(let O=0;O<x.length;++O){let F=r._.scale([],x[O],200),z=Math.max(0,1+.01*m*(1*w()-.5)),V=Math.max(0,1+.01*v*(1*w()-.5));E.emplaceBack(F[0],F[1],F[2],-1,-1,z,V),E.emplaceBack(F[0],F[1],F[2],1,-1,z,V),E.emplaceBack(F[0],F[1],F[2],1,1,z,V),E.emplaceBack(F[0],F[1],F[2],-1,1,z,V),S.emplaceBack(M+0,M+1,M+2),S.emplaceBack(M+0,M+2,M+3),M+=4}this.starsVx=c.createVertexBuffer(E,nx.members),this.starsIdx=c.createIndexBuffer(S),this.starsSegments=r.b.simpleSegment(0,0,E.length,S.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,c){let m=i.context,v=m.gl,x=i.transform,w=new r.ae(v.LEQUAL,r.ae.ReadOnly,[0,1]),E=r.a1(x.zoom),S=i.style.getLut(c.scope),M=c.properties.get("color").toRenderColor(S).toArray01(),O=c.properties.get("high-color").toRenderColor(S).toArray01(),F=c.properties.get("space-color").toRenderColor(S).toArray01PremultipliedAlpha(),z=5e-4,V=r.ce(c.properties.get("horizon-blend"),0,1,z,.25),$=r.ba(i,m,x)&&V===z?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,G=i.frameCounter/1e3%1,H=r._.length(x.globeCenterInViewSpace),q=Math.sqrt(Math.pow(H,2)-Math.pow($,2)),J=Math.acos(q/H),ee=te=>{let ce=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];te&&ce.push("ALPHA_PASS");let le=i.getOrCreateProgram("globeAtmosphere",{defines:ce}),Q=((re,pe,Ee,se,Ie,De,je,Ue,Ne,ve,Ae,ke)=>({u_frustum_tl:re,u_frustum_tr:pe,u_frustum_br:Ee,u_frustum_bl:se,u_horizon:Ie,u_transition:De,u_fadeout_range:je,u_color:Ue,u_high_color:Ne,u_space_color:ve,u_temporal_offset:Ae,u_horizon_angle:ke}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,E,V,M,O,F,G,J);i.uploadCommonUniforms(m,le);let ne=this.atmosphereBuffer;ne&&le.draw(i,v.TRIANGLES,w,r.ag.disabled,te?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,r.af.backCW,Q,te?"atmosphere_glow_alpha":"atmosphere_glow",ne.vertexBuffer,ne.indexBuffer,ne.segments)};ee(!1),ee(!0)}drawStars(i,c){let m=r.at(c.properties.get("star-intensity"),0,1);if(m===0)return;let v=i.context,x=v.gl,w=i.transform,E=i.getOrCreateProgram("stars"),S=r.av.identity([]);r.av.rotateX(S,S,-w._pitch),r.av.rotateZ(S,S,-w.angle),r.av.rotateX(S,S,r.ab(w._center.lat)),r.av.rotateY(S,S,-r.ab(w._center.lng));let M=r.ad.fromQuat(new Float32Array(16),S),O=r.ad.multiply([],w.starsProjMatrix,M),F=r.bC.fromMat4([],M),z=r.bC.invert([],F),V=[0,1,0];r._.transformMat3(V,V,z),r._.scale(V,V,this.params.sizeMultiplier);let $=[1,0,0];r._.transformMat3($,$,z),r._.scale($,$,this.params.sizeMultiplier);let G=(H=V,q=$,J=m,{u_matrix:Float32Array.from(O),u_up:H,u_right:q,u_intensity_multiplier:J});var H,q,J;i.uploadCommonUniforms(v,E),this.starsVx&&this.starsIdx&&E.draw(i,x.TRIANGLES,r.ae.disabled,r.ag.disabled,this.colorModeAlphaBlendedWriteRGB,r.af.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function _l(d,i){let c=[...d],m=i.cameraWorldSizeForFog/i.worldSize,v=r.ad.identity([]);return r.ad.scale(v,v,[m,m,1]),r.ad.multiply(c,v,c),r.ad.multiply(c,i.worldToFogMatrix,c),c}function jc(d,i,c,m,v){let x=c.material,w=m.context,{baseColorTexture:E,metallicRoughnessTexture:S}=x.pbrMetallicRoughness,{normalTexture:M,occlusionTexture:O,emissionTexture:F}=x;function z(V,$,G){if(V&&(d.push($),w.activeTexture.set(w.gl.TEXTURE0+G),V.gfxTexture)){let{minFilter:H,magFilter:q,wrapS:J,wrapT:ee}=V.sampler;V.gfxTexture.bindExtraParam(H,q,J,ee)}}z(E,"HAS_TEXTURE_u_baseColorTexture",ri.BaseColor),z(S,"HAS_TEXTURE_u_metallicRoughnessTexture",ri.MetallicRoughness),z(M,"HAS_TEXTURE_u_normalTexture",ri.Normal),z(O,"HAS_TEXTURE_u_occlusionTexture",ri.Occlusion),z(F,"HAS_TEXTURE_u_emissionTexture",ri.Emission),v&&(v.texture||(v.texture=new r.ch(m.context,v.image,[v.image.height,v.image.height,v.image.height],w.gl.RGBA)),w.activeTexture.set(w.gl.TEXTURE0+ri.LUT),v.texture&&v.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(c.texcoordBuffer)),c.colorBuffer&&(d.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(c.colorBuffer)),c.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(c.normalBuffer)),c.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(c.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||d.push("DIFFUSE_SHADED"),d.push("USE_STANDARD_DERIVATIVES")}function aa(d,i,c,m,v,x){let w=c.paint.get("model-opacity"),E=i.context,S=new r.ae(i.context.gl.LEQUAL,r.ae.ReadWrite,i.depthRangeFor3D),M=i.transform,O=d.mesh,F=O.material,z=F.pbrMetallicRoughness,V=i.style.fog,$;$=i.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:r.ad.multiply([],m.zScaleMatrix,d.nodeModelMatrix),r.ad.multiply($,m.negCameraPosMatrix,$);let G=r.ad.invert([],$);r.ad.transpose(G,G);let H=c.paint.get("model-emissive-strength").constantOr(0),q=Fc(new Float32Array(d.worldViewProjection),new Float32Array($),new Float32Array(G),null,i,w,z.baseColorFactor.toRenderColor(null),F.emissiveFactor,z.metallicFactor,z.roughnessFactor,F,H,c),J={defines:[]},ee=[];jc(J.defines,ee,O,i,c.lut);let te=i.shadowRenderer;te&&(te.useNormalOffset=!1);let ce=null;if(V){let ne=_l(d.nodeModelMatrix,i.transform);if(ce=new Float32Array(ne),M.projection.name!=="globe"){let re=O.aabb.min,pe=O.aabb.max,[Ee,se]=V.getOpacityForBounds(ne,re[0],re[1],pe[0],pe[1]);J.overrideFog=Ee>=Wn||se>=Wn}}let le=ko(i,c.paint.get("model-cutoff-fade-range"));le.shouldRenderCutoff&&J.defines.push("RENDER_CUTOFF");let Q=i.getOrCreateProgram("model",J);i.uploadCommonUniforms(E,Q,null,ce,le),i.renderPass!=="shadow"&&te&&te.setupShadowsFromMatrix(d.nodeModelMatrix,Q),Q.draw(i,E.gl.TRIANGLES,S,v,x,O.material.doubleSided?r.af.disabled:r.af.backCCW,q,c.id,O.vertexBuffer,O.indexBuffer,O.segments,c.paint,i.transform.zoom,void 0,ee)}function Zr(d,i,c,m,v,x,w){let E;E=d.projection.name==="globe"?r.ci(c,d):[...c],r.ad.multiply(E,E,i.matrix);let S=r.ad.multiply([],m,E);if(i.meshes)for(let M of i.meshes){if(M.material.alphaMode!=="BLEND"){w.push({mesh:M,depth:0,modelIndex:v,worldViewProjection:S,nodeModelMatrix:E});continue}let O=r._.transformMat4([],M.centroid,S);O[2]>0&&x.push({mesh:M,depth:O[2],modelIndex:v,worldViewProjection:S,nodeModelMatrix:E})}if(i.children)for(let M of i.children)Zr(d,M,c,m,v,x,w)}function hi(d,i,c,m){let v=c.shadowRenderer;if(!v)return;let x=v.getShadowPassDepthMode(),w=v.getShadowPassColorMode(),E=v.calculateShadowPassMatrixFromMatrix(i),S=Rg(E);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,x,r.ag.disabled,w,r.af.backCCW,S,m.id,d.vertexBuffer,d.indexBuffer,d.segments,m.paint,c.transform.zoom,void 0,void 0)}function zg(d,i,c){let m=i.updateZoomBasedPaintProperties(),v=function(x,w,E){let S,M,O,F=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&F>0){let z=x.terrain,V=z.findDEMTileFor(E);V&&V.dem?S=r.ck.create(z,E,V):F=0}if(F===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),F===w.validForExaggeration&&(F===0||S&&S._demTile&&S._demTile.tileID===w.validForDEMTile.id&&S._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(let z in w.instancesPerModel){let V=w.instancesPerModel[z];for(let $=0;$<V.instancedDataArray.length;++$){let G=(S?F*S.getElevationAt(0|V.instancedDataArray.float32[16*$],0|V.instancedDataArray.float32[16*$+1],!0,!0):0)+V.instancesEvaluatedElevation[$];V.instancedDataArray.float32[16*$+6]=G,M=M?Math.min(w.terrainElevationMin,G):G,O=O?Math.max(w.terrainElevationMax,G):G}}return w.terrainElevationMin=M||0,w.terrainElevationMax=O||0,w.validForExaggeration=F,w.validForDEMTile=S&&S._demTile?{id:S._demTile.tileID,timestamp:S._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,i,c);(m||v)&&(i.uploaded=!1,i.upload(d.context))}let di={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.b6([0,0,0],[r.a3,r.a3,0])};function mr(d,i){let c=1<<d.canonical.z,m=i.getFreeCameraOptions().position,v=i.elevation,x=d.canonical.x/c,w=(d.canonical.x+1)/c,E=d.canonical.y/c,S=(d.canonical.y+1)/c,M=i._centerAltitude;if(v){let V=v.getMinMaxForTile(d);V&&V.max>M&&(M=V.max)}let O=r.at(m.x,x,w)-m.x,F=r.at(m.y,E,S)-m.y,z=r.ax(M,i.center.lat)-m.z;return i._zoomFromMercatorZ(Math.sqrt(O*O+F*F+z*z))}function Fi(d,i,c,m,v,x,w){let E=d.context,S=d.renderPass==="shadow",M=d.shadowRenderer,O=S&&M?M.getShadowPassDepthMode():new r.ae(E.gl.LEQUAL,r.ae.ReadWrite,d.depthRangeFor3D),F=d.isTileAffectedByFog(x);if(c.meshes)for(let z of c.meshes){let V=["MODEL_POSITION_ON_GPU"],$=[],G,H,q;m.instancedDataArray.length>20&&V.push("INSTANCED_ARRAYS");let J=ko(d,i.paint.get("model-cutoff-fade-range"));if(J.shouldRenderCutoff&&V.push("RENDER_CUTOFF"),S&&M)G=d.getOrCreateProgram("modelDepth",{defines:V}),H=Rg(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(c.matrix)),q=M.getShadowPassColorMode();else{jc(V,$,z,d,i.lut),G=d.getOrCreateProgram("model",{defines:V,overrideFog:F});let te=z.material,ce=te.pbrMetallicRoughness,le=i.paint.get("model-opacity"),Q=i.paint.get("model-emissive-strength").constantOr(0);H=Fc(x.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),null,d,le,ce.baseColorFactor.toRenderColor(null),te.emissiveFactor,ce.metallicFactor,ce.roughnessFactor,te,Q,i,v),M&&(w.shadowUniformsInitialized?G.setShadowUniformValues(E,M.getShadowUniformValues()):(M.setupShadows(x.toUnwrapped(),G,"model-tile",x.overscaledZ),w.shadowUniformsInitialized=!0)),q=J.shouldRenderCutoff||le<1||te.alphaMode!=="OPAQUE"?r.a.alphaBlended:r.a.unblended}d.uploadCommonUniforms(E,G,x.toUnwrapped(),null,J);let ee=z.material.doubleSided?r.af.disabled:r.af.backCCW;if(m.instancedDataArray.length>20)$.push(m.instancedDataBuffer),G.draw(d,E.gl.TRIANGLES,O,r.ag.disabled,q,ee,H,i.id,z.vertexBuffer,z.indexBuffer,z.segments,i.paint,d.transform.zoom,void 0,$,m.instancedDataArray.length);else{let te=S?"u_instance":"u_normal_matrix";for(let ce=0;ce<m.instancedDataArray.length;++ce)H[te]=new Float32Array(m.instancedDataArray.arrayBuffer,64*ce,16),G.draw(d,E.gl.TRIANGLES,O,r.ag.disabled,q,ee,H,i.id,z.vertexBuffer,z.indexBuffer,z.segments,i.paint,d.transform.zoom,void 0,$)}}if(c.children)for(let z of c.children)Fi(d,i,z,m,v,x,w)}let No=[1,-1,1];function wr(d,i,c,m){if(!c.modelManager)return!0;let v=c.modelManager;if(!c.shadowRenderer)return!0;let x=c.shadowRenderer,w=i.aabb,E=!0,S=d.maxHeight;if(S===0){let O=0;for(let F in d.instancesPerModel){let z=v.getModel(F,m);z?O=Math.max(O,Math.max(Math.max(z.aabb.max[0],z.aabb.max[1]),z.aabb.max[2])):E=!1}S=d.maxScale*O*1.41+d.maxVerticalOffset,E&&(d.maxHeight=S)}w.max[2]=S,w.min[2]+=d.terrainElevationMin,w.max[2]+=d.terrainElevationMax,r._.transformMat4(w.min,w.min,i.tileMatrix),r._.transformMat4(w.max,w.max,i.tileMatrix);let M=w.intersects(x.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=M===2),M===0}function Qf(d,i){let c=d.uniformValues.u_cutoff_params[0],m=d.uniformValues.u_cutoff_params[1],v=d.uniformValues.u_cutoff_params[2],x=d.uniformValues.u_cutoff_params[3];return m===c||x===v?1:r.at(((i-c)/(m-c)-v)/(x-v),0,1)}function Ji(d,i,c,m){if(i.pitch<20)return 1;let v=i.getWorldToCameraMatrix(),x=r.ad.multiply([],v,d),w=[...c.min,1],E=r.aA.transformMat4([],w,x),S=E,M=E;w[1]=c.max[1],E=r.aA.transformMat4([],w,x),S=E[1]<S[1]?E:S,M=E[1]>M[1]?E:M,w[0]=c.max[0],E=r.aA.transformMat4([],w,x),S=E[1]<S[1]?E:S,M=E[1]>M[1]?E:M,w[1]=c.min[1],E=r.aA.transformMat4([],w,x),S=E[1]<S[1]?E:S,M=E[1]>M[1]?E:M;let O=r.at(m[0],0,1),F=100*i.pixelsPerMeter*r.at(m[1],0,1),z=r.at(m[2],0,1),V=r._.lerp([],S,M,O),$=Math.tan(.5*i.fovX),G=-V[2]*$;if(F===0)return V[1]<-Math.abs(G)?z:1;let H=(-Math.abs(G)-V[1])/F,q=(ee,te,ce)=>(1-ce)*ee+ce*te,J=r.at(q(1,z,H),z,1);return q(1,J,r.at((i.pitch-20)/20,0,1))}class Uc{}class $c{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,c,m){{let F=this._storage.get(c.id);if(F)return F.lastUsedFrameIdx=i,F.buf}let v=m.gl,x=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),w=new ArrayBuffer(x),E=new Int16Array(w);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));let S=new r.cm;for(let F=0;F<x/2;F+=3){let z=E[F],V=E[F+1],$=E[F+2];S.emplaceBack(z,V),S.emplaceBack(V,$),S.emplaceBack($,z)}let M=m.bindVertexArrayOES.current,O=new Uc;return O.buf=new r.I(m,S),O.lastUsedFrameIdx=i,this._storage.set(c.id,O),m.bindVertexArrayOES.set(M),O.buf}update(i){for(let[c,m]of this._storage)i-m.lastUsedFrameIdx>30&&(m.buf.destroy(),this._storage.delete(c))}destroy(){for(let[i,c]of this._storage)c.buf.destroy(),this._storage.delete(i)}}let la=r.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class rx{constructor(i){let c=new r.cn,m=new r.bu;c.emplaceBack(-1,-1),c.emplaceBack(1,-1),c.emplaceBack(1,1),c.emplaceBack(-1,1),m.emplaceBack(0,1,2),m.emplaceBack(0,2,3),this.segments=r.b.simpleSegment(0,0,c.length,m.length),this.vx=i.createVertexBuffer(c,la.members),this.idx=i.createIndexBuffer(m)}destroy(){this.vx.destroy(),this.idx.destroy()}}let eo={symbol:function(d,i,c,m,v){if(d.renderPass!=="translucent")return;let x=r.ag.disabled,w=d.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(M,O,F,z,V,$,G){let H=O.transform,q=V==="map",J=$==="map";for(let ee of M){let te=z.getTile(ee),ce=te.getBucket(F);if(!ce||!ce.text||!ce.text.segments.get().length)continue;let le=r.aD(ce.textSizeData,H.zoom),Q=hl(ee,ce.getProjection(),H),ne=H.calculatePixelsToTileUnitsMatrix(te),re=ea(Q,te.tileID.canonical,J,q,H,ce.getProjection(),ne),pe=ce.hasIconTextFit()&&ce.hasIconData();if(le){let Ee=Math.pow(2,H.zoom-te.tileID.overscaledZ);Lg(ce,q,J,G,r.bO,H,re,ee,Ee,le,pe)}}}(m,d,c,i,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),v);let E=c.paint.get("icon-opacity").constantOr(1)!==0,S=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(E||S)?qf(d,i,c,m,x,w):(E&&qf(d,i,c,m,x,w,{onlyIcons:!0}),S&&qf(d,i,c,m,x,w,{onlyText:!0}),function(M,O,F,z){if(!M.symbolParams.useOcclusionQueries)return;let V=M.context.gl,$=M.transform,G=F.paint,H=G.get("icon-occlusion-opacity").constantOr(0)!==1,q=G.get("text-occlusion-opacity").constantOr(0)!==1;if(!H&&!q)return;let J=$.projection.name==="globe";for(let ee of z){let te=O.getTile(ee),ce=te.getBucket(F);if(!ce||ce.projection.name==="mercator"&&J||ce.fullyClipped)continue;if(ce.projection.name==="globe"){r.w(`Occlusion not supported for globe mode. Layer: ${F.type}`);continue}let le=hl(ee,ce.getProjection(),$),Q=r.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,M.symbolParams.depthOffset,1),ne=r.ad.multiply([],Q,le),re=M.symbolParams.visualizeOcclusions!=="none"?1:M.symbolParams.occlusionQueryFrameWindow;for(let pe=0;pe<ce.symbolInstances.length;pe++){let Ee=ce.symbolInstances.get(pe),se=M.style.placement.opacities[Ee.crossTileID];if(se&&se.isHidden()||(M.frameCounter+pe)%re!=0)continue;let Ie=Ee.tileAnchorX,De=Ee.tileAnchorY,je=Ee.zOffset,Ue;if(M.symbolParams.visualizeOcclusions==="none"){let it=ce.queries.get(pe);if(it){if(!it.isFree()){if(!it.isResultAvailable())continue;let lt=it.consumeResult();Ee.occlusionState=lt===0?0:1;continue}Ue=it}else Ue=new Wa(M.context),ce.queries.set(pe,Ue)}let Ne=M.getOrCreateProgram("occlusion"),ve=M.symbolParams.occluderSize,Ae=Og(ne,[Ie,De,je],[$.width,$.height],[ve,ve],M.symbolParams.visualizeOcclusions==="zPass"?[1,0,0,.8]:[1,.4,.2,.9]);M.terrain&&M.terrain.setupElevationDraw(te,Ne,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),M.symbolParams.visualizeOcclusions==="none"&&Ue&&Ue.begin();let ke=new r.ae(M.symbolParams.visualizeOcclusions==="zPass"?M.context.gl.ALWAYS:M.context.gl.LEQUAL,r.ae.ReadOnly,M.depthRangeFor3D);Ne.draw(M,V.TRIANGLES,ke,r.ag.disabled,M.symbolParams.visualizeOcclusions!=="none"?r.a.alphaBlendedNonPremultiplied:r.a.disabled,r.af.disabled,Ae,"occlusion",M.occlusionBuffers.vx,M.occlusionBuffers.idx,M.occlusionBuffers.segments),M.symbolParams.visualizeOcclusions==="none"&&Ue&&Ue.end()}}}(d,i,c,m)),i.map.showCollisionBoxes&&(Nc(d,i,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Nc(d,i,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(d,i,c,m){if(d.renderPass!=="translucent")return;let v=c.paint.get("circle-opacity"),x=c.paint.get("circle-stroke-width"),w=c.paint.get("circle-stroke-opacity"),E=c.layout.get("circle-sort-key").constantOr(1)!==void 0,S=c.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(x.constantOr(1)===0||w.constantOr(1)===0))return;let M=d.context,O=M.gl,F=d.transform,z=d.depthModeForSublayer(0,r.ae.ReadOnly),V=r.ag.disabled,$=d.colorModeForDrapableLayerRenderPass(S),G=F.projection.name==="globe",H=[r.aj(F.center.lng),r.ak(F.center.lat)],q=[];for(let ee=0;ee<m.length;ee++){let te=m[ee],ce=i.getTile(te),le=ce.getBucket(c);if(!le||le.projection.name!==F.projection.name)continue;let Q=le.programConfigurations.get(c.id),ne=r.bR(c),re=d.isTileAffectedByFog(te);G&&ne.push("PROJECTION_GLOBE_VIEW");let pe=d.getOrCreateProgram("circle",{config:Q,defines:ne,overrideFog:re}),Ee=le.layoutVertexBuffer,se=le.globeExtVertexBuffer,Ie=le.indexBuffer,De=F.projection.createInversionMatrix(F,te.canonical),je={programConfiguration:Q,program:pe,layoutVertexBuffer:Ee,globeExtVertexBuffer:se,indexBuffer:Ie,uniformValues:r.bS(d,te,ce,De,H,c),tile:ce};if(E){let Ue=le.segments.get();for(let Ne of Ue)q.push({segments:new r.b([Ne]),sortKey:Ne.sortKey,state:je})}else q.push({segments:le.segments,sortKey:0,state:je})}E&&q.sort((ee,te)=>ee.sortKey-te.sortKey);let J={useDepthForOcclusion:F.depthOcclusionForCircles};for(let ee of q){let{programConfiguration:te,program:ce,layoutVertexBuffer:le,globeExtVertexBuffer:Q,indexBuffer:ne,uniformValues:re,tile:pe}=ee.state,Ee=ee.segments;d.terrain&&d.terrain.setupElevationDraw(pe,ce,J),d.uploadCommonUniforms(M,ce,pe.tileID.toUnwrapped()),ce.draw(d,O.TRIANGLES,z,V,$,r.af.disabled,re,c.id,le,ne,Ee,c.paint,F.zoom,te,[Q])}},heatmap:function(d,i,c,m){if(c.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){let v=d.context,x=v.gl,w=r.ag.disabled,E=new r.a([x.ONE,x.ONE,x.ONE,x.ONE],r.C.transparent,[!0,!0,!0,!0]);(function(V,$,G,H){let q=V.gl,J=$.width*H,ee=$.height*H;V.activeTexture.set(q.TEXTURE1),V.viewport.set([0,0,J,ee]);let te=G.heatmapFbo;if(!te||te&&(te.width!==J||te.height!==ee)){te&&te.destroy();let ce=q.createTexture();q.bindTexture(q.TEXTURE_2D,ce),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),te=G.heatmapFbo=V.createFramebuffer(J,ee,!0,null),function(le,Q,ne,re,pe,Ee){let se=le.gl;se.texImage2D(se.TEXTURE_2D,0,le.extRenderToTextureHalfFloat?se.RGBA16F:se.RGBA,pe,Ee,0,se.RGBA,le.extRenderToTextureHalfFloat?se.HALF_FLOAT:se.UNSIGNED_BYTE,null),re.colorAttachment.set(ne)}(V,0,ce,te,J,ee)}else q.bindTexture(q.TEXTURE_2D,te.colorAttachment.get()),V.bindFramebuffer.set(te.framebuffer)})(v,d,c,d.transform.projection.name==="globe"?.5:.25),v.clear({color:r.C.transparent});let S=d.transform,M=S.projection.name==="globe",O=M?["PROJECTION_GLOBE_VIEW"]:[],F=M?r.af.frontCCW:r.af.disabled,z=[r.aj(S.center.lng),r.ak(S.center.lat)];for(let V=0;V<m.length;V++){let $=m[V];if(i.hasRenderableParent($))continue;let G=i.getTile($),H=G.getBucket(c);if(!H||H.projection.name!==S.projection.name)continue;let q=d.isTileAffectedByFog($),J=H.programConfigurations.get(c.id),ee=d.getOrCreateProgram("heatmap",{config:J,defines:O,overrideFog:q}),{zoom:te}=d.transform;d.terrain&&d.terrain.setupElevationDraw(G,ee),d.uploadCommonUniforms(v,ee,$.toUnwrapped());let ce=S.projection.createInversionMatrix(S,$.canonical);ee.draw(d,x.TRIANGLES,r.ae.disabled,w,E,F,ia(d,$,G,ce,z,te,c.paint.get("heatmap-intensity")),c.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,c.paint,d.transform.zoom,J,M?[H.globeExtVertexBuffer]:null)}v.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(v,x){let w=v.context,E=w.gl,S=x.heatmapFbo;if(!S)return;w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,S.colorAttachment.get()),w.activeTexture.set(E.TEXTURE1);let M=x.colorRampTexture;M||(M=x.colorRampTexture=new r.T(w,x.colorRamp,E.RGBA)),M.bind(E.LINEAR,E.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,E.TRIANGLES,r.ae.disabled,r.ag.disabled,v.colorModeForRenderPass(),r.af.disabled,((O,F,z,V)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,x),x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(d,c))},line:function(d,i,c,m){if(d.renderPass!=="translucent")return;let v=c.paint.get("line-opacity"),x=c.paint.get("line-width");if(v.constantOr(1)===0||x.constantOr(1)===0)return;let w=c.paint.get("line-emissive-strength"),E=c.paint.get("line-occlusion-opacity"),S=d.context,M=S.gl,O=c.layout.get("line-z-offset"),F=!O.isConstant()||!!O.constantOr(0),z=F?new r.ae(d.depthOcclusion?M.GREATER:M.LEQUAL,r.ae.ReadOnly,d.depthRangeFor3D):d.depthModeForSublayer(0,r.ae.ReadOnly),V=d.colorModeForDrapableLayerRenderPass(w),$=d.terrain&&d.terrain.renderingToTexture,G=$?1:r.e.devicePixelRatio,H=c.paint.get("line-dasharray"),q=H.constantOr(1),J=c.layout.get("line-cap"),ee=H.constantOr(null),te=J.constantOr(null),ce=c.paint.get("line-pattern"),le=ce.constantOr(1),Q=ce.constantOr(null),ne=c.paint.get("line-opacity").constantOr(1),re=!le&&ne!==1||d.depthOcclusion&&E>0&&E<1,pe=c.paint.get("line-gradient"),Ee=le?"linePattern":"line",se=r.bT(c),Ie;if($&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(re=!1),E!==0&&d.depthOcclusion){let je=c.paint._values["line-opacity"];je&&je.value&&je.value.kind==="constant"?Ie=je.value:r.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}if(F&&(d.forceTerrainMode=!0),!F&&E!==0&&d.terrain&&!$)return void r.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has non-zero line-z-offset.`);let De=re&&F?d.stencilModeFor3D():r.ag.disabled;for(let je of m){let Ue=i.getTile(je);if(le&&!Ue.patternsLoaded())continue;let Ne=Ue.getBucket(c);if(!Ne)continue;d.prepareDrawTile();let ve=Ne.programConfigurations.get(c.id),Ae=d.isTileAffectedByFog(je),ke=d.getOrCreateProgram(Ee,{config:ve,defines:F?[...se,"ELEVATED"]:se,overrideFog:Ae});if(Q&&Ue.imageAtlas){let ot=Ue.imageAtlas.patternPositions[Q.toString()];ot&&ve.setConstantPatternPositions(ot)}if(!le&&ee&&te&&Ue.lineAtlas){let ot=Ue.lineAtlas.getDash(ee,te);ot&&ve.setConstantPatternPositions(ot)}let[it,lt]=c.paint.get("line-trim-offset");(te==="round"||te==="square")&&it!==lt&&(it===0&&(it-=1),lt===1&&(lt+=1));let st=$?je.projMatrix:null,ze=le?r.bU(d,Ue,c,st,G,[it,lt]):r.bV(d,Ue,c,st,Ne.lineClipsArray.length,G,[it,lt]);if(pe){let ot=Ne.gradients[c.id],ft=ot.texture;if(c.gradientVersion!==ot.version){let At=256;if(c.stepInterpolant){let Bt=i.getSource().maxzoom,tn=je.canonical.z===Bt?Math.ceil(1<<d.transform.maxZoom-je.canonical.z):1;At=r.at(r.bW(Ne.maxLineLength/r.a3*1024*tn),256,S.maxTextureSize)}ot.gradient=r.bX({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:At,image:ot.gradient||void 0,clips:Ne.lineClipsArray}),ot.texture?ot.texture.update(ot.gradient):ot.texture=new r.T(S,ot.gradient,M.RGBA),ot.version=c.gradientVersion,ft=ot.texture}S.activeTexture.set(M.TEXTURE1),ft.bind(c.stepInterpolant?M.NEAREST:M.LINEAR,M.CLAMP_TO_EDGE)}q&&(S.activeTexture.set(M.TEXTURE0),Ue.lineAtlasTexture&&Ue.lineAtlasTexture.bind(M.LINEAR,M.REPEAT),ve.updatePaintBuffers()),le&&(S.activeTexture.set(M.TEXTURE0),Ue.imageAtlasTexture&&Ue.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ve.updatePaintBuffers()),F&&d.terrain.setupElevationDraw(Ue,ke),d.uploadCommonUniforms(S,ke,je.toUnwrapped());let $e=ot=>{Ie!=null&&(Ie.value=ne*E),ke.draw(d,M.TRIANGLES,z,ot,V,r.af.disabled,ze,c.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,c.paint,d.transform.zoom,ve,[Ne.layoutVertexBuffer2,Ne.patternVertexBuffer,Ne.zOffsetVertexBuffer]),Ie!=null&&(Ie.value=ne)};if(re&&!F){let ot=d.stencilModeForClipping(je).ref;ot===0&&$&&S.clear({stencil:0});let ft={func:M.EQUAL,mask:255};ze.u_alpha_discard_threshold=.8,$e(new r.ag(ft,ot,255,M.KEEP,M.KEEP,M.INVERT)),ze.u_alpha_discard_threshold=0,$e(new r.ag(ft,ot,255,M.KEEP,M.KEEP,M.KEEP))}else re&&F&&(ze.u_alpha_discard_threshold=.001),$e(F?De:d.stencilModeForClipping(je))}re&&(d.resetStencilClippingMasks(),$&&S.clear({stencil:0})),E===0||d.depthOcclusion||$||d.layersWithOcclusionOpacity.push(d.currentLayer),F&&(d.forceTerrainMode=!1)},fill:function(d,i,c,m){let v=c.paint.get("fill-color"),x=c.paint.get("fill-opacity");if(x.constantOr(1)===0)return;let w=c.paint.get("fill-emissive-strength"),E=d.colorModeForDrapableLayerRenderPass(w),S=c.paint.get("fill-pattern"),M=d.opaquePassEnabledForLayer()&&!S.constantOr(1)&&v.constantOr(r.C.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===M){let O=d.depthModeForSublayer(1,d.renderPass==="opaque"?r.ae.ReadWrite:r.ae.ReadOnly);Wf(d,i,c,m,O,E,!1)}if(d.renderPass==="translucent"&&c.paint.get("fill-antialias")){let O=d.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,r.ae.ReadOnly);Wf(d,i,c,m,O,E,!0)}},"fill-extrusion":function(d,i,c,m){let v=c.paint.get("fill-extrusion-opacity"),x=d.context,w=x.gl,E=d.terrain,S=E&&E.renderingToTexture;if(v===0)return;let M=d.conflationActive&&d.style.isLayerClipped(c,i.getSource()),O=d.style.order.indexOf(c.fqid);if(M&&function(F,z,V,$,G){for(let H of $){let q=z.getTile(H).getBucket(V);q&&(q.updateReplacement(H,F.replacementSource,G),q.uploadCentroid(F.context))}}(d,i,c,m,O),E||M)for(let F of m){let z=i.getTile(F).getBucket(c);z&&Ph(d.context,i,F,z,c,E,M)}if(d.renderPass==="shadow"&&d.shadowRenderer){let F=d.shadowRenderer;if(E&&v<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.Z)return;let z=F.getShadowPassDepthMode(),V=F.getShadowPassColorMode();fl(d,i,c,m,z,r.ag.disabled,V,M)}else if(d.renderPass==="translucent"){let F=!c.paint.get("fill-extrusion-pattern").constantOr(1),z=c.paint.get("fill-extrusion-color").constantOr(r.C.white);if(!S&&z.a!==0){let V=new r.ae(d.context.gl.LEQUAL,r.ae.ReadWrite,d.depthRangeFor3D);v===1&&F?fl(d,i,c,m,V,r.ag.disabled,r.a.unblended,M):(fl(d,i,c,m,V,r.ag.disabled,r.a.disabled,M),fl(d,i,c,m,V,d.stencilModeFor3D(),d.colorModeForRenderPass(),M),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&F&&(!E&&d.transform.projection.name!=="globe"||S)){let V=c.paint.get("fill-extrusion-opacity"),$=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),G=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),H=c.paint.get("fill-extrusion-flood-light-intensity"),q=c.paint.get("fill-extrusion-flood-light-color").toRenderColor(c.lut).toArray01().slice(0,3),J=$>0&&G>0,ee=H>0,te=(le,Q,ne)=>(1-ne)*le+ne*Q,ce=le=>{let Q=d.depthModeForSublayer(1,r.ae.ReadOnly,w.LEQUAL,!0),ne=c.paint.get(le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),re=te(.1,3,ne),pe=d._showOverdrawInspector;if(!pe){let Ee=new r.ag({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),se=new r.a([w.ONE,w.ONE,w.ONE,w.ONE],r.C.transparent,[!1,!1,!1,!0],w.MIN);ci(d,i,c,m,Q,Ee,se,r.af.disabled,le,"sdf",V,$,G,H,q,re,M,!1)}{let Ee=pe?r.ag.disabled:new r.ag({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),se=pe?d.colorModeForRenderPass():new r.a([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],r.C.transparent,[!0,!0,!0,!0]);ci(d,i,c,m,Q,Ee,se,r.af.disabled,le,"color",V,$,G,H,q,re,M,!1)}};if(S){let le=(Q,ne,re)=>{let pe=d.depthModeForSublayer(1,r.ae.ReadOnly,w.LEQUAL,!1),Ee=c.paint.get(Q?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),se=te(.1,3,Ee);{let Ie=new r.a([w.ONE,w.ONE,w.ONE,w.ONE],r.C.transparent,[!1,!1,!1,!0]);ci(d,i,c,m,pe,r.ag.disabled,Ie,r.af.disabled,Q,"clear",V,$,G,H,q,se,M,ne)}{let Ie=new r.ag({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),De=new r.a([w.ONE,w.ONE,w.ONE,w.ONE],r.C.transparent,[!1,!1,!1,!0],w.MIN);ci(d,i,c,m,pe,Ie,De,r.af.disabled,Q,"sdf",V,$,G,H,q,se,M,ne)}{let Ie=Q?w.ZERO:w.ONE_MINUS_DST_ALPHA,De=new r.ag({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),je=new r.a([Ie,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],r.C.transparent,[!0,!0,!0,!0]);ci(d,i,c,m,pe,De,je,r.af.disabled,Q,"color",V,$,G,H,q,se,M,ne)}{let Ie=new r.a([w.ONE,w.ONE,w.ONE,Q?w.ZERO:w.ONE],r.C.transparent,[!1,!1,!1,!0],Q?w.FUNC_ADD:w.MAX);ci(d,i,c,m,pe,r.ag.disabled,Ie,r.af.disabled,Q,"clear",V,$,G,H,q,se,M,ne,re)}};if(J||ee){let Q;if(d.prepareDrawTile(),E){let ne=E.drapeBufferSize[0],re=E.drapeBufferSize[1];Q=E.framebufferCopyTexture,Q&&(!Q||Q.size[0]===ne&&Q.size[1]===re)||(Q&&Q.destroy(),Q=E.framebufferCopyTexture=new r.T(x,new r.i({width:ne,height:re}),w.RGBA)),Q.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexImage2D(w.TEXTURE_2D,0,w.RGBA,0,0,ne,re,0)}J&&le(!0,!1,Q),ee&&le(!1,!0,Q)}}else J&&ce(!0),ee&&ce(!1)}}},hillshade:function(d,i,c,m){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;let v=d.context,x=d.terrain&&d.terrain.renderingToTexture,[w,E]=d.renderPass!=="translucent"||x?[{},m]:d.stencilConfigForOverlap(m);for(let S of E){let M=i.getTile(S);if(M.needsHillshadePrepare&&d.renderPass==="offscreen")yo(d,M,c);else if(d.renderPass==="translucent"){let O=d.depthModeForSublayer(0,r.ae.ReadOnly),F=c.paint.get("hillshade-emissive-strength"),z=d.colorModeForDrapableLayerRenderPass(F),V=x&&d.terrain?d.terrain.stencilModeForRTTOverlap(S):w[S.overscaledZ];Yv(d,S,M,c,O,V,z)}}v.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,i,c,m,v,x){if(d.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;let w=d.transform.projection.name==="globe",E=c.paint.get("raster-elevation")!==0,S=E&&w;if(d.renderElevatedRasterBackface&&!S)return;let M=d.context,O=M.gl,F=i.getSource(),z=function(le,Q,ne,re){let pe=Q.paint.get("raster-color"),Ee=le.type==="raster-array",se=[],Ie=Q.paint.get("raster-resampling"),De=Q.paint.get("raster-color-mix"),je=Q.paint.get("raster-color-range"),Ue=[De[0],De[1],De[2],0],Ne=De[3],ve=Ie==="nearest"?re.NEAREST:re.LINEAR;if(Ee&&(se.push("RASTER_ARRAY"),pe||se.push("RASTER_COLOR"),Ie==="linear"&&se.push("RASTER_ARRAY_LINEAR"),ve=re.NEAREST,!je&&le.rasterLayers)){let Ae=le.rasterLayers.find(({id:ke})=>ke===Q.sourceLayer);Ae&&Ae.fields&&Ae.fields.range&&(je=Ae.fields.range)}if(je=je||[0,1],pe){se.push("RASTER_COLOR"),ne.activeTexture.set(re.TEXTURE2),Q.updateColorRamp(je);let Ae=Q.colorRampTexture;Ae||(Ae=Q.colorRampTexture=new r.T(ne,Q.colorRamp,re.RGBA)),Ae.bind(re.LINEAR,re.CLAMP_TO_EDGE)}return{mix:Ue,range:je,offset:Ne,defines:se,resampling:ve}}(F,c,M,O);if(F instanceof r.bm&&!m.length&&!w)return;let V=c.paint.get("raster-emissive-strength"),$=d.colorModeForDrapableLayerRenderPass(V),G=d.terrain&&d.terrain.renderingToTexture,H=!d.options.moving,q=c.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;if(F instanceof r.bm&&!m.length&&(F.onNorthPole||F.onSouthPole)){let le=E?d.stencilModeFor3D():r.ag.disabled;return void Bc(!!F.onNorthPole,null,d,i,c,V,z,r.af.disabled,le)}if(!m.length)return;let[J,ee]=F instanceof r.bm||G?[{},m]:d.stencilConfigForOverlap(m),te=ee[ee.length-1].overscaledZ;S&&z.defines.push("PROJECTION_GLOBE_VIEW"),E&&z.defines.push("RENDER_CUTOFF");let ce=(le,Q,ne)=>{for(let re of le){let pe=re.toUnwrapped(),Ee=i.getTile(re);if(G&&(!Ee||!Ee.hasData()))continue;M.activeTexture.set(O.TEXTURE0);let se=tx(Ee,F,c,z);if(!se||!se.texture)continue;let{texture:Ie,mix:De,offset:je,tileSize:Ue,buffer:Ne}=se,ve,Ae;G?(ve=r.ae.disabled,Ae=re.projMatrix):E?(ve=new r.ae(O.LEQUAL,r.ae.ReadWrite,d.depthRangeFor3D),Ae=w?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(pe,H)):(ve=d.depthModeForSublayer(re.overscaledZ-te,c.paint.get("raster-opacity")===1?r.ae.ReadWrite:r.ae.ReadOnly,O.LESS),Ae=d.transform.calculateProjMatrix(pe,H));let ke=d.terrain&&G?d.terrain.stencilModeForRTTOverlap(re):J[re.overscaledZ],it=x?0:c.paint.get("raster-fade-duration");Ee.registerFadeDuration(it);let lt=i.findLoadedParent(re,0),st=bh(Ee,lt,i,d.transform,it),ze,$e;d.terrain&&d.terrain.prepareDrawTile(),M.activeTexture.set(O.TEXTURE0),Ie.bind(q,O.CLAMP_TO_EDGE),M.activeTexture.set(O.TEXTURE1),lt?(lt.texture&&lt.texture.bind(q,O.CLAMP_TO_EDGE),ze=Math.pow(2,lt.tileID.overscaledZ-Ee.tileID.overscaledZ),$e=[Ee.tileID.canonical.x*ze%1,Ee.tileID.canonical.y*ze%1]):Ie.bind(q,O.CLAMP_TO_EDGE),Ie.useMipmap&&M.extTextureFilterAnisotropic&&d.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);let ot=d.transform,ft,At=E?pn(ot):[0,0,0,0],Bt,tn,Kt,In,Lt,bn=0;if(S&&F instanceof r.bm&&F.coordinates.length>3)Bt=Float32Array.from(r.bf(r.bg(new r.aO(0,0,0)))),tn=Float32Array.from(ot.globeMatrix),Kt=Float32Array.from(r.bb(ot)),In=[r.aj(ot.center.lng),r.ak(ot.center.lat)],ft=F.elevatedGlobePerspectiveTransform,Lt=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(S){let Ft=r.bc(re.canonical);bn=r.bd(Ft.getCenter().lat),Bt=Float32Array.from(r.bf(r.bg(re.canonical))),tn=Float32Array.from(ot.globeMatrix),Kt=Float32Array.from(r.bb(ot)),In=[r.aj(ot.center.lng),r.ak(ot.center.lat)],ft=[0,0],Lt=Float32Array.from(r.be(re.canonical,Ft,bn,ot.worldSize/ot._pixelsPerMercatorPixel))}else ft=F instanceof r.bm?F.perspectiveTransform:[0,0],Bt=new Float32Array(16),tn=new Float32Array(9),Kt=new Float32Array(16),In=[0,0],Lt=new Float32Array(9);let kn=Oc(Ae,Bt,tn,Kt,Lt,$e||[0,0],r.a1(d.transform.zoom),In,At,ze||1,st,c,ft,E?c.paint.get("raster-elevation"):0,2,De,je,z.range,Ue,Ne,V),Dn=d.isTileAffectedByFog(re),Zt=d.getOrCreateProgram("raster",{defines:z.defines,overrideFog:Dn});if(d.uploadCommonUniforms(M,Zt,pe),F instanceof r.bm){let Ft=F.elevatedGlobeVertexBuffer,Vn=F.elevatedGlobeIndexBuffer;if(G||!w)F.boundsBuffer&&F.boundsSegments&&Zt.draw(d,O.TRIANGLES,ve,r.ag.disabled,$,r.af.disabled,kn,c.id,F.boundsBuffer,d.quadTriangleIndexBuffer,F.boundsSegments);else if(Ft&&Vn){let $n=ot.zoom<=r.b1?F.elevatedGlobeSegments:F.getSegmentsForLongitude(ot.center.lng);$n&&Zt.draw(d,O.TRIANGLES,ve,r.ag.disabled,$,Q,kn,c.id,Ft,Vn,$n)}}else if(S){ve=new r.ae(O.LEQUAL,r.ae.ReadOnly,d.depthRangeFor3D);let Ft=d.globeSharedBuffers;if(Ft){let[Vn,$n,nn]=Ft.getGridBuffers(bn,!1);Zt.draw(d,O.TRIANGLES,ve,ne||ke,d.colorModeForRenderPass(),Q,kn,c.id,Vn,$n,nn)}}else{let{tileBoundsBuffer:Ft,tileBoundsIndexBuffer:Vn,tileBoundsSegments:$n}=d.getTileBoundsBuffers(Ee);Zt.draw(d,O.TRIANGLES,ve,ke,$,r.af.disabled,kn,c.id,Ft,Vn,$n)}}if(!(F instanceof r.bm)&&S)for(let re of le){let pe=re.canonical.y===(1<<re.canonical.z)-1;re.canonical.y===0&&Bc(!0,re,d,i,c,V,z,Q,ne||r.ag.disabled),pe&&Bc(!1,re,d,i,c,V,z,Q===r.af.frontCW?r.af.backCW:r.af.frontCW,ne||r.ag.disabled)}};S?ce(ee,d.renderElevatedRasterBackface?r.af.backCW:r.af.frontCW,d.stencilModeFor3D()):ce(ee,r.af.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,i,c,m,v,x){d.renderPass==="offscreen"&&function(w,E,S,M){if(!M.length)return;let O=w.context,F=O.gl,z=E.getSource();if(!(z instanceof al))return;let V=Math.ceil(Math.sqrt(S.paint.get("raster-particle-count"))),$=S.particlePositionRGBAImage;if(!$||$.width!==V){let ee=function(te){let ce=te*te,le=new Uint8Array(4*ce),Q=function(re){return re|=0,re=Math.imul(2747636419^re,2654435769),re=Math.imul(re^re>>>16,2654435769),((re=Math.imul(re^re>>>16,2654435769))>>>0)/4294967296},ne=1/1.3;for(let re=0;re<ce;re++){let pe=ne*(Q(2*re+0)+ps),Ee=ne*(Q(2*re+1)+ps),se=255*pe%1,Ie=255*Ee%1,De=se,je=Ee-Ie/255,Ue=Ie;le[4*re+0]=255*(pe-se/255),le[4*re+1]=255*De,le[4*re+2]=255*je,le[4*re+3]=255*Ue}return le}(V);$=S.particlePositionRGBAImage=new r.i({width:V,height:V},ee)}let G=S.particleFramebuffer;G?G.width!==V&&(G.destroy(),G=S.particleFramebuffer=O.createFramebuffer(V,V,!0,null)):G=S.particleFramebuffer=O.createFramebuffer(V,V,!0,null);let H=[];for(let ee of M){let te=E.getTile(ee);if(!(te instanceof r.c3))continue;let ce=bt(te,z,S);if(!ce)continue;let le=[te.tileSize,te.tileSize],Q=S.tileFramebuffer;Q||(Q=S.tileFramebuffer=O.createFramebuffer(le[0],le[1],!0,null));let ne=te.rasterParticleState;ne||(ne=te.rasterParticleState=new Ri(O,ee,le,$));let re=ne.update(S.lastInvalidatedAt);ne.particleTextureDimension!==V&&ne.updateParticleTexture(ee,$);let pe=ne.targetColorTexture;ne.targetColorTexture=ne.backgroundColorTexture,ne.backgroundColorTexture=pe;let Ee=ne.particleTexture0;ne.particleTexture0=ne.particleTexture1,ne.particleTexture1=Ee,H.push([ee,ce,ne,re])}if(H.length===0)return;let q=r.e.now(),J=S.previousDrawTimestamp?.001*(q-S.previousDrawTimestamp):.0167;if(S.previousDrawTimestamp=q,S.hasColorMap()){O.activeTexture.set(F.TEXTURE0+2);let ee=S.colorRampTexture;ee||(ee=S.colorRampTexture=new r.T(O,S.colorRamp,F.RGBA)),ee.bind(F.LINEAR,F.CLAMP_TO_EDGE)}O.bindFramebuffer.set(S.tileFramebuffer.framebuffer),function(ee,te,ce){let le=ee.context,Q=le.gl,ne=te.tileFramebuffer;le.activeTexture.set(Q.TEXTURE0);let re={u_texture:0,u_opacity:1.05*(Ee=te.paint.get("raster-particle-fade-opacity-factor"))/(Ee+.05)},pe=ee.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ee;for(let se of ce){let[,,Ie,De]=se;ne.colorAttachment.set(Ie.targetColorTexture.texture),le.viewport.set([0,0,ne.width,ne.height]),le.clear({color:r.C.transparent}),De&&(Ie.backgroundColorTexture.bind(Q.NEAREST,Q.CLAMP_TO_EDGE),pe.draw(ee,Q.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.alphaBlended,r.af.disabled,re,te.id,ee.viewportBuffer,ee.quadTriangleIndexBuffer,ee.viewportSegments))}}(w,S,H),function(ee,te,ce,le){let Q=ee.context,ne=Q.gl,re=ce.tileFramebuffer,pe=ee.transform.projection.name==="globe",Ee=ce.paint.get("raster-particle-max-speed");for(let se of le){let[Ie,De,je]=se;Q.activeTexture.set(ne.TEXTURE0+0),De.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),re.colorAttachment.set(je.targetColorTexture.texture);let Ue=ee.getOrCreateProgram("rasterParticleDraw",{defines:De.defines,overrideFog:!1});Q.activeTexture.set(ne.TEXTURE0+1);let Ne=De.scalarData?[]:[0,1,2,3].map(ke=>r.bZ[ke](Ie));Ne.push(Ie);let ve=Ie.canonical.x,Ae=Ie.canonical.y;for(let ke of Ne){let it=te.getTile(pe?ke.wrapped():ke);if(!it)continue;let lt=it.rasterParticleState;if(!lt)continue;let st=ke.canonical.x+(1<<ke.canonical.z)*(ke.wrap-Ie.wrap),ze=ke.canonical.y;lt.particleTexture0.bind(ne.NEAREST,ne.CLAMP_TO_EDGE);let $e=Gf(1,lt.particleTexture0.size[0],[st-ve,ze-Ae],0,De.texture.size,2,Ee,De.textureOffset,De.scale,De.offset);Ue.draw(ee,ne.POINTS,r.ae.disabled,r.ag.disabled,r.a.alphaBlended,r.af.disabled,$e,ce.id,lt.particleIndexBuffer,void 0,lt.particleSegment)}}}(w,E,S,H),O.bindFramebuffer.set(S.particleFramebuffer.framebuffer),function(ee,te,ce,le){let Q=ee.context,ne=Q.gl,re=te.paint.get("raster-particle-max-speed"),pe=le*te.paint.get("raster-particle-speed-factor")*.15,Ee=function(Ie){return Math.pow(Ie,6)}(.01+1*te.paint.get("raster-particle-reset-rate-factor")),se=te.particleFramebuffer;Q.viewport.set([0,0,se.width,se.height]);for(let Ie of ce){let[,De,je]=Ie;Q.activeTexture.set(ne.TEXTURE0+0),De.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),Q.activeTexture.set(ne.TEXTURE0+1);let Ue=je.particleTexture0;Ue.bind(ne.NEAREST,ne.CLAMP_TO_EDGE);let Ne=Kv(1,Ue.size[0],0,De.texture.size,re,pe,Ee,De.textureOffset,De.scale,De.offset);se.colorAttachment.set(je.particleTexture1.texture),Q.clear({color:r.C.transparent}),ee.getOrCreateProgram("rasterParticleUpdate",{defines:De.defines}).draw(ee,ne.TRIANGLES,r.ae.disabled,r.ag.disabled,r.a.unblended,r.af.disabled,Ne,te.id,ee.viewportBuffer,ee.quadTriangleIndexBuffer,ee.viewportSegments)}}(w,S,H,J)}(d,i,c,m),d.renderPass==="translucent"&&(function(w,E,S,M,O){let F=w.context,z=F.gl,V=!w.options.moving,$=w.transform.projection.name==="globe";if(!M.length)return;let[G,H]=w.stencilConfigForOverlap(M),q=[];$&&q.push("PROJECTION_GLOBE_VIEW");let J=w.stencilModeFor3D();for(let ee of H){let te=ee.toUnwrapped(),ce=E.getTile(ee);if(!ce.rasterParticleState)continue;let le=ce.rasterParticleState,Q=100;ce.registerFadeDuration(Q);let ne=E.findLoadedParent(ee,0),re=bh(ce,ne,E,w.transform,Q),pe,Ee;w.terrain&&w.terrain.prepareDrawTile(),F.activeTexture.set(z.TEXTURE0),le.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),F.activeTexture.set(z.TEXTURE1),ne&&ne.rasterParticleState?(ne.rasterParticleState.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),pe=Math.pow(2,ne.tileID.overscaledZ-ce.tileID.overscaledZ),Ee=[ce.tileID.canonical.x*pe%1,ce.tileID.canonical.y*pe%1]):le.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);let se=$?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(te,V),Ie=w.transform,De=Ng(Ie),je=r.bc(ee.canonical),Ue=r.bd(je.getCenter().lat),Ne,ve,Ae,ke,it;$?(Ne=Float32Array.from(r.bf(r.bg(ee.canonical))),ve=Float32Array.from(Ie.globeMatrix),Ae=Float32Array.from(r.bb(Ie)),ke=[r.aj(Ie.center.lng),r.ak(Ie.center.lat)],it=Float32Array.from(r.be(ee.canonical,je,Ue,Ie.worldSize/Ie._pixelsPerMercatorPixel))):(Ne=new Float32Array(16),ve=new Float32Array(9),Ae=new Float32Array(16),ke=[0,0],it=new Float32Array(9));let lt=$f(se,Ne,ve,Ae,it,Ee||[0,0],r.a1(w.transform.zoom),ke,De,pe||1,re,250),st=w.isTileAffectedByFog(ee),ze=w.getOrCreateProgram("rasterParticle",{defines:q,overrideFog:st});if(w.uploadCommonUniforms(F,ze,te),$){let $e=new r.ae(z.LEQUAL,r.ae.ReadWrite,w.depthRangeFor3D),ot=0,ft=w.globeSharedBuffers;if(ft){let[At,Bt,tn]=ft.getGridBuffers(Ue,ot!==0);ze.draw(w,z.TRIANGLES,$e,J,r.a.alphaBlended,r.af.backCCW,lt,S.id,At,Bt,tn)}}else{let $e=w.depthModeForSublayer(0,r.ae.ReadOnly),ot=G[ee.overscaledZ],{tileBoundsBuffer:ft,tileBoundsIndexBuffer:At,tileBoundsSegments:Bt}=w.getTileBoundsBuffers(ce);ze.draw(w,z.TRIANGLES,$e,ot,r.a.alphaBlended,r.af.disabled,lt,S.id,ft,At,Bt)}}w.resetStencilClippingMasks()}(d,i,c,m),d.style.map.triggerRepaint())},background:function(d,i,c,m){let v=c.paint.get("background-color"),x=c.paint.get("background-opacity"),w=c.paint.get("background-emissive-strength");if(x===0)return;let E=d.context,S=E.gl,M=d.transform,O=M.tileSize,F=c.paint.get("background-pattern"),z;if(F!==void 0&&(F===null||(z=d.imageManager.getPattern(F.toString(),c.scope,d.style.getLut(c.scope)),!z)))return;let V=!F&&v.a===1&&x===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==V)return;let $=r.ag.disabled,G=d.depthModeForSublayer(0,V==="opaque"?r.ae.ReadWrite:r.ae.ReadOnly),H=d.colorModeForDrapableLayerRenderPass(w),q=F?"backgroundPattern":"background",J,ee=m;ee||(J=d.getBackgroundTiles(),ee=Object.values(J).map(te=>te.tileID)),F&&(E.activeTexture.set(S.TEXTURE0),d.imageManager.bind(d.context,c.scope));for(let te of ee){let ce=d.isTileAffectedByFog(te),le=d.getOrCreateProgram(q,{overrideFog:ce}),Q=te.toUnwrapped(),ne=m?te.projMatrix:d.transform.calculateProjMatrix(Q);d.prepareDrawTile();let re=i?i.getTile(te):J?J[te.key]:new r.by(te,O,M.zoom,d),pe=F?Pg(ne,w,x,d,0,c.scope,z,{tileID:te,tileSize:O}):Lc(ne,w,x,v.toRenderColor(c.lut));d.uploadCommonUniforms(E,le,Q);let{tileBoundsBuffer:Ee,tileBoundsIndexBuffer:se,tileBoundsSegments:Ie}=d.getTileBoundsBuffers(re);le.draw(d,S.TRIANGLES,G,$,H,r.af.disabled,pe,c.id,Ee,se,Ie)}},sky:function(d,i,c){let m=d._atmosphere?r.a1(d.transform.zoom):1,v=c.paint.get("sky-opacity")*m;if(v===0)return;let x=d.context,w=c.paint.get("sky-type"),E=new r.ae(x.gl.LEQUAL,r.ae.ReadOnly,[0,1]),S=d.frameCounter/1e3%1;w==="atmosphere"?d.renderPass==="offscreen"?c.needsSkyboxCapture(d)&&(function(M,O,F,z){let V=M.context,$=V.gl,G=O.skyboxFbo;if(!G){G=O.skyboxFbo=V.createFramebuffer(32,32,!0,null),O.skyboxGeometry=new gl(V),O.skyboxTexture=V.gl.createTexture(),$.bindTexture($.TEXTURE_CUBE_MAP,O.skyboxTexture),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MAG_FILTER,$.LINEAR);for(let ee=0;ee<6;++ee)$.texImage2D($.TEXTURE_CUBE_MAP_POSITIVE_X+ee,0,$.RGBA,32,32,0,$.RGBA,$.UNSIGNED_BYTE,null)}V.bindFramebuffer.set(G.framebuffer),V.viewport.set([0,0,32,32]);let H=O.getCenter(M,!0),q=M.getOrCreateProgram("skyboxCapture"),J=new Float64Array(16);r.ad.identity(J),r.ad.rotateY(J,J,.5*-Math.PI),wo(M,O,q,J,H,0),r.ad.identity(J),r.ad.rotateY(J,J,.5*Math.PI),wo(M,O,q,J,H,1),r.ad.identity(J),r.ad.rotateX(J,J,.5*-Math.PI),wo(M,O,q,J,H,2),r.ad.identity(J),r.ad.rotateX(J,J,.5*Math.PI),wo(M,O,q,J,H,3),r.ad.identity(J),wo(M,O,q,J,H,4),r.ad.identity(J),r.ad.rotateY(J,J,Math.PI),wo(M,O,q,J,H,5),V.viewport.set([0,0,M.width,M.height])}(d,c),c.markSkyboxValid(d)):d.renderPass==="sky"&&function(M,O,F,z,V){let $=M.context,G=$.gl,H=M.transform,q=M.getOrCreateProgram("skybox");$.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,O.skyboxTexture);let J=((ee,te,ce,le,Q)=>({u_matrix:ee,u_sun_direction:te,u_cubemap:0,u_opacity:le,u_temporal_offset:Q}))(H.skyboxMatrix,O.getCenter(M,!1),0,z,V);M.uploadCommonUniforms($,q),q.draw(M,G.TRIANGLES,F,r.ag.disabled,M.colorModeForRenderPass(),r.af.backCW,J,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(d,c,E,v,S):w==="gradient"&&d.renderPass==="sky"&&function(M,O,F,z,V){let $=M.context,G=$.gl,H=M.transform,q=M.getOrCreateProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new gl($)),$.activeTexture.set(G.TEXTURE0);let J=O.colorRampTexture;J||(J=O.colorRampTexture=new r.T($,O.colorRamp,G.RGBA)),J.bind(G.LINEAR,G.CLAMP_TO_EDGE);let ee=((te,ce,le,Q,ne)=>({u_matrix:te,u_color_ramp:0,u_center_direction:ce,u_radius:r.ab(le),u_opacity:Q,u_temporal_offset:ne}))(H.skyboxMatrix,O.getCenter(M,!1),O.paint.get("sky-gradient-radius"),z,V);M.uploadCommonUniforms($,q),q.draw(M,G.TRIANGLES,F,r.ag.disabled,M.colorModeForRenderPass(),r.af.backCW,ee,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(d,c,E,v,S)},debug:function(d,i,c,m,v,x){for(let w=0;w<c.length;w++)if(v){let M=new r.C(m.r*.8,m.g*.8,m.b*.8,1);dt(d,i,c[w],m,-1,-1,x),dt(d,i,c[w],m,-1,1,x),dt(d,i,c[w],m,1,1,x),dt(d,i,c[w],m,1,-1,x),dt(d,i,c[w],M,0,0,x)}else dt(d,i,c[w],m,0,0,x)},custom:function(d,i,c,m){let v=d.context,x=c.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&c.isDraped(i)){if(d.renderPass==="offscreen"){let w=x.prerender;if(w){if(d.setCustomLayerDefaults(),v.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){let E=d.transform.pointMerc;w.call(x,v.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),r.a1(d.transform.zoom),[E.x,E.y],d.transform.pixelsPerMeterRatio)}else w.call(x,v.gl,d.transform.customLayerMatrix());v.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){let E=x.renderToTile;if(E){let S=m[0].canonical,M=new r.Y(S.x+m[0].wrap*(1<<S.z),S.y,S.z);v.setDepthMode(r.ae.disabled),v.setStencilMode(r.ag.disabled),v.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),E.call(x,v.gl,M),v.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),v.setColorMode(d.colorModeForRenderPass()),v.setStencilMode(r.ag.disabled);let w=x.renderingMode==="3d"?new r.ae(d.context.gl.LEQUAL,r.ae.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,r.ae.ReadOnly);if(v.setDepthMode(w),d.transform.projection.name==="globe"){let E=d.transform.pointMerc;x.render(v.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),r.a1(d.transform.zoom),[E.x,E.y],d.transform.pixelsPerMeterRatio)}else x.render(v.gl,d.transform.customLayerMatrix());v.setDirty(),d.setBaseState(),v.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,i,c,m){if(d.renderPass==="opaque")return;let v=c.paint.get("model-opacity");if(v===0)return;let x=c.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!x||d.terrain&&v<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof r.Z))return;let w=d.shadowRenderer,E=c.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,E||(w.enabled=!1));let S=()=>{w&&(w.useNormalOffset=!0,E||(w.enabled=!0))},M=i.getSource();if(d.renderPass==="light-beam"&&M.type!=="batched-model")return;if(M.type==="vector"||M.type==="geojson")return function(q,J,ee,te,ce){let le=q.transform;if(le.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${le.projection.name} projection is not yet implemented`);let Q=le.getFreeCameraOptions().position;if(!q.modelManager)return;let ne=q.modelManager;ee.modelManager=ne;let re=q.shadowRenderer;if(!ee._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let pe=ee._unevaluatedLayout._values["model-id"],Ee=kt({},ee.layout.get("model-id").parameters),se=q.style.order.indexOf(ee.fqid);for(let Ie of te){let De=J.getTile(Ie).getBucket(ee);if(!De||De.projection.name!==le.projection.name)continue;let je=De.getModelUris();je&&!De.modelsRequested&&(ne.addModelsFromBucket(je,ce),De.modelsRequested=!0);let Ue=mr(Ie,le);Ee.zoom=Ue;let Ne=pe.possiblyEvaluate(Ee);if(zg(q,De,Ie),di.shadowUniformsInitialized=!1,di.useSingleShadowCascade=!!re&&re.getMaxCascadeForTile(Ie.toUnwrapped())===0,q.renderPass==="shadow"&&re){if(q.currentShadowCascade===1&&De.isInsideFirstShadowMapFrustum)continue;let ke=le.calculatePosMatrix(Ie.toUnwrapped(),le.worldSize);if(di.tileMatrix.set(ke),di.shadowTileMatrix=Float32Array.from(re.calculateShadowPassMatrixFromMatrix(ke)),di.aabb.min.fill(0),di.aabb.max[0]=di.aabb.max[1]=r.a3,di.aabb.max[2]=0,wr(De,di,q,ee.scope))continue}let ve=1<<Ie.canonical.z,Ae=[((Q.x-Ie.wrap)*ve-Ie.canonical.x)*r.a3,(Q.y*ve-Ie.canonical.y)*r.a3,Q.z*ve*r.a3];q.conflationActive&&Object.keys(De.instancesPerModel).length>0&&q.style.isLayerClipped(ee,J.getSource())&&De.updateReplacement(Ie,q.replacementSource,se)&&(De.uploaded=!1,De.upload(q.context));for(let ke in De.instancesPerModel){let it=De.instancesPerModel[ke];it.features.length>0&&(ke=Ne.evaluate(it.features[0].feature,{}));let lt=ne.getModel(ke,ce);if(lt&&lt.uploaded)for(let st of lt.nodes)Fi(q,ee,st,it,Ae,Ie,di)}}}(d,i,c,m,M.type==="vector"?c.scope:""),void S();if(!M.loaded())return;if(M.type==="batched-model")return function(q,J,ee,te){ee.resetLayerRenderingStats(q);let ce=q.context,le=q.transform,Q=q.style.fog,ne=q.shadowRenderer;if(le.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${le.projection.name} projection is not yet implemented`);let re=q.transform.getFreeCameraOptions().position,pe=r._.scale([],[re.x,re.y,re.z],q.transform.worldSize);r._.negate(pe,pe);let Ee=r.ad.identity([]),se=r.cg(le.center.lat,le.zoom),Ie=r.ad.fromScaling([],[1,1,1/se]);r.ad.translate(Ee,Ee,pe);let De=ee.paint.get("model-opacity"),je=new r.ae(ce.gl.LEQUAL,r.ae.ReadWrite,q.depthRangeFor3D),Ue=new r.ae(ce.gl.LEQUAL,r.ae.ReadOnly,q.depthRangeFor3D),Ne=new r.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ve=q.renderPass==="shadow",Ae=ve&&ne?ne.getCurrentCascadeFrustum():le.getFrustum(le.scaleZoom(le.worldSize)),ke=ee.paint.get("model-front-cutoff"),it=ke[2]<1,lt=ko(q,ee.paint.get("model-cutoff-fade-range")),st=ee.getLayerRenderingStats();(function(ze,$e,ot,ft){let At=ze.terrain?ze.terrain.exaggeration():0,Bt=ze.transform.zoom;for(let tn of ft){let Kt=$e.getTile(tn).getBucket(ot);Kt&&(ze.conflationActive&&Kt.updateReplacement(tn,ze.replacementSource),Kt.evaluateScale(ze,ot),ze.terrain&&At>0&&Kt.elevationUpdate(ze.terrain,At,tn,ot.source),Kt.needsReEvaluation(ze,Bt,ot)&&Kt.evaluate(ot))}})(q,J,ee,te),function(){let ze,$e,ot;it?(ze=te.length-1,$e=-1,ot=-1):(ze=0,$e=te.length,ot=1);for(let ft=ze;ft!==$e;ft+=ot){let At=te[ft],Bt=J.getTile(At).getBucket(ee);if(!Bt||!Bt.uploaded)continue;let tn=!1;ne&&(tn=ne.getMaxCascadeForTile(At.toUnwrapped())===0);let Kt=le.calculatePosMatrix(At.toUnwrapped(),le.worldSize),In=Bt.modelTraits,Lt=[];for(let bn of Bt.getNodesInfo()){if(bn.hiddenByReplacement||!bn.node.meshes)continue;let kn=bn.node,Dn=0;q.terrain&&kn.elevation&&(Dn=kn.elevation*q.terrain.exaggeration());let Zt=bn.evaluatedScale;if(Zt[0]<=1&&Zt[1]<=1&&Zt[2]<=1&&(()=>{let Te=bn.aabb;return Ne.min=[...Te.min],Ne.max=[...Te.max],Ne.min[2]+=Dn,Ne.max[2]+=Dn,r._.transformMat4(Ne.min,Ne.min,Kt),r._.transformMat4(Ne.max,Ne.max,Kt),Ne})().intersects(Ae)===0)continue;let Ft=[...Kt],Vn=kn.anchor?kn.anchor[0]:0,$n=kn.anchor?kn.anchor[1]:0;r.ad.translate(Ft,Ft,[Vn*(Zt[0]-1),$n*(Zt[1]-1),Dn]),r._.exactEquals(Zt,r.cj)||r.ad.scale(Ft,Ft,Zt);let nn=r.ad.multiply([],Ft,kn.matrix),Fe=r.ad.multiply([],le.expandedFarZProjMatrix,nn),ut=r.ad.multiply([],le.expandedFarZProjMatrix,Ft),vr=r.aA.transformMat4([],[Vn,$n,Dn,1],Fe)[2];kn.hidden=!1;let Cn=De;ve||(it&&(Cn*=Ji(Ft,le,bn.aabb,ke)),Cn*=Qf(lt,vr)),Cn!==0?Lt.push({nodeInfo:bn,depth:vr,opacity:Cn,wvpForNode:Fe,wvpForTile:ut,nodeModelMatrix:nn,tileModelMatrix:Ft}):kn.hidden=!0}ve||Lt.sort((bn,kn)=>!it||bn.opacity===1&&kn.opacity===1?bn.depth<kn.depth?-1:1:bn.opacity===1?-1:kn.opacity===1?1:bn.depth>kn.depth?-1:1);for(let bn of Lt){let kn=bn.nodeInfo,Dn=kn.node,Zt=r.ad.multiply([],Ie,bn.tileModelMatrix);r.ad.multiply(Zt,Ee,Zt);let Ft=r.ad.invert([],Zt);r.ad.transpose(Ft,Ft),r.ad.scale(Ft,Ft,No),Zt=r.ad.multiply(Zt,Zt,Dn.matrix);let Vn=q.renderPass==="light-beam",$n=In&r.cl.HasMapboxMeshFeatures,nn=$n?0:kn.evaluatedRMEA[0][2];for(let Fe=0;Fe<Dn.meshes.length;++Fe){let ut=Dn.meshes[Fe],vr=Fe===Dn.lightMeshIndex,Cn=bn.wvpForNode;if(vr){if(!Vn&&!q.terrain&&q.shadowRenderer){q.currentLayer<q.firstLightBeamLayer&&(q.firstLightBeamLayer=q.currentLayer);continue}Cn=bn.wvpForTile}else if(Vn)continue;let Te={defines:[]},fi=[];if(jc(Te.defines,fi,ut,q,ee.lut),$n||Te.defines.push("DIFFUSE_SHADED"),tn&&Te.defines.push("SHADOWS_SINGLE_CASCADE"),st&&(ve?st.numRenderedVerticesInShadowPass+=ut.vertexArray.length:st.numRenderedVerticesInTransparentPass+=ut.vertexArray.length),ve){hi(ut,bn.nodeModelMatrix,q,ee);continue}let Yr=null;if(Q){let ws=_l(bn.nodeModelMatrix,q.transform);if(Yr=new Float32Array(ws),le.projection.name!=="globe"){let Ts=ut.aabb.min,Bo=ut.aabb.max,[Eo,Vo]=Q.getOpacityForBounds(ws,Ts[0],Ts[1],Bo[0],Bo[1]);Te.overrideFog=Eo>=Wn||Vo>=Wn}}let Tr=ut.material,oi;Tr.occlusionTexture&&Tr.occlusionTexture.offsetScale&&(oi=Tr.occlusionTexture.offsetScale,Te.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!ve&&ne&&(ne.useNormalOffset=!!ut.normalBuffer);let vi=q.getOrCreateProgram("model",Te);!ve&&ne&&ne.setupShadowsFromMatrix(bn.tileModelMatrix,vi,ne.useNormalOffset),q.uploadCommonUniforms(ce,vi,null,Yr);let zi=Tr.pbrMetallicRoughness;zi.metallicFactor=.9,zi.roughnessFactor=.5;let Ci=Fc(new Float32Array(Cn),new Float32Array(Zt),new Float32Array(Ft),new Float32Array(Dn.matrix),q,bn.opacity,zi.baseColorFactor.toRenderColor(null),Tr.emissiveFactor,zi.metallicFactor,zi.roughnessFactor,Tr,nn,ee,[0,0,0],oi);!vr&&(kn.hasTranslucentParts||bn.opacity<1)&&vi.draw(q,ce.gl.TRIANGLES,je,r.ag.disabled,r.a.disabled,r.af.backCCW,Ci,ee.id,ut.vertexBuffer,ut.indexBuffer,ut.segments,ee.paint,q.transform.zoom,void 0,fi),vi.draw(q,ce.gl.TRIANGLES,vr?Ue:je,r.ag.disabled,vr||bn.opacity<1||kn.hasTranslucentParts?r.a.alphaBlended:r.a.unblended,r.af.backCCW,Ci,ee.id,ut.vertexBuffer,ut.indexBuffer,ut.segments,ee.paint,q.transform.zoom,void 0,fi)}}}}()}(d,i,c,m),void S();let O=M.getModels(),F=[],z=d.transform.getFreeCameraOptions().position,V=r._.scale([],[z.x,z.y,z.z],d.transform.worldSize);r._.negate(V,V);let $=[],G=[],H=0;for(let q of O){let J=c.paint.get("model-rotation").constantOr(null),ee=c.paint.get("model-scale").constantOr(null),te=c.paint.get("model-translation").constantOr(null);q.computeModelMatrix(d,J,ee,te,!0,!0,!1);let ce=r.ad.identity([]),le=r.cg(q.position.lat,d.transform.zoom),Q=r.ad.fromScaling([],[1,1,1/le]);r.ad.translate(ce,ce,V),F.push({zScaleMatrix:Q,negCameraPosMatrix:ce});for(let ne of q.nodes)Zr(d.transform,ne,q.matrix,d.transform.expandedFarZProjMatrix,H,$,G);H++}if($.sort((q,J)=>J.depth-q.depth),d.renderPass!=="shadow"){if(v===1)for(let q of G)aa(q,d,c,F[q.modelIndex],r.ag.disabled,d.colorModeForRenderPass());else{for(let q of G)aa(q,d,c,F[q.modelIndex],r.ag.disabled,r.a.disabled);for(let q of G)aa(q,d,c,F[q.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(let q of $)aa(q,d,c,F[q.modelIndex],r.ag.disabled,d.colorModeForRenderPass());S()}else{for(let q of G)hi(q.mesh,q.nodeModelMatrix,d,c);for(let q of $)hi(q.mesh,q.nodeModelMatrix,d,c);S()}}},Bg={model:function(d,i,c){let m=i.getSource();if(!m.loaded())return;if(m.type==="vector"||m.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,m.type==="vector"?d.scope:""));if(m.type==="batched-model")return;let v=m.getModels();for(let x of v)x.upload(c.context)},raster:function(d,i,c){let m=i.getSource();if(!(m instanceof al&&m.loaded()))return;let v=d.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!v)return;let x=d.paint.get("raster-array-band")||m.getInitialBand(v);if(x==null)return;let w=i.getIds().map(E=>i.getTileByID(E));for(let E of w)E.updateNeeded(v,x)&&m.prepareTile(E,v,x)},"raster-particle":function(d,i,c){let m=i.getSource();if(!(m instanceof al&&m.loaded()))return;let v=d.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!v)return;let x=d.paint.get("raster-particle-array-band")||m.getInitialBand(v);if(x==null)return;let w=i.getIds().map(E=>i.getTileByID(E));for(let E of w)E.updateNeeded(v,x)&&m.prepareTile(E,v,x)}};class Vg{constructor(i,c,m,v){this.context=new yc(i,c),this.occlusionBuffers=new rx(this.context),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=r.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let w of x)this._debugParams.enabledLayers[w]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let w of x)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],w);this.symbolParams=new Za(v),this.setup(),this.numSublayers=r.bv.maxUnderzooming+r.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new yh(this),this._wireframeDebugCache=new $c,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(i,c){let m=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Nf(this,i));let v=this._terrain;this.transform.elevation=m?v:null,v.update(i,this.transform,c),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(i){let c=i.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[m,v]=c.getFovAdjustedRange(this.transform._fov);if(m>v)return void(this.transform.fogCullDistSq=null);let x=m+.78*(v-m);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new Nf(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,c){if(this.width=i*r.e.devicePixelRatio,this.height=c*r.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let m of this.style.order)this.style._mergedLayers[m].resize()}setup(){let i=this.context,c=new r.bt;c.emplaceBack(0,0),c.emplaceBack(r.a3,0),c.emplaceBack(0,r.a3),c.emplaceBack(r.a3,r.a3),this.tileExtentBuffer=i.createVertexBuffer(c,r.br.members),this.tileExtentSegments=r.b.simpleSegment(0,0,4,2);let m=new r.bt;m.emplaceBack(0,0),m.emplaceBack(r.a3,0),m.emplaceBack(0,r.a3),m.emplaceBack(r.a3,r.a3),this.debugBuffer=i.createVertexBuffer(m,r.br.members),this.debugSegments=r.b.simpleSegment(0,0,4,5);let v=new r.bt;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(v,r.br.members),this.viewportSegments=r.b.simpleSegment(0,0,4,2);let x=new r.cp;x.emplaceBack(0,0,0,0),x.emplaceBack(r.a3,0,r.a3,0),x.emplaceBack(0,r.a3,0,r.a3),x.emplaceBack(r.a3,r.a3,r.a3,r.a3),this.mercatorBoundsBuffer=i.createVertexBuffer(x,r.cq.members),this.mercatorBoundsSegments=r.b.simpleSegment(0,0,4,2);let w=new r.bu;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(w);let E=new r.cr;for(let M of[0,1,3,2,0])E.emplaceBack(M);this.debugIndexBuffer=i.createIndexBuffer(E),this.emptyTexture=new r.T(i,new r.i({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=r.ad.create();let S=this.context.gl;this.stencilClearMode=new r.ag({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,r.ae.disabled,this.stencilClearMode,r.a.disabled,r.af.disabled,xh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,c,m){if(!c||this.currentStencilSource===c.id||!i.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(let S of m)if(this._tileClippingMaskIDs[S.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=c.id;let v=this.context,x=v.gl;this.nextStencilID+m.length>256&&this.clearStencil(),v.setColorMode(r.a.disabled),v.setDepthMode(r.ae.disabled);let w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let E of m){let S=c.getTile(E),M=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:F,tileBoundsSegments:z}=this.getTileBoundsBuffers(S);w.draw(this,x.TRIANGLES,r.ae.disabled,new r.ag({func:x.ALWAYS,mask:0},M,255,x.KEEP,x.KEEP,x.REPLACE),r.a.disabled,r.af.disabled,xh(E.projMatrix),"$clipping",O,F,z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let i=this.nextStencilID++,c=this.context.gl;return new r.ag({func:c.NOTEQUAL,mask:255},i,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);let c=this.context.gl;return new r.ag({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(i){let c=this.context.gl,m=i.sort((w,E)=>E.overscaledZ-w.overscaledZ),v=m[m.length-1].overscaledZ,x=m[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();let w={};for(let E=0;E<x;E++)w[E+v]=new r.ag({func:c.GEQUAL,mask:255},E+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=x,[w,m]}return[{[v]:r.ag.disabled},m]}colorModeForRenderPass(){let i=this.context.gl;return this._showOverdrawInspector?new r.a([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new r.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?r.a.unblended:r.a.alphaBlended}colorModeForDrapableLayerRenderPass(i){let c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new r.a([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new r.C(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,c,m,v=!1){if(this.depthOcclusion)return new r.ae(this.context.gl.GREATER,r.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return r.ae.disabled;let x=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new r.ae(m||this.context.gl.LEQUAL,c,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,c)=>i+c/this._fpsHistory.length,0))}render(i,c){let m=r.e.now();this._dt=m-this._timeStamp,this._timeStamp=m,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=c;let v=this.style._mergedLayers,x=this.style.order.filter(ne=>{let re=v[ne];return!(re.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[re.type]}),w=x.map(ne=>v[ne]),E=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(r.e.now()),this.imageManager.beginFrame();let S=0,M=!1;for(let ne in E){let re=E[ne];re.used&&(re.prepare(this.context),re.getSource().usedInConflation&&++S)}let O=!1;for(let ne of w)ne.isHidden(this.transform.zoom)||(ne.type==="clip"&&(O=!0),this.prepareLayer(ne));let F={},z={},V={},$={},G={};for(let ne in E){let re=E[ne];F[ne]=re.getVisibleCoordinates(),z[ne]=F[ne].slice().reverse(),V[ne]=re.getVisibleCoordinates(!0).reverse(),$[ne]=re.getShadowCasterCoordinates(),G[ne]=re.sortCoordinatesByDistance(F[ne])}let H=ne=>{let re=this.style.getLayerSourceCache(ne);return re&&re.used?re.getSource():null};if(S||O){let ne=[],re=[],pe=0;for(let Ee of w)this.isSourceForClippingOrConflation(Ee,H(Ee))&&(ne.push(Ee),re.push(pe)),pe++;if(ne&&(O||ne.length>1)){let Ee=[];for(let se=0;se<ne.length;se++){let Ie=ne[se],De=re[se],je=this.style.getLayerSourceCache(Ie);if(!je||!je.used||!je.getSource().usedInConflation&&Ie.type!=="clip")continue;let Ue=1/0,Ne=r.cu.None;if(Ie.type==="clip"){Ue=De;for(let ve of Ie.layout.get("clip-layer-types"))Ne|=ve==="model"?r.cu.Model:ve==="symbol"?r.cu.Symbol:r.cu.FillExtrusion}Ee.push({layer:Ie.fqid,cache:je,order:Ue,clipMask:Ne})}this.replacementSource.setSources(Ee),M=!0}}M||this.replacementSource.clear(),this.conflationActive=M,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ne=0;ne<w.length;ne++){let re=w[ne],pe=re.cutoffRange();if(this.longestCutoffRange=Math.max(pe,this.longestCutoffRange),pe>0){let Ee=H(re);Ee&&(this.minCutoffZoom=Math.max(Ee.minzoom,this.minCutoffZoom)),re.minzoom&&(this.minCutoffZoom=Math.max(re.minzoom,this.minCutoffZoom))}re.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ne),this._lastOcclusionLayer=ne)}let q=this.style&&this.style.fog;q?(this._fogVisible=q.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=q.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(V),this.opaquePassCutoff=0);let J=this._shadowRenderer;if(J){J.updateShadowParameters(this.transform,this.style.directionalLight);for(let ne in E)for(let re of F[ne]){let pe={min:0,max:0};this.terrain&&(pe=this.terrain.getMinMaxForTile(re)||pe),J.addShadowReceiver(re.toUnwrapped(),pe.min,pe.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Kf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!r.ct(this.context.gl))return;this.renderPass="offscreen";for(let ne of w){let re=i.getLayerSourceCache(ne);if(!ne.hasOffscreenPass()||ne.isHidden(this.transform.zoom))continue;let pe=re?z[re.id]:void 0;(ne.type==="custom"||ne.type==="raster"||ne.type==="raster-particle"||ne.isSky()||pe&&pe.length)&&this.renderLayer(this,re,ne,pe)}this.depthRangeFor3D=[0,1-(w.length+2)*this.numSublayers*this.depthEpsilon];let ee=this.terrain;ee&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&ee.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,$)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let te=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ce=(()=>{if(c.showOverdrawInspector)return r.C.black;let ne=this.style.fog;if(ne&&this.transform.projection.supportsFog){let re=this.style.getLut(ne.scope);if(!te){let pe=ne.properties.get("color").toRenderColor(re).toArray01();return new r.C(...pe)}if(te){let pe=ne.properties.get("space-color").toRenderColor(re).toArray01();return new r.C(...pe)}}return r.C.transparent})();if(this.context.clear({color:ce,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&te&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){let ne=w[this.currentLayer],re=i.getLayerSourceCache(ne);if(ne.isSky())continue;let pe=re?(ne.is3D()?G:z)[re.id]:void 0;this._renderTileClippingMasks(ne,re,pe),this.renderLayer(this,re,ne,pe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&te&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.a1(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){let ne=w[this.currentLayer],re=i.getLayerSourceCache(ne);ne.isSky()&&this.renderLayer(this,re,ne,re?z[re.id]:void 0)}function le(ne,re){let pe;return re&&(pe=(ne.type==="symbol"?V:ne.is3D()?G:z)[re.id]),pe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<x.length;){let ne=w[this.currentLayer];if(ne.type==="raster"){let re=i.getLayerSourceCache(ne);this.renderLayer(this,re,ne,le(ne,re))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Q=0;for(J&&(Q=J.getShadowCastingLayerCount());this.currentLayer<x.length;){let ne=w[this.currentLayer],re=i.getLayerSourceCache(ne);if(ne.isSky())++this.currentLayer;else if(ee&&this.style.isLayerDraped(ne)){if(ne.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=ee.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(ne.is3D()||this.terrain||this._renderTileClippingMasks(ne,re,re?F[re.id]:void 0),this.renderLayer(this,re,ne,le(ne,re)),!ee&&J&&Q>0&&ne.hasShadowPass()&&--Q==0&&(J.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let pe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=pe;this.currentLayer++){let Ee=w[this.currentLayer];if(!Ee.hasLightBeamPass())continue;let se=i.getLayerSourceCache(Ee);this.renderLayer(this,se,Ee,se?z[se.id]:void 0)}this.currentLayer=pe,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let pe=this.currentLayer;this.depthOcclusion=!0;for(let Ee of this.layersWithOcclusionOpacity){this.currentLayer=Ee;let se=w[this.currentLayer],Ie=i.getLayerSourceCache(se),De=Ie?z[Ie.id]:void 0;se.is3D()||this.terrain||this._renderTileClippingMasks(se,Ie,Ie?F[Ie.id]:void 0),this.renderLayer(this,Ie,se,De)}this.depthOcclusion=!1,this.currentLayer=pe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ne=null;w.forEach(re=>{let pe=i.getLayerSourceCache(re);pe&&!re.isHidden(this.transform.zoom)&&pe.getVisibleCoordinates().length&&(!ne||ne.getSource().maxzoom<pe.getSource().maxzoom)&&(ne=pe)}),ne&&this.options.showTileBoundaries&&eo.debug(this,ne,ne.getVisibleCoordinates(),r.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&eo.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ne){let re=ne.transform.padding;mn(ne,ne.transform.height-(re.top||0),3,Oh),mn(ne,re.bottom||0,3,Yf),gn(ne,re.left||0,3,bo),gn(ne,ne.transform.width-(re.right||0),3,Xf);let pe=ne.transform.centerPoint;(function(Ee,se,Ie,De){ui(Ee,se-1,Ie-10,2,20,De),ui(Ee,se-10,Ie-1,20,2,De)})(ne,pe.x,ne.transform.height-pe.y,pl)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),M||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);let{unsupportedLayers:c}=this.transform.projection,m=!c||!c.includes(i.type);if(Bg[i.type]&&(m||this.terrain&&i.type==="custom")){let v=this.style.getLayerSourceCache(i);Bg[i.type](i,v,this)}this.gpuTimingEnd()}renderLayer(i,c,m,v){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||m.type==="model"||m.type==="raster"||m.type==="raster-particle"||v&&v.length)&&(this.id=m.id,this.gpuTimingStart(m),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(m.type)&&(!i.terrain||m.type!=="custom")||m.type==="clip"||eo[m.type](i,c,m,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;let c=this.context.extTimerQuery,m=this.context.gl,v=this.gpuTimers[i.id];v||(v=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:m.createQuery()}),v.calls++,m.beginQuery(c.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let i=this.context.extTimerQuery,c=this.context.gl,m=c.createQuery();this.deferredRenderGpuTimeQueries.push(m),c.beginQuery(i.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){let i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){let c={};for(let m in i){let v=i[m],x=this.context.extTimerQuery,w=x.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(v.query),c[m]=w}return c}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;let c=this.context.extTimerQuery,m=this.context.gl,v=0;for(let x of i)v+=c.getQueryParameter(x,m.QUERY_RESULT)/1e6,c.deleteQueryEXT(x);return v}translatePosMatrix(i,c,m,v,x){if(!m[0]&&!m[1])return i;let w=x?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(w){let M=Math.sin(w),O=Math.cos(w);m=[m[0]*O-m[1]*M,m[0]*M+m[1]*O]}let E=[x?m[0]:r.bB(c,m[0],this.transform.zoom),x?m[1]:r.bB(c,m[1],this.transform.zoom),0],S=new Float32Array(16);return r.ad.translate(S,i,E),S}saveTileTexture(i){let c=i.size[0],m=this._tileTextures[c];m?m.push(i):this._tileTextures[c]=[i]}getTileTexture(i){let c=this._tileTextures[i];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,c,m){let v=m===void 0?this.terrain&&this.terrain.renderingToTexture:m,x=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||v||c!==void 0&&!c||x.push("FOG","FOG_DITHERING"),v&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(i,c){this.cache=this.cache||{};let m=c&&c.defines||[],v=c&&c.config,x=this.currentGlobalDefines(i,c&&c.overrideFog,c&&c.overrideRtt).concat(m),w=Pc.cacheKey(wg[i],i,x,v);return this.cache[w]||(this.cache[w]=new Pc(this.context,i,wg[i],v,Qv[i],x)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,c){if(this.style.enable3dLights()){let m=this.style.directionalLight,v=this.style.ambientLight;if(m&&v){let x=((w,E,S)=>{let M=w.properties.get("direction"),O=w.properties.get("color").toRenderColor(S.getLut(w.scope)).toArray01(),F=w.properties.get("intensity"),z=E.properties.get("color").toRenderColor(S.getLut(E.scope)).toArray01(),V=E.properties.get("intensity"),$=[M.x,M.y,M.z],G=r.bA(z,V),H=r.bA(O,F);return{u_lighting_ambient_color:G,u_lighting_directional_dir:$,u_lighting_directional_color:H,u_ground_radiance:Fo($,H,G)}})(m,v,this.style);c.setLightsUniformValues(i,x)}}}uploadCommonUniforms(i,c,m,v,x){if(this.uploadCommonLightUniforms(i,c),this.terrain&&this.terrain.renderingToTexture)return;let w=this.style.fog;if(w){let E=w.getOpacity(this.transform.pitch),S=((M,O,F,z,V,$,G,H,q,J,ee,te)=>{let ce=M.transform,le=O.properties.get("color").toRenderColor(M.style.getLut(O.scope)).toArray01();le[3]=z;let Q=M.frameCounter/1e3%1,[ne,re]=O.properties.get("vertical-range");return{u_fog_matrix:F?ce.calculateFogTileMatrix(F):te||M.identityMat,u_fog_range:O.getFovAdjustedRange(ce._fov),u_fog_color:le,u_fog_horizon_blend:O.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ne,re),re],u_fog_temporal_offset:Q,u_frustum_tl:V,u_frustum_tr:$,u_frustum_br:G,u_frustum_bl:H,u_globe_pos:q,u_globe_radius:J,u_viewport:ee,u_globe_transition:r.a1(ce.zoom),u_is_globe:+(ce.projection.name==="globe")}})(this,w,m,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.e.devicePixelRatio,this.transform.height*r.e.devicePixelRatio],v);c.setFogUniformValues(i,S)}x&&c.setCutoffUniformValues(i,x.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){let i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){let i=this.context.gl,c=i.createTexture();return i.bindTexture(i.TEXTURE_2D,c),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let i=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(let v of m)c[v.key]=i[v.key]||new r.by(v,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,c){return!(!i.is3D()||i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||i.sourceLayer!=="building")&&i.type!=="clip"&&(!c||c.type!=="batched-model"))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[i.key];return c||(this._cachedTileFogOpacities[i.key]=c=this.style.fog.getOpacityForTile(i)),c[0]>=Wn||c[1]>=Wn}}class ii{constructor(i,c,m,v){this.screenBounds=i,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(i,c){let m,v;if(i instanceof r.P||typeof i[0]=="number"){let x=r.P.convert(i);m=[x],v=c.isPointAboveHorizon(x)}else{let x=r.P.convert(i[0]),w=r.P.convert(i[1]);m=[x,w],v=r.cv(x,w).every(E=>c.isPointAboveHorizon(E))}return new ii(m,c.getCameraPoint(),v,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return r.cv(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){let c=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],v=r.cv(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?v[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(v[3]=this.cameraPoint)),r.cw(v,i)}bufferedCameraGeometryGlobe(i){let c=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],v=r.cv(c,m,i),x=this.cameraPoint.clone();switch(3*((x.y>c.y)+(x.y>m.y))+((x.x>c.x)+(x.x>m.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(i,c,m,v=0){let x=i.queryPadding/c._pixelsPerMercatorPixel+1,w=m?this._bufferedCameraMercator(x,c):this._bufferedScreenMercator(x,c),E=i.tileID.wrap+(w.unwrapped?v:0),S=w.polygon.map(H=>r.cx(i.tileTransform,H,E));if(!r.cy(S,0,0,r.a3,r.a3))return;E=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);let M=this.screenGeometryMercator.polygon.map(H=>r.cz(i.tileTransform,H,E)),O=M.map(H=>new r.P(H[0],H[1])),F=c.getFreeCameraOptions().position||new r.Y(0,0,0),z=r.cz(i.tileTransform,F,E),V=M.map(H=>{let q=r._.sub(H,H,z);return r._.normalize(q,q),new r.aT(z,q)}),$=r.bB(i,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:O,tilespaceRays:V,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(G=r.cA(S),G.min.x=r.at(G.min.x,0,r.a3),G.min.y=r.at(G.min.y,0,r.a3),G.max.x=r.at(G.max.x,0,r.a3),G.max.y=r.at(G.max.y,0,r.a3),G),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:$};var G}_bufferedScreenMercator(i,c){let m=ep(i);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let v;return v=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),c):{polygon:this.bufferedScreenGeometry(i).map(x=>c.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[m]=v,v}}_bufferedCameraMercator(i,c){let m=ep(i);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let v;return v=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),c):{polygon:this.bufferedCameraGeometry(i).map(x=>c.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[m]=v,v}}_projectAndResample(i,c){let m=function(x,w){let E=r.ad.multiply([],w.pixelMatrix,w.globeMatrix),S=[0,-r.cD,0,1],M=[0,r.cD,0,1],O=[0,0,0,1];r.aA.transformMat4(S,S,E),r.aA.transformMat4(M,M,E),r.aA.transformMat4(O,O,E);let F=new r.P(S[0]/S[3],S[1]/S[3]),z=new r.P(M[0]/M[3],M[1]/M[3]),V=r.cB(x,F)&&S[3]<O[3],$=r.cB(x,z)&&M[3]<O[3];if(!V&&!$)return null;let G=function(Q,ne,re){for(let pe=1;pe<Q.length;pe++){let Ee=ms(ne.pointCoordinate3D(Q[pe-1]).x),se=ms(ne.pointCoordinate3D(Q[pe]).x);if(re<0){if(Ee<se)return{idx:pe,t:-Ee/(se-1-Ee)}}else if(se<Ee)return{idx:pe,t:(1-Ee)/(se+1-Ee)}}return null}(x,w,V?-1:1);if(!G)return null;let{idx:H,t:q}=G,J=H>1?Jf(x.slice(0,H),w):[],ee=H<x.length?Jf(x.slice(H),w):[];J=J.map(Q=>new r.P(ms(Q.x),Q.y)),ee=ee.map(Q=>new r.P(ms(Q.x),Q.y));let te=[...J];te.length===0&&te.push(ee[ee.length-1]);let ce=r.a2(te[te.length-1].y,(ee.length===0?J[0]:ee[0]).y,q),le;return le=V?[new r.P(0,ce),new r.P(0,0),new r.P(1,0),new r.P(1,ce)]:[new r.P(1,ce),new r.P(1,1),new r.P(0,1),new r.P(0,ce)],te.push(...le),ee.length===0?te.push(J[0]):te.push(...ee),{polygon:te.map(Q=>new r.Y(Q.x,Q.y)),unwrapped:!1}}(i,c);if(m)return m;let v=function(x,w){let E=!1,S=-1/0,M=0;for(let F=0;F<x.length-1;F++)x[F].x>S&&(S=x[F].x,M=F);for(let F=0;F<x.length-1;F++){let z=(M+F)%(x.length-1),V=x[z],$=x[z+1];Math.abs(V.x-$.x)>.5&&(V.x<$.x?(V.x+=1,z===0&&(x[x.length-1].x+=1)):($.x+=1,z+1===x.length-1&&(x[0].x+=1)),E=!0)}let O=r.aj(w.center.lng);return E&&O<Math.abs(O-1)&&x.forEach(F=>{F.x-=1}),{polygon:x,unwrapped:E}}(Jf(i,c).map(x=>new r.P(ms(x.x),x.y)),c);return{polygon:v.polygon.map(x=>new r.Y(x.x,x.y)),unwrapped:v.unwrapped}}}function Jf(d,i){return r.cC(d,c=>{let m=i.pointCoordinate3D(c);c.x=m.x,c.y=m.y},1/256)}function ms(d){return d<0?1+d%1:d%1}function ep(d){return 100*d|0}function ix(d,i){let c=r.ad.identity([]);return r.ad.scale(c,c,[.5*d.width,.5*-d.height,1]),r.ad.translate(c,c,[1,-1,0]),r.ad.multiply(c,c,d.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(c)}function ox(d,i,c,m,v,x,w,E=!1){let S=d.tilesIn(m,w,E);S.sort(yl);let M=[];for(let F of S)M.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(i,c,d._state,F,v,x,ix(d.transform,F.tile.tileID),E)});let O=function(F){let z={},V={};for(let $ of F){let G=$.queryResults,H=$.wrappedTileID,q=V[H]=V[H]||{};for(let J in G){let ee=G[J],te=q[J]=q[J]||{},ce=z[J]=z[J]||[];for(let le of ee)te[le.featureIndex]||(te[le.featureIndex]=!0,ce.push(le))}}return z}(M);for(let F in O)O[F].forEach(z=>{let V=z.feature,$=V.layer;$&&$.type!=="background"&&$.type!=="sky"&&$.type!=="slot"&&(V.source=$.source,$["source-layer"]&&(V.sourceLayer=$["source-layer"]),V.state=V.id!==void 0?d.getFeatureState($["source-layer"],V.id):{})});return O}function Gc(d,i){let c=d.getRenderableIds().map(x=>d.getTileByID(x)),m=[],v={};for(let x=0;x<c.length;x++){let w=c[x],E=w.tileID.canonical.key;v[E]||(v[E]=!0,w.querySourceFeatures(m,i))}return m}function yl(d,i){let c=d.tileID,m=i.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}class sx{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let i=!1,c=!1;for(let m in this.style._mergedLayers){let v=this.style._mergedLayers[m];if(v.type==="fill-extrusion")this.layers.push({layer:v,visible:i,visibilityChanged:c});else if(v.type==="model"){let x=this.style.getLayerSource(v);x&&x.type==="batched-model"&&this.layers.push({layer:v,visible:i,visibilityChanged:c})}}}onNewFrame(i){this.layersGotHidden=!1;for(let c of this.layers){let m=c.layer,v=!1;m.type==="fill-extrusion"?v=!m.isHidden(i)&&m.paint.get("fill-extrusion-opacity")>0:m.type==="model"&&(v=!m.isHidden(i)&&m.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!v&&c.visible,c.visible=v}}updateZOffset(i,c){this.currentBuildingBuckets=[];for(let v of this.layers){let x=v.layer,w=this.style.getLayerSourceCache(x),E=1;x.type==="fill-extrusion"&&(E=v.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let S=w?w.getTile(c):null;if(!S&&w&&c.canonical.z>w.getSource().minzoom){let M=c.scaledTo(Math.min(w.getSource().maxzoom,c.overscaledZ-1));for(;M.overscaledZ>=w.getSource().minzoom&&(S=w.getTile(M),!S&&M.overscaledZ!==0);)M=M.scaledTo(M.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:S?S.getBucket(x):null,tileID:S?S.tileID:c,verticalScale:E})}i.hasAnyZOffset=!1;let m=!1;for(let v=0;v<i.symbolInstances.length;v++){let x=i.symbolInstances.get(v),w=x.zOffset,E=this._getHeightAtTileOffset(c,x.tileAnchorX,x.tileAnchorY);x.zOffset=E!==Number.NEGATIVE_INFINITY?E:w,m||w===x.zOffset||(m=!0),i.hasAnyZOffset||x.zOffset===0||(i.hasAnyZOffset=!0)}m&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,c,m,v){let x=c,w=m;if(i.canonical.z!==v.canonical.z){let E=v.canonical,S=1/(1<<i.canonical.z-E.z);x=(c+i.canonical.x*r.a3)*S-E.x*r.a3|0,w=(m+i.canonical.y*r.a3)*S-E.y*r.a3|0}return{tileX:x,tileY:w}}_getHeightAtTileOffset(i,c,m){let v,x;for(let w=0;w<this.layers.length;++w){if(this.layers[w].layer.type!=="fill-extrusion")continue;let{bucket:E,tileID:S,verticalScale:M}=this.currentBuildingBuckets[w];if(!E)continue;let{tileX:O,tileY:F}=this._mapCoordToOverlappingTile(i,c,m,S),z=E.getHeightAtTileCoord(O,F);z&&z.height!==void 0&&(z.hidden?v=z.height:x=Math.max(z.height*M,x||0))}if(x!==void 0)return x;for(let w=0;w<this.layers.length;++w){let E=this.layers[w];if(E.layer.type!=="model"||!E.visible)continue;let{bucket:S,tileID:M}=this.currentBuildingBuckets[w];if(!S)continue;let{tileX:O,tileY:F}=this._mapCoordToOverlappingTile(i,c,m,M),z=S.getHeightAtTileCoord(O,F);if(z&&!z.hidden)return z.height===void 0&&v!==void 0?Math.min(z.maxHeight,v)*z.verticalScale:z.height?z.height*z.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function vl(d,i){let c={};for(let m in d)m!=="ref"&&(c[m]=d[m]);return r.cE.forEach(m=>{m in i&&(c[m]=i[m])}),c}function tp(d){d=d.slice();let i=Object.create(null);for(let c=0;c<d.length;c++)i[d[c].id]=d[c];for(let c=0;c<d.length;c++)"ref"in d[c]&&(d[c]=vl(d[c],i[d[c].ref]));return d}let an={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function zo(d,i,c){c.push({command:an.addSource,args:[d,i[d]]})}function jg(d,i,c){i.push({command:an.removeSource,args:[d]}),c[d]=!0}function ax(d,i,c,m){jg(d,c,m),zo(d,i,c)}function lx(d,i,c){let m;for(m in d[c])if(d[c].hasOwnProperty(m)&&m!=="data"&&!C(d[c][m],i[c][m]))return!1;for(m in i[c])if(i[c].hasOwnProperty(m)&&m!=="data"&&!C(d[c][m],i[c][m]))return!1;return!0}function Hc(d,i,c,m,v,x){let w;for(w in i=i||{},d=d||{})d.hasOwnProperty(w)&&(C(d[w],i[w])||c.push({command:x,args:[m,w,i[w],v]}));for(w in i)i.hasOwnProperty(w)&&!d.hasOwnProperty(w)&&(C(d[w],i[w])||c.push({command:x,args:[m,w,i[w],v]}))}function kh(d){return d.id}function xl(d,i){return d[i.id]=i,d}class Ug{constructor(i,c){this.reset(i,c)}reset(i,c){this.points=i||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=r.at(i,0,1);let c=1,m=this._distances[c],v=i*this.paddedLength+this.padding;for(;m<v&&c<this._distances.length;)m=this._distances[++c];let x=c-1,w=this._distances[x],E=m-w,S=E>0?(v-w)/E:0;return this.points[x].mult(1-S).add(this.points[c].mult(S))}}class np{constructor(i,c,m){let v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(i/m),this.yCellCount=Math.ceil(c/m);for(let w=0;w<this.xCellCount*this.yCellCount;w++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=c,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,c,m,v,x){this._forEachCell(c,m,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(i,c,m,v){this._forEachCell(c-v,m-v,c+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(c),this.circles.push(m),this.circles.push(v)}_insertBoxCell(i,c,m,v,x,w){this.boxCells[x].push(w)}_insertCircleCell(i,c,m,v,x,w){this.circleCells[x].push(w)}_query(i,c,m,v,x,w){if(m<0||i>this.width||v<0||c>this.height)return!x&&[];let E=[];if(i<=0&&c<=0&&this.width<=m&&this.height<=v){if(x)return!0;for(let S=0;S<this.boxKeys.length;S++)E.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){let M=this.circles[3*S],O=this.circles[3*S+1],F=this.circles[3*S+2];E.push({key:this.circleKeys[S],x1:M-F,y1:O-F,x2:M+F,y2:O+F})}return w?E.filter(w):E}return this._forEachCell(i,c,m,v,this._queryCell,E,{hitTest:x,seenUids:{box:{},circle:{}}},w),x?E.length>0:E}_queryCircle(i,c,m,v,x){let w=i-m,E=i+m,S=c-m,M=c+m;if(E<0||w>this.width||M<0||S>this.height)return!v&&[];let O=[];return this._forEachCell(w,S,E,M,this._queryCellCircle,O,{hitTest:v,circle:{x:i,y:c,radius:m},seenUids:{box:{},circle:{}}},x),v?O.length>0:O}query(i,c,m,v,x){return this._query(i,c,m,v,!1,x)}hitTest(i,c,m,v,x){return this._query(i,c,m,v,!0,x)}hitTestCircle(i,c,m,v){return this._queryCircle(i,c,m,!0,v)}_queryCell(i,c,m,v,x,w,E,S){let M=E.seenUids,O=this.boxCells[x];if(O!==null){let z=this.bboxes;for(let V of O)if(!M.box[V]){M.box[V]=!0;let $=4*V;if(i<=z[$+2]&&c<=z[$+3]&&m>=z[$+0]&&v>=z[$+1]&&(!S||S(this.boxKeys[V]))){if(E.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[V],x1:z[$],y1:z[$+1],x2:z[$+2],y2:z[$+3]})}}}let F=this.circleCells[x];if(F!==null){let z=this.circles;for(let V of F)if(!M.circle[V]){M.circle[V]=!0;let $=3*V;if(this._circleAndRectCollide(z[$],z[$+1],z[$+2],i,c,m,v)&&(!S||S(this.circleKeys[V]))){if(E.hitTest)return w.push(!0),!0;{let G=z[$],H=z[$+1],q=z[$+2];w.push({key:this.circleKeys[V],x1:G-q,y1:H-q,x2:G+q,y2:H+q})}}}}}_queryCellCircle(i,c,m,v,x,w,E,S){let M=E.circle,O=E.seenUids,F=this.boxCells[x];if(F!==null){let V=this.bboxes;for(let $ of F)if(!O.box[$]){O.box[$]=!0;let G=4*$;if(this._circleAndRectCollide(M.x,M.y,M.radius,V[G+0],V[G+1],V[G+2],V[G+3])&&(!S||S(this.boxKeys[$])))return w.push(!0),!0}}let z=this.circleCells[x];if(z!==null){let V=this.circles;for(let $ of z)if(!O.circle[$]){O.circle[$]=!0;let G=3*$;if(this._circlesCollide(V[G],V[G+1],V[G+2],M.x,M.y,M.radius)&&(!S||S(this.circleKeys[$])))return w.push(!0),!0}}}_forEachCell(i,c,m,v,x,w,E,S){let M=this._convertToXCellCoord(i),O=this._convertToYCellCoord(c),F=this._convertToXCellCoord(m),z=this._convertToYCellCoord(v);for(let V=M;V<=F;V++)for(let $=O;$<=z;$++)if(x.call(this,i,c,m,v,this.xCellCount*$+V,w,E,S))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,c,m,v,x,w){let E=v-i,S=x-c,M=m+w;return M*M>E*E+S*S}_circleAndRectCollide(i,c,m,v,x,w,E){let S=(w-v)/2,M=Math.abs(i-(v+S));if(M>S+m)return!1;let O=(E-x)/2,F=Math.abs(c-(x+O));if(F>O+m)return!1;if(M<=S||F<=O)return!0;let z=M-S,V=F-O;return z*z+V*V<=m*m}}let to=100;class $g{constructor(i,c,m=new np(i.width+200,i.height+200,25),v=new np(i.width+200,i.height+200,25)){this.transform=i,this.grid=m,this.ignoredGrid=v,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+to,this.screenBottomBoundary=i.height+to,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=c}placeCollisionBox(i,c,m,v,x,w,E,S){let M=m.projectedAnchorX,O=m.projectedAnchorY,F=m.projectedAnchorZ,z=m.elevation,V=m.tileID,$=i.getProjection();if(z&&V){let[le,Q,ne]=$.upVector(V.canonical,m.tileAnchorX,m.tileAnchorY),re=$.upVectorScale(V.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;M+=le*z*re,O+=Q*z*re,F+=ne*z*re}let G=this.projectAndGetPerspectiveRatio(E,M,O,F,m.tileID,$.name==="globe"||!!z||this.transform.pitch>0,$),H=w*G.perspectiveRatio,q=(m.x1*c+v.x-m.padding)*H+G.point.x,J=(m.y1*c+v.y-m.padding)*H+G.point.y,ee=(m.x2*c+v.x+m.padding)*H+G.point.x,te=(m.y2*c+v.y+m.padding)*H+G.point.y,ce=G.perspectiveRatio<=.55||G.occluded;return!this.isInsideGrid(q,J,ee,te)||!x&&this.grid.hitTest(q,J,ee,te,S)||ce?{box:[],offscreen:!1,occluded:G.occluded}:{box:[q,J,ee,te],offscreen:this.isOffscreen(q,J,ee,te),occluded:!1}}placeCollisionCircles(i,c,m,v,x,w,E,S,M,O,F,z,V,$,G){let H=[],q=this.transform.elevation,J=i.getProjection(),ee=q?q.getAtTileOffsetFunc(G,this.transform.center.lat,this.transform.worldSize,J):null,te=new r.P(m.tileAnchorX,m.tileAnchorY),{x:ce,y:le,z:Q}=J.projectTilePoint(te.x,te.y,G.canonical);if(ee){let[Ne,ve,Ae]=ee(te);ce+=Ne,le+=ve,Q+=Ae}let ne=J.name==="globe",re=this.projectAndGetPerspectiveRatio(E,ce,le,Q,G,ne||!!q||this.transform.pitch>0,J),{perspectiveRatio:pe}=re,Ee=(F?w/pe:w*pe)/r.bN,se=Li(ce,le,Q,S),Ie=re.signedDistanceFromCamera>0?gh(Ee,x,m.lineOffsetX*Ee,m.lineOffsetY*Ee,!1,se,te,m,v,S,{},q&&!F?ee:null,F&&!!q,J,G,F):null,De=!1,je=!1,Ue=!0;if(Ie&&!re.occluded){let Ne=.5*V*pe+$,ve=new r.P(-100,-100),Ae=new r.P(this.screenRightBoundary,this.screenBottomBoundary),ke=new Ug,{first:it,last:lt}=Ie,st=it.path.length,ze=[];for(let ft=st-1;ft>=1;ft--)ze.push(it.path[ft]);for(let ft=1;ft<lt.path.length;ft++)ze.push(lt.path[ft]);let $e=2.5*Ne;M&&(ze=ze.map(([ft,At,Bt],tn)=>(ee&&!ne&&(Bt=ee(tn<st-1?it.tilePath[st-1-tn]:lt.tilePath[tn-st+2])[2]),Li(ft,At,Bt,M))),ze.some(ft=>ft[3]<=0)&&(ze=[]));let ot=[];if(ze.length>0){let ft=1/0,At=-1/0,Bt=1/0,tn=-1/0;for(let Kt of ze)ft=Math.min(ft,Kt[0]),Bt=Math.min(Bt,Kt[1]),At=Math.max(At,Kt[0]),tn=Math.max(tn,Kt[1]);At>=ve.x&&ft<=Ae.x&&tn>=ve.y&&Bt<=Ae.y&&(ot=[ze.map(Kt=>new r.P(Kt[0],Kt[1]))],(ft<ve.x||At>Ae.x||Bt<ve.y||tn>Ae.y)&&(ot=r.cF(ot,ve.x,ve.y,Ae.x,Ae.y)))}for(let ft of ot){ke.reset(ft,.25*Ne);let At=0;At=ke.length<=.5*Ne?1:Math.ceil(ke.paddedLength/$e)+1;for(let Bt=0;Bt<At;Bt++){let tn=Bt/Math.max(At-1,1),Kt=ke.lerp(tn),In=Kt.x+to,Lt=Kt.y+to;H.push(In,Lt,Ne,0);let bn=In-Ne,kn=Lt-Ne,Dn=In+Ne,Zt=Lt+Ne;if(Ue=Ue&&this.isOffscreen(bn,kn,Dn,Zt),je=je||this.isInsideGrid(bn,kn,Dn,Zt),!c&&this.grid.hitTestCircle(In,Lt,Ne,z)&&(De=!0,!O))return{circles:[],offscreen:!1,collisionDetected:De,occluded:!1}}}}return{circles:!O&&De||!je?[]:H,offscreen:Ue,collisionDetected:De,occluded:re.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let c=[],m=1/0,v=1/0,x=-1/0,w=-1/0;for(let O of i){let F=new r.P(O.x+to,O.y+to);m=Math.min(m,F.x),v=Math.min(v,F.y),x=Math.max(x,F.x),w=Math.max(w,F.y),c.push(F)}let E=this.grid.query(m,v,x,w).concat(this.ignoredGrid.query(m,v,x,w)),S={},M={};for(let O of E){let F=O.key;if(S[F.bucketInstanceId]===void 0&&(S[F.bucketInstanceId]={}),S[F.bucketInstanceId][F.featureIndex])continue;let z=[new r.P(O.x1,O.y1),new r.P(O.x2,O.y1),new r.P(O.x2,O.y2),new r.P(O.x1,O.y2)];r.cG(c,z)&&(S[F.bucketInstanceId][F.featureIndex]=!0,M[F.bucketInstanceId]===void 0&&(M[F.bucketInstanceId]=[]),M[F.bucketInstanceId].push(F.featureIndex))}return M}insertCollisionBox(i,c,m,v,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:x},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,c,m,v,x){let w=c?this.ignoredGrid:this.grid,E={bucketInstanceId:m,featureIndex:v,collisionGroupID:x};for(let S=0;S<i.length;S+=4)w.insertCircle(E,i[S],i[S+1],i[S+2])}projectAndGetPerspectiveRatio(i,c,m,v,x,w,E){let S=[c,m,v,1],M=!1;v||this.transform.pitch>0?(r.aA.transformMat4(S,S,i),this.fogState&&x&&E.name!=="globe"&&(M=function(z,V,$,G,H,q){let J=q.calculateFogTileMatrix(H),ee=[V,$,G];return r._.transformMat4(ee,ee,J),pr(z,r._.length(ee),q.pitch,q._fov)}(this.fogState,c,m,v,x.toUnwrapped(),this.transform)>.9)):vo(S,S,i);let O=S[3];return{point:new r.P((S[0]/O+1)/2*this.transform.width+to,(-S[1]/O+1)/2*this.transform.height+to),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/O*.5,1.5),signedDistanceFromCamera:O,occluded:w&&S[2]>O||M}}isOffscreen(i,c,m,v){return m<to||i>=this.screenRightBoundary||v<to||c>this.screenBottomBoundary}isInsideGrid(i,c,m,v){return m>=0&&i<this.gridRightBoundary&&v>=0&&c<this.gridBottomBoundary}getViewportMatrix(){let i=r.ad.identity([]);return r.ad.translate(i,i,[-100,-100,0]),i}}class gs{constructor(i,c,m,v){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?c:-c))):v&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class _s{constructor(i,c,m,v,x,w=!1){this.text=new gs(i?i.text:null,c,m,x),this.icon=new gs(i?i.icon:null,c,v,x),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Lh{constructor(i,c,m,v=!1){this.text=i,this.icon=c,this.skipFade=m,this.clipped=v}}class Gg{constructor(){this.invProjMatrix=r.ad.create(),this.viewportMatrix=r.ad.create(),this.circles=[]}}class qc{constructor(i,c,m,v,x){this.bucketInstanceId=i,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=x}}class Wc{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){let c=++this.maxGroupID;this.collisionGroups[i]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[i]}}function rp(d,i,c,m,v){let{horizontalAlign:x,verticalAlign:w}=r.bQ(d),E=-(x-.5)*i,S=-(w-.5)*c,M=r.bP(d,m);return new r.P(E+M[0]*v,S+M[1]*v)}function Zc(d,i,c,m,v){let x=new r.P(d,i);return c&&x._rotate(m?v:-v),x}class Ni{constructor(i,c,m,v,x,w){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new $g(this.transform,x),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Wc(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,c,m,v){let x=m.getBucket(c),w=m.latestFeatureIndex;if(!x||!w||c.fqid!==x.layerIds[0])return;let E=x.layers[0].layout,S=m.collisionBoxArray,M=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),O=m.tileSize/r.a3,F=m.tileID.toUnwrapped();this.transform.setProjection(x.projection);let z=(V=m.tileID,$=x.getProjection(),G=this.transform,$.name===this.projection?G.calculateProjMatrix(V.toUnwrapped()):Mh(G,$,V));var V,$,G;let H=E.get("text-pitch-alignment")==="map",q=E.get("text-rotation-alignment")==="map";c.compileFilter();let J=c.dynamicFilter(),ee=c.dynamicFilterNeedsFeature(),te=this.transform.calculatePixelsToTileUnitsMatrix(m),ce=ta(z,m.tileID.canonical,H,q,this.transform,x.getProjection(),te),le=null;if(H){let re=il(z,m.tileID.canonical,H,q,this.transform,x.getProjection(),te);le=r.ad.multiply([],this.transform.labelPlaneMatrix,re)}let Q=null;J&&m.latestFeatureIndex&&(Q={unwrappedTileID:F,dynamicFilter:J,dynamicFilterNeedsFeature:ee,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new qc(x.bucketInstanceId,w,x.sourceLayerIndex,x.index,m.tileID);let ne={bucket:x,layout:E,posMatrix:z,textLabelPlaneMatrix:ce,labelToScreenMatrix:le,clippingData:Q,scale:M,textPixelRatio:O,holdingForFade:m.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:r.aD(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.aD(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(v)for(let re of x.sortKeyRanges){let{sortKey:pe,symbolInstanceStart:Ee,symbolInstanceEnd:se}=re;i.push({sortKey:pe,symbolInstanceStart:Ee,symbolInstanceEnd:se,parameters:ne})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:ne})}attemptAnchorPlacement(i,c,m,v,x,w,E,S,M,O,F,z,V,$,G,H,q,J){let{textOffset0:ee,textOffset1:te,crossTileID:ce}=z,le=[ee,te],Q=rp(i,m,v,le,x),ne=this.collisionIndex.placeCollisionBox($,x,c,Zc(Q.x,Q.y,w,E,this.transform.angle),F,S,M,O.predicate);if(H){let re=$.getSymbolInstanceIconSize(J,this.transform.zoom,z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox($,re,H,Zc(Q.x,Q.y,w,E,this.transform.angle),F,S,M,O.predicate).box.length===0)return}if(ne.box.length>0){let re;return this.prevPlacement&&this.prevPlacement.variableOffsets[ce]&&this.prevPlacement.placements[ce]&&this.prevPlacement.placements[ce].text&&(re=this.prevPlacement.variableOffsets[ce].anchor),this.variableOffsets[ce]={textOffset:le,width:m,height:v,anchor:i,textScale:x,prevAnchor:re},this.markUsedJustification($,i,z,G),$.allowVerticalPlacement&&(this.markUsedOrientation($,G,z),this.placedOrientations[ce]=G),{shift:Q,placedGlyphBoxes:ne}}}placeLayerBucketPart(i,c,m,v){let{bucket:x,layout:w,posMatrix:E,textLabelPlaneMatrix:S,labelToScreenMatrix:M,clippingData:O,textPixelRatio:F,holdingForFade:z,collisionBoxArray:V,partiallyEvaluatedTextSize:$,partiallyEvaluatedIconSize:G,collisionGroup:H}=i.parameters,q=w.get("text-optional"),J=w.get("icon-optional"),ee=w.get("text-allow-overlap"),te=w.get("icon-allow-overlap"),ce=w.get("text-rotation-alignment")==="map",le=w.get("text-pitch-alignment")==="map",Q=w.get("symbol-z-order")==="viewport-y",ne=w.get("symbol-z-elevate");this.transform.setProjection(x.projection);let re=ee&&(te||!x.hasIconData()||J),pe=te&&(ee||!x.hasTextData()||q);!x.collisionArrays&&V&&x.deserializeCollisionBoxes(V),m&&v&&x.updateCollisionDebugBuffers(this.transform.zoom,V);let Ee=(se,Ie,De)=>{let{crossTileID:je,numVerticalGlyphVertices:Ue}=se;if(O){let Dn={zoom:this.transform.zoom,pitch:this.transform.pitch},Zt=null;if(O.dynamicFilterNeedsFeature){let Ft=this.retainedQueryData[x.bucketInstanceId];Zt=O.featureIndex.loadFeature({featureIndex:se.featureIndex,bucketIndex:Ft.bucketIndex,sourceLayerIndex:Ft.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,O.dynamicFilter)(Dn,Zt,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new r.P(se.tileAnchorX,se.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[je]=new Lh(!1,!1,!1,!0),void c.add(je)}if(c.has(je))return;if(z)return void(this.placements[je]=new Lh(!1,!1,!1));let Ne=!1,ve=!1,Ae=!0,ke=!1,it=!1,lt=null,st={box:null,offscreen:null,occluded:null},ze={box:null,offscreen:null,occluded:null},$e=null,ot=null,ft=null,At=0,Bt=0,tn=0;De.textFeatureIndex?At=De.textFeatureIndex:se.useRuntimeCollisionCircles&&(At=se.featureIndex),De.verticalTextFeatureIndex&&(Bt=De.verticalTextFeatureIndex);let Kt=Dn=>{Dn.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let Zt=this.transform.elevation;Dn.elevation=se.zOffset+(Zt?Zt.getAtTileOffset(Dn.tileID,Dn.tileAnchorX,Dn.tileAnchorY):0)},In=De.textBox;if(In){Kt(In);let Dn=Ft=>{let Vn=r.aE.horizontal;if(x.allowVerticalPlacement&&!Ft&&this.prevPlacement){let $n=this.prevPlacement.placedOrientations[je];$n&&(this.placedOrientations[je]=$n,Vn=$n,this.markUsedOrientation(x,Vn,se))}return Vn},Zt=(Ft,Vn)=>{if(x.allowVerticalPlacement&&Ue>0&&De.verticalTextBox){for(let $n of x.writingModes)if($n===r.aE.vertical?(st=Vn(),ze=st):st=Ft(),st&&st.box&&st.box.length)break}else st=Ft()};if(w.get("text-variable-anchor")){let Ft=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[je]){let nn=this.prevPlacement.variableOffsets[je];Ft.indexOf(nn.anchor)>0&&(Ft=Ft.filter(Fe=>Fe!==nn.anchor),Ft.unshift(nn.anchor))}let Vn=(nn,Fe,ut)=>{let vr=x.getSymbolInstanceTextSize($,se,this.transform.zoom,Ie),Cn=(nn.x2-nn.x1)*vr+2*nn.padding,Te=(nn.y2-nn.y1)*vr+2*nn.padding,fi=se.hasIconTextFit&&!te?Fe:null;fi&&Kt(fi);let Yr={box:[],offscreen:!1,occluded:!1},Tr=ee?2*Ft.length:Ft.length;for(let oi=0;oi<Tr;++oi){let vi=this.attemptAnchorPlacement(Ft[oi%Ft.length],nn,Cn,Te,vr,ce,le,F,E,H,oi>=Ft.length,se,Ie,x,ut,fi,$,G);if(vi&&(Yr=vi.placedGlyphBoxes,Yr&&Yr.box&&Yr.box.length)){Ne=!0,lt=vi.shift;break}}return Yr};Zt(()=>Vn(In,De.iconBox,r.aE.horizontal),()=>{let nn=De.verticalTextBox;return nn&&Kt(nn),x.allowVerticalPlacement&&!(st&&st.box&&st.box.length)&&Ue>0&&nn?Vn(nn,De.verticalIconBox,r.aE.vertical):{box:null,offscreen:null,occluded:null}}),st&&(Ne=st.box,Ae=st.offscreen,ke=st.occluded);let $n=Dn(!(!st||!st.box));if(!Ne&&this.prevPlacement){let nn=this.prevPlacement.variableOffsets[je];nn&&(this.variableOffsets[je]=nn,this.markUsedJustification(x,nn.anchor,se,$n))}}else{let Ft=(Vn,$n)=>{let nn=x.getSymbolInstanceTextSize($,se,this.transform.zoom,Ie),Fe=this.collisionIndex.placeCollisionBox(x,nn,Vn,new r.P(0,0),ee,F,E,H.predicate);return Fe&&Fe.box&&Fe.box.length&&(this.markUsedOrientation(x,$n,se),this.placedOrientations[je]=$n),Fe};Zt(()=>Ft(In,r.aE.horizontal),()=>{let Vn=De.verticalTextBox;return x.allowVerticalPlacement&&Ue>0&&Vn?(Kt(Vn),Ft(Vn,r.aE.vertical)):{box:null,offscreen:null,occluded:null}}),Dn(!!(st&&st.box&&st.box.length))}}if($e=st,Ne=$e&&$e.box&&$e.box.length>0,Ae=$e&&$e.offscreen,ke=$e&&$e.occluded,se.useRuntimeCollisionCircles){let Dn=x.text.placedSymbolArray.get(se.centerJustifiedTextSymbolIndex>=0?se.centerJustifiedTextSymbolIndex:se.verticalPlacedTextSymbolIndex),Zt=r.aF(x.textSizeData,$,Dn),Ft=w.get("text-padding");ot=this.collisionIndex.placeCollisionCircles(x,ee,Dn,x.lineVertexArray,x.glyphOffsetArray,Zt,E,S,M,m,le,H.predicate,se.collisionCircleDiameter*Zt/r.bN,Ft,this.retainedQueryData[x.bucketInstanceId].tileID),Ne=ee||ot.circles.length>0&&!ot.collisionDetected,Ae=Ae&&ot.offscreen,ke=ot.occluded}if(De.iconFeatureIndex&&(tn=De.iconFeatureIndex),De.iconBox){let Dn=Zt=>{Kt(Zt);let Ft=se.hasIconTextFit&&lt?Zc(lt.x,lt.y,ce,le,this.transform.angle):new r.P(0,0),Vn=x.getSymbolInstanceIconSize(G,this.transform.zoom,se.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,Vn,Zt,Ft,te,F,E,H.predicate)};ze&&ze.box&&ze.box.length&&De.verticalIconBox?(ft=Dn(De.verticalIconBox),ve=ft.box.length>0):(ft=Dn(De.iconBox),ve=ft.box.length>0),Ae=Ae&&ft.offscreen,it=ft.occluded}let Lt=q||se.numHorizontalGlyphVertices===0&&Ue===0,bn=J||se.numIconVertices===0;if(Lt||bn?bn?Lt||(ve=ve&&Ne):Ne=ve&&Ne:ve=Ne=ve&&Ne,Ne&&$e&&$e.box&&this.collisionIndex.insertCollisionBox($e.box,w.get("text-ignore-placement"),x.bucketInstanceId,ze&&ze.box&&Bt?Bt:At,H.ID),ve&&ft&&this.collisionIndex.insertCollisionBox(ft.box,w.get("icon-ignore-placement"),x.bucketInstanceId,tn,H.ID),ot&&(Ne&&this.collisionIndex.insertCollisionCircles(ot.circles,w.get("text-ignore-placement"),x.bucketInstanceId,At,H.ID),m)){let Dn=x.bucketInstanceId,Zt=this.collisionCircleArrays[Dn];Zt===void 0&&(Zt=this.collisionCircleArrays[Dn]=new Gg);for(let Ft=0;Ft<ot.circles.length;Ft+=4)Zt.circles.push(ot.circles[Ft+0]),Zt.circles.push(ot.circles[Ft+1]),Zt.circles.push(ot.circles[Ft+2]),Zt.circles.push(ot.collisionDetected?1:0)}let kn=x.projection.name!=="globe";re=re&&(kn||!ke),pe=pe&&(kn||!it),this.placements[je]=new Lh(Ne||re,ve||pe,Ae||x.justReloaded),c.add(je)};if(ne&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),Q){let se=x.getSortedSymbolIndexes(this.transform.angle);for(let Ie=se.length-1;Ie>=0;--Ie){let De=se[Ie];Ee(x.symbolInstances.get(De),De,x.collisionArrays[De])}x.hasAnyZOffset&&r.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let se=x.getSortedIndexesByZOffset();for(let Ie=0;Ie<se.length;++Ie){let De=se[Ie];Ee(x.symbolInstances.get(De),De,x.collisionArrays[De])}}else for(let se=i.symbolInstanceStart;se<i.symbolInstanceEnd;se++)Ee(x.symbolInstances.get(se),se,x.collisionArrays[se]);if(m&&x.bucketInstanceId in this.collisionCircleArrays){let se=this.collisionCircleArrays[x.bucketInstanceId];r.ad.invert(se.invProjMatrix,E),se.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(i,c,m,v){let{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:S,crossTileID:M}=m,O=r.cJ(c),F=v===r.aE.vertical?S:O==="left"?x:O==="center"?w:O==="right"?E:-1;x>=0&&(i.text.placedSymbolArray.get(x).crossTileID=F>=0&&x!==F?0:M),w>=0&&(i.text.placedSymbolArray.get(w).crossTileID=F>=0&&w!==F?0:M),E>=0&&(i.text.placedSymbolArray.get(E).crossTileID=F>=0&&E!==F?0:M),S>=0&&(i.text.placedSymbolArray.get(S).crossTileID=F>=0&&S!==F?0:M)}markUsedOrientation(i,c,m){let v=c===r.aE.horizontal||c===r.aE.horizontalOnly?c:0,x=c===r.aE.vertical?c:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:M}=m,O=i.text.placedSymbolArray;w>=0&&(O.get(w).placedOrientation=v),E>=0&&(O.get(E).placedOrientation=v),S>=0&&(O.get(S).placedOrientation=v),M>=0&&(O.get(M).placedOrientation=x)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;let c=this.prevPlacement,m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;let v=c?c.symbolFadeChange(i):1,x=c?c.opacities:{},w=c?c.variableOffsets:{},E=c?c.placedOrientations:{};for(let S in this.placements){let M=this.placements[S],O=x[S];O?(this.opacities[S]=new _s(O,v,M.text,M.icon,null,M.clipped),m=m||M.text!==O.text.placed||M.icon!==O.icon.placed):(this.opacities[S]=new _s(null,v,M.text,M.icon,M.skipFade,M.clipped),m=m||M.text||M.icon)}for(let S in x){let M=x[S];if(!this.opacities[S]){let O=new _s(M,v,!1,!1);O.isHidden()||(this.opacities[S]=O,m=m||M.text.placed||M.icon.placed)}}for(let S in w)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=w[S]);for(let S in E)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=E[S]);m?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:i)}updateLayerOpacities(i,c,m,v){let x=new Set;for(let w of c){let E=w.getBucket(i);E&&w.latestFeatureIndex&&i.fqid===E.layerIds[0]&&(this.updateBucketOpacities(E,x,w.collisionBoxArray,m,v,w.tileID),E.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(E,w.tileID),E.updateZOffset()))}}updateBucketOpacities(i,c,m,v,x,w){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();let E=i.layers[0].layout,S=!!i.layers[0].dynamicFilter(),M=new _s(null,0,!1,!1,!0),O=E.get("text-allow-overlap"),F=E.get("icon-allow-overlap"),z=E.get("text-variable-anchor"),V=E.get("text-rotation-alignment")==="map",$=E.get("text-pitch-alignment")==="map",G=new _s(null,0,O&&(F||!i.hasIconData()||E.get("icon-optional")),F&&(O||!i.hasTextData()||E.get("text-optional")),!0);!i.collisionArrays&&m&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(m);let H=(J,ee,te)=>{for(let ce=0;ce<ee/4;ce++)J.opacityVertexArray.emplaceBack(te)},q=0;x&&i.updateReplacement(w,x);for(let J=0;J<i.symbolInstances.length;J++){let ee=i.symbolInstances.get(J),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:ce,crossTileID:le,numIconVertices:Q,tileAnchorX:ne,tileAnchorY:re}=ee,pe=c.has(le),Ee=this.opacities[le];pe?Ee=M:Ee||(Ee=G,this.opacities[le]=Ee),c.add(le);let se=te>0||ce>0,Ie=Q>0,De=this.placedOrientations[le],je=De===r.aE.vertical,Ue=De===r.aE.horizontal||De===r.aE.horizontalOnly;!se&&!Ie||Ee.isHidden()||q++;let Ne=!1;if((se||Ie)&&x)for(let ve of i.activeReplacements){if(ve.order<v||ve.order===1/0||!(ve.clipMask&r.cu.Symbol)||ve.min.x>ne||ne>ve.max.x||ve.min.y>re||re>ve.max.y)continue;let Ae=r.cH(ne,re,w.canonical,ve.footprintTileId.canonical);if(Ne=r.cI(Ae,ve),Ne)break}if(se){let ve=Ne?ys:To(Ee.text);H(i.text,te,je?ys:ve),H(i.text,ce,Ue?ys:ve);let Ae=Ee.text.isHidden(),{leftJustifiedTextSymbolIndex:ke,centerJustifiedTextSymbolIndex:it,rightJustifiedTextSymbolIndex:lt,verticalPlacedTextSymbolIndex:st}=ee,ze=i.text.placedSymbolArray,$e=Ae||je?1:0;ke>=0&&(ze.get(ke).hidden=$e),it>=0&&(ze.get(it).hidden=$e),lt>=0&&(ze.get(lt).hidden=$e),st>=0&&(ze.get(st).hidden=Ae||Ue?1:0);let ot=this.variableOffsets[le];ot&&this.markUsedJustification(i,ot.anchor,ee,De);let ft=this.placedOrientations[le];ft&&(this.markUsedJustification(i,"left",ee,ft),this.markUsedOrientation(i,ft,ee))}if(Ie){let ve=Ne?ys:To(Ee.icon),{placedIconSymbolIndex:Ae,verticalPlacedIconSymbolIndex:ke}=ee,it=i.icon.placedSymbolArray,lt=Ee.icon.isHidden()?1:0;Ae>=0&&(H(i.icon,Q,je?ys:ve),it.get(Ae).hidden=lt),ke>=0&&(H(i.icon,ee.numVerticalIconVertices,Ue?ys:ve),it.get(ke).hidden=lt)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){let ve=i.collisionArrays[J];if(ve){let Ae=new r.P(0,0),ke=!0;if(ve.textBox||ve.verticalTextBox){if(z){let lt=this.variableOffsets[le];lt?(Ae=rp(lt.anchor,lt.width,lt.height,lt.textOffset,lt.textScale),V&&Ae._rotate($?this.transform.angle:-this.transform.angle)):ke=!1}S&&(ke=!Ee.clipped),ve.textBox&&Yc(i.textCollisionBox.collisionVertexArray,Ee.text.placed,!ke||je,Ae.x,Ae.y),ve.verticalTextBox&&Yc(i.textCollisionBox.collisionVertexArray,Ee.text.placed,!ke||Ue,Ae.x,Ae.y)}let it=ke&&!!(!Ue&&ve.verticalIconBox);ve.iconBox&&Yc(i.iconCollisionBox.collisionVertexArray,Ee.icon.placed,it,ee.hasIconTextFit?Ae.x:0,ee.hasIconTextFit?Ae.y:0),ve.verticalIconBox&&Yc(i.iconCollisionBox.collisionVertexArray,Ee.icon.placed,!it,ee.hasIconTextFit?Ae.x:0,ee.hasIconTextFit?Ae.y:0)}}}if(i.fullyClipped=q===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){let J=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=J.invProjMatrix,i.placementViewportMatrix=J.viewportMatrix,i.collisionCircleArray=J.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,c){let m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>i}setStale(){this.stale=!0}}function Yc(d,i,c,m,v){d.emplaceBack(i?1:0,c?1:0,m||0,v||0),d.emplaceBack(i?1:0,c?1:0,m||0,v||0),d.emplaceBack(i?1:0,c?1:0,m||0,v||0),d.emplaceBack(i?1:0,c?1:0,m||0,v||0)}let ip=Math.pow(2,25),rt=Math.pow(2,24),Hg=Math.pow(2,17),op=Math.pow(2,16),sp=Math.pow(2,9),qg=Math.pow(2,8),Fh=Math.pow(2,1);function To(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;let i=d.placed?1:0,c=Math.floor(127*d.opacity);return c*ip+i*rt+c*Hg+i*op+c*sp+i*qg+c*Fh+i}let ys=0;class ca{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,c,m,v,x){let w=this._bucketParts;for(;this._currentTileIndex<i.length;)if(c.getBucketParts(w,v,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((E,S)=>E.sortKey-S.sortKey));this._currentPartIndex<w.length;){let E=w[this._currentPartIndex];if(c.placeLayerBucketPart(E,this._seenCrossTileIDs,m,E.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class Nh{constructor(i,c,m,v,x,w,E,S,M){this.placement=new Ni(i,x,w,E,S,M),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(i,c,m,v){let x=r.e.now(),w=()=>{let E=r.e.now()-x;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){let E=c[i[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=S)&&(!E.maxzoom||E.maxzoom>S)){let M=E,O=M.layout.get("symbol-z-elevate"),F=this._inProgressLayer=this._inProgressLayer||new ca(M),z=r.al(E.source,E.scope);if(F.continuePlacement(O?v[z]:m[z],this.placement,this._showCollisionBoxes,E,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}let vs=512/r.a3/2;class cx{constructor(i,c,m){this.tileID=i,this.bucketInstanceId=m,this.index=new r.cK(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let v=i.canonical.x*r.a3,x=i.canonical.y*r.a3;for(let w=0;w<c.length;w++){let{key:E,crossTileID:S,tileAnchorX:M,tileAnchorY:O}=c.get(w),F=Math.floor((v+M)*vs),z=Math.floor((x+O)*vs);this.index.add(F,z),this.keys.push(E),this.crossTileIDs.push(S)}this.index.finish()}findMatches(i,c,m){let v=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),x=vs/Math.pow(2,c.canonical.z-this.tileID.canonical.z),w=c.canonical.x*r.a3,E=c.canonical.y*r.a3;for(let S=0;S<i.length;S++){let M=i.get(S);if(M.crossTileID)continue;let{key:O,tileAnchorX:F,tileAnchorY:z}=M,V=Math.floor((w+F)*x),$=Math.floor((E+z)*x),G=this.index.range(V-v,$-v,V+v,$+v);for(let H of G){let q=this.crossTileIDs[H];if(this.keys[H]===O&&!m.has(q)){m.add(q),M.crossTileID=q;break}}}}}class ux{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ap{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){let c=Math.round((i-this.lng)/360);if(c!==0)for(let m in this.indexes){let v=this.indexes[m],x={};for(let w in v){let E=v[w];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+c),x[E.tileID.key]=E}this.indexes[m]=x}this.lng=i}addBucket(i,c,m){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let x=0;x<c.symbolInstances.length;x++)c.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);let v=this.usedCrossTileIDs[i.overscaledZ];for(let x in this.indexes){let w=this.indexes[x];if(Number(x)>i.overscaledZ)for(let E in w){let S=w[E];S.tileID.isChildOf(i)&&S.findMatches(c.symbolInstances,i,v)}else{let E=w[i.scaledTo(Number(x)).key];E&&E.findMatches(c.symbolInstances,i,v)}}for(let x=0;x<c.symbolInstances.length;x++){let w=c.symbolInstances.get(x);w.crossTileID||(w.crossTileID=m.generate(),v.add(w.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new cx(i,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(i,c){for(let m of c.crossTileIDs)this.usedCrossTileIDs[i].delete(m)}removeStaleBuckets(i){let c=!1;for(let m in this.indexes){let v=this.indexes[m];for(let x in v)i[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[x]),delete v[x],c=!0)}return c}}class hx{constructor(){this.layerIndexes={},this.crossTileIDs=new ux,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,c,m,v){let x=this.layerIndexes[i.fqid];x===void 0&&(x=this.layerIndexes[i.fqid]=new ap);let w=!1,E={};v.name!=="globe"&&x.handleWrapJump(m);for(let S of c){let M=S.getBucket(i);M&&i.fqid===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(S.tileID,M,this.crossTileIDs)&&(w=!0),E[M.bucketInstanceId]=!0)}return x.removeStaleBuckets(E)&&(w=!0),w}pruneUnusedLayers(i){let c={};i.forEach(m=>{c[m]=!0});for(let m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}let Wg=new r.N({data:new r.O(r.L.colorTheme.data)}),xs=(d,i)=>Nt(d,i&&i.filter(c=>c.identifier!=="source.canvas")),lp=r.ah(an,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),dx=r.ah(an,["setCenter","setZoom","setBearing","setPitch"]),Zg={version:8,layers:[],sources:{}},Yg={duration:300,delay:0};class no extends r.E{constructor(i,c={}){super(),this.map=i,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=r.W({},Yg),this._buildingIndex=new sx(this),this.crossTileSymbolIndex=new hx,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new dn,this.dispatcher=c.dispatcher?c.dispatcher:new r.bw(r.bx(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new vc,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new r.cM(i._requestManager,c.localFontFamily?r.cN.all:c.localIdeographFontFamily?r.cN.ideographs:r.cN.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new ch(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,colorTheme:null},this._styleColorThemeForScope={},this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",r.cO());let m=this;this._rtlTextPluginCallback=no.registerForPluginStateChange(v=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,w)=>{if(r.cP(x),w&&w.every(E=>E))for(let E in m._sourceCaches){let S=m._sourceCaches[E],M=S.getSource().type;M!=="vector"&&M!=="geojson"||S.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;let x=this.getOwnSource(v.sourceId);if(x&&x.vectorLayerIds)for(let w in this._layers){let E=this._layers[w];E.source===x.id&&this._validateLayer(E)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(r.cQ(i))return i;let c=r.cR(i);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${r.cS(JSON.stringify(i))}`}_diffStyle(i,c,m){this.globalId=this._getGlobalId(i);let v=(x,w)=>{try{w(null,this.setState(x,m))}catch(E){w(E,!1)}};if(typeof i=="string"){let x=this.map._requestManager.normalizeStyleURL(i),w=this.map._requestManager.transformRequest(x,r.R.Style);r.g(w,(E,S)=>{E?this.fire(new r.d(E)):S&&v(S,c)})}else typeof i=="object"&&v(i,c)}loadURL(i,c={}){this.fire(new r.f("dataloading",{dataType:"style"}));let m=typeof c.validate=="boolean"?c.validate:!r.cQ(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,c.accessToken),this.resolvedImports.add(i);let v=this.importsCache.get(i);if(v)return this._load(v,m);let x=this.map._requestManager.transformRequest(i,r.R.Style);this._request=r.g(x,(w,E)=>{if(this._request=null,w)this.fire(new r.d(w));else if(E)return this.importsCache.set(i,E),this._load(E,m)})}loadJSON(i,c={}){this.fire(new r.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=r.e.frame(()=>{this._request=null,this._load(i,c.validate!==!1)})}loadEmpty(){this.fire(new r.f("dataloading",{dataType:"style"})),this._load(Zg,!1)}_loadImports(i,c,m){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let v=[];for(let x of i){let w=this._createFragmentStyle(x),E=new Promise(O=>{w.once("style.import.load",O),w.once("error",O)}).then(()=>this.mergeAll());if(v.push(E),this.resolvedImports.has(x.url)){w.loadEmpty();continue}let S=x.data||this.importsCache.get(x.url);S?(w.loadJSON(S,{validate:c}),this._isInternalStyle(S)&&(w.globalId=null)):x.url?w.loadURL(x.url,{validate:c}):w.loadEmpty();let M={style:w,id:x.id,config:x.config};if(m){let O=this.fragments.findIndex(({id:F})=>F===m);this.fragments=this.fragments.slice(0,O).concat(M).concat(this.fragments.slice(O))}else this.fragments.push(M)}return Promise.allSettled(v)}getImportGlobalIds(i=this,c=new Set){for(let m of i.fragments)m.style.globalId&&c.add(m.style.globalId),this.getImportGlobalIds(m.style,c);return[...c.values()]}_createFragmentStyle(i){let c=this.scope?r.al(i.id,this.scope):i.id,m,v=this._initialConfig&&this._initialConfig[c];(i.config||v)&&(m=r.W({},i.config,v));let x=new no(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:m,configOptions:this.options,configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,c){let m=i.schema;if(this._isInternalStyle(i)){let w=r.W({},Zg,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(w,c)}if(this.updateConfig(this._config,m),c&&xs(this,ue(i)))return;this._loaded=!0,this.stylesheet=r.cT(i);let v=()=>{for(let M in i.sources)this.addSource(M,i.sources[M],{validate:!1,isInitialLoad:!0});i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);let w=tp(this.stylesheet.layers);if(this._order=w.map(M=>M.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let M=this.stylesheet.lights[0];this.light=new pt(M.properties,M.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new pt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let M of w){let O=r.cY(M,this.scope,this._styleColorTheme.lut,this.options);O.isConfigDependent&&this._configDependentLayers.add(O.fqid),O.setEventedParent(this,{layer:{id:O.id}}),this._layers[O.id]=O,this._serializedLayers[O.id]=O.serialize();let F=this.getOwnLayerSourceCache(O),z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&O.canCastShadows()&&z&&(F.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let E=this.stylesheet.terrain;E&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(E,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.f("data",{dataType:"style"}));let S=this.isRootStyle();i.imports?this._loadImports(i.imports,c).then(()=>{this._reloadImports(),this.fire(new r.f(S?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.f(S?"style.load":"style.import.load")))},x=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=x,x){let w=this._evaluateColorThemeData(x);this._loadColorTheme(w).then(()=>{v()}).catch(E=>{r.w(`Couldn't load color theme from the stylesheet: ${E}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,c,m,v,x,w,E,S,M={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(O.light!=null&&(i=O.light),O.stylesheet.lights)for(let F of O.stylesheet.lights)F.type==="ambient"&&O.ambientLight!=null&&(c=O.ambientLight),F.type==="directional"&&O.directionalLight!=null&&(m=O.directionalLight);v=this._prioritizeTerrain(v,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(x=O.fog),O.stylesheet.camera!=null&&(S=O.stylesheet.camera),O.stylesheet.projection!=null&&(w=O.stylesheet.projection),O.stylesheet.transition!=null&&(E=O.stylesheet.transition),M[O.scope]=O._styleColorTheme}}),this.light=i,this.ambientLight=c,this.directionalLight=m,this.fog=x,this._styleColorThemeForScope=M,v===null?delete this.terrain:this.terrain=v,this.camera=S||{"camera-projection":"perspective"},this.projection=w||{name:"mercator"},this.transition=r.W({},Yg,E),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){let c=m=>{for(let v of m.fragments)c(v.style);i(m)};c(this)}_prioritizeTerrain(i,c,m){let v=i&&i.drapeRenderMode===0;return m===null?c&&c.drapeRenderMode===0?c:v?i:null:c!=null&&(!i||v||c&&c.drapeRenderMode===1)?c:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{i=this._prioritizeTerrain(i,c.terrain,c.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(i=c.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){let i={},c={},m={};this.forEachFragmentStyle(v=>{for(let x in v._sourceCaches){let w=r.al(x,v.scope);i[w]=v._sourceCaches[x]}for(let x in v._otherSourceCaches){let w=r.al(x,v.scope);c[w]=v._otherSourceCaches[x]}for(let x in v._symbolSourceCaches){let w=r.al(x,v.scope);m[w]=v._symbolSourceCaches[x]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=m}mergeLayers(){let i={},c=[],m={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(let E of w._order){let S=w._layers[E];if(S.type==="slot"){let M=r.cU(E);if(i[M])continue;i[M]=[]}S.slot&&i[S.slot]?i[S.slot].push(S):c.push(S)}}),this._mergedOrder=[],this._clipLayerIndices=[];let v=0,x=(w=[])=>{for(let E of w)if(E.type==="slot"){let S=r.cU(E.id);i[S]&&x(i[S]),this._mergedSlots.push(S)}else{let S=r.al(E.id,E.scope);this._mergedOrder.push(S),m[S]=E,E.is3D()&&(this._has3DLayers=!0),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&this._clipLayerIndices.push(v),v++}};x(c),this._mergedLayers=m,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=r.W({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?function(c,m,v){let x=r.W({},m);for(let E of Object.keys(r.L.colorTheme))x[E]===void 0&&(x[E]=r.L.colorTheme[E].default);let w=new r.U(Wg,c,new Map(v));return w.setTransitionOrValue(x,v),w.untransitioned().possiblyEvaluate(new r.X(0))}(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){return this._styleColorTheme.lutLoading=!0,new Promise((c,m)=>{let v="data:image/png;base64,";if(i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void c();i.startsWith(v)||(i=v+i);let x="mapbox-reserved-lut",w=new Image;w.src=i,w.onerror=()=>{this._styleColorTheme.lutLoading=!1,m(new Error("Failed to load image data"))},w.onload=()=>{this._styleColorTheme.lutLoading=!1;let{width:E,height:S,data:M}=r.e.getImageData(w);if(S>32)return void m(new Error("The height of the image must be less than or equal to 32 pixels."));if(E!==S*S)return void m(new Error("The width of the image must be equal to the height squared."));this.getImage(x)&&this.removeImage(x),this.addImage(x,{data:new r.i({width:E,height:S},M),pixelRatio:1,sdf:!1,version:0});let O=this.imageManager.getImage(x,this.scope);O?(this._styleColorTheme.lut={image:O.data,data:i},c()):m(new Error("Missing LUT image."))}})}getLut(i){let c=this._styleColorThemeForScope[i];return c?c.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(c,m,v){let x,w,E,S=r.e.devicePixelRatio>1?"@2x":"",M=r.g(m.transformRequest(m.normalizeSpriteURL(c,S,".json"),r.R.SpriteJSON),(z,V)=>{M=null,E||(E=z,x=V,F())}),O=r.h(m.transformRequest(m.normalizeSpriteURL(c,S,".png"),r.R.SpriteImage),(z,V)=>{O=null,E||(E=z,w=V,F())});function F(){if(E)v(E);else if(x&&w){let z=r.e.getImageData(w),V={};for(let $ in x){let{width:G,height:H,x:q,y:J,sdf:ee,pixelRatio:te,stretchX:ce,stretchY:le,content:Q}=x[$],ne=new r.i({width:G,height:H});r.i.copy(z,ne,{x:q,y:J},{x:0,y:0},{width:G,height:H},null),V[$]={data:ne,pixelRatio:te,sdf:ee,stretchX:ce,stretchY:le,content:Q}}v(null,V)}}return{cancel(){M&&(M.cancel(),M=null),O&&(O.cancel(),O=null)}}}(i,this.map._requestManager,(c,m)=>{if(this._spriteRequest=null,c)this.fire(new r.d(c));else if(m)for(let v in m)this.imageManager.addImage(v,this.scope,m[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.f("data",{dataType:"style"}))})}_validateLayer(i){let c=this.getOwnSource(i.source);if(!c)return;let m=i.sourceLayer;m&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(m)===-1)&&this.fire(new r.d(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,c)=>{let m=this.fragments[c];return m&&m.style&&(i.data=m.style.serialize()),i})}_serializeSources(){let i={};for(let c in this._sourceCaches){let m=this._sourceCaches[c].getSource();i[m.id]||(i[m.id]=m.serialize())}return i}_serializeLayers(i){let c=[];for(let m of i){let v=this._layers[m];v&&v.type!=="custom"&&c.push(v.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(let i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){let c=this.getOwnLayer(i);if(c)return c;this.fire(new r.d(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){let c=this.getOwnSource(i);if(c)return c;this.fire(new r.d(new Error(`The source '${i}' does not exist in the map's style.`)))}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);let c=this.calculateLightsBrightness();i.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c));let m=this._changes.isDirty(),v=!1;if(this._changes.isDirty()){let w=this._changes.getLayerUpdatesByScope();for(let E in w){let{updatedIds:S,removedIds:M}=w[E];(S||M)&&(this._updateWorkerLayers(E,S,M),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._changes.reset()}let x={};for(let w in this._mergedSourceCaches){let E=this._mergedSourceCaches[w];x[w]=E.used,E.used=!1,E.tileCoverLift=0}for(let w of this._mergedOrder){let E=this._mergedLayers[w];if(E.recalculate(i,this._availableImages),!E.isHidden(i.zoom)){let S=this.getLayerSourceCache(E);S&&(S.used=!0,S.tileCoverLift=Math.max(S.tileCoverLift,E.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let S=E.minzoom||0;S<(E.maxzoom||25.5);S++){let M=this.map.painter;if(M){let O=E.getProgramIds();if(!O)continue;for(let F of O){let z=E.getDefaultProgramParams(F,i.zoom,this._styleColorTheme.lut);z&&(M.style=this,this.fog&&(M._fogVisible=!0,z.overrideFog=!0,M.getOrCreateProgram(F,z)),M._fogVisible=!1,z.overrideFog=!1,M.getOrCreateProgram(F,z),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(z.overrideRtt=!0,M.getOrCreateProgram(F,z)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();for(let w in x){let E=this._mergedSourceCaches[w];x[w]!==E.used&&E.getSource().fire(new r.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),m&&this.fire(new r.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){let i=this._changes.getUpdatedImages();if(i.length){for(let c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,c,m){let v=this.getFragmentStyle(i);v&&this.dispatcher.broadcast("updateLayers",{layers:c?v._serializeLayers(c):[],scope:i,removedIds:m||[],options:v.options})}setState(i,c){if(this._checkLoaded(),xs(this,ue(i)))return!1;(i=r.cT(i)).layers=tp(i.layers);let m=function(w,E){if(!w)return[{command:an.setStyle,args:[E]}];let S=[];try{if(!C(w.version,E.version))return[{command:an.setStyle,args:[E]}];if(C(w.center,E.center)||S.push({command:an.setCenter,args:[E.center]}),C(w.zoom,E.zoom)||S.push({command:an.setZoom,args:[E.zoom]}),C(w.bearing,E.bearing)||S.push({command:an.setBearing,args:[E.bearing]}),C(w.pitch,E.pitch)||S.push({command:an.setPitch,args:[E.pitch]}),C(w.sprite,E.sprite)||S.push({command:an.setSprite,args:[E.sprite]}),C(w.glyphs,E.glyphs)||S.push({command:an.setGlyphs,args:[E.glyphs]}),C(w.imports,E.imports)||function(V=[],$=[],G){$=$||[];let H=(V=V||[]).map(kh),q=$.map(kh),J=V.reduce(xl,{}),ee=$.reduce(xl,{}),te=H.slice(),ce,le,Q,ne;for(ce=0,le=0;ce<H.length;ce++)Q=H[ce],ee.hasOwnProperty(Q)?le++:(G.push({command:an.removeImport,args:[Q]}),te.splice(te.indexOf(Q,le),1));for(ce=0,le=0;ce<q.length;ce++)Q=q[q.length-1-ce],te[te.length-1-ce]!==Q&&(J.hasOwnProperty(Q)?(G.push({command:an.removeImport,args:[Q]}),te.splice(te.lastIndexOf(Q,te.length-le),1)):le++,ne=te[te.length-ce],G.push({command:an.addImport,args:[ee[Q],ne]}),te.splice(te.length-ce,0,Q));for(let re of $){let pe=J[re.id];pe&&!C(pe,re)&&G.push({command:an.updateImport,args:[re.id,re]})}}(w.imports,E.imports,S),C(w.transition,E.transition)||S.push({command:an.setTransition,args:[E.transition]}),C(w.light,E.light)||S.push({command:an.setLight,args:[E.light]}),C(w.fog,E.fog)||S.push({command:an.setFog,args:[E.fog]}),C(w.projection,E.projection)||S.push({command:an.setProjection,args:[E.projection]}),C(w.lights,E.lights)||S.push({command:an.setLights,args:[E.lights]}),C(w.camera,E.camera)||S.push({command:an.setCamera,args:[E.camera]}),!C(w["color-theme"],E["color-theme"]))return[{command:an.setStyle,args:[E]}];let M={},O=[];(function(V,$,G,H){let q;for(q in $=$||{},V=V||{})V.hasOwnProperty(q)&&($.hasOwnProperty(q)||jg(q,G,H));for(q in $){if(!$.hasOwnProperty(q))continue;let J=$[q];V.hasOwnProperty(q)?C(V[q],J)||(V[q].type==="geojson"&&J.type==="geojson"&&lx(V,$,q)?G.push({command:an.setGeoJSONSourceData,args:[q,J.data]}):ax(q,$,G,H)):zo(q,$,G)}})(w.sources,E.sources,O,M);let F=[];w.layers&&w.layers.forEach(V=>{V.source&&M[V.source]?S.push({command:an.removeLayer,args:[V.id]}):F.push(V)});let z=w.terrain;z&&M[z.source]&&(S.push({command:an.setTerrain,args:[void 0]}),z=void 0),S=S.concat(O),C(z,E.terrain)||S.push({command:an.setTerrain,args:[E.terrain]}),function(V,$,G){$=$||[];let H=(V=V||[]).map(kh),q=$.map(kh),J=V.reduce(xl,{}),ee=$.reduce(xl,{}),te=H.slice(),ce=Object.create(null),le,Q,ne,re,pe,Ee,se;for(le=0,Q=0;le<H.length;le++)ne=H[le],ee.hasOwnProperty(ne)?Q++:(G.push({command:an.removeLayer,args:[ne]}),te.splice(te.indexOf(ne,Q),1));for(le=0,Q=0;le<q.length;le++)ne=q[q.length-1-le],te[te.length-1-le]!==ne&&(J.hasOwnProperty(ne)?(G.push({command:an.removeLayer,args:[ne]}),te.splice(te.lastIndexOf(ne,te.length-Q),1)):Q++,Ee=te[te.length-le],G.push({command:an.addLayer,args:[ee[ne],Ee]}),te.splice(te.length-le,0,ne),ce[ne]=!0);for(le=0;le<q.length;le++)if(ne=q[le],re=J[ne],pe=ee[ne],!ce[ne]&&!C(re,pe))if(C(re.source,pe.source)&&C(re["source-layer"],pe["source-layer"])&&C(re.type,pe.type)){for(se in Hc(re.layout,pe.layout,G,ne,null,an.setLayoutProperty),Hc(re.paint,pe.paint,G,ne,null,an.setPaintProperty),C(re.slot,pe.slot)||G.push({command:an.setSlot,args:[ne,pe.slot]}),C(re.filter,pe.filter)||G.push({command:an.setFilter,args:[ne,pe.filter]}),C(re.minzoom,pe.minzoom)&&C(re.maxzoom,pe.maxzoom)||G.push({command:an.setLayerZoomRange,args:[ne,pe.minzoom,pe.maxzoom]}),re)re.hasOwnProperty(se)&&se!=="layout"&&se!=="paint"&&se!=="filter"&&se!=="metadata"&&se!=="minzoom"&&se!=="maxzoom"&&se!=="slot"&&(se.indexOf("paint.")===0?Hc(re[se],pe[se],G,ne,se.slice(6),an.setPaintProperty):C(re[se],pe[se])||G.push({command:an.setLayerProperty,args:[ne,se,pe[se]]}));for(se in pe)pe.hasOwnProperty(se)&&!re.hasOwnProperty(se)&&se!=="layout"&&se!=="paint"&&se!=="filter"&&se!=="metadata"&&se!=="minzoom"&&se!=="maxzoom"&&se!=="slot"&&(se.indexOf("paint.")===0?Hc(re[se],pe[se],G,ne,se.slice(6),an.setPaintProperty):C(re[se],pe[se])||G.push({command:an.setLayerProperty,args:[ne,se,pe[se]]}))}else G.push({command:an.removeLayer,args:[ne]}),Ee=te[te.lastIndexOf(ne)+1],G.push({command:an.addLayer,args:[pe,Ee]})}(F,E.layers,S)}catch(M){console.warn("Unable to compute style diff:",M),S=[{command:an.setStyle,args:[E]}]}return S}(this.serialize(),i).filter(w=>!(w.command in dx));if(m.length===0)return!1;let v=m.filter(w=>!(w.command in lp));if(v.length>0)throw new Error(`Unimplemented: ${v.map(w=>w.command).join(", ")}.`);let x=[];return m.forEach(w=>{x.push(this[w.command].apply(this,w.args))}),c&&Promise.all(x).then(c),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,c){return this.getImage(i)?this.fire(new r.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,c),this._afterImageUpdated(i),this)}updateImage(i,c){this.imageManager.updateImage(i,this.scope,c)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new r.d(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,c,m={}){return this._checkLoaded(),this._validate(Gt,`models.${i}`,c,null,m)||(this.modelManager.addModel(i,c,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new r.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,c,m={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(de,`sources.${i}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);let v=wh(i,c,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));let x=w=>{let E=(w?"symbol:":"other:")+v.id,S=r.al(E,this.scope),M=this._sourceCaches[E]=new r.bv(S,v,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=M,M.onAdd(this.map)};x(!1),c.type!=="vector"&&c.type!=="geojson"||x(!0),v.onAdd&&v.onAdd(this.map),m.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();let c=this.getOwnSource(i);if(!c)throw new Error("There is no source with this ID");for(let v in this._layers)if(this._layers[v].source===i)return this.fire(new r.d(new Error(`Source "${i}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new r.d(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));let m=this.getOwnSourceCaches(i);for(let v of m){let x=r.cU(v.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(v.id),v.fire(new r.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,c){this._checkLoaded(),this.getOwnSource(i).setData(c),this._changes.setDirty()}getOwnSource(i){let c=this.getOwnSourceCache(i);return c&&c.getSource()}getOwnSources(){let i=[];for(let c in this._otherSourceCaches){let m=this.getOwnSourceCache(c);m&&i.push(m.getSource())}return i}areTilesLoaded(){let i=this._mergedSourceCaches;for(let c in i){let m=i[c]._tiles;for(let v in m){let x=m[v];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;let c=this._getTransitionParameters();for(let v of i){if(this._validate(Se,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){let x=this.ambientLight;x.set(v),x.updateTransitions(c)}else this.ambientLight=new wc(v,Ut,this.scope,this.options);break;case"directional":if(this.directionalLight){let x=this.directionalLight;x.set(v),x.updateTransitions(c)}else this.directionalLight=new wc(v,gf,this.scope,this.options)}}let m=new r.X(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(m),this.directionalLight&&this.directionalLight.recalculate(m),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let i=this.directionalLight,c=this.ambientLight;if(!i||!c)return;let m=F=>.2126*(F[0]<=.03928?F[0]/12.92:Math.pow((F[0]+.055)/1.055,2.4))+.7152*(F[1]<=.03928?F[1]/12.92:Math.pow((F[1]+.055)/1.055,2.4))+.0722*(F[2]<=.03928?F[2]/12.92:Math.pow((F[2]+.055)/1.055,2.4)),v=i.properties.get("color").toRenderColor(null).toArray01(),x=i.properties.get("intensity"),w=i.properties.get("direction"),E=1-r.ac(w.x,w.y,w.z)[2]/90,S=m(v)*x*E,M=c.properties.get("color").toRenderColor(null).toArray01(),O=c.properties.get("intensity");return(S+m(M)*O)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(r.cV(i)){let c=r.cW(i),m=this.fragments.find(({id:x})=>x===c);if(!m)throw new Error(`Style import not found: ${i}`);let v=r.cU(i);return m.style.getFragmentStyle(v)}{let c=this.fragments.find(({id:m})=>m===i);if(!c)throw new Error(`Style import not found: ${i}`);return c.style}}getConfigProperty(i,c){let m=this.getFragmentStyle(i);if(!m)return null;let v=r.al(c,m.scope),x=m.options.get(v),w=x?x.value||x.default:null;return w?w.serialize():null}setConfigProperty(i,c,m){let v=this.getFragmentStyle(i);if(!v)return;let x=v.stylesheet.schema;if(!x||!x[c])return;let w=r.y(m);if(w.result!=="success")return void xs(this,w.value);let E=w.value.expression,S=r.al(c,v.scope),M=v.options.get(S);if(!M)return;let O,{minValue:F,maxValue:z,stepValue:V,type:$,values:G}=x[c],H=r.y(x[c].default);H.result==="success"&&(O=H.value.expression),O?(this.options.set(S,_r(kt({},M),{value:E,default:O,minValue:F,maxValue:z,stepValue:V,type:$,values:G})),this.updateConfigDependencies()):this.fire(new r.d(new Error(`No schema defined for the config option "${c}" in the "${i}" fragment.`)))}getConfig(i){let c=this.getFragmentStyle(i);if(!c)return null;let m=c.stylesheet.schema;if(!m)return null;let v={};for(let x in m){let w=r.al(x,c.scope),E=c.options.get(w),S=E?E.value||E.default:null;v[x]=S?S.serialize():null}return v}setConfig(i,c){let m=this.getFragmentStyle(i);m&&(m.updateConfig(c,m.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){let c=this.getFragmentStyle(i);return c?c.stylesheet.schema:null}setSchema(i,c){let m=this.getFragmentStyle(i);m&&(m.stylesheet.schema=c,m.updateConfig(m._config,c),this.updateConfigDependencies())}updateConfig(i,c){if(this._config=i,i||c)if(c)for(let m in c){let v,x,w=r.y(c[m].default);if(w.result==="success"&&(v=w.value.expression),i&&i[m]!==void 0){let z=r.y(i[m]);z.result==="success"&&(x=z.value.expression)}let{minValue:E,maxValue:S,stepValue:M,type:O,values:F}=c[m];if(v){let z=r.al(m,this.scope);this.options.set(z,{default:v,value:x,minValue:E,maxValue:S,stepValue:M,type:O,values:F})}else this.fire(new r.d(new Error(`No schema defined for config option "${m}".`)))}else this.fire(new r.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let i of this._configDependentLayers){let c=this.getLayer(i);c&&(c.possiblyEvaluateVisibility(),this._updateLayer(c))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(i=>{if(i._styleColorTheme.colorTheme){let c=i._evaluateColorThemeData(i._styleColorTheme.colorTheme);(!i._styleColorTheme.lut||i._styleColorTheme.lut&&c!==i._styleColorTheme.lut.data)&&i.setColorTheme(i._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(i,c,m={}){this._checkLoaded();let v=i.id;if(this._layers[v])return void this.fire(new r.d(new Error(`Layer with id "${v}" already exists on this map`)));let x;if(i.type==="custom"){if(xs(this,r.cX(i)))return;x=r.cY(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(v,i.source),i=r.cT(i),i=r.W(i,{source:v})),this._validate(nt,`layers.${v}`,i,{arrayIndex:-1},m))return;x=r.cY(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[x.id]=x.serialize()}x.isConfigDependent&&this._configDependentLayers.add(x.fqid);let w=this._order.length;if(c){let O=this._order.indexOf(c);if(O===-1)return void this.fire(new r.d(new Error(`Layer with id "${c}" does not exist on this map.`)));x.slot===this._layers[c].slot?w=O:r.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,v),this._layerOrderChanged=!0,this._layers[v]=x;let E=this.getOwnLayerSourceCache(x),S=!!this.directionalLight&&this.directionalLight.shadowsEnabled();E&&x.canCastShadows()&&S&&(E.castsShadows=!0);let M=this._changes.getRemovedLayer(x);if(M&&x.source&&E&&x.type!=="custom"){this._changes.discardLayerRemoval(x);let O=r.al(x.source,x.scope);M.type!==x.type?this._changes.updateSourceCache(O,"clear"):(this._changes.updateSourceCache(O,"reload"),E.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(i,c){this._checkLoaded();let m=this._checkLayer(i);if(!m||i===c)return;let v=this._order.indexOf(i);this._order.splice(v,1);let x=this._order.length;if(c){let w=this._order.indexOf(c);if(w===-1)return void this.fire(new r.d(new Error(`Layer with id "${c}" does not exist on this map.`)));m.slot===this._layers[c].slot?x=w:r.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();let c=this._checkLayer(i);if(!c)return;c.setEventedParent(null);let m=this._order.indexOf(i);this._order.splice(m,1),delete this._layers[i],delete this._serializedLayers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);let v=this.getOwnLayerSourceCache(c);if(v&&v.castsShadows){let x=!1;for(let w in this._layers)if(this._layers[w].source===c.source&&this._layers[w].canCastShadows()){x=!0;break}v.castsShadows=x}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(let c in this._layers)if(this._layers[c].type===i)return!0;return!1}setLayerZoomRange(i,c,m){this._checkLoaded();let v=this._checkLayer(i);v&&(v.minzoom===c&&v.maxzoom===m||(c!=null&&(v.minzoom=c),m!=null&&(v.maxzoom=m),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,c){this._checkLoaded();let m=this._checkLayer(i);m&&m.slot!==c&&(m.slot=c,this._updateLayer(m))}setFilter(i,c,m={}){this._checkLoaded();let v=this._checkLayer(i);if(v&&!C(v.filter,c))return c==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(Ke,`layers.${v.id}.filter`,c,{layerType:v.type},m)||(v.filter=r.cT(c),this._updateLayer(v)))}getFilter(i){let c=this._checkLayer(i);if(c)return r.cT(c.filter)}setLayoutProperty(i,c,m,v={}){this._checkLoaded();let x=this._checkLayer(i);if(x&&!C(x.getLayoutProperty(c),m)){if(m!=null&&(!v||v.validate!==!1)&&xs(x,Ct.call(ue,{key:`layers.${i}.layout.${c}`,layerType:x.type,objectKey:c,value:m,styleSpec:r.L,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(c,m),x.isConfigDependent&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(i,c){let m=this._checkLayer(i);if(m)return m.getLayoutProperty(c)}setPaintProperty(i,c,m,v={}){this._checkLoaded();let x=this._checkLayer(i);if(!x||C(x.getPaintProperty(c),m)||m!=null&&(!v||v.validate!==!1)&&xs(x,_t.call(ue,{key:`layers.${i}.paint.${c}`,layerType:x.type,objectKey:c,value:m,styleSpec:r.L})))return;let w=x.setPaintProperty(c,m);x.isConfigDependent&&this._configDependentLayers.add(x.fqid),w&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(i,c){let m=this._checkLayer(i);if(m)return m.getPaintProperty(c)}setFeatureState(i,c){this._checkLoaded();let m=i.source,v=i.sourceLayer,x=this._checkSource(m);if(!x)return;let w=x.type;if(w==="geojson"&&v)return void this.fire(new r.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!v)return void this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new r.d(new Error("The feature id parameter must be provided.")));let E=this.getOwnSourceCaches(m);for(let S of E)S.setFeatureState(v,i.id,c)}removeFeatureState(i,c){this._checkLoaded();let m=i.source,v=this._checkSource(m);if(!v)return;let x=v.type,w=x==="vector"?i.sourceLayer:void 0;if(x==="vector"&&!w)return void this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new r.d(new Error("A feature id is required to remove its specific state property.")));let E=this.getOwnSourceCaches(m);for(let S of E)S.removeFeatureState(w,i.id,c)}getFeatureState(i){this._checkLoaded();let c=i.source,m=i.sourceLayer,v=this._checkSource(c);if(v){if(v.type!=="vector"||m)return i.id===void 0&&this.fire(new r.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(m,i.id);this.fire(new r.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=r.W({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return r.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();let i=this.getTerrain(),c=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return r.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},m=>m!==void 0)}_updateLayer(i){this._changes.updateLayer(i);let c=this.getLayerSourceCache(i),m=r.al(i.source,i.scope),v=this._changes.getUpdatedSourceCaches();i.source&&!v[m]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(m,"reload"),c.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){let c=E=>this._mergedLayers[E].type==="fill-extrusion"||this._mergedLayers[E].type==="model",m=this.order,v={},x=[];for(let E=m.length-1;E>=0;E--){let S=m[E];if(c(S)){v[S]=E;for(let M of i){let O=M[S];if(O)for(let F of O)x.push(F)}}}x.sort((E,S)=>S.intersectionZ-E.intersectionZ);let w=[];for(let E=m.length-1;E>=0;E--){let S=m[E];if(c(S))for(let M=x.length-1;M>=0;M--){let O=x[M].feature;if(O.layer&&v[O.layer.id]<E)break;w.push(O),x.pop()}else for(let M of i){let O=M[S];if(O)for(let F of O)w.push(F.feature)}}return w}queryRenderedFeatures(i,c,m){c&&c.filter&&this._validate(Ke,"queryRenderedFeatures.filter",c.filter,null,c),c.scope=this.scope,c.availableImages=this._availableImages,c.serializedLayers=this._serializedLayers;let v={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new r.d(new Error("parameters.layers must be an Array."))),[];for(let M of c.layers){let O=this._mergedLayers[M];if(!O)return this.fire(new r.d(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];v[O.source]=!0}}let x=[],w=c.serializedLayers||{},E=c&&c.layers?c.layers.some(M=>{let O=this.getLayer(M);return O&&O.is3D()}):this.has3DLayers(),S=ii.createFromScreenPoints(i,m);for(let M in this._mergedSourceCaches){let O=this._mergedSourceCaches[M].getSource();if(!O||O.scope!==c.scope)continue;let F=this._mergedSourceCaches[M].getSource().id;c.layers&&!v[F]||x.push(ox(this._mergedSourceCaches[M],this._mergedLayers,w,S,c,m,E,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(M,O,F,z,V,$,G){let H={},q=$.queryRenderedSymbols(z),J=[];for(let ee of Object.keys(q).map(Number))J.push(G[ee]);J.sort(yl);for(let ee of J){let te=ee.featureIndex.lookupSymbolFeatures(q[ee.bucketInstanceId],O,ee.bucketIndex,ee.sourceLayerIndex,V.filter,V.layers,V.availableImages,M);for(let ce in te){let le=H[ce]=H[ce]||[],Q=te[ce];Q.sort((ne,re)=>{let pe=ee.featureSortOrder;if(pe){let Ee=pe.indexOf(ne.featureIndex);return pe.indexOf(re.featureIndex)-Ee}return re.featureIndex-ne.featureIndex});for(let ne of Q)le.push(ne)}}for(let ee in H)H[ee].forEach(te=>{let ce=te.feature,le=F(M[ee]);if(!le)return;let Q=le.getFeatureState(ce.layer["source-layer"],ce.id);ce.source=ce.layer.source,ce.layer["source-layer"]&&(ce.sourceLayer=ce.layer["source-layer"]),ce.state=Q});return H}(this._mergedLayers,w,this.getLayerSourceCache.bind(this),S.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(i,c){c&&c.filter&&this._validate(Ke,"querySourceFeatures.filter",c.filter,null,c);let m=this.getOwnSourceCaches(i),v=[];for(let x of m)v=v.concat(Gc(x,c));return v}addSourceType(i,c,m){return no.getSourceType(i)?m(new Error(`A source type called "${i}" already exists.`)):(no.setSourceType(i,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:c.workerSourceURL},m):m(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,c,m={}){this._checkLoaded();let v=this.light.getLight(),x=!1;for(let E in i)if(!C(i[E],v[E])){x=!0;break}if(!x)return;let w=this._getTransitionParameters();this.light.setLight(i,c,m),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,c=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()&&c!==0||delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let m=i,v=i.source==null;if(c===1){if(this.disableElevatedTerrain)return;if(typeof m.source=="object"){let E="terrain-dem-src";this.addSource(E,m.source),m=r.cT(m),m=r.W(m,{source:E})}let x=r.W({},m),w={};if(this.terrain&&v){x.source=this.terrain.get().source;let E=this.terrain?this.getFragmentStyle(this.terrain.scope):null;E&&(w.style=E.serialize())}if(this._validate(ye,"terrain",x,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&c!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,c),this.fire(new r.f("data",{dataType:"style"}))}else{let x=this.terrain,w=x.get();for(let E of Object.keys(r.L.terrain))!m.hasOwnProperty(E)&&r.L.terrain[E].default&&(m[E]=r.L.terrain[E].default);for(let E in i)if(!C(i[E],w[E])){x.set(i,this.options),this.stylesheet.terrain=i;let S=this._getTransitionParameters({duration:0});x.updateTransitions(S),this.fire(new r.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){let c=this.fog=new yg(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();let m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let c=this.fog;if(!C(c.get(),i)){c.set(i,this.options),this.stylesheet.fog=c.get();let m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}}else this._createFog(i);this._markersNeedUpdate=!0}setColorTheme(i){this._checkLoaded();let c=()=>{for(let v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(let v in this._sourceCaches)this._sourceCaches[v].clearTiles()};if(this._styleColorTheme.colorTheme=i,!i)return this._styleColorTheme.lut=null,void c();let m=this._evaluateColorThemeData(i);this._loadColorTheme(m).then(()=>{c()}).catch(v=>{r.w(`Couldn't set color theme: ${v}`)})}_getTransitionParameters(i){return{now:r.e.now(),transition:r.W(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;let i=[],c=[];for(let m in this._mergedLayers)this.isLayerDraped(this._mergedLayers[m])?i.push(m):c.push(m);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...c)}_createTerrain(i,c){let m=this.terrain=new An(i,c,this.scope,this.options);c===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let v=this._getTransitionParameters({duration:0});m.updateTransitions(v)}_force3DLayerUpdate(){for(let i in this._layers){let c=this._layers[i];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(let i in this._layers){let c=this._layers[i];c.type==="symbol"&&this._updateLayer(c)}}_validate(i,c,m,v,x={}){if(x&&x.validate===!1)return!1;let w=r.W({},this.serialize());return xs(this,i.call(ue,r.W({key:c,style:w,value:m,styleSpec:r.L},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(let i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(let i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){let c=this.getSourceCaches(i);for(let m of c)m.clearTiles()}clearSources(){for(let i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){let c=this.getSourceCaches(i);for(let m of c)m.resume(),m.reload()}reloadSources(){for(let i of this.getSources())i.reload&&i.reload()}updateSources(i){let c;this.directionalLight&&(c=Sc(this.directionalLight));for(let m in this._mergedSourceCaches)this._mergedSourceCaches[m].update(i,void 0,void 0,c)}_generateCollisionBoxes(){for(let i in this._sourceCaches){let c=this._sourceCaches[i];c.resume(),c.reload()}}_updatePlacement(i,c,m,v,x,w,E=!1){let S=!1,M=!1,O={},F={};for(let V of this._mergedOrder){let $=this._mergedLayers[V];if($.type!=="symbol")continue;let G=r.al($.source,$.scope),H=O[G];if(!H){let J=this.getLayerSourceCache($);if(!J)continue;let ee=J.getRenderableIds(!0).map(te=>J.getTileByID(te));F[G]=ee.slice(),H=O[G]=ee.sort((te,ce)=>ce.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(ce.tileID)?-1:1))}let q=this.crossTileSymbolIndex.addLayer($,H,c.center.lng,c.projection);S=S||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),E=E||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new r.f("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.e.now(),c.zoom))&&(this.pauseablePlacement=new Nh(c,this._mergedOrder,E,m,v,x,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,O,F),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.e.now()),M=!0),S&&this.pauseablePlacement.placement.setStale()),M||S){this._buildingIndex.onNewFrame(c.zoom);for(let V=0;V<this._mergedOrder.length;V++){let $=this._mergedLayers[this._mergedOrder[V]];if($.type!=="symbol")continue;let G=this.isLayerClipped($)&&this._clipLayerIndices.some(H=>V<H);this.placement.updateLayerOpacities($,O[r.al($.source,$.scope)],V,G?w:null)}}let z=!1;for(let V of this._mergedOrder){let $=this._mergedLayers[V];if($.type!=="symbol")continue;let G=O[r.al($.source,$.scope)];for(let H of G){let q=H.getBucket($);q&&H.latestFeatureIndex&&$.fqid===q.layerIds[0]&&(z=q.updateOcclusionOpacities(i.context,i.symbolParams,i._dt)||z)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.e.now())||z,occlusionQueryBasedOpacityChanged:z}}_releaseSymbolFadeTiles(){for(let i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,c){this._checkLoaded();let m=this.stylesheet.imports=this.stylesheet.imports||[];if(m.findIndex(({id:x})=>x===i.id)!==-1)return void this.fire(new r.d(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!c)return m.push(i),this._loadImports([i],!0);let v=m.findIndex(({id:x})=>x===c);return v===-1&&this.fire(new r.d(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=m.slice(0,v).concat(i).concat(m.slice(v)),this._loadImports([i],!0,c)}updateImport(i,c){this._checkLoaded();let m=this.stylesheet.imports||[],v=this.getImportIndex(i);return v===-1?this:typeof c=="string"?(this.setImportUrl(i,c),this):(c.url&&c.url!==m[v].url&&this.setImportUrl(i,c.url),C(c.config,m[v].config)||this.setImportConfig(i,c.config),C(c.data,m[v].data)||this.setImportData(i,c.data),this)}moveImport(i,c){this._checkLoaded();let m=this.stylesheet.imports||[],v=this.getImportIndex(i);if(v===-1)return this;let x=this.getImportIndex(c);if(x===-1)return this;let w=m[v],E=this.fragments[v];return m=m.filter(({id:S})=>S!==i),this.fragments=this.fragments.filter(({id:S})=>S!==i),this.stylesheet.imports=m.slice(0,x).concat(w).concat(m.slice(x)),this.fragments=this.fragments.slice(0,x).concat(E).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(i,c){this._checkLoaded();let m=this.stylesheet.imports||[],v=this.getImportIndex(i);if(v===-1)return this;m[v].url=c;let x=this.fragments[v];return x.style=this._createFragmentStyle(m[v]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(c),this}setImportData(i,c){this._checkLoaded();let m=this.getImportIndex(i),v=this.stylesheet.imports||[];return m===-1?this:c?(this.fragments[m].style.setState(c),this._reloadImports(),this):(delete v[m].data,this.setImportUrl(i,v[m].url))}setImportConfig(i,c){this._checkLoaded();let m=this.getImportIndex(i),v=this.stylesheet.imports||[];if(m===-1)return this;c?v[m].config=c:delete v[m].config;let x=this.fragments[m],w=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=c,x.style.updateConfig(c,w),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();let c=this.stylesheet.imports||[],m=this.getImportIndex(i);m!==-1&&(c.splice(m,1),this.fragments[m].style._remove(),this.fragments.splice(m,1),this._reloadImports())}getImportIndex(i){let c=(this.stylesheet.imports||[]).findIndex(m=>m.id===i);return c===-1&&this.fire(new r.d(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),c}getLayer(i){return this._mergedLayers[i]}getSources(){let i=[];for(let c in this._mergedOtherSourceCaches){let m=this._mergedOtherSourceCaches[c];m&&i.push(m.getSource())}return i}getSource(i,c){let m=this.getSourceCache(i,c);return m&&m.getSource()}getLayerSource(i){let c=this.getLayerSourceCache(i);return c&&c.getSource()}getSourceCache(i,c){let m=r.al(i,c);return this._mergedOtherSourceCaches[m]}getLayerSourceCache(i){let c=r.al(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);let c=[];return this._mergedOtherSourceCaches[i]&&c.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&c.push(this._mergedSymbolSourceCaches[i]),c}updateSourceCaches(){let i=this._changes.getUpdatedSourceCaches();for(let c in i){let m=i[c];m==="reload"?this.reloadSource(c):m==="clear"&&this.clearSource(c)}}updateLayers(i){let c=this._changes.getUpdatedPaintProperties();for(let m of c){let v=this.getLayer(m);v&&v.updateTransitions(i)}}getImages(i,c,m){this.imageManager.getImages(c.icons,c.scope,m),this._updateTilesForChangedImages();let v=x=>{x&&x.setDependencies(c.tileID.key,c.type,c.icons)};v(this._otherSourceCaches[c.source]),v(this._symbolSourceCaches[c.source])}getGlyphs(i,c,m){this.glyphManager.getGlyphs(c.stacks,c.scope,m)}getResource(i,c,m){return r.c$(c,m)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){let c=[];return this._otherSourceCaches[i]&&c.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&c.push(this._symbolSourceCaches[i]),c}_isSourceCacheLoaded(i){let c=this.getOwnSourceCaches(i);return c.length===0?(this.fire(new r.d(new Error(`There is no source with ID '${i}'`))),!1):c.every(m=>m.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,c){if(this._clipLayerIndices.length===0&&i.type!=="fill-extrusion")return!1;let m=i.type==="fill-extrusion"&&i.sourceLayer==="building",v=0;if(i.is3D()){if(m||c&&c.type==="batched-model")return!0;i.type==="model"&&(v=r.cu.Model)}else i.type==="symbol"&&(v=r.cu.Symbol);for(let x of this._clipLayerIndices){let w=this._mergedLayers[this._mergedOrder[x]];if(!w)continue;let E=[];for(let S of w.layout.get("clip-layer-types"))E.push(S==="model"?r.cu.Model:S==="symbol"?r.cu.Symbol:r.cu.FillExtrusion);for(let S of E)if(v&S)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function cp(d,i){let c=!1,m=null,v=()=>{m=null,c&&(d(),m=setTimeout(v,i),c=!1)};return()=>(c=!0,m||v(),m)}no.getSourceType=function(d){return Rr[d]},no.setSourceType=function(d,i){Rr[d]=i},no.registerForPluginStateChange=r.cL;class fx{constructor(i){this._hashName=i&&encodeURIComponent(i),r.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=cp(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let i=this._map;if(!i)return"";let c=Xc(i);if(this._hashName){let m=this._hashName,v=!1,x=location.hash.slice(1).split("&").map(w=>{let E=w.split("=")[0];return E===m?(v=!0,`${E}=${c}`):w}).filter(w=>w);return v||x.push(`${m}=${c}`),`#${x.join("&")}`}return`#${c}`}_getCurrentHash(){let i=location.hash.replace("#","");if(this._hashName){let c;return i.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(c=m)}),(c&&c[1]||"").split("/")}return i.split("/")}_onHashChange(){let i=this._map;if(!i)return!1;let c=this._getCurrentHash();if(c.length>=3&&!c.some(m=>isNaN(m))){let m=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(c[3]||0):i.getBearing();return i.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:m,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Xc(d,i){let c=d.getCenter(),m=Math.round(100*d.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),w=Math.round(c.lng*x)/x,E=Math.round(c.lat*x)/x,S=d.getBearing(),M=d.getPitch(),O=i?`/${w}/${E}/${m}`:`${m}/${E}/${w}`;return(S||M)&&(O+="/"+Math.round(10*S)/10),M&&(O+=`/${Math.round(M)}`),O}let zh={linearity:.3,easing:r.d0(0,0,.3,1)},Xg=r.W({deceleration:2500,maxSpeed:1400},zh),up=r.W({deceleration:20,maxSpeed:1400},zh),Bh=r.W({deceleration:1e3,maxSpeed:360},zh),hp=r.W({deceleration:1e3,maxSpeed:90},zh);class ua{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.e.now(),settings:i})}_drainInertiaBuffer(){let i=this._inertiaBuffer,c=r.e.now();for(;i.length>0&&c-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let c={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:x}of this._inertiaBuffer)c.zoom+=x.zoomDelta||0,c.bearing+=x.bearingDelta||0,c.pitch+=x.pitchDelta||0,x.panDelta&&c.pan._add(x.panDelta),x.around&&(c.around=x.around),x.pinchAround&&(c.pinchAround=x.pinchAround);let m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(c.pan.mag()){let x=Kc(c.pan.mag(),m,r.W({},Xg,i||{}));v.offset=c.pan.mult(x.amount/c.pan.mag()),v.center=this._map.transform.center,bl(v,x)}if(c.zoom){let x=Kc(c.zoom,m,up);v.zoom=this._map.transform.zoom+x.amount,bl(v,x)}if(c.bearing){let x=Kc(c.bearing,m,Bh);v.bearing=this._map.transform.bearing+r.at(x.amount,-179,179),bl(v,x)}if(c.pitch){let x=Kc(c.pitch,m,hp);v.pitch=this._map.transform.pitch+x.amount,bl(v,x)}if(v.zoom||v.bearing){let x=c.pinchAround===void 0?c.around:c.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function bl(d,i){(!d.duration||d.duration<i.duration)&&(d.duration=i.duration,d.easing=i.easing)}function Kc(d,i,c){let{maxSpeed:m,linearity:v,deceleration:x}=c,w=r.at(d*v/(i/1e3),-m,m),E=Math.abs(w)/(x*v);return{easing:c.easing,duration:1e3*E,amount:w*(E/2)}}class Or extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,m,v={}){let x=gt(c.getCanvasContainer(),m),w=c.unproject(x);super(i,r.W({point:x,lngLat:w,originalEvent:m},v)),this._defaultPrevented=!1,this.target=c}}class bs extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,m){let v=i==="touchend"?m.changedTouches:m.touches,x=Be(c.getCanvasContainer(),v),w=x.map(S=>c.unproject(S)),E=x.reduce((S,M,O,F)=>S.add(M.div(F.length)),new r.P(0,0));super(i,{points:x,point:E,lngLats:w,lngLat:c.unproject(E),originalEvent:m}),this._defaultPrevented=!1}}class Vh extends r.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,m){super(i,{originalEvent:m}),this._defaultPrevented=!1}}class dp{constructor(i,c){this._map=i,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Vh(i.type,this._map,i))}mousedown(i,c){return this._mousedownPos=c,this._firePreventable(new Or(i.type,this._map,i))}mouseup(i){this._map.fire(new Or(i.type,this._map,i))}preclick(i){let c=r.W({},i);c.type="preclick",this._map.fire(new Or(c.type,this._map,c))}click(i,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Or(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Or(i.type,this._map,i))}mouseover(i){this._map.fire(new Or(i.type,this._map,i))}mouseout(i){this._map.fire(new Or(i.type,this._map,i))}touchstart(i){return this._firePreventable(new bs(i.type,this._map,i))}touchmove(i){this._map.fire(new bs(i.type,this._map,i))}touchend(i){this._map.fire(new bs(i.type,this._map,i))}touchcancel(i){this._map.fire(new bs(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qc{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Or(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Or("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Or(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jh{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,c){this.isEnabled()&&i.shiftKey&&i.button===0&&(Ge(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(i,c){if(!this._active)return;let m=c,v=this._startPos,x=this._lastPos;if(!v||!x||x.equals(m)||!this._box&&m.dist(v)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=Z("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));let w=Math.min(v.x,m.x),E=Math.max(v.x,m.x),S=Math.min(v.y,m.y),M=Math.max(v.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${S}px)`,this._box.style.width=E-w+"px",this._box.style.height=M-S+"px")})}mouseupWindow(i,c){if(!this._active)return;let m=this._startPos,v=c;if(m&&i.button===0){if(this.reset(),ct(),m.x!==v.x||m.y!==v.y)return this._map.fire(new r.f("boxzoomend",{originalEvent:i})),{cameraAnimation:x=>x.fitScreenCoordinates(m,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ve(),delete this._startPos,delete this._lastPos}_fireEvent(i,c){return this._map.fire(new r.f(i,{originalEvent:c}))}}function Jc(d,i){let c={};for(let m=0;m<d.length;m++)c[d[m].identifier]=i[m];return c}class Kg{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),m.length===this.numTouches&&(this.centroid=function(v){let x=new r.P(0,0);for(let w of v)x._add(w);return x.div(v.length)}(c),this.touches=Jc(m,c)))}touchmove(i,c,m){if(this.aborted||!this.centroid)return;let v=Jc(m,c);for(let x in this.touches){let w=v[x];(!w||w.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(i,c,m){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){let v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class eu{constructor(i){this.singleTap=new Kg(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,c,m){this.singleTap.touchstart(i,c,m)}touchmove(i,c,m){this.singleTap.touchmove(i,c,m)}touchend(i,c,m){let v=this.singleTap.touchend(i,c,m);if(v){let x=i.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(v)<30;if(x&&w||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Uh{constructor(){this._zoomIn=new eu({numTouches:1,numTaps:2}),this._zoomOut=new eu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,c,m){this._zoomIn.touchstart(i,c,m),this._zoomOut.touchstart(i,c,m)}touchmove(i,c,m){this._zoomIn.touchmove(i,c,m),this._zoomOut.touchmove(i,c,m)}touchend(i,c,m){let v=this._zoomIn.touchend(i,c,m),x=this._zoomOut.touchend(i,c,m);return v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(v)},{originalEvent:i})}):x?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(x)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let tu={0:1,2:2};class $h{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,c){return!1}_move(i,c){return{}}mousedown(i,c){if(this._lastPoint)return;let m=St(i);this._correctButton(i,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(i,c){let m=this._lastPoint;if(m){if(i.preventDefault(),this._eventButton!=null&&function(v,x){let w=tu[x];return v.buttons===void 0||(v.buttons&w)!==w}(i,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}}mouseupWindow(i){this._lastPoint&&St(i)===this._eventButton&&(this._moved&&ct(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qg extends $h{mousedown(i,c){super.mousedown(i,c),this._lastPoint&&(this._active=!0)}_correctButton(i,c){return c===0&&!i.ctrlKey}_move(i,c){return{around:c,panDelta:c.sub(i)}}}class fp extends $h{_correctButton(i,c){return c===0&&i.ctrlKey||c===2}_move(i,c){let m=.8*(c.x-i.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(i){i.preventDefault()}}class ha extends $h{_correctButton(i,c){return c===0&&i.ctrlKey||c===2}_move(i,c){let m=-.5*(c.y-i.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(i){i.preventDefault()}}class Jg{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),r.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(i,c,m){return this._calculateTransform(i,c,m)}touchmove(i,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!r.d1())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,c,m)}}touchend(i,c,m){this._calculateTransform(i,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,c,m){m.length>0&&(this._active=!0);let v=Jc(m,c),x=new r.P(0,0),w=new r.P(0,0),E=0;for(let M in v){let O=v[M],F=this._touches[M];F&&(x._add(O),w._add(O.sub(F)),E++,v[M]=O)}if(this._touches=v,E<this._minTouches||!w.mag())return;let S=w.div(E);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(E),panDelta:S}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Z("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class pp{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,c,m){return{}}touchstart(i,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(i,c,m){let v=this._firstTwoTouches;if(!v)return;i.preventDefault();let[x,w]=v,E=Gh(m,c,x),S=Gh(m,c,w);if(!E||!S)return;let M=this._aroundCenter?null:E.add(S).div(2);return this._move([E,S],M,i)}touchend(i,c,m){if(!this._firstTwoTouches)return;let[v,x]=this._firstTwoTouches,w=Gh(m,c,v),E=Gh(m,c,x);w&&E||(this._active&&ct(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Gh(d,i,c){for(let m=0;m<d.length;m++)if(d[m].identifier===c)return i[m]}function e_(d,i){return Math.log(d/i)/Math.LN2}class mp extends pp{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,c){let m=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(e_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:e_(this._distance,m),pinchAround:c}}}function Hh(d,i){return 180*d.angleWith(i)/Math.PI}class gp extends pp{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,c){let m=this._vector;if(this._vector=i[0].sub(i[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Hh(this._vector,m),pinchAround:c}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());let c=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;let v=Hh(i,m);return Math.abs(v)<c}}function nu(d){return Math.abs(d.y)>Math.abs(d.x)}class t_ extends pp{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,nu(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,c,m){let v=this._lastPoints;if(!v)return;let x=i[0].sub(v[0]),w=i[1].sub(v[1]);return this._map._cooperativeGestures&&!r.d1()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(x,w,m.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(x.y+w.y)/2*-.5})}gestureBeginsVertically(i,c,m){if(this._valid!==void 0)return this._valid;let v=i.mag()>=2,x=c.mag()>=2;if(!v&&!x)return;if(!v||!x)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;let w=i.y>0==c.y>0;return nu(i)&&nu(c)&&w}}let n_={panStep:100,bearingStep:15,pitchStep:10};class px{constructor(){let i=n_;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let c=0,m=0,v=0,x=0,w=0;switch(i.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:i.shiftKey?m=-1:(i.preventDefault(),x=-1);break;case 39:i.shiftKey?m=1:(i.preventDefault(),x=1);break;case 38:i.shiftKey?v=1:(i.preventDefault(),w=-1);break;case 40:i.shiftKey?v=-1:(i.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:E=>{let S=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:ru,zoom:c?Math.round(S)+c*(i.shiftKey?2:1):S,bearing:E.getBearing()+m*this._bearingStep,pitch:E.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-w*this._panStep],center:E.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ru(d){return d*(2-d)}let wl=4.000244140625,r_=1/450;class Ii{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=r_,r.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||r.d1()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY,m=r.e.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,c!==0&&c%wl==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(v*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),i.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=i,this._delta-=c,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let c=gt(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let c=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){let M=this._type==="wheel"&&Math.abs(this._delta)>wl?this._wheelZoomRate:this._defaultZoomRate,O=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&O!==0&&(O=1/O);let F=c(),z=Math.pow(2,F),V=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(V*O))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let m=typeof this._targetZoom=="number"?this._targetZoom:c(),v=this._startZoom,x=this._easing,w,E=!1;if(this._type==="wheel"&&v&&x){let M=Math.min((r.e.now()-this._lastWheelEventTime)/200,1),O=x(M);w=r.a2(v,m,O),M<1?this._frameId||(this._frameId=!0):E=!0}else w=m,E=!0;this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let S=w-c();return S*this._lastDelta<0&&(S=0),{noInertia:!0,needsRenderFrame:!E,zoomDelta:S,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let c=r.d2;if(this._prevEase){let m=this._prevEase,v=(r.e.now()-m.start)/m.duration,x=m.easing(v+.01)-m.easing(v),w=.27/Math.sqrt(x*x+1e-4)*.01,E=Math.sqrt(.0729-w*w);c=r.d0(w,E,.25,1)}return this._prevEase={start:r.e.now(),duration:i,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Z("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class _p{constructor(i,c){this._clickZoom=i,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,c){return i.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(i.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wh{constructor(){this._tap=new eu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,c,m){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(i,c,m))}touchmove(i,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;let v=c[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,i.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(i,c,m)}touchend(i,c,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(i,c,m)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yp{constructor(i,c,m){this._el=i,this._mousePan=c,this._touchPan=m}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class vp{constructor(i,c,m){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Zh{constructor(i,c,m,v){this._el=i,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Tl=d=>d.zoom||d.drag||d.pitch||d.rotate;class xp extends r.f{}class Yh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,c){let m=r._.sub([],c,i);this.radius=r._.length(m[2]<0?r._.div([],m,this.constants):[m[0],m[1],0])}projectRay(i){r._.div(i,i,this.constants),r._.normalize(i,i),r._.mul(i,i,this.constants);let c=r._.scale([],i,this.radius);if(c[2]>0){let m=r._.scale([],[0,0,1],r._.dot(c,[0,0,1])),v=r._.scale([],r._.normalize([],[c[0],c[1],0]),this.radius),x=r._.add([],c,r._.scale([],r._.sub([],r._.add([],v,m),c),2));c[0]=x[0],c[1]=x[1]}return c}}function iu(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class i_{constructor(i,c){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ua(i),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Yh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),r.bp(["handleEvent","handleWindowEvent"],this);let m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(let[v,x,w]of this._listeners){let E=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(x,E,w)}}destroy(){for(let[i,c,m]of this._listeners){let v=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(c,v,m)}}_addDefaultHandlers(i){let c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new dp(c,i));let v=c.boxZoom=new jh(c,i);this._add("boxZoom",v);let x=new Uh,w=new qh;c.doubleClickZoom=new _p(w,x),this._add("tapZoom",x),this._add("clickZoom",w);let E=new Wh;this._add("tapDragZoom",E);let S=c.touchPitch=new t_(c);this._add("touchPitch",S);let M=new fp(i),O=new ha(i);c.dragRotate=new vp(i,M,O),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);let F=new Qg(i),z=new Jg(c,i);c.dragPan=new yp(m,F,z),this._add("mousePan",F),this._add("touchPan",z,["touchZoom","touchRotate"]);let V=new gp,$=new mp;c.touchZoomRotate=new Zh(m,$,V,E),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Qc(c));let G=c.scrollZoom=new Ii(c,this);this._add("scrollZoom",G,["mousePan"]);let H=c.keyboard=new px;this._add("keyboard",H);for(let q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[q]&&c[q].enable(i[q])}_add(i,c,m){this._handlers.push({handlerName:i,handler:c,allowed:m}),this._handlersById[i]=c}stop(i){if(!this._updatingCamera){for(let{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Tl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,c,m){for(let v in i)if(v!==m&&(!c||c.indexOf(v)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){let c=[];for(let m of i)this._el.contains(m.target)&&c.push(m);return c}handleEvent(i,c){this._updatingCamera=!0;let m=i.type==="renderFrame",v=m?void 0:i,x={needsRenderFrame:!1},w={},E={},S=i.touches?this._getMapTouches(i.touches):void 0,M=S?Be(this._el,S):m?void 0:gt(this._el,i);for(let{handlerName:z,handler:V,allowed:$}of this._handlers){if(!V.isEnabled())continue;let G;this._blockedByActive(E,$,z)?V.reset():V[c||i.type]&&(G=V[c||i.type](i,M,S),this.mergeHandlerResult(x,w,G,z,v),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||V.isActive())&&(E[z]=V)}let O={};for(let z in this._previousActiveHandlers)E[z]||(O[z]=v);this._previousActiveHandlers=E,(Object.keys(O).length||iu(x))&&(this._changes.push([x,w,O]),this._triggerRenderFrame()),(Object.keys(E).length||iu(x))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:F}=x;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(i,c,m,v,x){if(!m)return;r.W(i,m);let w={handlerName:v,originalEvent:m.originalEvent||x};m.zoomDelta!==void 0&&(c.zoom=w),m.panDelta!==void 0&&(c.drag=w),m.pitchDelta!==void 0&&(c.pitch=w),m.bearingDelta!==void 0&&(c.rotate=w)}_applyChanges(){let i={},c={},m={};for(let[v,x,w]of this._changes)v.panDelta&&(i.panDelta=(i.panDelta||new r.P(0,0))._add(v.panDelta)),v.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(i.around=v.around),v.aroundCoord!==void 0&&(i.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(i.pinchAround=v.pinchAround),v.noInertia&&(i.noInertia=v.noInertia),r.W(c,x),r.W(m,w);this._updateMapTransform(i,c,m),this._changes=[]}_updateMapTransform(i,c,m){let v=this._map,x=v.transform,w=J=>[J.x,J.y,J.z];if((J=>{let ee=this._eventsInProgress.drag;return ee&&!this._handlersById[ee.handlerName].isActive()})()&&!iu(i)){let J=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),J!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&v._stop(!0),!iu(i))return void this._fireEvents(c,m,!0);let{panDelta:E,zoomDelta:S,bearingDelta:M,pitchDelta:O,around:F,aroundCoord:z,pinchAround:V}=i;x._isCameraConstrained&&(S>0&&(S=0),x._isCameraConstrained=!1),V!==void 0&&(F=V),(S||(J=>c[J]&&!this._eventsInProgress[J])("drag"))&&F&&(this._dragOrigin=w(x.pointCoordinate3D(F)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),F=F||v.transform.centerPoint,M&&(x.bearing+=M),O&&(x.pitch+=O),x._updateCameraState();let $=[0,0,0];if(E)if(x.projection.name==="mercator"){let J=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(F).dir),ee=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(F.sub(E)).dir);$[0]=ee[0]-J[0],$[1]=ee[1]-J[1]}else{let J=x.pointCoordinate(F);if(x.projection.name==="globe"){E=E.rotate(-x.angle);let ee=x._pixelsPerMercatorPixel/x.worldSize;$[0]=-E.x*r.d3(r.ay(J.y))*ee,$[1]=-E.y*r.d3(x.center.lat)*ee}else{let ee=x.pointCoordinate(F.sub(E));J&&ee&&($[0]=ee.x-J.x,$[1]=ee.y-J.y)}}let G=x.zoom,H=[0,0,0];if(S){let J=w(z||x.pointCoordinate3D(F)),ee={dir:r._.normalize([],r._.sub([],J,x._camera.position))};if(ee.dir[2]<0){let te=x.zoomDeltaToMovement(J,S);r._.scale(H,ee.dir,te)}}let q=r._.add($,$,H);x._translateCameraConstrained(q),S&&Math.abs(x.zoom-G)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(c,m,!0)}_fireEvents(i,c,m){let v=Tl(this._eventsInProgress),x=Tl(i),w={};for(let O in i){let{originalEvent:F}=i[O];this._eventsInProgress[O]||(w[`${O}start`]=F),this._eventsInProgress[O]=i[O]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(let O in w)this._fireEvent(O,w[O]);x&&this._fireEvent("move",x.originalEvent);for(let O in i){let{originalEvent:F}=i[O];this._fireEvent(O,F)}let E={},S;for(let O in this._eventsInProgress){let{handlerName:F,originalEvent:z}=this._eventsInProgress[O];this._handlersById[F].isActive()||(delete this._eventsInProgress[O],S=c[F]||z,E[`${O}end`]=S)}for(let O in E)this._fireEvent(O,E[O]);let M=Tl(this._eventsInProgress);if(m&&(v||x)&&!M){this._updatingCamera=!0;let O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;O?(F(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:S})):(this._map.fire(new r.f("moveend",{originalEvent:S})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,c){this._map.fire(new r.f(i,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new xp("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let da="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class mx extends r.E{constructor(i,c){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,r.bp(["_renderFrameCallback"],this)}getCenter(){return new r.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(i,c){return this.jumpTo({center:i},c)}panBy(i,c,m){return i=r.P.convert(i).mult(-1),this.panTo(this.transform.center,r.W({offset:i},c),m)}panTo(i,c,m){return this.easeTo(r.W({center:i},c),m)}getZoom(){return this.transform.zoom}setZoom(i,c){return this.jumpTo({zoom:i},c),this}zoomTo(i,c,m){return this.easeTo(r.W({zoom:i},c),m)}zoomIn(i,c){return this.zoomTo(this.getZoom()+1,i,c),this}zoomOut(i,c){return this.zoomTo(this.getZoom()-1,i,c),this}getBearing(){return this.transform.bearing}setBearing(i,c){return this.jumpTo({bearing:i},c),this}getPadding(){return this.transform.padding}setPadding(i,c){return this.jumpTo({padding:i},c),this}rotateTo(i,c,m){return this.easeTo(r.W({bearing:i},c),m)}resetNorth(i,c){return this.rotateTo(0,r.W({duration:1e3},i),c),this}resetNorthPitch(i,c){return this.easeTo(r.W({bearing:0,pitch:0,duration:1e3},i),c),this}snapToNorth(i,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,c):this}getPitch(){return this.transform.pitch}setPitch(i,c){return this.jumpTo({pitch:i},c),this}cameraForBounds(i,c){i=r.ai.convert(i);let m=c&&c.bearing||0,v=c&&c.pitch||0,x=i.getNorthWest(),w=i.getSouthEast();return this._cameraForBounds(this.transform,x,w,m,v,c)}_extendPadding(i){let c={top:0,right:0,bottom:0,left:0};return i==null?r.W({},c,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:r.W({},c,i)}_extendCameraOptions(i){return(i=r.W({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,c){let m=c.max[0]-c.min[0],v=c.max[1]-c.min[1];return m/v>i.aspect?m/(2*Math.tan(.5*i.fovX)*i.aspect):v/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,c,m,v,x,w){let E=i.clone(),S=this._extendCameraOptions(w);E.bearing=v,E.pitch=x;let M=r.aI.convert(c),O=r.aI.convert(m),F=.5*(M.lat+O.lat),z=.5*(M.lng+O.lng),V=r.d4(F,z),$=r._.normalize([],V),G=r._.normalize([],r._.cross([],$,[0,1,0])),H=r._.cross([],G,$),q=[G[0],G[1],G[2],0,H[0],H[1],H[2],0,$[0],$[1],$[2],0,0,0,0,1],J=[V,r.d4(M.lat,M.lng),r.d4(O.lat,M.lng),r.d4(O.lat,O.lng),r.d4(M.lat,O.lng),r.d4(F,M.lng),r.d4(F,O.lng),r.d4(M.lat,z),r.d4(O.lat,z)],ee=r.b6.fromPoints(J.map(ke=>[r._.dot(G,ke),r._.dot(H,ke),r._.dot($,ke)])),te=r._.transformMat4([],ee.center,q);r._.squaredLength(te)===0&&r._.set(te,0,0,1),r._.normalize(te,te),r._.scale(te,te,r.cD),E.center=r.d5(te);let ce=E.getWorldToCameraMatrix(),le=r.ad.invert(new Float64Array(16),ce);ee=r.b6.applyTransform(ee,r.ad.multiply([],ce,q));let Q=this._extendAABB(ee,E,S,v);if(!Q)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ee=Q,r._.transformMat4(te,te,ce);let ne=.5*(ee.max[2]-ee.min[2]),re=this._minimumAABBFrustumDistance(E,ee),pe=r._.scale([],[0,0,1],ne),Ee=r._.add(pe,te,pe),se=re+(E.pitch===0?0:r._.distance(te,Ee)),Ie=E.globeCenterInViewSpace,De=r._.sub([],te,[Ie[0],Ie[1],Ie[2]]);r._.normalize(De,De),r._.scale(De,De,se);let je=r._.add([],te,De);r._.transformMat4(je,je,le);let Ue=r.d7/r.cD,Ne=r._.length(je),ve=r.ax(Math.max(Ne*Ue-r.d7,Number.EPSILON),0),Ae=Math.min(E.zoomFromMercatorZAdjusted(ve),S.maxZoom);return Ae>.5*(r.b1+r.aU)?(E.setProjection({name:"mercator"}),E.zoom=Ae,this._cameraForBounds(E,c,m,v,x,w)):{center:E.center,zoom:Ae,bearing:v,pitch:x}}_extendAABB(i,c,m,v){let x=.5*((m.padding.left||0)+(m.padding.right||0)),w=.5*((m.padding.top||0)+(m.padding.bottom||0)),E=w,S=x,M=x,O=w,F=c.width-(S+M),z=c.height-(E+O),V=r._.sub([],i.max,i.min),$=Math.min(F/V[0],z/V[1]),G=Math.min(c.scaleZoom(c.scale*$),m.maxZoom);if(isNaN(G))return null;let H=c.scale/c.zoomScale(G),q=new r.b6([i.min[0]-S*H,i.min[1]-O*H,i.min[2]],[i.max[0]+M*H,i.max[1]+E*H,i.max[2]]),J=(typeof m.offset.x=="number"&&typeof m.offset.y=="number"?new r.P(m.offset.x,m.offset.y):r.P.convert(m.offset)).rotate(-r.ab(v));return q.center[0]-=J.x*H,q.center[1]+=J.y*H,q}queryTerrainElevation(i,c){let m=this.transform.elevation;return m?(c=r.W({},{exaggerated:!0},c),m.getAtPoint(r.Y.fromLngLat(i),null,c.exaggerated)):null}_cameraForBounds(i,c,m,v,x,w){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,c,m,v,x,w);let E=i.clone(),S=this._extendCameraOptions(w);E.bearing=v,E.pitch=x;let M=r.aI.convert(c),O=r.aI.convert(m),F=new r.aI(M.lng,O.lat),z=new r.aI(O.lng,M.lat),V=E.project(M),$=E.project(O),G=this.queryTerrainElevation(M),H=this.queryTerrainElevation(O),q=this.queryTerrainElevation(F),J=this.queryTerrainElevation(z),ee=[[V.x,V.y,Math.min(G||0,H||0,q||0,J||0)],[$.x,$.y,Math.max(G||0,H||0,q||0,J||0)]],te=r.b6.fromPoints(ee),ce=E.getWorldToCameraMatrix(),le=r.ad.invert(new Float64Array(16),ce);te=r.b6.applyTransform(te,ce);let Q=this._extendAABB(te,E,S,v);if(!Q)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");te=Q;let ne=.5*r._.sub([],te.max,te.min)[2],re=this._minimumAABBFrustumDistance(E,te),pe=[0,0,1,0];r.aA.transformMat4(pe,pe,ce),r.aA.normalize(pe,pe);let Ee=r._.scale([],pe,re+ne),se=r._.add([],te.center,Ee);r._.transformMat4(te.center,te.center,le),r._.transformMat4(se,se,le);let Ie=[te.center[0],te.center[1],se[2]*E.pixelsPerMeter];r._.scale(Ie,Ie,1/E.worldSize);let De=r.d6(Ie[0]),je=r.ay(Ie[1]),Ue=Math.min(E._zoomFromMercatorZ(Ie[2]),S.maxZoom),Ne=new r.aI(De,je);return E.mercatorFromTransition&&Ue<.5*(r.b1+r.aU)?(E.setProjection({name:"globe"}),E.zoom=Ue,this._cameraForBounds(E,c,m,v,x,w)):{center:Ne,zoom:Ue,bearing:v,pitch:x}}fitBounds(i,c,m){let v=this.cameraForBounds(i,c);return this._fitInternal(v,c,m)}fitScreenCoordinates(i,c,m,v,x){let w=r.P.convert(i),E=r.P.convert(c),S=new r.P(Math.min(w.x,E.x),Math.min(w.y,E.y)),M=new r.P(Math.max(w.x,E.x),Math.max(w.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,E))return this;let O=this.transform.pointLocation3D(S),F=this.transform.pointLocation3D(M),z=this.transform.pointLocation3D(new r.P(S.x,M.y)),V=this.transform.pointLocation3D(new r.P(M.x,S.y)),$=[Math.min(O.lng,F.lng,z.lng,V.lng),Math.min(O.lat,F.lat,z.lat,V.lat)],G=[Math.max(O.lng,F.lng,z.lng,V.lng),Math.max(O.lat,F.lat,z.lat,V.lat)],H=v&&v.pitch?v.pitch:this.getPitch(),q=this._cameraForBounds(this.transform,$,G,m,H,v);return this._fitInternal(q,v,x)}_fitInternal(i,c,m){return i?(c=r.W(i,c)).linear?this.easeTo(c,m):this.flyTo(c,m):this}jumpTo(i,c){this.stop();let m=i.preloadOnly?this.transform.clone():this.transform,v=!1,x=!1,w=!1;return"zoom"in i&&m.zoom!==+i.zoom&&(v=!0,m.zoom=+i.zoom),i.center!==void 0&&(m.center=r.aI.convert(i.center)),"bearing"in i&&m.bearing!==+i.bearing&&(x=!0,m.bearing=+i.bearing),"pitch"in i&&m.pitch!==+i.pitch&&(w=!0,m.pitch=+i.pitch),i.padding==null||m.isPaddingEqual(i.padding)||(m.padding=i.padding),i.preloadOnly?(this._preloadTiles(m),this):(this.fire(new r.f("movestart",c)).fire(new r.f("move",c)),v&&this.fire(new r.f("zoomstart",c)).fire(new r.f("zoom",c)).fire(new r.f("zoomend",c)),x&&this.fire(new r.f("rotatestart",c)).fire(new r.f("rotate",c)).fire(new r.f("rotateend",c)),w&&this.fire(new r.f("pitchstart",c)).fire(new r.f("pitch",c)).fire(new r.f("pitchend",c)),this.fire(new r.f("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(da),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,c){let m=this.transform;if(!m.projection.supportsFreeCamera)return r.w(da),this;this.stop();let v=m.zoom,x=m.pitch,w=m.bearing;m.setFreeCameraOptions(i);let E=v!==m.zoom,S=x!==m.pitch,M=w!==m.bearing;return this.fire(new r.f("movestart",c)).fire(new r.f("move",c)),E&&this.fire(new r.f("zoomstart",c)).fire(new r.f("zoom",c)).fire(new r.f("zoomend",c)),M&&this.fire(new r.f("rotatestart",c)).fire(new r.f("rotate",c)).fire(new r.f("rotateend",c)),S&&this.fire(new r.f("pitchstart",c)).fire(new r.f("pitch",c)).fire(new r.f("pitchend",c)),this.fire(new r.f("moveend",c)),this}easeTo(i,c){this._stop(!1,i.easeId),((i=r.W({offset:[0,0],duration:500,easing:r.d2},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);let m=this.transform,v=this.getZoom(),x=this.getBearing(),w=this.getPitch(),E=this.getPadding(),S="zoom"in i?+i.zoom:v,M="bearing"in i?this._normalizeBearing(i.bearing,x):x,O="pitch"in i?+i.pitch:w,F=this._extendPadding(i.padding),z=r.P.convert(i.offset),V,$,G;if(m.projection.name==="globe"){let re=r.Y.fromLngLat(m.center),pe=z.rotate(-m.angle);re.x+=pe.x/m.worldSize,re.y+=pe.y/m.worldSize;let Ee=re.toLngLat(),se=r.aI.convert(i.center||Ee);this._normalizeCenter(se),V=m.centerPoint.add(pe),$=new r.P(re.x,re.y).mult(m.worldSize),G=new r.P(r.aj(se.lng),r.ak(se.lat)).mult(m.worldSize).sub($)}else{V=m.centerPoint.add(z);let re=m.pointLocation(V),pe=r.aI.convert(i.center||re);this._normalizeCenter(pe),$=m.project(re),G=m.project(pe).sub($)}let H=m.zoomScale(S-v),q,J;i.around&&(q=r.aI.convert(i.around),J=m.locationPoint(q));let ee=this._zooming||S!==v,te=this._rotating||x!==M,ce=this._pitching||O!==w,le=!m.isPaddingEqual(F),Q=re=>pe=>{if(ee&&(re.zoom=r.a2(v,S,pe)),te&&(re.bearing=r.a2(x,M,pe)),ce&&(re.pitch=r.a2(w,O,pe)),le&&(re.interpolatePadding(E,F,pe),V=re.centerPoint.add(z)),q)re.setLocationAtPoint(q,J);else{let Ee=re.zoomScale(re.zoom-v),se=S>v?Math.min(2,H):Math.max(.5,H),Ie=Math.pow(se,1-pe),De=re.unproject($.add(G.mult(pe*Ie)).mult(Ee));re.setLocationAtPoint(re.renderWorldCopies?De.wrap():De,V)}return i.preloadOnly||this._fireMoveEvents(c),re};if(i.preloadOnly){let re=this._emulate(Q,i.duration,m);return this._preloadTiles(re),this}let ne={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ee,this._rotating=te,this._pitching=ce,this._padding=le,this._easeId=i.easeId,this._prepareEase(c,i.noMoveStart,ne),this._ease(Q(m),re=>{m.cameraElevationReference==="sea"&&m.recenterOnTerrain(),this._afterEase(c,re)},i),this}_prepareEase(i,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||m.moving||this.fire(new r.f("movestart",i)),this._zooming&&!m.zooming&&this.fire(new r.f("zoomstart",i)),this._rotating&&!m.rotating&&this.fire(new r.f("rotatestart",i)),this._pitching&&!m.pitching&&this.fire(new r.f("pitchstart",i))}_fireMoveEvents(i){this.fire(new r.f("move",i)),this._zooming&&this.fire(new r.f("zoom",i)),this._rotating&&this.fire(new r.f("rotate",i)),this._pitching&&this.fire(new r.f("pitch",i))}_afterEase(i,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let m=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new r.f("zoomend",i)),v&&this.fire(new r.f("rotateend",i)),x&&this.fire(new r.f("pitchend",i)),this.fire(new r.f("moveend",i))}flyTo(i,c){if(this._prefersReducedMotion(i)){let Ae=r.ah(i,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(Ae,c)}this.stop(),i=r.W({offset:[0,0],speed:1.2,curve:1.42,easing:r.d2},i);let m=this.transform,v=this.getZoom(),x=this.getBearing(),w=this.getPitch(),E=this.getPadding(),S="zoom"in i?r.at(+i.zoom,m.minZoom,m.maxZoom):v,M="bearing"in i?this._normalizeBearing(i.bearing,x):x,O="pitch"in i?+i.pitch:w,F=this._extendPadding(i.padding),z=m.zoomScale(S-v),V=r.P.convert(i.offset),$=m.centerPoint.add(V),G=m.pointLocation($),H=r.aI.convert(i.center||G);this._normalizeCenter(H);let q=m.project(G),J=m.project(H).sub(q),ee=i.curve,te=Math.max(m.width,m.height),ce=te/z,le=J.mag();if("minZoom"in i){let Ae=r.at(Math.min(i.minZoom,v,S),m.minZoom,m.maxZoom),ke=te/m.zoomScale(Ae-v);ee=Math.sqrt(ke/le*2)}let Q=ee*ee;function ne(Ae){let ke=(ce*ce-te*te+(Ae?-1:1)*Q*Q*le*le)/(2*(Ae?ce:te)*Q*le);return Math.log(Math.sqrt(ke*ke+1)-ke)}function re(Ae){return(Math.exp(Ae)-Math.exp(-Ae))/2}function pe(Ae){return(Math.exp(Ae)+Math.exp(-Ae))/2}let Ee=ne(0),se=function(Ae){return pe(Ee)/pe(Ee+ee*Ae)},Ie=function(Ae){return te*((pe(Ee)*(re(ke=Ee+ee*Ae)/pe(ke))-re(Ee))/Q)/le;var ke},De=(ne(1)-Ee)/ee;if(Math.abs(le)<1e-6||!isFinite(De)){if(Math.abs(te-ce)<1e-6)return this.easeTo(i,c);let Ae=ce<te?-1:1;De=Math.abs(Math.log(ce/te))/ee,Ie=function(){return 0},se=function(ke){return Math.exp(Ae*ee*ke)}}i.duration="duration"in i?+i.duration:1e3*De/("screenSpeed"in i?+i.screenSpeed/ee:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);let je=x!==M,Ue=O!==w,Ne=!m.isPaddingEqual(F),ve=Ae=>ke=>{let it=ke*De,lt=1/se(it);Ae.zoom=ke===1?S:v+Ae.scaleZoom(lt),je&&(Ae.bearing=r.a2(x,M,ke)),Ue&&(Ae.pitch=r.a2(w,O,ke)),Ne&&(Ae.interpolatePadding(E,F,ke),$=Ae.centerPoint.add(V));let st=ke===1?H:Ae.unproject(q.add(J.mult(Ie(it))).mult(lt));return Ae.setLocationAtPoint(Ae.renderWorldCopies?st.wrap():st,$),Ae._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(c),Ae};if(i.preloadOnly){let Ae=this._emulate(ve,i.duration,m);return this._preloadTiles(Ae),this}return this._zooming=!0,this._rotating=je,this._pitching=Ue,this._padding=Ne,this._prepareEase(c,!1),this._ease(ve(m),()=>this._afterEase(c),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,c)}if(!i){let m=this.handlers;m&&m.stop(!1)}return this}_ease(i,c,m){m.animate===!1||m.duration===0?(i(1),c()):(this._easeStart=r.e.now(),this._easeOptions=m,this._onEaseFrame=i,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let i=Math.min((r.e.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,c){i=r.au(i,-180,180);let m=Math.abs(i-c);return Math.abs(i-360-c)<m&&(i-=360),Math.abs(i+360-c)<m&&(i+=360),i}_normalizeCenter(i){let c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;let m=i.lng-c.center.lng;i.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&r.e.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,c,m){let v=Math.ceil(15*c/1e3),x=[],w=i(m.clone());for(let E=0;E<=v;E++){let S=w(E/v);x.push(S.clone())}return x}_preloadTiles(i,c){}}class o_{constructor(i={}){this.options=i,r.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){let c=this.options&&this.options.compact;return this._map=i,this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z("button","mapboxgl-ctrl-attrib-button",this._container),Z("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,c){let m=this._map._getUIString(`AttributionControl.${c}`);i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));let c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.d8.ACCESS_TOKEN}];if(i){let m=c.reduce((v,x,w)=>(x.value&&(v+=`${x.key}=${x.value}${w<c.length-1?"&":""}`),v),"?");i.href=`${r.d8.FEEDBACK_URL}/${m}#${Xc(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){let v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}let c=this._map.style._mergedSourceCaches;for(let v in c){let x=c[v];if(x.used){let w=x.getSource();w.attribution&&i.indexOf(w.attribution)<0&&i.push(w.attribution)}}i.sort((v,x)=>v.length-x.length),i=i.filter((v,x)=>{for(let w=x+1;w<i.length;w++)if(i[w].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));let m=i.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,i.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class s_{constructor(){r.bp(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=Z("div","mapboxgl-ctrl");let c=Z("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(let c in i){let m=i[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){let i=this._container.children;if(i.length){let c=i[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class a_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){let c=++this._id;return this._queue.push({callback:i,id:c,cancelled:!1}),c}remove(i){let c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(let v of m)if(v.id===i)return void(v.cancelled=!0)}run(i=0){let c=this._currentlyRunning=this._queue;this._queue=[];for(let m of c)if(!m.cancelled&&(m.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function l_(d,i,c){if(d=new r.aI(d.lng,d.lat),i){let m=new r.aI(d.lng-360,d.lat),v=new r.aI(d.lng+360,d.lat),x=360*Math.ceil(Math.abs(d.lng-c.center.lng)/360),w=c.locationPoint(d).distSqr(i),E=i.x<0||i.y<0||i.x>c.width||i.y>c.height;c.locationPoint(m).distSqr(i)<w&&(E||Math.abs(m.lng-c.center.lng)<x)?d=m:c.locationPoint(v).distSqr(i)<w&&(E||Math.abs(v.lng-c.center.lng)<x)&&(d=v)}for(;Math.abs(d.lng-c.center.lng)>180;){let m=c.locationPoint(d);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;d.lng>c.center.lng?d.lng-=360:d.lng+=360}return d}let bp={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ou extends r.E{constructor(i,c){if(super(),(i instanceof HTMLElement||c)&&(i=r.W({element:i},c)),r.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=r.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z("div");let x=41,w=27,E=he("svg",{display:"block",height:x*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${x}`},this._element),S=he("radialGradient",{id:"shadowGradient"},he("defs",{},E));he("stop",{offset:"10%","stop-opacity":.4},S),he("stop",{offset:"100%","stop-opacity":.05},S),he("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),he("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),he("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),he("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=r.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});let m=this._element.classList;for(let x in bp)m.remove(`mapboxgl-marker-anchor-${x}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`);let v=i&&i.className?i.className.trim().split(/\s+/):[];m.add(...v),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){let i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=r.aI.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){let v=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){let c=i.code,m=i.charCode||i.keyCode;c!=="Space"&&c!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(i){let c=i.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let i=this._map,c=this._pos;if(!i||!c)return!1;let m=i.unproject(c),v=i.getFreeCameraOptions();if(!v.position)return!1;let x=v.position.toLngLat();return x.distanceTo(m)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){let i=this._map;if(!i)return;let c=this._pos;if(!c||c.x<0||c.x>i.transform.width||c.y<0||c.y>i.transform.height)return void this._clearFadeTimer();let m=i.unproject(c),v;i._showingGlobe()&&r.d9(i.transform,this._lngLat)?v=0:(v=1-i._queryFogOpacity(m),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let i=this._pos;if(!i||!this._map)return;let c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${bp[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){let i=this._pos,c=this._map,m=this.getPitchAlignment();if(!c||!i||m!=="map")return"";if(!c._showingGlobe()){let S=c.getPitch();return S?`rotateX(${S}deg)`:""}let v=r.b0(r.da(c.transform,this._lngLat)),x=i.sub(r.db(c.transform)),w=Math.abs(x.x)+Math.abs(x.y);if(w===0)return"";let E=v/w;return`rotateX(${-x.y*E}deg) rotateY(${x.x*E}deg)`}_calculateZTransform(){let i=this._pos,c=this._map;if(!c||!i)return"";let m=0,v=this.getRotationAlignment();if(v==="map")if(c._showingGlobe()){let x=c.project(new r.aI(this._lngLat.lng,this._lngLat.lat+.001)),w=c.project(new r.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);m=r.b0(Math.atan2(w.y,w.x))-90}else m=-c.getBearing();else if(v==="horizon"){let x=r.$(4,6,c.getZoom()),w=r.db(c.transform);w.y+=x*c.transform.height;let E=i.sub(w),S=r.b0(Math.atan2(E.y,E.x));m=(S>90?S-270:S+90)*(1-x)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);let c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=l_(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=r.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){let c=this._map;if(!c)return;let m=this._pointerdownPos,v=this._positionDelta;if(m&&v){if(!this._isDragging){let x=this._clickTolerance||c._clickTolerance;if(i.point.dist(m)<x)return;this._isDragging=!0}this._pos=i.point.sub(v),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.f("dragstart"))),this.fire(new r.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.f("dragend")),this._state="inactive"}_addDragHandler(i){let c=this._map,m=this._pos;c&&m&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(m),this._pointerdownPos=i.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;let c=this._map;return c&&(i?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let wp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},c_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function fa(d=new r.P(0,0),i="bottom"){if(typeof d=="number"){let c=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(i){case"top":return new r.P(0,d);case"top-left":return new r.P(c,c);case"top-right":return new r.P(-c,c);case"bottom":return new r.P(0,-d);case"bottom-left":return new r.P(c,-c);case"bottom-right":return new r.P(-c,-c);case"left":return new r.P(d,0);case"right":return new r.P(-d,0)}return new r.P(0,0)}return d instanceof r.P||Array.isArray(d)?r.P.convert(d):r.P.convert(d[i]||[0,0])}class u_{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;let c=r.b9((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,c,m){this._start=this.getValue(c),this._end=i,this._startTime=c,this._endTime=c+m}}let h_={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class d_{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let Tp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},pa={showCompass:!0,showZoom:!0,visualizePitch:!1};class f_{constructor(i,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new fp({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,m&&(this.mousePitch=new ha({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),r.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(i,c){this.mouseRotate.mousedown(i,c),this.mousePitch&&this.mousePitch.mousedown(i,c),Ge()}move(i,c){let m=this.map,v=this.mouseRotate.mousemoveWindow(i,c),x=v&&v.bearingDelta;if(x&&m.setBearing(m.getBearing()+x),this.mousePitch){let w=this.mousePitch.mousemoveWindow(i,c),E=w&&w.pitchDelta;E&&m.setPitch(m.getPitch()+E)}}off(){let i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ve(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(r.W({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),gt(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,gt(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Be(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Be(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let ma={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},p_={maxWidth:100,unit:"metric"},Xh={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:r.dt,supported:A,setRTLTextPlugin:r.dv,getRTLTextPluginStatus:r.dw,Map:class extends mx{constructor(d){r.dc.mark(r.dd.create);let i=d;if((d=r.W({},Tp,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&r.de(window)&&(d.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new xo(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new a_,this._domRenderTaskQueue=new a_,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.df(),this._locale=r.W({},h_,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new u_(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new r.dg(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?kt({},d.contextCreateOptions):{},typeof d.container=="string"){let c=document.getElementById(d.container);if(!c)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=c}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),r.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new d_),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new i_(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||r.d8.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),d.hash&&(this._hash=new fx(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});let c=d.bounds;c&&(this.resize(),this.fitBounds(c,r.W({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new o_({customAttribution:d.customAttribution})),this._logoControl=new s_,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new r.f(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new r.f(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(d,i){if(i===void 0&&(i=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new r.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let c=d.onAdd(this);this._controls.push(d);let m=this._controlPositions[i];return i.indexOf("bottom")!==-1?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new r.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let i=this._controls.indexOf(d);return i>-1&&this._controls.splice(i,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let i=!this._moving;return i&&this.fire(new r.f("movestart",d)).fire(new r.f("move",d)),this.fire(new r.f("resize",d)),i&&this.fire(new r.f("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(r.ai.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new r.f("zoomstart")).fire(new r.f("zoom")).fire(new r.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new r.f("zoomstart")).fire(new r.f("zoom")).fire(new r.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new r.f("pitchstart")).fire(new r.f("pitch")).fire(new r.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new r.f("pitchstart")).fire(new r.f("pitch")).fire(new r.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(i=>i==="auto"?navigator.language:i):d}setLanguage(d){let i=this._parseLanguage(d);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(let c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let d=this.transform,i=d.projection.name,c;i==="globe"&&d.zoom>=r.aU?(d.setMercatorFromTransition(),c=!0):i==="mercator"&&d.zoom<r.aU&&(d.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,i){return this._updateProjection(d||i||{name:"mercator"})}_updateProjection(d){let i;return i=d.name==="globe"&&this.transform.zoom>=r.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d){return this.transform.locationPoint3D(r.aI.convert(d))}unproject(d){return this.transform.pointLocation3D(r.P.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,i,c){if(d==="mouseenter"||d==="mouseover"){let m=!1,v=w=>{let E=i.filter(M=>this.getLayer(M)),S=E.length?this.queryRenderedFeatures(w.point,{layers:E}):[];S.length?m||(m=!0,c.call(this,new Or(d,this,w.originalEvent,{features:S}))):m=!1},x=()=>{m=!1};return{layers:new Set(i),listener:c,delegates:{mousemove:v,mouseout:x}}}if(d==="mouseleave"||d==="mouseout"){let m=!1,v=w=>{let E=i.filter(S=>this.getLayer(S));(E.length?this.queryRenderedFeatures(w.point,{layers:E}):[]).length?m=!0:m&&(m=!1,c.call(this,new Or(d,this,w.originalEvent)))},x=w=>{m&&(m=!1,c.call(this,new Or(d,this,w.originalEvent)))};return{layers:new Set(i),listener:c,delegates:{mousemove:v,mouseout:x}}}{let m=v=>{let x=i.filter(E=>this.getLayer(E)),w=x.length?this.queryRenderedFeatures(v.point,{layers:x}):[];w.length&&(v.features=w,c.call(this,v),delete v.features)};return{layers:new Set(i),listener:c,delegates:{[d]:m}}}}on(d,i,c){if(typeof i=="function"||c===void 0)return super.on(d,i);if(Array.isArray(i)||(i=[i]),i){for(let v of i)if(!this._isValidId(v))return this}let m=this._createDelegatedListener(d,i,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(m);for(let v in m.delegates)this.on(v,m.delegates[v]);return this}once(d,i,c){if(typeof i=="function"||c===void 0)return super.once(d,i);if(Array.isArray(i)||(i=[i]),i){for(let v of i)if(!this._isValidId(v))return this}let m=this._createDelegatedListener(d,i,c);for(let v in m.delegates)this.once(v,m.delegates[v]);return this}off(d,i,c){if(typeof i=="function"||c===void 0)return super.off(d,i);let m=new Set(Array.isArray(i)?i:[i]);for(let w of m)if(!this._isValidId(w))return this;let v=(w,E)=>{if(w.size!==E.size)return!1;for(let S of w)if(!E.has(S))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[d]:void 0;return x&&(w=>{for(let E=0;E<w.length;E++){let S=w[E];if(S.listener===c&&v(S.layers,m)){for(let M in S.delegates)this.off(M,S.delegates[M]);return w.splice(E,1),this}}})(x),this}queryRenderedFeatures(d,i){if(!this.style)return[];if(i!==void 0||d===void 0||d instanceof r.P||Array.isArray(d)||(i=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers)){for(let c of i.layers)if(!this._isValidId(c))return[]}return this.style.queryRenderedFeatures(d,i,this.transform)}querySourceFeatures(d,i){return this._isValidId(d)?this.style.querySourceFeatures(d,i):[]}isPointOnSurface(d){let{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&r.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(d))}setStyle(d,i){return i=r.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&d&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(d,(c,m)=>{c?(r.w(`Unable to perform style diff: ${String(c.message||c.error||c)}. Rebuilding the style from scratch.`),this._updateStyle(d,i)):m&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(d,i))}_getUIString(d){let i=this._locale[d];if(i==null)throw new Error(`Missing UI string '${d}'`);return i}_updateStyle(d,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){let c=r.W({},i);i&&i.config&&(c.initialConfig=i.config,delete c.config),this.style=new no(this,c).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new no(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new r.d(new Error("IDs can't be empty."))),!1):!r.cV(d)||(this.fire(new r.d(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}addSource(d,i){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,i),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,i,c){this._lazyInitEmptyStyle(),this.style.addSourceType(d,i,c)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,i,{pixelRatio:c=1,sdf:m=!1,stretchX:v,stretchY:x,content:w}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){let{width:E,height:S,data:M}=r.e.getImageData(i);this.style.addImage(d,{data:new r.i({width:E,height:S},M),pixelRatio:c,stretchX:v,stretchY:x,content:w,sdf:m,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new r.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:E,height:S}=i,M=i;this.style.addImage(d,{data:new r.i({width:E,height:S},new Uint8Array(M.data)),pixelRatio:c,stretchX:v,stretchY:x,content:w,sdf:m,version:0,userImage:M}),M.onAdd&&M.onAdd(this,d)}}updateImage(d,i){this._lazyInitEmptyStyle();let c=this.style.getImage(d);if(!c)return void this.fire(new r.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let m=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?r.e.getImageData(i):i,{width:v,height:x,data:w}=m;if(v===void 0||x===void 0)return void this.fire(new r.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==c.data.width||x!==c.data.height)return void this.fire(new r.d(new Error(`The width and height of the updated image (${v}, ${x})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`)));let E=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);c.data.replace(w,E),this.style.updateImage(d,c)}hasImage(d){return d?!!this.style&&!!this.style.getImage(d):(this.fire(new r.d(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,i){r.h(this._requestManager.transformRequest(d,r.R.Image),(c,m)=>{i(c,m instanceof HTMLImageElement?r.e.getImageData(m):m)})}listImages(){return this.style.listImages()}addModel(d,i){this._lazyInitEmptyStyle(),this.style.addModel(d,i)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new r.d(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,i){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,i),this._update(!0)):this}getSlot(d){let i=this.getLayer(d);return i&&i.slot||null}setSlot(d,i){return this.style.setSlot(d,i),this.style.mergeLayers(),this._update(!0)}addImport(d,i){return this.style.addImport(d,i),this}updateImport(d,i){return typeof i!="string"&&i.id!==d?(this.removeImport(d),this.addImport(i)):(this.style.updateImport(d,i),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,i){return this.style.moveImport(d,i),this._update(!0)}moveLayer(d,i){return this._isValidId(d)?(this.style.moveLayer(d,i),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){return this._isValidId(d)?this.style.getOwnLayer(d):null}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,i,c){return this._isValidId(d)?(this.style.setLayerZoomRange(d,i,c),this._update(!0)):this}setFilter(d,i,c={}){return this._isValidId(d)?(this.style.setFilter(d,i,c),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,i,c,m={}){return this._isValidId(d)?(this.style.setPaintProperty(d,i,c,m),this._update(!0)):this}getPaintProperty(d,i){return this._isValidId(d)?this.style.getPaintProperty(d,i):null}setLayoutProperty(d,i,c,m={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,i,c,m),this._update(!0)):this}getLayoutProperty(d,i){return this._isValidId(d)?this.style.getLayoutProperty(d,i):null}getSchema(d){return this.style.getSchema(d)}setSchema(d,i){return this.style.setSchema(d,i),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,i){return this.style.setConfig(d,i),this._update(!0)}getConfigProperty(d,i){return this.style.getConfigProperty(d,i)}setConfigProperty(d,i,c){return this.style.setConfigProperty(d,i,c),this._update(!0)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){let i=d[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aI.convert(d),this.transform):0}setFeatureState(d,i){return this._isValidId(d.source)?(this.style.setFeatureState(d,i),this._update()):this}removeFeatureState(d,i){return this._isValidId(d.source)?(this.style.removeFeatureState(d,i),this._update()):this}getFeatureState(d){return this._isValidId(d.source)?this.style.getFeatureState(d):null}_updateContainerDimensions(){if(!this._container)return;let d=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300,c,m,v,x=this._container;for(;x&&(!m||!v);){let w=window.getComputedStyle(x).transform;w&&w!=="none"&&(c=w.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(m=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(v=c[3])),x=x.parentElement}this._containerWidth=m?Math.abs(d/m):d,this._containerHeight=v?Math.abs(i/v):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=Z("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();let i=this._canvasContainer=Z("div","mapboxgl-canvas-container",d);this._canvas=Z("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let c=this._controlContainer=Z("div","mapboxgl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{m[v]=Z("div",`mapboxgl-ctrl-${v}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,i){let c=r.e.devicePixelRatio||1;this._canvas.width=c*Math.ceil(d),this._canvas.height=c*Math.ceil(i),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${i}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){let i=this._markers.indexOf(d);i!==-1&&this._markers.splice(i,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){let i=this._popups.indexOf(d);i!==-1&&this._popups.splice(i,1)}_setupPainter(){let d=r.W({},A.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",d);i?(r.dh(i,!0),this.painter=new Vg(i,this._contextCreateOptions,this.transform,this._tp),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.di.testSupport(i)):this.fire(new r.d(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.f("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new r.f("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let i;this.fire(new r.f("renderstart")),++this._frameId;let c=this.painter.context.extTimerQuery,m=r.e.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=v.createQuery(),v.beginQuery(c.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();let x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let M=this.transform.zoom,O=this.transform.pitch,F=r.e.now(),z=new r.X(M,{now:F,fadeDuration:x,pitch:O,transition:this.style.transition});this.style.update(z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(m),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(m);let E=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource);if(E&&(this._placementDirty=E.needsRerender,this._occlusionOpacityChanged=E.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,r.dc.mark(r.dd.load),this.fire(new r.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){let M=r.e.now()-m;v.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{let O=v.getQueryParameter(i,v.QUERY_RESULT)/1e6;v.deleteQuery(i),this.fire(new r.f("gpu-timing-frame",{cpuTime:M,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){let M=this.painter.collectGpuTimers();setTimeout(()=>{let O=this.painter.queryGpuTimers(M);this.fire(new r.f("gpu-timing-layer",{layerTimes:O}))},50)}if(this.listens("gpu-timing-deferred-render")){let M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let O=this.painter.queryGpuTimeDeferredRender(M);this.fire(new r.f("gpu-timing-deferred-render",{gpuTime:O}))},50)}let S=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||w;if((this._sourcesDirty||this._styleDirty||w||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),S||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{let M=!this.isMoving()&&this.loaded();if(M&&(w=this._updateAverageElevation(m,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new r.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let O=this._calculateSpeedIndex();this.fire(new r.f("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!S&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,r.dc.mark(r.dd.fullLoad),this._performanceMetricsCollection&&r.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(let i of this._markers)d&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(let i of this._popups)!d||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(d,i=!1){let c=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);let m=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(m||(i||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){let v=this.transform.averageElevation,x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=d;let w=Math.abs(v-x);if(w>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(x),c(x);this._averageElevation.easeTo(x,d,300)}else if(w>1e-4)return this._averageElevation.jumpTo(x),c(x)}return!!this._averageElevation.isEasing(d)&&c(this._averageElevation.getValue(d))}_authenticate(){r.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===r.dl||d.status===401)){let i=this.painter.context.gl;r.dh(i,!1),this._logoControl instanceof s_&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&r.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){let d=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());let c=this.painter.context.gl,m=c.createFramebuffer();function v(x){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,x,0);let w=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,w),w}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(v(d),i.canvasCopies.map(v),i.timeStamps)}_canvasPixelComparison(d,i,c){let m=c[1]-c[0],v=d.length/4;for(let x=0;x<i.length;x++){let w=i[x],E=0;for(let S=0;S<w.length;S+=4)w[S]===d[S]&&w[S+1]===d[S+1]&&w[S+2]===d[S+2]&&w[S+3]===d[S+3]&&(E+=1);m+=(c[x+2]-c[x+1])*(1-E/v)}return m}remove(){this._hash&&this._hash.remove();for(let i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.dp(this.painter.context.gl),r.dq.remove(),r.dr.remove(),this._removed=!0,this.fire(new r.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=r.e.frame(i=>{let c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(i)}))}_preloadTiles(d){let i=this.style?this.style.getSourceCaches():[];return r.ds(i,(c,m)=>c._preloadTiles(d,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,i){r.du(d,i)}_occlusionCriteriaSatisfied(){let d=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&d&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return r.dt}},NavigationControl:class{constructor(d){this.options=r.W({},pa,d),this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(r.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),Z("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),Z("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{let c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:i}):c.resetNorth({},{originalEvent:i}))}),this._compassIcon=Z("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let d=this._map;if(!d)return;let i=d.getZoom(),c=i===d.getMaxZoom(),m=i===d.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){let d=this._map;if(!d)return;let i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new f_(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){let d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,i){let c=Z("button",d,this._container);return c.type="button",c.addEventListener("click",i),c}_setButtonTitle(d,i){if(!this._map)return;let c=this._map._getUIString(`NavigationControl.${i}`);d.setAttribute("aria-label",c),d.firstElementChild&&d.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends r.E{constructor(d){super();let i=navigator.geolocation;this.options=r.W({geolocation:i},ma,d),r.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=cp(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){let i=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,d(c)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>i(c.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(d){let i=this._map.getMaxBounds(),c=d.coords;return!!i&&(c.longitude<i.getWest()||c.longitude>i.getEast()||c.latitude<i.getSouth()||c.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new r.f("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.f("geolocate",d)),this._finish()}}_updateCamera(d){let i=new r.aI(d.coords.longitude,d.coords.latitude),c=d.coords.accuracy,m=this._map.getBearing(),v=r.W({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(c),v,{geolocateSource:!0})}_updateMarker(d){if(d){let i=new r.aI(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let d=this._map.transform,i=r.ax(1,d._center.lat)*d.worldSize,c=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.f("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=Z("button","mapboxgl-ctrl-geolocate",this._container),Z("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");let i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{let i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z("div","mapboxgl-user-location"),this._dotElement.appendChild(Z("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Z("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ou({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Z("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ou({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.f("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:o_,ScaleControl:class{constructor(d){this.options=r.W({},p_,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let d=this.options.maxWidth||100,i=this._map,c=i._containerHeight/2,m=i._containerWidth/2-d/2,v=i.unproject([m,c]),x=i.unproject([m+d,c]),w=v.distanceTo(x);if(this.options.unit==="imperial"){let E=3.2808*w;E>5280?this._setScale(d,E/5280,"mile"):this._setScale(d,E,"foot")}else this.options.unit==="nautical"?this._setScale(d,w/1852,"nautical-mile"):w>=1e3?this._setScale(d,w/1e3,"kilometer"):this._setScale(d,w,"meter")}_setScale(d,i,c){this._map._requestDomTask(()=>{let m=function(x){let w=Math.pow(10,`${Math.floor(x)}`.length-1),E=x/w;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(S){let M=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*M)/M}(E),w*E}(i),v=m/i;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(m):`${m}&nbsp;${Xh[c]}`,this._container.style.width=d*v+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:r.w("Full screen control 'container' must be a DOM element.")),r.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let d=this._fullscreenButton=Z("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Z("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(d){super(),this.options=r.W(Object.create(wp),d),r.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new r.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new r.f("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=r.aI.convert(d),this._pos=null,this._trackPointer=!1,this._update();let i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){let i=document.createDocumentFragment(),c=document.createElement("body"),m;for(c.innerHTML=d;m=c.firstChild,m;)i.appendChild(m);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=Z("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(d),this.options.closeButton){let c=this._closeButton=Z("button","mapboxgl-popup-close-button",i);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let i;return this._classList.delete(d)?i=!1:(this._classList.add(d),i=!0),this._updateClassList(),i}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;let i=this._map,c=this._container,m=this._pos;if(!i||!c||!m)return"bottom";let v=c.offsetWidth,x=c.offsetHeight,w=m.x<v/2,E=m.x>i.transform.width-v/2;if(m.y+d<x)return w?"top-left":E?"top-right":"top";if(m.y>i.transform.height-x){if(w)return"bottom-left";if(E)return"bottom-right"}return w?"left":E?"right":"bottom"}_updateClassList(){let d=this._container;if(!d)return;let i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),d.className=i.join(" ")}_update(d){let i=this._map,c=this._content;if(!i||!this._lngLat&&!this._trackPointer||!c)return;let m=this._container;if(m||(m=this._container=Z("div","mapboxgl-popup",i.getContainer()),this._tip=Z("div","mapboxgl-popup-tip",m),m.appendChild(c)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=l_(this._lngLat,this._pos,i.transform)),!this._trackPointer||d){let v=this._pos=this._trackPointer&&d?d:i.project(this._lngLat),x=fa(this.options.offset),w=this._anchor=this._getAnchor(x.y),E=fa(this.options.offset,w),S=v.add(E).round();i._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${bp[w]} translate(${S.x}px,${S.y}px)`)})}if(!this._marker&&i._showingGlobe()){let v=r.d9(i.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let d=this._container.querySelector(c_);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:ou,Style:no,LngLat:r.aI,LngLatBounds:r.ai,Point:r.P,MercatorCoordinate:r.Y,FreeCameraOptions:Sf,Evented:r.E,config:r.d8,prewarm:r.dx,clearPrewarmedResources:r.dy,get accessToken(){return r.d8.ACCESS_TOKEN},set accessToken(d){r.d8.ACCESS_TOKEN=d},get baseApiUrl(){return r.d8.API_URL},set baseApiUrl(d){r.d8.API_URL=d},get workerCount(){return r.dz.workerCount},set workerCount(d){r.dz.workerCount=d},get maxParallelImageRequests(){return r.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){r.d8.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){r.dA(d)},get workerUrl(){return r.dB.workerUrl},set workerUrl(d){r.dB.workerUrl=d},get workerClass(){return r.dB.workerClass},set workerClass(d){r.dB.workerClass=d},get workerParams(){return r.dB.workerParams},set workerParams(d){r.dB.workerParams=d},get dracoUrl(){return r.dC()},set dracoUrl(d){r.dD(d)},get meshoptUrl(){return r.dE()},set meshoptUrl(d){r.dF(d)},setNow:r.e.setNow,restoreNow:r.e.restoreNow}});var _=f;return _})});var _S=null;var ab=1,yS=Symbol("SIGNAL");function Kn(s){let a=_S;return _S=s,a}var vS={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function u3(s){if(!(ub(s)&&!s.dirty)&&!(!s.dirty&&s.lastCleanEpoch===ab)){if(!s.producerMustRecompute(s)&&!lb(s)){s.dirty=!1,s.lastCleanEpoch=ab;return}s.producerRecomputeValue(s),s.dirty=!1,s.lastCleanEpoch=ab}}function xS(s){return s&&(s.nextProducerIndex=0),Kn(s)}function bS(s,a){if(Kn(a),!(!s||s.producerNode===void 0||s.producerIndexOfThis===void 0||s.producerLastReadVersion===void 0)){if(ub(s))for(let f=s.nextProducerIndex;f<s.producerNode.length;f++)cb(s.producerNode[f],s.producerIndexOfThis[f]);for(;s.producerNode.length>s.nextProducerIndex;)s.producerNode.pop(),s.producerLastReadVersion.pop(),s.producerIndexOfThis.pop()}}function lb(s){wy(s);for(let a=0;a<s.producerNode.length;a++){let f=s.producerNode[a],p=s.producerLastReadVersion[a];if(p!==f.version||(u3(f),p!==f.version))return!0}return!1}function wS(s){if(wy(s),ub(s))for(let a=0;a<s.producerNode.length;a++)cb(s.producerNode[a],s.producerIndexOfThis[a]);s.producerNode.length=s.producerLastReadVersion.length=s.producerIndexOfThis.length=0,s.liveConsumerNode&&(s.liveConsumerNode.length=s.liveConsumerIndexOfThis.length=0)}function cb(s,a){if(h3(s),wy(s),s.liveConsumerNode.length===1)for(let p=0;p<s.producerNode.length;p++)cb(s.producerNode[p],s.producerIndexOfThis[p]);let f=s.liveConsumerNode.length-1;if(s.liveConsumerNode[a]=s.liveConsumerNode[f],s.liveConsumerIndexOfThis[a]=s.liveConsumerIndexOfThis[f],s.liveConsumerNode.length--,s.liveConsumerIndexOfThis.length--,a<s.liveConsumerNode.length){let p=s.liveConsumerIndexOfThis[a],_=s.liveConsumerNode[a];wy(_),_.producerIndexOfThis[p]=a}}function ub(s){return s.consumerIsAlwaysLive||(s?.liveConsumerNode?.length??0)>0}function wy(s){s.producerNode??=[],s.producerIndexOfThis??=[],s.producerLastReadVersion??=[]}function h3(s){s.liveConsumerNode??=[],s.liveConsumerIndexOfThis??=[]}function d3(){throw new Error}var f3=d3;function TS(s){f3=s}function Tn(s){return typeof s=="function"}function Id(s){let f=s(p=>{Error.call(p),p.stack=new Error().stack});return f.prototype=Object.create(Error.prototype),f.prototype.constructor=f,f}var Ty=Id(s=>function(f){s(this),this.message=f?`${f.length} errors occurred during unsubscription:
${f.map((p,_)=>`${_+1}) ${p.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=f});function am(s,a){if(s){let f=s.indexOf(a);0<=f&&s.splice(f,1)}}var Qr=class s{constructor(a){this.initialTeardown=a,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let a;if(!this.closed){this.closed=!0;let{_parentage:f}=this;if(f)if(this._parentage=null,Array.isArray(f))for(let r of f)r.remove(this);else f.remove(this);let{initialTeardown:p}=this;if(Tn(p))try{p()}catch(r){a=r instanceof Ty?r.errors:[r]}let{_finalizers:_}=this;if(_){this._finalizers=null;for(let r of _)try{ES(r)}catch(C){a=a??[],C instanceof Ty?a=[...a,...C.errors]:a.push(C)}}if(a)throw new Ty(a)}}add(a){var f;if(a&&a!==this)if(this.closed)ES(a);else{if(a instanceof s){if(a.closed||a._hasParent(this))return;a._addParent(this)}(this._finalizers=(f=this._finalizers)!==null&&f!==void 0?f:[]).push(a)}}_hasParent(a){let{_parentage:f}=this;return f===a||Array.isArray(f)&&f.includes(a)}_addParent(a){let{_parentage:f}=this;this._parentage=Array.isArray(f)?(f.push(a),f):f?[f,a]:a}_removeParent(a){let{_parentage:f}=this;f===a?this._parentage=null:Array.isArray(f)&&am(f,a)}remove(a){let{_finalizers:f}=this;f&&am(f,a),a instanceof s&&a._removeParent(this)}};Qr.EMPTY=(()=>{let s=new Qr;return s.closed=!0,s})();var hb=Qr.EMPTY;function Ey(s){return s instanceof Qr||s&&"closed"in s&&Tn(s.remove)&&Tn(s.add)&&Tn(s.unsubscribe)}function ES(s){Tn(s)?s():s.unsubscribe()}var Qo={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Cd={setTimeout(s,a,...f){let{delegate:p}=Cd;return p?.setTimeout?p.setTimeout(s,a,...f):setTimeout(s,a,...f)},clearTimeout(s){let{delegate:a}=Cd;return(a?.clearTimeout||clearTimeout)(s)},delegate:void 0};function Iy(s){Cd.setTimeout(()=>{let{onUnhandledError:a}=Qo;if(a)a(s);else throw s})}function lm(){}var IS=db("C",void 0,void 0);function CS(s){return db("E",void 0,s)}function DS(s){return db("N",s,void 0)}function db(s,a,f){return{kind:s,value:a,error:f}}var Tu=null;function Dd(s){if(Qo.useDeprecatedSynchronousErrorHandling){let a=!Tu;if(a&&(Tu={errorThrown:!1,error:null}),s(),a){let{errorThrown:f,error:p}=Tu;if(Tu=null,f)throw p}}else s()}function SS(s){Qo.useDeprecatedSynchronousErrorHandling&&Tu&&(Tu.errorThrown=!0,Tu.error=s)}var Eu=class extends Qr{constructor(a){super(),this.isStopped=!1,a?(this.destination=a,Ey(a)&&a.add(this)):this.destination=g3}static create(a,f,p){return new Ca(a,f,p)}next(a){this.isStopped?pb(DS(a),this):this._next(a)}error(a){this.isStopped?pb(CS(a),this):(this.isStopped=!0,this._error(a))}complete(){this.isStopped?pb(IS,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(a){this.destination.next(a)}_error(a){try{this.destination.error(a)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},p3=Function.prototype.bind;function fb(s,a){return p3.call(s,a)}var mb=class{constructor(a){this.partialObserver=a}next(a){let{partialObserver:f}=this;if(f.next)try{f.next(a)}catch(p){Cy(p)}}error(a){let{partialObserver:f}=this;if(f.error)try{f.error(a)}catch(p){Cy(p)}else Cy(a)}complete(){let{partialObserver:a}=this;if(a.complete)try{a.complete()}catch(f){Cy(f)}}},Ca=class extends Eu{constructor(a,f,p){super();let _;if(Tn(a)||!a)_={next:a??void 0,error:f??void 0,complete:p??void 0};else{let r;this&&Qo.useDeprecatedNextContext?(r=Object.create(a),r.unsubscribe=()=>this.unsubscribe(),_={next:a.next&&fb(a.next,r),error:a.error&&fb(a.error,r),complete:a.complete&&fb(a.complete,r)}):_=a}this.destination=new mb(_)}};function Cy(s){Qo.useDeprecatedSynchronousErrorHandling?SS(s):Iy(s)}function m3(s){throw s}function pb(s,a){let{onStoppedNotification:f}=Qo;f&&Cd.setTimeout(()=>f(s,a))}var g3={closed:!0,next:lm,error:m3,complete:lm};var Sd=typeof Symbol=="function"&&Symbol.observable||"@@observable";function so(s){return s}function gb(...s){return _b(s)}function _b(s){return s.length===0?so:s.length===1?s[0]:function(f){return s.reduce((p,_)=>_(p),f)}}var Qn=(()=>{class s{constructor(f){f&&(this._subscribe=f)}lift(f){let p=new s;return p.source=this,p.operator=f,p}subscribe(f,p,_){let r=y3(f)?f:new Ca(f,p,_);return Dd(()=>{let{operator:C,source:A}=this;r.add(C?C.call(r,A):A?this._subscribe(r):this._trySubscribe(r))}),r}_trySubscribe(f){try{return this._subscribe(f)}catch(p){f.error(p)}}forEach(f,p){return p=MS(p),new p((_,r)=>{let C=new Ca({next:A=>{try{f(A)}catch(k){r(k),C.unsubscribe()}},error:r,complete:_});this.subscribe(C)})}_subscribe(f){var p;return(p=this.source)===null||p===void 0?void 0:p.subscribe(f)}[Sd](){return this}pipe(...f){return _b(f)(this)}toPromise(f){return f=MS(f),new f((p,_)=>{let r;this.subscribe(C=>r=C,C=>_(C),()=>p(r))})}}return s.create=a=>new s(a),s})();function MS(s){var a;return(a=s??Qo.Promise)!==null&&a!==void 0?a:Promise}function _3(s){return s&&Tn(s.next)&&Tn(s.error)&&Tn(s.complete)}function y3(s){return s&&s instanceof Eu||_3(s)&&Ey(s)}function yb(s){return Tn(s?.lift)}function Fn(s){return a=>{if(yb(a))return a.lift(function(f){try{return s(f,this)}catch(p){this.error(p)}});throw new TypeError("Unable to lift unknown Observable type")}}function Un(s,a,f,p,_){return new vb(s,a,f,p,_)}var vb=class extends Eu{constructor(a,f,p,_,r,C){super(a),this.onFinalize=r,this.shouldUnsubscribe=C,this._next=f?function(A){try{f(A)}catch(k){a.error(k)}}:super._next,this._error=_?function(A){try{_(A)}catch(k){a.error(k)}finally{this.unsubscribe()}}:super._error,this._complete=p?function(){try{p()}catch(A){a.error(A)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var a;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:f}=this;super.unsubscribe(),!f&&((a=this.onFinalize)===null||a===void 0||a.call(this))}}};function Md(){return Fn((s,a)=>{let f=null;s._refCount++;let p=Un(a,void 0,void 0,void 0,()=>{if(!s||s._refCount<=0||0<--s._refCount){f=null;return}let _=s._connection,r=f;f=null,_&&(!r||_===r)&&_.unsubscribe(),a.unsubscribe()});s.subscribe(p),p.closed||(f=s.connect())})}var Ad=class extends Qn{constructor(a,f){super(),this.source=a,this.subjectFactory=f,this._subject=null,this._refCount=0,this._connection=null,yb(a)&&(this.lift=a.lift)}_subscribe(a){return this.getSubject().subscribe(a)}getSubject(){let a=this._subject;return(!a||a.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:a}=this;this._subject=this._connection=null,a?.unsubscribe()}connect(){let a=this._connection;if(!a){a=this._connection=new Qr;let f=this.getSubject();a.add(this.source.subscribe(Un(f,void 0,()=>{this._teardown(),f.complete()},p=>{this._teardown(),f.error(p)},()=>this._teardown()))),a.closed&&(this._connection=null,a=Qr.EMPTY)}return a}refCount(){return Md()(this)}};var AS=Id(s=>function(){s(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Jr=(()=>{class s extends Qn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(f){let p=new Dy(this,this);return p.operator=f,p}_throwIfClosed(){if(this.closed)throw new AS}next(f){Dd(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let p of this.currentObservers)p.next(f)}})}error(f){Dd(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=f;let{observers:p}=this;for(;p.length;)p.shift().error(f)}})}complete(){Dd(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:f}=this;for(;f.length;)f.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var f;return((f=this.observers)===null||f===void 0?void 0:f.length)>0}_trySubscribe(f){return this._throwIfClosed(),super._trySubscribe(f)}_subscribe(f){return this._throwIfClosed(),this._checkFinalizedStatuses(f),this._innerSubscribe(f)}_innerSubscribe(f){let{hasError:p,isStopped:_,observers:r}=this;return p||_?hb:(this.currentObservers=null,r.push(f),new Qr(()=>{this.currentObservers=null,am(r,f)}))}_checkFinalizedStatuses(f){let{hasError:p,thrownError:_,isStopped:r}=this;p?f.error(_):r&&f.complete()}asObservable(){let f=new Qn;return f.source=this,f}}return s.create=(a,f)=>new Dy(a,f),s})(),Dy=class extends Jr{constructor(a,f){super(),this.destination=a,this.source=f}next(a){var f,p;(p=(f=this.destination)===null||f===void 0?void 0:f.next)===null||p===void 0||p.call(f,a)}error(a){var f,p;(p=(f=this.destination)===null||f===void 0?void 0:f.error)===null||p===void 0||p.call(f,a)}complete(){var a,f;(f=(a=this.destination)===null||a===void 0?void 0:a.complete)===null||f===void 0||f.call(a)}_subscribe(a){var f,p;return(p=(f=this.source)===null||f===void 0?void 0:f.subscribe(a))!==null&&p!==void 0?p:hb}};var pi=class extends Jr{constructor(a){super(),this._value=a}get value(){return this.getValue()}_subscribe(a){let f=super._subscribe(a);return!f.closed&&a.next(this._value),f}getValue(){let{hasError:a,thrownError:f,_value:p}=this;if(a)throw f;return this._throwIfClosed(),p}next(a){super.next(this._value=a)}};var ao=new Qn(s=>s.complete());function PS(s){return s&&Tn(s.schedule)}function RS(s){return s[s.length-1]}function OS(s){return Tn(RS(s))?s.pop():void 0}function Yl(s){return PS(RS(s))?s.pop():void 0}function LS(s,a,f,p){function _(r){return r instanceof f?r:new f(function(C){C(r)})}return new(f||(f=Promise))(function(r,C){function A(Z){try{B(p.next(Z))}catch(he){C(he)}}function k(Z){try{B(p.throw(Z))}catch(he){C(he)}}function B(Z){Z.done?r(Z.value):_(Z.value).then(A,k)}B((p=p.apply(s,a||[])).next())})}function kS(s){var a=typeof Symbol=="function"&&Symbol.iterator,f=a&&s[a],p=0;if(f)return f.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&p>=s.length&&(s=void 0),{value:s&&s[p++],done:!s}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")}function Iu(s){return this instanceof Iu?(this.v=s,this):new Iu(s)}function FS(s,a,f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=f.apply(s,a||[]),_,r=[];return _={},A("next"),A("throw"),A("return",C),_[Symbol.asyncIterator]=function(){return this},_;function C(_e){return function(Je){return Promise.resolve(Je).then(_e,he)}}function A(_e,Je){p[_e]&&(_[_e]=function(Ge){return new Promise(function(Ve,We){r.push([_e,Ge,Ve,We])>1||k(_e,Ge)})},Je&&(_[_e]=Je(_[_e])))}function k(_e,Je){try{B(p[_e](Je))}catch(Ge){xe(r[0][3],Ge)}}function B(_e){_e.value instanceof Iu?Promise.resolve(_e.value.v).then(Z,he):xe(r[0][2],_e)}function Z(_e){k("next",_e)}function he(_e){k("throw",_e)}function xe(_e,Je){_e(Je),r.shift(),r.length&&k(r[0][0],r[0][1])}}function NS(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=s[Symbol.asyncIterator],f;return a?a.call(s):(s=typeof kS=="function"?kS(s):s[Symbol.iterator](),f={},p("next"),p("throw"),p("return"),f[Symbol.asyncIterator]=function(){return this},f);function p(r){f[r]=s[r]&&function(C){return new Promise(function(A,k){C=s[r](C),_(A,k,C.done,C.value)})}}function _(r,C,A,k){Promise.resolve(k).then(function(B){r({value:B,done:A})},C)}}var Sy=s=>s&&typeof s.length=="number"&&typeof s!="function";function My(s){return Tn(s?.then)}function Ay(s){return Tn(s[Sd])}function Py(s){return Symbol.asyncIterator&&Tn(s?.[Symbol.asyncIterator])}function Ry(s){return new TypeError(`You provided ${s!==null&&typeof s=="object"?"an invalid object":`'${s}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function v3(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Oy=v3();function ky(s){return Tn(s?.[Oy])}function Ly(s){return FS(this,arguments,function*(){let f=s.getReader();try{for(;;){let{value:p,done:_}=yield Iu(f.read());if(_)return yield Iu(void 0);yield yield Iu(p)}}finally{f.releaseLock()}})}function Fy(s){return Tn(s?.getReader)}function Cr(s){if(s instanceof Qn)return s;if(s!=null){if(Ay(s))return x3(s);if(Sy(s))return b3(s);if(My(s))return w3(s);if(Py(s))return zS(s);if(ky(s))return T3(s);if(Fy(s))return E3(s)}throw Ry(s)}function x3(s){return new Qn(a=>{let f=s[Sd]();if(Tn(f.subscribe))return f.subscribe(a);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function b3(s){return new Qn(a=>{for(let f=0;f<s.length&&!a.closed;f++)a.next(s[f]);a.complete()})}function w3(s){return new Qn(a=>{s.then(f=>{a.closed||(a.next(f),a.complete())},f=>a.error(f)).then(null,Iy)})}function T3(s){return new Qn(a=>{for(let f of s)if(a.next(f),a.closed)return;a.complete()})}function zS(s){return new Qn(a=>{I3(s,a).catch(f=>a.error(f))})}function E3(s){return zS(Ly(s))}function I3(s,a){var f,p,_,r;return LS(this,void 0,void 0,function*(){try{for(f=NS(s);p=yield f.next(),!p.done;){let C=p.value;if(a.next(C),a.closed)return}}catch(C){_={error:C}}finally{try{p&&!p.done&&(r=f.return)&&(yield r.call(f))}finally{if(_)throw _.error}}a.complete()})}function $i(s,a,f,p=0,_=!1){let r=a.schedule(function(){f(),_?s.add(this.schedule(null,p)):this.unsubscribe()},p);if(s.add(r),!_)return r}function Ny(s,a=0){return Fn((f,p)=>{f.subscribe(Un(p,_=>$i(p,s,()=>p.next(_),a),()=>$i(p,s,()=>p.complete(),a),_=>$i(p,s,()=>p.error(_),a)))})}function zy(s,a=0){return Fn((f,p)=>{p.add(s.schedule(()=>f.subscribe(p),a))})}function BS(s,a){return Cr(s).pipe(zy(a),Ny(a))}function VS(s,a){return Cr(s).pipe(zy(a),Ny(a))}function jS(s,a){return new Qn(f=>{let p=0;return a.schedule(function(){p===s.length?f.complete():(f.next(s[p++]),f.closed||this.schedule())})})}function US(s,a){return new Qn(f=>{let p;return $i(f,a,()=>{p=s[Oy](),$i(f,a,()=>{let _,r;try{({value:_,done:r}=p.next())}catch(C){f.error(C);return}r?f.complete():f.next(_)},0,!0)}),()=>Tn(p?.return)&&p.return()})}function By(s,a){if(!s)throw new Error("Iterable cannot be null");return new Qn(f=>{$i(f,a,()=>{let p=s[Symbol.asyncIterator]();$i(f,a,()=>{p.next().then(_=>{_.done?f.complete():f.next(_.value)})},0,!0)})})}function $S(s,a){return By(Ly(s),a)}function GS(s,a){if(s!=null){if(Ay(s))return BS(s,a);if(Sy(s))return jS(s,a);if(My(s))return VS(s,a);if(Py(s))return By(s,a);if(ky(s))return US(s,a);if(Fy(s))return $S(s,a)}throw Ry(s)}function Dr(s,a){return a?GS(s,a):Cr(s)}function on(...s){let a=Yl(s);return Dr(s,a)}function Da(s,a){let f=Tn(s)?s:()=>s,p=_=>_.error(f());return new Qn(a?_=>a.schedule(p,0,_):p)}function xb(s){return!!s&&(s instanceof Qn||Tn(s.lift)&&Tn(s.subscribe))}var Sa=Id(s=>function(){s(this),this.name="EmptyError",this.message="no elements in sequence"});function Sn(s,a){return Fn((f,p)=>{let _=0;f.subscribe(Un(p,r=>{p.next(s.call(a,r,_++))}))})}var{isArray:C3}=Array;function D3(s,a){return C3(a)?s(...a):s(a)}function HS(s){return Sn(a=>D3(s,a))}var{isArray:S3}=Array,{getPrototypeOf:M3,prototype:A3,keys:P3}=Object;function qS(s){if(s.length===1){let a=s[0];if(S3(a))return{args:a,keys:null};if(R3(a)){let f=P3(a);return{args:f.map(p=>a[p]),keys:f}}}return{args:s,keys:null}}function R3(s){return s&&typeof s=="object"&&M3(s)===A3}function WS(s,a){return s.reduce((f,p,_)=>(f[p]=a[_],f),{})}function Vy(...s){let a=Yl(s),f=OS(s),{args:p,keys:_}=qS(s);if(p.length===0)return Dr([],a);let r=new Qn(O3(p,a,_?C=>WS(_,C):so));return f?r.pipe(HS(f)):r}function O3(s,a,f=so){return p=>{ZS(a,()=>{let{length:_}=s,r=new Array(_),C=_,A=_;for(let k=0;k<_;k++)ZS(a,()=>{let B=Dr(s[k],a),Z=!1;B.subscribe(Un(p,he=>{r[k]=he,Z||(Z=!0,A--),A||p.next(f(r.slice()))},()=>{--C||p.complete()}))},p)},p)}}function ZS(s,a,f){s?$i(f,s,a):a()}function YS(s,a,f,p,_,r,C,A){let k=[],B=0,Z=0,he=!1,xe=()=>{he&&!k.length&&!B&&a.complete()},_e=Ge=>B<p?Je(Ge):k.push(Ge),Je=Ge=>{r&&a.next(Ge),B++;let Ve=!1;Cr(f(Ge,Z++)).subscribe(Un(a,We=>{_?.(We),r?_e(We):a.next(We)},()=>{Ve=!0},void 0,()=>{if(Ve)try{for(B--;k.length&&B<p;){let We=k.shift();C?$i(a,C,()=>Je(We)):Je(We)}xe()}catch(We){a.error(We)}}))};return s.subscribe(Un(a,_e,()=>{he=!0,xe()})),()=>{A?.()}}function ei(s,a,f=1/0){return Tn(a)?ei((p,_)=>Sn((r,C)=>a(p,r,_,C))(Cr(s(p,_))),f):(typeof a=="number"&&(f=a),Fn((p,_)=>YS(p,_,s,f)))}function bb(s=1/0){return ei(so,s)}function XS(){return bb(1)}function Pd(...s){return XS()(Dr(s,Yl(s)))}function jy(s){return new Qn(a=>{Cr(s()).subscribe(a)})}function lo(s,a){return Fn((f,p)=>{let _=0;f.subscribe(Un(p,r=>s.call(a,r,_++)&&p.next(r)))})}function Ps(s){return Fn((a,f)=>{let p=null,_=!1,r;p=a.subscribe(Un(f,void 0,void 0,C=>{r=Cr(s(C,Ps(s)(a))),p?(p.unsubscribe(),p=null,r.subscribe(f)):_=!0})),_&&(p.unsubscribe(),p=null,r.subscribe(f))})}function KS(s,a,f,p,_){return(r,C)=>{let A=f,k=a,B=0;r.subscribe(Un(C,Z=>{let he=B++;k=A?s(k,Z,he):(A=!0,Z),p&&C.next(k)},_&&(()=>{A&&C.next(k),C.complete()})))}}function Xl(s,a){return Tn(a)?ei(s,a,1):ei(s,1)}function Kl(s){return Fn((a,f)=>{let p=!1;a.subscribe(Un(f,_=>{p=!0,f.next(_)},()=>{p||f.next(s),f.complete()}))})}function Ma(s){return s<=0?()=>ao:Fn((a,f)=>{let p=0;a.subscribe(Un(f,_=>{++p<=s&&(f.next(_),s<=p&&f.complete())}))})}function wb(s){return Sn(()=>s)}function Uy(s=k3){return Fn((a,f)=>{let p=!1;a.subscribe(Un(f,_=>{p=!0,f.next(_)},()=>p?f.complete():f.error(s())))})}function k3(){return new Sa}function Rs(s){return Fn((a,f)=>{try{a.subscribe(f)}finally{f.add(s)}})}function Os(s,a){let f=arguments.length>=2;return p=>p.pipe(s?lo((_,r)=>s(_,r,p)):so,Ma(1),f?Kl(a):Uy(()=>new Sa))}function Rd(s){return s<=0?()=>ao:Fn((a,f)=>{let p=[];a.subscribe(Un(f,_=>{p.push(_),s<p.length&&p.shift()},()=>{for(let _ of p)f.next(_);f.complete()},void 0,()=>{p=null}))})}function Tb(s,a){let f=arguments.length>=2;return p=>p.pipe(s?lo((_,r)=>s(_,r,p)):so,Rd(1),f?Kl(a):Uy(()=>new Sa))}function Eb(s,a){return Fn(KS(s,a,arguments.length>=2,!0))}function Cb(s={}){let{connector:a=()=>new Jr,resetOnError:f=!0,resetOnComplete:p=!0,resetOnRefCountZero:_=!0}=s;return r=>{let C,A,k,B=0,Z=!1,he=!1,xe=()=>{A?.unsubscribe(),A=void 0},_e=()=>{xe(),C=k=void 0,Z=he=!1},Je=()=>{let Ge=C;_e(),Ge?.unsubscribe()};return Fn((Ge,Ve)=>{B++,!he&&!Z&&xe();let We=k=k??a();Ve.add(()=>{B--,B===0&&!he&&!Z&&(A=Ib(Je,_))}),We.subscribe(Ve),!C&&B>0&&(C=new Ca({next:ct=>We.next(ct),error:ct=>{he=!0,xe(),A=Ib(_e,f,ct),We.error(ct)},complete:()=>{Z=!0,xe(),A=Ib(_e,p),We.complete()}}),Cr(Ge).subscribe(C))})(r)}}function Ib(s,a,...f){if(a===!0){s();return}if(a===!1)return;let p=new Ca({next:()=>{p.unsubscribe(),s()}});return Cr(a(...f)).subscribe(p)}function Db(...s){let a=Yl(s);return Fn((f,p)=>{(a?Pd(s,f,a):Pd(s,f)).subscribe(p)})}function co(s,a){return Fn((f,p)=>{let _=null,r=0,C=!1,A=()=>C&&!_&&p.complete();f.subscribe(Un(p,k=>{_?.unsubscribe();let B=0,Z=r++;Cr(s(k,Z)).subscribe(_=Un(p,he=>p.next(a?a(k,he,Z,B++):he),()=>{_=null,A()}))},()=>{C=!0,A()}))})}function Sb(s){return Fn((a,f)=>{Cr(s).subscribe(Un(f,()=>f.complete(),lm)),!f.closed&&a.subscribe(f)})}function Nr(s,a,f){let p=Tn(s)||a||f?{next:s,error:a,complete:f}:s;return p?Fn((_,r)=>{var C;(C=p.subscribe)===null||C===void 0||C.call(p);let A=!0;_.subscribe(Un(r,k=>{var B;(B=p.next)===null||B===void 0||B.call(p,k),r.next(k)},()=>{var k;A=!1,(k=p.complete)===null||k===void 0||k.call(p),r.complete()},k=>{var B;A=!1,(B=p.error)===null||B===void 0||B.call(p,k),r.error(k)},()=>{var k,B;A&&((k=p.unsubscribe)===null||k===void 0||k.call(p)),(B=p.finalize)===null||B===void 0||B.call(p)}))}):so}var un=class extends Error{constructor(a,f){super(d0(a,f)),this.code=a}};function d0(s,a){return`${`NG0${Math.abs(s)}`}${a?": "+a:""}`}function bm(s){return{toString:s}.toString()}var $y="__parameters__";function L3(s){return function(...f){if(s){let p=s(...f);for(let _ in p)this[_]=p[_]}}}function RM(s,a,f){return bm(()=>{let p=L3(a);function _(...r){if(this instanceof _)return p.apply(this,r),this;let C=new _(...r);return A.annotation=C,A;function A(k,B,Z){let he=k.hasOwnProperty($y)?k[$y]:Object.defineProperty(k,$y,{value:[]})[$y];for(;he.length<=Z;)he.push(null);return(he[Z]=he[Z]||[]).push(C),k}}return f&&(_.prototype=Object.create(f.prototype)),_.prototype.ngMetadataName=s,_.annotationCls=_,_})}var cm=globalThis;function sr(s){for(let a in s)if(s[a]===sr)return a;throw Error("Could not find renamed property on target object.")}function Gi(s){if(typeof s=="string")return s;if(Array.isArray(s))return"["+s.map(Gi).join(", ")+"]";if(s==null)return""+s;if(s.overriddenName)return`${s.overriddenName}`;if(s.name)return`${s.name}`;let a=s.toString();if(a==null)return""+a;let f=a.indexOf(`
`);return f===-1?a:a.substring(0,f)}function QS(s,a){return s==null||s===""?a===null?"":a:a==null||a===""?s:s+" "+a}var F3=sr({__forward_ref__:sr});function OM(s){return s.__forward_ref__=OM,s.toString=function(){return Gi(this())},s}function Si(s){return kM(s)?s():s}function kM(s){return typeof s=="function"&&s.hasOwnProperty(F3)&&s.__forward_ref__===OM}function Qt(s){return{token:s.token,providedIn:s.providedIn||null,factory:s.factory,value:void 0}}function ku(s){return{providers:s.providers||[],imports:s.imports||[]}}function f0(s){return JS(s,FM)||JS(s,NM)}function LM(s){return f0(s)!==null}function JS(s,a){return s.hasOwnProperty(a)?s[a]:null}function N3(s){let a=s&&(s[FM]||s[NM]);return a||null}function eM(s){return s&&(s.hasOwnProperty(tM)||s.hasOwnProperty(z3))?s[tM]:null}var FM=sr({\u0275prov:sr}),tM=sr({\u0275inj:sr}),NM=sr({ngInjectableDef:sr}),z3=sr({ngInjectorDef:sr}),vn=class{constructor(a,f){this._desc=a,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof f=="number"?this.__NG_ELEMENT_ID__=f:f!==void 0&&(this.\u0275prov=Qt({token:this,providedIn:f.providedIn||"root",factory:f.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function zM(s){return s&&!!s.\u0275providers}var B3=sr({\u0275cmp:sr}),V3=sr({\u0275dir:sr}),j3=sr({\u0275pipe:sr}),U3=sr({\u0275mod:sr}),Yy=sr({\u0275fac:sr}),um=sr({__NG_ELEMENT_ID__:sr}),nM=sr({__NG_ENV_ID__:sr});function $3(s){return typeof s=="string"?s:s==null?"":String(s)}function G3(s){return typeof s=="function"?s.name||s.toString():typeof s=="object"&&s!=null&&typeof s.type=="function"?s.type.name||s.type.toString():$3(s)}function H3(s,a){let f=a?`. Dependency path: ${a.join(" > ")} > ${s}`:"";throw new un(-200,s)}function xw(s,a){throw new un(-201,!1)}var On=function(s){return s[s.Default=0]="Default",s[s.Host=1]="Host",s[s.Self=2]="Self",s[s.SkipSelf=4]="SkipSelf",s[s.Optional=8]="Optional",s}(On||{}),jb;function BM(){return jb}function Ao(s){let a=jb;return jb=s,a}function VM(s,a,f){let p=f0(s);if(p&&p.providedIn=="root")return p.value===void 0?p.value=p.factory():p.value;if(f&On.Optional)return null;if(a!==void 0)return a;xw(s,"Injector")}var q3={},hm=q3,Ub="__NG_DI_FLAG__",Xy="ngTempTokenPath",W3="ngTokenPath",Z3=/\n/gm,Y3="\u0275",rM="__source",Fd;function X3(){return Fd}function Ql(s){let a=Fd;return Fd=s,a}function K3(s,a=On.Default){if(Fd===void 0)throw new un(-203,!1);return Fd===null?VM(s,void 0,a):Fd.get(s,a&On.Optional?null:void 0,a)}function xn(s,a=On.Default){return(BM()||K3)(Si(s),a)}function It(s,a=On.Default){return xn(s,p0(a))}function p0(s){return typeof s>"u"||typeof s=="number"?s:0|(s.optional&&8)|(s.host&&1)|(s.self&&2)|(s.skipSelf&&4)}function $b(s){let a=[];for(let f=0;f<s.length;f++){let p=Si(s[f]);if(Array.isArray(p)){if(p.length===0)throw new un(900,!1);let _,r=On.Default;for(let C=0;C<p.length;C++){let A=p[C],k=Q3(A);typeof k=="number"?k===-1?_=A.token:r|=k:_=A}a.push(xn(_,r))}else a.push(xn(p))}return a}function jM(s,a){return s[Ub]=a,s.prototype[Ub]=a,s}function Q3(s){return s[Ub]}function J3(s,a,f,p){let _=s[Xy];throw a[rM]&&_.unshift(a[rM]),s.message=ez(`
`+s.message,_,f,p),s[W3]=_,s[Xy]=null,s}function ez(s,a,f,p=null){s=s&&s.charAt(0)===`
`&&s.charAt(1)==Y3?s.slice(2):s;let _=Gi(a);if(Array.isArray(a))_=a.map(Gi).join(" -> ");else if(typeof a=="object"){let r=[];for(let C in a)if(a.hasOwnProperty(C)){let A=a[C];r.push(C+":"+(typeof A=="string"?JSON.stringify(A):Gi(A)))}_=`{${r.join(", ")}}`}return`${f}${p?"("+p+")":""}[${_}]: ${s.replace(Z3,`
  `)}`}var m0=jM(RM("Optional"),8);var bw=jM(RM("SkipSelf"),4);function zd(s,a){let f=s.hasOwnProperty(Yy);return f?s[Yy]:null}function ww(s,a){s.forEach(f=>Array.isArray(f)?ww(f,a):a(f))}function UM(s,a,f){a>=s.length?s.push(f):s.splice(a,0,f)}function Ky(s,a){return a>=s.length-1?s.pop():s.splice(a,1)[0]}var dm={},ks=[],Bd=new vn(""),$M=new vn("",-1),GM=new vn(""),Qy=class{get(a,f=hm){if(f===hm){let p=new Error(`NullInjectorError: No provider for ${Gi(a)}!`);throw p.name="NullInjectorError",p}return f}},HM=function(s){return s[s.OnPush=0]="OnPush",s[s.Default=1]="Default",s}(HM||{}),Ns=function(s){return s[s.Emulated=0]="Emulated",s[s.None=2]="None",s[s.ShadowDom=3]="ShadowDom",s}(Ns||{}),zs=function(s){return s[s.None=0]="None",s[s.SignalBased=1]="SignalBased",s[s.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",s}(zs||{});function tz(s,a,f){let p=s.length;for(;;){let _=s.indexOf(a,f);if(_===-1)return _;if(_===0||s.charCodeAt(_-1)<=32){let r=a.length;if(_+r===p||s.charCodeAt(_+r)<=32)return _}f=_+1}}function Gb(s,a,f){let p=0;for(;p<f.length;){let _=f[p];if(typeof _=="number"){if(_!==0)break;p++;let r=f[p++],C=f[p++],A=f[p++];s.setAttribute(a,C,A,r)}else{let r=_,C=f[++p];rz(r)?s.setProperty(a,r,C):s.setAttribute(a,r,C),p++}}return p}function nz(s){return s===3||s===4||s===6}function rz(s){return s.charCodeAt(0)===64}function Tw(s,a){if(!(a===null||a.length===0))if(s===null||s.length===0)s=a.slice();else{let f=-1;for(let p=0;p<a.length;p++){let _=a[p];typeof _=="number"?f=_:f===0||(f===-1||f===2?iM(s,f,_,null,a[++p]):iM(s,f,_,null,null))}}return s}function iM(s,a,f,p,_){let r=0,C=s.length;if(a===-1)C=-1;else for(;r<s.length;){let A=s[r++];if(typeof A=="number"){if(A===a){C=-1;break}else if(A>a){C=r-1;break}}}for(;r<s.length;){let A=s[r];if(typeof A=="number")break;if(A===f){if(p===null){_!==null&&(s[r+1]=_);return}else if(p===s[r+1]){s[r+2]=_;return}}r++,p!==null&&r++,_!==null&&r++}C!==-1&&(s.splice(C,0,a),r=C+1),s.splice(r++,0,f),p!==null&&s.splice(r++,0,p),_!==null&&s.splice(r++,0,_)}var qM="ng-template";function iz(s,a,f,p){let _=0;if(p){for(;_<a.length&&typeof a[_]=="string";_+=2)if(a[_]==="class"&&tz(a[_+1].toLowerCase(),f,0)!==-1)return!0}else if(Ew(s))return!1;if(_=a.indexOf(1,_),_>-1){let r;for(;++_<a.length&&typeof(r=a[_])=="string";)if(r.toLowerCase()===f)return!0}return!1}function Ew(s){return s.type===4&&s.value!==qM}function oz(s,a,f){let p=s.type===4&&!f?qM:s.value;return a===p}function sz(s,a,f){let p=4,_=s.attrs,r=_!==null?cz(_):0,C=!1;for(let A=0;A<a.length;A++){let k=a[A];if(typeof k=="number"){if(!C&&!Jo(p)&&!Jo(k))return!1;if(C&&Jo(k))continue;C=!1,p=k|p&1;continue}if(!C)if(p&4){if(p=2|p&1,k!==""&&!oz(s,k,f)||k===""&&a.length===1){if(Jo(p))return!1;C=!0}}else if(p&8){if(_===null||!iz(s,_,k,f)){if(Jo(p))return!1;C=!0}}else{let B=a[++A],Z=az(k,_,Ew(s),f);if(Z===-1){if(Jo(p))return!1;C=!0;continue}if(B!==""){let he;if(Z>r?he="":he=_[Z+1].toLowerCase(),p&2&&B!==he){if(Jo(p))return!1;C=!0}}}}return Jo(p)||C}function Jo(s){return(s&1)===0}function az(s,a,f,p){if(a===null)return-1;let _=0;if(p||!f){let r=!1;for(;_<a.length;){let C=a[_];if(C===s)return _;if(C===3||C===6)r=!0;else if(C===1||C===2){let A=a[++_];for(;typeof A=="string";)A=a[++_];continue}else{if(C===4)break;if(C===0){_+=4;continue}}_+=r?1:2}return-1}else return uz(a,s)}function lz(s,a,f=!1){for(let p=0;p<a.length;p++)if(sz(s,a[p],f))return!0;return!1}function cz(s){for(let a=0;a<s.length;a++){let f=s[a];if(nz(f))return a}return s.length}function uz(s,a){let f=s.indexOf(4);if(f>-1)for(f++;f<s.length;){let p=s[f];if(typeof p=="number")return-1;if(p===a)return f;f++}return-1}function oM(s,a){return s?":not("+a.trim()+")":a}function hz(s){let a=s[0],f=1,p=2,_="",r=!1;for(;f<s.length;){let C=s[f];if(typeof C=="string")if(p&2){let A=s[++f];_+="["+C+(A.length>0?'="'+A+'"':"")+"]"}else p&8?_+="."+C:p&4&&(_+=" "+C);else _!==""&&!Jo(C)&&(a+=oM(r,_),_=""),p=C,r=r||!Jo(p);f++}return _!==""&&(a+=oM(r,_)),a}function dz(s){return s.map(hz).join(",")}function fz(s){let a=[],f=[],p=1,_=2;for(;p<s.length;){let r=s[p];if(typeof r=="string")_===2?r!==""&&a.push(r,s[++p]):_===8&&f.push(r);else{if(!Jo(_))break;_=r}p++}return{attrs:a,classes:f}}function Ra(s){return bm(()=>{let a=KM(s),f=_r(kt({},a),{decls:s.decls,vars:s.vars,template:s.template,consts:s.consts||null,ngContentSelectors:s.ngContentSelectors,onPush:s.changeDetection===HM.OnPush,directiveDefs:null,pipeDefs:null,dependencies:a.standalone&&s.dependencies||null,getStandaloneInjector:null,signals:s.signals??!1,data:s.data||{},encapsulation:s.encapsulation||Ns.Emulated,styles:s.styles||ks,_:null,schemas:s.schemas||null,tView:null,id:""});QM(f);let p=s.dependencies;return f.directiveDefs=aM(p,!1),f.pipeDefs=aM(p,!0),f.id=gz(f),f})}function pz(s){return Su(s)||WM(s)}function mz(s){return s!==null}function Lu(s){return bm(()=>({type:s.type,bootstrap:s.bootstrap||ks,declarations:s.declarations||ks,imports:s.imports||ks,exports:s.exports||ks,transitiveCompileScopes:null,schemas:s.schemas||null,id:s.id||null}))}function sM(s,a){if(s==null)return dm;let f={};for(let p in s)if(s.hasOwnProperty(p)){let _=s[p],r,C,A=zs.None;Array.isArray(_)?(A=_[0],r=_[1],C=_[2]??r):(r=_,C=_),a?(f[r]=A!==zs.None?[p,A]:p,a[r]=C):f[r]=p}return f}function wm(s){return bm(()=>{let a=KM(s);return QM(a),a})}function Su(s){return s[B3]||null}function WM(s){return s[V3]||null}function ZM(s){return s[j3]||null}function YM(s){let a=Su(s)||WM(s)||ZM(s);return a!==null?a.standalone:!1}function XM(s,a){let f=s[U3]||null;if(!f&&a===!0)throw new Error(`Type ${Gi(s)} does not have '\u0275mod' property.`);return f}function KM(s){let a={};return{type:s.type,providersResolver:null,factory:null,hostBindings:s.hostBindings||null,hostVars:s.hostVars||0,hostAttrs:s.hostAttrs||null,contentQueries:s.contentQueries||null,declaredInputs:a,inputTransforms:null,inputConfig:s.inputs||dm,exportAs:s.exportAs||null,standalone:s.standalone===!0,signals:s.signals===!0,selectors:s.selectors||ks,viewQuery:s.viewQuery||null,features:s.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:sM(s.inputs,a),outputs:sM(s.outputs),debugInfo:null}}function QM(s){s.features?.forEach(a=>a(s))}function aM(s,a){if(!s)return null;let f=a?ZM:pz;return()=>(typeof s=="function"?s():s).map(p=>f(p)).filter(mz)}function gz(s){let a=0,f=[s.selectors,s.ngContentSelectors,s.hostVars,s.hostAttrs,s.consts,s.vars,s.decls,s.encapsulation,s.standalone,s.signals,s.exportAs,JSON.stringify(s.inputs),JSON.stringify(s.outputs),Object.getOwnPropertyNames(s.type.prototype),!!s.contentQueries,!!s.viewQuery].join("|");for(let _ of f)a=Math.imul(31,a)+_.charCodeAt(0)<<0;return a+=2147483648,"c"+a}function nc(s){return{\u0275providers:s}}function _z(...s){return{\u0275providers:JM(!0,s),\u0275fromNgModule:!0}}function JM(s,...a){let f=[],p=new Set,_,r=C=>{f.push(C)};return ww(a,C=>{let A=C;Hb(A,r,[],p)&&(_||=[],_.push(A))}),_!==void 0&&e2(_,r),f}function e2(s,a){for(let f=0;f<s.length;f++){let{ngModule:p,providers:_}=s[f];Iw(_,r=>{a(r,p)})}}function Hb(s,a,f,p){if(s=Si(s),!s)return!1;let _=null,r=eM(s),C=!r&&Su(s);if(!r&&!C){let k=s.ngModule;if(r=eM(k),r)_=k;else return!1}else{if(C&&!C.standalone)return!1;_=s}let A=p.has(_);if(C){if(A)return!1;if(p.add(_),C.dependencies){let k=typeof C.dependencies=="function"?C.dependencies():C.dependencies;for(let B of k)Hb(B,a,f,p)}}else if(r){if(r.imports!=null&&!A){p.add(_);let B;try{ww(r.imports,Z=>{Hb(Z,a,f,p)&&(B||=[],B.push(Z))})}finally{}B!==void 0&&e2(B,a)}if(!A){let B=zd(_)||(()=>new _);a({provide:_,useFactory:B,deps:ks},_),a({provide:GM,useValue:_,multi:!0},_),a({provide:Bd,useValue:()=>xn(_),multi:!0},_)}let k=r.providers;if(k!=null&&!A){let B=s;Iw(k,Z=>{a(Z,B)})}}else return!1;return _!==s&&s.providers!==void 0}function Iw(s,a){for(let f of s)zM(f)&&(f=f.\u0275providers),Array.isArray(f)?Iw(f,a):a(f)}var yz=sr({provide:String,useValue:sr});function t2(s){return s!==null&&typeof s=="object"&&yz in s}function vz(s){return!!(s&&s.useExisting)}function xz(s){return!!(s&&s.useFactory)}function Vd(s){return typeof s=="function"}function bz(s){return!!s.useClass}var g0=new vn(""),Gy={},wz={},Mb;function Cw(){return Mb===void 0&&(Mb=new Qy),Mb}var Hi=class{},fm=class extends Hi{get destroyed(){return this._destroyed}constructor(a,f,p,_){super(),this.parent=f,this.source=p,this.scopes=_,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Wb(a,C=>this.processProvider(C)),this.records.set($M,Od(void 0,this)),_.has("environment")&&this.records.set(Hi,Od(void 0,this));let r=this.records.get(g0);r!=null&&typeof r.value=="string"&&this.scopes.add(r.value),this.injectorDefTypes=new Set(this.get(GM,ks,On.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let a=Kn(null);try{for(let p of this._ngOnDestroyHooks)p.ngOnDestroy();let f=this._onDestroyHooks;this._onDestroyHooks=[];for(let p of f)p()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Kn(a)}}onDestroy(a){return this.assertNotDestroyed(),this._onDestroyHooks.push(a),()=>this.removeOnDestroy(a)}runInContext(a){this.assertNotDestroyed();let f=Ql(this),p=Ao(void 0),_;try{return a()}finally{Ql(f),Ao(p)}}get(a,f=hm,p=On.Default){if(this.assertNotDestroyed(),a.hasOwnProperty(nM))return a[nM](this);p=p0(p);let _,r=Ql(this),C=Ao(void 0);try{if(!(p&On.SkipSelf)){let k=this.records.get(a);if(k===void 0){let B=Dz(a)&&f0(a);B&&this.injectableDefInScope(B)?k=Od(qb(a),Gy):k=null,this.records.set(a,k)}if(k!=null)return this.hydrate(a,k)}let A=p&On.Self?Cw():this.parent;return f=p&On.Optional&&f===hm?null:f,A.get(a,f)}catch(A){if(A.name==="NullInjectorError"){if((A[Xy]=A[Xy]||[]).unshift(Gi(a)),r)throw A;return J3(A,a,"R3InjectorError",this.source)}else throw A}finally{Ao(C),Ql(r)}}resolveInjectorInitializers(){let a=Kn(null),f=Ql(this),p=Ao(void 0),_;try{let r=this.get(Bd,ks,On.Self);for(let C of r)C()}finally{Ql(f),Ao(p),Kn(a)}}toString(){let a=[],f=this.records;for(let p of f.keys())a.push(Gi(p));return`R3Injector[${a.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new un(205,!1)}processProvider(a){a=Si(a);let f=Vd(a)?a:Si(a&&a.provide),p=Ez(a);if(!Vd(a)&&a.multi===!0){let _=this.records.get(f);_||(_=Od(void 0,Gy,!0),_.factory=()=>$b(_.multi),this.records.set(f,_)),f=a,_.multi.push(a)}this.records.set(f,p)}hydrate(a,f){let p=Kn(null);try{return f.value===Gy&&(f.value=wz,f.value=f.factory()),typeof f.value=="object"&&f.value&&Cz(f.value)&&this._ngOnDestroyHooks.add(f.value),f.value}finally{Kn(p)}}injectableDefInScope(a){if(!a.providedIn)return!1;let f=Si(a.providedIn);return typeof f=="string"?f==="any"||this.scopes.has(f):this.injectorDefTypes.has(f)}removeOnDestroy(a){let f=this._onDestroyHooks.indexOf(a);f!==-1&&this._onDestroyHooks.splice(f,1)}};function qb(s){let a=f0(s),f=a!==null?a.factory:zd(s);if(f!==null)return f;if(s instanceof vn)throw new un(204,!1);if(s instanceof Function)return Tz(s);throw new un(204,!1)}function Tz(s){if(s.length>0)throw new un(204,!1);let f=N3(s);return f!==null?()=>f.factory(s):()=>new s}function Ez(s){if(t2(s))return Od(void 0,s.useValue);{let a=n2(s);return Od(a,Gy)}}function n2(s,a,f){let p;if(Vd(s)){let _=Si(s);return zd(_)||qb(_)}else if(t2(s))p=()=>Si(s.useValue);else if(xz(s))p=()=>s.useFactory(...$b(s.deps||[]));else if(vz(s))p=()=>xn(Si(s.useExisting));else{let _=Si(s&&(s.useClass||s.provide));if(Iz(s))p=()=>new _(...$b(s.deps));else return zd(_)||qb(_)}return p}function Od(s,a,f=!1){return{factory:s,value:a,multi:f?[]:void 0}}function Iz(s){return!!s.deps}function Cz(s){return s!==null&&typeof s=="object"&&typeof s.ngOnDestroy=="function"}function Dz(s){return typeof s=="function"||typeof s=="object"&&s instanceof vn}function Wb(s,a){for(let f of s)Array.isArray(f)?Wb(f,a):f&&zM(f)?Wb(f.\u0275providers,a):a(f)}function Oa(s,a){s instanceof fm&&s.assertNotDestroyed();let f,p=Ql(s),_=Ao(void 0);try{return a()}finally{Ql(p),Ao(_)}}function Sz(){return BM()!==void 0||X3()!=null}function Mz(s){return typeof s=="function"}var ka=0,zn=1,hn=2,Ei=3,ts=4,rs=5,Jy=6,pm=7,ns=8,jd=9,Bs=10,Mi=11,mm=12,lM=13,Hd=14,Vs=15,_0=16,kd=17,Ud=18,y0=19,r2=20,Jl=21,Ab=22,Mu=23,js=25,i2=1;var Au=7,e0=8,t0=9,Po=10,Dw=function(s){return s[s.None=0]="None",s[s.HasTransplantedViews=2]="HasTransplantedViews",s}(Dw||{});function Cu(s){return Array.isArray(s)&&typeof s[i2]=="object"}function La(s){return Array.isArray(s)&&s[i2]===!0}function Sw(s){return(s.flags&4)!==0}function v0(s){return s.componentOffset>-1}function x0(s){return(s.flags&1)===1}function qd(s){return!!s.template}function Az(s){return(s[hn]&512)!==0}var Zb=class{constructor(a,f,p){this.previousValue=a,this.currentValue=f,this.firstChange=p}isFirstChange(){return this.firstChange}};function o2(s,a,f,p){a!==null?a.applyValueToInputSignal(a,p):s[f]=p}function b0(){return s2}function s2(s){return s.type.prototype.ngOnChanges&&(s.setInput=Rz),Pz}b0.ngInherit=!0;function Pz(){let s=l2(this),a=s?.current;if(a){let f=s.previous;if(f===dm)s.previous=a;else for(let p in a)f[p]=a[p];s.current=null,this.ngOnChanges(a)}}function Rz(s,a,f,p,_){let r=this.declaredInputs[p],C=l2(s)||Oz(s,{previous:dm,current:null}),A=C.current||(C.current={}),k=C.previous,B=k[r];A[r]=new Zb(B&&B.currentValue,f,k===dm),o2(s,a,_,f)}var a2="__ngSimpleChanges__";function l2(s){return s[a2]||null}function Oz(s,a){return s[a2]=a}var cM=null;var Ls=function(s,a,f){cM?.(s,a,f)},kz="svg",Lz="math",Fz=!1;function Nz(){return Fz}function Aa(s){for(;Array.isArray(s);)s=s[ka];return s}function is(s,a){return Aa(a[s.index])}function c2(s,a){return s.data[a]}function zz(s,a){return s[a]}function rc(s,a){let f=a[s];return Cu(f)?f:f[ka]}function Mw(s){return(s[hn]&128)===128}function Bz(s){return La(s[Ei])}function $d(s,a){return a==null?null:s[a]}function u2(s){s[kd]=0}function Vz(s){s[hn]&1024||(s[hn]|=1024,Mw(s)&&gm(s))}function jz(s,a){for(;s>0;)a=a[Hd],s--;return a}function Aw(s){return!!(s[hn]&9216||s[Mu]?.dirty)}function Yb(s){s[Bs].changeDetectionScheduler?.notify(1),Aw(s)?gm(s):s[hn]&64&&(Nz()?(s[hn]|=1024,gm(s)):s[Bs].changeDetectionScheduler?.notify())}function gm(s){s[Bs].changeDetectionScheduler?.notify();let a=_m(s);for(;a!==null&&!(a[hn]&8192||(a[hn]|=8192,!Mw(a)));)a=_m(a)}function h2(s,a){if((s[hn]&256)===256)throw new un(911,!1);s[Jl]===null&&(s[Jl]=[]),s[Jl].push(a)}function Uz(s,a){if(s[Jl]===null)return;let f=s[Jl].indexOf(a);f!==-1&&s[Jl].splice(f,1)}function _m(s){let a=s[Ei];return La(a)?a[Ei]:a}var Bn={lFrame:y2(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function $z(){return Bn.lFrame.elementDepthCount}function Gz(){Bn.lFrame.elementDepthCount++}function Hz(){Bn.lFrame.elementDepthCount--}function d2(){return Bn.bindingsEnabled}function qz(){return Bn.skipHydrationRootTNode!==null}function Wz(s){return Bn.skipHydrationRootTNode===s}function Zz(){Bn.skipHydrationRootTNode=null}function zr(){return Bn.lFrame.lView}function os(){return Bn.lFrame.tView}function Fu(s){return Bn.lFrame.contextLView=s,s[ns]}function Nu(s){return Bn.lFrame.contextLView=null,s}function uo(){let s=f2();for(;s!==null&&s.type===64;)s=s.parent;return s}function f2(){return Bn.lFrame.currentTNode}function Yz(){let s=Bn.lFrame,a=s.currentTNode;return s.isParent?a:a.parent}function zu(s,a){let f=Bn.lFrame;f.currentTNode=s,f.isParent=a}function Pw(){return Bn.lFrame.isParent}function p2(){Bn.lFrame.isParent=!1}function Xz(){return Bn.lFrame.contextLView}function Kz(s){return Bn.lFrame.bindingIndex=s}function Qz(){return Bn.lFrame.bindingIndex++}function Jz(){return Bn.lFrame.inI18n}function eB(s,a){let f=Bn.lFrame;f.bindingIndex=f.bindingRootIndex=s,Xb(a)}function tB(){return Bn.lFrame.currentDirectiveIndex}function Xb(s){Bn.lFrame.currentDirectiveIndex=s}function m2(s){Bn.lFrame.currentQueryIndex=s}function nB(s){let a=s[zn];return a.type===2?a.declTNode:a.type===1?s[rs]:null}function g2(s,a,f){if(f&On.SkipSelf){let _=a,r=s;for(;_=_.parent,_===null&&!(f&On.Host);)if(_=nB(r),_===null||(r=r[Hd],_.type&10))break;if(_===null)return!1;a=_,s=r}let p=Bn.lFrame=_2();return p.currentTNode=a,p.lView=s,!0}function Rw(s){let a=_2(),f=s[zn];Bn.lFrame=a,a.currentTNode=f.firstChild,a.lView=s,a.tView=f,a.contextLView=s,a.bindingIndex=f.bindingStartIndex,a.inI18n=!1}function _2(){let s=Bn.lFrame,a=s===null?null:s.child;return a===null?y2(s):a}function y2(s){let a={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:s,child:null,inI18n:!1};return s!==null&&(s.child=a),a}function v2(){let s=Bn.lFrame;return Bn.lFrame=s.parent,s.currentTNode=null,s.lView=null,s}var x2=v2;function Ow(){let s=v2();s.isParent=!0,s.tView=null,s.selectedIndex=-1,s.contextLView=null,s.elementDepthCount=0,s.currentDirectiveIndex=-1,s.currentNamespace=null,s.bindingRootIndex=-1,s.bindingIndex=-1,s.currentQueryIndex=0}function rB(s){return(Bn.lFrame.contextLView=jz(s,Bn.lFrame.contextLView))[ns]}function b2(){return Bn.lFrame.selectedIndex}function Pu(s){Bn.lFrame.selectedIndex=s}function iB(){let s=Bn.lFrame;return c2(s.tView,s.selectedIndex)}function oB(){return Bn.lFrame.currentNamespace}var w2=!0;function w0(){return w2}function T0(s){w2=s}function sB(s,a,f){let{ngOnChanges:p,ngOnInit:_,ngDoCheck:r}=a.type.prototype;if(p){let C=s2(a);(f.preOrderHooks??=[]).push(s,C),(f.preOrderCheckHooks??=[]).push(s,C)}_&&(f.preOrderHooks??=[]).push(0-s,_),r&&((f.preOrderHooks??=[]).push(s,r),(f.preOrderCheckHooks??=[]).push(s,r))}function E0(s,a){for(let f=a.directiveStart,p=a.directiveEnd;f<p;f++){let r=s.data[f].type.prototype,{ngAfterContentInit:C,ngAfterContentChecked:A,ngAfterViewInit:k,ngAfterViewChecked:B,ngOnDestroy:Z}=r;C&&(s.contentHooks??=[]).push(-f,C),A&&((s.contentHooks??=[]).push(f,A),(s.contentCheckHooks??=[]).push(f,A)),k&&(s.viewHooks??=[]).push(-f,k),B&&((s.viewHooks??=[]).push(f,B),(s.viewCheckHooks??=[]).push(f,B)),Z!=null&&(s.destroyHooks??=[]).push(f,Z)}}function Hy(s,a,f){T2(s,a,3,f)}function qy(s,a,f,p){(s[hn]&3)===f&&T2(s,a,f,p)}function Pb(s,a){let f=s[hn];(f&3)===a&&(f&=16383,f+=1,s[hn]=f)}function T2(s,a,f,p){let _=p!==void 0?s[kd]&65535:0,r=p??-1,C=a.length-1,A=0;for(let k=_;k<C;k++)if(typeof a[k+1]=="number"){if(A=a[k],p!=null&&A>=p)break}else a[k]<0&&(s[kd]+=65536),(A<r||r==-1)&&(aB(s,f,a,k),s[kd]=(s[kd]&4294901760)+k+2),k++}function uM(s,a){Ls(4,s,a);let f=Kn(null);try{a.call(s)}finally{Kn(f),Ls(5,s,a)}}function aB(s,a,f,p){let _=f[p]<0,r=f[p+1],C=_?-f[p]:f[p],A=s[C];_?s[hn]>>14<s[kd]>>16&&(s[hn]&3)===a&&(s[hn]+=16384,uM(A,r)):uM(A,r)}var Nd=-1,Ru=class{constructor(a,f,p){this.factory=a,this.resolving=!1,this.canSeeViewProviders=f,this.injectImpl=p}};function lB(s){return s instanceof Ru}function cB(s){return(s.flags&8)!==0}function uB(s){return(s.flags&16)!==0}function E2(s){return s!==Nd}function n0(s){return s&32767}function hB(s){return s>>16}function r0(s,a){let f=hB(s),p=a;for(;f>0;)p=p[Hd],f--;return p}var Kb=!0;function hM(s){let a=Kb;return Kb=s,a}var dB=256,I2=dB-1,C2=5,fB=0,Fs={};function pB(s,a,f){let p;typeof f=="string"?p=f.charCodeAt(0)||0:f.hasOwnProperty(um)&&(p=f[um]),p==null&&(p=f[um]=fB++);let _=p&I2,r=1<<_;a.data[s+(_>>C2)]|=r}function i0(s,a){let f=D2(s,a);if(f!==-1)return f;let p=a[zn];p.firstCreatePass&&(s.injectorIndex=a.length,Rb(p.data,s),Rb(a,null),Rb(p.blueprint,null));let _=kw(s,a),r=s.injectorIndex;if(E2(_)){let C=n0(_),A=r0(_,a),k=A[zn].data;for(let B=0;B<8;B++)a[r+B]=A[C+B]|k[C+B]}return a[r+8]=_,r}function Rb(s,a){s.push(0,0,0,0,0,0,0,0,a)}function D2(s,a){return s.injectorIndex===-1||s.parent&&s.parent.injectorIndex===s.injectorIndex||a[s.injectorIndex+8]===null?-1:s.injectorIndex}function kw(s,a){if(s.parent&&s.parent.injectorIndex!==-1)return s.parent.injectorIndex;let f=0,p=null,_=a;for(;_!==null;){if(p=R2(_),p===null)return Nd;if(f++,_=_[Hd],p.injectorIndex!==-1)return p.injectorIndex|f<<16}return Nd}function Qb(s,a,f){pB(s,a,f)}function S2(s,a,f){if(f&On.Optional||s!==void 0)return s;xw(a,"NodeInjector")}function M2(s,a,f,p){if(f&On.Optional&&p===void 0&&(p=null),!(f&(On.Self|On.Host))){let _=s[jd],r=Ao(void 0);try{return _?_.get(a,p,f&On.Optional):VM(a,p,f&On.Optional)}finally{Ao(r)}}return S2(p,a,f)}function A2(s,a,f,p=On.Default,_){if(s!==null){if(a[hn]&2048&&!(p&On.Self)){let C=vB(s,a,f,p,Fs);if(C!==Fs)return C}let r=P2(s,a,f,p,Fs);if(r!==Fs)return r}return M2(a,f,p,_)}function P2(s,a,f,p,_){let r=_B(f);if(typeof r=="function"){if(!g2(a,s,p))return p&On.Host?S2(_,f,p):M2(a,f,p,_);try{let C;if(C=r(p),C==null&&!(p&On.Optional))xw(f);else return C}finally{x2()}}else if(typeof r=="number"){let C=null,A=D2(s,a),k=Nd,B=p&On.Host?a[Vs][rs]:null;for((A===-1||p&On.SkipSelf)&&(k=A===-1?kw(s,a):a[A+8],k===Nd||!fM(p,!1)?A=-1:(C=a[zn],A=n0(k),a=r0(k,a)));A!==-1;){let Z=a[zn];if(dM(r,A,Z.data)){let he=mB(A,a,f,C,p,B);if(he!==Fs)return he}k=a[A+8],k!==Nd&&fM(p,a[zn].data[A+8]===B)&&dM(r,A,a)?(C=Z,A=n0(k),a=r0(k,a)):A=-1}}return _}function mB(s,a,f,p,_,r){let C=a[zn],A=C.data[s+8],k=p==null?v0(A)&&Kb:p!=C&&(A.type&3)!==0,B=_&On.Host&&r===A,Z=gB(A,C,f,k,B);return Z!==null?Gd(a,C,Z,A):Fs}function gB(s,a,f,p,_){let r=s.providerIndexes,C=a.data,A=r&1048575,k=s.directiveStart,B=s.directiveEnd,Z=r>>20,he=p?A:A+Z,xe=_?A+Z:B;for(let _e=he;_e<xe;_e++){let Je=C[_e];if(_e<k&&f===Je||_e>=k&&Je.type===f)return _e}if(_){let _e=C[k];if(_e&&qd(_e)&&_e.type===f)return k}return null}function Gd(s,a,f,p){let _=s[f],r=a.data;if(lB(_)){let C=_;C.resolving&&H3(G3(r[f]));let A=hM(C.canSeeViewProviders);C.resolving=!0;let k,B=C.injectImpl?Ao(C.injectImpl):null,Z=g2(s,p,On.Default);try{_=s[f]=C.factory(void 0,r,s,p),a.firstCreatePass&&f>=p.directiveStart&&sB(f,r[f],a)}finally{B!==null&&Ao(B),hM(A),C.resolving=!1,x2()}}return _}function _B(s){if(typeof s=="string")return s.charCodeAt(0)||0;let a=s.hasOwnProperty(um)?s[um]:void 0;return typeof a=="number"?a>=0?a&I2:yB:a}function dM(s,a,f){let p=1<<s;return!!(f[a+(s>>C2)]&p)}function fM(s,a){return!(s&On.Self)&&!(s&On.Host&&a)}var Du=class{constructor(a,f){this._tNode=a,this._lView=f}get(a,f,p){return A2(this._tNode,this._lView,a,p0(p),f)}};function yB(){return new Du(uo(),zr())}function Lw(s){return bm(()=>{let a=s.prototype.constructor,f=a[Yy]||Jb(a),p=Object.prototype,_=Object.getPrototypeOf(s.prototype).constructor;for(;_&&_!==p;){let r=_[Yy]||Jb(_);if(r&&r!==f)return r;_=Object.getPrototypeOf(_)}return r=>new r})}function Jb(s){return kM(s)?()=>{let a=Jb(Si(s));return a&&a()}:zd(s)}function vB(s,a,f,p,_){let r=s,C=a;for(;r!==null&&C!==null&&C[hn]&2048&&!(C[hn]&512);){let A=P2(r,C,f,p|On.Self,Fs);if(A!==Fs)return A;let k=r.parent;if(!k){let B=C[r2];if(B){let Z=B.get(f,Fs,p);if(Z!==Fs)return Z}k=R2(C),C=C[Hd]}r=k}return _}function R2(s){let a=s[zn],f=a.type;return f===2?a.declTNode:f===1?s[rs]:null}function pM(s,a=null,f=null,p){let _=O2(s,a,f,p);return _.resolveInjectorInitializers(),_}function O2(s,a=null,f=null,p,_=new Set){let r=[f||ks,_z(s)];return p=p||(typeof s=="object"?void 0:Gi(s)),new fm(r,a||Cw(),p||null,_)}var Tm=(()=>{let a=class a{static create(p,_){if(Array.isArray(p))return pM({name:""},_,p,"");{let r=p.name??"";return pM({name:r},p.parent,p.providers,r)}}};a.THROW_IF_NOT_FOUND=hm,a.NULL=new Qy,a.\u0275prov=Qt({token:a,providedIn:"any",factory:()=>xn($M)}),a.__NG_ELEMENT_ID__=-1;let s=a;return s})();var xB="ngOriginalError";function Ob(s){return s[xB]}var Pa=class{constructor(){this._console=console}handleError(a){let f=this._findOriginalError(a);this._console.error("ERROR",a),f&&this._console.error("ORIGINAL ERROR",f)}_findOriginalError(a){let f=a&&Ob(a);for(;f&&Ob(f);)f=Ob(f);return f||null}},k2=new vn("",{providedIn:"root",factory:()=>It(Pa).handleError.bind(void 0)}),L2=(()=>{let a=class a{};a.__NG_ELEMENT_ID__=bB,a.__NG_ENV_ID__=p=>p;let s=a;return s})(),ew=class extends L2{constructor(a){super(),this._lView=a}onDestroy(a){return h2(this._lView,a),()=>Uz(this._lView,a)}};function bB(){return new ew(zr())}function wB(){return I0(uo(),zr())}function I0(s,a){return new Wd(is(s,a))}var Wd=(()=>{let a=class a{constructor(p){this.nativeElement=p}};a.__NG_ELEMENT_ID__=wB;let s=a;return s})();var tw=class extends Jr{constructor(a=!1){super(),this.destroyRef=void 0,this.__isAsync=a,Sz()&&(this.destroyRef=It(L2,{optional:!0})??void 0)}emit(a){let f=Kn(null);try{super.next(a)}finally{Kn(f)}}subscribe(a,f,p){let _=a,r=f||(()=>null),C=p;if(a&&typeof a=="object"){let k=a;_=k.next?.bind(k),r=k.error?.bind(k),C=k.complete?.bind(k)}this.__isAsync&&(r=kb(r),_&&(_=kb(_)),C&&(C=kb(C)));let A=super.subscribe({next:_,error:r,complete:C});return a instanceof Qr&&a.add(A),A}};function kb(s){return a=>{setTimeout(s,void 0,a)}}var es=tw;function F2(s){return(s.flags&128)===128}var N2=new Map,TB=0;function EB(){return TB++}function IB(s){N2.set(s[y0],s)}function CB(s){N2.delete(s[y0])}var mM="__ngContext__";function ec(s,a){Cu(a)?(s[mM]=a[y0],IB(a)):s[mM]=a}function z2(s){return V2(s[mm])}function B2(s){return V2(s[ts])}function V2(s){for(;s!==null&&!La(s);)s=s[ts];return s}var nw;function j2(s){nw=s}function DB(){if(nw!==void 0)return nw;if(typeof document<"u")return document;throw new un(210,!1)}var Fw=new vn("",{providedIn:"root",factory:()=>SB}),SB="ng",Nw=new vn(""),ic=new vn("",{providedIn:"platform",factory:()=>"unknown"});var zw=new vn("",{providedIn:"root",factory:()=>DB().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var MB="h",AB="b";var PB=()=>null;function Bw(s,a,f=!1){return PB(s,a,f)}var U2=!1,RB=new vn("",{providedIn:"root",factory:()=>U2});var OB=/^>|^->|<!--|-->|--!>|<!-$/g,kB=/(<|>)/g,LB="\u200B$1\u200B";function FB(s){return s.replace(OB,a=>a.replace(kB,LB))}function $2(s){return s instanceof Function?s():s}var Bu=function(s){return s[s.Important=1]="Important",s[s.DashCase=2]="DashCase",s}(Bu||{}),NB;function Vw(s,a){return NB(s,a)}function Ld(s,a,f,p,_){if(p!=null){let r,C=!1;La(p)?r=p:Cu(p)&&(C=!0,p=p[ka]);let A=Aa(p);s===0&&f!==null?_==null?Z2(a,f,A):o0(a,f,A,_||null,!0):s===1&&f!==null?o0(a,f,A,_||null,!0):s===2?e5(a,A,C):s===3&&a.destroyNode(A),r!=null&&n5(a,s,r,f,_)}}function zB(s,a){return s.createText(a)}function BB(s,a){return s.createComment(FB(a))}function G2(s,a,f){return s.createElement(a,f)}function VB(s,a){H2(s,a),a[ka]=null,a[rs]=null}function jB(s,a,f,p,_,r){p[ka]=_,p[rs]=a,D0(s,p,f,1,_,r)}function H2(s,a){a[Bs].changeDetectionScheduler?.notify(1),D0(s,a,a[Mi],2,null,null)}function UB(s){let a=s[mm];if(!a)return Lb(s[zn],s);for(;a;){let f=null;if(Cu(a))f=a[mm];else{let p=a[Po];p&&(f=p)}if(!f){for(;a&&!a[ts]&&a!==s;)Cu(a)&&Lb(a[zn],a),a=a[Ei];a===null&&(a=s),Cu(a)&&Lb(a[zn],a),f=a&&a[ts]}a=f}}function $B(s,a,f,p){let _=Po+p,r=f.length;p>0&&(f[_-1][ts]=a),p<r-Po?(a[ts]=f[_],UM(f,Po+p,a)):(f.push(a),a[ts]=null),a[Ei]=f;let C=a[_0];C!==null&&f!==C&&GB(C,a);let A=a[Ud];A!==null&&A.insertView(s),Yb(a),a[hn]|=128}function GB(s,a){let f=s[t0],_=a[Ei][Ei][Vs];a[Vs]!==_&&(s[hn]|=Dw.HasTransplantedViews),f===null?s[t0]=[a]:f.push(a)}function q2(s,a){let f=s[t0],p=f.indexOf(a);f.splice(p,1)}function rw(s,a){if(s.length<=Po)return;let f=Po+a,p=s[f];if(p){let _=p[_0];_!==null&&_!==s&&q2(_,p),a>0&&(s[f-1][ts]=p[ts]);let r=Ky(s,Po+a);VB(p[zn],p);let C=r[Ud];C!==null&&C.detachView(r[zn]),p[Ei]=null,p[ts]=null,p[hn]&=-129}return p}function W2(s,a){if(!(a[hn]&256)){let f=a[Mi];f.destroyNode&&D0(s,a,f,3,null,null),UB(a)}}function Lb(s,a){if(a[hn]&256)return;let f=Kn(null);try{a[hn]&=-129,a[hn]|=256,a[Mu]&&wS(a[Mu]),qB(s,a),HB(s,a),a[zn].type===1&&a[Mi].destroy();let p=a[_0];if(p!==null&&La(a[Ei])){p!==a[Ei]&&q2(p,a);let _=a[Ud];_!==null&&_.detachView(s)}CB(a)}finally{Kn(f)}}function HB(s,a){let f=s.cleanup,p=a[pm];if(f!==null)for(let r=0;r<f.length-1;r+=2)if(typeof f[r]=="string"){let C=f[r+3];C>=0?p[C]():p[-C].unsubscribe(),r+=2}else{let C=p[f[r+1]];f[r].call(C)}p!==null&&(a[pm]=null);let _=a[Jl];if(_!==null){a[Jl]=null;for(let r=0;r<_.length;r++){let C=_[r];C()}}}function qB(s,a){let f;if(s!=null&&(f=s.destroyHooks)!=null)for(let p=0;p<f.length;p+=2){let _=a[f[p]];if(!(_ instanceof Ru)){let r=f[p+1];if(Array.isArray(r))for(let C=0;C<r.length;C+=2){let A=_[r[C]],k=r[C+1];Ls(4,A,k);try{k.call(A)}finally{Ls(5,A,k)}}else{Ls(4,_,r);try{r.call(_)}finally{Ls(5,_,r)}}}}}function WB(s,a,f){return ZB(s,a.parent,f)}function ZB(s,a,f){let p=a;for(;p!==null&&p.type&40;)a=p,p=a.parent;if(p===null)return f[ka];{let{componentOffset:_}=p;if(_>-1){let{encapsulation:r}=s.data[p.directiveStart+_];if(r===Ns.None||r===Ns.Emulated)return null}return is(p,f)}}function o0(s,a,f,p,_){s.insertBefore(a,f,p,_)}function Z2(s,a,f){s.appendChild(a,f)}function gM(s,a,f,p,_){p!==null?o0(s,a,f,p,_):Z2(s,a,f)}function YB(s,a,f,p){s.removeChild(a,f,p)}function jw(s,a){return s.parentNode(a)}function XB(s,a){return s.nextSibling(a)}function KB(s,a,f){return JB(s,a,f)}function QB(s,a,f){return s.type&40?is(s,f):null}var JB=QB,_M;function C0(s,a,f,p){let _=WB(s,p,a),r=a[Mi],C=p.parent||a[rs],A=KB(C,p,a);if(_!=null)if(Array.isArray(f))for(let k=0;k<f.length;k++)gM(r,_,f[k],A,!1);else gM(r,_,f,A,!1);_M!==void 0&&_M(r,p,a,f,_)}function Wy(s,a){if(a!==null){let f=a.type;if(f&3)return is(a,s);if(f&4)return iw(-1,s[a.index]);if(f&8){let p=a.child;if(p!==null)return Wy(s,p);{let _=s[a.index];return La(_)?iw(-1,_):Aa(_)}}else{if(f&32)return Vw(a,s)()||Aa(s[a.index]);{let p=Y2(s,a);if(p!==null){if(Array.isArray(p))return p[0];let _=_m(s[Vs]);return Wy(_,p)}else return Wy(s,a.next)}}}return null}function Y2(s,a){if(a!==null){let p=s[Vs][rs],_=a.projection;return p.projection[_]}return null}function iw(s,a){let f=Po+s+1;if(f<a.length){let p=a[f],_=p[zn].firstChild;if(_!==null)return Wy(p,_)}return a[Au]}function e5(s,a,f){let p=jw(s,a);p&&YB(s,p,a,f)}function Uw(s,a,f,p,_,r,C){for(;f!=null;){let A=p[f.index],k=f.type;if(C&&a===0&&(A&&ec(Aa(A),p),f.flags|=2),(f.flags&32)!==32)if(k&8)Uw(s,a,f.child,p,_,r,!1),Ld(a,s,_,A,r);else if(k&32){let B=Vw(f,p),Z;for(;Z=B();)Ld(a,s,_,Z,r);Ld(a,s,_,A,r)}else k&16?t5(s,a,p,f,_,r):Ld(a,s,_,A,r);f=C?f.projectionNext:f.next}}function D0(s,a,f,p,_,r){Uw(f,p,s.firstChild,a,_,r,!1)}function t5(s,a,f,p,_,r){let C=f[Vs],k=C[rs].projection[p.projection];if(Array.isArray(k))for(let B=0;B<k.length;B++){let Z=k[B];Ld(a,s,_,Z,r)}else{let B=k,Z=C[Ei];F2(p)&&(B.flags|=128),Uw(s,a,B,Z,_,r,!0)}}function n5(s,a,f,p,_){let r=f[Au],C=Aa(f);r!==C&&Ld(a,s,p,r,_);for(let A=Po;A<f.length;A++){let k=f[A];D0(k[zn],k,s,a,p,r)}}function r5(s,a,f){s.setAttribute(a,"style",f)}function X2(s,a,f){f===""?s.removeAttribute(a,"class"):s.setAttribute(a,"class",f)}function K2(s,a,f){let{mergedAttrs:p,classes:_,styles:r}=f;p!==null&&Gb(s,a,p),_!==null&&X2(s,a,_),r!==null&&r5(s,a,r)}var Q2={};function S0(s=1){J2(os(),zr(),b2()+s,!1)}function J2(s,a,f,p){if(!p)if((a[hn]&3)===3){let r=s.preOrderCheckHooks;r!==null&&Hy(a,r,f)}else{let r=s.preOrderHooks;r!==null&&qy(a,r,0,f)}Pu(f)}function ho(s,a=On.Default){let f=zr();if(f===null)return xn(s,a);let p=uo();return A2(p,f,Si(s),a)}function eA(s,a,f,p,_,r){let C=Kn(null);try{let A=null;_&zs.SignalBased&&(A=a[p][yS]),A!==null&&A.transformFn!==void 0&&(r=A.transformFn(r)),_&zs.HasDecoratorInputTransform&&(r=s.inputTransforms[p].call(a,r)),s.setInput!==null?s.setInput(a,A,r,f,p):o2(a,A,p,r)}finally{Kn(C)}}function i5(s,a){let f=s.hostBindingOpCodes;if(f!==null)try{for(let p=0;p<f.length;p++){let _=f[p];if(_<0)Pu(~_);else{let r=_,C=f[++p],A=f[++p];eB(C,r);let k=a[r];A(2,k)}}}finally{Pu(-1)}}function M0(s,a,f,p,_,r,C,A,k,B,Z){let he=a.blueprint.slice();return he[ka]=_,he[hn]=p|4|128|8|64,(B!==null||s&&s[hn]&2048)&&(he[hn]|=2048),u2(he),he[Ei]=he[Hd]=s,he[ns]=f,he[Bs]=C||s&&s[Bs],he[Mi]=A||s&&s[Mi],he[jd]=k||s&&s[jd]||null,he[rs]=r,he[y0]=EB(),he[Jy]=Z,he[r2]=B,he[Vs]=a.type==2?s[Vs]:he,he}function Em(s,a,f,p,_){let r=s.data[a];if(r===null)r=o5(s,a,f,p,_),Jz()&&(r.flags|=32);else if(r.type&64){r.type=f,r.value=p,r.attrs=_;let C=Yz();r.injectorIndex=C===null?-1:C.injectorIndex}return zu(r,!0),r}function o5(s,a,f,p,_){let r=f2(),C=Pw(),A=C?r:r&&r.parent,k=s.data[a]=u5(s,A,f,a,p,_);return s.firstChild===null&&(s.firstChild=k),r!==null&&(C?r.child==null&&k.parent!==null&&(r.child=k):r.next===null&&(r.next=k,k.prev=r)),k}function tA(s,a,f,p){if(f===0)return-1;let _=a.length;for(let r=0;r<f;r++)a.push(p),s.blueprint.push(p),s.data.push(null);return _}function nA(s,a,f,p,_){let r=b2(),C=p&2;try{Pu(-1),C&&a.length>js&&J2(s,a,js,!1),Ls(C?2:0,_),f(p,_)}finally{Pu(r),Ls(C?3:1,_)}}function $w(s,a,f){if(Sw(a)){let p=Kn(null);try{let _=a.directiveStart,r=a.directiveEnd;for(let C=_;C<r;C++){let A=s.data[C];if(A.contentQueries){let k=f[C];A.contentQueries(1,k,C)}}}finally{Kn(p)}}}function Gw(s,a,f){d2()&&(_5(s,a,f,is(f,a)),(f.flags&64)===64&&oA(s,a,f))}function Hw(s,a,f=is){let p=a.localNames;if(p!==null){let _=a.index+1;for(let r=0;r<p.length;r+=2){let C=p[r+1],A=C===-1?f(a,s):s[C];s[_++]=A}}}function rA(s){let a=s.tView;return a===null||a.incompleteFirstPass?s.tView=qw(1,null,s.template,s.decls,s.vars,s.directiveDefs,s.pipeDefs,s.viewQuery,s.schemas,s.consts,s.id):a}function qw(s,a,f,p,_,r,C,A,k,B,Z){let he=js+p,xe=he+_,_e=s5(he,xe),Je=typeof B=="function"?B():B;return _e[zn]={type:s,blueprint:_e,template:f,queries:null,viewQuery:A,declTNode:a,data:_e.slice().fill(null,he),bindingStartIndex:he,expandoStartIndex:xe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof r=="function"?r():r,pipeRegistry:typeof C=="function"?C():C,firstChild:null,schemas:k,consts:Je,incompleteFirstPass:!1,ssrId:Z}}function s5(s,a){let f=[];for(let p=0;p<a;p++)f.push(p<s?null:Q2);return f}function a5(s,a,f,p){let r=p.get(RB,U2)||f===Ns.ShadowDom,C=s.selectRootElement(a,r);return l5(C),C}function l5(s){c5(s)}var c5=()=>null;function u5(s,a,f,p,_,r){let C=a?a.injectorIndex:-1,A=0;return qz()&&(A|=128),{type:f,index:p,insertBeforeIndex:null,injectorIndex:C,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:A,providerIndexes:0,value:_,attrs:r,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:a,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function yM(s,a,f,p,_){for(let r in a){if(!a.hasOwnProperty(r))continue;let C=a[r];if(C===void 0)continue;p??={};let A,k=zs.None;Array.isArray(C)?(A=C[0],k=C[1]):A=C;let B=r;if(_!==null){if(!_.hasOwnProperty(r))continue;B=_[r]}s===0?vM(p,f,B,A,k):vM(p,f,B,A)}return p}function vM(s,a,f,p,_){let r;s.hasOwnProperty(f)?(r=s[f]).push(a,p):r=s[f]=[a,p],_!==void 0&&r.push(_)}function h5(s,a,f){let p=a.directiveStart,_=a.directiveEnd,r=s.data,C=a.attrs,A=[],k=null,B=null;for(let Z=p;Z<_;Z++){let he=r[Z],xe=f?f.get(he):null,_e=xe?xe.inputs:null,Je=xe?xe.outputs:null;k=yM(0,he.inputs,Z,k,_e),B=yM(1,he.outputs,Z,B,Je);let Ge=k!==null&&C!==null&&!Ew(a)?C5(k,Z,C):null;A.push(Ge)}k!==null&&(k.hasOwnProperty("class")&&(a.flags|=8),k.hasOwnProperty("style")&&(a.flags|=16)),a.initialInputs=A,a.inputs=k,a.outputs=B}function d5(s){return s==="class"?"className":s==="for"?"htmlFor":s==="formaction"?"formAction":s==="innerHtml"?"innerHTML":s==="readonly"?"readOnly":s==="tabindex"?"tabIndex":s}function f5(s,a,f,p,_,r,C,A){let k=is(a,f),B=a.inputs,Z;!A&&B!=null&&(Z=B[p])?(Zw(s,f,Z,p,_),v0(a)&&p5(f,a.index)):a.type&3?(p=d5(p),_=C!=null?C(_,a.value||"",p):_,r.setProperty(k,p,_)):a.type&12}function p5(s,a){let f=rc(a,s);f[hn]&16||(f[hn]|=64)}function Ww(s,a,f,p){if(d2()){let _=p===null?null:{"":-1},r=v5(s,f),C,A;r===null?C=A=null:[C,A]=r,C!==null&&iA(s,a,f,C,_,A),_&&x5(f,p,_)}f.mergedAttrs=Tw(f.mergedAttrs,f.attrs)}function iA(s,a,f,p,_,r){for(let B=0;B<p.length;B++)Qb(i0(f,a),s,p[B].type);w5(f,s.data.length,p.length);for(let B=0;B<p.length;B++){let Z=p[B];Z.providersResolver&&Z.providersResolver(Z)}let C=!1,A=!1,k=tA(s,a,p.length,null);for(let B=0;B<p.length;B++){let Z=p[B];f.mergedAttrs=Tw(f.mergedAttrs,Z.hostAttrs),T5(s,f,a,k,Z),b5(k,Z,_),Z.contentQueries!==null&&(f.flags|=4),(Z.hostBindings!==null||Z.hostAttrs!==null||Z.hostVars!==0)&&(f.flags|=64);let he=Z.type.prototype;!C&&(he.ngOnChanges||he.ngOnInit||he.ngDoCheck)&&((s.preOrderHooks??=[]).push(f.index),C=!0),!A&&(he.ngOnChanges||he.ngDoCheck)&&((s.preOrderCheckHooks??=[]).push(f.index),A=!0),k++}h5(s,f,r)}function m5(s,a,f,p,_){let r=_.hostBindings;if(r){let C=s.hostBindingOpCodes;C===null&&(C=s.hostBindingOpCodes=[]);let A=~a.index;g5(C)!=A&&C.push(A),C.push(f,p,r)}}function g5(s){let a=s.length;for(;a>0;){let f=s[--a];if(typeof f=="number"&&f<0)return f}return 0}function _5(s,a,f,p){let _=f.directiveStart,r=f.directiveEnd;v0(f)&&E5(a,f,s.data[_+f.componentOffset]),s.firstCreatePass||i0(f,a),ec(p,a);let C=f.initialInputs;for(let A=_;A<r;A++){let k=s.data[A],B=Gd(a,s,A,f);if(ec(B,a),C!==null&&I5(a,A-_,B,k,f,C),qd(k)){let Z=rc(f.index,a);Z[ns]=Gd(a,s,A,f)}}}function oA(s,a,f){let p=f.directiveStart,_=f.directiveEnd,r=f.index,C=tB();try{Pu(r);for(let A=p;A<_;A++){let k=s.data[A],B=a[A];Xb(A),(k.hostBindings!==null||k.hostVars!==0||k.hostAttrs!==null)&&y5(k,B)}}finally{Pu(-1),Xb(C)}}function y5(s,a){s.hostBindings!==null&&s.hostBindings(1,a)}function v5(s,a){let f=s.directiveRegistry,p=null,_=null;if(f)for(let r=0;r<f.length;r++){let C=f[r];if(lz(a,C.selectors,!1))if(p||(p=[]),qd(C))if(C.findHostDirectiveDefs!==null){let A=[];_=_||new Map,C.findHostDirectiveDefs(C,A,_),p.unshift(...A,C);let k=A.length;ow(s,a,k)}else p.unshift(C),ow(s,a,0);else _=_||new Map,C.findHostDirectiveDefs?.(C,p,_),p.push(C)}return p===null?null:[p,_]}function ow(s,a,f){a.componentOffset=f,(s.components??=[]).push(a.index)}function x5(s,a,f){if(a){let p=s.localNames=[];for(let _=0;_<a.length;_+=2){let r=f[a[_+1]];if(r==null)throw new un(-301,!1);p.push(a[_],r)}}}function b5(s,a,f){if(f){if(a.exportAs)for(let p=0;p<a.exportAs.length;p++)f[a.exportAs[p]]=s;qd(a)&&(f[""]=s)}}function w5(s,a,f){s.flags|=1,s.directiveStart=a,s.directiveEnd=a+f,s.providerIndexes=a}function T5(s,a,f,p,_){s.data[p]=_;let r=_.factory||(_.factory=zd(_.type,!0)),C=new Ru(r,qd(_),ho);s.blueprint[p]=C,f[p]=C,m5(s,a,p,tA(s,f,_.hostVars,Q2),_)}function E5(s,a,f){let p=is(a,s),_=rA(f),r=s[Bs].rendererFactory,C=16;f.signals?C=4096:f.onPush&&(C=64);let A=A0(s,M0(s,_,null,C,p,a,null,r.createRenderer(p,f),null,null,null));s[a.index]=A}function I5(s,a,f,p,_,r){let C=r[a];if(C!==null)for(let A=0;A<C.length;){let k=C[A++],B=C[A++],Z=C[A++],he=C[A++];eA(p,f,k,B,Z,he)}}function C5(s,a,f){let p=null,_=0;for(;_<f.length;){let r=f[_];if(r===0){_+=4;continue}else if(r===5){_+=2;continue}if(typeof r=="number")break;if(s.hasOwnProperty(r)){p===null&&(p=[]);let C=s[r];for(let A=0;A<C.length;A+=3)if(C[A]===a){p.push(r,C[A+1],C[A+2],f[_+1]);break}}_+=2}return p}function sA(s,a,f,p){return[s,!0,0,a,null,p,null,f,null,null]}function aA(s,a){let f=s.contentQueries;if(f!==null){let p=Kn(null);try{for(let _=0;_<f.length;_+=2){let r=f[_],C=f[_+1];if(C!==-1){let A=s.data[C];m2(r),A.contentQueries(2,a[C],C)}}}finally{Kn(p)}}}function A0(s,a){return s[mm]?s[lM][ts]=a:s[mm]=a,s[lM]=a,a}function sw(s,a,f){m2(0);let p=Kn(null);try{a(s,f)}finally{Kn(p)}}function D5(s){return s[pm]||(s[pm]=[])}function S5(s){return s.cleanup||(s.cleanup=[])}function lA(s,a){let f=s[jd],p=f?f.get(Pa,null):null;p&&p.handleError(a)}function Zw(s,a,f,p,_){for(let r=0;r<f.length;){let C=f[r++],A=f[r++],k=f[r++],B=a[C],Z=s.data[C];eA(Z,B,p,A,k,_)}}function M5(s,a){let f=rc(a,s),p=f[zn];A5(p,f);let _=f[ka];_!==null&&f[Jy]===null&&(f[Jy]=Bw(_,f[jd])),Yw(p,f,f[ns])}function A5(s,a){for(let f=a.length;f<s.blueprint.length;f++)a.push(s.blueprint[f])}function Yw(s,a,f){Rw(a);try{let p=s.viewQuery;p!==null&&sw(1,p,f);let _=s.template;_!==null&&nA(s,a,_,1,f),s.firstCreatePass&&(s.firstCreatePass=!1),a[Ud]?.finishViewCreation(s),s.staticContentQueries&&aA(s,a),s.staticViewQueries&&sw(2,s.viewQuery,f);let r=s.components;r!==null&&P5(a,r)}catch(p){throw s.firstCreatePass&&(s.incompleteFirstPass=!0,s.firstCreatePass=!1),p}finally{a[hn]&=-5,Ow()}}function P5(s,a){for(let f=0;f<a.length;f++)M5(s,a[f])}function R5(s,a,f,p){let _=Kn(null);try{let r=a.tView,A=s[hn]&4096?4096:16,k=M0(s,r,f,A,null,a,null,null,p?.injector??null,p?.embeddedViewInjector??null,p?.dehydratedView??null),B=s[a.index];k[_0]=B;let Z=s[Ud];return Z!==null&&(k[Ud]=Z.createEmbeddedView(r)),Yw(r,k,f),k}finally{Kn(_)}}function xM(s,a){return!a||a.firstChild===null||F2(s)}function O5(s,a,f,p=!0){let _=a[zn];if($B(_,a,s,f),p){let C=iw(f,s),A=a[Mi],k=jw(A,s[Au]);k!==null&&jB(_,s[rs],A,a,k,C)}let r=a[Jy];r!==null&&r.firstChild!==null&&(r.firstChild=null)}function s0(s,a,f,p,_=!1){for(;f!==null;){let r=a[f.index];r!==null&&p.push(Aa(r)),La(r)&&k5(r,p);let C=f.type;if(C&8)s0(s,a,f.child,p);else if(C&32){let A=Vw(f,a),k;for(;k=A();)p.push(k)}else if(C&16){let A=Y2(a,f);if(Array.isArray(A))p.push(...A);else{let k=_m(a[Vs]);s0(k[zn],k,A,p,!0)}}f=_?f.projectionNext:f.next}return p}function k5(s,a){for(let f=Po;f<s.length;f++){let p=s[f],_=p[zn].firstChild;_!==null&&s0(p[zn],p,_,a)}s[Au]!==s[ka]&&a.push(s[Au])}var cA=[];function L5(s){return s[Mu]??F5(s)}function F5(s){let a=cA.pop()??Object.create(z5);return a.lView=s,a}function N5(s){s.lView[Mu]!==s&&(s.lView=null,cA.push(s))}var z5=_r(kt({},vS),{consumerIsAlwaysLive:!0,consumerMarkedDirty:s=>{gm(s.lView)},consumerOnSignalRead(){this.lView[Mu]=this}}),uA=100;function hA(s,a=!0,f=0){let p=s[Bs],_=p.rendererFactory,r=!1;r||_.begin?.();try{B5(s,f)}catch(C){throw a&&lA(s,C),C}finally{r||(_.end?.(),p.inlineEffectRunner?.flush())}}function B5(s,a){aw(s,a);let f=0;for(;Aw(s);){if(f===uA)throw new un(103,!1);f++,aw(s,1)}}function V5(s,a,f,p){let _=a[hn];if((_&256)===256)return;let r=!1;!r&&a[Bs].inlineEffectRunner?.flush(),Rw(a);let C=null,A=null;!r&&j5(s)&&(A=L5(a),C=xS(A));try{u2(a),Kz(s.bindingStartIndex),f!==null&&nA(s,a,f,2,p);let k=(_&3)===3;if(!r)if(k){let he=s.preOrderCheckHooks;he!==null&&Hy(a,he,null)}else{let he=s.preOrderHooks;he!==null&&qy(a,he,0,null),Pb(a,0)}if(U5(a),dA(a,0),s.contentQueries!==null&&aA(s,a),!r)if(k){let he=s.contentCheckHooks;he!==null&&Hy(a,he)}else{let he=s.contentHooks;he!==null&&qy(a,he,1),Pb(a,1)}i5(s,a);let B=s.components;B!==null&&pA(a,B,0);let Z=s.viewQuery;if(Z!==null&&sw(2,Z,p),!r)if(k){let he=s.viewCheckHooks;he!==null&&Hy(a,he)}else{let he=s.viewHooks;he!==null&&qy(a,he,2),Pb(a,2)}if(s.firstUpdatePass===!0&&(s.firstUpdatePass=!1),a[Ab]){for(let he of a[Ab])he();a[Ab]=null}r||(a[hn]&=-73)}catch(k){throw gm(a),k}finally{A!==null&&(bS(A,C),N5(A)),Ow()}}function j5(s){return s.type!==2}function dA(s,a){for(let f=z2(s);f!==null;f=B2(f))for(let p=Po;p<f.length;p++){let _=f[p];fA(_,a)}}function U5(s){for(let a=z2(s);a!==null;a=B2(a)){if(!(a[hn]&Dw.HasTransplantedViews))continue;let f=a[t0];for(let p=0;p<f.length;p++){let _=f[p],r=_[Ei];Vz(_)}}}function $5(s,a,f){let p=rc(a,s);fA(p,f)}function fA(s,a){Mw(s)&&aw(s,a)}function aw(s,a){let p=s[zn],_=s[hn],r=s[Mu],C=!!(a===0&&_&16);if(C||=!!(_&64&&a===0),C||=!!(_&1024),C||=!!(r?.dirty&&lb(r)),r&&(r.dirty=!1),s[hn]&=-9217,C)V5(p,s,p.template,s[ns]);else if(_&8192){dA(s,1);let A=p.components;A!==null&&pA(s,A,1)}}function pA(s,a,f){for(let p=0;p<a.length;p++)$5(s,a[p],f)}function Xw(s){for(s[Bs].changeDetectionScheduler?.notify();s;){s[hn]|=64;let a=_m(s);if(Az(s)&&!a)return s;s=a}return null}var Ou=class{get rootNodes(){let a=this._lView,f=a[zn];return s0(f,a,f.firstChild,[])}constructor(a,f,p=!0){this._lView=a,this._cdRefInjectingView=f,this.notifyErrorHandler=p,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[ns]}set context(a){this._lView[ns]=a}get destroyed(){return(this._lView[hn]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let a=this._lView[Ei];if(La(a)){let f=a[e0],p=f?f.indexOf(this):-1;p>-1&&(rw(a,p),Ky(f,p))}this._attachedToViewContainer=!1}W2(this._lView[zn],this._lView)}onDestroy(a){h2(this._lView,a)}markForCheck(){Xw(this._cdRefInjectingView||this._lView)}detach(){this._lView[hn]&=-129}reattach(){Yb(this._lView),this._lView[hn]|=128}detectChanges(){this._lView[hn]|=1024,hA(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new un(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,H2(this._lView[zn],this._lView)}attachToAppRef(a){if(this._attachedToViewContainer)throw new un(902,!1);this._appRef=a,Yb(this._lView)}},Kw=(()=>{let a=class a{};a.__NG_ELEMENT_ID__=q5;let s=a;return s})(),G5=Kw,H5=class extends G5{constructor(a,f,p){super(),this._declarationLView=a,this._declarationTContainer=f,this.elementRef=p}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(a,f){return this.createEmbeddedViewImpl(a,f)}createEmbeddedViewImpl(a,f,p){let _=R5(this._declarationLView,this._declarationTContainer,a,{embeddedViewInjector:f,dehydratedView:p});return new Ou(_)}};function q5(){return mA(uo(),zr())}function mA(s,a){return s.type&4?new H5(a,s,I0(s,a)):null}var h9=new RegExp(`^(\\d+)*(${AB}|${MB})*(.*)`);var W5=()=>null;function bM(s,a){return W5(s,a)}var lw=class{},cw=class{},a0=class{};function Z5(s){let a=Error(`No component factory found for ${Gi(s)}.`);return a[Y5]=s,a}var Y5="ngComponent";var uw=class{resolveComponentFactory(a){throw Z5(a)}},P0=(()=>{let a=class a{};a.NULL=new uw;let s=a;return s})(),ym=class{},Im=(()=>{let a=class a{constructor(){this.destroyNode=null}};a.__NG_ELEMENT_ID__=()=>X5();let s=a;return s})();function X5(){let s=zr(),a=uo(),f=rc(a.index,s);return(Cu(f)?f:s)[Mi]}var K5=(()=>{let a=class a{};a.\u0275prov=Qt({token:a,providedIn:"root",factory:()=>null});let s=a;return s})(),Fb={};var wM=new Set;function Qw(s){wM.has(s)||(wM.add(s),performance?.mark?.("mark_feature_usage",{detail:{feature:s}}))}function TM(...s){}function Q5(){let s=typeof cm.requestAnimationFrame=="function",a=cm[s?"requestAnimationFrame":"setTimeout"],f=cm[s?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&a&&f){let p=a[Zone.__symbol__("OriginalDelegate")];p&&(a=p);let _=f[Zone.__symbol__("OriginalDelegate")];_&&(f=_)}return{nativeRequestAnimationFrame:a,nativeCancelAnimationFrame:f}}var Sr=class s{constructor({enableLongStackTrace:a=!1,shouldCoalesceEventChangeDetection:f=!1,shouldCoalesceRunChangeDetection:p=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new es(!1),this.onMicrotaskEmpty=new es(!1),this.onStable=new es(!1),this.onError=new es(!1),typeof Zone>"u")throw new un(908,!1);Zone.assertZonePatched();let _=this;_._nesting=0,_._outer=_._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(_._inner=_._inner.fork(new Zone.TaskTrackingZoneSpec)),a&&Zone.longStackTraceZoneSpec&&(_._inner=_._inner.fork(Zone.longStackTraceZoneSpec)),_.shouldCoalesceEventChangeDetection=!p&&f,_.shouldCoalesceRunChangeDetection=p,_.lastRequestAnimationFrameId=-1,_.nativeRequestAnimationFrame=Q5().nativeRequestAnimationFrame,t4(_)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!s.isInAngularZone())throw new un(909,!1)}static assertNotInAngularZone(){if(s.isInAngularZone())throw new un(909,!1)}run(a,f,p){return this._inner.run(a,f,p)}runTask(a,f,p,_){let r=this._inner,C=r.scheduleEventTask("NgZoneEvent: "+_,a,J5,TM,TM);try{return r.runTask(C,f,p)}finally{r.cancelTask(C)}}runGuarded(a,f,p){return this._inner.runGuarded(a,f,p)}runOutsideAngular(a){return this._outer.run(a)}},J5={};function Jw(s){if(s._nesting==0&&!s.hasPendingMicrotasks&&!s.isStable)try{s._nesting++,s.onMicrotaskEmpty.emit(null)}finally{if(s._nesting--,!s.hasPendingMicrotasks)try{s.runOutsideAngular(()=>s.onStable.emit(null))}finally{s.isStable=!0}}}function e4(s){s.isCheckStableRunning||s.lastRequestAnimationFrameId!==-1||(s.lastRequestAnimationFrameId=s.nativeRequestAnimationFrame.call(cm,()=>{s.fakeTopEventTask||(s.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{s.lastRequestAnimationFrameId=-1,hw(s),s.isCheckStableRunning=!0,Jw(s),s.isCheckStableRunning=!1},void 0,()=>{},()=>{})),s.fakeTopEventTask.invoke()}),hw(s))}function t4(s){let a=()=>{e4(s)};s._inner=s._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(f,p,_,r,C,A)=>{if(n4(A))return f.invokeTask(_,r,C,A);try{return EM(s),f.invokeTask(_,r,C,A)}finally{(s.shouldCoalesceEventChangeDetection&&r.type==="eventTask"||s.shouldCoalesceRunChangeDetection)&&a(),IM(s)}},onInvoke:(f,p,_,r,C,A,k)=>{try{return EM(s),f.invoke(_,r,C,A,k)}finally{s.shouldCoalesceRunChangeDetection&&a(),IM(s)}},onHasTask:(f,p,_,r)=>{f.hasTask(_,r),p===_&&(r.change=="microTask"?(s._hasPendingMicrotasks=r.microTask,hw(s),Jw(s)):r.change=="macroTask"&&(s.hasPendingMacrotasks=r.macroTask))},onHandleError:(f,p,_,r)=>(f.handleError(_,r),s.runOutsideAngular(()=>s.onError.emit(r)),!1)})}function hw(s){s._hasPendingMicrotasks||(s.shouldCoalesceEventChangeDetection||s.shouldCoalesceRunChangeDetection)&&s.lastRequestAnimationFrameId!==-1?s.hasPendingMicrotasks=!0:s.hasPendingMicrotasks=!1}function EM(s){s._nesting++,s.isStable&&(s.isStable=!1,s.onUnstable.emit(null))}function IM(s){s._nesting--,Jw(s)}function n4(s){return!Array.isArray(s)||s.length!==1?!1:s[0].data?.__ignore_ng_zone__===!0}var gA=(()=>{let a=class a{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let p=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let _ of p)_()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};a.\u0275prov=Qt({token:a,providedIn:"root",factory:()=>new a});let s=a;return s})();function l0(s,a,f){let p=f?s.styles:null,_=f?s.classes:null,r=0;if(a!==null)for(let C=0;C<a.length;C++){let A=a[C];if(typeof A=="number")r=A;else if(r==1)_=QS(_,A);else if(r==2){let k=A,B=a[++C];p=QS(p,k+": "+B+";")}}f?s.styles=p:s.stylesWithoutHost=p,f?s.classes=_:s.classesWithoutHost=_}var c0=class extends P0{constructor(a){super(),this.ngModule=a}resolveComponentFactory(a){let f=Su(a);return new vm(f,this.ngModule)}};function CM(s){let a=[];for(let f in s){if(!s.hasOwnProperty(f))continue;let p=s[f];p!==void 0&&a.push({propName:Array.isArray(p)?p[0]:p,templateName:f})}return a}function r4(s){let a=s.toLowerCase();return a==="svg"?kz:a==="math"?Lz:null}var dw=class{constructor(a,f){this.injector=a,this.parentInjector=f}get(a,f,p){p=p0(p);let _=this.injector.get(a,Fb,p);return _!==Fb||f===Fb?_:this.parentInjector.get(a,f,p)}},vm=class extends a0{get inputs(){let a=this.componentDef,f=a.inputTransforms,p=CM(a.inputs);if(f!==null)for(let _ of p)f.hasOwnProperty(_.propName)&&(_.transform=f[_.propName]);return p}get outputs(){return CM(this.componentDef.outputs)}constructor(a,f){super(),this.componentDef=a,this.ngModule=f,this.componentType=a.type,this.selector=dz(a.selectors),this.ngContentSelectors=a.ngContentSelectors?a.ngContentSelectors:[],this.isBoundToModule=!!f}create(a,f,p,_){let r=Kn(null);try{_=_||this.ngModule;let C=_ instanceof Hi?_:_?.injector;C&&this.componentDef.getStandaloneInjector!==null&&(C=this.componentDef.getStandaloneInjector(C)||C);let A=C?new dw(a,C):a,k=A.get(ym,null);if(k===null)throw new un(407,!1);let B=A.get(K5,null),Z=A.get(gA,null),he=A.get(lw,null),xe={rendererFactory:k,sanitizer:B,inlineEffectRunner:null,afterRenderEventManager:Z,changeDetectionScheduler:he},_e=k.createRenderer(null,this.componentDef),Je=this.componentDef.selectors[0][0]||"div",Ge=p?a5(_e,p,this.componentDef.encapsulation,A):G2(_e,Je,r4(Je)),Ve=512;this.componentDef.signals?Ve|=4096:this.componentDef.onPush||(Ve|=16);let We=null;Ge!==null&&(We=Bw(Ge,A,!0));let ct=qw(0,null,null,1,0,null,null,null,null,null,null),gt=M0(null,ct,null,Ve,null,null,xe,_e,A,null,We);Rw(gt);let Be,St;try{let qt=this.componentDef,dn,Tt=null;qt.findHostDirectiveDefs?(dn=[],Tt=new Map,qt.findHostDirectiveDefs(qt,dn,Tt),dn.push(qt)):dn=[qt];let Gn=i4(gt,Ge),wt=o4(Gn,Ge,qt,dn,gt,xe,_e);St=c2(ct,js),Ge&&l4(_e,qt,Ge,p),f!==void 0&&c4(St,this.ngContentSelectors,f),Be=a4(wt,qt,dn,Tt,gt,[u4]),Yw(ct,gt,null)}finally{Ow()}return new fw(this.componentType,Be,I0(St,gt),gt,St)}finally{Kn(r)}}},fw=class extends cw{constructor(a,f,p,_,r){super(),this.location=p,this._rootLView=_,this._tNode=r,this.previousInputValues=null,this.instance=f,this.hostView=this.changeDetectorRef=new Ou(_,void 0,!1),this.componentType=a}setInput(a,f){let p=this._tNode.inputs,_;if(p!==null&&(_=p[a])){if(this.previousInputValues??=new Map,this.previousInputValues.has(a)&&Object.is(this.previousInputValues.get(a),f))return;let r=this._rootLView;Zw(r[zn],r,_,a,f),this.previousInputValues.set(a,f);let C=rc(this._tNode.index,r);Xw(C)}}get injector(){return new Du(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(a){this.hostView.onDestroy(a)}};function i4(s,a){let f=s[zn],p=js;return s[p]=a,Em(f,p,2,"#host",null)}function o4(s,a,f,p,_,r,C){let A=_[zn];s4(p,s,a,C);let k=null;a!==null&&(k=Bw(a,_[jd]));let B=r.rendererFactory.createRenderer(a,f),Z=16;f.signals?Z=4096:f.onPush&&(Z=64);let he=M0(_,rA(f),null,Z,_[s.index],s,r,B,null,null,k);return A.firstCreatePass&&ow(A,s,p.length-1),A0(_,he),_[s.index]=he}function s4(s,a,f,p){for(let _ of s)a.mergedAttrs=Tw(a.mergedAttrs,_.hostAttrs);a.mergedAttrs!==null&&(l0(a,a.mergedAttrs,!0),f!==null&&K2(p,f,a))}function a4(s,a,f,p,_,r){let C=uo(),A=_[zn],k=is(C,_);iA(A,_,C,f,null,p);for(let Z=0;Z<f.length;Z++){let he=C.directiveStart+Z,xe=Gd(_,A,he,C);ec(xe,_)}oA(A,_,C),k&&ec(k,_);let B=Gd(_,A,C.directiveStart+C.componentOffset,C);if(s[ns]=_[ns]=B,r!==null)for(let Z of r)Z(B,a);return $w(A,C,_),B}function l4(s,a,f,p){if(p)Gb(s,f,["ng-version","17.3.11"]);else{let{attrs:_,classes:r}=fz(a.selectors[0]);_&&Gb(s,f,_),r&&r.length>0&&X2(s,f,r.join(" "))}}function c4(s,a,f){let p=s.projection=[];for(let _=0;_<a.length;_++){let r=f[_];p.push(r!=null?Array.from(r):null)}}function u4(){let s=uo();E0(zr()[zn],s)}var Cm=(()=>{let a=class a{};a.__NG_ELEMENT_ID__=h4;let s=a;return s})();function h4(){let s=uo();return f4(s,zr())}var d4=Cm,_A=class extends d4{constructor(a,f,p){super(),this._lContainer=a,this._hostTNode=f,this._hostLView=p}get element(){return I0(this._hostTNode,this._hostLView)}get injector(){return new Du(this._hostTNode,this._hostLView)}get parentInjector(){let a=kw(this._hostTNode,this._hostLView);if(E2(a)){let f=r0(a,this._hostLView),p=n0(a),_=f[zn].data[p+8];return new Du(_,f)}else return new Du(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(a){let f=DM(this._lContainer);return f!==null&&f[a]||null}get length(){return this._lContainer.length-Po}createEmbeddedView(a,f,p){let _,r;typeof p=="number"?_=p:p!=null&&(_=p.index,r=p.injector);let C=bM(this._lContainer,a.ssrId),A=a.createEmbeddedViewImpl(f||{},r,C);return this.insertImpl(A,_,xM(this._hostTNode,C)),A}createComponent(a,f,p,_,r){let C=a&&!Mz(a),A;if(C)A=f;else{let Je=f||{};A=Je.index,p=Je.injector,_=Je.projectableNodes,r=Je.environmentInjector||Je.ngModuleRef}let k=C?a:new vm(Su(a)),B=p||this.parentInjector;if(!r&&k.ngModule==null){let Ge=(C?B:this.parentInjector).get(Hi,null);Ge&&(r=Ge)}let Z=Su(k.componentType??{}),he=bM(this._lContainer,Z?.id??null),xe=he?.firstChild??null,_e=k.create(B,_,xe,r);return this.insertImpl(_e.hostView,A,xM(this._hostTNode,he)),_e}insert(a,f){return this.insertImpl(a,f,!0)}insertImpl(a,f,p){let _=a._lView;if(Bz(_)){let A=this.indexOf(a);if(A!==-1)this.detach(A);else{let k=_[Ei],B=new _A(k,k[rs],k[Ei]);B.detach(B.indexOf(a))}}let r=this._adjustIndex(f),C=this._lContainer;return O5(C,_,r,p),a.attachToViewContainerRef(),UM(Nb(C),r,a),a}move(a,f){return this.insert(a,f)}indexOf(a){let f=DM(this._lContainer);return f!==null?f.indexOf(a):-1}remove(a){let f=this._adjustIndex(a,-1),p=rw(this._lContainer,f);p&&(Ky(Nb(this._lContainer),f),W2(p[zn],p))}detach(a){let f=this._adjustIndex(a,-1),p=rw(this._lContainer,f);return p&&Ky(Nb(this._lContainer),f)!=null?new Ou(p):null}_adjustIndex(a,f=0){return a??this.length+f}};function DM(s){return s[e0]}function Nb(s){return s[e0]||(s[e0]=[])}function f4(s,a){let f,p=a[s.index];return La(p)?f=p:(f=sA(p,a,null,s),a[s.index]=f,A0(a,f)),m4(f,a,s,p),new _A(f,s,a)}function p4(s,a){let f=s[Mi],p=f.createComment(""),_=is(a,s),r=jw(f,_);return o0(f,r,p,XB(f,_),!1),p}var m4=y4,g4=()=>!1;function _4(s,a,f){return g4(s,a,f)}function y4(s,a,f,p){if(s[Au])return;let _;f.type&8?_=Aa(p):_=p4(a,f),s[Au]=_}var tc=class{},xm=class{};var pw=class extends tc{constructor(a,f,p){super(),this._parent=f,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new c0(this);let _=XM(a);this._bootstrapComponents=$2(_.bootstrap),this._r3Injector=O2(a,f,[{provide:tc,useValue:this},{provide:P0,useValue:this.componentFactoryResolver},...p],Gi(a),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(a)}get injector(){return this._r3Injector}destroy(){let a=this._r3Injector;!a.destroyed&&a.destroy(),this.destroyCbs.forEach(f=>f()),this.destroyCbs=null}onDestroy(a){this.destroyCbs.push(a)}},mw=class extends xm{constructor(a){super(),this.moduleType=a}create(a){return new pw(this.moduleType,a,[])}};var u0=class extends tc{constructor(a){super(),this.componentFactoryResolver=new c0(this),this.instance=null;let f=new fm([...a.providers,{provide:tc,useValue:this},{provide:P0,useValue:this.componentFactoryResolver}],a.parent||Cw(),a.debugName,new Set(["environment"]));this.injector=f,a.runEnvironmentInitializers&&f.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(a){this.injector.onDestroy(a)}};function eT(s,a,f=null){return new u0({providers:s,parent:a,debugName:f,runEnvironmentInitializers:!0}).injector}var Vu=(()=>{let a=class a{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new pi(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let p=this.taskId++;return this.pendingTasks.add(p),p}remove(p){this.pendingTasks.delete(p),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function v4(s,a,f){let p=s[a];return Object.is(p,f)?!1:(s[a]=f,!0)}function x4(s){return(s.flags&32)===32}function b4(s,a,f,p,_,r,C,A,k){let B=a.consts,Z=Em(a,s,4,C||null,$d(B,A));Ww(a,f,Z,$d(B,k)),E0(a,Z);let he=Z.tView=qw(2,Z,p,_,r,a.directiveRegistry,a.pipeRegistry,null,a.schemas,B,null);return a.queries!==null&&(a.queries.template(a,Z),he.queries=a.queries.embeddedTView(Z)),Z}function R0(s,a,f,p,_,r,C,A){let k=zr(),B=os(),Z=s+js,he=B.firstCreatePass?b4(Z,B,k,a,f,p,_,r,C):B.data[Z];zu(he,!1);let xe=w4(B,k,he,s);w0()&&C0(B,k,xe,he),ec(xe,k);let _e=sA(xe,k,xe,he);return k[Z]=_e,A0(k,_e),_4(_e,he,k),x0(he)&&Gw(B,k,he),C!=null&&Hw(k,he,A),R0}var w4=T4;function T4(s,a,f,p){return T0(!0),a[Mi].createComment("")}function Dm(s,a,f){let p=zr(),_=Qz();if(v4(p,_,a)){let r=os(),C=iB();f5(r,C,p,s,a,p[Mi],f,!1)}return Dm}function SM(s,a,f,p,_){let r=a.inputs,C=_?"class":"style";Zw(s,f,r[C],C,p)}function E4(s,a,f,p,_,r){let C=a.consts,A=$d(C,_),k=Em(a,s,2,p,A);return Ww(a,f,k,$d(C,r)),k.attrs!==null&&l0(k,k.attrs,!1),k.mergedAttrs!==null&&l0(k,k.mergedAttrs,!0),a.queries!==null&&a.queries.elementStart(a,k),k}function dr(s,a,f,p){let _=zr(),r=os(),C=js+s,A=_[Mi],k=r.firstCreatePass?E4(C,r,_,a,f,p):r.data[C],B=I4(r,_,k,A,a,s);_[C]=B;let Z=x0(k);return zu(k,!0),K2(A,B,k),!x4(k)&&w0()&&C0(r,_,B,k),$z()===0&&ec(B,_),Gz(),Z&&(Gw(r,_,k),$w(r,k,_)),p!==null&&Hw(_,k),dr}function yr(){let s=uo();Pw()?p2():(s=s.parent,zu(s,!1));let a=s;Wz(a)&&Zz(),Hz();let f=os();return f.firstCreatePass&&(E0(f,s),Sw(s)&&f.queries.elementEnd(s)),a.classesWithoutHost!=null&&cB(a)&&SM(f,a,zr(),a.classesWithoutHost,!0),a.stylesWithoutHost!=null&&uB(a)&&SM(f,a,zr(),a.stylesWithoutHost,!1),yr}function Mr(s,a,f,p){return dr(s,a,f,p),yr(),Mr}var I4=(s,a,f,p,_,r)=>(T0(!0),G2(p,_,oB()));function C4(s,a,f,p,_){let r=a.consts,C=$d(r,p),A=Em(a,s,8,"ng-container",C);C!==null&&l0(A,C,!0);let k=$d(r,_);return Ww(a,f,A,k),a.queries!==null&&a.queries.elementStart(a,A),A}function yA(s,a,f){let p=zr(),_=os(),r=s+js,C=_.firstCreatePass?C4(r,_,p,a,f):_.data[r];zu(C,!0);let A=D4(_,p,C,s);return p[r]=A,w0()&&C0(_,p,A,C),ec(A,p),x0(C)&&(Gw(_,p,C),$w(_,C,p)),f!=null&&Hw(p,C),yA}function vA(){let s=uo(),a=os();return Pw()?p2():(s=s.parent,zu(s,!1)),a.firstCreatePass&&(E0(a,s),Sw(s)&&a.queries.elementEnd(s)),vA}function tT(s,a,f){return yA(s,a,f),vA(),tT}var D4=(s,a,f,p)=>(T0(!0),BB(a[Mi],""));function nT(){return zr()}var h0="en-US";var S4=h0;function M4(s){typeof s=="string"&&(S4=s.toLowerCase().replace(/_/g,"-"))}function ss(s,a,f,p){let _=zr(),r=os(),C=uo();return P4(r,_,_[Mi],C,s,a,p),ss}function A4(s,a,f,p){let _=s.cleanup;if(_!=null)for(let r=0;r<_.length-1;r+=2){let C=_[r];if(C===f&&_[r+1]===p){let A=a[pm],k=_[r+2];return A.length>k?A[k]:null}typeof C=="string"&&(r+=2)}return null}function P4(s,a,f,p,_,r,C){let A=x0(p),B=s.firstCreatePass&&S5(s),Z=a[ns],he=D5(a),xe=!0;if(p.type&3||C){let Ge=is(p,a),Ve=C?C(Ge):Ge,We=he.length,ct=C?Be=>C(Aa(Be[p.index])):p.index,gt=null;if(!C&&A&&(gt=A4(s,a,_,p.index)),gt!==null){let Be=gt.__ngLastListenerFn__||gt;Be.__ngNextListenerFn__=r,gt.__ngLastListenerFn__=r,xe=!1}else{r=AM(p,a,Z,r,!1);let Be=f.listen(Ve,_,r);he.push(r,Be),B&&B.push(_,ct,We,We+1)}}else r=AM(p,a,Z,r,!1);let _e=p.outputs,Je;if(xe&&_e!==null&&(Je=_e[_])){let Ge=Je.length;if(Ge)for(let Ve=0;Ve<Ge;Ve+=2){let We=Je[Ve],ct=Je[Ve+1],St=a[We][ct].subscribe(r),qt=he.length;he.push(r,St),B&&B.push(_,p.index,qt,-(qt+1))}}}function MM(s,a,f,p){let _=Kn(null);try{return Ls(6,a,f),f(p)!==!1}catch(r){return lA(s,r),!1}finally{Ls(7,a,f),Kn(_)}}function AM(s,a,f,p,_){return function r(C){if(C===Function)return p;let A=s.componentOffset>-1?rc(s.index,a):a;Xw(A);let k=MM(a,f,p,C),B=r.__ngNextListenerFn__;for(;B;)k=MM(a,f,B,C)&&k,B=B.__ngNextListenerFn__;return _&&k===!1&&C.preventDefault(),k}}function Zd(s=1){return rB(s)}function rT(s){let a=Xz();return zz(a,js+s)}function qi(s,a=""){let f=zr(),p=os(),_=s+js,r=p.firstCreatePass?Em(p,_,1,a,null):p.data[_],C=R4(p,f,r,a,s);f[_]=C,w0()&&C0(p,f,C,r),zu(r,!1)}var R4=(s,a,f,p,_)=>(T0(!0),zB(a[Mi],p));function O4(s,a,f){let p=os();if(p.firstCreatePass){let _=qd(s);gw(f,p.data,p.blueprint,_,!0),gw(a,p.data,p.blueprint,_,!1)}}function gw(s,a,f,p,_){if(s=Si(s),Array.isArray(s))for(let r=0;r<s.length;r++)gw(s[r],a,f,p,_);else{let r=os(),C=zr(),A=uo(),k=Vd(s)?s:Si(s.provide),B=n2(s),Z=A.providerIndexes&1048575,he=A.directiveStart,xe=A.providerIndexes>>20;if(Vd(s)||!s.multi){let _e=new Ru(B,_,ho),Je=Bb(k,a,_?Z:Z+xe,he);Je===-1?(Qb(i0(A,C),r,k),zb(r,s,a.length),a.push(k),A.directiveStart++,A.directiveEnd++,_&&(A.providerIndexes+=1048576),f.push(_e),C.push(_e)):(f[Je]=_e,C[Je]=_e)}else{let _e=Bb(k,a,Z+xe,he),Je=Bb(k,a,Z,Z+xe),Ge=_e>=0&&f[_e],Ve=Je>=0&&f[Je];if(_&&!Ve||!_&&!Ge){Qb(i0(A,C),r,k);let We=F4(_?L4:k4,f.length,_,p,B);!_&&Ve&&(f[Je].providerFactory=We),zb(r,s,a.length,0),a.push(k),A.directiveStart++,A.directiveEnd++,_&&(A.providerIndexes+=1048576),f.push(We),C.push(We)}else{let We=xA(f[_?Je:_e],B,!_&&p);zb(r,s,_e>-1?_e:Je,We)}!_&&p&&Ve&&f[Je].componentProviders++}}}function zb(s,a,f,p){let _=Vd(a),r=bz(a);if(_||r){let k=(r?Si(a.useClass):a).prototype.ngOnDestroy;if(k){let B=s.destroyHooks||(s.destroyHooks=[]);if(!_&&a.multi){let Z=B.indexOf(f);Z===-1?B.push(f,[p,k]):B[Z+1].push(p,k)}else B.push(f,k)}}}function xA(s,a,f){return f&&s.componentProviders++,s.multi.push(a)-1}function Bb(s,a,f,p){for(let _=f;_<p;_++)if(a[_]===s)return _;return-1}function k4(s,a,f,p){return _w(this.multi,[])}function L4(s,a,f,p){let _=this.multi,r;if(this.providerFactory){let C=this.providerFactory.componentProviders,A=Gd(f,f[zn],this.providerFactory.index,p);r=A.slice(0,C),_w(_,r);for(let k=C;k<A.length;k++)r.push(A[k])}else r=[],_w(_,r);return r}function _w(s,a){for(let f=0;f<s.length;f++){let p=s[f];a.push(p())}return a}function F4(s,a,f,p,_){let r=new Ru(s,f,ho);return r.multi=[],r.index=a,r.componentProviders=0,xA(r,_,p&&!f),r}function bA(s,a=[]){return f=>{f.providersResolver=(p,_)=>O4(p,_?_(s):s,a)}}var N4=(()=>{let a=class a{constructor(p){this._injector=p,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(p){if(!p.standalone)return null;if(!this.cachedInjectors.has(p)){let _=JM(!1,p.type),r=_.length>0?eT([_],this._injector,`Standalone[${p.type.name}]`):null;this.cachedInjectors.set(p,r)}return this.cachedInjectors.get(p)}ngOnDestroy(){try{for(let p of this.cachedInjectors.values())p!==null&&p.destroy()}finally{this.cachedInjectors.clear()}}};a.\u0275prov=Qt({token:a,providedIn:"environment",factory:()=>new a(xn(Hi))});let s=a;return s})();function Fa(s){Qw("NgStandalone"),s.getStandaloneInjector=a=>a.get(N4).getOrCreateStandaloneInjector(s)}function iT(s,a){return mA(s,a)}var O0=(()=>{let a=class a{log(p){console.log(p)}warn(p){console.warn(p)}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"platform"});let s=a;return s})();var wA=new vn("");function Sm(s){return!!s&&typeof s.then=="function"}function TA(s){return!!s&&typeof s.subscribe=="function"}var EA=new vn(""),IA=(()=>{let a=class a{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((p,_)=>{this.resolve=p,this.reject=_}),this.appInits=It(EA,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let p=[];for(let r of this.appInits){let C=r();if(Sm(C))p.push(C);else if(TA(C)){let A=new Promise((k,B)=>{C.subscribe({complete:k,error:B})});p.push(A)}}let _=()=>{this.done=!0,this.resolve()};Promise.all(p).then(()=>{_()}).catch(r=>{this.reject(r)}),p.length===0&&_(),this.initialized=!0}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),k0=new vn("");function z4(){TS(()=>{throw new un(600,!1)})}function B4(s){return s.isBoundToModule}function V4(s,a,f){try{let p=f();return Sm(p)?p.catch(_=>{throw a.runOutsideAngular(()=>s.handleError(_)),_}):p}catch(p){throw a.runOutsideAngular(()=>s.handleError(p)),p}}var Yd=(()=>{let a=class a{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=It(k2),this.afterRenderEffectManager=It(gA),this.externalTestViews=new Set,this.beforeRender=new Jr,this.afterTick=new Jr,this.componentTypes=[],this.components=[],this.isStable=It(Vu).hasPendingTasks.pipe(Sn(p=>!p)),this._injector=It(Hi)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(p,_){let r=p instanceof a0;if(!this._injector.get(IA).done){let _e=!r&&YM(p),Je=!1;throw new un(405,Je)}let A;r?A=p:A=this._injector.get(P0).resolveComponentFactory(p),this.componentTypes.push(A.componentType);let k=B4(A)?void 0:this._injector.get(tc),B=_||A.selector,Z=A.create(Tm.NULL,[],B,k),he=Z.location.nativeElement,xe=Z.injector.get(wA,null);return xe?.registerApplication(he),Z.onDestroy(()=>{this.detachView(Z.hostView),Vb(this.components,Z),xe?.unregisterApplication(he)}),this._loadComponent(Z),Z}tick(){this._tick(!0)}_tick(p){if(this._runningTick)throw new un(101,!1);let _=Kn(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(p)}catch(r){this.internalErrorHandler(r)}finally{this.afterTick.next(),this._runningTick=!1,Kn(_)}}detectChangesInAttachedViews(p){let _=0,r=this.afterRenderEffectManager;for(;;){if(_===uA)throw new un(103,!1);if(p){let C=_===0;this.beforeRender.next(C);for(let{_lView:A,notifyErrorHandler:k}of this._views)j4(A,C,k)}if(_++,r.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:C})=>yw(C))&&(r.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:C})=>yw(C))))break}}attachView(p){let _=p;this._views.push(_),_.attachToAppRef(this)}detachView(p){let _=p;Vb(this._views,_),_.detachFromAppRef()}_loadComponent(p){this.attachView(p.hostView),this.tick(),this.components.push(p);let _=this._injector.get(k0,[]);[...this._bootstrapListeners,..._].forEach(r=>r(p))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(p=>p()),this._views.slice().forEach(p=>p.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(p){return this._destroyListeners.push(p),()=>Vb(this._destroyListeners,p)}destroy(){if(this._destroyed)throw new un(406,!1);let p=this._injector;p.destroy&&!p.destroyed&&p.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function Vb(s,a){let f=s.indexOf(a);f>-1&&s.splice(f,1)}function j4(s,a,f){!a&&!yw(s)||U4(s,f,a)}function yw(s){return Aw(s)}function U4(s,a,f){let p;f?(p=0,s[hn]|=1024):s[hn]&64?p=0:p=1,hA(s,a,p)}var vw=class{constructor(a,f){this.ngModuleFactory=a,this.componentFactories=f}},oT=(()=>{let a=class a{compileModuleSync(p){return new mw(p)}compileModuleAsync(p){return Promise.resolve(this.compileModuleSync(p))}compileModuleAndAllComponentsSync(p){let _=this.compileModuleSync(p),r=XM(p),C=$2(r.declarations).reduce((A,k)=>{let B=Su(k);return B&&A.push(new vm(B)),A},[]);return new vw(_,C)}compileModuleAndAllComponentsAsync(p){return Promise.resolve(this.compileModuleAndAllComponentsSync(p))}clearCache(){}clearCacheFor(p){}getModuleId(p){}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var $4=(()=>{let a=class a{constructor(){this.zone=It(Sr),this.applicationRef=It(Yd)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function G4(s){return[{provide:Sr,useFactory:s},{provide:Bd,multi:!0,useFactory:()=>{let a=It($4,{optional:!0});return()=>a.initialize()}},{provide:Bd,multi:!0,useFactory:()=>{let a=It(Z4);return()=>{a.initialize()}}},{provide:k2,useFactory:H4}]}function H4(){let s=It(Sr),a=It(Pa);return f=>s.runOutsideAngular(()=>a.handleError(f))}function q4(s){let a=G4(()=>new Sr(W4(s)));return nc([[],a])}function W4(s){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:s?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:s?.runCoalescing??!1}}var Z4=(()=>{let a=class a{constructor(){this.subscription=new Qr,this.initialized=!1,this.zone=It(Sr),this.pendingTasks=It(Vu)}initialize(){if(this.initialized)return;this.initialized=!0;let p=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(p=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Sr.assertNotInAngularZone(),queueMicrotask(()=>{p!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(p),p=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Sr.assertInAngularZone(),p??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function Y4(){return typeof $localize<"u"&&$localize.locale||h0}var sT=new vn("",{providedIn:"root",factory:()=>It(sT,On.Optional|On.SkipSelf)||Y4()});var CA=new vn("");var Zy=null;function X4(s=[],a){return Tm.create({name:a,providers:[{provide:g0,useValue:"platform"},{provide:CA,useValue:new Set([()=>Zy=null])},...s]})}function K4(s=[]){if(Zy)return Zy;let a=X4(s);return Zy=a,z4(),Q4(a),a}function Q4(s){s.get(Nw,null)?.forEach(f=>f())}var Mm=(()=>{let a=class a{};a.__NG_ELEMENT_ID__=J4;let s=a;return s})();function J4(s){return eV(uo(),zr(),(s&16)===16)}function eV(s,a,f){if(v0(s)&&!f){let p=rc(s.index,a);return new Ou(p,p)}else if(s.type&47){let p=a[Vs];return new Ou(p,a)}return null}function DA(s){try{let{rootComponent:a,appProviders:f,platformProviders:p}=s,_=K4(p),r=[q4(),...f||[]],A=new u0({providers:r,parent:_,debugName:"",runEnvironmentInitializers:!1}).injector,k=A.get(Sr);return k.run(()=>{A.resolveInjectorInitializers();let B=A.get(Pa,null),Z;k.runOutsideAngular(()=>{Z=k.onError.subscribe({next:_e=>{B.handleError(_e)}})});let he=()=>A.destroy(),xe=_.get(CA);return xe.add(he),A.onDestroy(()=>{Z.unsubscribe(),xe.delete(he)}),V4(B,k,()=>{let _e=A.get(IA);return _e.runInitializers(),_e.donePromise.then(()=>{let Je=A.get(sT,h0);M4(Je||h0);let Ge=A.get(Yd);return a!==void 0&&Ge.bootstrap(a),Ge})})})}catch(a){return Promise.reject(a)}}var OA=null;function Xd(){return OA}function kA(s){OA??=s}var L0=class{};var Br=new vn(""),LA=(()=>{let a=class a{historyGo(p){throw new Error("")}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:()=>It(sV),providedIn:"platform"});let s=a;return s})();var sV=(()=>{let a=class a extends LA{constructor(){super(),this._doc=It(Br),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Xd().getBaseHref(this._doc)}onPopState(p){let _=Xd().getGlobalEventTarget(this._doc,"window");return _.addEventListener("popstate",p,!1),()=>_.removeEventListener("popstate",p)}onHashChange(p){let _=Xd().getGlobalEventTarget(this._doc,"window");return _.addEventListener("hashchange",p,!1),()=>_.removeEventListener("hashchange",p)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(p){this._location.pathname=p}pushState(p,_,r){this._history.pushState(p,_,r)}replaceState(p,_,r){this._history.replaceState(p,_,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(p=0){this._history.go(p)}getState(){return this._history.state}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:()=>new a,providedIn:"platform"});let s=a;return s})();function FA(s,a){if(s.length==0)return a;if(a.length==0)return s;let f=0;return s.endsWith("/")&&f++,a.startsWith("/")&&f++,f==2?s+a.substring(1):f==1?s+a:s+"/"+a}function SA(s){let a=s.match(/#|\?|$/),f=a&&a.index||s.length,p=f-(s[f-1]==="/"?1:0);return s.slice(0,p)+s.slice(f)}function ju(s){return s&&s[0]!=="?"?"?"+s:s}var F0=(()=>{let a=class a{historyGo(p){throw new Error("")}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:()=>It(NA),providedIn:"root"});let s=a;return s})(),aV=new vn(""),NA=(()=>{let a=class a extends F0{constructor(p,_){super(),this._platformLocation=p,this._removeListenerFns=[],this._baseHref=_??this._platformLocation.getBaseHrefFromDOM()??It(Br).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(p){this._removeListenerFns.push(this._platformLocation.onPopState(p),this._platformLocation.onHashChange(p))}getBaseHref(){return this._baseHref}prepareExternalUrl(p){return FA(this._baseHref,p)}path(p=!1){let _=this._platformLocation.pathname+ju(this._platformLocation.search),r=this._platformLocation.hash;return r&&p?`${_}${r}`:_}pushState(p,_,r,C){let A=this.prepareExternalUrl(r+ju(C));this._platformLocation.pushState(p,_,A)}replaceState(p,_,r,C){let A=this.prepareExternalUrl(r+ju(C));this._platformLocation.replaceState(p,_,A)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(p=0){this._platformLocation.historyGo?.(p)}};a.\u0275fac=function(_){return new(_||a)(xn(LA),xn(aV,8))},a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var Am=(()=>{let a=class a{constructor(p){this._subject=new es,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=p;let _=this._locationStrategy.getBaseHref();this._basePath=uV(SA(MA(_))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(p=!1){return this.normalize(this._locationStrategy.path(p))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(p,_=""){return this.path()==this.normalize(p+ju(_))}normalize(p){return a.stripTrailingSlash(cV(this._basePath,MA(p)))}prepareExternalUrl(p){return p&&p[0]!=="/"&&(p="/"+p),this._locationStrategy.prepareExternalUrl(p)}go(p,_="",r=null){this._locationStrategy.pushState(r,"",p,_),this._notifyUrlChangeListeners(this.prepareExternalUrl(p+ju(_)),r)}replaceState(p,_="",r=null){this._locationStrategy.replaceState(r,"",p,_),this._notifyUrlChangeListeners(this.prepareExternalUrl(p+ju(_)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(p=0){this._locationStrategy.historyGo?.(p)}onUrlChange(p){return this._urlChangeListeners.push(p),this._urlChangeSubscription??=this.subscribe(_=>{this._notifyUrlChangeListeners(_.url,_.state)}),()=>{let _=this._urlChangeListeners.indexOf(p);this._urlChangeListeners.splice(_,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(p="",_){this._urlChangeListeners.forEach(r=>r(p,_))}subscribe(p,_,r){return this._subject.subscribe({next:p,error:_,complete:r})}};a.normalizeQueryParams=ju,a.joinWithSlash=FA,a.stripTrailingSlash=SA,a.\u0275fac=function(_){return new(_||a)(xn(F0))},a.\u0275prov=Qt({token:a,factory:()=>lV(),providedIn:"root"});let s=a;return s})();function lV(){return new Am(xn(F0))}function cV(s,a){if(!s||!a.startsWith(s))return a;let f=a.substring(s.length);return f===""||["/",";","?","#"].includes(f[0])?f:a}function MA(s){return s.replace(/\/index.html$/,"")}function uV(s){if(new RegExp("^(https?:)?//").test(s)){let[,f]=s.split(/\/\/[^\/]+/);return f}return s}function N0(s,a){a=encodeURIComponent(a);for(let f of s.split(";")){let p=f.indexOf("="),[_,r]=p==-1?[f,""]:[f.slice(0,p),f.slice(p+1)];if(_.trim()===a)return decodeURIComponent(r)}return null}var aT=/\s+/,AA=[],zA=(()=>{let a=class a{constructor(p,_){this._ngEl=p,this._renderer=_,this.initialClasses=AA,this.stateMap=new Map}set klass(p){this.initialClasses=p!=null?p.trim().split(aT):AA}set ngClass(p){this.rawClass=typeof p=="string"?p.trim().split(aT):p}ngDoCheck(){for(let _ of this.initialClasses)this._updateState(_,!0);let p=this.rawClass;if(Array.isArray(p)||p instanceof Set)for(let _ of p)this._updateState(_,!0);else if(p!=null)for(let _ of Object.keys(p))this._updateState(_,!!p[_]);this._applyStateDiff()}_updateState(p,_){let r=this.stateMap.get(p);r!==void 0?(r.enabled!==_&&(r.changed=!0,r.enabled=_),r.touched=!0):this.stateMap.set(p,{enabled:_,changed:!0,touched:!0})}_applyStateDiff(){for(let p of this.stateMap){let _=p[0],r=p[1];r.changed?(this._toggleClass(_,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(_,!1),this.stateMap.delete(_)),r.touched=!1}}_toggleClass(p,_){p=p.trim(),p.length>0&&p.split(aT).forEach(r=>{_?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}};a.\u0275fac=function(_){return new(_||a)(ho(Wd),ho(Im))},a.\u0275dir=wm({type:a,selectors:[["","ngClass",""]],inputs:{klass:[zs.None,"class","klass"],ngClass:"ngClass"},standalone:!0});let s=a;return s})();var BA=(()=>{let a=class a{constructor(p,_){this._viewContainer=p,this._context=new lT,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=_}set ngIf(p){this._context.$implicit=this._context.ngIf=p,this._updateView()}set ngIfThen(p){PA("ngIfThen",p),this._thenTemplateRef=p,this._thenViewRef=null,this._updateView()}set ngIfElse(p){PA("ngIfElse",p),this._elseTemplateRef=p,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(p,_){return!0}};a.\u0275fac=function(_){return new(_||a)(ho(Cm),ho(Kw))},a.\u0275dir=wm({type:a,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let s=a;return s})(),lT=class{constructor(){this.$implicit=null,this.ngIf=null}};function PA(s,a){if(!!!(!a||a.createEmbeddedView))throw new Error(`${s} must be a TemplateRef, but received '${Gi(a)}'.`)}var Uu=(()=>{let a=class a{};a.\u0275fac=function(_){return new(_||a)},a.\u0275mod=Lu({type:a}),a.\u0275inj=ku({});let s=a;return s})(),VA="browser",hV="server";function z0(s){return s===hV}var Kd=class{};var Rm=class{},V0=class{},$u=class s{constructor(a){this.normalizedNames=new Map,this.lazyUpdate=null,a?typeof a=="string"?this.lazyInit=()=>{this.headers=new Map,a.split(`
`).forEach(f=>{let p=f.indexOf(":");if(p>0){let _=f.slice(0,p),r=_.toLowerCase(),C=f.slice(p+1).trim();this.maybeSetNormalizedName(_,r),this.headers.has(r)?this.headers.get(r).push(C):this.headers.set(r,[C])}})}:typeof Headers<"u"&&a instanceof Headers?(this.headers=new Map,a.forEach((f,p)=>{this.setHeaderEntries(p,f)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(a).forEach(([f,p])=>{this.setHeaderEntries(f,p)})}:this.headers=new Map}has(a){return this.init(),this.headers.has(a.toLowerCase())}get(a){this.init();let f=this.headers.get(a.toLowerCase());return f&&f.length>0?f[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(a){return this.init(),this.headers.get(a.toLowerCase())||null}append(a,f){return this.clone({name:a,value:f,op:"a"})}set(a,f){return this.clone({name:a,value:f,op:"s"})}delete(a,f){return this.clone({name:a,value:f,op:"d"})}maybeSetNormalizedName(a,f){this.normalizedNames.has(f)||this.normalizedNames.set(f,a)}init(){this.lazyInit&&(this.lazyInit instanceof s?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(a=>this.applyUpdate(a)),this.lazyUpdate=null))}copyFrom(a){a.init(),Array.from(a.headers.keys()).forEach(f=>{this.headers.set(f,a.headers.get(f)),this.normalizedNames.set(f,a.normalizedNames.get(f))})}clone(a){let f=new s;return f.lazyInit=this.lazyInit&&this.lazyInit instanceof s?this.lazyInit:this,f.lazyUpdate=(this.lazyUpdate||[]).concat([a]),f}applyUpdate(a){let f=a.name.toLowerCase();switch(a.op){case"a":case"s":let p=a.value;if(typeof p=="string"&&(p=[p]),p.length===0)return;this.maybeSetNormalizedName(a.name,f);let _=(a.op==="a"?this.headers.get(f):void 0)||[];_.push(...p),this.headers.set(f,_);break;case"d":let r=a.value;if(!r)this.headers.delete(f),this.normalizedNames.delete(f);else{let C=this.headers.get(f);if(!C)return;C=C.filter(A=>r.indexOf(A)===-1),C.length===0?(this.headers.delete(f),this.normalizedNames.delete(f)):this.headers.set(f,C)}break}}setHeaderEntries(a,f){let p=(Array.isArray(f)?f:[f]).map(r=>r.toString()),_=a.toLowerCase();this.headers.set(_,p),this.maybeSetNormalizedName(a,_)}forEach(a){this.init(),Array.from(this.normalizedNames.keys()).forEach(f=>a(this.normalizedNames.get(f),this.headers.get(f)))}};var hT=class{encodeKey(a){return jA(a)}encodeValue(a){return jA(a)}decodeKey(a){return decodeURIComponent(a)}decodeValue(a){return decodeURIComponent(a)}};function pV(s,a){let f=new Map;return s.length>0&&s.replace(/^\?/,"").split("&").forEach(_=>{let r=_.indexOf("="),[C,A]=r==-1?[a.decodeKey(_),""]:[a.decodeKey(_.slice(0,r)),a.decodeValue(_.slice(r+1))],k=f.get(C)||[];k.push(A),f.set(C,k)}),f}var mV=/%(\d[a-f0-9])/gi,gV={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function jA(s){return encodeURIComponent(s).replace(mV,(a,f)=>gV[f]??a)}function B0(s){return`${s}`}var sc=class s{constructor(a={}){if(this.updates=null,this.cloneFrom=null,this.encoder=a.encoder||new hT,a.fromString){if(a.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=pV(a.fromString,this.encoder)}else a.fromObject?(this.map=new Map,Object.keys(a.fromObject).forEach(f=>{let p=a.fromObject[f],_=Array.isArray(p)?p.map(B0):[B0(p)];this.map.set(f,_)})):this.map=null}has(a){return this.init(),this.map.has(a)}get(a){this.init();let f=this.map.get(a);return f?f[0]:null}getAll(a){return this.init(),this.map.get(a)||null}keys(){return this.init(),Array.from(this.map.keys())}append(a,f){return this.clone({param:a,value:f,op:"a"})}appendAll(a){let f=[];return Object.keys(a).forEach(p=>{let _=a[p];Array.isArray(_)?_.forEach(r=>{f.push({param:p,value:r,op:"a"})}):f.push({param:p,value:_,op:"a"})}),this.clone(f)}set(a,f){return this.clone({param:a,value:f,op:"s"})}delete(a,f){return this.clone({param:a,value:f,op:"d"})}toString(){return this.init(),this.keys().map(a=>{let f=this.encoder.encodeKey(a);return this.map.get(a).map(p=>f+"="+this.encoder.encodeValue(p)).join("&")}).filter(a=>a!=="").join("&")}clone(a){let f=new s({encoder:this.encoder});return f.cloneFrom=this.cloneFrom||this,f.updates=(this.updates||[]).concat(a),f}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(a=>this.map.set(a,this.cloneFrom.map.get(a))),this.updates.forEach(a=>{switch(a.op){case"a":case"s":let f=(a.op==="a"?this.map.get(a.param):void 0)||[];f.push(B0(a.value)),this.map.set(a.param,f);break;case"d":if(a.value!==void 0){let p=this.map.get(a.param)||[],_=p.indexOf(B0(a.value));_!==-1&&p.splice(_,1),p.length>0?this.map.set(a.param,p):this.map.delete(a.param)}else{this.map.delete(a.param);break}}}),this.cloneFrom=this.updates=null)}};var dT=class{constructor(){this.map=new Map}set(a,f){return this.map.set(a,f),this}get(a){return this.map.has(a)||this.map.set(a,a.defaultValue()),this.map.get(a)}delete(a){return this.map.delete(a),this}has(a){return this.map.has(a)}keys(){return this.map.keys()}};function _V(s){switch(s){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function UA(s){return typeof ArrayBuffer<"u"&&s instanceof ArrayBuffer}function $A(s){return typeof Blob<"u"&&s instanceof Blob}function GA(s){return typeof FormData<"u"&&s instanceof FormData}function yV(s){return typeof URLSearchParams<"u"&&s instanceof URLSearchParams}var Pm=class s{constructor(a,f,p,_){this.url=f,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=a.toUpperCase();let r;if(_V(this.method)||_?(this.body=p!==void 0?p:null,r=_):r=p,r&&(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.context&&(this.context=r.context),r.params&&(this.params=r.params),this.transferCache=r.transferCache),this.headers??=new $u,this.context??=new dT,!this.params)this.params=new sc,this.urlWithParams=f;else{let C=this.params.toString();if(C.length===0)this.urlWithParams=f;else{let A=f.indexOf("?"),k=A===-1?"?":A<f.length-1?"&":"";this.urlWithParams=f+k+C}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||UA(this.body)||$A(this.body)||GA(this.body)||yV(this.body)?this.body:this.body instanceof sc?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||GA(this.body)?null:$A(this.body)?this.body.type||null:UA(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof sc?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(a={}){let f=a.method||this.method,p=a.url||this.url,_=a.responseType||this.responseType,r=a.transferCache??this.transferCache,C=a.body!==void 0?a.body:this.body,A=a.withCredentials??this.withCredentials,k=a.reportProgress??this.reportProgress,B=a.headers||this.headers,Z=a.params||this.params,he=a.context??this.context;return a.setHeaders!==void 0&&(B=Object.keys(a.setHeaders).reduce((xe,_e)=>xe.set(_e,a.setHeaders[_e]),B)),a.setParams&&(Z=Object.keys(a.setParams).reduce((xe,_e)=>xe.set(_e,a.setParams[_e]),Z)),new s(f,p,C,{params:Z,headers:B,context:he,reportProgress:k,responseType:_,withCredentials:A,transferCache:r})}},Qd=function(s){return s[s.Sent=0]="Sent",s[s.UploadProgress=1]="UploadProgress",s[s.ResponseHeader=2]="ResponseHeader",s[s.DownloadProgress=3]="DownloadProgress",s[s.Response=4]="Response",s[s.User=5]="User",s}(Qd||{}),Om=class{constructor(a,f=$0.Ok,p="OK"){this.headers=a.headers||new $u,this.status=a.status!==void 0?a.status:f,this.statusText=a.statusText||p,this.url=a.url||null,this.ok=this.status>=200&&this.status<300}},fT=class s extends Om{constructor(a={}){super(a),this.type=Qd.ResponseHeader}clone(a={}){return new s({headers:a.headers||this.headers,status:a.status!==void 0?a.status:this.status,statusText:a.statusText||this.statusText,url:a.url||this.url||void 0})}},j0=class s extends Om{constructor(a={}){super(a),this.type=Qd.Response,this.body=a.body!==void 0?a.body:null}clone(a={}){return new s({body:a.body!==void 0?a.body:this.body,headers:a.headers||this.headers,status:a.status!==void 0?a.status:this.status,statusText:a.statusText||this.statusText,url:a.url||this.url||void 0})}},U0=class extends Om{constructor(a){super(a,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${a.url||"(unknown url)"}`:this.message=`Http failure response for ${a.url||"(unknown url)"}: ${a.status} ${a.statusText}`,this.error=a.error||null}},$0=function(s){return s[s.Continue=100]="Continue",s[s.SwitchingProtocols=101]="SwitchingProtocols",s[s.Processing=102]="Processing",s[s.EarlyHints=103]="EarlyHints",s[s.Ok=200]="Ok",s[s.Created=201]="Created",s[s.Accepted=202]="Accepted",s[s.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",s[s.NoContent=204]="NoContent",s[s.ResetContent=205]="ResetContent",s[s.PartialContent=206]="PartialContent",s[s.MultiStatus=207]="MultiStatus",s[s.AlreadyReported=208]="AlreadyReported",s[s.ImUsed=226]="ImUsed",s[s.MultipleChoices=300]="MultipleChoices",s[s.MovedPermanently=301]="MovedPermanently",s[s.Found=302]="Found",s[s.SeeOther=303]="SeeOther",s[s.NotModified=304]="NotModified",s[s.UseProxy=305]="UseProxy",s[s.Unused=306]="Unused",s[s.TemporaryRedirect=307]="TemporaryRedirect",s[s.PermanentRedirect=308]="PermanentRedirect",s[s.BadRequest=400]="BadRequest",s[s.Unauthorized=401]="Unauthorized",s[s.PaymentRequired=402]="PaymentRequired",s[s.Forbidden=403]="Forbidden",s[s.NotFound=404]="NotFound",s[s.MethodNotAllowed=405]="MethodNotAllowed",s[s.NotAcceptable=406]="NotAcceptable",s[s.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",s[s.RequestTimeout=408]="RequestTimeout",s[s.Conflict=409]="Conflict",s[s.Gone=410]="Gone",s[s.LengthRequired=411]="LengthRequired",s[s.PreconditionFailed=412]="PreconditionFailed",s[s.PayloadTooLarge=413]="PayloadTooLarge",s[s.UriTooLong=414]="UriTooLong",s[s.UnsupportedMediaType=415]="UnsupportedMediaType",s[s.RangeNotSatisfiable=416]="RangeNotSatisfiable",s[s.ExpectationFailed=417]="ExpectationFailed",s[s.ImATeapot=418]="ImATeapot",s[s.MisdirectedRequest=421]="MisdirectedRequest",s[s.UnprocessableEntity=422]="UnprocessableEntity",s[s.Locked=423]="Locked",s[s.FailedDependency=424]="FailedDependency",s[s.TooEarly=425]="TooEarly",s[s.UpgradeRequired=426]="UpgradeRequired",s[s.PreconditionRequired=428]="PreconditionRequired",s[s.TooManyRequests=429]="TooManyRequests",s[s.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",s[s.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",s[s.InternalServerError=500]="InternalServerError",s[s.NotImplemented=501]="NotImplemented",s[s.BadGateway=502]="BadGateway",s[s.ServiceUnavailable=503]="ServiceUnavailable",s[s.GatewayTimeout=504]="GatewayTimeout",s[s.HttpVersionNotSupported=505]="HttpVersionNotSupported",s[s.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",s[s.InsufficientStorage=507]="InsufficientStorage",s[s.LoopDetected=508]="LoopDetected",s[s.NotExtended=510]="NotExtended",s[s.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",s}($0||{});function uT(s,a){return{body:a,headers:s.headers,context:s.context,observe:s.observe,params:s.params,reportProgress:s.reportProgress,responseType:s.responseType,withCredentials:s.withCredentials,transferCache:s.transferCache}}var pT=(()=>{let a=class a{constructor(p){this.handler=p}request(p,_,r={}){let C;if(p instanceof Pm)C=p;else{let B;r.headers instanceof $u?B=r.headers:B=new $u(r.headers);let Z;r.params&&(r.params instanceof sc?Z=r.params:Z=new sc({fromObject:r.params})),C=new Pm(p,_,r.body!==void 0?r.body:null,{headers:B,context:r.context,params:Z,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache})}let A=on(C).pipe(Xl(B=>this.handler.handle(B)));if(p instanceof Pm||r.observe==="events")return A;let k=A.pipe(lo(B=>B instanceof j0));switch(r.observe||"body"){case"body":switch(C.responseType){case"arraybuffer":return k.pipe(Sn(B=>{if(B.body!==null&&!(B.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return B.body}));case"blob":return k.pipe(Sn(B=>{if(B.body!==null&&!(B.body instanceof Blob))throw new Error("Response is not a Blob.");return B.body}));case"text":return k.pipe(Sn(B=>{if(B.body!==null&&typeof B.body!="string")throw new Error("Response is not a string.");return B.body}));case"json":default:return k.pipe(Sn(B=>B.body))}case"response":return k;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(p,_={}){return this.request("DELETE",p,_)}get(p,_={}){return this.request("GET",p,_)}head(p,_={}){return this.request("HEAD",p,_)}jsonp(p,_){return this.request("JSONP",p,{params:new sc().append(_,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(p,_={}){return this.request("OPTIONS",p,_)}patch(p,_,r={}){return this.request("PATCH",p,uT(r,_))}post(p,_,r={}){return this.request("POST",p,uT(r,_))}put(p,_,r={}){return this.request("PUT",p,uT(r,_))}};a.\u0275fac=function(_){return new(_||a)(xn(Rm))},a.\u0275prov=Qt({token:a,factory:a.\u0275fac});let s=a;return s})();function ZA(s,a){return a(s)}function vV(s,a){return(f,p)=>a.intercept(f,{handle:_=>s(_,p)})}function xV(s,a,f){return(p,_)=>Oa(f,()=>a(p,r=>s(r,_)))}var bV=new vn(""),mT=new vn(""),wV=new vn(""),TV=new vn("");function EV(){let s=null;return(a,f)=>{s===null&&(s=(It(bV,{optional:!0})??[]).reduceRight(vV,ZA));let p=It(Vu),_=p.add();return s(a,f).pipe(Rs(()=>p.remove(_)))}}var HA=(()=>{let a=class a extends Rm{constructor(p,_){super(),this.backend=p,this.injector=_,this.chain=null,this.pendingTasks=It(Vu);let r=It(TV,{optional:!0});this.backend=r??p}handle(p){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(mT),...this.injector.get(wV,[])]));this.chain=r.reduceRight((C,A)=>xV(C,A,this.injector),ZA)}let _=this.pendingTasks.add();return this.chain(p,r=>this.backend.handle(r)).pipe(Rs(()=>this.pendingTasks.remove(_)))}};a.\u0275fac=function(_){return new(_||a)(xn(V0),xn(Hi))},a.\u0275prov=Qt({token:a,factory:a.\u0275fac});let s=a;return s})();var IV=/^\)\]\}',?\n/;function CV(s){return"responseURL"in s&&s.responseURL?s.responseURL:/^X-Request-URL:/m.test(s.getAllResponseHeaders())?s.getResponseHeader("X-Request-URL"):null}var qA=(()=>{let a=class a{constructor(p){this.xhrFactory=p}handle(p){if(p.method==="JSONP")throw new un(-2800,!1);let _=this.xhrFactory;return(_.\u0275loadImpl?Dr(_.\u0275loadImpl()):on(null)).pipe(co(()=>new Qn(C=>{let A=_.build();if(A.open(p.method,p.urlWithParams),p.withCredentials&&(A.withCredentials=!0),p.headers.forEach((Ve,We)=>A.setRequestHeader(Ve,We.join(","))),p.headers.has("Accept")||A.setRequestHeader("Accept","application/json, text/plain, */*"),!p.headers.has("Content-Type")){let Ve=p.detectContentTypeHeader();Ve!==null&&A.setRequestHeader("Content-Type",Ve)}if(p.responseType){let Ve=p.responseType.toLowerCase();A.responseType=Ve!=="json"?Ve:"text"}let k=p.serializeBody(),B=null,Z=()=>{if(B!==null)return B;let Ve=A.statusText||"OK",We=new $u(A.getAllResponseHeaders()),ct=CV(A)||p.url;return B=new fT({headers:We,status:A.status,statusText:Ve,url:ct}),B},he=()=>{let{headers:Ve,status:We,statusText:ct,url:gt}=Z(),Be=null;We!==$0.NoContent&&(Be=typeof A.response>"u"?A.responseText:A.response),We===0&&(We=Be?$0.Ok:0);let St=We>=200&&We<300;if(p.responseType==="json"&&typeof Be=="string"){let qt=Be;Be=Be.replace(IV,"");try{Be=Be!==""?JSON.parse(Be):null}catch(dn){Be=qt,St&&(St=!1,Be={error:dn,text:Be})}}St?(C.next(new j0({body:Be,headers:Ve,status:We,statusText:ct,url:gt||void 0})),C.complete()):C.error(new U0({error:Be,headers:Ve,status:We,statusText:ct,url:gt||void 0}))},xe=Ve=>{let{url:We}=Z(),ct=new U0({error:Ve,status:A.status||0,statusText:A.statusText||"Unknown Error",url:We||void 0});C.error(ct)},_e=!1,Je=Ve=>{_e||(C.next(Z()),_e=!0);let We={type:Qd.DownloadProgress,loaded:Ve.loaded};Ve.lengthComputable&&(We.total=Ve.total),p.responseType==="text"&&A.responseText&&(We.partialText=A.responseText),C.next(We)},Ge=Ve=>{let We={type:Qd.UploadProgress,loaded:Ve.loaded};Ve.lengthComputable&&(We.total=Ve.total),C.next(We)};return A.addEventListener("load",he),A.addEventListener("error",xe),A.addEventListener("timeout",xe),A.addEventListener("abort",xe),p.reportProgress&&(A.addEventListener("progress",Je),k!==null&&A.upload&&A.upload.addEventListener("progress",Ge)),A.send(k),C.next({type:Qd.Sent}),()=>{A.removeEventListener("error",xe),A.removeEventListener("abort",xe),A.removeEventListener("load",he),A.removeEventListener("timeout",xe),p.reportProgress&&(A.removeEventListener("progress",Je),k!==null&&A.upload&&A.upload.removeEventListener("progress",Ge)),A.readyState!==A.DONE&&A.abort()}})))}};a.\u0275fac=function(_){return new(_||a)(xn(Kd))},a.\u0275prov=Qt({token:a,factory:a.\u0275fac});let s=a;return s})(),YA=new vn(""),DV="XSRF-TOKEN",SV=new vn("",{providedIn:"root",factory:()=>DV}),MV="X-XSRF-TOKEN",AV=new vn("",{providedIn:"root",factory:()=>MV}),G0=class{},PV=(()=>{let a=class a{constructor(p,_,r){this.doc=p,this.platform=_,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let p=this.doc.cookie||"";return p!==this.lastCookieString&&(this.parseCount++,this.lastToken=N0(p,this.cookieName),this.lastCookieString=p),this.lastToken}};a.\u0275fac=function(_){return new(_||a)(xn(Br),xn(ic),xn(SV))},a.\u0275prov=Qt({token:a,factory:a.\u0275fac});let s=a;return s})();function RV(s,a){let f=s.url.toLowerCase();if(!It(YA)||s.method==="GET"||s.method==="HEAD"||f.startsWith("http://")||f.startsWith("https://"))return a(s);let p=It(G0).getToken(),_=It(AV);return p!=null&&!s.headers.has(_)&&(s=s.clone({headers:s.headers.set(_,p)})),a(s)}var XA=function(s){return s[s.Interceptors=0]="Interceptors",s[s.LegacyInterceptors=1]="LegacyInterceptors",s[s.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",s[s.NoXsrfProtection=3]="NoXsrfProtection",s[s.JsonpSupport=4]="JsonpSupport",s[s.RequestsMadeViaParent=5]="RequestsMadeViaParent",s[s.Fetch=6]="Fetch",s}(XA||{});function OV(s,a){return{\u0275kind:s,\u0275providers:a}}function kV(...s){let a=[pT,qA,HA,{provide:Rm,useExisting:HA},{provide:V0,useExisting:qA},{provide:mT,useValue:RV,multi:!0},{provide:YA,useValue:!0},{provide:G0,useClass:PV}];for(let f of s)a.push(...f.\u0275providers);return nc(a)}var WA=new vn("");function LV(){return OV(XA.LegacyInterceptors,[{provide:WA,useFactory:EV},{provide:mT,useExisting:WA,multi:!0}])}var KA=(()=>{let a=class a{};a.\u0275fac=function(_){return new(_||a)},a.\u0275mod=Lu({type:a}),a.\u0275inj=ku({providers:[kV(LV())]});let s=a;return s})();var yT=class extends L0{constructor(){super(...arguments),this.supportsDOMEvents=!0}},vT=class s extends yT{static makeCurrent(){kA(new s)}onAndCancel(a,f,p){return a.addEventListener(f,p),()=>{a.removeEventListener(f,p)}}dispatchEvent(a,f){a.dispatchEvent(f)}remove(a){a.parentNode&&a.parentNode.removeChild(a)}createElement(a,f){return f=f||this.getDefaultDocument(),f.createElement(a)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(a){return a.nodeType===Node.ELEMENT_NODE}isShadowRoot(a){return a instanceof DocumentFragment}getGlobalEventTarget(a,f){return f==="window"?window:f==="document"?a:f==="body"?a.body:null}getBaseHref(a){let f=NV();return f==null?null:zV(f)}resetBaseElement(){km=null}getUserAgent(){return window.navigator.userAgent}getCookie(a){return N0(document.cookie,a)}},km=null;function NV(){return km=km||document.querySelector("base"),km?km.getAttribute("href"):null}function zV(s){return new URL(s,document.baseURI).pathname}var BV=(()=>{let a=class a{build(){return new XMLHttpRequest}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:a.\u0275fac});let s=a;return s})(),xT=new vn(""),tP=(()=>{let a=class a{constructor(p,_){this._zone=_,this._eventNameToPlugin=new Map,p.forEach(r=>{r.manager=this}),this._plugins=p.slice().reverse()}addEventListener(p,_,r){return this._findPluginFor(_).addEventListener(p,_,r)}getZone(){return this._zone}_findPluginFor(p){let _=this._eventNameToPlugin.get(p);if(_)return _;if(_=this._plugins.find(C=>C.supports(p)),!_)throw new un(5101,!1);return this._eventNameToPlugin.set(p,_),_}};a.\u0275fac=function(_){return new(_||a)(xn(xT),xn(Sr))},a.\u0275prov=Qt({token:a,factory:a.\u0275fac});let s=a;return s})(),H0=class{constructor(a){this._doc=a}},gT="ng-app-id",nP=(()=>{let a=class a{constructor(p,_,r,C={}){this.doc=p,this.appId=_,this.nonce=r,this.platformId=C,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=z0(C),this.resetHostNodes()}addStyles(p){for(let _ of p)this.changeUsageCount(_,1)===1&&this.onStyleAdded(_)}removeStyles(p){for(let _ of p)this.changeUsageCount(_,-1)<=0&&this.onStyleRemoved(_)}ngOnDestroy(){let p=this.styleNodesInDOM;p&&(p.forEach(_=>_.remove()),p.clear());for(let _ of this.getAllStyles())this.onStyleRemoved(_);this.resetHostNodes()}addHost(p){this.hostNodes.add(p);for(let _ of this.getAllStyles())this.addStyleToHost(p,_)}removeHost(p){this.hostNodes.delete(p)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(p){for(let _ of this.hostNodes)this.addStyleToHost(_,p)}onStyleRemoved(p){let _=this.styleRef;_.get(p)?.elements?.forEach(r=>r.remove()),_.delete(p)}collectServerRenderedStyles(){let p=this.doc.head?.querySelectorAll(`style[${gT}="${this.appId}"]`);if(p?.length){let _=new Map;return p.forEach(r=>{r.textContent!=null&&_.set(r.textContent,r)}),_}return null}changeUsageCount(p,_){let r=this.styleRef;if(r.has(p)){let C=r.get(p);return C.usage+=_,C.usage}return r.set(p,{usage:_,elements:[]}),_}getStyleElement(p,_){let r=this.styleNodesInDOM,C=r?.get(_);if(C?.parentNode===p)return r.delete(_),C.removeAttribute(gT),C;{let A=this.doc.createElement("style");return this.nonce&&A.setAttribute("nonce",this.nonce),A.textContent=_,this.platformIsServer&&A.setAttribute(gT,this.appId),p.appendChild(A),A}}addStyleToHost(p,_){let r=this.getStyleElement(p,_),C=this.styleRef,A=C.get(_)?.elements;A?A.push(r):C.set(_,{elements:[r],usage:1})}resetHostNodes(){let p=this.hostNodes;p.clear(),p.add(this.doc.head)}};a.\u0275fac=function(_){return new(_||a)(xn(Br),xn(Fw),xn(zw,8),xn(ic))},a.\u0275prov=Qt({token:a,factory:a.\u0275fac});let s=a;return s})(),_T={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},wT=/%COMP%/g,rP="%COMP%",VV=`_nghost-${rP}`,jV=`_ngcontent-${rP}`,UV=!0,$V=new vn("",{providedIn:"root",factory:()=>UV});function GV(s){return jV.replace(wT,s)}function HV(s){return VV.replace(wT,s)}function iP(s,a){return a.map(f=>f.replace(wT,s))}var QA=(()=>{let a=class a{constructor(p,_,r,C,A,k,B,Z=null){this.eventManager=p,this.sharedStylesHost=_,this.appId=r,this.removeStylesOnCompDestroy=C,this.doc=A,this.platformId=k,this.ngZone=B,this.nonce=Z,this.rendererByCompId=new Map,this.platformIsServer=z0(k),this.defaultRenderer=new Lm(p,A,B,this.platformIsServer)}createRenderer(p,_){if(!p||!_)return this.defaultRenderer;this.platformIsServer&&_.encapsulation===Ns.ShadowDom&&(_=_r(kt({},_),{encapsulation:Ns.Emulated}));let r=this.getOrCreateRenderer(p,_);return r instanceof q0?r.applyToHost(p):r instanceof Fm&&r.applyStyles(),r}getOrCreateRenderer(p,_){let r=this.rendererByCompId,C=r.get(_.id);if(!C){let A=this.doc,k=this.ngZone,B=this.eventManager,Z=this.sharedStylesHost,he=this.removeStylesOnCompDestroy,xe=this.platformIsServer;switch(_.encapsulation){case Ns.Emulated:C=new q0(B,Z,_,this.appId,he,A,k,xe);break;case Ns.ShadowDom:return new bT(B,Z,p,_,A,k,this.nonce,xe);default:C=new Fm(B,Z,_,he,A,k,xe);break}r.set(_.id,C)}return C}ngOnDestroy(){this.rendererByCompId.clear()}};a.\u0275fac=function(_){return new(_||a)(xn(tP),xn(nP),xn(Fw),xn($V),xn(Br),xn(ic),xn(Sr),xn(zw))},a.\u0275prov=Qt({token:a,factory:a.\u0275fac});let s=a;return s})(),Lm=class{constructor(a,f,p,_){this.eventManager=a,this.doc=f,this.ngZone=p,this.platformIsServer=_,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(a,f){return f?this.doc.createElementNS(_T[f]||f,a):this.doc.createElement(a)}createComment(a){return this.doc.createComment(a)}createText(a){return this.doc.createTextNode(a)}appendChild(a,f){(JA(a)?a.content:a).appendChild(f)}insertBefore(a,f,p){a&&(JA(a)?a.content:a).insertBefore(f,p)}removeChild(a,f){a&&a.removeChild(f)}selectRootElement(a,f){let p=typeof a=="string"?this.doc.querySelector(a):a;if(!p)throw new un(-5104,!1);return f||(p.textContent=""),p}parentNode(a){return a.parentNode}nextSibling(a){return a.nextSibling}setAttribute(a,f,p,_){if(_){f=_+":"+f;let r=_T[_];r?a.setAttributeNS(r,f,p):a.setAttribute(f,p)}else a.setAttribute(f,p)}removeAttribute(a,f,p){if(p){let _=_T[p];_?a.removeAttributeNS(_,f):a.removeAttribute(`${p}:${f}`)}else a.removeAttribute(f)}addClass(a,f){a.classList.add(f)}removeClass(a,f){a.classList.remove(f)}setStyle(a,f,p,_){_&(Bu.DashCase|Bu.Important)?a.style.setProperty(f,p,_&Bu.Important?"important":""):a.style[f]=p}removeStyle(a,f,p){p&Bu.DashCase?a.style.removeProperty(f):a.style[f]=""}setProperty(a,f,p){a!=null&&(a[f]=p)}setValue(a,f){a.nodeValue=f}listen(a,f,p){if(typeof a=="string"&&(a=Xd().getGlobalEventTarget(this.doc,a),!a))throw new Error(`Unsupported event target ${a} for event ${f}`);return this.eventManager.addEventListener(a,f,this.decoratePreventDefault(p))}decoratePreventDefault(a){return f=>{if(f==="__ngUnwrap__")return a;(this.platformIsServer?this.ngZone.runGuarded(()=>a(f)):a(f))===!1&&f.preventDefault()}}};function JA(s){return s.tagName==="TEMPLATE"&&s.content!==void 0}var bT=class extends Lm{constructor(a,f,p,_,r,C,A,k){super(a,r,C,k),this.sharedStylesHost=f,this.hostEl=p,this.shadowRoot=p.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let B=iP(_.id,_.styles);for(let Z of B){let he=document.createElement("style");A&&he.setAttribute("nonce",A),he.textContent=Z,this.shadowRoot.appendChild(he)}}nodeOrShadowRoot(a){return a===this.hostEl?this.shadowRoot:a}appendChild(a,f){return super.appendChild(this.nodeOrShadowRoot(a),f)}insertBefore(a,f,p){return super.insertBefore(this.nodeOrShadowRoot(a),f,p)}removeChild(a,f){return super.removeChild(this.nodeOrShadowRoot(a),f)}parentNode(a){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(a)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Fm=class extends Lm{constructor(a,f,p,_,r,C,A,k){super(a,r,C,A),this.sharedStylesHost=f,this.removeStylesOnCompDestroy=_,this.styles=k?iP(k,p.styles):p.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},q0=class extends Fm{constructor(a,f,p,_,r,C,A,k){let B=_+"-"+p.id;super(a,f,p,r,C,A,k,B),this.contentAttr=GV(B),this.hostAttr=HV(B)}applyToHost(a){this.applyStyles(),this.setAttribute(a,this.hostAttr,"")}createElement(a,f){let p=super.createElement(a,f);return super.setAttribute(p,this.contentAttr,""),p}},qV=(()=>{let a=class a extends H0{constructor(p){super(p)}supports(p){return!0}addEventListener(p,_,r){return p.addEventListener(_,r,!1),()=>this.removeEventListener(p,_,r)}removeEventListener(p,_,r){return p.removeEventListener(_,r)}};a.\u0275fac=function(_){return new(_||a)(xn(Br))},a.\u0275prov=Qt({token:a,factory:a.\u0275fac});let s=a;return s})(),eP=["alt","control","meta","shift"],WV={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},ZV={alt:s=>s.altKey,control:s=>s.ctrlKey,meta:s=>s.metaKey,shift:s=>s.shiftKey},YV=(()=>{let a=class a extends H0{constructor(p){super(p)}supports(p){return a.parseEventName(p)!=null}addEventListener(p,_,r){let C=a.parseEventName(_),A=a.eventCallback(C.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Xd().onAndCancel(p,C.domEventName,A))}static parseEventName(p){let _=p.toLowerCase().split("."),r=_.shift();if(_.length===0||!(r==="keydown"||r==="keyup"))return null;let C=a._normalizeKey(_.pop()),A="",k=_.indexOf("code");if(k>-1&&(_.splice(k,1),A="code."),eP.forEach(Z=>{let he=_.indexOf(Z);he>-1&&(_.splice(he,1),A+=Z+".")}),A+=C,_.length!=0||C.length===0)return null;let B={};return B.domEventName=r,B.fullKey=A,B}static matchEventFullKeyCode(p,_){let r=WV[p.key]||p.key,C="";return _.indexOf("code.")>-1&&(r=p.code,C="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),eP.forEach(A=>{if(A!==r){let k=ZV[A];k(p)&&(C+=A+".")}}),C+=r,C===_)}static eventCallback(p,_,r){return C=>{a.matchEventFullKeyCode(C,p)&&r.runGuarded(()=>_(C))}}static _normalizeKey(p){return p==="esc"?"escape":p}};a.\u0275fac=function(_){return new(_||a)(xn(Br))},a.\u0275prov=Qt({token:a,factory:a.\u0275fac});let s=a;return s})();function oP(s,a){return DA(kt({rootComponent:s},XV(a)))}function XV(s){return{appProviders:[...tj,...s?.providers??[]],platformProviders:ej}}function KV(){vT.makeCurrent()}function QV(){return new Pa}function JV(){return j2(document),document}var ej=[{provide:ic,useValue:VA},{provide:Nw,useValue:KV,multi:!0},{provide:Br,useFactory:JV,deps:[]}];var tj=[{provide:g0,useValue:"root"},{provide:Pa,useFactory:QV,deps:[]},{provide:xT,useClass:qV,multi:!0,deps:[Br,Sr,ic]},{provide:xT,useClass:YV,multi:!0,deps:[Br]},QA,nP,tP,{provide:ym,useExisting:QA},{provide:Kd,useClass:BV,deps:[]},[]];var sP=(()=>{let a=class a{constructor(p){this._doc=p}getTitle(){return this._doc.title}setTitle(p){this._doc.title=p||""}};a.\u0275fac=function(_){return new(_||a)(xn(Br))},a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var Mn="primary",Km=Symbol("RouteTitle"),DT=class{constructor(a){this.params=a||{}}has(a){return Object.prototype.hasOwnProperty.call(this.params,a)}get(a){if(this.has(a)){let f=this.params[a];return Array.isArray(f)?f[0]:f}return null}getAll(a){if(this.has(a)){let f=this.params[a];return Array.isArray(f)?f:[f]}return[]}get keys(){return Object.keys(this.params)}};function rf(s){return new DT(s)}function rj(s,a,f){let p=f.path.split("/");if(p.length>s.length||f.pathMatch==="full"&&(a.hasChildren()||p.length<s.length))return null;let _={};for(let r=0;r<p.length;r++){let C=p[r],A=s[r];if(C.startsWith(":"))_[C.substring(1)]=A;else if(C!==A.path)return null}return{consumed:s.slice(0,p.length),posParams:_}}function ij(s,a){if(s.length!==a.length)return!1;for(let f=0;f<s.length;++f)if(!Us(s[f],a[f]))return!1;return!0}function Us(s,a){let f=s?ST(s):void 0,p=a?ST(a):void 0;if(!f||!p||f.length!=p.length)return!1;let _;for(let r=0;r<f.length;r++)if(_=f[r],!dP(s[_],a[_]))return!1;return!0}function ST(s){return[...Object.keys(s),...Object.getOwnPropertySymbols(s)]}function dP(s,a){if(Array.isArray(s)&&Array.isArray(a)){if(s.length!==a.length)return!1;let f=[...s].sort(),p=[...a].sort();return f.every((_,r)=>p[r]===_)}else return s===a}function fP(s){return s.length>0?s[s.length-1]:null}function cc(s){return xb(s)?s:Sm(s)?Dr(Promise.resolve(s)):on(s)}var oj={exact:mP,subset:gP},pP={exact:sj,subset:aj,ignored:()=>!0};function aP(s,a,f){return oj[f.paths](s.root,a.root,f.matrixParams)&&pP[f.queryParams](s.queryParams,a.queryParams)&&!(f.fragment==="exact"&&s.fragment!==a.fragment)}function sj(s,a){return Us(s,a)}function mP(s,a,f){if(!Hu(s.segments,a.segments)||!Y0(s.segments,a.segments,f)||s.numberOfChildren!==a.numberOfChildren)return!1;for(let p in a.children)if(!s.children[p]||!mP(s.children[p],a.children[p],f))return!1;return!0}function aj(s,a){return Object.keys(a).length<=Object.keys(s).length&&Object.keys(a).every(f=>dP(s[f],a[f]))}function gP(s,a,f){return _P(s,a,a.segments,f)}function _P(s,a,f,p){if(s.segments.length>f.length){let _=s.segments.slice(0,f.length);return!(!Hu(_,f)||a.hasChildren()||!Y0(_,f,p))}else if(s.segments.length===f.length){if(!Hu(s.segments,f)||!Y0(s.segments,f,p))return!1;for(let _ in a.children)if(!s.children[_]||!gP(s.children[_],a.children[_],p))return!1;return!0}else{let _=f.slice(0,s.segments.length),r=f.slice(s.segments.length);return!Hu(s.segments,_)||!Y0(s.segments,_,p)||!s.children[Mn]?!1:_P(s.children[Mn],a,r,p)}}function Y0(s,a,f){return a.every((p,_)=>pP[f](s[_].parameters,p.parameters))}var ac=class{constructor(a=new nr([],{}),f={},p=null){this.root=a,this.queryParams=f,this.fragment=p}get queryParamMap(){return this._queryParamMap??=rf(this.queryParams),this._queryParamMap}toString(){return uj.serialize(this)}},nr=class{constructor(a,f){this.segments=a,this.children=f,this.parent=null,Object.values(f).forEach(p=>p.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return X0(this)}},Gu=class{constructor(a,f){this.path=a,this.parameters=f}get parameterMap(){return this._parameterMap??=rf(this.parameters),this._parameterMap}toString(){return vP(this)}};function lj(s,a){return Hu(s,a)&&s.every((f,p)=>Us(f.parameters,a[p].parameters))}function Hu(s,a){return s.length!==a.length?!1:s.every((f,p)=>f.path===a[p].path)}function cj(s,a){let f=[];return Object.entries(s.children).forEach(([p,_])=>{p===Mn&&(f=f.concat(a(_,p)))}),Object.entries(s.children).forEach(([p,_])=>{p!==Mn&&(f=f.concat(a(_,p)))}),f}var eE=(()=>{let a=class a{};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:()=>new Q0,providedIn:"root"});let s=a;return s})(),Q0=class{parse(a){let f=new AT(a);return new ac(f.parseRootSegment(),f.parseQueryParams(),f.parseFragment())}serialize(a){let f=`/${Nm(a.root,!0)}`,p=fj(a.queryParams),_=typeof a.fragment=="string"?`#${hj(a.fragment)}`:"";return`${f}${p}${_}`}},uj=new Q0;function X0(s){return s.segments.map(a=>vP(a)).join("/")}function Nm(s,a){if(!s.hasChildren())return X0(s);if(a){let f=s.children[Mn]?Nm(s.children[Mn],!1):"",p=[];return Object.entries(s.children).forEach(([_,r])=>{_!==Mn&&p.push(`${_}:${Nm(r,!1)}`)}),p.length>0?`${f}(${p.join("//")})`:f}else{let f=cj(s,(p,_)=>_===Mn?[Nm(s.children[Mn],!1)]:[`${_}:${Nm(p,!1)}`]);return Object.keys(s.children).length===1&&s.children[Mn]!=null?`${X0(s)}/${f[0]}`:`${X0(s)}/(${f.join("//")})`}}function yP(s){return encodeURIComponent(s).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function W0(s){return yP(s).replace(/%3B/gi,";")}function hj(s){return encodeURI(s)}function MT(s){return yP(s).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function K0(s){return decodeURIComponent(s)}function lP(s){return K0(s.replace(/\+/g,"%20"))}function vP(s){return`${MT(s.path)}${dj(s.parameters)}`}function dj(s){return Object.entries(s).map(([a,f])=>`;${MT(a)}=${MT(f)}`).join("")}function fj(s){let a=Object.entries(s).map(([f,p])=>Array.isArray(p)?p.map(_=>`${W0(f)}=${W0(_)}`).join("&"):`${W0(f)}=${W0(p)}`).filter(f=>f);return a.length?`?${a.join("&")}`:""}var pj=/^[^\/()?;#]+/;function TT(s){let a=s.match(pj);return a?a[0]:""}var mj=/^[^\/()?;=#]+/;function gj(s){let a=s.match(mj);return a?a[0]:""}var _j=/^[^=?&#]+/;function yj(s){let a=s.match(_j);return a?a[0]:""}var vj=/^[^&#]+/;function xj(s){let a=s.match(vj);return a?a[0]:""}var AT=class{constructor(a){this.url=a,this.remaining=a}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new nr([],{}):new nr([],this.parseChildren())}parseQueryParams(){let a={};if(this.consumeOptional("?"))do this.parseQueryParam(a);while(this.consumeOptional("&"));return a}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let a=[];for(this.peekStartsWith("(")||a.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),a.push(this.parseSegment());let f={};this.peekStartsWith("/(")&&(this.capture("/"),f=this.parseParens(!0));let p={};return this.peekStartsWith("(")&&(p=this.parseParens(!1)),(a.length>0||Object.keys(f).length>0)&&(p[Mn]=new nr(a,f)),p}parseSegment(){let a=TT(this.remaining);if(a===""&&this.peekStartsWith(";"))throw new un(4009,!1);return this.capture(a),new Gu(K0(a),this.parseMatrixParams())}parseMatrixParams(){let a={};for(;this.consumeOptional(";");)this.parseParam(a);return a}parseParam(a){let f=gj(this.remaining);if(!f)return;this.capture(f);let p="";if(this.consumeOptional("=")){let _=TT(this.remaining);_&&(p=_,this.capture(p))}a[K0(f)]=K0(p)}parseQueryParam(a){let f=yj(this.remaining);if(!f)return;this.capture(f);let p="";if(this.consumeOptional("=")){let C=xj(this.remaining);C&&(p=C,this.capture(p))}let _=lP(f),r=lP(p);if(a.hasOwnProperty(_)){let C=a[_];Array.isArray(C)||(C=[C],a[_]=C),C.push(r)}else a[_]=r}parseParens(a){let f={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let p=TT(this.remaining),_=this.remaining[p.length];if(_!=="/"&&_!==")"&&_!==";")throw new un(4010,!1);let r;p.indexOf(":")>-1?(r=p.slice(0,p.indexOf(":")),this.capture(r),this.capture(":")):a&&(r=Mn);let C=this.parseChildren();f[r]=Object.keys(C).length===1?C[Mn]:new nr([],C),this.consumeOptional("//")}return f}peekStartsWith(a){return this.remaining.startsWith(a)}consumeOptional(a){return this.peekStartsWith(a)?(this.remaining=this.remaining.substring(a.length),!0):!1}capture(a){if(!this.consumeOptional(a))throw new un(4011,!1)}};function xP(s){return s.segments.length>0?new nr([],{[Mn]:s}):s}function bP(s){let a={};for(let[p,_]of Object.entries(s.children)){let r=bP(_);if(p===Mn&&r.segments.length===0&&r.hasChildren())for(let[C,A]of Object.entries(r.children))a[C]=A;else(r.segments.length>0||r.hasChildren())&&(a[p]=r)}let f=new nr(s.segments,a);return bj(f)}function bj(s){if(s.numberOfChildren===1&&s.children[Mn]){let a=s.children[Mn];return new nr(s.segments.concat(a.segments),a.children)}return s}function of(s){return s instanceof ac}function wj(s,a,f=null,p=null){let _=wP(s);return TP(_,a,f,p)}function wP(s){let a;function f(r){let C={};for(let k of r.children){let B=f(k);C[k.outlet]=B}let A=new nr(r.url,C);return r===s&&(a=A),A}let p=f(s.root),_=xP(p);return a??_}function TP(s,a,f,p){let _=s;for(;_.parent;)_=_.parent;if(a.length===0)return ET(_,_,_,f,p);let r=Tj(a);if(r.toRoot())return ET(_,_,new nr([],{}),f,p);let C=Ej(r,_,s),A=C.processChildren?Vm(C.segmentGroup,C.index,r.commands):IP(C.segmentGroup,C.index,r.commands);return ET(_,C.segmentGroup,A,f,p)}function J0(s){return typeof s=="object"&&s!=null&&!s.outlets&&!s.segmentPath}function $m(s){return typeof s=="object"&&s!=null&&s.outlets}function ET(s,a,f,p,_){let r={};p&&Object.entries(p).forEach(([k,B])=>{r[k]=Array.isArray(B)?B.map(Z=>`${Z}`):`${B}`});let C;s===a?C=f:C=EP(s,a,f);let A=xP(bP(C));return new ac(A,r,_)}function EP(s,a,f){let p={};return Object.entries(s.children).forEach(([_,r])=>{r===a?p[_]=f:p[_]=EP(r,a,f)}),new nr(s.segments,p)}var ev=class{constructor(a,f,p){if(this.isAbsolute=a,this.numberOfDoubleDots=f,this.commands=p,a&&p.length>0&&J0(p[0]))throw new un(4003,!1);let _=p.find($m);if(_&&_!==fP(p))throw new un(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function Tj(s){if(typeof s[0]=="string"&&s.length===1&&s[0]==="/")return new ev(!0,0,s);let a=0,f=!1,p=s.reduce((_,r,C)=>{if(typeof r=="object"&&r!=null){if(r.outlets){let A={};return Object.entries(r.outlets).forEach(([k,B])=>{A[k]=typeof B=="string"?B.split("/"):B}),[..._,{outlets:A}]}if(r.segmentPath)return[..._,r.segmentPath]}return typeof r!="string"?[..._,r]:C===0?(r.split("/").forEach((A,k)=>{k==0&&A==="."||(k==0&&A===""?f=!0:A===".."?a++:A!=""&&_.push(A))}),_):[..._,r]},[]);return new ev(f,a,p)}var tf=class{constructor(a,f,p){this.segmentGroup=a,this.processChildren=f,this.index=p}};function Ej(s,a,f){if(s.isAbsolute)return new tf(a,!0,0);if(!f)return new tf(a,!1,NaN);if(f.parent===null)return new tf(f,!0,0);let p=J0(s.commands[0])?0:1,_=f.segments.length-1+p;return Ij(f,_,s.numberOfDoubleDots)}function Ij(s,a,f){let p=s,_=a,r=f;for(;r>_;){if(r-=_,p=p.parent,!p)throw new un(4005,!1);_=p.segments.length}return new tf(p,!1,_-r)}function Cj(s){return $m(s[0])?s[0].outlets:{[Mn]:s}}function IP(s,a,f){if(s??=new nr([],{}),s.segments.length===0&&s.hasChildren())return Vm(s,a,f);let p=Dj(s,a,f),_=f.slice(p.commandIndex);if(p.match&&p.pathIndex<s.segments.length){let r=new nr(s.segments.slice(0,p.pathIndex),{});return r.children[Mn]=new nr(s.segments.slice(p.pathIndex),s.children),Vm(r,0,_)}else return p.match&&_.length===0?new nr(s.segments,{}):p.match&&!s.hasChildren()?PT(s,a,f):p.match?Vm(s,0,_):PT(s,a,f)}function Vm(s,a,f){if(f.length===0)return new nr(s.segments,{});{let p=Cj(f),_={};if(Object.keys(p).some(r=>r!==Mn)&&s.children[Mn]&&s.numberOfChildren===1&&s.children[Mn].segments.length===0){let r=Vm(s.children[Mn],a,f);return new nr(s.segments,r.children)}return Object.entries(p).forEach(([r,C])=>{typeof C=="string"&&(C=[C]),C!==null&&(_[r]=IP(s.children[r],a,C))}),Object.entries(s.children).forEach(([r,C])=>{p[r]===void 0&&(_[r]=C)}),new nr(s.segments,_)}}function Dj(s,a,f){let p=0,_=a,r={match:!1,pathIndex:0,commandIndex:0};for(;_<s.segments.length;){if(p>=f.length)return r;let C=s.segments[_],A=f[p];if($m(A))break;let k=`${A}`,B=p<f.length-1?f[p+1]:null;if(_>0&&k===void 0)break;if(k&&B&&typeof B=="object"&&B.outlets===void 0){if(!uP(k,B,C))return r;p+=2}else{if(!uP(k,{},C))return r;p++}_++}return{match:!0,pathIndex:_,commandIndex:p}}function PT(s,a,f){let p=s.segments.slice(0,a),_=0;for(;_<f.length;){let r=f[_];if($m(r)){let k=Sj(r.outlets);return new nr(p,k)}if(_===0&&J0(f[0])){let k=s.segments[a];p.push(new Gu(k.path,cP(f[0]))),_++;continue}let C=$m(r)?r.outlets[Mn]:`${r}`,A=_<f.length-1?f[_+1]:null;C&&A&&J0(A)?(p.push(new Gu(C,cP(A))),_+=2):(p.push(new Gu(C,{})),_++)}return new nr(p,{})}function Sj(s){let a={};return Object.entries(s).forEach(([f,p])=>{typeof p=="string"&&(p=[p]),p!==null&&(a[f]=PT(new nr([],{}),0,p))}),a}function cP(s){let a={};return Object.entries(s).forEach(([f,p])=>a[f]=`${p}`),a}function uP(s,a,f){return s==f.path&&Us(a,f.parameters)}var jm="imperative",mi=function(s){return s[s.NavigationStart=0]="NavigationStart",s[s.NavigationEnd=1]="NavigationEnd",s[s.NavigationCancel=2]="NavigationCancel",s[s.NavigationError=3]="NavigationError",s[s.RoutesRecognized=4]="RoutesRecognized",s[s.ResolveStart=5]="ResolveStart",s[s.ResolveEnd=6]="ResolveEnd",s[s.GuardsCheckStart=7]="GuardsCheckStart",s[s.GuardsCheckEnd=8]="GuardsCheckEnd",s[s.RouteConfigLoadStart=9]="RouteConfigLoadStart",s[s.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",s[s.ChildActivationStart=11]="ChildActivationStart",s[s.ChildActivationEnd=12]="ChildActivationEnd",s[s.ActivationStart=13]="ActivationStart",s[s.ActivationEnd=14]="ActivationEnd",s[s.Scroll=15]="Scroll",s[s.NavigationSkipped=16]="NavigationSkipped",s}(mi||{}),Ro=class{constructor(a,f){this.id=a,this.url=f}},Gm=class extends Ro{constructor(a,f,p="imperative",_=null){super(a,f),this.type=mi.NavigationStart,this.navigationTrigger=p,this.restoredState=_}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},qu=class extends Ro{constructor(a,f,p){super(a,f),this.urlAfterRedirects=p,this.type=mi.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},po=function(s){return s[s.Redirect=0]="Redirect",s[s.SupersededByNewNavigation=1]="SupersededByNewNavigation",s[s.NoDataFromResolver=2]="NoDataFromResolver",s[s.GuardRejected=3]="GuardRejected",s}(po||{}),RT=function(s){return s[s.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",s[s.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",s}(RT||{}),lc=class extends Ro{constructor(a,f,p,_){super(a,f),this.reason=p,this.code=_,this.type=mi.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Wu=class extends Ro{constructor(a,f,p,_){super(a,f),this.reason=p,this.code=_,this.type=mi.NavigationSkipped}},Hm=class extends Ro{constructor(a,f,p,_){super(a,f),this.error=p,this.target=_,this.type=mi.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},tv=class extends Ro{constructor(a,f,p,_){super(a,f),this.urlAfterRedirects=p,this.state=_,this.type=mi.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},OT=class extends Ro{constructor(a,f,p,_){super(a,f),this.urlAfterRedirects=p,this.state=_,this.type=mi.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},kT=class extends Ro{constructor(a,f,p,_,r){super(a,f),this.urlAfterRedirects=p,this.state=_,this.shouldActivate=r,this.type=mi.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},LT=class extends Ro{constructor(a,f,p,_){super(a,f),this.urlAfterRedirects=p,this.state=_,this.type=mi.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},FT=class extends Ro{constructor(a,f,p,_){super(a,f),this.urlAfterRedirects=p,this.state=_,this.type=mi.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},NT=class{constructor(a){this.route=a,this.type=mi.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},zT=class{constructor(a){this.route=a,this.type=mi.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},BT=class{constructor(a){this.snapshot=a,this.type=mi.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},VT=class{constructor(a){this.snapshot=a,this.type=mi.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},jT=class{constructor(a){this.snapshot=a,this.type=mi.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},UT=class{constructor(a){this.snapshot=a,this.type=mi.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var qm=class{},Wm=class{constructor(a){this.url=a}};var $T=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new av,this.attachRef=null}},av=(()=>{let a=class a{constructor(){this.contexts=new Map}onChildOutletCreated(p,_){let r=this.getOrCreateContext(p);r.outlet=_,this.contexts.set(p,r)}onChildOutletDestroyed(p){let _=this.getContext(p);_&&(_.outlet=null,_.attachRef=null)}onOutletDeactivated(){let p=this.contexts;return this.contexts=new Map,p}onOutletReAttached(p){this.contexts=p}getOrCreateContext(p){let _=this.getContext(p);return _||(_=new $T,this.contexts.set(p,_)),_}getContext(p){return this.contexts.get(p)||null}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),nv=class{constructor(a){this._root=a}get root(){return this._root.value}parent(a){let f=this.pathFromRoot(a);return f.length>1?f[f.length-2]:null}children(a){let f=GT(a,this._root);return f?f.children.map(p=>p.value):[]}firstChild(a){let f=GT(a,this._root);return f&&f.children.length>0?f.children[0].value:null}siblings(a){let f=HT(a,this._root);return f.length<2?[]:f[f.length-2].children.map(_=>_.value).filter(_=>_!==a)}pathFromRoot(a){return HT(a,this._root).map(f=>f.value)}};function GT(s,a){if(s===a.value)return a;for(let f of a.children){let p=GT(s,f);if(p)return p}return null}function HT(s,a){if(s===a.value)return[a];for(let f of a.children){let p=HT(s,f);if(p.length)return p.unshift(a),p}return[]}var fo=class{constructor(a,f){this.value=a,this.children=f}toString(){return`TreeNode(${this.value})`}};function ef(s){let a={};return s&&s.children.forEach(f=>a[f.value.outlet]=f),a}var rv=class extends nv{constructor(a,f){super(a),this.snapshot=f,nE(this,a)}toString(){return this.snapshot.toString()}};function CP(s){let a=Mj(s),f=new pi([new Gu("",{})]),p=new pi({}),_=new pi({}),r=new pi({}),C=new pi(""),A=new sf(f,p,r,C,_,Mn,s,a.root);return A.snapshot=a.root,new rv(new fo(A,[]),a)}function Mj(s){let a={},f={},p={},_="",r=new Zm([],a,p,_,f,Mn,s,null,{});return new iv("",new fo(r,[]))}var sf=class{constructor(a,f,p,_,r,C,A,k){this.urlSubject=a,this.paramsSubject=f,this.queryParamsSubject=p,this.fragmentSubject=_,this.dataSubject=r,this.outlet=C,this.component=A,this._futureSnapshot=k,this.title=this.dataSubject?.pipe(Sn(B=>B[Km]))??on(void 0),this.url=a,this.params=f,this.queryParams=p,this.fragment=_,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Sn(a=>rf(a))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Sn(a=>rf(a))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function tE(s,a,f="emptyOnly"){let p,{routeConfig:_}=s;return a!==null&&(f==="always"||_?.path===""||!a.component&&!a.routeConfig?.loadComponent)?p={params:kt(kt({},a.params),s.params),data:kt(kt({},a.data),s.data),resolve:kt(kt(kt(kt({},s.data),a.data),_?.data),s._resolvedData)}:p={params:kt({},s.params),data:kt({},s.data),resolve:kt(kt({},s.data),s._resolvedData??{})},_&&SP(_)&&(p.resolve[Km]=_.title),p}var Zm=class{get title(){return this.data?.[Km]}constructor(a,f,p,_,r,C,A,k,B){this.url=a,this.params=f,this.queryParams=p,this.fragment=_,this.data=r,this.outlet=C,this.component=A,this.routeConfig=k,this._resolve=B}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=rf(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=rf(this.queryParams),this._queryParamMap}toString(){let a=this.url.map(p=>p.toString()).join("/"),f=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${a}', path:'${f}')`}},iv=class extends nv{constructor(a,f){super(f),this.url=a,nE(this,f)}toString(){return DP(this._root)}};function nE(s,a){a.value._routerState=s,a.children.forEach(f=>nE(s,f))}function DP(s){let a=s.children.length>0?` { ${s.children.map(DP).join(", ")} } `:"";return`${s.value}${a}`}function IT(s){if(s.snapshot){let a=s.snapshot,f=s._futureSnapshot;s.snapshot=f,Us(a.queryParams,f.queryParams)||s.queryParamsSubject.next(f.queryParams),a.fragment!==f.fragment&&s.fragmentSubject.next(f.fragment),Us(a.params,f.params)||s.paramsSubject.next(f.params),ij(a.url,f.url)||s.urlSubject.next(f.url),Us(a.data,f.data)||s.dataSubject.next(f.data)}else s.snapshot=s._futureSnapshot,s.dataSubject.next(s._futureSnapshot.data)}function qT(s,a){let f=Us(s.params,a.params)&&lj(s.url,a.url),p=!s.parent!=!a.parent;return f&&!p&&(!s.parent||qT(s.parent,a.parent))}function SP(s){return typeof s.title=="string"||s.title===null}var rE=(()=>{let a=class a{constructor(){this.activated=null,this._activatedRoute=null,this.name=Mn,this.activateEvents=new es,this.deactivateEvents=new es,this.attachEvents=new es,this.detachEvents=new es,this.parentContexts=It(av),this.location=It(Cm),this.changeDetector=It(Mm),this.environmentInjector=It(Hi),this.inputBinder=It(iE,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(p){if(p.name){let{firstChange:_,previousValue:r}=p.name;if(_)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(p){return this.parentContexts.getContext(p)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let p=this.parentContexts.getContext(this.name);p?.route&&(p.attachRef?this.attach(p.attachRef,p.route):this.activateWith(p.route,p.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new un(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new un(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new un(4012,!1);this.location.detach();let p=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(p.instance),p}attach(p,_){this.activated=p,this._activatedRoute=_,this.location.insert(p.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(p.instance)}deactivate(){if(this.activated){let p=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(p)}}activateWith(p,_){if(this.isActivated)throw new un(4013,!1);this._activatedRoute=p;let r=this.location,A=p.snapshot.component,k=this.parentContexts.getOrCreateContext(this.name).children,B=new WT(p,k,r.injector);this.activated=r.createComponent(A,{index:r.length,injector:B,environmentInjector:_??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};a.\u0275fac=function(_){return new(_||a)},a.\u0275dir=wm({type:a,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[b0]});let s=a;return s})(),WT=class s{__ngOutletInjector(a){return new s(this.route,this.childContexts,a)}constructor(a,f,p){this.route=a,this.childContexts=f,this.parent=p}get(a,f){return a===sf?this.route:a===av?this.childContexts:this.parent.get(a,f)}},iE=new vn("");function Aj(s,a,f){let p=Ym(s,a._root,f?f._root:void 0);return new rv(p,a)}function Ym(s,a,f){if(f&&s.shouldReuseRoute(a.value,f.value.snapshot)){let p=f.value;p._futureSnapshot=a.value;let _=Pj(s,a,f);return new fo(p,_)}else{if(s.shouldAttach(a.value)){let r=s.retrieve(a.value);if(r!==null){let C=r.route;return C.value._futureSnapshot=a.value,C.children=a.children.map(A=>Ym(s,A)),C}}let p=Rj(a.value),_=a.children.map(r=>Ym(s,r));return new fo(p,_)}}function Pj(s,a,f){return a.children.map(p=>{for(let _ of f.children)if(s.shouldReuseRoute(p.value,_.value.snapshot))return Ym(s,p,_);return Ym(s,p)})}function Rj(s){return new sf(new pi(s.url),new pi(s.params),new pi(s.queryParams),new pi(s.fragment),new pi(s.data),s.outlet,s.component,s)}var MP="ngNavigationCancelingError";function AP(s,a){let{redirectTo:f,navigationBehaviorOptions:p}=of(a)?{redirectTo:a,navigationBehaviorOptions:void 0}:a,_=PP(!1,po.Redirect);return _.url=f,_.navigationBehaviorOptions=p,_}function PP(s,a){let f=new Error(`NavigationCancelingError: ${s||""}`);return f[MP]=!0,f.cancellationCode=a,f}function Oj(s){return RP(s)&&of(s.url)}function RP(s){return!!s&&s[MP]}var kj=(()=>{let a=class a{};a.\u0275fac=function(_){return new(_||a)},a.\u0275cmp=Ra({type:a,selectors:[["ng-component"]],standalone:!0,features:[Fa],decls:1,vars:0,template:function(_,r){_&1&&Mr(0,"router-outlet")},dependencies:[rE],encapsulation:2});let s=a;return s})();function Lj(s,a){return s.providers&&!s._injector&&(s._injector=eT(s.providers,a,`Route: ${s.path}`)),s._injector??a}function oE(s){let a=s.children&&s.children.map(oE),f=a?_r(kt({},s),{children:a}):kt({},s);return!f.component&&!f.loadComponent&&(a||f.loadChildren)&&f.outlet&&f.outlet!==Mn&&(f.component=kj),f}function $s(s){return s.outlet||Mn}function Fj(s,a){let f=s.filter(p=>$s(p)===a);return f.push(...s.filter(p=>$s(p)!==a)),f}function Qm(s){if(!s)return null;if(s.routeConfig?._injector)return s.routeConfig._injector;for(let a=s.parent;a;a=a.parent){let f=a.routeConfig;if(f?._loadedInjector)return f._loadedInjector;if(f?._injector)return f._injector}return null}var Nj=(s,a,f,p)=>Sn(_=>(new ZT(a,_.targetRouterState,_.currentRouterState,f,p).activate(s),_)),ZT=class{constructor(a,f,p,_,r){this.routeReuseStrategy=a,this.futureState=f,this.currState=p,this.forwardEvent=_,this.inputBindingEnabled=r}activate(a){let f=this.futureState._root,p=this.currState?this.currState._root:null;this.deactivateChildRoutes(f,p,a),IT(this.futureState.root),this.activateChildRoutes(f,p,a)}deactivateChildRoutes(a,f,p){let _=ef(f);a.children.forEach(r=>{let C=r.value.outlet;this.deactivateRoutes(r,_[C],p),delete _[C]}),Object.values(_).forEach(r=>{this.deactivateRouteAndItsChildren(r,p)})}deactivateRoutes(a,f,p){let _=a.value,r=f?f.value:null;if(_===r)if(_.component){let C=p.getContext(_.outlet);C&&this.deactivateChildRoutes(a,f,C.children)}else this.deactivateChildRoutes(a,f,p);else r&&this.deactivateRouteAndItsChildren(f,p)}deactivateRouteAndItsChildren(a,f){a.value.component&&this.routeReuseStrategy.shouldDetach(a.value.snapshot)?this.detachAndStoreRouteSubtree(a,f):this.deactivateRouteAndOutlet(a,f)}detachAndStoreRouteSubtree(a,f){let p=f.getContext(a.value.outlet),_=p&&a.value.component?p.children:f,r=ef(a);for(let C of Object.values(r))this.deactivateRouteAndItsChildren(C,_);if(p&&p.outlet){let C=p.outlet.detach(),A=p.children.onOutletDeactivated();this.routeReuseStrategy.store(a.value.snapshot,{componentRef:C,route:a,contexts:A})}}deactivateRouteAndOutlet(a,f){let p=f.getContext(a.value.outlet),_=p&&a.value.component?p.children:f,r=ef(a);for(let C of Object.values(r))this.deactivateRouteAndItsChildren(C,_);p&&(p.outlet&&(p.outlet.deactivate(),p.children.onOutletDeactivated()),p.attachRef=null,p.route=null)}activateChildRoutes(a,f,p){let _=ef(f);a.children.forEach(r=>{this.activateRoutes(r,_[r.value.outlet],p),this.forwardEvent(new UT(r.value.snapshot))}),a.children.length&&this.forwardEvent(new VT(a.value.snapshot))}activateRoutes(a,f,p){let _=a.value,r=f?f.value:null;if(IT(_),_===r)if(_.component){let C=p.getOrCreateContext(_.outlet);this.activateChildRoutes(a,f,C.children)}else this.activateChildRoutes(a,f,p);else if(_.component){let C=p.getOrCreateContext(_.outlet);if(this.routeReuseStrategy.shouldAttach(_.snapshot)){let A=this.routeReuseStrategy.retrieve(_.snapshot);this.routeReuseStrategy.store(_.snapshot,null),C.children.onOutletReAttached(A.contexts),C.attachRef=A.componentRef,C.route=A.route.value,C.outlet&&C.outlet.attach(A.componentRef,A.route.value),IT(A.route.value),this.activateChildRoutes(a,null,C.children)}else{let A=Qm(_.snapshot);C.attachRef=null,C.route=_,C.injector=A,C.outlet&&C.outlet.activateWith(_,C.injector),this.activateChildRoutes(a,null,C.children)}}else this.activateChildRoutes(a,null,p)}},ov=class{constructor(a){this.path=a,this.route=this.path[this.path.length-1]}},nf=class{constructor(a,f){this.component=a,this.route=f}};function zj(s,a,f){let p=s._root,_=a?a._root:null;return zm(p,_,f,[p.value])}function Bj(s){let a=s.routeConfig?s.routeConfig.canActivateChild:null;return!a||a.length===0?null:{node:s,guards:a}}function lf(s,a){let f=Symbol(),p=a.get(s,f);return p===f?typeof s=="function"&&!LM(s)?s:a.get(s):p}function zm(s,a,f,p,_={canDeactivateChecks:[],canActivateChecks:[]}){let r=ef(a);return s.children.forEach(C=>{Vj(C,r[C.value.outlet],f,p.concat([C.value]),_),delete r[C.value.outlet]}),Object.entries(r).forEach(([C,A])=>Um(A,f.getContext(C),_)),_}function Vj(s,a,f,p,_={canDeactivateChecks:[],canActivateChecks:[]}){let r=s.value,C=a?a.value:null,A=f?f.getContext(s.value.outlet):null;if(C&&r.routeConfig===C.routeConfig){let k=jj(C,r,r.routeConfig.runGuardsAndResolvers);k?_.canActivateChecks.push(new ov(p)):(r.data=C.data,r._resolvedData=C._resolvedData),r.component?zm(s,a,A?A.children:null,p,_):zm(s,a,f,p,_),k&&A&&A.outlet&&A.outlet.isActivated&&_.canDeactivateChecks.push(new nf(A.outlet.component,C))}else C&&Um(a,A,_),_.canActivateChecks.push(new ov(p)),r.component?zm(s,null,A?A.children:null,p,_):zm(s,null,f,p,_);return _}function jj(s,a,f){if(typeof f=="function")return f(s,a);switch(f){case"pathParamsChange":return!Hu(s.url,a.url);case"pathParamsOrQueryParamsChange":return!Hu(s.url,a.url)||!Us(s.queryParams,a.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!qT(s,a)||!Us(s.queryParams,a.queryParams);case"paramsChange":default:return!qT(s,a)}}function Um(s,a,f){let p=ef(s),_=s.value;Object.entries(p).forEach(([r,C])=>{_.component?a?Um(C,a.children.getContext(r),f):Um(C,null,f):Um(C,a,f)}),_.component?a&&a.outlet&&a.outlet.isActivated?f.canDeactivateChecks.push(new nf(a.outlet.component,_)):f.canDeactivateChecks.push(new nf(null,_)):f.canDeactivateChecks.push(new nf(null,_))}function Jm(s){return typeof s=="function"}function Uj(s){return typeof s=="boolean"}function $j(s){return s&&Jm(s.canLoad)}function Gj(s){return s&&Jm(s.canActivate)}function Hj(s){return s&&Jm(s.canActivateChild)}function qj(s){return s&&Jm(s.canDeactivate)}function Wj(s){return s&&Jm(s.canMatch)}function OP(s){return s instanceof Sa||s?.name==="EmptyError"}var Z0=Symbol("INITIAL_VALUE");function af(){return co(s=>Vy(s.map(a=>a.pipe(Ma(1),Db(Z0)))).pipe(Sn(a=>{for(let f of a)if(f!==!0){if(f===Z0)return Z0;if(f===!1||f instanceof ac)return f}return!0}),lo(a=>a!==Z0),Ma(1)))}function Zj(s,a){return ei(f=>{let{targetSnapshot:p,currentSnapshot:_,guards:{canActivateChecks:r,canDeactivateChecks:C}}=f;return C.length===0&&r.length===0?on(_r(kt({},f),{guardsResult:!0})):Yj(C,p,_,s).pipe(ei(A=>A&&Uj(A)?Xj(p,r,s,a):on(A)),Sn(A=>_r(kt({},f),{guardsResult:A})))})}function Yj(s,a,f,p){return Dr(s).pipe(ei(_=>tU(_.component,_.route,f,a,p)),Os(_=>_!==!0,!0))}function Xj(s,a,f,p){return Dr(a).pipe(Xl(_=>Pd(Qj(_.route.parent,p),Kj(_.route,p),eU(s,_.path,f),Jj(s,_.route,f))),Os(_=>_!==!0,!0))}function Kj(s,a){return s!==null&&a&&a(new jT(s)),on(!0)}function Qj(s,a){return s!==null&&a&&a(new BT(s)),on(!0)}function Jj(s,a,f){let p=a.routeConfig?a.routeConfig.canActivate:null;if(!p||p.length===0)return on(!0);let _=p.map(r=>jy(()=>{let C=Qm(a)??f,A=lf(r,C),k=Gj(A)?A.canActivate(a,s):Oa(C,()=>A(a,s));return cc(k).pipe(Os())}));return on(_).pipe(af())}function eU(s,a,f){let p=a[a.length-1],r=a.slice(0,a.length-1).reverse().map(C=>Bj(C)).filter(C=>C!==null).map(C=>jy(()=>{let A=C.guards.map(k=>{let B=Qm(C.node)??f,Z=lf(k,B),he=Hj(Z)?Z.canActivateChild(p,s):Oa(B,()=>Z(p,s));return cc(he).pipe(Os())});return on(A).pipe(af())}));return on(r).pipe(af())}function tU(s,a,f,p,_){let r=a&&a.routeConfig?a.routeConfig.canDeactivate:null;if(!r||r.length===0)return on(!0);let C=r.map(A=>{let k=Qm(a)??_,B=lf(A,k),Z=qj(B)?B.canDeactivate(s,a,f,p):Oa(k,()=>B(s,a,f,p));return cc(Z).pipe(Os())});return on(C).pipe(af())}function nU(s,a,f,p){let _=a.canLoad;if(_===void 0||_.length===0)return on(!0);let r=_.map(C=>{let A=lf(C,s),k=$j(A)?A.canLoad(a,f):Oa(s,()=>A(a,f));return cc(k)});return on(r).pipe(af(),kP(p))}function kP(s){return gb(Nr(a=>{if(of(a))throw AP(s,a)}),Sn(a=>a===!0))}function rU(s,a,f,p){let _=a.canMatch;if(!_||_.length===0)return on(!0);let r=_.map(C=>{let A=lf(C,s),k=Wj(A)?A.canMatch(a,f):Oa(s,()=>A(a,f));return cc(k)});return on(r).pipe(af(),kP(p))}var Xm=class{constructor(a){this.segmentGroup=a||null}},sv=class extends Error{constructor(a){super(),this.urlTree=a}};function Jd(s){return Da(new Xm(s))}function iU(s){return Da(new un(4e3,!1))}function oU(s){return Da(PP(!1,po.GuardRejected))}var YT=class{constructor(a,f){this.urlSerializer=a,this.urlTree=f}lineralizeSegments(a,f){let p=[],_=f.root;for(;;){if(p=p.concat(_.segments),_.numberOfChildren===0)return on(p);if(_.numberOfChildren>1||!_.children[Mn])return iU(a.redirectTo);_=_.children[Mn]}}applyRedirectCommands(a,f,p){let _=this.applyRedirectCreateUrlTree(f,this.urlSerializer.parse(f),a,p);if(f.startsWith("/"))throw new sv(_);return _}applyRedirectCreateUrlTree(a,f,p,_){let r=this.createSegmentGroup(a,f.root,p,_);return new ac(r,this.createQueryParams(f.queryParams,this.urlTree.queryParams),f.fragment)}createQueryParams(a,f){let p={};return Object.entries(a).forEach(([_,r])=>{if(typeof r=="string"&&r.startsWith(":")){let A=r.substring(1);p[_]=f[A]}else p[_]=r}),p}createSegmentGroup(a,f,p,_){let r=this.createSegments(a,f.segments,p,_),C={};return Object.entries(f.children).forEach(([A,k])=>{C[A]=this.createSegmentGroup(a,k,p,_)}),new nr(r,C)}createSegments(a,f,p,_){return f.map(r=>r.path.startsWith(":")?this.findPosParam(a,r,_):this.findOrReturn(r,p))}findPosParam(a,f,p){let _=p[f.path.substring(1)];if(!_)throw new un(4001,!1);return _}findOrReturn(a,f){let p=0;for(let _ of f){if(_.path===a.path)return f.splice(p),_;p++}return a}},XT={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function sU(s,a,f,p,_){let r=sE(s,a,f);return r.matched?(p=Lj(a,p),rU(p,a,f,_).pipe(Sn(C=>C===!0?r:kt({},XT)))):on(r)}function sE(s,a,f){if(a.path==="**")return aU(f);if(a.path==="")return a.pathMatch==="full"&&(s.hasChildren()||f.length>0)?kt({},XT):{matched:!0,consumedSegments:[],remainingSegments:f,parameters:{},positionalParamSegments:{}};let _=(a.matcher||rj)(f,s,a);if(!_)return kt({},XT);let r={};Object.entries(_.posParams??{}).forEach(([A,k])=>{r[A]=k.path});let C=_.consumed.length>0?kt(kt({},r),_.consumed[_.consumed.length-1].parameters):r;return{matched:!0,consumedSegments:_.consumed,remainingSegments:f.slice(_.consumed.length),parameters:C,positionalParamSegments:_.posParams??{}}}function aU(s){return{matched:!0,parameters:s.length>0?fP(s).parameters:{},consumedSegments:s,remainingSegments:[],positionalParamSegments:{}}}function hP(s,a,f,p){return f.length>0&&uU(s,f,p)?{segmentGroup:new nr(a,cU(p,new nr(f,s.children))),slicedSegments:[]}:f.length===0&&hU(s,f,p)?{segmentGroup:new nr(s.segments,lU(s,f,p,s.children)),slicedSegments:f}:{segmentGroup:new nr(s.segments,s.children),slicedSegments:f}}function lU(s,a,f,p){let _={};for(let r of f)if(lv(s,a,r)&&!p[$s(r)]){let C=new nr([],{});_[$s(r)]=C}return kt(kt({},p),_)}function cU(s,a){let f={};f[Mn]=a;for(let p of s)if(p.path===""&&$s(p)!==Mn){let _=new nr([],{});f[$s(p)]=_}return f}function uU(s,a,f){return f.some(p=>lv(s,a,p)&&$s(p)!==Mn)}function hU(s,a,f){return f.some(p=>lv(s,a,p))}function lv(s,a,f){return(s.hasChildren()||a.length>0)&&f.pathMatch==="full"?!1:f.path===""}function dU(s,a,f,p){return $s(s)!==p&&(p===Mn||!lv(a,f,s))?!1:sE(a,s,f).matched}function fU(s,a,f){return a.length===0&&!s.children[f]}var KT=class{};function pU(s,a,f,p,_,r,C="emptyOnly"){return new QT(s,a,f,p,_,C,r).recognize()}var mU=31,QT=class{constructor(a,f,p,_,r,C,A){this.injector=a,this.configLoader=f,this.rootComponentType=p,this.config=_,this.urlTree=r,this.paramsInheritanceStrategy=C,this.urlSerializer=A,this.applyRedirects=new YT(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(a){return new un(4002,`'${a.segmentGroup}'`)}recognize(){let a=hP(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(a).pipe(Sn(f=>{let p=new Zm([],Object.freeze({}),Object.freeze(kt({},this.urlTree.queryParams)),this.urlTree.fragment,{},Mn,this.rootComponentType,null,{}),_=new fo(p,f),r=new iv("",_),C=wj(p,[],this.urlTree.queryParams,this.urlTree.fragment);return C.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(C),this.inheritParamsAndData(r._root,null),{state:r,tree:C}}))}match(a){return this.processSegmentGroup(this.injector,this.config,a,Mn).pipe(Ps(p=>{if(p instanceof sv)return this.urlTree=p.urlTree,this.match(p.urlTree.root);throw p instanceof Xm?this.noMatchError(p):p}))}inheritParamsAndData(a,f){let p=a.value,_=tE(p,f,this.paramsInheritanceStrategy);p.params=Object.freeze(_.params),p.data=Object.freeze(_.data),a.children.forEach(r=>this.inheritParamsAndData(r,p))}processSegmentGroup(a,f,p,_){return p.segments.length===0&&p.hasChildren()?this.processChildren(a,f,p):this.processSegment(a,f,p,p.segments,_,!0).pipe(Sn(r=>r instanceof fo?[r]:[]))}processChildren(a,f,p){let _=[];for(let r of Object.keys(p.children))r==="primary"?_.unshift(r):_.push(r);return Dr(_).pipe(Xl(r=>{let C=p.children[r],A=Fj(f,r);return this.processSegmentGroup(a,A,C,r)}),Eb((r,C)=>(r.push(...C),r)),Kl(null),Tb(),ei(r=>{if(r===null)return Jd(p);let C=LP(r);return gU(C),on(C)}))}processSegment(a,f,p,_,r,C){return Dr(f).pipe(Xl(A=>this.processSegmentAgainstRoute(A._injector??a,f,A,p,_,r,C).pipe(Ps(k=>{if(k instanceof Xm)return on(null);throw k}))),Os(A=>!!A),Ps(A=>{if(OP(A))return fU(p,_,r)?on(new KT):Jd(p);throw A}))}processSegmentAgainstRoute(a,f,p,_,r,C,A){return dU(p,_,r,C)?p.redirectTo===void 0?this.matchSegmentAgainstRoute(a,_,p,r,C):this.allowRedirects&&A?this.expandSegmentAgainstRouteUsingRedirect(a,_,f,p,r,C):Jd(_):Jd(_)}expandSegmentAgainstRouteUsingRedirect(a,f,p,_,r,C){let{matched:A,consumedSegments:k,positionalParamSegments:B,remainingSegments:Z}=sE(f,_,r);if(!A)return Jd(f);_.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>mU&&(this.allowRedirects=!1));let he=this.applyRedirects.applyRedirectCommands(k,_.redirectTo,B);return this.applyRedirects.lineralizeSegments(_,he).pipe(ei(xe=>this.processSegment(a,p,f,xe.concat(Z),C,!1)))}matchSegmentAgainstRoute(a,f,p,_,r){let C=sU(f,p,_,a,this.urlSerializer);return p.path==="**"&&(f.children={}),C.pipe(co(A=>A.matched?(a=p._injector??a,this.getChildConfig(a,p,_).pipe(co(({routes:k})=>{let B=p._loadedInjector??a,{consumedSegments:Z,remainingSegments:he,parameters:xe}=A,_e=new Zm(Z,xe,Object.freeze(kt({},this.urlTree.queryParams)),this.urlTree.fragment,yU(p),$s(p),p.component??p._loadedComponent??null,p,vU(p)),{segmentGroup:Je,slicedSegments:Ge}=hP(f,Z,he,k);if(Ge.length===0&&Je.hasChildren())return this.processChildren(B,k,Je).pipe(Sn(We=>We===null?null:new fo(_e,We)));if(k.length===0&&Ge.length===0)return on(new fo(_e,[]));let Ve=$s(p)===r;return this.processSegment(B,k,Je,Ge,Ve?Mn:r,!0).pipe(Sn(We=>new fo(_e,We instanceof fo?[We]:[])))}))):Jd(f)))}getChildConfig(a,f,p){return f.children?on({routes:f.children,injector:a}):f.loadChildren?f._loadedRoutes!==void 0?on({routes:f._loadedRoutes,injector:f._loadedInjector}):nU(a,f,p,this.urlSerializer).pipe(ei(_=>_?this.configLoader.loadChildren(a,f).pipe(Nr(r=>{f._loadedRoutes=r.routes,f._loadedInjector=r.injector})):oU(f))):on({routes:[],injector:a})}};function gU(s){s.sort((a,f)=>a.value.outlet===Mn?-1:f.value.outlet===Mn?1:a.value.outlet.localeCompare(f.value.outlet))}function _U(s){let a=s.value.routeConfig;return a&&a.path===""}function LP(s){let a=[],f=new Set;for(let p of s){if(!_U(p)){a.push(p);continue}let _=a.find(r=>p.value.routeConfig===r.value.routeConfig);_!==void 0?(_.children.push(...p.children),f.add(_)):a.push(p)}for(let p of f){let _=LP(p.children);a.push(new fo(p.value,_))}return a.filter(p=>!f.has(p))}function yU(s){return s.data||{}}function vU(s){return s.resolve||{}}function xU(s,a,f,p,_,r){return ei(C=>pU(s,a,f,p,C.extractedUrl,_,r).pipe(Sn(({state:A,tree:k})=>_r(kt({},C),{targetSnapshot:A,urlAfterRedirects:k}))))}function bU(s,a){return ei(f=>{let{targetSnapshot:p,guards:{canActivateChecks:_}}=f;if(!_.length)return on(f);let r=new Set(_.map(k=>k.route)),C=new Set;for(let k of r)if(!C.has(k))for(let B of FP(k))C.add(B);let A=0;return Dr(C).pipe(Xl(k=>r.has(k)?wU(k,p,s,a):(k.data=tE(k,k.parent,s).resolve,on(void 0))),Nr(()=>A++),Rd(1),ei(k=>A===C.size?on(f):ao))})}function FP(s){let a=s.children.map(f=>FP(f)).flat();return[s,...a]}function wU(s,a,f,p){let _=s.routeConfig,r=s._resolve;return _?.title!==void 0&&!SP(_)&&(r[Km]=_.title),TU(r,s,a,p).pipe(Sn(C=>(s._resolvedData=C,s.data=tE(s,s.parent,f).resolve,null)))}function TU(s,a,f,p){let _=ST(s);if(_.length===0)return on({});let r={};return Dr(_).pipe(ei(C=>EU(s[C],a,f,p).pipe(Os(),Nr(A=>{r[C]=A}))),Rd(1),wb(r),Ps(C=>OP(C)?ao:Da(C)))}function EU(s,a,f,p){let _=Qm(a)??p,r=lf(s,_),C=r.resolve?r.resolve(a,f):Oa(_,()=>r(a,f));return cc(C)}function CT(s){return co(a=>{let f=s(a);return f?Dr(f).pipe(Sn(()=>a)):on(a)})}var NP=(()=>{let a=class a{buildTitle(p){let _,r=p.root;for(;r!==void 0;)_=this.getResolvedTitleForRoute(r)??_,r=r.children.find(C=>C.outlet===Mn);return _}getResolvedTitleForRoute(p){return p.data[Km]}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:()=>It(IU),providedIn:"root"});let s=a;return s})(),IU=(()=>{let a=class a extends NP{constructor(p){super(),this.title=p}updateTitle(p){let _=this.buildTitle(p);_!==void 0&&this.title.setTitle(_)}};a.\u0275fac=function(_){return new(_||a)(xn(sP))},a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),aE=new vn("",{providedIn:"root",factory:()=>({})}),lE=new vn(""),CU=(()=>{let a=class a{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=It(oT)}loadComponent(p){if(this.componentLoaders.get(p))return this.componentLoaders.get(p);if(p._loadedComponent)return on(p._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(p);let _=cc(p.loadComponent()).pipe(Sn(zP),Nr(C=>{this.onLoadEndListener&&this.onLoadEndListener(p),p._loadedComponent=C}),Rs(()=>{this.componentLoaders.delete(p)})),r=new Ad(_,()=>new Jr).pipe(Md());return this.componentLoaders.set(p,r),r}loadChildren(p,_){if(this.childrenLoaders.get(_))return this.childrenLoaders.get(_);if(_._loadedRoutes)return on({routes:_._loadedRoutes,injector:_._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(_);let C=DU(_,this.compiler,p,this.onLoadEndListener).pipe(Rs(()=>{this.childrenLoaders.delete(_)})),A=new Ad(C,()=>new Jr).pipe(Md());return this.childrenLoaders.set(_,A),A}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function DU(s,a,f,p){return cc(s.loadChildren()).pipe(Sn(zP),ei(_=>_ instanceof xm||Array.isArray(_)?on(_):Dr(a.compileModuleAsync(_))),Sn(_=>{p&&p(s);let r,C,A=!1;return Array.isArray(_)?(C=_,A=!0):(r=_.create(f).injector,C=r.get(lE,[],{optional:!0,self:!0}).flat()),{routes:C.map(oE),injector:r}}))}function SU(s){return s&&typeof s=="object"&&"default"in s}function zP(s){return SU(s)?s.default:s}var cE=(()=>{let a=class a{};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:()=>It(MU),providedIn:"root"});let s=a;return s})(),MU=(()=>{let a=class a{shouldProcessUrl(p){return!0}extract(p){return p}merge(p,_){return p}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),AU=new vn("");var PU=(()=>{let a=class a{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Jr,this.transitionAbortSubject=new Jr,this.configLoader=It(CU),this.environmentInjector=It(Hi),this.urlSerializer=It(eE),this.rootContexts=It(av),this.location=It(Am),this.inputBindingEnabled=It(iE,{optional:!0})!==null,this.titleStrategy=It(NP),this.options=It(aE,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=It(cE),this.createViewTransition=It(AU,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>on(void 0),this.rootComponentType=null;let p=r=>this.events.next(new NT(r)),_=r=>this.events.next(new zT(r));this.configLoader.onLoadEndListener=_,this.configLoader.onLoadStartListener=p}complete(){this.transitions?.complete()}handleNavigationRequest(p){let _=++this.navigationId;this.transitions?.next(_r(kt(kt({},this.transitions.value),p),{id:_}))}setupNavigations(p,_,r){return this.transitions=new pi({id:0,currentUrlTree:_,currentRawUrl:_,extractedUrl:this.urlHandlingStrategy.extract(_),urlAfterRedirects:this.urlHandlingStrategy.extract(_),rawUrl:_,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:jm,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(lo(C=>C.id!==0),Sn(C=>_r(kt({},C),{extractedUrl:this.urlHandlingStrategy.extract(C.rawUrl)})),co(C=>{let A=!1,k=!1;return on(C).pipe(co(B=>{if(this.navigationId>C.id)return this.cancelNavigationTransition(C,"",po.SupersededByNewNavigation),ao;this.currentTransition=C,this.currentNavigation={id:B.id,initialUrl:B.rawUrl,extractedUrl:B.extractedUrl,trigger:B.source,extras:B.extras,previousNavigation:this.lastSuccessfulNavigation?_r(kt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let Z=!p.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),he=B.extras.onSameUrlNavigation??p.onSameUrlNavigation;if(!Z&&he!=="reload"){let xe="";return this.events.next(new Wu(B.id,this.urlSerializer.serialize(B.rawUrl),xe,RT.IgnoredSameUrlNavigation)),B.resolve(null),ao}if(this.urlHandlingStrategy.shouldProcessUrl(B.rawUrl))return on(B).pipe(co(xe=>{let _e=this.transitions?.getValue();return this.events.next(new Gm(xe.id,this.urlSerializer.serialize(xe.extractedUrl),xe.source,xe.restoredState)),_e!==this.transitions?.getValue()?ao:Promise.resolve(xe)}),xU(this.environmentInjector,this.configLoader,this.rootComponentType,p.config,this.urlSerializer,this.paramsInheritanceStrategy),Nr(xe=>{C.targetSnapshot=xe.targetSnapshot,C.urlAfterRedirects=xe.urlAfterRedirects,this.currentNavigation=_r(kt({},this.currentNavigation),{finalUrl:xe.urlAfterRedirects});let _e=new tv(xe.id,this.urlSerializer.serialize(xe.extractedUrl),this.urlSerializer.serialize(xe.urlAfterRedirects),xe.targetSnapshot);this.events.next(_e)}));if(Z&&this.urlHandlingStrategy.shouldProcessUrl(B.currentRawUrl)){let{id:xe,extractedUrl:_e,source:Je,restoredState:Ge,extras:Ve}=B,We=new Gm(xe,this.urlSerializer.serialize(_e),Je,Ge);this.events.next(We);let ct=CP(this.rootComponentType).snapshot;return this.currentTransition=C=_r(kt({},B),{targetSnapshot:ct,urlAfterRedirects:_e,extras:_r(kt({},Ve),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=_e,on(C)}else{let xe="";return this.events.next(new Wu(B.id,this.urlSerializer.serialize(B.extractedUrl),xe,RT.IgnoredByUrlHandlingStrategy)),B.resolve(null),ao}}),Nr(B=>{let Z=new OT(B.id,this.urlSerializer.serialize(B.extractedUrl),this.urlSerializer.serialize(B.urlAfterRedirects),B.targetSnapshot);this.events.next(Z)}),Sn(B=>(this.currentTransition=C=_r(kt({},B),{guards:zj(B.targetSnapshot,B.currentSnapshot,this.rootContexts)}),C)),Zj(this.environmentInjector,B=>this.events.next(B)),Nr(B=>{if(C.guardsResult=B.guardsResult,of(B.guardsResult))throw AP(this.urlSerializer,B.guardsResult);let Z=new kT(B.id,this.urlSerializer.serialize(B.extractedUrl),this.urlSerializer.serialize(B.urlAfterRedirects),B.targetSnapshot,!!B.guardsResult);this.events.next(Z)}),lo(B=>B.guardsResult?!0:(this.cancelNavigationTransition(B,"",po.GuardRejected),!1)),CT(B=>{if(B.guards.canActivateChecks.length)return on(B).pipe(Nr(Z=>{let he=new LT(Z.id,this.urlSerializer.serialize(Z.extractedUrl),this.urlSerializer.serialize(Z.urlAfterRedirects),Z.targetSnapshot);this.events.next(he)}),co(Z=>{let he=!1;return on(Z).pipe(bU(this.paramsInheritanceStrategy,this.environmentInjector),Nr({next:()=>he=!0,complete:()=>{he||this.cancelNavigationTransition(Z,"",po.NoDataFromResolver)}}))}),Nr(Z=>{let he=new FT(Z.id,this.urlSerializer.serialize(Z.extractedUrl),this.urlSerializer.serialize(Z.urlAfterRedirects),Z.targetSnapshot);this.events.next(he)}))}),CT(B=>{let Z=he=>{let xe=[];he.routeConfig?.loadComponent&&!he.routeConfig._loadedComponent&&xe.push(this.configLoader.loadComponent(he.routeConfig).pipe(Nr(_e=>{he.component=_e}),Sn(()=>{})));for(let _e of he.children)xe.push(...Z(_e));return xe};return Vy(Z(B.targetSnapshot.root)).pipe(Kl(null),Ma(1))}),CT(()=>this.afterPreactivation()),co(()=>{let{currentSnapshot:B,targetSnapshot:Z}=C,he=this.createViewTransition?.(this.environmentInjector,B.root,Z.root);return he?Dr(he).pipe(Sn(()=>C)):on(C)}),Sn(B=>{let Z=Aj(p.routeReuseStrategy,B.targetSnapshot,B.currentRouterState);return this.currentTransition=C=_r(kt({},B),{targetRouterState:Z}),this.currentNavigation.targetRouterState=Z,C}),Nr(()=>{this.events.next(new qm)}),Nj(this.rootContexts,p.routeReuseStrategy,B=>this.events.next(B),this.inputBindingEnabled),Ma(1),Nr({next:B=>{A=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new qu(B.id,this.urlSerializer.serialize(B.extractedUrl),this.urlSerializer.serialize(B.urlAfterRedirects))),this.titleStrategy?.updateTitle(B.targetRouterState.snapshot),B.resolve(!0)},complete:()=>{A=!0}}),Sb(this.transitionAbortSubject.pipe(Nr(B=>{throw B}))),Rs(()=>{!A&&!k&&this.cancelNavigationTransition(C,"",po.SupersededByNewNavigation),this.currentTransition?.id===C.id&&(this.currentNavigation=null,this.currentTransition=null)}),Ps(B=>{if(k=!0,RP(B))this.events.next(new lc(C.id,this.urlSerializer.serialize(C.extractedUrl),B.message,B.cancellationCode)),Oj(B)?this.events.next(new Wm(B.url)):C.resolve(!1);else{this.events.next(new Hm(C.id,this.urlSerializer.serialize(C.extractedUrl),B,C.targetSnapshot??void 0));try{C.resolve(p.errorHandler(B))}catch(Z){this.options.resolveNavigationPromiseOnError?C.resolve(!1):C.reject(Z)}}return ao}))}))}cancelNavigationTransition(p,_,r){let C=new lc(p.id,this.urlSerializer.serialize(p.extractedUrl),_,r);this.events.next(C),p.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function RU(s){return s!==jm}var OU=(()=>{let a=class a{};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:()=>It(kU),providedIn:"root"});let s=a;return s})(),JT=class{shouldDetach(a){return!1}store(a,f){}shouldAttach(a){return!1}retrieve(a){return null}shouldReuseRoute(a,f){return a.routeConfig===f.routeConfig}},kU=(()=>{let a=class a extends JT{};a.\u0275fac=(()=>{let p;return function(r){return(p||(p=Lw(a)))(r||a)}})(),a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),BP=(()=>{let a=class a{};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:()=>It(LU),providedIn:"root"});let s=a;return s})(),LU=(()=>{let a=class a extends BP{constructor(){super(...arguments),this.location=It(Am),this.urlSerializer=It(eE),this.options=It(aE,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=It(cE),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new ac,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=CP(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(p){return this.location.subscribe(_=>{_.type==="popstate"&&p(_.url,_.state)})}handleRouterEvent(p,_){if(p instanceof Gm)this.stateMemento=this.createStateMemento();else if(p instanceof Wu)this.rawUrlTree=_.initialUrl;else if(p instanceof tv){if(this.urlUpdateStrategy==="eager"&&!_.extras.skipLocationChange){let r=this.urlHandlingStrategy.merge(_.finalUrl,_.initialUrl);this.setBrowserUrl(r,_)}}else p instanceof qm?(this.currentUrlTree=_.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(_.finalUrl,_.initialUrl),this.routerState=_.targetRouterState,this.urlUpdateStrategy==="deferred"&&(_.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,_))):p instanceof lc&&(p.code===po.GuardRejected||p.code===po.NoDataFromResolver)?this.restoreHistory(_):p instanceof Hm?this.restoreHistory(_,!0):p instanceof qu&&(this.lastSuccessfulId=p.id,this.currentPageId=this.browserPageId)}setBrowserUrl(p,_){let r=this.urlSerializer.serialize(p);if(this.location.isCurrentPathEqualTo(r)||_.extras.replaceUrl){let C=this.browserPageId,A=kt(kt({},_.extras.state),this.generateNgRouterState(_.id,C));this.location.replaceState(r,"",A)}else{let C=kt(kt({},_.extras.state),this.generateNgRouterState(_.id,this.browserPageId+1));this.location.go(r,"",C)}}restoreHistory(p,_=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,C=this.currentPageId-r;C!==0?this.location.historyGo(C):this.currentUrlTree===p.finalUrl&&C===0&&(this.resetState(p),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(_&&this.resetState(p),this.resetUrlToCurrentUrlTree())}resetState(p){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,p.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(p,_){return this.canceledNavigationResolution==="computed"?{navigationId:p,\u0275routerPageId:_}:{navigationId:p}}};a.\u0275fac=(()=>{let p;return function(r){return(p||(p=Lw(a)))(r||a)}})(),a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),Bm=function(s){return s[s.COMPLETE=0]="COMPLETE",s[s.FAILED=1]="FAILED",s[s.REDIRECTING=2]="REDIRECTING",s}(Bm||{});function FU(s,a){s.events.pipe(lo(f=>f instanceof qu||f instanceof lc||f instanceof Hm||f instanceof Wu),Sn(f=>f instanceof qu||f instanceof Wu?Bm.COMPLETE:(f instanceof lc?f.code===po.Redirect||f.code===po.SupersededByNewNavigation:!1)?Bm.REDIRECTING:Bm.FAILED),lo(f=>f!==Bm.REDIRECTING),Ma(1)).subscribe(()=>{a()})}function NU(s){throw s}var zU={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},BU={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},VP=(()=>{let a=class a{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=It(O0),this.stateManager=It(BP),this.options=It(aE,{optional:!0})||{},this.pendingTasks=It(Vu),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=It(PU),this.urlSerializer=It(eE),this.location=It(Am),this.urlHandlingStrategy=It(cE),this._events=new Jr,this.errorHandler=this.options.errorHandler||NU,this.navigated=!1,this.routeReuseStrategy=It(OU),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=It(lE,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!It(iE,{optional:!0}),this.eventsSubscription=new Qr,this.isNgZoneEnabled=It(Sr)instanceof Sr&&Sr.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:p=>{this.console.warn(p)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let p=this.navigationTransitions.events.subscribe(_=>{try{let r=this.navigationTransitions.currentTransition,C=this.navigationTransitions.currentNavigation;if(r!==null&&C!==null){if(this.stateManager.handleRouterEvent(_,C),_ instanceof lc&&_.code!==po.Redirect&&_.code!==po.SupersededByNewNavigation)this.navigated=!0;else if(_ instanceof qu)this.navigated=!0;else if(_ instanceof Wm){let A=this.urlHandlingStrategy.merge(_.url,r.currentRawUrl),k={info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||RU(r.source)};this.scheduleNavigation(A,jm,null,k,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}jU(_)&&this._events.next(_)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(p)}resetRootComponentType(p){this.routerState.root.component=p,this.navigationTransitions.rootComponentType=p}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),jm,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((p,_)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(p,"popstate",_)},0)})}navigateToSyncWithBrowser(p,_,r){let C={replaceUrl:!0},A=r?.navigationId?r:null;if(r){let B=kt({},r);delete B.navigationId,delete B.\u0275routerPageId,Object.keys(B).length!==0&&(C.state=B)}let k=this.parseUrl(p);this.scheduleNavigation(k,_,A,C)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(p){this.config=p.map(oE),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(p,_={}){let{relativeTo:r,queryParams:C,fragment:A,queryParamsHandling:k,preserveFragment:B}=_,Z=B?this.currentUrlTree.fragment:A,he=null;switch(k){case"merge":he=kt(kt({},this.currentUrlTree.queryParams),C);break;case"preserve":he=this.currentUrlTree.queryParams;break;default:he=C||null}he!==null&&(he=this.removeEmptyProps(he));let xe;try{let _e=r?r.snapshot:this.routerState.snapshot.root;xe=wP(_e)}catch{(typeof p[0]!="string"||!p[0].startsWith("/"))&&(p=[]),xe=this.currentUrlTree.root}return TP(xe,p,he,Z??null)}navigateByUrl(p,_={skipLocationChange:!1}){let r=of(p)?p:this.parseUrl(p),C=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(C,jm,null,_)}navigate(p,_={skipLocationChange:!1}){return VU(p),this.navigateByUrl(this.createUrlTree(p,_),_)}serializeUrl(p){return this.urlSerializer.serialize(p)}parseUrl(p){try{return this.urlSerializer.parse(p)}catch{return this.urlSerializer.parse("/")}}isActive(p,_){let r;if(_===!0?r=kt({},zU):_===!1?r=kt({},BU):r=_,of(p))return aP(this.currentUrlTree,p,r);let C=this.parseUrl(p);return aP(this.currentUrlTree,C,r)}removeEmptyProps(p){return Object.entries(p).reduce((_,[r,C])=>(C!=null&&(_[r]=C),_),{})}scheduleNavigation(p,_,r,C,A){if(this.disposed)return Promise.resolve(!1);let k,B,Z;A?(k=A.resolve,B=A.reject,Z=A.promise):Z=new Promise((xe,_e)=>{k=xe,B=_e});let he=this.pendingTasks.add();return FU(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(he))}),this.navigationTransitions.handleNavigationRequest({source:_,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:p,extras:C,resolve:k,reject:B,promise:Z,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Z.catch(xe=>Promise.reject(xe))}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function VU(s){for(let a=0;a<s.length;a++)if(s[a]==null)throw new un(4008,!1)}function jU(s){return!(s instanceof qm)&&!(s instanceof Wm)}var UU=new vn("");function jP(s,...a){return nc([{provide:lE,multi:!0,useValue:s},[],{provide:sf,useFactory:$U,deps:[VP]},{provide:k0,multi:!0,useFactory:GU},a.map(f=>f.\u0275providers)])}function $U(s){return s.routerState.root}function GU(){let s=It(Tm);return a=>{let f=s.get(Yd);if(a!==f.components[0])return;let p=s.get(VP),_=s.get(HU);s.get(qU)===1&&p.initialNavigation(),s.get(WU,null,On.Optional)?.setUpPreloading(),s.get(UU,null,On.Optional)?.init(),p.resetRootComponentType(f.componentTypes[0]),_.closed||(_.next(),_.complete(),_.unsubscribe())}}var HU=new vn("",{factory:()=>new Jr}),qU=new vn("",{providedIn:"root",factory:()=>1});var WU=new vn("");var UP=[];var Zu=class{},hE=(()=>{let a=class a extends Zu{constructor(p){super(),this.http=p}getSvg(p){return this.http.get(p,{responseType:"text"})}};a.\u0275fac=function(_){return new(_||a)(xn(pT))},a.\u0275prov=Qt({token:a,factory:a.\u0275fac});let s=a;return s})(),ZU=new vn("SERVER_URL"),uE=(()=>{let a=class a{constructor(){this.loader=It(Zu),this.serverUrl=It(ZU,{optional:!0}),this.document=It(Br),this.iconsByUrl=new Map,this.iconsLoadingByUrl=new Map}addSvg(p,_){if(!this.iconsByUrl.has(p)){let r=this.document.createElement("DIV");r.innerHTML=_;let C=r.querySelector("svg");this.iconsByUrl.set(p,C)}}loadSvg(p,_=p){if(this.serverUrl&&p.match(/^(http(s)?):/)===null&&(p=this.serverUrl+p,_=p),this.iconsByUrl.has(_))return on(this.iconsByUrl.get(_));if(this.iconsLoadingByUrl.has(_))return this.iconsLoadingByUrl.get(_);let r=this.loader.getSvg(p).pipe(Sn(C=>{let A=this.document.createElement("DIV");return A.innerHTML=C,A.querySelector("svg")}),Nr(C=>this.iconsByUrl.set(_,C)),Ps(C=>(console.error(C),Da(C))),Rs(()=>this.iconsLoadingByUrl.delete(_)),Cb());return this.iconsLoadingByUrl.set(_,r),r}getSvgByName(p){return this.iconsByUrl.has(p)?on(this.iconsByUrl.get(p)):this.iconsLoadingByUrl.has(p)?this.iconsLoadingByUrl.get(p):Da(`No svg with name '${p}' has been loaded`)}unloadSvg(p){this.iconsByUrl.has(p)&&this.iconsByUrl.delete(p)}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Qt({token:a,factory:a.\u0275fac});let s=a;return s})();function YU(s){return s||new uE}var dE={provide:uE,deps:[[new m0,new bw,uE]],useFactory:YU};function $P(s={}){return nc([dE,s.loader||{provide:Zu,useClass:hE}])}var GP={providers:[jP(UP),$P()]};var XU={value:()=>{}};function qP(){for(var s=0,a=arguments.length,f={},p;s<a;++s){if(!(p=arguments[s]+"")||p in f||/[\s.]/.test(p))throw new Error("illegal type: "+p);f[p]=[]}return new cv(f)}function cv(s){this._=s}function KU(s,a){return s.trim().split(/^|\s+/).map(function(f){var p="",_=f.indexOf(".");if(_>=0&&(p=f.slice(_+1),f=f.slice(0,_)),f&&!a.hasOwnProperty(f))throw new Error("unknown type: "+f);return{type:f,name:p}})}cv.prototype=qP.prototype={constructor:cv,on:function(s,a){var f=this._,p=KU(s+"",f),_,r=-1,C=p.length;if(arguments.length<2){for(;++r<C;)if((_=(s=p[r]).type)&&(_=QU(f[_],s.name)))return _;return}if(a!=null&&typeof a!="function")throw new Error("invalid callback: "+a);for(;++r<C;)if(_=(s=p[r]).type)f[_]=HP(f[_],s.name,a);else if(a==null)for(_ in f)f[_]=HP(f[_],s.name,null);return this},copy:function(){var s={},a=this._;for(var f in a)s[f]=a[f].slice();return new cv(s)},call:function(s,a){if((_=arguments.length-2)>0)for(var f=new Array(_),p=0,_,r;p<_;++p)f[p]=arguments[p+2];if(!this._.hasOwnProperty(s))throw new Error("unknown type: "+s);for(r=this._[s],p=0,_=r.length;p<_;++p)r[p].value.apply(a,f)},apply:function(s,a,f){if(!this._.hasOwnProperty(s))throw new Error("unknown type: "+s);for(var p=this._[s],_=0,r=p.length;_<r;++_)p[_].value.apply(a,f)}};function QU(s,a){for(var f=0,p=s.length,_;f<p;++f)if((_=s[f]).name===a)return _.value}function HP(s,a,f){for(var p=0,_=s.length;p<_;++p)if(s[p].name===a){s[p]=XU,s=s.slice(0,p).concat(s.slice(p+1));break}return f!=null&&s.push({name:a,value:f}),s}var Yu=qP;var uv="http://www.w3.org/1999/xhtml",fE={svg:"http://www.w3.org/2000/svg",xhtml:uv,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Na(s){var a=s+="",f=a.indexOf(":");return f>=0&&(a=s.slice(0,f))!=="xmlns"&&(s=s.slice(f+1)),fE.hasOwnProperty(a)?{space:fE[a],local:s}:s}function JU(s){return function(){var a=this.ownerDocument,f=this.namespaceURI;return f===uv&&a.documentElement.namespaceURI===uv?a.createElement(s):a.createElementNS(f,s)}}function e6(s){return function(){return this.ownerDocument.createElementNS(s.space,s.local)}}function hv(s){var a=Na(s);return(a.local?e6:JU)(a)}function t6(){}function Xu(s){return s==null?t6:function(){return this.querySelector(s)}}function WP(s){typeof s!="function"&&(s=Xu(s));for(var a=this._groups,f=a.length,p=new Array(f),_=0;_<f;++_)for(var r=a[_],C=r.length,A=p[_]=new Array(C),k,B,Z=0;Z<C;++Z)(k=r[Z])&&(B=s.call(k,k.__data__,Z,r))&&("__data__"in k&&(B.__data__=k.__data__),A[Z]=B);return new Er(p,this._parents)}function pE(s){return s==null?[]:Array.isArray(s)?s:Array.from(s)}function n6(){return[]}function eg(s){return s==null?n6:function(){return this.querySelectorAll(s)}}function r6(s){return function(){return pE(s.apply(this,arguments))}}function ZP(s){typeof s=="function"?s=r6(s):s=eg(s);for(var a=this._groups,f=a.length,p=[],_=[],r=0;r<f;++r)for(var C=a[r],A=C.length,k,B=0;B<A;++B)(k=C[B])&&(p.push(s.call(k,k.__data__,B,C)),_.push(k));return new Er(p,_)}function tg(s){return function(){return this.matches(s)}}function dv(s){return function(a){return a.matches(s)}}var i6=Array.prototype.find;function o6(s){return function(){return i6.call(this.children,s)}}function s6(){return this.firstElementChild}function YP(s){return this.select(s==null?s6:o6(typeof s=="function"?s:dv(s)))}var a6=Array.prototype.filter;function l6(){return Array.from(this.children)}function c6(s){return function(){return a6.call(this.children,s)}}function XP(s){return this.selectAll(s==null?l6:c6(typeof s=="function"?s:dv(s)))}function KP(s){typeof s!="function"&&(s=tg(s));for(var a=this._groups,f=a.length,p=new Array(f),_=0;_<f;++_)for(var r=a[_],C=r.length,A=p[_]=[],k,B=0;B<C;++B)(k=r[B])&&s.call(k,k.__data__,B,r)&&A.push(k);return new Er(p,this._parents)}function fv(s){return new Array(s.length)}function QP(){return new Er(this._enter||this._groups.map(fv),this._parents)}function ng(s,a){this.ownerDocument=s.ownerDocument,this.namespaceURI=s.namespaceURI,this._next=null,this._parent=s,this.__data__=a}ng.prototype={constructor:ng,appendChild:function(s){return this._parent.insertBefore(s,this._next)},insertBefore:function(s,a){return this._parent.insertBefore(s,a)},querySelector:function(s){return this._parent.querySelector(s)},querySelectorAll:function(s){return this._parent.querySelectorAll(s)}};function JP(s){return function(){return s}}function u6(s,a,f,p,_,r){for(var C=0,A,k=a.length,B=r.length;C<B;++C)(A=a[C])?(A.__data__=r[C],p[C]=A):f[C]=new ng(s,r[C]);for(;C<k;++C)(A=a[C])&&(_[C]=A)}function h6(s,a,f,p,_,r,C){var A,k,B=new Map,Z=a.length,he=r.length,xe=new Array(Z),_e;for(A=0;A<Z;++A)(k=a[A])&&(xe[A]=_e=C.call(k,k.__data__,A,a)+"",B.has(_e)?_[A]=k:B.set(_e,k));for(A=0;A<he;++A)_e=C.call(s,r[A],A,r)+"",(k=B.get(_e))?(p[A]=k,k.__data__=r[A],B.delete(_e)):f[A]=new ng(s,r[A]);for(A=0;A<Z;++A)(k=a[A])&&B.get(xe[A])===k&&(_[A]=k)}function d6(s){return s.__data__}function eR(s,a){if(!arguments.length)return Array.from(this,d6);var f=a?h6:u6,p=this._parents,_=this._groups;typeof s!="function"&&(s=JP(s));for(var r=_.length,C=new Array(r),A=new Array(r),k=new Array(r),B=0;B<r;++B){var Z=p[B],he=_[B],xe=he.length,_e=f6(s.call(Z,Z&&Z.__data__,B,p)),Je=_e.length,Ge=A[B]=new Array(Je),Ve=C[B]=new Array(Je),We=k[B]=new Array(xe);f(Z,he,Ge,Ve,We,_e,a);for(var ct=0,gt=0,Be,St;ct<Je;++ct)if(Be=Ge[ct]){for(ct>=gt&&(gt=ct+1);!(St=Ve[gt])&&++gt<Je;);Be._next=St||null}}return C=new Er(C,p),C._enter=A,C._exit=k,C}function f6(s){return typeof s=="object"&&"length"in s?s:Array.from(s)}function tR(){return new Er(this._exit||this._groups.map(fv),this._parents)}function nR(s,a,f){var p=this.enter(),_=this,r=this.exit();return typeof s=="function"?(p=s(p),p&&(p=p.selection())):p=p.append(s+""),a!=null&&(_=a(_),_&&(_=_.selection())),f==null?r.remove():f(r),p&&_?p.merge(_).order():_}function rR(s){for(var a=s.selection?s.selection():s,f=this._groups,p=a._groups,_=f.length,r=p.length,C=Math.min(_,r),A=new Array(_),k=0;k<C;++k)for(var B=f[k],Z=p[k],he=B.length,xe=A[k]=new Array(he),_e,Je=0;Je<he;++Je)(_e=B[Je]||Z[Je])&&(xe[Je]=_e);for(;k<_;++k)A[k]=f[k];return new Er(A,this._parents)}function iR(){for(var s=this._groups,a=-1,f=s.length;++a<f;)for(var p=s[a],_=p.length-1,r=p[_],C;--_>=0;)(C=p[_])&&(r&&C.compareDocumentPosition(r)^4&&r.parentNode.insertBefore(C,r),r=C);return this}function oR(s){s||(s=p6);function a(he,xe){return he&&xe?s(he.__data__,xe.__data__):!he-!xe}for(var f=this._groups,p=f.length,_=new Array(p),r=0;r<p;++r){for(var C=f[r],A=C.length,k=_[r]=new Array(A),B,Z=0;Z<A;++Z)(B=C[Z])&&(k[Z]=B);k.sort(a)}return new Er(_,this._parents).order()}function p6(s,a){return s<a?-1:s>a?1:s>=a?0:NaN}function sR(){var s=arguments[0];return arguments[0]=this,s.apply(null,arguments),this}function aR(){return Array.from(this)}function lR(){for(var s=this._groups,a=0,f=s.length;a<f;++a)for(var p=s[a],_=0,r=p.length;_<r;++_){var C=p[_];if(C)return C}return null}function cR(){let s=0;for(let a of this)++s;return s}function uR(){return!this.node()}function hR(s){for(var a=this._groups,f=0,p=a.length;f<p;++f)for(var _=a[f],r=0,C=_.length,A;r<C;++r)(A=_[r])&&s.call(A,A.__data__,r,_);return this}function m6(s){return function(){this.removeAttribute(s)}}function g6(s){return function(){this.removeAttributeNS(s.space,s.local)}}function _6(s,a){return function(){this.setAttribute(s,a)}}function y6(s,a){return function(){this.setAttributeNS(s.space,s.local,a)}}function v6(s,a){return function(){var f=a.apply(this,arguments);f==null?this.removeAttribute(s):this.setAttribute(s,f)}}function x6(s,a){return function(){var f=a.apply(this,arguments);f==null?this.removeAttributeNS(s.space,s.local):this.setAttributeNS(s.space,s.local,f)}}function dR(s,a){var f=Na(s);if(arguments.length<2){var p=this.node();return f.local?p.getAttributeNS(f.space,f.local):p.getAttribute(f)}return this.each((a==null?f.local?g6:m6:typeof a=="function"?f.local?x6:v6:f.local?y6:_6)(f,a))}function pv(s){return s.ownerDocument&&s.ownerDocument.defaultView||s.document&&s||s.defaultView}function b6(s){return function(){this.style.removeProperty(s)}}function w6(s,a,f){return function(){this.style.setProperty(s,a,f)}}function T6(s,a,f){return function(){var p=a.apply(this,arguments);p==null?this.style.removeProperty(s):this.style.setProperty(s,p,f)}}function fR(s,a,f){return arguments.length>1?this.each((a==null?b6:typeof a=="function"?T6:w6)(s,a,f??"")):uc(this.node(),s)}function uc(s,a){return s.style.getPropertyValue(a)||pv(s).getComputedStyle(s,null).getPropertyValue(a)}function E6(s){return function(){delete this[s]}}function I6(s,a){return function(){this[s]=a}}function C6(s,a){return function(){var f=a.apply(this,arguments);f==null?delete this[s]:this[s]=f}}function pR(s,a){return arguments.length>1?this.each((a==null?E6:typeof a=="function"?C6:I6)(s,a)):this.node()[s]}function mR(s){return s.trim().split(/^|\s+/)}function mE(s){return s.classList||new gR(s)}function gR(s){this._node=s,this._names=mR(s.getAttribute("class")||"")}gR.prototype={add:function(s){var a=this._names.indexOf(s);a<0&&(this._names.push(s),this._node.setAttribute("class",this._names.join(" ")))},remove:function(s){var a=this._names.indexOf(s);a>=0&&(this._names.splice(a,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(s){return this._names.indexOf(s)>=0}};function _R(s,a){for(var f=mE(s),p=-1,_=a.length;++p<_;)f.add(a[p])}function yR(s,a){for(var f=mE(s),p=-1,_=a.length;++p<_;)f.remove(a[p])}function D6(s){return function(){_R(this,s)}}function S6(s){return function(){yR(this,s)}}function M6(s,a){return function(){(a.apply(this,arguments)?_R:yR)(this,s)}}function vR(s,a){var f=mR(s+"");if(arguments.length<2){for(var p=mE(this.node()),_=-1,r=f.length;++_<r;)if(!p.contains(f[_]))return!1;return!0}return this.each((typeof a=="function"?M6:a?D6:S6)(f,a))}function A6(){this.textContent=""}function P6(s){return function(){this.textContent=s}}function R6(s){return function(){var a=s.apply(this,arguments);this.textContent=a??""}}function xR(s){return arguments.length?this.each(s==null?A6:(typeof s=="function"?R6:P6)(s)):this.node().textContent}function O6(){this.innerHTML=""}function k6(s){return function(){this.innerHTML=s}}function L6(s){return function(){var a=s.apply(this,arguments);this.innerHTML=a??""}}function bR(s){return arguments.length?this.each(s==null?O6:(typeof s=="function"?L6:k6)(s)):this.node().innerHTML}function F6(){this.nextSibling&&this.parentNode.appendChild(this)}function wR(){return this.each(F6)}function N6(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function TR(){return this.each(N6)}function ER(s){var a=typeof s=="function"?s:hv(s);return this.select(function(){return this.appendChild(a.apply(this,arguments))})}function z6(){return null}function IR(s,a){var f=typeof s=="function"?s:hv(s),p=a==null?z6:typeof a=="function"?a:Xu(a);return this.select(function(){return this.insertBefore(f.apply(this,arguments),p.apply(this,arguments)||null)})}function B6(){var s=this.parentNode;s&&s.removeChild(this)}function CR(){return this.each(B6)}function V6(){var s=this.cloneNode(!1),a=this.parentNode;return a?a.insertBefore(s,this.nextSibling):s}function j6(){var s=this.cloneNode(!0),a=this.parentNode;return a?a.insertBefore(s,this.nextSibling):s}function DR(s){return this.select(s?j6:V6)}function SR(s){return arguments.length?this.property("__data__",s):this.node().__data__}function U6(s){return function(a){s.call(this,a,this.__data__)}}function $6(s){return s.trim().split(/^|\s+/).map(function(a){var f="",p=a.indexOf(".");return p>=0&&(f=a.slice(p+1),a=a.slice(0,p)),{type:a,name:f}})}function G6(s){return function(){var a=this.__on;if(a){for(var f=0,p=-1,_=a.length,r;f<_;++f)r=a[f],(!s.type||r.type===s.type)&&r.name===s.name?this.removeEventListener(r.type,r.listener,r.options):a[++p]=r;++p?a.length=p:delete this.__on}}}function H6(s,a,f){return function(){var p=this.__on,_,r=U6(a);if(p){for(var C=0,A=p.length;C<A;++C)if((_=p[C]).type===s.type&&_.name===s.name){this.removeEventListener(_.type,_.listener,_.options),this.addEventListener(_.type,_.listener=r,_.options=f),_.value=a;return}}this.addEventListener(s.type,r,f),_={type:s.type,name:s.name,value:a,listener:r,options:f},p?p.push(_):this.__on=[_]}}function MR(s,a,f){var p=$6(s+""),_,r=p.length,C;if(arguments.length<2){var A=this.node().__on;if(A){for(var k=0,B=A.length,Z;k<B;++k)for(_=0,Z=A[k];_<r;++_)if((C=p[_]).type===Z.type&&C.name===Z.name)return Z.value}return}for(A=a?H6:G6,_=0;_<r;++_)this.each(A(p[_],a,f));return this}function AR(s,a,f){var p=pv(s),_=p.CustomEvent;typeof _=="function"?_=new _(a,f):(_=p.document.createEvent("Event"),f?(_.initEvent(a,f.bubbles,f.cancelable),_.detail=f.detail):_.initEvent(a,!1,!1)),s.dispatchEvent(_)}function q6(s,a){return function(){return AR(this,s,a)}}function W6(s,a){return function(){return AR(this,s,a.apply(this,arguments))}}function PR(s,a){return this.each((typeof a=="function"?W6:q6)(s,a))}function*RR(){for(var s=this._groups,a=0,f=s.length;a<f;++a)for(var p=s[a],_=0,r=p.length,C;_<r;++_)(C=p[_])&&(yield C)}var gE=[null];function Er(s,a){this._groups=s,this._parents=a}function OR(){return new Er([[document.documentElement]],gE)}function Z6(){return this}Er.prototype=OR.prototype={constructor:Er,select:WP,selectAll:ZP,selectChild:YP,selectChildren:XP,filter:KP,data:eR,enter:QP,exit:tR,join:nR,merge:rR,selection:Z6,order:iR,sort:oR,call:sR,nodes:aR,node:lR,size:cR,empty:uR,each:hR,attr:dR,style:fR,property:pR,classed:vR,text:xR,html:bR,raise:wR,lower:TR,append:ER,insert:IR,remove:CR,clone:DR,datum:SR,on:MR,dispatch:PR,[Symbol.iterator]:RR};var za=OR;function Wi(s){return typeof s=="string"?new Er([[document.querySelector(s)]],[document.documentElement]):new Er([[s]],gE)}function kR(s){let a;for(;a=s.sourceEvent;)s=a;return s}function mv(s,a){if(s=kR(s),a===void 0&&(a=s.currentTarget),a){var f=a.ownerSVGElement||a;if(f.createSVGPoint){var p=f.createSVGPoint();return p.x=s.clientX,p.y=s.clientY,p=p.matrixTransform(a.getScreenCTM().inverse()),[p.x,p.y]}if(a.getBoundingClientRect){var _=a.getBoundingClientRect();return[s.clientX-_.left-a.clientLeft,s.clientY-_.top-a.clientTop]}}return[s.pageX,s.pageY]}var LR={passive:!1},Ku={capture:!0,passive:!1};function gv(s){s.stopImmediatePropagation()}function hc(s){s.preventDefault(),s.stopImmediatePropagation()}function FR(s){var a=s.document.documentElement,f=Wi(s).on("dragstart.drag",hc,Ku);"onselectstart"in a?f.on("selectstart.drag",hc,Ku):(a.__noselect=a.style.MozUserSelect,a.style.MozUserSelect="none")}function NR(s,a){var f=s.document.documentElement,p=Wi(s).on("dragstart.drag",null);a&&(p.on("click.drag",hc,Ku),setTimeout(function(){p.on("click.drag",null)},0)),"onselectstart"in f?p.on("selectstart.drag",null):(f.style.MozUserSelect=f.__noselect,delete f.__noselect)}var rg=s=>()=>s;function ig(s,{sourceEvent:a,subject:f,target:p,identifier:_,active:r,x:C,y:A,dx:k,dy:B,dispatch:Z}){Object.defineProperties(this,{type:{value:s,enumerable:!0,configurable:!0},sourceEvent:{value:a,enumerable:!0,configurable:!0},subject:{value:f,enumerable:!0,configurable:!0},target:{value:p,enumerable:!0,configurable:!0},identifier:{value:_,enumerable:!0,configurable:!0},active:{value:r,enumerable:!0,configurable:!0},x:{value:C,enumerable:!0,configurable:!0},y:{value:A,enumerable:!0,configurable:!0},dx:{value:k,enumerable:!0,configurable:!0},dy:{value:B,enumerable:!0,configurable:!0},_:{value:Z}})}ig.prototype.on=function(){var s=this._.on.apply(this._,arguments);return s===this._?this:s};function Y6(s){return!s.ctrlKey&&!s.button}function X6(){return this.parentNode}function K6(s,a){return a??{x:s.x,y:s.y}}function Q6(){return navigator.maxTouchPoints||"ontouchstart"in this}function og(){var s=Y6,a=X6,f=K6,p=Q6,_={},r=Yu("start","drag","end"),C=0,A,k,B,Z,he=0;function xe(Be){Be.on("mousedown.drag",_e).filter(p).on("touchstart.drag",Ve).on("touchmove.drag",We,LR).on("touchend.drag touchcancel.drag",ct).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function _e(Be,St){if(!(Z||!s.call(this,Be,St))){var qt=gt(this,a.call(this,Be,St),Be,St,"mouse");qt&&(Wi(Be.view).on("mousemove.drag",Je,Ku).on("mouseup.drag",Ge,Ku),FR(Be.view),gv(Be),B=!1,A=Be.clientX,k=Be.clientY,qt("start",Be))}}function Je(Be){if(hc(Be),!B){var St=Be.clientX-A,qt=Be.clientY-k;B=St*St+qt*qt>he}_.mouse("drag",Be)}function Ge(Be){Wi(Be.view).on("mousemove.drag mouseup.drag",null),NR(Be.view,B),hc(Be),_.mouse("end",Be)}function Ve(Be,St){if(s.call(this,Be,St)){var qt=Be.changedTouches,dn=a.call(this,Be,St),Tt=qt.length,Gn,wt;for(Gn=0;Gn<Tt;++Gn)(wt=gt(this,dn,Be,St,qt[Gn].identifier,qt[Gn]))&&(gv(Be),wt("start",Be,qt[Gn]))}}function We(Be){var St=Be.changedTouches,qt=St.length,dn,Tt;for(dn=0;dn<qt;++dn)(Tt=_[St[dn].identifier])&&(hc(Be),Tt("drag",Be,St[dn]))}function ct(Be){var St=Be.changedTouches,qt=St.length,dn,Tt;for(Z&&clearTimeout(Z),Z=setTimeout(function(){Z=null},500),dn=0;dn<qt;++dn)(Tt=_[St[dn].identifier])&&(gv(Be),Tt("end",Be,St[dn]))}function gt(Be,St,qt,dn,Tt,Gn){var wt=r.copy(),ar=mv(Gn||qt,St),jr,Ur,En;if((En=f.call(Be,new ig("beforestart",{sourceEvent:qt,target:xe,identifier:Tt,active:C,x:ar[0],y:ar[1],dx:0,dy:0,dispatch:wt}),dn))!=null)return jr=En.x-ar[0]||0,Ur=En.y-ar[1]||0,function Hs(ni,qs,Ws){var mo=ar,fn;switch(ni){case"start":_[Tt]=Hs,fn=C++;break;case"end":delete _[Tt],--C;case"drag":ar=mv(Ws||qs,St),fn=C;break}wt.call(ni,Be,new ig(ni,{sourceEvent:qs,subject:En,target:xe,identifier:Tt,active:fn,x:ar[0]+jr,y:ar[1]+Ur,dx:ar[0]-mo[0],dy:ar[1]-mo[1],dispatch:wt}),dn)}}return xe.filter=function(Be){return arguments.length?(s=typeof Be=="function"?Be:rg(!!Be),xe):s},xe.container=function(Be){return arguments.length?(a=typeof Be=="function"?Be:rg(Be),xe):a},xe.subject=function(Be){return arguments.length?(f=typeof Be=="function"?Be:rg(Be),xe):f},xe.touchable=function(Be){return arguments.length?(p=typeof Be=="function"?Be:rg(!!Be),xe):p},xe.on=function(){var Be=r.on.apply(r,arguments);return Be===r?xe:Be},xe.clickDistance=function(Be){return arguments.length?(he=(Be=+Be)*Be,xe):Math.sqrt(he)},xe}function _v(s,a,f){s.prototype=a.prototype=f,f.constructor=s}function _E(s,a){var f=Object.create(s.prototype);for(var p in a)f[p]=a[p];return f}function lg(){}var sg=.7,xv=1/sg,cf="\\s*([+-]?\\d+)\\s*",ag="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Gs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",J6=/^#([0-9a-f]{3,8})$/,e8=new RegExp(`^rgb\\(${cf},${cf},${cf}\\)$`),t8=new RegExp(`^rgb\\(${Gs},${Gs},${Gs}\\)$`),n8=new RegExp(`^rgba\\(${cf},${cf},${cf},${ag}\\)$`),r8=new RegExp(`^rgba\\(${Gs},${Gs},${Gs},${ag}\\)$`),i8=new RegExp(`^hsl\\(${ag},${Gs},${Gs}\\)$`),o8=new RegExp(`^hsla\\(${ag},${Gs},${Gs},${ag}\\)$`),zR={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};_v(lg,dc,{copy(s){return Object.assign(new this.constructor,this,s)},displayable(){return this.rgb().displayable()},hex:BR,formatHex:BR,formatHex8:s8,formatHsl:a8,formatRgb:VR,toString:VR});function BR(){return this.rgb().formatHex()}function s8(){return this.rgb().formatHex8()}function a8(){return qR(this).formatHsl()}function VR(){return this.rgb().formatRgb()}function dc(s){var a,f;return s=(s+"").trim().toLowerCase(),(a=J6.exec(s))?(f=a[1].length,a=parseInt(a[1],16),f===6?jR(a):f===3?new Zi(a>>8&15|a>>4&240,a>>4&15|a&240,(a&15)<<4|a&15,1):f===8?yv(a>>24&255,a>>16&255,a>>8&255,(a&255)/255):f===4?yv(a>>12&15|a>>8&240,a>>8&15|a>>4&240,a>>4&15|a&240,((a&15)<<4|a&15)/255):null):(a=e8.exec(s))?new Zi(a[1],a[2],a[3],1):(a=t8.exec(s))?new Zi(a[1]*255/100,a[2]*255/100,a[3]*255/100,1):(a=n8.exec(s))?yv(a[1],a[2],a[3],a[4]):(a=r8.exec(s))?yv(a[1]*255/100,a[2]*255/100,a[3]*255/100,a[4]):(a=i8.exec(s))?GR(a[1],a[2]/100,a[3]/100,1):(a=o8.exec(s))?GR(a[1],a[2]/100,a[3]/100,a[4]):zR.hasOwnProperty(s)?jR(zR[s]):s==="transparent"?new Zi(NaN,NaN,NaN,0):null}function jR(s){return new Zi(s>>16&255,s>>8&255,s&255,1)}function yv(s,a,f,p){return p<=0&&(s=a=f=NaN),new Zi(s,a,f,p)}function l8(s){return s instanceof lg||(s=dc(s)),s?(s=s.rgb(),new Zi(s.r,s.g,s.b,s.opacity)):new Zi}function uf(s,a,f,p){return arguments.length===1?l8(s):new Zi(s,a,f,p??1)}function Zi(s,a,f,p){this.r=+s,this.g=+a,this.b=+f,this.opacity=+p}_v(Zi,uf,_E(lg,{brighter(s){return s=s==null?xv:Math.pow(xv,s),new Zi(this.r*s,this.g*s,this.b*s,this.opacity)},darker(s){return s=s==null?sg:Math.pow(sg,s),new Zi(this.r*s,this.g*s,this.b*s,this.opacity)},rgb(){return this},clamp(){return new Zi(Ju(this.r),Ju(this.g),Ju(this.b),bv(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:UR,formatHex:UR,formatHex8:c8,formatRgb:$R,toString:$R}));function UR(){return`#${Qu(this.r)}${Qu(this.g)}${Qu(this.b)}`}function c8(){return`#${Qu(this.r)}${Qu(this.g)}${Qu(this.b)}${Qu((isNaN(this.opacity)?1:this.opacity)*255)}`}function $R(){let s=bv(this.opacity);return`${s===1?"rgb(":"rgba("}${Ju(this.r)}, ${Ju(this.g)}, ${Ju(this.b)}${s===1?")":`, ${s})`}`}function bv(s){return isNaN(s)?1:Math.max(0,Math.min(1,s))}function Ju(s){return Math.max(0,Math.min(255,Math.round(s)||0))}function Qu(s){return s=Ju(s),(s<16?"0":"")+s.toString(16)}function GR(s,a,f,p){return p<=0?s=a=f=NaN:f<=0||f>=1?s=a=NaN:a<=0&&(s=NaN),new as(s,a,f,p)}function qR(s){if(s instanceof as)return new as(s.h,s.s,s.l,s.opacity);if(s instanceof lg||(s=dc(s)),!s)return new as;if(s instanceof as)return s;s=s.rgb();var a=s.r/255,f=s.g/255,p=s.b/255,_=Math.min(a,f,p),r=Math.max(a,f,p),C=NaN,A=r-_,k=(r+_)/2;return A?(a===r?C=(f-p)/A+(f<p)*6:f===r?C=(p-a)/A+2:C=(a-f)/A+4,A/=k<.5?r+_:2-r-_,C*=60):A=k>0&&k<1?0:C,new as(C,A,k,s.opacity)}function WR(s,a,f,p){return arguments.length===1?qR(s):new as(s,a,f,p??1)}function as(s,a,f,p){this.h=+s,this.s=+a,this.l=+f,this.opacity=+p}_v(as,WR,_E(lg,{brighter(s){return s=s==null?xv:Math.pow(xv,s),new as(this.h,this.s,this.l*s,this.opacity)},darker(s){return s=s==null?sg:Math.pow(sg,s),new as(this.h,this.s,this.l*s,this.opacity)},rgb(){var s=this.h%360+(this.h<0)*360,a=isNaN(s)||isNaN(this.s)?0:this.s,f=this.l,p=f+(f<.5?f:1-f)*a,_=2*f-p;return new Zi(yE(s>=240?s-240:s+120,_,p),yE(s,_,p),yE(s<120?s+240:s-120,_,p),this.opacity)},clamp(){return new as(HR(this.h),vv(this.s),vv(this.l),bv(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let s=bv(this.opacity);return`${s===1?"hsl(":"hsla("}${HR(this.h)}, ${vv(this.s)*100}%, ${vv(this.l)*100}%${s===1?")":`, ${s})`}`}}));function HR(s){return s=(s||0)%360,s<0?s+360:s}function vv(s){return Math.max(0,Math.min(1,s||0))}function yE(s,a,f){return(s<60?a+(f-a)*s/60:s<180?f:s<240?a+(f-a)*(240-s)/60:a)*255}function vE(s,a,f,p,_){var r=s*s,C=r*s;return((1-3*s+3*r-C)*a+(4-6*r+3*C)*f+(1+3*s+3*r-3*C)*p+C*_)/6}function ZR(s){var a=s.length-1;return function(f){var p=f<=0?f=0:f>=1?(f=1,a-1):Math.floor(f*a),_=s[p],r=s[p+1],C=p>0?s[p-1]:2*_-r,A=p<a-1?s[p+2]:2*r-_;return vE((f-p/a)*a,C,_,r,A)}}function YR(s){var a=s.length;return function(f){var p=Math.floor(((f%=1)<0?++f:f)*a),_=s[(p+a-1)%a],r=s[p%a],C=s[(p+1)%a],A=s[(p+2)%a];return vE((f-p/a)*a,_,r,C,A)}}var xE=s=>()=>s;function u8(s,a){return function(f){return s+f*a}}function h8(s,a,f){return s=Math.pow(s,f),a=Math.pow(a,f)-s,f=1/f,function(p){return Math.pow(s+p*a,f)}}function XR(s){return(s=+s)==1?wv:function(a,f){return f-a?h8(a,f,s):xE(isNaN(a)?f:a)}}function wv(s,a){var f=a-s;return f?u8(s,f):xE(isNaN(s)?a:s)}var Tv=function s(a){var f=XR(a);function p(_,r){var C=f((_=uf(_)).r,(r=uf(r)).r),A=f(_.g,r.g),k=f(_.b,r.b),B=wv(_.opacity,r.opacity);return function(Z){return _.r=C(Z),_.g=A(Z),_.b=k(Z),_.opacity=B(Z),_+""}}return p.gamma=s,p}(1);function KR(s){return function(a){var f=a.length,p=new Array(f),_=new Array(f),r=new Array(f),C,A;for(C=0;C<f;++C)A=uf(a[C]),p[C]=A.r||0,_[C]=A.g||0,r[C]=A.b||0;return p=s(p),_=s(_),r=s(r),A.opacity=1,function(k){return A.r=p(k),A.g=_(k),A.b=r(k),A+""}}}var d8=KR(ZR),f8=KR(YR);function Oo(s,a){return s=+s,a=+a,function(f){return s*(1-f)+a*f}}var wE=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,bE=new RegExp(wE.source,"g");function p8(s){return function(){return s}}function m8(s){return function(a){return s(a)+""}}function TE(s,a){var f=wE.lastIndex=bE.lastIndex=0,p,_,r,C=-1,A=[],k=[];for(s=s+"",a=a+"";(p=wE.exec(s))&&(_=bE.exec(a));)(r=_.index)>f&&(r=a.slice(f,r),A[C]?A[C]+=r:A[++C]=r),(p=p[0])===(_=_[0])?A[C]?A[C]+=_:A[++C]=_:(A[++C]=null,k.push({i:C,x:Oo(p,_)})),f=bE.lastIndex;return f<a.length&&(r=a.slice(f),A[C]?A[C]+=r:A[++C]=r),A.length<2?k[0]?m8(k[0].x):p8(a):(a=k.length,function(B){for(var Z=0,he;Z<a;++Z)A[(he=k[Z]).i]=he.x(B);return A.join("")})}var QR=180/Math.PI,Ev={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function EE(s,a,f,p,_,r){var C,A,k;return(C=Math.sqrt(s*s+a*a))&&(s/=C,a/=C),(k=s*f+a*p)&&(f-=s*k,p-=a*k),(A=Math.sqrt(f*f+p*p))&&(f/=A,p/=A,k/=A),s*p<a*f&&(s=-s,a=-a,k=-k,C=-C),{translateX:_,translateY:r,rotate:Math.atan2(a,s)*QR,skewX:Math.atan(k)*QR,scaleX:C,scaleY:A}}var Iv;function JR(s){let a=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(s+"");return a.isIdentity?Ev:EE(a.a,a.b,a.c,a.d,a.e,a.f)}function eO(s){return s==null?Ev:(Iv||(Iv=document.createElementNS("http://www.w3.org/2000/svg","g")),Iv.setAttribute("transform",s),(s=Iv.transform.baseVal.consolidate())?(s=s.matrix,EE(s.a,s.b,s.c,s.d,s.e,s.f)):Ev)}function tO(s,a,f,p){function _(B){return B.length?B.pop()+" ":""}function r(B,Z,he,xe,_e,Je){if(B!==he||Z!==xe){var Ge=_e.push("translate(",null,a,null,f);Je.push({i:Ge-4,x:Oo(B,he)},{i:Ge-2,x:Oo(Z,xe)})}else(he||xe)&&_e.push("translate("+he+a+xe+f)}function C(B,Z,he,xe){B!==Z?(B-Z>180?Z+=360:Z-B>180&&(B+=360),xe.push({i:he.push(_(he)+"rotate(",null,p)-2,x:Oo(B,Z)})):Z&&he.push(_(he)+"rotate("+Z+p)}function A(B,Z,he,xe){B!==Z?xe.push({i:he.push(_(he)+"skewX(",null,p)-2,x:Oo(B,Z)}):Z&&he.push(_(he)+"skewX("+Z+p)}function k(B,Z,he,xe,_e,Je){if(B!==he||Z!==xe){var Ge=_e.push(_(_e)+"scale(",null,",",null,")");Je.push({i:Ge-4,x:Oo(B,he)},{i:Ge-2,x:Oo(Z,xe)})}else(he!==1||xe!==1)&&_e.push(_(_e)+"scale("+he+","+xe+")")}return function(B,Z){var he=[],xe=[];return B=s(B),Z=s(Z),r(B.translateX,B.translateY,Z.translateX,Z.translateY,he,xe),C(B.rotate,Z.rotate,he,xe),A(B.skewX,Z.skewX,he,xe),k(B.scaleX,B.scaleY,Z.scaleX,Z.scaleY,he,xe),B=Z=null,function(_e){for(var Je=-1,Ge=xe.length,Ve;++Je<Ge;)he[(Ve=xe[Je]).i]=Ve.x(_e);return he.join("")}}}var IE=tO(JR,"px, ","px)","deg)"),CE=tO(eO,", ",")",")");var hf=0,ug=0,cg=0,rO=1e3,Cv,hg,Dv=0,eh=0,Sv=0,dg=typeof performance=="object"&&performance.now?performance:Date,iO=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(s){setTimeout(s,17)};function pg(){return eh||(iO(g8),eh=dg.now()+Sv)}function g8(){eh=0}function fg(){this._call=this._time=this._next=null}fg.prototype=df.prototype={constructor:fg,restart:function(s,a,f){if(typeof s!="function")throw new TypeError("callback is not a function");f=(f==null?pg():+f)+(a==null?0:+a),!this._next&&hg!==this&&(hg?hg._next=this:Cv=this,hg=this),this._call=s,this._time=f,DE()},stop:function(){this._call&&(this._call=null,this._time=1/0,DE())}};function df(s,a,f){var p=new fg;return p.restart(s,a,f),p}function oO(){pg(),++hf;for(var s=Cv,a;s;)(a=eh-s._time)>=0&&s._call.call(void 0,a),s=s._next;--hf}function nO(){eh=(Dv=dg.now())+Sv,hf=ug=0;try{oO()}finally{hf=0,y8(),eh=0}}function _8(){var s=dg.now(),a=s-Dv;a>rO&&(Sv-=a,Dv=s)}function y8(){for(var s,a=Cv,f,p=1/0;a;)a._call?(p>a._time&&(p=a._time),s=a,a=a._next):(f=a._next,a._next=null,a=s?s._next=f:Cv=f);hg=s,DE(p)}function DE(s){if(!hf){ug&&(ug=clearTimeout(ug));var a=s-eh;a>24?(s<1/0&&(ug=setTimeout(nO,s-dg.now()-Sv)),cg&&(cg=clearInterval(cg))):(cg||(Dv=dg.now(),cg=setInterval(_8,rO)),hf=1,iO(nO))}}function Mv(s,a,f){var p=new fg;return a=a==null?0:+a,p.restart(_=>{p.stop(),s(_+a)},a,f),p}var v8=Yu("start","end","cancel","interrupt"),x8=[],lO=0,sO=1,Pv=2,Av=3,aO=4,Rv=5,mg=6;function fc(s,a,f,p,_,r){var C=s.__transition;if(!C)s.__transition={};else if(f in C)return;b8(s,f,{name:a,index:p,group:_,on:v8,tween:x8,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:lO})}function gg(s,a){var f=ti(s,a);if(f.state>lO)throw new Error("too late; already scheduled");return f}function gi(s,a){var f=ti(s,a);if(f.state>Av)throw new Error("too late; already running");return f}function ti(s,a){var f=s.__transition;if(!f||!(f=f[a]))throw new Error("transition not found");return f}function b8(s,a,f){var p=s.__transition,_;p[a]=f,f.timer=df(r,0,f.time);function r(B){f.state=sO,f.timer.restart(C,f.delay,f.time),f.delay<=B&&C(B-f.delay)}function C(B){var Z,he,xe,_e;if(f.state!==sO)return k();for(Z in p)if(_e=p[Z],_e.name===f.name){if(_e.state===Av)return Mv(C);_e.state===aO?(_e.state=mg,_e.timer.stop(),_e.on.call("interrupt",s,s.__data__,_e.index,_e.group),delete p[Z]):+Z<a&&(_e.state=mg,_e.timer.stop(),_e.on.call("cancel",s,s.__data__,_e.index,_e.group),delete p[Z])}if(Mv(function(){f.state===Av&&(f.state=aO,f.timer.restart(A,f.delay,f.time),A(B))}),f.state=Pv,f.on.call("start",s,s.__data__,f.index,f.group),f.state===Pv){for(f.state=Av,_=new Array(xe=f.tween.length),Z=0,he=-1;Z<xe;++Z)(_e=f.tween[Z].value.call(s,s.__data__,f.index,f.group))&&(_[++he]=_e);_.length=he+1}}function A(B){for(var Z=B<f.duration?f.ease.call(null,B/f.duration):(f.timer.restart(k),f.state=Rv,1),he=-1,xe=_.length;++he<xe;)_[he].call(s,Z);f.state===Rv&&(f.on.call("end",s,s.__data__,f.index,f.group),k())}function k(){f.state=mg,f.timer.stop(),delete p[a];for(var B in p)return;delete s.__transition}}function Ov(s,a){var f=s.__transition,p,_,r=!0,C;if(f){a=a==null?null:a+"";for(C in f){if((p=f[C]).name!==a){r=!1;continue}_=p.state>Pv&&p.state<Rv,p.state=mg,p.timer.stop(),p.on.call(_?"interrupt":"cancel",s,s.__data__,p.index,p.group),delete f[C]}r&&delete s.__transition}}function cO(s){return this.each(function(){Ov(this,s)})}function w8(s,a){var f,p;return function(){var _=gi(this,s),r=_.tween;if(r!==f){p=f=r;for(var C=0,A=p.length;C<A;++C)if(p[C].name===a){p=p.slice(),p.splice(C,1);break}}_.tween=p}}function T8(s,a,f){var p,_;if(typeof f!="function")throw new Error;return function(){var r=gi(this,s),C=r.tween;if(C!==p){_=(p=C).slice();for(var A={name:a,value:f},k=0,B=_.length;k<B;++k)if(_[k].name===a){_[k]=A;break}k===B&&_.push(A)}r.tween=_}}function uO(s,a){var f=this._id;if(s+="",arguments.length<2){for(var p=ti(this.node(),f).tween,_=0,r=p.length,C;_<r;++_)if((C=p[_]).name===s)return C.value;return null}return this.each((a==null?w8:T8)(f,s,a))}function ff(s,a,f){var p=s._id;return s.each(function(){var _=gi(this,p);(_.value||(_.value={}))[a]=f.apply(this,arguments)}),function(_){return ti(_,p).value[a]}}function kv(s,a){var f;return(typeof a=="number"?Oo:a instanceof dc?Tv:(f=dc(a))?(a=f,Tv):TE)(s,a)}function E8(s){return function(){this.removeAttribute(s)}}function I8(s){return function(){this.removeAttributeNS(s.space,s.local)}}function C8(s,a,f){var p,_=f+"",r;return function(){var C=this.getAttribute(s);return C===_?null:C===p?r:r=a(p=C,f)}}function D8(s,a,f){var p,_=f+"",r;return function(){var C=this.getAttributeNS(s.space,s.local);return C===_?null:C===p?r:r=a(p=C,f)}}function S8(s,a,f){var p,_,r;return function(){var C,A=f(this),k;return A==null?void this.removeAttribute(s):(C=this.getAttribute(s),k=A+"",C===k?null:C===p&&k===_?r:(_=k,r=a(p=C,A)))}}function M8(s,a,f){var p,_,r;return function(){var C,A=f(this),k;return A==null?void this.removeAttributeNS(s.space,s.local):(C=this.getAttributeNS(s.space,s.local),k=A+"",C===k?null:C===p&&k===_?r:(_=k,r=a(p=C,A)))}}function hO(s,a){var f=Na(s),p=f==="transform"?CE:kv;return this.attrTween(s,typeof a=="function"?(f.local?M8:S8)(f,p,ff(this,"attr."+s,a)):a==null?(f.local?I8:E8)(f):(f.local?D8:C8)(f,p,a))}function A8(s,a){return function(f){this.setAttribute(s,a.call(this,f))}}function P8(s,a){return function(f){this.setAttributeNS(s.space,s.local,a.call(this,f))}}function R8(s,a){var f,p;function _(){var r=a.apply(this,arguments);return r!==p&&(f=(p=r)&&P8(s,r)),f}return _._value=a,_}function O8(s,a){var f,p;function _(){var r=a.apply(this,arguments);return r!==p&&(f=(p=r)&&A8(s,r)),f}return _._value=a,_}function dO(s,a){var f="attr."+s;if(arguments.length<2)return(f=this.tween(f))&&f._value;if(a==null)return this.tween(f,null);if(typeof a!="function")throw new Error;var p=Na(s);return this.tween(f,(p.local?R8:O8)(p,a))}function k8(s,a){return function(){gg(this,s).delay=+a.apply(this,arguments)}}function L8(s,a){return a=+a,function(){gg(this,s).delay=a}}function fO(s){var a=this._id;return arguments.length?this.each((typeof s=="function"?k8:L8)(a,s)):ti(this.node(),a).delay}function F8(s,a){return function(){gi(this,s).duration=+a.apply(this,arguments)}}function N8(s,a){return a=+a,function(){gi(this,s).duration=a}}function pO(s){var a=this._id;return arguments.length?this.each((typeof s=="function"?F8:N8)(a,s)):ti(this.node(),a).duration}function z8(s,a){if(typeof a!="function")throw new Error;return function(){gi(this,s).ease=a}}function mO(s){var a=this._id;return arguments.length?this.each(z8(a,s)):ti(this.node(),a).ease}function B8(s,a){return function(){var f=a.apply(this,arguments);if(typeof f!="function")throw new Error;gi(this,s).ease=f}}function gO(s){if(typeof s!="function")throw new Error;return this.each(B8(this._id,s))}function _O(s){typeof s!="function"&&(s=tg(s));for(var a=this._groups,f=a.length,p=new Array(f),_=0;_<f;++_)for(var r=a[_],C=r.length,A=p[_]=[],k,B=0;B<C;++B)(k=r[B])&&s.call(k,k.__data__,B,r)&&A.push(k);return new Ai(p,this._parents,this._name,this._id)}function yO(s){if(s._id!==this._id)throw new Error;for(var a=this._groups,f=s._groups,p=a.length,_=f.length,r=Math.min(p,_),C=new Array(p),A=0;A<r;++A)for(var k=a[A],B=f[A],Z=k.length,he=C[A]=new Array(Z),xe,_e=0;_e<Z;++_e)(xe=k[_e]||B[_e])&&(he[_e]=xe);for(;A<p;++A)C[A]=a[A];return new Ai(C,this._parents,this._name,this._id)}function V8(s){return(s+"").trim().split(/^|\s+/).every(function(a){var f=a.indexOf(".");return f>=0&&(a=a.slice(0,f)),!a||a==="start"})}function j8(s,a,f){var p,_,r=V8(a)?gg:gi;return function(){var C=r(this,s),A=C.on;A!==p&&(_=(p=A).copy()).on(a,f),C.on=_}}function vO(s,a){var f=this._id;return arguments.length<2?ti(this.node(),f).on.on(s):this.each(j8(f,s,a))}function U8(s){return function(){var a=this.parentNode;for(var f in this.__transition)if(+f!==s)return;a&&a.removeChild(this)}}function xO(){return this.on("end.remove",U8(this._id))}function bO(s){var a=this._name,f=this._id;typeof s!="function"&&(s=Xu(s));for(var p=this._groups,_=p.length,r=new Array(_),C=0;C<_;++C)for(var A=p[C],k=A.length,B=r[C]=new Array(k),Z,he,xe=0;xe<k;++xe)(Z=A[xe])&&(he=s.call(Z,Z.__data__,xe,A))&&("__data__"in Z&&(he.__data__=Z.__data__),B[xe]=he,fc(B[xe],a,f,xe,B,ti(Z,f)));return new Ai(r,this._parents,a,f)}function wO(s){var a=this._name,f=this._id;typeof s!="function"&&(s=eg(s));for(var p=this._groups,_=p.length,r=[],C=[],A=0;A<_;++A)for(var k=p[A],B=k.length,Z,he=0;he<B;++he)if(Z=k[he]){for(var xe=s.call(Z,Z.__data__,he,k),_e,Je=ti(Z,f),Ge=0,Ve=xe.length;Ge<Ve;++Ge)(_e=xe[Ge])&&fc(_e,a,f,Ge,xe,Je);r.push(xe),C.push(Z)}return new Ai(r,C,a,f)}var $8=za.prototype.constructor;function TO(){return new $8(this._groups,this._parents)}function G8(s,a){var f,p,_;return function(){var r=uc(this,s),C=(this.style.removeProperty(s),uc(this,s));return r===C?null:r===f&&C===p?_:_=a(f=r,p=C)}}function EO(s){return function(){this.style.removeProperty(s)}}function H8(s,a,f){var p,_=f+"",r;return function(){var C=uc(this,s);return C===_?null:C===p?r:r=a(p=C,f)}}function q8(s,a,f){var p,_,r;return function(){var C=uc(this,s),A=f(this),k=A+"";return A==null&&(k=A=(this.style.removeProperty(s),uc(this,s))),C===k?null:C===p&&k===_?r:(_=k,r=a(p=C,A))}}function W8(s,a){var f,p,_,r="style."+a,C="end."+r,A;return function(){var k=gi(this,s),B=k.on,Z=k.value[r]==null?A||(A=EO(a)):void 0;(B!==f||_!==Z)&&(p=(f=B).copy()).on(C,_=Z),k.on=p}}function IO(s,a,f){var p=(s+="")=="transform"?IE:kv;return a==null?this.styleTween(s,G8(s,p)).on("end.style."+s,EO(s)):typeof a=="function"?this.styleTween(s,q8(s,p,ff(this,"style."+s,a))).each(W8(this._id,s)):this.styleTween(s,H8(s,p,a),f).on("end.style."+s,null)}function Z8(s,a,f){return function(p){this.style.setProperty(s,a.call(this,p),f)}}function Y8(s,a,f){var p,_;function r(){var C=a.apply(this,arguments);return C!==_&&(p=(_=C)&&Z8(s,C,f)),p}return r._value=a,r}function CO(s,a,f){var p="style."+(s+="");if(arguments.length<2)return(p=this.tween(p))&&p._value;if(a==null)return this.tween(p,null);if(typeof a!="function")throw new Error;return this.tween(p,Y8(s,a,f??""))}function X8(s){return function(){this.textContent=s}}function K8(s){return function(){var a=s(this);this.textContent=a??""}}function DO(s){return this.tween("text",typeof s=="function"?K8(ff(this,"text",s)):X8(s==null?"":s+""))}function Q8(s){return function(a){this.textContent=s.call(this,a)}}function J8(s){var a,f;function p(){var _=s.apply(this,arguments);return _!==f&&(a=(f=_)&&Q8(_)),a}return p._value=s,p}function SO(s){var a="text";if(arguments.length<1)return(a=this.tween(a))&&a._value;if(s==null)return this.tween(a,null);if(typeof s!="function")throw new Error;return this.tween(a,J8(s))}function MO(){for(var s=this._name,a=this._id,f=Lv(),p=this._groups,_=p.length,r=0;r<_;++r)for(var C=p[r],A=C.length,k,B=0;B<A;++B)if(k=C[B]){var Z=ti(k,a);fc(k,s,f,B,C,{time:Z.time+Z.delay+Z.duration,delay:0,duration:Z.duration,ease:Z.ease})}return new Ai(p,this._parents,s,f)}function AO(){var s,a,f=this,p=f._id,_=f.size();return new Promise(function(r,C){var A={value:C},k={value:function(){--_===0&&r()}};f.each(function(){var B=gi(this,p),Z=B.on;Z!==s&&(a=(s=Z).copy(),a._.cancel.push(A),a._.interrupt.push(A),a._.end.push(k)),B.on=a}),_===0&&r()})}var e$=0;function Ai(s,a,f,p){this._groups=s,this._parents=a,this._name=f,this._id=p}function PO(s){return za().transition(s)}function Lv(){return++e$}var Ba=za.prototype;Ai.prototype=PO.prototype={constructor:Ai,select:bO,selectAll:wO,selectChild:Ba.selectChild,selectChildren:Ba.selectChildren,filter:_O,merge:yO,selection:TO,transition:MO,call:Ba.call,nodes:Ba.nodes,node:Ba.node,size:Ba.size,empty:Ba.empty,each:Ba.each,on:vO,attr:hO,attrTween:dO,style:IO,styleTween:CO,text:DO,textTween:SO,remove:xO,tween:uO,delay:fO,duration:pO,ease:mO,easeVarying:gO,end:AO,[Symbol.iterator]:Ba[Symbol.iterator]};function Fv(s){return((s*=2)<=1?s*s*s:(s-=2)*s*s+2)/2}var t$={time:null,delay:0,duration:250,ease:Fv};function n$(s,a){for(var f;!(f=s.__transition)||!(f=f[a]);)if(!(s=s.parentNode))throw new Error(`transition ${a} not found`);return f}function RO(s){var a,f;s instanceof Ai?(a=s._id,s=s._name):(a=Lv(),(f=t$).time=pg(),s=s==null?null:s+"");for(var p=this._groups,_=p.length,r=0;r<_;++r)for(var C=p[r],A=C.length,k,B=0;B<A;++B)(k=C[B])&&fc(k,s,a,B,C,f||n$(k,a));return new Ai(p,this._parents,s,a)}za.prototype.interrupt=cO;za.prototype.transition=RO;var{abs:Dee,max:See,min:Mee}=Math;function OO(s){return[+s[0],+s[1]]}function r$(s){return[OO(s[0]),OO(s[1])]}var Aee={name:"x",handles:["w","e"].map(SE),input:function(s,a){return s==null?null:[[+s[0],a[0][1]],[+s[1],a[1][1]]]},output:function(s){return s&&[s[0][0],s[1][0]]}},Pee={name:"y",handles:["n","s"].map(SE),input:function(s,a){return s==null?null:[[a[0][0],+s[0]],[a[1][0],+s[1]]]},output:function(s){return s&&[s[0][1],s[1][1]]}},Ree={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(SE),input:function(s){return s==null?null:r$(s)},output:function(s){return s}};function SE(s){return{type:s}}function kO(s){let a=+this._x.call(null,s),f=+this._y.call(null,s);return LO(this.cover(a,f),a,f,s)}function LO(s,a,f,p){if(isNaN(a)||isNaN(f))return s;var _,r=s._root,C={data:p},A=s._x0,k=s._y0,B=s._x1,Z=s._y1,he,xe,_e,Je,Ge,Ve,We,ct;if(!r)return s._root=C,s;for(;r.length;)if((Ge=a>=(he=(A+B)/2))?A=he:B=he,(Ve=f>=(xe=(k+Z)/2))?k=xe:Z=xe,_=r,!(r=r[We=Ve<<1|Ge]))return _[We]=C,s;if(_e=+s._x.call(null,r.data),Je=+s._y.call(null,r.data),a===_e&&f===Je)return C.next=r,_?_[We]=C:s._root=C,s;do _=_?_[We]=new Array(4):s._root=new Array(4),(Ge=a>=(he=(A+B)/2))?A=he:B=he,(Ve=f>=(xe=(k+Z)/2))?k=xe:Z=xe;while((We=Ve<<1|Ge)===(ct=(Je>=xe)<<1|_e>=he));return _[ct]=r,_[We]=C,s}function FO(s){var a,f,p=s.length,_,r,C=new Array(p),A=new Array(p),k=1/0,B=1/0,Z=-1/0,he=-1/0;for(f=0;f<p;++f)isNaN(_=+this._x.call(null,a=s[f]))||isNaN(r=+this._y.call(null,a))||(C[f]=_,A[f]=r,_<k&&(k=_),_>Z&&(Z=_),r<B&&(B=r),r>he&&(he=r));if(k>Z||B>he)return this;for(this.cover(k,B).cover(Z,he),f=0;f<p;++f)LO(this,C[f],A[f],s[f]);return this}function NO(s,a){if(isNaN(s=+s)||isNaN(a=+a))return this;var f=this._x0,p=this._y0,_=this._x1,r=this._y1;if(isNaN(f))_=(f=Math.floor(s))+1,r=(p=Math.floor(a))+1;else{for(var C=_-f||1,A=this._root,k,B;f>s||s>=_||p>a||a>=r;)switch(B=(a<p)<<1|s<f,k=new Array(4),k[B]=A,A=k,C*=2,B){case 0:_=f+C,r=p+C;break;case 1:f=_-C,r=p+C;break;case 2:_=f+C,p=r-C;break;case 3:f=_-C,p=r-C;break}this._root&&this._root.length&&(this._root=A)}return this._x0=f,this._y0=p,this._x1=_,this._y1=r,this}function zO(){var s=[];return this.visit(function(a){if(!a.length)do s.push(a.data);while(a=a.next)}),s}function BO(s){return arguments.length?this.cover(+s[0][0],+s[0][1]).cover(+s[1][0],+s[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function li(s,a,f,p,_){this.node=s,this.x0=a,this.y0=f,this.x1=p,this.y1=_}function VO(s,a,f){var p,_=this._x0,r=this._y0,C,A,k,B,Z=this._x1,he=this._y1,xe=[],_e=this._root,Je,Ge;for(_e&&xe.push(new li(_e,_,r,Z,he)),f==null?f=1/0:(_=s-f,r=a-f,Z=s+f,he=a+f,f*=f);Je=xe.pop();)if(!(!(_e=Je.node)||(C=Je.x0)>Z||(A=Je.y0)>he||(k=Je.x1)<_||(B=Je.y1)<r))if(_e.length){var Ve=(C+k)/2,We=(A+B)/2;xe.push(new li(_e[3],Ve,We,k,B),new li(_e[2],C,We,Ve,B),new li(_e[1],Ve,A,k,We),new li(_e[0],C,A,Ve,We)),(Ge=(a>=We)<<1|s>=Ve)&&(Je=xe[xe.length-1],xe[xe.length-1]=xe[xe.length-1-Ge],xe[xe.length-1-Ge]=Je)}else{var ct=s-+this._x.call(null,_e.data),gt=a-+this._y.call(null,_e.data),Be=ct*ct+gt*gt;if(Be<f){var St=Math.sqrt(f=Be);_=s-St,r=a-St,Z=s+St,he=a+St,p=_e.data}}return p}function jO(s){if(isNaN(Z=+this._x.call(null,s))||isNaN(he=+this._y.call(null,s)))return this;var a,f=this._root,p,_,r,C=this._x0,A=this._y0,k=this._x1,B=this._y1,Z,he,xe,_e,Je,Ge,Ve,We;if(!f)return this;if(f.length)for(;;){if((Je=Z>=(xe=(C+k)/2))?C=xe:k=xe,(Ge=he>=(_e=(A+B)/2))?A=_e:B=_e,a=f,!(f=f[Ve=Ge<<1|Je]))return this;if(!f.length)break;(a[Ve+1&3]||a[Ve+2&3]||a[Ve+3&3])&&(p=a,We=Ve)}for(;f.data!==s;)if(_=f,!(f=f.next))return this;return(r=f.next)&&delete f.next,_?(r?_.next=r:delete _.next,this):a?(r?a[Ve]=r:delete a[Ve],(f=a[0]||a[1]||a[2]||a[3])&&f===(a[3]||a[2]||a[1]||a[0])&&!f.length&&(p?p[We]=f:this._root=f),this):(this._root=r,this)}function UO(s){for(var a=0,f=s.length;a<f;++a)this.remove(s[a]);return this}function $O(){return this._root}function GO(){var s=0;return this.visit(function(a){if(!a.length)do++s;while(a=a.next)}),s}function HO(s){var a=[],f,p=this._root,_,r,C,A,k;for(p&&a.push(new li(p,this._x0,this._y0,this._x1,this._y1));f=a.pop();)if(!s(p=f.node,r=f.x0,C=f.y0,A=f.x1,k=f.y1)&&p.length){var B=(r+A)/2,Z=(C+k)/2;(_=p[3])&&a.push(new li(_,B,Z,A,k)),(_=p[2])&&a.push(new li(_,r,Z,B,k)),(_=p[1])&&a.push(new li(_,B,C,A,Z)),(_=p[0])&&a.push(new li(_,r,C,B,Z))}return this}function qO(s){var a=[],f=[],p;for(this._root&&a.push(new li(this._root,this._x0,this._y0,this._x1,this._y1));p=a.pop();){var _=p.node;if(_.length){var r,C=p.x0,A=p.y0,k=p.x1,B=p.y1,Z=(C+k)/2,he=(A+B)/2;(r=_[0])&&a.push(new li(r,C,A,Z,he)),(r=_[1])&&a.push(new li(r,Z,A,k,he)),(r=_[2])&&a.push(new li(r,C,he,Z,B)),(r=_[3])&&a.push(new li(r,Z,he,k,B))}f.push(p)}for(;p=f.pop();)s(p.node,p.x0,p.y0,p.x1,p.y1);return this}function WO(s){return s[0]}function ZO(s){return arguments.length?(this._x=s,this):this._x}function YO(s){return s[1]}function XO(s){return arguments.length?(this._y=s,this):this._y}function th(s,a,f){var p=new ME(a??WO,f??YO,NaN,NaN,NaN,NaN);return s==null?p:p.addAll(s)}function ME(s,a,f,p,_,r){this._x=s,this._y=a,this._x0=f,this._y0=p,this._x1=_,this._y1=r,this._root=void 0}function KO(s){for(var a={data:s.data},f=a;s=s.next;)f=f.next={data:s.data};return a}var Pi=th.prototype=ME.prototype;Pi.copy=function(){var s=new ME(this._x,this._y,this._x0,this._y0,this._x1,this._y1),a=this._root,f,p;if(!a)return s;if(!a.length)return s._root=KO(a),s;for(f=[{source:a,target:s._root=new Array(4)}];a=f.pop();)for(var _=0;_<4;++_)(p=a.source[_])&&(p.length?f.push({source:p,target:a.target[_]=new Array(4)}):a.target[_]=KO(p));return s};Pi.add=kO;Pi.addAll=FO;Pi.cover=NO;Pi.data=zO;Pi.extent=BO;Pi.find=VO;Pi.remove=jO;Pi.removeAll=UO;Pi.root=$O;Pi.size=GO;Pi.visit=HO;Pi.visitAfter=qO;Pi.x=ZO;Pi.y=XO;function Vr(s){return function(){return s}}function ls(s){return(s()-.5)*1e-6}function i$(s){return s.x+s.vx}function o$(s){return s.y+s.vy}function Nv(s){var a,f,p,_=1,r=1;typeof s!="function"&&(s=Vr(s==null?1:+s));function C(){for(var B,Z=a.length,he,xe,_e,Je,Ge,Ve,We=0;We<r;++We)for(he=th(a,i$,o$).visitAfter(A),B=0;B<Z;++B)xe=a[B],Ge=f[xe.index],Ve=Ge*Ge,_e=xe.x+xe.vx,Je=xe.y+xe.vy,he.visit(ct);function ct(gt,Be,St,qt,dn){var Tt=gt.data,Gn=gt.r,wt=Ge+Gn;if(Tt){if(Tt.index>xe.index){var ar=_e-Tt.x-Tt.vx,jr=Je-Tt.y-Tt.vy,Ur=ar*ar+jr*jr;Ur<wt*wt&&(ar===0&&(ar=ls(p),Ur+=ar*ar),jr===0&&(jr=ls(p),Ur+=jr*jr),Ur=(wt-(Ur=Math.sqrt(Ur)))/Ur*_,xe.vx+=(ar*=Ur)*(wt=(Gn*=Gn)/(Ve+Gn)),xe.vy+=(jr*=Ur)*wt,Tt.vx-=ar*(wt=1-wt),Tt.vy-=jr*wt)}return}return Be>_e+wt||qt<_e-wt||St>Je+wt||dn<Je-wt}}function A(B){if(B.data)return B.r=f[B.data.index];for(var Z=B.r=0;Z<4;++Z)B[Z]&&B[Z].r>B.r&&(B.r=B[Z].r)}function k(){if(a){var B,Z=a.length,he;for(f=new Array(Z),B=0;B<Z;++B)he=a[B],f[he.index]=+s(he,B,a)}}return C.initialize=function(B,Z){a=B,p=Z,k()},C.iterations=function(B){return arguments.length?(r=+B,C):r},C.strength=function(B){return arguments.length?(_=+B,C):_},C.radius=function(B){return arguments.length?(s=typeof B=="function"?B:Vr(+B),k(),C):s},C}function s$(s){return s.index}function QO(s,a){var f=s.get(a);if(!f)throw new Error("node not found: "+a);return f}function zv(s){var a=s$,f=he,p,_=Vr(30),r,C,A,k,B,Z=1;s==null&&(s=[]);function he(Ve){return 1/Math.min(A[Ve.source.index],A[Ve.target.index])}function xe(Ve){for(var We=0,ct=s.length;We<Z;++We)for(var gt=0,Be,St,qt,dn,Tt,Gn,wt;gt<ct;++gt)Be=s[gt],St=Be.source,qt=Be.target,dn=qt.x+qt.vx-St.x-St.vx||ls(B),Tt=qt.y+qt.vy-St.y-St.vy||ls(B),Gn=Math.sqrt(dn*dn+Tt*Tt),Gn=(Gn-r[gt])/Gn*Ve*p[gt],dn*=Gn,Tt*=Gn,qt.vx-=dn*(wt=k[gt]),qt.vy-=Tt*wt,St.vx+=dn*(wt=1-wt),St.vy+=Tt*wt}function _e(){if(C){var Ve,We=C.length,ct=s.length,gt=new Map(C.map((St,qt)=>[a(St,qt,C),St])),Be;for(Ve=0,A=new Array(We);Ve<ct;++Ve)Be=s[Ve],Be.index=Ve,typeof Be.source!="object"&&(Be.source=QO(gt,Be.source)),typeof Be.target!="object"&&(Be.target=QO(gt,Be.target)),A[Be.source.index]=(A[Be.source.index]||0)+1,A[Be.target.index]=(A[Be.target.index]||0)+1;for(Ve=0,k=new Array(ct);Ve<ct;++Ve)Be=s[Ve],k[Ve]=A[Be.source.index]/(A[Be.source.index]+A[Be.target.index]);p=new Array(ct),Je(),r=new Array(ct),Ge()}}function Je(){if(C)for(var Ve=0,We=s.length;Ve<We;++Ve)p[Ve]=+f(s[Ve],Ve,s)}function Ge(){if(C)for(var Ve=0,We=s.length;Ve<We;++Ve)r[Ve]=+_(s[Ve],Ve,s)}return xe.initialize=function(Ve,We){C=Ve,B=We,_e()},xe.links=function(Ve){return arguments.length?(s=Ve,_e(),xe):s},xe.id=function(Ve){return arguments.length?(a=Ve,xe):a},xe.iterations=function(Ve){return arguments.length?(Z=+Ve,xe):Z},xe.strength=function(Ve){return arguments.length?(f=typeof Ve=="function"?Ve:Vr(+Ve),Je(),xe):f},xe.distance=function(Ve){return arguments.length?(_=typeof Ve=="function"?Ve:Vr(+Ve),Ge(),xe):_},xe}function JO(){let s=1;return()=>(s=(1664525*s+1013904223)%4294967296)/4294967296}function ek(s){return s.x}function tk(s){return s.y}var a$=10,l$=Math.PI*(3-Math.sqrt(5));function Bv(s){var a,f=1,p=.001,_=1-Math.pow(p,1/300),r=0,C=.6,A=new Map,k=df(he),B=Yu("tick","end"),Z=JO();s==null&&(s=[]);function he(){xe(),B.call("tick",a),f<p&&(k.stop(),B.call("end",a))}function xe(Ge){var Ve,We=s.length,ct;Ge===void 0&&(Ge=1);for(var gt=0;gt<Ge;++gt)for(f+=(r-f)*_,A.forEach(function(Be){Be(f)}),Ve=0;Ve<We;++Ve)ct=s[Ve],ct.fx==null?ct.x+=ct.vx*=C:(ct.x=ct.fx,ct.vx=0),ct.fy==null?ct.y+=ct.vy*=C:(ct.y=ct.fy,ct.vy=0);return a}function _e(){for(var Ge=0,Ve=s.length,We;Ge<Ve;++Ge){if(We=s[Ge],We.index=Ge,We.fx!=null&&(We.x=We.fx),We.fy!=null&&(We.y=We.fy),isNaN(We.x)||isNaN(We.y)){var ct=a$*Math.sqrt(.5+Ge),gt=Ge*l$;We.x=ct*Math.cos(gt),We.y=ct*Math.sin(gt)}(isNaN(We.vx)||isNaN(We.vy))&&(We.vx=We.vy=0)}}function Je(Ge){return Ge.initialize&&Ge.initialize(s,Z),Ge}return _e(),a={tick:xe,restart:function(){return k.restart(he),a},stop:function(){return k.stop(),a},nodes:function(Ge){return arguments.length?(s=Ge,_e(),A.forEach(Je),a):s},alpha:function(Ge){return arguments.length?(f=+Ge,a):f},alphaMin:function(Ge){return arguments.length?(p=+Ge,a):p},alphaDecay:function(Ge){return arguments.length?(_=+Ge,a):+_},alphaTarget:function(Ge){return arguments.length?(r=+Ge,a):r},velocityDecay:function(Ge){return arguments.length?(C=1-Ge,a):1-C},randomSource:function(Ge){return arguments.length?(Z=Ge,A.forEach(Je),a):Z},force:function(Ge,Ve){return arguments.length>1?(Ve==null?A.delete(Ge):A.set(Ge,Je(Ve)),a):A.get(Ge)},find:function(Ge,Ve,We){var ct=0,gt=s.length,Be,St,qt,dn,Tt;for(We==null?We=1/0:We*=We,ct=0;ct<gt;++ct)dn=s[ct],Be=Ge-dn.x,St=Ve-dn.y,qt=Be*Be+St*St,qt<We&&(Tt=dn,We=qt);return Tt},on:function(Ge,Ve){return arguments.length>1?(B.on(Ge,Ve),a):B.on(Ge)}}}function Vv(){var s,a,f,p,_=Vr(-30),r,C=1,A=1/0,k=.81;function B(_e){var Je,Ge=s.length,Ve=th(s,ek,tk).visitAfter(he);for(p=_e,Je=0;Je<Ge;++Je)a=s[Je],Ve.visit(xe)}function Z(){if(s){var _e,Je=s.length,Ge;for(r=new Array(Je),_e=0;_e<Je;++_e)Ge=s[_e],r[Ge.index]=+_(Ge,_e,s)}}function he(_e){var Je=0,Ge,Ve,We=0,ct,gt,Be;if(_e.length){for(ct=gt=Be=0;Be<4;++Be)(Ge=_e[Be])&&(Ve=Math.abs(Ge.value))&&(Je+=Ge.value,We+=Ve,ct+=Ve*Ge.x,gt+=Ve*Ge.y);_e.x=ct/We,_e.y=gt/We}else{Ge=_e,Ge.x=Ge.data.x,Ge.y=Ge.data.y;do Je+=r[Ge.data.index];while(Ge=Ge.next)}_e.value=Je}function xe(_e,Je,Ge,Ve){if(!_e.value)return!0;var We=_e.x-a.x,ct=_e.y-a.y,gt=Ve-Je,Be=We*We+ct*ct;if(gt*gt/k<Be)return Be<A&&(We===0&&(We=ls(f),Be+=We*We),ct===0&&(ct=ls(f),Be+=ct*ct),Be<C&&(Be=Math.sqrt(C*Be)),a.vx+=We*_e.value*p/Be,a.vy+=ct*_e.value*p/Be),!0;if(_e.length||Be>=A)return;(_e.data!==a||_e.next)&&(We===0&&(We=ls(f),Be+=We*We),ct===0&&(ct=ls(f),Be+=ct*ct),Be<C&&(Be=Math.sqrt(C*Be)));do _e.data!==a&&(gt=r[_e.data.index]*p/Be,a.vx+=We*gt,a.vy+=ct*gt);while(_e=_e.next)}return B.initialize=function(_e,Je){s=_e,f=Je,Z()},B.strength=function(_e){return arguments.length?(_=typeof _e=="function"?_e:Vr(+_e),Z(),B):_},B.distanceMin=function(_e){return arguments.length?(C=_e*_e,B):Math.sqrt(C)},B.distanceMax=function(_e){return arguments.length?(A=_e*_e,B):Math.sqrt(A)},B.theta=function(_e){return arguments.length?(k=_e*_e,B):Math.sqrt(k)},B}function jv(s){var a=Vr(.1),f,p,_;typeof s!="function"&&(s=Vr(s==null?0:+s));function r(A){for(var k=0,B=f.length,Z;k<B;++k)Z=f[k],Z.vx+=(_[k]-Z.x)*p[k]*A}function C(){if(f){var A,k=f.length;for(p=new Array(k),_=new Array(k),A=0;A<k;++A)p[A]=isNaN(_[A]=+s(f[A],A,f))?0:+a(f[A],A,f)}}return r.initialize=function(A){f=A,C()},r.strength=function(A){return arguments.length?(a=typeof A=="function"?A:Vr(+A),C(),r):a},r.x=function(A){return arguments.length?(s=typeof A=="function"?A:Vr(+A),C(),r):s},r}function Uv(s){var a=Vr(.1),f,p,_;typeof s!="function"&&(s=Vr(s==null?0:+s));function r(A){for(var k=0,B=f.length,Z;k<B;++k)Z=f[k],Z.vy+=(_[k]-Z.y)*p[k]*A}function C(){if(f){var A,k=f.length;for(p=new Array(k),_=new Array(k),A=0;A<k;++A)p[A]=isNaN(_[A]=+s(f[A],A,f))?0:+a(f[A],A,f)}}return r.initialize=function(A){f=A,C()},r.strength=function(A){return arguments.length?(a=typeof A=="function"?A:Vr(+A),C(),r):a},r.y=function(A){return arguments.length?(s=typeof A=="function"?A:Vr(+A),C(),r):s},r}function pc(s,a,f){this.k=s,this.x=a,this.y=f}pc.prototype={constructor:pc,scale:function(s){return s===1?this:new pc(this.k*s,this.x,this.y)},translate:function(s,a){return s===0&a===0?this:new pc(this.k,this.x+this.k*s,this.y+this.k*a)},apply:function(s){return[s[0]*this.k+this.x,s[1]*this.k+this.y]},applyX:function(s){return s*this.k+this.x},applyY:function(s){return s*this.k+this.y},invert:function(s){return[(s[0]-this.x)/this.k,(s[1]-this.y)/this.k]},invertX:function(s){return(s-this.x)/this.k},invertY:function(s){return(s-this.y)/this.k},rescaleX:function(s){return s.copy().domain(s.range().map(this.invertX,this).map(s.invert,s))},rescaleY:function(s){return s.copy().domain(s.range().map(this.invertY,this).map(s.invert,s))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var AE=new pc(1,0,0);PE.prototype=pc.prototype;function PE(s){for(;!s.__zoom;)if(!(s=s.parentNode))return AE;return s.__zoom}function nk(s){return typeof s=="string"}function rk(s){return typeof s=="number"&&Number(s)==s}function Hv(s,a=0,f="0"){return typeof s!="string"&&(s=s.toString()),a>s.length?Array(a-s.length+1).join(f)+s:s}function RE(s){let a,f,p,_=s.h,r=s.s,C=s.l;if(r==0)a=f=p=C;else{let A=function(he,xe,_e){return _e<0&&(_e+=1),_e>1&&(_e-=1),_e<.16666666666666666?he+(xe-he)*6*_e:_e<.5?xe:_e<.6666666666666666?he+(xe-he)*(.6666666666666666-_e)*6:he},k=C<.5?C*(1+r):C+r-C*r,B=2*C-k;a=A(B,k,_+1/3),f=A(B,k,_),p=A(B,k,_-1/3)}return{r:Math.round(a*255),g:Math.round(f*255),b:Math.round(p*255)}}function OE(s){let a=s.r/255,f=s.g/255,p=s.b/255,_=Math.max(a,f,p),r=Math.min(a,f,p),C=0,A=0,k=(_+r)/2;if(_===r)C=A=0;else{let B=_-r;switch(A=k>.5?B/(2-_-r):B/(_+r),_){case a:C=(f-p)/B+(f<p?6:0);break;case f:C=(p-a)/B+2;break;case p:C=(a-f)/B+4;break}C/=6}return{h:C,s:A,l:k}}function ok(s,a){return s&&{r:Math.max(0,Math.min(255,s.r+Gv(s.r,a))),g:Math.max(0,Math.min(255,s.g+Gv(s.g,a))),b:Math.max(0,Math.min(255,s.b+Gv(s.b,a))),a:s.a}}function Gv(s,a){let f=a>0?255-s:s;return Math.round(f*a)}function sk(s,a){if(s){let f=Math.min(Math.max(s.r,s.g,s.b),230),p=Gv(f,a);return{r:Math.max(0,Math.min(255,Math.round(s.r+p))),g:Math.max(0,Math.min(255,Math.round(s.g+p))),b:Math.max(0,Math.min(255,Math.round(s.b+p))),a:s.a}}else return s}function ik(s){return(s.r*299+s.g*587+s.b*114)/1e3>=128}function ak(s,a){if(s===void 0||a==1)return s;let f=OE(s);return f.s=a,RE(f)}function lk(s,a={r:255,g:255,b:255},f={r:255,g:255,b:255}){let p=a,_=f;return ik(f)&&(p=f,_=a),ik(s)?_:p}function ck(s){return s[0]==="#"&&(s=s.substr(1)),s.length==3&&(s=s[0].repeat(2)+s[1].repeat(2)+s[2].repeat(2)),parseInt(s,16)}function h$(s){s=s.replace(/[ ]/g,"");let a=s.match(/^rgb\(([0-9]*),([0-9]*),([0-9]*)\)/i);if(a)a.push("1");else if(a=s.match(/^rgba\(([0-9]*),([0-9]*),([0-9]*),([.0-9]*)\)/i),!a)return 0;let f="";for(let p=1;p<=3;p++){let _=parseInt(a[p]).toString(16);_.length==1&&(_="0"+_),f+=_}return ck(f)}function pf(s){return _g.fromAny(s)}var _g=class s{constructor(a){Object.defineProperty(this,"_hex",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hex=a|0}get hex(){return this._hex}get r(){return this._hex>>>16}get g(){return this._hex>>8&255}get b(){return this._hex&255}toCSS(a=1){return"rgba("+this.r+", "+this.g+", "+this.b+", "+a+")"}toCSSHex(){return"#"+Hv(this.r.toString(16),2)+Hv(this.g.toString(16),2)+Hv(this.b.toString(16),2)}toHSL(a=1){return OE({r:this.r,g:this.g,b:this.b,a})}static fromHSL(a,f,p){let _=RE({h:a,s:f,l:p});return this.fromRGB(_.r,_.g,_.b)}toString(){return this.toCSSHex()}static fromHex(a){return new s(a)}static fromRGB(a,f,p){return new s((p|0)+(f<<8)+(a<<16))}static fromString(a){return new s(ck(a))}static fromCSS(a){return new s(h$(a))}static fromAny(a){if(nk(a)){if(a[0]=="#")return s.fromString(a);if(a.substr(0,3)=="rgb")return s.fromCSS(a)}else{if(rk(a))return s.fromHex(a);if(a instanceof s)return s.fromHex(a.hex)}throw new Error("Unknown color syntax: "+a)}static alternative(a,f,p){let _=lk({r:a.r,g:a.g,b:a.b},f?{r:f.r,g:f.g,b:f.b}:void 0,p?{r:p.r,g:p.g,b:p.b}:void 0);return this.fromRGB(_.r,_.g,_.b)}static interpolate(a,f,p,_="rgb"){if(_=="hsl"){let r=f.toHSL(),C=p.toHSL();return s.fromHSL(nh(a,r.h,C.h),nh(a,r.s,C.s),nh(a,r.l,C.l))}else return s.fromRGB(nh(a,f.r,p.r),nh(a,f.g,p.g),nh(a,f.b,p.b))}static lighten(a,f){let p=ok({r:a.r,g:a.g,b:a.b},f);return s.fromRGB(p.r,p.g,p.b)}static brighten(a,f){let p=sk({r:a.r,g:a.g,b:a.b},f);return s.fromRGB(p.r,p.g,p.b)}static saturate(a,f){let p=ak({r:a.r,g:a.g,b:a.b},f);return s.fromRGB(p.r,p.g,p.b)}};function nh(s,a,f){return a+s*(f-a)}var ire=[{name:"Root",children:[{name:"Sed et nulla a enim tincidunt gravida",shortName:"Gravida",color:pf(8824281),radius:90,action:"open",children:[{name:"First",value:46},{name:"Second",value:96,radius:80},{name:"Third",value:100},{name:"New",value:50,action:"add",color:pf(13688048),radius:35}]},{name:"Fusce ut nisi eu nibh laoreet scelerisque",shortName:"Fusce ut nisi",color:pf(8285892),radius:90,action:"open",children:[{name:"First",value:46},{name:"Second",value:96,radius:25},{name:"Third",value:100},{name:"New",value:50,action:"add",color:pf(14210285),radius:35}]}]}];var hk=gS(FE());var qv=gS(FE());var dk={type:"FeatureCollection",features:[{type:"Feature",properties:{name:"Treptower Park"},geometry:{type:"Point",coordinates:[13.470268249511719,52.489261333143126]}},{type:"Feature",properties:{name:"Tempelhofer Feld"},geometry:{type:"Point",coordinates:[13.40280532836914,52.474311525275674]}},{type:"Feature",properties:{name:"Volskpark Friedrichshain"},geometry:{type:"Point",coordinates:[13.432846069335938,52.527605775532116]}},{type:"Feature",properties:{name:"Gro\xDFer Tiergarten"},geometry:{type:"Point",coordinates:[13.356628417968748,52.51507176398948]}},{type:"Feature",properties:{name:"Park am Gleisdreieck"},geometry:{type:"Point",coordinates:[13.376026153564451,52.49605502101946]}},{type:"Feature",properties:{name:"Volskpark Humboldthain"},geometry:{type:"Point",coordinates:[13.383750915527344,52.54566934855766]}},{type:"Feature",properties:{name:"G\xF6rlitzer Park"},geometry:{type:"Point",coordinates:[13.435592651367188,52.4976226461021]}},{type:"Feature",properties:{name:"Volkspark Prenzlazer Berg"},geometry:{type:"Point",coordinates:[13.46323013305664,52.53700393747574]}},{type:"Feature",properties:{name:"Tierpark Berlin"},geometry:{type:"Point",coordinates:[13.528633117675781,52.50347461927098]}}]};function p$(s,a){s&1&&tT(0)}function m$(s,a){if(s&1){let f=nT();dr(0,"div",4),ss("click",function(_){Fu(f);let r=Zd();return Nu(r.handleMenuClick(_,"normal"))}),qi(1," 7 tasks to delegate "),Mr(2,"img",5),yr(),dr(3,"div",6),ss("click",function(_){Fu(f);let r=Zd();return Nu(r.handleMenuClick(_,"critical"))}),qi(4," 3 critical alerts "),yr(),dr(5,"div",7),ss("click",function(_){Fu(f);let r=Zd();return Nu(r.handleMenuClick(_,"high"))}),qi(6," 8 high priority alerts "),Mr(7,"hr",8),dr(8,"div",9),qi(9,"4 mice to be released "),Mr(10,"img",10),yr(),dr(11,"div",9),qi(12,"2 batteries to be replaced "),Mr(13,"img",10),yr(),dr(14,"div",11),qi(15,"2 roofs to be cleared of snow "),Mr(16,"img",12),yr()(),dr(17,"div",13),ss("click",function(_){Fu(f);let r=Zd();return Nu(r.handleMenuClick(_,"regular"))}),qi(18," 29 regular statuses "),yr(),dr(19,"div",14),ss("click",function(_){Fu(f);let r=Zd();return Nu(r.handleMenuClick(_,"low"))}),qi(20," 3 low priority statuses "),yr()}}function g$(s,a){s&1&&(dr(0,"div",15),Mr(1,"img",16),dr(2,"span",17),qi(3," 7 "),yr()(),dr(4,"div",18),qi(5," 3 "),yr(),dr(6,"div",19),qi(7," 8 "),yr(),dr(8,"div",20),qi(9," 29"),yr(),dr(10,"div",21),qi(11," 3 "),yr())}var fk=(()=>{let a=class a{constructor(p){this.docoment=p,this.opened=!1,this.bar=null,this.menuElements=[]}toggleSidebar(p){this.bar=this.docoment.querySelector(".right-bar"),this.menuElements=Array.from(this.bar.querySelectorAll(".menu-element")),this.opened=!this.opened,this.opened?this.openMenu(p):this.closeMenu()}openMenu(p){this.bar.classList.add("menu-opened"),this.menuElements.forEach(_=>{_.classList.add("menu-item-opened")})}closeMenu(){this.menuElements.forEach(p=>{p.classList.remove("menu-item-opened")}),this.bar.classList.remove("menu-opened")}handleMenuClick(p,_){p.cancelBubble=!0}};a.\u0275fac=function(_){return new(_||a)(ho(Br))},a.\u0275cmp=Ra({type:a,selectors:[["app-right-bar"]],standalone:!0,features:[Fa],decls:6,vars:3,consts:[["openedTemplate",""],["closedTemplate",""],["id","rightBar",1,"right-bar",3,"click"],[4,"ngIf","ngIfThen","ngIfElse"],[1,"normal","menu-element",2,"text-align","left","padding-left","10px",3,"click"],["src","../../assets/top-right-arrow.svg",2,"position","fixed","right","15px"],[1,"critical","menu-element",2,"text-align","left","padding-left","10px",3,"click"],[1,"high","menu-element",2,"height","fit-content","text-align","left","padding-left","10px",3,"click"],[1,"dotted"],[1,"inner-text",2,"display","flex","align-items","center","font-size","100%"],["src","../../assets/alert-add.svg",1,"add-icon"],[1,"inner-text",2,"display","flex","align-items","center","font-size","100%","text-decoration-line","line-through","text-decoration-color","rgba(0, 0, 0, 0.5)","color","rgba(0, 0, 0, 0.5)"],["src","../../assets/alert-close.svg",1,"add-icon"],[1,"regular","menu-element",2,"text-align","left","padding-left","10px",3,"click"],[1,"low","menu-element",2,"text-align","left","padding-left","10px",3,"click"],[1,"normal","menu-element"],["src","../../assets/top-right-arrow.svg",1,"right-arrow"],[1,"alarm-count"],[1,"critical","menu-element"],[1,"high","menu-element"],[1,"regular","menu-element"],[1,"low","menu-element"]],template:function(_,r){if(_&1){let C=nT();dr(0,"div",2),ss("click",function(k){return Fu(C),r.toggleSidebar(k),Nu(k.stopPropagation())}),R0(1,p$,1,0,"ng-container",3),yr(),R0(2,m$,21,0,"ng-template",null,0,iT)(4,g$,12,0,"ng-template",null,1,iT)}if(_&2){let C=rT(3),A=rT(5);S0(),Dm("ngIf",!r.opened)("ngIfThen",A)("ngIfElse",C)}},dependencies:[Uu,BA],styles:[".right-bar[_ngcontent-%COMP%]{position:fixed;width:30px;background-color:#fff0!important;height:40%;border-left:1px solid #bbb;padding-left:20px;padding-right:20px;top:25%;right:0;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:all .8s}.right-bar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:hover{cursor:pointer}.right-bar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{text-align:center;vertical-align:baseline;line-height:30px;font-size:80%}.right-bar[_ngcontent-%COMP%]   div.normal[_ngcontent-%COMP%]{background-color:#fff}.right-bar[_ngcontent-%COMP%]   div.normal[_ngcontent-%COMP%]   span.alarm-count[_ngcontent-%COMP%]{position:absolute;color:#c3c3c3;margin-top:-6px;font-size:90%}.right-bar[_ngcontent-%COMP%]   div.critical[_ngcontent-%COMP%]{background-color:#ecc6ef}.right-bar[_ngcontent-%COMP%]   div.high[_ngcontent-%COMP%]{background-color:#ffeb82}.right-bar[_ngcontent-%COMP%]   div.regular[_ngcontent-%COMP%]{background-color:#b3eccd}.right-bar[_ngcontent-%COMP%]   div.low[_ngcontent-%COMP%]{background-color:#eaebed}.right-bar[_ngcontent-%COMP%]   img.right-arrow[_ngcontent-%COMP%]{margin-top:10px;margin-left:-10px;scale:.7}.menu-element[_ngcontent-%COMP%]{justify-self:center;border-radius:10px;text-wrap:nowrap;border:2px solid #bbb;width:100%;height:30px;margin-top:1vh;margin-bottom:1vh}.menu-opened[_ngcontent-%COMP%]{top:15%;height:60%;width:30%}.menu-item-opened[_ngcontent-%COMP%]{transition:all .5s;width:100%;text-align:justify;vertical-align:baseline;line-height:30px;font-size:80%}.inner-text[_ngcontent-%COMP%]{text-align:center;vertical-align:baseline;line-height:50px;font-size:120%}.dotted[_ngcontent-%COMP%]{border-top:2px dotted #000;margin-right:10px}.add-icon[_ngcontent-%COMP%]{position:fixed;right:25px}"]});let s=a;return s})();var mk=(()=>{let a=class a{constructor(p){this.document=p,this.map=null,this.style="mapbox://styles/vitalii-bilinskyi/cly8fp05900fz01pfaajw4fqa",this.token="pk.eyJ1Ijoidml0YWxpaS1iaWxpbnNreWkiLCJhIjoiY2x5OGZqZDdsMDVjMjJucGh5Z2w3MmgzZSJ9.nKkXDgd7Q8u4sBZt_bsRrQ",this.lat=13.4426,this.lng=52.51,this.width=1497,this.height=700,this.toggleSidebar=new Jr,this.mapContainer=null,this.canvas=null,this.svg=null,this.simulation=null,this.graphSvg=null,this.nodeGroup=null,this.node=null,this.linkGroup=null,this.link=null,this.nodeMap={},this.data=_$(NE,this.nodeMap),this.changedData={nodes:[...this.data.nodes],links:[...this.data.links]},this.clickedPlace="",this.lastZoom=this.map?.getZoom(),this.addMenuOpened=!1}ngAfterViewInit(){this.renderMap();let p=this.document.querySelector(".mapboxgl-control-container"),_=this.document.querySelector(".mapboxgl-canvas-container");p.style.display="none",_.style.scale="1.3",this.canvas=this.map.getCanvasContainer(),this.svg=Wi(this.canvas).append("svg").attr("width","100%").attr("height",this.height).style("position","absolute").style("left",0)}toggleAddMenu(){console.log(this.addMenuOpened),this.addMenuOpened=!this.addMenuOpened}renderMap(){this.map=new qv.Map({accessToken:this.token,container:"map",style:this.style,minZoom:4,zoom:12,center:[this.lat,this.lng]}),this.map.on("load",()=>{this.map?.addSource("parks",{type:"geojson",data:dk,cluster:!0,clusterMaxZoom:14,clusterRadius:50}),this.drawData()}),this.map.on("viewreset",p=>this.updateNodeGraphSVGPlacement(p)),this.map.on("move",p=>this.updateNodeGraphSVGPlacement(p)),this.map.on("moveend",p=>this.updateNodeGraphSVGPlacement(p)),this.map.on("zoom",()=>this.onZoomHandler()),this.map.on("click","clusters",p=>this.onClusterClickHandler(p)),this.map.on("click","unclustered-point",p=>this.onUnlcusteredPointClickHandler(p))}updateNodeGraphSVGPlacement(p){let r=(this.map?.queryRenderedFeatures(p.point,{layers:["unclustered-point"]}))[0];if(r?.geometry){let C=this.project(r.geometry.coordinates).x-this.width/3,A=this.project(r.geometry.coordinates).y-this.height/3;this.graphSvg?.style("left",C).style("top",A)}else this.clearGraphAndSimulation()}onZoomHandler(){let p=this.map?.getZoom();p&&this.lastZoom&&p<this.lastZoom&&Number(this.map?.getZoom())<18&&(this.mapContainer&&(this.mapContainer.style.opacity="1"),this.clearGraphAndSimulation()),this.lastZoom=p}onClusterClickHandler(p){let _=this.map?.queryRenderedFeatures(p.point,{layers:["clusters"]}),r=_[0].properties.cluster_id;r&&this.map?.getSource("parks")?.getClusterExpansionZoom(r,(C,A)=>{C||this.map?.easeTo({center:_[0].geometry.coordinates,zoom:A})})}onUnlcusteredPointClickHandler(p){this.mapContainer=this.document.querySelector(".mapboxgl-canvas");let r=(this.map?.queryRenderedFeatures(p.point,{layers:["unclustered-point"]}))[0];if(r){let C={center:[r.geometry.coordinates[0],r.geometry.coordinates[1]],zoom:18};this.map?.flyTo(_r(kt({},C),{duration:3e3,essential:!0})),this.clickedPlace=r.properties?.name,setTimeout(()=>{this.loadForceDirectedGraph(r),this.mapContainer&&(this.mapContainer.style.transition="1.5s",this.mapContainer.style.opacity="0.1")},1500)}}project(p){return this.map?.project(new qv.LngLat(+p[0],+p[1]))}drawData(){this.map?.addLayer({id:"clusters",type:"circle",source:"parks",filter:["has","point_count"],paint:{"circle-color":"#51bbd6","circle-radius":20}}),this.map?.addLayer({id:"cluster-count",type:"symbol",source:"parks",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12}}),this.map?.addLayer({id:"unclustered-point",type:"circle",source:"parks",filter:["!",["has","point_count"]],paint:{"circle-color":"#f28cb1","circle-radius":5}})}update(){}loadSimulation(){let p=()=>{this.node?.attr("x",r=>r.icon?r.x-30:r.x-15).attr("y",r=>r.icon?r.y-30:r.y-15),this.link?.attr("x1",r=>r.source.x).attr("y1",r=>r.source.y).attr("x2",r=>r.target.x).attr("y2",r=>r.target.y)},_=Bv(this.changedData.nodes).force("link",zv(this.changedData.links).distance(100).strength(.25).id(r=>r.id)).force("charge",Vv().strength(-100).distanceMax(.5*Math.min(this.width,this.height))).force("x",jv().strength(.01)).force("y",Uv().strength(.01)).force("collide",Nv().radius(8)).on("tick",p);this.simulation=_}updateGraph(){this.simulation?.nodes(this.changedData.nodes),this.simulation?.force("link")?.links(this.changedData.links),this.simulation?.alpha(1).restart()}crateGraphComponents(p){let _=this.project(p.geometry.coordinates).x-this.width/3,r=this.project(p.geometry.coordinates).y-this.height/3;this.graphSvg=Wi(this.canvas).append("svg").attr("viewBox",[-this.width/3,-this.height/3,this.width/1.5,this.height/1.5]).attr("width",this.width/1.5).attr("height",this.height/1.5).style("position","absolute").style("left",_).style("top",r).classed("graph",!0),this.renderNodes()}renderLinks(p){!this.linkGroup&&this.graphSvg&&(this.linkGroup=this.graphSvg.append("g").attr("class","links")),this.linkGroup&&(p&&this.link?this.link=this.linkGroup.selectAll("line").data(this.changedData.links,_=>_.id).enter().append("line").classed("link",!0).merge(this.link):this.link=this.linkGroup.selectAll("line").data(this.changedData.links,_=>_.id).enter().append("line").classed("link",!0))}renderNodes(p){let _=(k,B)=>{if(!B.id.includes("Malborska")){console.log(NE[0].children);let Z=NE[0].children.find(he=>he.name===B.id);console.log(Z),this.toggleSidebar.next(!0)}this.filterDataToCollapse(B)},r=(k,B)=>{Wi(k.currentTaget).classed("fixed",!0)},C=(k,B)=>{B.id!=="Malborska"&&(B.fx=pk(k.x,-this.width/2,this.width/2),B.fy=pk(k.y,-this.height/2,this.height/2),this.simulation?.alpha(1).restart())},A=(k,B)=>{B.id!=="Malborska"&&(k.active||this.simulation?.alphaTarget(0),B.fx=null,B.fy=null)};!this.nodeGroup&&this.graphSvg&&(this.nodeGroup=this.graphSvg.append("g").attr("class","nodes")),this.nodeGroup&&(p&&this.node?this.node=this.nodeGroup.selectAll("image").data(this.changedData.nodes,k=>k.id).enter().append("image").attr("r",8).attr("fill","#5484d1").attr("href",k=>k.icon??"../assets/circle.svg").attr("height",k=>k.icon?60:30).attr("width",k=>k.icon?60:30).attr("style","position: absolute;").text(k=>k.name).classed("node",!0).call(og().on("start",r).on("drag",C).on("end",A)).on("click",_).merge(this.node):this.node=this.nodeGroup.selectAll("image").data(this.changedData.nodes,k=>k.id).enter().append("image").attr("r",8).attr("fill","#5484d1").attr("href",k=>k.icon??"../assets/circle.svg").attr("height",k=>k.icon?60:30).attr("width",k=>k.icon?60:30).attr("style","position: absolute;").text(k=>k.name).classed("node",!0).call(og().on("start",r).on("drag",C).on("end",A)).on("click",_))}loadForceDirectedGraph(p){this.crateGraphComponents(p),this.loadSimulation()}clearGraphAndSimulation(){this.simulation?.stop(),this.graphSvg?.remove(),this.graphSvg=null,this.nodeGroup=null,this.linkGroup=null,this.node=null,this.link=null}filterDataToCollapse(p){let _=this.nodeMap[p.id];if(_){if(_.childrenVisible){let A=function(k){k.children&&k.children.length!==0&&(k.hiddenChildren=k.children,k.children.forEach(B=>{C.push(B.name),B.childrenVisible=!1,A(B)}),k.children=[])};var r=A;let C=[];A(_),this.changedData.nodes=this.changedData.nodes.filter(k=>!C.includes(k.id)),this.changedData.links=this.changedData.links.filter(k=>!C.includes(k.target.id)),this.linkGroup&&this.link&&(this.link=this.linkGroup.selectAll("line").data(this.changedData.links,k=>k.id).join("line")),this.node&&this.nodeGroup&&(this.node=this.nodeGroup?.selectAll("image").data(this.changedData.nodes,k=>k.id).join("image")),_.childrenVisible=!1}else(A=>{A.hiddenChildren&&A.hiddenChildren.length!==0&&(A.hiddenChildren.forEach(k=>{this.changedData.nodes.push({id:k.name,x:p.x+8,y:p.y+8,icon:k.icon,value:k.value}),this.changedData.links.push({id:A.name+k.name,source:A.name,target:k.name}),A.children?.push(k)}),A.hiddenChildren=[])})(_),_.childrenVisible=!0,this.renderNodes(!0);this.updateGraph()}}};a.\u0275fac=function(_){return new(_||a)(ho(Br))},a.\u0275cmp=Ra({type:a,selectors:[["app-map-box-and-g3-js"]],standalone:!0,features:[bA([dE,{provide:Zu,useClass:hE}]),Fa],decls:17,vars:1,consts:[["id","map",1,"match-parent"],[1,"left-bar"],["src","../../assets/menu-globe.svg",1,"menu-item"],[1,"solid"],["src","../../assets/menu-map.svg",1,"menu-item"],["src","../../assets/menu-cube.svg",1,"menu-item"],["src","../../assets/menu-stars.svg",1,"menu-item"],[1,"timeline"],["src","../../assets/timeline.svg"],[1,"add-sensor",3,"click"],["src","../../assets/add-icon.svg"],[1,"add-sensor-menu",3,"ngClass"],[1,"add-qr-wrapper"],["src","../../assets/add-qr.svg"],[1,"add-nfc-wrapper"],["src","../../assets/add-nfc.svg"]],template:function(_,r){_&1&&(Mr(0,"div",0),dr(1,"div",1),Mr(2,"img",2)(3,"hr",3)(4,"img",4)(5,"img",5)(6,"img",6),yr(),dr(7,"div",7),Mr(8,"img",8),yr(),Mr(9,"app-right-bar"),dr(10,"div",9),ss("click",function(){return r.toggleAddMenu()}),Mr(11,"img",10),yr(),dr(12,"div",11)(13,"div",12),Mr(14,"img",13),yr(),dr(15,"div",14),Mr(16,"img",15),yr()()),_&2&&(S0(12),Dm("ngClass",r.addMenuOpened?"opened":"closed"))},dependencies:[KA,Uu,zA,fk],styles:[`.match-parent{width:100%;height:700px}.link{stroke:#b752e2;stroke-width:1.5px}.left-bar{opacity:1;background-color:#fff0!important;position:fixed;width:fit-content;background-color:#fff;padding:10px 20px 0;height:220px;top:30%;left:0;display:flex;flex-direction:column;align-items:center}.left-bar img{justify-self:center;width:30px;height:30px;margin-top:30%;margin-bottom:30%}.left-bar img:hover{cursor:pointer}.left-bar hr.solid{border-top:3px solid #bbb;width:130%;margin-left:-15%}.timeline{position:fixed;padding-left:20px;padding-bottom:20px;left:0;bottom:0}.timeline:hover{cursor:pointer}.add-sensor{z-index:999;width:50px;height:50px;background-color:#eaebed;position:fixed;margin-bottom:20px;margin-right:5px;border-radius:50%;right:0;bottom:0;display:flex;align-items:center;justify-content:center}.add-sensor-menu{position:fixed;right:0;bottom:0;padding-bottom:30px;padding-right:30px}.add-sensor-menu div{display:flex;justify-content:center;align-items:center;border-radius:50%;width:60px;height:60px;background-color:#fff}.add-sensor-menu div:hover{cursor:pointer}.add-sensor-menu .add-nfc-wrapper{margin-left:-40px}.add-sensor:hover{cursor:pointer}.closed{scale:0%;transition:.5s}.opened{scale:100%;transition:.5s}
`],encapsulation:2});let s=a;return s})();function pk(s,a,f){return s<a?a:s>f?f:s}function _$(s,a){let f=[],p=[];function _(r,C=null){let A=r.name;f.push({id:A,icon:r.icon,value:r.value,fx:r.name==="Malborska"?0:null,fy:r.name==="Malborska"?15:null}),a[A]=r,C&&(p.push({id:C+A,source:C,target:A}),r.parent=a[C]),r.childrenVisible=!0,r.children&&r.children.forEach(k=>_(k,A))}return s.forEach(r=>_(r)),{nodes:f,links:p}}var NE=[{name:"Malborska",location:"Malborska 85, Krak\xF3w, Polska",numberOfSensors:0,type:"group",icon:"../assets/circle.svg",children:[{name:"Latch",type:"group",icon:"../assets/icon_wf_latch.svg"},{name:"Sound",type:"group",icon:"../assets/icon_wf_sound.svg"},{name:"Humidity",type:"group",icon:"../assets/icon_wf_humidity.svg"},{name:"Temperature",type:"group",icon:"../assets/icon_wf_temperature.svg"}]}];var gk=(()=>{let a=class a{constructor(){this.title="GraphVizualization"}};a.\u0275fac=function(_){return new(_||a)},a.\u0275cmp=Ra({type:a,selectors:[["app-root"]],standalone:!0,features:[Fa],decls:3,vars:0,consts:[[2,"height","800px","width","100%"]],template:function(_,r){_&1&&(dr(0,"div",0),Mr(1,"app-map-box-and-g3-js"),yr(),Mr(2,"router-outlet"))},dependencies:[Uu,rE,mk],styles:[`main[_ngcontent-%COMP%] {
    width: 100%;
    min-height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 1rem;
    box-sizing: inherit;
    position: relative;
  }

  .content[_ngcontent-%COMP%] {
    display: flex;
    justify-content: space-around;
    width: 100%;
    max-width: 700px;
    margin-bottom: 3rem;
  }`]});let s=a;return s})();oP(gk,GP).catch(s=>console.error(s));
