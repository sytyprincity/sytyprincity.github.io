import{a as me,b as pt,d as ll,e as rae,f as FG,g as jn}from"./chunk-DM275RSA.js";var $z=rae((Yz,Xz)=>{"use strict";(function(e,t){typeof Yz=="object"&&typeof Xz<"u"?Xz.exports=t():typeof define=="function"&&define.amd?define(t):(e=typeof globalThis<"u"?globalThis:e||self,e.mapboxgl=t())})(Yz,function(){"use strict";var e,t,i;function r(n,c){if(!e)e=c;else if(!t)t=c;else{var u="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",p={};e(p),i=c(p),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([u],{type:"text/javascript"})))}}r(["exports"],function(n){var c="3.6.0";let u,p={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(u==null){let a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{u=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):a}catch{u=a}}return u},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!p.API_URL)return null;try{let a=new URL(p.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function f(a){return p.API_URL_REGEX.test(a)}function x(a){return a.indexOf("mapbox:")===0}function w(a){return p.API_CDN_URL_REGEX.test(a)}function E(a){return p.API_SPRITE_REGEX.test(a)}function A(a){return p.API_STYLE_REGEX.test(a)&&!E(a)}let I={create:"create",load:"load",fullLoad:"fullLoad"},P={mark(a){performance.mark(a)},measure(a,o,l){performance.measure(a,o,l)}};function O(a){let o=a.name.split("?")[0];return w(o)&&o.includes("mapbox-gl.js")?"javascript":w(o)&&o.includes("mapbox-gl.css")?"css":function(l){return p.API_FONTS_REGEX.test(l)}(o)?"fontRange":E(o)?"sprite":A(o)?"style":function(l){return p.API_TILEJSON_REGEX.test(l)}(o)?"tilejson":"other"}function k(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var U={},j={};Object.defineProperty(j,"__esModule",{value:!0}),j.setMatrixArrayType=function(a){j.ARRAY_TYPE=$=a},j.toRadian=function(a){return a*J},j.equals=function(a,o){return Math.abs(a-o)<=V*Math.max(1,Math.abs(a),Math.abs(o))},j.RANDOM=j.ARRAY_TYPE=j.EPSILON=void 0;var V=1e-6;j.EPSILON=V;var $=typeof Float32Array<"u"?Float32Array:Array;j.ARRAY_TYPE=$;var Y=Math.random;j.RANDOM=Y;var J=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var a=0,o=arguments.length;o--;)a+=arguments[o]*arguments[o];return Math.sqrt(a)});var X={};function ee(a){return ee=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},ee(a)}Object.defineProperty(X,"__esModule",{value:!0}),X.create=function(){var a=new oe.ARRAY_TYPE(4);return oe.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},X.clone=function(a){var o=new oe.ARRAY_TYPE(4);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o},X.copy=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a},X.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},X.fromValues=function(a,o,l,d){var m=new oe.ARRAY_TYPE(4);return m[0]=a,m[1]=o,m[2]=l,m[3]=d,m},X.set=function(a,o,l,d,m){return a[0]=o,a[1]=l,a[2]=d,a[3]=m,a},X.transpose=function(a,o){if(a===o){var l=o[1];a[1]=o[2],a[2]=l}else a[0]=o[0],a[1]=o[2],a[2]=o[1],a[3]=o[3];return a},X.invert=function(a,o){var l=o[0],d=o[1],m=o[2],y=o[3],v=l*y-m*d;return v?(a[0]=y*(v=1/v),a[1]=-d*v,a[2]=-m*v,a[3]=l*v,a):null},X.adjoint=function(a,o){var l=o[0];return a[0]=o[3],a[1]=-o[1],a[2]=-o[2],a[3]=l,a},X.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},X.multiply=ve,X.rotate=function(a,o,l){var d=o[0],m=o[1],y=o[2],v=o[3],S=Math.sin(l),T=Math.cos(l);return a[0]=d*T+y*S,a[1]=m*T+v*S,a[2]=d*-S+y*T,a[3]=m*-S+v*T,a},X.scale=function(a,o,l){var d=o[1],m=o[2],y=o[3],v=l[0],S=l[1];return a[0]=o[0]*v,a[1]=d*v,a[2]=m*S,a[3]=y*S,a},X.fromRotation=function(a,o){var l=Math.sin(o),d=Math.cos(o);return a[0]=d,a[1]=l,a[2]=-l,a[3]=d,a},X.fromScaling=function(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=o[1],a},X.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},X.frob=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},X.LDU=function(a,o,l,d){return a[2]=d[2]/d[0],l[0]=d[0],l[1]=d[1],l[3]=d[3]-a[2]*l[1],[a,o,l]},X.add=function(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a[3]=o[3]+l[3],a},X.subtract=we,X.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]},X.equals=function(a,o){var l=a[0],d=a[1],m=a[2],y=a[3],v=o[0],S=o[1],T=o[2],D=o[3];return Math.abs(l-v)<=oe.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(d-S)<=oe.EPSILON*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(m-T)<=oe.EPSILON*Math.max(1,Math.abs(m),Math.abs(T))&&Math.abs(y-D)<=oe.EPSILON*Math.max(1,Math.abs(y),Math.abs(D))},X.multiplyScalar=function(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a[3]=o[3]*l,a},X.multiplyScalarAndAdd=function(a,o,l,d){return a[0]=o[0]+l[0]*d,a[1]=o[1]+l[1]*d,a[2]=o[2]+l[2]*d,a[3]=o[3]+l[3]*d,a},X.sub=X.mul=void 0;var oe=function(a,o){if(a&&a.__esModule)return a;if(a===null||ee(a)!=="object"&&typeof a!="function")return{default:a};var l=le(void 0);if(l&&l.has(a))return l.get(a);var d={},m=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in a)if(y!=="default"&&Object.prototype.hasOwnProperty.call(a,y)){var v=m?Object.getOwnPropertyDescriptor(a,y):null;v&&(v.get||v.set)?Object.defineProperty(d,y,v):d[y]=a[y]}return d.default=a,l&&l.set(a,d),d}(j);function le(a){if(typeof WeakMap!="function")return null;var o=new WeakMap,l=new WeakMap;return(le=function(d){return d?l:o})(a)}function ve(a,o,l){var d=o[0],m=o[1],y=o[2],v=o[3],S=l[0],T=l[1],D=l[2],L=l[3];return a[0]=d*S+y*T,a[1]=m*S+v*T,a[2]=d*D+y*L,a[3]=m*D+v*L,a}function we(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a[2]=o[2]-l[2],a[3]=o[3]-l[3],a}X.mul=ve,X.sub=we;var fe={};function Ue(a){return Ue=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Ue(a)}Object.defineProperty(fe,"__esModule",{value:!0}),fe.create=function(){var a=new Fe.ARRAY_TYPE(6);return Fe.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[4]=0,a[5]=0),a[0]=1,a[3]=1,a},fe.clone=function(a){var o=new Fe.ARRAY_TYPE(6);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o},fe.copy=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[4]=o[4],a[5]=o[5],a},fe.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},fe.fromValues=function(a,o,l,d,m,y){var v=new Fe.ARRAY_TYPE(6);return v[0]=a,v[1]=o,v[2]=l,v[3]=d,v[4]=m,v[5]=y,v},fe.set=function(a,o,l,d,m,y,v){return a[0]=o,a[1]=l,a[2]=d,a[3]=m,a[4]=y,a[5]=v,a},fe.invert=function(a,o){var l=o[0],d=o[1],m=o[2],y=o[3],v=o[4],S=o[5],T=l*y-d*m;return T?(a[0]=y*(T=1/T),a[1]=-d*T,a[2]=-m*T,a[3]=l*T,a[4]=(m*S-y*v)*T,a[5]=(d*v-l*S)*T,a):null},fe.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},fe.multiply=Ae,fe.rotate=function(a,o,l){var d=o[0],m=o[1],y=o[2],v=o[3],S=o[4],T=o[5],D=Math.sin(l),L=Math.cos(l);return a[0]=d*L+y*D,a[1]=m*L+v*D,a[2]=d*-D+y*L,a[3]=m*-D+v*L,a[4]=S,a[5]=T,a},fe.scale=function(a,o,l){var d=o[1],m=o[2],y=o[3],v=o[4],S=o[5],T=l[0],D=l[1];return a[0]=o[0]*T,a[1]=d*T,a[2]=m*D,a[3]=y*D,a[4]=v,a[5]=S,a},fe.translate=function(a,o,l){var d=o[0],m=o[1],y=o[2],v=o[3],S=o[4],T=o[5],D=l[0],L=l[1];return a[0]=d,a[1]=m,a[2]=y,a[3]=v,a[4]=d*D+y*L+S,a[5]=m*D+v*L+T,a},fe.fromRotation=function(a,o){var l=Math.sin(o),d=Math.cos(o);return a[0]=d,a[1]=l,a[2]=-l,a[3]=d,a[4]=0,a[5]=0,a},fe.fromScaling=function(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=o[1],a[4]=0,a[5]=0,a},fe.fromTranslation=function(a,o){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=o[0],a[5]=o[1],a},fe.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},fe.frob=function(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],1)},fe.add=function(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a[3]=o[3]+l[3],a[4]=o[4]+l[4],a[5]=o[5]+l[5],a},fe.subtract=et,fe.multiplyScalar=function(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a[3]=o[3]*l,a[4]=o[4]*l,a[5]=o[5]*l,a},fe.multiplyScalarAndAdd=function(a,o,l,d){return a[0]=o[0]+l[0]*d,a[1]=o[1]+l[1]*d,a[2]=o[2]+l[2]*d,a[3]=o[3]+l[3]*d,a[4]=o[4]+l[4]*d,a[5]=o[5]+l[5]*d,a},fe.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]&&a[4]===o[4]&&a[5]===o[5]},fe.equals=function(a,o){var l=a[0],d=a[1],m=a[2],y=a[3],v=a[4],S=a[5],T=o[0],D=o[1],L=o[2],F=o[3],N=o[4],H=o[5];return Math.abs(l-T)<=Fe.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(d-D)<=Fe.EPSILON*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(m-L)<=Fe.EPSILON*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(y-F)<=Fe.EPSILON*Math.max(1,Math.abs(y),Math.abs(F))&&Math.abs(v-N)<=Fe.EPSILON*Math.max(1,Math.abs(v),Math.abs(N))&&Math.abs(S-H)<=Fe.EPSILON*Math.max(1,Math.abs(S),Math.abs(H))},fe.sub=fe.mul=void 0;var Fe=function(a,o){if(a&&a.__esModule)return a;if(a===null||Ue(a)!=="object"&&typeof a!="function")return{default:a};var l=Pe(void 0);if(l&&l.has(a))return l.get(a);var d={},m=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in a)if(y!=="default"&&Object.prototype.hasOwnProperty.call(a,y)){var v=m?Object.getOwnPropertyDescriptor(a,y):null;v&&(v.get||v.set)?Object.defineProperty(d,y,v):d[y]=a[y]}return d.default=a,l&&l.set(a,d),d}(j);function Pe(a){if(typeof WeakMap!="function")return null;var o=new WeakMap,l=new WeakMap;return(Pe=function(d){return d?l:o})(a)}function Ae(a,o,l){var d=o[0],m=o[1],y=o[2],v=o[3],S=o[4],T=o[5],D=l[0],L=l[1],F=l[2],N=l[3],H=l[4],q=l[5];return a[0]=d*D+y*L,a[1]=m*D+v*L,a[2]=d*F+y*N,a[3]=m*F+v*N,a[4]=d*H+y*q+S,a[5]=m*H+v*q+T,a}function et(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a[2]=o[2]-l[2],a[3]=o[3]-l[3],a[4]=o[4]-l[4],a[5]=o[5]-l[5],a}fe.mul=Ae,fe.sub=et;var $e={};function rt(a){return rt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},rt(a)}Object.defineProperty($e,"__esModule",{value:!0}),$e.create=function(){var a=new Je.ARRAY_TYPE(9);return Je.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},$e.fromMat4=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[4],a[4]=o[5],a[5]=o[6],a[6]=o[8],a[7]=o[9],a[8]=o[10],a},$e.clone=function(a){var o=new Je.ARRAY_TYPE(9);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o},$e.copy=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a[8]=o[8],a},$e.fromValues=function(a,o,l,d,m,y,v,S,T){var D=new Je.ARRAY_TYPE(9);return D[0]=a,D[1]=o,D[2]=l,D[3]=d,D[4]=m,D[5]=y,D[6]=v,D[7]=S,D[8]=T,D},$e.set=function(a,o,l,d,m,y,v,S,T,D){return a[0]=o,a[1]=l,a[2]=d,a[3]=m,a[4]=y,a[5]=v,a[6]=S,a[7]=T,a[8]=D,a},$e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},$e.transpose=function(a,o){if(a===o){var l=o[1],d=o[2],m=o[5];a[1]=o[3],a[2]=o[6],a[3]=l,a[5]=o[7],a[6]=d,a[7]=m}else a[0]=o[0],a[1]=o[3],a[2]=o[6],a[3]=o[1],a[4]=o[4],a[5]=o[7],a[6]=o[2],a[7]=o[5],a[8]=o[8];return a},$e.invert=function(a,o){var l=o[0],d=o[1],m=o[2],y=o[3],v=o[4],S=o[5],T=o[6],D=o[7],L=o[8],F=L*v-S*D,N=-L*y+S*T,H=D*y-v*T,q=l*F+d*N+m*H;return q?(a[0]=F*(q=1/q),a[1]=(-L*d+m*D)*q,a[2]=(S*d-m*v)*q,a[3]=N*q,a[4]=(L*l-m*T)*q,a[5]=(-S*l+m*y)*q,a[6]=H*q,a[7]=(-D*l+d*T)*q,a[8]=(v*l-d*y)*q,a):null},$e.adjoint=function(a,o){var l=o[0],d=o[1],m=o[2],y=o[3],v=o[4],S=o[5],T=o[6],D=o[7],L=o[8];return a[0]=v*L-S*D,a[1]=m*D-d*L,a[2]=d*S-m*v,a[3]=S*T-y*L,a[4]=l*L-m*T,a[5]=m*y-l*S,a[6]=y*D-v*T,a[7]=d*T-l*D,a[8]=l*v-d*y,a},$e.determinant=function(a){var o=a[3],l=a[4],d=a[5],m=a[6],y=a[7],v=a[8];return a[0]*(v*l-d*y)+a[1]*(-v*o+d*m)+a[2]*(y*o-l*m)},$e.multiply=ot,$e.translate=function(a,o,l){var d=o[0],m=o[1],y=o[2],v=o[3],S=o[4],T=o[5],D=o[6],L=o[7],F=o[8],N=l[0],H=l[1];return a[0]=d,a[1]=m,a[2]=y,a[3]=v,a[4]=S,a[5]=T,a[6]=N*d+H*v+D,a[7]=N*m+H*S+L,a[8]=N*y+H*T+F,a},$e.rotate=function(a,o,l){var d=o[0],m=o[1],y=o[2],v=o[3],S=o[4],T=o[5],D=o[6],L=o[7],F=o[8],N=Math.sin(l),H=Math.cos(l);return a[0]=H*d+N*v,a[1]=H*m+N*S,a[2]=H*y+N*T,a[3]=H*v-N*d,a[4]=H*S-N*m,a[5]=H*T-N*y,a[6]=D,a[7]=L,a[8]=F,a},$e.scale=function(a,o,l){var d=l[0],m=l[1];return a[0]=d*o[0],a[1]=d*o[1],a[2]=d*o[2],a[3]=m*o[3],a[4]=m*o[4],a[5]=m*o[5],a[6]=o[6],a[7]=o[7],a[8]=o[8],a},$e.fromTranslation=function(a,o){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=o[0],a[7]=o[1],a[8]=1,a},$e.fromRotation=function(a,o){var l=Math.sin(o),d=Math.cos(o);return a[0]=d,a[1]=l,a[2]=0,a[3]=-l,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},$e.fromScaling=function(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=0,a[4]=o[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},$e.fromMat2d=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=0,a[3]=o[2],a[4]=o[3],a[5]=0,a[6]=o[4],a[7]=o[5],a[8]=1,a},$e.fromQuat=function(a,o){var l=o[0],d=o[1],m=o[2],y=o[3],v=l+l,S=d+d,T=m+m,D=l*v,L=d*v,F=d*S,N=m*v,H=m*S,q=m*T,Q=y*v,K=y*S,ae=y*T;return a[0]=1-F-q,a[3]=L-ae,a[6]=N+K,a[1]=L+ae,a[4]=1-D-q,a[7]=H-Q,a[2]=N-K,a[5]=H+Q,a[8]=1-D-F,a},$e.normalFromMat4=function(a,o){var l=o[0],d=o[1],m=o[2],y=o[3],v=o[4],S=o[5],T=o[6],D=o[7],L=o[8],F=o[9],N=o[10],H=o[11],q=o[12],Q=o[13],K=o[14],ae=o[15],_e=l*S-d*v,ge=l*T-m*v,be=l*D-y*v,ze=d*T-m*S,ke=d*D-y*S,je=m*D-y*T,it=L*Q-F*q,ut=L*K-N*q,vt=L*ae-H*q,dt=F*K-N*Q,At=F*ae-H*Q,jt=N*ae-H*K,Ct=_e*jt-ge*At+be*dt+ze*vt-ke*ut+je*it;return Ct?(a[0]=(S*jt-T*At+D*dt)*(Ct=1/Ct),a[1]=(T*vt-v*jt-D*ut)*Ct,a[2]=(v*At-S*vt+D*it)*Ct,a[3]=(m*At-d*jt-y*dt)*Ct,a[4]=(l*jt-m*vt+y*ut)*Ct,a[5]=(d*vt-l*At-y*it)*Ct,a[6]=(Q*je-K*ke+ae*ze)*Ct,a[7]=(K*be-q*je-ae*ge)*Ct,a[8]=(q*ke-Q*be+ae*_e)*Ct,a):null},$e.projection=function(a,o,l){return a[0]=2/o,a[1]=0,a[2]=0,a[3]=0,a[4]=-2/l,a[5]=0,a[6]=-1,a[7]=1,a[8]=1,a},$e.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},$e.frob=function(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},$e.add=function(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a[3]=o[3]+l[3],a[4]=o[4]+l[4],a[5]=o[5]+l[5],a[6]=o[6]+l[6],a[7]=o[7]+l[7],a[8]=o[8]+l[8],a},$e.subtract=xt,$e.multiplyScalar=function(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a[3]=o[3]*l,a[4]=o[4]*l,a[5]=o[5]*l,a[6]=o[6]*l,a[7]=o[7]*l,a[8]=o[8]*l,a},$e.multiplyScalarAndAdd=function(a,o,l,d){return a[0]=o[0]+l[0]*d,a[1]=o[1]+l[1]*d,a[2]=o[2]+l[2]*d,a[3]=o[3]+l[3]*d,a[4]=o[4]+l[4]*d,a[5]=o[5]+l[5]*d,a[6]=o[6]+l[6]*d,a[7]=o[7]+l[7]*d,a[8]=o[8]+l[8]*d,a},$e.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]&&a[4]===o[4]&&a[5]===o[5]&&a[6]===o[6]&&a[7]===o[7]&&a[8]===o[8]},$e.equals=function(a,o){var l=a[0],d=a[1],m=a[2],y=a[3],v=a[4],S=a[5],T=a[6],D=a[7],L=a[8],F=o[0],N=o[1],H=o[2],q=o[3],Q=o[4],K=o[5],ae=o[6],_e=o[7],ge=o[8];return Math.abs(l-F)<=Je.EPSILON*Math.max(1,Math.abs(l),Math.abs(F))&&Math.abs(d-N)<=Je.EPSILON*Math.max(1,Math.abs(d),Math.abs(N))&&Math.abs(m-H)<=Je.EPSILON*Math.max(1,Math.abs(m),Math.abs(H))&&Math.abs(y-q)<=Je.EPSILON*Math.max(1,Math.abs(y),Math.abs(q))&&Math.abs(v-Q)<=Je.EPSILON*Math.max(1,Math.abs(v),Math.abs(Q))&&Math.abs(S-K)<=Je.EPSILON*Math.max(1,Math.abs(S),Math.abs(K))&&Math.abs(T-ae)<=Je.EPSILON*Math.max(1,Math.abs(T),Math.abs(ae))&&Math.abs(D-_e)<=Je.EPSILON*Math.max(1,Math.abs(D),Math.abs(_e))&&Math.abs(L-ge)<=Je.EPSILON*Math.max(1,Math.abs(L),Math.abs(ge))},$e.sub=$e.mul=void 0;var Je=function(a,o){if(a&&a.__esModule)return a;if(a===null||rt(a)!=="object"&&typeof a!="function")return{default:a};var l=bt(void 0);if(l&&l.has(a))return l.get(a);var d={},m=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in a)if(y!=="default"&&Object.prototype.hasOwnProperty.call(a,y)){var v=m?Object.getOwnPropertyDescriptor(a,y):null;v&&(v.get||v.set)?Object.defineProperty(d,y,v):d[y]=a[y]}return d.default=a,l&&l.set(a,d),d}(j);function bt(a){if(typeof WeakMap!="function")return null;var o=new WeakMap,l=new WeakMap;return(bt=function(d){return d?l:o})(a)}function ot(a,o,l){var d=o[0],m=o[1],y=o[2],v=o[3],S=o[4],T=o[5],D=o[6],L=o[7],F=o[8],N=l[0],H=l[1],q=l[2],Q=l[3],K=l[4],ae=l[5],_e=l[6],ge=l[7],be=l[8];return a[0]=N*d+H*v+q*D,a[1]=N*m+H*S+q*L,a[2]=N*y+H*T+q*F,a[3]=Q*d+K*v+ae*D,a[4]=Q*m+K*S+ae*L,a[5]=Q*y+K*T+ae*F,a[6]=_e*d+ge*v+be*D,a[7]=_e*m+ge*S+be*L,a[8]=_e*y+ge*T+be*F,a}function xt(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a[2]=o[2]-l[2],a[3]=o[3]-l[3],a[4]=o[4]-l[4],a[5]=o[5]-l[5],a[6]=o[6]-l[6],a[7]=o[7]-l[7],a[8]=o[8]-l[8],a}$e.mul=ot,$e.sub=xt;var Xe={};function kt(a){return kt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},kt(a)}Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.create=function(){var a=new yt.ARRAY_TYPE(16);return yt.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},Xe.clone=function(a){var o=new yt.ARRAY_TYPE(16);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o},Xe.copy=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a},Xe.fromValues=function(a,o,l,d,m,y,v,S,T,D,L,F,N,H,q,Q){var K=new yt.ARRAY_TYPE(16);return K[0]=a,K[1]=o,K[2]=l,K[3]=d,K[4]=m,K[5]=y,K[6]=v,K[7]=S,K[8]=T,K[9]=D,K[10]=L,K[11]=F,K[12]=N,K[13]=H,K[14]=q,K[15]=Q,K},Xe.set=function(a,o,l,d,m,y,v,S,T,D,L,F,N,H,q,Q,K){return a[0]=o,a[1]=l,a[2]=d,a[3]=m,a[4]=y,a[5]=v,a[6]=S,a[7]=T,a[8]=D,a[9]=L,a[10]=F,a[11]=N,a[12]=H,a[13]=q,a[14]=Q,a[15]=K,a},Xe.identity=Mt,Xe.transpose=function(a,o){if(a===o){var l=o[1],d=o[2],m=o[3],y=o[6],v=o[7],S=o[11];a[1]=o[4],a[2]=o[8],a[3]=o[12],a[4]=l,a[6]=o[9],a[7]=o[13],a[8]=d,a[9]=y,a[11]=o[14],a[12]=m,a[13]=v,a[14]=S}else a[0]=o[0],a[1]=o[4],a[2]=o[8],a[3]=o[12],a[4]=o[1],a[5]=o[5],a[6]=o[9],a[7]=o[13],a[8]=o[2],a[9]=o[6],a[10]=o[10],a[11]=o[14],a[12]=o[3],a[13]=o[7],a[14]=o[11],a[15]=o[15];return a},Xe.invert=function(a,o){var l=o[0],d=o[1],m=o[2],y=o[3],v=o[4],S=o[5],T=o[6],D=o[7],L=o[8],F=o[9],N=o[10],H=o[11],q=o[12],Q=o[13],K=o[14],ae=o[15],_e=l*S-d*v,ge=l*T-m*v,be=l*D-y*v,ze=d*T-m*S,ke=d*D-y*S,je=m*D-y*T,it=L*Q-F*q,ut=L*K-N*q,vt=L*ae-H*q,dt=F*K-N*Q,At=F*ae-H*Q,jt=N*ae-H*K,Ct=_e*jt-ge*At+be*dt+ze*vt-ke*ut+je*it;return Ct?(a[0]=(S*jt-T*At+D*dt)*(Ct=1/Ct),a[1]=(m*At-d*jt-y*dt)*Ct,a[2]=(Q*je-K*ke+ae*ze)*Ct,a[3]=(N*ke-F*je-H*ze)*Ct,a[4]=(T*vt-v*jt-D*ut)*Ct,a[5]=(l*jt-m*vt+y*ut)*Ct,a[6]=(K*be-q*je-ae*ge)*Ct,a[7]=(L*je-N*be+H*ge)*Ct,a[8]=(v*At-S*vt+D*it)*Ct,a[9]=(d*vt-l*At-y*it)*Ct,a[10]=(q*ke-Q*be+ae*_e)*Ct,a[11]=(F*be-L*ke-H*_e)*Ct,a[12]=(S*ut-v*dt-T*it)*Ct,a[13]=(l*dt-d*ut+m*it)*Ct,a[14]=(Q*ge-q*ze-K*_e)*Ct,a[15]=(L*ze-F*ge+N*_e)*Ct,a):null},Xe.adjoint=function(a,o){var l=o[0],d=o[1],m=o[2],y=o[3],v=o[4],S=o[5],T=o[6],D=o[7],L=o[8],F=o[9],N=o[10],H=o[11],q=o[12],Q=o[13],K=o[14],ae=o[15];return a[0]=S*(N*ae-H*K)-F*(T*ae-D*K)+Q*(T*H-D*N),a[1]=-(d*(N*ae-H*K)-F*(m*ae-y*K)+Q*(m*H-y*N)),a[2]=d*(T*ae-D*K)-S*(m*ae-y*K)+Q*(m*D-y*T),a[3]=-(d*(T*H-D*N)-S*(m*H-y*N)+F*(m*D-y*T)),a[4]=-(v*(N*ae-H*K)-L*(T*ae-D*K)+q*(T*H-D*N)),a[5]=l*(N*ae-H*K)-L*(m*ae-y*K)+q*(m*H-y*N),a[6]=-(l*(T*ae-D*K)-v*(m*ae-y*K)+q*(m*D-y*T)),a[7]=l*(T*H-D*N)-v*(m*H-y*N)+L*(m*D-y*T),a[8]=v*(F*ae-H*Q)-L*(S*ae-D*Q)+q*(S*H-D*F),a[9]=-(l*(F*ae-H*Q)-L*(d*ae-y*Q)+q*(d*H-y*F)),a[10]=l*(S*ae-D*Q)-v*(d*ae-y*Q)+q*(d*D-y*S),a[11]=-(l*(S*H-D*F)-v*(d*H-y*F)+L*(d*D-y*S)),a[12]=-(v*(F*K-N*Q)-L*(S*K-T*Q)+q*(S*N-T*F)),a[13]=l*(F*K-N*Q)-L*(d*K-m*Q)+q*(d*N-m*F),a[14]=-(l*(S*K-T*Q)-v*(d*K-m*Q)+q*(d*T-m*S)),a[15]=l*(S*N-T*F)-v*(d*N-m*F)+L*(d*T-m*S),a},Xe.determinant=function(a){var o=a[0],l=a[1],d=a[2],m=a[3],y=a[4],v=a[5],S=a[6],T=a[7],D=a[8],L=a[9],F=a[10],N=a[11],H=a[12],q=a[13],Q=a[14],K=a[15];return(o*v-l*y)*(F*K-N*Q)-(o*S-d*y)*(L*K-N*q)+(o*T-m*y)*(L*Q-F*q)+(l*S-d*v)*(D*K-N*H)-(l*T-m*v)*(D*Q-F*H)+(d*T-m*S)*(D*q-L*H)},Xe.multiply=li,Xe.translate=function(a,o,l){var d,m,y,v,S,T,D,L,F,N,H,q,Q=l[0],K=l[1],ae=l[2];return o===a?(a[12]=o[0]*Q+o[4]*K+o[8]*ae+o[12],a[13]=o[1]*Q+o[5]*K+o[9]*ae+o[13],a[14]=o[2]*Q+o[6]*K+o[10]*ae+o[14],a[15]=o[3]*Q+o[7]*K+o[11]*ae+o[15]):(m=o[1],y=o[2],v=o[3],S=o[4],T=o[5],D=o[6],L=o[7],F=o[8],N=o[9],H=o[10],q=o[11],a[0]=d=o[0],a[1]=m,a[2]=y,a[3]=v,a[4]=S,a[5]=T,a[6]=D,a[7]=L,a[8]=F,a[9]=N,a[10]=H,a[11]=q,a[12]=d*Q+S*K+F*ae+o[12],a[13]=m*Q+T*K+N*ae+o[13],a[14]=y*Q+D*K+H*ae+o[14],a[15]=v*Q+L*K+q*ae+o[15]),a},Xe.scale=function(a,o,l){var d=l[0],m=l[1],y=l[2];return a[0]=o[0]*d,a[1]=o[1]*d,a[2]=o[2]*d,a[3]=o[3]*d,a[4]=o[4]*m,a[5]=o[5]*m,a[6]=o[6]*m,a[7]=o[7]*m,a[8]=o[8]*y,a[9]=o[9]*y,a[10]=o[10]*y,a[11]=o[11]*y,a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a},Xe.rotate=function(a,o,l,d){var m,y,v,S,T,D,L,F,N,H,q,Q,K,ae,_e,ge,be,ze,ke,je,it,ut,vt,dt,At=d[0],jt=d[1],Ct=d[2],qt=Math.hypot(At,jt,Ct);return qt<yt.EPSILON?null:(At*=qt=1/qt,jt*=qt,Ct*=qt,m=Math.sin(l),y=Math.cos(l),T=o[1],D=o[2],L=o[3],N=o[5],H=o[6],q=o[7],K=o[9],ae=o[10],_e=o[11],ge=At*At*(v=1-y)+y,ke=At*jt*v-Ct*m,je=jt*jt*v+y,it=Ct*jt*v+At*m,ut=At*Ct*v+jt*m,vt=jt*Ct*v-At*m,dt=Ct*Ct*v+y,a[0]=(S=o[0])*ge+(F=o[4])*(be=jt*At*v+Ct*m)+(Q=o[8])*(ze=Ct*At*v-jt*m),a[1]=T*ge+N*be+K*ze,a[2]=D*ge+H*be+ae*ze,a[3]=L*ge+q*be+_e*ze,a[4]=S*ke+F*je+Q*it,a[5]=T*ke+N*je+K*it,a[6]=D*ke+H*je+ae*it,a[7]=L*ke+q*je+_e*it,a[8]=S*ut+F*vt+Q*dt,a[9]=T*ut+N*vt+K*dt,a[10]=D*ut+H*vt+ae*dt,a[11]=L*ut+q*vt+_e*dt,o!==a&&(a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a)},Xe.rotateX=function(a,o,l){var d=Math.sin(l),m=Math.cos(l),y=o[4],v=o[5],S=o[6],T=o[7],D=o[8],L=o[9],F=o[10],N=o[11];return o!==a&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[4]=y*m+D*d,a[5]=v*m+L*d,a[6]=S*m+F*d,a[7]=T*m+N*d,a[8]=D*m-y*d,a[9]=L*m-v*d,a[10]=F*m-S*d,a[11]=N*m-T*d,a},Xe.rotateY=function(a,o,l){var d=Math.sin(l),m=Math.cos(l),y=o[0],v=o[1],S=o[2],T=o[3],D=o[8],L=o[9],F=o[10],N=o[11];return o!==a&&(a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=y*m-D*d,a[1]=v*m-L*d,a[2]=S*m-F*d,a[3]=T*m-N*d,a[8]=y*d+D*m,a[9]=v*d+L*m,a[10]=S*d+F*m,a[11]=T*d+N*m,a},Xe.rotateZ=function(a,o,l){var d=Math.sin(l),m=Math.cos(l),y=o[0],v=o[1],S=o[2],T=o[3],D=o[4],L=o[5],F=o[6],N=o[7];return o!==a&&(a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=y*m+D*d,a[1]=v*m+L*d,a[2]=S*m+F*d,a[3]=T*m+N*d,a[4]=D*m-y*d,a[5]=L*m-v*d,a[6]=F*m-S*d,a[7]=N*m-T*d,a},Xe.fromTranslation=function(a,o){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=o[0],a[13]=o[1],a[14]=o[2],a[15]=1,a},Xe.fromScaling=function(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=o[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},Xe.fromRotation=function(a,o,l){var d,m,y,v=l[0],S=l[1],T=l[2],D=Math.hypot(v,S,T);return D<yt.EPSILON?null:(v*=D=1/D,S*=D,T*=D,d=Math.sin(o),m=Math.cos(o),a[0]=v*v*(y=1-m)+m,a[1]=S*v*y+T*d,a[2]=T*v*y-S*d,a[3]=0,a[4]=v*S*y-T*d,a[5]=S*S*y+m,a[6]=T*S*y+v*d,a[7]=0,a[8]=v*T*y+S*d,a[9]=S*T*y-v*d,a[10]=T*T*y+m,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)},Xe.fromXRotation=function(a,o){var l=Math.sin(o),d=Math.cos(o);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=d,a[6]=l,a[7]=0,a[8]=0,a[9]=-l,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},Xe.fromYRotation=function(a,o){var l=Math.sin(o),d=Math.cos(o);return a[0]=d,a[1]=0,a[2]=-l,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=l,a[9]=0,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},Xe.fromZRotation=function(a,o){var l=Math.sin(o),d=Math.cos(o);return a[0]=d,a[1]=l,a[2]=0,a[3]=0,a[4]=-l,a[5]=d,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},Xe.fromRotationTranslation=Qt,Xe.fromQuat2=function(a,o){var l=new yt.ARRAY_TYPE(3),d=-o[0],m=-o[1],y=-o[2],v=o[3],S=o[4],T=o[5],D=o[6],L=o[7],F=d*d+m*m+y*y+v*v;return F>0?(l[0]=2*(S*v+L*d+T*y-D*m)/F,l[1]=2*(T*v+L*m+D*d-S*y)/F,l[2]=2*(D*v+L*y+S*m-T*d)/F):(l[0]=2*(S*v+L*d+T*y-D*m),l[1]=2*(T*v+L*m+D*d-S*y),l[2]=2*(D*v+L*y+S*m-T*d)),Qt(a,o,l),a},Xe.getTranslation=function(a,o){return a[0]=o[12],a[1]=o[13],a[2]=o[14],a},Xe.getScaling=Wt,Xe.getRotation=function(a,o){var l=new yt.ARRAY_TYPE(3);Wt(l,o);var d=1/l[0],m=1/l[1],y=1/l[2],v=o[0]*d,S=o[1]*m,T=o[2]*y,D=o[4]*d,L=o[5]*m,F=o[6]*y,N=o[8]*d,H=o[9]*m,q=o[10]*y,Q=v+L+q,K=0;return Q>0?(K=2*Math.sqrt(Q+1),a[3]=.25*K,a[0]=(F-H)/K,a[1]=(N-T)/K,a[2]=(S-D)/K):v>L&&v>q?(K=2*Math.sqrt(1+v-L-q),a[3]=(F-H)/K,a[0]=.25*K,a[1]=(S+D)/K,a[2]=(N+T)/K):L>q?(K=2*Math.sqrt(1+L-v-q),a[3]=(N-T)/K,a[0]=(S+D)/K,a[1]=.25*K,a[2]=(F+H)/K):(K=2*Math.sqrt(1+q-v-L),a[3]=(S-D)/K,a[0]=(N+T)/K,a[1]=(F+H)/K,a[2]=.25*K),a},Xe.fromRotationTranslationScale=function(a,o,l,d){var m=o[0],y=o[1],v=o[2],S=o[3],T=m+m,D=y+y,L=v+v,F=m*T,N=m*D,H=m*L,q=y*D,Q=y*L,K=v*L,ae=S*T,_e=S*D,ge=S*L,be=d[0],ze=d[1],ke=d[2];return a[0]=(1-(q+K))*be,a[1]=(N+ge)*be,a[2]=(H-_e)*be,a[3]=0,a[4]=(N-ge)*ze,a[5]=(1-(F+K))*ze,a[6]=(Q+ae)*ze,a[7]=0,a[8]=(H+_e)*ke,a[9]=(Q-ae)*ke,a[10]=(1-(F+q))*ke,a[11]=0,a[12]=l[0],a[13]=l[1],a[14]=l[2],a[15]=1,a},Xe.fromRotationTranslationScaleOrigin=function(a,o,l,d,m){var y=o[0],v=o[1],S=o[2],T=o[3],D=y+y,L=v+v,F=S+S,N=y*D,H=y*L,q=y*F,Q=v*L,K=v*F,ae=S*F,_e=T*D,ge=T*L,be=T*F,ze=d[0],ke=d[1],je=d[2],it=m[0],ut=m[1],vt=m[2],dt=(1-(Q+ae))*ze,At=(H+be)*ze,jt=(q-ge)*ze,Ct=(H-be)*ke,qt=(1-(N+ae))*ke,Tt=(K+_e)*ke,Ot=(q+ge)*je,Kt=(K-_e)*je,Dt=(1-(N+Q))*je;return a[0]=dt,a[1]=At,a[2]=jt,a[3]=0,a[4]=Ct,a[5]=qt,a[6]=Tt,a[7]=0,a[8]=Ot,a[9]=Kt,a[10]=Dt,a[11]=0,a[12]=l[0]+it-(dt*it+Ct*ut+Ot*vt),a[13]=l[1]+ut-(At*it+qt*ut+Kt*vt),a[14]=l[2]+vt-(jt*it+Tt*ut+Dt*vt),a[15]=1,a},Xe.fromQuat=function(a,o){var l=o[0],d=o[1],m=o[2],y=o[3],v=l+l,S=d+d,T=m+m,D=l*v,L=d*v,F=d*S,N=m*v,H=m*S,q=m*T,Q=y*v,K=y*S,ae=y*T;return a[0]=1-F-q,a[1]=L+ae,a[2]=N-K,a[3]=0,a[4]=L-ae,a[5]=1-D-q,a[6]=H+Q,a[7]=0,a[8]=N+K,a[9]=H-Q,a[10]=1-D-F,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},Xe.frustum=function(a,o,l,d,m,y,v){var S=1/(l-o),T=1/(m-d),D=1/(y-v);return a[0]=2*y*S,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*y*T,a[6]=0,a[7]=0,a[8]=(l+o)*S,a[9]=(m+d)*T,a[10]=(v+y)*D,a[11]=-1,a[12]=0,a[13]=0,a[14]=v*y*2*D,a[15]=0,a},Xe.perspectiveNO=Di,Xe.perspectiveZO=function(a,o,l,d,m){var y,v=1/Math.tan(o/2);return a[0]=v/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=v,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,m!=null&&m!==1/0?(a[10]=m*(y=1/(d-m)),a[14]=m*d*y):(a[10]=-1,a[14]=-d),a},Xe.perspectiveFromFieldOfView=function(a,o,l,d){var m=Math.tan(o.upDegrees*Math.PI/180),y=Math.tan(o.downDegrees*Math.PI/180),v=Math.tan(o.leftDegrees*Math.PI/180),S=Math.tan(o.rightDegrees*Math.PI/180),T=2/(v+S),D=2/(m+y);return a[0]=T,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=D,a[6]=0,a[7]=0,a[8]=-(v-S)*T*.5,a[9]=(m-y)*D*.5,a[10]=d/(l-d),a[11]=-1,a[12]=0,a[13]=0,a[14]=d*l/(l-d),a[15]=0,a},Xe.orthoNO=Ii,Xe.orthoZO=function(a,o,l,d,m,y,v){var S=1/(o-l),T=1/(d-m),D=1/(y-v);return a[0]=-2*S,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*T,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=D,a[11]=0,a[12]=(o+l)*S,a[13]=(m+d)*T,a[14]=y*D,a[15]=1,a},Xe.lookAt=function(a,o,l,d){var m,y,v,S,T,D,L,F,N,H,q=o[0],Q=o[1],K=o[2],ae=d[0],_e=d[1],ge=d[2],be=l[0],ze=l[1],ke=l[2];return Math.abs(q-be)<yt.EPSILON&&Math.abs(Q-ze)<yt.EPSILON&&Math.abs(K-ke)<yt.EPSILON?Mt(a):(L=q-be,F=Q-ze,N=K-ke,m=_e*(N*=H=1/Math.hypot(L,F,N))-ge*(F*=H),y=ge*(L*=H)-ae*N,v=ae*F-_e*L,(H=Math.hypot(m,y,v))?(m*=H=1/H,y*=H,v*=H):(m=0,y=0,v=0),S=F*v-N*y,T=N*m-L*v,D=L*y-F*m,(H=Math.hypot(S,T,D))?(S*=H=1/H,T*=H,D*=H):(S=0,T=0,D=0),a[0]=m,a[1]=S,a[2]=L,a[3]=0,a[4]=y,a[5]=T,a[6]=F,a[7]=0,a[8]=v,a[9]=D,a[10]=N,a[11]=0,a[12]=-(m*q+y*Q+v*K),a[13]=-(S*q+T*Q+D*K),a[14]=-(L*q+F*Q+N*K),a[15]=1,a)},Xe.targetTo=function(a,o,l,d){var m=o[0],y=o[1],v=o[2],S=d[0],T=d[1],D=d[2],L=m-l[0],F=y-l[1],N=v-l[2],H=L*L+F*F+N*N;H>0&&(L*=H=1/Math.sqrt(H),F*=H,N*=H);var q=T*N-D*F,Q=D*L-S*N,K=S*F-T*L;return(H=q*q+Q*Q+K*K)>0&&(q*=H=1/Math.sqrt(H),Q*=H,K*=H),a[0]=q,a[1]=Q,a[2]=K,a[3]=0,a[4]=F*K-N*Q,a[5]=N*q-L*K,a[6]=L*Q-F*q,a[7]=0,a[8]=L,a[9]=F,a[10]=N,a[11]=0,a[12]=m,a[13]=y,a[14]=v,a[15]=1,a},Xe.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},Xe.frob=function(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])},Xe.add=function(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a[3]=o[3]+l[3],a[4]=o[4]+l[4],a[5]=o[5]+l[5],a[6]=o[6]+l[6],a[7]=o[7]+l[7],a[8]=o[8]+l[8],a[9]=o[9]+l[9],a[10]=o[10]+l[10],a[11]=o[11]+l[11],a[12]=o[12]+l[12],a[13]=o[13]+l[13],a[14]=o[14]+l[14],a[15]=o[15]+l[15],a},Xe.subtract=Li,Xe.multiplyScalar=function(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a[3]=o[3]*l,a[4]=o[4]*l,a[5]=o[5]*l,a[6]=o[6]*l,a[7]=o[7]*l,a[8]=o[8]*l,a[9]=o[9]*l,a[10]=o[10]*l,a[11]=o[11]*l,a[12]=o[12]*l,a[13]=o[13]*l,a[14]=o[14]*l,a[15]=o[15]*l,a},Xe.multiplyScalarAndAdd=function(a,o,l,d){return a[0]=o[0]+l[0]*d,a[1]=o[1]+l[1]*d,a[2]=o[2]+l[2]*d,a[3]=o[3]+l[3]*d,a[4]=o[4]+l[4]*d,a[5]=o[5]+l[5]*d,a[6]=o[6]+l[6]*d,a[7]=o[7]+l[7]*d,a[8]=o[8]+l[8]*d,a[9]=o[9]+l[9]*d,a[10]=o[10]+l[10]*d,a[11]=o[11]+l[11]*d,a[12]=o[12]+l[12]*d,a[13]=o[13]+l[13]*d,a[14]=o[14]+l[14]*d,a[15]=o[15]+l[15]*d,a},Xe.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]&&a[4]===o[4]&&a[5]===o[5]&&a[6]===o[6]&&a[7]===o[7]&&a[8]===o[8]&&a[9]===o[9]&&a[10]===o[10]&&a[11]===o[11]&&a[12]===o[12]&&a[13]===o[13]&&a[14]===o[14]&&a[15]===o[15]},Xe.equals=function(a,o){var l=a[0],d=a[1],m=a[2],y=a[3],v=a[4],S=a[5],T=a[6],D=a[7],L=a[8],F=a[9],N=a[10],H=a[11],q=a[12],Q=a[13],K=a[14],ae=a[15],_e=o[0],ge=o[1],be=o[2],ze=o[3],ke=o[4],je=o[5],it=o[6],ut=o[7],vt=o[8],dt=o[9],At=o[10],jt=o[11],Ct=o[12],qt=o[13],Tt=o[14],Ot=o[15];return Math.abs(l-_e)<=yt.EPSILON*Math.max(1,Math.abs(l),Math.abs(_e))&&Math.abs(d-ge)<=yt.EPSILON*Math.max(1,Math.abs(d),Math.abs(ge))&&Math.abs(m-be)<=yt.EPSILON*Math.max(1,Math.abs(m),Math.abs(be))&&Math.abs(y-ze)<=yt.EPSILON*Math.max(1,Math.abs(y),Math.abs(ze))&&Math.abs(v-ke)<=yt.EPSILON*Math.max(1,Math.abs(v),Math.abs(ke))&&Math.abs(S-je)<=yt.EPSILON*Math.max(1,Math.abs(S),Math.abs(je))&&Math.abs(T-it)<=yt.EPSILON*Math.max(1,Math.abs(T),Math.abs(it))&&Math.abs(D-ut)<=yt.EPSILON*Math.max(1,Math.abs(D),Math.abs(ut))&&Math.abs(L-vt)<=yt.EPSILON*Math.max(1,Math.abs(L),Math.abs(vt))&&Math.abs(F-dt)<=yt.EPSILON*Math.max(1,Math.abs(F),Math.abs(dt))&&Math.abs(N-At)<=yt.EPSILON*Math.max(1,Math.abs(N),Math.abs(At))&&Math.abs(H-jt)<=yt.EPSILON*Math.max(1,Math.abs(H),Math.abs(jt))&&Math.abs(q-Ct)<=yt.EPSILON*Math.max(1,Math.abs(q),Math.abs(Ct))&&Math.abs(Q-qt)<=yt.EPSILON*Math.max(1,Math.abs(Q),Math.abs(qt))&&Math.abs(K-Tt)<=yt.EPSILON*Math.max(1,Math.abs(K),Math.abs(Tt))&&Math.abs(ae-Ot)<=yt.EPSILON*Math.max(1,Math.abs(ae),Math.abs(Ot))},Xe.sub=Xe.mul=Xe.ortho=Xe.perspective=void 0;var yt=function(a,o){if(a&&a.__esModule)return a;if(a===null||kt(a)!=="object"&&typeof a!="function")return{default:a};var l=Nt(void 0);if(l&&l.has(a))return l.get(a);var d={},m=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in a)if(y!=="default"&&Object.prototype.hasOwnProperty.call(a,y)){var v=m?Object.getOwnPropertyDescriptor(a,y):null;v&&(v.get||v.set)?Object.defineProperty(d,y,v):d[y]=a[y]}return d.default=a,l&&l.set(a,d),d}(j);function Nt(a){if(typeof WeakMap!="function")return null;var o=new WeakMap,l=new WeakMap;return(Nt=function(d){return d?l:o})(a)}function Mt(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function li(a,o,l){var d=o[0],m=o[1],y=o[2],v=o[3],S=o[4],T=o[5],D=o[6],L=o[7],F=o[8],N=o[9],H=o[10],q=o[11],Q=o[12],K=o[13],ae=o[14],_e=o[15],ge=l[0],be=l[1],ze=l[2],ke=l[3];return a[0]=ge*d+be*S+ze*F+ke*Q,a[1]=ge*m+be*T+ze*N+ke*K,a[2]=ge*y+be*D+ze*H+ke*ae,a[3]=ge*v+be*L+ze*q+ke*_e,a[4]=(ge=l[4])*d+(be=l[5])*S+(ze=l[6])*F+(ke=l[7])*Q,a[5]=ge*m+be*T+ze*N+ke*K,a[6]=ge*y+be*D+ze*H+ke*ae,a[7]=ge*v+be*L+ze*q+ke*_e,a[8]=(ge=l[8])*d+(be=l[9])*S+(ze=l[10])*F+(ke=l[11])*Q,a[9]=ge*m+be*T+ze*N+ke*K,a[10]=ge*y+be*D+ze*H+ke*ae,a[11]=ge*v+be*L+ze*q+ke*_e,a[12]=(ge=l[12])*d+(be=l[13])*S+(ze=l[14])*F+(ke=l[15])*Q,a[13]=ge*m+be*T+ze*N+ke*K,a[14]=ge*y+be*D+ze*H+ke*ae,a[15]=ge*v+be*L+ze*q+ke*_e,a}function Qt(a,o,l){var d=o[0],m=o[1],y=o[2],v=o[3],S=d+d,T=m+m,D=y+y,L=d*S,F=d*T,N=d*D,H=m*T,q=m*D,Q=y*D,K=v*S,ae=v*T,_e=v*D;return a[0]=1-(H+Q),a[1]=F+_e,a[2]=N-ae,a[3]=0,a[4]=F-_e,a[5]=1-(L+Q),a[6]=q+K,a[7]=0,a[8]=N+ae,a[9]=q-K,a[10]=1-(L+H),a[11]=0,a[12]=l[0],a[13]=l[1],a[14]=l[2],a[15]=1,a}function Wt(a,o){var l=o[4],d=o[5],m=o[6],y=o[8],v=o[9],S=o[10];return a[0]=Math.hypot(o[0],o[1],o[2]),a[1]=Math.hypot(l,d,m),a[2]=Math.hypot(y,v,S),a}function Di(a,o,l,d,m){var y,v=1/Math.tan(o/2);return a[0]=v/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=v,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,m!=null&&m!==1/0?(a[10]=(m+d)*(y=1/(d-m)),a[14]=2*m*d*y):(a[10]=-1,a[14]=-2*d),a}function Ii(a,o,l,d,m,y,v){var S=1/(o-l),T=1/(d-m),D=1/(y-v);return a[0]=-2*S,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*T,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*D,a[11]=0,a[12]=(o+l)*S,a[13]=(m+d)*T,a[14]=(v+y)*D,a[15]=1,a}function Li(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a[2]=o[2]-l[2],a[3]=o[3]-l[3],a[4]=o[4]-l[4],a[5]=o[5]-l[5],a[6]=o[6]-l[6],a[7]=o[7]-l[7],a[8]=o[8]-l[8],a[9]=o[9]-l[9],a[10]=o[10]-l[10],a[11]=o[11]-l[11],a[12]=o[12]-l[12],a[13]=o[13]-l[13],a[14]=o[14]-l[14],a[15]=o[15]-l[15],a}Xe.perspective=Di,Xe.ortho=Ii,Xe.mul=li,Xe.sub=Li;var $t={},Ut={};function wi(a){return wi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},wi(a)}Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.create=Ke,Ut.clone=function(a){var o=new Hi.ARRAY_TYPE(3);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o},Ut.length=Re,Ut.fromValues=function(a,o,l){var d=new Hi.ARRAY_TYPE(3);return d[0]=a,d[1]=o,d[2]=l,d},Ut.copy=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a},Ut.set=function(a,o,l,d){return a[0]=o,a[1]=l,a[2]=d,a},Ut.add=function(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a},Ut.subtract=Lt,Ut.multiply=pi,Ut.divide=Ee,Ut.ceil=function(a,o){return a[0]=Math.ceil(o[0]),a[1]=Math.ceil(o[1]),a[2]=Math.ceil(o[2]),a},Ut.floor=function(a,o){return a[0]=Math.floor(o[0]),a[1]=Math.floor(o[1]),a[2]=Math.floor(o[2]),a},Ut.min=function(a,o,l){return a[0]=Math.min(o[0],l[0]),a[1]=Math.min(o[1],l[1]),a[2]=Math.min(o[2],l[2]),a},Ut.max=function(a,o,l){return a[0]=Math.max(o[0],l[0]),a[1]=Math.max(o[1],l[1]),a[2]=Math.max(o[2],l[2]),a},Ut.round=function(a,o){return a[0]=Math.round(o[0]),a[1]=Math.round(o[1]),a[2]=Math.round(o[2]),a},Ut.scale=function(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a},Ut.scaleAndAdd=function(a,o,l,d){return a[0]=o[0]+l[0]*d,a[1]=o[1]+l[1]*d,a[2]=o[2]+l[2]*d,a},Ut.distance=Zt,Ut.squaredDistance=Xi,Ut.squaredLength=Pi,Ut.negate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a},Ut.inverse=function(a,o){return a[0]=1/o[0],a[1]=1/o[1],a[2]=1/o[2],a},Ut.normalize=function(a,o){var l=o[0],d=o[1],m=o[2],y=l*l+d*d+m*m;return y>0&&(y=1/Math.sqrt(y)),a[0]=o[0]*y,a[1]=o[1]*y,a[2]=o[2]*y,a},Ut.dot=si,Ut.cross=function(a,o,l){var d=o[0],m=o[1],y=o[2],v=l[0],S=l[1],T=l[2];return a[0]=m*T-y*S,a[1]=y*v-d*T,a[2]=d*S-m*v,a},Ut.lerp=function(a,o,l,d){var m=o[0],y=o[1],v=o[2];return a[0]=m+d*(l[0]-m),a[1]=y+d*(l[1]-y),a[2]=v+d*(l[2]-v),a},Ut.hermite=function(a,o,l,d,m,y){var v=y*y,S=v*(2*y-3)+1,T=v*(y-2)+y,D=v*(y-1),L=v*(3-2*y);return a[0]=o[0]*S+l[0]*T+d[0]*D+m[0]*L,a[1]=o[1]*S+l[1]*T+d[1]*D+m[1]*L,a[2]=o[2]*S+l[2]*T+d[2]*D+m[2]*L,a},Ut.bezier=function(a,o,l,d,m,y){var v=1-y,S=v*v,T=y*y,D=S*v,L=3*y*S,F=3*T*v,N=T*y;return a[0]=o[0]*D+l[0]*L+d[0]*F+m[0]*N,a[1]=o[1]*D+l[1]*L+d[1]*F+m[1]*N,a[2]=o[2]*D+l[2]*L+d[2]*F+m[2]*N,a},Ut.random=function(a,o){o=o||1;var l=2*Hi.RANDOM()*Math.PI,d=2*Hi.RANDOM()-1,m=Math.sqrt(1-d*d)*o;return a[0]=Math.cos(l)*m,a[1]=Math.sin(l)*m,a[2]=d*o,a},Ut.transformMat4=function(a,o,l){var d=o[0],m=o[1],y=o[2],v=l[3]*d+l[7]*m+l[11]*y+l[15];return a[0]=(l[0]*d+l[4]*m+l[8]*y+l[12])/(v=v||1),a[1]=(l[1]*d+l[5]*m+l[9]*y+l[13])/v,a[2]=(l[2]*d+l[6]*m+l[10]*y+l[14])/v,a},Ut.transformMat3=function(a,o,l){var d=o[0],m=o[1],y=o[2];return a[0]=d*l[0]+m*l[3]+y*l[6],a[1]=d*l[1]+m*l[4]+y*l[7],a[2]=d*l[2]+m*l[5]+y*l[8],a},Ut.transformQuat=function(a,o,l){var d=l[0],m=l[1],y=l[2],v=o[0],S=o[1],T=o[2],D=m*T-y*S,L=y*v-d*T,F=d*S-m*v,N=m*F-y*L,H=y*D-d*F,q=d*L-m*D,Q=2*l[3];return L*=Q,F*=Q,H*=2,q*=2,a[0]=v+(D*=Q)+(N*=2),a[1]=S+L+H,a[2]=T+F+q,a},Ut.rotateX=function(a,o,l,d){var m=[],y=[];return m[0]=o[0]-l[0],m[1]=o[1]-l[1],m[2]=o[2]-l[2],y[0]=m[0],y[1]=m[1]*Math.cos(d)-m[2]*Math.sin(d),y[2]=m[1]*Math.sin(d)+m[2]*Math.cos(d),a[0]=y[0]+l[0],a[1]=y[1]+l[1],a[2]=y[2]+l[2],a},Ut.rotateY=function(a,o,l,d){var m=[],y=[];return m[0]=o[0]-l[0],m[1]=o[1]-l[1],m[2]=o[2]-l[2],y[0]=m[2]*Math.sin(d)+m[0]*Math.cos(d),y[1]=m[1],y[2]=m[2]*Math.cos(d)-m[0]*Math.sin(d),a[0]=y[0]+l[0],a[1]=y[1]+l[1],a[2]=y[2]+l[2],a},Ut.rotateZ=function(a,o,l,d){var m=[],y=[];return m[0]=o[0]-l[0],m[1]=o[1]-l[1],m[2]=o[2]-l[2],y[0]=m[0]*Math.cos(d)-m[1]*Math.sin(d),y[1]=m[0]*Math.sin(d)+m[1]*Math.cos(d),y[2]=m[2],a[0]=y[0]+l[0],a[1]=y[1]+l[1],a[2]=y[2]+l[2],a},Ut.angle=function(a,o){var l=a[0],d=a[1],m=a[2],y=o[0],v=o[1],S=o[2],T=Math.sqrt(l*l+d*d+m*m)*Math.sqrt(y*y+v*v+S*S),D=T&&si(a,o)/T;return Math.acos(Math.min(Math.max(D,-1),1))},Ut.zero=function(a){return a[0]=0,a[1]=0,a[2]=0,a},Ut.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},Ut.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]},Ut.equals=function(a,o){var l=a[0],d=a[1],m=a[2],y=o[0],v=o[1],S=o[2];return Math.abs(l-y)<=Hi.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(d-v)<=Hi.EPSILON*Math.max(1,Math.abs(d),Math.abs(v))&&Math.abs(m-S)<=Hi.EPSILON*Math.max(1,Math.abs(m),Math.abs(S))},Ut.forEach=Ut.sqrLen=Ut.len=Ut.sqrDist=Ut.dist=Ut.div=Ut.mul=Ut.sub=void 0;var Hi=function(a,o){if(a&&a.__esModule)return a;if(a===null||wi(a)!=="object"&&typeof a!="function")return{default:a};var l=lr(void 0);if(l&&l.has(a))return l.get(a);var d={},m=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in a)if(y!=="default"&&Object.prototype.hasOwnProperty.call(a,y)){var v=m?Object.getOwnPropertyDescriptor(a,y):null;v&&(v.get||v.set)?Object.defineProperty(d,y,v):d[y]=a[y]}return d.default=a,l&&l.set(a,d),d}(j);function lr(a){if(typeof WeakMap!="function")return null;var o=new WeakMap,l=new WeakMap;return(lr=function(d){return d?l:o})(a)}function Ke(){var a=new Hi.ARRAY_TYPE(3);return Hi.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Re(a){return Math.hypot(a[0],a[1],a[2])}function Lt(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a[2]=o[2]-l[2],a}function pi(a,o,l){return a[0]=o[0]*l[0],a[1]=o[1]*l[1],a[2]=o[2]*l[2],a}function Ee(a,o,l){return a[0]=o[0]/l[0],a[1]=o[1]/l[1],a[2]=o[2]/l[2],a}function Zt(a,o){return Math.hypot(o[0]-a[0],o[1]-a[1],o[2]-a[2])}function Xi(a,o){var l=o[0]-a[0],d=o[1]-a[1],m=o[2]-a[2];return l*l+d*d+m*m}function Pi(a){var o=a[0],l=a[1],d=a[2];return o*o+l*l+d*d}function si(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]}Ut.sub=Lt,Ut.mul=pi,Ut.div=Ee,Ut.dist=Zt,Ut.sqrDist=Xi,Ut.len=Re,Ut.sqrLen=Pi;var vi,ki=(vi=Ke(),function(a,o,l,d,m,y){var v,S;for(o||(o=3),l||(l=0),S=d?Math.min(d*o+l,a.length):a.length,v=l;v<S;v+=o)vi[0]=a[v],vi[1]=a[v+1],vi[2]=a[v+2],m(vi,vi,y),a[v]=vi[0],a[v+1]=vi[1],a[v+2]=vi[2];return a});Ut.forEach=ki;var Jt={};function mr(a){return mr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},mr(a)}Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.create=Sn,Jt.clone=function(a){var o=new $i.ARRAY_TYPE(4);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o},Jt.fromValues=function(a,o,l,d){var m=new $i.ARRAY_TYPE(4);return m[0]=a,m[1]=o,m[2]=l,m[3]=d,m},Jt.copy=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a},Jt.set=function(a,o,l,d,m){return a[0]=o,a[1]=l,a[2]=d,a[3]=m,a},Jt.add=function(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a[3]=o[3]+l[3],a},Jt.subtract=kr,Jt.multiply=wt,Jt.divide=Yt,Jt.ceil=function(a,o){return a[0]=Math.ceil(o[0]),a[1]=Math.ceil(o[1]),a[2]=Math.ceil(o[2]),a[3]=Math.ceil(o[3]),a},Jt.floor=function(a,o){return a[0]=Math.floor(o[0]),a[1]=Math.floor(o[1]),a[2]=Math.floor(o[2]),a[3]=Math.floor(o[3]),a},Jt.min=function(a,o,l){return a[0]=Math.min(o[0],l[0]),a[1]=Math.min(o[1],l[1]),a[2]=Math.min(o[2],l[2]),a[3]=Math.min(o[3],l[3]),a},Jt.max=function(a,o,l){return a[0]=Math.max(o[0],l[0]),a[1]=Math.max(o[1],l[1]),a[2]=Math.max(o[2],l[2]),a[3]=Math.max(o[3],l[3]),a},Jt.round=function(a,o){return a[0]=Math.round(o[0]),a[1]=Math.round(o[1]),a[2]=Math.round(o[2]),a[3]=Math.round(o[3]),a},Jt.scale=function(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a[3]=o[3]*l,a},Jt.scaleAndAdd=function(a,o,l,d){return a[0]=o[0]+l[0]*d,a[1]=o[1]+l[1]*d,a[2]=o[2]+l[2]*d,a[3]=o[3]+l[3]*d,a},Jt.distance=yi,Jt.squaredDistance=Ai,Jt.length=ir,Jt.squaredLength=dr,Jt.negate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a[3]=-o[3],a},Jt.inverse=function(a,o){return a[0]=1/o[0],a[1]=1/o[1],a[2]=1/o[2],a[3]=1/o[3],a},Jt.normalize=function(a,o){var l=o[0],d=o[1],m=o[2],y=o[3],v=l*l+d*d+m*m+y*y;return v>0&&(v=1/Math.sqrt(v)),a[0]=l*v,a[1]=d*v,a[2]=m*v,a[3]=y*v,a},Jt.dot=function(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]+a[3]*o[3]},Jt.cross=function(a,o,l,d){var m=l[0]*d[1]-l[1]*d[0],y=l[0]*d[2]-l[2]*d[0],v=l[0]*d[3]-l[3]*d[0],S=l[1]*d[2]-l[2]*d[1],T=l[1]*d[3]-l[3]*d[1],D=l[2]*d[3]-l[3]*d[2],L=o[0],F=o[1],N=o[2],H=o[3];return a[0]=F*D-N*T+H*S,a[1]=-L*D+N*v-H*y,a[2]=L*T-F*v+H*m,a[3]=-L*S+F*y-N*m,a},Jt.lerp=function(a,o,l,d){var m=o[0],y=o[1],v=o[2],S=o[3];return a[0]=m+d*(l[0]-m),a[1]=y+d*(l[1]-y),a[2]=v+d*(l[2]-v),a[3]=S+d*(l[3]-S),a},Jt.random=function(a,o){var l,d,m,y,v,S;o=o||1;do v=(l=2*$i.RANDOM()-1)*l+(d=2*$i.RANDOM()-1)*d;while(v>=1);do S=(m=2*$i.RANDOM()-1)*m+(y=2*$i.RANDOM()-1)*y;while(S>=1);var T=Math.sqrt((1-v)/S);return a[0]=o*l,a[1]=o*d,a[2]=o*m*T,a[3]=o*y*T,a},Jt.transformMat4=function(a,o,l){var d=o[0],m=o[1],y=o[2],v=o[3];return a[0]=l[0]*d+l[4]*m+l[8]*y+l[12]*v,a[1]=l[1]*d+l[5]*m+l[9]*y+l[13]*v,a[2]=l[2]*d+l[6]*m+l[10]*y+l[14]*v,a[3]=l[3]*d+l[7]*m+l[11]*y+l[15]*v,a},Jt.transformQuat=function(a,o,l){var d=o[0],m=o[1],y=o[2],v=l[0],S=l[1],T=l[2],D=l[3],L=D*d+S*y-T*m,F=D*m+T*d-v*y,N=D*y+v*m-S*d,H=-v*d-S*m-T*y;return a[0]=L*D+H*-v+F*-T-N*-S,a[1]=F*D+H*-S+N*-v-L*-T,a[2]=N*D+H*-T+L*-S-F*-v,a[3]=o[3],a},Jt.zero=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},Jt.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},Jt.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]},Jt.equals=function(a,o){var l=a[0],d=a[1],m=a[2],y=a[3],v=o[0],S=o[1],T=o[2],D=o[3];return Math.abs(l-v)<=$i.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(d-S)<=$i.EPSILON*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(m-T)<=$i.EPSILON*Math.max(1,Math.abs(m),Math.abs(T))&&Math.abs(y-D)<=$i.EPSILON*Math.max(1,Math.abs(y),Math.abs(D))},Jt.forEach=Jt.sqrLen=Jt.len=Jt.sqrDist=Jt.dist=Jt.div=Jt.mul=Jt.sub=void 0;var $i=function(a,o){if(a&&a.__esModule)return a;if(a===null||mr(a)!=="object"&&typeof a!="function")return{default:a};var l=Hr(void 0);if(l&&l.has(a))return l.get(a);var d={},m=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in a)if(y!=="default"&&Object.prototype.hasOwnProperty.call(a,y)){var v=m?Object.getOwnPropertyDescriptor(a,y):null;v&&(v.get||v.set)?Object.defineProperty(d,y,v):d[y]=a[y]}return d.default=a,l&&l.set(a,d),d}(j);function Hr(a){if(typeof WeakMap!="function")return null;var o=new WeakMap,l=new WeakMap;return(Hr=function(d){return d?l:o})(a)}function Sn(){var a=new $i.ARRAY_TYPE(4);return $i.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function kr(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a[2]=o[2]-l[2],a[3]=o[3]-l[3],a}function wt(a,o,l){return a[0]=o[0]*l[0],a[1]=o[1]*l[1],a[2]=o[2]*l[2],a[3]=o[3]*l[3],a}function Yt(a,o,l){return a[0]=o[0]/l[0],a[1]=o[1]/l[1],a[2]=o[2]/l[2],a[3]=o[3]/l[3],a}function yi(a,o){return Math.hypot(o[0]-a[0],o[1]-a[1],o[2]-a[2],o[3]-a[3])}function Ai(a,o){var l=o[0]-a[0],d=o[1]-a[1],m=o[2]-a[2],y=o[3]-a[3];return l*l+d*d+m*m+y*y}function ir(a){return Math.hypot(a[0],a[1],a[2],a[3])}function dr(a){var o=a[0],l=a[1],d=a[2],m=a[3];return o*o+l*l+d*d+m*m}Jt.sub=kr,Jt.mul=wt,Jt.div=Yt,Jt.dist=yi,Jt.sqrDist=Ai,Jt.len=ir,Jt.sqrLen=dr;var Rn=function(){var a=Sn();return function(o,l,d,m,y,v){var S,T;for(l||(l=4),d||(d=0),T=m?Math.min(m*l+d,o.length):o.length,S=d;S<T;S+=l)a[0]=o[S],a[1]=o[S+1],a[2]=o[S+2],a[3]=o[S+3],y(a,a,v),o[S]=a[0],o[S+1]=a[1],o[S+2]=a[2],o[S+3]=a[3];return o}}();function gs(a){return gs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},gs(a)}Jt.forEach=Rn,Object.defineProperty($t,"__esModule",{value:!0}),$t.create=_c,$t.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},$t.setAxisAngle=cs,$t.getAxisAngle=function(a,o){var l=2*Math.acos(o[3]),d=Math.sin(l/2);return d>ks.EPSILON?(a[0]=o[0]/d,a[1]=o[1]/d,a[2]=o[2]/d):(a[0]=1,a[1]=0,a[2]=0),l},$t.getAngle=function(a,o){var l=Ie(a,o);return Math.acos(2*l*l-1)},$t.multiply=Ze,$t.rotateX=function(a,o,l){l*=.5;var d=o[0],m=o[1],y=o[2],v=o[3],S=Math.sin(l),T=Math.cos(l);return a[0]=d*T+v*S,a[1]=m*T+y*S,a[2]=y*T-m*S,a[3]=v*T-d*S,a},$t.rotateY=function(a,o,l){l*=.5;var d=o[0],m=o[1],y=o[2],v=o[3],S=Math.sin(l),T=Math.cos(l);return a[0]=d*T-y*S,a[1]=m*T+v*S,a[2]=y*T+d*S,a[3]=v*T-m*S,a},$t.rotateZ=function(a,o,l){l*=.5;var d=o[0],m=o[1],y=o[2],v=o[3],S=Math.sin(l),T=Math.cos(l);return a[0]=d*T+m*S,a[1]=m*T-d*S,a[2]=y*T+v*S,a[3]=v*T-y*S,a},$t.calculateW=function(a,o){var l=o[0],d=o[1],m=o[2];return a[0]=l,a[1]=d,a[2]=m,a[3]=Math.sqrt(Math.abs(1-l*l-d*d-m*m)),a},$t.exp=xe,$t.ln=ie,$t.pow=function(a,o,l){return ie(a,o),De(a,a,l),xe(a,a),a},$t.slerp=re,$t.random=function(a){var o=ks.RANDOM(),l=ks.RANDOM(),d=ks.RANDOM(),m=Math.sqrt(1-o),y=Math.sqrt(o);return a[0]=m*Math.sin(2*Math.PI*l),a[1]=m*Math.cos(2*Math.PI*l),a[2]=y*Math.sin(2*Math.PI*d),a[3]=y*Math.cos(2*Math.PI*d),a},$t.invert=function(a,o){var l=o[0],d=o[1],m=o[2],y=o[3],v=l*l+d*d+m*m+y*y,S=v?1/v:0;return a[0]=-l*S,a[1]=-d*S,a[2]=-m*S,a[3]=y*S,a},$t.conjugate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a[3]=o[3],a},$t.fromMat3=he,$t.fromEuler=function(a,o,l,d){var m=.5*Math.PI/180;o*=m,l*=m,d*=m;var y=Math.sin(o),v=Math.cos(o),S=Math.sin(l),T=Math.cos(l),D=Math.sin(d),L=Math.cos(d);return a[0]=y*T*L-v*S*D,a[1]=v*S*L+y*T*D,a[2]=v*T*D-y*S*L,a[3]=v*T*L+y*S*D,a},$t.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},$t.setAxes=$t.sqlerp=$t.rotationTo=$t.equals=$t.exactEquals=$t.normalize=$t.sqrLen=$t.squaredLength=$t.len=$t.length=$t.lerp=$t.dot=$t.scale=$t.mul=$t.add=$t.set=$t.copy=$t.fromValues=$t.clone=void 0;var ks=Hl(j),Xn=Hl($e),ys=Hl(Ut),On=Hl(Jt);function vc(a){if(typeof WeakMap!="function")return null;var o=new WeakMap,l=new WeakMap;return(vc=function(d){return d?l:o})(a)}function Hl(a,o){if(a&&a.__esModule)return a;if(a===null||gs(a)!=="object"&&typeof a!="function")return{default:a};var l=vc(o);if(l&&l.has(a))return l.get(a);var d={},m=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in a)if(y!=="default"&&Object.prototype.hasOwnProperty.call(a,y)){var v=m?Object.getOwnPropertyDescriptor(a,y):null;v&&(v.get||v.set)?Object.defineProperty(d,y,v):d[y]=a[y]}return d.default=a,l&&l.set(a,d),d}function _c(){var a=new ks.ARRAY_TYPE(4);return ks.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function cs(a,o,l){l*=.5;var d=Math.sin(l);return a[0]=d*o[0],a[1]=d*o[1],a[2]=d*o[2],a[3]=Math.cos(l),a}function Ze(a,o,l){var d=o[0],m=o[1],y=o[2],v=o[3],S=l[0],T=l[1],D=l[2],L=l[3];return a[0]=d*L+v*S+m*D-y*T,a[1]=m*L+v*T+y*S-d*D,a[2]=y*L+v*D+d*T-m*S,a[3]=v*L-d*S-m*T-y*D,a}function xe(a,o){var l=o[0],d=o[1],m=o[2],y=o[3],v=Math.sqrt(l*l+d*d+m*m),S=Math.exp(y),T=v>0?S*Math.sin(v)/v:0;return a[0]=l*T,a[1]=d*T,a[2]=m*T,a[3]=S*Math.cos(v),a}function ie(a,o){var l=o[0],d=o[1],m=o[2],y=o[3],v=Math.sqrt(l*l+d*d+m*m),S=v>0?Math.atan2(v,y)/v:0;return a[0]=l*S,a[1]=d*S,a[2]=m*S,a[3]=.5*Math.log(l*l+d*d+m*m+y*y),a}function re(a,o,l,d){var m,y,v,S,T,D=o[0],L=o[1],F=o[2],N=o[3],H=l[0],q=l[1],Q=l[2],K=l[3];return(y=D*H+L*q+F*Q+N*K)<0&&(y=-y,H=-H,q=-q,Q=-Q,K=-K),1-y>ks.EPSILON?(m=Math.acos(y),v=Math.sin(m),S=Math.sin((1-d)*m)/v,T=Math.sin(d*m)/v):(S=1-d,T=d),a[0]=S*D+T*H,a[1]=S*L+T*q,a[2]=S*F+T*Q,a[3]=S*N+T*K,a}function he(a,o){var l,d=o[0]+o[4]+o[8];if(d>0)l=Math.sqrt(d+1),a[3]=.5*l,a[0]=(o[5]-o[7])*(l=.5/l),a[1]=(o[6]-o[2])*l,a[2]=(o[1]-o[3])*l;else{var m=0;o[4]>o[0]&&(m=1),o[8]>o[3*m+m]&&(m=2);var y=(m+1)%3,v=(m+2)%3;l=Math.sqrt(o[3*m+m]-o[3*y+y]-o[3*v+v]+1),a[m]=.5*l,a[3]=(o[3*y+v]-o[3*v+y])*(l=.5/l),a[y]=(o[3*y+m]+o[3*m+y])*l,a[v]=(o[3*v+m]+o[3*m+v])*l}return a}$t.clone=On.clone,$t.fromValues=On.fromValues,$t.copy=On.copy,$t.set=On.set,$t.add=On.add,$t.mul=Ze;var De=On.scale;$t.scale=De;var Ie=On.dot;$t.dot=Ie,$t.lerp=On.lerp;var He=On.length;$t.length=He,$t.len=He;var nt=On.squaredLength;$t.squaredLength=nt,$t.sqrLen=nt;var qe=On.normalize;$t.normalize=qe,$t.exactEquals=On.exactEquals,$t.equals=On.equals;var st,St,It,ni=(st=ys.create(),St=ys.fromValues(1,0,0),It=ys.fromValues(0,1,0),function(a,o,l){var d=ys.dot(o,l);return d<-.999999?(ys.cross(st,St,o),ys.len(st)<1e-6&&ys.cross(st,It,o),ys.normalize(st,st),cs(a,st,Math.PI),a):d>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(ys.cross(st,o,l),a[0]=st[0],a[1]=st[1],a[2]=st[2],a[3]=1+d,qe(a,a))});$t.rotationTo=ni;var Ci,Bi,Qi=(Ci=_c(),Bi=_c(),function(a,o,l,d,m,y){return re(Ci,o,m,y),re(Bi,l,d,y),re(a,Ci,Bi,2*y*(1-y)),a});$t.sqlerp=Qi;var fi,Sr=(fi=Xn.create(),function(a,o,l,d){return fi[0]=l[0],fi[3]=l[1],fi[6]=l[2],fi[1]=d[0],fi[4]=d[1],fi[7]=d[2],fi[2]=-o[0],fi[5]=-o[1],fi[8]=-o[2],qe(a,he(a,fi))});$t.setAxes=Sr;var _i={};function un(a){return un=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},un(a)}Object.defineProperty(_i,"__esModule",{value:!0}),_i.create=function(){var a=new qi.ARRAY_TYPE(8);return qi.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[4]=0,a[5]=0,a[6]=0,a[7]=0),a[3]=1,a},_i.clone=function(a){var o=new qi.ARRAY_TYPE(8);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o},_i.fromValues=function(a,o,l,d,m,y,v,S){var T=new qi.ARRAY_TYPE(8);return T[0]=a,T[1]=o,T[2]=l,T[3]=d,T[4]=m,T[5]=y,T[6]=v,T[7]=S,T},_i.fromRotationTranslationValues=function(a,o,l,d,m,y,v){var S=new qi.ARRAY_TYPE(8);S[0]=a,S[1]=o,S[2]=l,S[3]=d;var T=.5*m,D=.5*y,L=.5*v;return S[4]=T*d+D*l-L*o,S[5]=D*d+L*a-T*l,S[6]=L*d+T*o-D*a,S[7]=-T*a-D*o-L*l,S},_i.fromRotationTranslation=Ss,_i.fromTranslation=function(a,o){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a[4]=.5*o[0],a[5]=.5*o[1],a[6]=.5*o[2],a[7]=0,a},_i.fromRotation=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[4]=0,a[5]=0,a[6]=0,a[7]=0,a},_i.fromMat4=function(a,o){var l=vr.create();qn.getRotation(l,o);var d=new qi.ARRAY_TYPE(3);return qn.getTranslation(d,o),Ss(a,l,d),a},_i.copy=_n,_i.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a[6]=0,a[7]=0,a},_i.set=function(a,o,l,d,m,y,v,S,T){return a[0]=o,a[1]=l,a[2]=d,a[3]=m,a[4]=y,a[5]=v,a[6]=S,a[7]=T,a},_i.getDual=function(a,o){return a[0]=o[4],a[1]=o[5],a[2]=o[6],a[3]=o[7],a},_i.setDual=function(a,o){return a[4]=o[0],a[5]=o[1],a[6]=o[2],a[7]=o[3],a},_i.getTranslation=function(a,o){var l=o[4],d=o[5],m=o[6],y=o[7],v=-o[0],S=-o[1],T=-o[2],D=o[3];return a[0]=2*(l*D+y*v+d*T-m*S),a[1]=2*(d*D+y*S+m*v-l*T),a[2]=2*(m*D+y*T+l*S-d*v),a},_i.translate=function(a,o,l){var d=o[0],m=o[1],y=o[2],v=o[3],S=.5*l[0],T=.5*l[1],D=.5*l[2],L=o[4],F=o[5],N=o[6],H=o[7];return a[0]=d,a[1]=m,a[2]=y,a[3]=v,a[4]=v*S+m*D-y*T+L,a[5]=v*T+y*S-d*D+F,a[6]=v*D+d*T-m*S+N,a[7]=-d*S-m*T-y*D+H,a},_i.rotateX=function(a,o,l){var d=-o[0],m=-o[1],y=-o[2],v=o[3],S=o[4],T=o[5],D=o[6],L=o[7],F=S*v+L*d+T*y-D*m,N=T*v+L*m+D*d-S*y,H=D*v+L*y+S*m-T*d,q=L*v-S*d-T*m-D*y;return vr.rotateX(a,o,l),a[4]=F*(v=a[3])+q*(d=a[0])+N*(y=a[2])-H*(m=a[1]),a[5]=N*v+q*m+H*d-F*y,a[6]=H*v+q*y+F*m-N*d,a[7]=q*v-F*d-N*m-H*y,a},_i.rotateY=function(a,o,l){var d=-o[0],m=-o[1],y=-o[2],v=o[3],S=o[4],T=o[5],D=o[6],L=o[7],F=S*v+L*d+T*y-D*m,N=T*v+L*m+D*d-S*y,H=D*v+L*y+S*m-T*d,q=L*v-S*d-T*m-D*y;return vr.rotateY(a,o,l),a[4]=F*(v=a[3])+q*(d=a[0])+N*(y=a[2])-H*(m=a[1]),a[5]=N*v+q*m+H*d-F*y,a[6]=H*v+q*y+F*m-N*d,a[7]=q*v-F*d-N*m-H*y,a},_i.rotateZ=function(a,o,l){var d=-o[0],m=-o[1],y=-o[2],v=o[3],S=o[4],T=o[5],D=o[6],L=o[7],F=S*v+L*d+T*y-D*m,N=T*v+L*m+D*d-S*y,H=D*v+L*y+S*m-T*d,q=L*v-S*d-T*m-D*y;return vr.rotateZ(a,o,l),a[4]=F*(v=a[3])+q*(d=a[0])+N*(y=a[2])-H*(m=a[1]),a[5]=N*v+q*m+H*d-F*y,a[6]=H*v+q*y+F*m-N*d,a[7]=q*v-F*d-N*m-H*y,a},_i.rotateByQuatAppend=function(a,o,l){var d=l[0],m=l[1],y=l[2],v=l[3],S=o[0],T=o[1],D=o[2],L=o[3];return a[0]=S*v+L*d+T*y-D*m,a[1]=T*v+L*m+D*d-S*y,a[2]=D*v+L*y+S*m-T*d,a[3]=L*v-S*d-T*m-D*y,a[4]=(S=o[4])*v+(L=o[7])*d+(T=o[5])*y-(D=o[6])*m,a[5]=T*v+L*m+D*d-S*y,a[6]=D*v+L*y+S*m-T*d,a[7]=L*v-S*d-T*m-D*y,a},_i.rotateByQuatPrepend=function(a,o,l){var d=o[0],m=o[1],y=o[2],v=o[3],S=l[0],T=l[1],D=l[2],L=l[3];return a[0]=d*L+v*S+m*D-y*T,a[1]=m*L+v*T+y*S-d*D,a[2]=y*L+v*D+d*T-m*S,a[3]=v*L-d*S-m*T-y*D,a[4]=d*(L=l[7])+v*(S=l[4])+m*(D=l[6])-y*(T=l[5]),a[5]=m*L+v*T+y*S-d*D,a[6]=y*L+v*D+d*T-m*S,a[7]=v*L-d*S-m*T-y*D,a},_i.rotateAroundAxis=function(a,o,l,d){if(Math.abs(d)<qi.EPSILON)return _n(a,o);var m=Math.hypot(l[0],l[1],l[2]);d*=.5;var y=Math.sin(d),v=y*l[0]/m,S=y*l[1]/m,T=y*l[2]/m,D=Math.cos(d),L=o[0],F=o[1],N=o[2],H=o[3];a[0]=L*D+H*v+F*T-N*S,a[1]=F*D+H*S+N*v-L*T,a[2]=N*D+H*T+L*S-F*v,a[3]=H*D-L*v-F*S-N*T;var q=o[4],Q=o[5],K=o[6],ae=o[7];return a[4]=q*D+ae*v+Q*T-K*S,a[5]=Q*D+ae*S+K*v-q*T,a[6]=K*D+ae*T+q*S-Q*v,a[7]=ae*D-q*v-Q*S-K*T,a},_i.add=function(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a[3]=o[3]+l[3],a[4]=o[4]+l[4],a[5]=o[5]+l[5],a[6]=o[6]+l[6],a[7]=o[7]+l[7],a},_i.multiply=Br,_i.scale=function(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a[3]=o[3]*l,a[4]=o[4]*l,a[5]=o[5]*l,a[6]=o[6]*l,a[7]=o[7]*l,a},_i.lerp=function(a,o,l,d){var m=1-d;return cd(o,l)<0&&(d=-d),a[0]=o[0]*m+l[0]*d,a[1]=o[1]*m+l[1]*d,a[2]=o[2]*m+l[2]*d,a[3]=o[3]*m+l[3]*d,a[4]=o[4]*m+l[4]*d,a[5]=o[5]*m+l[5]*d,a[6]=o[6]*m+l[6]*d,a[7]=o[7]*m+l[7]*d,a},_i.invert=function(a,o){var l=eh(o);return a[0]=-o[0]/l,a[1]=-o[1]/l,a[2]=-o[2]/l,a[3]=o[3]/l,a[4]=-o[4]/l,a[5]=-o[5]/l,a[6]=-o[6]/l,a[7]=o[7]/l,a},_i.conjugate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a[3]=o[3],a[4]=-o[4],a[5]=-o[5],a[6]=-o[6],a[7]=o[7],a},_i.normalize=function(a,o){var l=eh(o);if(l>0){l=Math.sqrt(l);var d=o[0]/l,m=o[1]/l,y=o[2]/l,v=o[3]/l,S=o[4],T=o[5],D=o[6],L=o[7],F=d*S+m*T+y*D+v*L;a[0]=d,a[1]=m,a[2]=y,a[3]=v,a[4]=(S-d*F)/l,a[5]=(T-m*F)/l,a[6]=(D-y*F)/l,a[7]=(L-v*F)/l}return a},_i.str=function(a){return"quat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+")"},_i.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]&&a[4]===o[4]&&a[5]===o[5]&&a[6]===o[6]&&a[7]===o[7]},_i.equals=function(a,o){var l=a[0],d=a[1],m=a[2],y=a[3],v=a[4],S=a[5],T=a[6],D=a[7],L=o[0],F=o[1],N=o[2],H=o[3],q=o[4],Q=o[5],K=o[6],ae=o[7];return Math.abs(l-L)<=qi.EPSILON*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(d-F)<=qi.EPSILON*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(m-N)<=qi.EPSILON*Math.max(1,Math.abs(m),Math.abs(N))&&Math.abs(y-H)<=qi.EPSILON*Math.max(1,Math.abs(y),Math.abs(H))&&Math.abs(v-q)<=qi.EPSILON*Math.max(1,Math.abs(v),Math.abs(q))&&Math.abs(S-Q)<=qi.EPSILON*Math.max(1,Math.abs(S),Math.abs(Q))&&Math.abs(T-K)<=qi.EPSILON*Math.max(1,Math.abs(T),Math.abs(K))&&Math.abs(D-ae)<=qi.EPSILON*Math.max(1,Math.abs(D),Math.abs(ae))},_i.sqrLen=_i.squaredLength=_i.len=_i.length=_i.dot=_i.mul=_i.setReal=_i.getReal=void 0;var qi=Yn(j),vr=Yn($t),qn=Yn(Xe);function Zr(a){if(typeof WeakMap!="function")return null;var o=new WeakMap,l=new WeakMap;return(Zr=function(d){return d?l:o})(a)}function Yn(a,o){if(a&&a.__esModule)return a;if(a===null||un(a)!=="object"&&typeof a!="function")return{default:a};var l=Zr(o);if(l&&l.has(a))return l.get(a);var d={},m=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in a)if(y!=="default"&&Object.prototype.hasOwnProperty.call(a,y)){var v=m?Object.getOwnPropertyDescriptor(a,y):null;v&&(v.get||v.set)?Object.defineProperty(d,y,v):d[y]=a[y]}return d.default=a,l&&l.set(a,d),d}function Ss(a,o,l){var d=.5*l[0],m=.5*l[1],y=.5*l[2],v=o[0],S=o[1],T=o[2],D=o[3];return a[0]=v,a[1]=S,a[2]=T,a[3]=D,a[4]=d*D+m*T-y*S,a[5]=m*D+y*v-d*T,a[6]=y*D+d*S-m*v,a[7]=-d*v-m*S-y*T,a}function _n(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a}function Br(a,o,l){var d=o[0],m=o[1],y=o[2],v=o[3],S=l[4],T=l[5],D=l[6],L=l[7],F=o[4],N=o[5],H=o[6],q=o[7],Q=l[0],K=l[1],ae=l[2],_e=l[3];return a[0]=d*_e+v*Q+m*ae-y*K,a[1]=m*_e+v*K+y*Q-d*ae,a[2]=y*_e+v*ae+d*K-m*Q,a[3]=v*_e-d*Q-m*K-y*ae,a[4]=d*L+v*S+m*D-y*T+F*_e+q*Q+N*ae-H*K,a[5]=m*L+v*T+y*S-d*D+N*_e+q*K+H*Q-F*ae,a[6]=y*L+v*D+d*T-m*S+H*_e+q*ae+F*K-N*Q,a[7]=v*L-d*S-m*T-y*D+q*_e-F*Q-N*K-H*ae,a}_i.getReal=vr.copy,_i.setReal=vr.copy,_i.mul=Br;var cd=vr.dot;_i.dot=cd;var Wl=vr.length;_i.length=Wl,_i.len=Wl;var eh=vr.squaredLength;_i.squaredLength=eh,_i.sqrLen=eh;var rr={};function ye(a){return ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},ye(a)}Object.defineProperty(rr,"__esModule",{value:!0}),rr.create=Ve,rr.clone=function(a){var o=new Ce.ARRAY_TYPE(2);return o[0]=a[0],o[1]=a[1],o},rr.fromValues=function(a,o){var l=new Ce.ARRAY_TYPE(2);return l[0]=a,l[1]=o,l},rr.copy=function(a,o){return a[0]=o[0],a[1]=o[1],a},rr.set=function(a,o,l){return a[0]=o,a[1]=l,a},rr.add=function(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a},rr.subtract=Et,rr.multiply=xi,rr.divide=xc,rr.ceil=function(a,o){return a[0]=Math.ceil(o[0]),a[1]=Math.ceil(o[1]),a},rr.floor=function(a,o){return a[0]=Math.floor(o[0]),a[1]=Math.floor(o[1]),a},rr.min=function(a,o,l){return a[0]=Math.min(o[0],l[0]),a[1]=Math.min(o[1],l[1]),a},rr.max=function(a,o,l){return a[0]=Math.max(o[0],l[0]),a[1]=Math.max(o[1],l[1]),a},rr.round=function(a,o){return a[0]=Math.round(o[0]),a[1]=Math.round(o[1]),a},rr.scale=function(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a},rr.scaleAndAdd=function(a,o,l,d){return a[0]=o[0]+l[0]*d,a[1]=o[1]+l[1]*d,a},rr.distance=ud,rr.squaredDistance=th,rr.length=iu,rr.squaredLength=bc,rr.negate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a},rr.inverse=function(a,o){return a[0]=1/o[0],a[1]=1/o[1],a},rr.normalize=function(a,o){var l=o[0],d=o[1],m=l*l+d*d;return m>0&&(m=1/Math.sqrt(m)),a[0]=o[0]*m,a[1]=o[1]*m,a},rr.dot=function(a,o){return a[0]*o[0]+a[1]*o[1]},rr.cross=function(a,o,l){var d=o[0]*l[1]-o[1]*l[0];return a[0]=a[1]=0,a[2]=d,a},rr.lerp=function(a,o,l,d){var m=o[0],y=o[1];return a[0]=m+d*(l[0]-m),a[1]=y+d*(l[1]-y),a},rr.random=function(a,o){o=o||1;var l=2*Ce.RANDOM()*Math.PI;return a[0]=Math.cos(l)*o,a[1]=Math.sin(l)*o,a},rr.transformMat2=function(a,o,l){var d=o[0],m=o[1];return a[0]=l[0]*d+l[2]*m,a[1]=l[1]*d+l[3]*m,a},rr.transformMat2d=function(a,o,l){var d=o[0],m=o[1];return a[0]=l[0]*d+l[2]*m+l[4],a[1]=l[1]*d+l[3]*m+l[5],a},rr.transformMat3=function(a,o,l){var d=o[0],m=o[1];return a[0]=l[0]*d+l[3]*m+l[6],a[1]=l[1]*d+l[4]*m+l[7],a},rr.transformMat4=function(a,o,l){var d=o[0],m=o[1];return a[0]=l[0]*d+l[4]*m+l[12],a[1]=l[1]*d+l[5]*m+l[13],a},rr.rotate=function(a,o,l,d){var m=o[0]-l[0],y=o[1]-l[1],v=Math.sin(d),S=Math.cos(d);return a[0]=m*S-y*v+l[0],a[1]=m*v+y*S+l[1],a},rr.angle=function(a,o){var l=a[0],d=a[1],m=o[0],y=o[1],v=Math.sqrt(l*l+d*d)*Math.sqrt(m*m+y*y);return Math.acos(Math.min(Math.max(v&&(l*m+d*y)/v,-1),1))},rr.zero=function(a){return a[0]=0,a[1]=0,a},rr.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},rr.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]},rr.equals=function(a,o){var l=a[0],d=a[1],m=o[0],y=o[1];return Math.abs(l-m)<=Ce.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(d-y)<=Ce.EPSILON*Math.max(1,Math.abs(d),Math.abs(y))},rr.forEach=rr.sqrLen=rr.sqrDist=rr.dist=rr.div=rr.mul=rr.sub=rr.len=void 0;var Ce=function(a,o){if(a&&a.__esModule)return a;if(a===null||ye(a)!=="object"&&typeof a!="function")return{default:a};var l=ht(void 0);if(l&&l.has(a))return l.get(a);var d={},m=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in a)if(y!=="default"&&Object.prototype.hasOwnProperty.call(a,y)){var v=m?Object.getOwnPropertyDescriptor(a,y):null;v&&(v.get||v.set)?Object.defineProperty(d,y,v):d[y]=a[y]}return d.default=a,l&&l.set(a,d),d}(j);function ht(a){if(typeof WeakMap!="function")return null;var o=new WeakMap,l=new WeakMap;return(ht=function(d){return d?l:o})(a)}function Ve(){var a=new Ce.ARRAY_TYPE(2);return Ce.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0),a}function Et(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a}function xi(a,o,l){return a[0]=o[0]*l[0],a[1]=o[1]*l[1],a}function xc(a,o,l){return a[0]=o[0]/l[0],a[1]=o[1]/l[1],a}function ud(a,o){return Math.hypot(o[0]-a[0],o[1]-a[1])}function th(a,o){var l=o[0]-a[0],d=o[1]-a[1];return l*l+d*d}function iu(a){return Math.hypot(a[0],a[1])}function bc(a){var o=a[0],l=a[1];return o*o+l*l}rr.len=iu,rr.sub=Et,rr.mul=xi,rr.div=xc,rr.dist=ud,rr.sqrDist=th,rr.sqrLen=bc;var ih=function(){var a=Ve();return function(o,l,d,m,y,v){var S,T;for(l||(l=2),d||(d=0),T=m?Math.min(m*l+d,o.length):o.length,S=d;S<T;S+=l)a[0]=o[S],a[1]=o[S+1],y(a,a,v),o[S]=a[0],o[S+1]=a[1];return o}}();function iv(a){return iv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},iv(a)}rr.forEach=ih,Object.defineProperty(U,"__esModule",{value:!0}),n.aB=U.vec4=n.$=U.vec3=U.vec2=U.quat2=n.aw=U.quat=n.ae=U.mat4=n.bE=U.mat3=U.mat2d=n.aD=U.mat2=U.glMatrix=void 0;var uE=Za(j);U.glMatrix=uE;var hE=Za(X);n.aD=U.mat2=hE;var Op=Za(fe);U.mat2d=Op;var Wr=Za($e);n.bE=U.mat3=Wr;var cP=Za(Xe);n.ae=U.mat4=cP;var uP=Za($t);n.aw=U.quat=uP;var hP=Za(_i);U.quat2=hP;var dE=Za(rr);U.vec2=dE;var dP=Za(Ut);n.$=U.vec3=dP;var Vx=Za(Jt);function Mm(a){if(typeof WeakMap!="function")return null;var o=new WeakMap,l=new WeakMap;return(Mm=function(d){return d?l:o})(a)}function Za(a,o){if(a&&a.__esModule)return a;if(a===null||iv(a)!=="object"&&typeof a!="function")return{default:a};var l=Mm(o);if(l&&l.has(a))return l.get(a);var d={},m=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in a)if(y!=="default"&&Object.prototype.hasOwnProperty.call(a,y)){var v=m?Object.getOwnPropertyDescriptor(a,y):null;v&&(v.get||v.set)?Object.defineProperty(d,y,v):d[y]=a[y]}return d.default=a,l&&l.set(a,d),d}n.aB=U.vec4=Vx;var pE=fE;function fE(a,o,l,d){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(d-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=o,this.p2x=l,this.p2y=d}fE.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,o){if(o===void 0&&(o=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,d=0;d<8;d++){var m=this.sampleCurveX(l)-a;if(Math.abs(m)<o)return l;var y=this.sampleCurveDerivativeX(l);if(Math.abs(y)<1e-6)break;l-=m/y}var v=0,S=1;for(l=a,d=0;d<20&&(m=this.sampleCurveX(l),!(Math.abs(m-a)<o));d++)a>m?v=l:S=l,l=.5*(S-v)+v;return l},solve:function(a,o){return this.sampleCurveY(this.solveCurveX(a,o))}};var Gx=k(pE),Tm=hd;function hd(a,o){this.x=a,this.y=o}hd.prototype={clone:function(){return new hd(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,o){return this.clone()._rotateAround(a,o)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var o=a.x-this.x,l=a.y-this.y;return o*o+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,o){return Math.atan2(this.x*o-this.y*a,this.x*a+this.y*o)},_matMult:function(a){var o=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=o,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var o=Math.cos(a),l=Math.sin(a),d=l*this.x+o*this.y;return this.x=o*this.x-l*this.y,this.y=d,this},_rotateAround:function(a,o){var l=Math.cos(a),d=Math.sin(a),m=o.y+d*(this.x-o.x)+l*(this.y-o.y);return this.x=o.x+l*(this.x-o.x)-d*(this.y-o.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},hd.convert=function(a){return a instanceof hd?a:Array.isArray(a)?new hd(a[0],a[1]):a};var ai=k(Tm);function Lp(a,o){if(Array.isArray(a)){if(!Array.isArray(o)||a.length!==o.length)return!1;for(let l=0;l<a.length;l++)if(!Lp(a[l],o[l]))return!1;return!0}if(typeof a=="object"&&a!==null&&o!==null){if(typeof o!="object"||Object.keys(a).length!==Object.keys(o).length)return!1;for(let l in a)if(!Lp(a[l],o[l]))return!1;return!0}return a===o}let mE=Math.PI/180,zp=180/Math.PI;function Rr(a){return a*mE}function xa(a){return a*zp}let Am=[[0,0],[1,0],[1,1],[0,1]];function rv(a){if(a<=0)return 0;if(a>=1)return 1;let o=a*a,l=o*a;return 4*(a<.5?l:3*(a-o)+l-.75)}function nv(a,o,l,d){let m=new Gx(a,o,l,d);return function(y){return m.solve(y)}}let ql=nv(.25,.1,.25,1);function xr(a,o,l){return Math.min(l,Math.max(o,a))}function Hx(a,o,l){return(l=xr((l-a)/(o-a),0,1))*l*(3-2*l)}function Fp(a,o,l){let d=l-o,m=((a-o)%d+d)%d+o;return m===o?l:m}function Cm(a,o,l){if(!a.length)return l(null,[]);let d=a.length,m=new Array(a.length),y=null;a.forEach((v,S)=>{o(v,(T,D)=>{T&&(y=T),m[S]=D,--d==0&&l(y,m)})})}function Wx(a){let o=[];for(let l in a)o.push(a[l]);return o}function Io(a,...o){for(let l of o)for(let d in l)a[d]=l[d];return a}let gE=1;function sv(){return gE++}function kp(){return function a(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function dd(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function qx(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function ov(a,o){a.forEach(l=>{o[l]&&(o[l]=o[l].bind(o))})}function Dm(a,o){return a.indexOf(o,a.length-o.length)!==-1}function Im(a,o,l){let d={};for(let m in a)d[m]=o.call(this,a[m],m,a);return d}function Po(a,o,l){let d={};for(let m in a)o.call(this,a[m],m,a)&&(d[m]=a[m]);return d}function ba(a){return Array.isArray(a)?a.map(ba):typeof a=="object"&&a?Im(a,ba):a}let Ro={};function Ds(a){Ro[a]||(typeof console<"u"&&console.warn(a),Ro[a]=!0)}function rh(a,o,l){return(l.y-a.y)*(o.x-a.x)>(o.y-a.y)*(l.x-a.x)}function pP(a){let o=0;for(let l,d,m=0,y=a.length,v=y-1;m<y;v=m++)l=a[m],d=a[v],o+=(d.x-l.x)*(l.y+d.y);return o}function Np([a,o,l]){let d=Rr(o+90),m=Rr(l);return{x:a*Math.cos(d)*Math.sin(m),y:a*Math.sin(d)*Math.sin(m),z:a*Math.cos(m),azimuthal:o,polar:l}}function Bp(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Pm(a){let o={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,d,m,y)=>{let v=m||y;return o[d]=!v||v.toLowerCase(),""}),o["max-age"]){let l=parseInt(o["max-age"],10);isNaN(l)?delete o["max-age"]:o["max-age"]=l}return o}let Yx,Rm,nh,Om,sh,Lm,zm=null;function av(a){try{let o=self[a];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}}function oh(a,o){return[a[4*o],a[4*o+1],a[4*o+2],a[4*o+3]]}function lv(a,o,l,d){for(;o<l;){let m=o+l>>1;a[m]<d?o=m+1:l=m}return o}function cv(a,o,l,d){for(;o<l;){let m=o+l>>1;a[m]<=d?o=m+1:l=m}return o}function yE(a){return a>0?1/(1.001-a):1+a}function vE(a){return a>0?1-1/(1.001-a):-a}function Xx(){return Yx==null&&(Yx=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Yx}let Oo={now:()=>Om!==void 0?Om:performance.now(),setNow(a){Om=a},restoreNow(){Om=void 0},frame(a){let o=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(a,o=0){let{width:l,height:d}=a;sh||(sh=document.createElement("canvas"));let m=sh.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(l>sh.width||d>sh.height)&&(sh.width=l,sh.height=d),m.clearRect(-o,-o,l+2*o,d+2*o),m.drawImage(a,0,0,l,d),m.getImageData(-o,-o,l+2*o,d+2*o)},resolveURL:a=>(Rm||(Rm=document.createElement("a")),Rm.href=a,Rm.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(nh==null&&(nh=window.matchMedia("(prefers-reduced-motion: reduce)")),nh.matches)},hasCanvasFingerprintNoise(){if(Lm!==void 0)return Lm;if(!Xx())return Lm=!1,!1;let a=new OffscreenCanvas(85,1),o=a.getContext("2d",{willReadFrequently:!0}),l=0;for(let m=0;m<a.width;++m)o.fillStyle=`rgba(${l++},${l++},${l++}, 255)`,o.fillRect(m,0,1,1);let d=o.getImageData(0,0,a.width,a.height);l=0;for(let m=0;m<d.data.length;++m)if(m%4!=3&&l++!==d.data[m])return Lm=!0,!0;return Lm=!1,!1}};function _E(a,o){let l=a.indexOf("?");if(l<0)return`${a}?${new URLSearchParams(o).toString()}`;let d=new URLSearchParams(a.slice(l));for(let m in o)d.set(m,o[m]);return`${a.slice(0,l)}?${d.toString()}`}function $x(a,o={persistentParams:[]}){let l=a.indexOf("?");if(l<0)return a;let d=new URLSearchParams,m=new URLSearchParams(a.slice(l));for(let v of o.persistentParams){let S=m.get(v);S&&d.set(v,S)}let y=d.toString();return`${a.slice(0,l)}${y.length>0?`?${y}`:""}`}let xE="mapbox-tiles",Zx=500,Qx=50,bE=["language","worldview","jobid"],wc,uv;function wE(){try{return caches}catch{}}function Fm(){let a=wE();a&&!wc&&(wc=a.open(xE))}let hv=1/0,dv={supported:!1,testSupport:function(a){!pv&&Up&&(SE?Kx(a):km=a)}},km,Up,pv=!1,SE=!1,EE=typeof self<"u"?self:{};function Kx(a){let o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Up),a.isContextLost())return;dv.supported=!0}catch{}a.deleteTexture(o),pv=!0}EE.document&&(Up=EE.document.createElement("img"),Up.onload=function(){km&&Kx(km),km=null,SE=!0},Up.onerror=function(){pv=!0,km=null},Up.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Nm={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Nm);class fv extends Error{constructor(o,l,d){l===401&&f(d)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=l,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Jx=Bp()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Sc=function(a,o){if(!(/^file:/.test(l=a.url)||/^file:/.test(Jx())&&!/^\w+:/.test(l))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(d,m){let y=new AbortController,v=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:Jx(),referrerPolicy:d.referrerPolicy,signal:y.signal}),S=!1,T=!1,D=(L=v.url).indexOf("sku=")>0&&f(L);var L;d.type==="json"&&v.headers.set("Accept","application/json");let F=(H,q,Q)=>{if(T)return;if(H&&H.message!=="SecurityError"&&Ds(H.toString()),q&&Q)return N(q);let K=Date.now();fetch(v).then(ae=>{if(ae.ok){let _e=D?ae.clone():null;return N(ae,_e,K)}return m(new fv(ae.statusText,ae.status,d.url))}).catch(ae=>{ae.name!=="AbortError"&&m(new Error(`${ae.message} ${d.url}`))})},N=(H,q,Q)=>{(d.type==="arrayBuffer"?H.arrayBuffer():d.type==="json"?H.json():H.text()).then(K=>{T||(q&&Q&&function(ae,_e,ge){if(Fm(),!wc)return;let be=Pm(_e.headers.get("Cache-Control")||"");if(be["no-store"])return;let ze={status:_e.status,statusText:_e.statusText,headers:new Headers};_e.headers.forEach((it,ut)=>ze.headers.set(ut,it)),be["max-age"]&&ze.headers.set("Expires",new Date(ge+1e3*be["max-age"]).toUTCString());let ke=ze.headers.get("Expires");if(!ke||new Date(ke).getTime()-ge<42e4)return;let je=$x(ae.url,{persistentParams:bE});if(_e.status===206){let it=ae.headers.get("Range");if(!it)return;ze.status=200,je=_E(je,{range:it})}(function(it,ut){if(uv===void 0)try{new Response(new ReadableStream),uv=!0}catch{uv=!1}uv?ut(it.body):it.blob().then(ut)})(_e,it=>{let ut=new Response((vt=_e.status)!==200&&vt!==404&&[101,103,204,205,304].includes(vt)?null:it,ze);var vt;Fm(),wc&&wc.then(dt=>dt.put(je,ut)).catch(dt=>Ds(dt.message))})}(v,q,Q),S=!0,m(null,K,H.headers.get("Cache-Control"),H.headers.get("Expires")))}).catch(K=>{T||m(new Error(K.message))})};return D?function(H,q){if(Fm(),!wc)return q(null);wc.then(Q=>{let K=$x(H.url,{persistentParams:bE}),ae=H.headers.get("Range");ae&&(K=_E(K,{range:ae})),Q.match(K).then(_e=>{let ge=function(be){if(!be)return!1;let ze=new Date(be.headers.get("Expires")||0),ke=Pm(be.headers.get("Cache-Control")||"");return ze>Date.now()&&!ke["no-cache"]}(_e);Q.delete(K),ge&&Q.put(K,_e.clone()),q(null,_e,ge)}).catch(q)}).catch(q)}(v,F):F(null,null),{cancel:()=>{T=!0,S||y.abort()}}}(a,o);if(Bp()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,o,void 0,!0)}var l;return function(d,m){let y=new XMLHttpRequest;y.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(let v in d.headers)y.setRequestHeader(v,d.headers[v]);return d.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=d.credentials==="include",y.onerror=()=>{m(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let v=y.response;if(d.type==="json")try{v=JSON.parse(y.response)}catch(S){return m(S)}m(null,v,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else m(new fv(y.statusText,y.status,d.url))},y.send(d.body),{cancel:()=>y.abort()}}(a,o)},pd=function(a,o){return Sc(Io(a,{type:"arrayBuffer"}),o)};function fP(a){let o=document.createElement("a");return o.href=a,o.protocol===location.protocol&&o.host===location.host}let ME="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Bm,jp;Bm=[],jp=0;let Um=function(a,o){if(dv.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),jp>=p.MAX_PARALLEL_IMAGE_REQUESTS){let y={requestParameters:a,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return Bm.push(y),y}jp++;let l=!1,d=()=>{if(!l)for(l=!0,jp--;Bm.length&&jp<p.MAX_PARALLEL_IMAGE_REQUESTS;){let y=Bm.shift(),{requestParameters:v,callback:S,cancelled:T}=y;T||(y.cancel=Um(v,S).cancel)}},m=pd(a,(y,v,S,T)=>{d(),y?o(y):v&&(self.createImageBitmap?function(D,L){let F=new Blob([new Uint8Array(D)],{type:"image/png"});createImageBitmap(F).then(N=>{L(null,N)}).catch(N=>{L(new Error(`Could not load image because of ${N.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(D,L)=>o(D,L,S,T)):function(D,L){let F=new Image;F.onload=()=>{L(null,F),URL.revokeObjectURL(F.src),F.onload=null,requestAnimationFrame(()=>{F.src=ME})},F.onerror=()=>L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let N=new Blob([new Uint8Array(D)],{type:"image/png"});F.src=D.byteLength?URL.createObjectURL(N):ME}(v,(D,L)=>o(D,L,S,T)))});return{cancel:()=>{m.cancel(),d()}}},e1="01",t1="NO_ACCESS_TOKEN",mP=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function El(a){let o=a.match(mP);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function fd(a){let o=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${o}`}let i1="mapbox.eventData";function TE(a){if(!a)return null;let o=a.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(o[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class md{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){let l=TE(p.ACCESS_TOKEN),d="";return d=l&&l.u?btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(m,y)=>String.fromCharCode(+("0x"+y)))):p.ACCESS_TOKEN||"",o?`${i1}.${o}:${d}`:`${i1}:${d}`}fetchEventData(){let o=av("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid");if(o)try{let m=localStorage.getItem(l);m&&(this.eventData=JSON.parse(m));let y=localStorage.getItem(d);y&&(this.anonId=y)}catch{Ds("Unable to read from LocalStorage")}}saveEventData(){let o=av("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid"),m=this.anonId;if(o&&m)try{localStorage.setItem(d,m),Object.keys(this.eventData).length>=1&&localStorage.setItem(l,JSON.stringify(this.eventData))}catch{Ds("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,l,d,m){if(!p.EVENTS_URL)return;let y=El(p.EVENTS_URL);y.params.push(`access_token=${m||p.ACCESS_TOKEN||""}`);let v={event:this.type,created:new Date(o).toISOString()},S=l?Io(v,l):v,T={url:fd(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=function(D,L){return Sc(Io(D,{method:"POST"}),L)}(T,D=>{this.pendingRequest=null,d(D),this.saveEventData(),this.processRequests(m)})}queueRequest(o,l){this.queue.push(o),this.processRequests(l)}}let AE=new class extends md{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,o){p.EVENTS_URL&&p.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>x(l)||f(l))&&this.queueRequest(Date.now(),o)}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let o=TE(p.ACCESS_TOKEN),l=o?o.u:p.ACCESS_TOKEN,d=l!==this.eventData.tokenU;qx(this.anonId)||(this.anonId=kp(),d=!0);let m=this.queue.shift();if(this.eventData.lastSuccess){let y=new Date(this.eventData.lastSuccess),v=new Date(m),S=(m-this.eventData.lastSuccess)/864e5;d=d||S>=1||S<-1||y.getDate()!==v.getDate()}else d=!0;d?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:c,skuId:e1,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=m,this.eventData.tokenU=l)},a):this.processRequests()}},r1=AE.postTurnstileEvent.bind(AE),Vp=new class extends md{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,o,l,d){this.skuToken=o,this.errorCb=d,p.EVENTS_URL&&(l||p.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(t1)))}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;let{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),qx(this.anonId)||(this.anonId=kp()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:c,skuId:e1,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):o&&(this.success[o]=!0)},a))}remove(){this.errorCb=null}},CE=Vp.postMapLoadEvent.bind(Vp),jm=new class extends md{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(a){let o=this.mapInstanceIdMap.get(a);return o||(o=kp(),this.mapInstanceIdMap.set(a,o)),o}getEventId(a){let o=this.eventIdPerMapInstanceMap.get(a)||0;return this.eventIdPerMapInstanceMap.set(a,o+1),o}postStyleLoadEvent(a,o){let{map:l,style:d,importedStyles:m}=o;if(!p.EVENTS_URL||!a&&!p.ACCESS_TOKEN)return;let y=this.getMapInstanceId(l),v={mapInstanceId:y,eventId:this.getEventId(y),style:d};m.length&&(v.importedStyles=m),this.queueRequest({timestamp:Date.now(),payload:v},a)}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:o,payload:l}=this.queue.shift();this.postEvent(o,l,()=>{},a)}},DE=jm.postStyleLoadEvent.bind(jm),IE=new class extends md{constructor(){super("gljs.performance")}postPerformanceEvent(a,o){p.EVENTS_URL&&(a||p.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},a)}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:o,performanceData:l}=this.queue.shift(),d=function(m){let y=performance.getEntriesByType("resource"),v=performance.getEntriesByType("mark"),S=function(H){let q={};if(H){for(let Q in H)if(Q!=="other")for(let K of H[Q]){let ae=`${Q}ResolveRangeMin`,_e=`${Q}ResolveRangeMax`,ge=`${Q}RequestCount`,be=`${Q}RequestCachedCount`;q[ae]=Math.min(q[ae]||1/0,K.startTime),q[_e]=Math.max(q[_e]||-1/0,K.responseEnd);let ze=ke=>{q[ke]===void 0&&(q[ke]=0),++q[ke]};K.transferSize!==void 0&&K.transferSize===0&&ze(be),ze(ge)}}return q}(function(H,q){let Q={};if(H)for(let K of H){let ae=q(K);Q[ae]===void 0&&(Q[ae]=[]),Q[ae].push(K)}return Q}(y,O)),T=window.devicePixelRatio,D=navigator.connection||navigator.mozConnection||navigator.webkitConnection,L=D?D.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},N=(H,q,Q)=>{Q!=null&&H.push({name:q,value:Q.toString()})};for(let H in S)N(F.counters,H,S[H]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(N(F.counters,"interactionRangeMin",m.interactionRange[0]),N(F.counters,"interactionRangeMax",m.interactionRange[1])),v)for(let H of Object.keys(I)){let q=I[H],Q=v.find(K=>K.name===q);Q&&N(F.counters,q,Q.startTime)}return N(F.counters,"visibilityHidden",m.visibilityHidden),N(F.attributes,"style",function(H){if(H)for(let q of H){let Q=q.name.split("?")[0];if(A(Q)){let K=Q.split("/").slice(-2);if(K.length===2)return`mapbox://styles/${K[0]}/${K[1]}`}}}(y)),N(F.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),N(F.attributes,"fogEnabled",m.fogEnabled?"true":"false"),N(F.attributes,"projection",m.projection),N(F.attributes,"zoom",m.zoom),N(F.metadata,"devicePixelRatio",T),N(F.metadata,"connectionEffectiveType",L),N(F.metadata,"navigatorUserAgent",navigator.userAgent),N(F.metadata,"screenWidth",window.screen.width),N(F.metadata,"screenHeight",window.screen.height),N(F.metadata,"windowWidth",window.innerWidth),N(F.metadata,"windowHeight",window.innerHeight),N(F.metadata,"mapWidth",m.width/T),N(F.metadata,"mapHeight",m.height/T),N(F.metadata,"webglRenderer",m.renderer),N(F.metadata,"webglVendor",m.vendor),N(F.metadata,"sdkVersion",c),N(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(l);for(let m of d.metadata);for(let m of d.counters);for(let m of d.attributes);this.postEvent(o,d,()=>{},a)}},gP=IE.postPerformanceEvent.bind(IE),Vm=new class extends md{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,o,l,d){if(!p.API_URL||!p.SESSION_PATH)return;let m=El(p.API_URL+p.SESSION_PATH);m.params.push(`sku=${o||""}`),m.params.push(`access_token=${d||p.ACCESS_TOKEN||""}`);let y={url:fd(m),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(v,S){return Sc(Io(v,{method:"GET"}),S)}(y,v=>{this.pendingRequest=null,l(v),this.saveEventData(),this.processRequests(d)})}getSessionAPI(a,o,l,d){this.skuToken=o,this.errorCb=d,p.SESSION_PATH&&p.API_URL&&(l||p.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(t1)))}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;let{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||this.getSession(l,this.skuToken,d=>{d?this.errorCb(d):o&&(this.success[o]=!0)},a)}remove(){this.errorCb=null}},n1=Vm.getSessionAPI.bind(Vm),Gm=new Set;var gd={exports:{}},Gp={exports:function(a,o){var l,d,m,y,v,S,T,D;for(d=a.length-(l=3&a.length),m=o,v=3432918353,S=461845907,D=0;D<d;)T=255&a.charCodeAt(D)|(255&a.charCodeAt(++D))<<8|(255&a.charCodeAt(++D))<<16|(255&a.charCodeAt(++D))<<24,++D,m=27492+(65535&(y=5*(65535&(m=(m^=T=(65535&(T=(T=(65535&T)*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*S+(((T>>>16)*S&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(T=0,l){case 3:T^=(255&a.charCodeAt(D+2))<<16;case 2:T^=(255&a.charCodeAt(D+1))<<8;case 1:m^=T=(65535&(T=(T=(65535&(T^=255&a.charCodeAt(D)))*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*S+(((T>>>16)*S&65535)<<16)&4294967295}return m^=a.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}},yP={exports:function(a,o){for(var l,d=a.length,m=o^d,y=0;d>=4;)l=1540483477*(65535&(l=255&a.charCodeAt(y)|(255&a.charCodeAt(++y))<<8|(255&a.charCodeAt(++y))<<16|(255&a.charCodeAt(++y))<<24))+((1540483477*(l>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:m^=(255&a.charCodeAt(y+2))<<16;case 2:m^=(255&a.charCodeAt(y+1))<<8;case 1:m=1540483477*(65535&(m^=255&a.charCodeAt(y)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}},PE=Gp.exports,vP=yP.exports;gd.exports=PE,gd.exports.murmur3=PE,gd.exports.murmur2=vP;var mv=k(gd.exports);class Ec{constructor(o,...l){Io(this,l[0]||{}),this.type=o}}class Hm extends Ec{constructor(o,l={}){super("error",Io({error:o},l))}}function gv(a,o,l){l[a]&&l[a].indexOf(o)!==-1||(l[a]=l[a]||[],l[a].push(o))}function s1(a,o,l){if(l&&l[a]){let d=l[a].indexOf(o);d!==-1&&l[a].splice(d,1)}}class yd{on(o,l){return this._listeners=this._listeners||{},gv(o,l,this._listeners),this}off(o,l){return s1(o,l,this._listeners),s1(o,l,this._oneTimeListeners),this}once(o,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},gv(o,l,this._oneTimeListeners),this):new Promise(d=>this.once(o,d))}fire(o,l){let d=typeof o=="string"?new Ec(o,l):o,m=d.type;if(this.listens(m)){d.target=this;let y=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(let T of y)T.call(this,d);let v=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(let T of v)s1(m,T,this._oneTimeListeners),T.call(this,d);let S=this._eventedParent;S&&(Io(d,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),S.fire(d))}else d instanceof Hm&&console.error(d.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,l){return this._eventedParent=o,this._eventedParentData=l,this}}n.G=void 0;var RE={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function yv(a){return(a=Math.round(a))<0?0:a>255?255:a}function o1(a){return yv(a[a.length-1]==="%"?parseFloat(a)/100*255:parseInt(a))}function vv(a){return(o=a[a.length-1]==="%"?parseFloat(a)/100:parseFloat(a))<0?0:o>1?1:o;var o}function a1(a,o,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?a+(o-a)*l*6:2*l<1?o:3*l<2?a+(o-a)*(2/3-l)*6:a}try{n.G={}.parseCSSColor=function(a){var o,l=a.replace(/ /g,"").toLowerCase();if(l in RE)return RE[l].slice();if(l[0]==="#")return l.length===4?(o=parseInt(l.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:l.length===7&&(o=parseInt(l.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var d=l.indexOf("("),m=l.indexOf(")");if(d!==-1&&m+1===l.length){var y=l.substr(0,d),v=l.substr(d+1,m-(d+1)).split(","),S=1;switch(y){case"rgba":if(v.length!==4)return null;S=vv(v.pop());case"rgb":return v.length!==3?null:[o1(v[0]),o1(v[1]),o1(v[2]),S];case"hsla":if(v.length!==4)return null;S=vv(v.pop());case"hsl":if(v.length!==3)return null;var T=(parseFloat(v[0])%360+360)%360/360,D=vv(v[1]),L=vv(v[2]),F=L<=.5?L*(D+1):L+D-L*D,N=2*L-F;return[yv(255*a1(N,F,T+1/3)),yv(255*a1(N,F,T)),yv(255*a1(N,F,T-1/3)),S];default:return null}}return null}}catch{}class en{constructor(o,l,d,m=1){this.r=o,this.g=l,this.b=d,this.a=m}static parse(o){if(!o)return;if(o instanceof en)return o;if(typeof o!="string")return;let l=n.G(o);return l?new en(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){let[o,l,d,m]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(o)},${Math.round(l)},${Math.round(d)},${m})`}toRenderColor(o){let{r:l,g:d,b:m,a:y}=this;return new _P(o,l,d,m,y)}}class _P{constructor(o,l,d,m,y){if(o){let v=o.image.height,S=v*v;l=y===0?0:l/y*(v-1),d=y===0?0:d/y*(v-1),m=y===0?0:m/y*(v-1);let T=Math.floor(l),D=Math.floor(d),L=Math.floor(m),F=Math.ceil(l),N=Math.ceil(d),H=Math.ceil(m),q=l-T,Q=d-D,K=m-L,ae=o.image.data,_e=4*(T+D*S+L*v),ge=4*(T+D*S+H*v),be=4*(T+N*S+L*v),ze=4*(T+N*S+H*v),ke=4*(F+D*S+L*v),je=4*(F+D*S+H*v),it=4*(F+N*S+L*v),ut=4*(F+N*S+H*v);if(_e<0||ut>=ae.length)throw new Error("out of range");this.r=Gi(Gi(Gi(ae[_e],ae[ge],K),Gi(ae[be],ae[ze],K),Q),Gi(Gi(ae[ke],ae[je],K),Gi(ae[it],ae[ut],K),Q),q)/255*y,this.g=Gi(Gi(Gi(ae[_e+1],ae[ge+1],K),Gi(ae[be+1],ae[ze+1],K),Q),Gi(Gi(ae[ke+1],ae[je+1],K),Gi(ae[it+1],ae[ut+1],K),Q),q)/255*y,this.b=Gi(Gi(Gi(ae[_e+2],ae[ge+2],K),Gi(ae[be+2],ae[ze+2],K),Q),Gi(Gi(ae[ke+2],ae[je+2],K),Gi(ae[it+2],ae[ut+2],K),Q),q)/255*y,this.a=y}else this.r=l,this.g=d,this.b=m,this.a=y}toArray(){let{r:o,g:l,b:d,a:m}=this;return m===0?[0,0,0,0]:[255*o/m,255*l/m,255*d/m,m]}toArray01(){let{r:o,g:l,b:d,a:m}=this;return m===0?[0,0,0,0]:[o/m,l/m,d/m,m]}toArray01Scaled(o){let{r:l,g:d,b:m,a:y}=this;return y===0?[0,0,0]:[l/y*o,d/y*o,m/y*o]}toArray01PremultipliedAlpha(){let{r:o,g:l,b:d,a:m}=this;return[o,l,d,m]}toArray01Linear(){let{r:o,g:l,b:d,a:m}=this;return m===0?[0,0,0,0]:[Math.pow(o/m,2.2),Math.pow(l/m,2.2),Math.pow(d/m,2.2),m]}}function Gi(a,o,l){return a*(1-l)+o*l}function l1(a,o,l){return a.map((d,m)=>Gi(d,o[m],l))}en.black=new en(0,0,0,1),en.white=new en(1,1,1,1),en.transparent=new en(0,0,0,0),en.red=new en(1,0,0,1),en.blue=new en(0,0,1,1);var Wm=Object.freeze({__proto__:null,array:l1,color:function(a,o,l){return new en(Gi(a.r,o.r,l),Gi(a.g,o.g,l),Gi(a.b,o.b,l),Gi(a.a,o.a,l))},number:Gi});function Hp(a,...o){for(let l of o)for(let d in l)a[d]=l[d];return a}class Mc extends Error{constructor(o,l){super(l),this.message=l,this.key=o}}class c1{constructor(o,l=[]){this.parent=o,this.bindings={};for(let[d,m]of l)this.bindings[d]=m}concat(o){return new c1(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}let Qa={kind:"null"},bi={kind:"number"},qr={kind:"string"},on={kind:"boolean"},Ml={kind:"color"},Wp={kind:"object"},Qr={kind:"value"},_v={kind:"collator"},qp={kind:"formatted"},vd={kind:"resolvedImage"};function Lo(a,o){return{kind:"array",itemType:a,N:o}}function Es(a){if(a.kind==="array"){let o=Es(a.itemType);return typeof a.N=="number"?`array<${o}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${o}>`}return a.kind}let u1=[Qa,bi,qr,on,Ml,qp,Wp,Lo(Qr),vd];function qm(a,o){if(o.kind==="error")return null;if(a.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!qm(a.itemType,o.itemType))&&(typeof a.N!="number"||a.N===o.N))return null}else{if(a.kind===o.kind)return null;if(a.kind==="value"){for(let l of u1)if(!qm(l,o))return null}}return`Expected ${Es(a)} but found ${Es(o)} instead.`}function Tl(a,o){return o.some(l=>l.kind===a.kind)}function Ym(a,o){return o.some(l=>l==="null"?a===null:l==="array"?Array.isArray(a):l==="object"?a&&!Array.isArray(a)&&typeof a=="object":l===typeof a)}class xv{constructor(o,l,d){this.sensitivity=o?l?"variant":"case":l?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,l){return this.collator.compare(o,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class bv{constructor(o,l,d,m,y){this.text=o.normalize?o.normalize():o,this.image=l,this.scale=d,this.fontStack=m,this.textColor=y}}class ea{constructor(o){this.sections=o}static fromString(o){return new ea([new bv(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||o.image&&o.image.namePrimary.length!==0)}static factory(o){return o instanceof ea?o:ea.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}serialize(){let o=["format"];for(let l of this.sections){if(l.image){o.push(["image",l.image.namePrimary]);continue}o.push(l.text);let d={};l.fontStack&&(d["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(d["font-scale"]=l.scale),l.textColor&&(d["text-color"]=["rgba"].concat(l.textColor.toRenderColor(null).toArray())),o.push(d)}return o}}class Ka{constructor(o){this.namePrimary=o.namePrimary,o.nameSecondary&&(this.nameSecondary=o.nameSecondary),this.available=o.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(o,l){return o?new Ka({namePrimary:o,nameSecondary:l,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function OE(a,o,l,d){return typeof a=="number"&&a>=0&&a<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof l=="number"&&l>=0&&l<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[a,o,l,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[a,o,l,d]:[a,o,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Yp(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof en||a instanceof xv||a instanceof ea||a instanceof Ka)return!0;if(Array.isArray(a)){for(let o of a)if(!Yp(o))return!1;return!0}if(typeof a=="object"){for(let o in a)if(!Yp(a[o]))return!1;return!0}return!1}function Vs(a){if(a===null)return Qa;if(typeof a=="string")return qr;if(typeof a=="boolean")return on;if(typeof a=="number")return bi;if(a instanceof en)return Ml;if(a instanceof xv)return _v;if(a instanceof ea)return qp;if(a instanceof Ka)return vd;if(Array.isArray(a)){let o=a.length,l;for(let d of a){let m=Vs(d);if(l){if(l===m)continue;l=Qr;break}l=m}return Lo(l||Qr,o)}return Wp}function Yl(a){let o=typeof a;return a===null?"":o==="string"||o==="number"||o==="boolean"?String(a):a instanceof en||a instanceof ea||a instanceof Ka?a.toString():JSON.stringify(a)}class Xl{constructor(o,l){this.type=o,this.value=l}static parse(o,l){if(o.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Yp(o[1]))return l.error("invalid value");let d=o[1],m=Vs(d),y=l.expectedType;return m.kind!=="array"||m.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(m=y),new Xl(m,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof en?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof ea?this.value.serialize():this.value}}class Hs{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}let h1={string:qr,number:bi,boolean:on,object:Wp};class Ja{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let d,m=1,y=o[0];if(y==="array"){let S,T;if(o.length>2){let D=o[1];if(typeof D!="string"||!(D in h1)||D==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);S=h1[D],m++}else S=Qr;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return l.error('The length argument to "array" must be a positive integer literal',2);T=o[2],m++}d=Lo(S,T)}else d=h1[y];let v=[];for(;m<o.length;m++){let S=l.parse(o[m],m,Qr);if(!S)return null;v.push(S)}return new Ja(d,v)}evaluate(o){for(let l=0;l<this.args.length;l++){let d=this.args[l].evaluate(o);if(!qm(this.type,Vs(d)))return d;if(l===this.args.length-1)throw new Hs(`The expression ${JSON.stringify(this.args[l].serialize())} evaluated to ${Es(Vs(d))} but was expected to be of type ${Es(this.type)}.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){let o=this.type,l=[o.kind];if(o.kind==="array"){let d=o.itemType;if(d.kind==="string"||d.kind==="number"||d.kind==="boolean"){l.push(d.kind);let m=o.N;(typeof m=="number"||this.args.length>1)&&l.push(m)}}return l.concat(this.args.map(d=>d.serialize()))}}class _d{constructor(o){this.type=qp,this.sections=o}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let d=o[1];if(!Array.isArray(d)&&typeof d=="object")return l.error("First argument must be an image or text section.");let m=[],y=!1;for(let v=1;v<=o.length-1;++v){let S=o[v];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;let T=null;if(S["font-scale"]&&(T=l.parse(S["font-scale"],1,bi),!T))return null;let D=null;if(S["text-font"]&&(D=l.parse(S["text-font"],1,Lo(qr)),!D))return null;let L=null;if(S["text-color"]&&(L=l.parse(S["text-color"],1,Ml),!L))return null;let F=m[m.length-1];F.scale=T,F.font=D,F.textColor=L}else{let T=l.parse(o[v],1,Qr);if(!T)return null;let D=T.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,m.push({content:T,scale:null,font:null,textColor:null})}}return new _d(m)}evaluate(o){return new ea(this.sections.map(l=>{let d=l.content.evaluate(o);return Vs(d)===vd?new bv("",d,null,null,null):new bv(Yl(d),null,l.scale?l.scale.evaluate(o):null,l.font?l.font.evaluate(o).join(","):null,l.textColor?l.textColor.evaluate(o):null)}))}eachChild(o){for(let l of this.sections)o(l.content),l.scale&&o(l.scale),l.font&&o(l.font),l.textColor&&o(l.textColor)}outputDefined(){return!1}serialize(){let o=["format"];for(let l of this.sections){o.push(l.content.serialize());let d={};l.scale&&(d["font-scale"]=l.scale.serialize()),l.font&&(d["text-font"]=l.font.serialize()),l.textColor&&(d["text-color"]=l.textColor.serialize()),o.push(d)}return o}}class ru{constructor(o,l){this.type=vd,this.inputPrimary=o,this.inputSecondary=l}static parse(o,l){if(o.length<2)return l.error("Expected two or more arguments.");let d=l.parse(o[1],1,qr);if(!d)return l.error("No image name provided.");if(o.length===2)return new ru(d);let m=l.parse(o[2],1,qr);return m?new ru(d,m):l.error("Secondary image variant is not a string.")}evaluate(o){let l=Ka.fromString(this.inputPrimary.evaluate(o),this.inputSecondary?this.inputSecondary.evaluate(o):void 0);return l&&o.availableImages&&(l.available=o.availableImages.indexOf(l.namePrimary)>-1,l.nameSecondary&&l.available&&o.availableImages&&(l.available=o.availableImages.indexOf(l.nameSecondary)>-1)),l}eachChild(o){o(this.inputPrimary),this.inputSecondary&&o(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function ah(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}let xP={"to-boolean":on,"to-color":Ml,"to-number":bi,"to-string":qr};class nu{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let d=o[0],m=[],y=Qa;if(d==="to-array"){if(!Array.isArray(o[1]))return null;let v=o[1].length;if(l.expectedType){if(l.expectedType.kind!=="array")return l.error(`Expected ${l.expectedType.kind} but found array.`);y=Lo(l.expectedType.itemType,v)}else{if(!(v>0&&Yp(o[1][0])))return null;y=Lo(Vs(o[1][0]),v)}for(let S=0;S<v;S++){let T=o[1][S],D;if(ah(T)==="array")D=l.parse(T,void 0,y.itemType);else{let L=ah(T);if(L!==y.itemType.kind)return l.error(`Expected ${y.itemType.kind} but found ${L}.`);D=l.registry.literal.parse(["literal",T===void 0?null:T],l)}if(!D)return null;m.push(D)}}else{if((d==="to-boolean"||d==="to-string")&&o.length!==2)return l.error("Expected one argument.");y=xP[d];for(let v=1;v<o.length;v++){let S=l.parse(o[v],v,Qr);if(!S)return null;m.push(S)}}return new nu(y,m)}evaluate(o){if(this.type.kind==="boolean")return!!this.args[0].evaluate(o);if(this.type.kind==="color"){let l,d;for(let m of this.args){if(l=m.evaluate(o),d=null,l instanceof en)return l;if(typeof l=="string"){let y=o.parseColor(l);if(y)return y}else if(Array.isArray(l)&&(d=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:OE(l[0],l[1],l[2],l[3]),!d))return new en(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Hs(d||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(let d of this.args){if(l=d.evaluate(o),l===null)return 0;let m=Number(l);if(!isNaN(m))return m}throw new Hs(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?ea.fromString(Yl(this.args[0].evaluate(o))):this.type.kind==="resolvedImage"?Ka.fromString(Yl(this.args[0].evaluate(o))):this.type.kind==="array"?this.args.map(l=>l.evaluate(o)):Yl(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if(this.type.kind==="formatted")return new _d([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ru(this.args[0]).serialize();let o=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(l=>{o.push(l.serialize())}),o}}let bP=["Unknown","Point","LineString","Polygon"];class d1{constructor(o,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=o,this.options=l}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?bP[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(o){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let o=this.featureDistanceData.center,l=this.featureDistanceData.scale,{x:d,y:m}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*l-o[0])+this.featureDistanceData.bearing[1]*(m*l-o[1])}return 0}parseColor(o){let l=this._parseColorCache[o];return l||(l=this._parseColorCache[o]=en.parse(o)),l}getConfig(o){return this.options?this.options.get(o):null}}class Fa{constructor(o,l,d,m,y){this.name=o,this.type=l,this._evaluate=d,this.args=m,this._overloadIndex=y}evaluate(o){if(!this._evaluate){let l=Fa.definitions[this.name];this._evaluate=Array.isArray(l)?l[2]:l.overloads[this._overloadIndex][1]}return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,l){let d=o[0],m=Fa.definitions[d];if(!m)return l.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);let y=Array.isArray(m)?m[0]:m.type,v=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,S=[],T=null,D=-1;for(let[L,F]of v){if(Array.isArray(L)&&L.length!==o.length-1)continue;S.push(L),D++,T=new ZE(l.registry,l.path,null,l.scope,void 0,l._scope,l.options);let N=[],H=!1;for(let q=1;q<o.length;q++){let Q=o[q],K=Array.isArray(L)?L[q-1]:L.type,ae=T.parse(Q,1+N.length,K);if(!ae){H=!0;break}N.push(ae)}if(!H)if(Array.isArray(L)&&L.length!==N.length)T.error(`Expected ${L.length} arguments, but found ${N.length} instead.`);else{for(let q=0;q<N.length;q++){let Q=Array.isArray(L)?L[q]:L.type,K=N[q];T.concat(q+1).checkSubtype(Q,K.type)}if(T.errors.length===0)return new Fa(d,y,F,N,D)}}if(S.length===1)l.errors.push(...T.errors);else{let L=(S.length?S:v.map(([N])=>N)).map(wP).join(" | "),F=[];for(let N=1;N<o.length;N++){let H=l.parse(o[N],1+F.length);if(!H)return null;F.push(Es(H.type))}l.error(`Expected arguments of type ${L}, but found (${F.join(", ")}) instead.`)}return null}static register(o,l){Fa.definitions=l;for(let d in l)o[d]=Fa}}function wP(a){return Array.isArray(a)?`(${a.map(Es).join(", ")})`:`(${Es(a.type)}...)`}class Xm{constructor(o,l,d){this.type=_v,this.locale=d,this.caseSensitive=o,this.diacriticSensitive=l}static parse(o,l){if(o.length!==2)return l.error("Expected one argument.");let d=o[1];if(typeof d!="object"||Array.isArray(d))return l.error("Collator options argument must be an object.");let m=l.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,on);if(!m)return null;let y=l.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,on);if(!y)return null;let v=null;return d.locale&&(v=l.parse(d.locale,1,qr),!v)?null:new Xm(m,y,v)}evaluate(o){return new xv(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){let o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}function tn(a,o,l=0,d=a.length-1,m=LE){for(;d>l;){if(d-l>600){let T=d-l+1,D=o-l+1,L=Math.log(T),F=.5*Math.exp(2*L/3),N=.5*Math.sqrt(L*F*(T-F)/T)*(D-T/2<0?-1:1);tn(a,o,Math.max(l,Math.floor(o-D*F/T+N)),Math.min(d,Math.floor(o+(T-D)*F/T+N)),m)}let y=a[o],v=l,S=d;for(Xp(a,l,o),m(a[d],y)>0&&Xp(a,l,d);v<S;){for(Xp(a,v,S),v++,S--;m(a[v],y)<0;)v++;for(;m(a[S],y)>0;)S--}m(a[l],y)===0?Xp(a,l,S):(S++,Xp(a,S,d)),S<=o&&(l=S+1),o<=S&&(d=S-1)}}function Xp(a,o,l){let d=a[o];a[o]=a[l],a[l]=d}function LE(a,o){return a<o?-1:a>o?1:0}function SP(a){let o=0;for(let l,d,m=0,y=a.length,v=y-1;m<y;v=m++)l=a[m],d=a[v],o+=(d.x-l.x)*(l.y+d.y);return o}function $m(a,o){a[0]=Math.min(a[0],o[0]),a[1]=Math.min(a[1],o[1]),a[2]=Math.max(a[2],o[0]),a[3]=Math.max(a[3],o[1])}function lh(a,o){return!(a[0]<=o[0]||a[2]>=o[2]||a[1]<=o[1]||a[3]>=o[3])}function wv(a,o,l){let d=a[0]-o[0],m=a[1]-o[1],y=a[0]-l[0],v=a[1]-l[1];return d*v-y*m==0&&d*y<=0&&m*v<=0}function su(a,o,l=!1){let d=!1;for(let S=0,T=o.length;S<T;S++){let D=o[S];for(let L=0,F=D.length,N=F-1;L<F;N=L++){let H=D[N],q=D[L];if(wv(a,H,q))return l;(y=H)[1]>(m=a)[1]!=(v=q)[1]>m[1]&&m[0]<(v[0]-y[0])*(m[1]-y[1])/(v[1]-y[1])+y[0]&&(d=!d)}}var m,y,v;return d}function zE(a,o,l,d){let m=d[0]-l[0],y=d[1]-l[1],v=(a[0]-l[0])*y-m*(a[1]-l[1]),S=(o[0]-l[0])*y-m*(o[1]-l[1]);return v>0&&S<0||v<0&&S>0}function Zm(a,o,l,d){return(m=[d[0]-l[0],d[1]-l[1]])[0]*(y=[o[0]-a[0],o[1]-a[1]])[1]-m[1]*y[0]!=0&&!(!zE(a,o,l,d)||!zE(l,d,a,o));var m,y}let zo=8192;function EP(a,o){let l=(180+a[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,m=Math.pow(2,o.z);return[Math.round(l*m*zo),Math.round(d*m*zo)]}function FE(a,o){for(let l=0;l<o.length;l++)if(su(a,o[l]))return!0;return!1}function Qm(a,o,l){for(let d of l)for(let m=0,y=d.length,v=y-1;m<y;v=m++)if(Zm(a,o,d[v],d[m]))return!0;return!1}function Sv(a,o){for(let l=0;l<a.length;++l)if(!su(a[l],o))return!1;for(let l=0;l<a.length-1;++l)if(Qm(a[l],a[l+1],o))return!1;return!0}function MP(a,o){for(let l=0;l<o.length;l++)if(Sv(a,o[l]))return!0;return!1}function p1(a,o,l){let d=[];for(let m=0;m<a.length;m++){let y=[];for(let v=0;v<a[m].length;v++){let S=EP(a[m][v],l);$m(o,S),y.push(S)}d.push(y)}return d}function kE(a,o,l){let d=[];for(let m=0;m<a.length;m++){let y=p1(a[m],o,l);d.push(y)}return d}function f1(a,o,l,d){if(a[0]<l[0]||a[0]>l[2]){let m=.5*d,y=a[0]-l[0]>m?-d:l[0]-a[0]>m?d:0;y===0&&(y=a[0]-l[2]>m?-d:l[2]-a[0]>m?d:0),a[0]+=y}$m(o,a)}function Ev(a,o,l,d){let m=Math.pow(2,d.z)*zo,y=[d.x*zo,d.y*zo],v=[];if(!a)return v;for(let S of a)for(let T of S){let D=[T.x+y[0],T.y+y[1]];f1(D,o,l,m),v.push(D)}return v}function NE(a,o,l,d){let m=Math.pow(2,d.z)*zo,y=[d.x*zo,d.y*zo],v=[];if(!a)return v;for(let T of a){let D=[];for(let L of T){let F=[L.x+y[0],L.y+y[1]];$m(o,F),D.push(F)}v.push(D)}if(o[2]-o[0]<=m/2){(S=o)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(let T of v)for(let D of T)f1(D,o,l,m)}var S;return v}class Tc{constructor(o,l){this.type=on,this.geojson=o,this.geometries=l}static parse(o,l){if(o.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Yp(o[1])){let d=o[1];if(d.type==="FeatureCollection")for(let m=0;m<d.features.length;++m){let y=d.features[m].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Tc(d,d.features[m].geometry)}else if(d.type==="Feature"){let m=d.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Tc(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new Tc(d,d)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(l,d){let m=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(!v)return!1;if(d.type==="Polygon"){let S=p1(d.coordinates,y,v),T=Ev(l.geometry(),m,y,v);if(!lh(m,y))return!1;for(let D of T)if(!su(D,S))return!1}if(d.type==="MultiPolygon"){let S=kE(d.coordinates,y,v),T=Ev(l.geometry(),m,y,v);if(!lh(m,y))return!1;for(let D of T)if(!FE(D,S))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(l,d){let m=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(!v)return!1;if(d.type==="Polygon"){let S=p1(d.coordinates,y,v),T=NE(l.geometry(),m,y,v);if(!lh(m,y))return!1;for(let D of T)if(!Sv(D,S))return!1}if(d.type==="MultiPolygon"){let S=kE(d.coordinates,y,v),T=NE(l.geometry(),m,y,v);if(!lh(m,y))return!1;for(let D of T)if(!MP(D,S))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let Mv={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},BE=1/298.257223563,UE=BE*(2-BE),Km=Math.PI/180;class Jm{static fromTile(o,l,d){let m=Math.PI*(1-2*(o+.5)/Math.pow(2,l)),y=Math.atan(.5*(Math.exp(m)-Math.exp(-m)))/Km;return new Jm(y,d)}static get units(){return Mv}constructor(o,l){if(o===void 0)throw new Error("No latitude given.");if(l&&!Mv[l])throw new Error(`Unknown unit ${l}. Use one of: ${Object.keys(Mv).join(", ")}`);let d=6378.137*Km*(l?Mv[l]:1),m=Math.cos(o*Km),y=1/(1-UE*(1-m*m)),v=Math.sqrt(y);this.kx=d*v*m,this.ky=d*v*y*(1-UE)}distance(o,l){let d=el(o[0]-l[0])*this.kx,m=(o[1]-l[1])*this.ky;return Math.sqrt(d*d+m*m)}bearing(o,l){let d=el(l[0]-o[0])*this.kx;return Math.atan2(d,(l[1]-o[1])*this.ky)/Km}destination(o,l,d){let m=d*Km;return this.offset(o,Math.sin(m)*l,Math.cos(m)*l)}offset(o,l,d){return[o[0]+l/this.kx,o[1]+d/this.ky]}lineDistance(o){let l=0;for(let d=0;d<o.length-1;d++)l+=this.distance(o[d],o[d+1]);return l}area(o){let l=0;for(let d=0;d<o.length;d++){let m=o[d];for(let y=0,v=m.length,S=v-1;y<v;S=y++)l+=el(m[y][0]-m[S][0])*(m[y][1]+m[S][1])*(d?-1:1)}return Math.abs(l)/2*this.kx*this.ky}along(o,l){let d=0;if(l<=0)return o[0];for(let m=0;m<o.length-1;m++){let y=o[m],v=o[m+1],S=this.distance(y,v);if(d+=S,d>l)return m1(y,v,(l-(d-S))/S)}return o[o.length-1]}pointToSegmentDistance(o,l,d){let[m,y]=l,v=el(d[0]-m)*this.kx,S=(d[1]-y)*this.ky;if(v!==0||S!==0){let T=(el(o[0]-m)*this.kx*v+(o[1]-y)*this.ky*S)/(v*v+S*S);T>1?(m=d[0],y=d[1]):T>0&&(m+=v/this.kx*T,y+=S/this.ky*T)}return v=el(o[0]-m)*this.kx,S=(o[1]-y)*this.ky,Math.sqrt(v*v+S*S)}pointOnLine(o,l){let d=1/0,m=o[0][0],y=o[0][1],v=0,S=0;for(let T=0;T<o.length-1;T++){let D=o[T][0],L=o[T][1],F=el(o[T+1][0]-D)*this.kx,N=(o[T+1][1]-L)*this.ky,H=0;F===0&&N===0||(H=(el(l[0]-D)*this.kx*F+(l[1]-L)*this.ky*N)/(F*F+N*N),H>1?(D=o[T+1][0],L=o[T+1][1]):H>0&&(D+=F/this.kx*H,L+=N/this.ky*H)),F=el(l[0]-D)*this.kx,N=(l[1]-L)*this.ky;let q=F*F+N*N;q<d&&(d=q,m=D,y=L,v=T,S=H)}return{point:[m,y],index:v,t:Math.max(0,Math.min(1,S))}}lineSlice(o,l,d){let m=this.pointOnLine(d,o),y=this.pointOnLine(d,l);if(m.index>y.index||m.index===y.index&&m.t>y.t){let D=m;m=y,y=D}let v=[m.point],S=m.index+1,T=y.index;!jE(d[S],v[0])&&S<=T&&v.push(d[S]);for(let D=S+1;D<=T;D++)v.push(d[D]);return jE(d[T],y.point)||v.push(y.point),v}lineSliceAlong(o,l,d){let m=0,y=[];for(let v=0;v<d.length-1;v++){let S=d[v],T=d[v+1],D=this.distance(S,T);if(m+=D,m>o&&y.length===0&&y.push(m1(S,T,(o-(m-D))/D)),m>=l)return y.push(m1(S,T,(l-(m-D))/D)),y;m>o&&y.push(T)}return y}bufferPoint(o,l){let d=l/this.ky,m=l/this.kx;return[o[0]-m,o[1]-d,o[0]+m,o[1]+d]}bufferBBox(o,l){let d=l/this.ky,m=l/this.kx;return[o[0]-m,o[1]-d,o[2]+m,o[3]+d]}insideBBox(o,l){return el(o[0]-l[0])>=0&&el(o[0]-l[2])<=0&&o[1]>=l[1]&&o[1]<=l[3]}}function jE(a,o){return a[0]===o[0]&&a[1]===o[1]}function m1(a,o,l){let d=el(o[0]-a[0]);return[a[0]+d*l,a[1]+(o[1]-a[1])*l]}function el(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class ch{constructor(o=[],l=(d,m)=>d<m?-1:d>m?1:0){if(this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;let o=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),o}peek(){return this.data[0]}_up(o){let{data:l,compare:d}=this,m=l[o];for(;o>0;){let y=o-1>>1,v=l[y];if(d(m,v)>=0)break;l[o]=v,o=y}l[o]=m}_down(o){let{data:l,compare:d}=this,m=this.length>>1,y=l[o];for(;o<m;){let v=1+(o<<1),S=v+1;if(S<this.length&&d(l[S],l[v])<0&&(v=S),d(l[v],y)>=0)break;l[o]=l[v],o=v}l[o]=y}}var ti=8192;function VE(a,o){return o.dist-a.dist}let eg=100,g1=50;function GE(a){let o=[1/0,1/0,-1/0,-1/0];if(o.length!==a.length)return!1;for(let l=0;l<o.length;l++)if(o[l]!==a[l])return!1;return!0}function Tv(a){return a[1]-a[0]+1}function ou(a,o){let l=a[1]>=a[0]&&a[1]<o;return l||console.warn("Distance Expression: Index is out of range"),l}function y1(a,o){if(a[0]>a[1])return[null,null];let l=Tv(a);if(o){if(l===2)return[a,null];let d=Math.floor(l/2);return[[a[0],a[0]+d],[a[0]+d,a[1]]]}{if(l===1)return[a,null];let d=Math.floor(l/2)-1;return[[a[0],a[0]+d],[a[0]+d+1,a[1]]]}}function tl(a,o){let l=[1/0,1/0,-1/0,-1/0];if(!ou(o,a.length))return l;for(let d=o[0];d<=o[1];++d)$m(l,a[d]);return l}function Av(a){let o=[1/0,1/0,-1/0,-1/0];for(let l=0;l<a.length;++l)for(let d=0;d<a[l].length;++d)$m(o,a[l][d]);return o}function $p(a,o,l){if(GE(a)||GE(o))return NaN;let d=0,m=0;return a[2]<o[0]&&(d=o[0]-a[2]),a[0]>o[2]&&(d=a[0]-o[2]),a[1]>o[3]&&(m=a[1]-o[3]),a[3]<o[1]&&(m=o[1]-a[3]),l.distance([0,0],[d,m])}function HE(a){return 360*a-180}function WE(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function il(a,o){let l=Math.pow(2,o.z),d=(a.y/ti+o.y)/l;return[HE((a.x/ti+o.x)/l),WE(d)]}function qE(a,o){let l=[];for(let d=0;d<a.length;++d)l.push(il(a[d],o));return l}function YE(a,o,l){let d=l.pointOnLine(o,a).point;return l.distance(a,d)}function v1(a,o,l,d,m){let y=l.slice(d[0],d[1]+1),v=1/0;for(let S=o[0];S<=o[1];++S)if((v=Math.min(v,YE(a[S],y,m)))===0)return 0;return v}function Zp(a,o,l,d,m){let y=Math.min(m.pointToSegmentDistance(a,l,d),m.pointToSegmentDistance(o,l,d)),v=Math.min(m.pointToSegmentDistance(l,a,o),m.pointToSegmentDistance(d,a,o));return Math.min(y,v)}function TP(a,o,l,d,m){if(!ou(o,a.length)||!ou(d,l.length))return NaN;let y=1/0;for(let v=o[0];v<o[1];++v)for(let S=d[0];S<d[1];++S){if(Zm(a[v],a[v+1],l[S],l[S+1]))return 0;y=Math.min(y,Zp(a[v],a[v+1],l[S],l[S+1],m))}return y}function AP(a,o,l,d,m){if(!ou(o,a.length)||!ou(d,l.length))return NaN;let y=1/0;for(let v=o[0];v<=o[1];++v)for(let S=d[0];S<=d[1];++S)if((y=Math.min(y,m.distance(a[v],l[S])))===0)return y;return y}function CP(a,o,l){if(su(a,o,!0))return 0;let d=1/0;for(let m of o){let y=m.length;if(y<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(m[0]!==m[y-1]&&(d=Math.min(d,l.pointToSegmentDistance(a,m[y-1],m[0])))===0||(d=Math.min(d,YE(a,m,l)))===0)return d}return d}function DP(a,o,l,d){if(!ou(o,a.length))return NaN;for(let y=o[0];y<=o[1];++y)if(su(a[y],l,!0))return 0;let m=1/0;for(let y=o[0];y<o[1];++y)for(let v of l)for(let S=0,T=v.length,D=T-1;S<T;D=S++){if(Zm(a[y],a[y+1],v[D],v[S]))return 0;m=Math.min(m,Zp(a[y],a[y+1],v[D],v[S],d))}return m}function XE(a,o){for(let l of a)for(let d=0;d<=l.length-1;++d)if(su(l[d],o,!0))return!0;return!1}function Cv(a,o,l,d=1/0){let m=Av(a),y=Av(o);if(d!==1/0&&$p(m,y,l)>=d)return d;if(lh(m,y)){if(XE(a,o))return 0}else if(XE(o,a))return 0;let v=d;for(let S of a)for(let T=0,D=S.length,L=D-1;T<D;L=T++)for(let F of o)for(let N=0,H=F.length,q=H-1;N<H;q=N++){if(Zm(S[L],S[T],F[q],F[N]))return 0;v=Math.min(v,Zp(S[L],S[T],F[q],F[N],l))}return v}function xd(a,o,l,d,m,y,v){if(y===null||v===null)return;let S=$p(tl(d,y),tl(m,v),l);S<o&&a.push({dist:S,range1:y,range2:v})}function rl(a,o,l,d,m=1/0){let y=Math.min(d.distance(a[0],l[0][0]),m);if(y===0)return y;let v=new ch([{dist:0,range1:[0,a.length-1],range2:[0,0]}],VE),S=o?g1:eg,T=Av(l);for(;v.length;){let D=v.pop();if(D.dist>=y)continue;let L=D.range1;if(Tv(L)<=S){if(!ou(L,a.length))return NaN;if(o){let F=DP(a,L,l,d);if((y=Math.min(y,F))===0)return y}else for(let F=L[0];F<=L[1];++F){let N=CP(a[F],l,d);if((y=Math.min(y,N))===0)return y}}else{let F=y1(L,o);if(F[0]!==null){let N=$p(tl(a,F[0]),T,d);N<y&&v.push({dist:N,range1:F[0],range2:[0,0]})}if(F[1]!==null){let N=$p(tl(a,F[1]),T,d);N<y&&v.push({dist:N,range1:F[1],range2:[0,0]})}}}return y}function tg(a,o,l,d,m,y=1/0){let v=Math.min(y,m.distance(a[0],l[0]));if(v===0)return v;let S=new ch([{dist:0,range1:[0,a.length-1],range2:[0,l.length-1]}],VE),T=o?g1:eg,D=d?g1:eg;for(;S.length;){let L=S.pop();if(L.dist>=v)continue;let F=L.range1,N=L.range2;if(Tv(F)<=T&&Tv(N)<=D){if(!ou(F,a.length)||!ou(N,l.length))return NaN;if(o&&d?v=Math.min(v,TP(a,F,l,N,m)):o||d?o&&!d?v=Math.min(v,v1(l,N,a,F,m)):!o&&d&&(v=Math.min(v,v1(a,F,l,N,m))):v=Math.min(v,AP(a,F,l,N,m)),v===0)return v}else{let H=y1(F,o),q=y1(N,d);xd(S,v,m,a,l,H[0],q[0]),xd(S,v,m,a,l,H[0],q[1]),xd(S,v,m,a,l,H[1],q[0]),xd(S,v,m,a,l,H[1],q[1])}}return v}function _1(a,o,l,d,m=1/0){let y=m,v=tl(a,[0,a.length-1]);for(let S of l)if(!(y!==1/0&&$p(v,tl(S,[0,S.length-1]),d)>=y)&&(y=Math.min(y,tg(a,o,S,!0,d,y)),y===0))return y;return y}function Dv(a,o,l,d,m=1/0){let y=m,v=tl(a,[0,a.length-1]);for(let S of l){if(y!==1/0&&$p(v,Av(S),d)>=y)continue;let T=rl(a,o,S,d,y);if(isNaN(T))return T;if((y=Math.min(y,T))===0)return y}return y}function x1(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class bd{constructor(o,l){this.type=bi,this.geojson=o,this.geometries=l}static parse(o,l){if(o.length!==2)return l.error(`'distance' expression requires either one argument, but found ' ${o.length-1} instead.`);if(Yp(o[1])){let d=o[1];if(d.type==="FeatureCollection"){for(let m=0;m<d.features.length;++m)if(x1(d.features[m].geometry.type))return new bd(d,d.features[m].geometry)}else if(d.type==="Feature"){if(x1(d.geometry.type))return new bd(d,d.geometry)}else if(x1(d.type))return new bd(d,d)}return l.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(o){let l=o.geometry(),d=o.canonicalID();if(l!=null&&d!=null){if(o.geometryType()==="Point")return function(m,y,v){let S=[];for(let D of m)for(let L of D)S.push(il(L,y));let T=new Jm(S[0][1],"meters");return v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString"?tg(S,!1,v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",T):v.type==="MultiLineString"?_1(S,!1,v.coordinates,T):v.type==="Polygon"||v.type==="MultiPolygon"?Dv(S,!1,v.type==="Polygon"?[v.coordinates]:v.coordinates,T):null}(l,d,this.geometries);if(o.geometryType()==="LineString")return function(m,y,v){let S=[];for(let D of m){let L=[];for(let F of D)L.push(il(F,y));S.push(L)}let T=new Jm(S[0][0][1],"meters");if(v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString")return _1(v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",S,T);if(v.type==="MultiLineString"){let D=1/0;for(let L=0;L<v.coordinates.length;L++){let F=_1(v.coordinates[L],!0,S,T,D);if(isNaN(F))return F;if((D=Math.min(D,F))===0)return D}return D}if(v.type==="Polygon"||v.type==="MultiPolygon"){let D=1/0;for(let L=0;L<S.length;L++){let F=Dv(S[L],!0,v.type==="Polygon"?[v.coordinates]:v.coordinates,T,D);if(isNaN(F))return F;if((D=Math.min(D,F))===0)return D}return D}return null}(l,d,this.geometries);if(o.geometryType()==="Polygon")return function(m,y,v){let S=[];for(let D of function(L,F){let N=L.length;if(N<=1)return[L];let H=[],q,Q;for(let K=0;K<N;K++){let ae=SP(L[K]);ae!==0&&(L[K].area=Math.abs(ae),Q===void 0&&(Q=ae<0),Q===ae<0?(q&&H.push(q),q=[L[K]]):q.push(L[K]))}return q&&H.push(q),H}(m)){let L=[];for(let F=0;F<D.length;++F)L.push(qE(D[F],y));S.push(L)}let T=new Jm(S[0][0][0][1],"meters");if(v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString")return Dv(v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",S,T);if(v.type==="MultiLineString"){let D=1/0;for(let L=0;L<v.coordinates.length;L++){let F=Dv(v.coordinates[L],!0,S,T,D);if(isNaN(F))return F;if((D=Math.min(D,F))===0)return D}return D}return v.type==="Polygon"||v.type==="MultiPolygon"?function(D,L,F){let N=1/0;for(let H of D)for(let q of L){let Q=Cv(H,q,F,N);if(isNaN(Q))return Q;if((N=Math.min(N,Q))===0)return N}return N}(v.type==="Polygon"?[v.coordinates]:v.coordinates,S,T):null}(l,d,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ig(a,o){switch(a){case"string":return Yl(o);case"number":return+o;case"boolean":return!!o;case"color":return en.parse(o);case"formatted":return ea.fromString(Yl(o));case"resolvedImage":return Ka.fromString(Yl(o))}return o}function $E(a,o,l,d){return d!==void 0&&(a=d*Math.round(a/d)),o!==void 0&&a<o&&(a=o),l!==void 0&&a>l&&(a=l),a}class uh{constructor(o,l,d){this.type=o,this.key=l,this.scope=d}static parse(o,l){let d=l.expectedType;if(d==null&&(d=Qr),o.length<2||o.length>3)return l.error("Invalid number of arguments for 'config' expression.");let m=l.parse(o[1],1);if(!(m instanceof Xl))return l.error("Key name of 'config' expression must be a string literal.");if(o.length>=3){let y=l.parse(o[2],2);return y instanceof Xl?new uh(d,Yl(m.value),Yl(y.value)):l.error("Scope of 'config' expression must be a string literal.")}return new uh(d,Yl(m.value))}evaluate(o){let l=[this.key,this.scope,o.scope].filter(Boolean).join(""),d=o.getConfig(l);if(!d)return null;let{type:m,value:y,values:v,minValue:S,maxValue:T,stepValue:D}=d,L=d.default.evaluate(o),F=L;if(y){let N=o.scope;o.scope=(N||"").split("").slice(1).join(""),F=y.evaluate(o),o.scope=N}return m&&(F=ig(m,F)),F===void 0||S===void 0&&T===void 0&&D===void 0||(typeof F=="number"?F=$E(F,S,T,D):Array.isArray(F)&&(F=F.map(N=>typeof N=="number"?$E(N,S,T,D):N))),y!==void 0&&F!==void 0&&v&&!v.includes(F)&&(F=L,m&&(F=ig(m,F))),(m&&m!==this.type||F!==void 0&&Vs(F)!==this.type)&&(F=ig(this.type.kind,F)),F}eachChild(){}outputDefined(){return!1}serialize(){let o=["config",this.key];return this.scope&&o.concat(this.key),o}}function rg(a){if(a instanceof Fa&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Tc||a instanceof bd)return!1;let o=!0;return a.eachChild(l=>{o&&!rg(l)&&(o=!1)}),o}function Iv(a){if(a instanceof Fa&&a.name==="feature-state")return!1;let o=!0;return a.eachChild(l=>{o&&!Iv(l)&&(o=!1)}),o}function ng(a){if(a instanceof uh)return new Set([a.key]);let o=new Set;return a.eachChild(l=>{o=new Set([...o,...ng(l)])}),o}function sg(a,o){if(a instanceof Fa&&o.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(d=>{l&&!sg(d,o)&&(l=!1)}),l}class og{constructor(o,l){this.type=l.type,this.name=o,this.boundExpression=l}static parse(o,l){if(o.length!==2||typeof o[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");let d=o[1];return l.scope.has(d)?new og(d,l.scope.get(d)):l.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Pv{constructor(o,l=[],d,m=new c1,y=[],v,S){this.registry=o,this.path=l,this.key=l.map(T=>`[${T}]`).join(""),this.scope=m,this.errors=y,this.expectedType=d,this._scope=v,this.options=S}parse(o,l,d,m,y={}){return l||d?this.concat(l,d,m)._parse(o,y):this._parse(o,y)}_parse(o,l){function d(m,y,v){return v==="assert"?new Ja(y,[m]):v==="coerce"?new nu(y,[m]):m}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let m=typeof o[0]=="string"?this.registry[o[0]]:void 0;if(m){let y=m.parse(o,this);if(!y)return null;if(this.expectedType){let v=this.expectedType,S=y.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||S.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string"){if(this.checkSubtype(v,S))return null}else y=d(y,v,l.typeAnnotation||"coerce");else y=d(y,v,l.typeAnnotation||"assert")}if(!(y instanceof Xl)&&y.type.kind!=="resolvedImage"&&ag(y)){let v=new d1(this._scope,this.options);try{y=new Xl(y.type,y.evaluate(v))}catch(S){return this.error(S.message),null}}return y}return nu.parse(["to-array",o],this)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,l,d){let m=typeof o=="number"?this.path.concat(o):this.path,y=d?this.scope.concat(d):this.scope;return new Pv(this.registry,m,l||null,y,this.errors,this._scope,this.options)}error(o,...l){let d=`${this.key}${l.map(m=>`[${m}]`).join("")}`;this.errors.push(new Mc(d,o))}checkSubtype(o,l){let d=qm(o,l);return d&&this.error(d),d}}var ZE=Pv;function ag(a){if(a instanceof og)return ag(a.boundExpression);if(a instanceof Fa&&a.name==="error"||a instanceof Xm||a instanceof Tc||a instanceof bd||a instanceof uh)return!1;let o=a instanceof nu||a instanceof Ja,l=!0;return a.eachChild(d=>{l=o?l&&ag(d):l&&d instanceof Xl}),!!l&&rg(a)&&sg(a,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function wd(a,o){let l=a.length-1,d,m,y=0,v=l,S=0;for(;y<=v;)if(S=Math.floor((y+v)/2),d=a[S],m=a[S+1],d<=o){if(S===l||o<m)return S;y=S+1}else{if(!(d>o))throw new Hs("Input is not a number.");v=S-1}return 0}class Qp{constructor(o,l,d){this.type=o,this.input=l,this.labels=[],this.outputs=[];for(let[m,y]of d)this.labels.push(m),this.outputs.push(y)}static parse(o,l){if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");let d=l.parse(o[1],1,bi);if(!d)return null;let m=[],y=null;l.expectedType&&l.expectedType.kind!=="value"&&(y=l.expectedType);for(let v=1;v<o.length;v+=2){let S=v===1?-1/0:o[v],T=o[v+1],D=v,L=v+1;if(typeof S!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(m.length&&m[m.length-1][0]>=S)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);let F=l.parse(T,L,y);if(!F)return null;y=y||F.type,m.push([S,F])}return new Qp(y,d,m)}evaluate(o){let l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(o);let m=this.input.evaluate(o);if(m<=l[0])return d[0].evaluate(o);let y=l.length;return m>=l[y-1]?d[y-1].evaluate(o):d[wd(l,m)].evaluate(o)}eachChild(o){o(this.input);for(let l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&o.push(this.labels[l]),o.push(this.outputs[l].serialize());return o}}let QE=.95047,b1=1.08883,KE=4/29,hh=6/29,JE=3*hh*hh,IP=hh*hh*hh,PP=Math.PI/180,RP=180/Math.PI;function Rv(a){return a>IP?Math.pow(a,1/3):a/JE+KE}function w1(a){return a>hh?a*a*a:JE*(a-KE)}function S1(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function E1(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function eM(a){let o=E1(a.r),l=E1(a.g),d=E1(a.b),m=Rv((.4124564*o+.3575761*l+.1804375*d)/QE),y=Rv((.2126729*o+.7151522*l+.072175*d)/1);return{l:116*y-16,a:500*(m-y),b:200*(y-Rv((.0193339*o+.119192*l+.9503041*d)/b1)),alpha:a.a}}function tM(a){let o=(a.l+16)/116,l=isNaN(a.a)?o:o+a.a/500,d=isNaN(a.b)?o:o-a.b/200;return o=1*w1(o),l=QE*w1(l),d=b1*w1(d),new en(S1(3.2404542*l-1.5371385*o-.4985314*d),S1(-.969266*l+1.8760108*o+.041556*d),S1(.0556434*l-.2040259*o+1.0572252*d),a.alpha)}function OP(a,o,l){let d=o-a;return a+l*(d>180||d<-180?d-360*Math.round(d/360):d)}let lg={forward:eM,reverse:tM,interpolate:function(a,o,l){return{l:Gi(a.l,o.l,l),a:Gi(a.a,o.a,l),b:Gi(a.b,o.b,l),alpha:Gi(a.alpha,o.alpha,l)}}},cg={forward:function(a){let{l:o,a:l,b:d}=eM(a),m=Math.atan2(d,l)*RP;return{h:m<0?m+360:m,c:Math.sqrt(l*l+d*d),l:o,alpha:a.a}},reverse:function(a){let o=a.h*PP,l=a.c;return tM({l:a.l,a:Math.cos(o)*l,b:Math.sin(o)*l,alpha:a.alpha})},interpolate:function(a,o,l){return{h:OP(a.h,o.h,l),c:Gi(a.c,o.c,l),l:Gi(a.l,o.l,l),alpha:Gi(a.alpha,o.alpha,l)}}};var ug=Object.freeze({__proto__:null,hcl:cg,lab:lg});class nl{constructor(o,l,d,m,y){this.type=o,this.operator=l,this.interpolation=d,this.input=m,this.labels=[],this.outputs=[];for(let[v,S]of y)this.labels.push(v),this.outputs.push(S)}static interpolationFactor(o,l,d,m){let y=0;if(o.name==="exponential")y=M1(l,o.base,d,m);else if(o.name==="linear")y=M1(l,1,d,m);else if(o.name==="cubic-bezier"){let v=o.controlPoints;y=new Gx(v[0],v[1],v[2],v[3]).solve(M1(l,1,d,m))}return y}static parse(o,l){let[d,m,y,...v]=o;if(!Array.isArray(m)||m.length===0)return l.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){let D=m[1];if(typeof D!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:D}}else{if(m[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(m[0])}`,1,0);{let D=m.slice(1);if(D.length!==4||D.some(L=>typeof L!="number"||L<0||L>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:D}}}if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(y=l.parse(y,2,bi),!y)return null;let S=[],T=null;d==="interpolate-hcl"||d==="interpolate-lab"?T=Ml:l.expectedType&&l.expectedType.kind!=="value"&&(T=l.expectedType);for(let D=0;D<v.length;D+=2){let L=v[D],F=v[D+1],N=D+3,H=D+4;if(typeof L!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(S.length&&S[S.length-1][0]>=L)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);let q=l.parse(F,H,T);if(!q)return null;T=T||q.type,S.push([L,q])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new nl(T,d,m,y,S):l.error(`Type ${Es(T)} is not interpolatable.`)}evaluate(o){let l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(o);let m=this.input.evaluate(o);if(m<=l[0])return d[0].evaluate(o);let y=l.length;if(m>=l[y-1])return d[y-1].evaluate(o);let v=wd(l,m),S=nl.interpolationFactor(this.interpolation,m,l[v],l[v+1]),T=d[v].evaluate(o),D=d[v+1].evaluate(o);return this.operator==="interpolate"?Wm[this.type.kind.toLowerCase()](T,D,S):this.operator==="interpolate-hcl"?cg.reverse(cg.interpolate(cg.forward(T),cg.forward(D),S)):lg.reverse(lg.interpolate(lg.forward(T),lg.forward(D),S))}eachChild(o){o(this.input);for(let l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let l=[this.operator,o,this.input.serialize()];for(let d=0;d<this.labels.length;d++)l.push(this.labels[d],this.outputs[d].serialize());return l}}function M1(a,o,l,d){let m=d-l,y=a-l;return m===0?0:o===1?y/m:(Math.pow(o,y)-1)/(Math.pow(o,m)-1)}class Sd{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expectected at least one argument.");let d=null,m=l.expectedType;m&&m.kind!=="value"&&(d=m);let y=[];for(let S of o.slice(1)){let T=l.parse(S,1+y.length,d,void 0,{typeAnnotation:"omit"});if(!T)return null;d=d||T.type,y.push(T)}let v=m&&y.some(S=>qm(m,S.type));return new Sd(v?Qr:d,y)}evaluate(o){let l,d=null,m=0;for(let y of this.args){if(m++,d=y.evaluate(o),d&&d instanceof Ka&&!d.available&&(l||(l=d),d=null,m===this.args.length))return l;if(d!==null)break}return d}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){let o=["coalesce"];return this.eachChild(l=>{o.push(l.serialize())}),o}}class Ov{constructor(o,l){this.type=l.type,this.bindings=[].concat(o),this.result=l}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(let l of this.bindings)o(l[1]);o(this.result)}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);let d=[];for(let y=1;y<o.length-1;y+=2){let v=o[y];if(typeof v!="string")return l.error(`Expected string, but found ${typeof v} instead.`,y);if(/[^a-zA-Z0-9_]/.test(v))return l.error("Variable names must contain only alphanumeric characters or '_'.",y);let S=l.parse(o[y+1],y+1);if(!S)return null;d.push([v,S])}let m=l.parse(o[o.length-1],o.length-1,l.expectedType,d);return m?new Ov(d,m):null}outputDefined(){return this.result.outputDefined()}serialize(){let o=["let"];for(let[l,d]of this.bindings)o.push(l,d.serialize());return o.push(this.result.serialize()),o}}class Lv{constructor(o,l,d){this.type=o,this.index=l,this.input=d}static parse(o,l){if(o.length!==3)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);let d=l.parse(o[1],1,bi),m=l.parse(o[2],2,Lo(l.expectedType||Qr));return d&&m?new Lv(m.type.itemType,d,m):null}evaluate(o){let l=this.index.evaluate(o),d=this.input.evaluate(o);if(l<0)throw new Hs(`Array index out of bounds: ${l} < 0.`);if(l>=d.length)throw new Hs(`Array index out of bounds: ${l} > ${d.length-1}.`);if(l!==Math.floor(l))throw new Hs(`Array index must be an integer, but found ${l} instead.`);return d[l]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class T1{constructor(o,l){this.type=on,this.needle=o,this.haystack=l}static parse(o,l){if(o.length!==3)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);let d=l.parse(o[1],1,Qr),m=l.parse(o[2],2,Qr);return d&&m?Tl(d.type,[on,qr,bi,Qa,Qr])?new T1(d,m):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Es(d.type)} instead`):null}evaluate(o){let l=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(d==null)return!1;if(!Ym(l,["boolean","string","number","null"]))throw new Hs(`Expected first argument to be of type boolean, string, number or null, but found ${Es(Vs(l))} instead.`);if(!Ym(d,["string","array"]))throw new Hs(`Expected second argument to be of type array or string, but found ${Es(Vs(d))} instead.`);return d.indexOf(l)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class hg{constructor(o,l,d){this.type=bi,this.needle=o,this.haystack=l,this.fromIndex=d}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);let d=l.parse(o[1],1,Qr),m=l.parse(o[2],2,Qr);if(!d||!m)return null;if(!Tl(d.type,[on,qr,bi,Qa,Qr]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Es(d.type)} instead`);if(o.length===4){let y=l.parse(o[3],3,bi);return y?new hg(d,m,y):null}return new hg(d,m)}evaluate(o){let l=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(!Ym(l,["boolean","string","number","null"]))throw new Hs(`Expected first argument to be of type boolean, string, number or null, but found ${Es(Vs(l))} instead.`);if(!Ym(d,["string","array"]))throw new Hs(`Expected second argument to be of type array or string, but found ${Es(Vs(d))} instead.`);if(this.fromIndex){let m=this.fromIndex.evaluate(o);return d.indexOf(l,m)}return d.indexOf(l)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class zv{constructor(o,l,d,m,y,v){this.inputType=o,this.type=l,this.input=d,this.cases=m,this.outputs=y,this.otherwise=v}static parse(o,l){if(o.length<5)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return l.error("Expected an even number of arguments.");let d,m;l.expectedType&&l.expectedType.kind!=="value"&&(m=l.expectedType);let y={},v=[];for(let D=2;D<o.length-1;D+=2){let L=o[D],F=o[D+1];Array.isArray(L)||(L=[L]);let N=l.concat(D);if(L.length===0)return N.error("Expected at least one branch label.");for(let q of L){if(typeof q!="number"&&typeof q!="string")return N.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return N.error("Numeric branch labels must be integer values.");if(d){if(N.checkSubtype(d,Vs(q)))return null}else d=Vs(q);if(y[String(q)]!==void 0)return N.error("Branch labels must be unique.");y[String(q)]=v.length}let H=l.parse(F,D,m);if(!H)return null;m=m||H.type,v.push(H)}let S=l.parse(o[1],1,Qr);if(!S)return null;let T=l.parse(o[o.length-1],o.length-1,m);return T?S.type.kind!=="value"&&l.concat(1).checkSubtype(d,S.type)?null:new zv(d,m,S,y,v,T):null}evaluate(o){let l=this.input.evaluate(o);return(Vs(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){let o=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),d=[],m={};for(let v of l){let S=m[this.cases[v]];S===void 0?(m[this.cases[v]]=d.length,d.push([this.cases[v],[v]])):d[S][1].push(v)}let y=v=>this.inputType.kind==="number"?Number(v):v;for(let[v,S]of d)o.push(S.length===1?y(S[0]):S.map(y)),o.push(this.outputs[v].serialize());return o.push(this.otherwise.serialize()),o}}class Fv{constructor(o,l,d){this.type=o,this.branches=l,this.otherwise=d}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return l.error("Expected an odd number of arguments.");let d;l.expectedType&&l.expectedType.kind!=="value"&&(d=l.expectedType);let m=[];for(let v=1;v<o.length-1;v+=2){let S=l.parse(o[v],v,on);if(!S)return null;let T=l.parse(o[v+1],v+1,d);if(!T)return null;m.push([S,T]),d=d||T.type}let y=l.parse(o[o.length-1],o.length-1,d);return y?new Fv(d,m,y):null}evaluate(o){for(let[l,d]of this.branches)if(l.evaluate(o))return d.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(let[l,d]of this.branches)o(l),o(d);o(this.otherwise)}outputDefined(){return this.branches.every(([o,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){let o=["case"];return this.eachChild(l=>{o.push(l.serialize())}),o}}class dg{constructor(o,l,d,m){this.type=o,this.input=l,this.beginIndex=d,this.endIndex=m}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);let d=l.parse(o[1],1,Qr),m=l.parse(o[2],2,bi);if(!d||!m)return null;if(!Tl(d.type,[Lo(Qr),qr,Qr]))return l.error(`Expected first argument to be of type array or string, but found ${Es(d.type)} instead`);if(o.length===4){let y=l.parse(o[3],3,bi);return y?new dg(d.type,d,m,y):null}return new dg(d.type,d,m)}evaluate(o){let l=this.input.evaluate(o),d=this.beginIndex.evaluate(o);if(!Ym(l,["string","array"]))throw new Hs(`Expected first argument to be of type array or string, but found ${Es(Vs(l))} instead.`);if(this.endIndex){let m=this.endIndex.evaluate(o);return l.slice(d,m)}return l.slice(d)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function kv(a,o){return a==="=="||a==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Nv(a,o,l,d){return d.compare(o,l)===0}function Kp(a,o,l){let d=a!=="=="&&a!=="!=";return class Eq{constructor(y,v,S){this.type=on,this.lhs=y,this.rhs=v,this.collator=S,this.hasUntypedArgument=y.type.kind==="value"||v.type.kind==="value"}static parse(y,v){if(y.length!==3&&y.length!==4)return v.error("Expected two or three arguments.");let S=y[0],T=v.parse(y[1],1,Qr);if(!T)return null;if(!kv(S,T.type))return v.concat(1).error(`"${S}" comparisons are not supported for type '${Es(T.type)}'.`);let D=v.parse(y[2],2,Qr);if(!D)return null;if(!kv(S,D.type))return v.concat(2).error(`"${S}" comparisons are not supported for type '${Es(D.type)}'.`);if(T.type.kind!==D.type.kind&&T.type.kind!=="value"&&D.type.kind!=="value")return v.error(`Cannot compare types '${Es(T.type)}' and '${Es(D.type)}'.`);d&&(T.type.kind==="value"&&D.type.kind!=="value"?T=new Ja(D.type,[T]):T.type.kind!=="value"&&D.type.kind==="value"&&(D=new Ja(T.type,[D])));let L=null;if(y.length===4){if(T.type.kind!=="string"&&D.type.kind!=="string"&&T.type.kind!=="value"&&D.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(L=v.parse(y[3],3,_v),!L)return null}return new Eq(T,D,L)}evaluate(y){let v=this.lhs.evaluate(y),S=this.rhs.evaluate(y);if(d&&this.hasUntypedArgument){let T=Vs(v),D=Vs(S);if(T.kind!==D.kind||T.kind!=="string"&&T.kind!=="number")throw new Hs(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${T.kind}, ${D.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){let T=Vs(v),D=Vs(S);if(T.kind!=="string"||D.kind!=="string")return o(y,v,S)}return this.collator?l(y,v,S,this.collator.evaluate(y)):o(y,v,S)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){let y=[a];return this.eachChild(v=>{y.push(v.serialize())}),y}}}let LP=Kp("==",function(a,o,l){return o===l},Nv),iM=Kp("!=",function(a,o,l){return o!==l},function(a,o,l,d){return!Nv(0,o,l,d)}),zP=Kp("<",function(a,o,l){return o<l},function(a,o,l,d){return d.compare(o,l)<0}),FP=Kp(">",function(a,o,l){return o>l},function(a,o,l,d){return d.compare(o,l)>0}),kP=Kp("<=",function(a,o,l){return o<=l},function(a,o,l,d){return d.compare(o,l)<=0}),NP=Kp(">=",function(a,o,l){return o>=l},function(a,o,l,d){return d.compare(o,l)>=0});class A1{constructor(o,l,d,m,y,v){this.type=qr,this.number=o,this.locale=l,this.currency=d,this.unit=m,this.minFractionDigits=y,this.maxFractionDigits=v}static parse(o,l){if(o.length!==3)return l.error("Expected two arguments.");let d=l.parse(o[1],1,bi);if(!d)return null;let m=o[2];if(typeof m!="object"||Array.isArray(m))return l.error("NumberFormat options argument must be an object.");let y=null;if(m.locale&&(y=l.parse(m.locale,1,qr),!y))return null;let v=null;if(m.currency&&(v=l.parse(m.currency,1,qr),!v))return null;let S=null;if(m.unit&&(S=l.parse(m.unit,1,qr),!S))return null;let T=null;if(m["min-fraction-digits"]&&(T=l.parse(m["min-fraction-digits"],1,bi),!T))return null;let D=null;return m["max-fraction-digits"]&&(D=l.parse(m["max-fraction-digits"],1,bi),!D)?null:new A1(d,y,v,S,T,D)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class C1{constructor(o){this.type=bi,this.input=o}static parse(o,l){if(o.length!==2)return l.error(`Expected 1 argument, but found ${o.length-1} instead.`);let d=l.parse(o[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Es(d.type)} instead.`):new C1(d):null}evaluate(o){let l=this.input.evaluate(o);if(typeof l=="string"||Array.isArray(l))return l.length;throw new Hs(`Expected value to be of type string or array, but found ${Es(Vs(l))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){let o=["length"];return this.eachChild(l=>{o.push(l.serialize())}),o}}function rM(a){return function(){a=1831565813+(a|=0)|0;let o=Math.imul(a^a>>>15,1|a);return o=o+Math.imul(o^o>>>7,61|o)^o,((o^o>>>14)>>>0)/4294967296}}let Jp={"==":LP,"!=":iM,">":FP,"<":zP,">=":NP,"<=":kP,array:Ja,at:Lv,boolean:Ja,case:Fv,coalesce:Sd,collator:Xm,format:_d,image:ru,in:T1,"index-of":hg,interpolate:nl,"interpolate-hcl":nl,"interpolate-lab":nl,length:C1,let:Ov,literal:Xl,match:zv,number:Ja,"number-format":A1,object:Ja,slice:dg,step:Qp,string:Ja,"to-boolean":nu,"to-color":nu,"to-number":nu,"to-string":nu,var:og,within:Tc,distance:bd,config:uh};function nM(a,[o,l,d,m]){o=o.evaluate(a),l=l.evaluate(a),d=d.evaluate(a);let y=m?m.evaluate(a):1,v=OE(o,l,d,y);if(v)throw new Hs(v);return new en(o/255*y,l/255*y,d/255*y,y)}function BP(a,[o,l,d,m]){o=o.evaluate(a),l=l.evaluate(a),d=d.evaluate(a);let y=m?m.evaluate(a):1,v=function(D,L,F,N){return typeof D=="number"&&D>=0&&D<=360?typeof L=="number"&&L>=0&&L<=100&&typeof F=="number"&&F>=0&&F<=100?N===void 0||typeof N=="number"&&N>=0&&N<=1?null:`Invalid hsla value [${[D,L,F,N].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof N=="number"?[D,L,F,N]:[D,L,F]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof N=="number"?[D,L,F,N]:[D,L,F]).join(", ")}]: 'h' must be between 0 and 360.`}(o,l,d,y);if(v)throw new Hs(v);let S=`hsla(${o}, ${l}%, ${d}%, ${y})`,T=en.parse(S);if(!T)throw new Hs(`Failed to parse HSLA color: ${S}`);return T}function _(a,o){return a in o}function h(a,o){let l=o[a];return l===void 0?null:l}function g(a){return{type:a}}function b(a){return{result:"success",value:a}}function M(a){return{result:"error",value:a}}function C(a,o){return!!a&&!!a.parameters&&a.parameters.indexOf(o)>-1}function R(a){return a["property-type"]==="data-driven"}function z(a){return C(a.expression,"measure-light")}function B(a){return C(a.expression,"zoom")}function G(a){return!!a.expression&&a.expression.interpolated}function W(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Z(a){return a}function te(a,o){let l=o.type==="color",d=a.stops&&typeof a.stops[0][0]=="object",m=d||!(d||a.property!==void 0),y=a.type||(G(o)?"exponential":"interval");if(l&&((a=Hp({},a)).stops&&(a.stops=a.stops.map(D=>[D[0],en.parse(D[1])])),a.default=en.parse(a.default?a.default:o.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!ug[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let v,S,T;if(y==="exponential")v=de;else if(y==="interval")v=ue;else if(y==="categorical"){v=ce,S=Object.create(null);for(let D of a.stops)S[D[0]]=D[1];T=typeof a.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);v=pe}if(d){let D={},L=[];for(let H=0;H<a.stops.length;H++){let q=a.stops[H],Q=q[0].zoom;D[Q]===void 0&&(D[Q]={zoom:Q,type:a.type,property:a.property,default:a.default,stops:[]},L.push(Q)),D[Q].stops.push([q[0].value,q[1]])}let F=[];for(let H of L)F.push([D[H].zoom,te(D[H],o)]);let N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:nl.interpolationFactor.bind(void 0,N),zoomStops:F.map(H=>H[0]),evaluate:({zoom:H},q)=>de({stops:F,base:a.base},o,H).evaluate(H,q)}}if(m){let D=y==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:nl.interpolationFactor.bind(void 0,D),zoomStops:a.stops.map(L=>L[0]),evaluate:({zoom:L})=>v(a,o,L,S,T)}}return{kind:"source",evaluate(D,L){let F=L&&L.properties?L.properties[a.property]:void 0;return F===void 0?ne(a.default,o.default):v(a,o,F,S,T)}}}function ne(a,o,l){return a!==void 0?a:o!==void 0?o:l!==void 0?l:void 0}function ce(a,o,l,d,m){return ne(typeof l===m?d[l]:void 0,a.default,o.default)}function ue(a,o,l){if(ah(l)!=="number")return ne(a.default,o.default);let d=a.stops.length;if(d===1||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[d-1][0])return a.stops[d-1][1];let m=wd(a.stops.map(y=>y[0]),l);return a.stops[m][1]}function de(a,o,l){let d=a.base!==void 0?a.base:1;if(ah(l)!=="number")return ne(a.default,o.default);let m=a.stops.length;if(m===1||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[m-1][0])return a.stops[m-1][1];let y=wd(a.stops.map(L=>L[0]),l),v=function(L,F,N,H){let q=H-N,Q=L-N;return q===0?0:F===1?Q/q:(Math.pow(F,Q)-1)/(Math.pow(F,q)-1)}(l,d,a.stops[y][0],a.stops[y+1][0]),S=a.stops[y][1],T=a.stops[y+1][1],D=Wm[o.type]||Z;if(a.colorSpace&&a.colorSpace!=="rgb"){let L=ug[a.colorSpace];D=(F,N)=>L.reverse(L.interpolate(L.forward(F),L.forward(N),v))}return typeof S.evaluate=="function"?{evaluate(...L){let F=S.evaluate.apply(void 0,L),N=T.evaluate.apply(void 0,L);if(F!==void 0&&N!==void 0)return D(F,N,v)}}:D(S,T,v)}function pe(a,o,l){return o.type==="color"?l=en.parse(l):o.type==="formatted"?l=ea.fromString(l.toString()):o.type==="resolvedImage"?l=Ka.fromString(l.toString()):ah(l)===o.type||o.type==="enum"&&o.values[l]||(l=void 0),ne(l,a.default,o.default)}Fa.register(Jp,{error:[{kind:"error"},[qr],(a,[o])=>{throw new Hs(o.evaluate(a))}],typeof:[qr,[Qr],(a,[o])=>Es(Vs(o.evaluate(a)))],"to-rgba":[Lo(bi,4),[Ml],(a,[o])=>o.evaluate(a).toRenderColor(null).toArray()],rgb:[Ml,[bi,bi,bi],nM],rgba:[Ml,[bi,bi,bi,bi],nM],hsl:[Ml,[bi,bi,bi],BP],hsla:[Ml,[bi,bi,bi,bi],BP],has:{type:on,overloads:[[[qr],(a,[o])=>_(o.evaluate(a),a.properties())],[[qr,Wp],(a,[o,l])=>_(o.evaluate(a),l.evaluate(a))]]},get:{type:Qr,overloads:[[[qr],(a,[o])=>h(o.evaluate(a),a.properties())],[[qr,Wp],(a,[o,l])=>h(o.evaluate(a),l.evaluate(a))]]},"feature-state":[Qr,[qr],(a,[o])=>h(o.evaluate(a),a.featureState||{})],properties:[Wp,[],a=>a.properties()],"geometry-type":[qr,[],a=>a.geometryType()],id:[Qr,[],a=>a.id()],zoom:[bi,[],a=>a.globals.zoom],pitch:[bi,[],a=>a.globals.pitch||0],"distance-from-center":[bi,[],a=>a.distanceFromCenter()],"measure-light":[bi,[qr],(a,[o])=>a.measureLight(o.evaluate(a))],"heatmap-density":[bi,[],a=>a.globals.heatmapDensity||0],"line-progress":[bi,[],a=>a.globals.lineProgress||0],"raster-value":[bi,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[bi,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[bi,[],a=>a.globals.skyRadialProgress||0],accumulated:[Qr,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[bi,g(bi),(a,o)=>{let l=0;for(let d of o)l+=d.evaluate(a);return l}],"*":[bi,g(bi),(a,o)=>{let l=1;for(let d of o)l*=d.evaluate(a);return l}],"-":{type:bi,overloads:[[[bi,bi],(a,[o,l])=>o.evaluate(a)-l.evaluate(a)],[[bi],(a,[o])=>-o.evaluate(a)]]},"/":[bi,[bi,bi],(a,[o,l])=>o.evaluate(a)/l.evaluate(a)],"%":[bi,[bi,bi],(a,[o,l])=>o.evaluate(a)%l.evaluate(a)],ln2:[bi,[],()=>Math.LN2],pi:[bi,[],()=>Math.PI],e:[bi,[],()=>Math.E],"^":[bi,[bi,bi],(a,[o,l])=>Math.pow(o.evaluate(a),l.evaluate(a))],sqrt:[bi,[bi],(a,[o])=>Math.sqrt(o.evaluate(a))],log10:[bi,[bi],(a,[o])=>Math.log(o.evaluate(a))/Math.LN10],ln:[bi,[bi],(a,[o])=>Math.log(o.evaluate(a))],log2:[bi,[bi],(a,[o])=>Math.log(o.evaluate(a))/Math.LN2],sin:[bi,[bi],(a,[o])=>Math.sin(o.evaluate(a))],cos:[bi,[bi],(a,[o])=>Math.cos(o.evaluate(a))],tan:[bi,[bi],(a,[o])=>Math.tan(o.evaluate(a))],asin:[bi,[bi],(a,[o])=>Math.asin(o.evaluate(a))],acos:[bi,[bi],(a,[o])=>Math.acos(o.evaluate(a))],atan:[bi,[bi],(a,[o])=>Math.atan(o.evaluate(a))],min:[bi,g(bi),(a,o)=>Math.min(...o.map(l=>l.evaluate(a)))],max:[bi,g(bi),(a,o)=>Math.max(...o.map(l=>l.evaluate(a)))],abs:[bi,[bi],(a,[o])=>Math.abs(o.evaluate(a))],round:[bi,[bi],(a,[o])=>{let l=o.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[bi,[bi],(a,[o])=>Math.floor(o.evaluate(a))],ceil:[bi,[bi],(a,[o])=>Math.ceil(o.evaluate(a))],"filter-==":[on,[qr,Qr],(a,[o,l])=>a.properties()[o.value]===l.value],"filter-id-==":[on,[Qr],(a,[o])=>a.id()===o.value],"filter-type-==":[on,[qr],(a,[o])=>a.geometryType()===o.value],"filter-<":[on,[qr,Qr],(a,[o,l])=>{let d=a.properties()[o.value],m=l.value;return typeof d==typeof m&&d<m}],"filter-id-<":[on,[Qr],(a,[o])=>{let l=a.id(),d=o.value;return typeof l==typeof d&&l<d}],"filter->":[on,[qr,Qr],(a,[o,l])=>{let d=a.properties()[o.value],m=l.value;return typeof d==typeof m&&d>m}],"filter-id->":[on,[Qr],(a,[o])=>{let l=a.id(),d=o.value;return typeof l==typeof d&&l>d}],"filter-<=":[on,[qr,Qr],(a,[o,l])=>{let d=a.properties()[o.value],m=l.value;return typeof d==typeof m&&d<=m}],"filter-id-<=":[on,[Qr],(a,[o])=>{let l=a.id(),d=o.value;return typeof l==typeof d&&l<=d}],"filter->=":[on,[qr,Qr],(a,[o,l])=>{let d=a.properties()[o.value],m=l.value;return typeof d==typeof m&&d>=m}],"filter-id->=":[on,[Qr],(a,[o])=>{let l=a.id(),d=o.value;return typeof l==typeof d&&l>=d}],"filter-has":[on,[Qr],(a,[o])=>o.value in a.properties()],"filter-has-id":[on,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[on,[Lo(qr)],(a,[o])=>o.value.indexOf(a.geometryType())>=0],"filter-id-in":[on,[Lo(Qr)],(a,[o])=>o.value.indexOf(a.id())>=0],"filter-in-small":[on,[qr,Lo(Qr)],(a,[o,l])=>l.value.indexOf(a.properties()[o.value])>=0],"filter-in-large":[on,[qr,Lo(Qr)],(a,[o,l])=>function(d,m,y,v){for(;y<=v;){let S=y+v>>1;if(m[S]===d)return!0;m[S]>d?v=S-1:y=S+1}return!1}(a.properties()[o.value],l.value,0,l.value.length-1)],all:{type:on,overloads:[[[on,on],(a,[o,l])=>o.evaluate(a)&&l.evaluate(a)],[g(on),(a,o)=>{for(let l of o)if(!l.evaluate(a))return!1;return!0}]]},any:{type:on,overloads:[[[on,on],(a,[o,l])=>o.evaluate(a)||l.evaluate(a)],[g(on),(a,o)=>{for(let l of o)if(l.evaluate(a))return!0;return!1}]]},"!":[on,[on],(a,[o])=>!o.evaluate(a)],"is-supported-script":[on,[qr],(a,[o])=>{let l=a.globals&&a.globals.isSupportedScript;return!l||l(o.evaluate(a))}],upcase:[qr,[qr],(a,[o])=>o.evaluate(a).toUpperCase()],downcase:[qr,[qr],(a,[o])=>o.evaluate(a).toLowerCase()],concat:[qr,g(Qr),(a,o)=>o.map(l=>Yl(l.evaluate(a))).join("")],"resolved-locale":[qr,[_v],(a,[o])=>o.evaluate(a).resolvedLocale()],random:[bi,[bi,bi,Qr],(a,o)=>{let[l,d,m]=o.map(v=>v.evaluate(a));if(l>d||l===d)return l;let y;if(typeof m=="string")y=function(v){let S=0;if(v.length===0)return S;for(let T=0;T<v.length;T++)S=(S<<5)-S+v.charCodeAt(T),S|=0;return S}(m);else{if(typeof m!="number")throw new Hs(`Invalid seed input: ${m}`);y=m}return l+rM(y)()*(d-l)}]});class Me{constructor(o,l,d,m){this.expression=o,this._warningHistory={},this._evaluator=new d1(d,m),this._defaultValue=l?function(y){return y.type==="color"&&(W(y.default)||Array.isArray(y.default))?new en(0,0,0,0):y.type==="color"?en.parse(y.default)||null:y.default===void 0?null:y.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(o,l,d,m,y,v,S,T){return this._evaluator.globals=o,this._evaluator.feature=l,this._evaluator.featureState=d,this._evaluator.canonical=m||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(o,l,d,m,y,v,S,T){this._evaluator.globals=o,this._evaluator.feature=l||null,this._evaluator.featureState=d||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=T||null;try{let D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Hs(`Expected value to be one of ${Object.keys(this._enumValues).map(L=>JSON.stringify(L)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${D.message}`)),this._defaultValue}}}function Te(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Jp}function Se(a,o,l,d){let m=new ZE(Jp,[],o?function(v){let S={color:Ml,string:qr,number:bi,enum:qr,boolean:on,formatted:qp,resolvedImage:vd};return v.type==="array"?Lo(S[v.value]||Qr,v.length):S[v.type]}(o):void 0,void 0,void 0,l,d),y=m.parse(a,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return y?b(new Me(y,o,l,d)):M(m.errors)}class Be{constructor(o,l,d){this.kind=o,this._styleExpression=l,this.isLightConstant=d,this.isStateDependent=o!=="constant"&&!Iv(l.expression),this.configDependencies=ng(l.expression)}evaluateWithoutErrorHandling(o,l,d,m,y,v){return this._styleExpression.evaluateWithoutErrorHandling(o,l,d,m,y,v)}evaluate(o,l,d,m,y,v){return this._styleExpression.evaluate(o,l,d,m,y,v)}}class Oe{constructor(o,l,d,m,y){this.kind=o,this.zoomStops=d,this._styleExpression=l,this.isStateDependent=o!=="camera"&&!Iv(l.expression),this.isLightConstant=y,this.configDependencies=ng(l.expression),this.interpolationType=m}evaluateWithoutErrorHandling(o,l,d,m,y,v){return this._styleExpression.evaluateWithoutErrorHandling(o,l,d,m,y,v)}evaluate(o,l,d,m,y,v){return this._styleExpression.evaluate(o,l,d,m,y,v)}interpolationFactor(o,l,d){return this.interpolationType?nl.interpolationFactor(this.interpolationType,o,l,d):0}}function Le(a,o,l,d){if((a=Se(a,o,l,d)).result==="error")return a;let m=a.value.expression,y=rg(m);if(!y&&!R(o))return M([new Mc("","data expressions not supported")]);let v=sg(m,["zoom","pitch","distance-from-center"]);if(!v&&!B(o))return M([new Mc("","zoom expressions not supported")]);let S=sg(m,["measure-light"]);if(!S&&!z(o))return M([new Mc("","measure-light expression not supported")]);let T=o.expression&&o.expression.relaxZoomRestriction,D=We(m);return D||v||T?D instanceof Mc?M([D]):D instanceof nl&&!G(o)?M([new Mc("",'"interpolate" expressions cannot be used with this property')]):b(D?new Oe(y?"camera":"composite",a.value,D.labels,D instanceof nl?D.interpolation:void 0,S):new Be(y?"constant":"source",a.value,S)):M([new Mc("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ge{constructor(o,l){this._parameters=o,this._specification=l,Hp(this,te(this._parameters,this._specification))}static deserialize(o){return new Ge(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function We(a){let o=null;if(a instanceof Ov)o=We(a.result);else if(a instanceof Sd){for(let l of a.args)if(o=We(l),o)break}else(a instanceof Qp||a instanceof nl)&&a.input instanceof Fa&&a.input.name==="zoom"&&(o=a);return o instanceof Mc||a.eachChild(l=>{let d=We(l);d instanceof Mc?o=d:o&&d&&o!==d&&(o=new Mc("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}var at=Ne,Ye=3;function Ne(a,o,l){var d=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var m=new Int32Array(this.arrayBuffer);a=m[0],this.d=(o=m[1])+2*(l=m[2]);for(var y=0;y<this.d*this.d;y++){var v=m[Ye+y],S=m[Ye+y+1];d.push(v===S?null:m.subarray(v,S))}var T=m[Ye+d.length+1];this.keys=m.subarray(m[Ye+d.length],T),this.bboxes=m.subarray(T),this.insert=this._insertReadonly}else{this.d=o+2*l;for(var D=0;D<this.d*this.d;D++)d.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=a,this.padding=l,this.scale=o/a,this.uid=0;var L=l/o*a;this.min=-L,this.max=a+L}Ne.prototype.insert=function(a,o,l,d,m){this._forEachCell(o,l,d,m,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(m)},Ne.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ne.prototype._insertCell=function(a,o,l,d,m,y){this.cells[m].push(y)},Ne.prototype.query=function(a,o,l,d,m){var y=this.min,v=this.max;if(a<=y&&o<=y&&v<=l&&v<=d&&!m)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(a,o,l,d,this._queryCell,S,{},m),S},Ne.prototype._queryCell=function(a,o,l,d,m,y,v,S){var T=this.cells[m];if(T!==null)for(var D=this.keys,L=this.bboxes,F=0;F<T.length;F++){var N=T[F];if(v[N]===void 0){var H=4*N;(S?S(L[H+0],L[H+1],L[H+2],L[H+3]):a<=L[H+2]&&o<=L[H+3]&&l>=L[H+0]&&d>=L[H+1])?(v[N]=!0,y.push(D[N])):v[N]=!1}}},Ne.prototype._forEachCell=function(a,o,l,d,m,y,v,S){for(var T=this._convertToCellCoord(a),D=this._convertToCellCoord(o),L=this._convertToCellCoord(l),F=this._convertToCellCoord(d),N=T;N<=L;N++)for(var H=D;H<=F;H++){var q=this.d*H+N;if((!S||S(this._convertFromCellCoord(N),this._convertFromCellCoord(H),this._convertFromCellCoord(N+1),this._convertFromCellCoord(H+1)))&&m.call(this,a,o,l,d,q,y,v,S))return}},Ne.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Ne.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Ne.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,o=Ye+this.cells.length+1+1,l=0,d=0;d<this.cells.length;d++)l+=this.cells[d].length;var m=new Int32Array(o+l+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var y=o,v=0;v<a.length;v++){var S=a[v];m[Ye+v]=y,m.set(S,y),y+=S.length}return m[Ye+a.length]=y,m.set(this.keys,y),m[Ye+a.length+1]=y+=this.keys.length,m.set(this.bboxes,y),y+=this.bboxes.length,m.buffer};var gt=k(at);let ft={};function tt(a,o,l={}){Object.defineProperty(a,"_classRegistryKey",{value:o,writable:!1}),ft[o]={klass:a,omit:l.omit||[]}}tt(Object,"Object"),gt.serialize=function(a,o){let l=a.toArrayBuffer();return o&&o.add(l),{buffer:l}},gt.deserialize=function(a){return new gt(a.buffer)},Object.defineProperty(gt,"name",{value:"Grid"}),tt(gt,"Grid"),tt(en,"Color"),tt(Error,"Error"),tt(ea,"Formatted"),tt(bv,"FormattedSection"),tt(fv,"AJAXError"),tt(Ka,"ResolvedImage"),tt(Ge,"StylePropertyFunction"),tt(Me,"StyleExpression",{omit:["_evaluator"]}),tt(Oe,"ZoomDependentExpression"),tt(Be,"ZoomConstantExpression"),tt(Fa,"CompoundExpression",{omit:["_evaluate"]});for(let a in Jp)ft[Jp[a]._classRegistryKey]||tt(Jp[a],`Expression${a}`);function Bt(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Pt(a){return self.ImageBitmap&&a instanceof ImageBitmap}function ct(a,o){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Bt(a)||Pt(a))return o&&o.add(a),a;if(ArrayBuffer.isView(a)){let l=a;return o&&o.add(l.buffer),l}if(a instanceof ImageData)return o&&o.add(a.data.buffer),a;if(Array.isArray(a)){let l=[];for(let d of a)l.push(ct(d,o));return l}if(a instanceof Map){let l={$name:"Map"};for(let[d,m]of a.entries())l[d]=ct(m);return l}if(a instanceof Set){let l={$name:"Set"},d=0;for(let m of a.values())l[++d]=ct(m);return l}if(typeof a=="object"){let l=a.constructor,d=l._classRegistryKey;if(!d)throw new Error(`can't serialize object of unregistered class ${d}`);let m=l.serialize?l.serialize(a,o):{};if(!l.serialize){for(let y in a)a.hasOwnProperty(y)&&(ft[d].omit.indexOf(y)>=0||(m[y]=ct(a[y],o)));a instanceof Error&&(m.message=a.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(m.$name=d),m}throw new Error("can't serialize object of type "+typeof a)}function _t(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Bt(a)||Pt(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(_t);if(typeof a=="object"){let o=a.$name||"Object";if(o==="Map"){let m=new Map;for(let y of Object.keys(a))y!=="$name"&&m.set(y,_t(a[y]));return m}if(o==="Set"){let m=new Set;for(let y of Object.keys(a))y!=="$name"&&m.add(_t(a[y]));return m}let{klass:l}=ft[o];if(!l)throw new Error(`can't deserialize unregistered class ${o}`);if(l.deserialize)return l.deserialize(a);let d=Object.create(l.prototype);for(let m of Object.keys(a))m!=="$name"&&(d[m]=_t(a[m]));return d}throw new Error("can't deserialize object of type "+typeof a)}let Qe={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function Rt(a){for(let o of a)if(ci(o.charCodeAt(0)))return!0;return!1}function Ft(a){for(let o of a)if(!oi(o.charCodeAt(0)))return!1;return!0}function oi(a){return!(Qe.Arabic(a)||Qe["Arabic Supplement"](a)||Qe["Arabic Extended-A"](a)||Qe["Arabic Presentation Forms-A"](a)||Qe["Arabic Presentation Forms-B"](a))}function ci(a){return!(a!==746&&a!==747&&(a<4352||!(Qe["Bopomofo Extended"](a)||Qe.Bopomofo(a)||Qe["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Qe["CJK Compatibility Ideographs"](a)||Qe["CJK Compatibility"](a)||Qe["CJK Radicals Supplement"](a)||Qe["CJK Strokes"](a)||!(!Qe["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Qe["CJK Unified Ideographs Extension A"](a)||Qe["CJK Unified Ideographs"](a)||Qe["Enclosed CJK Letters and Months"](a)||Qe["Hangul Compatibility Jamo"](a)||Qe["Hangul Jamo Extended-A"](a)||Qe["Hangul Jamo Extended-B"](a)||Qe["Hangul Jamo"](a)||Qe["Hangul Syllables"](a)||Qe.Hiragana(a)||Qe["Ideographic Description Characters"](a)||Qe.Kanbun(a)||Qe["Kangxi Radicals"](a)||Qe["Katakana Phonetic Extensions"](a)||Qe.Katakana(a)&&a!==12540||!(!Qe["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Qe["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Qe["Unified Canadian Aboriginal Syllabics"](a)||Qe["Unified Canadian Aboriginal Syllabics Extended"](a)||Qe["Vertical Forms"](a)||Qe["Yijing Hexagram Symbols"](a)||Qe["Yi Syllables"](a)||Qe["Yi Radicals"](a))))}function Si(a){return!(ci(a)||function(o){return!!(Qe["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Qe["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Qe["Letterlike Symbols"](o)||Qe["Number Forms"](o)||Qe["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Qe["Control Pictures"](o)&&o!==9251||Qe["Optical Character Recognition"](o)||Qe["Enclosed Alphanumerics"](o)||Qe["Geometric Shapes"](o)||Qe["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Qe["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Qe["CJK Symbols and Punctuation"](o)||Qe.Katakana(o)||Qe["Private Use Area"](o)||Qe["CJK Compatibility Forms"](o)||Qe["Small Form Variants"](o)||Qe["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(a))}function hi(a){return a>=1424&&a<=2303||Qe["Arabic Presentation Forms-A"](a)||Qe["Arabic Presentation Forms-B"](a)}function ji(a,o){return!(!o&&hi(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Qe.Khmer(a))}function cr(a){for(let o of a)if(hi(o.charCodeAt(0)))return!0;return!1}let Wi="deferred",gr="loading",Or="loaded",zn=null,xn="unavailable",Ur=null,yn=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(xn="error"),zn&&zn(a)};function _r(){br.fire(new Ec("pluginStateChange",{pluginStatus:xn,pluginURL:Ur}))}let br=new yd,ur=function(){return xn},Xr=function(){if(xn!==Wi||!Ur)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");xn=gr,_r(),Ur&&pd({url:Ur},a=>{a?yn(a):(xn=Or,_r())})},Ar={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>xn===Or||Ar.applyArabicShaping!=null,isLoading:()=>xn===gr,setState(a){xn=a.pluginStatus,Ur=a.pluginURL},isParsed:()=>Ar.applyArabicShaping!=null&&Ar.processBidirectionalText!=null&&Ar.processStyledBidirectionalText!=null,getPluginURL:()=>Ur};class er{constructor(o,l){this.zoom=o,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch,this.brightness=l.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(o){return function(l,d){for(let m of l)if(!ji(m.charCodeAt(0),d))return!1;return!0}(o,Ar.isLoaded())}}class Is{constructor(o,l,d,m){this.property=o,this.value=l,this.expression=function(y,v,S,T){if(W(y))return new Ge(y,v);if(Te(y)||Array.isArray(y)&&y.length>0){let D=Le(y,v,S,T);if(D.result==="error")throw new Error(D.value.map(L=>`${L.key}: ${L.message}`).join(", "));return D.value}{let D=y;return typeof y=="string"&&v.type==="color"&&(D=en.parse(y)),{kind:"constant",configDependencies:new Set,evaluate:()=>D}}}(l===void 0?o.specification.default:l,o.specification,d,m)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,l,d){return this.property.possiblyEvaluate(this,o,l,d)}}class Ps{constructor(o,l,d){this.property=o,this.value=new Is(o,void 0,l,d)}transitioned(o,l){return new ko(this.property,this.value,l,Io({},o.transition,this.transition),o.now)}untransitioned(){return new ko(this.property,this.value,null,{},0)}}class Fo{constructor(o,l,d){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues),this._scope=l,this._options=d,this.configDependencies=new Set}getValue(o){return ba(this._values[o].value.value)}setValue(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new Ps(this._values[o].property,this._scope,this._options)),this._values[o].value=new Is(this._values[o].property,l===null?void 0:ba(l),this._scope,this._options),this._values[o].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].value.expression.configDependencies]))}setTransitionOrValue(o,l){l&&(this._options=l);let d=this._properties.properties;if(o)for(let m in o){let y=o[m];if(Dm(m,"-transition")){let v=m.slice(0,-11);d[v]&&this.setTransition(v,y)}else d.hasOwnProperty(m)&&this.setValue(m,y)}}getTransition(o){return ba(this._values[o].transition)}setTransition(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new Ps(this._values[o].property)),this._values[o].transition=ba(l)||void 0}serialize(){let o={};for(let l of Object.keys(this._values)){let d=this.getValue(l);d!==void 0&&(o[l]=d);let m=this.getTransition(l);m!==void 0&&(o[`${l}-transition`]=m)}return o}transitioned(o,l){let d=new yo(this._properties);for(let m of Object.keys(this._values))d._values[m]=this._values[m].transitioned(o,l._values[m]);return d}untransitioned(){let o=new yo(this._properties);for(let l of Object.keys(this._values))o._values[l]=this._values[l].untransitioned();return o}}class ko{constructor(o,l,d,m,y){let v=m.delay||0,S=m.duration||0;y=y||0,this.property=o,this.value=l,this.begin=y+v,this.end=this.begin+S,o.specification.transition&&(m.delay||m.duration)&&(this.prior=d)}possiblyEvaluate(o,l,d){let m=o.now||0,y=this.value.possiblyEvaluate(o,l,d),v=this.prior;if(v){if(m>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(m<this.begin)return v.possiblyEvaluate(o,l,d);{let S=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(o,l,d),y,rv(S))}}return y}}class yo{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,l,d){let m=new vo(this._properties);for(let y of Object.keys(this._values))m._values[y]=this._values[y].possiblyEvaluate(o,l,d);return m}hasTransition(){for(let o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class No{constructor(o,l,d){this._properties=o,this._values=Object.create(o.defaultPropertyValues),this._scope=l,this._options=d,this.configDependencies=new Set}getValue(o){return ba(this._values[o].value)}setValue(o,l){this._values[o]=new Is(this._values[o].property,l===null?void 0:ba(l),this._scope,this._options),this._values[o].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].expression.configDependencies]))}serialize(){let o={};for(let l of Object.keys(this._values)){let d=this.getValue(l);d!==void 0&&(o[l]=d)}return o}possiblyEvaluate(o,l,d){let m=new vo(this._properties);for(let y of Object.keys(this._values))m._values[y]=this._values[y].possiblyEvaluate(o,l,d);return m}}class no{constructor(o,l,d){this.property=o,this.value=l,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,l,d,m){return this.property.evaluate(this.value,this.parameters,o,l,d,m)}}class vo{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Ht{constructor(o){this.specification=o}possiblyEvaluate(o,l){return o.expression.evaluate(l)}interpolate(o,l,d){let m=Wm[this.specification.type];return m?m(o,l,d):o}}class Mi{constructor(o,l){this.specification=o,this.overrides=l}possiblyEvaluate(o,l,d,m){return new no(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(l,null,{},d,m)}:o.expression,l)}interpolate(o,l,d){if(o.value.kind!=="constant"||l.value.kind!=="constant")return o;if(o.value.value===void 0||l.value.value===void 0)return new no(this,{kind:"constant",value:void 0},o.parameters);let m=Wm[this.specification.type];return m?new no(this,{kind:"constant",value:m(o.value.value,l.value.value,d)},o.parameters):o}evaluate(o,l,d,m,y,v){return o.kind==="constant"?o.value:o.evaluate(l,d,m,y,v)}}class ta{constructor(o){this.specification=o}possiblyEvaluate(o,l,d,m){return!!o.expression.evaluate(l,null,{},d,m)}interpolate(){return!1}}class Dn{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let l=new er(0,{});for(let d in o){let m=o[d];m.specification.overridable&&this.overridableProperties.push(d);let y=this.defaultPropertyValues[d]=new Is(m,void 0),v=this.defaultTransitionablePropertyValues[d]=new Ps(m);this.defaultTransitioningPropertyValues[d]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=y.possiblyEvaluate(l)}}}tt(Mi,"DataDrivenProperty"),tt(Ht,"DataConstantProperty"),tt(ta,"ColorRampProperty");var mt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-line-alignment":{"type":"enum","values":{"inside":1,"outside":1,"center":1},"default":"center","property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function au(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function $l(a){if(Array.isArray(a))return a.map($l);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){let o={};for(let l in a)o[l]=$l(a[l]);return o}return au(a)}function lu(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(let o of a.slice(1))if(!lu(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}function cu(a,o="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};lu(a)||(a=ef(a));let l=a,d=!0;try{d=function(D){if(!dh(D))return D;let L=$l(D);return Uv(L),L=Bv(L),L}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(l,null,2)}
        `)}let m=mt[`filter_${o}`],y=Se(d,m),v=null;if(y.result==="error")throw new Error(y.value.map(D=>`${D.key}: ${D.message}`).join(", "));v=(D,L,F)=>y.value.evaluate(D,L,{},F);let S=null,T=null;if(d!==l){let D=Se(l,m);if(D.result==="error")throw new Error(D.value.map(L=>`${L.key}: ${L.message}`).join(", "));S=(L,F,N,H,q)=>D.value.evaluate(L,F,{},N,void 0,void 0,H,q),T=!rg(D.value.expression)}return{filter:v,dynamicFilter:S||void 0,needGeometry:jv(d),needFeature:!!T}}function Bv(a){if(!Array.isArray(a))return a;let o=function(l){if(D1.has(l[0])){for(let d=1;d<l.length;d++)if(dh(l[d]))return!0}return l}(a);return o===!0?o:o.map(l=>Bv(l))}function Uv(a){let o=!1,l=[];if(a[0]==="case"){for(let d=1;d<a.length-1;d+=2)o=o||dh(a[d]),l.push(a[d+1]);l.push(a[a.length-1])}else if(a[0]==="match"){o=o||dh(a[1]);for(let d=2;d<a.length-1;d+=2)l.push(a[d+1]);l.push(a[a.length-1])}else if(a[0]==="step"){o=o||dh(a[1]);for(let d=1;d<a.length-1;d+=2)l.push(a[d+1])}o&&(a.length=0,a.push("any",...l));for(let d=1;d<a.length;d++)Uv(a[d])}function dh(a){if(!Array.isArray(a))return!1;if((o=a[0])==="pitch"||o==="distance-from-center")return!0;var o;for(let l=1;l<a.length;l++)if(dh(a[l]))return!0;return!1}let D1=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ed(a,o){return a<o?-1:a>o?1:0}function jv(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let o=1;o<a.length;o++)if(jv(a[o]))return!0;return!1}function ef(a){if(!a)return!0;let o=a[0];return a.length<=1?o!=="any":o==="=="?UP(a[1],a[2],"=="):o==="!="?sM(UP(a[1],a[2],"==")):o==="<"||o===">"||o==="<="||o===">="?UP(a[1],a[2],o):o==="any"?(l=a.slice(1),["any"].concat(l.map(ef))):o==="all"?["all"].concat(a.slice(1).map(ef)):o==="none"?["all"].concat(a.slice(1).map(ef).map(sM)):o==="in"?M5(a[1],a.slice(2)):o==="!in"?sM(M5(a[1],a.slice(2))):o==="has"?T5(a[1]):o!=="!has"||sM(T5(a[1]));var l}function UP(a,o,l){switch(a){case"$type":return[`filter-type-${l}`,o];case"$id":return[`filter-id-${l}`,o];default:return[`filter-${l}`,a,o]}}function M5(a,o){if(o.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(l=>typeof l!=typeof o[0])?["filter-in-large",a,["literal",o.sort(Ed)]]:["filter-in-small",a,["literal",o]]}}function T5(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function sM(a){return["!",a]}let oM="";function A5(a,o){return o?`${a}${oM}${o}`:a}let C5="-transition",Rre=new Set(["fill","line","background","hillshade","raster"]);class sl extends yd{constructor(o,l,d,m,y){if(super(),this.id=o.id,this.fqid=A5(this.id,d),this.type=o.type,this.scope=d,this.lut=m,this.options=y,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,o.type!=="custom"&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type!=="background"&&o.type!=="sky"&&o.type!=="slot"&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),o.slot&&(this.slot=o.slot),l.layout&&(this._unevaluatedLayout=new No(l.layout,this.scope,y),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),l.paint)){this._transitionablePaint=new Fo(l.paint,this.scope,y);for(let v in o.paint)this.setPaintProperty(v,o.paint[v]);for(let v in o.layout)this.setLayoutProperty(v,o.layout[v]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vo(l.paint)}}onAdd(o){}onRemove(o){}isDraped(o){return Rre.has(this.type)}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,l){if(this.type==="custom"&&o==="visibility")return void(this.visibility=l);let d=this._unevaluatedLayout;d._properties.properties[o]&&(d.setValue(o,l),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),o==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(o){return Dm(o,C5)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,l){let d=this._transitionablePaint,m=d._properties.properties;if(Dm(o,C5)){let F=o.slice(0,-11);return m[F]&&d.setTransition(F,l||void 0),!1}if(!m[o])return!1;let y=d._values[o],v=y.value.isDataDriven(),S=y.value;d.setValue(o,l),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),this._handleSpecialPaintPropertyUpdate(o);let T=d._values[o].value,D=T.isDataDriven(),L=Dm(o,"pattern")||o==="line-dasharray";return D||v||L||this._handleOverridablePaintPropertyUpdate(o,S,T)}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getDefaultProgramParams(o,l,d){return null}_handleOverridablePaintPropertyUpdate(o,l,d){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,l)}serialize(){return Po({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(o,l)=>!(o===void 0||l==="layout"&&!Object.keys(o).length||l==="paint"&&!Object.keys(o).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let o in this.paint._values){let l=this.paint.get(o);if(l instanceof no&&R(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=cu(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(o){this._stats&&(o.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(o){}queryIntersectsFeature(o,l,d,m,y,v,S,T,D){}queryIntersectsMatchingFeature(o,l,d,m){}}let Ore={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class I1{constructor(o,l){this._structArray=o,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Kn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,l){return o._trim(),l&&(o.isTransferred=!0,l.add(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){let l=Object.create(this.prototype);return l.arrayBuffer=o.arrayBuffer,l.length=o.length,l.capacity=o.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...o){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...o){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function hn(a,o=1){let l=0,d=0;return{members:a.map(m=>{let y=Ore[m.type].BYTES_PER_ELEMENT,v=l=D5(l,Math.max(o,y)),S=m.components||1;return d=Math.max(d,y),l+=y*S,{name:m.name,type:m.type,components:S,offset:v}}),size:D5(l,Math.max(d,o)),alignment:o}}function D5(a,o){return Math.ceil(a/o)*o}class uu extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l){let d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){let m=2*o;return this.int16[m+0]=l,this.int16[m+1]=d,o}}uu.prototype.bytesPerElement=4,tt(uu,"StructArrayLayout2i4");class aM extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d){let m=this.length;return this.resize(m+1),this.emplace(m,o,l,d)}emplace(o,l,d,m){let y=3*o;return this.int16[y+0]=l,this.int16[y+1]=d,this.int16[y+2]=m,o}}aM.prototype.bytesPerElement=6,tt(aM,"StructArrayLayout3i6");class Md extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,m){let y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,m)}emplace(o,l,d,m,y){let v=4*o;return this.int16[v+0]=l,this.int16[v+1]=d,this.int16[v+2]=m,this.int16[v+3]=y,o}}Md.prototype.bytesPerElement=8,tt(Md,"StructArrayLayout4i8");class jP extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,m,y){let v=this.length;return this.resize(v+1),this.emplace(v,o,l,d,m,y)}emplace(o,l,d,m,y,v){let S=5*o;return this.int16[S+0]=l,this.int16[S+1]=d,this.int16[S+2]=m,this.int16[S+3]=y,this.int16[S+4]=v,o}}jP.prototype.bytesPerElement=10,tt(jP,"StructArrayLayout5i10");class VP extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,y,v,S){let T=this.length;return this.resize(T+1),this.emplace(T,o,l,d,m,y,v,S)}emplace(o,l,d,m,y,v,S,T){let D=6*o,L=12*o,F=3*o;return this.int16[D+0]=l,this.int16[D+1]=d,this.uint8[L+4]=m,this.uint8[L+5]=y,this.uint8[L+6]=v,this.uint8[L+7]=S,this.float32[F+2]=T,o}}VP.prototype.bytesPerElement=12,tt(VP,"StructArrayLayout2i4ub1f12");class tf extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m){let y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,m)}emplace(o,l,d,m,y){let v=4*o;return this.float32[v+0]=l,this.float32[v+1]=d,this.float32[v+2]=m,this.float32[v+3]=y,o}}tf.prototype.bytesPerElement=16,tt(tf,"StructArrayLayout4f16");class rf extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d){let m=this.length;return this.resize(m+1),this.emplace(m,o,l,d)}emplace(o,l,d,m){let y=3*o;return this.float32[y+0]=l,this.float32[y+1]=d,this.float32[y+2]=m,o}}rf.prototype.bytesPerElement=12,tt(rf,"StructArrayLayout3f12");class nf extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,y){let v=this.length;return this.resize(v+1),this.emplace(v,o,l,d,m,y)}emplace(o,l,d,m,y,v){let S=6*o,T=3*o;return this.uint16[S+0]=l,this.uint16[S+1]=d,this.uint16[S+2]=m,this.uint16[S+3]=y,this.float32[T+2]=v,o}}nf.prototype.bytesPerElement=12,tt(nf,"StructArrayLayout4ui1f12");class lM extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,m){let y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,m)}emplace(o,l,d,m,y){let v=4*o;return this.uint16[v+0]=l,this.uint16[v+1]=d,this.uint16[v+2]=m,this.uint16[v+3]=y,o}}lM.prototype.bytesPerElement=8,tt(lM,"StructArrayLayout4ui8");class cM extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,m,y,v){let S=this.length;return this.resize(S+1),this.emplace(S,o,l,d,m,y,v)}emplace(o,l,d,m,y,v,S){let T=6*o;return this.int16[T+0]=l,this.int16[T+1]=d,this.int16[T+2]=m,this.int16[T+3]=y,this.int16[T+4]=v,this.int16[T+5]=S,o}}cM.prototype.bytesPerElement=12,tt(cM,"StructArrayLayout6i12");class GP extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,m,y,v,S,T,D,L,F,N){let H=this.length;return this.resize(H+1),this.emplace(H,o,l,d,m,y,v,S,T,D,L,F,N)}emplace(o,l,d,m,y,v,S,T,D,L,F,N,H){let q=12*o;return this.int16[q+0]=l,this.int16[q+1]=d,this.int16[q+2]=m,this.int16[q+3]=y,this.uint16[q+4]=v,this.uint16[q+5]=S,this.uint16[q+6]=T,this.uint16[q+7]=D,this.int16[q+8]=L,this.int16[q+9]=F,this.int16[q+10]=N,this.int16[q+11]=H,o}}GP.prototype.bytesPerElement=24,tt(GP,"StructArrayLayout4i4ui4i24");class HP extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,y,v){let S=this.length;return this.resize(S+1),this.emplace(S,o,l,d,m,y,v)}emplace(o,l,d,m,y,v,S){let T=10*o,D=5*o;return this.int16[T+0]=l,this.int16[T+1]=d,this.int16[T+2]=m,this.float32[D+2]=y,this.float32[D+3]=v,this.float32[D+4]=S,o}}HP.prototype.bytesPerElement=20,tt(HP,"StructArrayLayout3i3f20");class WP extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){let l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint32[1*o+0]=l,o}}WP.prototype.bytesPerElement=4,tt(WP,"StructArrayLayout1ul4");class sf extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l){let d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){let m=2*o;return this.uint16[m+0]=l,this.uint16[m+1]=d,o}}sf.prototype.bytesPerElement=4,tt(sf,"StructArrayLayout2ui4");class qP extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,m,y,v,S,T,D,L,F,N,H){let q=this.length;return this.resize(q+1),this.emplace(q,o,l,d,m,y,v,S,T,D,L,F,N,H)}emplace(o,l,d,m,y,v,S,T,D,L,F,N,H,q){let Q=20*o,K=10*o;return this.int16[Q+0]=l,this.int16[Q+1]=d,this.int16[Q+2]=m,this.int16[Q+3]=y,this.int16[Q+4]=v,this.float32[K+3]=S,this.float32[K+4]=T,this.float32[K+5]=D,this.float32[K+6]=L,this.int16[Q+14]=F,this.uint32[K+8]=N,this.uint16[Q+18]=H,this.uint16[Q+19]=q,o}}qP.prototype.bytesPerElement=40,tt(qP,"StructArrayLayout5i4f1i1ul2ui40");class uM extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,m,y,v,S){let T=this.length;return this.resize(T+1),this.emplace(T,o,l,d,m,y,v,S)}emplace(o,l,d,m,y,v,S,T){let D=8*o;return this.int16[D+0]=l,this.int16[D+1]=d,this.int16[D+2]=m,this.int16[D+4]=y,this.int16[D+5]=v,this.int16[D+6]=S,this.int16[D+7]=T,o}}uM.prototype.bytesPerElement=16,tt(uM,"StructArrayLayout3i2i2i16");class YP extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,m,y){let v=this.length;return this.resize(v+1),this.emplace(v,o,l,d,m,y)}emplace(o,l,d,m,y,v){let S=4*o,T=8*o;return this.float32[S+0]=l,this.float32[S+1]=d,this.float32[S+2]=m,this.int16[T+6]=y,this.int16[T+7]=v,o}}YP.prototype.bytesPerElement=16,tt(YP,"StructArrayLayout2f1f2i16");class XP extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m){let y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,m)}emplace(o,l,d,m,y){let v=12*o,S=3*o;return this.uint8[v+0]=l,this.uint8[v+1]=d,this.float32[S+1]=m,this.float32[S+2]=y,o}}XP.prototype.bytesPerElement=12,tt(XP,"StructArrayLayout2ub2f12");class so extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d){let m=this.length;return this.resize(m+1),this.emplace(m,o,l,d)}emplace(o,l,d,m){let y=3*o;return this.uint16[y+0]=l,this.uint16[y+1]=d,this.uint16[y+2]=m,o}}so.prototype.bytesPerElement=6,tt(so,"StructArrayLayout3ui6");class $P extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,y,v,S,T,D,L,F,N,H,q,Q,K,ae,_e,ge,be,ze){let ke=this.length;return this.resize(ke+1),this.emplace(ke,o,l,d,m,y,v,S,T,D,L,F,N,H,q,Q,K,ae,_e,ge,be,ze)}emplace(o,l,d,m,y,v,S,T,D,L,F,N,H,q,Q,K,ae,_e,ge,be,ze,ke){let je=30*o,it=15*o,ut=60*o;return this.int16[je+0]=l,this.int16[je+1]=d,this.int16[je+2]=m,this.float32[it+2]=y,this.float32[it+3]=v,this.uint16[je+8]=S,this.uint16[je+9]=T,this.uint32[it+5]=D,this.uint32[it+6]=L,this.uint32[it+7]=F,this.uint16[je+16]=N,this.uint16[je+17]=H,this.uint16[je+18]=q,this.float32[it+10]=Q,this.float32[it+11]=K,this.uint8[ut+48]=ae,this.uint8[ut+49]=_e,this.uint8[ut+50]=ge,this.uint32[it+13]=be,this.int16[je+28]=ze,this.uint8[ut+58]=ke,o}}$P.prototype.bytesPerElement=60,tt($P,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ZP extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,y,v,S,T,D,L,F,N,H,q,Q,K,ae,_e,ge,be,ze,ke,je,it,ut,vt,dt,At,jt,Ct,qt,Tt){let Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,o,l,d,m,y,v,S,T,D,L,F,N,H,q,Q,K,ae,_e,ge,be,ze,ke,je,it,ut,vt,dt,At,jt,Ct,qt,Tt)}emplace(o,l,d,m,y,v,S,T,D,L,F,N,H,q,Q,K,ae,_e,ge,be,ze,ke,je,it,ut,vt,dt,At,jt,Ct,qt,Tt,Ot){let Kt=20*o,Dt=40*o,ri=80*o;return this.float32[Kt+0]=l,this.float32[Kt+1]=d,this.int16[Dt+4]=m,this.int16[Dt+5]=y,this.int16[Dt+6]=v,this.int16[Dt+7]=S,this.int16[Dt+8]=T,this.int16[Dt+9]=D,this.int16[Dt+10]=L,this.int16[Dt+11]=F,this.int16[Dt+12]=N,this.uint16[Dt+13]=H,this.uint16[Dt+14]=q,this.uint16[Dt+15]=Q,this.uint16[Dt+16]=K,this.uint16[Dt+17]=ae,this.uint16[Dt+18]=_e,this.uint16[Dt+19]=ge,this.uint16[Dt+20]=be,this.uint16[Dt+21]=ze,this.uint16[Dt+22]=ke,this.uint16[Dt+23]=je,this.uint16[Dt+24]=it,this.uint16[Dt+25]=ut,this.uint16[Dt+26]=vt,this.uint16[Dt+27]=dt,this.uint32[Kt+14]=At,this.float32[Kt+15]=jt,this.float32[Kt+16]=Ct,this.float32[Kt+17]=qt,this.float32[Kt+18]=Tt,this.uint8[ri+76]=Ot,o}}ZP.prototype.bytesPerElement=80,tt(ZP,"StructArrayLayout2f9i15ui1ul4f1ub80");class Vv extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){let l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.float32[1*o+0]=l,o}}Vv.prototype.bytesPerElement=4,tt(Vv,"StructArrayLayout1f4");class pg extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,y){let v=this.length;return this.resize(v+1),this.emplace(v,o,l,d,m,y)}emplace(o,l,d,m,y,v){let S=5*o;return this.float32[S+0]=l,this.float32[S+1]=d,this.float32[S+2]=m,this.float32[S+3]=y,this.float32[S+4]=v,o}}pg.prototype.bytesPerElement=20,tt(pg,"StructArrayLayout5f20");class QP extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,y,v,S){let T=this.length;return this.resize(T+1),this.emplace(T,o,l,d,m,y,v,S)}emplace(o,l,d,m,y,v,S,T){let D=7*o;return this.float32[D+0]=l,this.float32[D+1]=d,this.float32[D+2]=m,this.float32[D+3]=y,this.float32[D+4]=v,this.float32[D+5]=S,this.float32[D+6]=T,o}}QP.prototype.bytesPerElement=28,tt(QP,"StructArrayLayout7f28");class KP extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,m){let y=this.length;return this.resize(y+1),this.emplace(y,o,l,d,m)}emplace(o,l,d,m,y){let v=6*o;return this.uint32[3*o+0]=l,this.uint16[v+2]=d,this.uint16[v+3]=m,this.uint16[v+4]=y,o}}KP.prototype.bytesPerElement=12,tt(KP,"StructArrayLayout1ul3ui12");class P1 extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){let l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint16[1*o+0]=l,o}}P1.prototype.bytesPerElement=2,tt(P1,"StructArrayLayout1ui2");class R1 extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l){let d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){let m=2*o;return this.float32[m+0]=l,this.float32[m+1]=d,o}}R1.prototype.bytesPerElement=8,tt(R1,"StructArrayLayout2f8");class JP extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,y,v,S,T,D,L,F,N,H,q,Q,K){let ae=this.length;return this.resize(ae+1),this.emplace(ae,o,l,d,m,y,v,S,T,D,L,F,N,H,q,Q,K)}emplace(o,l,d,m,y,v,S,T,D,L,F,N,H,q,Q,K,ae){let _e=16*o;return this.float32[_e+0]=l,this.float32[_e+1]=d,this.float32[_e+2]=m,this.float32[_e+3]=y,this.float32[_e+4]=v,this.float32[_e+5]=S,this.float32[_e+6]=T,this.float32[_e+7]=D,this.float32[_e+8]=L,this.float32[_e+9]=F,this.float32[_e+10]=N,this.float32[_e+11]=H,this.float32[_e+12]=q,this.float32[_e+13]=Q,this.float32[_e+14]=K,this.float32[_e+15]=ae,o}}JP.prototype.bytesPerElement=64,tt(JP,"StructArrayLayout16f64");class hM extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,m,y,v,S){let T=this.length;return this.resize(T+1),this.emplace(T,o,l,d,m,y,v,S)}emplace(o,l,d,m,y,v,S,T){let D=10*o,L=5*o;return this.uint16[D+0]=l,this.uint16[D+1]=d,this.uint16[D+2]=m,this.uint16[D+3]=y,this.float32[L+2]=v,this.float32[L+3]=S,this.float32[L+4]=T,o}}hM.prototype.bytesPerElement=20,tt(hM,"StructArrayLayout4ui3f20");class eR extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o){let l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.int16[1*o+0]=l,o}}eR.prototype.bytesPerElement=2,tt(eR,"StructArrayLayout1i2");class tR extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(o){let l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint8[1*o+0]=l,o}}tR.prototype.bytesPerElement=1,tt(tR,"StructArrayLayout1ub1");class I5 extends I1{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}I5.prototype.size=40;class iR extends qP{get(o){return new I5(this,o)}}tt(iR,"CollisionBoxArray");class P5 extends I1{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}P5.prototype.size=60;class R5 extends $P{get(o){return new P5(this,o)}}tt(R5,"PlacedSymbolArray");class O5 extends I1{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(o){this._structArray.uint32[this._pos4+14]=o}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(o){this._structArray.float32[this._pos4+18]=o}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}O5.prototype.size=80;class L5 extends ZP{get(o){return new O5(this,o)}}tt(L5,"SymbolInstanceArray");class z5 extends Vv{getoffsetX(o){return this.float32[1*o+0]}}tt(z5,"GlyphOffsetArray");class F5 extends uu{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}tt(F5,"SymbolLineVertexArray");class k5 extends I1{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}k5.prototype.size=12;class N5 extends KP{get(o){return new k5(this,o)}}tt(N5,"FeatureIndexArray");class B5 extends sf{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}tt(B5,"FillExtrusionCentroidArray");class U5 extends I1{get a_join_normal_inside_polygon0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside_polygon1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside_polygon2(){return this._structArray.int16[this._pos2+2]}get a_join_normal_inside_polygon3(){return this._structArray.int16[this._pos2+3]}}U5.prototype.size=8;class j5 extends Md{get(o){return new U5(this,o)}}tt(j5,"FillExtrusionWallArray");let Lre=hn([{name:"a_pos",components:2,type:"Int16"}],4),zre=hn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ss{constructor(o=[]){this.segments=o}_prepareSegment(o,l,d,m){let y=this.segments[this.segments.length-1];return o>ss.MAX_VERTEX_ARRAY_LENGTH&&Ds(`Max vertices per segment is ${ss.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!y||y.vertexLength+o>ss.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==m)&&(y={vertexOffset:l,primitiveOffset:d,vertexLength:0,primitiveLength:0},m!==void 0&&(y.sortKey=m),this.segments.push(y)),y}prepareSegment(o,l,d,m){return this._prepareSegment(o,l.length,d.length,m)}get(){return this.segments}destroy(){for(let o of this.segments)for(let l in o.vaos)o.vaos[l].destroy()}static simpleSegment(o,l,d,m){return new ss([{vertexOffset:o,primitiveOffset:l,vertexLength:d,primitiveLength:m,vaos:{},sortKey:0}])}}function V5(a,o){return 256*(a=xr(Math.floor(a),0,255))+xr(Math.floor(o),0,255)}ss.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tt(ss,"SegmentVector");let Fre=hn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),kre=hn([{name:"a_dash",components:4,type:"Uint16"}]);class O1{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(o,l,d,m){this.ids.push(G5(o)),this.positions.push(l,d,m)}eachPosition(o,l){let d=G5(o),m=0,y=this.ids.length-1;for(;m<y;){let v=m+y>>1;this.ids[v]>=d?y=v:m=v+1}for(;this.ids[m]===d;)l(this.positions[3*m],this.positions[3*m+1],this.positions[3*m+2]),m++}static serialize(o,l){let d=new Float64Array(o.ids),m=new Uint32Array(o.positions);return rR(d,m,0,d.length-1),l&&(l.add(d.buffer),l.add(m.buffer)),{ids:d,positions:m}}static deserialize(o){let l=new O1,d;l.ids=o.ids,l.positions=o.positions;for(let m of l.ids)m!==d&&l.uniqueIds.push(m),d=m;return l.indexed=!0,l}}function G5(a){let o=+a;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:mv(String(a))}function rR(a,o,l,d){for(;l<d;){let m=a[l+d>>1],y=l-1,v=d+1;for(;;){do y++;while(a[y]<m);do v--;while(a[v]>m);if(y>=v)break;dM(a,y,v),dM(o,3*y,3*v),dM(o,3*y+1,3*v+1),dM(o,3*y+2,3*v+2)}v-l<d-v?(rR(a,o,l,v),l=v+1):(rR(a,o,v+1,d),d=v)}}function dM(a,o,l){let d=a[o];a[o]=a[l],a[l]=d}tt(O1,"FeaturePositionMap");class Td{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,l),this.initialized=!0),!!this.location}set(o,l,d){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class pM extends Td{constructor(o){super(o),this.current=0}set(o,l,d){this.fetchUniformLocation(o,l)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}}class ka extends Td{constructor(o){super(o),this.current=0}set(o,l,d){this.fetchUniformLocation(o,l)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class Ad extends Td{constructor(o){super(o),this.current=[0,0]}set(o,l,d){this.fetchUniformLocation(o,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}}class nR extends Td{constructor(o){super(o),this.current=[0,0,0]}set(o,l,d){this.fetchUniformLocation(o,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}}class sR extends Td{constructor(o){super(o),this.current=[0,0,0,0]}set(o,l,d){this.fetchUniformLocation(o,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class H5 extends Td{constructor(o){super(o),this.current=en.transparent.toRenderColor(null)}set(o,l,d){this.fetchUniformLocation(o,l)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}let Nre=new Float32Array(16);class L1 extends Td{constructor(o){super(o),this.current=Nre}set(o,l,d){if(this.fetchUniformLocation(o,l)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let m=1;m<16;m++)if(d[m]!==this.current[m]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}}let Bre=new Float32Array(9),Ure=new Float32Array(4);class oR extends Td{constructor(o){super(o),this.current=Ure}set(o,l,d){if(this.fetchUniformLocation(o,l)){for(let m=0;m<4;m++)if(d[m]!==this.current[m]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}}function aR(a){return[V5(255*a.r,255*a.g),V5(255*a.b,255*a.a)]}class z1{constructor(o,l,d,m){this.value=o,this.uniformNames=l.map(y=>`u_${y}`),this.type=d,this.context=m}setUniform(o,l,d,m,y){let v=m.constantOr(this.value);l.set(o,y,v instanceof en?v.toRenderColor(this.context.lut):v)}getBinding(o,l){return this.type==="color"?new H5(o):new ka(o)}}class Gv{constructor(o,l){this.uniformNames=l.map(d=>`u_${d}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,l,d,m,y){let v=y==="u_pattern"||y==="u_dash"?this.pattern:y==="u_pixel_ratio"?this.pixelRatio:null;v&&l.set(o,y,v)}getBinding(o,l){return l==="u_pattern"||l==="u_dash"?new sR(o):new ka(o)}}class Cd{constructor(o,l,d,m){this.expression=o,this.type=d,this.maxValue=0,this.paintVertexAttributes=l.map(y=>({name:`a_${y}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(o,l,d,m,y,v,S){let T=this.paintVertexArray.length,D=this.expression.evaluate(new er(0,{brightness:v}),l,{},y,m,S);this.paintVertexArray.resize(o),this._setPaintValue(T,o,D,this.context)}updatePaintArray(o,l,d,m,y,v,S){let T=this.expression.evaluate({zoom:0,brightness:S},d,m,void 0,y);this._setPaintValue(o,l,T,this.context)}_setPaintValue(o,l,d,m){if(this.type==="color"){let y=aR(d.toRenderColor(m.lut));for(let v=o;v<l;v++)this.paintVertexArray.emplace(v,y[0],y[1])}else{for(let y=o;y<l;y++)this.paintVertexArray.emplace(y,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class hu{constructor(o,l,d,m,y,v){this.expression=o,this.uniformNames=l.map(S=>`u_${S}_t`),this.type=d,this.useIntegerZoom=m,this.context=y,this.maxValue=0,this.paintVertexAttributes=l.map(S=>({name:`a_${S}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(o,l,d,m,y,v,S){let T=this.expression.evaluate(new er(this.context.zoom,{brightness:v}),l,{},y,m,S),D=this.expression.evaluate(new er(this.context.zoom+1,{brightness:v}),l,{},y,m,S),L=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(L,o,T,D,this.context)}updatePaintArray(o,l,d,m,y,v,S){let T=this.expression.evaluate({zoom:this.context.zoom,brightness:S},d,m,void 0,y),D=this.expression.evaluate({zoom:this.context.zoom+1,brightness:S},d,m,void 0,y);this._setPaintValue(o,l,T,D,this.context)}_setPaintValue(o,l,d,m,y){if(this.type==="color"){let v=aR(d.toRenderColor(y.lut)),S=aR(d.toRenderColor(y.lut));for(let T=o;T<l;T++)this.paintVertexArray.emplace(T,v[0],v[1],S[0],S[1])}else{for(let v=o;v<l;v++)this.paintVertexArray.emplace(v,d,m);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(m))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,l,d,m,y){let v=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,S=xr(this.expression.interpolationFactor(v,this.context.zoom,this.context.zoom+1),0,1);l.set(o,y,S)}getBinding(o,l){return new ka(o)}}class of{constructor(o,l,d,m,y){this.expression=o,this.layerId=y,this.paintVertexAttributes=(d==="array"?kre:Fre).members;for(let v=0;v<l.length;++v);this.paintVertexArray=new m}populatePaintArray(o,l,d,m){let y=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(y,o,l.patterns&&l.patterns[this.layerId],d)}updatePaintArray(o,l,d,m,y,v,S){this._setPaintValues(o,l,d.patterns&&d.patterns[this.layerId],v)}_setPaintValues(o,l,d,m){if(!m||!d)return;let y=m[d];if(!y)return;let{tl:v,br:S,pixelRatio:T}=y;for(let D=o;D<l;D++)this.paintVertexArray.emplace(D,v[0],v[1],S[0],S[1],T)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fg{constructor(o,l,d=()=>!0){this.binders={},this._buffers=[],this.context=l;let m=[];for(let y in o.paint._values){let v=o.paint.get(y);if(!d(y)||!(v instanceof no&&R(v.property.specification)))continue;let S=Vre(y,o.type),T=v.value,D=v.property.specification.type,L=!!v.property.useIntegerZoom,F=y==="line-dasharray"||y.endsWith("pattern"),N=y==="line-dasharray"&&o.layout.get("line-cap").value.kind!=="constant";if(T.kind!=="constant"||N)if(T.kind==="source"||N||F){let H=W5(y,D,"source");this.binders[y]=F?new of(T,S,D,H,o.id):new Cd(T,S,D,H),m.push(`/a_${y}`)}else{let H=W5(y,D,"composite");this.binders[y]=new hu(T,S,D,L,l,H),m.push(`/z_${y}`)}else this.binders[y]=F?new Gv(T.value,S):new z1(T.value,S,D,l),m.push(`/u_${y}`)}this.cacheKey=m.sort().join("")}getMaxValue(o){let l=this.binders[o];return l instanceof Cd||l instanceof hu?l.maxValue:0}populatePaintArrays(o,l,d,m,y,v,S){for(let T in this.binders){let D=this.binders[T];D.context=this.context,(D instanceof Cd||D instanceof hu||D instanceof of)&&D.populatePaintArray(o,l,d,m,y,v,S)}}setConstantPatternPositions(o){for(let l in this.binders){let d=this.binders[l];d instanceof Gv&&d.setConstantPatternPositions(o)}}updatePaintArrays(o,l,d,m,y,v,S,T){let D=!1,L=Object.keys(o),F=L.length!==0,N=F?L:l.uniqueIds;this.context.lut=y.lut;for(let H in this.binders){let q=this.binders[H];if(q.context=this.context,(q instanceof Cd||q instanceof hu||q instanceof of)&&(q.expression.isStateDependent===!0||q.expression.isLightConstant===!1)){let Q=y.paint.get(H);q.expression=Q.value;for(let K of N){let ae=o[K.toString()];l.eachPosition(K,(_e,ge,be)=>{let ze=m.feature(_e);q.updatePaintArray(ge,be,ze,ae,v,S,T)})}if(!F)for(let K of d.uniqueIds){let ae=o[K.toString()];d.eachPosition(K,(_e,ge,be)=>{let ze=m.feature(_e);q.updatePaintArray(ge,be,ze,ae,v,S,T)})}D=!0}}return D}defines(){let o=[];for(let l in this.binders){let d=this.binders[l];(d instanceof z1||d instanceof Gv)&&o.push(...d.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return o}getBinderAttributes(){let o=[];for(let l in this.binders){let d=this.binders[l];if(d instanceof Cd||d instanceof hu||d instanceof of)for(let m=0;m<d.paintVertexAttributes.length;m++)o.push(d.paintVertexAttributes[m].name)}return o}getBinderUniforms(){let o=[];for(let l in this.binders){let d=this.binders[l];if(d instanceof z1||d instanceof Gv||d instanceof hu)for(let m of d.uniformNames)o.push(m)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){let l=[];for(let d in this.binders){let m=this.binders[d];if(m instanceof z1||m instanceof Gv||m instanceof hu)for(let y of m.uniformNames)l.push({name:y,property:d,binding:m.getBinding(o,y)})}return l}setUniforms(o,l,d,m,y){for(let{name:v,property:S,binding:T}of d)this.binders[S].setUniform(o,T,y,m.get(S),v)}updatePaintBuffers(){this._buffers=[];for(let o in this.binders){let l=this.binders[o];(l instanceof Cd||l instanceof hu||l instanceof of)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(o){for(let l in this.binders){let d=this.binders[l];(d instanceof Cd||d instanceof hu||d instanceof of)&&d.upload(o)}this.updatePaintBuffers()}destroy(){for(let o in this.binders){let l=this.binders[o];(l instanceof Cd||l instanceof hu||l instanceof of)&&l.destroy()}}}class af{constructor(o,l,d=()=>!0){this.programConfigurations={};for(let m of o)this.programConfigurations[m.id]=new fg(m,l,d);this.needsUpload=!1,this._featureMap=new O1,this._featureMapWithoutIds=new O1,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(o,l,d,m,y,v,S,T){for(let D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(o,l,m,y,v,S,T);l.id!==void 0?this._featureMap.add(l.id,d,this._bufferOffset,o):(this._featureMapWithoutIds.add(this._idlessCounter,d,this._bufferOffset,o),this._idlessCounter+=1),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,l,d,m,y,v){for(let S of d)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(o,this._featureMap,this._featureMapWithoutIds,l,S,m,y,v||0)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(let l in this.programConfigurations)this.programConfigurations[l].upload(o);this.needsUpload=!1}}destroy(){for(let o in this.programConfigurations)this.programConfigurations[o].destroy()}}let jre={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Vre(a,o){return jre[a]||[a.replace(`${o}-`,"").replace(/-/g,"_")]}let Gre={"line-pattern":{source:nf,composite:nf},"fill-pattern":{source:nf,composite:nf},"fill-extrusion-pattern":{source:nf,composite:nf},"line-dasharray":{source:lM,composite:lM}},Hre={color:{source:R1,composite:tf},number:{source:Vv,composite:R1}};function W5(a,o,l){let d=Gre[a];return d&&d[l]||Hre[o][l]}tt(z1,"ConstantBinder"),tt(Gv,"PatternConstantBinder"),tt(Cd,"SourceExpressionBinder"),tt(of,"PatternCompositeBinder"),tt(hu,"CompositeExpressionBinder"),tt(fg,"ProgramConfiguration",{omit:["_buffers"]}),tt(af,"ProgramConfigurationSet");let Na=ti/Math.PI/2,lR=5,q5=6,Wre=16383,Hv=64,cR=[Hv,32,16],Ac=-Na,Cc=Na;function Wv(a,o,l,d=Na){return l=Rr(l),[a*Math.sin(l)*d,-o*d,a*Math.cos(l)*d]}function mg(a,o,l){return Wv(Math.cos(Rr(a)),Math.sin(Rr(a)),o,l)}let qv=63710088e-1,uR=2*Math.PI*qv;class Kr{constructor(o,l){if(isNaN(o)||isNaN(l))throw new Error(`Invalid LngLat object: (${o}, ${l})`);if(this.lng=+o,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Kr(Fp(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){let l=Math.PI/180,d=this.lat*l,m=o.lat*l,y=Math.sin(d)*Math.sin(m)+Math.cos(d)*Math.cos(m)*Math.cos((o.lng-this.lng)*l);return qv*Math.acos(Math.min(y,1))}toBounds(o=0){let l=360*o/40075017,d=l/Math.cos(Math.PI/180*this.lat);return new lf({lng:this.lng-d,lat:this.lat-l},{lng:this.lng+d,lat:this.lat+l})}toEcef(o){return mg(this.lat,this.lng,Na+o*Na/qv)}static convert(o){if(o instanceof Kr)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new Kr(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new Kr(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class lf{constructor(o,l){if(o)if(l)this.setSouthWest(o).setNorthEast(l);else if(o.length===4){let d=o;this.setSouthWest([d[0],d[1]]).setNorthEast([d[2],d[3]])}else{let d=o;this.setSouthWest(d[0]).setNorthEast(d[1])}}setNorthEast(o){return this._ne=o instanceof Kr?new Kr(o.lng,o.lat):Kr.convert(o),this}setSouthWest(o){return this._sw=o instanceof Kr?new Kr(o.lng,o.lat):Kr.convert(o),this}extend(o){let l=this._sw,d=this._ne,m,y;if(o instanceof Kr)m=o,y=o;else{if(!(o instanceof lf))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(lf.convert(o)):this.extend(Kr.convert(o)):typeof o=="object"&&o!==null&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(Kr.convert(o)):this;if(m=o._sw,y=o._ne,!m||!y)return this}return l||d?(l.lng=Math.min(m.lng,l.lng),l.lat=Math.min(m.lat,l.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new Kr(m.lng,m.lat),this._ne=new Kr(y.lng,y.lat)),this}getCenter(){return new Kr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Kr(this.getWest(),this.getNorth())}getSouthEast(){return new Kr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){let{lng:l,lat:d}=Kr.convert(o),m=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&m}static convert(o){return!o||o instanceof lf?o:new lf(o)}}var Y5={};(function(a,o){(function(l){function d(y,v,S){var T=m(256*y,256*(v=Math.pow(2,S)-v-1),S),D=m(256*(y+1),256*(v+1),S);return T[0]+","+T[1]+","+D[0]+","+D[1]}function m(y,v,S){var T=2*Math.PI*6378137/256/Math.pow(2,S);return[y*T-2*Math.PI*6378137/2,v*T-2*Math.PI*6378137/2]}l.getURL=function(y,v,S,T,D,L){return L=L||{},y+"?"+["bbox="+d(S,T,D),"format="+(L.format||"image/png"),"service="+(L.service||"WMS"),"version="+(L.version||"1.1.1"),"request="+(L.request||"GetMap"),"srs="+(L.srs||"EPSG:3857"),"width="+(L.width||256),"height="+(L.height||256),"layers="+v].join("&")},l.getTileBBox=d,l.getMercCoords=m,Object.defineProperty(l,"__esModule",{value:!0})})(o)})(0,Y5);var qre=Y5;class gg{constructor(o,l,d){this.z=o,this.x=l,this.y=d,this.key=Yv(0,o,o,l,d)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,l){let d=qre.getTileBBox(this.x,this.y,this.z),m=function(y,v,S){let T,D="";for(let L=y;L>0;L--)T=1<<L-1,D+=(v&T?1:0)+(S&T?2:0);return D}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class X5{constructor(o,l){this.wrap=o,this.canonical=l,this.key=Yv(o,l.z,l.z,l.x,l.y)}}class Ws{constructor(o,l,d,m,y){this.overscaledZ=o,this.wrap=l,this.canonical=new gg(d,+m,+y),this.key=l===0&&o===d?this.canonical.key:Yv(l,o,d,m,y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){let l=this.canonical.z-o;return o>this.canonical.z?new Ws(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ws(o,this.wrap,o,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(o,l=!0){if(this.overscaledZ===o&&l)return this.key;if(o>this.canonical.z)return Yv(this.wrap*+l,o,this.canonical.z,this.canonical.x,this.canonical.y);{let d=this.canonical.z-o;return Yv(this.wrap*+l,o,o,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;let l=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.z<this.canonical.z&&o.canonical.x===this.canonical.x>>l&&o.canonical.y===this.canonical.y>>l}children(o){if(this.overscaledZ>=o)return[new Ws(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let l=this.canonical.z+1,d=2*this.canonical.x,m=2*this.canonical.y;return[new Ws(l,this.wrap,l,d,m),new Ws(l,this.wrap,l,d+1,m),new Ws(l,this.wrap,l,d,m+1),new Ws(l,this.wrap,l,d+1,m+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Ws(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Ws(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new X5(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Yv(a,o,l,d,m){let y=1<<Math.min(l,22),v=y*(m%y)+d%y;return a&&l<22&&(v+=y*y*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*v+l)+(o-l)}let Yre=[a=>{let o=a.canonical.x-1,l=a.wrap;return o<0&&(o=(1<<a.canonical.z)-1,l--),new Ws(a.overscaledZ,l,a.canonical.z,o,a.canonical.y)},a=>{let o=a.canonical.x+1,l=a.wrap;return o===1<<a.canonical.z&&(o=0,l++),new Ws(a.overscaledZ,l,a.canonical.z,o,a.canonical.y)},a=>new Ws(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new Ws(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];tt(gg,"CanonicalTileID"),tt(Ws,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let Xre=0,$re=25.5;function hR(a){return uR*Math.cos(a*Math.PI/180)}function ph(a){return(180+a)/360}function fh(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Ba(a,o){return a/hR(o)}function ol(a){return 360*a-180}function _o(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function $5(a,o){return a*hR(_o(o))}let Rs=85.051129;function Z5(a){return Math.cos(Rr(xr(a,-Rs,Rs)))}function yg(a,o){let l=xr(o,Xre,$re),d=Math.pow(2,l);return Z5(a)*uR/(512*d)}function Q5(a){return 1/Math.cos(a*Math.PI/180)}function fM(a,o=0){let l=Math.exp(Math.PI*(1-(a.y+o/ti)/(1<<a.z)*2));return 80150034*l/(l*l+1)/ti/(1<<a.z)}class ia{constructor(o,l,d=0){this.x=+o,this.y=+l,this.z=+d}static fromLngLat(o,l=0){let d=Kr.convert(o);return new ia(ph(d.lng),fh(d.lat),Ba(l,d.lat))}toLngLat(){return new Kr(ol(this.x),_o(this.y))}toAltitude(){return $5(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/uR*Q5(_o(this.y))}}function dR(a,o,l,d,m,y,v,S,T){let D=(o+d)/2,L=(l+m)/2,F=new ai(D,L);S(F),function(N,H,q,Q,K,ae){let _e=q-K,ge=Q-ae;return Math.abs((Q-H)*_e-(q-N)*ge)/Math.hypot(_e,ge)}(F.x,F.y,y.x,y.y,v.x,v.y)>=T?(dR(a,o,l,D,L,y,F,S,T),dR(a,D,L,d,m,F,v,S,T)):a.push(v)}function K5(a,o,l){let d=a[0],m=d.x,y=d.y;o(d);let v=[d];for(let S=1;S<a.length;S++){let T=a[S],{x:D,y:L}=T;o(T),dR(v,m,y,D,L,d,T,o,l),m=D,y=L,d=T}return v}function pR(a,o,l,d){if(d(o,l)){let m=o.add(l)._mult(.5);pR(a,o,m,d),pR(a,m,l,d)}else a.push(l)}function Zre(a,o){let l=a[0],d=[l];for(let m=1;m<a.length;m++){let y=a[m];pR(d,l,y,o),l=y}return d}let fR=Math.pow(2,14)-1,J5=-fR-1;function Qre(a,o){let l=Math.round(a.x*o),d=Math.round(a.y*o);return a.x=xr(l,J5,fR),a.y=xr(d,J5,fR),(l<a.x||l>a.x+1||d<a.y||d>a.y+1)&&Ds("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function du(a,o,l){let d=a.loadGeometry(),m=a.extent,y=ti/m;if(o&&l&&l.projection.isReprojectedInTileSpace){let v=1<<o.z,{scale:S,x:T,y:D,projection:L}=l,F=N=>{let H=ol((o.x+N.x/m)/v),q=_o((o.y+N.y/m)/v),Q=L.project(H,q);N.x=(Q.x*S-T)*m,N.y=(Q.y*S-D)*m};for(let N=0;N<d.length;N++)if(a.type!==1)d[N]=K5(d[N],F,1);else{let H=[];for(let q of d[N])q.x<0||q.x>=m||q.y<0||q.y>=m||(F(q),H.push(q));d[N]=H}}for(let v of d)for(let S of v)Qre(S,y);return d}function Dd(a,o){return{type:a.type,id:a.id,properties:a.properties,geometry:o?du(a):[]}}function mM(a,o,l,d,m){a.emplaceBack(2*o+(d+1)/2,2*l+(m+1)/2)}function gM(a,o,l){a.emplaceBack(o.x,o.y,o.z,l[0]*16384,l[1]*16384,l[2]*16384)}class mR{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new uu,this.indexArray=new so,this.segments=new ss,this.programConfigurations=new af(o.layers,{zoom:o.zoom,lut:o.lut}),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}updateFootprints(o,l){}populate(o,l,d,m){let y=this.layers[0],v=[],S=null;y.type==="circle"&&(S=y.layout.get("circle-sort-key"));for(let{feature:D,id:L,index:F,sourceLayerIndex:N}of o){let H=this.layers[0]._featureFilter.needGeometry,q=Dd(D,H);if(!this.layers[0]._featureFilter.filter(new er(this.zoom),q,d))continue;let Q=S?S.evaluate(q,{},d):void 0,K={id:L,properties:D.properties,type:D.type,sourceLayerIndex:N,index:F,geometry:H?q.geometry:du(D,d,m),patterns:{},sortKey:Q};v.push(K)}S&&v.sort((D,L)=>D.sortKey-L.sortKey);let T=null;m.projection.name==="globe"&&(this.globeExtVertexArray=new cM,T=m.projection);for(let D of v){let{geometry:L,index:F,sourceLayerIndex:N}=D,H=o[F].feature;this.addFeature(D,L,F,l.availableImages,d,T,l.brightness),l.featureIndex.insert(H,L,F,N,this.index)}}update(o,l,d,m,y){let v=Object.keys(o).length!==0;v&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(o,l,v?this.stateDependentLayers:this.layers,d,m,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Lre.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,zre.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,l,d,m,y,v,S){for(let T of l)for(let D of T){let L=D.x,F=D.y;if(L<0||L>=ti||F<0||F>=ti)continue;if(v){let q=v.projectTilePoint(L,F,y),Q=v.upVector(y,L,F),K=this.globeExtVertexArray;gM(K,q,Q),gM(K,q,Q),gM(K,q,Q),gM(K,q,Q)}let N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),H=N.vertexLength;mM(this.layoutVertexArray,L,F,-1,-1),mM(this.layoutVertexArray,L,F,1,-1),mM(this.layoutVertexArray,L,F,1,1),mM(this.layoutVertexArray,L,F,-1,1),this.indexArray.emplaceBack(H,H+1,H+2),this.indexArray.emplaceBack(H,H+2,H+3),N.vertexLength+=4,N.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,{},m,y,S)}}function gR(a,o){for(let l=0;l<a.length;l++)if(cf(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(cf(a,o[l]))return!0;return!!yR(a,o)}function Kre(a,o,l){return!!cf(a,o)||!!vR(o,a,l)}function ej(a,o){if(a.length===1)return ij(o,a[0]);for(let l=0;l<o.length;l++){let d=o[l];for(let m=0;m<d.length;m++)if(cf(a,d[m]))return!0}for(let l=0;l<a.length;l++)if(ij(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(yR(a,o[l]))return!0;return!1}function Jre(a,o,l){if(a.length>1){if(yR(a,o))return!0;for(let d=0;d<o.length;d++)if(vR(o[d],a,l))return!0}for(let d=0;d<a.length;d++)if(vR(a[d],o,l))return!0;return!1}function yR(a,o){if(a.length===0||o.length===0)return!1;for(let l=0;l<a.length-1;l++){let d=a[l],m=a[l+1];for(let y=0;y<o.length-1;y++)if(ene(d,m,o[y],o[y+1]))return!0}return!1}function ene(a,o,l,d){return rh(a,l,d)!==rh(o,l,d)&&rh(a,o,l)!==rh(a,o,d)}function vR(a,o,l){let d=l*l;if(o.length===1)return a.distSqr(o[0])<d;for(let m=1;m<o.length;m++)if(tj(a,o[m-1],o[m])<d)return!0;return!1}function tj(a,o,l){let d=o.distSqr(l);if(d===0)return a.distSqr(o);let m=((a.x-o.x)*(l.x-o.x)+(a.y-o.y)*(l.y-o.y))/d;return a.distSqr(m<0?o:m>1?l:l.sub(o)._mult(m)._add(o))}function ij(a,o){let l,d,m,y=!1;for(let v=0;v<a.length;v++){l=a[v];for(let S=0,T=l.length-1;S<l.length;T=S++)d=l[S],m=l[T],d.y>o.y!=m.y>o.y&&o.x<(m.x-d.x)*(o.y-d.y)/(m.y-d.y)+d.x&&(y=!y)}return y}function cf(a,o){let l=!1;for(let d=0,m=a.length-1;d<a.length;m=d++){let y=a[d],v=a[m];y.y>o.y!=v.y>o.y&&o.x<(v.x-y.x)*(o.y-y.y)/(v.y-y.y)+y.x&&(l=!l)}return l}function rj(a,o,l,d,m){for(let v of a)if(o<=v.x&&l<=v.y&&d>=v.x&&m>=v.y)return!0;let y=[new ai(o,l),new ai(o,m),new ai(d,m),new ai(d,l)];if(a.length>2){for(let v of y)if(cf(a,v))return!0}for(let v=0;v<a.length-1;v++)if(tne(a[v],a[v+1],y))return!0;return!1}function tne(a,o,l){let d=l[0],m=l[2];if(a.x<d.x&&o.x<d.x||a.x>m.x&&o.x>m.x||a.y<d.y&&o.y<d.y||a.y>m.y&&o.y>m.y)return!1;let y=rh(a,o,l[0]);return y!==rh(a,o,l[1])||y!==rh(a,o,l[2])||y!==rh(a,o,l[3])}function Xv(a,o,l,d,m,y){let v=o.y-a.y,S=a.x-o.x;if(y=y||0){let T=v*v+S*S;if(T===0)return!0;let D=Math.sqrt(T);v/=D,S/=D}return!((l.x-a.x)*v+(l.y-a.y)*S-y<0||(d.x-a.x)*v+(d.y-a.y)*S-y<0||(m.x-a.x)*v+(m.y-a.y)*S-y<0)}function _R(a,o,l,d,m,y,v){return!(Xv(a,o,d,m,y,v)||Xv(o,l,d,m,y,v)||Xv(l,a,d,m,y,v)||Xv(d,m,a,o,l,v)||Xv(m,y,a,o,l,v)||Xv(y,d,a,o,l,v))}function $v(a,o,l){let d=o.paint.get(a).value;return d.kind==="constant"?d.value:l.programConfigurations.get(o.id).getMaxValue(a)}function yM(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function nj(a,o,l,d,m){if(!o[0]&&!o[1])return a;let y=ai.convert(o)._mult(m);l==="viewport"&&y._rotate(-d);let v=[];for(let S=0;S<a.length;S++)v.push(a[S].sub(y));return v}function sj(a,o,l,d){let m=ai.convert(a)._mult(d);return o==="viewport"&&m._rotate(-l),m}let oj,aj;tt(mR,"CircleBucket",{omit:["layers"]});class xR{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,d){let m=n.$.dot(l,this.dir);if(Math.abs(m)<1e-6)return!1;let y=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1]+(o[2]-this.pos[2])*l[2])/m;return d[0]=this.pos[0]+this.dir[0]*y,d[1]=this.pos[1]+this.dir[1]*y,d[2]=this.pos[2]+this.dir[2]*y,!0}closestPointOnSphere(o,l,d){if(n.$.equals(this.pos,o)||l===0)return d[0]=d[1]=d[2]=0,!1;let[m,y,v]=this.dir,S=this.pos[0]-o[0],T=this.pos[1]-o[1],D=this.pos[2]-o[2],L=m*m+y*y+v*v,F=2*(S*m+T*y+D*v),N=F*F-4*L*(S*S+T*T+D*D-l*l);if(N<0){let H=Math.max(-F/2,0),q=S+m*H,Q=T+y*H,K=D+v*H,ae=Math.hypot(q,Q,K);return d[0]=q*l/ae,d[1]=Q*l/ae,d[2]=K*l/ae,!1}{let H=(-F-Math.sqrt(N))/(2*L);if(H<0){let q=Math.hypot(S,T,D);return d[0]=S*l/q,d[1]=T*l/q,d[2]=D*l/q,!1}return d[0]=S+m*H,d[1]=T+y*H,d[2]=D+v*H,!0}}}class bR{constructor(o,l,d,m,y){this.TL=o,this.TR=l,this.BR=d,this.BL=m,this.horizon=y}static fromInvProjectionMatrix(o,l,d){let m=[-1,1,1],y=[1,1,1],v=[1,-1,1],S=[-1,-1,1],T=n.$.transformMat4(m,m,o),D=n.$.transformMat4(y,y,o),L=n.$.transformMat4(v,v,o),F=n.$.transformMat4(S,S,o);return new bR(T,D,L,F,l/d)}}function F1(a,o,l){let d=1/0,m=-1/0,y=[];for(let v of a){n.$.sub(y,v,o);let S=n.$.dot(y,l);d=Math.min(d,S),m=Math.max(m,S)}return[d,m]}function lj(a,o){let l=!0;for(let d=0;d<a.planes.length;d++){let m=a.planes[d],y=0;for(let v=0;v<o.length;v++)y+=n.$.dot(m,o[v])+m[3]>=0;if(y===0)return 0;y!==o.length&&(l=!1)}return l?2:1}function cj(a,o){for(let l of a.projections){let d=F1(o,a.points[0],l.axis);if(l.projection[1]<d[0]||l.projection[0]>d[1])return 0}return 1}function uj(a,o){let l=0,d=[0,0,0,0];for(let m=0;m<a.length;m++)d[0]=a[m][0],d[1]=a[m][1],d[2]=a[m][2],d[3]=1,n.aB.dot(d,o)>=0&&l++;return l}class wR{constructor(o,l){this.points=o||new Array(8).fill([0,0,0]),this.planes=l||new Array(6).fill([0,0,0,0]),this.bounds=Jn.fromPoints(this.points),this.projections=[],this.frustumEdges=[n.$.sub([],this.points[2],this.points[3]),n.$.sub([],this.points[0],this.points[3]),n.$.sub([],this.points[4],this.points[0]),n.$.sub([],this.points[5],this.points[1]),n.$.sub([],this.points[6],this.points[2]),n.$.sub([],this.points[7],this.points[3])];for(let d of this.frustumEdges){let m=[0,-d[2],d[1]],y=[d[2],0,-d[0]];this.projections.push({axis:m,projection:F1(this.points,this.points[0],m)}),this.projections.push({axis:y,projection:F1(this.points,this.points[0],y)})}}static fromInvProjectionMatrix(o,l,d,m){let y=Math.pow(2,d),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{let L=n.aB.transformMat4([],D,o),F=1/L[3]/l*y;return n.aB.mul(L,L,[F,F,m?1/L[3]:F,F])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{let L=n.$.sub([],v[D[0]],v[D[1]]),F=n.$.sub([],v[D[2]],v[D[1]]),N=n.$.normalize([],n.$.cross([],L,F)),H=-n.$.dot(N,v[D[1]]);return N.concat(H)}),T=[];for(let D=0;D<v.length;D++)T.push([v[D][0],v[D][1],v[D][2]]);return new wR(T,S)}intersectsPrecise(o,l,d){for(let m=0;m<l.length;m++)if(!uj(o,l[m]))return 0;for(let m=0;m<this.planes.length;m++)if(!uj(o,this.planes[m]))return 0;for(let m of d)for(let y of this.frustumEdges){let v=n.$.cross([],m,y),S=n.$.length(v);if(S===0)continue;n.$.scale(v,v,1/S);let T=F1(this.points,this.points[0],v),D=F1(o,this.points[0],v);if(T[0]>D[1]||D[0]>T[1])return 0}return 1}containsPoint(o){for(let l of this.planes){let d=l[3];if(n.$.dot([l[0],l[1],l[2]],o)+d<0)return!1}return!0}}class Jn{static fromPoints(o){let l=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(let m of o)n.$.min(l,l,m),n.$.max(d,d,m);return new Jn(l,d)}static fromTileIdAndHeight(o,l,d){let m=1<<o.canonical.z,y=o.canonical.x,v=o.canonical.y;return new Jn([y/m,v/m,l],[(y+1)/m,(v+1)/m,d])}static applyTransform(o,l){let d=o.getCorners();for(let m=0;m<d.length;++m)n.$.transformMat4(d[m],d[m],l);return Jn.fromPoints(d)}static applyTransformFast(o,l){let d=[l[12],l[13],l[14]],m=[...d];for(let y=0;y<3;y++)for(let v=0;v<3;v++){let S=l[4*v+y],T=S*o.min[v],D=S*o.max[v];d[y]+=Math.min(T,D),m[y]+=Math.max(T,D)}return new Jn(d,m)}static projectAabbCorners(o,l){let d=o.getCorners();for(let m=0;m<d.length;++m)n.$.transformMat4(d[m],d[m],l);return d}constructor(o,l){this.min=o,this.max=l,this.center=n.$.scale([],n.$.add([],this.min,this.max),.5)}quadrant(o){let l=[o%2==0,o<2],d=n.$.clone(this.min),m=n.$.clone(this.max);for(let y=0;y<l.length;y++)d[y]=l[y]?this.min[y]:this.center[y],m[y]=l[y]?this.center[y]:this.max[y];return m[2]=this.max[2],new Jn(d,m)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){let o=this.min,l=this.max;return[[o[0],o[1],o[2]],[l[0],o[1],o[2]],[l[0],l[1],o[2]],[o[0],l[1],o[2]],[o[0],o[1],l[2]],[l[0],o[1],l[2]],[l[0],l[1],l[2]],[o[0],l[1],l[2]]]}intersects(o){return this.intersectsAabb(o.bounds)?lj(o,this.getCorners()):0}intersectsFlat(o){return this.intersectsAabb(o.bounds)?lj(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(o,l){return l||this.intersects(o)?cj(o,this.getCorners()):0}intersectsPreciseFlat(o,l){return l||this.intersectsFlat(o)?cj(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(o){for(let l=0;l<3;++l)if(this.min[l]>o.max[l]||o.min[l]>this.max[l])return!1;return!0}intersectsAabbXY(o){return!(this.min[0]>o.max[0]||o.min[0]>this.max[0]||this.min[1]>o.max[1]||o.min[1]>this.max[1])}encapsulate(o){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],o.min[l]),this.max[l]=Math.max(this.max[l],o.max[l])}encapsulatePoint(o){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],o[l]),this.max[l]=Math.max(this.max[l],o[l])}closestPoint(o){return[Math.max(Math.min(this.max[0],o[0]),this.min[0]),Math.max(Math.min(this.max[1],o[1]),this.min[1]),Math.max(Math.min(this.max[2],o[2]),this.min[2])]}}tt(Jn,"Aabb");let ine=hn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:vM}=ine,hj=hn([{name:"a_pos_3",components:3,type:"Int16"}]);var k1=hn([{name:"a_pos",type:"Int16",components:2}]);function _M(a){return a*Na/qv}let rne=[new Jn([Ac,Ac,Ac],[Cc,Cc,Cc]),new Jn([Ac,Ac,Ac],[0,0,Cc]),new Jn([0,Ac,Ac],[Cc,0,Cc]),new Jn([Ac,0,Ac],[0,Cc,Cc]),new Jn([0,0,Ac],[Cc,Cc,Cc])];function dj(a,o,l,d=!0){let m=n.$.scale([],a._camera.position,a.worldSize),y=[o,l,1,1];n.aB.transformMat4(y,y,a.pixelMatrixInverse),n.aB.scale(y,y,1/y[3]);let v=n.$.sub([],y,m),S=n.$.normalize([],v),T=a.globeMatrix,D=[T[12],T[13],T[14]],L=n.$.sub([],D,m),F=n.$.length(L),N=n.$.normalize([],L),H=a.worldSize/(2*Math.PI),q=n.$.dot(N,S),Q=Math.asin(H/F);if(Q<Math.acos(q)){if(!d)return null;let dt=[],At=[];n.$.scale(dt,S,F/q),n.$.normalize(At,n.$.sub(At,dt,L)),n.$.normalize(S,n.$.add(S,L,n.$.scale(S,At,Math.tan(Q)*F)))}let K=[];new xR(m,S).closestPointOnSphere(D,H,K);let ae=n.$.normalize([],oh(T,0)),_e=n.$.normalize([],oh(T,1)),ge=n.$.normalize([],oh(T,2)),be=n.$.dot(ae,K),ze=n.$.dot(_e,K),ke=n.$.dot(ge,K),je=xa(Math.asin(-ze/H)),it=xa(Math.atan2(be,ke));it=a.center.lng+function(dt,At){let jt=(At-dt+180)%360-180;return jt<-180?jt+360:jt}(a.center.lng,it);let ut=ph(it),vt=xr(fh(je),0,1);return new ia(ut,vt)}class nne{constructor(o,l,d){this.a=n.$.sub([],o,d),this.b=n.$.sub([],l,d),this.center=d;let m=n.$.normalize([],this.a),y=n.$.normalize([],this.b);this.angle=Math.acos(n.$.dot(m,y))}}function SR(a,o){if(a.angle===0)return null;let l;return l=a.a[o]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[o]/a.a[o]/Math.sin(a.angle)-1/Math.tan(a.angle)),l<0||l>1?null:function(d,m,y,v){let S=Math.sin(y);return d*(Math.sin((1-v)*y)/S)+m*(Math.sin(v*y)/S)}(a.a[o],a.b[o],a.angle,xr(l,0,1))+a.center[o]}function mh(a){if(a.z<=1)return rne[a.z+2*a.y+a.x];let o=ER(xM(a));return Jn.fromPoints(o)}function Id(a,o,l){return n.$.scale(a,a,1-l),n.$.scaleAndAdd(a,a,o,l)}function pj(a,o){let l=Pd(o.zoom);if(l===0)return mh(a);let d=xM(a),m=ER(d),y=ph(d.getWest())*o.worldSize,v=ph(d.getEast())*o.worldSize,S=fh(d.getNorth())*o.worldSize,T=fh(d.getSouth())*o.worldSize,D=[y,S,0],L=[v,S,0],F=[y,T,0],N=[v,T,0],H=n.ae.invert([],o.globeMatrix);return n.$.transformMat4(D,D,H),n.$.transformMat4(L,L,H),n.$.transformMat4(F,F,H),n.$.transformMat4(N,N,H),m[0]=Id(m[0],F,l),m[1]=Id(m[1],N,l),m[2]=Id(m[2],L,l),m[3]=Id(m[3],D,l),Jn.fromPoints(m)}function fj(a,o,l){for(let d of a)n.$.transformMat4(d,d,o),n.$.scale(d,d,l)}function mj(a,o,l,d){let m=o/a.worldSize,y=a.globeMatrix;if(l.z<=1){let ut=mh(l).getCorners();return fj(ut,y,m),Jn.fromPoints(ut)}let v=xM(l,d),S=ER(v,Na+_M(a._tileCoverLift));fj(S,y,m);let T=Number.MAX_VALUE,D=[-T,-T,-T],L=[T,T,T];if(v.contains(a.center)){for(let dt of S)n.$.min(L,L,dt),n.$.max(D,D,dt);D[2]=0;let ut=a.point,vt=[ut.x*m,ut.y*m,0];return n.$.min(L,L,vt),n.$.max(D,D,vt),new Jn(L,D)}if(a._tileCoverLift>0){for(let ut of S)n.$.min(L,L,ut),n.$.max(D,D,ut);return new Jn(L,D)}let F=[y[12]*m,y[13]*m,y[14]*m],N=v.getCenter(),H=xr(a.center.lat,-Rs,Rs),q=xr(N.lat,-Rs,Rs),Q=ph(a.center.lng),K=fh(H),ae=Q-ph(N.lng),_e=K-fh(q);ae>.5?ae-=1:ae<-.5&&(ae+=1);let ge=0;if(Math.abs(ae)>Math.abs(_e))ge=ae>=0?1:3;else{ge=_e>=0?0:2;let ut=[y[4]*m,y[5]*m,y[6]*m],vt=-Math.sin(Rr(_e>=0?v.getSouth():v.getNorth()))*Na;n.$.scaleAndAdd(F,F,ut,vt)}let be=S[ge],ze=S[(ge+1)%4],ke=new nne(be,ze,F),je=[SR(ke,0)||be[0],SR(ke,1)||be[1],SR(ke,2)||be[2]],it=Pd(a.zoom);if(it>0){let ut=function({x:dt,y:At,z:jt},Ct,qt,Tt,Ot){let Kt=1/(1<<jt),Dt=dt*Kt,ri=Dt+Kt,Xt=At*Kt,Vt=Xt+Kt,zi=0,Ri=(Dt+ri)/2-Tt;return Ri>.5?zi=-1:Ri<-.5&&(zi=1),Dt=((Dt+zi)*Ct-(Tt*=Ct))*qt+Tt,ri=((ri+zi)*Ct-Tt)*qt+Tt,Xt=(Xt*Ct-(Ot*=Ct))*qt+Ot,Vt=(Vt*Ct-Ot)*qt+Ot,[[Dt,Vt,0],[ri,Vt,0],[ri,Xt,0],[Dt,Xt,0]]}(l,o,a._pixelsPerMercatorPixel,Q,K);for(let dt=0;dt<S.length;dt++)Id(S[dt],ut[dt],it);let vt=n.$.add([],ut[ge],ut[(ge+1)%4]);n.$.scale(vt,vt,.5),Id(je,vt,it)}for(let ut of S)n.$.min(L,L,ut),n.$.max(D,D,ut);return L[2]=Math.min(be[2],ze[2]),n.$.min(L,L,je),n.$.max(D,D,je),new Jn(L,D)}function xM({x:a,y:o,z:l},d=!1){let m=1/(1<<l),y=new Kr(ol(a*m),o===(1<<l)-1&&d?-90:_o((o+1)*m)),v=new Kr(ol((a+1)*m),o===0&&d?90:_o(o*m));return new lf(y,v)}function ER(a,o=Na){let l=Rr(a.getNorth()),d=Rr(a.getSouth()),m=Math.cos(l),y=Math.cos(d),v=Math.sin(l),S=Math.sin(d),T=a.getWest(),D=a.getEast();return[Wv(y,S,T,o),Wv(y,S,D,o),Wv(m,v,D,o),Wv(m,v,T,o)]}function N1(a,o,l,d){let m=1<<l.z,y=(a/ti+l.x)/m;return mg(_o((o/ti+l.y)/m),ol(y),d)}function bM({min:a,max:o}){return Wre/Math.max(o[0]-a[0],o[1]-a[1],o[2]-a[2])}let gj=new Float64Array(16);function B1(a){let o=bM(a),l=n.ae.fromScaling(gj,[o,o,o]);return n.ae.translate(l,l,n.$.negate([],a.min))}function MR(a){let o=n.ae.fromTranslation(gj,a.min),l=1/bM(a);return n.ae.scale(o,o,[l,l,l])}function TR(a){let o=ti/(2*Math.PI);return a/(2*Math.PI)/o}function yj(a,o){return ti/(512*Math.pow(2,a))*bM(mh(o))}function vj(a,o,l,d,m){let y=TR(l),v=[a,o,-l/(2*Math.PI)],S=n.ae.identity(new Float64Array(16));return n.ae.translate(S,S,v),n.ae.scale(S,S,[y,y,y]),n.ae.rotateX(S,S,Rr(-m)),n.ae.rotateY(S,S,Rr(-d)),S}function Pd(a){return Hx(lR,q5,a)}function _j(a,o){let l=mg(o.lat,o.lng),d=function(y){let v=mg(y._center.lat,y._center.lng),S=n.$.fromValues(0,1,0),T=n.$.cross([],S,v),D=n.ae.fromRotation([],-y.angle,v);T=n.$.transformMat4(T,T,D),n.ae.fromRotation(D,-y._pitch,T);let L=n.$.normalize([],v);return n.$.scale(L,L,_M(y.cameraToCenterDistance/y.pixelsPerMeter)),n.$.transformMat4(L,L,D),n.$.add([],v,L)}(a),m=n.$.subtract([],d,l);return n.$.angle(m,l)}function AR(a,o){return _j(a,o)>Math.PI/2*1.01}let xj=Rr(85),sne=Math.cos(xj),one=Math.sin(xj),ane=n.ae.create(),bj=a=>{let o=[];return a.paint.get("circle-pitch-alignment")==="map"&&o.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&o.push("SCALE_WITH_MAP"),o};function wj(a,o,l,d,m,y,v,S,T){if(y&&a.queryGeometry.isAboveHorizon)return!1;y&&(T*=a.pixelToTileUnitsFactor);let D=a.tileID.canonical,L=l.projection.upVectorScale(D,l.center.lat,l.worldSize).metersToTile;for(let F of o)for(let N of F){let H=N.add(S),q=m&&l.elevation?l.elevation.exaggeration()*m.getElevationAt(H.x,H.y,!0):0,Q=l.projection.projectTilePoint(H.x,H.y,D);if(q>0){let ge=l.projection.upVector(D,H.x,H.y);Q.x+=ge[0]*L*q,Q.y+=ge[1]*L*q,Q.z+=ge[2]*L*q}let K=y?H:lne(Q.x,Q.y,Q.z,d),ae=y?a.tilespaceRays.map(ge=>une(ge,q)):a.queryGeometry.screenGeometry,_e=n.aB.transformMat4([],[Q.x,Q.y,Q.z,1],d);if(!v&&y?T*=_e[3]/l.cameraToCenterDistance:v&&!y&&(T*=l.cameraToCenterDistance/_e[3]),y){let ge=_o((N.y/ti+D.y)/(1<<D.z));T/=l.projection.pixelsPerMeter(ge,1)/Ba(1,ge)}if(Kre(ae,K,T))return!0}return!1}function lne(a,o,l,d){let m=n.aB.transformMat4([],[a,o,l,1],d);return new ai(m[0]/m[3],m[1]/m[3])}let Sj=n.$.fromValues(0,0,0),cne=n.$.fromValues(0,0,1);function une(a,o){let l=n.$.create();return Sj[2]=o,a.intersectsPlane(Sj,cne,l),new ai(l[0],l[1])}class Ej extends mR{}function Mj(a,{width:o,height:l},d,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==o*l*d)throw new RangeError("mismatched image size")}else m=new Uint8Array(o*l*d);return a.width=o,a.height=l,a.data=m,a}function Tj(a,o,l){let{width:d,height:m}=o;d===a.width&&m===a.height||(CR(a,o,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,d),height:Math.min(a.height,m)},l,null),a.width=d,a.height=m,a.data=o.data)}function CR(a,o,l,d,m,y,v,S){if(m.width===0||m.height===0)return o;if(m.width>a.width||m.height>a.height||l.x>a.width-m.width||l.y>a.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>o.width||m.height>o.height||d.x>o.width-m.width||d.y>o.height-m.height)throw new RangeError("out of range destination coordinates for image copy");let T=a.data,D=o.data,L=y===4&&S;for(let F=0;F<m.height;F++){let N=((l.y+F)*a.width+l.x)*y,H=((d.y+F)*o.width+d.x)*y;if(L)for(let q=0;q<m.width;q++){let Q=N+q*y+3,K=H+q*y;D[K+0]=255,D[K+1]=255,D[K+2]=255,D[K+3]=T[Q]}else if(v)for(let q=0;q<m.width;q++){let Q=N+q*y,K=H+q*y,ae=T[Q+3],_e=new en(T[Q+0]/255*ae,T[Q+1]/255*ae,T[Q+2]/255*ae,ae).toRenderColor(v).toArray();D[K+0]=_e[0],D[K+1]=_e[1],D[K+2]=_e[2],D[K+3]=_e[3]}else for(let q=0;q<m.width*y;q++)D[H+q]=T[N+q]}return o}tt(Ej,"HeatmapBucket",{omit:["layers"]});class uf{constructor(o,l){Mj(this,o,1,l)}resize(o){Tj(this,new uf(o),1)}clone(){return new uf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,d,m,y){CR(o,l,d,m,y,1,null)}}class Zl{constructor(o,l){Mj(this,o,4,l)}resize(o){Tj(this,new Zl(o),4)}replace(o,l){l?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Zl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,d,m,y,v,S){CR(o,l,d,m,y,4,v,S)}}class Aj{constructor(o,l){this.width=o.width,this.height=o.height,this.data=l instanceof Uint8Array?new Float32Array(l.buffer):l}}let Cj,Dj,Ij,Pj;function U1(a){let o={},l=a.resolution||256,d=a.clips?a.clips.length:1,m=a.image||new Zl({width:l,height:d}),y=(v,S,T)=>{o[a.evaluationKey]=T;let D=a.expression.evaluate(o);D&&(m.data[v+S+0]=Math.floor(255*D.r/D.a),m.data[v+S+1]=Math.floor(255*D.g/D.a),m.data[v+S+2]=Math.floor(255*D.b/D.a),m.data[v+S+3]=Math.floor(255*D.a))};if(a.clips)for(let v=0,S=0;v<d;++v,S+=4*l)for(let T=0,D=0;T<l;T++,D+=4){let L=T/(l-1),{start:F,end:N}=a.clips[v];y(S,D,F*(1-L)+N*L)}else for(let v=0,S=0;v<l;v++,S+=4)y(0,S,v/(l-1));return m}tt(uf,"AlphaImage"),tt(Zl,"RGBAImage");let hne=hn([{name:"a_pos",components:2,type:"Int16"}],4),{members:dne}=hne;function j1(a,o,l=2){let d=o&&o.length,m=d?o[0]*l:a.length,y=Rj(a,0,m,l,!0),v=[];if(!y||y.next===y.prev)return v;let S,T,D;if(d&&(y=function(L,F,N,H){let q=[];for(let Q=0,K=F.length;Q<K;Q++){let ae=Rj(L,F[Q]*H,Q<K-1?F[Q+1]*H:L.length,H,!1);ae===ae.next&&(ae.steiner=!0),q.push(xne(ae))}q.sort(yne);for(let Q=0;Q<q.length;Q++)N=vne(q[Q],N);return N}(a,o,y,l)),a.length>80*l){S=1/0,T=1/0;let L=-1/0,F=-1/0;for(let N=l;N<m;N+=l){let H=a[N],q=a[N+1];H<S&&(S=H),q<T&&(T=q),H>L&&(L=H),q>F&&(F=q)}D=Math.max(L-S,F-T),D=D!==0?32767/D:0}return V1(y,v,l,S,T,D,0),v}function Rj(a,o,l,d,m){let y;if(m===function(v,S,T,D){let L=0;for(let F=S,N=T-D;F<T;F+=D)L+=(v[N]-v[F])*(v[F+1]+v[N+1]),N=F;return L}(a,o,l,d)>0)for(let v=o;v<l;v+=d)y=zj(v/d|0,a[v],a[v+1],y);else for(let v=l-d;v>=o;v-=d)y=zj(v/d|0,a[v],a[v+1],y);return y&&wM(y,y.next)&&(H1(y),y=y.next),y}function vg(a,o){if(!a)return a;o||(o=a);let l,d=a;do if(l=!1,d.steiner||!wM(d,d.next)&&qs(d.prev,d,d.next)!==0)d=d.next;else{if(H1(d),d=o=d.prev,d===d.next)break;l=!0}while(l||d!==o);return o}function V1(a,o,l,d,m,y,v){if(!a)return;!v&&y&&function(T,D,L,F){let N=T;do N.z===0&&(N.z=DR(N.x,N.y,D,L,F)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==T);N.prevZ.nextZ=null,N.prevZ=null,function(H){let q,Q=1;do{let K,ae=H;H=null;let _e=null;for(q=0;ae;){q++;let ge=ae,be=0;for(let ke=0;ke<Q&&(be++,ge=ge.nextZ,ge);ke++);let ze=Q;for(;be>0||ze>0&&ge;)be!==0&&(ze===0||!ge||ae.z<=ge.z)?(K=ae,ae=ae.nextZ,be--):(K=ge,ge=ge.nextZ,ze--),_e?_e.nextZ=K:H=K,K.prevZ=_e,_e=K;ae=ge}_e.nextZ=null,Q*=2}while(q>1)}(N)}(a,d,m,y);let S=a;for(;a.prev!==a.next;){let T=a.prev,D=a.next;if(y?fne(a,d,m,y):pne(a))o.push(T.i,a.i,D.i),H1(a),a=D.next,S=D.next;else if((a=D)===S){v?v===1?V1(a=mne(vg(a),o),o,l,d,m,y,2):v===2&&gne(a,o,l,d,m,y):V1(vg(a),o,l,d,m,y,1);break}}}function pne(a){let o=a.prev,l=a,d=a.next;if(qs(o,l,d)>=0)return!1;let m=o.x,y=l.x,v=d.x,S=o.y,T=l.y,D=d.y,L=m<y?m<v?m:v:y<v?y:v,F=S<T?S<D?S:D:T<D?T:D,N=m>y?m>v?m:v:y>v?y:v,H=S>T?S>D?S:D:T>D?T:D,q=d.next;for(;q!==o;){if(q.x>=L&&q.x<=N&&q.y>=F&&q.y<=H&&Zv(m,S,y,T,v,D,q.x,q.y)&&qs(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function fne(a,o,l,d){let m=a.prev,y=a,v=a.next;if(qs(m,y,v)>=0)return!1;let S=m.x,T=y.x,D=v.x,L=m.y,F=y.y,N=v.y,H=S<T?S<D?S:D:T<D?T:D,q=L<F?L<N?L:N:F<N?F:N,Q=S>T?S>D?S:D:T>D?T:D,K=L>F?L>N?L:N:F>N?F:N,ae=DR(H,q,o,l,d),_e=DR(Q,K,o,l,d),ge=a.prevZ,be=a.nextZ;for(;ge&&ge.z>=ae&&be&&be.z<=_e;){if(ge.x>=H&&ge.x<=Q&&ge.y>=q&&ge.y<=K&&ge!==m&&ge!==v&&Zv(S,L,T,F,D,N,ge.x,ge.y)&&qs(ge.prev,ge,ge.next)>=0||(ge=ge.prevZ,be.x>=H&&be.x<=Q&&be.y>=q&&be.y<=K&&be!==m&&be!==v&&Zv(S,L,T,F,D,N,be.x,be.y)&&qs(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;ge&&ge.z>=ae;){if(ge.x>=H&&ge.x<=Q&&ge.y>=q&&ge.y<=K&&ge!==m&&ge!==v&&Zv(S,L,T,F,D,N,ge.x,ge.y)&&qs(ge.prev,ge,ge.next)>=0)return!1;ge=ge.prevZ}for(;be&&be.z<=_e;){if(be.x>=H&&be.x<=Q&&be.y>=q&&be.y<=K&&be!==m&&be!==v&&Zv(S,L,T,F,D,N,be.x,be.y)&&qs(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function mne(a,o){let l=a;do{let d=l.prev,m=l.next.next;!wM(d,m)&&Oj(d,l,l.next,m)&&G1(d,m)&&G1(m,d)&&(o.push(d.i,l.i,m.i),H1(l),H1(l.next),l=a=m),l=l.next}while(l!==a);return vg(l)}function gne(a,o,l,d,m,y){let v=a;do{let S=v.next.next;for(;S!==v.prev;){if(v.i!==S.i&&bne(v,S)){let T=Lj(v,S);return v=vg(v,v.next),T=vg(T,T.next),V1(v,o,l,d,m,y,0),void V1(T,o,l,d,m,y,0)}S=S.next}v=v.next}while(v!==a)}function yne(a,o){return a.x-o.x}function vne(a,o){let l=function(m,y){let v=y,S=m.x,T=m.y,D,L=-1/0;do{if(T<=v.y&&T>=v.next.y&&v.next.y!==v.y){let Q=v.x+(T-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(Q<=S&&Q>L&&(L=Q,D=v.x<v.next.x?v:v.next,Q===S))return D}v=v.next}while(v!==y);if(!D)return null;let F=D,N=D.x,H=D.y,q=1/0;v=D;do{if(S>=v.x&&v.x>=N&&S!==v.x&&Zv(T<H?S:L,T,N,H,T<H?L:S,T,v.x,v.y)){let Q=Math.abs(T-v.y)/(S-v.x);G1(v,m)&&(Q<q||Q===q&&(v.x>D.x||v.x===D.x&&_ne(D,v)))&&(D=v,q=Q)}v=v.next}while(v!==F);return D}(a,o);if(!l)return o;let d=Lj(l,a);return vg(d,d.next),vg(l,l.next)}function _ne(a,o){return qs(a.prev,a,o.prev)<0&&qs(o.next,a,a.next)<0}function DR(a,o,l,d,m){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-l)*m|0)|a<<8))|a<<4))|a<<2))|a<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-d)*m|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function xne(a){let o=a,l=a;do(o.x<l.x||o.x===l.x&&o.y<l.y)&&(l=o),o=o.next;while(o!==a);return l}function Zv(a,o,l,d,m,y,v,S){return(m-v)*(o-S)>=(a-v)*(y-S)&&(a-v)*(d-S)>=(l-v)*(o-S)&&(l-v)*(y-S)>=(m-v)*(d-S)}function bne(a,o){return a.next.i!==o.i&&a.prev.i!==o.i&&!function(l,d){let m=l;do{if(m.i!==l.i&&m.next.i!==l.i&&m.i!==d.i&&m.next.i!==d.i&&Oj(m,m.next,l,d))return!0;m=m.next}while(m!==l);return!1}(a,o)&&(G1(a,o)&&G1(o,a)&&function(l,d){let m=l,y=!1,v=(l.x+d.x)/2,S=(l.y+d.y)/2;do m.y>S!=m.next.y>S&&m.next.y!==m.y&&v<(m.next.x-m.x)*(S-m.y)/(m.next.y-m.y)+m.x&&(y=!y),m=m.next;while(m!==l);return y}(a,o)&&(qs(a.prev,a,o.prev)||qs(a,o.prev,o))||wM(a,o)&&qs(a.prev,a,a.next)>0&&qs(o.prev,o,o.next)>0)}function qs(a,o,l){return(o.y-a.y)*(l.x-o.x)-(o.x-a.x)*(l.y-o.y)}function wM(a,o){return a.x===o.x&&a.y===o.y}function Oj(a,o,l,d){let m=EM(qs(a,o,l)),y=EM(qs(a,o,d)),v=EM(qs(l,d,a)),S=EM(qs(l,d,o));return m!==y&&v!==S||!(m!==0||!SM(a,l,o))||!(y!==0||!SM(a,d,o))||!(v!==0||!SM(l,a,d))||!(S!==0||!SM(l,o,d))}function SM(a,o,l){return o.x<=Math.max(a.x,l.x)&&o.x>=Math.min(a.x,l.x)&&o.y<=Math.max(a.y,l.y)&&o.y>=Math.min(a.y,l.y)}function EM(a){return a>0?1:a<0?-1:0}function G1(a,o){return qs(a.prev,a,a.next)<0?qs(a,o,a.next)>=0&&qs(a,a.prev,o)>=0:qs(a,o,a.prev)<0||qs(a,a.next,o)<0}function Lj(a,o){let l=IR(a.i,a.x,a.y),d=IR(o.i,o.x,o.y),m=a.next,y=o.prev;return a.next=o,o.prev=a,l.next=m,m.prev=l,d.next=l,l.prev=d,y.next=d,d.prev=y,d}function zj(a,o,l,d){let m=IR(a,o,l);return d?(m.next=d.next,m.prev=d,d.next.prev=m,d.next=m):(m.prev=m,m.next=m),m}function H1(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function IR(a,o,l){return{i:a,x:o,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function MM(a,o){let l=a.length;if(l<=1)return[a];let d=[],m,y;for(let v=0;v<l;v++){let S=pP(a[v]);S!==0&&(a[v].area=Math.abs(S),y===void 0&&(y=S<0),y===S<0?(m&&d.push(m),m=[a[v]]):m.push(a[v]))}if(m&&d.push(m),o>1)for(let v=0;v<d.length;v++)d[v].length<=o||(tn(d[v],o,1,d[v].length-1,wne),d[v]=d[v].slice(0,o));return d}function wne(a,o){return o.area-a.area}function PR(a,o,l){let d=l.patternDependencies,m=!1;for(let y of o){let v=y.paint.get(`${a}-pattern`);v.isConstant()||(m=!0);let S=v.constantOr(null);S&&(m=!0,d[S]=!0)}return m}function RR(a,o,l,d,m){let y=m.patternDependencies;for(let v of o){let S=v.paint.get(`${a}-pattern`).value;if(S.kind!=="constant"){let T=S.evaluate({zoom:d},l,{},m.availableImages);T=T&&T.name?T.name:T,y[T]=!0,l.patterns[v.id]=T}}return l}class TM{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new uu,this.indexArray=new so,this.indexArray2=new sf,this.programConfigurations=new af(o.layers,{zoom:o.zoom,lut:o.lut}),this.segments=new ss,this.segments2=new ss,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=o.projection}updateFootprints(o,l){}populate(o,l,d,m){this.hasPattern=PR("fill",this.layers,l);let y=this.layers[0].layout.get("fill-sort-key"),v=[];for(let{feature:S,id:T,index:D,sourceLayerIndex:L}of o){let F=this.layers[0]._featureFilter.needGeometry,N=Dd(S,F);if(!this.layers[0]._featureFilter.filter(new er(this.zoom),N,d))continue;let H=y?y.evaluate(N,{},d,l.availableImages):void 0,q={id:T,properties:S.properties,type:S.type,sourceLayerIndex:L,index:D,geometry:F?N.geometry:du(S,d,m),patterns:{},sortKey:H};v.push(q)}y&&v.sort((S,T)=>S.sortKey-T.sortKey);for(let S of v){let{geometry:T,index:D,sourceLayerIndex:L}=S;if(this.hasPattern){let F=RR("fill",this.layers,S,this.zoom,l);this.patternFeatures.push(F)}else this.addFeature(S,T,D,d,{},l.availableImages,l.brightness);l.featureIndex.insert(o[D].feature,T,D,L,this.index)}}update(o,l,d,m,y){let v=Object.keys(o).length!==0;v&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(o,l,v?this.stateDependentLayers:this.layers,d,m,y)}addFeatures(o,l,d,m,y,v){for(let S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,l,d,m,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,dne),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,l,d,m,y,v=[],S){for(let T of MM(l,500)){let D=0;for(let Q of T)D+=Q.length;let L=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),F=L.vertexLength,N=[],H=[];for(let Q of T){if(Q.length===0)continue;Q!==T[0]&&H.push(N.length/2);let K=this.segments2.prepareSegment(Q.length,this.layoutVertexArray,this.indexArray2),ae=K.vertexLength;this.layoutVertexArray.emplaceBack(Q[0].x,Q[0].y),this.indexArray2.emplaceBack(ae+Q.length-1,ae),N.push(Q[0].x),N.push(Q[0].y);for(let _e=1;_e<Q.length;_e++)this.layoutVertexArray.emplaceBack(Q[_e].x,Q[_e].y),this.indexArray2.emplaceBack(ae+_e-1,ae+_e),N.push(Q[_e].x),N.push(Q[_e].y);K.vertexLength+=Q.length,K.primitiveLength+=Q.length}let q=j1(N,H);for(let Q=0;Q<q.length;Q+=3)this.indexArray.emplaceBack(F+q[Q],F+q[Q+1],F+q[Q+2]);L.vertexLength+=D,L.primitiveLength+=q.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,y,v,m,S)}}let Fj,kj,Nj,Bj;tt(TM,"FillBucket",{omit:["layers","patternFeatures"]});class OR{constructor(o,l,d,m){if(this.triangleCount=l.length/3,this.min=new ai(0,0),this.max=new ai(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||o.length===0)return;let[y,v]=[o[0].clone(),o[0].clone()];for(let F=1;F<o.length;++F){let N=o[F];y.x=Math.min(y.x,N.x),y.y=Math.min(y.y,N.y),v.x=Math.max(v.x,N.x),v.y=Math.max(v.y,N.y)}if(m){let F=Math.ceil(Math.max(v.x-y.x,v.y-y.y)/m);d=Math.max(d,F)}if(d===0)return;this.min=y,this.max=v;let S=this.max.sub(this.min);S.x=Math.max(S.x,1),S.y=Math.max(S.y,1);let T=Math.max(S.x,S.y)/d;this.cellsX=Math.max(1,Math.ceil(S.x/T)),this.cellsY=Math.max(1,Math.ceil(S.y/T)),this.xScale=1/T,this.yScale=1/T;let D=[];for(let F=0;F<this.triangleCount;F++){let N=o[l[3*F+0]].sub(this.min),H=o[l[3*F+1]].sub(this.min),q=o[l[3*F+2]].sub(this.min),Q=gh(Math.floor(Math.min(N.x,H.x,q.x)),this.xScale,this.cellsX),K=gh(Math.floor(Math.max(N.x,H.x,q.x)),this.xScale,this.cellsX),ae=gh(Math.floor(Math.min(N.y,H.y,q.y)),this.yScale,this.cellsY),_e=gh(Math.floor(Math.max(N.y,H.y,q.y)),this.yScale,this.cellsY),ge=new ai(0,0),be=new ai(0,0),ze=new ai(0,0),ke=new ai(0,0);for(let je=ae;je<=_e;++je){ge.y=be.y=je*T,ze.y=ke.y=(je+1)*T;for(let it=Q;it<=K;++it)ge.x=ze.x=it*T,be.x=ke.x=(it+1)*T,(_R(N,H,q,ge,be,ke)||_R(N,H,q,ge,ke,ze))&&D.push({cellIdx:je*this.cellsX+it,triIdx:F})}}if(D.length===0)return;D.sort((F,N)=>F.cellIdx-N.cellIdx||F.triIdx-N.triIdx);let L=0;for(;L<D.length;){let F=D[L].cellIdx,N={start:this.payload.length,len:0};for(;L<D.length&&D[L].cellIdx===F;)++N.len,this.payload.push(D[L++].triIdx);this.cells[F]=N}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(o,l){if(this.triangleCount===0||this.cells.length===0||o.x>this.max.x||this.min.x>o.x||o.y>this.max.y||this.min.y>o.y)return;let d=gh(o.x-this.min.x,this.xScale,this.cellsX),m=gh(o.y-this.min.y,this.yScale,this.cellsY),y=this.cells[m*this.cellsX+d];if(y){this._lazyInitLookup();for(let v=0;v<y.len;v++){let S=this.payload[y.start+v],T=Math.floor(S/8),D=1<<S%8;if(!(this.lookup[T]&D)&&(this.lookup[T]|=D,l.push(S),l.length===this.triangleCount))return}}}query(o,l,d){if(this.triangleCount===0||this.cells.length===0||o.x>this.max.x||this.min.x>l.x||o.y>this.max.y||this.min.y>l.y)return;this._lazyInitLookup();let m=gh(o.x-this.min.x,this.xScale,this.cellsX),y=gh(l.x-this.min.x,this.xScale,this.cellsX),v=gh(o.y-this.min.y,this.yScale,this.cellsY),S=gh(l.y-this.min.y,this.yScale,this.cellsY);for(let T=v;T<=S;T++)for(let D=m;D<=y;D++){let L=this.cells[T*this.cellsX+D];if(L)for(let F=0;F<L.len;F++){let N=this.payload[L.start+F],H=Math.floor(N/8),q=1<<N%8;if(!(this.lookup[H]&q)&&(this.lookup[H]|=q,d.push(N),d.length===this.triangleCount))return}}}}function gh(a,o,l){return Math.max(0,Math.min(l-1,Math.floor(a*o)))}tt(OR,"TriangleGridIndex");class Uj{constructor(o){this.zoom=o.zoom,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.footprints=[]}updateFootprints(o,l){for(let d of this.footprints)l.push({footprint:d,id:o})}populate(o,l,d,m){let y=[];for(let{feature:v,id:S,index:T,sourceLayerIndex:D}of o){let L=this.layers[0]._featureFilter.needGeometry,F=Dd(v,L);if(!this.layers[0]._featureFilter.filter(new er(this.zoom),F,d))continue;let N={id:S,properties:v.properties,type:v.type,sourceLayerIndex:D,index:T,geometry:L?F.geometry:du(v,d,m),patterns:{}};y.push(N)}for(let v of y){let{geometry:S,index:T,sourceLayerIndex:D}=v;this.addFeature(v,S,T,d,{},l.availableImages,l.brightness),l.featureIndex.insert(o[T].feature,S,T,D,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(o){}update(o,l,d,m,y){}destroy(){}addFeature(o,l,d,m,y,v=[],S){for(let T of MM(l,2)){let D=[],L=[],F=[],N=new ai(1/0,1/0),H=new ai(-1/0,-1/0);for(let K of T)if(K.length!==0){K!==T[0]&&F.push(L.length/2);for(let ae=0;ae<K.length;ae++)L.push(K[ae].x),L.push(K[ae].y),D.push(K[ae]),N.x=Math.min(N.x,K[ae].x),N.y=Math.min(N.y,K[ae].y),H.x=Math.max(H.x,K[ae].x),H.y=Math.max(H.y,K[ae].y)}let q=j1(L,F),Q=new OR(D,q,8,256);this.footprints.push({vertices:D,indices:q,grid:Q,min:N,max:H})}}}tt(Uj,"ClipBucket",{omit:["layers"]});let Sne=hn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ene=hn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Mne=hn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Tne=hn([{name:"a_join_normal_inside_polygon",components:4,type:"Int16"}]),Ane=hn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Cne=hn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Dne}=Sne;var AM={},Ine=Tm,jj=Qv;function Qv(a,o,l,d,m){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=d,this._values=m,a.readFields(Pne,this,o)}function Pne(a,o,l){a==1?o.id=l.readVarint():a==2?function(d,m){for(var y=d.readVarint()+d.pos;d.pos<y;){var v=m._keys[d.readVarint()],S=m._values[d.readVarint()];m.properties[v]=S}}(l,o):a==3?o.type=l.readVarint():a==4&&(o._geometry=l.pos)}function Rne(a){for(var o,l,d=0,m=0,y=a.length,v=y-1;m<y;v=m++)d+=((l=a[v]).x-(o=a[m]).x)*(o.y+l.y);return d}Qv.types=["Unknown","Point","LineString","Polygon"],Qv.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var o,l=a.readVarint()+a.pos,d=1,m=0,y=0,v=0,S=[];a.pos<l;){if(m<=0){var T=a.readVarint();d=7&T,m=T>>3}if(m--,d===1||d===2)y+=a.readSVarint(),v+=a.readSVarint(),d===1&&(o&&S.push(o),o=[]),o.push(new Ine(y,v));else{if(d!==7)throw new Error("unknown command "+d);o&&o.push(o[0].clone())}}return o&&S.push(o),S},Qv.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var o=a.readVarint()+a.pos,l=1,d=0,m=0,y=0,v=1/0,S=-1/0,T=1/0,D=-1/0;a.pos<o;){if(d<=0){var L=a.readVarint();l=7&L,d=L>>3}if(d--,l===1||l===2)(m+=a.readSVarint())<v&&(v=m),m>S&&(S=m),(y+=a.readSVarint())<T&&(T=y),y>D&&(D=y);else if(l!==7)throw new Error("unknown command "+l)}return[v,T,S,D]},Qv.prototype.toGeoJSON=function(a,o,l){var d,m,y=this.extent*Math.pow(2,l),v=this.extent*a,S=this.extent*o,T=this.loadGeometry(),D=Qv.types[this.type];function L(H){for(var q=0;q<H.length;q++){var Q=H[q];H[q]=[360*(Q.x+v)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(Q.y+S)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(d=0;d<T.length;d++)F[d]=T[d][0];L(T=F);break;case 2:for(d=0;d<T.length;d++)L(T[d]);break;case 3:for(T=function(H){var q=H.length;if(q<=1)return[H];for(var Q,K,ae=[],_e=0;_e<q;_e++){var ge=Rne(H[_e]);ge!==0&&(K===void 0&&(K=ge<0),K===ge<0?(Q&&ae.push(Q),Q=[H[_e]]):Q.push(H[_e]))}return Q&&ae.push(Q),ae}(T),d=0;d<T.length;d++)for(m=0;m<T[d].length;m++)L(T[d][m])}T.length===1?T=T[0]:D="Multi"+D;var N={type:"Feature",geometry:{type:D,coordinates:T},properties:this.properties};return"id"in this&&(N.id=this.id),N};var One=jj,Vj=Gj;function Gj(a,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Lne,this,o),this.length=this._features.length}function Lne(a,o,l){a===15?o.version=l.readVarint():a===1?o.name=l.readString():a===5?o.extent=l.readVarint():a===2?o._features.push(l.pos):a===3?o._keys.push(l.readString()):a===4&&o._values.push(function(d){for(var m=null,y=d.readVarint()+d.pos;d.pos<y;){var v=d.readVarint()>>3;m=v===1?d.readString():v===2?d.readFloat():v===3?d.readDouble():v===4?d.readVarint64():v===5?d.readVarint():v===6?d.readSVarint():v===7?d.readBoolean():null}return m}(l))}Gj.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var o=this._pbf.readVarint()+this._pbf.pos;return new One(this._pbf,o,this.extent,this._keys,this._values)};var zne=Vj;function Fne(a,o,l){if(a===3){var d=new zne(l,l.readVarint()+l.pos);d.length&&(o[d.name]=d)}}var LR=AM.VectorTile=function(a,o){this.layers=a.readFields(Fne,{},o)},CM=AM.VectorTileFeature=jj;AM.VectorTileLayer=Vj;class _g extends ai{constructor(o,l,d){super(o,l),this.z=d}}class Hj extends _g{constructor(o,l,d,m){super(o,l,d),this.w=m}}function DM(a,o,l,d){let m=[],y=d===0?(v,S,T,D,L,F)=>{v.push(new ai(F,T+(F-S)/(D-S)*(L-T)))}:(v,S,T,D,L,F)=>{v.push(new ai(S+(F-T)/(L-T)*(D-S),F))};for(let v of a){let S=[];for(let T of v){if(T.length<=2)continue;let D=[];for(let N=0;N<T.length-1;N++){let H=T[N].x,q=T[N].y,Q=T[N+1].x,K=T[N+1].y,ae=d===0?H:q,_e=d===0?Q:K;ae<o?_e>o&&y(D,H,q,Q,K,o):ae>l?_e<l&&y(D,H,q,Q,K,l):D.push(T[N]),_e<o&&ae>=o&&y(D,H,q,Q,K,o),_e>l&&ae<=l&&y(D,H,q,Q,K,l)}let L=T[T.length-1],F=d===0?L.x:L.y;F>=o&&F<=l&&D.push(L),D.length&&(L=D[D.length-1],D[0].x===L.x&&D[0].y===L.y||D.push(D[0]),S.push(D))}S.length&&m.push(S)}return m}function Wj(a,o,l,d){let m=l==="x"?"y":"x",y=(d-a[l])/(o[l]-a[l]);a[m]=a[m]+(o[m]-a[m])*y,a[l]=d,a.hasOwnProperty("z")&&(a.z=Gi(a.z,o.z,y)),a.hasOwnProperty("w")&&(a.w=Gi(a.w,o.w,y))}function qj(a,o,l,d){let m=l,y=d;for(let v of["x","y"]){let S=a,T=o;S[v]>=T[v]&&(S=o,T=a),S[v]<m&&T[v]>m&&Wj(S,T,v,m),S[v]<y&&T[v]>y&&Wj(T,S,v,y)}}let IM=Number.MAX_SAFE_INTEGER;function Yj(a,o,l,d){return a.order<o||a.order===IM||!(a.clipMask&l)||function(m,y){return y.length!==0&&y.find(v=>v===m)===void 0}(d,a.clipScope)}function PM(a,o){return a.x-o.x||a.y-o.y}function Xj(a,o){return PM(a.min,o.min)===0&&PM(a.max,o.max)===0}function zR(a,o){return!(a.min.x>o.max.x||a.max.x<o.min.x||a.min.y>o.max.y||a.max.y<o.min.y)}function FR(a,o){if(a.length!==o.length)return!1;for(let l=0;l<a.length;l++)if(a[l].sourceId!==o[l].sourceId||!Xj(a[l],o[l])||a[l].order!==o[l].order||a[l].clipMask!==o[l].clipMask||!Lp(a[l].clipScope,o[l].clipScope))return!1;return!0}function $j(a,o,l){let d=1/ti,m=1/(1<<l.canonical.z),y=(o.x*d+l.canonical.x)*m+l.wrap,v=(o.y*d+l.canonical.y)*m;return{min:new ai((a.x*d+l.canonical.x)*m+l.wrap,(a.y*d+l.canonical.y)*m),max:new ai(y,v)}}function kne(a,o,l){let d=1<<l.canonical.z,m=((o.x-l.wrap)*d-l.canonical.x)*ti,y=(o.y*d-l.canonical.y)*ti;return{min:new ai(((a.x-l.wrap)*d-l.canonical.x)*ti,(a.y*d-l.canonical.y)*ti),max:new ai(m,y)}}function Zj(a,o,l,d,m,y,v){let S=a.indices,T=a.vertices,D=[];for(let L=d;L<d+m;L+=3){let F=o[l[L+0]+y],N=o[l[L+1]+y],H=o[l[L+2]+y],q=Math.min(F.x,N.x,H.x),Q=Math.max(F.x,N.x,H.x),K=Math.min(F.y,N.y,H.y),ae=Math.max(F.y,N.y,H.y);D.length=0,a.grid.query(new ai(q,K),new ai(Q,ae),D);for(let _e=0;_e<D.length;_e++){let ge=D[_e];if(_R(T[S[3*ge+0]],T[S[3*ge+1]],T[S[3*ge+2]],F,N,H,v))return!0}}return!1}function Qj(a,o,l,d){if(!a||!l)return!1;let m=a.vertices;if(!o.canonical.equals(d.canonical)||o.wrap!==d.wrap){if(l.vertices.length<a.vertices.length)return Qj(l,d,a,o);let y=o.canonical,v=d.canonical,S=Math.pow(2,v.z-y.z);m=a.vertices.map(T=>new ai((T.x+y.x*ti)*S-v.x*ti,(T.y+y.y*ti)*S-v.y*ti))}return Zj(l,m,a.indices,0,a.indices.length,0,0)}function Kj(a,o,l,d){let m=Math.pow(2,d.z-l.z);return new ai((a+l.x*ti)*m-d.x*ti,(o+l.y*ti)*m-d.y*ti)}function Jj(a,o){let l=[];o.footprint.grid.queryPoint(a,l);let d=o.footprint.indices,m=o.footprint.vertices;for(let y=0;y<l.length;y++){let v=l[y];if(cf([m[d[3*v+0]],m[d[3*v+1]],m[d[3*v+2]]],a))return!0}return!1}class eV{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,l){let d=this.toIdx(o,l);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(o,l){return this.leaves[this.toIdx(o,l)]}toIdx(o,l){return l*this.size+o}}function tV(a,o,l,d){let m=0,y=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(d[v])<1e-15){if(l[v]<a[v]||l[v]>o[v])return null}else{let S=1/d[v],T=(a[v]-l[v])*S,D=(o[v]-l[v])*S;if(T>D){let L=T;T=D,D=L}if(T>m&&(m=T),D<y&&(y=D),m>y)return null}return m}function iV(a,o,l,d,m,y,v,S,T,D,L){let F=d-a,N=m-o,H=y-l,q=v-a,Q=S-o,K=T-l,ae=L[1]*K-L[2]*Q,_e=L[2]*q-L[0]*K,ge=L[0]*Q-L[1]*q,be=F*ae+N*_e+H*ge;if(Math.abs(be)<1e-15)return null;let ze=1/be,ke=D[0]-a,je=D[1]-o,it=D[2]-l,ut=(ke*ae+je*_e+it*ge)*ze;if(ut<0||ut>1)return null;let vt=je*H-it*N,dt=it*F-ke*H,At=ke*N-je*F,jt=(L[0]*vt+L[1]*dt+L[2]*At)*ze;return jt<0||ut+jt>1?null:(q*vt+Q*dt+K*At)*ze}function rV(a,o,l){return(a-o)/(l-o)}function nV(a,o,l,d,m,y,v,S,T){let D=1<<l,L=y-d,F=v-m,N=(a+1)/D*L+d,H=(o+0)/D*F+m,q=(o+1)/D*F+m;S[0]=(a+0)/D*L+d,S[1]=H,T[0]=N,T[1]=q}class sV{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let l=function(y){let v=Math.ceil(Math.log2(y.dim/8)),S=[],T=Math.ceil(Math.pow(2,v)),D=1/T,L=(H,q,Q,K,ae)=>{let _e=K?1:0,ge=(H+1)*Q-_e,be=q*Q,ze=(q+1)*Q-_e;ae[0]=H*Q,ae[1]=be,ae[2]=ge,ae[3]=ze},F=new eV(T),N=[];for(let H=0;H<T*T;H++){L(H%T,Math.floor(H/T),D,!1,N);let q=hf(N[0],N[1],y),Q=hf(N[2],N[1],y),K=hf(N[2],N[3],y),ae=hf(N[0],N[3],y);F.minimums.push(Math.min(q,Q,K,ae)),F.maximums.push(Math.max(q,Q,K,ae)),F.leaves.push(1)}for(S.push(F),T/=2;T>=1;T/=2){let H=S[S.length-1];F=new eV(T);for(let q=0;q<T*T;q++){L(q%T,Math.floor(q/T),2,!0,N);let Q=H.getElevation(N[0],N[1]),K=H.getElevation(N[2],N[1]),ae=H.getElevation(N[2],N[3]),_e=H.getElevation(N[0],N[3]),ge=H.isLeaf(N[0],N[1]),be=H.isLeaf(N[2],N[1]),ze=H.isLeaf(N[2],N[3]),ke=H.isLeaf(N[0],N[3]),je=Math.min(Q.min,K.min,ae.min,_e.min),it=Math.max(Q.max,K.max,ae.max,_e.max),ut=ge&&be&&ze&&ke;F.maximums.push(it),F.minimums.push(je),F.leaves.push(it-je<=5&&ut?1:0)}S.push(F)}return S}(this.dem),d=l.length-1,m=l[d];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(l,0,0,d,0)}raycastRoot(o,l,d,m,y,v,S=1){return tV([o,l,-100],[d,m,this.maximums[0]*S],y,v)}raycast(o,l,d,m,y,v,S=1){if(!this.nodeCount)return null;let T=this.raycastRoot(o,l,d,m,y,v,S);if(T==null)return null;let D=[],L=[],F=[],N=[],H=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;H.length>0;){let{idx:q,t:Q,nodex:K,nodey:ae,depth:_e}=H.pop();if(this.leaves[q]){nV(K,ae,_e,o,l,d,m,F,N);let be=1<<_e,ze=(K+0)/be,ke=(K+1)/be,je=(ae+0)/be,it=(ae+1)/be,ut=hf(ze,je,this.dem)*S,vt=hf(ke,je,this.dem)*S,dt=hf(ke,it,this.dem)*S,At=hf(ze,it,this.dem)*S,jt=iV(F[0],F[1],ut,N[0],F[1],vt,N[0],N[1],dt,y,v),Ct=iV(N[0],N[1],dt,F[0],N[1],At,F[0],F[1],ut,y,v),qt=Math.min(jt!==null?jt:Number.MAX_VALUE,Ct!==null?Ct:Number.MAX_VALUE);if(qt!==Number.MAX_VALUE)return qt;{let Tt=n.$.scaleAndAdd([],y,v,Q);if(oV(ut,vt,At,dt,rV(Tt[0],F[0],N[0]),rV(Tt[1],F[1],N[1]))>=Tt[2])return Q}continue}let ge=0;for(let be=0;be<this._siblingOffset.length;be++){nV((K<<1)+this._siblingOffset[be][0],(ae<<1)+this._siblingOffset[be][1],_e+1,o,l,d,m,F,N),F[2]=-100,N[2]=this.maximums[this.childOffsets[q]+be]*S;let ze=tV(F,N,y,v);if(ze!=null){let ke=ze;D[be]=ke;let je=!1;for(let it=0;it<ge&&!je;it++)ke>=D[L[it]]&&(L.splice(it,0,be),je=!0);je||(L[ge]=be),ge++}}for(let be=0;be<ge;be++){let ze=L[be];H.push({idx:this.childOffsets[q]+ze,t:D[ze],nodex:(K<<1)+this._siblingOffset[ze][0],nodey:(ae<<1)+this._siblingOffset[ze][1],depth:_e+1})}}return null}_addNode(o,l,d){return this.minimums.push(o),this.maximums.push(l),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(o,l,d,m,y){if(o[m].isLeaf(l,d)===1)return;this.childOffsets[y]||(this.childOffsets[y]=this.nodeCount);let v=m-1,S=o[v],T=0,D=0;for(let L=0;L<this._siblingOffset.length;L++){let F=2*l+this._siblingOffset[L][0],N=2*d+this._siblingOffset[L][1],H=S.getElevation(F,N),q=S.isLeaf(F,N),Q=this._addNode(H.min,H.max,q);q&&(T|=1<<L),D||(D=Q)}for(let L=0;L<this._siblingOffset.length;L++)T&1<<L||this._construct(o,2*l+this._siblingOffset[L][0],2*d+this._siblingOffset[L][1],v,D+L)}}function oV(a,o,l,d,m,y){return Gi(Gi(a,l,y),Gi(o,d,y),m)}function hf(a,o,l){let d=l.dim,m=xr(a*d-.5,0,d-1),y=xr(o*d-.5,0,d-1),v=Math.floor(m),S=Math.floor(y),T=Math.min(v+1,d-1),D=Math.min(S+1,d-1);return oV(l.get(v,S),l.get(T,S),l.get(v,D),l.get(T,D),m-v,y-S)}let Nne={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Bne(a,o,l){return(256*a*256+256*o+l)/10-1e4}function Une(a,o,l){return 256*a+o+l/256-32768}class RM{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,l,d,m=!1){if(this.uid=o,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return Ds(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;let y=this.dim=l.height-2,v=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.floatView=new Float32Array(l.data.buffer),this.borderReady=m,this._modifiedForSources={},!m){for(let T=0;T<y;T++)v[this._idx(-1,T)]=v[this._idx(0,T)],v[this._idx(y,T)]=v[this._idx(y-1,T)],v[this._idx(T,-1)]=v[this._idx(T,0)],v[this._idx(T,y)]=v[this._idx(T,y-1)];v[this._idx(-1,-1)]=v[this._idx(0,0)],v[this._idx(y,-1)]=v[this._idx(y-1,0)],v[this._idx(-1,y)]=v[this._idx(0,y-1)],v[this._idx(y,y)]=v[this._idx(y-1,y-1)]}let S=d==="terrarium"?Une:Bne;for(let T=0;T<v.length;++T){let D=4*T;this.floatView[T]=S(this.pixels[D],this.pixels[D+1],this.pixels[D+2])}this._timestamp=Oo.now()}_buildQuadTree(){this._tree=new sV(this)}get(o,l,d=!1){d&&(o=xr(o,-1,this.dim),l=xr(l,-1,this.dim));let m=this._idx(o,l);return this.floatView[m]}set(o,l,d){let m=this._idx(o,l),y=this.floatView[m];return this.floatView[m]=d,d-y}static getUnpackVector(o){return Nne[o]}_idx(o,l){if(o<-1||o>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(o+1)}static pack(o,l){let d=[0,0,0,0],m=RM.getUnpackVector(l),y=Math.floor((o+m[3])/m[2]);return d[2]=y%256,y=Math.floor(y/256),d[1]=y%256,y=Math.floor(y/256),d[0]=y,d}getPixels(){return new Aj({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,l,d){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let m=l*this.dim,y=l*this.dim+this.dim,v=d*this.dim,S=d*this.dim+this.dim;switch(l){case-1:m=y-1;break;case 1:y=m+1}switch(d){case-1:v=S-1;break;case 1:S=v+1}let T=-l*this.dim,D=-d*this.dim;for(let L=v;L<S;L++)for(let F=m;F<y;F++){let N=4*this._idx(F,L),H=4*this._idx(F+T,L+D);this.pixels[N+0]=o.pixels[H+0],this.pixels[N+1]=o.pixels[H+1],this.pixels[N+2]=o.pixels[H+2],this.pixels[N+3]=o.pixels[H+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}tt(RM,"DEMData"),tt(sV,"DemMinMaxQuadTree",{omit:["dem"]});class Kv{constructor(o,l,d){this._demTile=o,this._dem=this._demTile.dem,this._scale=l,this._offset=d}static create(o,l,d){let m=d||o.findDEMTileFor(l);if(!m||!m.dem)return;let y=m.dem,v=m.tileID,S=1<<l.canonical.z-v.canonical.z;return new Kv(m,y.dim/ti/S,[(l.canonical.x/S-v.canonical.x)*y.dim,(l.canonical.y/S-v.canonical.y)*y.dim])}tileCoordToPixel(o,l){let d=l*this._scale+this._offset[1],m=Math.floor(o*this._scale+this._offset[0]),y=Math.floor(d);return new ai(m,y)}getElevationAt(o,l,d,m){let y=o*this._scale+this._offset[0],v=l*this._scale+this._offset[1],S=Math.floor(y),T=Math.floor(v),D=this._dem;return m=!!m,d?Gi(Gi(D.get(S,T,m),D.get(S,T+1,m),v-T),Gi(D.get(S+1,T,m),D.get(S+1,T+1,m),v-T),y-S):D.get(S,T,m)}getElevationAtPixel(o,l,d){return this._dem.get(o,l,!!d)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*Ba(1,o)*this._dem.stride}}let aV={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},jne=CM.types,Vne=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-line-alignment"],Gne=["fill-extrusion-flood-light-ground-radius"],Hne=Math.pow(2,13),Wne=Math.pow(2,15)-1,lV=new ai(0,1),df=2147483648;function W1(a,o,l,d,m,y,v,S){a.emplaceBack((o<<1)+v,(l<<1)+y,(Math.floor(d*Hne)<<1)+m,Math.round(S))}function q1(a,o,l,d){a.emplaceBack(o.x*ti,o.y*ti,l?0:1,d?1:0)}function OM(a,o,l,d,m,y){a.emplaceBack(o.x,o.y,(l.x<<1)+d,(l.y<<1)+m,y)}function Y1(a,o,l){a.emplaceBack(o.x,o.y,o.z,l[0]*16384,l[1]*16384,l[2]*16384)}class cV{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class uV{constructor(){this.centroidXY=new ai(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ai(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ai(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new ai(this.max.x-this.min.x,this.max.y-this.min.y)}}class hV{constructor(){this.acc=new ai(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(o,l){o.min.x===Number.MAX_VALUE&&(o.min.x=o.max.x=l.x,o.min.y=o.max.y=l.y)}appendEdge(o,l,d){this.accCount++,this.acc._add(l);let m=!!this.borders;l.x<o.min.x?(o.min.x=l.x,m=!0):l.x>o.max.x&&(o.max.x=l.x,m=!0),l.y<o.min.y?(o.min.y=l.y,m=!0):l.y>o.max.y&&(o.max.y=l.y,m=!0),((l.x===0||l.x===ti)&&l.x===d.x)!=((l.y===0||l.y===ti)&&l.y===d.y)&&this.processBorderOverlap(l,d),m&&this.checkBorderIntersection(l,d)}checkBorderIntersection(o,l){l.x<0!=o.x<0&&this.addBorderIntersection(0,Gi(l.y,o.y,(0-l.x)/(o.x-l.x))),l.x>ti!=o.x>ti&&this.addBorderIntersection(1,Gi(l.y,o.y,(ti-l.x)/(o.x-l.x))),l.y<0!=o.y<0&&this.addBorderIntersection(2,Gi(l.x,o.x,(0-l.y)/(o.y-l.y))),l.y>ti!=o.y>ti&&this.addBorderIntersection(3,Gi(l.x,o.x,(ti-l.y)/(o.y-l.y)))}addBorderIntersection(o,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let d=this.borders[o];l<d[0]&&(d[0]=l),l>d[1]&&(d[1]=l)}processBorderOverlap(o,l){if(o.x===l.x){if(o.y===l.y)return;let d=o.x===0?0:1;this.addBorderIntersection(d,l.y),this.addBorderIntersection(d,o.y)}else{let d=o.y===0?2:3;this.addBorderIntersection(d,l.x),this.addBorderIntersection(d,o.x)}}centroid(){return this.accCount===0?new ai(0,0):new ai(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((o,l)=>o+ +(l[0]!==Number.MAX_VALUE),0):0}}function dV(a,o){let l=a.add(o)._unit(),d=xr(a.x*l.x+a.y*l.y,-1,1);var m,y,v;return m=Math.acos(d),Math.min(4,Math.max(-4,Math.tan(m)))/4*Wne*((y=a).x*(v=o).y-y.y*v.x<0?-1:1)}let qne=[a=>a.x<0,a=>a.x>ti,a=>a.y<0,a=>a.y>ti];function Yne(a,o,l,d){let m=[4];if(d===0)return m;l._mult(d);let y=a.sub(l),v=o.sub(l),S=[a,o,y,v];for(let T=0;T<4;T++)for(let D of S)if(qne[T](D)){m.push(T);break}return m}class pV{constructor(o){this.vertexArray=new jP,this.indexArray=new so,this.programConfigurations=new af(o.layers,{zoom:o.zoom,lut:o.lut},l=>Gne.includes(l)),this._segments=new ss,this.hiddenByLandmarkVertexArray=new tR,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ss}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(o,l,d,m=!1){let y=o.length;if(y>2){let v=Math.max(0,this._segments.get().length-1),S=this._segments._prepareSegment(4*y,this.vertexArray.length,2*this._segmentToGroundQuads[v].length),T;v!==this._segments.get().length-1&&(v++,this._segmentToGroundQuads[v]=[],this._segmentToRegionTriCounts[v]=[0,0,0,0,0]);{let D=o[0],L=o[1];T=dV(D.sub(o[y-1])._perp()._unit(),L.sub(D)._perp()._unit())}for(let D=0;D<y;D++){let L=D===y-1?0:D+1,F=o[D],N=o[L],H=o[L===y-1?0:L+1],q=N.sub(F)._perp()._unit(),Q=dV(q,H.sub(N)._perp()._unit()),K=T,ae=Q;if(kR(F,N,l)||m&&gV(F,l)&&gV(N,l)){T=Q;continue}let _e=S.vertexLength;OM(this.vertexArray,F,N,1,1,K),OM(this.vertexArray,F,N,1,0,K),OM(this.vertexArray,F,N,0,1,ae),OM(this.vertexArray,F,N,0,0,ae),S.vertexLength+=4;let ge=Yne(F,N,q,d);for(let be of ge)this._segmentToGroundQuads[v].push({id:_e,region:be}),this._segmentToRegionTriCounts[v][be]+=2,S.primitiveLength+=2;T=Q}}}prepareBorderSegments(){if(!this.hasData())return;let o=this._segments.get(),l=o.length;for(let d=0;d<l;d++)this._segmentToGroundQuads[d].sort((m,y)=>m.region-y.region);for(let d=0;d<l;d++){let m=this._segmentToGroundQuads[d],y=o[d],v=this._segmentToRegionTriCounts[d];v.reduce((T,D)=>T+D,0);let S=0;for(let T=0;T<=4;T++){let D=v[T];if(D!==0){let L=this.regionSegments[T];L||(L=this.regionSegments[T]=new ss);let F={vertexOffset:y.vertexOffset,primitiveOffset:y.primitiveOffset+S,vertexLength:y.vertexLength,primitiveLength:D};L.get().push(F)}S+=D}for(let T=0;T<m.length;T++){let D=m[T].id;this.indexArray.emplaceBack(D,D+1,D+3),this.indexArray.emplaceBack(D,D+3,D+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(o,l,d,m,y,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,o,l,d,m,y,v)}upload(o){this.hasData()&&(this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Ene.members),this.indexBuffer=o.createIndexBuffer(this.indexArray))}uploadPaintProperties(o){this.hasData()&&this.programConfigurations.upload(o)}update(o,l,d,m,y,v){this.hasData()&&this.programConfigurations.updatePaintArrays(o,l,d,m,y,v)}updateHiddenByLandmark(o){if(!this.hasData())return;let l=o.groundVertexCount+o.groundVertexArrayOffset;if(o.groundVertexCount===0)return;let d=o.flags&df?1:0;for(let m=o.groundVertexArrayOffset;m<l;++m)this.hiddenByLandmarkVertexArray.emplace(m,d);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(o){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=o.createVertexBuffer(this.hiddenByLandmarkVertexArray,Ane.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let o=0;o<=4;o++){let l=this.regionSegments[o];l&&l.destroy()}}}}class LM{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new so,this.footprintVertices=new uu,this.footprintSegments=[],this.layoutVertexArray=new Md,this.centroidVertexArray=new B5,this.wallVertexArray=new j5,this.indexArray=new so,this.programConfigurations=new af(o.layers,{zoom:o.zoom,lut:o.lut},l=>Vne.includes(l)),this.segments=new ss,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.groundEffect=new pV(o),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(o,l){}populate(o,l,d,m){this.features=[],this.hasPattern=PR("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=fM(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(let{feature:y,id:v,index:S,sourceLayerIndex:T}of o){let D=this.layers[0]._featureFilter.needGeometry,L=Dd(y,D);if(!this.layers[0]._featureFilter.filter(new er(this.zoom),L,d))continue;let F={id:v,sourceLayerIndex:T,index:S,geometry:D?L.geometry:du(y,d,m),properties:y.properties,type:y.type,patterns:{}},N=this.layoutVertexArray.length;if(this.hasPattern)this.features.push(RR("fill-extrusion",this.layers,F,this.zoom,l));else if(this.wallMode)for(let H of F.geometry)this.addFeature(F,[H],S,d,{},l.availableImages,m,l.brightness);else this.addFeature(F,F.geometry,S,d,{},l.availableImages,m,l.brightness);l.featureIndex.insert(y,F.geometry,S,T,this.index,N)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(o,l,d,m,y,v){for(let S of this.features){let{geometry:T}=S;if(this.wallMode)for(let D of T)this.addFeature(S,[D],S.index,l,d,m,y,v);else this.addFeature(S,T,S.index,l,d,m,y,v)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(o,l,d,m,y){let v=Object.keys(o).length!==0;if(v&&!this.stateDependentLayers.length)return;let S=v?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(o,l,S,d,m,y),this.groundEffect.update(o,l,S,d,m,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Dne),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.wallVertexBuffer=o.createVertexBuffer(this.wallVertexArray,Tne.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,Cne.members,!0)),this.groundEffect.upload(o)),this.groundEffect.uploadPaintProperties(o),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){this.groundEffect.uploadHiddenByLandmark(o),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,Mne.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,l,d,m,y,v,S,T){let D=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(o,{})/this.tileToMeter,L=[new ai(0,0),new ai(ti,ti)],F=S.projection,N=F.name==="globe",H=this.wallMode||jne[o.type]==="Polygon",q=new hV;q.centroidDataIndex=this.centroidData.length;let Q=new uV,K=this.layers[0].paint.get("fill-extrusion-base").evaluate(o,{},m)<=0,ae=this.layers[0].paint.get("fill-extrusion-height").evaluate(o,{},m),_e;if(Q.height=ae,Q.vertexArrayOffset=this.layoutVertexArray.length,Q.groundVertexArrayOffset=this.groundEffect.vertexArray.length,N&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new cM),this.wallMode){if(N)return void Ds("Non zero fill-extrusion-line-width is not yet supported on globe.");if(l.length!==1)return;_e=function(vt){let dt=vt[0].x===vt[vt.length-1].x&&vt[0].y===vt[vt.length-1].y;(function(Ri){let gi=0,ii=Ri.length;for(let Ki=0;Ki<ii;Ki++)gi+=(Ri[(Ki+1)%ii].x-Ri[Ki].x)*(Ri[(Ki+1)%ii].y+Ri[Ki].y);return gi>=0})(vt)||(vt=vt.reverse());let jt={isPolygon:dt,geometry:[],joinNormals:[]},Ct=[],qt=[],Tt=[],Ot=vt.length;if(Ot<(dt?3:2))return jt;for(;Ot>=2&&vt[Ot-1].equals(vt[Ot-2]);)Ot--;let Kt,Dt,ri,Xt,Vt,zi=0;for(;zi<Ot-1&&vt[zi].equals(vt[zi+1]);)zi++;dt&&(Kt=vt[Ot-2],Vt=vt[zi].sub(Kt)._unit()._perp());for(let Ri=zi;Ri<Ot;Ri++){if(ri=Ri===Ot-1?dt?vt[zi+1]:void 0:vt[Ri+1],ri&&vt[Ri].equals(ri))continue;Vt&&(Xt=Vt),Kt&&(Dt=Kt),Kt=vt[Ri],Vt=ri?ri.sub(Kt)._unit()._perp():Xt,Xt=Xt||Vt;let gi=Xt.add(Vt);gi.x===0&&gi.y===0||gi._unit();let ii=gi.x*Vt.x+gi.y*Vt.y,Ki=ii!==0?1/ii:1/0,Oi=Xt.x*Vt.y-Xt.y*Vt.x>0,Ei="miter";Ei==="miter"&&Ki>2&&(Ei="bevel");let nr=(or,sr,yr,jr)=>{let Ir=new ai(or.x,or.y),En=new ai(or.x,or.y);Ir.x-=sr.x*jr,Ir.y-=sr.y*jr,En.x-=sr.x*Math.max(yr,1),En.y-=sr.y*Math.max(yr,1),Tt.push(sr),Ct.push(Ir),qt.push(En)};if(Ei==="miter")gi._mult(Ki),nr(Kt,gi,1,0);else{let or=-Math.sqrt(Ki*Ki-1),sr=Oi?or:0,yr=Oi?0:or;Dt&&nr(Kt,Xt,sr,yr),ri&&nr(Kt,Vt,sr,yr)}}return jt.geometry=[...Ct,...qt.reverse(),Ct[0]],jt.joinNormals=[...Tt,...Tt.reverse(),Tt[Tt.length-1]],jt}(l[0]),l=[_e.geometry]}let ge=(vt,dt)=>vt<(dt.length-1)/2||vt===dt.length-1,be=this.wallMode?[l]:MM(l,500);for(let vt=be.length-1;vt>=0;vt--){let dt=be[vt];(dt.length===0||(ze=dt[0]).every(At=>At.x<=0)||ze.every(At=>At.x>=ti)||ze.every(At=>At.y<=0)||ze.every(At=>At.y>=ti))&&be.splice(vt,1)}var ze;let ke;if(N)ke=xV(be,L,m);else{ke=[];for(let vt of be)ke.push({polygon:vt,bounds:L})}let je=H?this.edgeRadius:0,it=je>0&&this.zoom<17,ut=(vt,dt)=>{if(vt.length===0)return!1;let At=vt[vt.length-1];return dt.x===At.x&&dt.y===At.y};for(let{polygon:vt,bounds:dt}of ke){let At=0,jt=0;for(let Ot of vt)H&&!Ot[0].equals(Ot[Ot.length-1])&&Ot.push(Ot[0]),jt+=H?Ot.length-1:Ot.length;let Ct=this.segments.prepareSegment((H?5:4)*jt,this.layoutVertexArray,this.indexArray);Q.footprintSegIdx<0&&(Q.footprintSegIdx=this.footprintSegments.length),Q.polygonSegIdx<0&&(Q.polygonSegIdx=this.polygonSegments.length);let qt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Tt=new cV;if(Tt.vertexOffset=this.footprintVertices.length,Tt.indexOffset=3*this.footprintIndices.length,Tt.ringIndices=[],H){let Ot=[],Kt=[];At=Ct.vertexLength;for(let ri=0;ri<vt.length;ri++){let Xt=vt[ri];Xt.length&&ri!==0&&Kt.push(Ot.length/2);let Vt=[],zi,Ri;zi=Xt[1].sub(Xt[0])._perp()._unit(),Tt.ringIndices.push(Xt.length-1);for(let gi=1;gi<Xt.length;gi++){let ii=Xt[gi],Ki=Xt[gi===Xt.length-1?1:gi+1],Oi=ii.clone();if(je){Ri=Ki.sub(ii)._perp()._unit();let Ei=zi.add(Ri)._unit(),nr=je*Math.min(4,1/(zi.x*Ei.x+zi.y*Ei.y));Oi.x+=nr*Ei.x,Oi.y+=nr*Ei.y,Oi.x=Math.round(Oi.x),Oi.y=Math.round(Oi.y),zi=Ri}if(!K||je!==0&&!it||ut(Vt,Oi)||Vt.push(Oi),W1(this.layoutVertexArray,Oi.x,Oi.y,0,0,1,1,0),this.wallMode){let Ei=ge(gi,Xt);q1(this.wallVertexArray,_e.joinNormals[gi],Ei,_e.isPolygon)}Ct.vertexLength++,this.footprintVertices.emplaceBack(ii.x,ii.y),Ot.push(ii.x,ii.y),N&&Y1(this.layoutVertexExtArray,F.projectTilePoint(Oi.x,Oi.y,m),F.upVector(m,Oi.x,Oi.y))}K&&(je===0||it)&&(Vt.length!==0&&ut(Vt,Vt[0])&&Vt.pop(),this.groundEffect.addData(Vt,dt,D))}let Dt=j1(Ot,Kt);for(let ri=0;ri<Dt.length;ri+=3)this.footprintIndices.emplaceBack(Tt.vertexOffset+Dt[ri+0],Tt.vertexOffset+Dt[ri+1],Tt.vertexOffset+Dt[ri+2]),this.indexArray.emplaceBack(At+Dt[ri],At+Dt[ri+2],At+Dt[ri+1]),Ct.primitiveLength++;Tt.indexCount+=Dt.length,Tt.vertexCount+=this.footprintVertices.length-Tt.vertexOffset}for(let Ot=0;Ot<vt.length;Ot++){let Kt=vt[Ot];q.startRing(Q,Kt[0]);let Dt=Kt.length>4&&yV(Kt[Kt.length-2],Kt[0],Kt[1]),ri=je?Xne(Kt[Kt.length-2],Kt[0],Kt[1],je):0,Xt=[],Vt,zi,Ri;zi=Kt[1].sub(Kt[0])._perp()._unit();let gi=!0;for(let ii=1,Ki=0;ii<Kt.length;ii++){let Oi=Kt[ii-1],Ei=Kt[ii],nr=Kt[ii===Kt.length-1?1:ii+1];if(q.appendEdge(Q,Ei,Oi),kR(Ei,Oi,dt)){je&&(zi=nr.sub(Ei)._perp()._unit(),gi=!gi);continue}let or=Ei.sub(Oi)._perp(),sr=or.x/(Math.abs(or.x)+Math.abs(or.y)),yr=or.y>0?1:0,jr=Oi.dist(Ei);if(Ki+jr>32768&&(Ki=0),je){Ri=nr.sub(Ei)._perp()._unit();let ar=mV(Oi,Ei,nr,fV(zi,Ri),je);isNaN(ar)&&(ar=0);let dn=Ei.sub(Oi)._unit();Oi=Oi.add(dn.mult(ri))._round(),Ei=Ei.add(dn.mult(-ar))._round(),ri=ar,zi=Ri,K&&this.zoom>=17&&(ut(Xt,Oi)||Xt.push(Oi),ut(Xt,Ei)||Xt.push(Ei))}let Ir=Ct.vertexLength,En=Kt.length>4&&yV(Oi,Ei,nr),In=vV(Ki,Dt,gi);if(W1(this.layoutVertexArray,Oi.x,Oi.y,sr,yr,0,0,In),W1(this.layoutVertexArray,Oi.x,Oi.y,sr,yr,0,1,In),this.wallMode){let ar=ge(ii-1,Kt),dn=_e.joinNormals[ii-1];q1(this.wallVertexArray,dn,!ar,_e.isPolygon),q1(this.wallVertexArray,dn,!ar,_e.isPolygon)}if(Ki+=jr,In=vV(Ki,En,!gi),Dt=En,W1(this.layoutVertexArray,Ei.x,Ei.y,sr,yr,0,0,In),W1(this.layoutVertexArray,Ei.x,Ei.y,sr,yr,0,1,In),this.wallMode){let ar=ge(ii,Kt),dn=_e.joinNormals[ii];q1(this.wallVertexArray,dn,!ar,_e.isPolygon),q1(this.wallVertexArray,dn,!ar,_e.isPolygon)}if(Ct.vertexLength+=4,this.indexArray.emplaceBack(Ir+0,Ir+1,Ir+2),this.indexArray.emplaceBack(Ir+1,Ir+3,Ir+2),Ct.primitiveLength+=2,je){let ar=At+(ii===1?Kt.length-2:ii-2),dn=ii===1?At:ar+1;if(this.indexArray.emplaceBack(Ir+1,ar,Ir+3),this.indexArray.emplaceBack(ar,dn,Ir+3),Ct.primitiveLength+=2,Vt===void 0&&(Vt=Ir),!kR(nr,Kt[ii],dt)){let fn=ii===Kt.length-1?Vt:Ct.vertexLength;this.indexArray.emplaceBack(Ir+2,Ir+3,fn),this.indexArray.emplaceBack(Ir+3,fn+1,fn),this.indexArray.emplaceBack(Ir+3,dn,fn+1),Ct.primitiveLength+=3}gi=!gi}if(N){let ar=this.layoutVertexExtArray,dn=F.projectTilePoint(Oi.x,Oi.y,m),fn=F.projectTilePoint(Ei.x,Ei.y,m),Un=F.upVector(m,Oi.x,Oi.y),Ms=F.upVector(m,Ei.x,Ei.y);Y1(ar,dn,Un),Y1(ar,dn,Un),Y1(ar,fn,Ms),Y1(ar,fn,Ms)}}H&&(At+=Kt.length-1),K&&je&&this.zoom>=17&&(Xt.length!==0&&ut(Xt,Xt[0])&&Xt.pop(),this.groundEffect.addData(Xt,dt,D,je>0))}this.footprintSegments.push(Tt),qt.triangleCount=this.indexArray.length-qt.triangleArrayOffset,this.polygonSegments.push(qt),++Q.footprintSegLen,++Q.polygonSegLen}if(Q.vertexCount=this.layoutVertexArray.length-Q.vertexArrayOffset,Q.groundVertexCount=this.groundEffect.vertexArray.length-Q.groundVertexArrayOffset,Q.vertexCount!==0){if(Q.centroidXY=q.borders?lV:this.encodeCentroid(q,Q),this.centroidData.push(Q),q.borders){this.featuresOnBorder.push(q);let vt=this.featuresOnBorder.length-1;for(let dt=0;dt<q.borders.length;dt++)q.borders[dt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[dt].push(vt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,y,v,m,T),this.groundEffect.addPaintPropertiesData(o,d,y,v,m,T),this.maxHeight=Math.max(this.maxHeight,ae)}}sortBorders(){for(let o=0;o<this.borderFeatureIndices.length;o++)this.borderFeatureIndices[o].sort((l,d)=>this.featuresOnBorder[l].borders[o][0]-this.featuresOnBorder[d].borders[o][0])}splitToSubtiles(){let o=[];for(let S=0;S<this.centroidData.length;S++){let T=this.centroidData[S],D=+(T.min.y+T.max.y>ti),L=2*D+(+(T.min.x+T.max.x>ti)^D);for(let F=0;F<T.polygonSegLen;F++){let N=T.polygonSegIdx+F;o.push({centroidIdx:S,subtile:L,polygonSegmentIdx:N,triangleSegmentIdx:this.polygonSegments[N].triangleSegIdx})}}let l=new so;o.sort((S,T)=>S.triangleSegmentIdx===T.triangleSegmentIdx?S.subtile-T.subtile:S.triangleSegmentIdx-T.triangleSegmentIdx);let d=0,m=0,y=0;for(let S of o){if(S.triangleSegmentIdx!==d)break;y++}let v=o.length;for(;m!==o.length;){d=o[m].triangleSegmentIdx;let S=0,T=m,D=m;for(let L=T;L<y&&o[L].subtile===S;L++)D++;for(;T!==y;){let L=o[T];S=L.subtile;let F=this.centroidData[L.centroidIdx].min.clone(),N=this.centroidData[L.centroidIdx].max.clone(),H={vertexOffset:this.segments.segments[d].vertexOffset,primitiveOffset:l.length,vertexLength:this.segments.segments[d].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let q=T;q<D;q++){let Q=o[q],K=this.polygonSegments[Q.polygonSegmentIdx],ae=this.centroidData[Q.centroidIdx].min,_e=this.centroidData[Q.centroidIdx].max,ge=this.indexArray.uint16;for(let be=K.triangleArrayOffset;be<K.triangleArrayOffset+K.triangleCount;be++)l.emplaceBack(ge[3*be],ge[3*be+1],ge[3*be+2]);H.primitiveLength+=K.triangleCount,F.x=Math.min(F.x,ae.x),F.y=Math.min(F.y,ae.y),N.x=Math.max(N.x,_e.x),N.y=Math.max(N.y,_e.y)}H.primitiveLength>0&&this.triangleSubSegments.push({segment:H,min:F,max:N}),T=D;for(let q=T;q<y&&o[q].subtile===o[T].subtile;q++)D++}m=y;for(let L=m;L<v&&o[L].triangleSegmentIdx===o[m].triangleSegmentIdx;L++)y++}l._trim(),this.indexArray=l}getVisibleSegments(o,l,d){let m=new ss;if(this.wallMode){for(let Q of this.triangleSubSegments)m.segments.push(Q.segment);return m}let y=0,v=0,S=1<<o.canonical.z;if(l){let Q=l.getMinMaxForTile(o);Q&&(y=Q.min,v=Q.max)}v+=this.maxHeight;let T=o.toUnwrapped(),D,L=[T.canonical.x/S+T.wrap,T.canonical.y/S],F=[(T.canonical.x+1)/S+T.wrap,(T.canonical.y+1)/S],N=(Q,K,ae)=>[Q[0]*(1-ae[0])+K[0]*ae[0],Q[1]*(1-ae[1])+K[1]*ae[1]],H=[],q=[];for(let Q of this.triangleSubSegments){H[0]=Q.min.x/ti,H[1]=Q.min.y/ti,q[0]=Q.max.x/ti,q[1]=Q.max.y/ti;let K=N(L,F,H),ae=N(L,F,q);if(new Jn([K[0],K[1],y],[ae[0],ae[1],v]).intersectsPrecise(d)===0){D&&(m.segments.push(D),D=void 0);continue}let _e=Q.segment;D&&D.vertexOffset!==_e.vertexOffset&&(m.segments.push(D),D=void 0),D?(D.vertexLength+=_e.vertexLength,D.primitiveLength+=_e.primitiveLength):D={vertexOffset:_e.vertexOffset,primitiveLength:_e.primitiveLength,vertexLength:_e.vertexLength,primitiveOffset:_e.primitiveOffset,sortKey:void 0,vaos:{}}}return D&&m.segments.push(D),m}encodeCentroid(o,l){let d=o.centroid(),m=l.span(),y=Math.min(7,Math.round(m.x*this.tileToMeter/10)),v=Math.min(7,Math.round(m.y*this.tileToMeter/10));return new ai(xr(d.x,1,ti-1)<<3|y,xr(d.y,1,ti-1)<<3|v)}encodeBorderCentroid(o){if(!o.borders)return new ai(0,0);let l=o.borders,d=Number.MAX_VALUE;if(l[0][0]!==d||l[1][0]!==d){let m=l[0][0]!==d?0:1;return new ai(6|(l[0][0]!==d?0:65528),(l[m][0]+l[m][1])/2<<3|6)}{let m=l[2][0]!==d?2:3;return new ai((l[m][0]+l[m][1])/2<<3|6,6|(l[2][0]!==d?0:65528))}}showCentroid(o){let l=this.centroidData[o.centroidDataIndex];l.flags&=df,l.centroidXY.x=0,l.centroidXY.y=0,this.writeCentroidToBuffer(l)}writeCentroidToBuffer(o){this.groundEffect.updateHiddenByLandmark(o);let l=o.vertexArrayOffset,d=o.vertexCount+o.vertexArrayOffset,m=o.flags&df?lV:o.centroidXY,y=this.centroidVertexArray.geta_centroid_pos0(l);if(this.centroidVertexArray.geta_centroid_pos1(l)!==m.y||y!==m.x){for(let v=l;v<d;++v)this.centroidVertexArray.emplace(v,m.x,m.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let o of this.centroidData)this.writeCentroidToBuffer(o)}updateReplacement(o,l,d){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;let m=l.getReplacementRegionsForTile(o.toUnwrapped());if(FR(this.activeReplacements,m))return;if(this.activeReplacements=m,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let v of this.centroidData)v.flags&=2147483647;let y=[];for(let v of this.activeReplacements){if(v.order<d)continue;let S=Math.pow(2,v.footprintTileId.canonical.z-o.canonical.z);for(let T of this.centroidData)if(!(T.flags&df||v.min.x>T.max.x||T.min.x>v.max.x||v.min.y>T.max.y||T.min.y>v.max.y))for(let D=0;D<T.footprintSegLen;D++){let L=this.footprintSegments[T.footprintSegIdx+D];if(y.length=0,$ne(this.footprintVertices,L.vertexOffset,L.vertexCount,v.footprintTileId.canonical,o.canonical,y),Zj(v.footprint,y,this.footprintIndices.uint16,L.indexOffset,L.indexCount,-L.vertexOffset,-S)){T.flags|=df;break}}}for(let v of this.centroidData)this.writeCentroidToBuffer(v);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(o,l,d){let m=!1;for(let y=0;y<d.footprintSegLen;y++){let v=this.footprintSegments[d.footprintSegIdx+y],S=0;for(let T of v.ringIndices){for(let D=S,L=T+S-1;D<T+S;L=D++){let F=this.footprintVertices.int16[2*(D+v.vertexOffset)+0],N=this.footprintVertices.int16[2*(D+v.vertexOffset)+1],H=this.footprintVertices.int16[2*(L+v.vertexOffset)+1];N>l!=H>l&&o<(this.footprintVertices.int16[2*(L+v.vertexOffset)+0]-F)*(l-N)/(H-N)+F&&(m=!m)}S=T}}return m}getHeightAtTileCoord(o,l){let d=Number.NEGATIVE_INFINITY,m=!0,y=4*(o+ti)*ti+(l+ti);if(this.partLookup.hasOwnProperty(y)){let v=this.partLookup[y];return v?{height:v.height,hidden:!!(v.flags&df)}:void 0}for(let v of this.centroidData)o>v.max.x||v.min.x>o||l>v.max.y||v.min.y>l||this.footprintContainsPoint(o,l,v)&&v&&v.height>d&&(d=v.height,this.partLookup[y]=v,m=!!(v.flags&df));if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:m};this.partLookup[y]=void 0}}function fV(a,o){let l=a.add(o)._unit();return a.x*l.x+a.y*l.y}function Xne(a,o,l,d){let m=o.sub(a)._perp()._unit(),y=l.sub(o)._perp()._unit();return mV(a,o,l,fV(m,y),d)}function mV(a,o,l,d,m){let y=Math.sqrt(1-d*d);return Math.min(a.dist(o)/3,o.dist(l)/3,m*y/d)}function kR(a,o,l){return a.x<l[0].x&&o.x<l[0].x||a.x>l[1].x&&o.x>l[1].x||a.y<l[0].y&&o.y<l[0].y||a.y>l[1].y&&o.y>l[1].y}function gV(a,o){return a.x<o[0].x||a.x>o[1].x||a.y<o[0].y||a.y>o[1].y}function yV(a,o,l){if(a.x<0||a.x>=ti||o.x<0||o.x>=ti||l.x<0||l.x>=ti)return!1;let d=l.sub(o),m=d.perp(),y=a.sub(o);return(d.x*y.x+d.y*y.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(y.x*y.x+y.y*y.y))>-.866&&m.x*y.x+m.y*y.y<0}function vV(a,o,l){let d=o?2|a:-3&a;return l?1|d:-2&d}function _V(){let a=Math.PI/32,o=Math.tan(a),l=qv;return l*Math.sqrt(1+2*o*o)-l}function xV(a,o,l){let d=1<<l.z,m=ol(l.x/d),y=ol((l.x+1)/d),v=_o(l.y/d),S=_o((l.y+1)/d);return function(T,D,L,F,N=0,H){let q=[];if(!T.length||!L||!F)return q;let Q=(ke,je)=>{for(let it of ke)q.push({polygon:it,bounds:je})},K=Math.ceil(Math.log2(L)),ae=Math.ceil(Math.log2(F)),_e=K-ae,ge=[];for(let ke=0;ke<Math.abs(_e);ke++)ge.push(_e>0?0:1);for(let ke=0;ke<Math.min(K,ae);ke++)ge.push(0),ge.push(1);let be=T;if(be=DM(be,D[0].y-N,D[1].y+N,1),be=DM(be,D[0].x-N,D[1].x+N,0),!be.length)return q;let ze=[];for(ge.length?ze.push({polygons:be,bounds:D,depth:0}):Q(be,D);ze.length;){let ke=ze.pop(),je=ke.depth,it=ge[je],ut=ke.bounds[0],vt=ke.bounds[1],dt=it===0?ut.x:ut.y,At=it===0?vt.x:vt.y,jt=H?H(it,dt,At):.5*(dt+At),Ct=DM(ke.polygons,dt-N,jt+N,it),qt=DM(ke.polygons,jt-N,At+N,it);if(Ct.length){let Tt=[ut,new ai(it===0?jt:vt.x,it===1?jt:vt.y)];ge.length>je+1?ze.push({polygons:Ct,bounds:Tt,depth:je+1}):Q(Ct,Tt)}if(qt.length){let Tt=[new ai(it===0?jt:ut.x,it===1?jt:ut.y),vt];ge.length>je+1?ze.push({polygons:qt,bounds:Tt,depth:je+1}):Q(qt,Tt)}}return q}(a,o,Math.ceil((y-m)/11.25),Math.ceil((v-S)/11.25),1,(T,D,L)=>{if(T===0)return .5*(D+L);{let F=_o((l.y+D/ti)/d);return(fh(.5*(_o((l.y+L/ti)/d)+F))*d-l.y)*ti}})}function $ne(a,o,l,d,m,y){let v=Math.pow(2,d.z-m.z);for(let S=0;S<l;S++){let T=a.int16[2*(S+o)+0],D=a.int16[2*(S+o)+1];T=(T+m.x*ti)*v-d.x*ti,D=(D+m.y*ti)*v-d.y*ti,y.push(new ai(T,D))}}let bV,wV;function X1(a,o){return a.x*o.x+a.y*o.y}function SV(a,o){if(a.length===1){let l=0,d=o[l++],m;for(;!m||d.equals(m);)if(m=o[l++],!m)return 1/0;for(;l<o.length;l++){let y=o[l],v=a[0],S=m.sub(d),T=y.sub(d),D=v.sub(d),L=X1(S,S),F=X1(S,T),N=X1(T,T),H=X1(D,S),q=X1(D,T),Q=L*N-F*F,K=(N*H-F*q)/Q,ae=(L*q-F*H)/Q,_e=d.z*(1-K-ae)+m.z*K+y.z*ae;if(isFinite(_e))return _e}return 1/0}{let l=1/0;for(let d of o)l=Math.min(l,d.z);return l}}function EV(a,o,l,d,m,y,v,S){let T=v*m.getElevationAt(a,o,!0,!0),D=y[0]!==0,L=D?y[1]===0?v*(y[0]/7-450):v*function(F,N,H){let q=Math.floor(N[0]/8),Q=Math.floor(N[1]/8),K=10*(N[0]-8*q),ae=10*(N[1]-8*Q),_e=F.getElevationAt(q,Q,!0,!0),ge=F.getMeterToDEM(H),be=Math.floor(.5*(K*ge-1)),ze=Math.floor(.5*(ae*ge-1)),ke=F.tileCoordToPixel(q,Q),je=2*be+1,it=2*ze+1,ut=function(qt,Tt,Ot,Kt,Dt){return[qt.getElevationAtPixel(Tt,Ot,!0),qt.getElevationAtPixel(Tt+Dt,Ot,!0),qt.getElevationAtPixel(Tt,Ot+Dt,!0),qt.getElevationAtPixel(Tt+Kt,Ot+Dt,!0)]}(F,ke.x-be,ke.y-ze,je,it),vt=Math.abs(ut[0]-ut[1]),dt=Math.abs(ut[2]-ut[3]),At=Math.abs(ut[0]-ut[2])+Math.abs(ut[1]-ut[3]),jt=Math.min(.25,.5*ge*(vt+dt)/je),Ct=Math.min(.25,.5*ge*At/it);return _e+Math.max(jt*K,Ct*ae)}(m,y,S):T;return{base:T+(l===0)?-1:l,top:D?Math.max(L+d,T+l+2):T+d}}tt(LM,"FillExtrusionBucket",{omit:["layers","features"]}),tt(uV,"PartData"),tt(cV,"FootprintSegment"),tt(hV,"BorderCentroidData"),tt(pV,"GroundEffect");let Zne=hn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Qne}=Zne,Kne=hn([{name:"a_packed",components:4,type:"Float32"}]),{members:Jne}=Kne,ese=hn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:tse}=ese,ise=hn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),rse=hn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),nse=hn([{name:"a_projected_pos",components:4,type:"Float32"}],4);hn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let MV=hn([{name:"a_z_offset",components:1,type:"Float32"}],4),sse=hn([{name:"a_texb",components:2,type:"Uint16"}]),ose=hn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),ase=hn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);hn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let TV=hn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),lse=hn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);hn([{name:"triangle",components:3,type:"Uint16"}]),hn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),hn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),hn([{type:"Float32",name:"offsetX"}]),hn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class AV{constructor(o,l){this.width=o,this.height=l,this.nextRow=0,this.image=new uf({width:o,height:l}),this.positions={},this.uploaded=!1}getDash(o,l){let d=this.getKey(o,l);return this.positions[d]}trim(){let o=this.width,l=this.height=dd(this.nextRow);this.image.resize({width:o,height:l})}getKey(o,l){return o.join(",")+l}getDashRanges(o,l,d){let m=[],y=o.length%2==1?-o[o.length-1]*d:0,v=o[0]*d,S=!0;m.push({left:y,right:v,isDash:S,zeroLength:o[0]===0});let T=o[0];for(let D=1;D<o.length;D++){S=!S;let L=o[D];y=T*d,T+=L,v=T*d,m.push({left:y,right:v,isDash:S,zeroLength:L===0})}return m}addRoundDash(o,l,d){let m=l/2;for(let y=-d;y<=d;y++){let v=this.width*(this.nextRow+d+y),S=0,T=o[S];for(let D=0;D<this.width;D++){D/T.right>1&&(T=o[++S]);let L=Math.abs(D-T.left),F=Math.abs(D-T.right),N=Math.min(L,F),H,q=y/d*(m+1);if(T.isDash){let Q=m-Math.abs(q);H=Math.sqrt(N*N+Q*Q)}else H=m-Math.sqrt(N*N+q*q);this.image.data[v+D]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(o,l){for(let T=o.length-1;T>=0;--T){let D=o[T],L=o[T+1];D.zeroLength?o.splice(T,1):L&&L.isDash===D.isDash&&(L.left=D.left,o.splice(T,1))}let d=o[0],m=o[o.length-1];d.isDash===m.isDash&&(d.left=m.left-this.width,m.right=d.right+this.width);let y=this.width*this.nextRow,v=0,S=o[v];for(let T=0;T<this.width;T++){T/S.right>1&&(S=o[++v]);let D=Math.abs(T-S.left),L=Math.abs(T-S.right),F=Math.min(D,L);this.image.data[y+T]=Math.max(0,Math.min(255,(S.isDash?F:-F)+l+128))}}addDash(o,l){let d=this.getKey(o,l);if(this.positions[d])return this.positions[d];let m=l==="round",y=m?7:0,v=2*y+1;if(this.nextRow+v>this.height)return Ds("LineAtlas out of space"),null;o.length===0&&o.push(1);let S=0;for(let L=0;L<o.length;L++)o[L]<0&&(Ds("Negative value is found in line dasharray, replacing values with 0"),o[L]=0),S+=o[L];if(S!==0){let L=this.width/S,F=this.getDashRanges(o,this.width,L);m?this.addRoundDash(F,L,y):this.addRegularDash(F,l==="square"?.5*L:0)}let T=this.nextRow+y;this.nextRow+=v;let D={tl:[T,y],br:[S,0]};return this.positions[d]=D,D}}tt(AV,"LineAtlas");let cse=CM.types,use=Math.cos(Math.PI/180*37.5),hse=Math.cos(Math.PI/180*5);class zM{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new VP,this.layoutVertexArray2=new tf,this.patternVertexArray=new rf,this.indexArray=new so,this.programConfigurations=new af(o.layers,{zoom:o.zoom,lut:o.lut}),this.segments=new ss,this.maxLineLength=0,this.zOffsetVertexArray=new Vv,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.tessellationStep=o.tessellationStep?o.tessellationStep:ti/64}updateFootprints(o,l){}populate(o,l,d,m){this.hasPattern=PR("line",this.layers,l);let y=this.layers[0].layout.get("line-sort-key"),v=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!v.isConstant()||!!v.constantOr(0);let S=[];for(let{feature:F,id:N,index:H,sourceLayerIndex:q}of o){let Q=this.layers[0]._featureFilter.needGeometry,K=Dd(F,Q);if(!this.layers[0]._featureFilter.filter(new er(this.zoom),K,d))continue;let ae=y?y.evaluate(K,{},d):void 0,_e={id:N,properties:F.properties,type:F.type,sourceLayerIndex:q,index:H,geometry:Q?K.geometry:du(F,d,m),patterns:{},sortKey:ae};S.push(_e)}y&&S.sort((F,N)=>F.sortKey-N.sortKey);let{lineAtlas:T,featureIndex:D}=l,L=this.addConstantDashes(T);for(let F of S){let{geometry:N,index:H,sourceLayerIndex:q}=F;if(L&&this.addFeatureDashes(F,T),this.hasPattern){let Q=RR("line",this.layers,F,this.zoom,l);this.patternFeatures.push(Q)}else this.addFeature(F,N,H,d,T.positions,l.availableImages,l.brightness);D.insert(o[H].feature,N,H,q,this.index)}}addConstantDashes(o){let l=!1;for(let d of this.layers){let m=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if(m.kind!=="constant"||y.kind!=="constant")l=!0;else{let v=y.value,S=m.value;if(!S)continue;o.addDash(S,v)}}return l}addFeatureDashes(o,l){let d=this.zoom;for(let m of this.layers){let y=m.paint.get("line-dasharray").value,v=m.layout.get("line-cap").value;if(y.kind==="constant"&&v.kind==="constant")continue;let S,T;if(y.kind==="constant"){if(S=y.value,!S)continue}else S=y.evaluate({zoom:d},o);T=v.kind==="constant"?v.value:v.evaluate({zoom:d},o),l.addDash(S,T),o.patterns[m.id]=l.getKey(S,T)}}update(o,l,d,m,y){let v=Object.keys(o).length!==0;v&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(o,l,v?this.stateDependentLayers:this.layers,d,m,y)}addFeatures(o,l,d,m,y,v){for(let S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,l,d,m,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,Jne)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=o.createVertexBuffer(this.patternVertexArray,tse)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,MV.members,!0)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Qne),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,l,d,m,y,v,S){let T=this.layers[0].layout,D=T.get("line-join").evaluate(o,{}),L=T.get("line-cap").evaluate(o,{}),F=T.get("line-miter-limit"),N=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(let H of l)this.addLine(H,o,m,D,L,F,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,y,v,m,S)}addLine(o,l,d,m,y,v,S){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;let T={zoom:this.zoom,lineProgress:void 0},D=this.layers[0].layout,L=m==="none";if(this.patternJoinNone=this.hasPattern&&L,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ke=0;ke<o.length-1;ke++)this.totalDistance+=o[ke].dist(o[ke+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let F=cse[l.type]==="Polygon",N=o.length;for(;N>=2&&o[N-1].equals(o[N-2]);)N--;let H=0;for(;H<N-1&&o[H].equals(o[H+1]);)H++;if(N<(F?3:2))return;m==="bevel"&&(v=1.05);let q=this.overscaling<=16?15*ti/(512*this.overscaling):0,Q=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray),K,ae,_e,ge,be,ze;this.e1=this.e2=-1,F&&(K=o[N-2],be=o[H].sub(K)._unit()._perp());for(let ke=H;ke<N;ke++){if(_e=ke===N-1?F?o[H+1]:void 0:o[ke+1],_e&&o[ke].equals(_e))continue;if(be&&(ge=be),K&&(ae=K),K=o[ke],this.hasZOffset){let Tt=D.get("line-z-offset").value;if(Tt.kind==="constant")ze=Tt.value;else{if(this.lineClips){let Ot=this.totalDistance/(this.lineClips.end-this.lineClips.start);T.lineProgress=(Ot*this.lineClips.start+this.distance+(ae?ae.dist(K):0))/Ot}else Ds(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),T.lineProgress=0;ze=Tt.evaluate(T,l)}ze=ze||0}be=_e?_e.sub(K)._unit()._perp():ge,ge=ge||be;let je=ae&&_e,it=je?m:F||L?"butt":y,ut=ge.x*be.x+ge.y*be.y;if(L){let Tt=function(Ot){if(Ot.patternJoinNone){let Kt=Ot.segmentPoints.length/2,Dt=Ot.lineSoFar-Ot.segmentStart;for(let ri=0;ri<Kt;++ri){let Xt=Ot.segmentPoints[2*ri+1],Vt=Math.round(Ot.segmentPoints[2*ri])+.5+.25*Xt;Ot.patternVertexArray.emplaceBack(Vt,Dt,Ot.segmentStart),Ot.patternVertexArray.emplaceBack(Vt,Dt,Ot.segmentStart)}Ot.segmentPoints.length=0}Ot.e1=Ot.e2=-1};if(je&&ut<hse){this.updateDistance(ae,K),this.addCurrentVertex(K,ge,1,1,Q,ze),Tt(this),this.addCurrentVertex(K,be,-1,-1,Q,ze);continue}if(ae){if(!_e){this.updateDistance(ae,K),this.addCurrentVertex(K,ge,1,1,Q,ze),Tt(this);continue}it="miter"}}let vt=ge.add(be);vt.x===0&&vt.y===0||vt._unit();let dt=vt.x*be.x+vt.y*be.y,At=dt!==0?1/dt:1/0,jt=2*Math.sqrt(2-2*dt),Ct=dt<use&&ae&&_e,qt=ge.x*be.y-ge.y*be.x>0;if(Ct&&ke>H){let Tt=K.dist(ae);if(Tt>2*q){let Ot=K.sub(K.sub(ae)._mult(q/Tt)._round());this.updateDistance(ae,Ot),this.addCurrentVertex(Ot,ge,0,0,Q,ze),ae=Ot}}if(je&&it==="round"&&(At<S?it="miter":At<=2&&(it="fakeround")),it==="miter"&&At>v&&(it="bevel"),it==="bevel"&&(At>2&&(it="flipbevel"),At<v&&(it="miter")),ae&&this.updateDistance(ae,K),it==="miter")vt._mult(At),this.addCurrentVertex(K,vt,0,0,Q,ze);else if(it==="flipbevel"){if(At>100)vt=be.mult(-1);else{let Tt=At*ge.add(be).mag()/ge.sub(be).mag();vt._perp()._mult(Tt*(qt?-1:1))}this.addCurrentVertex(K,vt,0,0,Q,ze),this.addCurrentVertex(K,vt.mult(-1),0,0,Q,ze)}else if(it==="bevel"||it==="fakeround"){let Tt=-Math.sqrt(At*At-1),Ot=qt?Tt:0,Kt=qt?0:Tt;if(ae&&this.addCurrentVertex(K,ge,Ot,Kt,Q,ze),it==="fakeround"){let Dt=Math.round(180*jt/Math.PI/20);for(let ri=1;ri<Dt;ri++){let Xt=ri/Dt;if(Xt!==.5){let zi=Xt-.5;Xt+=Xt*zi*(Xt-1)*((1.0904+ut*(ut*(3.55645-1.43519*ut)-3.2452))*zi*zi+(.848013+ut*(.215638*ut-1.06021)))}let Vt=be.sub(ge)._mult(Xt)._add(ge)._unit()._mult(qt?-1:1);this.addHalfVertex(K,Vt.x,Vt.y,!1,qt,0,Q,ze)}}_e&&this.addCurrentVertex(K,be,-Ot,-Kt,Q,ze)}else it==="butt"?this.addCurrentVertex(K,vt,0,0,Q,ze):it==="square"?(ae||this.addCurrentVertex(K,vt,-1,-1,Q,ze),this.addCurrentVertex(K,vt,0,0,Q,ze),ae&&this.addCurrentVertex(K,vt,1,1,Q,ze)):it==="round"&&(ae&&(this.addCurrentVertex(K,ge,0,0,Q,ze),this.addCurrentVertex(K,ge,1,1,Q,ze,!0)),_e&&(this.addCurrentVertex(K,be,-1,-1,Q,ze,!0),this.addCurrentVertex(K,be,0,0,Q,ze)));if(Ct&&ke<N-1){let Tt=K.dist(_e);if(Tt>2*q){let Ot=K.add(_e.sub(K)._mult(q/Tt)._round());this.updateDistance(K,Ot),this.addCurrentVertex(Ot,be,0,0,Q,ze),K=Ot}}}}addVerticesTo(o,l,d,m,y,v,S,T,D,L){let F=(l.w-o.w)/this.tessellationStep|0;if(F>1){this.lineSoFar=o.w;let N=(l.x-o.x)/F,H=(l.y-o.y)/F,q=(l.z-o.z)/F,Q=(l.w-o.w)/F;for(let K=1;K<F;++K)o.x+=N,o.y+=H,o.z+=q,this.lineSoFar+=Q,this.addHalfVertex(o,d,m,L,!1,S,D,o.z),this.addHalfVertex(o,y,v,L,!0,-T,D,o.z)}this.lineSoFar=l.w,this.addHalfVertex(l,d,m,L,!1,S,D,l.z),this.addHalfVertex(l,y,v,L,!0,-T,D,l.z)}addCurrentVertex(o,l,d,m,y,v,S=!1){let T=l.x+l.y*d,D=l.y-l.x*d,L=l.y*m-l.x,F=-l.y-l.x*m;if(v!=null){let H=ti+10,q=v,Q=new Hj(o.x,o.y,q,this.lineSoFar),K=CV(o,-10,H),ae=this.lineSoFar;if(this.currentVertex)if(K){let _e=this.currentVertexIsOutside,ge=this.currentVertex,be=new Hj(o.x,o.y,q,this.lineSoFar);qj(ge,be,-10,H),CV(be,-10,H)||(_e&&(this.e1=this.e2=-1,this.lineSoFar=ge.w,this.addHalfVertex(ge,T,D,S,!1,d,y,ge.z),this.addHalfVertex(ge,L,F,S,!0,-m,y,ge.z)),this.addVerticesTo(ge,be,T,D,L,F,d,m,y,S))}else{let _e=this.currentVertex;this.currentVertexIsOutside&&(qj(_e,Q,-10,H),this.e1=this.e2=-1,this.lineSoFar=_e.w,this.addHalfVertex(_e,T,D,S,!1,d,y,_e.z),this.addHalfVertex(_e,L,F,S,!0,-m,y,_e.z)),this.addVerticesTo(_e,Q,T,D,L,F,d,m,y,S)}else K||(this.addHalfVertex(o,T,D,S,!1,d,y,v),this.addHalfVertex(o,L,F,S,!0,-m,y,v));this.currentVertex=Q,this.currentVertexIsOutside=K,this.lineSoFar=ae}else this.addHalfVertex(o,T,D,S,!1,d,y,v),this.addHalfVertex(o,L,F,S,!0,-m,y,v)}addHalfVertex({x:o,y:l},d,m,y,v,S,T,D){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),v||this.segmentPoints.push(this.lineSoFar-this.segmentStart,S)),this.layoutVertexArray.emplaceBack((o<<1)+(y?1:0),(l<<1)+(v?1:0),Math.round(63*d)+128,Math.round(63*m)+128,1+(S===0?0:S<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let L=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),T.primitiveLength++),v?this.e2=L:this.e1=L,D!=null&&this.zOffsetVertexArray.emplaceBack(D)}updateScaledDistance(){if(this.lineClips){let o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,l){this.distance+=o.dist(l),this.updateScaledDistance()}}function CV(a,o,l){return a.x<o||a.x>l||a.y<o||a.y>l}let DV,IV;function PV(a,o,l){return o*(ti/(a.tileSize*Math.pow(2,l-a.tileID.overscaledZ)))}function RV(a,o){return 1/PV(a,1,o.tileZoom)}function OV(a,o,l,d){return a.translatePosMatrix(d||o.tileID.projMatrix,o,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}tt(zM,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let LV=a=>{let o=[];zV(a)&&o.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&o.push("RENDER_LINE_GRADIENT");let l=a.paint.get("line-trim-offset");l[0]===0&&l[1]===0||o.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&o.push("RENDER_LINE_BORDER");let d=a.layout.get("line-join").constantOr("miter")==="none",m=!!a.paint.get("line-pattern").constantOr(1);return d&&m&&o.push("LINE_JOIN_NONE"),o};function zV(a){let o=a.paint.get("line-dasharray").value;return o.value||o.kind!=="constant"}class FV{constructor(o){this._stringToNumber={},this._numberToString=[];for(let l=0;l<o.length;l++){let d=o[l];this._stringToNumber[d]=l,this._numberToString[l]=d}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}var dse={read:function(a,o,l,d,m){var y,v,S=8*m-d-1,T=(1<<S)-1,D=T>>1,L=-7,F=l?m-1:0,N=l?-1:1,H=a[o+F];for(F+=N,y=H&(1<<-L)-1,H>>=-L,L+=S;L>0;y=256*y+a[o+F],F+=N,L-=8);for(v=y&(1<<-L)-1,y>>=-L,L+=d;L>0;v=256*v+a[o+F],F+=N,L-=8);if(y===0)y=1-D;else{if(y===T)return v?NaN:1/0*(H?-1:1);v+=Math.pow(2,d),y-=D}return(H?-1:1)*v*Math.pow(2,y-d)},write:function(a,o,l,d,m,y){var v,S,T,D=8*y-m-1,L=(1<<D)-1,F=L>>1,N=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,H=d?0:y-1,q=d?1:-1,Q=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(S=isNaN(o)?1:0,v=L):(v=Math.floor(Math.log(o)/Math.LN2),o*(T=Math.pow(2,-v))<1&&(v--,T*=2),(o+=v+F>=1?N/T:N*Math.pow(2,1-F))*T>=2&&(v++,T/=2),v+F>=L?(S=0,v=L):v+F>=1?(S=(o*T-1)*Math.pow(2,m),v+=F):(S=o*Math.pow(2,F-1)*Math.pow(2,m),v=0));m>=8;a[l+H]=255&S,H+=q,S/=256,m-=8);for(v=v<<m|S,D+=m;D>0;a[l+H]=255&v,H+=q,v/=256,D-=8);a[l+H-q]|=128*Q}},kV=es,FM=dse;function es(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}es.Varint=0,es.Fixed64=1,es.Bytes=2,es.Fixed32=5;var NR=4294967296,NV=1/NR,BV=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Rd(a){return a.type===es.Bytes?a.readVarint()+a.pos:a.pos+1}function Jv(a,o,l){return l?4294967296*o+(a>>>0):4294967296*(o>>>0)+(a>>>0)}function UV(a,o,l){var d=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));l.realloc(d);for(var m=l.pos-1;m>=a;m--)l.buf[m+d]=l.buf[m]}function pse(a,o){for(var l=0;l<a.length;l++)o.writeVarint(a[l])}function fse(a,o){for(var l=0;l<a.length;l++)o.writeSVarint(a[l])}function mse(a,o){for(var l=0;l<a.length;l++)o.writeFloat(a[l])}function gse(a,o){for(var l=0;l<a.length;l++)o.writeDouble(a[l])}function yse(a,o){for(var l=0;l<a.length;l++)o.writeBoolean(a[l])}function vse(a,o){for(var l=0;l<a.length;l++)o.writeFixed32(a[l])}function _se(a,o){for(var l=0;l<a.length;l++)o.writeSFixed32(a[l])}function xse(a,o){for(var l=0;l<a.length;l++)o.writeFixed64(a[l])}function bse(a,o){for(var l=0;l<a.length;l++)o.writeSFixed64(a[l])}function kM(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+16777216*a[o+3]}function e0(a,o,l){a[l]=o,a[l+1]=o>>>8,a[l+2]=o>>>16,a[l+3]=o>>>24}function jV(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+(a[o+3]<<24)}es.prototype={destroy:function(){this.buf=null},readFields:function(a,o,l){for(l=l||this.length;this.pos<l;){var d=this.readVarint(),m=d>>3,y=this.pos;this.type=7&d,a(m,o,this),this.pos===y&&this.skip(d)}return o},readMessage:function(a,o){return this.readFields(a,o,this.readVarint()+this.pos)},readFixed32:function(){var a=kM(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=jV(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=kM(this.buf,this.pos)+kM(this.buf,this.pos+4)*NR;return this.pos+=8,a},readSFixed64:function(){var a=kM(this.buf,this.pos)+jV(this.buf,this.pos+4)*NR;return this.pos+=8,a},readFloat:function(){var a=FM.read(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=FM.read(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var o,l,d=this.buf;return o=127&(l=d[this.pos++]),l<128?o:(o|=(127&(l=d[this.pos++]))<<7,l<128?o:(o|=(127&(l=d[this.pos++]))<<14,l<128?o:(o|=(127&(l=d[this.pos++]))<<21,l<128?o:function(m,y,v){var S,T,D=v.buf;if(S=(112&(T=D[v.pos++]))>>4,T<128||(S|=(127&(T=D[v.pos++]))<<3,T<128)||(S|=(127&(T=D[v.pos++]))<<10,T<128)||(S|=(127&(T=D[v.pos++]))<<17,T<128)||(S|=(127&(T=D[v.pos++]))<<24,T<128)||(S|=(1&(T=D[v.pos++]))<<31,T<128))return Jv(m,S,y);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(l=d[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,o=this.pos;return this.pos=a,a-o>=12&&BV?function(l,d,m){return BV.decode(l.subarray(d,m))}(this.buf,o,a):function(l,d,m){for(var y="",v=d;v<m;){var S,T,D,L=l[v],F=null,N=L>239?4:L>223?3:L>191?2:1;if(v+N>m)break;N===1?L<128&&(F=L):N===2?(192&(S=l[v+1]))==128&&(F=(31&L)<<6|63&S)<=127&&(F=null):N===3?(T=l[v+2],(192&(S=l[v+1]))==128&&(192&T)==128&&((F=(15&L)<<12|(63&S)<<6|63&T)<=2047||F>=55296&&F<=57343)&&(F=null)):N===4&&(T=l[v+2],D=l[v+3],(192&(S=l[v+1]))==128&&(192&T)==128&&(192&D)==128&&((F=(15&L)<<18|(63&S)<<12|(63&T)<<6|63&D)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,N=1):F>65535&&(F-=65536,y+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),y+=String.fromCharCode(F),v+=N}return y}(this.buf,o,a)},readBytes:function(){var a=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,a);return this.pos=a,o},readPackedVarint:function(a,o){if(this.type!==es.Bytes)return a.push(this.readVarint(o));var l=Rd(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(o));return a},readPackedSVarint:function(a){if(this.type!==es.Bytes)return a.push(this.readSVarint());var o=Rd(this);for(a=a||[];this.pos<o;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==es.Bytes)return a.push(this.readBoolean());var o=Rd(this);for(a=a||[];this.pos<o;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==es.Bytes)return a.push(this.readFloat());var o=Rd(this);for(a=a||[];this.pos<o;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==es.Bytes)return a.push(this.readDouble());var o=Rd(this);for(a=a||[];this.pos<o;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==es.Bytes)return a.push(this.readFixed32());var o=Rd(this);for(a=a||[];this.pos<o;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==es.Bytes)return a.push(this.readSFixed32());var o=Rd(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==es.Bytes)return a.push(this.readFixed64());var o=Rd(this);for(a=a||[];this.pos<o;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==es.Bytes)return a.push(this.readSFixed64());var o=Rd(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed64());return a},skip:function(a){var o=7&a;if(o===es.Varint)for(;this.buf[this.pos++]>127;);else if(o===es.Bytes)this.pos=this.readVarint()+this.pos;else if(o===es.Fixed32)this.pos+=4;else{if(o!==es.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(a,o){this.writeVarint(a<<3|o)},realloc:function(a){for(var o=this.length||16;o<this.pos+a;)o*=2;if(o!==this.length){var l=new Uint8Array(o);l.set(this.buf),this.buf=l,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),e0(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),e0(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),e0(this.buf,-1&a,this.pos),e0(this.buf,Math.floor(a*NV),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),e0(this.buf,-1&a,this.pos),e0(this.buf,Math.floor(a*NV),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(o,l){var d,m;if(o>=0?(d=o%4294967296|0,m=o/4294967296|0):(m=~(-o/4294967296),4294967295^(d=~(-o%4294967296))?d=d+1|0:(d=0,m=m+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(y,v,S){S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,S.buf[S.pos]=127&(y>>>=7)}(d,0,l),function(y,v){var S=(7&y)<<4;v.buf[v.pos++]|=S|((y>>>=3)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y)))))}(m,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var o=this.pos;this.pos=function(d,m,y){for(var v,S,T=0;T<m.length;T++){if((v=m.charCodeAt(T))>55295&&v<57344){if(!S){v>56319||T+1===m.length?(d[y++]=239,d[y++]=191,d[y++]=189):S=v;continue}if(v<56320){d[y++]=239,d[y++]=191,d[y++]=189,S=v;continue}v=S-55296<<10|v-56320|65536,S=null}else S&&(d[y++]=239,d[y++]=191,d[y++]=189,S=null);v<128?d[y++]=v:(v<2048?d[y++]=v>>6|192:(v<65536?d[y++]=v>>12|224:(d[y++]=v>>18|240,d[y++]=v>>12&63|128),d[y++]=v>>6&63|128),d[y++]=63&v|128)}return y}(this.buf,a,this.pos);var l=this.pos-o;l>=128&&UV(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),FM.write(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),FM.write(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var o=a.length;this.writeVarint(o),this.realloc(o);for(var l=0;l<o;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,o){this.pos++;var l=this.pos;a(o,this);var d=this.pos-l;d>=128&&UV(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeMessage:function(a,o,l){this.writeTag(a,es.Bytes),this.writeRawMessage(o,l)},writePackedVarint:function(a,o){o.length&&this.writeMessage(a,pse,o)},writePackedSVarint:function(a,o){o.length&&this.writeMessage(a,fse,o)},writePackedBoolean:function(a,o){o.length&&this.writeMessage(a,yse,o)},writePackedFloat:function(a,o){o.length&&this.writeMessage(a,mse,o)},writePackedDouble:function(a,o){o.length&&this.writeMessage(a,gse,o)},writePackedFixed32:function(a,o){o.length&&this.writeMessage(a,vse,o)},writePackedSFixed32:function(a,o){o.length&&this.writeMessage(a,_se,o)},writePackedFixed64:function(a,o){o.length&&this.writeMessage(a,xse,o)},writePackedSFixed64:function(a,o){o.length&&this.writeMessage(a,bse,o)},writeBytesField:function(a,o){this.writeTag(a,es.Bytes),this.writeBytes(o)},writeFixed32Field:function(a,o){this.writeTag(a,es.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(a,o){this.writeTag(a,es.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(a,o){this.writeTag(a,es.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(a,o){this.writeTag(a,es.Fixed64),this.writeSFixed64(o)},writeVarintField:function(a,o){this.writeTag(a,es.Varint),this.writeVarint(o)},writeSVarintField:function(a,o){this.writeTag(a,es.Varint),this.writeSVarint(o)},writeStringField:function(a,o){this.writeTag(a,es.Bytes),this.writeString(o)},writeFloatField:function(a,o){this.writeTag(a,es.Fixed32),this.writeFloat(o)},writeDoubleField:function(a,o){this.writeTag(a,es.Fixed64),this.writeDouble(o)},writeBooleanField:function(a,o){this.writeVarintField(a,!!o)}};var $1=k(kV);let wse=["id","tile","layer","source","sourceLayer","state"];class VV{constructor(o,l,d,m,y){this.type="Feature",this._vectorTileFeature=o,this._z=l,this._x=d,this._y=m,this.properties=o.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){let o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let l of wse)this[l]!==void 0&&(o[l]=this[l]);return o}}class Sse{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,l,d){let m=String(l);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][m]=this.stateChanges[o][m]||{},Io(this.stateChanges[o][m],d),this.deletedStates[o]===null){this.deletedStates[o]={};for(let y in this.state[o])y!==m&&(this.deletedStates[o][y]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][m]===null){this.deletedStates[o][m]={};for(let y in this.state[o][m])d[y]||(this.deletedStates[o][m][y]=null)}else for(let y in d)this.deletedStates[o]&&this.deletedStates[o][m]&&this.deletedStates[o][m][y]===null&&delete this.deletedStates[o][m][y]}removeFeatureState(o,l,d){if(this.deletedStates[o]===null)return;let m=String(l);if(this.deletedStates[o]=this.deletedStates[o]||{},d&&l!==void 0)this.deletedStates[o][m]!==null&&(this.deletedStates[o][m]=this.deletedStates[o][m]||{},this.deletedStates[o][m][d]=null);else if(l!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][m])for(d in this.deletedStates[o][m]={},this.stateChanges[o][m])this.deletedStates[o][m][d]=null;else this.deletedStates[o][m]=null;else this.deletedStates[o]=null}getState(o,l){let d=String(l),m=Io({},(this.state[o]||{})[d],(this.stateChanges[o]||{})[d]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){let y=this.deletedStates[o][l];if(y===null)return{};for(let v in y)delete m[v]}return m}initializeTileState(o,l){o.setFeatureState(this.state,l)}coalesceChanges(o,l){let d={};for(let m in this.stateChanges){this.state[m]=this.state[m]||{};let y={};for(let v in this.stateChanges[m])this.state[m][v]||(this.state[m][v]={}),Io(this.state[m][v],this.stateChanges[m][v]),y[v]=this.state[m][v];d[m]=y}for(let m in this.deletedStates){this.state[m]=this.state[m]||{};let y={};if(this.deletedStates[m]===null)for(let v in this.state[m])y[v]={},this.state[m][v]={};else for(let v in this.deletedStates[m]){if(this.deletedStates[m][v]===null)this.state[m][v]={};else if(this.state[m][v])for(let S of Object.keys(this.deletedStates[m][v]))delete this.state[m][v][S];y[v]=this.state[m][v]}d[m]=d[m]||{},Io(d[m],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(let m in o)o[m].setFeatureState(d,l)}}class GV{constructor(o,l){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new gt(ti,16,0),this.featureIndexArray=new N5,this.promoteId=l,this.is3DTile=!1}insert(o,l,d,m,y,v=0,S=0){let T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,m,y,v);let D=this.grid;for(let L=0;L<l.length;L++){let F=l[L],N=[1/0,1/0,-1/0,-1/0];for(let H=0;H<F.length;H++){let q=F[H];N[0]=Math.min(N[0],q.x),N[1]=Math.min(N[1],q.y),N[2]=Math.max(N[2],q.x),N[3]=Math.max(N[3],q.y)}S!==0&&(N[0]-=S,N[1]-=S,N[2]+=S,N[3]+=S),N[0]<ti&&N[1]<ti&&N[2]>=0&&N[3]>=0&&D.insert(T,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new LR(new $1(this.rawTileData)).layers,this.sourceLayerCoder=new FV(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,l,d,m){this.loadVTLayers();let y=o.params||{},v=cu(y.filter),S=o.tileResult,T=o.transform,D=S.bufferedTilespaceBounds,L=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(q,Q,K,ae)=>rj(S.bufferedTilespaceGeometry,q,Q,K,ae));L.sort(Ese);let F=null;T.elevation&&L.length>0&&(F=Kv.create(T.elevation,this.tileID));let N={},H;for(let q=0;q<L.length;q++){let Q=L[q];if(Q===H)continue;H=Q;let K=this.featureIndexArray.get(Q),ae=null;if(this.is3DTile){let _e=this.bucketLayerIDs[0][0],ge=l[_e];if(ge.type!=="model")continue;let{queryFeature:be,intersectionZ:ze}=ge.queryIntersectsMatchingFeature(S,K.featureIndex,v,T);be&&this.appendToResult(N,_e,K.featureIndex,be,ze)}else this.loadMatchingFeature(N,K,v,y.layers,y.availableImages,l,d,m,(_e,ge,be,ze=0)=>(ae||(ae=du(_e,this.tileID.canonical,o.tileTransform)),ge.queryIntersectsFeature(S,_e,be,ae,this.z,o.transform,o.pixelPosMatrix,F,ze)))}return N}loadMatchingFeature(o,l,d,m,y,v,S,T,D){let{featureIndex:L,bucketIndex:F,sourceLayerIndex:N,layoutVertexArrayOffset:H}=l,q=this.bucketLayerIDs[F];if(m&&!function(_e,ge){for(let be=0;be<_e.length;be++)if(ge.indexOf(_e[be])>=0)return!0;return!1}(m,q))return;let Q=this.sourceLayerCoder.decode(N),K=this.vtLayers[Q].feature(L);if(d.needGeometry){let _e=Dd(K,!0);if(!d.filter(new er(this.tileID.overscaledZ),_e,this.tileID.canonical))return}else if(!d.filter(new er(this.tileID.overscaledZ),K))return;let ae=this.getId(K,Q);for(let _e=0;_e<q.length;_e++){let ge=q[_e];if(m&&m.indexOf(ge)<0)continue;let be=v[ge];if(!be)continue;let ze={};ae!==void 0&&T&&(ze=T.getState(be.sourceLayer||"_geojsonTileLayer",ae));let ke=!D||D(K,be,ze,H);if(!ke)continue;let je=new VV(K,this.z,this.x,this.y,ae),it=Io({},S[ge]);it.paint=HV(it.paint,be.paint,K,ze,y),it.layout=HV(it.layout,be.layout,K,ze,y),je.layer=it,this.appendToResult(o,ge,L,je,ke)}}appendToResult(o,l,d,m,y){let v=o[l];v===void 0&&(v=o[l]=[]),v.push({featureIndex:d,feature:m,intersectionZ:y})}lookupSymbolFeatures(o,l,d,m,y,v,S,T){let D={};this.loadVTLayers();let L=cu(y);for(let F of o)this.loadMatchingFeature(D,{bucketIndex:d,sourceLayerIndex:m,featureIndex:F,layoutVertexArrayOffset:0},L,v,S,T,l);return D}loadFeature(o){let{featureIndex:l,sourceLayerIndex:d}=o;this.loadVTLayers();let m=this.sourceLayerCoder.decode(d),y=this.vtFeatures[m];if(y[l])return y[l];let v=this.vtLayers[m].feature(l);return y[l]=v,v}hasLayer(o){for(let l of this.bucketLayerIDs)for(let d of l)if(o===d)return!0;return!1}getId(o,l){let d=o.id;if(this.promoteId){let m=typeof this.promoteId=="string"?this.promoteId:this.promoteId[l];m!=null&&(d=o.properties[m]),typeof d=="boolean"&&(d=Number(d))}return d}}function HV(a,o,l,d,m){return Im(a,(y,v)=>{let S=o instanceof vo?o.get(v):null;return S&&S.evaluate?S.evaluate(l,d,m):S})}function Ese(a,o){return o-a}tt(GV,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var Bo=24;let pu=128;function BR(a,o){let{expression:l}=o;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new er(a+1))};if(l.kind==="source")return{kind:"source"};{let{zoomStops:d,interpolationType:m}=l,y=0;for(;y<d.length&&d[y]<=a;)y++;y=Math.max(0,y-1);let v=y;for(;v<d.length&&d[v]<a+1;)v++;v=Math.min(d.length-1,v);let S=d[y],T=d[v];return l.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:T,interpolationType:m}:{kind:"camera",minZoom:S,maxZoom:T,minSize:l.evaluate(new er(S)),maxSize:l.evaluate(new er(T)),interpolationType:m}}}function NM(a,{uSize:o,uSizeT:l},{lowerSize:d,upperSize:m}){return a.kind==="source"?d/pu:a.kind==="composite"?Gi(d/pu,m/pu,l):o}function t0(a,o){let l=0,d=0;if(a.kind==="constant")d=a.layoutSize;else if(a.kind!=="source"){let{interpolationType:m,minZoom:y,maxZoom:v}=a,S=m?xr(nl.interpolationFactor(m,o,y,v),0,1):0;a.kind==="camera"?d=Gi(a.minSize,a.maxSize,S):l=S}return{uSizeT:l,uSize:d}}var Mse=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:pu,evaluateSizeForFeature:NM,evaluateSizeForZoom:t0,getSizeData:BR});function Tse(a,o,l){return a.sections.forEach(d=>{d.text=function(m,y,v){let S=y.layout.get("text-transform").evaluate(v,{});return S==="uppercase"?m=m.toLocaleUpperCase():S==="lowercase"&&(m=m.toLocaleLowerCase()),Ar.applyArabicShaping&&(m=Ar.applyArabicShaping(m)),m}(d.text,o,l)}),a}let Z1={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function Ase(a){return a==="\uFE36"||a==="\uFE48"||a==="\uFE38"||a==="\uFE44"||a==="\uFE42"||a==="\uFE3E"||a==="\uFE3C"||a==="\uFE3A"||a==="\uFE18"||a==="\uFE40"||a==="\uFE10"||a==="\uFE13"||a==="\uFE14"||a==="\uFF40"||a==="\uFFE3"||a==="\uFE11"||a==="\uFE12"}function Cse(a){return a==="\uFE35"||a==="\uFE47"||a==="\uFE37"||a==="\uFE43"||a==="\uFE41"||a==="\uFE3D"||a==="\uFE3B"||a==="\uFE39"||a==="\uFE17"||a==="\uFE3F"}let UR=3;function Dse(a,o,l){o.glyphs=[],a===1&&l.readMessage(Ise,o)}function Ise(a,o,l){if(a===3){let{id:d,bitmap:m,width:y,height:v,left:S,top:T,advance:D}=l.readMessage(Pse,{});o.glyphs.push({id:d,bitmap:new uf({width:y+2*UR,height:v+2*UR},m),metrics:{width:y,height:v,left:S,top:T,advance:D}})}else a===4?o.ascender=l.readSVarint():a===5&&(o.descender=l.readSVarint())}function Pse(a,o,l){a===1?o.id=l.readVarint():a===2?o.bitmap=l.readBytes():a===3?o.width=l.readVarint():a===4?o.height=l.readVarint():a===5?o.left=l.readSVarint():a===6?o.top=l.readSVarint():a===7&&(o.advance=l.readVarint())}let WV=UR,Ql={horizontal:1,vertical:2,horizontalOnly:3};class Q1{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,l){let d=new Q1;return d.scale=o||1,d.fontStack=l,d}static forImage(o){let l=new Q1;return l.imageName=o,l}}class i0{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,l){let d=new i0;for(let m=0;m<o.sections.length;m++){let y=o.sections[m];y.image?d.addImageSection(y):d.addTextSection(y,l)}return d}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCodePoint(o){return this.text.codePointAt(o)}verticalizePunctuation(o){this.text=function(l,d){let m="";for(let y=0;y<l.length;y++){let v=l.charCodeAt(y+1)||null,S=l.charCodeAt(y-1)||null;m+=!d&&(v&&Si(v)&&!Z1[l[y+1]]||S&&Si(S)&&!Z1[l[y-1]])||!Z1[l[y]]?l[y]:Z1[l[y]]}return m}(this.text,o)}trim(){let o=0;for(let d=0;d<this.text.length&&BM[this.text.charCodeAt(d)];d++)o++;let l=this.text.length;for(let d=this.text.length-1;d>=0&&d>=o&&BM[this.text.charCodeAt(d)];d--)l--;this.text=this.text.substring(o,l),this.sectionIndex=this.sectionIndex.slice(o,l)}substring(o,l){let d=new i0;return d.text=this.text.substring(o,l),d.sectionIndex=this.sectionIndex.slice(o,l),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,l)=>Math.max(o,this.sections[l].scale),0)}addTextSection(o,l){this.text+=o.text,this.sections.push(Q1.forText(o.scale,o.fontStack||l));let d=this.sections.length-1;for(let m=0;m<o.text.length;++m)this.sectionIndex.push(d)}addImageSection(o){let l=o.image?o.image.namePrimary:"";if(l.length===0)return void Ds("Can't add FormattedSection with an empty image.");let d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(Q1.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Ds("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function jR(a,o,l,d,m,y,v,S,T,D,L,F,N,H,q){let Q=i0.fromFeature(a,m);F===Ql.vertical&&Q.verticalizePunctuation(N);let K=[],ae=function(ke,je,it,ut,vt,dt){if(!ke)return[];let At=[],jt=function(Ot,Kt,Dt,ri,Xt,Vt){let zi=0;for(let Ri=0;Ri<Ot.length();Ri++){let gi=Ot.getSection(Ri);zi+=qV(Ot.getCodePoint(Ri),gi,ri,Xt,Kt,Vt)}return zi/Math.max(1,Math.ceil(zi/Dt))}(ke,je,it,ut,vt,dt),Ct=ke.text.indexOf("\u200B")>=0,qt=0;for(let Ot=0;Ot<ke.length();Ot++){let Kt=ke.getSection(Ot),Dt=ke.getCodePoint(Ot);if(BM[Dt]||(qt+=qV(Dt,Kt,ut,vt,je,dt)),Ot<ke.length()-1){let ri=!((Tt=Dt)<11904||!(Qe["Bopomofo Extended"](Tt)||Qe.Bopomofo(Tt)||Qe["CJK Compatibility Forms"](Tt)||Qe["CJK Compatibility Ideographs"](Tt)||Qe["CJK Compatibility"](Tt)||Qe["CJK Radicals Supplement"](Tt)||Qe["CJK Strokes"](Tt)||Qe["CJK Symbols and Punctuation"](Tt)||Qe["CJK Unified Ideographs Extension A"](Tt)||Qe["CJK Unified Ideographs"](Tt)||Qe["Enclosed CJK Letters and Months"](Tt)||Qe["Halfwidth and Fullwidth Forms"](Tt)||Qe.Hiragana(Tt)||Qe["Ideographic Description Characters"](Tt)||Qe["Kangxi Radicals"](Tt)||Qe["Katakana Phonetic Extensions"](Tt)||Qe.Katakana(Tt)||Qe["Vertical Forms"](Tt)||Qe["Yi Radicals"](Tt)||Qe["Yi Syllables"](Tt)));(Rse[Dt]||ri||Kt.imageName)&&At.push(XV(Ot+1,qt,jt,At,Ose(Dt,ke.getCodePoint(Ot+1),ri&&Ct),!1))}}var Tt;return $V(XV(ke.length(),qt,jt,At,0,!0))}(Q,D,y,o,d,H),{processBidirectionalText:_e,processStyledBidirectionalText:ge}=Ar;if(_e&&Q.sections.length===1){let ke=_e(Q.toString(),ae);for(let je of ke){let it=new i0;it.text=je,it.sections=Q.sections;for(let ut=0;ut<je.length;ut++)it.sectionIndex.push(0);K.push(it)}}else if(ge){let ke=ge(Q.text,Q.sectionIndex,ae);for(let je of ke){let it=new i0;it.text=je[0],it.sectionIndex=je[1],it.sections=Q.sections,K.push(it)}}else K=function(ke,je){let it=[],ut=ke.text,vt=0;for(let dt of je)it.push(ke.substring(vt,dt)),vt=dt;return vt<ut.length&&it.push(ke.substring(vt,ut.length)),it}(Q,ae);let be=[],ze={positionedLines:be,text:Q.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:F,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ke,je,it,ut,vt,dt,At,jt,Ct,qt,Tt,Ot){let Kt=0,Dt=0,ri=0,Xt=jt==="right"?1:jt==="left"?0:.5,Vt=!1;for(let Oi of vt){let Ei=Oi.getSections();for(let nr of Ei){if(nr.imageName)continue;let or=je[nr.fontStack];if(or&&(Vt=or.ascender!==void 0&&or.descender!==void 0,!Vt))break}if(!Vt)break}let zi=0;for(let Oi of vt){Oi.trim();let Ei=Oi.getMaxScale(),nr=(Ei-1)*Bo,or={positionedGlyphs:[],lineOffset:0};ke.positionedLines[zi]=or;let sr=or.positionedGlyphs,yr=0;if(!Oi.length()){Dt+=dt,++zi;continue}let jr=0,Ir=0;for(let In=0;In<Oi.length();In++){let ar=Oi.getSection(In),dn=Oi.getSectionIndex(In),fn=Oi.getCodePoint(In),Un=ar.scale,Ms=null,Bs=null,Ts=null,us=Bo,oo=0,Gs=!(Ct===Ql.horizontal||!Tt&&!ci(fn)||Tt&&(BM[fn]||(Ri=fn,Qe.Arabic(Ri)||Qe["Arabic Supplement"](Ri)||Qe["Arabic Extended-A"](Ri)||Qe["Arabic Presentation Forms-A"](Ri)||Qe["Arabic Presentation Forms-B"](Ri))));if(ar.imageName){let Uo=ut[ar.imageName];if(!Uo)continue;Ts=ar.imageName,ke.iconsInText=ke.iconsInText||!0,Bs=Uo.paddedRect;let Fn=Uo.displaySize;Un=Un*Bo/Ot,Ms={width:Fn[0],height:Fn[1],left:0,top:-WV,advance:Gs?Fn[1]:Fn[0],localGlyph:!1},oo=Vt?-Ms.height*Un:Ei*Bo-17-Fn[1]*Un,us=Ms.advance;let al=(Gs?Fn[0]:Fn[1])*Un-Bo*Ei;al>0&&al>yr&&(yr=al)}else{let Uo=it[ar.fontStack];if(!Uo)continue;Uo[fn]&&(Bs=Uo[fn]);let Fn=je[ar.fontStack];if(!Fn)continue;let al=Fn.glyphs[fn];if(!al)continue;if(Ms=al.metrics,us=fn!==8203?Bo:0,Vt){let _u=Fn.ascender!==void 0?Math.abs(Fn.ascender):0,Rc=Fn.descender!==void 0?Math.abs(Fn.descender):0,Oc=(_u+Rc)*Un;jr<Oc&&(jr=Oc,Ir=(_u-Rc)/2*Un),oo=-_u*Un}else oo=(Ei-Un)*Bo-17}Gs?(ke.verticalizable=!0,sr.push({glyph:fn,imageName:Ts,x:Kt,y:Dt+oo,vertical:Gs,scale:Un,localGlyph:Ms.localGlyph,fontStack:ar.fontStack,sectionIndex:dn,metrics:Ms,rect:Bs}),Kt+=us*Un+qt):(sr.push({glyph:fn,imageName:Ts,x:Kt,y:Dt+oo,vertical:Gs,scale:Un,localGlyph:Ms.localGlyph,fontStack:ar.fontStack,sectionIndex:dn,metrics:Ms,rect:Bs}),Kt+=Ms.advance*Un+qt)}sr.length!==0&&(ri=Math.max(Kt-qt,ri),Vt?ZV(sr,Xt,yr,Ir,dt*Ei/2):ZV(sr,Xt,yr,0,dt/2)),Kt=0;let En=dt*Ei+yr;or.lineOffset=Math.max(yr,nr),Dt+=En,++zi}var Ri;let gi=Dt,{horizontalAlign:ii,verticalAlign:Ki}=VR(At);(function(Oi,Ei,nr,or,sr,yr){let jr=(Ei-nr)*sr,Ir=-yr*or;for(let En of Oi)for(let In of En.positionedGlyphs)In.x+=jr,In.y+=Ir})(ke.positionedLines,Xt,ii,Ki,ri,gi),ke.top+=-Ki*gi,ke.bottom=ke.top+gi,ke.left+=-ii*ri,ke.right=ke.left+ri,ke.hasBaseline=Vt}(ze,o,l,d,K,v,S,T,F,D,N,q),!function(ke){for(let je of ke)if(je.positionedGlyphs.length!==0)return!1;return!0}(be)&&ze}let BM={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Rse={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function qV(a,o,l,d,m,y){if(o.imageName){let v=d[o.imageName];return v?v.displaySize[0]*o.scale*Bo/y+m:0}{let v=l[o.fontStack],S=v&&v.glyphs[a];return S?S.metrics.advance*o.scale+m:0}}function YV(a,o,l,d){let m=Math.pow(a-o,2);return d?a<o?m/2:2*m:m+Math.abs(l)*l}function Ose(a,o,l){let d=0;return a===10&&(d-=1e4),l&&(d+=150),a!==40&&a!==65288||(d+=50),o!==41&&o!==65289||(d+=50),d}function XV(a,o,l,d,m,y){let v=null,S=YV(o,l,m,y);for(let T of d){let D=YV(o-T.x,l,m,y)+T.badness;D<=S&&(v=T,S=D)}return{index:a,x:o,priorBreak:v,badness:S}}function $V(a){return a?$V(a.priorBreak).concat(a.index):[]}function VR(a){let o=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:o,verticalAlign:l}}function ZV(a,o,l,d,m){if(!(o||l||d||m))return;let y=a.length-1,v=a[y],S=(v.x+v.metrics.advance*v.scale)*o;for(let T=0;T<=y;T++)a[T].x-=S,a[T].y+=l+d+m}function Lse(a,o,l,d){let{horizontalAlign:m,verticalAlign:y}=VR(d),v=l[0]-a.displaySize[0]*m,S=l[1]-a.displaySize[1]*y;return{imagePrimary:a,imageSecondary:o,top:S,bottom:S+a.displaySize[1],left:v,right:v+a.displaySize[0]}}function QV(a,o,l,d,m,y){let v=a.imagePrimary,S;if(v.content){let K=v.content,ae=v.pixelRatio||1;S=[K[0]/ae,K[1]/ae,v.displaySize[0]-K[2]/ae,v.displaySize[1]-K[3]/ae]}let T=o.left*y,D=o.right*y,L,F,N,H;l==="width"||l==="both"?(H=m[0]+T-d[3],F=m[0]+D+d[1]):(H=m[0]+(T+D-v.displaySize[0])/2,F=H+v.displaySize[0]);let q=o.top*y,Q=o.bottom*y;return l==="height"||l==="both"?(L=m[1]+q-d[0],N=m[1]+Q+d[2]):(L=m[1]+(q+Q-v.displaySize[1])/2,N=L+v.displaySize[1]),{imagePrimary:v,imageSecondary:void 0,top:L,right:F,bottom:N,left:H,collisionPadding:S}}class Od extends ai{constructor(o,l,d,m,y){super(o,l),this.angle=m,this.z=d,y!==void 0&&(this.segment=y)}clone(){return new Od(this.x,this.y,this.z,this.angle,this.segment)}}function KV(a,o,l,d,m){if(o.segment===void 0)return!0;let y=o,v=o.segment+1,S=0;for(;S>-l/2;){if(v--,v<0)return!1;S-=a[v].dist(y),y=a[v]}S+=a[v].dist(a[v+1]),v++;let T=[],D=0;for(;S<l/2;){let L=a[v],F=a[v+1];if(!F)return!1;let N=a[v-1].angleTo(L)-L.angleTo(F);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:S,angleDelta:N}),D+=N;S-T[0].distance>d;)D-=T.shift().angleDelta;if(D>m)return!1;v++,S+=L.dist(F)}return!0}function JV(a){let o=0;for(let l=0;l<a.length-1;l++)o+=a[l].dist(a[l+1]);return o}function e6(a,o,l){return a?.6*o*l:0}function t6(a,o){return Math.max(a?a.right-a.left:0,o?o.right-o.left:0)}function zse(a,o,l,d,m,y){let v=e6(l,m,y),S=t6(l,d)*y,T=0,D=JV(a)/2;for(let L=0;L<a.length-1;L++){let F=a[L],N=a[L+1],H=F.dist(N);if(T+H>D){let q=(D-T)/H,Q=Gi(F.x,N.x,q),K=Gi(F.y,N.y,q),ae=new Od(Q,K,0,N.angleTo(F),L);return!v||KV(a,ae,S,v,o)?ae:void 0}T+=H}}function Fse(a,o,l,d,m,y,v,S,T){let D=e6(d,y,v),L=t6(d,m),F=L*v,N=a[0].x===0||a[0].x===T||a[0].y===0||a[0].y===T;return o-F<o/4&&(o=F+o/4),i6(a,N?o/2*S%o:(L/2+2*y)*v*S%o,o,D,l,F,N,!1,T)}function i6(a,o,l,d,m,y,v,S,T){let D=y/2,L=JV(a),F=0,N=o-l,H=[];for(let q=0;q<a.length-1;q++){let Q=a[q],K=a[q+1],ae=Q.dist(K),_e=K.angleTo(Q);for(;N+l<F+ae;){N+=l;let ge=(N-F)/ae,be=Gi(Q.x,K.x,ge),ze=Gi(Q.y,K.y,ge);if(be>=0&&be<T&&ze>=0&&ze<T&&N-D>=0&&N+D<=L){let ke=new Od(be,ze,0,_e,q);d&&!KV(a,ke,y,d,m)||H.push(ke)}}F+=ae}return S||H.length||v||(H=i6(a,F/2,l,d,m,y,v,!0,T)),H}function r6(a,o,l,d,m){let y=[];for(let v=0;v<a.length;v++){let S=a[v],T;for(let D=0;D<S.length-1;D++){let L=S[D],F=S[D+1];L.x<o&&F.x<o||(L.x<o?L=new ai(o,L.y+(o-L.x)/(F.x-L.x)*(F.y-L.y))._round():F.x<o&&(F=new ai(o,L.y+(o-L.x)/(F.x-L.x)*(F.y-L.y))._round()),L.y<l&&F.y<l||(L.y<l?L=new ai(L.x+(l-L.y)/(F.y-L.y)*(F.x-L.x),l)._round():F.y<l&&(F=new ai(L.x+(l-L.y)/(F.y-L.y)*(F.x-L.x),l)._round()),L.x>=d&&F.x>=d||(L.x>=d?L=new ai(d,L.y+(d-L.x)/(F.x-L.x)*(F.y-L.y))._round():F.x>=d&&(F=new ai(d,L.y+(d-L.x)/(F.x-L.x)*(F.y-L.y))._round()),L.y>=m&&F.y>=m||(L.y>=m?L=new ai(L.x+(m-L.y)/(F.y-L.y)*(F.x-L.x),m)._round():F.y>=m&&(F=new ai(L.x+(m-L.y)/(F.y-L.y)*(F.x-L.x),m)._round()),T&&L.equals(T[T.length-1])||(T=[L],y.push(T)),T.push(F)))))}}return y}function n6(a){let o=0,l=0;for(let v of a)o+=v.w*v.h,l=Math.max(l,v.w);a.sort((v,S)=>S.h-v.h);let d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),l),h:1/0}],m=0,y=0;for(let v of a)for(let S=d.length-1;S>=0;S--){let T=d[S];if(!(v.w>T.w||v.h>T.h)){if(v.x=T.x,v.y=T.y,y=Math.max(y,v.y+v.h),m=Math.max(m,v.x+v.w),v.w===T.w&&v.h===T.h){let D=d.pop();S<d.length&&(d[S]=D)}else v.h===T.h?(T.x+=v.w,T.w-=v.w):v.w===T.w?(T.y+=v.h,T.h-=v.h):(d.push({x:T.x+v.w,y:T.y,w:T.w-v.w,h:v.h}),T.y+=v.h,T.h-=v.h);break}}return{w:m,h:y,fill:o/(m*y)||0}}tt(Od,"Anchor");let Al=1;class GR{constructor(o,{pixelRatio:l,version:d,stretchX:m,stretchY:y,content:v}){this.paddedRect=o,this.pixelRatio=l,this.stretchX=m,this.stretchY=y,this.content=v,this.version=d}get tl(){return[this.paddedRect.x+Al,this.paddedRect.y+Al]}get br(){return[this.paddedRect.x+this.paddedRect.w-Al,this.paddedRect.y+this.paddedRect.h-Al]}get displaySize(){return[(this.paddedRect.w-2*Al)/this.pixelRatio,(this.paddedRect.h-2*Al)/this.pixelRatio]}}class s6{constructor(o,l,d){let m={},y={};this.haveRenderCallbacks=[];let v=[];this.addImages(o,m,v),this.addImages(l,y,v);let{w:S,h:T}=n6(v),D=new Zl({width:S||1,height:T||1});for(let L in o){let F=o[L],N=m[L].paddedRect;Zl.copy(F.data,D,{x:0,y:0},{x:N.x+Al,y:N.y+Al},F.data,d,F.sdf)}for(let L in l){let F=l[L],N=y[L].paddedRect,H=N.x+Al,q=N.y+Al,Q=F.data.width,K=F.data.height;Zl.copy(F.data,D,{x:0,y:0},{x:H,y:q},F.data,d),Zl.copy(F.data,D,{x:0,y:K-1},{x:H,y:q-1},{width:Q,height:1},d),Zl.copy(F.data,D,{x:0,y:0},{x:H,y:q+K},{width:Q,height:1},d),Zl.copy(F.data,D,{x:Q-1,y:0},{x:H-1,y:q},{width:1,height:K},d),Zl.copy(F.data,D,{x:0,y:0},{x:H+Q,y:q},{width:1,height:K},d)}this.image=D,this.iconPositions=m,this.patternPositions=y}addImages(o,l,d){for(let m in o){let y=o[m],v={x:0,y:0,w:y.data.width+2*Al,h:y.data.height+2*Al};d.push(v),l[m]=new GR(v,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(o,l,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(m=>o.hasImage(m,d)),o.dispatchRenderCallbacks(this.haveRenderCallbacks,d);for(let m in o.getUpdatedImages(d))this.patchUpdatedImage(this.iconPositions[m],o.getImage(m,d),l),this.patchUpdatedImage(this.patternPositions[m],o.getImage(m,d),l)}patchUpdatedImage(o,l,d){if(!o||!l||o.version===l.version)return;o.version=l.version;let[m,y]=o.tl,v=!!Object.keys(this.patternPositions).length;d.update(l.data,{useMipmap:v},{x:m,y})}}tt(GR,"ImagePosition"),tt(s6,"ImageAtlas");let K1=1e20;function o6(a,o,l,d,m,y,v,S,T){for(let D=o;D<o+d;D++)a6(a,l*y+D,y,m,v,S,T);for(let D=l;D<l+m;D++)a6(a,D*y+o,1,d,v,S,T)}function a6(a,o,l,d,m,y,v){y[0]=0,v[0]=-K1,v[1]=K1,m[0]=a[o];for(let S=1,T=0,D=0;S<d;S++){m[S]=a[o+S*l];let L=S*S;do{let F=y[T];D=(m[S]-m[F]+L-F*F)/(S-F)/2}while(D<=v[T]&&--T>-1);T++,y[T]=S,v[T]=D,v[T+1]=K1}for(let S=0,T=0;S<d;S++){for(;v[T+1]<S;)T++;let D=y[T],L=S-D;a[o+S*l]=m[D]+L*L}}let fu=2,HR={none:0,ideographs:1,all:2};class r0{constructor(o,l,d){this.requestManager=o,this.localGlyphMode=l,this.localFontFamily=d,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o,l){this.urls[l]=o}getGlyphs(o,l,d){let m=[],y=this.urls[l]||p.GLYPHS_URL;for(let v in o)for(let S of o[v])m.push({stack:v,id:S});Cm(m,({stack:v,id:S},T)=>{let D=this.entries[v];D||(D=this.entries[v]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let L=D.glyphs[S];if(L!==void 0)return void T(null,{stack:v,id:S,glyph:L});if(L=this._tinySDF(D,v,S),L)return D.glyphs[S]=L,void T(null,{stack:v,id:S,glyph:L});let F=Math.floor(S/256);if(256*F>65535)return void T(new Error("glyphs > 65535 not supported"));if(D.ranges[F])return void T(null,{stack:v,id:S,glyph:L});let N=D.requests[F];N||(N=D.requests[F]=[],r0.loadGlyphRange(v,F,y,this.requestManager,(H,q)=>{if(q){D.ascender=q.ascender,D.descender=q.descender;for(let Q in q.glyphs)this._doesCharSupportLocalGlyph(+Q)||(D.glyphs[+Q]=q.glyphs[+Q]);D.ranges[F]=!0}for(let Q of N)Q(H,q);delete D.requests[F]})),N.push((H,q)=>{H?T(H):q&&T(null,{stack:v,id:S,glyph:q.glyphs[S]||null})})},(v,S)=>{if(v)d(v);else if(S){let T={};for(let{stack:D,id:L,glyph:F}of S)T[D]===void 0&&(T[D]={}),T[D].glyphs===void 0&&(T[D].glyphs={}),T[D].glyphs[L]=F&&{id:F.id,bitmap:F.bitmap.clone(),metrics:F.metrics},T[D].ascender=this.entries[D].ascender,T[D].descender=this.entries[D].descender;d(null,T)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==HR.none&&(this.localGlyphMode===HR.all?!!this.localFontFamily:!!this.localFontFamily&&(Qe["CJK Unified Ideographs"](o)||Qe["Hangul Syllables"](o)||Qe.Hiragana(o)||Qe.Katakana(o)||Qe["CJK Symbols and Punctuation"](o)||Qe["CJK Unified Ideographs Extension A"](o)||Qe["CJK Unified Ideographs Extension B"](o)))}_tinySDF(o,l,d){let m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(d))return;let y=o.tinySDF;if(!y){let Q="400";/bold/i.test(l)?Q="900":/medium/i.test(l)?Q="500":/light/i.test(l)&&(Q="200"),y=o.tinySDF=new r0.TinySDF({fontFamily:m,fontWeight:Q,fontSize:24*fu,buffer:3*fu,radius:8*fu}),y.fontWeight=Q}if(this.localGlyphs[y.fontWeight][d])return this.localGlyphs[y.fontWeight][d];let v=String.fromCodePoint(d),{data:S,width:T,height:D,glyphWidth:L,glyphHeight:F,glyphLeft:N,glyphTop:H,glyphAdvance:q}=y.draw(v);return this.localGlyphs[y.fontWeight][d]={id:d,bitmap:new uf({width:T,height:D},S),metrics:{width:L/fu,height:F/fu,left:N/fu,top:H/fu-27,advance:q/fu,localGlyph:!0}}}}r0.loadGlyphRange=function(a,o,l,d,m){let y=256*o,v=y+255,S=d.transformRequest(d.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${y}-${v}`),Nm.Glyphs);pd(S,(T,D)=>{if(T)m(T);else if(D){let L={},F=function(N){return new $1(N).readFields(Dse,{})}(D);for(let N of F.glyphs)L[N.id]=N;m(null,{glyphs:L,ascender:F.ascender,descender:F.descender})}})},r0.TinySDF=class{constructor({fontSize:a=24,buffer:o=3,radius:l=8,cutoff:d=.25,fontFamily:m="sans-serif",fontWeight:y="normal",fontStyle:v="normal"}={}){this.buffer=o,this.cutoff=d,this.radius=l;let S=this.size=a+4*o,T=this._createCanvas(S),D=this.ctx=T.getContext("2d",{willReadFrequently:!0});D.font=`${v} ${y} ${a}px ${m}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(a){let o=document.createElement("canvas");return o.width=o.height=a,o}draw(a){let{width:o,actualBoundingBoxAscent:l,actualBoundingBoxDescent:d,actualBoundingBoxLeft:m,actualBoundingBoxRight:y}=this.ctx.measureText(a),v=Math.ceil(l),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-m))),T=Math.min(this.size-this.buffer,v+Math.ceil(d)),D=S+2*this.buffer,L=T+2*this.buffer,F=Math.max(D*L,0),N=new Uint8ClampedArray(F),H={data:N,width:D,height:L,glyphWidth:S,glyphHeight:T,glyphTop:v,glyphLeft:0,glyphAdvance:o};if(S===0||T===0)return H;let{ctx:q,buffer:Q,gridInner:K,gridOuter:ae}=this;q.clearRect(Q,Q,S,T),q.fillText(a,Q,Q+v);let _e=q.getImageData(Q,Q,S,T);ae.fill(K1,0,F),K.fill(0,0,F);for(let ge=0;ge<T;ge++)for(let be=0;be<S;be++){let ze=_e.data[4*(ge*S+be)+3]/255;if(ze===0)continue;let ke=(ge+Q)*D+be+Q;if(ze===1)ae[ke]=0,K[ke]=K1;else{let je=.5-ze;ae[ke]=je>0?je*je:0,K[ke]=je<0?je*je:0}}o6(ae,0,0,D,L,D,this.f,this.v,this.z),o6(K,Q,Q,S,T,D,this.f,this.v,this.z);for(let ge=0;ge<F;ge++){let be=Math.sqrt(ae[ge])-Math.sqrt(K[ge]);N[ge]=Math.round(255-255*(be/this.radius+this.cutoff))}return H}};let pf=Al;function l6(a,o,l,d){let m=[],y=a.imagePrimary,v=y.pixelRatio,S=y.paddedRect.w-2*pf,T=y.paddedRect.h-2*pf,D=a.right-a.left,L=a.bottom-a.top,F=y.stretchX||[[0,S]],N=y.stretchY||[[0,T]],H=(dt,At)=>dt+At[1]-At[0],q=F.reduce(H,0),Q=N.reduce(H,0),K=S-q,ae=T-Q,_e=0,ge=q,be=0,ze=Q,ke=0,je=K,it=0,ut=ae;if(y.content&&d){let dt=y.content;_e=UM(F,0,dt[0]),be=UM(N,0,dt[1]),ge=UM(F,dt[0],dt[2]),ze=UM(N,dt[1],dt[3]),ke=dt[0]-_e,it=dt[1]-be,je=dt[2]-dt[0]-ge,ut=dt[3]-dt[1]-ze}let vt=(dt,At,jt,Ct)=>{let qt=jM(dt.stretch-_e,ge,D,a.left),Tt=VM(dt.fixed-ke,je,dt.stretch,q),Ot=jM(At.stretch-be,ze,L,a.top),Kt=VM(At.fixed-it,ut,At.stretch,Q),Dt=jM(jt.stretch-_e,ge,D,a.left),ri=VM(jt.fixed-ke,je,jt.stretch,q),Xt=jM(Ct.stretch-be,ze,L,a.top),Vt=VM(Ct.fixed-it,ut,Ct.stretch,Q),zi=new ai(qt,Ot),Ri=new ai(Dt,Ot),gi=new ai(Dt,Xt),ii=new ai(qt,Xt),Ki=new ai(Tt/v,Kt/v),Oi=new ai(ri/v,Vt/v),Ei=o*Math.PI/180;if(Ei){let Ir=Math.sin(Ei),En=Math.cos(Ei),In=[En,-Ir,Ir,En];zi._matMult(In),Ri._matMult(In),ii._matMult(In),gi._matMult(In)}let nr=dt.stretch+dt.fixed,or=jt.stretch+jt.fixed,sr=At.stretch+At.fixed,yr=Ct.stretch+Ct.fixed,jr=a.imageSecondary;return{tl:zi,tr:Ri,bl:ii,br:gi,texPrimary:{x:y.paddedRect.x+pf+nr,y:y.paddedRect.y+pf+sr,w:or-nr,h:yr-sr},texSecondary:jr?{x:jr.paddedRect.x+pf+nr,y:jr.paddedRect.y+pf+sr,w:or-nr,h:yr-sr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ki,pixelOffsetBR:Oi,minFontScaleX:je/v/D,minFontScaleY:ut/v/L,isSDF:l}};if(d&&(y.stretchX||y.stretchY)){let dt=c6(F,K,q),At=c6(N,ae,Q);for(let jt=0;jt<dt.length-1;jt++){let Ct=dt[jt],qt=dt[jt+1];for(let Tt=0;Tt<At.length-1;Tt++)m.push(vt(Ct,At[Tt],qt,At[Tt+1]))}}else m.push(vt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:T+1}));return m}function UM(a,o,l){let d=0;for(let m of a)d+=Math.max(o,Math.min(l,m[1]))-Math.max(o,Math.min(l,m[0]));return d}function c6(a,o,l){let d=[{fixed:-pf,stretch:0}];for(let[m,y]of a){let v=d[d.length-1];d.push({fixed:m-v.stretch,stretch:v.stretch}),d.push({fixed:m-v.stretch,stretch:v.stretch+(y-m)})}return d.push({fixed:o+pf,stretch:l}),d}function jM(a,o,l,d){return a/o*l+d}function VM(a,o,l,d){return a-o*l/d}function kse(a,o,l,d){let m=o+a.positionedLines[d].lineOffset;return d===0?l+m/2:l+(m+(o+a.positionedLines[d-1].lineOffset))/2}function Nse(a,o=1,l=!1){let d=1/0,m=1/0,y=-1/0,v=-1/0,S=a[0];for(let H=0;H<S.length;H++){let q=S[H];(!H||q.x<d)&&(d=q.x),(!H||q.y<m)&&(m=q.y),(!H||q.x>y)&&(y=q.x),(!H||q.y>v)&&(v=q.y)}let T=Math.min(y-d,v-m),D=T/2,L=new ch([],Bse);if(T===0)return new ai(d,m);for(let H=d;H<y;H+=T)for(let q=m;q<v;q+=T)L.push(new n0(H+D,q+D,D,a));let F=function(H){let q=0,Q=0,K=0,ae=H[0];for(let _e=0,ge=ae.length,be=ge-1;_e<ge;be=_e++){let ze=ae[_e],ke=ae[be],je=ze.x*ke.y-ke.x*ze.y;Q+=(ze.x+ke.x)*je,K+=(ze.y+ke.y)*je,q+=3*je}return new n0(Q/q,K/q,0,H)}(a),N=L.length;for(;L.length;){let H=L.pop();(H.d>F.d||!F.d)&&(F=H,l&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,N)),H.max-F.d<=o||(D=H.h/2,L.push(new n0(H.p.x-D,H.p.y-D,D,a)),L.push(new n0(H.p.x+D,H.p.y-D,D,a)),L.push(new n0(H.p.x-D,H.p.y+D,D,a)),L.push(new n0(H.p.x+D,H.p.y+D,D,a)),N+=4)}return l&&(console.log(`num probes: ${N}`),console.log(`best distance: ${F.d}`)),F.p}function Bse(a,o){return o.max-a.max}class n0{constructor(o,l,d,m){this.p=new ai(o,l),this.h=d,this.d=function(y,v){let S=!1,T=1/0;for(let D=0;D<v.length;D++){let L=v[D];for(let F=0,N=L.length,H=N-1;F<N;H=F++){let q=L[F],Q=L[H];q.y>y.y!=Q.y>y.y&&y.x<(Q.x-q.x)*(y.y-q.y)/(Q.y-q.y)+q.x&&(S=!S),T=Math.min(T,tj(y,q,Q))}}return(S?1:-1)*Math.sqrt(T)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}let WR=Number.POSITIVE_INFINITY,Use=Math.sqrt(2);function u6(a,[o,l]){let d=0,m=0;if(l===WR){o<0&&(o=0);let y=o/Use;switch(a){case"top-right":case"top-left":m=y-7;break;case"bottom-right":case"bottom-left":m=7-y;break;case"bottom":m=7-o;break;case"top":m=o-7}switch(a){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=o;break;case"right":d=-o}}else{switch(o=Math.abs(o),l=Math.abs(l),a){case"top-right":case"top-left":case"top":m=l-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-l}switch(a){case"top-right":case"bottom-right":case"right":d=-o;break;case"top-left":case"bottom-left":case"left":d=o}}return[d,m]}function qR(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function jse(a,o,l,d,m,y,v,S,T,D,L,F,N,H,q){let Q=y.textMaxSize.evaluate(o,{},F);Q===void 0&&(Q=v);let K=a.layers[0].layout,ae=K.get("icon-offset").evaluate(o,{},F),_e=d6(l.horizontal)||l.vertical,ge=N.name==="globe",be=Bo,ze=v/be,ke=a.tilePixelRatio*Q/be,je=(qt=a.overscaling,a.zoom>18&&qt>2&&(qt>>=1),Math.max(ti/(512*qt),1)*K.get("symbol-spacing")),it=K.get("text-padding")*a.tilePixelRatio,ut=K.get("icon-padding")*a.tilePixelRatio,vt=Rr(K.get("text-max-angle")),dt=K.get("text-rotation-alignment")==="map"&&K.get("symbol-placement")!=="point",At=K.get("icon-rotation-alignment")==="map"&&K.get("symbol-placement")!=="point",jt=K.get("symbol-placement"),Ct=je/2;var qt;let Tt=K.get("icon-text-fit").evaluate(o,{},F),Ot=K.get("icon-text-fit-padding").evaluate(o,{},F),Kt=Tt!=="none",Dt;a.hasAnyIconTextFit===!1&&Kt&&(a.hasAnyIconTextFit=!0),d&&Kt&&(a.allowVerticalPlacement&&l.vertical&&(Dt=QV(d,l.vertical,Tt,Ot,ae,ze)),_e&&(d=QV(d,_e,Tt,Ot,ae,ze)));let ri=(Xt,Vt,zi)=>{if(Vt.x<0||Vt.x>=ti||Vt.y<0||Vt.y>=ti)return;let Ri=null;if(ge){let{x:gi,y:ii,z:Ki}=N.projectTilePoint(Vt.x,Vt.y,zi);Ri={anchor:new Od(gi,ii,Ki,0,void 0),up:N.upVector(zi,Vt.x,Vt.y)}}(function(gi,ii,Ki,Oi,Ei,nr,or,sr,yr,jr,Ir,En,In,ar,dn,fn,Un,Ms,Bs,Ts,us,oo,Gs,Uo,Fn,al,_u){let Rc=gi.addToLineVertexArray(ii,Oi),Oc,Mg,_f,Tg,vb,CG,DG,IG=0,PG=0,RG=0,OG=0,wO=-1,SO=-1,_h={},LG=mv(""),Ag=Ki?Ki.anchor:ii,EO=yr.layout.get("icon-text-fit").evaluate(us,{},Fn)!=="none",MO=0,TO=0;if(yr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[MO,TO]=yr.layout.get("text-offset").evaluate(us,{},Fn).map(Dl=>Dl*Bo):(MO=yr.layout.get("text-radial-offset").evaluate(us,{},Fn)*Bo,TO=WR),gi.allowVerticalPlacement&&Ei.vertical){let Dl=Ei.vertical;if(dn)CG=YR(Dl),sr&&(DG=YR(sr));else{let Il=yr.layout.get("text-rotate").evaluate(us,{},Fn)+90;_f=GM(jr,Ag,ii,Ir,En,In,Dl,ar,Il,fn),sr&&(Tg=GM(jr,Ag,ii,Ir,En,In,sr,Ms,Il))}}if(nr){let Dl=yr.layout.get("icon-rotate").evaluate(us,{},Fn),Il=l6(nr,Dl,Gs,EO),d0=sr?l6(sr,Dl,Gs,EO):void 0;Mg=GM(jr,Ag,ii,Ir,En,In,nr,Ms,Dl),IG=4*Il.length;let zG=gi.iconSizeData,Cg=null;zG.kind==="source"?(Cg=[pu*yr.layout.get("icon-size").evaluate(us,{},Fn)],Cg[0]>ff&&Ds(`${gi.layerIds[0]}: Value for "icon-size" is >= ${J1}. Reduce your "icon-size".`)):zG.kind==="composite"&&(Cg=[pu*oo.compositeIconSizes[0].evaluate(us,{},Fn),pu*oo.compositeIconSizes[1].evaluate(us,{},Fn)],(Cg[0]>ff||Cg[1]>ff)&&Ds(`${gi.layerIds[0]}: Value for "icon-size" is >= ${J1}. Reduce your "icon-size".`)),gi.addSymbols(gi.icon,Il,Cg,Ts,Bs,us,!1,Ki,ii,Rc.lineStartIndex,Rc.lineLength,-1,Uo,Fn,al,_u),wO=gi.icon.placedSymbolArray.length-1,d0&&(PG=4*d0.length,gi.addSymbols(gi.icon,d0,Cg,Ts,Bs,us,Ql.vertical,Ki,ii,Rc.lineStartIndex,Rc.lineLength,-1,Uo,Fn,al,_u),SO=gi.icon.placedSymbolArray.length-1)}for(let Dl in Ei.horizontal){let Il=Ei.horizontal[Dl];Oc||(LG=mv(Il.text),dn?vb=YR(Il):Oc=GM(jr,Ag,ii,Ir,En,In,Il,ar,yr.layout.get("text-rotate").evaluate(us,{},Fn),fn));let d0=Il.positionedLines.length===1;if(RG+=h6(gi,Ki,ii,Il,or,yr,dn,us,fn,Rc,Ei.vertical?Ql.horizontal:Ql.horizontalOnly,d0?Object.keys(Ei.horizontal):[Dl],_h,wO,oo,Uo,Fn,al),d0)break}Ei.vertical&&(OG+=h6(gi,Ki,ii,Ei.vertical,or,yr,dn,us,fn,Rc,Ql.vertical,["vertical"],_h,SO,oo,Uo,Fn,al));let xf=-1,AO=(Dl,Il)=>Dl?Math.max(Dl,Il):Il;xf=AO(vb,xf),xf=AO(CG,xf),xf=AO(DG,xf);let iae=xf>-1?1:0;gi.glyphOffsetArray.length>=65535&&Ds("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),us.sortKey!==void 0&&gi.addToSortKeyRanges(gi.symbolInstances.length,us.sortKey),gi.symbolInstances.emplaceBack(ii.x,ii.y,Ag.x,Ag.y,Ag.z,_h.right>=0?_h.right:-1,_h.center>=0?_h.center:-1,_h.left>=0?_h.left:-1,_h.vertical>=0?_h.vertical:-1,wO,SO,LG,Oc!==void 0?Oc:gi.collisionBoxArray.length,Oc!==void 0?Oc+1:gi.collisionBoxArray.length,_f!==void 0?_f:gi.collisionBoxArray.length,_f!==void 0?_f+1:gi.collisionBoxArray.length,Mg!==void 0?Mg:gi.collisionBoxArray.length,Mg!==void 0?Mg+1:gi.collisionBoxArray.length,Tg||gi.collisionBoxArray.length,Tg?Tg+1:gi.collisionBoxArray.length,Ir,RG,OG,IG,PG,iae,0,MO,TO,xf,0,EO?1:0)})(a,Vt,Ri,Xt,l,d,m,Dt,a.layers[0],a.collisionBoxArray,o.index,o.sourceLayerIndex,a.index,it,dt,T,0,ut,At,ae,o,y,D,L,F,H,q)};if(jt==="line")for(let Xt of r6(o.geometry,0,0,ti,ti)){let Vt=Fse(Xt,je,vt,l.vertical||_e,d,be,ke,a.overscaling,ti);for(let zi of Vt)_e&&Vse(a,_e.text,Ct,zi)||ri(Xt,zi,F)}else if(jt==="line-center"){for(let Xt of o.geometry)if(Xt.length>1){let Vt=zse(Xt,vt,l.vertical||_e,d,be,ke);Vt&&ri(Xt,Vt,F)}}else if(o.type==="Polygon")for(let Xt of MM(o.geometry,0)){let Vt=Nse(Xt,16);ri(Xt[0],new Od(Vt.x,Vt.y,0,0,void 0),F)}else if(o.type==="LineString")for(let Xt of o.geometry)ri(Xt,new Od(Xt[0].x,Xt[0].y,0,0,void 0),F);else if(o.type==="Point")for(let Xt of o.geometry)for(let Vt of Xt)ri([Vt],new Od(Vt.x,Vt.y,0,0,void 0),F)}let J1=255,ff=J1*pu;function h6(a,o,l,d,m,y,v,S,T,D,L,F,N,H,q,Q,K,ae){let _e=function(ze,ke,je,it,ut,vt,dt,At){let jt=[];if(ke.positionedLines.length===0)return jt;let Ct=it.layout.get("text-rotate").evaluate(vt,{})*Math.PI/180,qt=function(ri){let Xt=ri[0],Vt=ri[1],zi=Xt*Vt;return zi>0?[Xt,-Vt]:zi<0?[-Xt,Vt]:Xt===0?[Vt,Xt]:[Vt,-Xt]}(je),Tt=Math.abs(ke.top-ke.bottom);for(let ri of ke.positionedLines)Tt-=ri.lineOffset;let Ot=ke.positionedLines.length,Kt=Tt/Ot,Dt=ke.top-je[1];for(let ri=0;ri<Ot;++ri){let Xt=ke.positionedLines[ri];Dt=kse(ke,Kt,Dt,ri);for(let Vt of Xt.positionedGlyphs){if(!Vt.rect)continue;let zi=Vt.rect||{},Ri=WV+1,gi=!0,ii=1,Ki=0;if(Vt.imageName){let Ts=dt[Vt.imageName];if(!Ts)continue;if(Ts.sdf){Ds("SDF images are not supported in formatted text and will be ignored.");continue}gi=!1,ii=Ts.pixelRatio,Ri=Al/ii}let Oi=(ut||At)&&Vt.vertical,Ei=Vt.metrics.advance*Vt.scale/2,nr=Vt.metrics,or=Vt.rect;if(or===null)continue;At&&ke.verticalizable&&(Ki=Vt.imageName?Ei-Vt.metrics.width*Vt.scale/2:0);let sr=ut?[Vt.x+Ei,Vt.y]:[0,0],yr=[0,0],jr=[0,0],Ir=!1;ut||(Oi?(jr=[Vt.x+Ei+qt[0],Vt.y+qt[1]-Ki],Ir=!0):yr=[Vt.x+Ei+je[0],Vt.y+je[1]-Ki]);let En=or.w*Vt.scale/(ii*(Vt.localGlyph?fu:1)),In=or.h*Vt.scale/(ii*(Vt.localGlyph?fu:1)),ar,dn,fn,Un;if(Oi){let Ts=Vt.y-Dt,us=new ai(-Ei,Ei-Ts),oo=-Math.PI/2,Gs=new ai(...jr);ar=new ai(-Ei+yr[0],yr[1]),ar._rotateAround(oo,us)._add(Gs),ar.x+=-Ts+Ei,ar.y-=(nr.left-Ri)*Vt.scale;let Uo=Vt.imageName?nr.advance*Vt.scale:Bo*Vt.scale,Fn=String.fromCodePoint(Vt.glyph);Ase(Fn)?ar.x+=(1-Ri)*Vt.scale:Cse(Fn)?ar.x+=Uo-nr.height*Vt.scale+(-Ri-1)*Vt.scale:ar.x+=Vt.imageName||nr.width+2*Ri===or.w&&nr.height+2*Ri===or.h?(Uo-In)/2:(Uo-(nr.height+2*Ri)*Vt.scale)/2,dn=new ai(ar.x,ar.y-En),fn=new ai(ar.x+In,ar.y),Un=new ai(ar.x+In,ar.y-En)}else{let Ts=(nr.left-Ri)*Vt.scale-Ei+yr[0],us=(-nr.top-Ri)*Vt.scale+yr[1],oo=Ts+En,Gs=us+In;ar=new ai(Ts,us),dn=new ai(oo,us),fn=new ai(Ts,Gs),Un=new ai(oo,Gs)}if(Ct){let Ts;Ts=ut?new ai(0,0):Ir?new ai(qt[0],qt[1]):new ai(je[0],je[1]),ar._rotateAround(Ct,Ts),dn._rotateAround(Ct,Ts),fn._rotateAround(Ct,Ts),Un._rotateAround(Ct,Ts)}let Ms=new ai(0,0),Bs=new ai(0,0);jt.push({tl:ar,tr:dn,bl:fn,br:Un,texPrimary:zi,texSecondary:void 0,writingMode:ke.writingMode,glyphOffset:sr,sectionIndex:Vt.sectionIndex,isSDF:gi,pixelOffsetTL:Ms,pixelOffsetBR:Bs,minFontScaleX:0,minFontScaleY:0})}}return jt}(0,d,T,y,v,S,m,a.allowVerticalPlacement),ge=a.textSizeData,be=null;ge.kind==="source"?(be=[pu*y.layout.get("text-size").evaluate(S,{},K)],be[0]>ff&&Ds(`${a.layerIds[0]}: Value for "text-size" is >= ${J1}. Reduce your "text-size".`)):ge.kind==="composite"&&(be=[pu*q.compositeTextSizes[0].evaluate(S,{},K),pu*q.compositeTextSizes[1].evaluate(S,{},K)],(be[0]>ff||be[1]>ff)&&Ds(`${a.layerIds[0]}: Value for "text-size" is >= ${J1}. Reduce your "text-size".`)),a.addSymbols(a.text,_e,be,T,v,S,L,o,l,D.lineStartIndex,D.lineLength,H,Q,K,ae,!1);for(let ze of F)N[ze]=a.text.placedSymbolArray.length-1;return 4*_e.length}function d6(a){for(let o in a)return a[o];return null}function GM(a,o,l,d,m,y,v,S,T,D){let L=v.top,F=v.bottom,N=v.left,H=v.right,q=v.collisionPadding;if(q&&(N-=q[0],L-=q[1],H+=q[2],F+=q[3]),T){let Q=new ai(N,L),K=new ai(H,L),ae=new ai(N,F),_e=new ai(H,F),ge=Rr(T),be=new ai(0,0);D&&(be=new ai(D[0],D[1])),Q._rotateAround(ge,be),K._rotateAround(ge,be),ae._rotateAround(ge,be),_e._rotateAround(ge,be),N=Math.min(Q.x,K.x,ae.x,_e.x),H=Math.max(Q.x,K.x,ae.x,_e.x),L=Math.min(Q.y,K.y,ae.y,_e.y),F=Math.max(Q.y,K.y,ae.y,_e.y)}return a.emplaceBack(o.x,o.y,o.z,l.x,l.y,N,L,H,F,S,d,m,y),a.length-1}function YR(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);let o=a.bottom-a.top;return o>0?Math.max(10,o):null}function Vse(a,o,l,d){let m=a.compareText;if(o in m){let y=m[o];for(let v=y.length-1;v>=0;v--)if(d.dist(y[v])<l)return!0}else m[o]=[];return m[o].push(d),!1}function p6(a,o){let l=a.fovAboveCenter,d=a.elevation?a.elevation.getMinElevationBelowMSL()*o:0,m=(a._camera.position[2]*a.worldSize-d)/Math.cos(a._pitch),y=Math.sin(l)*m/Math.sin(Math.max(Math.PI/2-a._pitch-l,.01)),v=Math.sin(a._pitch)*y+m;return Math.min(1.01*v,m*(1/a._horizonShift))}function xg(a,o){if(!o.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:o};let l=Math.pow(2,-a.z),d=a.x*l,m=(a.x+1)*l,y=a.y*l,v=(a.y+1)*l,S=ol(d),T=ol(m),D=_o(y),L=_o(v),F=o.project(S,D),N=o.project(T,D),H=o.project(T,L),q=o.project(S,L),Q=Math.min(F.x,N.x,H.x,q.x),K=Math.min(F.y,N.y,H.y,q.y),ae=Math.max(F.x,N.x,H.x,q.x),_e=Math.max(F.y,N.y,H.y,q.y),ge=l/16;function be(ke,je,it,ut,vt,dt){let At=(it+vt)/2,jt=(ut+dt)/2,Ct=o.project(ol(At),_o(jt)),qt=Math.max(0,Q-Ct.x,K-Ct.y,Ct.x-ae,Ct.y-_e);Q=Math.min(Q,Ct.x),ae=Math.max(ae,Ct.x),K=Math.min(K,Ct.y),_e=Math.max(_e,Ct.y),qt>ge&&(be(ke,Ct,it,ut,At,jt),be(Ct,je,At,jt,vt,dt))}be(F,N,d,y,m,y),be(N,H,m,y,m,v),be(H,q,m,v,d,v),be(q,F,d,v,d,y),Q-=ge,K-=ge,ae+=ge,_e+=ge;let ze=1/Math.max(ae-Q,_e-K);return{scale:ze,x:Q*ze,y:K*ze,x2:ae*ze,y2:_e*ze,projection:o}}function f6(a,{x:o,y:l},d=0){return new ai(((o-d)*a.scale-a.x)*ti,(l*a.scale-a.y)*ti)}let Gse=n.ae.identity(new Float32Array(16));class mf{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,l){return{x:0,y:0,z:0}}unproject(o,l){return new Kr(0,0)}projectTilePoint(o,l,d){return{x:o,y:l,z:0}}locationPoint(o,l,d=!0){return o._coordinatePoint(o.locationCoordinate(l),d)}pixelsPerMeter(o,l){return Ba(1,o)*l}pixelSpaceConversion(o,l,d){return 1}farthestPixelDistance(o){return p6(o,o.pixelsPerMeter)}pointCoordinate(o,l,d,m){let y=o.horizonLineFromTop(!1),v=new ai(l,Math.max(y,d));return o.rayIntersectionCoordinate(o.pointRayIntersection(v,m))}pointCoordinate3D(o,l,d){let m=new ai(l,d);if(o.elevation)return o.elevation.pointCoordinate(m);{let y=this.pointCoordinate(o,m.x,m.y,0);return[y.x,y.y,y.z]}}isPointAboveHorizon(o,l){if(o.elevation&&o.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(o,l.x,l.y);let d=o.horizonLineFromTop();return l.y<d}createInversionMatrix(o,l){return Gse}createTileMatrix(o,l,d){let m,y,v,S=d.canonical,T=n.ae.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let D=xg(S,this);m=1,y=D.x+d.wrap*D.scale,v=D.y,n.ae.scale(T,T,[m/D.scale,m/D.scale,o.pixelsPerMeter/l])}else m=l/o.zoomScale(S.z),y=(S.x+Math.pow(2,S.z)*d.wrap)*m,v=S.y*m;return n.ae.translate(T,T,[y,v,0]),n.ae.scale(T,T,[m/ti,m/ti,1]),T}upVector(o,l,d){return[0,0,1]}upVectorScale(o,l,d){return{metersToTile:1}}}class Hse extends mf{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];let[l,d]=this.parallels=o.parallels||[29.5,45.5],m=Math.sin(Rr(l));this.n=(m+Math.sin(Rr(d)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(o,l){let{n:d,c:m,r0:y}=this,v=Rr(o-this.center[0]),S=Rr(l),T=Math.sqrt(m-2*d*Math.sin(S))/d;return{x:T*Math.sin(v*d),y:T*Math.cos(v*d)-y,z:0}}unproject(o,l){let{n:d,c:m,r0:y}=this,v=y+l,S=Math.atan2(o,Math.abs(v))*Math.sign(v);v*d<0&&(S-=Math.PI*Math.sign(o)*Math.sign(v));let T=Rr(this.center[0])*d;S=Fp(S,-Math.PI-T,Math.PI-T);let D=xr(xa(S/d)+this.center[0],-180,180),L=Math.asin(xr((m-(o*o+v*v)*d*d)/(2*d),-1,1)),F=xr(xa(L),-Rs,Rs);return new Kr(D,F)}}let eb=1.340264,tb=-.081106,ib=893e-6,rb=.003796,HM=Math.sqrt(3)/2;class Wse extends mf{project(o,l){l=l/180*Math.PI,o=o/180*Math.PI;let d=Math.asin(HM*Math.sin(l)),m=d*d,y=m*m*m;return{x:.5*(o*Math.cos(d)/(HM*(eb+3*tb*m+y*(7*ib+9*rb*m)))/Math.PI+.5),y:1-.5*(d*(eb+tb*m+y*(ib+rb*m))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let d=l=(2*(1-l)-1)*Math.PI,m=d*d,y=m*m*m;for(let L,F,N,H=0;H<12&&(F=d*(eb+tb*m+y*(ib+rb*m))-l,N=eb+3*tb*m+y*(7*ib+9*rb*m),L=F/N,d=xr(d-L,-Math.PI/3,Math.PI/3),m=d*d,y=m*m*m,!(Math.abs(L)<1e-12));++H);let v=HM*o*(eb+3*tb*m+y*(7*ib+9*rb*m))/Math.cos(d),S=Math.asin(Math.sin(d)/HM),T=xr(180*v/Math.PI,-180,180),D=xr(180*S/Math.PI,-Rs,Rs);return new Kr(T,D)}}class qse extends mf{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){return{x:.5+o/360,y:.5-l/360,z:0}}unproject(o,l){let d=360*(o-.5),m=xr(360*(.5-l),-Rs,Rs);return new Kr(d,m)}}let s0=Math.PI/2;function WM(a){return Math.tan((s0+a)/2)}class Yse extends mf{constructor(o){super(o),this.center=o.center||[0,30];let[l,d]=this.parallels=o.parallels||[30,30],m=Rr(l),y=Rr(d);this.southernCenter=m+y<0,this.southernCenter&&(m=-m,y=-y);let v=Math.cos(m),S=WM(m);this.n=m===y?Math.sin(m):Math.log(v/Math.cos(y))/Math.log(WM(y)/S),this.f=v*Math.pow(WM(m),this.n)/this.n}project(o,l){l=Rr(l),this.southernCenter&&(l=-l),o=Rr(o-this.center[0]);let d=1e-6,{n:m,f:y}=this;y>0?l<-s0+d&&(l=-s0+d):l>s0-d&&(l=s0-d);let v=y/Math.pow(WM(l),m),S=v*Math.sin(m*o),T=y-v*Math.cos(m*o);return S=.5*(S/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:S,y:this.southernCenter?T:1-T,z:0}}unproject(o,l){o=(2*o-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;let{n:d,f:m}=this,y=m-l,v=Math.sign(y),S=Math.sign(d)*Math.sqrt(o*o+y*y),T=Math.atan2(o,Math.abs(y))*v;y*d<0&&(T-=Math.PI*Math.sign(o)*v);let D=xr(xa(T/d)+this.center[0],-180,180),L=xr(xa(2*Math.atan(Math.pow(m/S,1/d))-s0),-Rs,Rs);return new Kr(D,this.southernCenter?-L:L)}}class m6 extends mf{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,l){return{x:ph(o),y:fh(l),z:0}}unproject(o,l){let d=ol(o),m=_o(l);return new Kr(d,m)}}let g6=Rr(Rs);class Xse extends mf{project(o,l){let d=(l=Rr(l))*l,m=d*d;return{x:.5*((o=Rr(o))*(.8707-.131979*d+m*(m*(.003971*d-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+d*(.015085+m*(.028874*d-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let d=l=(2*(1-l)-1)*Math.PI,m=25,y=0,v=d*d;do{v=d*d;let D=v*v;y=(d*(1.007226+v*(.015085+D*(.028874*v-.044475-.005916*D)))-l)/(1.007226+v*(.045255+D*(.259866*v-.311325-.005916*11*D))),d=xr(d-y,-g6,g6)}while(Math.abs(y)>1e-6&&--m>0);v=d*d;let S=xr(xa(o/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),T=xa(d);return new Kr(S,T)}}let y6=Rr(Rs);class $se extends mf{project(o,l){l=Rr(l),o=Rr(o);let d=Math.cos(l),m=2/Math.PI,y=Math.acos(d*Math.cos(o/2)),v=Math.sin(y)/y,S=.5*(o*m+2*d*Math.sin(o/2)/v)||0,T=.5*(l+Math.sin(l)/v)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(o,l){let d=o=(2*o-.5)*Math.PI,m=l=(2*(1-l)-1)*Math.PI,y=25,v=1e-6,S=0,T=0;do{let D=Math.cos(m),L=Math.sin(m),F=2*L*D,N=L*L,H=D*D,q=Math.cos(d/2),Q=Math.sin(d/2),K=2*q*Q,ae=Q*Q,_e=1-H*q*q,ge=_e?1/_e:0,be=_e?Math.acos(D*q)*Math.sqrt(1/_e):0,ze=.5*(2*be*D*Q+2*d/Math.PI)-o,ke=.5*(be*L+m)-l,je=.5*ge*(H*ae+be*D*q*N)+1/Math.PI,it=ge*(K*F/4-be*L*Q),ut=.125*ge*(F*Q-be*L*H*K),vt=.5*ge*(N*q+be*ae*D)+.5,dt=it*ut-vt*je;S=(ke*it-ze*vt)/dt,T=(ze*ut-ke*je)/dt,d=xr(d-S,-Math.PI,Math.PI),m=xr(m-T,-y6,y6)}while((Math.abs(S)>v||Math.abs(T)>v)&&--y>0);return new Kr(xa(d),xa(m))}}class v6 extends mf{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Rr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){let{scale:d,cosPhi:m}=this;return{x:Rr(o)*m*d+.5,y:-Math.sin(Rr(l))/m*d+.5,z:0}}unproject(o,l){let{scale:d,cosPhi:m}=this,y=-(l-.5)/d,v=xr(xa((o-.5)/d)/m,-180,180),S=Math.asin(xr(y*m,-1,1)),T=xr(xa(S),-Rs,Rs);return new Kr(v,T)}}class Zse extends m6{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,l,d){let m=N1(o,l,d),y=B1(mh(d));return n.$.transformMat4(m,m,y),{x:m[0],y:m[1],z:m[2]}}locationPoint(o,l){let d=mg(l.lat,l.lng),m=n.$.normalize([],d),y=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(l),o._centerAltitude):o._centerAltitude,v=Ba(1,0)*ti*y;n.$.scaleAndAdd(d,d,m,v);let S=n.ae.identity(new Float64Array(16));return n.ae.multiply(S,o.pixelMatrix,o.globeMatrix),n.$.transformMat4(d,d,S),new ai(d[0],d[1])}pixelsPerMeter(o,l){return Ba(1,0)*l}pixelSpaceConversion(o,l,d){let m=Ba(1,o)*l,y=Gi(Ba(1,45)*l,m,d);return this.pixelsPerMeter(o,l)/y}createTileMatrix(o,l,d){let m=MR(mh(d.canonical));return n.ae.multiply(new Float64Array(16),o.globeMatrix,m)}createInversionMatrix(o,l){let{center:d}=o,m=B1(mh(l));return n.ae.rotateY(m,m,Rr(d.lng)),n.ae.rotateX(m,m,Rr(d.lat)),n.ae.scale(m,m,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(o,l,d,m){return dj(o,l,d,!0)||new ia(0,0)}pointCoordinate3D(o,l,d){let m=this.pointCoordinate(o,l,d,0);return[m.x,m.y,m.z]}isPointAboveHorizon(o,l){return!dj(o,l.x,l.y,!1)}farthestPixelDistance(o){let l=function(m,y){let v=m.cameraToCenterDistance,S=m._centerAltitude*y,T=m._camera,D=m._camera.forward(),L=n.$.add([],n.$.scale([],D,-v),[0,0,S]),F=m.worldSize/(2*Math.PI),N=[0,0,-F],H=m.width/m.height,q=Math.tan(m.fovAboveCenter),Q=n.$.scale([],T.up(),q),K=n.$.scale([],T.right(),q*H),ae=n.$.normalize([],n.$.add([],n.$.add([],D,Q),K)),_e=[],ge;if(new xR(L,ae).closestPointOnSphere(N,F,_e)){let be=n.$.add([],_e,N),ze=n.$.sub([],be,L);ge=Math.cos(m.fovAboveCenter)*n.$.length(ze)}else{let be=n.$.sub([],L,N),ze=n.$.sub([],N,L);n.$.normalize(ze,ze);let ke=n.$.length(be)-F;ge=Math.sqrt(ke*(ke+2*F));let je=Math.acos(ge/(F+ke))-Math.acos(n.$.dot(D,ze));ge*=Math.cos(je)}return 1.01*ge}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),d=Pd(o.zoom);if(d>0){let m=p6(o,Ba(1,o.center.lat)*o.worldSize),y=o.worldSize/(2*Math.PI),v=Math.max(o.width,o.height)/o.worldSize*Math.PI;return Gi(l,m+y*(1-Math.cos(v)),Math.pow(d,10))}return l}upVector(o,l,d){return N1(l,d,o,1)}upVectorScale(o){return{metersToTile:_M(bM(mh(o)))}}}function _6(a){let o=a.parallels,l=!!o&&Math.abs(o[0]+o[1])<.01;switch(a.name){case"mercator":return new m6(a);case"equirectangular":return new qse(a);case"naturalEarth":return new Xse(a);case"equalEarth":return new Wse(a);case"winkelTripel":return new $se(a);case"albers":return l?new v6(a):new Hse(a);case"lambertConformalConic":return l?new v6(a):new Yse(a);case"globe":return new Zse(a)}throw new Error(`Invalid projection name: ${a.name}`)}let Qse=CM.types,Kse=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qM(a,o,l,d,m,y,v,S,T,D,L,F,N){let H=S?Math.min(ff,Math.round(S[0])):0,q=S?Math.min(ff,Math.round(S[1])):0;a.emplaceBack(o,l,Math.round(32*d),Math.round(32*m),y,v,(H<<1)+(T?1:0),q,16*D,16*L,256*F,256*N)}function YM(a,o,l){a.emplaceBack(o,l)}function XM(a,o,l,d,m,y,v){a.emplaceBack(o,l,d,m,y,v)}function $M(a,o,l,d,m){a.emplaceBack(o,l,d,m),a.emplaceBack(o,l,d,m),a.emplaceBack(o,l,d,m),a.emplaceBack(o,l,d,m)}function Jse(a){for(let o of a.sections)if(cr(o.text))return!0;return!1}class XR{constructor(o){this.layoutVertexArray=new GP,this.indexArray=new so,this.programConfigurations=o,this.segments=new ss,this.dynamicLayoutVertexArray=new tf,this.opacityVertexArray=new WP,this.placedSymbolArray=new R5,this.iconTransitioningVertexArray=new sf,this.globeExtVertexArray=new HP,this.zOffsetVertexArray=new Vv}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(o,l,d,m,y){this.isEmpty()||(d&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,ise.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,nse.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,Kse,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=o.createVertexBuffer(this.iconTransitioningVertexArray,sse.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,rse.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||y)&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,MV.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||m)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}tt(XR,"SymbolBuffers");class $R{constructor(o,l,d){this.layoutVertexArray=new o,this.layoutAttributes=l,this.indexArray=new d,this.segments=new ss,this.collisionVertexArray=new XP,this.collisionVertexArrayExt=new tf}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,ose.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,ase.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}tt($R,"CollisionBuffers");class o0{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.lut=o.lut,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(v=>v.fqid),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=n.ae.identity([]),this.placementViewportMatrix=n.ae.identity([]);let l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=BR(this.zoom,l["text-size"]),this.iconSizeData=BR(this.zoom,l["icon-size"]);let d=this.layers[0].layout,m=d.get("symbol-sort-key"),y=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(v=>Ql[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=o.sourceID,this.projection=o.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=d.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new XR(new af(this.layers,{zoom:this.zoom,lut:this.lut},o=>/^text/.test(o))),this.icon=new XR(new af(this.layers,{zoom:this.zoom,lut:this.lut},o=>/^icon/.test(o))),this.glyphOffsetArray=new z5,this.lineVertexArray=new F5,this.symbolInstances=new L5}calculateGlyphDependencies(o,l,d,m,y){for(let v=0;v<o.length;v++){let S=o.codePointAt(v);if(S===void 0)break;if(l[S]=!0,m&&y&&S<=65535){let T=Z1[o.charAt(v)];T&&(l[T.charCodeAt(0)]=!0)}}}updateFootprints(o,l){}updateReplacement(o,l){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;let d=l.getReplacementRegionsForTile(o.toUnwrapped(),!0);return!FR(this.activeReplacements,d)&&(this.activeReplacements=d,!0)}populate(o,l,d,m){let y=this.layers[0],v=y.layout,S=this.projection.name==="globe",T=v.get("text-font"),D=v.get("text-field"),L=v.get("icon-image"),F=(D.value.kind!=="constant"||D.value.value instanceof ea&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),N=L.value.kind!=="constant"||!!L.value.value||Object.keys(L.parameters).length>0,H=v.get("symbol-sort-key");if(this.features=[],!F&&!N)return;let q=l.iconDependencies,Q=l.glyphDependencies,K=l.availableImages,ae=new er(this.zoom);for(let{feature:_e,id:ge,index:be,sourceLayerIndex:ze}of o){let ke=y._featureFilter.needGeometry,je=Dd(_e,ke);if(!y._featureFilter.filter(ae,je,d))continue;if(ke||(je.geometry=du(_e,d,m)),S&&_e.type!==1&&d.z<=5){let dt=je.geometry,At=.98078528056,jt=(Ct,qt)=>{let Tt=N1(Ct.x,Ct.y,d,1),Ot=N1(qt.x,qt.y,d,1);return n.$.dot(Tt,Ot)<At};for(let Ct=0;Ct<dt.length;Ct++)dt[Ct]=Zre(dt[Ct],jt)}let it,ut;if(F){let dt=y.getValueAndResolveTokens("text-field",je,d,K),At=ea.factory(dt);Jse(At)&&(this.hasRTLText=!0),(!this.hasRTLText||ur()==="unavailable"||this.hasRTLText&&Ar.isParsed())&&(it=Tse(At,y,je))}if(N){let dt=y.getValueAndResolveTokens("icon-image",je,d,K);ut=dt instanceof Ka?dt:Ka.fromString(dt)}if(!it&&!ut)continue;let vt=this.sortFeaturesByKey?H.evaluate(je,{},d):void 0;if(this.features.push({id:ge,text:it,icon:ut,index:be,sourceLayerIndex:ze,geometry:je.geometry,properties:_e.properties,type:Qse[_e.type],sortKey:vt}),ut&&(q[ut.namePrimary]=!0,ut.nameSecondary&&(q[ut.nameSecondary]=!0)),it){let dt=T.evaluate(je,{},d).join(","),At=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ql.vertical)>=0;for(let jt of it.sections)if(jt.image)q[jt.image.namePrimary]=!0;else{let Ct=Rt(it.toString()),qt=jt.fontStack||dt,Tt=Q[qt]=Q[qt]||{};this.calculateGlyphDependencies(jt.text,Tt,At,this.allowVerticalPlacement,Ct)}}}v.get("symbol-placement")==="line"&&(this.features=function(_e){let ge={},be={},ze=[],ke=0;function je(dt){ze.push(_e[dt]),ke++}function it(dt,At,jt){let Ct=be[dt];return delete be[dt],be[At]=Ct,ze[Ct].geometry[0].pop(),ze[Ct].geometry[0]=ze[Ct].geometry[0].concat(jt[0]),Ct}function ut(dt,At,jt){let Ct=ge[At];return delete ge[At],ge[dt]=Ct,ze[Ct].geometry[0].shift(),ze[Ct].geometry[0]=jt[0].concat(ze[Ct].geometry[0]),Ct}function vt(dt,At,jt){let Ct=jt?At[0][At[0].length-1]:At[0][0];return`${dt}:${Ct.x}:${Ct.y}`}for(let dt=0;dt<_e.length;dt++){let At=_e[dt],jt=At.geometry,Ct=At.text?At.text.toString():null;if(!Ct){je(dt);continue}let qt=vt(Ct,jt),Tt=vt(Ct,jt,!0);if(qt in be&&Tt in ge&&be[qt]!==ge[Tt]){let Ot=ut(qt,Tt,jt),Kt=it(qt,Tt,ze[Ot].geometry);delete ge[qt],delete be[Tt],be[vt(Ct,ze[Kt].geometry,!0)]=Kt,ze[Ot].geometry=null}else qt in be?it(qt,Tt,jt):Tt in ge?ut(qt,Tt,jt):(je(dt),ge[qt]=ke-1,be[Tt]=ke-1)}return ze.filter(dt=>dt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((_e,ge)=>_e.sortKey-ge.sortKey)}update(o,l,d,m,y){let v=Object.keys(o).length!==0;if(v&&!this.stateDependentLayers.length)return;let S=v?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(o,l,S,d,m,y),this.icon.programConfigurations.updatePaintArrays(o,l,S,d,m,y)}updateZOffset(){let o=(y,v,S)=>{d+=v,d>y.length&&y.resize(d);for(let T=-v;T<0;T++)y.emplace(T+d,S)},l=(y,v,S)=>{m+=v,m>y.length&&y.resize(m);for(let T=-v;T<0;T++)y.emplace(T+m,S)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let d=0,m=0;for(let y=0;y<this.symbolInstances.length;y++){let v=this.symbolInstances.get(y),{numHorizontalGlyphVertices:S,numVerticalGlyphVertices:T,numIconVertices:D}=v,L=v.zOffset,F=D>0;if((S>0||T>0)&&(o(this.text.zOffsetVertexArray,S,L),o(this.text.zOffsetVertexArray,T,L)),F){let{placedIconSymbolIndex:N,verticalPlacedIconSymbolIndex:H}=v;N>=0&&l(this.icon.zOffsetVertexArray,D,L),H>=0&&l(this.icon.zOffsetVertexArray,v.numVerticalIconVertices,L)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=_6(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,l){let d=this.lineVertexArray.length;if(o.segment!==void 0)for(let{x:m,y}of l)this.lineVertexArray.emplaceBack(m,y);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(o,l,d,m,y,v,S,T,D,L,F,N,H,q,Q,K){let ae=o.indexArray,_e=o.layoutVertexArray,ge=o.globeExtVertexArray,be=o.segments.prepareSegment(4*l.length,_e,ae,this.canOverlap?v.sortKey:void 0),ze=this.glyphOffsetArray.length,ke=be.vertexLength,je=this.allowVerticalPlacement&&S===Ql.vertical?Math.PI/2:0,it=v.text&&v.text.sections;for(let vt=0;vt<l.length;vt++){let{tl:dt,tr:At,bl:jt,br:Ct,texPrimary:qt,texSecondary:Tt,pixelOffsetTL:Ot,pixelOffsetBR:Kt,minFontScaleX:Dt,minFontScaleY:ri,glyphOffset:Xt,isSDF:Vt,sectionIndex:zi}=l[vt],Ri=be.vertexLength,gi=Xt[1];if(qM(_e,D.x,D.y,dt.x,gi+dt.y,qt.x,qt.y,d,Vt,Ot.x,Ot.y,Dt,ri),qM(_e,D.x,D.y,At.x,gi+At.y,qt.x+qt.w,qt.y,d,Vt,Kt.x,Ot.y,Dt,ri),qM(_e,D.x,D.y,jt.x,gi+jt.y,qt.x,qt.y+qt.h,d,Vt,Ot.x,Kt.y,Dt,ri),qM(_e,D.x,D.y,Ct.x,gi+Ct.y,qt.x+qt.w,qt.y+qt.h,d,Vt,Kt.x,Kt.y,Dt,ri),T){let{x:ii,y:Ki,z:Oi}=T.anchor,[Ei,nr,or]=T.up;XM(ge,ii,Ki,Oi,Ei,nr,or),XM(ge,ii,Ki,Oi,Ei,nr,or),XM(ge,ii,Ki,Oi,Ei,nr,or),XM(ge,ii,Ki,Oi,Ei,nr,or),$M(o.dynamicLayoutVertexArray,ii,Ki,Oi,je)}else $M(o.dynamicLayoutVertexArray,D.x,D.y,D.z,je);if(K){let ii=Tt||qt;YM(o.iconTransitioningVertexArray,ii.x,ii.y),YM(o.iconTransitioningVertexArray,ii.x+ii.w,ii.y),YM(o.iconTransitioningVertexArray,ii.x,ii.y+ii.h),YM(o.iconTransitioningVertexArray,ii.x+ii.w,ii.y+ii.h)}ae.emplaceBack(Ri,Ri+1,Ri+2),ae.emplaceBack(Ri+1,Ri+2,Ri+3),be.vertexLength+=4,be.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Xt[0]),vt!==l.length-1&&zi===l[vt+1].sectionIndex||o.programConfigurations.populatePaintArrays(_e.length,v,v.index,{},H,q,Q,it&&it[zi])}let ut=T?T.anchor:D;o.placedSymbolArray.emplaceBack(ut.x,ut.y,ut.z,D.x,D.y,ze,this.glyphOffsetArray.length-ze,ke,L,F,D.segment,d?d[0]:0,d?d[1]:0,m[0],m[1],S,0,!1,0,N,0)}_commitLayoutVertex(o,l,d,m,y,v,S){o.emplaceBack(l,d,m,y,v,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(o,l,d,m,y,v,S){let T=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),D=T.vertexLength,L=S.tileAnchorX,F=S.tileAnchorY;for(let H=0;H<4;H++)d.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(d.collisionVertexArrayExt,l,o.padding,S.zOffset),this._commitLayoutVertex(d.layoutVertexArray,m,y,v,L,F,new ai(o.x1,o.y1)),this._commitLayoutVertex(d.layoutVertexArray,m,y,v,L,F,new ai(o.x2,o.y1)),this._commitLayoutVertex(d.layoutVertexArray,m,y,v,L,F,new ai(o.x2,o.y2)),this._commitLayoutVertex(d.layoutVertexArray,m,y,v,L,F,new ai(o.x1,o.y2)),T.vertexLength+=4;let N=d.indexArray;N.emplaceBack(D,D+1),N.emplaceBack(D+1,D+2),N.emplaceBack(D+2,D+3),N.emplaceBack(D+3,D),T.primitiveLength+=4}_addTextDebugCollisionBoxes(o,l,d,m,y,v){for(let S=m;S<y;S++){let T=d.get(S),D=this.getSymbolInstanceTextSize(o,v,l,S);this._addCollisionDebugVertices(T,D,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(o,l,d,m,y,v){for(let S=m;S<y;S++){let T=d.get(S),D=this.getSymbolInstanceIconSize(o,l,v.placedIconSymbolIndex);this._addCollisionDebugVertices(T,D,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,v)}}generateCollisionDebugBuffers(o,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $R(uM,TV.members,sf),this.iconCollisionBox=new $R(uM,TV.members,sf);let d=t0(this.iconSizeData,o),m=t0(this.textSizeData,o);for(let y=0;y<this.symbolInstances.length;y++){let v=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(m,o,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(m,o,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(d,o,l,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(d,o,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(o,l,d,m){let y=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:m),v=NM(this.textSizeData,o,y)/Bo;return this.tilePixelRatio*v}getSymbolInstanceIconSize(o,l,d){let m=this.icon.placedSymbolArray.get(d),y=NM(this.iconSizeData,o,m);return this.tilePixelRatio*y}_commitDebugCollisionVertexUpdate(o,l,d,m){o.emplaceBack(l,-d,-d,m),o.emplaceBack(l,d,-d,m),o.emplaceBack(l,d,d,m),o.emplaceBack(l,-d,d,m)}_updateTextDebugCollisionBoxes(o,l,d,m,y,v){for(let S=m;S<y;S++){let T=d.get(S),D=this.getSymbolInstanceTextSize(o,v,l,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,T.padding,v.zOffset)}}_updateIconDebugCollisionBoxes(o,l,d,m,y,v){for(let S=m;S<y;S++){let T=d.get(S),D=this.getSymbolInstanceIconSize(o,l,v.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,T.padding,v.zOffset)}}updateCollisionDebugBuffers(o,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let d=t0(this.iconSizeData,o),m=t0(this.textSizeData,o);for(let y=0;y<this.symbolInstances.length;y++){let v=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(m,o,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._updateTextDebugCollisionBoxes(m,o,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._updateIconDebugCollisionBoxes(d,o,l,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._updateIconDebugCollisionBoxes(d,o,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,l,d,m,y,v,S,T,D){let L={};if(l<d){let{x1:F,y1:N,x2:H,y2:q,padding:Q,projectedAnchorX:K,projectedAnchorY:ae,projectedAnchorZ:_e,tileAnchorX:ge,tileAnchorY:be,featureIndex:ze}=o.get(l);L.textBox={x1:F,y1:N,x2:H,y2:q,padding:Q,projectedAnchorX:K,projectedAnchorY:ae,projectedAnchorZ:_e,tileAnchorX:ge,tileAnchorY:be},L.textFeatureIndex=ze}if(m<y){let{x1:F,y1:N,x2:H,y2:q,padding:Q,projectedAnchorX:K,projectedAnchorY:ae,projectedAnchorZ:_e,tileAnchorX:ge,tileAnchorY:be,featureIndex:ze}=o.get(m);L.verticalTextBox={x1:F,y1:N,x2:H,y2:q,padding:Q,projectedAnchorX:K,projectedAnchorY:ae,projectedAnchorZ:_e,tileAnchorX:ge,tileAnchorY:be},L.verticalTextFeatureIndex=ze}if(v<S){let{x1:F,y1:N,x2:H,y2:q,padding:Q,projectedAnchorX:K,projectedAnchorY:ae,projectedAnchorZ:_e,tileAnchorX:ge,tileAnchorY:be,featureIndex:ze}=o.get(v);L.iconBox={x1:F,y1:N,x2:H,y2:q,padding:Q,projectedAnchorX:K,projectedAnchorY:ae,projectedAnchorZ:_e,tileAnchorX:ge,tileAnchorY:be},L.iconFeatureIndex=ze}if(T<D){let{x1:F,y1:N,x2:H,y2:q,padding:Q,projectedAnchorX:K,projectedAnchorY:ae,projectedAnchorZ:_e,tileAnchorX:ge,tileAnchorY:be,featureIndex:ze}=o.get(T);L.verticalIconBox={x1:F,y1:N,x2:H,y2:q,padding:Q,projectedAnchorX:K,projectedAnchorY:ae,projectedAnchorZ:_e,tileAnchorX:ge,tileAnchorY:be},L.verticalIconFeatureIndex=ze}return L}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){let d=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(o,l){let d=o.placedSymbolArray.get(l),m=d.vertexStartIndex+4*d.numGlyphs;for(let y=d.vertexStartIndex;y<m;y+=4)o.indexArray.emplaceBack(y,y+1,y+2),o.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let l=Math.sin(o),d=Math.cos(o),m=[],y=[],v=[];for(let S=0;S<this.symbolInstances.length;++S){v.push(S);let T=this.symbolInstances.get(S);m.push(0|Math.round(l*T.tileAnchorX+d*T.tileAnchorY)),y.push(T.featureIndex)}return v.sort((S,T)=>m[S]-m[T]||y[T]-y[S]),v}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let o=0;o<this.symbolInstances.length;++o)this.symbolInstanceIndexesSortedZOffset.push(o)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((o,l)=>this.symbolInstances.get(l).zOffset-this.symbolInstances.get(o).zOffset)}addToSortKeyRanges(o,l){let d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===l?d.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let l of this.symbolInstanceIndexes){let d=this.symbolInstances.get(l);this.featureSortOrder.push(d.featureIndex);let{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:y,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:S,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:D}=d;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&y!==m&&this.addIndicesForPlacedSymbol(this.text,y),v>=0&&v!==y&&v!==m&&this.addIndicesForPlacedSymbol(this.text,v),S>=0&&this.addIndicesForPlacedSymbol(this.text,S),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}tt(o0,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),o0.addDynamicAttributes=$M;class Dc{constructor(o,l,d,m){this.context=o,this.format=d,this.texture=o.gl.createTexture(),this.update(l,m)}update(o,l,d){let{width:m,height:y}=o,{context:v}=this,{gl:S}=v;if(S.bindTexture(S.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!l||l.premultiply!==!1)),this.useMipmap=!!(l&&l.useMipmap),d||this.size&&this.size[0]===m&&this.size[1]===y){let{x:T,y:D}=d||{x:0,y:0};if(o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||ImageBitmap&&o instanceof ImageBitmap)S.texSubImage2D(S.TEXTURE_2D,0,T,D,S.RGBA,S.UNSIGNED_BYTE,o);else{let L=this.format,F=S.UNSIGNED_BYTE;this.format===S.R32F&&(L=S.RED,F=S.FLOAT),S.texSubImage2D(S.TEXTURE_2D,0,T,D,m,y,L,F,o.data)}}else if(this.size=[m,y],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||ImageBitmap&&o instanceof ImageBitmap){let T=this.format;this.format===S.R8&&(T=S.RED),S.texImage2D(S.TEXTURE_2D,0,this.format,T,S.UNSIGNED_BYTE,o)}else{let T=this.format,D=this.format,L=S.UNSIGNED_BYTE,F=!1;this.format===S.DEPTH_COMPONENT&&(T=S.DEPTH_COMPONENT16,L=S.UNSIGNED_SHORT),this.format===S.DEPTH_STENCIL&&(T=S.DEPTH24_STENCIL8,L=S.UNSIGNED_INT_24_8,F=!0),this.format===S.R8&&(D=S.RED),this.format===S.R32F&&(L=S.FLOAT,D=S.RED),!this.useMipmap&&F?S.texStorage2D(S.TEXTURE_2D,1,T,m,y):S.texImage2D(S.TEXTURE_2D,0,T,m,y,0,D,L,o.data)}this.useMipmap&&S.generateMipmap(S.TEXTURE_2D)}bind(o,l,d=!1){let{context:m}=this,{gl:y}=m;y.bindTexture(y.TEXTURE_2D,this.texture),o!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,o),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap&&!d?o===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),l!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,l),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,l),this.wrapS=l)}bindExtraParam(o,l,d,m){let{context:y}=this,{gl:v}=y;v.bindTexture(v.TEXTURE_2D,this.texture),l!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,l),this.magFilter=l),o!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?o===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),d!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,d),this.wrapS=d),m!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,m),this.wrapT=m)}destroy(){let{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class ZM{constructor(o,l){this.context=o,this.texture=l}bind(o,l){let{context:d}=this,{gl:m}=d;m.bindTexture(m.TEXTURE_2D,this.texture),o!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,o),this.minFilter=o),l!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,l),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,l),this.wrapS=l)}}let Ic=32,yh=33,gf=new Uint16Array(8184);for(let a=0;a<2046;a++){let o=a+2,l=0,d=0,m=0,y=0,v=0,S=0;for(1&o?m=y=v=Ic:l=d=S=Ic;(o>>=1)>1;){let D=l+m>>1,L=d+y>>1;1&o?(m=l,y=d,l=v,d=S):(l=m,d=y,m=v,y=S),v=D,S=L}let T=4*a;gf[T+0]=l,gf[T+1]=d,gf[T+2]=m,gf[T+3]=y}let vh=new Uint16Array(2178),yf=new Uint8Array(1089),QM=new Uint16Array(1089);function x6(a){return a===0?-.03125:a===32?.03125:0}var KM=hn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let eoe=(()=>{class a{constructor(l,d,m,y){this.id=a.uniqueIdxCounter,a.uniqueIdxCounter++,this.context=l;let v=l.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||y||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){this.id=a.uniqueIdxCounter,a.uniqueIdxCounter++;let d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return a.uniqueIdxCounter=0,a})();class a0{constructor(o,l,d){this.func=o,this.mask=l,this.range=d}}a0.ReadOnly=!1,a0.ReadWrite=!0,a0.disabled=new a0(519,a0.ReadOnly,[0,1]);let ZR=7680;class QR{constructor(o,l,d,m,y,v){this.test=o,this.ref=l,this.mask=d,this.fail=m,this.depthFail=y,this.pass=v}}QR.disabled=new QR({func:519,mask:0},0,0,ZR,ZR,ZR);let nb=771;class Cl{constructor(o,l,d,m){this.blendFunction=o,this.blendColor=l,this.mask=d,this.blendEquation=m}}Cl.Replace=[1,0,1,0],Cl.disabled=new Cl(Cl.Replace,en.transparent,[!1,!1,!1,!1]),Cl.unblended=new Cl(Cl.Replace,en.transparent,[!0,!0,!0,!0]),Cl.alphaBlended=new Cl([1,nb,1,nb],en.transparent,[!0,!0,!0,!0]),Cl.alphaBlendedNonPremultiplied=new Cl([770,nb,770,nb],en.transparent,[!0,!0,!0,!0]),Cl.multiply=new Cl([774,0,774,0],en.transparent,[!0,!0,!0,!0]);let KR=1029,JR=2305;class mu{constructor(o,l,d){this.enable=o,this.mode=l,this.frontFace=d}}mu.disabled=new mu(!1,KR,JR),mu.backCCW=new mu(!0,KR,JR),mu.backCW=new mu(!0,KR,2304),mu.frontCW=new mu(!0,1028,2304),mu.frontCCW=new mu(!0,1028,JR);var toe=hn([{name:"a_index",type:"Int16",components:1}]);let b6={type:2,extent:ti,loadGeometry:()=>[[new ai(0,0),new ai(ti+1,0),new ai(ti+1,ti+1),new ai(0,ti+1),new ai(0,0)]]};class JM{constructor(o,l,d,m,y){this.tileID=o,this.uid=sv(),this.uses=0,this.tileSize=l,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(o){let l=o+this.timeAdded;l<Oo.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=xg(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,l,d){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(m,y){let v={};if(!y)return v;for(let S of m){let T=S.layerIds.map(D=>y.getLayer(D)).filter(Boolean);if(T.length!==0){S.layers=T,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(D=>T.filter(L=>L.id===D)[0]));for(let D of T)v[D.fqid]=S}}return v}(o.buckets,l.style),this.hasSymbolBuckets=!1;for(let m in this.buckets){let y=this.buckets[m];if(y instanceof o0){if(this.hasSymbolBuckets=!0,!d)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let m in this.buckets){let y=this.buckets[m];if(y instanceof o0&&y.hasRTLText){this.hasRTLText=!0,Ar.isLoading()||Ar.isLoaded()||ur()!=="deferred"||Xr();break}}this.queryPadding=0;for(let m in this.buckets){let y=this.buckets[m],v=l.style.getOwnLayer(m);if(!v)continue;let S=v.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,S)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new iR}unloadVectorData(){if(this.hasData()){for(let o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.fqid]}upload(o){for(let m in this.buckets){let y=this.buckets[m];y.uploadPending()&&y.upload(o)}let l=o.gl,d=this.imageAtlas;if(d&&!d.uploaded){let m=!!Object.keys(d.patternPositions).length;this.imageAtlasTexture=new Dc(o,d.image,l.RGBA,{useMipmap:m}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Dc(o,this.glyphAtlasImage,l.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Dc(o,this.lineAtlas.image,l.R8),this.lineAtlas.uploaded=!0)}prepare(o,l,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,d),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let m=l.style.getBrightness();(this._lastUpdatedBrightness||m)&&(this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this._lastUpdatedBrightness=m,this.updateBuckets(void 0,l)))}queryRenderedFeatures(o,l,d,m,y,v,S,T){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:m,pixelPosMatrix:S,transform:v,params:y,tileTransform:this.tileTransform},o,l,d):{}}querySourceFeatures(o,l){let d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;let m=d.loadVTLayers(),y=l?l.sourceLayer:"",v=m._geojsonTileLayer||m[y];if(!v)return;let S=cu(l&&l.filter),{z:T,x:D,y:L}=this.tileID.canonical,F={z:T,x:D,y:L};for(let N=0;N<v.length;N++){let H=v.feature(N);if(S.needGeometry){let K=Dd(H,!0);if(!S.filter(new er(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!S.filter(new er(this.tileID.overscaledZ),H))continue;let q=d.getId(H,y),Q=new VV(H,T,D,L,q);Q.tile=F,o.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){let l=this.expirationTime;if(o.cacheControl){let d=Pm(o.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){let d=Date.now(),m=!1;if(this.expirationTime>d)m=!1;else if(l)if(this.expirationTime<l)m=!0;else{let y=this.expirationTime-l;y?this.expirationTime=d+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,l){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(o).length!==0&&l&&this.updateBuckets(o,l)}updateBuckets(o,l){if(!this.latestFeatureIndex)return;let d=this.latestFeatureIndex.loadVTLayers(),m=l.style.listImages(),y=l.style.getBrightness();for(let v in this.buckets){if(!l.style.hasLayer(v))continue;let S=this.buckets[v],T=S.layers[0].sourceLayer||"_geojsonTileLayer",D=d[T],L={};if(o&&(L=o[T],!D||!L||Object.keys(L).length===0))continue;if(S.update(L,D,m,this.imageAtlas&&this.imageAtlas.patternPositions||{},y),S instanceof zM||S instanceof TM){let N=l.style.getOwnSourceCache(S.layers[0].source);l._terrain&&l._terrain.enabled&&N&&S.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(N.id,this.tileID)}let F=l&&l.style&&l.style.getOwnLayer(v);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Oo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=Oo.now()+o}setTexture(o,l){let d=l.context,m=d.gl;this.texture=this.texture||l.getTileTexture(o.width),this.texture&&this.texture instanceof Dc?this.texture.update(o,{useMipmap:!0}):(this.texture=new Dc(d,o,m.RGBA,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(o,l){let d={};for(let m of l)d[m]=!0;this.dependencies[o]=d}hasDependency(o,l){for(let d of o){let m=this.dependencies[d];if(m){for(let y of l)if(m[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;let d=du(b6,this.tileID.canonical,this.tileTransform)[0],m=new uu,y=new P1;for(let v=0;v<d.length;v++){let{x:S,y:T}=d[v];m.emplaceBack(S,T),y.emplaceBack(v)}y.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(y),this._tileDebugBuffer=o.createVertexBuffer(m,k1.members),this._tileDebugSegments=ss.simpleSegment(0,0,m.length,y.length)}_makeTileBoundsBuffers(o,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;let d=du(b6,this.tileID.canonical,this.tileTransform)[0],m,y;if(this.isRaster){let v=function(S,T){let D=xg(S,T),L=Math.pow(2,S.z);for(let K=0;K<yh;K++)for(let ae=0;ae<yh;ae++){let _e=ol((S.x+(ae+x6(ae))/Ic)/L),ge=_o((S.y+(K+x6(K))/Ic)/L),be=T.project(_e,ge),ze=K*yh+ae;vh[2*ze+0]=Math.round((be.x*D.scale-D.x)*ti),vh[2*ze+1]=Math.round((be.y*D.scale-D.y)*ti)}yf.fill(0),QM.fill(0);for(let K=2045;K>=0;K--){let ae=4*K,_e=gf[ae+0],ge=gf[ae+1],be=gf[ae+2],ze=gf[ae+3],ke=_e+be>>1,je=ge+ze>>1,it=ke+je-ge,ut=je+_e-ke,vt=ge*yh+_e,dt=ze*yh+be,At=je*yh+ke,jt=Math.hypot((vh[2*vt+0]+vh[2*dt+0])/2-vh[2*At+0],(vh[2*vt+1]+vh[2*dt+1])/2-vh[2*At+1])>=16;yf[At]=yf[At]||(jt?1:0),K<1022&&(yf[At]=yf[At]||yf[(ge+ut>>1)*yh+(_e+it>>1)]||yf[(ze+ut>>1)*yh+(be+it>>1)])}let F=new Md,N=new so,H=0;function q(K,ae){let _e=ae*yh+K;return QM[_e]===0&&(F.emplaceBack(vh[2*_e+0],vh[2*_e+1],K*ti/Ic,ae*ti/Ic),QM[_e]=++H),QM[_e]-1}function Q(K,ae,_e,ge,be,ze){let ke=K+_e>>1,je=ae+ge>>1;if(Math.abs(K-be)+Math.abs(ae-ze)>1&&yf[je*yh+ke])Q(be,ze,K,ae,ke,je),Q(_e,ge,be,ze,ke,je);else{let it=q(K,ae),ut=q(_e,ge),vt=q(be,ze);N.emplaceBack(it,ut,vt)}}return Q(0,0,Ic,Ic,Ic,0),Q(Ic,Ic,0,0,0,Ic),{vertices:F,indices:N}}(this.tileID.canonical,l);m=v.vertices,y=v.indices}else{m=new Md,y=new so;for(let{x:S,y:T}of d)m.emplaceBack(S,T,0,0);let v=j1(m.int16,void 0,4);for(let S=0;S<v.length;S+=3)y.emplaceBack(v[S],v[S+1],v[S+2])}this._tileBoundsBuffer=o.createVertexBuffer(m,KM.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(y),this._tileBoundsSegments=ss.simpleSegment(0,0,m.length,y.length)}_makeGlobeTileDebugBuffers(o,l){let d=l.projection;if(!d||d.name!=="globe"||l.freezeTileCoverage)return;let m=this.tileID.canonical,y=B1(pj(m,l)),v=Pd(l.zoom),S;v>0&&(S=n.ae.invert(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,m,l,y,S,v),this._makeGlobeTileDebugTextBuffer(o,m,l,y,S,v)}_globePoint(o,l,d,m,y,v,S){let T=N1(o,l,d);if(v){let D=1<<d.z,L=ph(m.center.lng),F=fh(m.center.lat),N=(d.x+.5)/D-L,H=0;N>.5?H=-1:N<-.5&&(H=1);let q=(o/ti+d.x)/D+H,Q=(l/ti+d.y)/D;q=(q-L)*m._pixelsPerMercatorPixel+L,Q=(Q-F)*m._pixelsPerMercatorPixel+F;let K=[q*m.worldSize,Q*m.worldSize,0];n.$.transformMat4(K,K,v),T=Id(T,K,S)}return n.$.transformMat4(T,T,y)}_makeGlobeTileDebugBorderBuffer(o,l,d,m,y,v){let S=new uu,T=new P1,D=new aM,L=(N,H,q,Q,K)=>{let ae=(q-N)/(K-1),_e=(Q-H)/(K-1),ge=S.length;for(let be=0;be<K;be++){let ze=N+be*ae,ke=H+be*_e;S.emplaceBack(ze,ke);let je=this._globePoint(ze,ke,l,d,m,y,v);D.emplaceBack(je[0],je[1],je[2]),T.emplaceBack(ge+be)}},F=ti;L(0,0,F,0,16),L(F,0,F,F,16),L(F,F,0,F,16),L(0,F,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(T),this._tileDebugBuffer=o.createVertexBuffer(S,k1.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(D,hj.members),this._tileDebugSegments=ss.simpleSegment(0,0,S.length,T.length)}_makeGlobeTileDebugTextBuffer(o,l,d,m,y,v){let S=ti/4,T=new uu,D=new so,L=new aM,F=25;D.reserve(32),T.reserve(F),L.reserve(F);let N=(H,q)=>F*H+q;for(let H=0;H<F;H++){let q=H*S;for(let Q=0;Q<F;Q++){let K=Q*S;T.emplaceBack(K,q);let ae=this._globePoint(K,q,l,d,m,y,v);L.emplaceBack(ae[0],ae[1],ae[2])}}for(let H=0;H<4;H++)for(let q=0;q<4;q++){let Q=N(H,q),K=N(H,q+1),ae=N(H+1,q),_e=N(H+1,q+1);D.emplaceBack(Q,K,ae),D.emplaceBack(ae,K,_e)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(D),this._tileDebugTextBuffer=o.createVertexBuffer(T,k1.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(L,hj.members),this._tileDebugTextSegments=ss.simpleSegment(0,0,F,32)}destroy(o=!1){for(let l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!o&&this.texture&&this.texture instanceof Dc&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function ioe(a,o,l){a===1?o.header_length=l.readFixed32():a===2?o.x=l.readVarint():a===3?o.y=l.readVarint():a===4?o.z=l.readVarint():a===5&&o.layers.push(function(d,m){return d.readFields(aoe,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},m)}(l,l.readVarint()+l.pos))}function roe(a,o,l){a===1?(o.delta_filter=function(d,m){return d.readFields(noe,{block_size:0},m)}(l,l.readVarint()+l.pos),o.filter="delta_filter"):a===2?(l.readVarint(),o.filter="zigzag_filter"):a===3?(l.readVarint(),o.filter="bitshuffle_filter"):a===4&&(l.readVarint(),o.filter="byteshuffle_filter")}function noe(a,o,l){a===1&&(o.block_size=l.readVarint())}function soe(a,o,l){a===1?(l.readVarint(),o.codec="gzip_data"):a===2?(l.readVarint(),o.codec="jpeg_image"):a===3?(l.readVarint(),o.codec="webp_image"):a===4&&(l.readVarint(),o.codec="png_image")}function ooe(a,o,l){a===1?o.first_byte=l.readFixed64():a===2?o.last_byte=l.readFixed64():a===3?o.filters.push(function(d,m){return d.readFields(roe,{},m)}(l,l.readVarint()+l.pos)):a===4?o.codec=function(d,m){return d.readFields(soe,{},m)}(l,l.readVarint()+l.pos):a===5?o.deprecated_offset=l.readFloat():a===6?o.deprecated_scale=l.readFloat():a===7?o.bands.push(l.readString()):a===8?o.offset=l.readDouble():a===9&&(o.scale=l.readDouble())}function aoe(a,o,l){a===1?o.version=l.readVarint():a===2?o.name=l.readString():a===3?o.units=l.readString():a===4?o.tilesize=l.readVarint():a===5?o.buffer=l.readVarint():a===6?o.pixel_format=l.readVarint():a===7&&o.data_index.push(function(d,m){return d.readFields(ooe,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},m)}(l,l.readVarint()+l.pos))}function loe(a,o,l){if(a===2)(function(d,m,y){d.readFields(coe,y,m)})(l,l.readVarint()+l.pos,o);else if(a===3)throw new Error("Not implemented")}function coe(a,o,l){if(a===1){let d=0,m=l.readVarint()+l.pos;for(;l.pos<m;)o[d++]=l.readVarint()}}class uoe{constructor(o){this.capacity=o,this.cache=new Map}get(o){if(!this.cache.has(o))return;let l=this.cache.get(o);return this.cache.delete(o),this.cache.set(o,l),l}put(o,l){this.cache.has(o)?this.cache.delete(o):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(o,l)}}function hoe(a,o){if(o.length!==4)throw new Error(`Expected data of dimension 4 but got ${o.length}.`);let l=o[3];for(let d=2;d>=1;d--){let m=d===1?1:0,y=d===2?1:0;for(let v=0;v<o[0];v++){let S=o[1]*v;for(let T=m;T<o[1];T++){let D=o[2]*(T+S);for(let L=y;L<o[2];L++){let F=o[3]*(L+D);for(let N=0;N<o[3];N++){let H=F+N;a[H]+=a[H-l]}}}}l*=o[d]}return a}function doe(a){for(let o=0,l=a.length;o<l;o++)a[o]=a[o]>>>1^-(1&a[o]);return a}function poe(a,o){switch(o){case"uint32":return a;case"uint16":for(let l=0;l<a.length;l+=2){let d=a[l],m=a[l+1];a[l]=(240&d)>>4|(61440&d)>>8|(240&m)<<4|61440&m,a[l+1]=15&d|(3840&d)>>4|(15&m)<<8|(3840&m)<<4}return a;case"uint8":for(let l=0;l<a.length;l+=4){let d=a[l],m=a[l+1],y=a[l+2],v=a[l+3];a[l+0]=(192&d)>>6|(192&m)>>4|(192&y)>>2|192&v,a[l+1]=(48&d)>>4|(48&m)>>2|48&y|(48&v)<<2,a[l+2]=(12&d)>>2|12&m|(12&y)<<2|(12&v)<<4,a[l+3]=3&d|(3&m)<<2|(3&y)<<4|(3&v)<<6}return a;default:throw new Error(`Invalid pixel format, "${o}"`)}}var Kl=Uint8Array,sb=Uint16Array,foe=Int32Array,w6=new Kl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),S6=new Kl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),moe=new Kl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),E6=function(a,o){for(var l=new sb(31),d=0;d<31;++d)l[d]=o+=1<<a[d-1];var m=new foe(l[30]);for(d=1;d<30;++d)for(var y=l[d];y<l[d+1];++y)m[y]=y-l[d]<<5|d;return{b:l,r:m}},M6=E6(w6,2),T6=M6.b,goe=M6.r;T6[28]=258,goe[258]=28;for(var yoe=E6(S6,0).b,A6=new sb(32768),Ns=0;Ns<32768;++Ns){var l0=(43690&Ns)>>1|(21845&Ns)<<1;A6[Ns]=((65280&(l0=(61680&(l0=(52428&l0)>>2|(13107&l0)<<2))>>4|(3855&l0)<<4))>>8|(255&l0)<<8)>>1}var ob=function(a,o,l){for(var d=a.length,m=0,y=new sb(o);m<d;++m)a[m]&&++y[a[m]-1];var v,S=new sb(o);for(m=1;m<o;++m)S[m]=S[m-1]+y[m-1]<<1;v=new sb(1<<o);var T=15-o;for(m=0;m<d;++m)if(a[m])for(var D=m<<4|a[m],L=o-a[m],F=S[a[m]-1]++<<L,N=F|(1<<L)-1;F<=N;++F)v[A6[F]>>T]=D;return v},ab=new Kl(288);for(Ns=0;Ns<144;++Ns)ab[Ns]=8;for(Ns=144;Ns<256;++Ns)ab[Ns]=9;for(Ns=256;Ns<280;++Ns)ab[Ns]=7;for(Ns=280;Ns<288;++Ns)ab[Ns]=8;var C6=new Kl(32);for(Ns=0;Ns<32;++Ns)C6[Ns]=5;var voe=ob(ab,9),_oe=ob(C6,5),eO=function(a){for(var o=a[0],l=1;l<a.length;++l)a[l]>o&&(o=a[l]);return o},gu=function(a,o,l){var d=o/8|0;return(a[d]|a[d+1]<<8)>>(7&o)&l},tO=function(a,o){var l=o/8|0;return(a[l]|a[l+1]<<8|a[l+2]<<16)>>(7&o)},xoe=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],yu=function(a,o,l){var d=new Error(o||xoe[a]);if(d.code=a,Error.captureStackTrace&&Error.captureStackTrace(d,yu),!l)throw d;return d},boe=new Kl(0),woe=typeof TextDecoder<"u"&&new TextDecoder;try{woe.decode(boe,{stream:!0})}catch{}let Soe={gzip_data:"gzip"};class Pc extends Error{constructor(o){super(o),this.name="MRTError"}}let Eoe={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},D6={uint32:1,uint16:2,uint8:4},Moe={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array},iO,rO;class lb{constructor(o=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=o}getLayer(o){let l=this.layers[o];if(!l)throw new Pc(`Layer '${o}' not found`);return l}getHeaderLength(o){let l=new Uint8Array(o),d=new DataView(o);if(l[0]!==13)throw new Pc("File is not a valid MRT.");return d.getUint32(1,!0)}parseHeader(o){let l=new Uint8Array(o),d=this.getHeaderLength(o);if(l.length<d)throw new Pc(`Expected header with length >= ${d} but got buffer of length ${l.length}`);let m=function(y,v){return y.readFields(ioe,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new iO(l.subarray(0,d)));if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new Pc(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(let y of m.layers)this.layers[y.name]=new Toe(y,{cacheSize:this._cacheSize});return this}createDecodingTask(o){let l=[],d=this.getLayer(o.layerName);for(let m of o.blockIndices){let y=d.dataIndex[m],v=y.first_byte-o.firstByte,S=y.last_byte-o.firstByte;if(d._blocksInProgress.has(m))continue;let T={layerName:d.name,firstByte:v,lastByte:S,pixelFormat:d.pixelFormat,blockIndex:m,blockShape:[y.bands.length].concat(d.bandShape),buffer:d.buffer,codec:y.codec.codec,filters:y.filters.map(D=>D.filter)};d._blocksInProgress.add(m),l.push(T)}return new I6(l,()=>{l.forEach(m=>d._blocksInProgress.delete(m.blockIndex))},(m,y)=>{if(l.forEach(v=>d._blocksInProgress.delete(v.blockIndex)),m)throw m;y.forEach(v=>{this.getLayer(v.layerName).processDecodedData(v)})})}}class Toe{constructor({version:o,name:l,units:d,tilesize:m,pixel_format:y,buffer:v,data_index:S},T){if(this.version=o,this.version!==1)throw new Pc(`Cannot parse raster layer encoded with MRT version ${o}`);this.name=l,this.units=d,this.tileSize=m,this.buffer=v,this.pixelFormat=Eoe[y],this.dataIndex=S,this.bandShape=[m+2*v,m+2*v,D6[this.pixelFormat]],this._decodedBlocks=new uoe(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return D6[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:o})=>o).flat()}processDecodedData(o){let l=o.blockIndex.toString();this._decodedBlocks.get(l)||this._decodedBlocks.put(l,o.data)}getBlockForBand(o){let l=0;switch(typeof o){case"string":for(let[d,m]of this.dataIndex.entries()){for(let[y,v]of m.bands.entries())if(v===o)return{bandIndex:l+y,blockIndex:d,blockBandIndex:y};l+=m.bands.length}break;case"number":for(let[d,m]of this.dataIndex.entries()){if(o>=l&&o<l+m.bands.length)return{bandIndex:o,blockIndex:d,blockBandIndex:o-l};l+=m.bands.length}break;default:throw new Pc(`Invalid band \`${JSON.stringify(o)}\`. Expected string or integer.`)}throw new Pc(`Band not found: ${JSON.stringify(o)}`)}getDataRange(o){let l=1/0,d=-1/0,m=[],y=new Set;for(let v of o){let{blockIndex:S}=this.getBlockForBand(v);if(S<0)throw new Pc(`Invalid band: ${JSON.stringify(v)}`);let T=this.dataIndex[S];m.includes(S)||m.push(S),y.add(S),l=Math.min(l,T.first_byte),d=Math.max(d,T.last_byte)}if(y.size>this.cacheSize)throw new Pc(`Number of blocks to decode (${y.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:l,lastByte:d,blockIndices:m}}hasBand(o){let{blockIndex:l}=this.getBlockForBand(o);return l>=0}hasDataForBand(o){let{blockIndex:l}=this.getBlockForBand(o);return l>=0&&!!this._decodedBlocks.get(l.toString())}getBandView(o){let{blockIndex:l,blockBandIndex:d}=this.getBlockForBand(o),m=this._decodedBlocks.get(l.toString());if(!m)throw new Pc(`Data for band ${JSON.stringify(o)} of layer "${this.name}" not decoded.`);let y=this.dataIndex[l],v=this.bandShape.reduce((D,L)=>D*L,1),S=d*v,T=m.subarray(S,S+v);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:y.offset!==0?y.offset:y.deprecated_offset,scale:y.scale!==0?y.scale:y.deprecated_scale}}}lb.setPbf=function(a){iO=a};class I6{constructor(o,l,d){this.tasks=o,this._onCancel=l,this._onComplete=d,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(o,l){this._finalized||(this._onComplete(o,l),this._finalized=!0)}}lb.performDecoding=function(a,o){let l=new Uint8Array(a);return Promise.all(o.tasks.map(d=>{let{layerName:m,firstByte:y,lastByte:v,pixelFormat:S,blockShape:T,blockIndex:D,filters:L,codec:F}=d,N=l.subarray(y,v+1),H=new Uint32Array(T[0]*T[1]*T[2]),q;if(F!=="gzip_data")throw new Pc(`Unhandled codec: ${F}`);return q=function(Q,K){if(!globalThis.DecompressionStream&&K==="gzip_data")return Promise.resolve(((be=function(je){je[0]==31&&je[1]==139&&je[2]==8||yu(6,"invalid gzip data");var it=je[3],ut=10;4&it&&(ut+=2+(je[10]|je[11]<<8));for(var vt=(it>>3&1)+(it>>4&1);vt>0;vt-=!je[ut++]);return ut+(2&it)}(ge=Q))+8>ge.length&&yu(6,"invalid gzip data"),function(je,it,ut,vt){var dt=je.length;if(!dt||it.f&&!it.l)return ut||new Kl(0);var At=!ut,jt=At||it.i!=2,Ct=it.i;At&&(ut=new Kl(3*dt));var qt,Tt,Ot=function(_f){var Tg=ut.length;if(_f>Tg){var vb=new Kl(Math.max(2*Tg,_f));vb.set(ut),ut=vb}},Kt=it.f||0,Dt=it.p||0,ri=it.b||0,Xt=it.l,Vt=it.d,zi=it.m,Ri=it.n,gi=8*dt;do{if(!Xt){Kt=gu(je,Dt,1);var ii=gu(je,Dt+1,3);if(Dt+=3,!ii){var Ki=je[(ar=4+((Dt+7)/8|0))-4]|je[ar-3]<<8,Oi=ar+Ki;if(Oi>dt){Ct&&yu(0);break}jt&&Ot(ri+Ki),ut.set(je.subarray(ar,Oi),ri),it.b=ri+=Ki,it.p=Dt=8*Oi,it.f=Kt;continue}if(ii==1)Xt=voe,Vt=_oe,zi=9,Ri=5;else if(ii==2){var Ei=gu(je,Dt,31)+257,nr=gu(je,Dt+10,15)+4,or=Ei+gu(je,Dt+5,31)+1;Dt+=14;for(var sr=new Kl(or),yr=new Kl(19),jr=0;jr<nr;++jr)yr[moe[jr]]=gu(je,Dt+3*jr,7);Dt+=3*nr;var Ir=eO(yr),En=(1<<Ir)-1,In=ob(yr,Ir);for(jr=0;jr<or;){var ar,dn=In[gu(je,Dt,En)];if(Dt+=15&dn,(ar=dn>>4)<16)sr[jr++]=ar;else{var fn=0,Un=0;for(ar==16?(Un=3+gu(je,Dt,3),Dt+=2,fn=sr[jr-1]):ar==17?(Un=3+gu(je,Dt,7),Dt+=3):ar==18&&(Un=11+gu(je,Dt,127),Dt+=7);Un--;)sr[jr++]=fn}}var Ms=sr.subarray(0,Ei),Bs=sr.subarray(Ei);zi=eO(Ms),Ri=eO(Bs),Xt=ob(Ms,zi),Vt=ob(Bs,Ri)}else yu(1);if(Dt>gi){Ct&&yu(0);break}}jt&&Ot(ri+131072);for(var Ts=(1<<zi)-1,us=(1<<Ri)-1,oo=Dt;;oo=Dt){var Gs=(fn=Xt[tO(je,Dt)&Ts])>>4;if((Dt+=15&fn)>gi){Ct&&yu(0);break}if(fn||yu(2),Gs<256)ut[ri++]=Gs;else{if(Gs==256){oo=Dt,Xt=null;break}var Uo=Gs-254;Gs>264&&(Uo=gu(je,Dt,(1<<(_u=w6[jr=Gs-257]))-1)+T6[jr],Dt+=_u);var Fn=Vt[tO(je,Dt)&us],al=Fn>>4;if(Fn||yu(3),Dt+=15&Fn,Bs=yoe[al],al>3){var _u=S6[al];Bs+=tO(je,Dt)&(1<<_u)-1,Dt+=_u}if(Dt>gi){Ct&&yu(0);break}jt&&Ot(ri+131072);var Rc=ri+Uo;if(ri<Bs){var Oc=0-Bs,Mg=Math.min(Bs,Rc);for(Oc+ri<0&&yu(3);ri<Mg;++ri)ut[ri]=(void 0)[Oc+ri]}for(;ri<Rc;++ri)ut[ri]=ut[ri-Bs]}}it.l=Xt,it.p=oo,it.b=ri,it.f=Kt,Xt&&(Kt=1,it.m=zi,it.d=Vt,it.n=Ri)}while(!Kt);return ri!=ut.length&&At?(qt=ut,((Tt=ri)==null||Tt>qt.length)&&(Tt=qt.length),new Kl(qt.subarray(0,Tt))):ut.subarray(0,ri)}(ge.subarray(be,-8),{i:2},new Kl(((ae=ge)[(_e=ae.length)-4]|ae[_e-3]<<8|ae[_e-2]<<16|ae[_e-1]<<24)>>>0))));var ae,_e,ge,be;let ze=Soe[K];if(!ze)throw new Error(`Unhandled codec: ${K}`);let ke=new globalThis.DecompressionStream(ze);return new Response(new Blob([Q]).stream().pipeThrough(ke)).arrayBuffer().then(je=>new Uint8Array(je))}(N,F).then(Q=>(function(K,ae){K.readFields(loe,ae)}(new iO(Q),H),new Moe[S](H.buffer))),q.then(Q=>{for(let K=L.length-1;K>=0;K--)switch(L[K]){case"delta_filter":hoe(Q,T);break;case"zigzag_filter":doe(Q);break;case"bitshuffle_filter":poe(Q,S);break;default:throw new Pc(`Unhandled filter "${L[K]}"`)}return{layerName:m,blockIndex:D,data:Q}}).catch(Q=>{throw Q})}))},lb.setPbf($1);class P6 extends JM{constructor(o,l,d,m,y){super(o,l,d,m,y),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(o,l){let d=l.context,m=d.gl;this.texture=this.texture||l.getTileTexture(o.width),this.texture&&this.texture instanceof Dc?this.texture.update(o,{useMipmap:!1,premultiply:!1}):this.texture=new Dc(d,o,m.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(o=16384,l){let d=this._mrt=new lb(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=pd(m,(y,v,S,T)=>{if(y)l(y);else try{let D=d.getHeaderLength(v);if(D>o)return void(this.request=this.fetchHeader(D,l));d.parseHeader(v),this._isHeaderLoaded=!0;let L=0;for(let F of Object.values(d.layers))L=Math.max(L,F.dataIndex[F.dataIndex.length-1].last_byte);v.byteLength>=L&&(this.entireBuffer=v),l(null,this.entireBuffer||v,S,T)}catch(D){l(D)}}),this.request}fetchBand(o,l,d){let m=this._mrt;if(!this._isHeaderLoaded||!m)return void d(new Error("Tile header is not ready"));let y=this.actor;if(!y)return void d(new Error("Can't fetch tile band without an actor"));let v,S=(F,N)=>{v.complete(F,N),F?d(F):(this.updateTextureDescriptor(o,l),d(null,this.textureDescriptor&&this.textureDescriptor.img))},T=(F,N)=>{if(F)return d(F);let H=y.send("decodeRasterArray",{buffer:N,task:v},S,void 0,!0);this._workQueue.push(()=>{H&&H.cancel(),v.cancel()})},D=m.getLayer(o);if(!D)return void d(new Error(`Unknown sourceLayer "${o}"`));if(D.hasDataForBand(l))return this.updateTextureDescriptor(o,l),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);let L=D.getDataRange([l]);if(v=m.createDecodingTask(L),!v||v.tasks.length)if(this.flushQueues(),this.entireBuffer)T(null,this.entireBuffer.slice(L.firstByte,L.lastByte+1));else{let F=Object.assign({},this.requestParams,{headers:{Range:`bytes=${L.firstByte}-${L.lastByte}`}}),N=pd(F,T);this._fetchQueue.push(()=>{N.cancel(),v.cancel()})}else d(null)}updateNeeded(o,l){return(!this.textureDescriptor||this.textureDescriptor.band!==l||this.textureDescriptor.layer!==o)&&this.state!=="errored"}updateTextureDescriptor(o,l){if(!this._mrt)return;let d=this._mrt.getLayer(o);if(!d||!d.hasBand(l)||!d.hasDataForBand(l))return;let{bytes:m,tileSize:y,buffer:v,offset:S,scale:T}=d.getBandView(l),D=y+2*v,L={data:m,width:D,height:D},F=this.texture;F&&F instanceof Dc&&F.update(L,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:o,band:l,img:L,buffer:v,offset:S,tileSize:y,format:d.pixelFormat,mix:[T,256*T,65536*T,16777216*T]}}}class Aoe{constructor(o,l){this.max=o,this.onRemove=l,this.reset()}reset(){for(let o in this.data)for(let l of this.data[o])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(o,l,d){let m=o.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);let y={value:l,timeout:void 0};if(d!==void 0&&(y.timeout=setTimeout(()=>{this.remove(o,y)},d)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){let v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){let l=this.data[o].shift();return l.timeout&&clearTimeout(l.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),l.value}getByKey(o){let l=this.data[o];return l?l[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,l){if(!this.has(o))return this;let d=o.wrapped().key,m=l===void 0?0:this.data[d].indexOf(l),y=this.data[d][m];return this.data[d].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(y.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){let l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(o){let l=[];for(let d in this.data)for(let m of this.data[d])o(m.value)||l.push(m);for(let d of l)this.remove(d.value.tileID,d)}}class bg extends yd{constructor(o,l,d){super(),this.id=o,this._onlySymbols=d,l.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new Aoe(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Sse,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let o in this._tiles){let l=this._tiles[o];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,l){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,l)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let l in this._tiles){let d=this._tiles[l];d.upload(o),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Wx(this._tiles).map(o=>o.tileID).sort(R6).map(o=>o.key)}getRenderableIds(o,l){let d=[];for(let m in this._tiles)this._isIdRenderable(+m,o,l)&&d.push(this._tiles[m]);return o?d.sort((m,y)=>{let v=m.tileID,S=y.tileID,T=new ai(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),D=new ai(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-S.overscaledZ||D.y-T.y||D.x-T.x}).map(m=>m.tileID.key):d.map(m=>m.tileID).sort(R6).map(m=>m.key)}hasRenderableParent(o){let l=this.findLoadedParent(o,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(o,l,d){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(l||!this._tiles[o].holdingForFade())&&(d||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,l){let d=this._tiles[o];d&&(d.state!=="loading"&&(d.state=l),this._loadTile(d,this._tileLoaded.bind(this,d,o,l)))}_tileLoaded(o,l,d,m){if(m)if(o.state="errored",m.status!==404)this._source.fire(new Hm(m,{tile:o}));else{if(this._source.fire(new Ec("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform)}else o.timeAdded=Oo.now(),d==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(l,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new Ec("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){let l=this.getRenderableIds();for(let m=0;m<l.length;m++){let y=l[m];if(o.neighboringTiles&&o.neighboringTiles[y]){let v=this.getTileByID(y);d(o,v),d(v,o)}}function d(m,y){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let v=y.tileID.canonical.x-m.tileID.canonical.x,S=y.tileID.canonical.y-m.tileID.canonical.y,T=Math.pow(2,m.tileID.canonical.z),D=y.tileID.key;v===0&&S===0||Math.abs(S)>1||(Math.abs(v)>1&&(Math.abs(v+T)===1?v+=T:Math.abs(v-T)===1&&(v-=T)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,v,S),m.neighboringTiles&&m.neighboringTiles[D]&&(m.neighboringTiles[D].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,l,d,m){for(let y in this._tiles){let v=this._tiles[y];if(m[y]||!v.hasData()||v.tileID.overscaledZ<=l||v.tileID.overscaledZ>d)continue;let S=v.tileID;for(;v&&v.tileID.overscaledZ>l+1;){let D=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[D.key],v&&v.hasData()&&(S=D)}let T=S;for(;T.overscaledZ>l;)if(T=T.scaledTo(T.overscaledZ-1),o[T.key]){m[S.key]=S;break}}}findLoadedParent(o,l){if(o.key in this._loadedParentTiles){let d=this._loadedParentTiles[o.key];return d&&d.tileID.overscaledZ>=l?d:null}for(let d=o.overscaledZ-1;d>=l;d--){let m=o.scaledTo(d),y=this._getLoadedTile(m);if(y)return y}}_getLoadedTile(o){let l=this._tiles[o.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,l){l=l||this._source.tileSize;let d=Math.ceil(o.width/l)+1,m=Math.ceil(o.height/l)+1,y=Math.floor(d*m*5),v=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(S)}handleWrapJump(o){let l=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,l){let d={};for(let m in this._tiles){let y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+l),d[y.tileID.key]=y}this._tiles=d;for(let m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(let m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(o,l,d,m){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(o,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};let y=this._source.type==="batched-model",v;if(this.used||this.usedForTerrain){if(this._source.tileID)v=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new Ws(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y));else if(this.tileCoverLift!==0){let D=o.clone();D.tileCoverLift=this.tileCoverLift,v=D.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:y}),this._source.minzoom<=1&&o.projection.name==="globe"&&(v.push(new Ws(1,0,1,0,0)),v.push(new Ws(1,0,1,1,0)),v.push(new Ws(1,0,1,0,1)),v.push(new Ws(1,0,1,1,1)))}else if(v=o.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:y}),this._source.hasTile){let D=this._source.hasTile.bind(this._source);v=v.filter(L=>D(L))}}else v=[];if(v.length>0&&this.castsShadows&&m&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!nO(this._source.type)){let D=o.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),L=Math.min(D,this._source.maxzoom);if(y){let F=o.extendTileCover(v,L);for(let N of F)v.push(N)}else{let F=o.extendTileCover(v,L,m);for(let N of F)this._shadowCasterTiles[N.key]=!0,v.push(N)}}let S=this._updateRetainedTiles(v);if(nO(this._source.type)&&v.length!==0){let D={},L={},F=Object.keys(S);for(let H of F){let q=S[H],Q=this._tiles[H];if(!Q||Q.fadeEndTime&&Q.fadeEndTime<=Oo.now())continue;let K=this.findLoadedParent(q,Math.max(q.overscaledZ-bg.maxOverzooming,this._source.minzoom));K&&(this._addTile(K.tileID),D[K.tileID.key]=K.tileID),L[H]=q}let N=v[v.length-1].overscaledZ;for(let H in this._tiles){let q=this._tiles[H];if(S[H]||!q.hasData())continue;let Q=q.tileID;for(;Q.overscaledZ>N;){Q=Q.scaledTo(Q.overscaledZ-1);let K=this._tiles[Q.key];if(K&&K.hasData()&&L[Q.key]){S[H]=q.tileID;break}}}for(let H in D)S[H]||(this._coveredTiles[H]=!0,S[H]=D[H])}for(let D in S)this._tiles[D].clearFadeHold();let T=function(D,L){let F=[];for(let N in D)N in L||F.push(N);return F}(this._tiles,S);for(let D of T){let L=this._tiles[D];L.hasSymbolBuckets&&!L.holdingForFade()?L.setHoldDuration(this.map._fadeDuration):L.hasSymbolBuckets&&!L.symbolFadeFinished()||this._removeTile(+D)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){let l={};if(o.length===0)return l;let d={},m=o.reduce((D,L)=>Math.min(D,L.overscaledZ),1/0),y=o[0].overscaledZ,v=Math.max(y-bg.maxOverzooming,this._source.minzoom),S=Math.max(y+bg.maxUnderzooming,this._source.minzoom),T={};for(let D of o){let L=this._addTile(D);l[D.key]=D,L.hasData()||m<this._source.maxzoom&&(T[D.key]=D)}this._retainLoadedChildren(T,m,S,l);for(let D of o){let L=this._tiles[D.key];if(L.hasData())continue;if(D.canonical.z>=this._source.maxzoom){let N=D.children(this._source.maxzoom)[0],H=this.getTile(N);if(H&&H.hasData()){l[N.key]=N;continue}}else{let N=D.children(this._source.maxzoom);if(l[N[0].key]&&l[N[1].key]&&l[N[2].key]&&l[N[3].key])continue}let F=L.wasRequested();for(let N=D.overscaledZ-1;N>=v;--N){let H=D.scaledTo(N);if(d[H.key]||(d[H.key]=!0,L=this.getTile(H),!L&&F&&(L=this._addTile(H)),L&&(l[H.key]=H,F=L.wasRequested(),L.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let o in this._tiles){let l=[],d,m=this._tiles[o].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){d=this._loadedParentTiles[m.key];break}l.push(m.key);let y=m.scaledTo(m.overscaledZ-1);if(d=this._getLoadedTile(y),d)break;m=y}for(let y of l)this._loadedParentTiles[y]=d}}_addTile(o){let l=this._tiles[o.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),l;l=this._cache.getAndRemove(o),l&&(this._setTileReloadTimer(o.key,l),l.tileID=o,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,l)));let d=!!l;if(!d){let m=this.map?this.map.painter:null,y=this._source.tileSize*o.overscaleFactor();l=this._source.type==="raster-array"?new P6(o,y,this.transform.tileZoom,m,this._isRaster):new JM(o,y,this.transform.tileZoom,m,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,o.key,l.state))}return l?(l.uses++,this._tiles[o.key]=l,d||this._source.fire(new Ec("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(o,l){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);let d=l.getExpiryTimeout();d&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},d))}_removeTile(o){let l=this._tiles[o];l&&(l.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,l,d){let m=[],y=this.transform;if(!y)return m;let v=y.projection.name==="globe",S=ph(y.center.lng);for(let T in this._tiles){let D=this._tiles[T];if(d&&D.clearQueryDebugViz(),D.holdingForFade())continue;let L;if(v){let F=D.tileID.canonical;if(F.z===0){let N=[Math.abs(xr(S,...cb(F,-1))-S),Math.abs(xr(S,...cb(F,1))-S)];L=[0,2*N.indexOf(Math.min(...N))-1]}else{let N=[Math.abs(xr(S,...cb(F,-1))-S),Math.abs(xr(S,...cb(F,0))-S),Math.abs(xr(S,...cb(F,1))-S)];L=[N.indexOf(Math.min(...N))-1]}}else L=[0];for(let F of L){let N=o.containsTile(D,y,l,F);N&&m.push(N)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,l){let d=this.getRenderableIds(o,l).map(y=>this._tiles[y].tileID),m=this.transform.projection.name==="globe";for(let y of d)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=m?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return d}sortCoordinatesByDistance(o){let l=o.slice(),d=this.transform._camera.position,m=this.transform._camera.forward(),y={};for(let v of l){let S=1/(1<<v.canonical.z);y[v.key]=((v.canonical.x+.5)*S+v.wrap-d[0])*m[0]+((v.canonical.y+.5)*S-d[1])*m[1]-d[2]*m[2]}return l.sort((v,S)=>y[v.key]-y[S.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(nO(this._source.type))for(let o in this._tiles){let l=this._tiles[o];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=Oo.now())return!0}return!1}setFeatureState(o,l,d){this._state.updateState(o=o||"_geojsonTileLayer",l,d)}removeFeatureState(o,l,d){this._state.removeFeatureState(o=o||"_geojsonTileLayer",l,d)}getFeatureState(o,l){return this._state.getState(o=o||"_geojsonTileLayer",l)}setDependencies(o,l,d){let m=this._tiles[o];m&&m.setDependencies(l,d)}reloadTilesForDependencies(o,l){for(let d in this._tiles)this._tiles[d].hasDependency(o,l)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(o,l))}_preloadTiles(o,l){if(!this._sourceLoaded){let S=()=>{this._sourceLoaded&&(this._source.off("data",S),this._preloadTiles(o,l))};return void this._source.on("data",S)}let d=new Map,m=Array.isArray(o)?o:[o],y=this.map.painter.terrain,v=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(let S of m){let T=S.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let D of T)d.set(D.key,D);this.usedForTerrain&&S.updateElevation(!1)}Cm(Array.from(d.values()),(S,T)=>{let D=new JM(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,L=>{this._source.type==="raster-dem"&&D.dem&&this._backfillDEM(D),T(L,D)})},l)}}function R6(a,o){let l=Math.abs(2*a.wrap)-+(a.wrap<0),d=Math.abs(2*o.wrap)-+(o.wrap<0);return a.overscaledZ-o.overscaledZ||d-l||o.canonical.y-a.canonical.y||o.canonical.x-a.canonical.x}function nO(a){return a==="raster"||a==="image"||a==="video"||a==="custom"}function cb(a,o){let l=1<<a.z;return[a.x/l+o,(a.x+1)/l+o]}bg.maxOverzooming=10,bg.maxUnderzooming=3;let O6=()=>rO||(rO={layout:DV||(DV=new Dn({"line-cap":new Mi(mt.layout_line["line-cap"]),"line-join":new Mi(mt.layout_line["line-join"]),"line-miter-limit":new Ht(mt.layout_line["line-miter-limit"]),"line-round-limit":new Ht(mt.layout_line["line-round-limit"]),"line-sort-key":new Mi(mt.layout_line["line-sort-key"]),"line-z-offset":new Mi(mt.layout_line["line-z-offset"]),visibility:new Ht(mt.layout_line.visibility)})),paint:IV||(IV=new Dn({"line-opacity":new Mi(mt.paint_line["line-opacity"]),"line-color":new Mi(mt.paint_line["line-color"]),"line-translate":new Ht(mt.paint_line["line-translate"]),"line-translate-anchor":new Ht(mt.paint_line["line-translate-anchor"]),"line-width":new Mi(mt.paint_line["line-width"]),"line-gap-width":new Mi(mt.paint_line["line-gap-width"]),"line-offset":new Mi(mt.paint_line["line-offset"]),"line-blur":new Mi(mt.paint_line["line-blur"]),"line-dasharray":new Mi(mt.paint_line["line-dasharray"]),"line-pattern":new Mi(mt.paint_line["line-pattern"]),"line-gradient":new ta(mt.paint_line["line-gradient"]),"line-trim-offset":new Ht(mt.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ht(mt.paint_line["line-trim-fade-range"]),"line-trim-color":new Ht(mt.paint_line["line-trim-color"]),"line-emissive-strength":new Ht(mt.paint_line["line-emissive-strength"]),"line-border-width":new Mi(mt.paint_line["line-border-width"]),"line-border-color":new Mi(mt.paint_line["line-border-color"]),"line-occlusion-opacity":new Ht(mt.paint_line["line-occlusion-opacity"])}))},rO);class Coe extends Mi{possiblyEvaluate(o,l){return l=new er(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,transition:l.transition}),super.possiblyEvaluate(o,l)}evaluate(o,l,d,m){return l=Io({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(o,l,d,m)}}let ub,L6,z6,sO;function F6(a,o){return o>0?o+2*a:a}class k6{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Qa,this.defaultValue=o}evaluate(o){if(o.formattedSection){let l=this.defaultValue.property.overrides;if(l&&l.hasOverride(o.formattedSection))return l.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}tt(k6,"FormatSectionOverride",{omit:["defaultValue"]});let oO=()=>sO||(sO={layout:L6||(L6=new Dn({"symbol-placement":new Ht(mt.layout_symbol["symbol-placement"]),"symbol-spacing":new Ht(mt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ht(mt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mi(mt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ht(mt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ht(mt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Ht(mt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ht(mt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ht(mt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ht(mt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mi(mt.layout_symbol["icon-size"]),"icon-text-fit":new Mi(mt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Mi(mt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mi(mt.layout_symbol["icon-image"]),"icon-rotate":new Mi(mt.layout_symbol["icon-rotate"]),"icon-padding":new Ht(mt.layout_symbol["icon-padding"]),"icon-keep-upright":new Ht(mt.layout_symbol["icon-keep-upright"]),"icon-offset":new Mi(mt.layout_symbol["icon-offset"]),"icon-anchor":new Mi(mt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ht(mt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ht(mt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ht(mt.layout_symbol["text-rotation-alignment"]),"text-field":new Mi(mt.layout_symbol["text-field"]),"text-font":new Mi(mt.layout_symbol["text-font"]),"text-size":new Mi(mt.layout_symbol["text-size"]),"text-max-width":new Mi(mt.layout_symbol["text-max-width"]),"text-line-height":new Mi(mt.layout_symbol["text-line-height"]),"text-letter-spacing":new Mi(mt.layout_symbol["text-letter-spacing"]),"text-justify":new Mi(mt.layout_symbol["text-justify"]),"text-radial-offset":new Mi(mt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ht(mt.layout_symbol["text-variable-anchor"]),"text-anchor":new Mi(mt.layout_symbol["text-anchor"]),"text-max-angle":new Ht(mt.layout_symbol["text-max-angle"]),"text-writing-mode":new Ht(mt.layout_symbol["text-writing-mode"]),"text-rotate":new Mi(mt.layout_symbol["text-rotate"]),"text-padding":new Ht(mt.layout_symbol["text-padding"]),"text-keep-upright":new Ht(mt.layout_symbol["text-keep-upright"]),"text-transform":new Mi(mt.layout_symbol["text-transform"]),"text-offset":new Mi(mt.layout_symbol["text-offset"]),"text-allow-overlap":new Ht(mt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ht(mt.layout_symbol["text-ignore-placement"]),"text-optional":new Ht(mt.layout_symbol["text-optional"]),visibility:new Ht(mt.layout_symbol.visibility)})),paint:z6||(z6=new Dn({"icon-opacity":new Mi(mt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Mi(mt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Mi(mt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Mi(mt.paint_symbol["text-emissive-strength"]),"icon-color":new Mi(mt.paint_symbol["icon-color"]),"icon-halo-color":new Mi(mt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mi(mt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mi(mt.paint_symbol["icon-halo-blur"]),"icon-translate":new Ht(mt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ht(mt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Mi(mt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Mi(mt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Mi(mt.paint_symbol["text-occlusion-opacity"]),"text-color":new Mi(mt.paint_symbol["text-color"],{runtimeType:Ml,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Mi(mt.paint_symbol["text-halo-color"]),"text-halo-width":new Mi(mt.paint_symbol["text-halo-width"]),"text-halo-blur":new Mi(mt.paint_symbol["text-halo-blur"]),"text-translate":new Ht(mt.paint_symbol["text-translate"]),"text-translate-anchor":new Ht(mt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ht(mt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ht(mt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ht(mt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ht(mt.paint_symbol["icon-color-brightness-max"])}))},sO);class eT extends sl{constructor(o,l,d,m){super(o,oO(),l,d,m),this._colorAdjustmentMatrix=n.ae.identity([]),this.hasInitialOcclusionOpacityProperties=o.paint!==void 0&&("icon-occlusion-opacity"in o.paint||"text-occlusion-opacity"in o.paint)}recalculate(o,l){super.recalculate(o,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let d=this.layout.get("text-writing-mode");if(d){let m=[];for(let y of d)m.indexOf(y)<0&&m.push(y);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(o,l,d,m){return this._saturation===o&&this._contrast===l&&this._brightnessMin===d&&this._brightnessMax===m||(this._colorAdjustmentMatrix=function(y,v,S,T){y=vE(y),v=yE(v);let D=n.ae.create(),L=y/3,F=1-2*L,N=[F,L,L,0,L,F,L,0,L,L,F,0,0,0,0,1],H=.5-.5*v,q=T-S;return n.ae.multiply(D,[q,0,0,0,0,q,0,0,0,0,q,0,S,S,S,1],[v,0,0,0,0,v,0,0,0,0,v,0,H,H,H,1]),n.ae.multiply(D,D,N),D}(o,l,d,m),this._saturation=o,this._contrast=l,this._brightnessMin=d,this._brightnessMax=m),this._colorAdjustmentMatrix}getValueAndResolveTokens(o,l,d,m){let y=this.layout.get(o).evaluate(l,{},d,m),v=this._unevaluatedLayout._values[o];return v.isDataDriven()||Te(v.value)||!y?y:function(S,T){return T.replace(/{([^{}]+)}/g,(D,L)=>L in S?String(S[L]):"")}(l.properties,y)}createBucket(o){return new o0(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let o of oO().paint.overridableProperties){if(!eT.hasPaintOverride(this.layout,o))continue;let l=this.paint.get(o),d=new k6(l),m=new Me(d,l.property.specification,this.scope,this.options),y=null;y=l.value.kind==="constant"||l.value.kind==="source"?new Be("source",m):new Oe("composite",m,l.value.zoomStops,l.value._interpolationType),this.paint._values[o]=new no(l.property,y,l.parameters)}}_handleOverridablePaintPropertyUpdate(o,l,d){return!(!this.layout||l.isDataDriven()||d.isDataDriven())&&eT.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,l){let d=o.get("text-field"),m=oO().paint.properties[l],y=!1,v=S=>{for(let T of S)if(m.overrides&&m.overrides.hasOverride(T))return void(y=!0)};if(d.value.kind==="constant"&&d.value.value instanceof ea)v(d.value.value.sections);else if(d.value.kind==="source"){let S=D=>{y||(D instanceof Xl&&Vs(D.value)===qp?v(D.value.sections):D instanceof _d?v(D.sections):D.eachChild(S))},T=d.value;T._styleExpression&&S(T._styleExpression.expression)}return y}getProgramIds(){let o=this.paint.get("icon-opacity").constantOr(1)!==0,l=this.paint.get("text-opacity").constantOr(1)!==0,d=[];return o&&d.push("symbolIcon"),l&&d.push("symbolSDF"),d}getDefaultProgramParams(o,l,d){return{config:new fg(this,{zoom:l,lut:d}),overrideFog:!1}}}let N6,B6,U6,j6;function tT(a,o,l,d,m,y,v,S){let T=[a,o,1,l,d,1,m,y,1],D=[v,S,1],L=n.bE.adjoint([],T),[F,N,H]=n.$.transformMat3(D,D,L);return n.bE.multiply(T,T,[F,0,0,0,N,0,0,0,H])}function V6(a,o,l,d,m,y,v,S){let T=function(D,L,F,N,H,q,Q,K){let ae=tT(0,0,1,0,1,1,0,1),_e=tT(D,L,F,N,H,q,Q,K),ge=n.bE.adjoint([],ae);return n.bE.multiply(_e,_e,ge)}(a,o,l,d,m,y,v,S);return[T[2]/T[8]/ti,T[5]/T[8]/ti]}function iT(a){return[a[0],Math.min(Math.max(a[1],-Rs),Rs)]}class G6 extends yd{constructor(o,l,d,m){super(),this.id=o,this.dispatcher=d,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(m),this.options=l,this._dirty=!1}load(o,l){if(this._loaded=l||!1,this.fire(new Ec("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return o&&(this.coordinates=o),this._loaded=!0,void this._finishLoading();this._imageRequest=Um(this.map._requestManager.transformRequest(this.url,Nm.Image),(d,m)=>{this._imageRequest=null,this._loaded=!0,d?this.fire(new Hm(d)):m&&(this.image=m instanceof HTMLImageElement?Oo.getImageData(m):m,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return o.url?(this._imageRequest&&o.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}setTexture(o){if(!(o.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new ZM(this.map.painter.context,o.handle),this.width=o.dimensions[0],this.height=o.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ec("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(o){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof ZM||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(o){if(this.coordinates=o,this._boundsArray=void 0,this._unsupportedCoords=!1,!o.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let l=o[0][1],d=o[0][1];for(let y of o)y[1]>d&&(d=y[1]),y[1]<l&&(l=y[1]);let m=(d+l)/2;if(m>Rs?this.onNorthPole=!0:m<-Rs&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let y=o.map(ia.fromLngLat);this.tileID=function(v){let S=1/0,T=1/0,D=-1/0,L=-1/0;for(let Q of v)S=Math.min(S,Q.x),T=Math.min(T,Q.y),D=Math.max(D,Q.x),L=Math.max(L,Q.y);let F=Math.max(D-S,L-T),N=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),H=Math.pow(2,N),q=Math.floor((S+D)/2*H);return q>1&&(q-=1),new gg(N,q,Math.floor((T+L)/2*H))}(y),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ec("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(o){for(let K in this.tiles){let ae=this.tiles[K];ae.state!=="loaded"&&(ae.state="loaded",ae.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let l=xg(new gg(0,0,0),this.map.transform.projection),d=[l.projection.project(this.coordinates[0][0],this.coordinates[0][1]),l.projection.project(this.coordinates[1][0],this.coordinates[1][1]),l.projection.project(this.coordinates[2][0],this.coordinates[2][1]),l.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(K){let ae=K[1].x-K[0].x,_e=K[1].y-K[0].y,ge=K[2].x-K[1].x,be=K[2].y-K[1].y,ze=K[3].x-K[2].x,ke=K[3].y-K[2].y,je=K[0].x-K[3].x,it=K[0].y-K[3].y,ut=ae*be-ge*_e,vt=ge*ke-ze*be,dt=ze*it-je*ke,At=je*_e-ae*it;return ut>0&&vt>0&&dt>0&&At>0||ut<0&&vt<0&&dt<0&&At<0}(d))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let m=xg(this.tileID,this.map.transform.projection),[y,v,S,T]=this.coordinates.map(K=>{let ae=m.projection.project(K[0],K[1]);return f6(m,ae)._round()});this.perspectiveTransform=V6(y.x,y.y,v.x,v.y,S.x,S.y,T.x,T.y);let D=this._boundsArray=new Md;D.emplaceBack(y.x,y.y,0,0),D.emplaceBack(v.x,v.y,ti,0),D.emplaceBack(T.x,T.y,0,ti),D.emplaceBack(S.x,S.y,ti,ti),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=o.createVertexBuffer(D,KM.members),this.boundsSegments=ss.simpleSegment(0,0,4,2);let L=[],F=function(K){return[iT(K[0]),iT(K[1]),iT(K[2]),iT(K[3])]}(this.coordinates),[N,H,q,Q]=function(K){let ae=K[0][0],_e=ae,ge=K[0][1],be=ge;for(let ze=1;ze<K.length;ze++)K[ze][0]<ae?ae=K[ze][0]:K[ze][0]>_e&&(_e=K[ze][0]),K[ze][1]<ge?ge=K[ze][1]:K[ze][1]>be&&(be=K[ze][1]);return[ae,ge,_e-ae,be-ge]}(F);{let K=new Md,[ae,_e,ge,be]=function(Tt){let Ot=Tt[0].x,Kt=Ot,Dt=Tt[0].y,ri=Dt;for(let Xt=1;Xt<Tt.length;Xt++)Tt[Xt].x<Ot?Ot=Tt[Xt].x:Tt[Xt].x>Kt&&(Kt=Tt[Xt].x),Tt[Xt].y<Dt?Dt=Tt[Xt].y:Tt[Xt].y>ri&&(ri=Tt[Xt].y);return[Ot,Dt,Kt-Ot,ri-Dt]}(d),ze=Tt=>[(Tt.x-ae)/ge,(Tt.y-_e)/be],[ke,je,it,ut]=d.map(ze),vt=function(Tt,Ot,Kt,Dt,ri,Xt,Vt,zi){let Ri=tT(0,0,1,0,1,1,0,1),gi=tT(Tt,Ot,Kt,Dt,ri,Xt,Vt,zi),ii=n.bE.adjoint([],gi);return n.bE.multiply(Ri,Ri,ii)}(ke[0],ke[1],je[0],je[1],it[0],it[1],ut[0],ut[1]);this.elevatedGlobePerspectiveTransform=V6(ke[0],ke[1],je[0],je[1],it[0],it[1],ut[0],ut[1]);let dt=(Tt,Ot)=>{L.push(Tt.lng);let Kt=Math.round((Tt.lng-N)/q*ti),Dt=Math.round((Tt.lat-H)/Q*ti),ri=ze(Ot),Xt=n.$.transformMat3([],[ri[0],ri[1],1],vt),Vt=Math.round(Xt[0]/Xt[2]*ti),zi=Math.round(Xt[1]/Xt[2]*ti);K.emplaceBack(Kt,Dt,Vt,zi)},At=d[3].x-d[0].x,jt=d[3].y-d[0].y,Ct=d[2].x-d[1].x,qt=d[2].y-d[1].y;for(let Tt=0;Tt<65;Tt++){let Ot=Tt/64,Kt=[d[0].x+Ot*At,d[0].y+Ot*jt],Dt=[d[1].x+Ot*Ct,d[1].y+Ot*qt],ri=Dt[0]-Kt[0],Xt=Dt[1]-Kt[1];for(let Vt=0;Vt<65;Vt++){let zi=Vt/64,Ri={x:Kt[0]+ri*zi,y:Kt[1]+Xt*zi,z:0};dt(l.projection.unproject(Ri.x,Ri.y),Ri)}}this.elevatedGlobeVertexBuffer=o.createVertexBuffer(K,KM.members)}{this.maxLongitudeTriangleSize=0;let K=[],ae=new so,_e=(ge,be,ze)=>{ae.emplaceBack(ge,be,ze);let ke=L[ge],je=L[be],it=L[ze],ut=Math.min(Math.min(ke,je),it),vt=Math.max(Math.max(ke,je),it)-ut;vt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=vt),K.push(ut+vt/2)};for(let ge=0;ge<64;ge++)for(let be=0;be<64;be++){let ze=65*ge+be,ke=ze+1,je=ze+65,it=je+1;_e(ze,je,ke),_e(ke,je,it)}[K,ae]=function(ge,be){let ze=Array.from({length:ge.length},(it,ut)=>ut);ze.sort((it,ut)=>ge[it]-ge[ut]);let ke=[],je=new so;for(let it=0;it<ze.length;it++){let ut=ze[it];ke.push(ge[ut]);let vt=3*ut,dt=vt+1;je.emplaceBack(be.uint16[vt],be.uint16[dt],be.uint16[dt+1])}return[ke,je]}(K,ae),this.elevatedGlobeTrianglesCenterLongitudes=K,this.elevatedGlobeIndexBuffer=o.createIndexBuffer(ae)}this.elevatedGlobeSegments=ss.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,q/ti,0,Q/ti,0,0,H,N,0])}prepare(){let o=Object.keys(this.tiles).length!==0;if(this.tileID&&!o)return;let l=this.map.painter.context,d=l.gl;!this._dirty||this.texture instanceof ZM||(this.texture?this.texture.update(this.image):(this.texture=new Dc(l,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),o&&this._prepareData(l)}loadTile(o,l){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},l(null)):(o.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(o){let l=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!l)return null;let d=this.elevatedGlobeTrianglesCenterLongitudes,m=(y=o+180)+360*Math.round((d[0]-y)/360);var y;let v=new ss,S=(F,N)=>{v.segments.push({vertexOffset:0,primitiveOffset:F,vertexLength:l.segments[0].vertexLength,primitiveLength:N,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(d[0]-m)<=T){let F=cv(d,0,d.length,m+T);return F===d.length||S(F,lv(d,F+1,d.length,m+360-T)-F),v}m<d[0]&&(m+=360);let D=lv(d,0,d.length,m-T);if(D===d.length)return S(0,d.length),v;S(0,D-0);let L=cv(d,D+1,d.length,m+T);return L!==d.length&&S(L,d.length-L),v}}let Doe=(Math.pow(256,2)-1)/16907520;class H6 extends sl{constructor(o,l,d,m){super(o,{layout:U6||(U6=new Dn({visibility:new Ht(mt.layout_raster.visibility)})),paint:j6||(j6=new Dn({"raster-opacity":new Ht(mt.paint_raster["raster-opacity"]),"raster-color":new ta(mt.paint_raster["raster-color"]),"raster-color-mix":new Ht(mt.paint_raster["raster-color-mix"]),"raster-color-range":new Ht(mt.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ht(mt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ht(mt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ht(mt.paint_raster["raster-brightness-max"]),"raster-saturation":new Ht(mt.paint_raster["raster-saturation"]),"raster-contrast":new Ht(mt.paint_raster["raster-contrast"]),"raster-resampling":new Ht(mt.paint_raster["raster-resampling"]),"raster-fade-duration":new Ht(mt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ht(mt.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ht(mt.paint_raster["raster-array-band"]),"raster-elevation":new Ht(mt.paint_raster["raster-elevation"])}))},l,d,m),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(o){return!(o&&o._source instanceof G6&&(o._source.onNorthPole||o._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(o){o!=="raster-color"&&o!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(o){if(!this.hasColorMap()||!this._curRampRange)return;let l=this._transitionablePaint._values["raster-color"].value.expression,[d,m]=o||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(d)&&isNaN(m)||d===this._curRampRange[0]&&m===this._curRampRange[1]||(this.colorRamp=U1({expression:l,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:d,end:m}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[d,m])}}let W6,q6,Y6,X6,$6;class Z6 extends sl{constructor(o,l,d,m){super(o,{layout:W6||(W6=new Dn({visibility:new Ht(mt["layout_raster-particle"].visibility)})),paint:q6||(q6=new Dn({"raster-particle-array-band":new Ht(mt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ht(mt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ta(mt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ht(mt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ht(mt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ht(mt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ht(mt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Ht(mt["paint_raster-particle"]["raster-particle-elevation"])}))},l,d,m),this._updateColorRamp(),this.lastInvalidatedAt=Oo.now()}onRemove(o){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(o){return!1}_handleSpecialPaintPropertyUpdate(o){o!=="raster-particle-color"&&o!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),o==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let o=this._transitionablePaint._values["raster-particle-color"].value.expression,l=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=U1({expression:o,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:l}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Oo.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Ioe extends sl{constructor(o,l){super(o,{},l,null),this.implementation=o,o.slot&&(this.slot=o.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(o){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}function aO(a,o,l){let d=[0,0,1],m=n.aw.identity([]);return n.aw.rotateY(m,m,l?-Rr(a)+Math.PI:Rr(a)),n.aw.rotateX(m,m,-Rr(o)),n.$.transformQuat(d,d,m),n.$.normalize(d,d)}function Q6(a,o){let l=rT(a.projection,a.zoom,a.width,a.height),d=function(y,v,S,T,D){let L=new Kr(S.lng-180*vf,S.lat),F=new Kr(S.lng+180*vf,S.lat),N=y.project(L.lng,L.lat),H=y.project(F.lng,F.lat),q=-Math.atan2(H.y-N.y,H.x-N.x),Q=ia.fromLngLat(S);Q.y=xr(Q.y,-1+vf,1-vf);let K=Q.toLngLat(),ae=y.project(K.lng,K.lat),_e=ia.fromLngLat(K);_e.x+=vf;let ge=_e.toLngLat(),be=y.project(ge.lng,ge.lat),ze=eG(be.x-ae.x,be.y-ae.y,q),ke=ia.fromLngLat(K);ke.y+=vf;let je=ke.toLngLat(),it=y.project(je.lng,je.lat),ut=eG(it.x-ae.x,it.y-ae.y,q),vt=Math.abs(ze.x)/Math.abs(ut.y),dt=n.ae.identity([]);n.ae.rotateZ(dt,dt,-q*(1-(D?0:T)));let At=n.ae.identity([]);return n.ae.scale(At,At,[1,1-(1-vt)*T,1]),At[4]=-ut.x/ut.y*T,n.ae.rotateZ(At,At,q),n.ae.multiply(At,dt,At),At}(a.projection,0,a.center,l,o),m=K6(a);return n.ae.scale(d,d,[m,m,1]),d}function K6(a){let o=a.projection,l=rT(a.projection,a.zoom,a.width,a.height),d=J6(o,a.center),m=J6(o,Kr.convert(o.center));return Math.pow(2,d*l+(1-l)*m)}function rT(a,o,l,d,m=1/0){let y=a.range;if(!y)return 0;let v=Math.min(m,Math.max(l,d)),S=Math.log(v/1024)/Math.LN2;return Hx(y[0]+S,y[1]+S,o)}let vf=1/4e4;function J6(a,o){let l=xr(o.lat,-Rs,Rs),d=new Kr(o.lng-180*vf,l),m=new Kr(o.lng+180*vf,l),y=a.project(d.lng,l),v=a.project(m.lng,l),S=ia.fromLngLat(d),T=ia.fromLngLat(m),D=v.x-y.x,L=v.y-y.y,F=T.x-S.x,N=T.y-S.y,H=Math.sqrt((F*F+N*N)/(D*D+L*L));return Math.log(H)/Math.LN2}function eG(a,o,l){let d=Math.cos(l),m=Math.sin(l);return{x:a*d-o*m,y:a*m+o*d}}function tG(a,o,l){n.ae.identity(a),n.ae.rotateZ(a,a,Rr(o[2])),n.ae.rotateX(a,a,Rr(o[0])),n.ae.rotateY(a,a,Rr(o[1])),n.ae.scale(a,a,l),n.ae.multiply(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function nT(a,o,l,d,m,y,v,S){let T=[l[0]-o[0],l[1]-o[1],0],D=[d[0]-o[0],d[1]-o[1],0];if(n.$.length(T)<1e-12||n.$.length(D)<1e-12)return n.aw.identity(a);let L=n.$.cross([],T,D);n.$.normalize(L,L),n.$.subtract(D,d,o),T[2]=(y-m)*S,D[2]=(v-m)*S;let F=T;return n.$.cross(F,T,D),n.$.normalize(F,F),n.aw.rotationTo(a,L,F)}function lO(a,o,l=!1){let d=Pd(o.zoom),m=function(y,v,S){let T=v.worldSize,D=[y[12],y[13],y[14]],L=_o(D[1]/T),F=ol(D[0]/T),N=n.ae.identity([]),H=Ba(1,L)*T,q=Ba(1,0)*T*yg(L,v.zoom),Q=1/TR(T),K=q*Q;if(S){let be=rT(v.projection,v.zoom,v.width,v.height,1024);K=Q*v.projection.pixelSpaceConversion(v.center.lat,T,be)}let ae=mg(L,F);n.$.add(ae,ae,n.$.scale([],n.$.normalize([],ae),H*K*D[2]));let _e=function(be){let ze=[be[0],be[1],be[2]],ke=[0,1,0],je=n.$.cross([],ke,ze);return n.$.cross(ke,ze,je),n.$.squaredLength(ke)===0&&(ke=[0,1,0],n.$.cross(je,ze,ke)),n.$.normalize(je,je),n.$.normalize(ke,ke),n.$.normalize(ze,ze),[je[0],je[1],je[2],0,ke[0],ke[1],ke[2],0,ze[0],ze[1],ze[2],0,be[0],be[1],be[2],1]}(ae);n.ae.scale(N,N,[K,K,K*H]),n.ae.translate(N,N,[-D[0],-D[1],-D[2]]);let ge=n.ae.multiply([],v.globeMatrix,_e);return n.ae.multiply(ge,ge,N),n.ae.multiply(ge,ge,y),ge}(a,o,l);if(d>0){let y=function(v,S){let T=S.worldSize,D=Ba(1,0)*T*yg(S.center.lat,S.zoom)/TR(T),L=Ba(1,S.center.lat)*T,F=n.ae.identity([]);return n.ae.rotateY(F,F,Rr(S.center.lng)),n.ae.rotateX(F,F,Rr(S.center.lat)),n.ae.translate(F,F,[0,0,Na]),n.ae.scale(F,F,[D,D,D*L]),n.ae.translate(F,F,[S.point.x-.5*T,S.point.y-.5*T,0]),n.ae.multiply(F,F,v),n.ae.multiply(F,S.globeMatrix,F)}(a,o);return function(v,S,T){let D=(q,Q,K)=>{let ae=n.$.length(q),_e=n.$.length(Q),ge=Id(q,Q,K);return n.$.scale(ge,ge,1/n.$.length(ge)*Gi(ae,_e,K))},L=D([v[0],v[1],v[2]],[S[0],S[1],S[2]],T),F=D([v[4],v[5],v[6]],[S[4],S[5],S[6]],T),N=D([v[8],v[9],v[10]],[S[8],S[9],S[10]],T),H=Id([v[12],v[13],v[14]],[S[12],S[13],S[14]],T);return[L[0],L[1],L[2],0,F[0],F[1],F[2],0,N[0],N[1],N[2],0,H[0],H[1],H[2],1]}(m,y,d)}return m}function iG(a,o,l,d){let m=Jn.projectAabbCorners(d,l),y=Number.MAX_VALUE,v=-1;for(let D=0;D<m.length;++D){let L=m[D];L[0]=(.5*L[0]+.5)*o.width,L[1]=(.5-.5*L[1])*o.height,L[2]<y&&(v=D,y=L[2])}let S=D=>new ai(m[D][0],m[D][1]),T;switch(v){case 0:case 6:T=[S(1),S(5),S(4),S(7),S(3),S(2),S(1)];break;case 1:case 7:T=[S(0),S(4),S(5),S(6),S(2),S(3),S(0)];break;case 3:case 5:T=[S(1),S(0),S(4),S(7),S(6),S(2),S(1)];break;default:T=[S(1),S(5),S(6),S(7),S(3),S(0),S(1)]}if(gR(a,T))return y}let Poe=hn([{name:"a_pos_3f",components:3,type:"Float32"}]),Roe=hn([{name:"a_color_3f",components:3,type:"Float32"}]),Ooe=hn([{name:"a_color_4f",components:4,type:"Float32"}]),Loe=hn([{name:"a_uv_2f",components:2,type:"Float32"}]),zoe=hn([{name:"a_normal_3f",components:3,type:"Float32"}]),Foe=hn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),koe=hn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class sT{constructor(o,l,d,m){this.message=(o?`${o}: `:"")+d,m&&(this.identifier=m),l!=null&&l.__line__&&(this.line=l.__line__)}}function rG(a,o){let l=a.indexOf("://")===-1;try{return new URL(a,l&&o?"http://example.com":void 0),!0}catch{return!1}}class nG{constructor(o,l){this.feature=o,this.instancedDataOffset=l,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class sG{constructor(){this.instancedDataArray=new JP,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class cO{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.projection=o.projection,this.index=o.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(o,l){}populate(o,l,d,m){this.tileToMeter=fM(d);let y=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:v,id:S,index:T,sourceLayerIndex:D}of o){let L=S??(v.properties&&v.properties.hasOwnProperty("id")?v.properties.id:void 0),F=Dd(v,y);if(!this.layers[0]._featureFilter.filter(new er(this.zoom),F,d))continue;let N={id:L,sourceLayerIndex:D,index:T,geometry:y?F.geometry:du(v,d,m),properties:v.properties,type:v.type,patterns:{}},H=this.addFeature(N,N.geometry,F);H&&l.featureIndex.insert(v,N.geometry,T,D,this.index,this.instancesPerModel[H].instancedDataArray.length,ti/32)}this.lookup=null}update(o,l,d,m){for(let y in this.instancesPerModel){let v=this.instancesPerModel[y];for(let S in o)v.idToFeaturesIndex.hasOwnProperty(S)&&(this.evaluate(v.features[v.idToFeaturesIndex[S]],o[S],v,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let o=!1;for(let l in this.instancesPerModel){let d=this.instancesPerModel[l];for(let m of d.features){let y=this.layers[0],v=m.feature,S=this.canonical,T=y.paint.get("model-rotation").evaluate(v,{},S),D=y.paint.get("model-scale").evaluate(v,{},S),L=y.paint.get("model-translation").evaluate(v,{},S);n.$.exactEquals(m.rotation,T)&&n.$.exactEquals(m.scale,D)&&n.$.exactEquals(m.translation,L)||(this.evaluate(m,m.featureStates,d,!0),o=!0)}}return o}updateReplacement(o,l,d,m){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;let y=l.getReplacementRegionsForTile(o.toUnwrapped(),!0);if(FR(this.activeReplacements,y))return!1;this.activeReplacements=y;let v=!1;for(let S in this.instancesPerModel){let T=this.instancesPerModel[S],D=T.instancedDataArray;for(let L of T.features){let F=L.instancedDataOffset,N=L.instancedDataCount;for(let H=0;H<N;H++){let q=16*(H+F),Q=D.float32[q+0];Q=Q>ti?Q-ti:Q;let K=Math.floor(Q),ae=D.float32[q+1],_e=!1;for(let ge of this.activeReplacements)if(!Yj(ge,d,aV.Model,m)&&!(ge.min.x>K||K>ge.max.x||ge.min.y>ae||ae>ge.max.y)&&(_e=Jj(Kj(K,ae,o.canonical,ge.footprintTileId.canonical),ge),_e))break;D.float32[q]=_e?Q+ti:Q,v=v||_e}}}return v}isEmpty(){for(let o in this.instancesPerModel)if(this.instancesPerModel[o].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(o){if(!this.uploaded)for(let l in this.instancesPerModel){let d=this.instancesPerModel[l];d.instancedDataArray.length<0||d.instancedDataArray.length===0||(d.instancedDataBuffer?d.instancedDataBuffer.updateData(d.instancedDataArray):d.instancedDataBuffer=o.createVertexBuffer(d.instancedDataArray,Foe.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let l in this.instancesPerModel){let d=this.instancesPerModel[l];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}let o=this.layers[0].modelManager;if(o&&this.modelUris)for(let l of this.modelUris)o.removeModel(l,"")}addFeature(o,l,d){let m=this.layers[0],y=m.layout.get("model-id").evaluate(d,{},this.canonical);if(!y)return Ds(`modelId is not evaluated for layer ${m.id} and it is not going to get rendered.`),y;rG(y,!1)&&(this.modelUris.includes(y)||this.modelUris.push(y)),this.instancesPerModel[y]||(this.instancesPerModel[y]=new sG);let v=this.instancesPerModel[y],S=v.instancedDataArray,T=new nG(d,S.length);for(let D of l)for(let L of D){if(L.x<0||L.x>=ti||L.y<0||L.y>=ti)continue;let F=(this.lookupDim-1)/ti,N=this.lookupDim*(L.y*F|0)+L.x*F|0;if(this.lookup){if(this.lookup[N]!==0)continue;this.lookup[N]=1}this.instanceCount++;let H=S.length;S.resize(H+1),v.instancesEvaluatedElevation.push(0),S.float32[16*H]=L.x,S.float32[16*H+1]=L.y}return T.instancedDataCount=v.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(o.id&&(v.idToFeaturesIndex[o.id]=v.features.length),v.features.push(T),this.evaluate(T,{},v,!1)),y}getModelUris(){return this.modelUris}evaluate(o,l,d,m){let y=this.layers[0],v=o.feature,S=this.canonical,T=o.rotation=y.paint.get("model-rotation").evaluate(v,l,S),D=o.scale=y.paint.get("model-scale").evaluate(v,l,S),L=o.translation=y.paint.get("model-translation").evaluate(v,l,S),F=y.paint.get("model-color").evaluate(v,l,S);F.a=y.paint.get("model-color-mix-intensity").evaluate(v,l,S);let N=[];this.maxVerticalOffset<L[2]&&(this.maxVerticalOffset=L[2]),this.maxScale=Math.max(Math.max(this.maxScale,D[0]),Math.max(D[1],D[2])),tG(N,T,D);let H=Math.round(100*F.a)+F.b/1.05;for(let q=0;q<o.instancedDataCount;++q){let Q=o.instancedDataOffset+q,K=16*Q,ae=d.instancedDataArray.float32,_e=0;m&&(_e=ae[K+6]-d.instancesEvaluatedElevation[Q]);let ge=0|ae[K+1];ae[K]=(0|ae[K])+F.r/1.05,ae[K+1]=ge+F.g/1.05,ae[K+2]=H,ae[K+3]=1/(S.z>10?this.tileToMeter:fM(S,ge)),ae[K+4]=L[0],ae[K+5]=L[1],ae[K+6]=L[2]+_e,ae[K+7]=N[0],ae[K+8]=N[1],ae[K+9]=N[2],ae[K+10]=N[4],ae[K+11]=N[5],ae[K+12]=N[6],ae[K+13]=N[8],ae[K+14]=N[9],ae[K+15]=N[10],d.instancesEvaluatedElevation[Q]=L[2]}}}let oG,aG;tt(cO,"ModelBucket",{omit:["layers"]}),tt(sG,"PerModelAttributes"),tt(nG,"ModelFeature");let wg=64,c0={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function lG(a,o,l,d,m,y,v,S,T,D=!1){let L=l.zoom,F=l.project(d),N=yg(d.lat,L),H=1/N;n.ae.identity(a),n.ae.translate(a,a,[F.x+v[0]*H,F.y+v[1]*H,v[2]]);let q=1,Q=1,K=l.worldSize;if(D){if(l.projection.name==="mercator"){let be=0;l.elevation&&(be=l.elevation.getAtPointOrZero(new ia(F.x/K,F.y/K),0));let ze=n.aB.transformMat4([],[F.x,F.y,be,1],l.projMatrix)[3]/l.cameraToCenterDistance;q=ze,Q=ze*yg(l.center.lat,L)}else if(l.projection.name==="globe"){let be=lO(a,l),ze=n.ae.multiply([],l.projMatrix,be),ke=[0,0,0,1];n.aB.transformMat4(ke,ke,ze);let je=ke[3]/l.cameraToCenterDistance,it=Pd(L),ut=l.projection.pixelsPerMeter(d.lat,K)*yg(d.lat,L),vt=l.projection.pixelsPerMeter(l.center.lat,K)*yg(l.center.lat,L);q=je/Gi(ut,Z5(l.center.lat),it),Q=je*N/ut,q*=vt,Q*=vt}}else q=H;n.ae.scale(a,a,[q,q,Q]);let ae=[...a],_e=o.orientation,ge=[];if(tG(ge,[_e[0]+m[0],_e[1]+m[1],_e[2]+m[2]],y),n.ae.multiply(a,ae,ge),S&&l.elevation){let be=0,ze=[];if(T&&l.elevation){be=function(it,ut,vt,dt,At){let jt=ut.elevation;if(!jt)return 0;let Ct=Jn.projectAabbCorners(vt,dt),qt=Ba(1,At.lat)*ut.worldSize,Tt=function(Ki,Oi){let Ei=[0,0,1],nr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let or of nr){let sr=Ki[or.corners[0]],yr=Ki[or.corners[1]],jr=Ki[or.corners[2]],Ir=[yr[0]-sr[0],yr[1]-sr[1],Oi*(yr[2]-sr[2])],En=n.$.cross(Ir,Ir,[jr[0]-sr[0],jr[1]-sr[1],Oi*(jr[2]-sr[2])]);n.$.normalize(En,En),or.dotProductWithUp=n.$.dot(En,Ei)}return nr.sort((or,sr)=>or.dotProductWithUp-sr.dotProductWithUp),nr[0].corners}(Ct,qt),Ot=Ct[Tt[0]],Kt=Ct[Tt[1]],Dt=Ct[Tt[2]],ri=Ct[Tt[3]],Xt=jt.getAtPointOrZero(new ia(Ot[0]/ut.worldSize,Ot[1]/ut.worldSize),0),Vt=jt.getAtPointOrZero(new ia(Kt[0]/ut.worldSize,Kt[1]/ut.worldSize),0),zi=jt.getAtPointOrZero(new ia(Dt[0]/ut.worldSize,Dt[1]/ut.worldSize),0),Ri=jt.getAtPointOrZero(new ia(ri[0]/ut.worldSize,ri[1]/ut.worldSize),0),gi=(Xt+Ri)/2,ii=(Vt+zi)/2;return gi>ii?Vt<zi?nT(it,Kt,ri,Ot,Vt,Ri,Xt,qt):nT(it,Dt,Ot,ri,zi,Xt,Ri,qt):Xt<Ri?nT(it,Ot,Kt,Dt,Xt,Vt,zi,qt):nT(it,ri,Dt,Kt,Ri,zi,Vt,qt),Math.max(gi,ii)}(ze,l,o.aabb,a,d);let ke=n.ae.fromQuat([],ze),je=n.ae.multiply([],ke,ge);n.ae.multiply(a,ae,je)}else be=l.elevation.getAtPointOrZero(new ia(F.x/K,F.y/K),0);be!==0&&(a[14]+=be)}}function hb(a,o,l=!1){a.uploaded||(a.gfxTexture=new Dc(o,a.image,l?o.gl.R8:o.gl.RGBA,{useMipmap:a.sampler.minFilter>=o.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function Noe(a,o,l){a.indexBuffer=o.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=o.createVertexBuffer(a.vertexArray,Poe.members,!1,!0),a.normalArray&&(a.normalBuffer=o.createVertexBuffer(a.normalArray,zoe.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=o.createVertexBuffer(a.texcoordArray,Loe.members,!1,!0)),a.colorArray&&(a.colorBuffer=o.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?Roe:Ooe).members,!1,!0)),a.featureArray&&(a.pbrBuffer=o.createVertexBuffer(a.featureArray,koe.members,!0)),a.segments=ss.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);let d=a.material;d.pbrMetallicRoughness.baseColorTexture&&hb(d.pbrMetallicRoughness.baseColorTexture,o),d.pbrMetallicRoughness.metallicRoughnessTexture&&hb(d.pbrMetallicRoughness.metallicRoughnessTexture,o),d.normalTexture&&hb(d.normalTexture,o),d.occlusionTexture&&hb(d.occlusionTexture,o,l),d.emissionTexture&&hb(d.emissionTexture,o)}function uO(a,o,l){if(a.meshes)for(let d of a.meshes)Noe(d,o,l);if(a.children)for(let d of a.children)uO(d,o,l)}function oT(a){if(a.meshes)for(let o of a.meshes)o.indexArray.destroy(),o.vertexArray.destroy(),o.colorArray&&o.colorArray.destroy(),o.normalArray&&o.normalArray.destroy(),o.texcoordArray&&o.texcoordArray.destroy(),o.featureArray&&o.featureArray.destroy();if(a.children)for(let o of a.children)oT(o)}function hO(a){if(a.meshes)for(let l of a.meshes)l.vertexBuffer&&(l.vertexBuffer.destroy(),l.indexBuffer.destroy(),l.normalBuffer&&l.normalBuffer.destroy(),l.texcoordBuffer&&l.texcoordBuffer.destroy(),l.colorBuffer&&l.colorBuffer.destroy(),l.pbrBuffer&&l.pbrBuffer.destroy(),l.segments.destroy(),l.material&&((o=l.material).pbrMetallicRoughness.baseColorTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),o.pbrMetallicRoughness.metallicRoughnessTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),o.normalTexture&&o.normalTexture.gfxTexture&&o.normalTexture.gfxTexture.destroy(),o.emissionTexture&&o.emissionTexture.gfxTexture&&o.emissionTexture.gfxTexture.destroy(),o.occlusionTexture&&o.occlusionTexture.gfxTexture&&o.occlusionTexture.gfxTexture.destroy()));var o;if(a.children)for(let l of a.children)hO(l)}class Boe{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Uoe{constructor(){this.tasks={},this.taskQueue=[],ov(["process"],this),this.invoker=new Boe(this.process),this.nextId=0}add(o,l){let d=this.nextId++,m=function({type:y,isSymbolTile:v,zoom:S}){return S=S||0,y==="message"?0:y!=="maybePrepare"||v?y!=="parseTile"||v?y==="parseTile"&&v?300-S:y==="maybePrepare"&&v?400-S:500:200-S:100-S}(l);if(m===0){try{o()}finally{}return null}return this.tasks[d]={fn:o,metadata:l,priority:m,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;let o=this.pick();if(o===null)return;let l=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let o=null,l=1/0;for(let m=0;m<this.taskQueue.length;m++){let y=this.tasks[this.taskQueue[m]];y.priority<l&&(l=y.priority,o=m)}if(o===null)return null;let d=this.taskQueue[o];return this.taskQueue.splice(o,1),d}remove(){this.invoker.remove()}}class cG{constructor(o,l,d){this.target=o,this.parent=l,this.mapId=d,this.callbacks={},this.cancelCallbacks={},ov(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Uoe}send(o,l,d,m,y=!1,v){let S=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=v,this.callbacks[S]=d);let T=new Set;return this.target.postMessage({id:S,type:o,hasCallback:!!d,targetMapId:m,mustQueue:y,sourceMapId:this.mapId,data:ct(l,T)},T),{cancel:()=>{d&&delete this.callbacks[S],this.target.postMessage({id:S,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}receive(o){let l=o.data,d=l.id;if(d&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){let m=this.cancelCallbacks[d];delete this.cancelCallbacks[d],m&&m.cancel()}else if(l.mustQueue||Bp()){let m=this.callbacks[d],y=this.scheduler.add(()=>this.processTask(d,l),m&&m.metadata||{type:"message"});y&&(this.cancelCallbacks[d]=y)}else this.processTask(d,l)}processTask(o,l){if(delete this.cancelCallbacks[o],l.type==="<response>"){let d=this.callbacks[o];delete this.callbacks[o],d&&(l.error?d(_t(l.error)):d(null,_t(l.data)))}else{let d=new Set,m=l.hasCallback?(v,S)=>{this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:v?ct(v):null,data:ct(S,d)},d)}:v=>{},y=_t(l.data);if(this.parent[l.type])this.parent[l.type](l.sourceMapId,y,m);else if(this.parent.getWorkerSource){let v=l.type.split(".");this.parent.getWorkerSource(l.sourceMapId,v[0],y.source,y.scope)[v[1]](y,m)}else m(new Error(`Could not find function ${l.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let dO=(()=>{class a{constructor(l,d){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=sv();let m=this.workerPool.acquire(this.id);for(let y=0;y<m.length;y++){let v=new a.Actor(m[y],d,this.id);v.name=`Worker ${y}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,d,m){Cm(this.actors,(y,v)=>{y.send(l,d,v)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}return a.Actor=cG,a})();var db={workerUrl:"",workerClass:null,workerParams:void 0};function joe(){return db.workerClass!=null?new db.workerClass:new self.Worker(db.workerUrl,db.workerParams)}let pO="mapboxgl_preloaded_worker_pool";class pb{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<pb.workerCount;)this.workers.push(new joe);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.workers&&this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[pO]}numActive(){return Object.keys(this.active).length}}let fb;function aT(){return fb||(fb=new pb),fb}pb.workerCount=2;let lT,fO,vu,u0,mO,h0=null;function uG(){return Bp()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:fO||p.DRACO_URL}function hG(){if(Bp()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(u0)return u0;let a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return u0=WebAssembly.validate(a)?p.MESHOPT_SIMD_URL:p.MESHOPT_URL,u0}let cT={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Voe={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},mb={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function dG(a,o,l){let d=l.json.bufferViews.length,m=l.buffers.length;o.bufferView=d,l.json.bufferViews[d]={buffer:m,byteLength:a.byteLength},l.buffers[m]=a}let gO="KHR_draco_mesh_compression";function Goe(a,o){let l=a.extensions&&a.extensions[gO];if(!l)return;let d=new vu.Decoder,m=gG(o,l.bufferView),y=new vu.Mesh;if(!d.DecodeArrayToMesh(m,m.byteLength,y))throw new Error("Failed to decode Draco mesh");let v=o.json.accessors[a.indices],S=cT[v.componentType],T=v.count*S.BYTES_PER_ELEMENT,D=vu._malloc(T);S===Uint16Array?d.GetTrianglesUInt16Array(y,T,D):d.GetTrianglesUInt32Array(y,T,D),dG(vu.memory.buffer.slice(D,D+T),v,o),vu._free(D);for(let L of Object.keys(l.attributes)){let F=d.GetAttributeByUniqueId(y,l.attributes[L]),N=o.json.accessors[a.attributes[L]],H=Voe[N.componentType],q=N.count*mb[N.type]*cT[N.componentType].BYTES_PER_ELEMENT,Q=vu._malloc(q);d.GetAttributeDataArrayForAllPoints(y,F,vu[H],q,Q),dG(vu.memory.buffer.slice(Q,Q+q),N,o),vu._free(Q)}d.destroy(),y.destroy(),delete a.extensions[gO]}let uT="EXT_meshopt_compression";function Hoe(a,o){if(!a.extensions||!a.extensions[uT])return;let l=a.extensions[uT],d=new Uint8Array(o.buffers[l.buffer],l.byteOffset||0,l.byteLength||0),m=new Uint8Array(l.count*l.byteStride);mO.decodeGltfBuffer(m,l.count,l.byteStride,d,l.mode,l.filter),a.buffer=o.buffers.length,a.byteOffset=0,o.buffers[a.buffer]=m.buffer,delete a.extensions[uT]}let pG=1179937895,fG=new TextDecoder("utf8");function mG(a,o){return new URL(a,o).href}function Woe(a,o,l,d){return fetch(mG(a.uri,d)).then(m=>m.arrayBuffer()).then(m=>{o.buffers[l]=m})}function gG(a,o){let l=a.json.bufferViews[o];return new Uint8Array(a.buffers[l.buffer],l.byteOffset||0,l.byteLength)}function qoe(a,o,l,d){if(a.uri){let m=mG(a.uri,d);return fetch(m).then(y=>y.blob()).then(y=>createImageBitmap(y)).then(y=>{o.images[l]=y})}if(a.bufferView!==void 0){let m=gG(o,a.bufferView),y=new Blob([m],{type:a.mimeType});return createImageBitmap(y).then(v=>{o.images[l]=v})}}function yG(a,o=0,l){let d={json:null,images:[],buffers:[]};if(new Uint32Array(a,o,1)[0]===pG){let L=new Uint32Array(a,o),F=2,N=(L[F++]>>2)-3,H=L[F++]>>2;if(F++,d.json=JSON.parse(fG.decode(L.subarray(F,F+H))),F+=H,F<N){let q=L[F++];F++;let Q=o+(F<<2);d.buffers[0]=a.slice(Q,Q+q)}}else d.json=JSON.parse(fG.decode(new Uint8Array(a,o)));let{buffers:m,images:y,meshes:v,extensionsUsed:S,bufferViews:T}=d.json,D=Promise.resolve();if(m){let L=[];for(let F=0;F<m.length;F++){let N=m[F];N.uri?L.push(Woe(N,d,F,l)):d.buffers[F]||(d.buffers[F]=null)}D=Promise.all(L)}return D.then(()=>{let L=[],F=S&&S.includes(gO),N=S&&S.includes(uT);if(F&&L.push(function(){if(!vu)return lT||(lT=function(H){let q,Q=null;function K(){q=new Uint8Array(Q.buffer)}function ae(){throw new Error("Unexpected Draco error.")}let _e={a:{a:ae,d:function(ge,be,ze){return q.copyWithin(ge,be,be+ze)},c:function(ge){let be=q.length,ze=Math.max(ge>>>0,Math.ceil(1.2*be)),ke=Math.ceil((ze-be)/65536);try{return Q.grow(ke),K(),!0}catch{return!1}},b:ae}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(H,_e):H.then(ge=>ge.arrayBuffer()).then(ge=>WebAssembly.instantiate(ge,_e))).then(ge=>{let{Rb:be,Qb:ze,P:ke,T:je,X:it,Ja:ut,La:vt,Qa:dt,Va:At,Wa:jt,eb:Ct,jb:qt,f:Tt,e:Ot,yb:Kt,zb:Dt,Ab:ri,Bb:Xt,Db:Vt,Gb:zi}=ge.instance.exports;Q=Ot;let Ri=(()=>{let gi=0,ii=0,Ki=0,Oi=0;return Ei=>{Ki&&(be(Oi),be(gi),ii+=Ki,Ki=gi=0),gi||(ii+=128,gi=ze(ii));let nr=Ei.length+7&-8,or=gi;nr>=ii&&(Ki=nr,or=Oi=ze(nr));for(let sr=0;sr<Ei.length;sr++)q[or+sr]=Ei[sr];return or}})();return K(),Tt(),{memory:Ot,_free:be,_malloc:ze,Mesh:class{constructor(){this.ptr=ke()}destroy(){je(this.ptr)}},Decoder:class{constructor(){this.ptr=ut()}destroy(){qt(this.ptr)}DecodeArrayToMesh(gi,ii,Ki){let Oi=Ri(gi),Ei=vt(this.ptr,Oi,ii,Ki.ptr);return!!it(Ei)}GetAttributeByUniqueId(gi,ii){return{ptr:dt(this.ptr,gi.ptr,ii)}}GetTrianglesUInt16Array(gi,ii,Ki){At(this.ptr,gi.ptr,ii,Ki)}GetTrianglesUInt32Array(gi,ii,Ki){jt(this.ptr,gi.ptr,ii,Ki)}GetAttributeDataArrayForAllPoints(gi,ii,Ki,Oi,Ei){Ct(this.ptr,gi.ptr,ii.ptr,Ki,Oi,Ei)}},DT_INT8:Kt(),DT_UINT8:Dt(),DT_INT16:ri(),DT_UINT16:Xt(),DT_UINT32:Vt(),DT_FLOAT32:zi()}})}(fetch(uG())),lT.then(H=>{vu=H,lT=void 0}))}()),N&&L.push(function(){if(mO)return;let H=function(q){let Q,K=WebAssembly.instantiateStreaming(q,{}).then(ge=>{Q=ge.instance,Q.exports.__wasm_call_ctors()}),ae={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},_e={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:K,supported:!0,decodeGltfBuffer(ge,be,ze,ke,je,it){(function(ut,vt,dt,At,jt,Ct,qt){let Tt=ut.exports.sbrk,Ot=At+3&-4,Kt=Tt(Ot*jt),Dt=Tt(Ct.length),ri=new Uint8Array(ut.exports.memory.buffer);ri.set(Ct,Dt);let Xt=vt(Kt,At,jt,Dt,Ct.length);if(Xt===0&&qt&&qt(Kt,Ot,jt),dt.set(ri.subarray(Kt,Kt+At*jt)),Tt(Kt-Tt(0)),Xt!==0)throw new Error(`Malformed buffer data: ${Xt}`)})(Q,Q.exports[_e[je]],ge,be,ze,ke,Q.exports[ae[it]])}}}(fetch(hG()));return H.ready.then(()=>{mO=H})}()),y)for(let H=0;H<y.length;H++)L.push(qoe(y[H],d,H,l));return(L.length?Promise.all(L):Promise.resolve()).then(()=>{if(F&&v)for(let{primitives:H}of v)for(let q of H)Goe(q,d);if(N&&v&&T)for(let H of T)Hoe(H,d);return d})})}function Sg(a,o){let l=a.json.bufferViews[o.bufferView],d=cT[o.componentType];return new d(a.buffers[l.buffer],(o.byteOffset||0)+(l.byteOffset||0),o.count*(l.byteStride&&l.byteStride!==mb[o.type]*d.BYTES_PER_ELEMENT?l.byteStride/d.BYTES_PER_ELEMENT:mb[o.type]))}function yO(a,o,l,d){let m=cT[o.componentType],y=function(L){switch(L){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(m),v=a.json.bufferViews[o.bufferView],S=v.byteStride?v.byteStride/m.BYTES_PER_ELEMENT:mb[o.type],T=l.float32,D=T.length/l.capacity;for(let L=0,F=0;L<o.count*S;L+=S,F+=D)for(let N=0;N<D;N++)T[F+N]=d[L+N]*y;l._trim()}function Yoe(a,o,l){let d=a.indices,m=a.attributes,y={};y.indexArray=new so;let v=o.json.accessors[d],S=v.count/3;y.indexArray.reserve(S);let T=Sg(o,v);for(let N=0;N<S;N++)y.indexArray.emplaceBack(T[3*N],T[3*N+1],T[3*N+2]);y.indexArray._trim(),y.vertexArray=new rf;let D=o.json.accessors[m.POSITION];y.vertexArray.reserve(D.count);let L=Sg(o,D);for(let N=0;N<D.count;N++)y.vertexArray.emplaceBack(L[3*N],L[3*N+1],L[3*N+2]);if(y.vertexArray._trim(),y.aabb=new Jn(D.min,D.max),y.centroid=function(N,H){let q=[0,0,0],Q=N.length;if(Q>0){for(let K=0;K<Q;K++){let ae=3*N[K];q[0]+=H[ae],q[1]+=H[ae+1],q[2]+=H[ae+2]}q[0]/=Q,q[1]/=Q,q[2]/=Q}return q}(T,L),m.COLOR_0!==void 0){let N=o.json.accessors[m.COLOR_0],H=mb[N.type],q=Sg(o,N);y.colorArray=H===3?new rf:new tf,y.colorArray.resize(N.count),yO(o,N,y.colorArray,q)}if(m.NORMAL!==void 0){y.normalArray=new rf;let N=o.json.accessors[m.NORMAL];y.normalArray.resize(N.count);let H=Sg(o,N);yO(o,N,y.normalArray,H)}if(m.TEXCOORD_0!==void 0&&l.length>0){y.texcoordArray=new R1;let N=o.json.accessors[m.TEXCOORD_0];y.texcoordArray.resize(N.count);let H=Sg(o,N);yO(o,N,y.texcoordArray,H)}if(m._FEATURE_ID_RGBA4444!==void 0){let N=o.json.accessors[m._FEATURE_ID_RGBA4444];o.json.extensionsUsed&&o.json.extensionsUsed.includes("EXT_meshopt_compression")&&(y.featureData=Sg(o,N))}m._FEATURE_RGBA4444!==void 0&&(y.featureData=new Uint32Array(Sg(o,o.json.accessors[m._FEATURE_RGBA4444]).buffer));let F=a.material;return y.material=function(N,H){let{emissiveFactor:q=[0,0,0],alphaMode:Q="OPAQUE",alphaCutoff:K=.5,normalTexture:ae,occlusionTexture:_e,emissiveTexture:ge,doubleSided:be}=N,{baseColorFactor:ze=[1,1,1,1],metallicFactor:ke=1,roughnessFactor:je=1,baseColorTexture:it,metallicRoughnessTexture:ut}=N.pbrMetallicRoughness||{},vt=_e?H[_e.index]:void 0;if(_e&&_e.extensions&&_e.extensions.KHR_texture_transform&&vt){let dt=_e.extensions.KHR_texture_transform;vt.offsetScale=[dt.offset[0],dt.offset[1],dt.scale[0],dt.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new en(...ze),metallicFactor:ke,roughnessFactor:je,baseColorTexture:it?H[it.index]:void 0,metallicRoughnessTexture:ut?H[ut.index]:void 0},doubleSided:be,emissiveFactor:q,alphaMode:Q,alphaCutoff:K,normalTexture:ae?H[ae.index]:void 0,occlusionTexture:vt,emissionTexture:ge?H[ge.index]:void 0,defined:N.defined===void 0}}(F!==void 0?o.json.materials[F]:{defined:!1},l),y}function vG(a,o,l){let{matrix:d,rotation:m,translation:y,scale:v,mesh:S,extras:T,children:D}=a,L={};if(L.matrix=d||n.ae.fromRotationTranslationScale([],m||[0,0,0,1],y||[0,0,0],v||[1,1,1]),S!==void 0){L.meshes=l[S];let F=L.anchor=[0,0];for(let N of L.meshes){let{min:H,max:q}=N.aabb;F[0]+=H[0]+q[0],F[1]+=H[1]+q[1]}F[0]=Math.floor(F[0]/L.meshes.length/2),F[1]=Math.floor(F[1]/L.meshes.length/2)}if(T&&(T.id&&(L.id=T.id),T.lights&&(L.lights=function(F){if(!F.length)return[];let N=function(ae){let _e=atob(ae),ge=new Uint8Array(_e.length);for(let be=0;be<_e.length;be++)ge[be]=_e.codePointAt(be);return ge}(F),H=[],q=N.length/24,Q=new Uint16Array(N.buffer),K=new Float32Array(N.buffer);for(let ae=0;ae<q;ae++){let _e=Q[2*ae*6]/30,ge=Q[2*ae*6+1]/30,be=Q[2*ae*6+10]/100,ze=K[6*ae+1],ke=K[6*ae+2],je=K[6*ae+3],it=K[6*ae+4],ut=je-ze,vt=it-ke,dt=Math.hypot(ut,vt);H.push({pos:[ze+.5*ut,ke+.5*vt,ge],normal:[vt/dt,-ut/dt,0],width:dt,height:_e,depth:be,points:[ze,ke,je,it]})}return H}(T.lights))),D){let F=[];for(let N of D)F.push(vG(o.json.nodes[N],o,l));L.children=F}return L}function Xoe(a){if(a.vertices.length===0||a.indices.length===0)return null;let o=new OR(a.vertices,a.indices,8,256),[l,d]=[o.min.clone(),o.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:o,min:l,max:d}}function $oe(a){if(!a.extras||!a.extras.ground)return null;let o=a.extras.ground;if(!o||!Array.isArray(o)||o.length===0)return null;let l=o[0];if(!l||!Array.isArray(l)||l.length===0)return null;let d=[];for(let v of l){if(!Array.isArray(v)||v.length!==2)continue;let S=v[0],T=v[1];typeof S=="number"&&typeof T=="number"&&d.push(new ai(S,T))}if(d.length<3)return null;d.length>1&&d[d.length-1].equals(d[0])&&d.pop();let m=0;for(let v=0;v<d.length;v++){let S=d[v],T=d[(v+1)%d.length],D=d[(v+2)%d.length];m+=(S.x-T.x)*(D.y-T.y)-(D.x-T.x)*(S.y-T.y)}m>0&&d.reverse();let y=j1(d.flatMap(v=>[v.x,v.y]),[]);return y.length===0?null:{vertices:d,indices:y}}function Zoe(a,o){let l=[],d=[],m=0,y=[];for(let v of a){m=l.length;let S=v.vertexArray.float32,T=v.indexArray.uint16;for(let D=0;D<v.vertexArray.length;D++)y[0]=S[3*D+0],y[1]=S[3*D+1],y[2]=S[3*D+2],n.$.transformMat4(y,y,o),l.push(new ai(y[0],y[1]));for(let D=0;D<3*v.indexArray.length;D++)d.push(T[D]+m)}if(d.length%3!=0)return null;for(let v=0;v<d.length;v+=3){let S=l[d[v+0]],T=l[d[v+1]],D=l[d[v+2]];(S.x-T.x)*(D.y-T.y)-(D.x-T.x)*(S.y-T.y)>0&&([d[v+1],d[v+2]]=[d[v+2],d[v+1]])}return{vertices:l,indices:d}}function _G(a){let o=function(T,D){let L=[],F=WebGL2RenderingContext;if(T.json.textures)for(let N of T.json.textures){let H={magFilter:F.LINEAR,minFilter:F.NEAREST,wrapS:F.REPEAT,wrapT:F.REPEAT};N.sampler!==void 0&&Object.assign(H,T.json.samplers[N.sampler]),L.push({image:D[N.source],sampler:H,uploaded:!1})}return L}(a,a.images),l=function(T,D){let L=[];for(let F of T.json.meshes){let N=[];for(let H of F.primitives)N.push(Yoe(H,T,D));L.push(N)}return L}(a,o),{scenes:d,scene:m,nodes:y}=a.json,v=d?d[m||0].nodes:y,S=[];for(let T of v)S.push(vG(y[T],a,l));return function(T,D,L){let F={},N=new Set;for(let H=0;H<T.length;H++){let q=L[D[H]];if(!q.extras)continue;let Q=q.extras["mapbox:footprint:version"],K=q.extras["mapbox:footprint:id"];(Q||K)&&N.add(H),Q==="1.0.0"&&K&&(F[K]=H)}for(let H=0;H<T.length;H++){if(N.has(H))continue;let q=T[H],Q=L[D[H]];if(!Q.extras)continue;let K=null;q.id in F&&(K=Zoe(T[F[q.id]].meshes,q.matrix)),K||(K=$oe(Q)),K&&(q.footprint=Xoe(K))}if(N.size>0){let H=Array.from(N.values()).sort((q,Q)=>q-Q);for(let q=H.length-1;q>=0;q--)T.splice(H[q],1)}}(S,v,a.json.nodes),S}function Qoe(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);let o=a.vertexArray.float32,l=a.aabb.min[0]-1,d=a.aabb.min[1]-1,m=wg/(a.aabb.max[0]-l+2),y=wg/(a.aabb.max[1]-d+2);for(let v=0;v<o.length;v+=3){let S=o[v+2],T=(o[v+0]-l)*m|0,D=(o[v+1]-d)*y|0;S>a.heightmap[D*wg+T]&&(a.heightmap[D*wg+T]=S)}}function Koe(a,o){let l={};l.indexArray=new so,l.indexArray.reserve(4*a.length),l.vertexArray=new rf,l.vertexArray.reserve(10*a.length),l.colorArray=new tf,l.vertexArray.reserve(10*a.length);let d=0;for(let v of a){let S=Math.min(10,Math.max(4,1.3*v.height))*o,T=[-v.normal[1],v.normal[0],0],D=Math.min(.29,.1*v.width/v.depth),L=v.width-2*v.depth*o*(D+.01),F=n.$.scaleAndAdd([],v.pos,T,L/2),N=n.$.scaleAndAdd([],v.pos,T,-L/2),H=[F[0],F[1],F[2]+v.height],q=[N[0],N[1],N[2]+v.height],Q=n.$.scaleAndAdd([],v.normal,T,D);n.$.scale(Q,Q,S);let K=n.$.scaleAndAdd([],v.normal,T,-D);n.$.scale(K,K,S),n.$.add(Q,F,Q),n.$.add(K,N,K),F[2]+=.1,N[2]+=.1,l.vertexArray.emplaceBack(Q[0],Q[1],Q[2]),l.vertexArray.emplaceBack(K[0],K[1],K[2]),l.vertexArray.emplaceBack(F[0],F[1],F[2]),l.vertexArray.emplaceBack(N[0],N[1],N[2]),l.vertexArray.emplaceBack(H[0],H[1],H[2]),l.vertexArray.emplaceBack(q[0],q[1],q[2]),l.vertexArray.emplaceBack(F[0],F[1],F[2]),l.vertexArray.emplaceBack(N[0],N[1],N[2]),l.vertexArray.emplaceBack(Q[0],Q[1],Q[2]),l.vertexArray.emplaceBack(K[0],K[1],K[2]);let ae=L/S/2;l.colorArray.emplaceBack(-ae-D,-1,ae,.8),l.colorArray.emplaceBack(ae+D,-1,ae,.8),l.colorArray.emplaceBack(-ae,0,ae,1.3),l.colorArray.emplaceBack(ae,0,ae,1.3),l.colorArray.emplaceBack(ae+D,-.8,ae,.7),l.colorArray.emplaceBack(ae+D,-.8,ae,.7),l.colorArray.emplaceBack(0,0,ae,1.3),l.colorArray.emplaceBack(0,0,ae,1.3),l.colorArray.emplaceBack(ae+D,-1.2,ae,.8),l.colorArray.emplaceBack(ae+D,-1.2,ae,.8),l.indexArray.emplaceBack(6+d,4+d,8+d),l.indexArray.emplaceBack(7+d,9+d,5+d),l.indexArray.emplaceBack(0+d,1+d,2+d),l.indexArray.emplaceBack(1+d,3+d,2+d),d+=10}let m={defined:!0,emissiveFactor:[0,0,0]},y={};return y.baseColorFactor=en.white,m.pbrMetallicRoughness=y,l.material=m,l.aabb=new Jn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),l}let vO=new Float32Array(262144),Eg=new Uint8Array(262144);function xG(a){let o=0;if(a.meshes)for(let l of a.meshes)o=Math.max(o,l.aabb.max[2]);if(a.children)for(let l of a.children)o=Math.max(o,xG(l));return o}function bG(a,o,l){if(a.meshes)for(let d of a.meshes)d.aabb.min[0]!==1/0&&l.insert(o,d.aabb.min[0],d.aabb.min[1],d.aabb.max[0],d.aabb.max[1]);if(a.children)for(let d of a.children)bG(d,o,l)}let wG=["","wall","door","roof","window","lamp","logo"];class SG{constructor(o){this.node=o,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:o.id,geometry:[],properties:{height:xG(o)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Jn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let o=0,l=new Jn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let d of this.node.meshes)this.node.lightMeshIndex!==o&&(d.transformedAabb=Jn.applyTransformFast(d.aabb,this.node.matrix),l.encapsulate(d.transformedAabb)),o++;this.aabb=l}return this.aabb}}class hT{constructor(o,l,d,m,y,v){this.id=l,this.modelTraits|=c0.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=c0.HasMapboxMeshFeatures),m&&(this.modelTraits|=c0.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=y,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let S of o)this.nodesInfo.push(new SG(S)),bG(S,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0)}updateFootprints(o,l){for(let d of this.getNodesInfo()){let m=d.node;m.footprint&&l.push({footprint:m.footprint,id:o})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(o){if(!this.needsUpload)return;let l=this.getNodesInfo();for(let d of l){let m=d.node;this.uploaded?this.updatePbrBuffer(m):uO(m,o,!0)}for(let d of l)oT(d.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(o){let l=!1;if(!o.meshes)return l;for(let d of o.meshes)d.pbrBuffer&&(d.pbrBuffer.updateData(d.featureArray),l=!0);return l}needsReEvaluation(o,l,d){let m=o.transform.projectionOptions,y=o.style.getBrightness(),v=this.brightness!==y;return!!(!this.uploaded||this.dirty||m.name!==this.projection.name||gb(d.paint.get("model-color").value,v)||gb(d.paint.get("model-color-mix-intensity").value,v)||gb(d.paint.get("model-roughness").value,v)||gb(d.paint.get("model-emissive-strength").value,v)||gb(d.paint.get("model-height-based-emissive-strength-multiplier").value,v))&&(this.projection=m,this.brightness=y,!0)}evaluateScale(o,l){if(o.transform.zoom===this.zoom)return;this.zoom=o.transform.zoom;let d=this.getNodesInfo(),m=this.id.canonical;for(let y of d){let v=y.feature;y.evaluatedScale=l.paint.get("model-scale").evaluate(v,{},m)}}evaluate(o){let l=this.getNodesInfo();for(let d of l){if(!d.node.meshes)continue;let m=d.feature,y=d.node.meshes&&d.node.meshes[0].featureData,v=d.evaluatedColor[2],S=d.evaluatedRMEA[2],T=this.id.canonical;if(d.hasTranslucentParts=!1,y){for(let D=0;D<wG.length;D++){let L=wG[D];L.length&&(m.properties.part=L);let F=o.paint.get("model-color").evaluate(m,{},T).toRenderColor(null),N=o.paint.get("model-color-mix-intensity").evaluate(m,{},T);d.evaluatedColor[D]=[F.r,F.g,F.b,N],d.evaluatedRMEA[D][0]=o.paint.get("model-roughness").evaluate(m,{},T),d.evaluatedRMEA[D][2]=o.paint.get("model-emissive-strength").evaluate(m,{},T),d.evaluatedRMEA[D][3]=F.a,d.emissionHeightBasedParams[D]=o.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,{},T),!d.hasTranslucentParts&&F.a<1&&(d.hasTranslucentParts=!0)}delete m.properties.part,eae(d,v!==d.evaluatedColor[2]||S!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=o.paint.get("model-emissive-strength").evaluate(m,{},T);d.evaluatedScale=o.paint.get("model-scale").evaluate(m,{},T),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(o,l,d,m){let y=o.findDEMTileFor(d);if(y&&(y.tileID.canonical!==this.terrainTile||l!==this.terrainExaggeration)){if(y.dem&&y.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=y.tileID.overscaledZ;let v=Kv.create(o,d,y);if(!v)return;this.modelTraits&c0.HasMapboxMeshFeatures&&this.updateDEM(o,v,d,m);for(let S of this.getNodesInfo()){let T=S.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;let D=T.footprint.vertices,L=v.getElevationAt(D[0].x,D[0].y,!0,!0);for(let F=1;F<D.length;F++)L=Math.min(L,v.getElevationAt(D[F].x,D[F].y,!0,!0));T.elevation=L}}this.terrainTile=y.tileID.canonical,this.terrainExaggeration=l}}updateDEM(o,l,d,m){let y=l._dem._modifiedForSources[m];if(y===void 0&&(l._dem._modifiedForSources[m]=[],y=l._dem._modifiedForSources[m]),y.includes(d.canonical))return;let v=l._dem.dim;y.push(d.canonical);let S=!1;for(let T of this.getNodesInfo()){let D=T.node;if(!D.footprint||!D.footprint.grid)continue;let L=D.footprint.grid,F=l.tileCoordToPixel(L.min.x,L.min.y),N=l.tileCoordToPixel(L.max.x,L.max.y),H=Math.min(Math.min(v-N.y,F.x),Math.min(F.y,v-N.x));if(H<0)continue;let q=xr(H,2,5),Q=Math.max(0,F.x-q),K=Math.max(0,F.y-q),ae=Math.min(N.x+q,v-1),_e=Math.min(N.y+q,v-1);for(let ke=K;ke<=_e;++ke)for(let je=Q;je<=ae;++je)Eg[ke*v+je]=255;let ge=0,be=0;for(let ke=0;ke<L.cellsY;++ke)for(let je=0;je<L.cellsX;++je){if(!L.cells[ke*L.cellsX+je])continue;let it=l.tileCoordToPixel(L.min.x+je/L.xScale,L.min.y+ke/L.yScale),ut=l.tileCoordToPixel(L.min.x+(je+1)/L.xScale,L.min.y+(ke+1)/L.yScale);for(let vt=it.y;vt<=Math.min(ut.y+1,v-1);++vt)for(let dt=it.x;dt<=Math.min(ut.x+1,v-1);++dt)Eg[vt*v+dt]===255&&(Eg[vt*v+dt]=0,ge+=l.getElevationAtPixel(dt,vt),be++)}let ze=ge/be;Q=Math.max(1,F.x-q),K=Math.max(1,F.y-q),ae=Math.min(N.x+q,v-2),_e=Math.min(N.y+q,v-2),S=!0;for(let ke=K;ke<=_e;++ke)for(let je=Q;je<=ae;++je)Eg[ke*v+je]===0&&(vO[ke*v+je]=l._dem.set(je,ke,ze));for(let ke=1;ke<q;++ke){Q=Math.max(1,F.x-ke),K=Math.max(1,F.y-ke),ae=Math.min(N.x+ke,v-2),_e=Math.min(N.y+ke,v-2);for(let je=K;je<=_e;++je)for(let it=Q;it<=ae;++it){let ut=je*v+it;if(Eg[ut]===255){let vt=0,dt=0,At=-1,jt=-1;for(let Ct=-1;Ct<=1;++Ct)for(let qt=-1;qt<=1;++qt){let Tt=(je+Ct)*v+it+qt;if(Eg[Tt]>=ke)continue;let Ot=vO[Tt],Kt=Math.abs(Ot);Kt>dt&&(vt=Ot,dt=Kt,At=qt,jt=Ct)}if(dt>.1){let Ct=1-(ke+.5*Math.abs(At*jt))/q,qt=l._dem.get(it,je)+vt*Ct,Tt=l._dem.get(it+At,je+jt),Ot=l._dem.get(it-At,je-jt,!0);(qt-Tt)*(qt-Ot)>0&&(qt=(Tt+Ot)/2),vO[ut]=l._dem.set(it,je,qt),Eg[ut]=ke}}}}}S&&(l._demTile.needsDEMTextureUpload=!0,l._dem._timestamp=Oo.now())}getNodesInfo(){return this.nodesInfo}destroy(){let o=this.getNodesInfo();for(let l of o)oT(l.node),hO(l.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(o,l){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;let d=l.getReplacementRegionsForTile(o.toUnwrapped()),m=this.getNodesInfo();for(let y=0;y<this.nodesInfo.length;y++){let v=m[y].node;m[y].hiddenByReplacement=!!v.footprint&&!d.find(S=>S.footprint===v.footprint)}}getHeightAtTileCoord(o,l){let d=this.getNodesInfo(),m=[],y=[0,0,0],v=n.ae.identity([]);for(let S=0;S<this.nodesInfo.length;S++){let T=d[S],D=T.node.meshes[0],L=D.transformedAabb;if(o<L.min[0]||l<L.min[1]||o>L.max[0]||l>L.max[1])continue;if(T.node.hidden===!0)return{height:0,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};n.ae.invert(v,T.node.matrix),y[0]=o,y[1]=l,n.$.transformMat4(y,y,v);let F=(y[0]-D.aabb.min[0])/(D.aabb.max[0]-D.aabb.min[0])*wg|0,N=Math.min(63,(y[1]-D.aabb.min[1])/(D.aabb.max[1]-D.aabb.min[1])*wg|0)*wg+Math.min(63,F),H=D.heightmap[N];if(!(H<0&&T.node.footprint))return T.hiddenByReplacement?void 0:{height:H,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};if(T.node.footprint.grid.query(new ai(o,l),new ai(o,l),m),m.length>0)return{height:void 0,maxHeight:T.feature.properties.height,hidden:T.hiddenByReplacement,verticalScale:T.evaluatedScale[2]}}}}function gb(a,o){return!a.isLightConstant&&o}function Joe(a,o,l,d,m,y,v,S){let T=(61440&o|(61440&o)>>4)>>8,D=(3840&o|(3840&o)>>4)>>4,L=240&o|(240&o)>>4;l[3]>0&&(T=Gi(T,255*l[0],l[3]),D=Gi(D,255*l[1],l[3]),L=Gi(L,255*l[2],l[3]));let F=T<<8|D,N=L<<8|Math.floor(255*d[3]),H=function(ke){let je=xr(ke,0,2);return Math.min(Math.round(.5*je*255),255)}(d[2])<<8|15*d[0]<<4|15*d[1],q=xr(m[0],0,1),Q=xr(m[1],0,1),K=xr(m[2],0,1),ae=xr(m[3],0,1),_e,ge,be,ze;if(q!==Q&&v!==y&&Q!==q){let ke=v-y;ge=1/(ke*(Q-q)),be=-(y+ke*q)/(ke*(Q-q));let je=xr(m[4],-1,1);ze=Math.pow(10,je),_e=255*K<<8|255*ae}else _e=65535,ge=0,be=1,ze=1;if(a.emplaceBack(F,N,H,_e,ge,be,ze),S){let ke=S.length;S.clear();for(let je=0;je<ke;je++)S.emplaceBack(F,N,H,_e,ge,be,ze)}}function eae(a,o,l){let d=a.node,m=0,y=l&c0.HasMeshoptCompression;for(let v of d.meshes){if(d.lights&&d.lightMeshIndex===m||!v.featureData)continue;v.featureArray=new hM,v.featureArray.reserve(v.featureData.length);let S=o;for(let T of v.featureData){let D=y?65535&T:T>>16&65535,L=y?T>>16&65535:65535&T,F=(15&L)<8?15&L:0,N=a.evaluatedRMEA[F],H=a.evaluatedColor[F],q=a.emissionHeightBasedParams[F],Q;if(S&&F===2&&d.lights&&(Q=new hM,Q.resize(10*d.lights.length)),Joe(v.featureArray,D,H,N,q,v.aabb.min[2],v.aabb.max[2],Q),Q&&S){S=!1;let K=d.meshes[d.lightMeshIndex];K.featureArray=Q,K.featureArray._trim()}}v.featureArray._trim(),m++}}function EG(a,o,l,d){let m=1<<a.z;o.lat=_o((d/ti+a.y)/m),o.lng=ol((l/ti+a.x)/m)}tt(hT,"Tiled3dModelBucket",{omit:["layers"]}),tt(SG,"Tiled3dModelFeature");let tae={circle:class extends sl{constructor(a,o,l,d){super(a,{layout:oj||(oj=new Dn({"circle-sort-key":new Mi(mt.layout_circle["circle-sort-key"]),visibility:new Ht(mt.layout_circle.visibility)})),paint:aj||(aj=new Dn({"circle-radius":new Mi(mt.paint_circle["circle-radius"]),"circle-color":new Mi(mt.paint_circle["circle-color"]),"circle-blur":new Mi(mt.paint_circle["circle-blur"]),"circle-opacity":new Mi(mt.paint_circle["circle-opacity"]),"circle-translate":new Ht(mt.paint_circle["circle-translate"]),"circle-translate-anchor":new Ht(mt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ht(mt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ht(mt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mi(mt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mi(mt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mi(mt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ht(mt.paint_circle["circle-emissive-strength"])}))},o,l,d)}createBucket(a){return new mR(a)}queryRadius(a){let o=a;return $v("circle-radius",this,o)+$v("circle-stroke-width",this,o)+yM(this.paint.get("circle-translate"))}queryIntersectsFeature(a,o,l,d,m,y,v,S){let T=sj(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,a.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l);return wj(a,d,y,v,S,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,D)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,o,l){let d=bj(this);return{config:new fg(this,{zoom:o,lut:l}),defines:d,overrideFog:!1}}},heatmap:class extends sl{createBucket(a){return new Ej(a)}constructor(a,o,l,d){super(a,{layout:Cj||(Cj=new Dn({visibility:new Ht(mt.layout_heatmap.visibility)})),paint:Dj||(Dj=new Dn({"heatmap-radius":new Mi(mt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mi(mt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ht(mt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ta(mt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ht(mt.paint_heatmap["heatmap-opacity"])}))},o,l,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=U1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return $v("heatmap-radius",this,a)}queryIntersectsFeature(a,o,l,d,m,y,v,S){let T=this.paint.get("heatmap-radius").evaluate(o,l);return wj(a,d,y,v,S,!0,!0,new ai(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,o,l){return a==="heatmap"?{config:new fg(this,{zoom:o,lut:l}),overrideFog:!1}:{}}},hillshade:class extends sl{constructor(a,o,l,d){super(a,{layout:Ij||(Ij=new Dn({visibility:new Ht(mt.layout_hillshade.visibility)})),paint:Pj||(Pj=new Dn({"hillshade-illumination-direction":new Ht(mt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ht(mt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ht(mt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ht(mt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ht(mt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ht(mt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ht(mt.paint_hillshade["hillshade-emissive-strength"])}))},o,l,d)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,o,l){return{overrideFog:!1}}},fill:class extends sl{constructor(a,o,l,d){super(a,{layout:Fj||(Fj=new Dn({"fill-sort-key":new Mi(mt.layout_fill["fill-sort-key"]),visibility:new Ht(mt.layout_fill.visibility)})),paint:kj||(kj=new Dn({"fill-antialias":new Ht(mt.paint_fill["fill-antialias"]),"fill-opacity":new Mi(mt.paint_fill["fill-opacity"]),"fill-color":new Mi(mt.paint_fill["fill-color"]),"fill-outline-color":new Mi(mt.paint_fill["fill-outline-color"]),"fill-translate":new Ht(mt.paint_fill["fill-translate"]),"fill-translate-anchor":new Ht(mt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Mi(mt.paint_fill["fill-pattern"]),"fill-emissive-strength":new Ht(mt.paint_fill["fill-emissive-strength"])}))},o,l,d)}getProgramIds(){let a=this.paint.get("fill-pattern"),o=a&&a.constantOr(1),l=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getDefaultProgramParams(a,o,l){return{config:new fg(this,{zoom:o,lut:l}),overrideFog:!1}}recalculate(a,o){super.recalculate(a,o);let l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new TM(a)}queryRadius(){return yM(this.paint.get("fill-translate"))}queryIntersectsFeature(a,o,l,d,m,y){return!a.queryGeometry.isAboveHorizon&&ej(nj(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,a.pixelToTileUnitsFactor),d)}isTileClipped(){return!0}},"fill-extrusion":class extends sl{constructor(a,o,l,d){super(a,{layout:bV||(bV=new Dn({visibility:new Ht(mt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ht(mt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:wV||(wV=new Dn({"fill-extrusion-opacity":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mi(mt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Mi(mt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Mi(mt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mi(mt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Mi(mt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Mi(mt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Mi(mt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-line-alignment":new Ht(mt["paint_fill-extrusion"]["fill-extrusion-line-alignment"])}))},o,l,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new LM(a)}queryRadius(){return yM(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,o,l,d,m,y,v,S,T){let D=sj(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,a.pixelToTileUnitsFactor),L=this.paint.get("fill-extrusion-height").evaluate(o,l),F=this.paint.get("fill-extrusion-base").evaluate(o,l),N=[0,0],H=S&&y.elevation,q=y.elevation?y.elevation.exaggeration():1,Q=a.tile.getBucket(this);if(H&&Q instanceof LM){let be=Q.centroidVertexArray,ze=T+1;ze<be.length&&(N[0]=be.geta_centroid_pos0(ze),N[1]=be.geta_centroid_pos1(ze))}if(N[0]===0&&N[1]===1)return!1;y.projection.name==="globe"&&(d=xV([d],[new ai(0,0),new ai(ti,ti)],a.tileID.canonical).map(be=>be.polygon).flat());let K=H?S:null,[ae,_e]=function(be,ze,ke,je,it,ut,vt,dt,At,jt,Ct){return be.projection.name==="globe"?function(qt,Tt,Ot,Kt,Dt,ri,Xt,Vt,zi,Ri,gi){let ii=[],Ki=[],Oi=qt.projection.upVectorScale(gi,qt.center.lat,qt.worldSize).metersToTile,Ei=[0,0,0,1],nr=[0,0,0,1],or=(yr,jr,Ir,En)=>{yr[0]=jr,yr[1]=Ir,yr[2]=En,yr[3]=1},sr=_V();Ot>0&&(Ot+=sr),Kt+=sr;for(let yr of Tt){let jr=[],Ir=[];for(let En of yr){let In=En.x+Dt.x,ar=En.y+Dt.y,dn=qt.projection.projectTilePoint(In,ar,gi),fn=qt.projection.upVector(gi,En.x,En.y),Un=Ot,Ms=Kt;if(Xt){let Bs=EV(In,ar,Ot,Kt,Xt,Vt,zi,Ri);Un+=Bs.base,Ms+=Bs.top}Ot!==0?or(Ei,dn.x+fn[0]*Oi*Un,dn.y+fn[1]*Oi*Un,dn.z+fn[2]*Oi*Un):or(Ei,dn.x,dn.y,dn.z),or(nr,dn.x+fn[0]*Oi*Ms,dn.y+fn[1]*Oi*Ms,dn.z+fn[2]*Oi*Ms),n.$.transformMat4(Ei,Ei,ri),n.$.transformMat4(nr,nr,ri),jr.push(new _g(Ei[0],Ei[1],Ei[2])),Ir.push(new _g(nr[0],nr[1],nr[2]))}ii.push(jr),Ki.push(Ir)}return[ii,Ki]}(be,ze,ke,je,it,ut,vt,dt,At,jt,Ct):vt?function(qt,Tt,Ot,Kt,Dt,ri,Xt,Vt,zi){let Ri=[],gi=[],ii=[0,0,0,1];for(let Ki of qt){let Oi=[],Ei=[];for(let nr of Ki){let or=nr.x+Kt.x,sr=nr.y+Kt.y,yr=EV(or,sr,Tt,Ot,ri,Xt,Vt,zi);ii[0]=or,ii[1]=sr,ii[2]=yr.base,ii[3]=1,n.aB.transformMat4(ii,ii,Dt),ii[3]=Math.max(ii[3],1e-5);let jr=new _g(ii[0]/ii[3],ii[1]/ii[3],ii[2]/ii[3]);ii[0]=or,ii[1]=sr,ii[2]=yr.top,ii[3]=1,n.aB.transformMat4(ii,ii,Dt),ii[3]=Math.max(ii[3],1e-5);let Ir=new _g(ii[0]/ii[3],ii[1]/ii[3],ii[2]/ii[3]);Oi.push(jr),Ei.push(Ir)}Ri.push(Oi),gi.push(Ei)}return[Ri,gi]}(ze,ke,je,it,ut,vt,dt,At,jt):function(qt,Tt,Ot,Kt,Dt){let ri=[],Xt=[],Vt=Dt[8]*Tt,zi=Dt[9]*Tt,Ri=Dt[10]*Tt,gi=Dt[11]*Tt,ii=Dt[8]*Ot,Ki=Dt[9]*Ot,Oi=Dt[10]*Ot,Ei=Dt[11]*Ot;for(let nr of qt){let or=[],sr=[];for(let yr of nr){let jr=yr.x+Kt.x,Ir=yr.y+Kt.y,En=Dt[0]*jr+Dt[4]*Ir+Dt[12],In=Dt[1]*jr+Dt[5]*Ir+Dt[13],ar=Dt[2]*jr+Dt[6]*Ir+Dt[14],dn=Dt[3]*jr+Dt[7]*Ir+Dt[15],fn=En+Vt,Un=In+zi,Ms=ar+Ri,Bs=Math.max(dn+gi,1e-5),Ts=En+ii,us=In+Ki,oo=ar+Oi,Gs=Math.max(dn+Ei,1e-5);or.push(new _g(fn/Bs,Un/Bs,Ms/Bs)),sr.push(new _g(Ts/Gs,us/Gs,oo/Gs))}ri.push(or),Xt.push(sr)}return[ri,Xt]}(ze,ke,je,it,ut)}(y,d,F,L,D,v,K,N,q,y.center.lat,a.tileID.canonical),ge=a.queryGeometry;return function(be,ze,ke){let je=1/0;ej(ke,ze)&&(je=SV(ke,ze[0]));for(let it=0;it<ze.length;it++){let ut=ze[it],vt=be[it];for(let dt=0;dt<ut.length-1;dt++){let At=ut[dt],jt=[At,ut[dt+1],vt[dt+1],vt[dt],At];gR(ke,jt)&&(je=Math.min(je,SV(ke,jt)))}}return je!==1/0&&je}(ae,_e,ge.isPointQuery()?ge.screenBounds:ge.screenGeometry)}},line:class extends sl{constructor(a,o,l,d){let m=O6();super(a,m,o,l,d),m.layout&&(this.layout=new vo(m.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){let o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof Qp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,o){super.recalculate(a,o),this.paint._values["line-floorwidth"]=(()=>{if(ub)return ub;let l=O6();return ub=new Coe(l.paint.properties["line-width"].specification),ub.useIntegerZoom=!0,ub})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new zM(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,o,l){let d=LV(this);return{config:new fg(this,{zoom:o,lut:l}),defines:d,overrideFog:!1}}queryRadius(a){let o=a,l=F6($v("line-width",this,o),$v("line-gap-width",this,o)),d=$v("line-offset",this,o);return l/2+Math.abs(d)+yM(this.paint.get("line-translate"))}queryIntersectsFeature(a,o,l,d,m,y){if(a.queryGeometry.isAboveHorizon)return!1;let v=nj(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,a.pixelToTileUnitsFactor),S=a.pixelToTileUnitsFactor/2*F6(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),T=this.paint.get("line-offset").evaluate(o,l);return T&&(d=function(D,L){let F=[],N=new ai(0,0);for(let H=0;H<D.length;H++){let q=D[H],Q=[];for(let K=0;K<q.length;K++){let ae=q[K],_e=q[K+1],ge=K===0?N:ae.sub(q[K-1])._unit()._perp(),be=K===q.length-1?N:_e.sub(ae)._unit()._perp(),ze=ge._add(be)._unit();ze._mult(1/(ze.x*be.x+ze.y*be.y)),Q.push(ze._mult(L)._add(ae))}F.push(Q)}return F}(d,T*a.pixelToTileUnitsFactor)),function(D,L,F){for(let N=0;N<L.length;N++){let H=L[N];if(D.length>=3){for(let q=0;q<H.length;q++)if(cf(D,H[q]))return!0}if(Jre(D,H,F))return!0}return!1}(v,d,S)}isTileClipped(){return!0}isDraped(a){let o=this.layout.get("line-z-offset");return o.isConstant()&&!o.constantOr(0)}},symbol:eT,background:class extends sl{constructor(a,o,l,d){super(a,{layout:N6||(N6=new Dn({visibility:new Ht(mt.layout_background.visibility)})),paint:B6||(B6=new Dn({"background-color":new Ht(mt.paint_background["background-color"]),"background-pattern":new Ht(mt.paint_background["background-pattern"]),"background-opacity":new Ht(mt.paint_background["background-opacity"]),"background-emissive-strength":new Ht(mt.paint_background["background-emissive-strength"])}))},o,l,d)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,o,l){return{overrideFog:!1}}},raster:H6,"raster-particle":Z6,sky:class extends sl{constructor(a,o,l,d){super(a,{layout:Y6||(Y6=new Dn({visibility:new Ht(mt.layout_sky.visibility)})),paint:X6||(X6=new Dn({"sky-type":new Ht(mt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ht(mt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ht(mt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ht(mt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ht(mt.paint_sky["sky-gradient-radius"]),"sky-gradient":new ta(mt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ht(mt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ht(mt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ht(mt.paint_sky["sky-opacity"])}))},o,l,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=U1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let o=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(a,o){if(this.paint.get("sky-type")==="atmosphere"){let d=this.paint.get("sky-atmosphere-sun"),m=!d,y=a.style.light,v=y.properties.get("position");return m&&y.properties.get("anchor")==="viewport"&&Ds("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?aO(v.azimuthal,90-v.polar,o):aO(d[0],90-d[1],o)}let l=this.paint.get("sky-gradient-center");return aO(l[0],90-l[1],o)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends sl{constructor(a,o,l,d){super(a,{paint:$6||($6=new Dn({}))},o,null)}},model:class extends sl{constructor(a,o,l,d){super(a,{layout:oG||(oG=new Dn({visibility:new Ht(mt.layout_model.visibility),"model-id":new Mi(mt.layout_model["model-id"])})),paint:aG||(aG=new Dn({"model-opacity":new Ht(mt.paint_model["model-opacity"]),"model-rotation":new Mi(mt.paint_model["model-rotation"]),"model-scale":new Mi(mt.paint_model["model-scale"]),"model-translation":new Mi(mt.paint_model["model-translation"]),"model-color":new Mi(mt.paint_model["model-color"]),"model-color-mix-intensity":new Mi(mt.paint_model["model-color-mix-intensity"]),"model-type":new Ht(mt.paint_model["model-type"]),"model-cast-shadows":new Ht(mt.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ht(mt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ht(mt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Mi(mt.paint_model["model-emissive-strength"]),"model-roughness":new Mi(mt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Mi(mt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ht(mt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ht(mt.paint_model["model-front-cutoff"])}))},o,l,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new cO(a)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof hT?ti-1:0}queryIntersectsFeature(a,o,l,d,m,y){if(!this.modelManager)return!1;let v=this.modelManager,S=a.tile.getBucket(this);if(!(S&&S instanceof cO))return!1;let T=S;for(let D in T.instancesPerModel){let L=T.instancesPerModel[D],F=o.id!==void 0?o.id:o.properties&&o.properties.hasOwnProperty("id")?o.properties.id:void 0;if(L.idToFeaturesIndex.hasOwnProperty(F)){let N=L.features[L.idToFeaturesIndex[F]],H=v.getModel(D,this.scope);if(!H)return!1;let q=n.ae.create(),Q=new Kr(0,0),K=T.canonical,ae=Number.MAX_VALUE;for(let _e=0;_e<N.instancedDataCount;++_e){let ge=16*(N.instancedDataOffset+_e),be=L.instancedDataArray.float32,ze=[be[ge+4],be[ge+5],be[ge+6]];EG(K,Q,be[ge],0|be[ge+1]),lG(q,H,y,Q,N.rotation,N.scale,ze,!1,!1,!1),y.projection.name==="globe"&&(q=lO(q,y));let ke=n.ae.multiply([],y.projMatrix,q),je=a.queryGeometry,it=iG(je.isPointQuery()?je.screenBounds:je.screenGeometry,y,ke,H.aabb);it!=null&&(ae=Math.min(it,ae))}return ae!==Number.MAX_VALUE&&ae}}return!1}_handleOverridablePaintPropertyUpdate(a,o,l){return!(!this.layout||o.isDataDriven()||l.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){let o=this._transitionablePaint._values[a];return o!=null&&o.value!=null&&o.value.expression!=null&&o.value.expression instanceof Oe}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(a,o,l,d){let m=a.tile,y=m.getBucket(this),v=null,S=Number.MAX_VALUE;if(!(y&&y instanceof hT))return{queryFeature:v,intersectionZ:S};let T=y.getNodesInfo()[o];if(T.hiddenByReplacement||!T.node.meshes||!l.filter(new er(m.tileID.overscaledZ),T.feature,m.tileID.canonical))return{queryFeature:v,intersectionZ:S};let D=T.node,L=d.calculatePosMatrix(m.tileID.toUnwrapped(),d.worldSize),F=T.evaluatedScale,N=0;d.elevation&&D.elevation&&(N=D.elevation*d.elevation.exaggeration()),n.ae.translate(L,L,[(D.anchor?D.anchor[0]:0)*(F[0]-1),(D.anchor?D.anchor[1]:0)*(F[1]-1),N]),n.ae.scale(L,L,F),n.ae.multiply(L,L,D.matrix);let H=a.queryGeometry,q=H.isPointQuery()?H.screenBounds:H.screenGeometry,Q=function(ae){let _e=n.ae.multiply([],L,ae.matrix),ge=n.ae.multiply(_e,d.expandedFarZProjMatrix,_e);for(let be=0;be<ae.meshes.length;++be){let ze=ae.meshes[be];if(be===ae.lightMeshIndex)continue;let ke=iG(q,d,ge,ze.aabb);ke!=null&&(S=Math.min(ke,S))}if(ae.children)for(let be of ae.children)Q(be)};if(Q(D),S===Number.MAX_VALUE)return{queryFeature:v,intersectionZ:S};let K=new Kr(0,0);return EG(m.tileID.canonical,K,T.node.anchor[0],T.node.anchor[1]),v={type:"Feature",geometry:{type:"Point",coordinates:[K.lng,K.lat]},properties:T.feature.properties,id:T.feature.id,state:{},layer:this.serialize()},{queryFeature:v,intersectionZ:S}}},clip:class extends sl{constructor(a,o,l,d){super(a,{layout:Nj||(Nj=new Dn({"clip-layer-types":new Ht(mt.layout_clip["clip-layer-types"]),"clip-layer-scope":new Ht(mt.layout_clip["clip-layer-scope"])})),paint:Bj||(Bj=new Dn({}))},o,l,d)}recalculate(a,o){super.recalculate(a,o)}createBucket(a){return new Uj(a)}isTileClipped(){return!0}is3D(){return!0}}};tt(I6,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let MG=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class _O{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[l,d]=new Uint8Array(o,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");let m=d>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);let y=MG[15&d];if(!y)throw new Error("Unrecognized array type.");let[v]=new Uint16Array(o,2,1),[S]=new Uint32Array(o,4,1);return new _O(S,v,y,o)}constructor(o,l=64,d=Float64Array,m){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=d,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;let y=MG.indexOf(this.ArrayType),v=2*o*this.ArrayType.BYTES_PER_ELEMENT,S=o*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-S%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${d}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+S+T,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+v+S+T),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+S+T,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=o)}add(o,l){let d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=o,this.coords[this._pos++]=l,d}finish(){let o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return xO(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,l,d,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:y,coords:v,nodeSize:S}=this,T=[0,y.length-1,0],D=[];for(;T.length;){let L=T.pop()||0,F=T.pop()||0,N=T.pop()||0;if(F-N<=S){for(let K=N;K<=F;K++){let ae=v[2*K],_e=v[2*K+1];ae>=o&&ae<=d&&_e>=l&&_e<=m&&D.push(y[K])}continue}let H=N+F>>1,q=v[2*H],Q=v[2*H+1];q>=o&&q<=d&&Q>=l&&Q<=m&&D.push(y[H]),(L===0?o<=q:l<=Q)&&(T.push(N),T.push(H-1),T.push(1-L)),(L===0?d>=q:m>=Q)&&(T.push(H+1),T.push(F),T.push(1-L))}return D}within(o,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:m,coords:y,nodeSize:v}=this,S=[0,m.length-1,0],T=[],D=d*d;for(;S.length;){let L=S.pop()||0,F=S.pop()||0,N=S.pop()||0;if(F-N<=v){for(let K=N;K<=F;K++)AG(y[2*K],y[2*K+1],o,l)<=D&&T.push(m[K]);continue}let H=N+F>>1,q=y[2*H],Q=y[2*H+1];AG(q,Q,o,l)<=D&&T.push(m[H]),(L===0?o-d<=q:l-d<=Q)&&(S.push(N),S.push(H-1),S.push(1-L)),(L===0?o+d>=q:l+d>=Q)&&(S.push(H+1),S.push(F),S.push(1-L))}return T}}function xO(a,o,l,d,m,y){if(m-d<=l)return;let v=d+m>>1;TG(a,o,v,d,m,y),xO(a,o,l,d,v-1,1-y),xO(a,o,l,v+1,m,1-y)}function TG(a,o,l,d,m,y){for(;m>d;){if(m-d>600){let D=m-d+1,L=l-d+1,F=Math.log(D),N=.5*Math.exp(2*F/3),H=.5*Math.sqrt(F*N*(D-N)/D)*(L-D/2<0?-1:1);TG(a,o,l,Math.max(d,Math.floor(l-L*N/D+H)),Math.min(m,Math.floor(l+(D-L)*N/D+H)),y)}let v=o[2*l+y],S=d,T=m;for(yb(a,o,d,l),o[2*m+y]>v&&yb(a,o,d,m);S<T;){for(yb(a,o,S,T),S++,T--;o[2*S+y]<v;)S++;for(;o[2*T+y]>v;)T--}o[2*d+y]===v?yb(a,o,d,T):(T++,yb(a,o,T,m)),T<=l&&(d=T+1),l<=T&&(m=T-1)}}function yb(a,o,l,d){bO(a,l,d),bO(o,2*l,2*d),bO(o,2*l+1,2*d+1)}function bO(a,o,l){let d=a[o];a[o]=a[l],a[l]=d}function AG(a,o,l,d){let m=a-l,y=o-d;return m*m+y*y}n.A=Iv,n.B=sg,n.C=en,n.D=rg,n.E=yd,n.F=Fa,n.H=lu,n.I=eoe,n.J=W,n.K=z,n.L=function(a){let o=a.value,l=[];if(!o)return l;let d=ah(o);return d!=="string"?(l=l.concat([new sT(a.key,o,`string expected, "${d}" found`)]),l):(rG(o,!0)||(l=l.concat([new sT(a.key,o,`invalid url "${o}"`)])),l)},n.M=class{constructor(a,o,l,d){this.id=a,this.position=o!=null?new Kr(o[0],o[1]):new Kr(0,0),this.orientation=l??[0,0,0],this.nodes=d,this.uploaded=!1,this.aabb=new Jn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(a,o){if(n.ae.multiply(a.matrix,o,a.matrix),a.meshes)for(let l of a.meshes){let d=Jn.applyTransformFast(l.aabb,a.matrix);this.aabb.encapsulate(d)}if(a.children)for(let l of a.children)this._applyTransformations(l,a.matrix)}computeBoundsAndApplyParent(){let a=n.ae.identity([]);for(let o of this.nodes)this._applyTransformations(o,a)}computeModelMatrix(a,o,l,d,m,y,v=!1){lG(this.matrix,this,a.transform,this.position,o,l,d,m,y,v)}upload(a){if(!this.uploaded){for(let o of this.nodes)uO(o,a);for(let o of this.nodes)oT(o);this.uploaded=!0}}destroy(){for(let a of this.nodes)hO(a)}},n.N=mt,n.O=Fo,n.P=ai,n.Q=Io,n.R=Nm,n.S=eR,n.T=Dc,n.U=Dn,n.V=sT,n.W=Ht,n.X=class{constructor(a){this.specification=a}possiblyEvaluate(a,o){return Np(a.expression.evaluate(o))}interpolate(a,o,l){return{x:Gi(a.x,o.x,l),y:Gi(a.y,o.y,l),z:Gi(a.z,o.z,l),azimuthal:Gi(a.azimuthal,o.azimuthal,l),polar:Gi(a.polar,o.polar,l)}}},n.Y=er,n.Z=Oe,n._=ia,n.a=Cl,n.a$=bR,n.a0=Hx,n.a1=vo,n.a2=Pd,n.a3=Gi,n.a4=ti,n.a5=l1,n.a6=class{constructor(a){this.specification=a}possiblyEvaluate(a,o){return function([l,d]){let m=Np([1,l,d]);return{x:m.x,y:m.y,z:m.z}}(a.expression.evaluate(o))}interpolate(a,o,l){return{x:Gi(a.x,o.x,l),y:Gi(a.y,o.y,l),z:Gi(a.z,o.z,l)}}},n.a7=L1,n.a8=pM,n.a9=Ad,n.aA=function(a,o,l){a[4*o+0]=l[0],a[4*o+1]=l[1],a[4*o+2]=l[2],a[4*o+3]=l[3]},n.aC=function(a,o){let{x:l,y:d}=a.point,m=vj(l,d,a.worldSize/a._pixelsPerMercatorPixel,0,0);return n.ae.multiply(m,m,MR(mh(o)))},n.aE=t0,n.aF=Ql,n.aG=NM,n.aH=function(a,o,l,d,m){let y=5*o+2;a.float32[y+0]=l,a.float32[y+1]=d,a.float32[y+2]=m},n.aI=$M,n.aJ=Kr,n.aK=_6,n.aL=X5,n.aM=wR,n.aN=K6,n.aO=gg,n.aP=mj,n.aQ=Ws,n.aR=function(a,o,l,d,m,y,v,S,T){if(T.name==="globe")return mj(a,o,new gg(l,d,m),!1);let D=xg({z:l,x:d,y:m},T);return new Jn([(y+D.x/D.scale)*o,o*(D.y/D.scale),v],[(y+D.x2/D.scale)*o,o*(D.y2/D.scale),S])},n.aS=function(a,o,l){let d=0;for(let m=0;m<2;++m)a[m]>0&&(d+=(a[m]-0)*(a[m]-0)),o[m]<0&&(d+=(0-o[m])*(0-o[m]));return d},n.aT=Rs,n.aU=xR,n.aV=q5,n.aW=function(a){let o=n.ae.identity(new Float64Array(16));n.ae.multiply(o,a.pixelMatrix,a.globeMatrix);let l=[0,Ac,0],d=[0,Cc,0];return n.$.transformMat4(l,l,o),n.$.transformMat4(d,d,o),[l[0]>0&&l[0]<=a.width&&l[1]>0&&l[1]<=a.height&&!AR(a,new Kr(a.center.lat,90)),d[0]>0&&d[0]<=a.width&&d[1]>0&&d[1]<=a.height&&!AR(a,new Kr(a.center.lat,-90))]},n.aX=function(a,o){let{scale:l}=a.tileTransform,d=l*ti/(a.tileSize*Math.pow(2,o.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return n.aD.scale(new Float32Array(4),o.inverseAdjustmentMatrix,[d,d])},n.aY=rT,n.aZ=Q6,n.a_=function(a){let o=Q6(a,!0);return n.aD.invert([],[o[0],o[1],o[4],o[5]])},n.aa=H5,n.ab=ka,n.ac=Rr,n.ad=function(a,o,l){let d=Math.sqrt(a*a+o*o+l*l),m=d>0?Math.acos(l/d)*zp:0,y=a!==0||o!==0?Math.atan2(-o,-a)*zp+90:0;return y<0&&(y+=360),[d,y,m]},n.af=a0,n.ag=mu,n.ah=QR,n.ai=function(a,o){let l={};for(let d=0;d<o.length;d++){let m=o[d];m in a&&(l[m]=a[m])}return l},n.aj=lf,n.ak=ph,n.al=fh,n.am=A5,n.an=function(a){hv++,hv>Qx&&(a.getActor().send("enforceCacheSizeLimit",Zx),hv=0)},n.ao=r1,n.ap=class{constructor(a){this.entries={},this.scheduler=a}request(a,o,l,d){let m=this.entries[a]=this.entries[a]||{callbacks:[]};if(m.result){let[y,v]=m.result;return this.scheduler?this.scheduler.add(()=>{d(y,v)},o):d(y,v),()=>{}}return m.callbacks.push(d),m.cancel||(m.cancel=l((y,v)=>{m.result=[y,v];for(let S of m.callbacks)this.scheduler?this.scheduler.add(()=>{S(y,v)},o):S(y,v);setTimeout(()=>delete this.entries[a],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(y=>y!==d),m.callbacks.length||(m.cancel(),delete this.entries[a]))}}},n.aq=function(a,o,l){let d=JSON.stringify(a.request);return a.data&&(this.deduped.entries[d]={result:[null,a.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},m=>{let y=pd(a.request,(v,S,T,D)=>{v?m(v):S&&m(null,{vectorTile:l?void 0:new LR(new $1(S)),rawData:S,cacheControl:T,expires:D})});return()=>{y.cancel(),m()}},o)},n.ar=nR,n.as=class extends Td{constructor(a){super(a),this.current=Bre}set(a,o,l){if(this.fetchUniformLocation(a,o)){for(let d=0;d<9;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}}},n.at=sR,n.au=xr,n.av=Fp,n.ax=oh,n.ay=Ba,n.az=_o,n.b=ss,n.b$=Yre,n.b0=function(a){let{x:o,y:l}=a.point,{lng:d,lat:m}=a._center;return vj(o,l,a.worldSize,d,m)},n.b1=xa,n.b2=Yv,n.b3=lR,n.b4=function(a){let o=Math.round((a+45+360)%360/90)%4;return Am[o]},n.b5=45,n.b6=hR,n.b7=fM,n.b8=Jn,n.b9=Np,n.bA=JM,n.bB=Aj,n.bC=function(a,o){return[Math.pow(a[0],2.2)*o,Math.pow(a[1],2.2)*o,Math.pow(a[2],2.2)*o]},n.bD=PV,n.bF=yj,n.bG=vE,n.bH=yE,n.bI=256,n.bJ=function(a,o){let l=[0,0,0],d=B1(mh(o.canonical));return n.$.transformMat4(l,l,d),n.$.transformMat4(l,l,a),l},n.bK=a=>({u_camera_to_center_distance:new ka(a),u_extrude_scale:new oR(a),u_device_pixel_ratio:new ka(a),u_matrix:new L1(a),u_inv_rot_matrix:new L1(a),u_merc_center:new Ad(a),u_tile_id:new nR(a),u_zoom_transition:new ka(a),u_up_dir:new nR(a),u_emissive_strength:new ka(a)}),n.bL=a=>({u_matrix:new L1(a),u_pixels_to_tile_units:new oR(a),u_device_pixel_ratio:new ka(a),u_units_to_pixels:new Ad(a),u_dash_image:new pM(a),u_gradient_image:new pM(a),u_image_height:new ka(a),u_texsize:new Ad(a),u_tile_units_to_pixels:new ka(a),u_alpha_discard_threshold:new ka(a),u_trim_offset:new Ad(a),u_trim_fade_range:new Ad(a),u_trim_color:new sR(a),u_emissive_strength:new ka(a)}),n.bM=a=>({u_matrix:new L1(a),u_texsize:new Ad(a),u_pixels_to_tile_units:new oR(a),u_device_pixel_ratio:new ka(a),u_image:new pM(a),u_units_to_pixels:new Ad(a),u_tile_units_to_pixels:new ka(a),u_alpha_discard_threshold:new ka(a),u_trim_offset:new Ad(a)}),n.bN=YP,n.bO=lse,n.bP=Bo,n.bQ=Mse,n.bR=u6,n.bS=VR,n.bT=bj,n.bU=(a,o,l,d,m,y)=>{let v=a.transform,S=v.projection.name==="globe",T;if(y.paint.get("circle-pitch-alignment")==="map")if(S){let L=yj(v.zoom,o.canonical)*v._pixelsPerMercatorPixel;T=Float32Array.from([L,0,0,L])}else T=v.calculatePixelsToTileUnitsMatrix(l);else T=new Float32Array([v.pixelsToGLUnits[0],0,0,v.pixelsToGLUnits[1]]);let D={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(v.projection),u_matrix:a.translatePosMatrix(o.projMatrix,l,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Oo.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:ane,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:y.paint.get("circle-emissive-strength")};if(S){D.u_inv_rot_matrix=d,D.u_merc_center=m,D.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],D.u_zoom_transition=Pd(v.zoom);let L=m[0]*ti,F=m[1]*ti;D.u_up_dir=v.projection.upVector(new gg(0,0,0),L,F)}return D},n.bV=LV,n.bW=(a,o,l,d,m,y)=>{let v=a.transform;return{u_matrix:OV(a,o,l,d),u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:v.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:m,u_image:0,u_tile_units_to_pixels:RV(o,v),u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:y}},n.bX=(a,o,l,d,m,y,v)=>{let S=a.transform,T=S.calculatePixelsToTileUnitsMatrix(o);return{u_matrix:OV(a,o,l,d),u_pixels_to_tile_units:T,u_device_pixel_ratio:y,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:m,u_texsize:zV(l)&&o.lineAtlasTexture?o.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:RV(o,a.transform),u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toRenderColor(l.lut).toArray01(),u_emissive_strength:l.paint.get("line-emissive-strength")}},n.bY=dd,n.bZ=U1,n.b_=_V,n.ba=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},n.bb=rv,n.bc=function(a,o,l){let d=Pd(l.zoom),m=a.style.map._antialias,y=o.options.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return d===0&&!m&&!y},n.bd=function(a){let o=a.pixelsPerMeter,l=o/Ba(1,a.center.lat),d=n.ae.identity(new Float64Array(16));return n.ae.translate(d,d,[a.point.x,a.point.y,0]),n.ae.scale(d,d,[l,l,o]),Float32Array.from(d)},n.be=xM,n.bf=function(a){let o=Rs-5;a=xr(a,-o,o)/o*90;let l=Math.pow(Math.abs(Math.sin(Rr(a))),3);return Math.round(l*(cR.length-1))},n.bg=function(a,o,l,d){let m=o.getNorth(),y=o.getSouth(),v=o.getWest(),S=o.getEast(),T=1<<a.z,D=S-v,L=m-y,F=D/Hv,N=-L/cR[l],H=[0,F,0,N,0,0,m,v,0];if(a.z>0){let q=180/d;n.bE.multiply(H,H,[q/D+1,0,0,0,q/L+1,0,-.5*q/F,.5*q/N,1])}return H[2]=T,H[5]=a.x,H[8]=a.y,H},n.bh=B1,n.bi=mh,n.bj=function(a,o,l){let d=n.ae.identity(new Float64Array(16)),m=(o/(1<<a)-.5)*Math.PI*2;return n.ae.rotateY(d,l.globeMatrix,m),Float32Array.from(d)},n.bk=Xx,n.bl=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},n.bm=H6,n.bn=Z6,n.bo=G6,n.bp=function(a,o){let l=document.createElement("video");l.muted=!0,l.onloadstart=function(){o(null,l)};for(let d=0;d<a.length;d++){let m=document.createElement("source");fP(a[d])||(l.crossOrigin="Anonymous"),m.src=a[d],l.appendChild(m)}return{cancel:()=>{}}},n.bq=ZM,n.br=ov,n.bs=class{isDataAvailableAtPoint(a){let o=this._source();if(this.isUsingMockSource()||!o||a.y<0||a.y>1)return!1;let l=o.getSource().maxzoom,d=1<<l,m=Math.floor(a.x),y=Math.floor((a.x-m)*d),v=Math.floor(a.y*d),S=this.findDEMTileFor(new Ws(l,m,l,y,v));return!(!S||!S.dem)}getAtPointOrZero(a,o=0){return this.getAtPoint(a,o)||0}getAtPoint(a,o,l=!0){if(this.isUsingMockSource())return null;o==null&&(o=null);let d=this._source();if(!d||a.y<0||a.y>1)return o;let m=d.getSource().maxzoom,y=1<<m,v=Math.floor(a.x),S=a.x-v,T=new Ws(m,v,m,Math.floor(S*y),Math.floor(a.y*y)),D=this.findDEMTileFor(T);if(!D||!D.dem)return o;let L=D.dem,F=1<<D.tileID.canonical.z,N=(S*F-D.tileID.canonical.x)*L.dim,H=(a.y*F-D.tileID.canonical.y)*L.dim,q=Math.floor(N),Q=Math.floor(H);return(l?this.exaggeration():1)*Gi(Gi(L.get(q,Q),L.get(q,Q+1),H-Q),Gi(L.get(q+1,Q),L.get(q+1,Q+1),H-Q),N-q)}getAtTileOffset(a,o,l){let d=1<<a.canonical.z;return this.getAtPointOrZero(new ia(a.wrap+(a.canonical.x+o/ti)/d,(a.canonical.y+l/ti)/d))}getAtTileOffsetFunc(a,o,l,d){return m=>{let y=this.getAtTileOffset(a,m.x,m.y),v=d.upVector(a.canonical,m.x,m.y),S=d.upVectorScale(a.canonical,o,l).metersToTile;return n.$.scale(v,v,y*S),v}}getForTilePoints(a,o,l,d){if(this.isUsingMockSource())return!1;let m=Kv.create(this,a,d);return!!m&&(o.forEach(y=>{y[2]=this.exaggeration()*m.getElevationAt(y[0],y[1],l)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;let o=this.findDEMTileFor(a);if(!o||!o.dem)return null;let l=o.dem.tree,d=o.tileID,m=1<<a.canonical.z-d.canonical.z,y=a.canonical.x/m-d.canonical.x,v=a.canonical.y/m-d.canonical.y,S=0;for(let T=0;T<a.canonical.z-d.canonical.z&&!l.leaves[S];T++){y*=2,v*=2;let D=2*Math.floor(v)+Math.floor(y);S=l.childOffsets[S]+D,y%=1,v%=1}return{min:this.exaggeration()*l.minimums[S],max:this.exaggeration()*l.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,o,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let a=this.visibleDemTiles;if(a.length===0)return null;let o=!1,l=Number.MAX_VALUE,d=Number.MIN_VALUE;for(let m of a){let y=this.getMinMaxForTile(m.tileID);y&&(l=Math.min(l,y.min),d=Math.max(d,y.max),o=!0)}return o?{min:l,max:d}:null}},n.bt=k1,n.bu=_M,n.bv=uu,n.bw=so,n.bx=bg,n.by=dO,n.bz=aT,n.c=_G,n.c$=function(a,o,l,d){return a.type==="custom"?new Ioe(a,o):new tae[a.type](a,o,l,d)},n.c0=LM,n.c1=df,n.c2=450,n.c3=7,n.c4=Doe,n.c5=P6,n.c6=256,n.c7=pj,n.c8=MR,n.c9=hn,n.cA=rj,n.cB=function(a,o,l=0){return n.$.fromValues(((o.x-l)*a.scale-a.x)*ti,(o.y*a.scale-a.y)*ti,$5(o.z,o.y))},n.cC=function(a){let o=1/0,l=1/0,d=-1/0,m=-1/0;for(let y of a)o=Math.min(o,y.x),l=Math.min(l,y.y),d=Math.max(d,y.x),m=Math.max(m,y.y);return{min:new ai(o,l),max:new ai(d,m)}},n.cD=cf,n.cE=K5,n.cF=Na,n.cG=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.cH=r6,n.cI=gR,n.cJ=Yj,n.cK=Kj,n.cL=Jj,n.cM=qR,n.cN=_O,n.cO=function(a){return a({pluginStatus:xn,pluginURL:Ur}),br.on("pluginStateChange",a),a},n.cP=r0,n.cQ=HR,n.cR=Jx,n.cS=yn,n.cT=x,n.cU=$x,n.cV=mv,n.cW=ba,n.cX=function(a){let o=a.indexOf(oM);return o>=0?a.slice(0,o):a},n.cY=function(a){return a.indexOf(oM)>=0},n.cZ=function(a){let o=a.indexOf(oM);return o>=0?a.slice(o+1):""},n.c_=function(a){let o=[],l=a.id;return l===void 0&&o.push({message:`layers.${l}: missing required property "id"`}),a.render===void 0&&o.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&o.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),o},n.ca=rf,n.cb=pg,n.cc=1,n.cd=nb,n.ce=0,n.cf=QP,n.cg=function(a,o,l,d,m){return xr((a-o)/(l-o)*(m-d)+d,d,m)},n.ch=rM,n.ci=yg,n.cj=class{constructor(a,o,l,d){this.context=a,this.format=d,this.size=l,this.texture=a.gl.createTexture();let[m,y,v]=this.size,{gl:S}=a;S.bindTexture(S.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1);let T=this.format,D=S.UNSIGNED_BYTE;this.format===S.DEPTH_COMPONENT&&(T=S.DEPTH_COMPONENT16,D=S.UNSIGNED_SHORT),this.format===S.R8&&(d=S.RED),this.format===S.R32F&&(D=S.FLOAT,d=S.RED),S.texImage3D(S.TEXTURE_3D,0,T,m,y,v,0,d,D,o.data)}bind(a,o){let{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_3D,this.texture),a!==this.minFilter&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MAG_FILTER,a),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MIN_FILTER,a),this.minFilter=a),o!==this.wrapS&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_S,o),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_T,o),this.wrapS=o)}destroy(){let{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},n.ck=lO,n.cl=[1,1,1],n.cm=Kv,n.cn=c0,n.co=sf,n.cp=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new ai(1/0,1/0),max:new ai(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,o=!1){let l=$j(new ai(0,0),new ai(ti,ti),a),d=[];if(o&&!zR(l,this._globalClipBounds))return d;for(let m of this._activeRegions){if(m.hiddenByOverlap||!zR(l,m))continue;let y=kne(m.min,m.max,a);d.push({min:y.min,max:y.max,sourceId:this._sourceIds[m.priority],footprint:m.footprint,footprintTileId:m.tileId,order:m.order,clipMask:m.clipMask,clipScope:m.clipScope})}return d}setSources(a){this._setSources(a.map(o=>({getSourceId:()=>o.cache.id,getFootprints:()=>{let l=[];for(let d of o.cache.getVisibleCoordinates()){let m=o.cache.getTile(d).buckets[o.layer];m&&m.updateFootprints(d.toUnwrapped(),l)}return l},getOrder:()=>o.order,getClipMask:()=>o.clipMask,getClipScope:()=>o.clipScope})))}_addSource(a){let o=a.getFootprints();if(o.length===0)return;let l=a.getOrder(),d=a.getClipMask(),m=a.getClipScope();for(let y of o){if(!y.footprint)continue;let v=$j(y.footprint.min,y.footprint.max,y.id);this._activeRegions.push({min:v.min,max:v.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:y.id,footprint:y.footprint,order:l,clipMask:d,clipScope:m})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((o,l)=>o.priority-l.priority||PM(o.min,l.min)||PM(o.max,l.max)||o.order-l.order||o.clipMask-l.clipMask||function(d,m){let y=(v,S)=>v+S;return d.length-m.length||d.reduce(y,"").localeCompare(m.reduce(y,""))}(o.clipScope,l.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let o=0;for(;!a&&o!==this._activeRegions.length;){let l=this._activeRegions[o],d=this._prevRegions[o];a=l.priority!==d.priority||!Xj(l,d)||l.order!==d.order||l.clipMask!==d.clipMask||!Lp(l.clipScope,d.clipScope),++o}}if(a){++this._updateTime;for(let l of this._activeRegions)l.order!==IM&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,l.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,l.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,l.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,l.max.y));let o=l=>{let d=this._activeRegions;if(l>=d.length)return l;let m=d[l].priority;for(;l<d.length&&d[l].priority===m;)++l;return l};if(this._sourceIds.length>1){let l=0,d=o(l);for(;l!==d;){let m=l,y=l;for(;m!==d;){let v=this._activeRegions[m];v.hiddenByOverlap=!1;for(let S=0;S<y;S++){let T=this._activeRegions[S];if(!T.hiddenByOverlap&&v.order===IM&&zR(v,T)&&(v.hiddenByOverlap=Qj(v.footprint,v.tileId,T.footprint,T.tileId),v.hiddenByOverlap))break}++m}l=d,d=o(l)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let o=a.length-1;o>=0;o--)this._addSource(a[o]);this._computeReplacement()}},n.cq=Md,n.cr=KM,n.cs=P1,n.ct=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let a of this._poleSegments)a.destroy();for(let a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,o){let l=new uu,d=new so,m=[],y=a+1+2,v=o[0]+1,S=o[0]+1+(1+o.length),T=(D,L,F)=>{let N=D===y-1?D-2:D===0?D:D-1;return N+=F?24575:0,[N,L]};for(let D=0;D<y;++D)l.emplaceBack(...T(D,0,!0));for(let D=0;D<v;++D)for(let L=0;L<y;++L)l.emplaceBack(...T(L,D,(L===0||L===y-1)&&!0));for(let D=0;D<o.length;++D){let L=o[D];for(let F=0;F<y;++F)l.emplaceBack(...T(F,L,!0))}for(let D=0;D<o.length;++D){let L=d.length,F=o[D]+1+2,N=new so;for(let Q=0;Q<F-1;Q++){let K=Q===F-2,ae=K?y*(S-o.length+D-Q):y;for(let _e=0;_e<y-1;_e++){let ge=Q*y+_e;Q===0||K||_e===0||_e===y-2?(N.emplaceBack(ge+1,ge,ge+ae),N.emplaceBack(ge+ae,ge+ae+1,ge+1)):(d.emplaceBack(ge+1,ge,ge+ae),d.emplaceBack(ge+ae,ge+ae+1,ge+1))}}let H=ss.simpleSegment(0,L,l.length,d.length-L);for(let Q=0;Q<N.uint16.length;Q+=3)d.emplaceBack(N.uint16[Q],N.uint16[Q+1],N.uint16[Q+2]);let q=ss.simpleSegment(0,L,l.length,d.length-L);m.push({withoutSkirts:H,withSkirts:q})}return{vertices:l,indices:d,segments:m}}_createGrid(a){let o=this._fillGridMeshWithLods(Hv,cR);this._gridSegments=o.segments,this._gridBuffer=a.createVertexBuffer(o.vertices,k1.members),this._gridIndexBuffer=a.createIndexBuffer(o.indices,!0)}_createPoles(a){let o=new so;for(let v=0;v<=Hv;v++)o.emplaceBack(0,v+1,v+2);this._poleIndexBuffer=a.createIndexBuffer(o,!0);let l=new pg,d=new pg,m=new pg,y=new pg;this._poleSegments=[];for(let v=0,S=0;v<lR;v++){let T=360/(1<<v);l.emplaceBack(0,-Na,0,.5,0),d.emplaceBack(0,-Na,0,.5,1),m.emplaceBack(0,-Na,0,.5,.5),y.emplaceBack(0,-Na,0,.5,.5);for(let D=0;D<=Hv;D++){let L=D/Hv,F=0,N=Gi(0,T,L),[H,q,Q]=Wv(sne,one,N,Na);l.emplaceBack(H,q,Q,L,F),d.emplaceBack(H,q,Q,L,1-F);let K=Rr(N);L=.5+.5*Math.sin(K),F=.5+.5*Math.cos(K),m.emplaceBack(H,q,Q,L,F),y.emplaceBack(H,q,Q,L,1-F)}this._poleSegments.push(ss.simpleSegment(S,0,66,64)),S+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(l,vM,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(d,vM,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(m,vM,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(y,vM,!1)}getGridBuffers(a,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,o){return[o?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,o?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},n.cu=function(a){return Gm.has(a)},n.cv=IM,n.cw=aV,n.cx=function(a,o,l=0,d=!0){let m=new ai(l,l),y=a.sub(m),v=o.add(m),S=[y,new ai(v.x,y.y),v,new ai(y.x,v.y)];return d&&S.push(y.clone()),S},n.cy=function(a,o){let l=[];for(let d=0;d<a.length;d++){let m=Fp(d-1,-1,a.length-1),y=Fp(d+1,-1,a.length-1),v=a[d],S=a[y],T=a[m].sub(v).unit(),D=S.sub(v).unit(),L=D.angleWithSep(T.x,T.y),F=T.add(D).unit().mult(-1*o/Math.sin(L/2));l.push(v.add(F))}return l},n.cz=f6,n.d=Lp,n.d$=lb,n.d0=Po,n.d1=br,n.d2=Sc,n.d3=nv,n.d4=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.d5=ql,n.d6=Q5,n.d7=mg,n.d8=function([a,o,l]){let d=Math.hypot(a,o,l),m=Math.atan2(a,l),y=.5*Math.PI-Math.acos(-o/d);return new Kr(xa(m),xa(y))},n.d9=ol,n.dA=function(){aT().acquire(pO)},n.dB=function(){let a=fb;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(pO),fb=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.dC=pb,n.dD=function(a){let o=wE();if(!o)return;let l=o.delete(xE);a&&l.catch(a).then(()=>a())},n.dE=db,n.dF=uG,n.dG=function(a){fO=Oo.resolveURL(a),h0||(h0=new dO(aT(),new yd)),h0.broadcast("setDracoUrl",fO)},n.dH=hG,n.dI=function(a){u0=Oo.resolveURL(a),h0||(h0=new dO(aT(),new yd)),h0.broadcast("setMeshoptUrl",u0)},n.dJ=Wx,n.dK=tt,n.dL=uf,n.dM=fu,n.dN=xg,n.dO=iR,n.dP=FV,n.dQ=GV,n.dR=AV,n.dS=Im,n.dT=s6,n.dU=o0,n.dV=function(a,o,l,d,m,y,v,S,T,D,L){a.createArrays(),a.tilePixelRatio=ti/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;let F=a.layers[0].layout,N=a.layers[0]._unevaluatedLayout._values,H={};if(a.textSizeData.kind==="composite"){let{minZoom:ae,maxZoom:_e}=a.textSizeData;H.compositeTextSizes=[N["text-size"].possiblyEvaluate(new er(ae),S),N["text-size"].possiblyEvaluate(new er(_e),S)]}if(a.iconSizeData.kind==="composite"){let{minZoom:ae,maxZoom:_e}=a.iconSizeData;H.compositeIconSizes=[N["icon-size"].possiblyEvaluate(new er(ae),S),N["icon-size"].possiblyEvaluate(new er(_e),S)]}H.layoutTextSize=N["text-size"].possiblyEvaluate(new er(T+1),S),H.layoutIconSize=N["icon-size"].possiblyEvaluate(new er(T+1),S),H.textMaxSize=N["text-size"].possiblyEvaluate(new er(18),S);let q=F.get("text-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",Q=F.get("text-size"),K=!1;for(let ae of a.features)if(ae.icon&&ae.icon.nameSecondary){K=!0;break}for(let ae of a.features){let _e=F.get("text-font").evaluate(ae,{},S).join(","),ge=Q.evaluate(ae,{},S),be=H.layoutTextSize.evaluate(ae,{},S),ze=(H.layoutIconSize.evaluate(ae,{},S),{horizontal:{},vertical:void 0}),ke=ae.text,je,it=[0,0];if(ke){let dt=ke.toString(),At=F.get("text-letter-spacing").evaluate(ae,{},S)*Bo,jt=F.get("text-line-height").evaluate(ae,{},S)*Bo,Ct=Ft(dt)?At:0,qt=F.get("text-anchor").evaluate(ae,{},S),Tt=F.get("text-variable-anchor");if(!Tt){let Xt=F.get("text-radial-offset").evaluate(ae,{},S);it=Xt?u6(qt,[Xt*Bo,WR]):F.get("text-offset").evaluate(ae,{},S).map(Vt=>Vt*Bo)}let Ot=q?"center":F.get("text-justify").evaluate(ae,{},S),Kt=F.get("symbol-placement")==="point",Dt=Kt?F.get("text-max-width").evaluate(ae,{},S)*Bo:1/0,ri=Xt=>{a.allowVerticalPlacement&&Rt(dt)&&(ze.vertical=jR(ke,o,l,m,_e,Dt,jt,qt,Xt,Ct,it,Ql.vertical,!0,be,ge))};if(!q&&Tt){let Xt=Ot==="auto"?Tt.map(zi=>qR(zi)):[Ot],Vt=!1;for(let zi=0;zi<Xt.length;zi++){let Ri=Xt[zi];if(!ze.horizontal[Ri])if(Vt)ze.horizontal[Ri]=ze.horizontal[0];else{let gi=jR(ke,o,l,m,_e,Dt,jt,"center",Ri,Ct,it,Ql.horizontal,!1,be,ge);gi&&(ze.horizontal[Ri]=gi,Vt=gi.positionedLines.length===1)}}ri("left")}else{if(Ot==="auto"&&(Ot=qR(qt)),Kt||F.get("text-writing-mode").indexOf("horizontal")>=0||!Rt(dt)){let Xt=jR(ke,o,l,m,_e,Dt,jt,qt,Ot,Ct,it,Ql.horizontal,!1,be,ge);Xt&&(ze.horizontal[Ot]=Xt)}ri(Kt?"left":Ot)}}let ut=!1;if(ae.icon&&ae.icon.namePrimary){let dt=d[ae.icon.namePrimary];dt&&(je=Lse(m[ae.icon.namePrimary],ae.icon.nameSecondary?m[ae.icon.nameSecondary]:void 0,F.get("icon-offset").evaluate(ae,{},S),F.get("icon-anchor").evaluate(ae,{},S)),ut=dt.sdf,a.sdfIcons===void 0?a.sdfIcons=dt.sdf:a.sdfIcons!==dt.sdf&&Ds("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(dt.pixelRatio!==a.pixelRatio||F.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}let vt=d6(ze.horizontal)||ze.vertical;a.iconsInText||(a.iconsInText=!!vt&&vt.iconsInText),(vt||je)&&jse(a,ae,ze,je,d,H,be,0,it,ut,v,S,D,L,K)}y&&a.generateCollisionDebugBuffers(T,a.collisionBoxArray)},n.dW=zM,n.dX=TM,n.dY=LR,n.dZ=$1,n.d_=RM,n.da=qv,n.db=p,n.dc=AR,n.dd=_j,n.de=function(a){let o=[0,0,0],l=n.ae.identity(new Float64Array(16));return n.ae.multiply(l,a.pixelMatrix,a.globeMatrix),n.$.transformMat4(o,o,l),new ai(o[0],o[1])},n.df=P,n.dg=I,n.dh=function(a){let o=a.navigator?a.navigator.userAgent:null;return!!function(l){if(zm==null){let d=l.navigator?l.navigator.userAgent:null;zm=!!l.safari||!(!d||!(/\b(iPad|iPhone|iPod)\b/.test(d)||d.match("Safari")&&!d.match("Chrome")))}return zm}(a)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},n.di=sv,n.dj=class{constructor(a,o,l){this._transformRequestFn=a,this._customAccessToken=o,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){let a=function(){let o="";for(let l=0;l<10;l++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",e1,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,o){return this._transformRequestFn&&this._transformRequestFn(a,o)||{url:a}}normalizeStyleURL(a,o){if(!x(a))return a;let l=El(a);return l.params.push(`sdk=js-${c}`),l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeGlyphsURL(a,o){if(!x(a))return a;let l=El(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeModelURL(a,o){if(!x(a))return a;let l=El(a);return l.path=`/models/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeSourceURL(a,o,l,d){if(!x(a))return a;let m=El(a);return m.path=`/v4/${m.authority}.json`,m.params.push("secure"),l&&m.params.push(`language=${l}`),d&&m.params.push(`worldview=${d}`),this._makeAPIURL(m,this._customAccessToken||o)}normalizeSpriteURL(a,o,l,d){let m=El(a);return x(a)?(m.path=`/styles/v1${m.path}/sprite${o}${l}`,this._makeAPIURL(m,this._customAccessToken||d)):(m.path+=`${o}${l}`,fd(m))}normalizeTileURL(a,o,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!x(a))return a;let d=El(a);d.path=d.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||l&&d.authority!=="raster"&&l===512?"@2x":""}${dv.supported?".webp":"$1"}`),d.authority==="raster"?d.path=`/${p.RASTER_URL_PREFIX}${d.path}`:d.authority==="rasterarrays"?d.path=`/${p.RASTERARRAYS_URL_PREFIX}${d.path}`:d.authority==="3dtiles"?d.path=`/${p.TILES3D_URL_PREFIX}${d.path}`:(d.path=d.path.replace(/^.+\/v4\//,"/"),d.path=`/${p.TILE_URL_VERSION}${d.path}`);let m=this._customAccessToken||function(y){for(let v of y){let S=v.match(/^access_token=(.*)$/);if(S)return S[1]}return null}(d.params)||p.ACCESS_TOKEN;return p.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&d.params.push(`sku=${this._skuToken}`),this._makeAPIURL(d,m)}canonicalizeTileURL(a,o){let l=El(a);if(!l.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let d="mapbox://";l.path.match(/^\/raster\/v1\//)?d+=`raster/${l.path.replace(`/${p.RASTER_URL_PREFIX}/`,"")}`:l.path.match(/^\/rasterarrays\/v1\//)?d+=`rasterarrays/${l.path.replace(`/${p.RASTERARRAYS_URL_PREFIX}/`,"")}`:d+=`tiles/${l.path.replace(`/${p.TILE_URL_VERSION}/`,"")}`;let m=l.params;return o&&(m=m.filter(y=>!y.match(/^access_token=/))),m.length&&(d+=`?${m.join("&")}`),d}canonicalizeTileset(a,o){let l=!!o&&x(o),d=[];for(let m of a.tiles||[])f(m)?d.push(this.canonicalizeTileURL(m,l)):d.push(m);return d}_makeAPIURL(a,o){let l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",d=El(p.API_URL);if(a.protocol=d.protocol,a.authority=d.authority,a.protocol==="http"){let m=a.params.indexOf("secure");m>=0&&a.params.splice(m,1)}if(d.path!=="/"&&(a.path=`${d.path}${a.path}`),!p.REQUIRE_ACCESS_TOKEN)return fd(a);if(o=o||p.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(m=>m.indexOf("access_token")===-1),a.params.push(`access_token=${o||""}`),fd(a)}},n.dk=function(a,o){o?Gm.add(a):Gm.delete(a)},n.dl=dv,n.dm=gP,n.dn=n1,n.dp=t1,n.dq=CE,n.dr=DE,n.ds=function(a){Gm.delete(a)},n.dt=Vm,n.du=Vp,n.dv=Cm,n.dw=c,n.dx=function(a,o){Zx=a,Qx=o},n.dy=function(a,o,l=!1){if(xn===Wi||xn===gr||xn===Or)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ur=Oo.resolveURL(a),xn=Wi,zn=o,_r(),l||Xr()},n.dz=ur,n.e=Oo,n.e0=CM,n.e1=AM,n.e2=Tm,n.e3=kV,n.e4=k,n.e5=pd,n.e6=function(a){let o=0;if(new Uint32Array(a,0,1)[0]!==pG){let l=new Uint32Array(a,0,7),[,,d,m,y,v]=l;o=l.byteLength+m+y+v+y,(d!==a.byteLength||o>=a.byteLength)&&Ds("Invalid b3dm header information.")}return yG(a,o)},n.e7=function(a,o){let l=_G(a);for(let d of l){for(let m of d.meshes)Qoe(m);d.lights&&(d.lightMeshIndex=d.meshes.length,d.meshes.push(Koe(d.lights,o)))}return l},n.e8=hT,n.e9=cG,n.ea=Ar,n.eb=function(a){Fm(),wc&&wc.then(o=>{o.keys().then(l=>{for(let d=0;d<l.length-a;d++)o.delete(l[d])})})},n.f=Hm,n.g=Ec,n.h=function(a,o){return Sc(Io(a,{type:"json"}),o)},n.i=Um,n.j=Zl,n.k=n6,n.l=function(a){return fetch(a).then(o=>o.arrayBuffer()).then(o=>yG(o,0,a))},n.m=GR,n.n=class extends sT{},n.o=ah,n.p=toe,n.q=Hp,n.r=R,n.s=G,n.t=B,n.u=au,n.v=Te,n.w=Ds,n.x=$l,n.y=Le,n.z=Se}),r(["./shared"],function(n){function c(xe){let ie=xe?xe.url.toString():void 0;return ie?performance.getEntriesByName(ie):[]}function u(xe){if(typeof xe=="number"||typeof xe=="boolean"||typeof xe=="string"||xe==null)return JSON.stringify(xe);if(Array.isArray(xe)){let re="[";for(let he of xe)re+=`${u(he)},`;return`${re}]`}let ie="{";for(let re of Object.keys(xe).sort())ie+=`${re}:${u(xe[re])},`;return`${ie}}`}function p(xe){let ie="";for(let re of n.cG)ie+=`/${u(xe[re])}`;return ie}class f{constructor(ie){this.keyCache={},this._layers={},this._layerConfigs={},ie&&this.replace(ie)}replace(ie,re){this._layerConfigs={},this._layers={},this.update(ie,[],re)}update(ie,re,he){this._options=he;for(let Ie of ie)this._layerConfigs[Ie.id]=Ie,(this._layers[Ie.id]=n.c$(Ie,this.scope,null,this._options)).compileFilter(),this.keyCache[Ie.id]&&delete this.keyCache[Ie.id];for(let Ie of re)delete this.keyCache[Ie],delete this._layerConfigs[Ie],delete this._layers[Ie];this.familiesBySource={};let De=function(Ie,He){let nt={};for(let st=0;st<Ie.length;st++){let St=He&&He[Ie[st].id]||p(Ie[st]);He&&(He[Ie[st].id]=St);let It=nt[St];It||(It=nt[St]=[]),It.push(Ie[st])}let qe=[];for(let st in nt)qe.push(nt[st]);return qe}(n.dJ(this._layerConfigs),this.keyCache);for(let Ie of De){let He=Ie.map(ni=>this._layers[ni.id]),nt=He[0];if(nt.visibility==="none")continue;let qe=nt.source||"",st=this.familiesBySource[qe];st||(st=this.familiesBySource[qe]={});let St=nt.sourceLayer||"_geojsonTileLayer",It=st[St];It||(It=st[St]=[]),It.push(He)}}}let x=1*n.dM;class w{constructor(ie){let re={},he=[];for(let nt in ie){let qe=ie[nt],st=re[nt]={};for(let St in qe.glyphs){let It=qe.glyphs[+St];if(!It||It.bitmap.width===0||It.bitmap.height===0)continue;let ni=It.metrics.localGlyph?x:1,Ci={x:0,y:0,w:It.bitmap.width+2*ni,h:It.bitmap.height+2*ni};he.push(Ci),st[St]=Ci}}let{w:De,h:Ie}=n.k(he),He=new n.dL({width:De||1,height:Ie||1});for(let nt in ie){let qe=ie[nt];for(let st in qe.glyphs){let St=qe.glyphs[+st];if(!St||St.bitmap.width===0||St.bitmap.height===0)continue;let It=re[nt][st],ni=St.metrics.localGlyph?x:1;n.dL.copy(St.bitmap,He,{x:0,y:0},{x:It.x+ni,y:It.y+ni},St.bitmap)}}this.image=He,this.positions=re}}n.dK(w,"GlyphAtlas");class E{constructor(ie){this.tileID=new n.aQ(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),this.tileZoom=ie.tileZoom,this.uid=ie.uid,this.zoom=ie.zoom,this.lut=ie.lut,this.canonical=ie.tileID.canonical,this.pixelRatio=ie.pixelRatio,this.tileSize=ie.tileSize,this.source=ie.source,this.scope=ie.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ie.showCollisionBoxes,this.collectResourceTiming=!!ie.collectResourceTiming,this.promoteId=ie.promoteId,this.isSymbolTile=ie.isSymbolTile,this.tileTransform=n.dN(ie.tileID.canonical,ie.projection),this.projection=ie.projection,this.brightness=ie.brightness,this.extraShadowCaster=!!ie.extraShadowCaster,this.tessellationStep=ie.tessellationStep}parse(ie,re,he,De,Ie){this.status="parsing",this.data=ie,this.collisionBoxArray=new n.dO;let He=new n.dP(Object.keys(ie.layers).sort()),nt=new n.dQ(this.tileID,this.promoteId);nt.bucketLayerIDs=[];let qe={},st=new n.dR(256,256),St={featureIndex:nt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:st,availableImages:he,brightness:this.brightness},It=re.familiesBySource[this.source];for(let _i in It){let un=ie.layers[_i];if(!un)continue;let qi=!1,vr=!1,qn=!1;for(let Ss of It[_i])Ss[0].type==="symbol"?qi=!0:vr=!0,Ss[0].is3D()&&Ss[0].type!=="model"&&(qn=!0);if(this.extraShadowCaster&&!qn||this.isSymbolTile===!0&&!qi||this.isSymbolTile===!1&&!vr)continue;un.version===1&&n.w(`Vector tile source "${this.source}" layer "${_i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Zr=He.encode(_i),Yn=[];for(let Ss=0;Ss<un.length;Ss++){let _n=un.feature(Ss),Br=nt.getId(_n,_i);Yn.push({feature:_n,id:Br,index:Ss,sourceLayerIndex:Zr})}for(let Ss of It[_i]){let _n=Ss[0];(!this.extraShadowCaster||_n.is3D()&&_n.type!=="model")&&(this.isSymbolTile!==void 0&&_n.type==="symbol"!==this.isSymbolTile||_n.minzoom&&this.zoom<Math.floor(_n.minzoom)||_n.maxzoom&&this.zoom>=_n.maxzoom||_n.visibility!=="none"&&(A(Ss,this.zoom,St.brightness,he),(qe[_n.id]=_n.createBucket({index:nt.bucketLayerIDs.length,layers:Ss,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Zr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Yn,St,this.tileID.canonical,this.tileTransform),nt.bucketLayerIDs.push(Ss.map(Br=>Br.id))))}}let ni,Ci,Bi,Qi;st.trim();let fi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Sr=()=>{if(ni)return this.status="done",Ie(ni);if(this.extraShadowCaster)this.status="done",Ie(null,{buckets:n.dJ(qe).filter(_i=>!_i.isEmpty()),featureIndex:nt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:St.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ci&&Bi&&Qi){let _i=new w(Ci),un=new n.dT(Bi,Qi,this.lut);for(let qi in qe){let vr=qe[qi];vr instanceof n.dU?(A(vr.layers,this.zoom,St.brightness,he),n.dV(vr,Ci,_i.positions,Bi,un.iconPositions,this.showCollisionBoxes,he,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):vr.hasPattern&&(vr instanceof n.dW||vr instanceof n.dX||vr instanceof n.c0)&&(A(vr.layers,this.zoom,St.brightness,he),vr.addFeatures(St,this.tileID.canonical,un.patternPositions,he,this.tileTransform,this.brightness))}this.status="done",Ie(null,{buckets:n.dJ(qe).filter(qi=>!qi.isEmpty()),featureIndex:nt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:_i.image,lineAtlas:st,imageAtlas:un,brightness:St.brightness})}};if(!this.extraShadowCaster){let _i=n.dS(St.glyphDependencies,vr=>Object.keys(vr).map(Number));Object.keys(_i).length?De.send("getGlyphs",{uid:this.uid,stacks:_i,scope:this.scope},(vr,qn)=>{ni||(ni=vr,Ci=qn,Sr())},void 0,!1,fi):Ci={};let un=Object.keys(St.iconDependencies);un.length?De.send("getImages",{icons:un,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(vr,qn)=>{ni||(ni=vr,Bi=qn,Sr())},void 0,!1,fi):Bi={};let qi=Object.keys(St.patternDependencies);qi.length?De.send("getImages",{icons:qi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(vr,qn)=>{ni||(ni=vr,Qi=qn,Sr())},void 0,!1,fi):Qi={}}Sr()}}function A(xe,ie,re,he){let De=new n.Y(ie,{brightness:re});for(let Ie of xe)Ie.recalculate(De,he)}class I extends n.E{constructor(ie,re,he,De,Ie,He){super(),this.actor=ie,this.layerIndex=re,this.availableImages=he,this.loadVectorData=Ie||n.aq,this.loading={},this.loaded={},this.deduped=new n.ap(ie.scheduler),this.isSpriteLoaded=De,this.scheduler=ie.scheduler,this.brightness=He}loadTile(ie,re){let he=ie.uid,De=ie&&ie.request,Ie=De&&De.collectResourceTiming,He=this.loading[he]=new E(ie);He.abort=this.loadVectorData(ie,(nt,qe)=>{let st=!this.loading[he];if(delete this.loading[he],st||nt||!qe)return He.status="done",st||(this.loaded[he]=He),re(nt);let St=qe.rawData,It={};qe.expires&&(It.expires=qe.expires),qe.cacheControl&&(It.cacheControl=qe.cacheControl),He.vectorTile=qe.vectorTile||new n.dY(new n.dZ(St));let ni=()=>{He.parse(He.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ci,Bi)=>{if(Ci||!Bi)return re(Ci);let Qi={};if(Ie){let fi=c(De);fi.length>0&&(Qi.resourceTiming=JSON.parse(JSON.stringify(fi)))}re(null,n.Q({rawTileData:St.slice(0)},Bi,It,Qi))})};this.isSpriteLoaded?ni():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ni,{type:"parseTile",isSymbolTile:ie.isSymbolTile,zoom:ie.tileZoom}):ni()}),this.loaded=this.loaded||{},this.loaded[he]=He})}reloadTile(ie,re){let he=this.loaded,De=ie.uid;if(he&&he[De]){let Ie=he[De];Ie.showCollisionBoxes=ie.showCollisionBoxes,Ie.projection=ie.projection,Ie.brightness=ie.brightness,Ie.tileTransform=n.dN(ie.tileID.canonical,ie.projection),Ie.extraShadowCaster=ie.extraShadowCaster,Ie.lut=ie.lut;let He=(nt,qe)=>{let st=Ie.reloadCallback;st&&(delete Ie.reloadCallback,Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor,st)),re(nt,qe)};Ie.status==="parsing"?Ie.reloadCallback=He:Ie.status==="done"&&(Ie.vectorTile?Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor,He):He())}else re(null,void 0)}abortTile(ie,re){let he=ie.uid,De=this.loading[he];De&&(De.abort&&De.abort(),delete this.loading[he]),re()}removeTile(ie,re){let he=this.loaded,De=ie.uid;he&&he[De]&&delete he[De],re()}}class P{loadTile(ie,re){let{uid:he,encoding:De,rawImageData:Ie,padding:He}=ie,nt=ImageBitmap&&Ie instanceof ImageBitmap?this.getImageData(Ie,He):Ie;re(null,new n.d_(he,nt,De,He<1))}getImageData(ie,re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ie.width,ie.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ie.width,this.offscreenCanvas.height=ie.height,this.offscreenCanvasContext.drawImage(ie,0,0,ie.width,ie.height);let he=this.offscreenCanvasContext.getImageData(-re,-re,ie.width+2*re,ie.height+2*re);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),he}}n.d$.setPbf(n.dZ);class O{decodeRasterArray({task:ie,buffer:re},he){n.d$.performDecoding(re,ie).then(De=>{he(null,De)},De=>{he(De)})}}let k=n.e0.prototype.toGeoJSON,U=class{constructor(xe){this._feature=xe,this.extent=n.a4,this.type=xe.type,this.properties=xe.tags,"id"in xe&&!isNaN(xe.id)&&(this.id=parseInt(xe.id,10))}loadGeometry(){if(this._feature.type===1){let xe=[];for(let ie of this._feature.geometry)xe.push([new n.P(ie[0],ie[1])]);return xe}{let xe=[];for(let ie of this._feature.geometry){let re=[];for(let he of ie)re.push(new n.P(he[0],he[1]));xe.push(re)}return xe}}toGeoJSON(xe,ie,re){return k.call(this,xe,ie,re)}},j=class{constructor(xe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.a4,this.length=xe.length,this._features=xe}feature(xe){return new U(this._features[xe])}},V=64/4096,$=128;class Y{constructor(){this.features=new Map}clear(){this.features.clear()}load(ie=[],re){for(let he of ie){let De=he.id;if(De==null)continue;let Ie=this.features.get(De);Ie&&this.updateCache(Ie,re),he.geometry?(Ie=X(he),this.updateCache(Ie,re),this.features.set(De,Ie)):this.features.delete(De),this.updateCache(Ie,re)}}updateCache(ie,re){for(let{canonical:he,uid:De}of Object.values(re)){let{z:Ie,x:He,y:nt}=he;J(ie,Math.pow(2,Ie),He,nt)&&delete re[De]}}getTile(ie,re,he){let De=Math.pow(2,ie),Ie=[];for(let He of this.features.values())J(He,De,re,he)&&Ie.push(ve(He,De,re,he));return{features:Ie}}getFeatures(){return[...this.features.values()]}}function J({minX:xe,minY:ie,maxX:re,maxY:he},De,Ie,He){return xe<(Ie+1+V)/De&&ie<(He+1+V)/De&&re>(Ie-V)/De&&he>(He-V)/De}function X(xe){let{id:ie,geometry:re,properties:he}=xe;if(!re)return;if(re.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:De,coordinates:Ie}=re,He={id:ie,type:1,geometry:[],tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},nt=He.geometry;if(De==="Point")ee(Ie,nt,He);else if(De==="MultiPoint")for(let qe of Ie)ee(qe,nt,He);else if(De==="LineString")He.type=2,oe(Ie,nt,He);else if(De==="MultiLineString")He.type=2,le(Ie,nt,He);else if(De==="Polygon")He.type=3,le(Ie,nt,He,!0);else{if(De!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");He.type=3;for(let qe of Ie)le(qe,nt,He,!0)}return He}function ee([xe,ie],re,he){let De=n.ak(xe),Ie=n.al(ie);Ie=Ie<0?0:Ie>1?1:Ie,re.push(De,Ie),he.minX=Math.min(he.minX,De),he.minY=Math.min(he.minY,Ie),he.maxX=Math.max(he.maxX,De),he.maxY=Math.max(he.maxY,Ie)}function oe(xe,ie,re,he=!1,De=!1){let Ie=[];for(let He of xe)ee(He,Ie,re);ie.push(Ie),he&&function(He,nt){let qe=0;for(let st=0,St=He.length,It=St-2;st<St;It=st,st+=2)qe+=(He[st]-He[It])*(He[st+1]+He[It+1]);if(qe>0===nt)for(let st=0,St=He.length;st<St/2;st+=2){let It=He[st],ni=He[st+1];He[st]=He[St-2-st],He[st+1]=He[St-1-st],He[St-2-st]=It,He[St-1-st]=ni}}(Ie,De)}function le(xe,ie,re,he=!1){for(let De=0;De<xe.length;De++)oe(xe[De],ie,re,he,De===0)}function ve(xe,ie,re,he){let{id:De,type:Ie,geometry:He,tags:nt}=xe,qe=[];if(Ie===1)(function(st,St,It,ni,Ci){for(let Bi=0;Bi<st.length;Bi+=2){let Qi=Math.round(n.a4*(st[Bi+0]*St-It)),fi=Math.round(n.a4*(st[Bi+1]*St-ni));Ci.push([Qi,fi])}})(He,ie,re,he,qe);else for(let st of He)we(st,ie,re,he,qe);return{id:De,type:Ie,geometry:qe,tags:nt}}function we(xe,ie,re,he,De){let Ie=-$,He=n.a4+$,nt;for(let qe=0;qe<xe.length-2;qe+=2){let st=Math.round(n.a4*(xe[qe+0]*ie-re)),St=Math.round(n.a4*(xe[qe+1]*ie-he)),It=Math.round(n.a4*(xe[qe+2]*ie-re)),ni=Math.round(n.a4*(xe[qe+3]*ie-he)),Ci=It-st,Bi=ni-St;st<Ie&&It<Ie||(st<Ie?(St+=Math.round(Bi*((Ie-st)/Ci)),st=Ie):It<Ie&&(ni=St+Math.round(Bi*((Ie-st)/Ci)),It=Ie),St<Ie&&ni<Ie||(St<Ie?(st+=Math.round(Ci*((Ie-St)/Bi)),St=Ie):ni<Ie&&(It=st+Math.round(Ci*((Ie-St)/Bi)),ni=Ie),st>=He&&It>=He||(st>=He?(St+=Math.round(Bi*((He-st)/Ci)),st=He):It>=He&&(ni=St+Math.round(Bi*((He-st)/Ci)),It=He),St>=He&&ni>=He||(St>=He?(st+=Math.round(Ci*((He-St)/Bi)),St=He):ni>=He&&(It=st+Math.round(Ci*((He-St)/Bi)),ni=He),nt&&st===nt[nt.length-1][0]&&St===nt[nt.length-1][1]||(nt=[[st,St]],De.push(nt)),nt.push([It,ni])))))}}var fe={exports:{}},Ue=n.e2,Fe=n.e1.VectorTileFeature,Pe=Ae;function Ae(xe,ie){this.options=ie||{},this.features=xe,this.length=xe.length}function et(xe,ie){this.id=typeof xe.id=="number"?xe.id:void 0,this.type=xe.type,this.rawGeometry=xe.type===1?[xe.geometry]:xe.geometry,this.properties=xe.tags,this.extent=ie||4096}Ae.prototype.feature=function(xe){return new et(this.features[xe],this.options.extent)},et.prototype.loadGeometry=function(){var xe=this.rawGeometry;this.geometry=[];for(var ie=0;ie<xe.length;ie++){for(var re=xe[ie],he=[],De=0;De<re.length;De++)he.push(new Ue(re[De][0],re[De][1]));this.geometry.push(he)}return this.geometry},et.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var xe=this.geometry,ie=1/0,re=-1/0,he=1/0,De=-1/0,Ie=0;Ie<xe.length;Ie++)for(var He=xe[Ie],nt=0;nt<He.length;nt++){var qe=He[nt];ie=Math.min(ie,qe.x),re=Math.max(re,qe.x),he=Math.min(he,qe.y),De=Math.max(De,qe.y)}return[ie,he,re,De]},et.prototype.toGeoJSON=Fe.prototype.toGeoJSON;var $e=n.e3,rt=Pe;function Je(xe){var ie=new $e;return function(re,he){for(var De in re.layers)he.writeMessage(3,bt,re.layers[De])}(xe,ie),ie.finish()}function bt(xe,ie){var re;ie.writeVarintField(15,xe.version||1),ie.writeStringField(1,xe.name||""),ie.writeVarintField(5,xe.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(re=0;re<xe.length;re++)he.feature=xe.feature(re),ie.writeMessage(2,ot,he);var De=he.keys;for(re=0;re<De.length;re++)ie.writeStringField(3,De[re]);var Ie=he.values;for(re=0;re<Ie.length;re++)ie.writeMessage(4,Nt,Ie[re])}function ot(xe,ie){var re=xe.feature;re.id!==void 0&&ie.writeVarintField(1,re.id),ie.writeMessage(2,xt,xe),ie.writeVarintField(3,re.type),ie.writeMessage(4,yt,re)}function xt(xe,ie){var re=xe.feature,he=xe.keys,De=xe.values,Ie=xe.keycache,He=xe.valuecache;for(var nt in re.properties){var qe=re.properties[nt],st=Ie[nt];if(qe!==null){st===void 0&&(he.push(nt),Ie[nt]=st=he.length-1),ie.writeVarint(st);var St=typeof qe;St!=="string"&&St!=="boolean"&&St!=="number"&&(qe=JSON.stringify(qe));var It=St+":"+qe,ni=He[It];ni===void 0&&(De.push(qe),He[It]=ni=De.length-1),ie.writeVarint(ni)}}}function Xe(xe,ie){return(ie<<3)+(7&xe)}function kt(xe){return xe<<1^xe>>31}function yt(xe,ie){for(var re=xe.loadGeometry(),he=xe.type,De=0,Ie=0,He=re.length,nt=0;nt<He;nt++){var qe=re[nt],st=1;he===1&&(st=qe.length),ie.writeVarint(Xe(1,st));for(var St=he===3?qe.length-1:qe.length,It=0;It<St;It++){It===1&&he!==1&&ie.writeVarint(Xe(2,St-1));var ni=qe[It].x-De,Ci=qe[It].y-Ie;ie.writeVarint(kt(ni)),ie.writeVarint(kt(Ci)),De+=ni,Ie+=Ci}he===3&&ie.writeVarint(Xe(7,1))}}function Nt(xe,ie){var re=typeof xe;re==="string"?ie.writeStringField(1,xe):re==="boolean"?ie.writeBooleanField(7,xe):re==="number"&&(xe%1!=0?ie.writeDoubleField(3,xe):xe<0?ie.writeSVarintField(6,xe):ie.writeVarintField(5,xe))}fe.exports=Je,fe.exports.fromVectorTileJs=Je,fe.exports.fromGeojsonVt=function(xe,ie){ie=ie||{};var re={};for(var he in xe)re[he]=new rt(xe[he].features,ie),re[he].name=he,re[he].version=ie.version,re[he].extent=ie.extent;return Je({layers:re})},fe.exports.GeoJSONWrapper=rt;var Mt=n.e4(fe.exports);let li={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:xe=>xe},Qt=Math.fround||(Wt=new Float32Array(1),xe=>(Wt[0]=+xe,Wt[0]));var Wt;let Di=3,Ii=5,Li=6;class $t{constructor(ie){this.options=Object.assign(Object.create(li),ie),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ie){let{log:re,minZoom:he,maxZoom:De}=this.options;re&&console.time("total time");let Ie=`prepare ${ie.length} points`;re&&console.time(Ie),this.points=ie;let He=[];for(let qe=0;qe<ie.length;qe++){let st=ie[qe];if(!st.geometry)continue;let[St,It]=st.geometry.coordinates,ni=Qt(Hi(St)),Ci=Qt(lr(It));He.push(ni,Ci,1/0,qe,-1,1),this.options.reduce&&He.push(0)}let nt=this.trees[De+1]=this._createTree(He);re&&console.timeEnd(Ie);for(let qe=De;qe>=he;qe--){let st=+Date.now();nt=this.trees[qe]=this._createTree(this._cluster(nt,qe)),re&&console.log("z%d: %d clusters in %dms",qe,nt.numItems,+Date.now()-st)}return re&&console.timeEnd("total time"),this}getClusters(ie,re){let he=((ie[0]+180)%360+360)%360-180,De=Math.max(-90,Math.min(90,ie[1])),Ie=ie[2]===180?180:((ie[2]+180)%360+360)%360-180,He=Math.max(-90,Math.min(90,ie[3]));if(ie[2]-ie[0]>=360)he=-180,Ie=180;else if(he>Ie){let It=this.getClusters([he,De,180,He],re),ni=this.getClusters([-180,De,Ie,He],re);return It.concat(ni)}let nt=this.trees[this._limitZoom(re)],qe=nt.range(Hi(he),lr(He),Hi(Ie),lr(De)),st=nt.data,St=[];for(let It of qe){let ni=this.stride*It;St.push(st[ni+Ii]>1?Ut(st,ni,this.clusterProps):this.points[st[ni+Di]])}return St}getChildren(ie){let re=this._getOriginId(ie),he=this._getOriginZoom(ie),De="No cluster with the specified id.",Ie=this.trees[he];if(!Ie)throw new Error(De);let He=Ie.data;if(re*this.stride>=He.length)throw new Error(De);let nt=this.options.radius/(this.options.extent*Math.pow(2,he-1)),qe=Ie.within(He[re*this.stride],He[re*this.stride+1],nt),st=[];for(let St of qe){let It=St*this.stride;He[It+4]===ie&&st.push(He[It+Ii]>1?Ut(He,It,this.clusterProps):this.points[He[It+Di]])}if(st.length===0)throw new Error(De);return st}getLeaves(ie,re,he){let De=[];return this._appendLeaves(De,ie,re=re||10,he=he||0,0),De}getTile(ie,re,he){let De=this.trees[this._limitZoom(ie)],Ie=Math.pow(2,ie),{extent:He,radius:nt}=this.options,qe=nt/He,st=(he-qe)/Ie,St=(he+1+qe)/Ie,It={features:[]};return this._addTileFeatures(De.range((re-qe)/Ie,st,(re+1+qe)/Ie,St),De.data,re,he,Ie,It),re===0&&this._addTileFeatures(De.range(1-qe/Ie,st,1,St),De.data,Ie,he,Ie,It),re===Ie-1&&this._addTileFeatures(De.range(0,st,qe/Ie,St),De.data,-1,he,Ie,It),It.features.length?It:null}getClusterExpansionZoom(ie){let re=this._getOriginZoom(ie)-1;for(;re<=this.options.maxZoom;){let he=this.getChildren(ie);if(re++,he.length!==1)break;ie=he[0].properties.cluster_id}return re}_appendLeaves(ie,re,he,De,Ie){let He=this.getChildren(re);for(let nt of He){let qe=nt.properties;if(qe&&qe.cluster?Ie+qe.point_count<=De?Ie+=qe.point_count:Ie=this._appendLeaves(ie,qe.cluster_id,he,De,Ie):Ie<De?Ie++:ie.push(nt),ie.length===he)break}return Ie}_createTree(ie){let re=new n.cN(ie.length/this.stride|0,this.options.nodeSize,Float32Array);for(let he=0;he<ie.length;he+=this.stride)re.add(ie[he],ie[he+1]);return re.finish(),re.data=ie,re}_addTileFeatures(ie,re,he,De,Ie,He){for(let nt of ie){let qe=nt*this.stride,st=re[qe+Ii]>1,St,It,ni;if(st)St=wi(re,qe,this.clusterProps),It=re[qe],ni=re[qe+1];else{let Qi=this.points[re[qe+Di]];St=Qi.properties;let[fi,Sr]=Qi.geometry.coordinates;It=Hi(fi),ni=lr(Sr)}let Ci={type:1,geometry:[[Math.round(this.options.extent*(It*Ie-he)),Math.round(this.options.extent*(ni*Ie-De))]],tags:St},Bi;Bi=st||this.options.generateId?re[qe+Di]:this.points[re[qe+Di]].id,Bi!==void 0&&(Ci.id=Bi),He.features.push(Ci)}}_limitZoom(ie){return Math.max(this.options.minZoom,Math.min(Math.floor(+ie),this.options.maxZoom+1))}_cluster(ie,re){let{radius:he,extent:De,reduce:Ie,minPoints:He}=this.options,nt=he/(De*Math.pow(2,re)),qe=ie.data,st=[],St=this.stride;for(let It=0;It<qe.length;It+=St){if(qe[It+2]<=re)continue;qe[It+2]=re;let ni=qe[It],Ci=qe[It+1],Bi=ie.within(qe[It],qe[It+1],nt),Qi=qe[It+Ii],fi=Qi;for(let Sr of Bi){let _i=Sr*St;qe[_i+2]>re&&(fi+=qe[_i+Ii])}if(fi>Qi&&fi>=He){let Sr,_i=ni*Qi,un=Ci*Qi,qi=-1,vr=(It/St<<5)+(re+1)+this.points.length;for(let qn of Bi){let Zr=qn*St;if(qe[Zr+2]<=re)continue;qe[Zr+2]=re;let Yn=qe[Zr+Ii];_i+=qe[Zr]*Yn,un+=qe[Zr+1]*Yn,qe[Zr+4]=vr,Ie&&(Sr||(Sr=this._map(qe,It,!0),qi=this.clusterProps.length,this.clusterProps.push(Sr)),Ie(Sr,this._map(qe,Zr)))}qe[It+4]=vr,st.push(_i/fi,un/fi,1/0,vr,-1,fi),Ie&&st.push(qi)}else{for(let Sr=0;Sr<St;Sr++)st.push(qe[It+Sr]);if(fi>1)for(let Sr of Bi){let _i=Sr*St;if(!(qe[_i+2]<=re)){qe[_i+2]=re;for(let un=0;un<St;un++)st.push(qe[_i+un])}}}}return st}_getOriginId(ie){return ie-this.points.length>>5}_getOriginZoom(ie){return(ie-this.points.length)%32}_map(ie,re,he){if(ie[re+Ii]>1){let He=this.clusterProps[ie[re+Li]];return he?Object.assign({},He):He}let De=this.points[ie[re+Di]].properties,Ie=this.options.map(De);return he&&Ie===De?Object.assign({},Ie):Ie}}function Ut(xe,ie,re){return{type:"Feature",id:xe[ie+Di],properties:wi(xe,ie,re),geometry:{type:"Point",coordinates:[(he=xe[ie],360*(he-.5)),Ke(xe[ie+1])]}};var he}function wi(xe,ie,re){let he=xe[ie+Ii],De=he>=1e4?`${Math.round(he/1e3)}k`:he>=1e3?Math.round(he/100)/10+"k":he,Ie=xe[ie+Li],He=Ie===-1?{}:Object.assign({},re[Ie]);return Object.assign(He,{cluster:!0,cluster_id:xe[ie+Di],point_count:he,point_count_abbreviated:De})}function Hi(xe){return xe/360+.5}function lr(xe){let ie=Math.sin(xe*Math.PI/180),re=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return re<0?0:re>1?1:re}function Ke(xe){let ie=(180-360*xe)*Math.PI/180;return 360*Math.atan(Math.exp(ie))/Math.PI-90}function Re(xe,ie,re,he){let De=he,Ie=ie+(re-ie>>1),He,nt=re-ie,qe=xe[ie],st=xe[ie+1],St=xe[re],It=xe[re+1];for(let ni=ie+3;ni<re;ni+=3){let Ci=Lt(xe[ni],xe[ni+1],qe,st,St,It);if(Ci>De)He=ni,De=Ci;else if(Ci===De){let Bi=Math.abs(ni-Ie);Bi<nt&&(He=ni,nt=Bi)}}De>he&&(He-ie>3&&Re(xe,ie,He,he),xe[He+2]=De,re-He>3&&Re(xe,He,re,he))}function Lt(xe,ie,re,he,De,Ie){let He=De-re,nt=Ie-he;if(He!==0||nt!==0){let qe=((xe-re)*He+(ie-he)*nt)/(He*He+nt*nt);qe>1?(re=De,he=Ie):qe>0&&(re+=He*qe,he+=nt*qe)}return He=xe-re,nt=ie-he,He*He+nt*nt}function pi(xe,ie,re,he){let De={id:xe??null,type:ie,geometry:re,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")Ee(De,re);else if(ie==="Polygon")Ee(De,re[0]);else if(ie==="MultiLineString")for(let Ie of re)Ee(De,Ie);else if(ie==="MultiPolygon")for(let Ie of re)Ee(De,Ie[0]);return De}function Ee(xe,ie){for(let re=0;re<ie.length;re+=3)xe.minX=Math.min(xe.minX,ie[re]),xe.minY=Math.min(xe.minY,ie[re+1]),xe.maxX=Math.max(xe.maxX,ie[re]),xe.maxY=Math.max(xe.maxY,ie[re+1])}function Zt(xe,ie,re,he){if(!ie.geometry)return;let De=ie.geometry.coordinates;if(De&&De.length===0)return;let Ie=ie.geometry.type,He=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2),nt=[],qe=ie.id;if(re.promoteId?qe=ie.properties[re.promoteId]:re.generateId&&(qe=he||0),Ie==="Point")Xi(De,nt);else if(Ie==="MultiPoint")for(let st of De)Xi(st,nt);else if(Ie==="LineString")Pi(De,nt,He,!1);else if(Ie==="MultiLineString"){if(re.lineMetrics){for(let st of De)nt=[],Pi(st,nt,He,!1),xe.push(pi(qe,"LineString",nt,ie.properties));return}si(De,nt,He,!1)}else if(Ie==="Polygon")si(De,nt,He,!0);else{if(Ie!=="MultiPolygon"){if(Ie==="GeometryCollection"){for(let st of ie.geometry.geometries)Zt(xe,{id:qe,geometry:st,properties:ie.properties},re,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let st of De){let St=[];si(st,St,He,!0),nt.push(St)}}xe.push(pi(qe,Ie,nt,ie.properties))}function Xi(xe,ie){ie.push(vi(xe[0]),ki(xe[1]),0)}function Pi(xe,ie,re,he){let De,Ie,He=0;for(let qe=0;qe<xe.length;qe++){let st=vi(xe[qe][0]),St=ki(xe[qe][1]);ie.push(st,St,0),qe>0&&(He+=he?(De*St-st*Ie)/2:Math.sqrt(Math.pow(st-De,2)+Math.pow(St-Ie,2))),De=st,Ie=St}let nt=ie.length-3;ie[2]=1,Re(ie,0,nt,re),ie[nt+2]=1,ie.size=Math.abs(He),ie.start=0,ie.end=ie.size}function si(xe,ie,re,he){for(let De=0;De<xe.length;De++){let Ie=[];Pi(xe[De],Ie,re,he),ie.push(Ie)}}function vi(xe){return xe/360+.5}function ki(xe){let ie=Math.sin(xe*Math.PI/180),re=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return re<0?0:re>1?1:re}function Jt(xe,ie,re,he,De,Ie,He,nt){if(he/=ie,Ie>=(re/=ie)&&He<he)return xe;if(He<re||Ie>=he)return null;let qe=[];for(let st of xe){let St=st.geometry,It=st.type,ni=De===0?st.minX:st.minY,Ci=De===0?st.maxX:st.maxY;if(ni>=re&&Ci<he){qe.push(st);continue}if(Ci<re||ni>=he)continue;let Bi=[];if(It==="Point"||It==="MultiPoint")mr(St,Bi,re,he,De);else if(It==="LineString")$i(St,Bi,re,he,De,!1,nt.lineMetrics);else if(It==="MultiLineString")Sn(St,Bi,re,he,De,!1);else if(It==="Polygon")Sn(St,Bi,re,he,De,!0);else if(It==="MultiPolygon")for(let Qi of St){let fi=[];Sn(Qi,fi,re,he,De,!0),fi.length&&Bi.push(fi)}if(Bi.length){if(nt.lineMetrics&&It==="LineString"){for(let Qi of Bi)qe.push(pi(st.id,It,Qi,st.tags));continue}It!=="LineString"&&It!=="MultiLineString"||(Bi.length===1?(It="LineString",Bi=Bi[0]):It="MultiLineString"),It!=="Point"&&It!=="MultiPoint"||(It=Bi.length===3?"Point":"MultiPoint"),qe.push(pi(st.id,It,Bi,st.tags))}}return qe.length?qe:null}function mr(xe,ie,re,he,De){for(let Ie=0;Ie<xe.length;Ie+=3){let He=xe[Ie+De];He>=re&&He<=he&&kr(ie,xe[Ie],xe[Ie+1],xe[Ie+2])}}function $i(xe,ie,re,he,De,Ie,He){let nt=Hr(xe),qe=De===0?wt:Yt,st,St,It=xe.start;for(let fi=0;fi<xe.length-3;fi+=3){let Sr=xe[fi],_i=xe[fi+1],un=xe[fi+2],qi=xe[fi+3],vr=xe[fi+4],qn=De===0?Sr:_i,Zr=De===0?qi:vr,Yn=!1;He&&(st=Math.sqrt(Math.pow(Sr-qi,2)+Math.pow(_i-vr,2))),qn<re?Zr>re&&(St=qe(nt,Sr,_i,qi,vr,re),He&&(nt.start=It+st*St)):qn>he?Zr<he&&(St=qe(nt,Sr,_i,qi,vr,he),He&&(nt.start=It+st*St)):kr(nt,Sr,_i,un),Zr<re&&qn>=re&&(St=qe(nt,Sr,_i,qi,vr,re),Yn=!0),Zr>he&&qn<=he&&(St=qe(nt,Sr,_i,qi,vr,he),Yn=!0),!Ie&&Yn&&(He&&(nt.end=It+st*St),ie.push(nt),nt=Hr(xe)),He&&(It+=st)}let ni=xe.length-3,Ci=xe[ni],Bi=xe[ni+1],Qi=De===0?Ci:Bi;Qi>=re&&Qi<=he&&kr(nt,Ci,Bi,xe[ni+2]),ni=nt.length-3,Ie&&ni>=3&&(nt[ni]!==nt[0]||nt[ni+1]!==nt[1])&&kr(nt,nt[0],nt[1],nt[2]),nt.length&&ie.push(nt)}function Hr(xe){let ie=[];return ie.size=xe.size,ie.start=xe.start,ie.end=xe.end,ie}function Sn(xe,ie,re,he,De,Ie){for(let He of xe)$i(He,ie,re,he,De,Ie,!1)}function kr(xe,ie,re,he){xe.push(ie,re,he)}function wt(xe,ie,re,he,De,Ie){let He=(Ie-ie)/(he-ie);return kr(xe,Ie,re+(De-re)*He,1),He}function Yt(xe,ie,re,he,De,Ie){let He=(Ie-re)/(De-re);return kr(xe,ie+(he-ie)*He,Ie,1),He}function yi(xe,ie){let re=[];for(let he=0;he<xe.length;he++){let De=xe[he],Ie=De.type,He;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")He=Ai(De.geometry,ie);else if(Ie==="MultiLineString"||Ie==="Polygon"){He=[];for(let nt of De.geometry)He.push(Ai(nt,ie))}else if(Ie==="MultiPolygon"){He=[];for(let nt of De.geometry){let qe=[];for(let st of nt)qe.push(Ai(st,ie));He.push(qe)}}re.push(pi(De.id,Ie,He,De.tags))}return re}function Ai(xe,ie){let re=[];re.size=xe.size,xe.start!==void 0&&(re.start=xe.start,re.end=xe.end);for(let he=0;he<xe.length;he+=3)re.push(xe[he]+ie,xe[he+1],xe[he+2]);return re}function ir(xe,ie){if(xe.transformed)return xe;let re=1<<xe.z,he=xe.x,De=xe.y;for(let Ie of xe.features){let He=Ie.geometry,nt=Ie.type;if(Ie.geometry=[],nt===1)for(let qe=0;qe<He.length;qe+=2)Ie.geometry.push(dr(He[qe],He[qe+1],ie,re,he,De));else for(let qe=0;qe<He.length;qe++){let st=[];for(let St=0;St<He[qe].length;St+=2)st.push(dr(He[qe][St],He[qe][St+1],ie,re,he,De));Ie.geometry.push(st)}}return xe.transformed=!0,xe}function dr(xe,ie,re,he,De,Ie){return[Math.round(re*(xe*he-De)),Math.round(re*(ie*he-Ie))]}function Rn(xe,ie,re,he,De){let Ie=ie===De.maxZoom?0:De.tolerance/((1<<ie)*De.extent),He={features:[],numPoints:0,numSimplified:0,numFeatures:xe.length,source:null,x:re,y:he,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let nt of xe)gs(He,nt,Ie,De);return He}function gs(xe,ie,re,he){let De=ie.geometry,Ie=ie.type,He=[];if(xe.minX=Math.min(xe.minX,ie.minX),xe.minY=Math.min(xe.minY,ie.minY),xe.maxX=Math.max(xe.maxX,ie.maxX),xe.maxY=Math.max(xe.maxY,ie.maxY),Ie==="Point"||Ie==="MultiPoint")for(let nt=0;nt<De.length;nt+=3)He.push(De[nt],De[nt+1]),xe.numPoints++,xe.numSimplified++;else if(Ie==="LineString")ks(He,De,xe,re,!1,!1);else if(Ie==="MultiLineString"||Ie==="Polygon")for(let nt=0;nt<De.length;nt++)ks(He,De[nt],xe,re,Ie==="Polygon",nt===0);else if(Ie==="MultiPolygon")for(let nt=0;nt<De.length;nt++){let qe=De[nt];for(let st=0;st<qe.length;st++)ks(He,qe[st],xe,re,!0,st===0)}if(He.length){let nt=ie.tags||null;if(Ie==="LineString"&&he.lineMetrics){nt={};for(let st in ie.tags)nt[st]=ie.tags[st];nt.mapbox_clip_start=De.start/De.size,nt.mapbox_clip_end=De.end/De.size}let qe={geometry:He,type:Ie==="Polygon"||Ie==="MultiPolygon"?3:Ie==="LineString"||Ie==="MultiLineString"?2:1,tags:nt};ie.id!==null&&(qe.id=ie.id),xe.features.push(qe)}}function ks(xe,ie,re,he,De,Ie){let He=he*he;if(he>0&&ie.size<(De?He:he))return void(re.numPoints+=ie.length/3);let nt=[];for(let qe=0;qe<ie.length;qe+=3)(he===0||ie[qe+2]>He)&&(re.numSimplified++,nt.push(ie[qe],ie[qe+1])),re.numPoints++;De&&function(qe,st){let St=0;for(let It=0,ni=qe.length,Ci=ni-2;It<ni;Ci=It,It+=2)St+=(qe[It]-qe[Ci])*(qe[It+1]+qe[Ci+1]);if(St>0===st)for(let It=0,ni=qe.length;It<ni/2;It+=2){let Ci=qe[It],Bi=qe[It+1];qe[It]=qe[ni-2-It],qe[It+1]=qe[ni-1-It],qe[ni-2-It]=Ci,qe[ni-1-It]=Bi}}(nt,Ie),xe.push(nt)}let Xn={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ys{constructor(ie,re){let he=(re=this.options=function(Ie,He){for(let nt in He)Ie[nt]=He[nt];return Ie}(Object.create(Xn),re)).debug;if(he&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");let De=function(Ie,He){let nt=[];if(Ie.type==="FeatureCollection")for(let qe=0;qe<Ie.features.length;qe++)Zt(nt,Ie.features[qe],He,qe);else Zt(nt,Ie.type==="Feature"?Ie:{geometry:Ie},He);return nt}(ie,re);this.tiles={},this.tileCoords=[],he&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),De=function(Ie,He){let nt=He.buffer/He.extent,qe=Ie,st=Jt(Ie,1,-1-nt,nt,0,-1,2,He),St=Jt(Ie,1,1-nt,2+nt,0,-1,2,He);return(st||St)&&(qe=Jt(Ie,1,-nt,1+nt,0,-1,2,He)||[],st&&(qe=yi(st,1).concat(qe)),St&&(qe=qe.concat(yi(St,-1)))),qe}(De,re),De.length&&this.splitTile(De,0,0,0),he&&(De.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ie,re,he,De,Ie,He,nt){let qe=[ie,re,he,De],st=this.options,St=st.debug;for(;qe.length;){De=qe.pop(),he=qe.pop(),re=qe.pop(),ie=qe.pop();let It=1<<re,ni=On(re,he,De),Ci=this.tiles[ni];if(!Ci&&(St>1&&console.time("creation"),Ci=this.tiles[ni]=Rn(ie,re,he,De,st),this.tileCoords.push({z:re,x:he,y:De}),St)){St>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,he,De,Ci.numFeatures,Ci.numPoints,Ci.numSimplified),console.timeEnd("creation"));let Yn=`z${re}`;this.stats[Yn]=(this.stats[Yn]||0)+1,this.total++}if(Ci.source=ie,Ie==null){if(re===st.indexMaxZoom||Ci.numPoints<=st.indexMaxPoints)continue}else{if(re===st.maxZoom||re===Ie)continue;if(Ie!=null){let Yn=Ie-re;if(he!==He>>Yn||De!==nt>>Yn)continue}}if(Ci.source=null,ie.length===0)continue;St>1&&console.time("clipping");let Bi=.5*st.buffer/st.extent,Qi=.5-Bi,fi=.5+Bi,Sr=1+Bi,_i=null,un=null,qi=null,vr=null,qn=Jt(ie,It,he-Bi,he+fi,0,Ci.minX,Ci.maxX,st),Zr=Jt(ie,It,he+Qi,he+Sr,0,Ci.minX,Ci.maxX,st);ie=null,qn&&(_i=Jt(qn,It,De-Bi,De+fi,1,Ci.minY,Ci.maxY,st),un=Jt(qn,It,De+Qi,De+Sr,1,Ci.minY,Ci.maxY,st),qn=null),Zr&&(qi=Jt(Zr,It,De-Bi,De+fi,1,Ci.minY,Ci.maxY,st),vr=Jt(Zr,It,De+Qi,De+Sr,1,Ci.minY,Ci.maxY,st),Zr=null),St>1&&console.timeEnd("clipping"),qe.push(_i||[],re+1,2*he,2*De),qe.push(un||[],re+1,2*he,2*De+1),qe.push(qi||[],re+1,2*he+1,2*De),qe.push(vr||[],re+1,2*he+1,2*De+1)}}getTile(ie,re,he){ie=+ie,re=+re,he=+he;let De=this.options,{extent:Ie,debug:He}=De;if(ie<0||ie>24)return null;let nt=1<<ie,qe=On(ie,re=re+nt&nt-1,he);if(this.tiles[qe])return ir(this.tiles[qe],Ie);He>1&&console.log("drilling down to z%d-%d-%d",ie,re,he);let st,St=ie,It=re,ni=he;for(;!st&&St>0;)St--,It>>=1,ni>>=1,st=this.tiles[On(St,It,ni)];return st&&st.source?(He>1&&(console.log("found parent tile z%d-%d-%d",St,It,ni),console.time("drilling down")),this.splitTile(st.source,St,It,ni,ie,re,he),He>1&&console.timeEnd("drilling down"),this.tiles[qe]?ir(this.tiles[qe],Ie):null):null}}function On(xe,ie,re){return 32*((1<<xe)*re+ie)+xe}function vc(xe,ie){let re=xe.tileID.canonical;if(!this._geoJSONIndex)return ie(null,null);let he=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!he)return ie(null,null);let De=new j(he.features),Ie=Mt(De);Ie.byteOffset===0&&Ie.byteLength===Ie.buffer.byteLength||(Ie=new Uint8Array(Ie)),ie(null,{vectorTile:De,rawData:Ie.buffer})}class Hl extends I{constructor(ie,re,he,De,Ie,He){super(ie,re,he,De,vc,He),Ie&&(this.loadGeoJSON=Ie),this._dynamicIndex=new Y}loadData(ie,re){let he=ie&&ie.request,De=he&&he.collectResourceTiming;this.loadGeoJSON(ie,(Ie,He)=>{if(Ie||!He)return re(Ie);if(typeof He!="object")return re(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`));{try{if(ie.filter){let qe=n.z(ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(qe.result==="error")throw new Error(qe.value.map(st=>`${st.key}: ${st.message}`).join(", "));He.features=He.features.filter(st=>qe.value.evaluate({zoom:0},st))}ie.dynamic?(He.type==="Feature"&&(He={type:"FeatureCollection",features:[He]}),ie.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(He.features,this.loaded),ie.cluster&&(He.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ie.cluster?new $t(function({superclusterOptions:qe,clusterProperties:st}){if(!st||!qe)return qe;let St={},It={},ni={accumulated:null,zoom:0},Ci={properties:null},Bi=Object.keys(st);for(let Qi of Bi){let[fi,Sr]=st[Qi],_i=n.z(Sr),un=n.z(typeof fi=="string"?[fi,["accumulated"],["get",Qi]]:fi);St[Qi]=_i.value,It[Qi]=un.value}return qe.map=Qi=>{Ci.properties=Qi;let fi={};for(let Sr of Bi)fi[Sr]=St[Sr].evaluate(ni,Ci);return fi},qe.reduce=(Qi,fi)=>{Ci.properties=fi;for(let Sr of Bi)ni.accumulated=Qi[Sr],Qi[Sr]=It[Sr].evaluate(ni,Ci)},qe}(ie)).load(He.features):ie.dynamic?this._dynamicIndex:function(qe,st){return new ys(qe,st)}(He,ie.geojsonVtOptions)}catch(qe){return re(qe)}let nt={};if(De){let qe=c(he);qe&&(nt.resourceTiming={},nt.resourceTiming[ie.source]=JSON.parse(JSON.stringify(qe)))}re(null,nt)}})}reloadTile(ie,re){let he=this.loaded;return he&&he[ie.uid]?ie.partial?re(null,void 0):super.reloadTile(ie,re):this.loadTile(ie,re)}loadGeoJSON(ie,re){if(ie.request)n.h(ie.request,re);else{if(typeof ie.data!="string")return re(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`));try{return re(null,JSON.parse(ie.data))}catch{return re(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ie,re){try{re(null,this._geoJSONIndex.getClusterExpansionZoom(ie.clusterId))}catch(he){re(he)}}getClusterChildren(ie,re){try{re(null,this._geoJSONIndex.getChildren(ie.clusterId))}catch(he){re(he)}}getClusterLeaves(ie,re){try{re(null,this._geoJSONIndex.getLeaves(ie.clusterId,ie.limit,ie.offset))}catch(he){re(he)}}}class _c{constructor(ie,re){this.tileID=new n.aQ(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),this.tileZoom=ie.tileZoom,this.uid=ie.uid,this.zoom=ie.zoom,this.canonical=ie.tileID.canonical,this.pixelRatio=ie.pixelRatio,this.tileSize=ie.tileSize,this.source=ie.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ie.projection,this.brightness=re}parse(ie,re,he,De){this.status="parsing";let Ie=new n.aQ(he.tileID.overscaledZ,he.tileID.wrap,he.tileID.canonical.z,he.tileID.canonical.x,he.tileID.canonical.y),He={},nt=re.familiesBySource[he.source],qe=new n.dQ(Ie,he.promoteId);return qe.bucketLayerIDs=[],qe.is3DTile=!0,n.e6(ie).then(st=>{if(!st)return De(new Error("Could not parse tile"));let St=n.e7(st,1/n.b7(he.tileID.canonical)),It=st.json.extensionsUsed&&st.json.extensionsUsed.includes("MAPBOX_mesh_features")||st.json.asset.extras&&st.json.asset.extras.MAPBOX_mesh_features,ni=st.json.extensionsUsed&&st.json.extensionsUsed.includes("EXT_meshopt_compression"),Ci=new n.Y(this.zoom,{brightness:this.brightness});for(let Bi in nt)for(let Qi of nt[Bi]){let fi=Qi[0];qe.bucketLayerIDs.push(Qi.map(_i=>_i.id)),fi.recalculate(Ci,[]);let Sr=new n.e8(St,Ie,It,ni,this.brightness,qe);It||(Sr.needsUpload=!0),He[fi.fqid]=Sr,Sr.evaluate(fi)}this.status="done",De(null,{buckets:He,featureIndex:qe})}).catch(st=>De(new Error(st.message)))}}class cs{constructor(ie,re,he,De,Ie,He){this.actor=ie,this.layerIndex=re,this.brightness=He,this.loading={},this.loaded={}}loadTile(ie,re){let he=ie.uid,De=this.loading[he]=new _c(ie,this.brightness);n.e5(ie.request,(Ie,He)=>{let nt=!this.loading[he];return delete this.loading[he],nt||Ie?(De.status="done",nt||(this.loaded[he]=De),re(Ie)):He&&He.byteLength!==0?void De.parse(He,this.layerIndex,ie,(qe,st)=>{De.status="done",this.loaded=this.loaded||{},this.loaded[he]=De,qe||!st?re(qe):re(null,st)}):(De.status="done",this.loaded[he]=De,re())})}reloadTile(ie,re){let he=this.loaded,De=ie.uid;if(he&&he[De]){let Ie=he[De];Ie.projection=ie.projection,Ie.brightness=ie.brightness;let He=(nt,qe)=>{Ie.reloadCallback&&(delete Ie.reloadCallback,this.loadTile(ie,re)),re(nt,qe)};Ie.status==="parsing"?Ie.reloadCallback=He:Ie.status==="done"&&this.loadTile(ie,re)}}abortTile(ie,re){let he=ie.uid;this.loading[he]&&delete this.loading[he],re()}removeTile(ie,re){let he=this.loaded,De=ie.uid;he&&he[De]&&delete he[De],re()}}class Ze{constructor(ie){this.self=ie,this.actor=new n.e9(ie,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=n.aK({name:"mercator"}),this.workerSourceTypes={vector:I,geojson:Hl,"batched-model":cs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(re,he)=>{if(this.workerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.workerSourceTypes[re]=he},this.self.registerRTLTextPlugin=re=>{if(n.ea.isParsed())throw new Error("RTL text plugin already registered.");n.ea.applyArabicShaping=re.applyArabicShaping,n.ea.processBidirectionalText=re.processBidirectionalText,n.ea.processStyledBidirectionalText=re.processStyledBidirectionalText}}clearCaches(ie,re,he){delete this.layerIndexes[ie],delete this.availableImages[ie],delete this.workerSources[ie],delete this.demWorkerSources[ie],delete this.rasterArrayWorkerSource,he()}checkIfReady(ie,re,he){he()}setReferrer(ie,re){this.referrer=re}spriteLoaded(ie,{scope:re,isLoaded:he}){if(this.isSpriteLoaded[ie]||(this.isSpriteLoaded[ie]={}),this.isSpriteLoaded[ie][re]=he,this.workerSources[ie]&&this.workerSources[ie][re])for(let De in this.workerSources[ie][re]){let Ie=this.workerSources[ie][re][De];for(let He in Ie){let nt=Ie[He];nt instanceof I&&(nt.isSpriteLoaded=he,nt.fire(new n.g("isSpriteLoaded")))}}}setImages(ie,{scope:re,images:he},De){if(this.availableImages[ie]||(this.availableImages[ie]={}),this.availableImages[ie][re]=he,this.workerSources[ie]&&this.workerSources[ie][re]){for(let Ie in this.workerSources[ie][re]){let He=this.workerSources[ie][re][Ie];for(let nt in He)He[nt].availableImages=he}De()}else De()}setProjection(ie,re){this.projections[ie]=n.aK(re)}setBrightness(ie,re,he){this.brightness=re,he()}setLayers(ie,re,he){this.getLayerIndex(ie,re.scope).replace(re.layers,re.options),he()}updateLayers(ie,re,he){this.getLayerIndex(ie,re.scope).update(re.layers,re.removedIds,re.options),he()}loadTile(ie,re,he){re.projection=this.projections[ie]||this.defaultProjection,this.getWorkerSource(ie,re.type,re.source,re.scope).loadTile(re,he)}loadDEMTile(ie,re,he){this.getDEMWorkerSource(ie,re.source,re.scope).loadTile(re,he)}decodeRasterArray(ie,re,he){this.getRasterArrayWorkerSource().decodeRasterArray(re,he)}reloadTile(ie,re,he){re.projection=this.projections[ie]||this.defaultProjection,this.getWorkerSource(ie,re.type,re.source,re.scope).reloadTile(re,he)}abortTile(ie,re,he){this.getWorkerSource(ie,re.type,re.source,re.scope).abortTile(re,he)}removeTile(ie,re,he){this.getWorkerSource(ie,re.type,re.source,re.scope).removeTile(re,he)}removeSource(ie,re,he){if(!(this.workerSources[ie]&&this.workerSources[ie][re.scope]&&this.workerSources[ie][re.scope][re.type]&&this.workerSources[ie][re.scope][re.type][re.source]))return;let De=this.workerSources[ie][re.scope][re.type][re.source];delete this.workerSources[ie][re.scope][re.type][re.source],De.removeSource!==void 0?De.removeSource(re,he):he()}loadWorkerSource(ie,re,he){try{this.self.importScripts(re.url),he()}catch(De){he(De.toString())}}syncRTLPluginState(ie,re,he){try{n.ea.setState(re);let De=n.ea.getPluginURL();if(n.ea.isLoaded()&&!n.ea.isParsed()&&De!=null){this.self.importScripts(De);let Ie=n.ea.isParsed();he(Ie?void 0:new Error(`RTL Text Plugin failed to import scripts from ${De}`),Ie)}}catch(De){he(De.toString())}}setDracoUrl(ie,re){this.dracoUrl=re}getAvailableImages(ie,re){this.availableImages[ie]||(this.availableImages[ie]={});let he=this.availableImages[ie][re];return he||(he=[]),he}getLayerIndex(ie,re){this.layerIndexes[ie]||(this.layerIndexes[ie]={});let he=this.layerIndexes[ie][re];return he||(he=this.layerIndexes[ie][re]=new f,he.scope=re),he}getWorkerSource(ie,re,he,De){return this.workerSources[ie]||(this.workerSources[ie]={}),this.workerSources[ie][De]||(this.workerSources[ie][De]={}),this.workerSources[ie][De][re]||(this.workerSources[ie][De][re]={}),this.isSpriteLoaded[ie]||(this.isSpriteLoaded[ie]={}),this.workerSources[ie][De][re][he]||(this.workerSources[ie][De][re][he]=new this.workerSourceTypes[re]({send:(Ie,He,nt,qe,st,St)=>{this.actor.send(Ie,He,nt,ie,st,St)},scheduler:this.actor.scheduler},this.getLayerIndex(ie,De),this.getAvailableImages(ie,De),this.isSpriteLoaded[ie][De],void 0,this.brightness)),this.workerSources[ie][De][re][he]}getDEMWorkerSource(ie,re,he){return this.demWorkerSources[ie]||(this.demWorkerSources[ie]={}),this.demWorkerSources[ie][he]||(this.demWorkerSources[ie][he]={}),this.demWorkerSources[ie][he][re]||(this.demWorkerSources[ie][he][re]=new P),this.demWorkerSources[ie][he][re]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new O),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ie,re){n.eb(re)}getWorkerPerformanceMetrics(ie,re,he){he(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ze(self)),Ze}),r(["./shared"],function(n){var c=u;function u(_){return!function(h){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,M,C=new Blob([""],{type:"text/javascript"}),R=URL.createObjectURL(C);try{M=new Worker(R),b=!0}catch{b=!1}return M&&M.terminate(),URL.revokeObjectURL(R),b}()?function(){var b=document.createElement("canvas");b.width=b.height=1;var M=b.getContext("2d");if(!M)return!1;var C=M.getImageData(0,0,1,1);return C&&C.width===b.width}()?(p[g=h&&h.failIfMajorPerformanceCaveat]===void 0&&(p[g]=function(b){var M,C=function(R){var z=document.createElement("canvas"),B=Object.create(u.webGLContextAttributes);return B.failIfMajorPerformanceCaveat=R,z.getContext("webgl2",B)}(b);if(!C)return!1;try{M=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!M||C.isContextLost())&&(C.shaderSource(M,"void main() {}"),C.compileShader(M),C.getShaderParameter(M,C.COMPILE_STATUS)===!0)}(g)),p[g]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var g}(_)}var p={};function f(_,h,g){let b=document.createElement(_);return h!=null&&(b.className=h),g&&g.appendChild(b),b}function x(_,h,g){let b=document.createElementNS("http://www.w3.org/2000/svg",_);for(let M of Object.keys(h))b.setAttributeNS(null,M,String(h[M]));return g&&g.appendChild(b),b}u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let w=typeof document<"u"?document.documentElement&&document.documentElement.style:null,E=w&&w.userSelect!==void 0?"userSelect":"WebkitUserSelect",A;function I(){w&&E&&(A=w[E],w[E]="none")}function P(){w&&E&&(w[E]=A)}function O(_){_.preventDefault(),_.stopPropagation(),window.removeEventListener("click",O,!0)}function k(){window.addEventListener("click",O,!0),window.setTimeout(()=>{window.removeEventListener("click",O,!0)},0)}function U(_,h){let g=_.getBoundingClientRect();return $(_,g,h)}function j(_,h){let g=_.getBoundingClientRect(),b=[];for(let M=0;M<h.length;M++)b.push($(_,g,h[M]));return b}function V(_){return window.InstallTrigger!==void 0&&_.button===2&&_.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:_.button}function $(_,h,g){let b=_.offsetWidth===h.width?1:_.offsetWidth/h.width;return new n.P((g.clientX-h.left)*b,(g.clientY-h.top)*b)}class Y{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(h,g){this._updatedSourceCaches[h]=g,this.setDirty()}discardSourceCacheUpdate(h){delete this._updatedSourceCaches[h]}updateLayer(h){let g=h.scope;this._updatedLayers[g]=this._updatedLayers[g]||new Set,this._updatedLayers[g].add(h.id),this.setDirty()}removeLayer(h){let g=h.scope;this._removedLayers[g]=this._removedLayers[g]||{},this._updatedLayers[g]=this._updatedLayers[g]||new Set,this._removedLayers[g][h.id]=h,this._updatedLayers[g].delete(h.id),this._updatedPaintProps.delete(h.fqid),this.setDirty()}getRemovedLayer(h){return this._removedLayers[h.scope]?this._removedLayers[h.scope][h.id]:null}discardLayerRemoval(h){this._removedLayers[h.scope]&&delete this._removedLayers[h.scope][h.id]}getLayerUpdatesByScope(){let h={};for(let g in this._updatedLayers)h[g]=h[g]||{},h[g].updatedIds=Array.from(this._updatedLayers[g].values());for(let g in this._removedLayers)h[g]=h[g]||{},h[g].removedIds=Object.keys(this._removedLayers[g]);return h}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(h){this._updatedPaintProps.add(h.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(h){this._updatedImages.add(h),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let J={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class X{constructor(h,g,b,M,C,R){this.length=g.length,this.attributes=b,this.itemSize=g.bytesPerElement,this.dynamicDraw=M,this.instanceCount=R,this.context=h;let z=h.gl;this.buffer=z.createBuffer(),h.bindVertexBuffer.set(this.buffer),z.bufferData(z.ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?z.DYNAMIC_DRAW:z.STATIC_DRAW),this.dynamicDraw||C||g.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(h){let g=this.context.gl;this.bind(),g.bufferSubData(g.ARRAY_BUFFER,0,h.arrayBuffer)}enableAttributes(h,g){for(let b=0;b<this.attributes.length;b++){let M=g.attributes[this.attributes[b].name];M!==void 0&&h.enableVertexAttribArray(M)}}setVertexAttribPointers(h,g,b){for(let M=0;M<this.attributes.length;M++){let C=this.attributes[M],R=g.attributes[C.name];R!==void 0&&h.vertexAttribPointer(R,C.components,h[J[C.type]],!1,this.itemSize,C.offset+this.itemSize*(b||0))}}setVertexAttribDivisor(h,g,b){for(let M=0;M<this.attributes.length;M++){let C=g.attributes[this.attributes[M].name];C!==void 0&&this.instanceCount&&this.instanceCount>0&&h.vertexAttribDivisor(C,b)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ee{constructor(h){this.gl=h.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(h){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class oe extends ee{getDefault(){return n.C.transparent}set(h){let g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)}}class le extends ee{getDefault(){return 1}set(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)}}class ve extends ee{getDefault(){return 0}set(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)}}class we extends ee{getDefault(){return[!0,!0,!0,!0]}set(h){let g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)}}class fe extends ee{getDefault(){return!0}set(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)}}class Ue extends ee{getDefault(){return 255}set(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)}}class Fe extends ee{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(h){let g=this.current;(h.func!==g.func||h.ref!==g.ref||h.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)}}class Pe extends ee{getDefault(){let h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]}set(h){let g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)}}class Ae extends ee{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let g=this.gl;h?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=h,this.dirty=!1}}class et extends ee{getDefault(){return[0,1]}set(h){let g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)}}class $e extends ee{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let g=this.gl;h?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=h,this.dirty=!1}}class rt extends ee{getDefault(){return this.gl.LESS}set(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)}}class Je extends ee{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let g=this.gl;h?g.enable(g.BLEND):g.disable(g.BLEND),this.current=h,this.dirty=!1}}class bt extends ee{getDefault(){let h=this.gl;return[h.ONE,h.ZERO,h.ONE,h.ZERO]}set(h){let g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.blendFuncSeparate(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)}}class ot extends ee{getDefault(){return n.C.transparent}set(h){let g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)}}class xt extends ee{getDefault(){return this.gl.FUNC_ADD}set(h){(h!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(h,h),this.current=h,this.dirty=!1)}}class Xe extends ee{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let g=this.gl;h?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=h,this.dirty=!1}}class kt extends ee{getDefault(){return this.gl.BACK}set(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)}}class yt extends ee{getDefault(){return this.gl.CCW}set(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)}}let Nt=class extends ee{getDefault(){return null}set(_){(_!==this.current||this.dirty)&&(this.gl.useProgram(_),this.current=_,this.dirty=!1)}};class Mt extends ee{getDefault(){return this.gl.TEXTURE0}set(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)}}class li extends ee{getDefault(){let h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]}set(h){let g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)}}class Qt extends ee{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;let g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,h),this.current=h,this.dirty=!1}}class Wt extends ee{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;let g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,h),this.current=h,this.dirty=!1}}class Di extends ee{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;let g=this.gl;g.bindTexture(g.TEXTURE_2D,h),this.current=h,this.dirty=!1}}class Ii extends ee{getDefault(){return null}set(h){if(h===this.current&&!this.dirty)return;let g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}}class Li extends ee{getDefault(){return null}set(h){let g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1}}class $t extends ee{getDefault(){return null}set(h){this.gl&&(h!==this.current||this.dirty)&&(this.gl.bindVertexArray(h),this.current=h,this.dirty=!1)}}class Ut extends ee{getDefault(){return 4}set(h){if(h===this.current&&!this.dirty)return;let g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}}class wi extends ee{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}}class Hi extends ee{getDefault(){return!1}set(h){if(h===this.current&&!this.dirty)return;let g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}}class lr extends ee{constructor(h,g){super(h),this.context=h,this.parent=g}getDefault(){return null}}class Ke extends lr{setDirty(){this.dirty=!0}set(h){if(h===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}}class Re extends lr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(h){if(h===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,this.attachment(),g.RENDERBUFFER,h),this.current=h,this.dirty=!1}}class Lt extends lr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(h){if(h===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,this.attachment(),g.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}}class pi extends Re{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ee{constructor(h,g,b,M,C){this.context=h,this.width=g,this.height=b;let R=this.framebuffer=h.gl.createFramebuffer();M&&(this.colorAttachment=new Ke(h,R)),C&&(this.depthAttachmentType=C,this.depthAttachment=C==="renderbuffer"?new Re(h,R):new Lt(h,R))}destroy(){let h=this.context.gl;if(this.colorAttachment){let g=this.colorAttachment.get();g&&h.deleteTexture(g)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let g=this.depthAttachment.get();g&&h.deleteRenderbuffer(g)}else{let g=this.depthAttachment.get();g&&h.deleteTexture(g)}h.deleteFramebuffer(this.framebuffer)}}class Zt{constructor(h,g){this.gl=h,this.clearColor=new oe(this),this.clearDepth=new le(this),this.clearStencil=new ve(this),this.colorMask=new we(this),this.depthMask=new fe(this),this.stencilMask=new Ue(this),this.stencilFunc=new Fe(this),this.stencilOp=new Pe(this),this.stencilTest=new Ae(this),this.depthRange=new et(this),this.depthTest=new $e(this),this.depthFunc=new rt(this),this.blend=new Je(this),this.blendFunc=new bt(this),this.blendColor=new ot(this),this.blendEquation=new xt(this),this.cullFace=new Xe(this),this.cullFaceSide=new kt(this),this.frontFace=new yt(this),this.program=new Nt(this),this.activeTexture=new Mt(this),this.viewport=new li(this),this.bindFramebuffer=new Qt(this),this.bindRenderbuffer=new Wt(this),this.bindTexture=new Di(this),this.bindVertexBuffer=new Ii(this),this.bindElementBuffer=new Li(this),this.bindVertexArrayOES=new $t(this),this.pixelStoreUnpack=new Ut(this),this.pixelStoreUnpackPremultiplyAlpha=new wi(this),this.pixelStoreUnpackFlipY=new Hi(this),this.options=g?me({},g):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=h.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=h.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=h.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=h.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=h.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=h.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=h.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE),this.maxPointSize=h.getParameter(h.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(h,g,b){return new n.I(this,h,g,b)}createVertexBuffer(h,g,b,M,C){return new X(this,h,g,b,M,C)}createRenderbuffer(h,g,b){let M=this.gl,C=M.createRenderbuffer();return this.bindRenderbuffer.set(C),M.renderbufferStorage(M.RENDERBUFFER,h,g,b),this.bindRenderbuffer.set(null),C}createFramebuffer(h,g,b,M){return new Ee(this,h,g,b,M)}clear({color:h,depth:g,stencil:b,colorMask:M}){let C=this.gl,R=0;h&&(R|=C.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set(M||[!0,!0,!0,!0])),g!==void 0&&(R|=C.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(g),this.depthMask.set(!0)),b!==void 0&&(R|=C.STENCIL_BUFFER_BIT,this.clearStencil.set(b),this.stencilMask.set(255)),C.clear(R)}setCullFace(h){h.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(h.mode),this.frontFace.set(h.frontFace))}setDepthMode(h){h.func!==this.gl.ALWAYS||h.mask?(this.depthTest.set(!0),this.depthFunc.set(h.func),this.depthMask.set(h.mask),this.depthRange.set(h.range)):this.depthTest.set(!1)}setStencilMode(h){h.test.func!==this.gl.ALWAYS||h.mask?(this.stencilTest.set(!0),this.stencilMask.set(h.mask),this.stencilOp.set([h.fail,h.depthFail,h.pass]),this.stencilFunc.set({func:h.test.func,ref:h.ref,mask:h.test.mask})):this.stencilTest.set(!1)}setColorMode(h){n.d(h.blendFunction,n.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(h.blendFunction),this.blendColor.set(h.blendColor),h.blendEquation?this.blendEquation.set(h.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(h.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Xi{constructor(h,g,b,M){let C={width:b[0],height:b[1],data:null},R=h.gl;this.targetColorTexture=new n.T(h,C,R.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new n.T(h,C,R.RGBA,{useMipmap:!1}),this.context=h,this.updateParticleTexture(g,M),this.lastInvalidatedAt=0}updateParticleTexture(h,g){if(this.particleTextureDimension===g.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let b=this.context.gl,M=g.width*g.height;this.particleTexture0=new n.T(this.context,g,b.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,g,b.RGBA,{premultiply:!1,useMipmap:!1});let C=new n.S;C.reserve(M);for(let R=0;R<M;R++)C.emplaceBack(R);this.particleIndexBuffer=this.context.createVertexBuffer(C,n.p.members,!0),this.particleSegment=n.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=g.width}update(h){return!(this.lastInvalidatedAt<h&&(this.lastInvalidatedAt=n.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class Pi extends n.E{constructor(h){super(),this.requestManager=h,this.models={"":{}},this.numModelsLoading={}}loadModel(h,g){return n.l(this.requestManager.transformRequest(g,n.R.Model).url).then(b=>{if(!b)return;let M=n.c(b),C=new n.M(h,void 0,void 0,M);return C.computeBoundsAndApplyParent(),C}).catch(b=>{if(b&&b.status===404)return null;this.fire(new n.f(new Error(`Could not load model ${h} from ${g}: ${b.message}`)))})}load(h,g){this.models[g]||(this.models[g]={});let b=Object.keys(h);this.numModelsLoading[g]=(this.numModelsLoading[g]||0)+b.length;let M=[];for(let C of b)M.push(this.loadModel(C,h[C]));Promise.allSettled(M).then(C=>{for(let R=0;R<C.length;R++){let{status:z,value:B}=C[R];z==="fulfilled"&&B&&(this.models[g][b[R]]={model:B,numReferences:1})}this.numModelsLoading[g]-=b.length,this.fire(new n.g("data",{dataType:"style"}))}).catch(C=>{this.fire(new n.f(new Error(`Could not load models: ${C.message}`)))})}isLoaded(){for(let h in this.numModelsLoading)if(this.numModelsLoading[h]>0)return!1;return!0}hasModel(h,g){return!!this.getModel(h,g)}getModel(h,g){return this.models[g]||(this.models[g]={}),this.models[g][h]?this.models[g][h].model:void 0}addModel(h,g,b){this.models[b]||(this.models[b]={}),this.hasModel(h,b)&&this.models[b][h].numReferences++,this.load({[h]:this.requestManager.normalizeModelURL(g)},b)}addModels(h,g){this.models[g]||(this.models[g]={});let b={};for(let M in h)this.models[g][M]={},b[M]=this.requestManager.normalizeModelURL(h[M]);this.load(b,g)}addModelsFromBucket(h,g){this.models[g]||(this.models[g]={});let b={};for(let M of h)this.hasModel(M,g)?this.models[g][M].numReferences++:b[M]=this.requestManager.normalizeModelURL(M);this.load(b,g)}removeModel(h,g){if(this.models[g]&&this.models[g][h]&&(this.models[g][h].numReferences--,this.models[g][h].numReferences===0)){let b=this.models[g][h].model;delete this.models[g][h],b.destroy()}}listModels(h){return this.models[h]||(this.models[h]={}),Object.keys(this.models[h])}upload(h,g){this.models[g]||(this.models[g]={});for(let b in this.models[g])this.models[g][b].model&&this.models[g][b].model.upload(h.context)}}function si(_){let{userImage:h}=_;return!!(h&&h.render&&h.render())&&(_.data.replace(new Uint8Array(h.data.buffer)),!0)}class vi extends n.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(h){this.images[h]={},this.loaded[h]=!1,this.updatedImages[h]={},this.patterns[h]={},this.callbackDispatchedThisFrame[h]={},this.atlasImage[h]=new n.j({width:1,height:1})}isLoaded(){for(let h in this.loaded)if(!this.loaded[h])return!1;return!0}setLoaded(h,g){if(this.loaded[g]!==h&&(this.loaded[g]=h,h)){for(let{ids:b,callback:M}of this.requestors)this._notify(b,g,M);this.requestors=[]}}hasImage(h,g){return!!this.getImage(h,g)}getImage(h,g){return this.images[g][h]}addImage(h,g,b){this._validate(h,b)&&(this.images[g][h]=b)}_validate(h,g){let b=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new n.f(new Error(`Image "${h}" has invalid "stretchX" value`))),b=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new n.f(new Error(`Image "${h}" has invalid "stretchY" value`))),b=!1),this._validateContent(g.content,g)||(this.fire(new n.f(new Error(`Image "${h}" has invalid "content" value`))),b=!1),b}_validateStretch(h,g){if(!h)return!0;let b=0;for(let M of h){if(M[0]<b||M[1]<M[0]||g<M[1])return!1;b=M[1]}return!0}_validateContent(h,g){return!(h&&(h.length!==4||h[0]<0||g.data.width<h[0]||h[1]<0||g.data.height<h[1]||h[2]<0||g.data.width<h[2]||h[3]<0||g.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))}updateImage(h,g,b){b.version=this.images[g][h].version+1,this.images[g][h]=b,this.updatedImages[g][h]=!0}removeImage(h,g){let b=this.images[g][h];delete this.images[g][h],delete this.patterns[g][h],b.userImage&&b.userImage.onRemove&&b.userImage.onRemove()}listImages(h){return Object.keys(this.images[h])}getImages(h,g,b){let M=!0,C=!!this.loaded[g];if(!C)for(let R of h)this.images[g][R]||(M=!1);C||M?this._notify(h,g,b):this.requestors.push({ids:h,scope:g,callback:b})}getUpdatedImages(h){return this.updatedImages[h]}_notify(h,g,b){let M={};for(let C of h){this.images[g][C]||this.fire(new n.g("styleimagemissing",{id:C}));let R=this.images[g][C];R?M[C]={data:R.data.clone(),pixelRatio:R.pixelRatio,sdf:R.sdf,version:R.version,stretchX:R.stretchX,stretchY:R.stretchY,content:R.content,hasRenderCallback:!!(R.userImage&&R.userImage.render)}:n.w(`Image "${C}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}b(null,M)}getPixelSize(h){let{width:g,height:b}=this.atlasImage[h];return{width:g,height:b}}getPattern(h,g,b){let M=this.patterns[g][h],C=this.getImage(h,g);if(!C)return null;if(M&&M.position.version===C.version)return M.position;if(M)M.position.version=C.version;else{let R={w:C.data.width+2,h:C.data.height+2,x:0,y:0},z=new n.m(R,C);this.patterns[g][h]={bin:R,position:z}}return this._updatePatternAtlas(g,b),this.patterns[g][h].position}bind(h,g){let b=h.gl,M=this.atlasTexture[g];M?this.dirty&&(M.update(this.atlasImage[g]),this.dirty=!1):(M=new n.T(h,this.atlasImage[g],b.RGBA),this.atlasTexture[g]=M),M.bind(b.LINEAR,b.CLAMP_TO_EDGE)}_updatePatternAtlas(h,g){let b=[];for(let z in this.patterns[h])b.push(this.patterns[h][z].bin);let{w:M,h:C}=n.k(b),R=this.atlasImage[h];R.resize({width:M||1,height:C||1});for(let z in this.patterns[h]){let{bin:B}=this.patterns[h][z],G=B.x+1,W=B.y+1,Z=this.images[h][z].data,te=Z.width,ne=Z.height;n.j.copy(Z,R,{x:0,y:0},{x:G,y:W},{width:te,height:ne},g),n.j.copy(Z,R,{x:0,y:ne-1},{x:G,y:W-1},{width:te,height:1},g),n.j.copy(Z,R,{x:0,y:0},{x:G,y:W+ne},{width:te,height:1},g),n.j.copy(Z,R,{x:te-1,y:0},{x:G-1,y:W},{width:1,height:ne},g),n.j.copy(Z,R,{x:0,y:0},{x:G+te,y:W},{width:1,height:ne},g)}this.dirty=!0}beginFrame(){for(let h in this.images)this.callbackDispatchedThisFrame[h]={}}dispatchRenderCallbacks(h,g){for(let b of h){if(this.callbackDispatchedThisFrame[g][b])continue;this.callbackDispatchedThisFrame[g][b]=!0;let M=this.images[g][b];si(M)&&this.updateImage(b,g,M)}}}function ki(_){let h=_.key,g=_.value,b=_.valueSpec||{},M=_.objectElementValidators||{},C=_.style,R=_.styleSpec,z=[],B=n.o(g);if(B!=="object")return[new n.V(h,g,`object expected, ${B} found`)];for(let G in g){let W=G.split(".")[0],Z;M[W]?Z=M[W]:b[W]?Z=cs:M["*"]?Z=M["*"]:b["*"]&&(Z=cs),Z?z=z.concat(Z({key:(h&&`${h}.`)+G,value:g[G],valueSpec:b[W]||b["*"],style:C,styleSpec:R,object:g,objectKey:G},g)):z.push(new n.n(h,g[G],`unknown property "${G}"`))}for(let G in b)M[G]||b[G].required&&b[G].default===void 0&&g[G]===void 0&&z.push(new n.V(h,g,`missing required property "${G}"`));return z}function Jt(_){let h=_.value,g=_.valueSpec,b=_.style,M=_.styleSpec,C=_.key,R=_.arrayElementValidator||cs;if(n.o(h)!=="array")return[new n.V(C,h,`array expected, ${n.o(h)} found`)];if(g.length&&h.length!==g.length)return[new n.V(C,h,`array length ${g.length} expected, length ${h.length} found`)];if(g["min-length"]&&h.length<g["min-length"])return[new n.V(C,h,`array length at least ${g["min-length"]} expected, length ${h.length} found`)];let z={type:g.value,values:g.values,minimum:g.minimum,maximum:g.maximum,function:void 0};M.$version<7&&(z.function=g.function),n.o(g.value)==="object"&&(z=g.value);let B=[];for(let G=0;G<h.length;G++)B=B.concat(R({array:h,arrayIndex:G,value:h[G],valueSpec:z,style:b,styleSpec:M,key:`${C}[${G}]`},!0));return B}function mr(_){let h=_.key,g=_.value,b=_.valueSpec,M=n.o(g);if(M==="number"&&g!=g&&(M="NaN"),M!=="number")return[new n.V(h,g,`number expected, ${M} found`)];if("minimum"in b){let C=b.minimum;if(n.o(b.minimum)==="array"&&(C=b.minimum[_.arrayIndex]),g<C)return[new n.V(h,g,`${g} is less than the minimum value ${C}`)]}if("maximum"in b){let C=b.maximum;if(n.o(b.maximum)==="array"&&(C=b.maximum[_.arrayIndex]),g>C)return[new n.V(h,g,`${g} is greater than the maximum value ${C}`)]}return[]}function $i(_){let h=_.valueSpec,g=n.u(_.value.type),b,M,C,R={},z=g!=="categorical"&&_.value.property===void 0,B=!z,G=n.o(_.value.stops)==="array"&&n.o(_.value.stops[0])==="array"&&n.o(_.value.stops[0][0])==="object",W=ki({key:_.key,value:_.value,valueSpec:_.styleSpec.function,style:_.style,styleSpec:_.styleSpec,objectElementValidators:{stops:function(ne){if(g==="identity")return[new n.V(ne.key,ne.value,'identity function may not have a "stops" property')];let ce=[],ue=ne.value;return ce=ce.concat(Jt({key:ne.key,value:ue,valueSpec:ne.valueSpec,style:ne.style,styleSpec:ne.styleSpec,arrayElementValidator:Z})),n.o(ue)==="array"&&ue.length===0&&ce.push(new n.V(ne.key,ue,"array must have at least one stop")),ce},default:function(ne){return cs({key:ne.key,value:ne.value,valueSpec:h,style:ne.style,styleSpec:ne.styleSpec})}}});return g==="identity"&&z&&W.push(new n.V(_.key,_.value,'missing required property "property"')),g==="identity"||_.value.stops||W.push(new n.V(_.key,_.value,'missing required property "stops"')),g==="exponential"&&_.valueSpec.expression&&!n.s(_.valueSpec)&&W.push(new n.V(_.key,_.value,"exponential functions not supported")),_.styleSpec.$version>=8&&(B&&!n.r(_.valueSpec)?W.push(new n.V(_.key,_.value,"property functions not supported")):z&&!n.t(_.valueSpec)&&W.push(new n.V(_.key,_.value,"zoom functions not supported"))),g!=="categorical"&&!G||_.value.property!==void 0||W.push(new n.V(_.key,_.value,'"property" property is required')),W;function Z(ne){let ce=[],ue=ne.value,de=ne.key;if(n.o(ue)!=="array")return[new n.V(de,ue,`array expected, ${n.o(ue)} found`)];if(ue.length!==2)return[new n.V(de,ue,`array length 2 expected, length ${ue.length} found`)];if(G){if(n.o(ue[0])!=="object")return[new n.V(de,ue,`object expected, ${n.o(ue[0])} found`)];if(ue[0].zoom===void 0)return[new n.V(de,ue,"object stop key must have zoom")];if(ue[0].value===void 0)return[new n.V(de,ue,"object stop key must have value")];let pe=n.u(ue[0].zoom);if(typeof pe!="number")return[new n.V(de,ue[0].zoom,"stop zoom values must be numbers")];if(C&&C>pe)return[new n.V(de,ue[0].zoom,"stop zoom values must appear in ascending order")];pe!==C&&(C=pe,M=void 0,R={}),ce=ce.concat(ki({key:`${de}[0]`,value:ue[0],valueSpec:{zoom:{}},style:ne.style,styleSpec:ne.styleSpec,objectElementValidators:{zoom:mr,value:te}}))}else ce=ce.concat(te({key:`${de}[0]`,value:ue[0],valueSpec:{},style:ne.style,styleSpec:ne.styleSpec},ue));return n.v(n.x(ue[1]))?ce.concat([new n.V(`${de}[1]`,ue[1],"expressions are not allowed in function stops.")]):ce.concat(cs({key:`${de}[1]`,value:ue[1],valueSpec:h,style:ne.style,styleSpec:ne.styleSpec}))}function te(ne,ce){let ue=n.o(ne.value),de=n.u(ne.value),pe=ne.value!==null?ne.value:ce;if(b){if(ue!==b)return[new n.V(ne.key,pe,`${ue} stop domain type must match previous stop domain type ${b}`)]}else b=ue;if(ue!=="number"&&ue!=="string"&&ue!=="boolean"&&typeof de!="number"&&typeof de!="string"&&typeof de!="boolean")return[new n.V(ne.key,pe,"stop domain value must be a number, string, or boolean")];if(ue!=="number"&&g!=="categorical"){let Me=`number expected, ${ue} found`;return n.r(h)&&g===void 0&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(ne.key,pe,Me)]}return g!=="categorical"||ue!=="number"||typeof de=="number"&&isFinite(de)&&Math.floor(de)===de?g!=="categorical"&&ue==="number"&&typeof de=="number"&&typeof M=="number"&&M!==void 0&&de<M?[new n.V(ne.key,pe,"stop domain values must appear in ascending order")]:(M=de,g==="categorical"&&de in R?[new n.V(ne.key,pe,"stop domain values must be unique")]:(R[de]=!0,[])):[new n.V(ne.key,pe,`integer expected, found ${String(de)}`)]}}function Hr(_){let h=(_.expressionContext==="property"?n.y:n.z)(n.x(_.value),_.valueSpec);if(h.result==="error")return h.value.map(b=>new n.V(`${_.key}${b.key}`,_.value,b.message));let g=h.value.expression||h.value._styleExpression.expression;if(_.expressionContext==="property"&&_.propertyKey==="text-font"&&!g.outputDefined())return[new n.V(_.key,_.value,`Invalid data expression for "${_.propertyKey}". Output values must be contained as literals within the expression.`)];if(_.expressionContext==="property"&&_.propertyType==="layout"&&!n.A(g))return[new n.V(_.key,_.value,'"feature-state" data expressions are not supported with layout properties.')];if(_.expressionContext==="filter")return Sn(g,_);if(_.expressionContext&&_.expressionContext.indexOf("cluster")===0){if(!n.B(g,["zoom","feature-state"]))return[new n.V(_.key,_.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(_.expressionContext==="cluster-initial"&&!n.D(g))return[new n.V(_.key,_.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Sn(_,h){let g=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(h.valueSpec&&h.valueSpec.expression)for(let M of h.valueSpec.expression.parameters)g.delete(M);if(g.size===0)return[];let b=[];return _ instanceof n.F&&g.has(_.name)?[new n.V(h.key,h.value,`["${_.name}"] expression is not supported in a filter for a ${h.object.type} layer with id: ${h.object.id}`)]:(_.eachChild(M=>{b.push(...Sn(M,h))}),b)}function kr(_){let h=_.key,g=_.value,b=_.valueSpec,M=[];return Array.isArray(b.values)?b.values.indexOf(n.u(g))===-1&&M.push(new n.V(h,g,`expected one of [${b.values.join(", ")}], ${JSON.stringify(g)} found`)):Object.keys(b.values).indexOf(n.u(g))===-1&&M.push(new n.V(h,g,`expected one of [${Object.keys(b.values).join(", ")}], ${JSON.stringify(g)} found`)),M}function wt(_){return n.H(n.x(_.value))?Hr(n.q({},_,{expressionContext:"filter",valueSpec:_.styleSpec[`filter_${_.layerType||"fill"}`]})):Yt(_)}function Yt(_){let h=_.value,g=_.key;if(n.o(h)!=="array")return[new n.V(g,h,`array expected, ${n.o(h)} found`)];let b=_.styleSpec,M,C=[];if(h.length<1)return[new n.V(g,h,"filter array must have at least 1 element")];switch(C=C.concat(kr({key:`${g}[0]`,value:h[0],valueSpec:b.filter_operator,style:_.style,styleSpec:_.styleSpec})),n.u(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&n.u(h[1])==="$type"&&C.push(new n.V(g,h,`"$type" cannot be use with operator "${h[0]}"`));case"==":case"!=":h.length!==3&&C.push(new n.V(g,h,`filter array for operator "${h[0]}" must have 3 elements`));case"in":case"!in":h.length>=2&&(M=n.o(h[1]),M!=="string"&&C.push(new n.V(`${g}[1]`,h[1],`string expected, ${M} found`)));for(let R=2;R<h.length;R++)M=n.o(h[R]),n.u(h[1])==="$type"?C=C.concat(kr({key:`${g}[${R}]`,value:h[R],valueSpec:b.geometry_type,style:_.style,styleSpec:_.styleSpec})):M!=="string"&&M!=="number"&&M!=="boolean"&&C.push(new n.V(`${g}[${R}]`,h[R],`string, number, or boolean expected, ${M} found`));break;case"any":case"all":case"none":for(let R=1;R<h.length;R++)C=C.concat(Yt({key:`${g}[${R}]`,value:h[R],style:_.style,styleSpec:_.styleSpec}));break;case"has":case"!has":M=n.o(h[1]),h.length!==2?C.push(new n.V(g,h,`filter array for "${h[0]}" operator must have 2 elements`)):M!=="string"&&C.push(new n.V(`${g}[1]`,h[1],`string expected, ${M} found`))}return C}function yi(_,h){let g=_.key,b=_.style,M=_.layer,C=_.styleSpec,R=_.value,z=_.objectKey,B=C[`${h}_${_.layerType}`];if(!B)return[];let G=z.match(/^(.*)-transition$/);if(h==="paint"&&G&&B[G[1]]&&B[G[1]].transition)return cs({key:g,value:R,valueSpec:C.transition,style:b,styleSpec:C});let W=_.valueSpec||B[z];if(!W)return[new n.n(g,R,`unknown property "${z}"`)];let Z;if(n.o(R)==="string"&&n.r(W)&&!W.tokens&&(Z=/^{([^}]+)}$/.exec(R))){let ne=`\`{ "type": "identity", "property": ${Z?JSON.stringify(Z[1]):'"_"'} }\``;return[new n.V(g,R,`"${z}" does not support interpolation syntax
Use an identity property function instead: ${ne}.`)]}let te=[];if(_.layerType==="symbol")z!=="text-field"||!b||b.glyphs||b.imports||te.push(new n.V(g,R,'use of "text-field" requires a style "glyphs" property')),z==="text-font"&&n.J(n.x(R))&&n.u(R.type)==="identity"&&te.push(new n.V(g,R,'"text-font" does not support identity functions'));else if(_.layerType==="model"&&h==="paint"&&M&&M.layout&&M.layout.hasOwnProperty("model-id")&&n.r(W)&&(n.K(W)||n.t(W))){let ne=n.y(n.x(R),W),ce=ne.value.expression||ne.value._styleExpression.expression;ce&&!n.B(ce,["measure-light"])&&(z==="model-emissive-strength"&&n.D(ce)&&n.A(ce)||te.push(new n.V(g,R,`${z} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return te.concat(cs({key:_.key,value:R,valueSpec:W,style:b,styleSpec:C,expressionContext:"property",propertyType:h,propertyKey:z}))}function Ai(_){return yi(_,"paint")}function ir(_){return yi(_,"layout")}function dr(_){let h=[],g=_.value,b=_.key,M=_.style,C=_.styleSpec;g.type||g.ref||h.push(new n.V(b,g,'either "type" or "ref" is required'));let R=n.u(g.type),z=n.u(g.ref);if(g.id){let B=n.u(g.id);for(let G=0;G<_.arrayIndex;G++){let W=M.layers[G];n.u(W.id)===B&&h.push(new n.V(b,g.id,`duplicate layer id "${g.id}", previously used at line ${W.id.__line__}`))}}if("ref"in g){let B;["type","source","source-layer","filter","layout"].forEach(G=>{G in g&&h.push(new n.V(b,g[G],`"${G}" is prohibited for ref layers`))}),M.layers.forEach(G=>{n.u(G.id)===z&&(B=G)}),B?B.ref?h.push(new n.V(b,g.ref,"ref cannot reference another ref layer")):R=n.u(B.type):typeof z=="string"&&h.push(new n.V(b,g.ref,`ref layer "${z}" not found`))}else if(R!=="background"&&R!=="sky"&&R!=="slot")if(g.source){let B=M.sources&&M.sources[g.source],G=B&&n.u(B.type);B?G==="vector"&&R==="raster"?h.push(new n.V(b,g.source,`layer "${g.id}" requires a raster source`)):G==="raster"&&R!=="raster"?h.push(new n.V(b,g.source,`layer "${g.id}" requires a vector source`)):G!=="vector"||g["source-layer"]?G==="raster-dem"&&R!=="hillshade"?h.push(new n.V(b,g.source,"raster-dem source can only be used with layer type 'hillshade'.")):G!=="raster-array"||["raster","raster-particle"].includes(R)?R!=="line"||!g.paint||!g.paint["line-gradient"]&&!g.paint["line-trim-offset"]||G==="geojson"&&B.lineMetrics?R==="raster-particle"&&G!=="raster-array"&&h.push(new n.V(b,g.source,`layer "${g.id}" requires a 'raster-array' source.`)):h.push(new n.V(b,g,`layer "${g.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):h.push(new n.V(b,g.source,"raster-array source can only be used with layer type 'raster'.")):h.push(new n.V(b,g,`layer "${g.id}" must specify a "source-layer"`)):h.push(new n.V(b,g.source,`source "${g.source}" not found`))}else h.push(new n.V(b,g,'missing required property "source"'));return h=h.concat(ki({key:b,value:g,valueSpec:C.layer,style:_.style,styleSpec:_.styleSpec,objectElementValidators:{"*":()=>[],type:()=>cs({key:`${b}.type`,value:g.type,valueSpec:C.layer.type,style:_.style,styleSpec:_.styleSpec,object:g,objectKey:"type"}),filter:B=>wt(n.q({layerType:R},B)),layout:B=>ki({layer:g,key:B.key,value:B.value,valueSpec:{},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{"*":G=>ir(n.q({layerType:R},G))}}),paint:B=>ki({layer:g,key:B.key,value:B.value,valueSpec:{},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{"*":G=>Ai(n.q({layerType:R,layer:g},G))}})}})),h}function Rn(_){let h=_.value,g=_.key,b=n.o(h);return b!=="string"?[new n.V(g,h,`string expected, ${b} found`)]:[]}let gs={promoteId:function({key:_,value:h}){if(n.o(h)==="string")return Rn({key:_,value:h});{let g=[];for(let b in h)g.push(...Rn({key:`${_}.${b}`,value:h[b]}));return g}}};function ks(_){let h=_.value,g=_.key,b=_.styleSpec,M=_.style;if(!h.type)return[new n.V(g,h,'"type" is required')];let C=n.u(h.type),R=[];switch(["vector","raster","raster-dem","raster-array"].includes(C)&&(h.url||h.tiles||R.push(new n.n(g,h,'Either "url" or "tiles" is required.'))),C){case"vector":case"raster":case"raster-dem":case"raster-array":return R=R.concat(ki({key:g,value:h,valueSpec:b[`source_${C.replace("-","_")}`],style:_.style,styleSpec:b,objectElementValidators:gs})),R;case"geojson":if(R=ki({key:g,value:h,valueSpec:b.source_geojson,style:M,styleSpec:b,objectElementValidators:gs}),h.cluster)for(let z in h.clusterProperties){let[B,G]=h.clusterProperties[z],W=typeof B=="string"?[B,["accumulated"],["get",z]]:B;R.push(...Hr({key:`${g}.${z}.map`,value:G,expressionContext:"cluster-map"})),R.push(...Hr({key:`${g}.${z}.reduce`,value:W,expressionContext:"cluster-reduce"}))}return R;case"video":return ki({key:g,value:h,valueSpec:b.source_video,style:M,styleSpec:b});case"image":return ki({key:g,value:h,valueSpec:b.source_image,style:M,styleSpec:b});case"canvas":return[new n.V(g,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return kr({key:`${g}.type`,value:h.type,valueSpec:{values:Xn(b)},style:M,styleSpec:b})}}function Xn(_){return _.source.reduce((h,g)=>{let b=_[g];return b.type.type==="enum"&&(h=h.concat(Object.keys(b.type.values))),h},[])}function ys(_){let h=_.value,g=_.styleSpec,b=g.light,M=_.style,C=[],R=n.o(h);if(h===void 0)return C;if(R!=="object")return C=C.concat([new n.V("light",h,`object expected, ${R} found`)]),C;for(let z in h){let B=z.match(/^(.*)-transition$/);C=C.concat(B&&b[B[1]]&&b[B[1]].transition?cs({key:z,value:h[z],valueSpec:g.transition,style:M,styleSpec:g}):b[z]?cs({key:z,value:h[z],valueSpec:b[z],style:M,styleSpec:g}):[new n.V(z,h[z],`unknown property "${z}"`)])}return C}function On(_){let h=_.value,g=[];if(!h)return g;let b=n.o(h);if(b!=="object")return g=g.concat([new n.V("light-3d",h,`object expected, ${b} found`)]),g;let M=_.styleSpec,C=M["light-3d"],R=_.key,z=_.style,B=_.style.lights;for(let Z of["type","id"])if(!(Z in h))return g=g.concat([new n.V("light-3d",h,`missing property ${Z} on light`)]),g;if(h.type&&B)for(let Z=0;Z<_.arrayIndex;Z++){let te=n.u(h.type),ne=B[Z];n.u(ne.type)===te&&g.push(new n.V(R,h.id,`duplicate light type "${h.type}", previously defined at line ${ne.id.__line__}`))}let G=`properties_light_${h.type}`;if(!(G in M))return g=g.concat([new n.V("light-3d",h,`Invalid light type ${h.type}`)]),g;let W=M[G];for(let Z in h)if(Z==="properties"){let te=h[Z],ne=n.o(te);if(ne!=="object")return g=g.concat([new n.V("properties",te,`object expected, ${ne} found`)]),g;for(let ce in te)g=g.concat(W[ce]?cs({key:ce,value:te[ce],valueSpec:W[ce],style:z,styleSpec:M}):[new n.n(_.key,te[ce],`unknown property "${ce}"`)])}else{let te=Z.match(/^(.*)-transition$/);g=g.concat(te&&C[te[1]]&&C[te[1]].transition?cs({key:Z,value:h[Z],valueSpec:M.transition,style:z,styleSpec:M}):C[Z]?cs({key:Z,value:h[Z],valueSpec:C[Z],style:z,styleSpec:M}):[new n.n(Z,h[Z],`unknown property "${Z}"`)])}return g}function vc(_){let h=_.value,g=_.key,b=_.style,M=_.styleSpec,C=M.terrain,R=[],z=n.o(h);if(h===void 0||z==="null")return R;if(z!=="object")return R=R.concat([new n.V("terrain",h,`object expected, ${z} found`)]),R;for(let B in h){let G=B.match(/^(.*)-transition$/);R=R.concat(G&&C[G[1]]&&C[G[1]].transition?cs({key:B,value:h[B],valueSpec:M.transition,style:b,styleSpec:M}):C[B]?cs({key:B,value:h[B],valueSpec:C[B],style:b,styleSpec:M}):[new n.n(B,h[B],`unknown property "${B}"`)])}if(h.source){let B=b.sources&&b.sources[h.source],G=B&&n.u(B.type);B?G!=="raster-dem"&&R.push(new n.V(g,h.source,`terrain cannot be used with a source of type ${String(G)}, it only be used with a "raster-dem" source type`)):R.push(new n.V(g,h.source,`source "${h.source}" not found`))}else R.push(new n.V(g,h,'terrain is missing required property "source"'));return R}function Hl(_){let h=_.value,g=_.style,b=_.styleSpec,M=b.fog,C=[],R=n.o(h);if(h===void 0)return C;if(R!=="object")return C=C.concat([new n.V("fog",h,`object expected, ${R} found`)]),C;for(let z in h){let B=z.match(/^(.*)-transition$/);C=C.concat(B&&M[B[1]]&&M[B[1]].transition?cs({key:z,value:h[z],valueSpec:b.transition,style:g,styleSpec:b}):M[z]?cs({key:z,value:h[z],valueSpec:M[z],style:g,styleSpec:b}):[new n.n(z,h[z],`unknown property "${z}"`)])}return C}let _c={"*":()=>[],array:Jt,boolean:function(_){let h=_.value,g=_.key,b=n.o(h);return b!=="boolean"?[new n.V(g,h,`boolean expected, ${b} found`)]:[]},number:mr,color:function(_){let h=_.key,g=_.value,b=n.o(g);return b!=="string"?[new n.V(h,g,`color expected, ${b} found`)]:n.G(g)===null?[new n.V(h,g,`color expected, "${g}" found`)]:[]},enum:kr,filter:wt,function:$i,layer:dr,object:ki,source:ks,model:n.L,light:ys,"light-3d":On,terrain:vc,fog:Hl,string:Rn,formatted:function(_){return Rn(_).length===0?[]:Hr(_)},resolvedImage:function(_){return Rn(_).length===0?[]:Hr(_)},projection:function(_){let h=_.value,g=_.styleSpec,b=g.projection,M=_.style,C=[],R=n.o(h);if(R==="object")for(let z in h)C=C.concat(cs({key:z,value:h[z],valueSpec:b[z],style:M,styleSpec:g}));else R!=="string"&&(C=C.concat([new n.V("projection",h,`object or string expected, ${R} found`)]));return C},import:function(_){let{value:h,styleSpec:g}=_,R=h,{data:b}=R,M=ll(R,["data"]);Object.defineProperty(M,"__line__",{value:h.__line__,enumerable:!1});let C=ki(n.q({},_,{value:M,valueSpec:g.import}));return n.u(M.id)===""&&C.push(new n.V(`${_.key}.id`,M,"import id can't be an empty string")),b&&(C=C.concat(xe(b,g,{key:`${_.key}.data`}))),C}};function cs(_,h=!1){let g=_.value,b=_.valueSpec,M=_.styleSpec;if(b.expression&&n.J(n.u(g)))return $i(_);if(b.expression&&n.v(n.x(g)))return Hr(_);if(b.type&&_c[b.type]){let C=_c[b.type](_);return h===!0&&C.length>0&&n.o(_.value)==="array"?Hr(_):C}return ki(n.q({},_,{valueSpec:b.type?M[b.type]:b}))}function Ze(_){let h=_.value,g=_.key,b=Rn(_);return b.length||(h.indexOf("{fontstack}")===-1&&b.push(new n.V(g,h,'"glyphs" url must include a "{fontstack}" token')),h.indexOf("{range}")===-1&&b.push(new n.V(g,h,'"glyphs" url must include a "{range}" token'))),b}function xe(_,h=n.N,g={}){return cs({key:g.key||"",value:_,valueSpec:h.$root,styleSpec:h,style:_,objectElementValidators:{glyphs:Ze,"*":()=>[]}})}function ie(_,h=n.N){return ni(xe(_,h))}let re=_=>ni(ks(_)),he=_=>ni(ys(_)),De=_=>ni(On(_)),Ie=_=>ni(vc(_)),He=_=>ni(Hl(_)),nt=_=>ni(dr(_)),qe=_=>ni(wt(_)),st=_=>ni(Ai(_)),St=_=>ni(ir(_)),It=_=>ni(n.L(_));function ni(_){return _.slice().sort((h,g)=>h.line&&g.line?h.line-g.line:0)}function Ci(_,h){let g=!1;if(h&&h.length)for(let b of h)b instanceof n.n?n.w(b.message):(_.fire(new n.f(new Error(b.message))),g=!0);return g}let Bi;class Qi extends n.E{constructor(h,g="flat"){super(),this._transitionable=new n.O(Bi||(Bi=new n.U({anchor:new n.W(n.N.light.anchor),position:new n.X(n.N.light.position),color:new n.W(n.N.light.color),intensity:new n.W(n.N.light.intensity)}))),this.setLight(h,g),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(h,g,b={}){this._validate(he,h,b)||(this._transitionable.setTransitionOrValue(h),this.id=g)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,g,b){return(!b||b.validate!==!1)&&Ci(this,h.call(ie,n.Q({value:g,style:{glyphs:!0,sprite:!0},styleSpec:n.N})))}}let fi=new n.U({source:new n.W(n.N.terrain.source),exaggeration:new n.W(n.N.terrain.exaggeration)}),Sr=class extends n.E{constructor(_,h,g,b){super(),this.scope=g,this._transitionable=new n.O(fi,g,b),this._transitionable.setTransitionOrValue(_,b),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=h}get(){return this._transitionable.serialize()}set(_,h){this._transitionable.setTransitionOrValue(_,h)}updateTransitions(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(_){this.properties=this._transitioning.possiblyEvaluate(_)}getExaggeration(_){return this._transitioning.possiblyEvaluate(new n.Y(_)).get("exaggeration")}isZoomDependent(){let _=this._transitionable._values.exaggeration;return _!=null&&_.value!=null&&_.value.expression!=null&&_.value.expression instanceof n.Z}},_i=45,un=65,qi=.05;function vr(_,h,g,b){let M=n.a0(_i,un,g),[C,R]=qn(_,b),z=1-Math.min(1,Math.exp((h-C)/(R-C)*-6));return z*=z*z,z=Math.min(1,1.00747*z),z*M*_.alpha}function qn(_,h){let g=.5/Math.tan(.5*h);return[_.range[0]+g,_.range[1]+g]}function Zr(_,h,g,b,M){let C=n.$.transformMat4([],[h,g,b],M.mercatorFogMatrix);return vr(_,n.$.length(C),M.pitch,M._fov)}function Yn(_,h,g,b,M,C,R){let z=[[g,b,0],[M,b,0],[M,C,0],[g,C,0]],B=Number.MAX_VALUE,G=-Number.MAX_VALUE;for(let W of z){let Z=n.$.transformMat4([],W,h),te=n.$.length(Z);B=Math.min(B,te),G=Math.max(G,te)}return[vr(_,B,R.pitch,R._fov),vr(_,G,R.pitch,R._fov)]}let Ss=new n.U({range:new n.W(n.N.fog.range),color:new n.W(n.N.fog.color),"high-color":new n.W(n.N.fog["high-color"]),"space-color":new n.W(n.N.fog["space-color"]),"horizon-blend":new n.W(n.N.fog["horizon-blend"]),"star-intensity":new n.W(n.N.fog["star-intensity"]),"vertical-range":new n.W(n.N.fog["vertical-range"])});class _n extends n.E{constructor(h,g,b,M){super(),this._transitionable=new n.O(Ss,b,new Map(M)),this.set(h,M),this._transitioning=this._transitionable.untransitioned(),this._transform=g,this.properties=new n.a1(Ss),this.scope=b}get state(){let h=this._transform,g=h.projection.name==="globe",b=n.a2(h.zoom),M=this.properties.get("range"),C=[.5,3];return{range:g?[n.a3(C[0],M[0],b),n.a3(C[1],M[1],b)]:M,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(h,g,b={}){if(this._validate(He,h,b))return;let M=n.Q({},h);for(let C of Object.keys(n.N.fog))M[C]===void 0&&(M[C]=n.N.fog[C].default);this._options=M,this._transitionable.setTransitionOrValue(this._options,g)}getOpacity(h){if(!this._transform.projection.supportsFog)return 0;let g=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.a0(_i,un,h))*g.a}getOpacityAtLatLng(h,g){return this._transform.projection.supportsFog?function(b,M,C){let R=n._.fromLngLat(M),z=C.elevation?C.elevation.getAtPointOrZero(R):0;return Zr(b,R.x,R.y,z,C)}(this.state,h,g):0}getOpacityForTile(h){if(!this._transform.projection.supportsFog)return[1,1];let g=this._transform.calculateFogTileMatrix(h.toUnwrapped());return Yn(this.state,g,0,0,n.a4,n.a4,this._transform)}getOpacityForBounds(h,g,b,M,C){return this._transform.projection.supportsFog?Yn(this.state,h,g,b,M,C,this._transform):[1,1]}getFovAdjustedRange(h){return this._transform.projection.supportsFog?qn(this.state,h):[0,1]}isVisibleOnFrustum(h){if(!this._transform.projection.supportsFog)return!1;let g=[4,5,6,7];for(let b of g){let M=h.points[b],C;if(M[2]>=0)C=M;else{let R=h.points[b-4];C=n.a5(R,M,R[2]/(R[2]-M[2]))}if(Zr(this.state,C[0],C[1],0,this._transform)>=qi)return!0}return!1}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,g,b){return(!b||b.validate!==!1)&&Ci(this,h.call(ie,n.Q({value:g,style:{glyphs:!0,sprite:!0},styleSpec:n.N})))}}class Br extends n.E{constructor(h,g,b,M){super(),this.scope=b,this._options=h,this.properties=new n.a1(g),this._transitionable=new n.O(g,b,new Map(M)),this._transitionable.setTransitionOrValue(h.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(h){this._transitionable.setTransitionOrValue(this._options.properties,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(h,g){this._options=h,this._transitionable.setTransitionOrValue(h.properties,g)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let cd,Wl;var eh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,rr=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,ye=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Ce="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ht=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Ve=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Et=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,xi=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,xc=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,ud=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,th=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let iu=[];Op(eh,iu),Op(ye,iu),Op(rr,iu);let bc={"_prelude_fog.vertex.glsl":Ve,"_prelude_terrain.vertex.glsl":ht,"_prelude_shadow.vertex.glsl":ud,"_prelude_fog.fragment.glsl":Et,"_prelude_shadow.fragment.glsl":th,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":xi,"_prelude_raster_particle.glsl":xc},ih={};Wr("",ht),Wr(Et,Ve),Wr(th,ud),Wr(xi,""),Wr(xc,"");let iv=Wr(rr,ye),uE=eh;var hE={background:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Wr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Wr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Wr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Wr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Wr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Wr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);scaled_pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);scaled_pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Wr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_alignment;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);p.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);p.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Wr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Wr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Wr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Wr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Wr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Wr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Wr(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);v_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:Wr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Wr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Wr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Wr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ce),skyboxGradient:Wr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ce),skyboxCapture:Wr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Wr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Wr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Wr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Wr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:Wr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Op(_,h){let g=_.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let b of g)if(b=b.trim(),b[0]==="#"&&b.includes("if")&&!b.includes("endif")){b=b.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let M=b.split(" ");for(let C of M)h.includes(C)||h.push(C)}}function Wr(_,h){let g=/#include\s+"([^"]+)"/g,b=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,M=h.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);M&&(M=M.map(G=>{let W=G.split(" ");return W[W.length-1]}),M=[...new Set(M)]);let C={},R=[],z=[];if(_=_.replace(g,(G,W)=>(z.push(W),"")),(h=h.replace(g,(G,W)=>(R.push(W),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let B=[...iu];Op(_,B),Op(h,B);for(let G of[...R,...z])bc[G]||console.error(`Undefined include: ${G}`),ih[G]||(ih[G]=[],Op(bc[G],ih[G])),B=[...B,...ih[G]];return{fragmentSource:_=_.replace(b,(G,W,Z,te,ne)=>(C[ne]=!0,W==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
in ${Z} ${te} ${ne};
#else
uniform ${Z} ${te} u_${ne};
#endif
`:W==="initialize"?`
#ifdef HAS_UNIFORM_u_${ne}
    ${Z} ${te} ${ne} = u_${ne};
#endif
`:W==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ne}
    in ${Z} ${te} ${ne};
#endif
`:W==="initialize-attribute"?"":void 0)),vertexSource:h=h.replace(b,(G,W,Z,te,ne)=>{let ce=te==="float"?"vec2":te,ue=ne.match(/color/)?"color":ce;return W==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${ne}
in ${Z} ${te} a_${ne};
#endif
`:C[ne]?W==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
in ${Z} ${ce} a_${ne};
out ${Z} ${te} ${ne};
#else
uniform ${Z} ${te} u_${ne};
#endif
`:W==="initialize"?ue==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = a_${ne};
#else
    ${Z} ${te} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = unpack_mix_${ue}(a_${ne}, u_${ne}_t);
#else
    ${Z} ${te} ${ne} = u_${ne};
#endif
`:W==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ne}
    in ${Z} ${te} a_${ne};
    out ${Z} ${te} ${ne};
#endif
`:W==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ne}
    ${ne} = a_${ne};
#endif
`:void 0:W==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
in ${Z} ${ce} a_${ne};
#else
uniform ${Z} ${te} u_${ne};
#endif
`:W==="define-instanced"?ue==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${ne}0;
in vec4 a_${ne}1;
in vec4 a_${ne}2;
in vec4 a_${ne}3;
#else
uniform ${Z} ${te} u_${ne};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${Z} ${ce} a_${ne};
#else
uniform ${Z} ${te} u_${ne};
#endif
`:W==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${ne}
    ${Z} ${te} ${ne} = a_${ne};
#endif
`:ue==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${Z} ${te} ${ne} = a_${ne};
#else
    ${Z} ${te} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${Z} ${te} ${ne} = unpack_mix_${ue}(a_${ne}, u_${ne}_t);
#else
    ${Z} ${te} ${ne} = u_${ne};
#endif
`}),staticAttributes:M,usedDefines:B,vertexIncludes:R,fragmentIncludes:z}}class cP{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(h,g,b,M,C,R,z,B){this.context=h;let G=this.boundPaintVertexBuffers.length!==M.length;for(let Z=0;!G&&Z<M.length;Z++)this.boundPaintVertexBuffers[Z]!==M[Z]&&(G=!0);let W=this.boundDynamicVertexBuffers.length!==z.length;for(let Z=0;!W&&Z<z.length;Z++)this.boundDynamicVertexBuffers[Z]!==z[Z]&&(W=!0);if(!this.vao||this.boundProgram!==g||this.boundLayoutVertexBuffer!==b||G||W||this.boundIndexBuffer!==C||this.boundVertexOffset!==R)this.freshBind(g,b,M,C,R,z,B);else{h.bindVertexArrayOES.set(this.vao);for(let Z of z)Z&&(Z.bind(),B&&Z.instanceCount&&Z.setVertexAttribDivisor(h.gl,g,B));C&&C.dynamicDraw&&C.bind()}}freshBind(h,g,b,M,C,R,z){let B=h.numAttributes,G=this.context,W=G.gl;this.vao&&this.destroy(),this.vao=G.gl.createVertexArray(),G.bindVertexArrayOES.set(this.vao),this.boundProgram=h,this.boundLayoutVertexBuffer=g,this.boundPaintVertexBuffers=b,this.boundIndexBuffer=M,this.boundVertexOffset=C,this.boundDynamicVertexBuffers=R,g.enableAttributes(W,h),g.bind(),g.setVertexAttribPointers(W,h,C);for(let Z of b)Z.enableAttributes(W,h),Z.bind(),Z.setVertexAttribPointers(W,h,C);for(let Z of R)Z&&(Z.enableAttributes(W,h),Z.bind(),Z.setVertexAttribPointers(W,h,C),z&&Z.instanceCount&&Z.setVertexAttribDivisor(W,h,z));M&&M.bind(),G.currentNumAttributes=B}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function uP(_,h){let g=Math.pow(2,h.canonical.z),b=h.canonical.y;return[new n._(0,b/g).toLngLat().lat,new n._(0,(b+1)/g).toLngLat().lat]}function hP(_,h,g,b,M,C,R){let z=_.context,B=z.gl,G=g.hillshadeFBO;if(!G)return;_.prepareDrawTile();let W=_.isTileAffectedByFog(h),Z=_.getOrCreateProgram("hillshade",{overrideFog:W});z.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,G.colorAttachment.get());let te=((de,pe,Me,Te)=>{let Se=Me.paint.get("hillshade-shadow-color"),Be=Me.paint.get("hillshade-highlight-color"),Oe=Me.paint.get("hillshade-accent-color"),Le=Me.paint.get("hillshade-emissive-strength"),Ge=n.ac(Me.paint.get("hillshade-illumination-direction"));if(Me.paint.get("hillshade-illumination-anchor")==="viewport")Ge-=de.transform.angle;else if(de.style&&de.style.enable3dLights()&&de.style.directionalLight){let at=de.style.directionalLight.properties.get("direction"),Ye=n.ad(at.x,at.y,at.z);Ge=n.ac(Ye[1])}let We=!de.options.moving;return{u_matrix:Te||de.transform.calculateProjMatrix(pe.tileID.toUnwrapped(),We),u_image:0,u_latrange:uP(0,pe.tileID),u_light:[Me.paint.get("hillshade-exaggeration"),Ge],u_shadow:Se.toRenderColor(Me.lut),u_highlight:Be.toRenderColor(Me.lut),u_emissive_strength:Le,u_accent:Oe.toRenderColor(Me.lut)}})(_,g,b,_.terrain?h.projMatrix:null);_.uploadCommonUniforms(z,Z,h.toUnwrapped());let{tileBoundsBuffer:ne,tileBoundsIndexBuffer:ce,tileBoundsSegments:ue}=_.getTileBoundsBuffers(g);Z.draw(_,B.TRIANGLES,M,C,R,n.ag.disabled,te,b.id,ne,ce,ue)}function dE(_,h,g){if(!h.needsDEMTextureUpload)return;let b=_.context,M=b.gl;b.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||_.getTileTexture(g.stride);let C=g.getPixels();h.demTexture?h.demTexture.update(C,{premultiply:!1}):h.demTexture=new n.T(b,C,M.R32F,{premultiply:!1}),h.needsDEMTextureUpload=!1}function dP(_,h,g){let b=_.context,M=b.gl;if(!h.dem)return;let C=h.dem;if(b.activeTexture.set(M.TEXTURE1),dE(_,h,C),!h.demTexture)return;h.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);let R=C.dim;b.activeTexture.set(M.TEXTURE0);let z=h.hillshadeFBO;if(!z){let te=new n.T(b,{width:R,height:R,data:null},M.RGBA);te.bind(M.LINEAR,M.CLAMP_TO_EDGE),z=h.hillshadeFBO=b.createFramebuffer(R,R,!0,"renderbuffer"),z.colorAttachment.set(te.texture)}b.bindFramebuffer.set(z.framebuffer),b.viewport.set([0,0,R,R]);let{tileBoundsBuffer:B,tileBoundsIndexBuffer:G,tileBoundsSegments:W}=_.getMercatorTileBoundsBuffers(),Z=[];_.linearFloatFilteringSupported()&&Z.push("TERRAIN_DEM_FLOAT_FORMAT"),_.getOrCreateProgram("hillshadePrepare",{defines:Z}).draw(_,M.TRIANGLES,n.af.disabled,n.ah.disabled,n.a.unblended,n.ag.disabled,((te,ne)=>{let ce=ne.stride,ue=n.ae.create();return n.ae.ortho(ue,0,n.a4,-n.a4,0,0,1),n.ae.translate(ue,ue,[0,-n.a4,0]),{u_matrix:ue,u_image:1,u_dimension:[ce,ce],u_zoom:te.overscaledZ}})(h.tileID,C),g.id,B,G,W),h.needsHillshadePrepare=!1}function Vx(_,h,g,b,M){let C=function(z,B){if(z)return M(z);if(B){if(_.url&&B.tiles&&_.tiles&&delete _.tiles,B.variants){if(!Array.isArray(B.variants))return M(new Error("variants must be an array"));for(let W of B.variants){if(W==null||typeof W!="object"||W.constructor!==Object)return M(new Error("variant must be an object"));if(!Array.isArray(W.capabilities))return M(new Error("capabilities must be an array"));if(W.capabilities.length===1&&W.capabilities[0]==="meshopt"){B=n.Q(B,W);break}}}let G=n.ai(n.Q(B,_),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);B.vector_layers&&(G.vectorLayers=B.vector_layers,G.vectorLayerIds=G.vectorLayers.map(W=>W.id)),B.raster_layers&&(G.rasterLayers=B.raster_layers,G.rasterLayerIds=G.rasterLayers.map(W=>W.id)),G.tiles=h.canonicalizeTileset(G,_.url),M(null,G)}},R=function(z,B,G){if(!z)return null;if(!B&&!G)return z;G=G||z.worldview_default;let W=Object.values(z.language||{});if(W.length===0)return null;let Z=Object.values(z.worldview||{});if(Z.length===0)return null;let te=W.every(ce=>ce===B),ne=Z.every(ce=>ce===G);return te&&ne?z:B in(z.language_options||{})||G in(z.worldview_options||{})?null:z.language_options&&z.worldview_options?z:null}(_.data,g,b);return R?n.e.frame(()=>C(null,R)):_.url?n.h(h.transformRequest(h.normalizeSourceURL(_.url,null,g,b),n.R.Source),C):n.e.frame(()=>{let G=_,{data:z}=G,B=ll(G,["data"]);C(null,B)})}class Mm{constructor(h,g,b){this.bounds=n.aj.convert(this.validateBounds(h)),this.minzoom=g||0,this.maxzoom=b||24}validateBounds(h){return Array.isArray(h)&&h.length===4?[Math.max(-180,h[0]),Math.max(-90,h[1]),Math.min(180,h[2]),Math.min(90,h[3])]:[-180,-90,180,90]}contains(h){let g=Math.pow(2,h.z),b=Math.floor(n.ak(this.bounds.getWest())*g),M=Math.floor(n.al(this.bounds.getNorth())*g),C=Math.ceil(n.ak(this.bounds.getEast())*g),R=Math.ceil(n.al(this.bounds.getSouth())*g);return h.x>=b&&h.x<C&&h.y>=M&&h.y<R}}class Za extends n.E{constructor(h,g,b,M){super(),this.id=h,this.dispatcher=b,this.setEventedParent(M),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.Q({type:"raster"},g),n.Q(this,n.ai(g,["url","scheme","tileSize"]))}load(h){this._loaded=!1,this.fire(new n.g("dataloading",{dataType:"source"})),this._tileJSONRequest=Vx(this._options,this.map._requestManager,null,null,(g,b)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new n.f(g)):b&&(n.Q(this,b),b.bounds&&(this.tileBounds=new Mm(b.bounds,this.minzoom,this.maxzoom)),n.ao(b.tiles),this.fire(new n.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.g("data",{dataType:"source",sourceDataType:"content"}))),h&&h(g)})}loaded(){return this._loaded}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest();let h=n.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(h))}setTiles(h){return this._options.tiles=h,this.reload(),this}setUrl(h){return this.url=h,this._options.url=h,this.reload(),this}onRemove(h){this.cancelTileJSONRequest()}serialize(){return n.Q({},this._options)}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,g){let b=n.e.devicePixelRatio>=2,M=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),b,this.tileSize);h.request=n.i(this.map._requestManager.transformRequest(M,n.R.Tile),(C,R,z,B)=>(delete h.request,h.aborted?(h.state="unloaded",g(null)):C?(h.state="errored",g(C)):R?(this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:z,expires:B}),h.setTexture(R,this.map.painter),h.state="loaded",n.an(this.dispatcher),void g(null)):g(null)))}abortTile(h,g){h.request&&(h.request.cancel(),delete h.request),g&&g()}unloadTile(h,g){h.texture&&h.texture instanceof n.T?(h.destroy(!0),h.texture&&h.texture instanceof n.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),g&&g()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class pE extends n.E{constructor(h,g,b,M){if(super(),this.id=h,this.dispatcher=b,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.Q(this,n.ai(g,["url","scheme","tileSize","promoteId"])),this._options=n.Q({type:"vector"},g),this._collectResourceTiming=!!g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(M),this._tileWorkers={},this._deduped=new n.ap}load(h){this._loaded=!1,this.fire(new n.g("dataloading",{dataType:"source"}));let g=Array.isArray(this.map._language)?this.map._language.join():this.map._language,b=this.map._worldview;this._tileJSONRequest=Vx(this._options,this.map._requestManager,g,b,(M,C)=>{this._tileJSONRequest=null,this._loaded=!0,M?(g&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${g}`),b&&b.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${b}`),this.fire(new n.f(M))):C&&(n.Q(this,C),C.bounds&&(this.tileBounds=new Mm(C.bounds,this.minzoom,this.maxzoom)),n.ao(C.tiles,this.map._requestManager._customAccessToken),this.fire(new n.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.g("data",{dataType:"source",sourceDataType:"content"}))),h&&h(M)})}loaded(){return this._loaded}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest();let h=n.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(h))}setTiles(h){return this._options.tiles=h,this.reload(),this}setUrl(h){return this.url=h,this._options.url=h,this.reload(),this}onRemove(h){this.cancelTileJSONRequest()}serialize(){return n.Q({},this._options)}loadTile(h,g){let b=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),M=this.map._requestManager.transformRequest(b,n.R.Tile),C=this.map.style?this.map.style.getLut(this.scope):null,R={request:M,data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,lut:C?{image:C.image.clone()}:null,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:h.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(R.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired")h.state==="loading"?h.reloadCallback=g:h.request=h.actor.send("reloadTile",R,z.bind(this));else if(h.actor=this._tileWorkers[b]=this._tileWorkers[b]||this.dispatcher.getActor(),this.dispatcher.ready)h.request=h.actor.send("loadTile",R,z.bind(this),void 0,!0);else{let B=n.aq.call({deduped:this._deduped},R,(G,W)=>{G||!W?z.call(this,G):(R.data={cacheControl:W.cacheControl,expires:W.expires,rawData:W.rawData.slice(0)},h.actor&&h.actor.send("loadTile",R,z.bind(this),void 0,!0))},!0);h.request={cancel:B}}function z(B,G){return delete h.request,h.aborted?g(null):B&&B.status!==404?g(B):(G&&G.resourceTiming&&(h.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&h.setExpiryData(G),h.loadVectorData(G,this.map.painter),n.an(this.dispatcher),g(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(h,g){h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let fE=(_,h,g)=>({u_matrix:_,u_image0:0,u_skirt_height:h,u_ground_shadow_factor:g}),Gx=(_,h,g,b,M,C,R,z,B,G,W,Z,te,ne,ce,ue)=>({u_proj_matrix:Float32Array.from(_),u_globe_matrix:h,u_normalize_matrix:Float32Array.from(b),u_merc_matrix:g,u_zoom_transition:M,u_merc_center:C,u_image0:0,u_frustum_tl:R,u_frustum_tr:z,u_frustum_br:B,u_frustum_bl:G,u_globe_pos:W,u_globe_radius:Z,u_viewport:te,u_grid_matrix:ue?Float32Array.from(ue):new Float32Array(9),u_skirt_height:ne,u_far_z_cutoff:ce});class Tm{constructor(h=0,g=0,b=0,M=0){if(isNaN(h)||h<0||isNaN(g)||g<0||isNaN(b)||b<0||isNaN(M)||M<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=h,this.bottom=g,this.left=b,this.right=M}interpolate(h,g,b){return g.top!=null&&h.top!=null&&(this.top=n.a3(h.top,g.top,b)),g.bottom!=null&&h.bottom!=null&&(this.bottom=n.a3(h.bottom,g.bottom,b)),g.left!=null&&h.left!=null&&(this.left=n.a3(h.left,g.left,b)),g.right!=null&&h.right!=null&&(this.right=n.a3(h.right,g.right,b)),this}getCenter(h,g){let b=n.au((this.left+h-this.right)/2,0,h),M=n.au((this.top+g-this.bottom)/2,0,g);return new n.P(b,M)}equals(h){return this.top===h.top&&this.bottom===h.bottom&&this.left===h.left&&this.right===h.right}clone(){return new Tm(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function hd(_,h){let g=n.ax(_,3);n.ae.fromQuat(_,h),n.aA(_,3,g)}function ai(_,h){let g=n.aw.identity([]);return n.aw.rotateZ(g,g,-h),n.aw.rotateX(g,g,-_),g}function Lp(_,h){let g=[_[0],_[1],0],b=[h[0],h[1],0];if(n.$.length(g)>=1e-15){let R=n.$.normalize([],g);n.$.scale(b,R,n.$.dot(b,R)),h[0]=b[0],h[1]=b[1]}let M=n.$.cross([],h,_);if(n.$.len(M)<1e-15)return null;let C=Math.atan2(-M[1],M[0]);return ai(Math.atan2(Math.sqrt(_[0]*_[0]+_[1]*_[1]),-_[2]),C)}class mE{constructor(h,g){this.position=h,this.orientation=g}get position(){return this._position}set position(h){if(h){let g=h instanceof n._?h:new n._(h[0],h[1],h[2]);this._renderWorldCopies&&(g.x=n.av(g.x,0,1)),this._position=g}else this._position=null}lookAtPoint(h,g){if(this.orientation=null,!this.position)return;let b=this.position,M=this._elevation?this._elevation.getAtPointOrZero(n._.fromLngLat(h)):0,C=n._.fromLngLat(h,M),R=[C.x-b.x,C.y-b.y,C.z-b.z];g||(g=[0,0,1]),g[2]=Math.abs(g[2]),this.orientation=Lp(R,g)}setPitchBearing(h,g){this.orientation=ai(n.ac(h),n.ac(-g))}}class zp{constructor(h,g){this._transform=n.ae.identity([]),this.orientation=g,this.position=h}get mercatorPosition(){let h=this.position;return new n._(h[0],h[1],h[2])}get position(){let h=n.ax(this._transform,3);return[h[0],h[1],h[2]]}set position(h){var g;h&&n.aA(this._transform,3,[(g=h)[0],g[1],g[2],1])}get orientation(){return this._orientation}set orientation(h){this._orientation=h||n.aw.identity([]),h&&hd(this._transform,this._orientation)}getPitchBearing(){let h=this.forward(),g=this.right();return{bearing:Math.atan2(-g[1],g[0]),pitch:Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2])}}setPitchBearing(h,g){this._orientation=ai(h,g),hd(this._transform,this._orientation)}forward(){let h=n.ax(this._transform,2);return[-h[0],-h[1],-h[2]]}up(){let h=n.ax(this._transform,1);return[-h[0],-h[1],-h[2]]}right(){let h=n.ax(this._transform,0);return[h[0],h[1],h[2]]}getCameraToWorld(h,g){let b=new Float64Array(16);return n.ae.invert(b,this.getWorldToCamera(h,g)),b}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(h,g,b){let M=this.position;n.$.scale(M,M,-h);let C=new Float64Array(16);return n.ae.fromScaling(C,[b,b,b]),n.ae.translate(C,C,M),C[10]*=g,C}getWorldToCamera(h,g){let b=new Float64Array(16),M=new Float64Array(4),C=this.position;return n.aw.conjugate(M,this._orientation),n.$.scale(C,C,-h),n.ae.fromQuat(b,M),n.ae.translate(b,b,C),b[1]*=-1,b[5]*=-1,b[9]*=-1,b[13]*=-1,b[8]*=g,b[9]*=g,b[10]*=g,b[11]*=g,b}getCameraToClipPerspective(h,g,b,M){let C=new Float64Array(16);return n.ae.perspective(C,h,g,b,M),C}getCameraToClipOrthographic(h,g,b,M,C,R){let z=new Float64Array(16);return n.ae.ortho(z,h,g,b,M,C,R),z}getDistanceToElevation(h,g=!1){let b=h===0?0:n.ay(h,g?n.az(this.position[1]):this.position[1]),M=this.forward();return(b-this.position[2])/M[2]}clone(){return new zp([...this.position],[...this.orientation])}}let Rr={unknown:0,flipRequired:1,flipNotRequired:2},xa=Math.tan(85*Math.PI/180);function Am(_,h,g,b,M,C,R){let z=n.ae.create();if(g)if(C.name==="globe"){let B=n.aC(M,h);n.ae.multiply(z,z,B)}else{let B=n.aD.invert([],R);z[0]=B[0],z[1]=B[1],z[4]=B[2],z[5]=B[3],b||n.ae.rotateZ(z,z,M.angle)}else n.ae.multiply(z,M.labelPlaneMatrix,_);return z}function rv(_,h,g,b,M,C,R){let z=Am(_,h,g,b,M,C,R);return C.name==="globe"&&g||(z[2]=z[6]=z[10]=z[14]=0),z}function nv(_,h,g,b,M,C,R){if(g){if(C.name==="globe"){let z=Am(_,h,g,b,M,C,R);return n.ae.invert(z,z),n.ae.multiply(z,_,z),z}{let z=n.ae.clone(_),B=n.ae.identity([]);return B[0]=R[0],B[1]=R[1],B[4]=R[2],B[5]=R[3],n.ae.multiply(z,z,B),b||n.ae.rotateZ(z,z,-M.angle),z}}return M.glCoordMatrix}function ql(_,h,g,b){let M=[_,h,g,1];g?n.aB.transformMat4(M,M,b):qx(M,M,b);let C=M[3];return M[0]/=C,M[1]/=C,M[2]/=C,M}function xr(_,h){return Math.min(.5+_/h*.5,1.5)}function Hx(_,h){let g=_[0]/_[3],b=_[1]/_[3];return g>=-h[0]&&g<=h[0]&&b>=-h[1]&&b<=h[1]}function Fp(_,h,g,b,M,C,R,z,B,G){let W=g.transform,Z=b?_.textSizeData:_.iconSizeData,te=n.aE(Z,g.transform.zoom),ne=W.projection.name==="globe",ce=[256/g.width*2+1,256/g.height*2+1],ue=b?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;ue.clear();let de=null;ne&&(de=b?_.text.globeExtVertexArray:_.icon.globeExtVertexArray);let pe=_.lineVertexArray,Me=b?_.text.placedSymbolArray:_.icon.placedSymbolArray,Te=g.transform.width/g.transform.height,Se,Be=!1;for(let Oe=0;Oe<Me.length;Oe++){let Le=Me.get(Oe),{numGlyphs:Ge,writingMode:We}=Le;if(We!==n.aF.vertical||Be||Se===n.aF.horizontal||(Be=!0),Se=We,(Le.hidden||We===n.aF.vertical)&&!Be){dd(Ge,ue);continue}Be=!1;let at=new n.P(Le.tileAnchorX,Le.tileAnchorY),{x:Ye,y:Ne,z:gt}=W.projection.projectTilePoint(at.x,at.y,G.canonical);if(B){let[oi,ci,Si]=B(at);Ye+=oi,Ne+=ci,gt+=Si}let ft=[Ye,Ne,gt,1];if(n.aB.transformMat4(ft,ft,h),!Hx(ft,ce)){dd(Ge,ue);continue}let tt=ft[3],Bt=xr(g.transform.getCameraToCenterDistance(W.projection),tt),Pt=n.aG(Z,te,Le),ct=R?Pt/Bt:Pt*Bt,_t=ql(Ye,Ne,gt,M);if(_t[3]<=0){dd(Ge,ue);continue}let Qe={},Rt=R?null:B,Ft=Io(Le,ct,!1,z,h,M,C,_.glyphOffsetArray,pe,ue,de,_t,at,Qe,Te,Rt,W.projection,G,R);Be=Ft.useVertical,Rt&&Ft.needsFlipping&&(Qe={}),(Ft.notEnoughRoom||Be||Ft.needsFlipping&&Io(Le,ct,!0,z,h,M,C,_.glyphOffsetArray,pe,ue,de,_t,at,Qe,Te,Rt,W.projection,G,R).notEnoughRoom)&&dd(Ge,ue)}b?(_.text.dynamicLayoutVertexBuffer.updateData(ue),de&&_.text.globeExtVertexBuffer&&_.text.globeExtVertexBuffer.updateData(de)):(_.icon.dynamicLayoutVertexBuffer.updateData(ue),de&&_.icon.globeExtVertexBuffer&&_.icon.globeExtVertexBuffer.updateData(de))}function Cm(_,h,g,b,M,C,R,z,B,G,W,Z,te,ne,ce,ue){let{lineStartIndex:de,glyphStartIndex:pe,segment:Me}=z,Te=pe+z.numGlyphs,Se=de+z.lineLength,Be=h.getoffsetX(pe),Oe=h.getoffsetX(Te-1),Le=kp(_*Be,g,b,M,C,R,Me,de,Se,B,G,W,Z,te,!0,ne,ce,ue);if(!Le)return null;let Ge=kp(_*Oe,g,b,M,C,R,Me,de,Se,B,G,W,Z,te,!0,ne,ce,ue);return Ge?{first:Le,last:Ge}:null}function Wx(_,h,g,b){return _===n.aF.horizontal&&Math.abs(b)>Math.abs(g)?{useVertical:!0}:_===n.aF.vertical?b>0?{needsFlipping:!0}:null:h!==Rr.unknown&&function(M,C){return M===0||Math.abs(C/M)>xa}(g,b)?h===Rr.flipRequired?{needsFlipping:!0}:null:g<0?{needsFlipping:!0}:null}function Io(_,h,g,b,M,C,R,z,B,G,W,Z,te,ne,ce,ue,de,pe,Me){let Te=h/24,Se=_.lineOffsetX*Te,Be=_.lineOffsetY*Te,{lineStartIndex:Oe,glyphStartIndex:Le,numGlyphs:Ge,segment:We,writingMode:at,flipState:Ye}=_,Ne=Oe+_.lineLength,gt=ft=>{if(W){let[ct,_t,Qe]=ft.up,Rt=G.length;n.aH(W,Rt+0,ct,_t,Qe),n.aH(W,Rt+1,ct,_t,Qe),n.aH(W,Rt+2,ct,_t,Qe),n.aH(W,Rt+3,ct,_t,Qe)}let[tt,Bt,Pt]=ft.point;n.aI(G,tt,Bt,Pt,ft.angle)};if(Ge>1){let ft=Cm(Te,z,Se,Be,g,Z,te,_,B,C,ne,ue,!1,de,pe,Me);if(!ft)return{notEnoughRoom:!0};if(b&&!g){let[tt,Bt,Pt]=ft.first.point,[ct,_t,Qe]=ft.last.point;[tt,Bt]=ql(tt,Bt,Pt,R),[ct,_t]=ql(ct,_t,Qe,R);let Rt=Wx(at,Ye,(ct-tt)*ce,_t-Bt);if(_.flipState=Rt&&Rt.needsFlipping?Rr.flipRequired:Rr.flipNotRequired,Rt)return Rt}gt(ft.first);for(let tt=Le+1;tt<Le+Ge-1;tt++){let Bt=kp(Te*z.getoffsetX(tt),Se,Be,g,Z,te,We,Oe,Ne,B,C,ne,ue,!1,!1,de,pe,Me);if(!Bt)return G.length-=4*(tt-Le),{notEnoughRoom:!0};gt(Bt)}gt(ft.last)}else{if(b&&!g){let tt=ql(te.x,te.y,0,M),Bt=Oe+We+1,Pt=new n.P(B.getx(Bt),B.gety(Bt)),ct=ql(Pt.x,Pt.y,0,M),_t=ct[3]>0?ct:sv(te,Pt,tt,1,M,void 0,de,pe.canonical),Qe=Wx(at,Ye,(_t[0]-tt[0])*ce,_t[1]-tt[1]);if(_.flipState=Qe&&Qe.needsFlipping?Rr.flipRequired:Rr.flipNotRequired,Qe)return Qe}let ft=kp(Te*z.getoffsetX(Le),Se,Be,g,Z,te,We,Oe,Ne,B,C,ne,ue,!1,!1,de,pe,Me);if(!ft)return{notEnoughRoom:!0};gt(ft)}return{}}function gE(_,h,g,b,M){let{x:C,y:R,z}=b.projectTilePoint(_.x,_.y,h);if(!M)return ql(C,R,z,g);let[B,G,W]=M(_);return ql(C+B,R+G,z+W,g)}function sv(_,h,g,b,M,C,R,z){let B=gE(_.sub(h)._unit()._add(_),z,M,R,C);return n.$.sub(B,g,B),n.$.normalize(B,B),n.$.scaleAndAdd(B,g,B,b)}function kp(_,h,g,b,M,C,R,z,B,G,W,Z,te,ne,ce,ue,de,pe){let Me=b?_-h:_+h,Te=Me>0?1:-1,Se=0;b&&(Te*=-1,Se=Math.PI),Te<0&&(Se+=Math.PI);let Be=z+R+(Te>0?0:1)|0,Oe=M,Le=M,Ge=0,We=0,at=Math.abs(Me),Ye=[],Ne=[],gt=C,ft=gt,tt=()=>sv(ft,gt,Le,at-Ge+1,W,te,ue,de.canonical);for(;Ge+We<=at;){if(Be+=Te,Be<z||Be>=B)return null;if(Le=Oe,ft=gt,Ye.push(Le),ne&&Ne.push(ft),gt=new n.P(G.getx(Be),G.gety(Be)),Oe=Z[Be],!Oe){let ci=gE(gt,de.canonical,W,ue,te);Oe=ci[3]>0?Z[Be]=ci:tt()}Ge+=We,We=n.$.distance(Le,Oe)}ce&&te&&(Z[Be]&&(Oe=tt(),We=n.$.distance(Le,Oe)),Z[Be]=Oe);let Bt=(at-Ge)/We,Pt=gt.sub(ft)._mult(Bt)._add(ft),ct=n.$.sub([],Oe,Le),_t=n.$.scaleAndAdd([],Le,ct,Bt),Qe=[0,0,1],Rt=ct[0],Ft=ct[1];if(pe&&(Qe=ue.upVector(de.canonical,Pt.x,Pt.y),Qe[0]!==0||Qe[1]!==0||Qe[2]!==1)){let ci=[Qe[2],0,-Qe[0]],Si=n.$.cross([],Qe,ci);n.$.normalize(ci,ci),n.$.normalize(Si,Si),Rt=n.$.dot(ct,ci),Ft=n.$.dot(ct,Si)}if(g){let ci=n.$.cross([],Qe,ct);n.$.normalize(ci,ci),n.$.scaleAndAdd(_t,_t,ci,g*Te)}let oi=Se+Math.atan2(Ft,Rt);return Ye.push(_t),ne&&Ne.push(Pt),{point:_t,angle:oi,path:Ye,tilePath:Ne,up:Qe}}function dd(_,h){let g=h.length,b=g+4*_;h.resize(b),h.float32.fill(-1/0,4*g,4*b)}function qx(_,h,g){let b=h[0],M=h[1];return _[0]=g[0]*b+g[4]*M+g[12],_[1]=g[1]*b+g[5]*M+g[13],_[3]=g[3]*b+g[7]*M+g[15],_}let ov=(_,h,g)=>(1-g)*_+g*h,Dm=_=>_*_*_*_*_;class Im{constructor(h,g,b,M,C,R,z){this.tileSize=512,this._renderWorldCopies=C===void 0||C,this._minZoom=h||0,this._maxZoom=g||22,this._minPitch=b??0,this._maxPitch=M??60,this.setProjection(R),this.setMaxBounds(z),this.width=0,this.height=0,this._center=new n.aJ(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Tm,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new zp,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let h=new Im(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return h._elevation=this._elevation,h._centerAltitude=this._centerAltitude,h._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,h.tileSize=this.tileSize,h.mercatorFromTransition=this.mercatorFromTransition,h.width=this.width,h.height=this.height,h.cameraElevationReference=this.cameraElevationReference,h._center=this._center,h._setZoom(this.zoom),h._seaLevelZoom=this._seaLevelZoom,h.angle=this.angle,h._fov=this._fov,h._pitch=this._pitch,h._nearZ=this._nearZ,h._farZ=this._farZ,h._averageElevation=this._averageElevation,h._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,h._unmodified=this._unmodified,h._edgeInsets=this._edgeInsets.clone(),h._camera=this._camera.clone(),h._calcMatrices(),h.freezeTileCoverage=this.freezeTileCoverage,h.frustumCorners=this.frustumCorners,h}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(h){this._elevation!==h&&(this._elevation=h,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(h,g=!1){let b=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||b)&&this._updateCameraOnTerrain(),(h||b)&&this._constrainCamera(g),this._calcMatrices()}getProjection(){return n.ai(this.projection,["name","center","parallels"])}setProjection(h){this.projectionOptions=h||{name:"mercator"};let g=this.projection?this.getProjection():void 0;this.projection=n.aK(this.projectionOptions);let b=this.getProjection(),M=!n.d(g,b);return M&&this._calcMatrices(),this.mercatorFromTransition=!1,M}setOrthographicProjectionAtLowPitch(h){return this._orthographicProjectionAtLowPitch!==h&&(this._orthographicProjectionAtLowPitch=h,this._calcMatrices(),!0)}setMercatorFromTransition(){let h=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.aK({name:"mercator"});let g=h!==this.projection.name;return g&&this._calcMatrices(),g}get minZoom(){return this._minZoom}set minZoom(h){this._minZoom!==h&&(this._minZoom=h,this.zoom=Math.max(this.zoom,h))}get maxZoom(){return this._maxZoom}set maxZoom(h){this._maxZoom!==h&&(this._maxZoom=h,this.zoom=Math.min(this.zoom,h))}get minPitch(){return this._minPitch}set minPitch(h){this._minPitch!==h&&(this._minPitch=h,this.pitch=Math.max(this.pitch,h))}get maxPitch(){return this._maxPitch}set maxPitch(h){this._maxPitch!==h&&(this._maxPitch=h,this.pitch=Math.min(this.pitch,h))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(h){h===void 0?h=!0:h===null&&(h=!1),this._renderWorldCopies=h}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let h=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(h))}get cameraWorldSize(){let h=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(h))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.ay(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.av(this.rotation,-180,180)}set bearing(h){this.rotation=h}get rotation(){return-this.angle/Math.PI*180}set rotation(h){let g=-h*Math.PI/180;this.angle!==g&&(this._unmodified=!1,this.angle=g,this._calcMatrices(),this.rotationMatrix=n.aD.create(),n.aD.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(h){let g=n.au(h,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==g&&(this._unmodified=!1,this._pitch=g,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let h=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/h)}set fov(h){h=Math.max(.01,Math.min(60,h)),this._fov!==h&&(this._unmodified=!1,this._fov=n.ac(h),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(h){this._averageElevation=h,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(h){let g=Math.min(Math.max(h,this.minZoom),this.maxZoom);this._zoom!==g&&(this._unmodified=!1,this._setZoom(g),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(h){this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(h){this._tileCoverLift!==h&&(this._tileCoverLift=h)}_updateCameraOnTerrain(){let h=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,g=this.elevation&&h===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||h===Number.NEGATIVE_INFINITY&&(!g||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let b=this._elevation;g||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&b.exaggeration()&&this._centerAltitudeValidForExaggeration!==b.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*b.exaggeration(),this._centerAltitudeValidForExaggeration=b.exaggeration()):(this._centerAltitude=h||0,this._centerAltitudeValidForExaggeration=b.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let h=this._elevation,g=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],b=this.horizonLineFromTop(),M=0,C=0;for(let R=0;R<g.length;R++){let z=new n.P(g[R][0]*this.width,b+g[R][1]*(this.height-b)),B=h.pointCoordinate(z);if(!B)continue;let G=1/Math.hypot(B[0]-this._camera.position[0],B[1]-this._camera.position[1]);M+=B[3]*G,C+=G}return C===0?NaN:M/C}get center(){return this._center}set center(h){h.lat===this._center.lat&&h.lng===this._center.lng||(this._unmodified=!1,this._center=h,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let h=this._seaLevelZoom,g=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),b=this.pixelsPerMeter/this.worldSize*g,M=this._mercatorZfromZoom(h),C=this._mercatorZfromZoom(this._maxZoom),R=Math.max(M-b,C);this._setZoom(this._zoomFromMercatorZ(R))}get padding(){return this._edgeInsets.toJSON()}set padding(h){this._edgeInsets.equals(h)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,h,1),this._calcMatrices())}computeZoomRelativeTo(h){let g=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,h.toAltitude())),b;b=h.z<this._camera.position[2]?[g.x,g.y,g.z]:[h.x,h.y,h.z];let M=n.$.length(n.$.sub([],this._camera.position,b));return n.au(this._zoomFromMercatorZ(M),this._minZoom,this._maxZoom)}setFreeCameraOptions(h){if(!this.height||!h.position&&!h.orientation)return;this._updateCameraState();let g=!1;if(h.orientation&&!n.aw.exactEquals(h.orientation,this._camera.orientation)&&(g=this._setCameraOrientation(h.orientation)),h.position){let b=[h.position.x,h.position.y,h.position.z];n.$.exactEquals(b,this._camera.position)||(this._setCameraPosition(b),g=!0)}g&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let h=this._camera.position,g=new mE;return g.position=new n._(h[0],h[1],h[2]),g.orientation=this._camera.orientation,g._elevation=this.elevation,g._renderWorldCopies=this.renderWorldCopies,g}_setCameraOrientation(h){if(!n.aw.length(h))return!1;n.aw.normalize(h,h);let g=n.$.transformQuat([],[0,0,-1],h),b=n.$.transformQuat([],[0,-1,0],h);if(b[2]<0)return!1;let M=Lp(g,b);return!!M&&(this._camera.orientation=M,!0)}_setCameraPosition(h){let g=this.zoomScale(this.minZoom)*this.tileSize,b=this.zoomScale(this.maxZoom)*this.tileSize,M=this.cameraToCenterDistance;h[2]=n.au(h[2],M/b,M/g),this._camera.position=h}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(h){return this._edgeInsets.equals(h)}interpolatePadding(h,g,b){this._unmodified=!1,this._edgeInsets.interpolate(h,g,b),this._constrain(),this._calcMatrices()}coveringZoomLevel(h){let g=(h.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/h.tileSize));return Math.max(0,g)}getVisibleUnwrappedCoordinates(h){let g=[new n.aL(0,h)];if(this.renderWorldCopies){let b=this.pointCoordinate(new n.P(0,0)),M=this.pointCoordinate(new n.P(this.width,0)),C=this.pointCoordinate(new n.P(this.width,this.height)),R=this.pointCoordinate(new n.P(0,this.height)),z=Math.floor(Math.min(b.x,M.x,C.x,R.x)),B=Math.floor(Math.max(b.x,M.x,C.x,R.x)),G=1;for(let W=z-G;W<=B+G;W++)W!==0&&g.push(new n.aL(W,h))}return g}isLODDisabled(h){return(!h||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(h,g,b){let M=[],C=b!==void 0,R=!C;if(R&&this.zoom<g||C&&b[0]===0&&b[1]===0)return M;let z=new Set,B=(W,Z,te,ne,ce)=>{let ue=n.b2(Z,W,te,ne,ce);z.has(ue)||(M.push(new n.aQ(W,Z,te,ne,ce)),z.add(ue))};for(let W=0;W<h.length;W++){let Z=h[W];if(R&&Z.canonical.z!==g)continue;let te=Z.canonical,ne=Z.overscaledZ,ce=Z.wrap,ue=1<<te.z,de=te.x+1<ue,pe=te.x>0,Me=te.y+1<ue,Te=te.y>0,Se=Z.wrap-(pe?0:1),Be=Z.wrap+(de?0:1),Oe=pe?te.x-1:ue-1,Le=de?te.x+1:0;if(C)b[0]<0?(B(ne,Be,te.z,Le,te.y),b[1]<0&&Me&&(B(ne,ce,te.z,te.x,te.y+1),B(ne,Be,te.z,Le,te.y+1)),b[1]>0&&Te&&(B(ne,ce,te.z,te.x,te.y-1),B(ne,Be,te.z,Le,te.y-1))):b[0]>0?(B(ne,Se,te.z,Oe,te.y),b[1]<0&&Me&&(B(ne,ce,te.z,te.x,te.y+1),B(ne,Se,te.z,Oe,te.y+1)),b[1]>0&&Te&&(B(ne,ce,te.z,te.x,te.y-1),B(ne,Se,te.z,Oe,te.y-1))):b[1]<0&&Me?B(ne,ce,te.z,te.x,te.y+1):Te&&B(ne,ce,te.z,te.x,te.y-1);else{let Ge=Z.visibleQuadrants;1&Ge&&(B(ne,Se,te.z,Oe,te.y),Te&&(B(ne,ce,te.z,te.x,te.y-1),B(ne,Se,te.z,Oe,te.y-1))),2&Ge&&(B(ne,Be,te.z,Le,te.y),Te&&(B(ne,ce,te.z,te.x,te.y-1),B(ne,Be,te.z,Le,te.y-1))),4&Ge&&(B(ne,Se,te.z,Oe,te.y),Me&&(B(ne,ce,te.z,te.x,te.y+1),B(ne,Se,te.z,Oe,te.y+1))),8&Ge&&(B(ne,Be,te.z,Le,te.y),Me&&(B(ne,ce,te.z,te.x,te.y+1),B(ne,Be,te.z,Le,te.y+1)))}}let G=[];for(let W of M)M.some(Z=>W.isChildOf(Z))||G.push(W);if(M=G.filter(W=>!h.some(Z=>!!(W.overscaledZ<g&&Z.isChildOf(W))||W.equals(Z)||W.isChildOf(Z))),R){let W=1<<g,Z=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),te=[W*Z.x,W*Z.y],ne=4,ce=ne*ne;M=M.filter(ue=>{let de=ue.canonical.x+.5-te[0],pe=ue.canonical.y+.5-te[1];return de*de+pe*pe<ce})}return M}coveringTiles(h){let g=this.coveringZoomLevel(h),b=g,M=this.elevation&&this.elevation.exaggeration(),C=M&&!h.isTerrainDEM,R=this.projection.name==="mercator";if(h.minzoom!==void 0&&g<h.minzoom)return[];h.maxzoom!==void 0&&g>h.maxzoom&&(g=h.maxzoom);let z=this.locationCoordinate(this.center),B=this.center.lat,G=1<<g,W=[G*z.x,G*z.y,0],Z=this.projection.name==="globe",te=!Z,ne=n.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g,te),ce=Z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ue=G*n.ay(1,this.center.lat),de=this._camera.position[2]/n.ay(1,this.center.lat),pe=[G*ce.x,G*ce.y,de*(te?1:ue)],Me=Z||M,Te=this.cameraToCenterDistance/h.tileSize*(h.roundZoom?1:.502),Se=this.isLODDisabled(!0)?g:0,Be;if(this._elevation&&h.isTerrainDEM)Be=1e4*this._elevation.exaggeration();else if(this._elevation){let ct=this._elevation.getMinMaxForVisibleTiles();Be=ct?ct.max:this._centerAltitude}else Be=this._centerAltitude;let Oe=h.isTerrainDEM?-Be:this._elevation?this._elevation.getMinElevationBelowMSL():0,Le=this.projection.isReprojectedInTileSpace?n.aN(this):1,Ge=ct=>{let Qe=new n._(ct.x+25e-6,ct.y,ct.z),Rt=new n._(ct.x,ct.y+25e-6,ct.z),Ft=ct.toLngLat(),oi=Qe.toLngLat(),ci=Rt.toLngLat(),Si=this.locationCoordinate(Ft),hi=this.locationCoordinate(oi),ji=this.locationCoordinate(ci),cr=Math.hypot(hi.x-Si.x,hi.y-Si.y),Wi=Math.hypot(ji.x-Si.x,ji.y-Si.y);return Math.sqrt(cr*Wi)*Le/25e-6},We=ct=>{let _t=Be,Qe=Oe;return{aabb:n.aR(this,G,0,0,0,ct,Qe,_t,this.projection),zoom:0,x:0,y:0,minZ:Qe,maxZ:_t,wrap:ct,fullyVisible:!1}},at=[],Ye=[],Ne=g,gt=h.reparseOverscaled?b:g,ft=(de-this._centerAltitude)*ue,tt=ct=>{if(!this._elevation||!ct.tileID||!R)return;let _t=this._elevation.getMinMaxForTile(ct.tileID),Qe=ct.aabb;_t?(Qe.min[2]=_t.min,Qe.max[2]=_t.max,Qe.center[2]=(Qe.min[2]+Qe.max[2])/2):(ct.shouldSplit=Pt(ct),ct.shouldSplit||(Qe.min[2]=Qe.max[2]=Qe.center[2]=this._centerAltitude))},Bt=(ct,_t)=>{if(.707*_t<ct)return 1;let Qe=_t/ct;return Qe/(1.4144271570014144+(Math.pow(1.1,Qe-1.4144271570014144+1)-1)/(1.1-1)-1)},Pt=ct=>{if(ct.zoom<Se)return!0;if(ct.zoom===Ne)return!1;if(ct.shouldSplit!=null)return ct.shouldSplit;let _t=ct.aabb.distanceX(pe),Qe=ct.aabb.distanceY(pe),Rt=ft,Ft=1;if(Z){Rt=ct.aabb.distanceZ(pe);let Wi=Math.pow(2,ct.zoom),gr=n.az((ct.y+1)/Wi),Or=n.az(ct.y/Wi),zn=Math.min(Math.max(B,gr),Or),xn=n.b6(zn)/n.b6(B);if(Ft=zn===B?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,xn/this._mercatorScaleRatio),this.zoom<=n.b3&&ct.zoom===Ne-1&&xn>=.9)return!0}else if(C&&(Rt=ct.aabb.distanceZ(pe)*ue),this.projection.isReprojectedInTileSpace&&b<=5){let Wi=Math.pow(2,ct.zoom),gr=Ge(new n._((ct.x+.5)/Wi,(ct.y+.5)/Wi));Ft=gr>.85?1:gr}if(!R){let Wi=Math.sqrt(_t*_t+Qe*Qe+Rt*Rt),gr=(1<<Ne-ct.zoom)*Te*Ft;return gr*=Bt(Math.max(Rt,ft),Wi),Wi<gr}let oi=Number.MAX_VALUE,ci=0,Si=ct.aabb.getCorners(),hi=[];for(let Wi of Si){n.$.sub(hi,Wi,pe),Z||(C?hi[2]*=ue:hi[2]=ft);let gr=n.$.dot(hi,this._camera.forward());gr<oi&&(oi=gr,ci=Math.abs(hi[2]))}let ji=(1<<Ne-ct.zoom)*Te*Ft;if(ji*=Bt(Math.max(ci,ft),oi),oi<ji)return!0;let cr=ct.aabb.closestPoint(W);return cr[0]===W[0]&&cr[1]===W[1]};if(this.renderWorldCopies)for(let ct=1;ct<=3;ct++)at.push(We(-ct)),at.push(We(ct));for(at.push(We(0));at.length>0;){let ct=at.pop(),_t=ct.x,Qe=ct.y,Rt=ct.fullyVisible,Ft=()=>this.projection.name==="globe"&&(ct.y===0||ct.y===(1<<ct.zoom)-1);if(!Rt){let oi=Me?ct.aabb.intersects(ne):ct.aabb.intersectsFlat(ne);if(oi===0&&Ft()){let ci=new n.aO(ct.zoom,_t,Qe);oi=n.aP(this,G,ci,!0).intersects(ne)}if(oi===0)continue;Rt=oi===2}if(ct.zoom!==Ne&&Pt(ct))for(let oi=0;oi<4;oi++){let ci=(_t<<1)+oi%2,Si=(Qe<<1)+(oi>>1),hi={aabb:R?ct.aabb.quadrant(oi):n.aR(this,G,ct.zoom+1,ci,Si,ct.wrap,ct.minZ,ct.maxZ,this.projection),zoom:ct.zoom+1,x:ci,y:Si,wrap:ct.wrap,fullyVisible:Rt,tileID:void 0,shouldSplit:void 0,minZ:ct.minZ,maxZ:ct.maxZ};C&&!Z&&(hi.tileID=new n.aQ(ct.zoom+1===Ne?gt:ct.zoom+1,ct.wrap,ct.zoom+1,ci,Si),tt(hi)),at.push(hi)}else{let oi=ct.zoom===Ne?gt:ct.zoom;if(h.minzoom&&h.minzoom>oi)continue;let ci=0;if(!Rt){let cr=Me?ct.aabb.intersectsPrecise(ne):ct.aabb.intersectsPreciseFlat(ne);if(cr===0&&Ft()){let Wi=new n.aO(ct.zoom,_t,Qe);cr=n.aP(this,G,Wi,!0).intersectsPrecise(ne)}if(cr===0)continue;if(h.calculateQuadrantVisibility)if(ne.containsPoint(ct.aabb.center))ci=15;else for(let Wi=0;Wi<4;Wi++)ct.aabb.quadrant(Wi).intersects(ne)!==0&&(ci|=1<<Wi)}let Si=W[0]-(.5+_t+(ct.wrap<<ct.zoom))*(1<<g-ct.zoom),hi=W[1]-.5-Qe,ji=ct.tileID?ct.tileID:new n.aQ(oi,ct.wrap,ct.zoom,_t,Qe);h.calculateQuadrantVisibility&&(ji.visibleQuadrants=ci),Ye.push({tileID:ji,distanceSq:Si*Si+hi*hi})}}if(this.fogCullDistSq){let ct=this.fogCullDistSq,_t=this.horizonLineFromTop();Ye=Ye.filter(Qe=>{let Rt=[0,0,0,1],Ft=[n.a4,n.a4,0,1],oi=this.calculateFogTileMatrix(Qe.tileID.toUnwrapped());n.aB.transformMat4(Rt,Rt,oi),n.aB.transformMat4(Ft,Ft,oi);let ci=n.aB.min([],Rt,Ft),Si=n.aB.max([],Rt,Ft),hi=n.aS(ci,Si);if(hi===0)return!0;let ji=!1,cr=this._elevation;if(cr&&hi>ct&&_t!==0){let Wi=this.calculateProjMatrix(Qe.tileID.toUnwrapped()),gr;h.isTerrainDEM||(gr=cr.getMinMaxForTile(Qe.tileID)),gr||(gr={min:Oe,max:Be});let Or=n.b4(this.rotation),zn=[Or[0]*n.a4,Or[1]*n.a4,gr.max];n.$.transformMat4(zn,zn,Wi),ji=(1-zn[1])*this.height*.5<_t}return hi<ct||ji})}return Ye.sort((ct,_t)=>ct.distanceSq-_t.distanceSq).map(ct=>ct.tileID)}resize(h,g){this.width=h,this.height=g,this.pixelsToGLUnits=[2/h,-2/g],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(h){return Math.pow(2,h)}scaleZoom(h){return Math.log(h)/Math.LN2}project(h){let g=n.au(h.lat,-n.aT,n.aT),b=this.projection.project(h.lng,g);return new n.P(b.x*this.worldSize,b.y*this.worldSize)}unproject(h){return this.projection.unproject(h.x/this.worldSize,h.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.ay(1,this.center.lat)/this.worldSize}setLocationAtPoint(h,g){let b,M,C=this.centerPoint;if(this.projection.name==="globe"){let z=this.worldSize;b=(g.x-C.x)/z,M=(g.y-C.y)/z}else{let z=this.pointCoordinate(g),B=this.pointCoordinate(C);b=z.x-B.x,M=z.y-B.y}let R=this.locationCoordinate(h);this.setLocation(new n._(R.x-b,R.y-M))}setLocation(h){this.center=this.coordinateLocation(h),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(h){return this.projection.locationPoint(this,h)}locationPoint3D(h){return this.projection.locationPoint(this,h,!0)}pointLocation(h){return this.coordinateLocation(this.pointCoordinate(h))}pointLocation3D(h){return this.coordinateLocation(this.pointCoordinate3D(h))}locationCoordinate(h,g){let b=g?n.ay(g,h.lat):void 0,M=this.projection.project(h.lng,h.lat);return new n._(M.x,M.y,b)}coordinateLocation(h){return this.projection.unproject(h.x,h.y)}pointRayIntersection(h,g){let b=g??this._centerAltitude,M=[h.x,h.y,0,1],C=[h.x,h.y,1,1];n.aB.transformMat4(M,M,this.pixelMatrixInverse),n.aB.transformMat4(C,C,this.pixelMatrixInverse);let R=C[3];n.aB.scale(M,M,1/M[3]),n.aB.scale(C,C,1/R);let z=M[2],B=C[2];return{p0:M,p1:C,t:z===B?0:(b-z)/(B-z)}}screenPointToMercatorRay(h){let g=[h.x,h.y,0,1],b=[h.x,h.y,1,1];return n.aB.transformMat4(g,g,this.pixelMatrixInverse),n.aB.transformMat4(b,b,this.pixelMatrixInverse),n.aB.scale(g,g,1/g[3]),n.aB.scale(b,b,1/b[3]),g[2]=n.ay(g[2],this._center.lat)*this.worldSize,b[2]=n.ay(b[2],this._center.lat)*this.worldSize,n.aB.scale(g,g,1/this.worldSize),n.aB.scale(b,b,1/this.worldSize),new n.aU([g[0],g[1],g[2]],n.$.normalize([],n.$.sub([],b,g)))}rayIntersectionCoordinate(h){let{p0:g,p1:b,t:M}=h,C=n.ay(g[2],this._center.lat),R=n.ay(b[2],this._center.lat);return new n._(n.a3(g[0],b[0],M)/this.worldSize,n.a3(g[1],b[1],M)/this.worldSize,n.a3(C,R,M))}pointCoordinate(h,g=this._centerAltitude){return this.projection.pointCoordinate(this,h.x,h.y,g)}pointCoordinate3D(h){if(!this.elevation)return this.pointCoordinate(h);let g=this.projection.pointCoordinate3D(this,h.x,h.y);if(g)return new n._(g[0],g[1],g[2]);let b=0,M=this.horizonLineFromTop();if(h.y>M)return this.pointCoordinate(h);let C=.02*M,R=h.clone();for(let z=0;z<10&&M-b>C;z++){R.y=n.a3(b,M,.66);let B=this.projection.pointCoordinate3D(this,R.x,R.y);B?(M=R.y,g=B):b=R.y}return g?new n._(g[0],g[1],g[2]):this.pointCoordinate(h)}isPointAboveHorizon(h){return this.projection.isPointAboveHorizon(this,h)}isPointOnSurface(h){if(h.y<0||h.y>this.height||h.x<0||h.x>this.width)return!1;if(this.elevation||this.zoom>=n.aV)return!this.isPointAboveHorizon(h);let g=this.pointCoordinate(h);return g.y>=0&&g.y<=1}_coordinatePoint(h,g){let b=g&&this.elevation?this.elevation.getAtPointOrZero(h,this._centerAltitude):this._centerAltitude,M=[h.x*this.worldSize,h.y*this.worldSize,b+h.toAltitude(),1];return n.aB.transformMat4(M,M,this.pixelMatrix),M[3]>0?new n.P(M[0]/M[3],M[1]/M[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:h,left:g}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,M=this.width-this._edgeInsets.right,C=this.pointLocation3D(new n.P(g,h)),R=this.pointLocation3D(new n.P(M,h)),z=this.pointLocation3D(new n.P(M,b)),B=this.pointLocation3D(new n.P(g,b)),G=Math.min(C.lng,R.lng,z.lng,B.lng),W=Math.max(C.lng,R.lng,z.lng,B.lng),Z=Math.min(C.lat,R.lat,z.lat,B.lat),te=Math.max(C.lat,R.lat,z.lat,B.lat),ne=Math.pow(2,-this.zoom)/16*270,ce=this.projection.name==="globe"?1:4,ue=(de,pe,Me,Te,Se)=>{let Be=(de+Me)/2,Oe=(pe+Te)/2,Le=new n.P(Be,Oe),{lng:Ge,lat:We}=this.pointLocation3D(Le),at=Math.max(0,G-Ge,Z-We,Ge-W,We-te);G=Math.min(G,Ge),W=Math.max(W,Ge),Z=Math.min(Z,We),te=Math.max(te,We),(Se<ce||at>ne)&&(ue(de,pe,Be,Oe,Se+1),ue(Be,Oe,Me,Te,Se+1))};if(ue(g,h,M,h,1),ue(M,h,M,b,1),ue(M,b,g,b,1),ue(g,b,g,h,1),this.projection.name==="globe"){let[de,pe]=n.aW(this);de?(te=90,W=180,G=-180):pe&&(Z=-90,W=180,G=-180)}return new n.aj(new n.aJ(G,Z),new n.aJ(W,te))}_getBoundsRectangular(h,g){let{top:b,left:M}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,R=this.width-this._edgeInsets.right,z=new n.P(M,b),B=new n.P(R,b),G=new n.P(R,C),W=new n.P(M,C),Z=this.pointCoordinate(z,h),te=this.pointCoordinate(B,h),ne=this.pointCoordinate(G,g),ce=this.pointCoordinate(W,g),ue=(de,pe)=>(pe.y-de.y)/(pe.x-de.x);return Z.y>1&&te.y>=0?Z=new n._((1-ce.y)/ue(ce,Z)+ce.x,1):Z.y<0&&te.y<=1&&(Z=new n._(-ce.y/ue(ce,Z)+ce.x,0)),te.y>1&&Z.y>=0?te=new n._((1-ne.y)/ue(ne,te)+ne.x,1):te.y<0&&Z.y<=1&&(te=new n._(-ne.y/ue(ne,te)+ne.x,0)),new n.aj().extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(te)).extend(this.coordinateLocation(ce)).extend(this.coordinateLocation(ne))}_getBoundsRectangularTerrain(){let h=this.elevation;if(!h.visibleDemTiles.length||h.isUsingMockSource())return this._getBoundsRectangular(0,0);let g=h.visibleDemTiles.reduce((b,M)=>{if(M.dem){let C=M.dem.tree;b.min=Math.min(b.min,C.minimums[0]),b.max=Math.max(b.max,C.maximums[0])}return b},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(g.min*h.exaggeration(),g.max*h.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(h=!0){let g=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,b=this.height/2-g*(1-this._horizonShift);return h?Math.max(0,b):b}getMaxBounds(){return this.maxBounds}setMaxBounds(h){this.maxBounds=h,this.minLat=-n.aT,this.maxLat=n.aT,this.minLng=-180,this.maxLng=180,h&&(this.minLat=h.getSouth(),this.maxLat=h.getNorth(),this.minLng=h.getWest(),this.maxLng=h.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.ak(this.minLng)*this.tileSize,this.worldMaxX=n.ak(this.maxLng)*this.tileSize,this.worldMinY=n.al(this.maxLat)*this.tileSize,this.worldMaxY=n.al(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(h,g){return this.projection.createTileMatrix(this,g,h)}calculateDistanceTileData(h){let g=h.key,b=this._distanceTileDataCache;if(b[g])return b[g];let M=h.canonical,C=1/this.height,R=this.cameraWorldSize,z=R/this.zoomScale(M.z),B=(M.x+Math.pow(2,M.z)*h.wrap)*z,G=M.y*z,W=this.point;W.x*=R/this.worldSize,W.y*=R/this.worldSize;let Z=this.angle,te=Math.sin(-Z),ne=-Math.cos(-Z);return b[g]={bearing:[te,ne],center:[(W.x-B)*C,(W.y-G)*C],scale:z/n.a4*C},b[g]}calculateFogTileMatrix(h){let g=h.key,b=this._fogTileMatrixCache;if(b[g])return b[g];let M=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,h);return n.ae.multiply(M,this.worldToFogMatrix,M),b[g]=new Float32Array(M),b[g]}calculateProjMatrix(h,g=!1,b=!1){let M=h.key,C;if(C=b?this._expandedProjMatrixCache:g?this._alignedProjMatrixCache:this._projMatrixCache,C[M])return C[M];let R=this.calculatePosMatrix(h,this.worldSize),z;return z=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:b?this.expandedFarZProjMatrix:g?this.alignedProjMatrix:this.projMatrix,n.ae.multiply(R,z,R),C[M]=new Float32Array(R),C[M]}calculatePixelsToTileUnitsMatrix(h){let g=h.tileID.key,b=this._pixelsToTileUnitsCache;if(b[g])return b[g];let M=n.aX(h,this);return b[g]=M,b[g]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let h=1/this.worldSize,g=n.ae.fromScaling([],[h,h,h]);return n.ae.multiply(g,g,this.globeMatrix),g}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let h=this._elevation;this._updateCameraState();let g=n.ay(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(g),M=this._camera.forward(),C=n.ay(1,this._center.lat);b[2]/=C,M[2]/=C,n.$.normalize(M,M);let R=h.raycast(b,M,h.exaggeration());if(R){let z=n.$.scaleAndAdd([],b,M,R),B=new n._(z[0],z[1],n.ay(z[2],n.az(z[1]))),G=(B.z+n.$.length([B.x-b[0],B.y-b[1],B.z-b[2]*C]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(G),this._centerAltitude=B.toAltitude(),this._center=this.coordinateLocation(B),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(h=!1){if(!this._elevation)return;let g=this._elevation,b=n.ay(1,this._center.lat)*this.worldSize,M=this._computeCameraPosition(b),C=g.getAtPointOrZero(new n._(...M)),R=this.pixelsPerMeter/this.worldSize*C,z=this._minimumHeightOverTerrain(),B=M[2]-R;if(B<=z)if(B<0||h){let G=this.locationCoordinate(this._center,this._centerAltitude),W=[M[0],M[1],G.z-M[2]],Z=n.$.length(W);W[2]-=(z-B)/this._pixelsPerMercatorPixel;let te=n.$.length(W);if(te===0)return;n.$.scale(W,W,Z/te*this._pixelsPerMercatorPixel),this._camera.position=[M[0],M[1],G.z*this._pixelsPerMercatorPixel-W[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let h=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||h){let te=this.center;return te.lat=n.au(te.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!h)&&(te.lng=n.au(te.lng,this.minLng,this.maxLng)),this.center=te,void(this._constraining=!1)}let g=this._unmodified,{x:b,y:M}=this.point,C=0,R=b,z=M,B=this.width/2,G=this.height/2,W=this.worldMinY*this.scale,Z=this.worldMaxY*this.scale;if(M-G<W&&(z=W+G),M+G>Z&&(z=Z-G),Z-W<this.height&&(C=Math.max(C,this.height/(Z-W)),z=(Z+W)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let te=this.worldMinX*this.scale,ne=this.worldMaxX*this.scale,ce=this.worldSize/2-(te+ne)/2;R=(b+ce+this.worldSize)%this.worldSize-ce,R-B<te&&(R=te+B),R+B>ne&&(R=ne-B),ne-te<this.width&&(C=Math.max(C,this.width/(ne-te)),R=(ne+te)/2)}R===b&&z===M||(this.center=this.unproject(new n.P(R,z))),C&&(this.zoom+=this.scaleZoom(C)),this._constrainCamera(),this._unmodified=g,this._constraining=!1}_minZoomForBounds(){let h=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(h=Math.max(h,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),h}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let h=this.centerOffset,g=this.projection.name==="globe",b=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.ay(1,this.center.lat)/n.ay(1,n.b5));let M=n.aY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,M),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let C=this.projection.zAxisUnit==="meters"?b:1,R=this._camera.getWorldToCamera(this.worldSize,C),z,B=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(B[8]=2*-h.x/this.width,B[9]=2*h.y/this.height,this.isOrthographic){let We=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),at=We*this.aspect,Ye=-at,Ne=-We;at-=h.x,Ye-=h.x,We+=h.y,Ne+=h.y,z=this._camera.getCameraToClipOrthographic(Ye,at,Ne,We,this._nearZ,this._farZ),((gt,ft,tt,Bt)=>{for(let Pt=0;Pt<16;Pt++)gt[Pt]=ov(ft[Pt],tt[Pt],Bt)})(z,z,B,Dm(this.pitch>=15?1:this.pitch/15))}else z=B;let G=n.ae.mul([],B,R),W=n.ae.mul([],z,R);if(this.projection.isReprojectedInTileSpace){let We=this.locationCoordinate(this.center),at=n.ae.identity([]);n.ae.translate(at,at,[We.x*this.worldSize,We.y*this.worldSize,0]),n.ae.multiply(at,at,n.aZ(this)),n.ae.translate(at,at,[-We.x*this.worldSize,-We.y*this.worldSize,0]),n.ae.multiply(W,W,at),n.ae.multiply(G,G,at),this.inverseAdjustmentMatrix=n.a_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.ae.scale([],W,[this.worldSize,this.worldSize,this.worldSize/C,1]),this.projMatrix=W,this.invProjMatrix=n.ae.invert(new Float64Array(16),this.projMatrix),g){let We=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);We[8]=2*-h.x/this.width,We[9]=2*h.y/this.height,this.expandedFarZProjMatrix=n.ae.mul([],We,R)}else this.expandedFarZProjMatrix=this.projMatrix;let Z=n.ae.invert([],z);this.frustumCorners=n.a$.fromInvProjectionMatrix(Z,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!g);let te=new Float32Array(16);n.ae.identity(te),n.ae.scale(te,te,[1,-1,1]),n.ae.rotateX(te,te,this._pitch),n.ae.rotateZ(te,te,this.angle);let ne=n.ae.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.ae.clone(ne);let ce=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ne[8]=2*-h.x/this.width,ne[9]=2*(h.y+ce)/this.height,this.skyboxMatrix=n.ae.multiply(te,ne,te);let ue=this.point,de=ue.x,pe=ue.y,Me=this.width%2/2,Te=this.height%2/2,Se=Math.cos(this.angle),Be=Math.sin(this.angle),Oe=de-Math.round(de)+Se*Me+Be*Te,Le=pe-Math.round(pe)+Se*Te+Be*Me,Ge=new Float64Array(W);if(n.ae.translate(Ge,Ge,[Oe>.5?Oe-1:Oe,Le>.5?Le-1:Le,0]),this.alignedProjMatrix=Ge,W=n.ae.create(),n.ae.scale(W,W,[this.width/2,-this.height/2,1]),n.ae.translate(W,W,[1,-1,0]),this.labelPlaneMatrix=W,W=n.ae.create(),n.ae.scale(W,W,[1,-1,1]),n.ae.translate(W,W,[-1,-1,0]),n.ae.scale(W,W,[2/this.width,2/this.height,1]),this.glCoordMatrix=W,this.pixelMatrix=n.ae.multiply(new Float64Array(16),this.labelPlaneMatrix,G),this._calcFogMatrices(),this._distanceTileDataCache={},W=n.ae.invert(new Float64Array(16),this.pixelMatrix),!W)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=W,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.b0(this);let We=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.$.transformMat4(We,We,R),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=W;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let h=this.cameraWorldSizeForFog,g=this.cameraPixelsPerMeter,b=this._camera.position,M=1/this.height/this._pixelsPerMercatorPixel,C=[h,h,g];n.$.scale(C,C,M),n.$.scale(b,b,-1),n.$.multiply(b,b,C);let R=n.ae.create();n.ae.translate(R,R,b),n.ae.scale(R,R,C),this.mercatorFogMatrix=R,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(h,g,M)}_computeCameraPosition(h){let g=(h=h||this.pixelsPerMeter)/this.pixelsPerMeter,b=this._camera.forward(),M=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*g-h/this.worldSize*this._centerAltitude;return[M.x/this.worldSize-b[0]*C,M.y/this.worldSize-b[1]*C,h/this.worldSize*this._centerAltitude-b[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(h){let g=this._maxCameraBoundsDistance()*Math.cos(this._pitch),b=this._camera.position[2],M=h[2],C=1;this.projection.wrap&&(this.center=this.center.wrap()),M>0&&(C=Math.min((g-b)/M,1)),this._camera.position=n.$.scaleAndAdd([],this._camera.position,h,C),this._updateStateFromCamera()}_updateStateFromCamera(){let h=this._camera.position,g=this._camera.forward(),{pitch:b,bearing:M}=this._camera.getPitchBearing(),C=n.ay(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,R=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.ac(this._maxPitch)),z=Math.max((h[2]-C)/Math.cos(b),R),B=this._zoomFromMercatorZ(z);n.$.scaleAndAdd(h,h,g,z),this._pitch=n.au(b,n.ac(this.minPitch),n.ac(this.maxPitch)),this.angle=n.av(M,-Math.PI,Math.PI),this._setZoom(n.au(B,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n._(h[0],h[1],h[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(h){return Math.pow(2,h)*this.tileSize}_mercatorZfromZoom(h){return this.cameraToCenterDistance/this._worldSizeFromZoom(h)}_minimumHeightOverTerrain(){let h=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(h)}_zoomFromMercatorZ(h){return this.scaleZoom(this.cameraToCenterDistance/(h*this.tileSize))}zoomFromMercatorZAdjusted(h){let g=0,b=n.aV,M=0,C=1/0;for(;b-g>1e-6&&b>g;){let R=g+.5*(b-g),z=this.tileSize*Math.pow(2,R),B=this.getCameraToCenterDistance(this.projection,R,z),G=this.scaleZoom(B/(h*this.tileSize)),W=Math.abs(R-G);W<C&&(C=W,M=R),R<G?g=R:b=R}return M}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(h,g){let b=Math.min(h.x,g.x),M=Math.max(h.x,g.x),C=Math.min(h.y,g.y),R=Math.max(h.y,g.y);if(C<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let z=[new n.P(b,C),new n.P(M,R),new n.P(b,R),new n.P(M,C)],B=this.renderWorldCopies?-3:0,G=this.renderWorldCopies?4:1;for(let W of z){let Z=this.pointRayIntersection(W);if(Z.t<0)return!0;let te=this.rayIntersectionCoordinate(Z);if(te.x<B||te.y<0||te.x>G||te.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.b1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(h,g){let b=n.$.length(n.$.sub([],this._camera.position,h)),M=this._zoomFromMercatorZ(b)+g;return b-this._mercatorZfromZoom(M)}getCameraPoint(){if(this.projection.name==="globe"){let h=function([g,b,M],C){let R=[g,b,M,1];n.aB.transformMat4(R,R,C);let z=R[3]=Math.max(R[3],1e-6);return R[0]/=z,R[1]/=z,R[2]/=z,R}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(h[0],h[1])}{let h=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,h))}}getCameraToCenterDistance(h,g=this.zoom,b=this.worldSize){let M=n.aY(h,g,this.width,this.height,1024),C=h.pixelSpaceConversion(this.center.lat,b,M),R=.5/Math.tan(.5*this._fov)*this.height*C;return this.isOrthographic&&(R=ov(1,R,Dm(this.pitch>=15?1:this.pitch/15))),R}getWorldToCameraMatrix(){let h=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.ae.multiply(h,h,this.globeMatrix),h}getFrustum(h){return n.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,this.projection.zAxisUnit==="meters")}}let Po={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},ba=(_,h)=>{if(h>0&&_.terrain&&n.w("Cutoff is currently disabled on terrain"),h<=0||_.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let g=_.transform,b=Math.max(Math.abs(g._zoom-(_.minCutoffZoom-1)),1),M=g.isLODDisabled(!1)?n.a0(60,45,g.pitch):n.a0(30,15,g.pitch),C=g._farZ-g._nearZ,R=h*g.height,z=((1-(B=M))*g.cameraToCenterDistance+B*(g._farZ+R))*b;var B;return{shouldRenderCutoff:M<1,uniformValues:{u_cutoff_params:[g._nearZ,g._farZ,(z-g._nearZ)/C,(z-R-g._nearZ)/C]}}},Ro={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Ds{constructor(h,g){this.aabb=h,this.lastCascade=g}}class rh{add(h,g){let b=this.receivers[h.key];b!==void 0?(b.aabb.min[0]=Math.min(b.aabb.min[0],g.min[0]),b.aabb.min[1]=Math.min(b.aabb.min[1],g.min[1]),b.aabb.min[2]=Math.min(b.aabb.min[2],g.min[2]),b.aabb.max[0]=Math.max(b.aabb.max[0],g.max[0]),b.aabb.max[1]=Math.max(b.aabb.max[1],g.max[1]),b.aabb.max[2]=Math.max(b.aabb.max[2],g.max[2])):this.receivers[h.key]=new Ds(g,null)}clear(){this.receivers={}}get(h){return this.receivers[h.key]}computeRequiredCascades(h,g,b){let M=n.b8.fromPoints(h.points),C=0;for(let R in this.receivers){let z=this.receivers[R];if(!z||!M.intersectsAabb(z.aabb))continue;z.aabb.min=M.closestPoint(z.aabb.min),z.aabb.max=M.closestPoint(z.aabb.max);let B=z.aabb.getCorners();for(let G=0;G<b.length;G++){let W=!0;for(let Z of B){let te=[Z[0]*g,Z[1]*g,Z[2]];if(n.$.transformMat4(te,te,b[G].matrix),te[0]<-1||te[0]>1||te[1]<-1||te[1]>1){W=!1;break}}if(z.lastCascade=G,C=Math.max(C,G),W)break}}return C+1}}class pP{constructor(h){this.painter=h,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new rh,this._depthMode=new n.af(h.context.gl.LEQUAL,n.af.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,h.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),h.tp.registerParameter(Ro,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),h.tp.registerParameter(Ro,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),h.tp.registerParameter(Ro,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),h.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let h of this._cascades)h.texture.destroy(),h.framebuffer.destroy();this._cascades=[]}updateShadowParameters(h,g){let b=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!g||!g.properties)return;let M=g.properties.get("shadow-intensity");if(!g.shadowsEnabled()||M<=0||(this._shadowLayerCount=b.style.order.reduce((ce,ue)=>{let de=b.style._mergedLayers[ue];return ce+(de.hasShadowPass()&&!de.isHidden(h.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let C=b.context,R=Ro.shadowMapResolution,z=Ro.shadowMapResolution;if(this._cascades.length===0||Ro.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ce=0;ce<Ro.cascadeCount;++ce){let ue=b._shadowMapDebug,de=C.gl,pe=C.createFramebuffer(R,z,ue,"texture"),Me=new n.T(C,{width:R,height:z,data:null},de.DEPTH_COMPONENT);if(pe.depthAttachment.set(Me.texture),ue){let Te=new n.T(C,{width:R,height:z,data:null},de.RGBA);pe.colorAttachment.set(Te.texture)}this._cascades.push({framebuffer:pe,texture:Me,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.aM,scale:0})}}this.shadowDirection=Bp(g);let B=0;if(h.elevation){let ce=h.elevation,ue=[1e4,-1e4];ce.visibleDemTiles.filter(de=>de.dem).forEach(de=>{let pe=de.dem.tree;ue[0]=Math.min(ue[0],pe.minimums[0]),ue[1]=Math.max(ue[1],pe.maximums[0])}),ue[0]!==1e4&&(B=(ue[1]-ue[0])*ce.exaggeration())}let G=1.5*h.cameraToCenterDistance,W=3*G,Z=new Float64Array(16);for(let ce=0;ce<this._cascades.length;++ce){let ue=this._cascades[ce],de=h.height/50,pe=1;Ro.cascadeCount===1?pe=W:ce===0?pe=G:(de=G,pe=W);let[Me,Te]=Yx(h,this.shadowDirection,de,pe,Ro.shadowMapResolution,B);ue.scale=h.scale,ue.matrix=Me,ue.boundingSphereRadius=Te,n.ae.invert(Z,ue.matrix),ue.frustum=n.aM.fromInvProjectionMatrix(Z,1,0,!0),ue.far=pe}let te=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[te].far,this._cascades[te].far],this._uniformValues.u_shadow_intensity=M,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ro.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ro.shadowMapResolution,this._uniformValues.u_shadowmap_0=Po.ShadowMap0,this._uniformValues.u_shadowmap_1=Po.ShadowMap0+1,this._groundShadowTiles=b.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let ne=b.transform.elevation;for(let ce of this._groundShadowTiles){let ue={min:0,max:0};if(ne){let de=ne.getMinMaxForTile(ce);de&&(ue=de)}this.addShadowReceiver(ce.toUnwrapped(),ue.min,ue.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(h){this._enabled=h}drawShadowPass(h,g){if(!this.enabled)return;let b=this.painter,M=b.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(b.transform.getFrustum(0),b.transform.worldSize,this._cascades),M.viewport.set([0,0,Ro.shadowMapResolution,Ro.shadowMapResolution]);for(let C=0;C<this._numCascadesToRender;++C){b.currentShadowCascade=C,M.bindFramebuffer.set(this._cascades[C].framebuffer.framebuffer),M.clear({color:n.C.white,depth:1});for(let R of h.order){let z=h._mergedLayers[R];if(!z.hasShadowPass()||z.isHidden(b.transform.zoom))continue;let B=h.getLayerSourceCache(z),G=B?g[B.id]:void 0;(z.type==="model"||G&&G.length)&&b.renderLayer(b,B,z,G)}}b.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let h=this.painter,g=h.style,b=h.context,M=g.directionalLight,C=g.ambientLight;if(!M||!C)return;let R=[],z=ba(h,h.longestCutoffRange);z.shouldRenderCutoff&&R.push("RENDER_CUTOFF");let B=Pm(g,M,C),G=new n.af(b.gl.LEQUAL,n.af.ReadOnly,h.depthRangeFor3D);for(let W of this._groundShadowTiles){let Z=W.toUnwrapped(),te=h.isTileAffectedByFog(W),ne=h.getOrCreateProgram("groundShadow",{defines:R,overrideFog:te});this.setupShadows(Z,ne),h.uploadCommonUniforms(b,ne,Z,null,z);let ce={u_matrix:h.transform.calculateProjMatrix(Z),u_ground_shadow_factor:B};ne.draw(h,b.gl.TRIANGLES,G,n.ah.disabled,n.a.multiply,n.ag.disabled,ce,"ground_shadow",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments,{},h.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?n.a.unblended:n.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(h){let g=this.painter.transform,b=g.calculatePosMatrix(h,g.worldSize);return n.ae.multiply(b,this._cascades[this.painter.currentShadowCascade].matrix,b),Float32Array.from(b)}calculateShadowPassMatrixFromMatrix(h){return n.ae.multiply(h,this._cascades[this.painter.currentShadowCascade].matrix,h),Float32Array.from(h)}setupShadows(h,g,b,M=0){if(!this.enabled)return;let C=this.painter.transform,R=this.painter.context,z=R.gl,B=this._uniformValues,G=new Float64Array(16),W=C.calculatePosMatrix(h,C.worldSize);for(let Z=0;Z<this._cascades.length;Z++)n.ae.multiply(G,this._cascades[Z].matrix,W),B[Z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(G),R.activeTexture.set(z.TEXTURE0+Po.ShadowMap0+Z),this._cascades[Z].texture.bind(z.NEAREST,z.CLAMP_TO_EDGE);if(this.useNormalOffset=!!b,this.useNormalOffset){let Z=n.b7(h.canonical),te=2/C.tileSize*n.a4/Ro.shadowMapResolution,ne=te*this._cascades[0].boundingSphereRadius,ce=te*this._cascades[this._cascades.length-1].boundingSphereRadius,ue=(b==="vector-tile"?1:3)/Math.pow(2,M-h.canonical.z-(1-C.zoom+Math.floor(C.zoom)));B.u_shadow_normal_offset=[Z,ne*ue,ce*ue],B.u_shadow_bias=[6e-5,.0012,.012]}else B.u_shadow_bias=[36e-5,.0012,.012];g.setShadowUniformValues(R,B)}setupShadowsFromMatrix(h,g,b=!1){if(!this.enabled)return;let M=this.painter.context,C=M.gl,R=this._uniformValues,z=new Float64Array(16);for(let B=0;B<Ro.cascadeCount;B++)n.ae.multiply(z,this._cascades[B].matrix,h),R[B===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),M.activeTexture.set(C.TEXTURE0+Po.ShadowMap0+B),this._cascades[B].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=b,b){let B=Ro.normalOffset;R.u_shadow_normal_offset=[1,B,B],R.u_shadow_bias=[6e-5,.0012,.012]}else R.u_shadow_bias=[36e-5,.0012,.012];g.setShadowUniformValues(M,R)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(h,g,b,M){if(M[2]>=0)return{};let C=function(B,G,W){let Z=W/(1<<B.canonical.z);return new n.b8([B.canonical.x*Z+B.wrap*W,B.canonical.y*Z+B.wrap*W,0],[(B.canonical.x+1)*Z+B.wrap*W,(B.canonical.y+1)*Z+B.wrap*W,G])}(h,g,b).getCorners(),R=g/-M[2];M[0]<0?(n.$.add(C[0],C[0],[M[0]*R,0,0]),n.$.add(C[3],C[3],[M[0]*R,0,0])):M[0]>0&&(n.$.add(C[1],C[1],[M[0]*R,0,0]),n.$.add(C[2],C[2],[M[0]*R,0,0])),M[1]<0?(n.$.add(C[0],C[0],[0,M[1]*R,0]),n.$.add(C[1],C[1],[0,M[1]*R,0])):M[1]>0&&(n.$.add(C[2],C[2],[0,M[1]*R,0]),n.$.add(C[3],C[3],[0,M[1]*R,0]));let z={};return z.vertices=C,z.planes=[Np(C[1],C[0],C[4]),Np(C[2],C[1],C[5]),Np(C[3],C[2],C[6]),Np(C[0],C[3],C[7])],z}addShadowReceiver(h,g,b){this._receivers.add(h,n.b8.fromTileIdAndHeight(h,g,b))}getMaxCascadeForTile(h){let g=this._receivers.get(h);return g&&g.lastCascade?g.lastCascade:0}}function Np(_,h,g){let b=n.$.sub([],g,h),M=n.$.sub([],_,h),C=n.$.cross([],b,M),R=n.$.length(C);return R===0?[0,0,1,0]:(n.$.scale(C,C,1/R),[C[0],C[1],C[2],-n.$.dot(C,h)])}function Bp(_){let h=_.properties.get("direction"),g=n.ad(h.x,h.y,h.z);g[2]=n.au(g[2],0,75);let b=n.b9([g[0],g[1],g[2]]);return n.$.fromValues(b.x,b.y,b.z)}function Pm(_,h,g){let b=h.properties.get("color"),M=h.properties.get("intensity"),C=h.properties.get("direction"),R=[C.x,C.y,C.z],z=g.properties.get("color"),B=g.properties.get("intensity"),G=Math.max(n.$.dot([0,0,1],R),0),W=[0,0,0];n.$.scale(W,z.toRenderColor(_.getLut(h.scope)).toArray01Linear().slice(0,3),B);let Z=[0,0,0];return n.$.scale(Z,b.toRenderColor(_.getLut(g.scope)).toArray01Linear().slice(0,3),G*M),n.ba([W[0]>0?W[0]/(W[0]+Z[0]):0,W[1]>0?W[1]/(W[1]+Z[1]):0,W[2]>0?W[2]/(W[2]+Z[2]):0])}function Yx(_,h,g,b,M,C){let R=_.zoom,z=_.scale,B=_.worldSize,G=1/B,W=_.aspect,Z=Math.sqrt(1+W*W)*Math.tan(.5*_.fovX),te=Z*Z,ne=b-g,ce=b+g,ue,de;te>ne/ce?(ue=b,de=b*Z):(ue=.5*ce*(1+te),de=.5*Math.sqrt(ne*ne+2*(b*b+g*g)*te+ce*ce*te*te));let pe=_.projection.pixelsPerMeter(_.center.lat,B),Me=_._camera.getCameraToWorldMercator(),Te=[0,0,-ue*G];n.$.transformMat4(Te,Te,Me);let Se=de*G,Be=_._edgeInsets;if(!(Be.left===0&&Be.top===0&&Be.right===0&&Be.bottom===0||Be.left===Be.right&&Be.top===Be.bottom)){let Rt=_._camera.getWorldToCamera(_.worldSize,_.projection.zAxisUnit==="meters"?pe:1),Ft=_._camera.getCameraToClipPerspective(_._fov,_.width/_.height,g,b);Ft[8]=2*-_.centerOffset.x/_.width,Ft[9]=2*_.centerOffset.y/_.height;let oi=new Float64Array(16);n.ae.mul(oi,Ft,Rt);let ci=new Float64Array(16);n.ae.invert(ci,oi);let Si=n.aM.fromInvProjectionMatrix(ci,B,R,!0);for(let hi of Si.points){let ji=((Oe=hi)[0]/=z,Oe[1]/=z,Oe[2]=n.ay(Oe[2],_._center.lat),Oe);Se=Math.max(Se,n.$.len(n.$.subtract([],Te,ji)))}}var Oe;Se*=M/(M-1);let Le=Math.acos(h[2]),Ge=Math.atan2(-h[0],-h[1]),We=new zp;We.position=Te,We.setPitchBearing(Le,Ge);let at=We.getWorldToCamera(B,pe),Ye=Se*B,Ne=Math.min(_._mercatorZfromZoom(17)*B*-2,-2*Ye),gt=We.getCameraToClipOrthographic(-Ye,Ye,-Ye,Ye,Ne,(Ye+C*pe)/h[2]),ft=new Float64Array(16);n.ae.multiply(ft,gt,at);let tt=n.$.fromValues(Math.floor(1e6*Te[0])/1e6*B,Math.floor(1e6*Te[1])/1e6*B,0),Bt=.5*M,Pt=[0,0,0];n.$.transformMat4(Pt,tt,ft),n.$.scale(Pt,Pt,Bt);let ct=[Math.floor(Pt[0]),Math.floor(Pt[1]),Math.floor(Pt[2])],_t=[0,0,0];n.$.sub(_t,Pt,ct),n.$.scale(_t,_t,-1/Bt);let Qe=new Float64Array(16);return n.ae.identity(Qe),n.ae.translate(Qe,Qe,_t),n.ae.multiply(ft,Qe,ft),[ft,Ye]}function Rm(_,h){return _!=null&&h!=null&&!(!_.hasData()||!h.hasData())&&_.demTexture!=null&&h.demTexture!=null&&_.tileID.key!==h.tileID.key}let nh=new class{constructor(){this.operations={}}newMorphing(_,h,g,b,M){if(_ in this.operations){let C=this.operations[_];C.to.tileID.key!==g.tileID.key&&(C.queued=g)}else this.operations[_]={startTime:b,phase:0,duration:M,from:h,to:g,queued:null}}getMorphValuesForProxy(_){if(!(_ in this.operations))return null;let h=this.operations[_];return{from:h.from,to:h.to,phase:h.phase}}update(_){for(let h in this.operations){let g=this.operations[h];for(g.phase=(_-g.startTime)/g.duration;g.phase>=1||!this._validOp(g);)if(!this._nextOp(g,_)){delete this.operations[h];break}}}_nextOp(_,h){return!!_.queued&&(_.from=_.to,_.to=_.queued,_.queued=null,_.phase=0,_.startTime=h,!0)}_validOp(_){return _.from.hasData()&&_.to.hasData()}},Om={0:null,1:"TERRAIN_VERTEX_MORPHING"};function sh(_,h,g){if(h===0)return 0;let b=h<1&&g===514?.25/h:1;return 6*Math.pow(1.5,22-_)*Math.max(h,1)*b}function Lm(_,h){let g=1<<_.z;return!h&&(_.x===0||_.x===g-1)||_.y===0||_.y===g-1}let zm=_=>({u_matrix:_});function av(_,h,g,b,M){if(M>0){let C=n.e.now(),R=(C-_.timeAdded)/M,z=h?(C-h.timeAdded)/M:-1,B=g.getSource(),G=b.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),W=!h||Math.abs(h.tileID.overscaledZ-G)>Math.abs(_.tileID.overscaledZ-G),Z=W&&_.refreshedUponExpiration?1:n.au(W?R:1-z,0,1);return _.refreshedUponExpiration&&R>=1&&(_.refreshedUponExpiration=!1),h?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}class oh extends Za{constructor(h,g,b,M){super(h,g,b,M),this.type="raster-array",this.maxzoom=22,this._options=n.Q({type:"raster-array"},g)}triggerRepaint(h){let g=this.map.painter._terrain,b=this.map.style.getSourceCache(this.id);g&&g.enabled&&b&&g._clearRenderCacheForTile(b.id,h.tileID),this.map.triggerRepaint()}loadTile(h,g){let b=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),M=this.map._requestManager.transformRequest(b,n.R.Tile);h.requestParams=M,h.actor||(h.actor=this.dispatcher.getActor()),h.request=h.fetchHeader(void 0,(C,R,z,B)=>{if(delete h.request,h.aborted)return h.state="unloaded",g(null);if(C)return C.code===20?void 0:(h.state="errored",g(C));this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:z,expires:B}),h.state="empty",g(null)})}unloadTile(h,g){let b=h.texture;b&&b instanceof n.T?(h.destroy(!0),this.map.painter.saveTileTexture(b)):(h.destroy(),h.flushQueues(),h._isHeaderLoaded=!1,delete h._mrt,delete h.textureDescriptor),h.fbo&&(h.fbo.destroy(),delete h.fbo),delete h.request,delete h.requestParams,delete h.neighboringTiles,h.state="unloaded"}prepareTile(h,g,b){h._isHeaderLoaded&&(h.state!=="empty"&&(h.state="reloading"),h.fetchBand(g,b,(M,C)=>{if(M)return h.state="errored",this.fire(new n.f(M)),void this.triggerRepaint(h);C&&(h.setTexture(C,this.map.painter),h.state="loaded",this.triggerRepaint(h))}))}getInitialBand(h){if(!this.rasterLayers)return 0;let g=this.rasterLayers.find(({id:C})=>C===h),b=g&&g.fields,M=b&&b.bands&&b.bands;return M?M[0]:0}getTextureDescriptor(h,g,b){if(!h)return;let M=g.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!M)return;let C=null;g instanceof n.bm?C=g.paint.get("raster-array-band"):g instanceof n.bn&&(C=g.paint.get("raster-particle-array-band"));let R=C||this.getInitialBand(M);if(R!=null)if(h.textureDescriptor){if(!h.updateNeeded(M,R)||b)return Object.assign({},h.textureDescriptor,{texture:h.texture})}else this.prepareTile(h,M,R)}}let lv={vector:pE,raster:Za,"raster-dem":class extends Za{constructor(_,h,g,b){super(_,h,g,b),this.type="raster-dem",this.maxzoom=22,this._options=n.Q({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}loadTile(_,h){let g=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function b(M,C){M&&(_.state="errored",h(M)),C&&(_.dem=C,_.dem.onDeserialize(),_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0,_.state="loaded",h(null))}_.request=n.i(this.map._requestManager.transformRequest(g,n.R.Tile),(function(M,C,R,z){if(delete _.request,_.aborted)_.state="unloaded",h(null);else if(M)_.state="errored",h(M);else if(C){this.map._refreshExpiredTiles&&_.setExpiryData({cacheControl:R,expires:z});let B=ImageBitmap&&C instanceof ImageBitmap&&n.bk(),G=1-(C.width-n.bl(C.width))/2;G<1||_.neighboringTiles||(_.neighboringTiles=this._getNeighboringTiles(_.tileID));let W=B?C:n.e.getImageData(C,G),Z={uid:_.uid,coord:_.tileID,source:this.id,scope:this.scope,rawImageData:W,encoding:this.encoding,padding:G};_.actor&&_.state!=="expired"||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",Z,b.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(_){let h=_.canonical,g=Math.pow(2,h.z),b=(h.x-1+g)%g,M=h.x===0?_.wrap-1:_.wrap,C=(h.x+1+g)%g,R=h.x+1===g?_.wrap+1:_.wrap,z={};return z[new n.aQ(_.overscaledZ,M,h.z,b,h.y).key]={backfilled:!1},z[new n.aQ(_.overscaledZ,R,h.z,C,h.y).key]={backfilled:!1},h.y>0&&(z[new n.aQ(_.overscaledZ,M,h.z,b,h.y-1).key]={backfilled:!1},z[new n.aQ(_.overscaledZ,_.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},z[new n.aQ(_.overscaledZ,R,h.z,C,h.y-1).key]={backfilled:!1}),h.y+1<g&&(z[new n.aQ(_.overscaledZ,M,h.z,b,h.y+1).key]={backfilled:!1},z[new n.aQ(_.overscaledZ,_.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},z[new n.aQ(_.overscaledZ,R,h.z,C,h.y+1).key]={backfilled:!1}),z}},"raster-array":oh,geojson:class extends n.E{constructor(_,h,g,b){super(),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(b),this._data=h.data,this._options=n.Q({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.minzoom!==void 0&&(this.minzoom=h.minzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;let M=n.a4/this.tileSize;this.workerOptions=n.Q({source:this.id,scope:this.scope,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*M,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*M,extent:n.a4,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:n.a4,radius:(h.clusterRadius!==void 0?h.clusterRadius:50)*M,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter,dynamic:h.dynamic},h.workerOptions)}onAdd(_){this.map=_,this.setData(this._data)}setData(_){return this._data=_,this._updateWorkerData(),this}updateData(_){if(!this._options.dynamic)return this.fire(new n.f(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof _!="string"&&(_.type==="Feature"&&(_={type:"FeatureCollection",features:[_]}),_.type!=="FeatureCollection"))return this.fire(new n.f(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof _!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){let h=new Map;for(let g of this._data.features)h.set(g.id,g);for(let g of _.features)h.set(g.id,g);this._data.features=[...h.values()]}else this._data=_;return this._updateWorkerData(!0),this}getClusterExpansionZoom(_,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id,scope:this.scope},h),this}getClusterChildren(_,h){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id,scope:this.scope},h),this}getClusterLeaves(_,h,g,b){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:_,limit:h,offset:g},b),this}_updateWorkerData(_=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.g("dataloading",{dataType:"source"})),this._loaded=!1;let h=n.Q({append:_},this.workerOptions);h.scope=this.scope;let g=this._data;typeof g=="string"?(h.request=this.map._requestManager.transformRequest(n.e.resolveURL(g),n.R.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(g),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(b,M)=>{if(this._loaded=!0,this._pendingLoad=null,b)this.fire(new n.f(b));else{let C={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&M&&M.resourceTiming&&M.resourceTiming[this.id]&&(C.resourceTiming=M.resourceTiming[this.id]),_&&(this._partialReload=!0),this.fire(new n.g("data",C)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(_),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(_,h){let g=_.actor?"reloadTile":"loadTile";_.actor=this.actor;let b=this.map.style?this.map.style.getLut(this.scope):null,M=this._partialReload,C={type:this.type,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:b?{image:b.image.clone()}:null,scope:this.scope,pixelRatio:n.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:M};_.request=this.actor.send(g,C,(R,z)=>M&&!z?(_.state="loaded",h(null)):(delete _.request,_.destroy(),_.aborted?h(null):R?h(R):(_.loadVectorData(z,this.map.painter,g==="reloadTile"),h(null))),void 0,g==="loadTile")}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0}unloadTile(_,h){this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id,scope:this.scope}),_.destroy()}onRemove(_){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.Q({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.bo{constructor(_,h,g,b){super(_,h,g,b),this.roundZoom=!0,this.type="video",this.options=h}load(){this._loaded=!1;let _=this.options;this.urls=[];for(let h of _.urls)this.urls.push(this.map._requestManager.transformRequest(h,n.R.Source).url);n.bp(this.urls,(h,g)=>{this._loaded=!0,h?this.fire(new n.f(h)):g&&(this.video=g,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(_){if(this.video){let h=this.video.seekable;_<h.start(0)||_>h.end(0)?this.fire(new n.f(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=_}}getVideo(){return this.video}onAdd(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let _=this.map.painter.context,h=_.gl;this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(_,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(_)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.bo,model:class extends n.E{constructor(_,h,g,b){super(),this.id=_,this.type="model",this.models=[],this._loaded=!1,this._options=h}load(){let _=[];for(let h in this._options.models){let g=this._options.models[h],b=n.l(this.map._requestManager.transformRequest(g.uri,n.R.Model).url).then(M=>{if(!M)return;let C=n.c(M),R=new n.M(h,g.position,g.orientation,C);R.computeBoundsAndApplyParent(),this.models.push(R)}).catch(M=>{this.fire(new n.f(new Error(`Could not load model ${h} from ${g.uri}: ${M.message}`)))});_.push(b)}return Promise.allSettled(_).then(()=>{this._loaded=!0,this.fire(new n.g("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(h=>{this.fire(new n.f(new Error(`Could not load models: ${h.message}`)))})}onAdd(_){this.map=_,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(_,h){}serialize(){return{type:"model"}}},"batched-model":class extends n.E{constructor(_,h,g,b){super(),this.type="batched-model",this.id=_,this.tileSize=512,this._options=h,this.tiles=this._options.tiles,this.maxzoom=h.maxzoom||19,this.minzoom=h.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=g,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(b)}onAdd(_){this.map=_,this.load()}load(_){this._loaded=!1,this.fire(new n.g("dataloading",{dataType:"source"}));let h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=Vx(this._options,this.map._requestManager,h,g,(b,M)=>{this._tileJSONRequest=null,this._loaded=!0,b?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new n.f(b))):M&&(n.Q(this,M),M.bounds&&(this.tileBounds=new Mm(M.bounds,this.minzoom,this.maxzoom)),n.ao(M.tiles,this.map._requestManager._customAccessToken),this.fire(new n.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.g("data",{dataType:"source",sourceDataType:"content"}))),_&&_(b)})}hasTransition(){return!1}hasTile(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)}loaded(){return this._loaded}loadTile(_,h){let g=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(g,n.R.Tile),data:void 0,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,tileSize:this.tileSize*_.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:_.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(_.actor&&_.state!=="expired")if(_.state==="loading")_.reloadCallback=h;else{if(_.buckets){let C=Object.values(_.buckets);for(let R of C)R.dirty=!0;return void(_.state="loaded")}_.request=_.actor.send("reloadTile",b,M.bind(this))}else _.actor=this.dispatcher.getActor(),_.request=_.actor.send("loadTile",b,M.bind(this),void 0,!0);function M(C,R){return _.aborted?h(null):C&&C.status!==404?h(C):(R&&(R.resourceTiming&&(_.resourceTiming=R.resourceTiming),this.map._refreshExpiredTiles&&_.setExpiryData(R),_.buckets=me(me({},_.buckets),R.buckets),R.featureIndex&&(_.latestFeatureIndex=R.featureIndex)),_.state="loaded",void h(null))}}serialize(){return n.Q({},this._options)}},canvas:class extends n.bo{constructor(_,h,g,b){super(_,h,g,b),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(M=>!Array.isArray(M)||M.length!==2||M.some(C=>typeof C!="number"))||this.fire(new n.f(new n.V(`sources.${_}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.f(new n.V(`sources.${_}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new n.f(new n.V(`sources.${_}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new n.f(new n.V(`sources.${_}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.f(new n.V(`sources.${_}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.f(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()}onRemove(_){this.pause()}prepare(){let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let h=this.map.painter.context;this.texture?!_&&!this._playing||this.texture instanceof n.bq||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(h,this.canvas,h.gl.RGBA,{premultiply:!0}),this._prepareData(h)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let _ of[this.canvas.width,this.canvas.height])if(isNaN(_)||_<=0)return!0;return!1}},custom:class extends n.E{constructor(_,h,g,b){super(),this.id=_,this.type="custom",this._dataType="raster",this._dispatcher=g,this._implementation=h,this.setEventedParent(b),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.f(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.f(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Mm(this._implementation.bounds,this.minzoom,this.maxzoom)),h.update=this._update.bind(this),h.clearTiles=this._clearTiles.bind(this),h.coveringTiles=this._coveringTiles.bind(this),n.Q(this,n.ai(h,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.ai(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.g("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(_){this.map=_,this._loaded=!1,this.fire(new n.g("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(_),this.load()}onRemove(_){this._implementation.onRemove&&this._implementation.onRemove(_)}hasTile(_){if(this._implementation.hasTile){let{x:h,y:g,z:b}=_.canonical;return this._implementation.hasTile({x:h,y:g,z:b})}return!this.tileBounds||this.tileBounds.contains(_.canonical)}loadTile(_,h){let{x:g,y:b,z:M}=_.tileID.canonical,C=new AbortController;_.request=Promise.resolve(this._implementation.loadTile({x:g,y:b,z:M},{signal:C.signal})).then((function(R){return delete _.request,_.aborted?(_.state="unloaded",h(null)):R===void 0?(_.state="errored",h(null)):R===null?(this.loadTileData(_,{width:this.tileSize,height:this.tileSize,data:null}),_.state="loaded",h(null)):function(z){return z instanceof ImageData||z instanceof HTMLCanvasElement||z instanceof ImageBitmap||z instanceof HTMLImageElement}(R)?(this.loadTileData(_,R),_.state="loaded",void h(null)):(_.state="errored",h(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(R=>{R.code!==20&&(_.state="errored",h(R))}),_.request.cancel=()=>C.abort()}loadTileData(_,h){_.setTexture(h,this.map.painter)}unloadTile(_,h){if(_.texture&&_.texture instanceof n.T?(_.destroy(!0),_.texture&&_.texture instanceof n.T&&this.map.painter.saveTileTexture(_.texture)):_.destroy(),this._implementation.unloadTile){let{x:g,y:b,z:M}=_.tileID.canonical;this._implementation.unloadTile({x:g,y:b,z:M})}h&&h()}abortTile(_,h){_.request&&_.request.cancel&&(_.request.cancel(),delete _.request),h&&h()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(_=>({x:_.canonical.x,y:_.canonical.y,z:_.canonical.z}))}_clearTiles(){let _=n.am(this.id,this.scope);this.map.style.clearSource(_)}_update(){this.fire(new n.g("data",{dataType:"source",sourceDataType:"content"}))}}},cv=function(_,h,g,b){let M=new lv[h.type](_,h,g,b);if(M.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${M.id}`);return n.br(["load","abort","unload","serialize","prepare"],M),M};class yE extends n.bx{constructor(h){let g={type:"raster-dem",maxzoom:h.transform.maxZoom},b=new n.by(n.bz(),null),M=cv("mock-dem",g,b,h.style);super("mock-dem",M,!1),M.setEventedParent(this),this._sourceLoaded=!0}_loadTile(h,g){h.state="loaded",g(null)}}class vE extends n.bx{constructor(h){let g=cv("proxy",{type:"geojson",maxzoom:h.transform.maxZoom},new n.by(n.bz(),null),h.style);super("proxy",g,!1),g.setEventedParent(this),this.map=this.getSource().map=h,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(h,g,b){if(h.freezeTileCoverage)return;this.transform=h;let M=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,R)=>{if(C[R.key]="",!this._tiles[R.key]){let z=new n.bA(R,this._source.tileSize*R.overscaleFactor(),h.tileZoom);z.state="loaded",this._tiles[R.key]=z}return C},{});for(let C in this._tiles)C in M||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(h){let g=this.proxyCachedFBO[h];if(g!==void 0){let b=Object.values(g);this.renderCachePool.push(...b),delete this.proxyCachedFBO[h]}}deallocRenderCache(){this.renderCache.forEach(h=>h.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Xx extends n.aQ{constructor(h,g,b){super(h.overscaledZ,h.wrap,h.canonical.z,h.canonical.x,h.canonical.y),this.proxyTileKey=g,this.projMatrix=b}}class Oo extends n.bs{constructor(h,g){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},h.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),h.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),h.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=h,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[b,M,C]=function(B){let G=new n.bv,W=new n.bw,Z=131;G.reserve(17161),W.reserve(33800);let te=n.a4/128,ne=n.a4+te/2,ce=ne+te;for(let de=-te;de<ce;de+=te)for(let pe=-te;pe<ce;pe+=te){let Me=pe<0||pe>ne||de<0||de>ne?24575:0,Te=n.au(Math.round(pe),0,n.a4),Se=n.au(Math.round(de),0,n.a4);G.emplaceBack(Te+Me,Se)}let ue=(de,pe)=>{let Me=pe*Z+de;W.emplaceBack(Me+1,Me,Me+Z),W.emplaceBack(Me+Z,Me+Z+1,Me+1)};for(let de=1;de<129;de++)for(let pe=1;pe<129;pe++)ue(pe,de);return[0,129].forEach(de=>{for(let pe=0;pe<130;pe++)ue(pe,de),ue(de,pe)}),[G,W,32768]}(),R=h.context;this.gridBuffer=R.createVertexBuffer(b,n.bt.members),this.gridIndexBuffer=R.createIndexBuffer(M),this.gridSegments=n.b.simpleSegment(0,0,b.length,M.length),this.gridNoSkirtSegments=n.b.simpleSegment(0,0,b.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new vE(g.map),this.orthoMatrix=n.ae.create(),n.ae.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.a4,0,n.a4,0,1);let z=R.gl;this._overlapStencilMode=new n.ah({func:z.GEQUAL,mask:255},0,255,z.KEEP,z.KEEP,z.REPLACE),this._previousZoom=h.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=g,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new yE(g.map),this._pendingGroundEffectLayers=[]}set style(h){h.on("data",this._onStyleDataEvent.bind(this)),this._style=h,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(h,g,b){if(h&&h.terrain){this._style!==h&&(this.style=h,this._evaluationZoom=void 0);let M=h.terrain.properties,C=h.terrain.drapeRenderMode===0,R=h.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.e.now();let z=h.terrain&&h.terrain.scope,B=M.get("source"),G=C?this._mockSourceCache:h.getSourceCache(B,z);if(!G)return void n.w(`Couldn't find terrain source "${B}".`);if(this.sourceCache=G,this._exaggeration=R?this.calculateExaggeration(g):M.get("exaggeration"),!g.projection.requiresDraping&&R&&this._exaggeration===0)return void this._disable();this.enabled=!0;let W=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let Z=this.getScaledDemTileSize();this.sourceCache.update(g,Z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,W(),this._initializing=!0),W(),g.updateElevation(!0,b),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(g),this._emptyDEMTextureDirty=!0,this._previousZoom=g.zoom}else this._disable()}calculateExaggeration(h){let g=this._previousCameraAltitude,b=h.getFreeCameraOptions().position.z/h.pixelsPerMeter*h.worldSize;this._previousCameraAltitude=b;let M=g!=null?b-g:Number.MAX_VALUE;if(Math.abs(M)<2)return this._exaggeration;let C=h.zoom,R=this._style.terrain;if(!this._previousUpdateTimestamp)return R.getExaggeration(C);let z=C-this._previousZoom,B=this._previousUpdateTimestamp,G=C;this._evaluationZoom!=null&&(G=this._evaluationZoom,Math.abs(C-G)>.5&&(z=.5*(C-G+z)),z*M<0&&(G+=z)),this._evaluationZoom=G;let W=R.getExaggeration(G),Z=W===R.getExaggeration(Math.max(0,G-.1));if(Z&&Math.abs(W-this._exaggeration)<.01)return W;let te=Math.min(.1,.00375*(this._updateTimestamp-B));return(Z||W<.1||Math.abs(z)<1e-4)&&(te=Math.min(.2,4*te)),n.a3(this._exaggeration,W,te)}resetTileLookupCache(h){this._findCoveringTileCache[h]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(h){h.coord&&h.dataType==="source"?this._clearRenderCacheForTile(h.sourceCacheId,h.coord):h.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let h in this._style._mergedSourceCaches)this._style._mergedSourceCaches[h].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(h=>h.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let h=2*this.proxySourceCache.getSource().tileSize;return[h,h]}set useVertexMorphing(h){this._useVertexMorphing=h}updateTileBinding(h){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let g=this.proxySourceCache,b=this.painter.transform;this._initializing&&(this._initializing=b._centerAltitude===0&&this.getAtPointOrZero(n._.fromLngLat(b.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let M=this.proxyCoords=g.getIds().map(B=>{let G=g.getTileByID(B).tileID;return G.projMatrix=b.calculateProjMatrix(G.toUnwrapped()),G});(function(B,G){let W=G.transform.pointCoordinate(G.transform.getCameraPoint()),Z=new n.P(W.x,W.y);B.sort((te,ne)=>{if(ne.overscaledZ-te.overscaledZ)return ne.overscaledZ-te.overscaledZ;let ce=new n.P(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),ue=new n.P(ne.canonical.x+(1<<ne.canonical.z)*ne.wrap,ne.canonical.y),de=Z.mult(1<<te.canonical.z);return de.x-=.5,de.y-=.5,de.distSqr(ce)-de.distSqr(ue)})})(M,this.painter);let C=this.proxyToSource||{};this.proxyToSource={},M.forEach(B=>{this.proxyToSource[B.key]={}}),this.terrainTileForTile={};let R=this._style._mergedSourceCaches;for(let B in R){let G=R[B];if(!G.used||(G!==this.sourceCache&&this.resetTileLookupCache(G.id),this._setupProxiedCoordsForOrtho(G,h[B],C),G.usedForTerrain))continue;let W=h[B];G.getSource().reparseOverscaled&&this._assignTerrainTiles(W)}this.proxiedCoords[g.id]=M.map(B=>new Xx(B,B.key,this.orthoMatrix)),this._assignTerrainTiles(M),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1;let z={};this._visibleDemTiles=[];for(let B of this.proxyCoords){let G=this.terrainTileForTile[B.key];if(!G)continue;let W=G.tileID.key;W in z||(this._visibleDemTiles.push(G),z[W]=W)}}_assignTerrainTiles(h){this._initializing||h.forEach(g=>{if(this.terrainTileForTile[g.key])return;let b=this._findTileCoveringTileID(g,this.sourceCache);b&&(this.terrainTileForTile[g.key]=b)})}_prepareDEMTextures(){let h=this.painter.context,g=h.gl;for(let b in this.terrainTileForTile){let M=this.terrainTileForTile[b],C=M.dem;!C||M.demTexture&&!M.needsDEMTextureUpload||(h.activeTexture.set(g.TEXTURE1),dE(this.painter,M,C))}}_prepareDemTileUniforms(h,g,b,M){if(!g||g.demTexture==null)return!1;let C=h.tileID.canonical,R=Math.pow(2,g.tileID.canonical.z-C.z),z=M||"";return b[`u_dem_tl${z}`]=[C.x*R%1,C.y*R%1],b[`u_dem_scale${z}`]=R,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let h=0,g=this._visibleDemTiles.reduce((b,M)=>{if(!M.dem)return b;let C=M.dem.tree.minimums[0];return C>0&&h++,b+C},0);return h?g/h:0}_updateEmptyDEMTexture(){let h=this.painter.context,g=h.gl;h.activeTexture.set(g.TEXTURE2);let b=this._getLoadedAreaMinimum(),[M,C]=(()=>{let z=new n.bB({width:1,height:1},new Float32Array([b]));return[g.R32F,z]})();this._emptyDEMTextureDirty=!1;let R=this._emptyDEMTexture;return R?R.update(C,{premultiply:!1}):R=this._emptyDEMTexture=new n.T(h,C,M,{premultiply:!1}),R}setupElevationDraw(h,g,b){let M=this.painter.context,C=M.gl,R={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};R.u_exaggeration=this.exaggeration();let z=null,B=null,G=1;if(b&&b.morphing&&this._useVertexMorphing){let ne=b.morphing.srcDemTile,ce=b.morphing.dstDemTile;G=b.morphing.phase,ne&&ce&&(this._prepareDemTileUniforms(h,ne,R,"_prev")&&(B=ne),this._prepareDemTileUniforms(h,ce,R)&&(z=ce))}let W=ne=>ne&&ne.demTexture&&this.painter.linearFloatFilteringSupported()?C.LINEAR:C.NEAREST,Z=null;var te;if(this.enabled?B&&z?(Z=z.demTexture,M.activeTexture.set(C.TEXTURE4),B.demTexture.bind(W(B),C.CLAMP_TO_EDGE),R.u_dem_lerp=G):(z=this.terrainTileForTile[h.tileID.key],Z=this._prepareDemTileUniforms(h,z,R)?z.demTexture:this.emptyDEMTexture):Z=this.emptyDEMTexture,M.activeTexture.set(C.TEXTURE2),Z&&(R.u_dem_size=(te=Z).size[0]===1?1:te.size[0]-2,Z.bind(W(z),C.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(b&&b.useDepthForOcclusion,g,R),b&&b.useMeterToDem&&z){let ne=(1<<z.tileID.canonical.z)*n.ay(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;R.u_meter_to_dem=ne}if(b&&b.labelPlaneMatrixInv&&(R.u_label_plane_matrix_inv=b.labelPlaneMatrixInv),g.setTerrainUniformValues(M,R),this.painter.transform.projection.name==="globe"){let ne=this.globeUniformValues(this.painter.transform,h.tileID.canonical,b&&b.useDenormalizedUpVectorScale);g.setGlobeUniformValues(M,ne)}}globeUniformValues(h,g,b){let M=h.projection;return{u_tile_tl_up:M.upVector(g,0,0),u_tile_tr_up:M.upVector(g,n.a4,0),u_tile_br_up:M.upVector(g,n.a4,n.a4),u_tile_bl_up:M.upVector(g,0,n.a4),u_tile_up_scale:b?n.bu(1):M.upVectorScale(g,h.center.lat,h.worldSize).metersToTile}}renderToBackBuffer(h){let g=this.painter,b=this.painter.context;h.length!==0&&(b.bindFramebuffer.set(null),b.viewport.set([0,0,g.width,g.height]),g.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(M,C,R,z,B){if(M.transform.projection.name==="globe")(function(G,W,Z,te,ne){let ce=G.context,ue=ce.gl,de,pe,Me=G.transform,Te=n.bc(G,ce,Me),Se=(gt,ft)=>{if(pe===ft)return;let tt=[Om[ft],"PROJECTION_GLOBE_VIEW"];Te&&tt.push("CUSTOM_ANTIALIASING");let Bt=G.isTileAffectedByFog(gt);de=G.getOrCreateProgram("globeRaster",{defines:tt,overrideFog:Bt}),pe=ft},Be=G.colorModeForRenderPass(),Oe=new n.af(ue.LEQUAL,n.af.ReadWrite,G.depthRangeFor3D);nh.update(ne);let Le=n.bd(Me),Ge=[n.ak(Me.center.lng),n.al(Me.center.lat)],We=G.globeSharedBuffers,at=[Me.width*n.e.devicePixelRatio,Me.height*n.e.devicePixelRatio],Ye=Float32Array.from(Me.globeMatrix),Ne={useDenormalizedUpVectorScale:!0};{let gt=G.transform,ft=sh(gt.zoom,W.exaggeration(),W.sourceCache._source.tileSize);pe=-1;let tt=ue.TRIANGLES;for(let Bt of te){let Pt=Z.getTile(Bt),ct=n.ah.disabled,_t=W.prevTerrainTileForTile[Bt.key],Qe=W.terrainTileForTile[Bt.key];Rm(_t,Qe)&&nh.newMorphing(Bt.key,_t,Qe,ne,250),ce.activeTexture.set(ue.TEXTURE0),Pt.texture&&Pt.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);let Rt=nh.getMorphValuesForProxy(Bt.key),Ft=Rt?1:0;Rt&&n.q(Ne,{morphing:{srcDemTile:Rt.from,dstDemTile:Rt.to,phase:n.bb(Rt.phase)}});let oi=n.be(Bt.canonical),ci=n.bf(oi.getCenter().lat),Si=n.bg(Bt.canonical,oi,ci,gt.worldSize/gt._pixelsPerMercatorPixel),hi=n.bh(n.bi(Bt.canonical)),ji=Gx(gt.expandedFarZProjMatrix,Ye,Le,hi,n.a2(gt.zoom),Ge,gt.frustumCorners.TL,gt.frustumCorners.TR,gt.frustumCorners.BR,gt.frustumCorners.BL,gt.globeCenterInViewSpace,gt.globeRadius,at,ft,gt._farZ,Si);if(Se(Bt,Ft),de&&(W.setupElevationDraw(Pt,de,Ne),G.uploadCommonUniforms(ce,de,Bt.toUnwrapped()),We)){let[cr,Wi,gr]=We.getGridBuffers(ci,ft!==0);de.draw(G,tt,Oe,ct,Be,n.ag.backCCW,ji,"globe_raster",cr,Wi,gr)}}}if(We&&(G.renderDefaultNorthPole||G.renderDefaultSouthPole)){let gt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Te&&gt.push("CUSTOM_ANTIALIASING"),de=G.getOrCreateProgram("globeRaster",{defines:gt});for(let ft of te){let{x:tt,y:Bt,z:Pt}=ft.canonical,ct=Bt===0,_t=Bt===(1<<Pt)-1,[Qe,Rt,Ft,oi]=We.getPoleBuffers(Pt,!1);if(oi&&(ct||_t)){let ci=Z.getTile(ft);ce.activeTexture.set(ue.TEXTURE0),ci.texture&&ci.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);let Si=n.bj(Pt,tt,Me),hi=n.bh(n.bi(ft.canonical)),ji=(cr,Wi)=>cr.draw(G,ue.TRIANGLES,Oe,n.ah.disabled,Be,n.ag.disabled,Gx(Me.expandedFarZProjMatrix,Si,Si,hi,0,Ge,Me.frustumCorners.TL,Me.frustumCorners.TR,Me.frustumCorners.BR,Me.frustumCorners.BL,Me.globeCenterInViewSpace,Me.globeRadius,at,0,Me._farZ),"globe_pole_raster",Wi,Ft,oi);W.setupElevationDraw(ci,de,Ne),G.uploadCommonUniforms(ce,de,ft.toUnwrapped()),ct&&G.renderDefaultNorthPole&&ji(de,Qe),_t&&G.renderDefaultSouthPole&&(Si=n.ae.scale(n.ae.create(),Si,[1,-1,1]),ji(de,Rt))}}}})(M,C,R,z,B);else{let G=M.context,W=G.gl,Z,te,ne=M.shadowRenderer,ce=ba(M,M.longestCutoffRange),ue=Be=>{if(te===Be)return;let Oe=[];Oe.push(Om[Be]),ce.shouldRenderCutoff&&Oe.push("RENDER_CUTOFF"),Z=M.getOrCreateProgram("terrainRaster",{defines:Oe}),te=Be},de=M.colorModeForRenderPass(),pe=new n.af(W.LEQUAL,n.af.ReadWrite,M.depthRangeFor3D);nh.update(B);let Me=M.transform,Te=sh(Me.zoom,C.exaggeration(),C.sourceCache._source.tileSize),Se=[0,0,0];if(ne){let Be=M.style.directionalLight,Oe=M.style.ambientLight;Be&&Oe&&(Se=Pm(M.style,Be,Oe))}{te=-1;let Be=W.TRIANGLES,[Oe,Le]=[C.gridIndexBuffer,C.gridSegments];for(let Ge of z){let We=R.getTile(Ge),at=n.ah.disabled,Ye=C.prevTerrainTileForTile[Ge.key],Ne=C.terrainTileForTile[Ge.key];Rm(Ye,Ne)&&nh.newMorphing(Ge.key,Ye,Ne,B,250),G.activeTexture.set(W.TEXTURE0),We.texture&&We.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let gt=nh.getMorphValuesForProxy(Ge.key),ft=gt?1:0,tt;gt&&(tt={morphing:{srcDemTile:gt.from,dstDemTile:gt.to,phase:n.bb(gt.phase)}});let Bt=fE(Ge.projMatrix,Lm(Ge.canonical,Me.renderWorldCopies)?Te/10:Te,Se);if(ue(ft),!Z)continue;C.setupElevationDraw(We,Z,tt);let Pt=Ge.toUnwrapped();ne&&ne.setupShadows(Pt,Z),M.uploadCommonUniforms(G,Z,Pt,null,ce),Z.draw(M,Be,pe,at,de,n.ag.backCCW,Bt,"terrain_raster",C.gridBuffer,Oe,Le)}}}}(g,this,this.proxySourceCache,h,this._updateTimestamp),this.renderingToTexture=!0,g.gpuTimingDeferredRenderEnd(),h.splice(0,h.length))}renderBatch(h){if(this._drapedRenderBatches.length===0)return h+1;this.renderingToTexture=!0;let g=this.painter,b=this.painter.context,M=this.proxySourceCache,C=this.proxiedCoords[M.id],R=this._drapedRenderBatches.shift(),z=g.style.order,B=[],G=0;for(let W of C){let Z=M.getTileByID(W.proxyTileKey),te=M.proxyCachedFBO[W.key]?M.proxyCachedFBO[W.key][h]:void 0,ne=te!==void 0?M.renderCache[te]:this.pool[G++],ce=te!==void 0;if(Z.texture=ne.tex,ce&&!ne.dirty){B.push(Z.tileID);continue}let ue;b.bindFramebuffer.set(ne.fb.framebuffer),this.renderedToTile=!1,ne.dirty&&(b.clear({color:n.C.transparent,stencil:0}),ne.dirty=!1);for(let de=R.start;de<=R.end;++de){let pe=g.style._mergedLayers[z[de]];if(pe.isHidden(g.transform.zoom))continue;let Me=g.style.getLayerSourceCache(pe),Te=Me?this.proxyToSource[W.key][Me.id]:[W];if(!Te)continue;let Se=Te;b.viewport.set([0,0,ne.fb.width,ne.fb.height]),ue!==(Me?Me.id:null)&&(this._setupStencil(ne,Te,pe,Me),ue=Me?Me.id:null),g.renderLayer(g,Me,pe,Se)}if(this._drapedRenderBatches.length===0)for(let de of this._pendingGroundEffectLayers){let pe=g.style._mergedLayers[z[de]];if(pe.isHidden(g.transform.zoom))continue;let Me=g.style.getLayerSourceCache(pe),Te=Me?this.proxyToSource[W.key][Me.id]:[W];if(!Te)continue;let Se=Te;b.viewport.set([0,0,ne.fb.width,ne.fb.height]),ue!==(Me?Me.id:null)&&(this._setupStencil(ne,Te,pe,Me),ue=Me?Me.id:null),g.renderLayer(g,Me,pe,Se)}this.renderedToTile?(ne.dirty=!0,B.push(Z.tileID)):ce||--G,G===5&&(G=0,this.renderToBackBuffer(B))}return this.renderToBackBuffer(B),this.renderingToTexture=!1,b.bindFramebuffer.set(null),b.viewport.set([0,0,g.width,g.height]),R.end+1}postRender(){}isLayerOrderingCorrect(h){let g=h.order.length,b=-1,M=g;for(let C=0;C<g;++C)this._style.isLayerDraped(h._mergedLayers[h.order[C]])?b=Math.max(b,C):M=Math.min(M,C);return M>b}getMinElevationBelowMSL(){let h=0;return this._visibleDemTiles.filter(g=>g.dem).forEach(g=>{h=Math.min(h,g.dem.tree.minimums[0])}),h===0?h:(h-30)*this._exaggeration}raycast(h,g,b){if(!this._visibleDemTiles)return null;let M=this._visibleDemTiles.filter(C=>C.dem).map(C=>{let R=C.tileID,z=1<<R.overscaledZ,{x:B,y:G}=R.canonical,W=B/z,Z=(B+1)/z,te=G/z,ne=(G+1)/z;return{minx:W,miny:te,maxx:Z,maxy:ne,t:C.dem.tree.raycastRoot(W,te,Z,ne,h,g,b),tile:C}});M.sort((C,R)=>(C.t!==null?C.t:Number.MAX_VALUE)-(R.t!==null?R.t:Number.MAX_VALUE));for(let C of M){if(C.t==null)return null;let R=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,h,g,b);if(R!=null)return R}return null}_createFBO(){let h=this.painter.context,g=h.gl,b=this.drapeBufferSize;h.activeTexture.set(g.TEXTURE0);let M=new n.T(h,{width:b[0],height:b[1],data:null},g.RGBA);M.bind(g.LINEAR,g.CLAMP_TO_EDGE);let C=h.createFramebuffer(b[0],b[1],!0,null);return C.colorAttachment.set(M.texture),C.depthAttachment=new pi(h,C.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=h.createRenderbuffer(h.gl.DEPTH_STENCIL,b[0],b[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),h.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),h.extTextureFilterAnisotropic&&g.texParameterf(g.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax),{fb:C,tex:M,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let h in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[h].hasTransition())return!0;return this._style.order.some(h=>{let g=this._style._mergedLayers[h],b=g.isHidden(this.painter.transform.zoom);return g.type==="custom"?!b&&g.shouldRedrape():!b&&g.hasTransition()})}_clearLineLayersFromRenderCache(){let h=!1;for(let b of this._style.getSources())if(b instanceof pE){h=!0;break}if(!h)return;let g={};for(let b=0;b<this._style.order.length;++b){let M=this._style._mergedLayers[this._style.order[b]],C=this._style.getLayerSourceCache(M);if(C&&!g[C.id]&&!M.isHidden(this.painter.transform.zoom)&&M.type==="line"&&M.widthExpression()instanceof n.Z){g[C.id]=!0;for(let R of this.proxyCoords){let z=this.proxyToSource[R.key][C.id];if(z)for(let B of z)this._clearRenderCacheForTile(C.id,B)}}}}_clearRasterLayersFromRenderCache(){let h=!1;for(let b in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[b]._source instanceof Za){h=!0;break}if(!h)return;let g={};for(let b=0;b<this._style.order.length;++b){let M=this._style._mergedLayers[this._style.order[b]],C=this._style.getLayerSourceCache(M);if(!C||g[C.id]||M.isHidden(this.painter.transform.zoom)||M.type!=="raster")continue;let R=M.paint.get("raster-fade-duration");for(let z of this.proxyCoords){let B=this.proxyToSource[z.key][C.id];if(B)for(let G of B){let W=av(C.getTile(G),C.findLoadedParent(G,0),C,this.painter.transform,R);(W.opacity!==1||W.mix!==0)&&this._clearRenderCacheForTile(C.id,G)}}}}_setupDrapedRenderBatches(){let h=this._style.order,g=h.length;if(g===0)return;let b=[];this._pendingGroundEffectLayers=[];let M,C=0,R=this._style._mergedLayers[h[C]];for(;!this._style.isLayerDraped(R)&&R.isHidden(this.painter.transform.zoom)&&++C<g;)R=this._style._mergedLayers[h[C]];for(;C<g;++C){let z=this._style._mergedLayers[h[C]];z.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(z)?M===void 0&&(M=C):(z.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(C),M!==void 0&&(b.push({start:M,end:C-1}),M=void 0)))}if(M!==void 0&&b.push({start:M,end:C-1}),b.length!==0){let z=b[b.length-1];this._pendingGroundEffectLayers.every(B=>B>z.end)||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=b}_setupRenderCache(h){let g=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,g.renderCache.length>g.renderCachePool.length){let R=Object.values(g.proxyCachedFBO);g.proxyCachedFBO={};for(let z=0;z<R.length;++z){let B=Object.values(R[z]);g.renderCachePool.push(...B)}}return}this._clearRasterLayersFromRenderCache();let b=this.proxyCoords,M=this._tilesDirty;for(let R=b.length-1;R>=0;R--){let z=b[R];if(g.getTileByID(z.key),g.proxyCachedFBO[z.key]!==void 0){let B=h[z.key],G=this.proxyToSource[z.key],W=0;for(let Z in G){let te=G[Z],ne=B[Z];if(!ne||ne.length!==te.length||te.some((ce,ue)=>ce!==ne[ue]||M[Z]&&M[Z].hasOwnProperty(ce.key))){W=-1;break}++W}for(let Z in g.proxyCachedFBO[z.key])g.renderCache[g.proxyCachedFBO[z.key][Z]].dirty=W<0||W!==Object.values(B).length}}let C=[...this._drapedRenderBatches];C.sort((R,z)=>z.end-z.start-(R.end-R.start));for(let R of C)for(let z of b){if(g.proxyCachedFBO[z.key])continue;let B=g.renderCachePool.pop();B===void 0&&g.renderCache.length<50&&(B=g.renderCache.length,g.renderCache.push(this._createFBO())),B!==void 0&&(g.proxyCachedFBO[z.key]={},g.proxyCachedFBO[z.key][R.start]=B,g.renderCache[B].dirty=!0)}this._tilesDirty={}}_setupStencil(h,g,b,M){if(!M||!this._sourceTilesOverlap[M.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let C=this.painter.context,R=C.gl;if(g.length<=1)return void(this._overlapStencilType=!1);let z;if(b.isTileClipped())z=g.length,this._overlapStencilMode.test={func:R.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(g[0].overscaledZ>g[g.length-1].overscaledZ))return void(this._overlapStencilType=!1);z=1,this._overlapStencilMode.test={func:R.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+z>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=z,this._overlapStencilMode.ref=this._stencilRef,b.isTileClipped()&&this._renderTileClippingMasks(g,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(h){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[h.key]),this._overlapStencilMode):n.ah.disabled}_renderTileClippingMasks(h,g){let b=this.painter,M=this.painter.context,C=M.gl;b._tileClippingMaskIDs={},M.setColorMode(n.a.disabled),M.setDepthMode(n.af.disabled);let R=b.getOrCreateProgram("clippingMask");for(let z of h){let B=b._tileClippingMaskIDs[z.key]=--g;R.draw(b,C.TRIANGLES,n.af.disabled,new n.ah({func:C.ALWAYS,mask:0},B,255,C.KEEP,C.KEEP,C.REPLACE),n.a.disabled,n.ag.disabled,zm(z.projMatrix),"$clipping",b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}}pointCoordinate(h){let g=this.painter.transform;if(h.x<0||h.x>g.width||h.y<0||h.y>g.height)return null;let b=[h.x,h.y,1,1];n.aB.transformMat4(b,b,g.pixelMatrixInverse),n.aB.scale(b,b,1/b[3]),b[0]/=g.worldSize,b[1]/=g.worldSize;let M=g._camera.position,C=n.ay(1,g.center.lat),R=[M[0],M[1],M[2]/C,0],z=n.$.subtract([],b.slice(0,3),R);n.$.normalize(z,z);let B=this.raycast(R,z,this._exaggeration);return B!==null&&B?(n.$.scaleAndAdd(R,R,z,B),R[3]=R[2],R[2]*=C,R):null}_setupProxiedCoordsForOrtho(h,g,b){if(h.getSource()instanceof n.bo)return this._setupProxiedCoordsForImageSource(h,g,b);this._findCoveringTileCache[h.id]=this._findCoveringTileCache[h.id]||{};let M=this.proxiedCoords[h.id]=[],C=this.proxyCoords;for(let B=0;B<C.length;B++){let G=C[B],W=this._findTileCoveringTileID(G,h);if(W){let Z=this._createProxiedId(G,W,b[G.key]&&b[G.key][h.id]);M.push(Z),this.proxyToSource[G.key][h.id]=[Z]}}let R=!1,z=new Set;for(let B=0;B<g.length;B++){let G=h.getTile(g[B]);if(!G||!G.hasData())continue;let W=this._findTileCoveringTileID(G.tileID,this.proxySourceCache);if(W&&W.tileID.canonical.z!==G.tileID.canonical.z){let Z=this.proxyToSource[W.tileID.key][h.id],te=this._createProxiedId(W.tileID,G,b[W.tileID.key]&&b[W.tileID.key][h.id]);Z?Z.splice(Z.length-1,0,te):this.proxyToSource[W.tileID.key][h.id]=[te];let ne=this.proxyToSource[W.tileID.key][h.id];z.has(ne)||z.add(ne),M.push(te),R=!0}}if(this._sourceTilesOverlap[h.id]=R,R&&this._debugParams.sortTilesHiZFirst)for(let B of z)B.sort((G,W)=>W.overscaledZ-G.overscaledZ)}_setupProxiedCoordsForImageSource(h,g,b){if(!h.getSource().loaded())return;let M=this.proxiedCoords[h.id]=[],C=this.proxyCoords,R=h.getSource(),z=R.tileID;if(!z)return;let B=new n.P(z.x,z.y)._div(1<<z.z),G=R.coordinates.map(n._.fromLngLat).reduce((Z,te)=>(Z.min.x=Math.min(Z.min.x,te.x-B.x),Z.min.y=Math.min(Z.min.y,te.y-B.y),Z.max.x=Math.max(Z.max.x,te.x-B.x),Z.max.y=Math.max(Z.max.y,te.y-B.y),Z),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),W=(Z,te)=>{let ne=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),ce=Z.canonical.y/(1<<Z.canonical.z),ue=n.a4/(1<<Z.canonical.z),de=te.wrap+te.canonical.x/(1<<te.canonical.z),pe=te.canonical.y/(1<<te.canonical.z);return ne+ue<de+G.min.x||ne>de+G.max.x||ce+ue<pe+G.min.y||ce>pe+G.max.y};for(let Z=0;Z<C.length;Z++){let te=C[Z];for(let ne=0;ne<g.length;ne++){let ce=h.getTile(g[ne]);if(!ce||!ce.hasData()||W(te,ce.tileID))continue;let ue=this._createProxiedId(te,ce,b[te.key]&&b[te.key][h.id]),de=this.proxyToSource[te.key][h.id];de?de.push(ue):this.proxyToSource[te.key][h.id]=[ue],M.push(ue)}}}_createProxiedId(h,g,b){let M=this.orthoMatrix;if(b){let C=b.find(R=>R.key===g.tileID.key);if(C)return C}if(g.tileID.key!==h.key){let C=h.canonical.z-g.tileID.canonical.z,R,z,B;M=n.ae.create();let G=g.tileID.wrap-h.wrap<<h.overscaledZ;C>0?(R=n.a4>>C,z=R*((g.tileID.canonical.x<<C)-h.canonical.x+G),B=R*((g.tileID.canonical.y<<C)-h.canonical.y)):(R=n.a4<<-C,z=n.a4*(g.tileID.canonical.x-(h.canonical.x+G<<-C)),B=n.a4*(g.tileID.canonical.y-(h.canonical.y<<-C))),n.ae.ortho(M,0,R,0,R,0,1),n.ae.translate(M,M,[z,B,0])}return new Xx(g.tileID,h.key,M)}_findTileCoveringTileID(h,g){let b=g.getTile(h);if(b&&b.hasData())return b;let M=this._findCoveringTileCache[g.id],C=M[h.key];if(b=C?g.getTileByID(C):null,b&&b.hasData()||C===null)return b;let R=b?b.tileID:h,z=R.overscaledZ,B=g.getSource().minzoom,G=[];if(!C){let Z=g.getSource().maxzoom;if(h.canonical.z>=Z){let te=h.canonical.z-Z;g.getSource().reparseOverscaled?(z=Math.max(h.canonical.z+2,g.transform.tileZoom),R=new n.aQ(z,h.wrap,Z,h.canonical.x>>te,h.canonical.y>>te)):te!==0&&(z=Z,R=new n.aQ(z,h.wrap,Z,h.canonical.x>>te,h.canonical.y>>te))}R.key!==h.key&&(G.push(R.key),b=g.getTile(R))}let W=Z=>{G.forEach(te=>{M[te]=Z}),G.length=0};for(z-=1;z>=B&&(!b||!b.hasData());z--){b&&W(b.tileID.key);let Z=R.calculateScaledKey(z);if(b=g.getTileByID(Z),b&&b.hasData())break;let te=M[Z];if(te===null)break;te===void 0?G.push(Z):b=g.getTileByID(te)}return W(b?b.tileID.key:null),b&&b.hasData()?b:null}findDEMTileFor(h){return this.enabled?this._findTileCoveringTileID(h,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(h,g){let b=this._tilesDirty[h];b||(b=this._tilesDirty[h]={}),b[g.key]=!0}}function _E(_,h,g){let b=function(z,B,G){let W=n.$.dot(B,z),Z=n.$.dot(G,[.2126,.7152,.0722]),te=(ce,ue,de)=>(1-de)*ce+de*ue,ne=te(1-.3*Math.min(Z,1),1,Math.min(W+1,1));return te(.92,1,Math.asin(n.au(B[2],-1,1))/Math.PI+.5)*ne}(_,[0,0,1],h),M=[0,0,0];n.$.scale(M,g.slice(0,3),b);let C=[0,0,0];n.$.scale(C,h.slice(0,3),_[2]);let R=[0,0,0];return n.$.add(R,M,C),n.ba(R)}let $x=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],xE=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Zx{static cacheKey(h,g,b,M){let C=`${g}${M?M.cacheKey:""}`;for(let R of b)h.usedDefines.includes(R)&&(C+=`/${R}`);return C}constructor(h,g,b,M,C,R){let z=h.gl;this.program=z.createProgram(),this.configuration=M,this.name=g,this.fixedDefines=[...R];let B=M?M.getBinderAttributes():[],G=(b.staticAttributes||[]).concat(B),W=M?M.defines():[];W=W.concat(R.map(de=>`#define ${de}`));let Z=`#version 300 es
`,te=Z+W.concat("precision mediump float;",uE,iv.fragmentSource).join(`
`);for(let de of b.fragmentIncludes)te+=`
${bc[de]}`;te+=`
${b.fragmentSource}`;let ne=Z+W.concat("precision highp float;",uE,iv.vertexSource).join(`
`);for(let de of b.vertexIncludes)ne+=`
${bc[de]}`;ne+=`
${b.vertexSource}`;let ce=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);z.shaderSource(ce,te),z.compileShader(ce),z.attachShader(this.program,ce);let ue=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())this.failedToCreate=!0;else{z.shaderSource(ue,ne),z.compileShader(ue),z.attachShader(this.program,ue),this.attributes={},this.numAttributes=G.length;for(let de=0;de<this.numAttributes;de++)if(G[de]){let pe=G[de].startsWith("a_")?G[de]:`a_${G[de]}`;z.bindAttribLocation(this.program,de,pe),this.attributes[pe]=de}z.linkProgram(this.program),z.deleteShader(ue),z.deleteShader(ce),this.fixedUniforms=C(h),this.binderUniforms=M?M.getUniforms(h):[],(R.includes("TERRAIN")||g.indexOf("symbol")!==-1||g.indexOf("circle")!==-1)&&(this.terrainUniforms=(de=>({u_dem:new n.a8(de),u_dem_prev:new n.a8(de),u_dem_tl:new n.a9(de),u_dem_scale:new n.ab(de),u_dem_tl_prev:new n.a9(de),u_dem_scale_prev:new n.ab(de),u_dem_size:new n.ab(de),u_dem_lerp:new n.ab(de),u_exaggeration:new n.ab(de),u_depth:new n.a8(de),u_depth_size_inv:new n.a9(de),u_depth_range_unpack:new n.a9(de),u_occluder_half_size:new n.ab(de),u_occlusion_depth_offset:new n.ab(de),u_meter_to_dem:new n.ab(de),u_label_plane_matrix_inv:new n.a7(de)}))(h)),R.includes("GLOBE")&&(this.globeUniforms=(de=>({u_tile_tl_up:new n.ar(de),u_tile_tr_up:new n.ar(de),u_tile_br_up:new n.ar(de),u_tile_bl_up:new n.ar(de),u_tile_up_scale:new n.ab(de)}))(h)),R.includes("FOG")&&(this.fogUniforms=(de=>({u_fog_matrix:new n.a7(de),u_fog_range:new n.a9(de),u_fog_color:new n.at(de),u_fog_horizon_blend:new n.ab(de),u_fog_vertical_limit:new n.a9(de),u_fog_temporal_offset:new n.ab(de),u_frustum_tl:new n.ar(de),u_frustum_tr:new n.ar(de),u_frustum_br:new n.ar(de),u_frustum_bl:new n.ar(de),u_globe_pos:new n.ar(de),u_globe_radius:new n.ab(de),u_globe_transition:new n.ab(de),u_is_globe:new n.a8(de),u_viewport:new n.a9(de)}))(h)),R.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(de=>({u_cutoff_params:new n.at(de)}))(h)),R.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(de=>({u_lighting_ambient_color:new n.ar(de),u_lighting_directional_dir:new n.ar(de),u_lighting_directional_color:new n.ar(de),u_ground_radiance:new n.ar(de)}))(h)),R.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(de=>({u_light_matrix_0:new n.a7(de),u_light_matrix_1:new n.a7(de),u_fade_range:new n.a9(de),u_shadow_normal_offset:new n.ar(de),u_shadow_intensity:new n.ab(de),u_shadow_texel_size:new n.ab(de),u_shadow_map_resolution:new n.ab(de),u_shadow_direction:new n.ar(de),u_shadow_bias:new n.ar(de),u_shadowmap_0:new n.a8(de),u_shadowmap_1:new n.a8(de)}))(h))}}setTerrainUniformValues(h,g){if(!this.terrainUniforms)return;let b=this.terrainUniforms;if(!this.failedToCreate){h.program.set(this.program);for(let M in g)b[M]&&b[M].set(this.program,M,g[M])}}setGlobeUniformValues(h,g){if(!this.globeUniforms)return;let b=this.globeUniforms;if(!this.failedToCreate){h.program.set(this.program);for(let M in g)b[M]&&b[M].set(this.program,M,g[M])}}setFogUniformValues(h,g){if(!this.fogUniforms)return;let b=this.fogUniforms;if(!this.failedToCreate){h.program.set(this.program);for(let M in g)b[M].set(this.program,M,g[M])}}setCutoffUniformValues(h,g){if(!this.cutoffUniforms)return;let b=this.cutoffUniforms;if(!this.failedToCreate){h.program.set(this.program);for(let M in g)b[M].set(this.program,M,g[M])}}setLightsUniformValues(h,g){if(!this.lightsUniforms)return;let b=this.lightsUniforms;if(!this.failedToCreate){h.program.set(this.program);for(let M in g)b[M].set(this.program,M,g[M])}}setShadowUniformValues(h,g){if(this.failedToCreate||!this.shadowUniforms)return;let b=this.shadowUniforms;h.program.set(this.program);for(let M in g)b[M].set(this.program,M,g[M])}_drawDebugWireframe(h,g,b,M,C,R,z,B,G,W){let Z=h.options.wireframe;if(Z.terrain===!1&&Z.layers2D===!1&&Z.layers3D===!1)return;let te=h.context;if(!(!(!Z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Z.layers2D||h._terrain&&h._terrain.renderingToTexture||!$x.includes(this.name))||!(!Z.layers3D||!xE.includes(this.name))))return;let ne=te.gl,ce=h.wireframeDebugCache.getLinesFromTrianglesBuffer(h.frameCounter,C,te);if(!ce)return;let ue=[...this.fixedDefines];ue.push("DEBUG_WIREFRAME");let de=h.getOrCreateProgram(this.name,{config:this.configuration,defines:ue});te.program.set(de.program);let pe=(Se,Be,Oe)=>{if(Be[Se]&&Oe[Se])for(let Le in Be[Se])Oe[Se][Le]&&Oe[Se][Le].set(Oe.program,Le,Be[Se][Le].current)};G&&G.setUniforms(de.program,te,de.binderUniforms,z,{zoom:B}),pe("fixedUniforms",this,de),pe("terrainUniforms",this,de),pe("globeUniforms",this,de),pe("fogUniforms",this,de),pe("lightsUniforms",this,de),pe("shadowUniforms",this,de),ce.bind(),te.setColorMode(new n.a([ne.ONE,ne.ONE_MINUS_SRC_ALPHA,ne.ZERO,ne.ONE],n.C.transparent,[!0,!0,!0,!1])),te.setDepthMode(new n.af(g.func===ne.LESS?ne.LEQUAL:g.func,n.af.ReadOnly,g.range)),te.setStencilMode(n.ah.disabled);let Me=3*R.primitiveLength*2,Te=3*R.primitiveOffset*2*2;W&&W>1?ne.drawElementsInstanced(ne.LINES,Me,ne.UNSIGNED_SHORT,Te,W):ne.drawElements(ne.LINES,Me,ne.UNSIGNED_SHORT,Te),C.bind(),te.program.set(this.program),te.setDepthMode(g),te.setStencilMode(b),te.setColorMode(M)}draw(h,g,b,M,C,R,z,B,G,W,Z,te,ne,ce,ue,de){let pe=h.context,Me=pe.gl;if(this.failedToCreate)return;pe.program.set(this.program),pe.setDepthMode(b),pe.setStencilMode(M),pe.setColorMode(C),pe.setCullFace(R);for(let Be of Object.keys(this.fixedUniforms))this.fixedUniforms[Be].set(this.program,Be,z[Be]);ce&&ce.setUniforms(this.program,pe,this.binderUniforms,te,{zoom:ne});let Te={[Me.POINTS]:1,[Me.LINES]:2,[Me.TRIANGLES]:3,[Me.LINE_STRIP]:1}[g],Se=de&&de>0?1:void 0;for(let Be of Z.get()){let Oe=Be.vaos||(Be.vaos={});(Oe[B]||(Oe[B]=new cP)).bind(pe,this,G,ce?ce.getPaintVertexBuffers():[],W,Be.vertexOffset,ue||[],Se),de&&de>1?Me.drawElementsInstanced(g,Be.primitiveLength*Te,Me.UNSIGNED_SHORT,Be.primitiveOffset*Te*2,de):W?Me.drawElements(g,Be.primitiveLength*Te,Me.UNSIGNED_SHORT,Be.primitiveOffset*Te*2):Me.drawArrays(g,Be.vertexOffset,Be.vertexLength),g===Me.TRIANGLES&&W&&this._drawDebugWireframe(h,b,M,C,W,Be,te,ne,ce,de)}}}function Qx(_,h){let g=Math.pow(2,h.tileID.overscaledZ),b=h.tileSize*Math.pow(2,_.transform.tileZoom)/g,M=b*(h.tileID.canonical.x+h.tileID.wrap*g),C=b*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture?h.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.bD(h,1,_.transform.tileZoom),u_pixel_coord_upper:[M>>16,C>>16],u_pixel_coord_lower:[65535&M,65535&C]}}let bE=n.ae.create(),wc=(_,h,g,b,M,C,R,z,B,G,W,Z,te,ne,ce,ue,de,pe)=>{let Me=h.style.light,Te=Me.properties.get("position"),Se=[Te.x,Te.y,Te.z],Be=n.bE.create();Me.properties.get("anchor")==="viewport"&&(n.bE.fromRotation(Be,-h.transform.angle),n.$.transformMat3(Se,Se,Be));let Oe=Me.properties.get("color"),Le=h.transform,Ge={u_matrix:_,u_lightpos:Se,u_lightintensity:Me.properties.get("intensity"),u_lightcolor:[Oe.r,Oe.g,Oe.b],u_vertical_gradient:+g,u_opacity:b,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:bE,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:M,u_edge_radius:C,u_alignment:R,u_width_scale:z,u_flood_light_color:ne,u_vertical_scale:ce,u_flood_light_intensity:ue,u_ground_shadow_factor:de,u_emissive_strength:pe};return Le.projection.name==="globe"&&(Ge.u_tile_id=[B.canonical.x,B.canonical.y,1<<B.canonical.z],Ge.u_zoom_transition=W,Ge.u_inv_rot_matrix=te,Ge.u_merc_center=Z,Ge.u_up_dir=Le.projection.upVector(new n.aO(0,0,0),Z[0]*n.a4,Z[1]*n.a4),Ge.u_height_lift=G),Ge},uv=(_,h,g,b,M)=>({u_matrix:_,u_edge_radius:h,u_alignment:g,u_width_scale:b,u_vertical_scale:M}),wE=(_,h,g,b,M,C,R,z,B,G,W,Z,te,ne,ce,ue)=>{let de=wc(_,h,g,b,M,C,R,z,B,W,Z,te,ne,ce,ue,1,[0,0,0],0),pe={u_height_factor:-Math.pow(2,B.overscaledZ)/G.tileSize/8};return n.Q(de,Qx(h,G),pe)},Fm=(_,h)=>({u_matrix:_,u_emissive_strength:h}),hv=(_,h,g,b)=>n.Q(Fm(_,h),Qx(g,b)),dv=(_,h,g)=>({u_matrix:_,u_world:g,u_emissive_strength:h}),km=(_,h,g,b,M)=>n.Q(hv(_,h,g,b),{u_world:M}),Up=(_,h,g,b)=>{let M=n.a4/g.tileSize;return{u_matrix:_,u_camera_to_center_distance:h.getCameraToCenterDistance(b),u_extrude_scale:[h.pixelsToGLUnits[0]/M,h.pixelsToGLUnits[1]/M]}},pv=(_,h,g=1)=>({u_matrix:_,u_color:h.toRenderColor(null),u_overlay:0,u_overlay_scale:g}),SE=n.ae.create(),EE=(_,h,g,b,M,C,R)=>{let z=_.transform,B=z.projection.name==="globe",G=B?n.bF(z.zoom,h.canonical)*z._pixelsPerMercatorPixel:n.bD(g,1,C),W={u_matrix:h.projMatrix,u_extrude_scale:G,u_intensity:R,u_inv_rot_matrix:SE,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(B){W.u_inv_rot_matrix=b,W.u_merc_center=M,W.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],W.u_zoom_transition=n.a2(z.zoom);let Z=M[0]*n.a4,te=M[1]*n.a4;W.u_up_dir=z.projection.upVector(new n.aO(0,0,0),Z,te)}return W};function Kx(_,[h,g,b,M],[C,R]){if(C===R)return[0,0,0,0];let z=255*(_-1)/(_*(R-C));return[h*z,g*z,b*z,M*z]}function Nm(_,h,[g,b]){return g===b?0:.5/_+(h-g)*(_-1)/(_*(b-g))}let fv=(_,h,g,b,M,C,R,z,B,G,W,Z,te,ne,ce,ue,de,pe,Me,Te,Se)=>({u_matrix:_,u_normalize_matrix:h,u_globe_matrix:g,u_merc_matrix:b,u_grid_matrix:M,u_tl_parent:C,u_scale_parent:G,u_fade_t:W.mix,u_opacity:W.opacity*Z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Z.paint.get("raster-brightness-min"),u_brightness_high:Z.paint.get("raster-brightness-max"),u_saturation_factor:n.bG(Z.paint.get("raster-saturation")),u_contrast_factor:n.bH(Z.paint.get("raster-contrast")),u_spin_weights:Jx(Z.paint.get("raster-hue-rotate")),u_perspective_transform:te,u_raster_elevation:ne,u_zoom_transition:R,u_merc_center:z,u_cutoff_params:B,u_colorization_mix:Kx(n.bI,ue,pe),u_colorization_offset:Nm(n.bI,de,pe),u_color_ramp:ce,u_texture_offset:[Te/(Me+2*Te),Me/(Me+2*Te)],u_texture_res:[Me+2*Te,Me+2*Te],u_emissive_strength:Se});function Jx(_){_*=Math.PI/180;let h=Math.sin(_),g=Math.cos(_);return[(2*g+1)/3,(-Math.sqrt(3)*h-g+1)/3,(Math.sqrt(3)*h-g+1)/3]}let Sc=.05,pd=(_,h,g,b,M,C,R,z,B,G,W,Z)=>({u_matrix:_,u_normalize_matrix:h,u_globe_matrix:g,u_merc_matrix:b,u_grid_matrix:M,u_tl_parent:C,u_scale_parent:G,u_fade_t:W.mix,u_opacity:W.opacity,u_image0:0,u_image1:1,u_raster_elevation:Z,u_zoom_transition:R,u_merc_center:z,u_cutoff_params:B}),fP=(_,h,g,b,M,C,R,z,B,G)=>({u_particle_texture:_,u_particle_texture_side_len:h,u_tile_offset:g,u_velocity:b,u_color_ramp:C,u_velocity_res:M,u_max_speed:R,u_uv_offset:z,u_data_scale:[255*B[0],255*B[1]],u_data_offset:G,u_particle_pos_scale:1.1,u_particle_pos_offset:[Sc,Sc]}),ME=(_,h,g,b,M,C,R,z,B,G)=>({u_particle_texture:_,u_particle_texture_side_len:h,u_velocity:g,u_velocity_res:b,u_max_speed:M,u_speed_factor:C,u_reset_rate:R,u_rand_seed:Math.random(),u_uv_offset:z,u_data_scale:[255*B[0],255*B[1]],u_data_offset:G,u_particle_pos_scale:1.1,u_particle_pos_offset:[Sc,Sc]}),Bm=n.ae.create(),jp=(_,h,g,b,M,C,R,z,B,G,W,Z,te,ne,ce,ue,de,pe)=>{let Me=M.transform,Te={u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:Me.getCameraToCenterDistance(ue),u_rotate_symbol:+g,u_aspect_ratio:Me.width/Me.height,u_fade_change:M.options.fadeDuration?M.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:R,u_coord_matrix:z,u_is_text:+B,u_pitch_with_map:+b,u_texsize:G,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Bm,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Bm,u_up_vector:[0,-1,0],u_color_adj_mat:de,u_icon_transition:pe||0};return ue.name==="globe"&&(Te.u_tile_id=[W.canonical.x,W.canonical.y,1<<W.canonical.z],Te.u_zoom_transition=Z,Te.u_inv_rot_matrix=ne,Te.u_merc_center=te,Te.u_camera_forward=Me._camera.forward(),Te.u_ecef_origin=n.bJ(Me.globeMatrix,W.toUnwrapped()),Te.u_tile_matrix=Float32Array.from(Me.globeMatrix),Te.u_up_vector=ce),Te},Um=(_,h,g,b,M,C,R,z,B,G,W,Z,te,ne,ce,ue,de)=>n.Q(jp(_,h,g,b,M,C,R,z,B,G,Z,te,ne,ce,ue,de),{u_gamma_scale:b?M.transform.getCameraToCenterDistance(de)*Math.cos(M.terrain?0:M.transform._pitch):1,u_device_pixel_ratio:n.e.devicePixelRatio,u_is_halo:+W,undefined:void 0}),e1=(_,h,g,b,M,C,R,z,B,G,W,Z,te,ne,ce,ue)=>n.Q(Um(_,h,g,b,M,C,R,z,!0,B,!0,W,Z,te,ne,ce,ue),{u_texsize_icon:G,u_texture_icon:1}),t1=(_,h,g,b)=>({u_matrix:_,u_emissive_strength:h,u_opacity:g,u_color:b}),mP=(_,h,g,b,M,C,R,z)=>n.Q(function(B,G,W,Z,te){let{width:ne,height:ce}=Z.imageManager.getPixelSize(G),ue=Math.pow(2,te.tileID.overscaledZ),de=te.tileSize*Math.pow(2,Z.transform.tileZoom)/ue,pe=de*(te.tileID.canonical.x+te.tileID.wrap*ue),Me=de*te.tileID.canonical.y;return{u_image:0,u_pattern_tl:W.tl,u_pattern_br:W.br,u_texsize:[ne,ce],u_pattern_size:W.displaySize,u_tile_units_to_pixels:1/n.bD(te,1,Z.transform.tileZoom),u_pixel_coord_upper:[pe>>16,Me>>16],u_pixel_coord_lower:[65535&pe,65535&Me]}}(0,C,R,b,z),{u_matrix:_,u_emissive_strength:h,u_opacity:g}),El=new Float32Array(n.ae.identity([])),fd=(_,h,g,b,M,C,R,z,B,G,W,Z,te,ne=[0,0,0],ce)=>{let ue=M.style.light,de=ue.properties.get("position"),pe=[-de.x,-de.y,de.z],Me=n.bE.create();ue.properties.get("anchor")==="viewport"&&(n.bE.fromRotation(Me,-M.transform.angle),n.$.transformMat3(pe,pe,Me));let Te=W.alphaMode==="MASK",Se=ue.properties.get("color").toRenderColor(null),Be=te.paint.get("model-ambient-occlusion-intensity"),Oe=te.paint.get("model-color").constantOr(n.C.white).toRenderColor(null),Le=te.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:_,u_lighting_matrix:h,u_normal_matrix:g,u_node_matrix:b||El,u_lightpos:pe,u_lightintensity:ue.properties.get("intensity"),u_lightcolor:[Se.r,Se.g,Se.b],u_camera_pos:ne,u_opacity:C,u_baseTextureIsAlpha:0,u_alphaMask:+Te,u_alphaCutoff:W.alphaCutoff,u_baseColorFactor:[R.r,R.g,R.b,R.a],u_emissiveFactor:[z[0],z[1],z[2],1],u_metallicFactor:B,u_roughnessFactor:G,u_baseColorTexture:Po.BaseColor,u_metallicRoughnessTexture:Po.MetallicRoughness,u_normalTexture:Po.Normal,u_occlusionTexture:Po.Occlusion,u_emissionTexture:Po.Emission,u_lutTexture:Po.LUT,u_color_mix:[Oe.r,Oe.g,Oe.b,Le],u_aoIntensity:Be,u_emissive_strength:Z,u_occlusionTextureTransform:ce||[0,0,0,0]}},i1=(_,h=El,g=El)=>({u_matrix:_,u_instance:h,u_node_matrix:g}),TE={fillExtrusion:_=>({u_matrix:new n.a7(_),u_lightpos:new n.ar(_),u_lightintensity:new n.ab(_),u_lightcolor:new n.ar(_),u_vertical_gradient:new n.ab(_),u_opacity:new n.ab(_),u_edge_radius:new n.ab(_),u_alignment:new n.ab(_),u_width_scale:new n.ab(_),u_ao:new n.a9(_),u_tile_id:new n.ar(_),u_zoom_transition:new n.ab(_),u_inv_rot_matrix:new n.a7(_),u_merc_center:new n.a9(_),u_up_dir:new n.ar(_),u_height_lift:new n.ab(_),u_flood_light_color:new n.ar(_),u_vertical_scale:new n.ab(_),u_flood_light_intensity:new n.ab(_),u_ground_shadow_factor:new n.ar(_),u_emissive_strength:new n.ab(_)}),fillExtrusionDepth:_=>({u_matrix:new n.a7(_),u_edge_radius:new n.ab(_),u_alignment:new n.ab(_),u_width_scale:new n.ab(_),u_vertical_scale:new n.ab(_)}),fillExtrusionPattern:_=>({u_matrix:new n.a7(_),u_lightpos:new n.ar(_),u_lightintensity:new n.ab(_),u_lightcolor:new n.ar(_),u_vertical_gradient:new n.ab(_),u_height_factor:new n.ab(_),u_edge_radius:new n.ab(_),u_alignment:new n.ab(_),u_width_scale:new n.ab(_),u_ao:new n.a9(_),u_tile_id:new n.ar(_),u_zoom_transition:new n.ab(_),u_inv_rot_matrix:new n.a7(_),u_merc_center:new n.a9(_),u_up_dir:new n.ar(_),u_height_lift:new n.ab(_),u_image:new n.a8(_),u_texsize:new n.a9(_),u_pixel_coord_upper:new n.a9(_),u_pixel_coord_lower:new n.a9(_),u_tile_units_to_pixels:new n.ab(_),u_opacity:new n.ab(_)}),fillExtrusionGroundEffect:_=>({u_matrix:new n.a7(_),u_opacity:new n.ab(_),u_ao_pass:new n.ab(_),u_meter_to_tile:new n.ab(_),u_ao:new n.a9(_),u_flood_light_intensity:new n.ab(_),u_flood_light_color:new n.ar(_),u_attenuation:new n.ab(_),u_edge_radius:new n.ab(_),u_fb:new n.a8(_),u_fb_size:new n.ab(_)}),fill:_=>({u_matrix:new n.a7(_),u_emissive_strength:new n.ab(_)}),fillPattern:_=>({u_matrix:new n.a7(_),u_emissive_strength:new n.ab(_),u_image:new n.a8(_),u_texsize:new n.a9(_),u_pixel_coord_upper:new n.a9(_),u_pixel_coord_lower:new n.a9(_),u_tile_units_to_pixels:new n.ab(_)}),fillOutline:_=>({u_matrix:new n.a7(_),u_emissive_strength:new n.ab(_),u_world:new n.a9(_)}),fillOutlinePattern:_=>({u_matrix:new n.a7(_),u_emissive_strength:new n.ab(_),u_world:new n.a9(_),u_image:new n.a8(_),u_texsize:new n.a9(_),u_pixel_coord_upper:new n.a9(_),u_pixel_coord_lower:new n.a9(_),u_tile_units_to_pixels:new n.ab(_)}),circle:n.bK,collisionBox:_=>({u_matrix:new n.a7(_),u_camera_to_center_distance:new n.ab(_),u_extrude_scale:new n.a9(_)}),collisionCircle:_=>({u_matrix:new n.a7(_),u_inv_matrix:new n.a7(_),u_camera_to_center_distance:new n.ab(_),u_viewport_size:new n.a9(_)}),debug:_=>({u_color:new n.aa(_),u_matrix:new n.a7(_),u_overlay:new n.a8(_),u_overlay_scale:new n.ab(_)}),clippingMask:_=>({u_matrix:new n.a7(_)}),heatmap:_=>({u_extrude_scale:new n.ab(_),u_intensity:new n.ab(_),u_matrix:new n.a7(_),u_inv_rot_matrix:new n.a7(_),u_merc_center:new n.a9(_),u_tile_id:new n.ar(_),u_zoom_transition:new n.ab(_),u_up_dir:new n.ar(_)}),heatmapTexture:_=>({u_image:new n.a8(_),u_color_ramp:new n.a8(_),u_opacity:new n.ab(_)}),hillshade:_=>({u_matrix:new n.a7(_),u_image:new n.a8(_),u_latrange:new n.a9(_),u_light:new n.a9(_),u_shadow:new n.aa(_),u_highlight:new n.aa(_),u_emissive_strength:new n.ab(_),u_accent:new n.aa(_)}),hillshadePrepare:_=>({u_matrix:new n.a7(_),u_image:new n.a8(_),u_dimension:new n.a9(_),u_zoom:new n.ab(_)}),line:n.bL,linePattern:n.bM,raster:_=>({u_matrix:new n.a7(_),u_normalize_matrix:new n.a7(_),u_globe_matrix:new n.a7(_),u_merc_matrix:new n.a7(_),u_grid_matrix:new n.as(_),u_tl_parent:new n.a9(_),u_scale_parent:new n.ab(_),u_fade_t:new n.ab(_),u_opacity:new n.ab(_),u_image0:new n.a8(_),u_image1:new n.a8(_),u_brightness_low:new n.ab(_),u_brightness_high:new n.ab(_),u_saturation_factor:new n.ab(_),u_contrast_factor:new n.ab(_),u_spin_weights:new n.ar(_),u_perspective_transform:new n.a9(_),u_raster_elevation:new n.ab(_),u_zoom_transition:new n.ab(_),u_merc_center:new n.a9(_),u_cutoff_params:new n.at(_),u_colorization_mix:new n.at(_),u_colorization_offset:new n.ab(_),u_color_ramp:new n.a8(_),u_texture_offset:new n.a9(_),u_texture_res:new n.a9(_),u_emissive_strength:new n.ab(_)}),rasterParticle:_=>({u_matrix:new n.a7(_),u_normalize_matrix:new n.a7(_),u_globe_matrix:new n.a7(_),u_merc_matrix:new n.a7(_),u_grid_matrix:new n.as(_),u_tl_parent:new n.a9(_),u_scale_parent:new n.ab(_),u_fade_t:new n.ab(_),u_opacity:new n.ab(_),u_image0:new n.a8(_),u_image1:new n.a8(_),u_raster_elevation:new n.ab(_),u_zoom_transition:new n.ab(_),u_merc_center:new n.a9(_),u_cutoff_params:new n.at(_)}),rasterParticleTexture:_=>({u_texture:new n.a8(_),u_opacity:new n.ab(_)}),rasterParticleDraw:_=>({u_particle_texture:new n.a8(_),u_particle_texture_side_len:new n.ab(_),u_tile_offset:new n.a9(_),u_velocity:new n.a8(_),u_color_ramp:new n.a8(_),u_velocity_res:new n.a9(_),u_max_speed:new n.ab(_),u_uv_offset:new n.a9(_),u_data_scale:new n.a9(_),u_data_offset:new n.ab(_),u_particle_pos_scale:new n.ab(_),u_particle_pos_offset:new n.a9(_)}),rasterParticleUpdate:_=>({u_particle_texture:new n.a8(_),u_particle_texture_side_len:new n.ab(_),u_velocity:new n.a8(_),u_velocity_res:new n.a9(_),u_max_speed:new n.ab(_),u_speed_factor:new n.ab(_),u_reset_rate:new n.ab(_),u_rand_seed:new n.ab(_),u_uv_offset:new n.a9(_),u_data_scale:new n.a9(_),u_data_offset:new n.ab(_),u_particle_pos_scale:new n.ab(_),u_particle_pos_offset:new n.a9(_)}),symbolIcon:_=>({u_is_size_zoom_constant:new n.a8(_),u_is_size_feature_constant:new n.a8(_),u_size_t:new n.ab(_),u_size:new n.ab(_),u_camera_to_center_distance:new n.ab(_),u_rotate_symbol:new n.a8(_),u_aspect_ratio:new n.ab(_),u_fade_change:new n.ab(_),u_matrix:new n.a7(_),u_label_plane_matrix:new n.a7(_),u_coord_matrix:new n.a7(_),u_is_text:new n.a8(_),u_pitch_with_map:new n.a8(_),u_texsize:new n.a9(_),u_tile_id:new n.ar(_),u_zoom_transition:new n.ab(_),u_inv_rot_matrix:new n.a7(_),u_merc_center:new n.a9(_),u_camera_forward:new n.ar(_),u_tile_matrix:new n.a7(_),u_up_vector:new n.ar(_),u_ecef_origin:new n.ar(_),u_texture:new n.a8(_),u_icon_transition:new n.ab(_),u_color_adj_mat:new n.a7(_)}),symbolSDF:_=>({u_is_size_zoom_constant:new n.a8(_),u_is_size_feature_constant:new n.a8(_),u_size_t:new n.ab(_),u_size:new n.ab(_),u_camera_to_center_distance:new n.ab(_),u_rotate_symbol:new n.a8(_),u_aspect_ratio:new n.ab(_),u_fade_change:new n.ab(_),u_matrix:new n.a7(_),u_label_plane_matrix:new n.a7(_),u_coord_matrix:new n.a7(_),u_is_text:new n.a8(_),u_pitch_with_map:new n.a8(_),u_texsize:new n.a9(_),u_texture:new n.a8(_),u_gamma_scale:new n.ab(_),u_device_pixel_ratio:new n.ab(_),u_tile_id:new n.ar(_),u_zoom_transition:new n.ab(_),u_inv_rot_matrix:new n.a7(_),u_merc_center:new n.a9(_),u_camera_forward:new n.ar(_),u_tile_matrix:new n.a7(_),u_up_vector:new n.ar(_),u_ecef_origin:new n.ar(_),u_is_halo:new n.a8(_)}),symbolTextAndIcon:_=>({u_is_size_zoom_constant:new n.a8(_),u_is_size_feature_constant:new n.a8(_),u_size_t:new n.ab(_),u_size:new n.ab(_),u_camera_to_center_distance:new n.ab(_),u_rotate_symbol:new n.a8(_),u_aspect_ratio:new n.ab(_),u_fade_change:new n.ab(_),u_matrix:new n.a7(_),u_label_plane_matrix:new n.a7(_),u_coord_matrix:new n.a7(_),u_is_text:new n.a8(_),u_pitch_with_map:new n.a8(_),u_texsize:new n.a9(_),u_texsize_icon:new n.a9(_),u_texture:new n.a8(_),u_texture_icon:new n.a8(_),u_gamma_scale:new n.ab(_),u_device_pixel_ratio:new n.ab(_),u_is_halo:new n.a8(_)}),background:_=>({u_matrix:new n.a7(_),u_emissive_strength:new n.ab(_),u_opacity:new n.ab(_),u_color:new n.aa(_)}),backgroundPattern:_=>({u_matrix:new n.a7(_),u_emissive_strength:new n.ab(_),u_opacity:new n.ab(_),u_image:new n.a8(_),u_pattern_tl:new n.a9(_),u_pattern_br:new n.a9(_),u_texsize:new n.a9(_),u_pattern_size:new n.a9(_),u_pixel_coord_upper:new n.a9(_),u_pixel_coord_lower:new n.a9(_),u_tile_units_to_pixels:new n.ab(_)}),terrainRaster:_=>({u_matrix:new n.a7(_),u_image0:new n.a8(_),u_skirt_height:new n.ab(_),u_ground_shadow_factor:new n.ar(_)}),skybox:_=>({u_matrix:new n.a7(_),u_sun_direction:new n.ar(_),u_cubemap:new n.a8(_),u_opacity:new n.ab(_),u_temporal_offset:new n.ab(_)}),skyboxGradient:_=>({u_matrix:new n.a7(_),u_color_ramp:new n.a8(_),u_center_direction:new n.ar(_),u_radius:new n.ab(_),u_opacity:new n.ab(_),u_temporal_offset:new n.ab(_)}),skyboxCapture:_=>({u_matrix_3f:new n.as(_),u_sun_direction:new n.ar(_),u_sun_intensity:new n.ab(_),u_color_tint_r:new n.at(_),u_color_tint_m:new n.at(_),u_luminance:new n.ab(_)}),globeRaster:_=>({u_proj_matrix:new n.a7(_),u_globe_matrix:new n.a7(_),u_normalize_matrix:new n.a7(_),u_merc_matrix:new n.a7(_),u_zoom_transition:new n.ab(_),u_merc_center:new n.a9(_),u_image0:new n.a8(_),u_grid_matrix:new n.as(_),u_skirt_height:new n.ab(_),u_far_z_cutoff:new n.ab(_),u_frustum_tl:new n.ar(_),u_frustum_tr:new n.ar(_),u_frustum_br:new n.ar(_),u_frustum_bl:new n.ar(_),u_globe_pos:new n.ar(_),u_globe_radius:new n.ab(_),u_viewport:new n.a9(_)}),globeAtmosphere:_=>({u_frustum_tl:new n.ar(_),u_frustum_tr:new n.ar(_),u_frustum_br:new n.ar(_),u_frustum_bl:new n.ar(_),u_horizon:new n.ab(_),u_transition:new n.ab(_),u_fadeout_range:new n.ab(_),u_color:new n.at(_),u_high_color:new n.at(_),u_space_color:new n.at(_),u_temporal_offset:new n.ab(_),u_horizon_angle:new n.ab(_)}),model:_=>({u_matrix:new n.a7(_),u_lighting_matrix:new n.a7(_),u_normal_matrix:new n.a7(_),u_node_matrix:new n.a7(_),u_lightpos:new n.ar(_),u_lightintensity:new n.ab(_),u_lightcolor:new n.ar(_),u_camera_pos:new n.ar(_),u_opacity:new n.ab(_),u_baseColorFactor:new n.at(_),u_emissiveFactor:new n.at(_),u_metallicFactor:new n.ab(_),u_roughnessFactor:new n.ab(_),u_baseTextureIsAlpha:new n.a8(_),u_alphaMask:new n.a8(_),u_alphaCutoff:new n.ab(_),u_baseColorTexture:new n.a8(_),u_metallicRoughnessTexture:new n.a8(_),u_normalTexture:new n.a8(_),u_occlusionTexture:new n.a8(_),u_emissionTexture:new n.a8(_),u_lutTexture:new n.a8(_),u_color_mix:new n.at(_),u_aoIntensity:new n.ab(_),u_emissive_strength:new n.ab(_),u_occlusionTextureTransform:new n.at(_)}),modelDepth:_=>({u_matrix:new n.a7(_),u_instance:new n.a7(_),u_node_matrix:new n.a7(_)}),groundShadow:_=>({u_matrix:new n.a7(_),u_ground_shadow_factor:new n.ar(_)}),stars:_=>({u_matrix:new n.a7(_),u_up:new n.ar(_),u_right:new n.ar(_),u_intensity_multiplier:new n.ab(_)}),occlusion:_=>({u_matrix:new n.a7(_),u_anchorPos:new n.ar(_),u_screenSizePx:new n.a9(_),u_occluderSizePx:new n.a9(_),u_color:new n.at(_)})};function md(_,h,g){let b=h.createTileMatrix(_,_.worldSize,g.toUnwrapped());return n.ae.multiply(new Float32Array(16),_.projMatrix,b)}function AE(_,h,g){if(h.projection.name===g.projection.name)return _.projMatrix;let b=g.clone();return b.setProjection(h.projection),md(b,h.getProjection(),_)}function r1(_,h,g){return h.name===g.projection.name?_.projMatrix:md(g,h,_)}let Vp;function CE(_,h,g,b,M,C,R){let z=_.context,B=z.gl,G=_.transform,W=_.getOrCreateProgram("collisionBox"),Z=[],te=0,ne=0;for(let Se=0;Se<b.length;Se++){let Be=b[Se],Oe=h.getTile(Be),Le=Oe.getBucket(g);if(!Le)continue;let Ge=AE(Be,Le,G),We=Ge;M[0]===0&&M[1]===0||(We=_.translatePosMatrix(Ge,Oe,M,C));let at=R?Le.textCollisionBox:Le.iconCollisionBox,Ye=Le.collisionCircleArray;if(Ye.length>0){let Ne=n.ae.create(),gt=We;n.ae.mul(Ne,Le.placementInvProjMatrix,G.glCoordMatrix),n.ae.mul(Ne,Ne,Le.placementViewportMatrix),Z.push({circleArray:Ye,circleOffset:ne,transform:gt,invTransform:Ne,projection:Le.getProjection()}),te+=Ye.length/4,ne=te}at&&(_.terrain&&_.terrain.setupElevationDraw(Oe,W),W.draw(_,B.LINES,n.af.disabled,n.ah.disabled,_.colorModeForRenderPass(),n.ag.disabled,Up(We,G,Oe,Le.getProjection()),g.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,null,G.zoom,null,[at.collisionVertexBuffer,at.collisionVertexBufferExt]))}if(!R||!Z.length)return;let ce=_.getOrCreateProgram("collisionCircle"),ue=new n.bN;ue.resize(4*te),ue._trim();let de=0;for(let Se of Z)for(let Be=0;Be<Se.circleArray.length/4;Be++){let Oe=4*Be,Le=Se.circleArray[Oe+0],Ge=Se.circleArray[Oe+1],We=Se.circleArray[Oe+2],at=Se.circleArray[Oe+3];ue.emplace(de++,Le,Ge,We,at,0),ue.emplace(de++,Le,Ge,We,at,1),ue.emplace(de++,Le,Ge,We,at,2),ue.emplace(de++,Le,Ge,We,at,3)}(!Vp||Vp.length<2*te)&&(Vp=function(Se){let Be=2*Se,Oe=new n.bw;Oe.resize(Be),Oe._trim();for(let Le=0;Le<Be;Le++){let Ge=6*Le;Oe.uint16[Ge+0]=4*Le+0,Oe.uint16[Ge+1]=4*Le+1,Oe.uint16[Ge+2]=4*Le+2,Oe.uint16[Ge+3]=4*Le+2,Oe.uint16[Ge+4]=4*Le+3,Oe.uint16[Ge+5]=4*Le+0}return Oe}(te));let pe=z.createIndexBuffer(Vp,!0),Me=z.createVertexBuffer(ue,n.bO.members,!0);for(let Se of Z){let Be={u_matrix:Se.transform,u_inv_matrix:Se.invTransform,u_camera_to_center_distance:(Te=G).getCameraToCenterDistance(Se.projection),u_viewport_size:[Te.width,Te.height]};ce.draw(_,B.TRIANGLES,n.af.disabled,n.ah.disabled,_.colorModeForRenderPass(),n.ag.disabled,Be,g.id,Me,pe,n.b.simpleSegment(0,2*Se.circleOffset,Se.circleArray.length,Se.circleArray.length/2),null,G.zoom)}var Te;Me.destroy(),pe.destroy()}let jm=n.ae.create();function DE(_){let h=_._camera.getWorldToCamera(_.worldSize,1),g=n.ae.multiply([],h,_.globeMatrix);n.ae.invert(g,g);let b=[0,0,0],M=[0,1,0,0];return n.aB.transformMat4(M,M,g),b[0]=M[0],b[1]=M[1],b[2]=M[2],n.$.normalize(b,b),b}function IE({width:_,height:h,anchor:g,textOffset:b,textScale:M},C){let{horizontalAlign:R,verticalAlign:z}=n.bS(g),B=-(R-.5)*_,G=-(z-.5)*h,W=n.bR(g,b);return new n.P((B/M+W[0])*C,(G/M+W[1])*C)}function gP(_,h,g,b,M,C,R,z,B,G,W){let Z=_.text.placedSymbolArray,te=_.text.dynamicLayoutVertexArray,ne=_.icon.dynamicLayoutVertexArray,ce={},ue=_.getProjection(),de=r1(z,ue,C),pe=C.elevation,Me=ue.upVectorScale(z.canonical,C.center.lat,C.worldSize).metersToTile;te.clear();for(let Te=0;Te<Z.length;Te++){let Se=Z.get(Te),{tileAnchorX:Be,tileAnchorY:Oe,numGlyphs:Le}=Se,Ge=Se.hidden||!Se.crossTileID||_.allowVerticalPlacement&&!Se.placedOrientation?null:b[Se.crossTileID];if(Ge){let We=0,at=0,Ye=0;if(pe){let Qe=pe?pe.getAtTileOffset(z,Be,Oe):0,[Rt,Ft,oi]=ue.upVector(z.canonical,Be,Oe);We=Qe*Rt*Me,at=Qe*Ft*Me,Ye=Qe*oi*Me}let[Ne,gt,ft,tt]=ql(Se.projectedAnchorX+We,Se.projectedAnchorY+at,Se.projectedAnchorZ+Ye,g?de:R),Bt=xr(C.getCameraToCenterDistance(ue),tt),Pt=M.evaluateSizeForFeature(_.textSizeData,G,Se)*Bt/n.bP;g&&(Pt*=_.tilePixelRatio/B);let ct=IE(Ge,Pt);g?({x:Ne,y:gt,z:ft}=ue.projectTilePoint(Be+ct.x,Oe+ct.y,z.canonical),[Ne,gt,ft]=ql(Ne+We,gt+at,ft+Ye,R)):(h&&ct._rotate(-C.angle),Ne+=ct.x,gt+=ct.y,ft=0);let _t=_.allowVerticalPlacement&&Se.placedOrientation===n.aF.vertical?Math.PI/2:0;for(let Qe=0;Qe<Le;Qe++)n.aI(te,Ne,gt,ft,_t);W&&Se.associatedIconIndex>=0&&(ce[Se.associatedIconIndex]={x:Ne,y:gt,z:ft,angle:_t})}else dd(Le,te)}if(W){ne.clear();let Te=_.icon.placedSymbolArray;for(let Se=0;Se<Te.length;Se++){let Be=Te.get(Se),{numGlyphs:Oe}=Be,Le=ce[Se];if(Be.hidden||!Le)dd(Oe,ne);else{let{x:Ge,y:We,z:at,angle:Ye}=Le;for(let Ne=0;Ne<Oe;Ne++)n.aI(ne,Ge,We,at,Ye)}}_.icon.dynamicLayoutVertexBuffer.updateData(ne)}_.text.dynamicLayoutVertexBuffer.updateData(te)}function Vm(_,h,g,b,M,C,R={}){let z=g.paint.get("icon-translate"),B=g.paint.get("text-translate"),G=g.paint.get("icon-translate-anchor"),W=g.paint.get("text-translate-anchor"),Z=g.layout.get("icon-rotation-alignment"),te=g.layout.get("text-rotation-alignment"),ne=g.layout.get("icon-pitch-alignment"),ce=g.layout.get("text-pitch-alignment"),ue=g.layout.get("icon-keep-upright"),de=g.layout.get("text-keep-upright"),pe=g.paint.get("icon-color-saturation"),Me=g.paint.get("icon-color-contrast"),Te=g.paint.get("icon-color-brightness-min"),Se=g.paint.get("icon-color-brightness-max");g.paint.get("icon-occlusion-opacity").constantOr(0),g.paint.get("text-occlusion-opacity").constantOr(0);let Be=_.context,Oe=Be.gl,Le=_.transform,Ge=Z==="map",We=te==="map",at=ne==="map",Ye=ce==="map",Ne=g.layout.get("symbol-sort-key").constantOr(1)!==void 0,gt=!1,ft=_.depthModeForSublayer(0,n.af.ReadOnly),tt=[n.ak(Le.center.lng),n.al(Le.center.lat)],Bt=g.layout.get("text-variable-anchor"),Pt=Le.projection.name==="globe",ct=[],_t=[0,-1,0];for(let Qe of b){let Rt=h.getTile(Qe),Ft=Rt.getBucket(g);if(!Ft||Ft.projection.name==="mercator"&&Pt||Ft.fullyClipped)continue;let oi=Ft.projection.name==="globe",ci=oi?n.a2(Le.zoom):0,Si=r1(Qe,Ft.getProjection(),Le),hi=Le.calculatePixelsToTileUnitsMatrix(Rt),ji=Bt&&Ft.hasTextData(),cr=Ft.hasIconTextFit()&&ji&&Ft.hasIconData(),Wi=Ft.getProjection().createInversionMatrix(Le,Qe.canonical),gr=Xr=>{Le.depthOcclusionForSymbolsAndCircles&&(g.hasInitialOcclusionOpacityProperties||_.terrain)&&(Xr.push("DEPTH_D24"),Xr.push("DEPTH_OCCLUSION"))},Or=()=>{let Xr=Ge&&g.layout.get("symbol-placement")!=="point",Ar=[];gr(Ar);let er=Xr||cr,Is=g.paint.get("icon-image-cross-fade").constantOr(0);_.terrainRenderModeElevated()&&at&&Ar.push("PITCH_WITH_MAP_TERRAIN"),oi&&(Ar.push("PROJECTION_GLOBE_VIEW"),er&&Ar.push("PROJECTED_POS_ON_VIEWPORT")),Is>0&&Ar.push("ICON_TRANSITION"),Ft.icon.zOffsetVertexBuffer&&Ar.push("Z_OFFSET"),pe===0&&Me===0&&Te===0&&Se===1||Ar.push("COLOR_ADJUSTMENT");let Ps=Ft.icon.programConfigurations.get(g.id),Fo=_.getOrCreateProgram(Ft.sdfIcons?"symbolSDF":"symbolIcon",{config:Ps,defines:Ar}),ko,yo=Rt.imageAtlasTexture?Rt.imageAtlasTexture.size:[0,0],No=Ft.iconSizeData,no=n.aE(No,Le.zoom),vo=at||Le.pitch!==0,Ht=Am(Si,Rt.tileID.canonical,at,Ge,Le,Ft.getProjection(),hi),Mi=nv(Si,Rt.tileID.canonical,at,Ge,Le,Ft.getProjection(),hi),ta=_.translatePosMatrix(Mi,Rt,z,G,!0),Dn=_.translatePosMatrix(Si,Rt,z,G),mt=er?jm:Ht,au=Ge&&!at&&!Xr,$l=_t;!Pt&&!Le.mercatorFromTransition||Ge||($l=DE(Le));let lu=oi?$l:_t;if(Ft.sdfIcons&&!Ft.iconsInText)ko=Um(No.kind,no,au,at,_,Dn,mt,ta,!1,yo,!0,Qe,ci,tt,Wi,lu,Ft.getProjection());else{let Ed=g.getColorAdjustmentMatrix(pe,Me,Te,Se);ko=jp(No.kind,no,au,at,_,Dn,mt,ta,!1,yo,Qe,ci,tt,Wi,lu,Ft.getProjection(),Ed,Is)}let cu=Rt.imageAtlasTexture?Rt.imageAtlasTexture:null,Bv=g.layout.get("icon-size").constantOr(0)!==1||Ft.iconsNeedLinear,Uv=Ft.sdfIcons||_.options.rotating||_.options.zooming||Bv||vo?Oe.LINEAR:Oe.NEAREST,dh=Ft.sdfIcons&&g.paint.get("icon-halo-width").constantOr(1)!==0,D1=_.terrain&&at&&Xr?n.ae.invert(n.ae.create(),Ht):jm;if(Xr&&Ft.icon){let Ed=Le.elevation,jv=Ed?Ed.getAtTileOffsetFunc(Qe,Le.center.lat,Le.worldSize,Ft.getProjection()):null,ef=rv(Si,Rt.tileID.canonical,at,Ge,Le,Ft.getProjection(),hi);Fp(Ft,Si,_,!1,ef,Mi,at,ue,jv,Qe)}return{program:Fo,buffers:Ft.icon,uniformValues:ko,atlasTexture:cu,atlasTextureIcon:null,atlasInterpolation:Uv,atlasInterpolationIcon:null,isSDF:Ft.sdfIcons,hasHalo:dh,tile:Rt,labelPlaneMatrixInv:D1}},zn=()=>{let Xr=We&&g.layout.get("symbol-placement")!=="point",Ar=[],er=Xr||Bt||cr;_.terrainRenderModeElevated()&&Ye&&Ar.push("PITCH_WITH_MAP_TERRAIN"),oi&&(Ar.push("PROJECTION_GLOBE_VIEW"),er&&Ar.push("PROJECTED_POS_ON_VIEWPORT")),Ft.text.zOffsetVertexBuffer&&Ar.push("Z_OFFSET"),gr(Ar);let Is=Ft.text.programConfigurations.get(g.id),Ps=_.getOrCreateProgram(Ft.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Is,defines:Ar}),Fo,ko=[0,0],yo=null,No=Ft.textSizeData;Ft.iconsInText&&(ko=Rt.imageAtlasTexture?Rt.imageAtlasTexture.size:[0,0],yo=Rt.imageAtlasTexture?Rt.imageAtlasTexture:null,Fo=Ye||Le.pitch!==0||_.options.rotating||_.options.zooming||No.kind==="composite"||No.kind==="camera"?Oe.LINEAR:Oe.NEAREST);let no=Rt.glyphAtlasTexture?Rt.glyphAtlasTexture.size:[0,0],vo=n.aE(No,Le.zoom),Ht=Am(Si,Rt.tileID.canonical,Ye,We,Le,Ft.getProjection(),hi),Mi=nv(Si,Rt.tileID.canonical,Ye,We,Le,Ft.getProjection(),hi),ta=_.translatePosMatrix(Mi,Rt,B,W,!0),Dn=_.translatePosMatrix(Si,Rt,B,W),mt=er?jm:Ht,au=We&&!Ye&&!Xr,$l=_t;!Pt&&!Le.mercatorFromTransition||We||($l=DE(Le));let lu=oi?$l:_t,cu;cu=Ft.iconsInText?e1(No.kind,vo,au,Ye,_,Dn,mt,ta,no,ko,Qe,ci,tt,Wi,lu,Ft.getProjection()):Um(No.kind,vo,au,Ye,_,Dn,mt,ta,!0,no,!0,Qe,ci,tt,Wi,lu,Ft.getProjection());let Bv=Rt.glyphAtlasTexture?Rt.glyphAtlasTexture:null,Uv=Oe.LINEAR,dh=g.paint.get("text-halo-width").constantOr(1)!==0,D1=_.terrain&&Ye&&Xr?n.ae.invert(n.ae.create(),Ht):jm;if(Xr&&Ft.text){let Ed=Le.elevation,jv=Ed?Ed.getAtTileOffsetFunc(Qe,Le.center.lat,Le.worldSize,Ft.getProjection()):null,ef=rv(Si,Rt.tileID.canonical,Ye,We,Le,Ft.getProjection(),hi);Fp(Ft,Si,_,!0,ef,Mi,Ye,de,jv,Qe)}return{program:Ps,buffers:Ft.text,uniformValues:cu,atlasTexture:Bv,atlasTextureIcon:yo,atlasInterpolation:Uv,atlasInterpolationIcon:Fo,isSDF:!0,hasHalo:dh,tile:Rt,labelPlaneMatrixInv:D1}},xn=Ft.icon.segments.get().length,Ur=Ft.text.segments.get().length,yn=xn&&!R.onlyText?Or():null,_r=Ur&&!R.onlyIcons?zn():null,br=g.paint.get("icon-opacity").constantOr(1),ur=g.paint.get("text-opacity").constantOr(1);if(Ne&&Ft.canOverlap){gt=!0;let Xr=br&&!R.onlyText?Ft.icon.segments.get():[],Ar=ur&&!R.onlyIcons?Ft.text.segments.get():[];for(let er of Xr)ct.push({segments:new n.b([er]),sortKey:er.sortKey,state:yn});for(let er of Ar)ct.push({segments:new n.b([er]),sortKey:er.sortKey,state:_r})}else R.onlyText||ct.push({segments:br?Ft.icon.segments:new n.b([]),sortKey:0,state:yn}),R.onlyIcons||ct.push({segments:ur?Ft.text.segments:new n.b([]),sortKey:0,state:_r})}gt&&ct.sort((Qe,Rt)=>Qe.sortKey-Rt.sortKey);for(let Qe of ct){let Rt=Qe.state;if(Rt)if(_.terrain?_.terrain.setupElevationDraw(Rt.tile,Rt.program,{useDepthForOcclusion:Le.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Rt.labelPlaneMatrixInv}):_.setupDepthForOcclusion(Le.depthOcclusionForSymbolsAndCircles,Rt.program),Be.activeTexture.set(Oe.TEXTURE0),Rt.atlasTexture&&Rt.atlasTexture.bind(Rt.atlasInterpolation,Oe.CLAMP_TO_EDGE,!0),Rt.atlasTextureIcon&&(Be.activeTexture.set(Oe.TEXTURE1),Rt.atlasTextureIcon&&Rt.atlasTextureIcon.bind(Rt.atlasInterpolationIcon,Oe.CLAMP_TO_EDGE,!0)),_.uploadCommonLightUniforms(_.context,Rt.program),Rt.hasHalo){let Ft=Rt.uniformValues;Ft.u_is_halo=1,n1(Rt.buffers,Qe.segments,g,_,Rt.program,ft,M,C,Ft,2),Ft.u_is_halo=0}else{if(Rt.isSDF){let Ft=Rt.uniformValues;Rt.hasHalo&&(Ft.u_is_halo=1,n1(Rt.buffers,Qe.segments,g,_,Rt.program,ft,M,C,Ft,1)),Ft.u_is_halo=0}n1(Rt.buffers,Qe.segments,g,_,Rt.program,ft,M,C,Rt.uniformValues,1)}}}function n1(_,h,g,b,M,C,R,z,B,G){let W=[_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer,_.iconTransitioningVertexBuffer,_.globeExtVertexBuffer,_.zOffsetVertexBuffer];M.draw(b,b.context.gl.TRIANGLES,C,R,z,n.ag.disabled,B,g.id,_.layoutVertexBuffer,_.indexBuffer,h,g.paint,b.transform.zoom,_.programConfigurations.get(g.id),W,G)}function Gm(_,h,g,b,M,C,R){let z=_.context.gl,B=g.paint.get("fill-pattern"),G=B&&B.constantOr(1),W,Z,te,ne,ce;R?(Z=G&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",W=z.LINES):(Z=G?"fillPattern":"fill",W=z.TRIANGLES);for(let ue of b){let de=h.getTile(ue);if(G&&!de.patternsLoaded())continue;let pe=de.getBucket(g);if(!pe)continue;_.prepareDrawTile();let Me=pe.programConfigurations.get(g.id),Te=_.isTileAffectedByFog(ue),Se=_.getOrCreateProgram(Z,{config:Me,overrideFog:Te});G&&(_.context.activeTexture.set(z.TEXTURE0),de.imageAtlasTexture&&de.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Me.updatePaintBuffers());let Be=B.constantOr(null);if(Be&&de.imageAtlas){let Ge=de.imageAtlas.patternPositions[Be.toString()];Ge&&Me.setConstantPatternPositions(Ge)}let Oe=_.translatePosMatrix(ue.projMatrix,de,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor")),Le=g.paint.get("fill-emissive-strength");if(R){ne=pe.indexBuffer2,ce=pe.segments2;let Ge=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[z.drawingBufferWidth,z.drawingBufferHeight];te=Z==="fillOutlinePattern"&&G?km(Oe,Le,_,de,Ge):dv(Oe,Le,Ge)}else ne=pe.indexBuffer,ce=pe.segments,te=G?hv(Oe,Le,_,de):Fm(Oe,Le);_.uploadCommonUniforms(_.context,Se,ue.toUnwrapped()),Se.draw(_,W,M,_.stencilModeForClipping(ue),C,n.ag.disabled,te,g.id,pe.layoutVertexBuffer,ne,ce,g.paint,_.transform.zoom,Me,void 0)}}function gd(_,h,g,b,M,C,R,z){g.resetLayerRenderingStats(_);let B=_.context,G=B.gl,W=_.transform,Z=g.paint.get("fill-extrusion-pattern"),te=Z.constantOr(1),ne=g.paint.get("fill-extrusion-opacity"),ce=_.style.enable3dLights(),ue=g.paint.get(ce&&!te?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),de=[g.paint.get("fill-extrusion-ambient-occlusion-intensity"),ue],pe=g.layout.get("fill-extrusion-edge-radius"),Me=pe>0&&!g.paint.get("fill-extrusion-rounded-roof"),Te=Me?0:pe,Se=W.projection.name==="globe"?n.b_():0,Be=W.projection.name==="globe",Oe=Be?n.a2(W.zoom):0,Le=[n.ak(W.center.lng),n.al(W.center.lat)],Ge=g.paint.get("fill-extrusion-flood-light-color").toRenderColor(g.lut).toArray01().slice(0,3),We=g.paint.get("fill-extrusion-flood-light-intensity"),at=g.paint.get("fill-extrusion-vertical-scale"),Ye=g.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ne=ba(_,g.paint.get("fill-extrusion-cutoff-fade-range")),gt=g.paint.get("fill-extrusion-emissive-strength"),ft=[];Be&&ft.push("PROJECTION_GLOBE_VIEW"),de[0]>0&&ft.push("FAUX_AO"),Me&&ft.push("ZERO_ROOF_RADIUS"),z&&ft.push("HAS_CENTROID"),We>0&&ft.push("FLOOD_LIGHT"),Ne.shouldRenderCutoff&&ft.push("RENDER_CUTOFF"),Ye&&ft.push("RENDER_WALL_MODE");let tt=(()=>{let oi=g.paint.get("fill-extrusion-line-alignment");switch(oi){case"inside":return 1;case"outside":return-1;case"center":return 0;default:return n.w(`Unsupported value for fill-extrusion-line-alignment: ${oi}`),0}})(),Bt,Pt=_.renderPass==="shadow",ct=_.shadowRenderer,_t=Pt&&!!ct;_.shadowRenderer&&(_.shadowRenderer.useNormalOffset=!0);let Qe=[0,0,0];if(ct){let oi=_.style.directionalLight,ci=_.style.ambientLight;oi&&ci&&(Qe=Pm(_.style,oi,ci)),Bt=ft.concat(["SHADOWS_SINGLE_CASCADE"])}let Rt=_t?"fillExtrusionDepth":te?"fillExtrusionPattern":"fillExtrusion",Ft=g.getLayerRenderingStats();for(let oi of b){let ci=h.getTile(oi),Si=ci.getBucket(g);if(!Si||Si.projection.name!==W.projection.name)continue;let hi=!1;ct&&(hi=ct.getMaxCascadeForTile(oi.toUnwrapped())===0);let ji=_.isTileAffectedByFog(oi),cr=Si.programConfigurations.get(g.id),Wi=_.getOrCreateProgram(Rt,{config:cr,defines:hi?Bt:ft,overrideFog:ji});if(_.terrain&&_.terrain.setupElevationDraw(ci,Wi,{useMeterToDem:!0}),!Si.centroidVertexBuffer){let _r=Wi.attributes.a_centroid_pos;_r!==void 0&&G.vertexAttrib2f(_r,0,0)}!Pt&&ct&&ct.setupShadows(ci.tileID.toUnwrapped(),Wi,"vector-tile",ci.tileID.overscaledZ),te&&(_.context.activeTexture.set(G.TEXTURE0),ci.imageAtlasTexture&&ci.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),cr.updatePaintBuffers());let gr=Z.constantOr(null);if(gr&&ci.imageAtlas){let _r=ci.imageAtlas.patternPositions[gr.toString()];_r&&cr.setConstantPatternPositions(_r)}let Or=g.paint.get("fill-extrusion-vertical-gradient"),zn=1/Si.tileToMeter,xn;if(Pt&&ct){if(Ec(ci.tileID,Si,_))continue;let _r=ct.calculateShadowPassMatrixFromTile(ci.tileID.toUnwrapped());xn=uv(_r,Te,tt,zn,at)}else{let _r=_.translatePosMatrix(oi.expandedProjMatrix,ci,g.paint.get("fill-extrusion-translate"),g.paint.get("fill-extrusion-translate-anchor")),br=W.projection.createInversionMatrix(W,oi.canonical);xn=te?wE(_r,_,Or,ne,de,Te,tt,zn,oi,ci,Se,Oe,Le,br,Ge,at):wc(_r,_,Or,ne,de,Te,tt,zn,oi,Se,Oe,Le,br,Ge,at,We,Qe,gt)}_.uploadCommonUniforms(B,Wi,oi.toUnwrapped(),null,Ne);let Ur=Si.segments;if(W.projection.name==="mercator"&&!Pt&&(Ur=Si.getVisibleSegments(ci.tileID,_.terrain,_.transform.getFrustum(0)),!Ur.get().length))continue;if(Ft)if(Pt)for(let _r of Ur.get())Ft.numRenderedVerticesInShadowPass+=_r.primitiveLength;else for(let _r of Ur.get())Ft.numRenderedVerticesInTransparentPass+=_r.primitiveLength;let yn=[];(_.terrain||z)&&yn.push(Si.centroidVertexBuffer),Be&&yn.push(Si.layoutVertexExtBuffer),Ye&&yn.push(Si.wallVertexBuffer),Wi.draw(_,B.gl.TRIANGLES,M,C,R,n.ag.backCCW,xn,g.id,Si.layoutVertexBuffer,Si.indexBuffer,Ur,g.paint,_.transform.zoom,cr,yn)}_.shadowRenderer&&(_.shadowRenderer.useNormalOffset=!1)}function Gp(_,h,g,b,M,C,R,z,B,G,W,Z,te,ne,ce,ue,de,pe,Me){let Te=_.context,Se=Te.gl,Be=_.transform,Oe=_.transform.zoom,Le=[],Ge=ba(_,g.paint.get("fill-extrusion-cutoff-fade-range"));G==="clear"?(Le.push("CLEAR_SUBPASS"),Me&&(Le.push("CLEAR_FROM_TEXTURE"),Te.activeTexture.set(Se.TEXTURE0),Me.bind(Se.LINEAR,Se.CLAMP_TO_EDGE))):G==="sdf"&&Le.push("SDF_SUBPASS"),de&&Le.push("HAS_CENTROID"),Ge.shouldRenderCutoff&&Le.push("RENDER_CUTOFF");let We=g.layout.get("fill-extrusion-edge-radius"),at=(Ye,Ne,gt,ft,tt)=>{let Bt=Ne.programConfigurations.get(g.id),Pt=_.isTileAffectedByFog(Ye),ct=_.getOrCreateProgram("fillExtrusionGroundEffect",{config:Bt,defines:Le,overrideFog:Pt}),_t=((Rt,Ft,oi,ci,Si,hi,ji,cr,Wi,gr,Or)=>({u_matrix:Ft,u_opacity:oi,u_ao_pass:ci?1:0,u_meter_to_tile:Si,u_ao:hi,u_flood_light_intensity:ji,u_flood_light_color:cr,u_attenuation:Wi,u_edge_radius:gr,u_fb:0,u_fb_size:Or}))(0,ft,W,B,tt,[Z,te*tt],ne,ce,ue,Oe>=17?0:We*tt,Me?Me.size[0]:0),Qe=[];de&&Qe.push(Ne.hiddenByLandmarkVertexBuffer),_.uploadCommonUniforms(Te,ct,Ye.toUnwrapped(),null,Ge),ct.draw(_,Te.gl.TRIANGLES,M,C,R,z,_t,g.id,Ne.vertexBuffer,Ne.indexBuffer,gt,g.paint,Oe,Bt,Qe)};for(let Ye of b){let Ne=h.getTile(Ye),gt=Ne.getBucket(g);if(!gt||gt.projection.name!==Be.projection.name||!gt.groundEffect||gt.groundEffect&&!gt.groundEffect.hasData())continue;let ft=gt.groundEffect,tt=1/gt.tileToMeter;{let Bt=_.translatePosMatrix(Ye.projMatrix,Ne,g.paint.get("fill-extrusion-translate"),g.paint.get("fill-extrusion-translate-anchor")),Pt=ft.getDefaultSegment();at(Ye,ft,Pt,Bt,tt)}if(pe)for(let Bt=0;Bt<4;Bt++){let Pt=n.b$[Bt](Ye),ct=h.getTile(Pt);if(!ct)continue;let _t=ct.getBucket(g);if(!_t||_t.projection.name!==Be.projection.name||!_t.groundEffect||_t.groundEffect&&!_t.groundEffect.hasData())continue;let Qe=_t.groundEffect,Rt,Ft;Bt===0?(Rt=[-n.a4,0,0],Ft=1):Bt===1?(Rt=[n.a4,0,0],Ft=0):Bt===2?(Rt=[0,-n.a4,0],Ft=3):(Rt=[0,n.a4,0],Ft=2);let oi=Qe.regionSegments[Ft];if(!oi)continue;let ci=new Float32Array(16);n.ae.translate(ci,Ye.projMatrix,Rt),at(Ye,Qe,oi,_.translatePosMatrix(ci,Ne,g.paint.get("fill-extrusion-translate"),g.paint.get("fill-extrusion-translate-anchor")),tt)}}}function yP(_,h,g,b,M,C,R){b.centroidVertexArray.length===0&&b.createCentroidsBuffer();let z=C?C.findDEMTileFor(g):null;if(!(z&&z.dem||R))return;let B=pe=>new n.P(Math.ceil((pe+n.c2)*n.c3),0),G=pe=>{let Me=h.getSource().minzoom,Te=Be=>{let Oe=h.getTileByID(Be);if(Oe&&Oe.hasData())return Oe.getBucket(M)},Se=[0,-1,1];for(let Be of Se){if(pe.overscaledZ+Be<Me)continue;let Oe=Te(pe.calculateScaledKey(pe.overscaledZ+Be));if(Oe)return Oe}},W=[0,0,0],Z=(pe,Me)=>(W[0]=Math.min(pe.min.y,Me.min.y),W[1]=Math.max(pe.max.y,Me.max.y),W[2]=n.a4-Me.min.x>pe.max.x?Me.min.x-n.a4:pe.max.x,W),te=(pe,Me)=>(W[0]=Math.min(pe.min.x,Me.min.x),W[1]=Math.max(pe.max.x,Me.max.x),W[2]=n.a4-Me.min.y>pe.max.y?Me.min.y-n.a4:pe.max.y,W),ne=[(pe,Me)=>Z(pe,Me),(pe,Me)=>Z(Me,pe),(pe,Me)=>te(pe,Me),(pe,Me)=>te(Me,pe)],ce=(pe,Me,Te,Se,Be,Oe,Le)=>{if(!C)return 0;let Ge=[[Oe?Te:pe,Oe?pe:Te,0],[Oe?Te:Me,Oe?Me:Te,0]],We=Le<0?n.a4+Le:Le,at=[Oe?We:(pe+Me)/2,Oe?(pe+Me)/2:We,0];return Te===0&&Le<0||Te!==0&&Le>0?C.getForTilePoints(Be,[at],!0,Se):Ge.push(at),C.getForTilePoints(g,Ge,!0,z),Math.max(Ge[0][2],Ge[1][2],at[2])/C.exaggeration()};for(let pe=0;pe<4;pe++){let Me=b.borderFeatureIndices[pe];if(Me.length===0)continue;let Te=n.b$[pe](g),Se=G(Te);if(!(Se&&Se instanceof n.c0)||b.borderDoneWithNeighborZ[pe]===Se.canonical.z)continue;Se.centroidVertexArray.length===0&&Se.createCentroidsBuffer();let Be=C?C.findDEMTileFor(Te):null;if(!(Be&&Be.dem||R))continue;let Oe=(pe<2?1:5)-pe,Le=Se.borderDoneWithNeighborZ[Oe]!==b.canonical.z,Ge=Se.borderFeatureIndices[Oe],We=0;if(b.canonical.z!==Se.canonical.z){for(let at of Me)b.showCentroid(b.featuresOnBorder[at]);if(Le)for(let at of Ge)Se.showCentroid(Se.featuresOnBorder[at]);b.borderDoneWithNeighborZ[pe]=Se.canonical.z,Se.borderDoneWithNeighborZ[Oe]=b.canonical.z}for(let at of Me){let Ye=b.featuresOnBorder[at],Ne=b.centroidData[Ye.centroidDataIndex],gt=Ye.borders[pe],ft;for(;We<Ge.length;){ft=Se.featuresOnBorder[Ge[We]];let tt=ft.borders[Oe];if(tt[1]>gt[0]+3||tt[0]>gt[0]-3)break;Se.showCentroid(ft),We++}if(ft&&We<Ge.length){let tt=We,Bt=0;for(;!(ft.borders[Oe][0]>gt[1]-3)&&(Bt++,++We!==Ge.length);)ft=Se.featuresOnBorder[Ge[We]];if(ft=Se.featuresOnBorder[Ge[tt]],Bt>1){let _t=ft.borders[Oe];Math.abs(gt[0]-_t[0])<3&&Math.abs(gt[1]-_t[1])<3&&(Bt=1,We=tt+1)}else if(Bt===0){b.showCentroid(Ye);continue}let Pt=Se.centroidData[ft.centroidDataIndex];R&&Bt===1&&(((ue=Ne).flags|(de=Pt).flags)&n.c1?(ue.flags|=n.c1,de.flags|=n.c1):(ue.flags&=~n.c1,de.flags&=~n.c1));let ct=Ye.intersectsCount()>1||ft.intersectsCount()>1;if(Bt>1)We=tt,Ne.centroidXY=Pt.centroidXY=new n.P(0,0);else if(Be&&Be.dem&&!ct){let _t=ne[pe](Ne,Pt),Qe=pe%2?n.a4-1:0,Rt=ce(_t[0],Math.min(n.a4-1,_t[1]),Qe,Be,Te,pe<2,_t[2]);Ne.centroidXY=Pt.centroidXY=B(Rt)}else ct?Ne.centroidXY=Pt.centroidXY=new n.P(0,0):(Ne.centroidXY=b.encodeBorderCentroid(Ye),Pt.centroidXY=Se.encodeBorderCentroid(ft));b.writeCentroidToBuffer(Ne),Se.writeCentroidToBuffer(Pt)}else b.showCentroid(Ye)}b.borderDoneWithNeighborZ[pe]=Se.canonical.z,Se.borderDoneWithNeighborZ[Oe]=b.canonical.z}var ue,de;(b.needsCentroidUpdate||!b.centroidVertexBuffer&&b.centroidVertexArray.length!==0)&&b.uploadCentroid(_)}let PE=[1,0,0],vP=[0,1,0],mv=[0,0,1];function Ec(_,h,g){let b=g.transform,M=g.shadowRenderer;if(!M)return!0;let C=_.toUnwrapped(),R=b.tileSize*M._cascades[g.currentShadowCascade].scale,z=h.maxHeight;if(b.elevation){let ue=b.elevation.getMinMaxForTile(_);ue&&(z+=ue.max)}let B=[...M.shadowDirection];B[2]=-B[2];let G=M.computeSimplifiedTileShadowVolume(C,z,R,B);if(!G)return!1;let W=[PE,vP,mv,B,[B[0],0,B[2]],[0,B[1],B[2]]],Z=b.projection.name==="globe",te=b.scaleZoom(R),ne=n.aM.fromInvProjectionMatrix(b.invProjMatrix,b.worldSize,te,!Z),ce=M.getCurrentCascadeFrustum();return ne.intersectsPrecise(G.vertices,G.planes,W)===0||ce.intersectsPrecise(G.vertices,G.planes,W)===0}function Hm(_){return[_[0]*n.c4,_[1]*n.c4,_[2]*n.c4,0]}function gv(_,h,g,b,M,C,R,z,B){let G=b.getSource(),W=g.globeSharedBuffers;if(!W)return;let Z,te,ne;if(h&&(Z=b.getTile(h)),G instanceof n.bo?(te=G.texture,ne=n.bj(0,0,g.transform)):Z&&h&&(te=Z.texture,ne=n.bj(h.canonical.z,h.canonical.x,g.transform)),!te||!ne)return;_||(ne=n.ae.scale(n.ae.create(),ne,[1,-1,1]));let ce=g.context,ue=ce.gl,de=M.paint.get("raster-resampling")==="nearest"?ue.NEAREST:ue.LINEAR,pe=g.colorModeForDrapableLayerRenderPass(C),Me=R.defines;Me.push("GLOBE_POLES");let Te=new n.af(ue.LEQUAL,n.af.ReadWrite,g.depthRangeFor3D),Se=Float32Array.from(g.transform.expandedFarZProjMatrix),Be=Float32Array.from(n.bh(n.bi(new n.aO(0,0,0))));g.terrain&&g.terrain.prepareDrawTile(),ce.activeTexture.set(ue.TEXTURE0),te.bind(de,ue.CLAMP_TO_EDGE),ce.activeTexture.set(ue.TEXTURE1),te.bind(de,ue.CLAMP_TO_EDGE),te.useMipmap&&ce.extTextureFilterAnisotropic&&g.transform.pitch>20&&ue.texParameterf(ue.TEXTURE_2D,ce.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ce.extTextureFilterAnisotropicMax);let[Oe,Le,Ge,We]=h?W.getPoleBuffers(h.canonical.z,!1):W.getPoleBuffers(0,!0),at=M.paint.get("raster-elevation"),Ye;_?(Ye=Oe,g.renderDefaultNorthPole=at!==0):(Ye=Le,g.renderDefaultSouthPole=at!==0);let Ne=Hm(R.mix),gt=((tt,Bt,Pt,ct,_t,Qe,Rt,Ft,oi,ci,Si,hi,ji)=>fv(tt,Bt,Pt,new Float32Array(16),new Float32Array(9),[0,0],ct,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Qe,[0,0],Ft,2,ci,Si,hi,1,0,ji))(Se,Be,ne,n.a2(g.transform.zoom),0,M,0,at,0,Ne,R.offset,R.range,C),ft=g.getOrCreateProgram("raster",{defines:Me});g.uploadCommonUniforms(ce,ft,null),ft.draw(g,ue.TRIANGLES,Te,B,pe,z,gt,M.id,Ye,Ge,We)}function s1(_){let h=_._nearZ,g=_.projection.farthestPixelDistance(_),b=g-h,M=.2*_.height,C=h+M;return[h,g,(C-M-h)/b,(C-h)/b]}function yd(_,h,g,b){if(_)return h instanceof oh&&_ instanceof n.c5?h.getTextureDescriptor(_,g,!0):{texture:_.texture,mix:Hm(b.mix),offset:b.offset,buffer:0,tileSize:1}}function RE(_,h,g){if(!_)return null;let b=h.getTextureDescriptor(_,g,!0);if(!b)return null;let{texture:M,mix:C,offset:R,tileSize:z,buffer:B,format:G}=b;if(!M||!G)return null;let W=!1;return G==="uint32"&&(W=!0,C[3]=0,C=Kx(n.c6,C,[0,g.paint.get("raster-particle-max-speed")]),R=Nm(n.c6,R,[0,g.paint.get("raster-particle-max-speed")])),{texture:M,textureOffset:[B/(z+2*B),z/(z+2*B)],tileSize:z,scalarData:W,scale:C,offset:R,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[G]]}}function yv(_){let h=_._nearZ,g=_.projection.farthestPixelDistance(_),b=g-h,M=.2*_.height,C=h+M;return[h,g,(C-M-h)/b,(C-h)/b]}let o1=new n.C(1,0,0,1),vv=new n.C(0,1,0,1),a1=new n.C(0,0,1,1),en=new n.C(1,0,1,1),_P=new n.C(0,1,1,1);function Gi(_,h,g,b,M,C,R){let z=_.context,B=_.transform,G=z.gl,W=B.projection.name==="globe",Z=W?["PROJECTION_GLOBE_VIEW"]:[],te=n.ae.clone(g.projMatrix);if(W&&n.a2(B.zoom)>0){let Ne=n.c7(g.canonical,B),gt=n.c8(Ne);te=n.ae.multiply(new Float32Array(16),B.globeMatrix,gt),n.ae.multiply(te,B.projMatrix,te)}let ne=n.ae.create();ne[12]+=2*M/(n.e.devicePixelRatio*B.width),ne[13]+=2*C/(n.e.devicePixelRatio*B.height),n.ae.multiply(te,ne,te);let ce=_.getOrCreateProgram("debug",{defines:Z}),ue=h.getTileByID(g.key);_.terrain&&_.terrain.setupElevationDraw(ue,ce);let de=n.af.disabled,pe=n.ah.disabled,Me=_.colorModeForRenderPass(),Te="$debug";z.activeTexture.set(G.TEXTURE0),_.emptyTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),W?ue._makeGlobeTileDebugBuffers(_.context,B):ue._makeDebugTileBoundsBuffers(_.context,B.projection);let Se=ue._tileDebugBuffer||_.debugBuffer,Be=ue._tileDebugIndexBuffer||_.debugIndexBuffer,Oe=ue._tileDebugSegments||_.debugSegments;if(ce.draw(_,G.LINE_STRIP,de,pe,Me,n.ag.disabled,pv(te,b),Te,Se,Be,Oe,null,null,null,[ue._globeTileDebugBorderBuffer]),R){let Ne=ue.latestRawTileData,gt=Math.floor((Ne&&Ne.byteLength||0)/1024),ft=g.canonical.toString();g.overscaledZ!==g.canonical.z&&(ft+=` => ${g.overscaledZ}`),ft+=` ${ue.state}`,ft+=` ${gt}kb`,function(tt,Bt){tt.initDebugOverlayCanvas();let Pt=tt.debugOverlayCanvas,ct=tt.context.gl,_t=tt.debugOverlayCanvas.getContext("2d");_t.clearRect(0,0,Pt.width,Pt.height),_t.shadowColor="white",_t.shadowBlur=2,_t.lineWidth=1.5,_t.strokeStyle="white",_t.textBaseline="top",_t.font="bold 36px Open Sans, sans-serif",_t.fillText(Bt,5,5),_t.strokeText(Bt,5,5),tt.debugOverlayTexture.update(Pt),tt.debugOverlayTexture.bind(ct.LINEAR,ct.CLAMP_TO_EDGE)}(_,ft)}let Le=h.getTile(g).tileSize,Ge=512/Math.min(Le,512)*(g.overscaledZ/B.zoom)*.5,We=ue._tileDebugTextBuffer||_.debugBuffer,at=ue._tileDebugTextIndexBuffer||_.quadTriangleIndexBuffer,Ye=ue._tileDebugTextSegments||_.debugSegments;ce.draw(_,G.TRIANGLES,de,pe,n.a.alphaBlended,n.ag.disabled,pv(te,n.C.transparent,Ge),Te,We,at,Ye,null,null,null,[ue._globeTileDebugTextBuffer])}function l1(_,h,g,b){Hp(_,0,h+g/2,_.transform.width,g,b)}function Wm(_,h,g,b){Hp(_,h-g/2,0,g,_.transform.height,b)}function Hp(_,h,g,b,M,C){let R=_.context,z=R.gl;z.enable(z.SCISSOR_TEST),z.scissor(h*n.e.devicePixelRatio,g*n.e.devicePixelRatio,b*n.e.devicePixelRatio,M*n.e.devicePixelRatio),R.clear({color:C}),z.disable(z.SCISSOR_TEST)}let Mc=n.c9([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:c1}=Mc;function Qa(_,h,g,b){_.emplaceBack(h,g,b)}class bi{constructor(h){this.vertexArray=new n.ca,this.indices=new n.bw,Qa(this.vertexArray,-1,-1,1),Qa(this.vertexArray,1,-1,1),Qa(this.vertexArray,-1,1,1),Qa(this.vertexArray,1,1,1),Qa(this.vertexArray,-1,-1,-1),Qa(this.vertexArray,1,-1,-1),Qa(this.vertexArray,-1,1,-1),Qa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=h.createVertexBuffer(this.vertexArray,c1),this.indexBuffer=h.createIndexBuffer(this.indices),this.segment=n.b.simpleSegment(0,0,36,12)}}function qr(_,h,g,b,M,C){let R=_.context.gl,z=h.paint.get("sky-atmosphere-color"),B=h.paint.get("sky-atmosphere-halo-color"),G=h.paint.get("sky-atmosphere-sun-intensity"),W=((Z,te,ne,ce,ue)=>({u_matrix_3f:Z,u_sun_direction:te,u_sun_intensity:ne,u_color_tint_r:[ce.r,ce.g,ce.b,ce.a],u_color_tint_m:[ue.r,ue.g,ue.b,ue.a],u_luminance:5e-5}))(n.bE.fromMat4(n.bE.create(),b),M,G,z,B);R.framebufferTexture2D(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.TEXTURE_CUBE_MAP_POSITIVE_X+C,h.skyboxTexture,0),g.draw(_,R.TRIANGLES,n.af.disabled,n.ah.disabled,n.a.unblended,n.ag.frontCW,W,"skyboxCapture",h.skyboxGeometry.vertexBuffer,h.skyboxGeometry.indexBuffer,h.skyboxGeometry.segment)}let on=n.c9([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ml{constructor(h){let g=new n.cb;g.emplaceBack(-1,1,1,0,0),g.emplaceBack(1,1,1,1,0),g.emplaceBack(1,-1,1,1,1),g.emplaceBack(-1,-1,1,0,1);let b=new n.bw;b.emplaceBack(0,1,2),b.emplaceBack(2,3,0),this.vertexBuffer=h.createVertexBuffer(g,on.members),this.indexBuffer=h.createIndexBuffer(b),this.segments=n.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let Wp=n.c9([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Qr{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class _v{constructor(h){this.colorModeAlphaBlendedWriteRGB=new n.a([n.cc,n.cd,n.cc,n.cd],n.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new n.a([n.cc,n.ce,n.cc,n.ce],n.C.transparent,[!1,!1,!1,!0]),this.params=new Qr,this.updateNeeded=!0,h.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),h.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),h.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),h.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(h){let g=h.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ml(g);let b=this.params.sizeRange,M=this.params.intensityRange,C=function(W){let Z=n.ch(30),te=[];for(let ne=0;ne<W;++ne){let ce=2*Math.PI*Z(),ue=Math.acos(1-2*Z())-.5*Math.PI;te.push(n.$.fromValues(Math.cos(ue)*Math.cos(ce),Math.cos(ue)*Math.sin(ce),Math.sin(ue)))}return te}(this.params.starsCount),R=n.ch(300),z=new n.cf,B=new n.bw,G=0;for(let W=0;W<C.length;++W){let Z=n.$.scale([],C[W],200),te=Math.max(0,1+.01*b*(1*R()-.5)),ne=Math.max(0,1+.01*M*(1*R()-.5));z.emplaceBack(Z[0],Z[1],Z[2],-1,-1,te,ne),z.emplaceBack(Z[0],Z[1],Z[2],1,-1,te,ne),z.emplaceBack(Z[0],Z[1],Z[2],1,1,te,ne),z.emplaceBack(Z[0],Z[1],Z[2],-1,1,te,ne),B.emplaceBack(G+0,G+1,G+2),B.emplaceBack(G+0,G+2,G+3),G+=4}this.starsVx=g.createVertexBuffer(z,Wp.members),this.starsIdx=g.createIndexBuffer(B),this.starsSegments=n.b.simpleSegment(0,0,z.length,B.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(h,g){let b=h.context,M=b.gl,C=h.transform,R=new n.af(M.LEQUAL,n.af.ReadOnly,[0,1]),z=n.a2(C.zoom),B=h.style.getLut(g.scope),G=g.properties.get("color").toRenderColor(B).toArray01(),W=g.properties.get("high-color").toRenderColor(B).toArray01(),Z=g.properties.get("space-color").toRenderColor(B).toArray01PremultipliedAlpha(),te=5e-4,ne=n.cg(g.properties.get("horizon-blend"),0,1,te,.25),ce=n.bc(h,b,C)&&ne===te?C.worldSize/(2*Math.PI*1.025)-1:C.globeRadius,ue=h.frameCounter/1e3%1,de=n.$.length(C.globeCenterInViewSpace),pe=Math.sqrt(Math.pow(de,2)-Math.pow(ce,2)),Me=Math.acos(pe/de),Te=Se=>{let Be=C.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Se&&Be.push("ALPHA_PASS");let Oe=h.getOrCreateProgram("globeAtmosphere",{defines:Be}),Le=((We,at,Ye,Ne,gt,ft,tt,Bt,Pt,ct,_t,Qe)=>({u_frustum_tl:We,u_frustum_tr:at,u_frustum_br:Ye,u_frustum_bl:Ne,u_horizon:gt,u_transition:ft,u_fadeout_range:tt,u_color:Bt,u_high_color:Pt,u_space_color:ct,u_temporal_offset:_t,u_horizon_angle:Qe}))(C.frustumCorners.TL,C.frustumCorners.TR,C.frustumCorners.BR,C.frustumCorners.BL,C.frustumCorners.horizon,z,ne,G,W,Z,ue,Me);h.uploadCommonUniforms(b,Oe);let Ge=this.atmosphereBuffer;Ge&&Oe.draw(h,M.TRIANGLES,R,n.ah.disabled,Se?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,n.ag.backCW,Le,Se?"atmosphere_glow_alpha":"atmosphere_glow",Ge.vertexBuffer,Ge.indexBuffer,Ge.segments)};Te(!1),Te(!0)}drawStars(h,g){let b=n.au(g.properties.get("star-intensity"),0,1);if(b===0)return;let M=h.context,C=M.gl,R=h.transform,z=h.getOrCreateProgram("stars"),B=n.aw.identity([]);n.aw.rotateX(B,B,-R._pitch),n.aw.rotateZ(B,B,-R.angle),n.aw.rotateX(B,B,n.ac(R._center.lat)),n.aw.rotateY(B,B,-n.ac(R._center.lng));let G=n.ae.fromQuat(new Float32Array(16),B),W=n.ae.multiply([],R.starsProjMatrix,G),Z=n.bE.fromMat4([],G),te=n.bE.invert([],Z),ne=[0,1,0];n.$.transformMat3(ne,ne,te),n.$.scale(ne,ne,this.params.sizeMultiplier);let ce=[1,0,0];n.$.transformMat3(ce,ce,te),n.$.scale(ce,ce,this.params.sizeMultiplier);let ue=(de=ne,pe=ce,Me=b,{u_matrix:Float32Array.from(W),u_up:de,u_right:pe,u_intensity_multiplier:Me});var de,pe,Me;h.uploadCommonUniforms(M,z),this.starsVx&&this.starsIdx&&z.draw(h,C.TRIANGLES,n.af.disabled,n.ah.disabled,this.colorModeAlphaBlendedWriteRGB,n.ag.disabled,ue,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function qp(_,h){let g=[..._],b=h.cameraWorldSizeForFog/h.worldSize,M=n.ae.identity([]);return n.ae.scale(M,M,[b,b,1]),n.ae.multiply(g,M,g),n.ae.multiply(g,h.worldToFogMatrix,g),g}function vd(_,h,g,b,M){let C=g.material,R=b.context,{baseColorTexture:z,metallicRoughnessTexture:B}=C.pbrMetallicRoughness,{normalTexture:G,occlusionTexture:W,emissionTexture:Z}=C;function te(ne,ce,ue){if(ne&&(_.push(ce),R.activeTexture.set(R.gl.TEXTURE0+ue),ne.gfxTexture)){let{minFilter:de,magFilter:pe,wrapS:Me,wrapT:Te}=ne.sampler;ne.gfxTexture.bindExtraParam(de,pe,Me,Te)}}te(z,"HAS_TEXTURE_u_baseColorTexture",Po.BaseColor),te(B,"HAS_TEXTURE_u_metallicRoughnessTexture",Po.MetallicRoughness),te(G,"HAS_TEXTURE_u_normalTexture",Po.Normal),te(W,"HAS_TEXTURE_u_occlusionTexture",Po.Occlusion),te(Z,"HAS_TEXTURE_u_emissionTexture",Po.Emission),M&&(M.texture||(M.texture=new n.cj(b.context,M.image,[M.image.height,M.image.height,M.image.height],R.gl.RGBA)),R.activeTexture.set(R.gl.TEXTURE0+Po.LUT),M.texture&&M.texture.bind(R.gl.LINEAR,R.gl.CLAMP_TO_EDGE),_.push("APPLY_LUT_ON_GPU")),g.texcoordBuffer&&(_.push("HAS_ATTRIBUTE_a_uv_2f"),h.push(g.texcoordBuffer)),g.colorBuffer&&(_.push(g.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),h.push(g.colorBuffer)),g.normalBuffer&&(_.push("HAS_ATTRIBUTE_a_normal_3f"),h.push(g.normalBuffer)),g.pbrBuffer&&(_.push("HAS_ATTRIBUTE_a_pbr"),_.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),h.push(g.pbrBuffer)),C.alphaMode!=="OPAQUE"&&C.alphaMode!=="MASK"||_.push("UNPREMULT_TEXTURE_IN_SHADER"),C.defined||_.push("DIFFUSE_SHADED"),_.push("USE_STANDARD_DERIVATIVES")}function Lo(_,h,g,b,M,C){let R=g.paint.get("model-opacity"),z=h.context,B=new n.af(h.context.gl.LEQUAL,n.af.ReadWrite,h.depthRangeFor3D),G=h.transform,W=_.mesh,Z=W.material,te=Z.pbrMetallicRoughness,ne=h.style.fog,ce;ce=h.transform.projection.zAxisUnit==="pixels"?[..._.nodeModelMatrix]:n.ae.multiply([],b.zScaleMatrix,_.nodeModelMatrix),n.ae.multiply(ce,b.negCameraPosMatrix,ce);let ue=n.ae.invert([],ce);n.ae.transpose(ue,ue);let de=g.paint.get("model-emissive-strength").constantOr(0),pe=fd(new Float32Array(_.worldViewProjection),new Float32Array(ce),new Float32Array(ue),null,h,R,te.baseColorFactor.toRenderColor(null),Z.emissiveFactor,te.metallicFactor,te.roughnessFactor,Z,de,g),Me={defines:[]},Te=[];vd(Me.defines,Te,W,h,g.lut);let Se=h.shadowRenderer;Se&&(Se.useNormalOffset=!1);let Be=null;if(ne){let Ge=qp(_.nodeModelMatrix,h.transform);if(Be=new Float32Array(Ge),G.projection.name!=="globe"){let We=W.aabb.min,at=W.aabb.max,[Ye,Ne]=ne.getOpacityForBounds(Ge,We[0],We[1],at[0],at[1]);Me.overrideFog=Ye>=qi||Ne>=qi}}let Oe=ba(h,g.paint.get("model-cutoff-fade-range"));Oe.shouldRenderCutoff&&Me.defines.push("RENDER_CUTOFF");let Le=h.getOrCreateProgram("model",Me);h.uploadCommonUniforms(z,Le,null,Be,Oe),h.renderPass!=="shadow"&&Se&&Se.setupShadowsFromMatrix(_.nodeModelMatrix,Le),Le.draw(h,z.gl.TRIANGLES,B,M,C,W.material.doubleSided?n.ag.disabled:n.ag.backCCW,pe,g.id,W.vertexBuffer,W.indexBuffer,W.segments,g.paint,h.transform.zoom,void 0,Te)}function Es(_,h,g,b,M,C,R){let z;z=_.projection.name==="globe"?n.ck(g,_):[...g],n.ae.multiply(z,z,h.matrix);let B=n.ae.multiply([],b,z);if(h.meshes)for(let G of h.meshes){if(G.material.alphaMode!=="BLEND"){R.push({mesh:G,depth:0,modelIndex:M,worldViewProjection:B,nodeModelMatrix:z});continue}let W=n.$.transformMat4([],G.centroid,B);W[2]>0&&C.push({mesh:G,depth:W[2],modelIndex:M,worldViewProjection:B,nodeModelMatrix:z})}if(h.children)for(let G of h.children)Es(_,G,g,b,M,C,R)}function u1(_,h,g,b){let M=g.shadowRenderer;if(!M)return;let C=M.getShadowPassDepthMode(),R=M.getShadowPassColorMode(),z=M.calculateShadowPassMatrixFromMatrix(h),B=i1(z);g.getOrCreateProgram("modelDepth",{defines:g._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(g,g.context.gl.TRIANGLES,C,n.ah.disabled,R,n.ag.backCCW,B,b.id,_.vertexBuffer,_.indexBuffer,_.segments,b.paint,g.transform.zoom,void 0,void 0)}function qm(_,h,g){let b=h.updateZoomBasedPaintProperties(),M=function(C,R,z){let B,G,W,Z=C.terrain?C.terrain.exaggeration():0;if(C.terrain&&Z>0){let te=C.terrain,ne=te.findDEMTileFor(z);ne&&ne.dem?B=n.cm.create(te,z,ne):Z=0}if(Z===0&&(R.terrainElevationMin=0,R.terrainElevationMax=0),Z===R.validForExaggeration&&(Z===0||B&&B._demTile&&B._demTile.tileID===R.validForDEMTile.id&&B._dem._timestamp===R.validForDEMTile.timestamp))return!1;for(let te in R.instancesPerModel){let ne=R.instancesPerModel[te];for(let ce=0;ce<ne.instancedDataArray.length;++ce){let ue=(B?Z*B.getElevationAt(0|ne.instancedDataArray.float32[16*ce],0|ne.instancedDataArray.float32[16*ce+1],!0,!0):0)+ne.instancesEvaluatedElevation[ce];ne.instancedDataArray.float32[16*ce+6]=ue,G=G?Math.min(R.terrainElevationMin,ue):ue,W=W?Math.max(R.terrainElevationMax,ue):ue}}return R.terrainElevationMin=G||0,R.terrainElevationMax=W||0,R.validForExaggeration=Z,R.validForDEMTile=B&&B._demTile?{id:B._demTile.tileID,timestamp:B._dem._timestamp}:{id:void 0,timestamp:0},!0}(_,h,g);(b||M)&&(h.uploaded=!1,h.upload(_.context))}let Tl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.b8([0,0,0],[n.a4,n.a4,0])};function Ym(_,h){let g=1<<_.canonical.z,b=h.getFreeCameraOptions().position,M=h.elevation,C=_.canonical.x/g,R=(_.canonical.x+1)/g,z=_.canonical.y/g,B=(_.canonical.y+1)/g,G=h._centerAltitude;if(M){let ne=M.getMinMaxForTile(_);ne&&ne.max>G&&(G=ne.max)}let W=n.au(b.x,C,R)-b.x,Z=n.au(b.y,z,B)-b.y,te=n.ay(G,h.center.lat)-b.z;return h._zoomFromMercatorZ(Math.sqrt(W*W+Z*Z+te*te))}function xv(_,h,g,b,M,C,R){let z=_.context,B=_.renderPass==="shadow",G=_.shadowRenderer,W=B&&G?G.getShadowPassDepthMode():new n.af(z.gl.LEQUAL,n.af.ReadWrite,_.depthRangeFor3D),Z=_.isTileAffectedByFog(C);if(g.meshes)for(let te of g.meshes){let ne=["MODEL_POSITION_ON_GPU"],ce=[],ue,de,pe;b.instancedDataArray.length>20&&ne.push("INSTANCED_ARRAYS");let Me=ba(_,h.paint.get("model-cutoff-fade-range"));if(Me.shouldRenderCutoff&&ne.push("RENDER_CUTOFF"),B&&G)ue=_.getOrCreateProgram("modelDepth",{defines:ne}),de=i1(R.shadowTileMatrix,R.shadowTileMatrix,Float32Array.from(g.matrix)),pe=G.getShadowPassColorMode();else{vd(ne,ce,te,_,h.lut),ue=_.getOrCreateProgram("model",{defines:ne,overrideFog:Z});let Se=te.material,Be=Se.pbrMetallicRoughness,Oe=h.paint.get("model-opacity"),Le=h.paint.get("model-emissive-strength").constantOr(0);de=fd(C.expandedProjMatrix,Float32Array.from(g.matrix),new Float32Array(16),null,_,Oe,Be.baseColorFactor.toRenderColor(null),Se.emissiveFactor,Be.metallicFactor,Be.roughnessFactor,Se,Le,h,M),G&&(R.shadowUniformsInitialized?ue.setShadowUniformValues(z,G.getShadowUniformValues()):(G.setupShadows(C.toUnwrapped(),ue,"model-tile",C.overscaledZ),R.shadowUniformsInitialized=!0)),pe=Me.shouldRenderCutoff||Oe<1||Se.alphaMode!=="OPAQUE"?n.a.alphaBlended:n.a.unblended}_.uploadCommonUniforms(z,ue,C.toUnwrapped(),null,Me);let Te=te.material.doubleSided?n.ag.disabled:n.ag.backCCW;if(b.instancedDataArray.length>20)ce.push(b.instancedDataBuffer),ue.draw(_,z.gl.TRIANGLES,W,n.ah.disabled,pe,Te,de,h.id,te.vertexBuffer,te.indexBuffer,te.segments,h.paint,_.transform.zoom,void 0,ce,b.instancedDataArray.length);else{let Se=B?"u_instance":"u_normal_matrix";for(let Be=0;Be<b.instancedDataArray.length;++Be)de[Se]=new Float32Array(b.instancedDataArray.arrayBuffer,64*Be,16),ue.draw(_,z.gl.TRIANGLES,W,n.ah.disabled,pe,Te,de,h.id,te.vertexBuffer,te.indexBuffer,te.segments,h.paint,_.transform.zoom,void 0,ce)}}if(g.children)for(let te of g.children)xv(_,h,te,b,M,C,R)}let bv=[1,-1,1];function ea(_,h,g,b){if(!g.modelManager)return!0;let M=g.modelManager;if(!g.shadowRenderer)return!0;let C=g.shadowRenderer,R=h.aabb,z=!0,B=_.maxHeight;if(B===0){let W=0;for(let Z in _.instancesPerModel){let te=M.getModel(Z,b);te?W=Math.max(W,Math.max(Math.max(te.aabb.max[0],te.aabb.max[1]),te.aabb.max[2])):z=!1}B=_.maxScale*W*1.41+_.maxVerticalOffset,z&&(_.maxHeight=B)}R.max[2]=B,R.min[2]+=_.terrainElevationMin,R.max[2]+=_.terrainElevationMax,n.$.transformMat4(R.min,R.min,h.tileMatrix),n.$.transformMat4(R.max,R.max,h.tileMatrix);let G=R.intersects(C.getCurrentCascadeFrustum());return g.currentShadowCascade===0&&(_.isInsideFirstShadowMapFrustum=G===2),G===0}function Ka(_,h){let g=_.uniformValues.u_cutoff_params[0],b=_.uniformValues.u_cutoff_params[1],M=_.uniformValues.u_cutoff_params[2],C=_.uniformValues.u_cutoff_params[3];return b===g||C===M?1:n.au(((h-g)/(b-g)-M)/(C-M),0,1)}function OE(_,h,g,b){if(h.pitch<20)return 1;let M=h.getWorldToCameraMatrix(),C=n.ae.multiply([],M,_),R=[...g.min,1],z=n.aB.transformMat4([],R,C),B=z,G=z;R[1]=g.max[1],z=n.aB.transformMat4([],R,C),B=z[1]<B[1]?z:B,G=z[1]>G[1]?z:G,R[0]=g.max[0],z=n.aB.transformMat4([],R,C),B=z[1]<B[1]?z:B,G=z[1]>G[1]?z:G,R[1]=g.min[1],z=n.aB.transformMat4([],R,C),B=z[1]<B[1]?z:B,G=z[1]>G[1]?z:G;let W=n.au(b[0],0,1),Z=100*h.pixelsPerMeter*n.au(b[1],0,1),te=n.au(b[2],0,1),ne=n.$.lerp([],B,G,W),ce=Math.tan(.5*h.fovX),ue=-ne[2]*ce;if(Z===0)return ne[1]<-Math.abs(ue)?te:1;let de=(-Math.abs(ue)-ne[1])/Z,pe=(Te,Se,Be)=>(1-Be)*Te+Be*Se,Me=n.au(pe(1,te,de),te,1);return pe(1,Me,n.au((h.pitch-20)/20,0,1))}class Yp{}class Vs{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(h,g,b){{let Z=this._storage.get(g.id);if(Z)return Z.lastUsedFrameIdx=h,Z.buf}let M=b.gl,C=M.getBufferParameter(M.ELEMENT_ARRAY_BUFFER,M.BUFFER_SIZE),R=new ArrayBuffer(C),z=new Int16Array(R);M.getBufferSubData(M.ELEMENT_ARRAY_BUFFER,0,new Int16Array(R));let B=new n.co;for(let Z=0;Z<C/2;Z+=3){let te=z[Z],ne=z[Z+1],ce=z[Z+2];B.emplaceBack(te,ne),B.emplaceBack(ne,ce),B.emplaceBack(ce,te)}let G=b.bindVertexArrayOES.current,W=new Yp;return W.buf=new n.I(b,B),W.lastUsedFrameIdx=h,this._storage.set(g.id,W),b.bindVertexArrayOES.set(G),W.buf}update(h){for(let[g,b]of this._storage)h-b.lastUsedFrameIdx>30&&(b.buf.destroy(),this._storage.delete(g))}destroy(){for(let[h,g]of this._storage)g.buf.destroy(),this._storage.delete(h)}}class Yl{constructor(h){this.occluderSize=30,this.depthOffset=-1e-4,h.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),h.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}let Xl={symbol:function(_,h,g,b,M){if(_.renderPass!=="translucent")return;let C=n.ah.disabled,R=_.colorModeForRenderPass();g.layout.get("text-variable-anchor")&&function(G,W,Z,te,ne,ce,ue){let de=W.transform,pe=ne==="map",Me=ce==="map";for(let Te of G){let Se=te.getTile(Te),Be=Se.getBucket(Z);if(!Be||!Be.text||!Be.text.segments.get().length)continue;let Oe=n.aE(Be.textSizeData,de.zoom),Le=r1(Te,Be.getProjection(),de),Ge=de.calculatePixelsToTileUnitsMatrix(Se),We=Am(Le,Se.tileID.canonical,Me,pe,de,Be.getProjection(),Ge),at=Be.hasIconTextFit()&&Be.hasIconData();if(Oe){let Ye=Math.pow(2,de.zoom-Se.tileID.overscaledZ);gP(Be,pe,Me,ue,n.bQ,de,We,Te,Ye,Oe,at)}}}(b,_,g,h,g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),M);let z=g.paint.get("icon-opacity").constantOr(1)!==0,B=g.paint.get("text-opacity").constantOr(1)!==0;g.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(z||B)?Vm(_,h,g,b,C,R):(z&&Vm(_,h,g,b,C,R,{onlyIcons:!0}),B&&Vm(_,h,g,b,C,R,{onlyText:!0})),h.map.showCollisionBoxes&&(CE(_,h,g,b,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),!0),CE(_,h,g,b,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),!1))},circle:function(_,h,g,b){if(_.renderPass!=="translucent")return;let M=g.paint.get("circle-opacity"),C=g.paint.get("circle-stroke-width"),R=g.paint.get("circle-stroke-opacity"),z=g.layout.get("circle-sort-key").constantOr(1)!==void 0,B=g.paint.get("circle-emissive-strength");if(M.constantOr(1)===0&&(C.constantOr(1)===0||R.constantOr(1)===0))return;let G=_.context,W=G.gl,Z=_.transform,te=_.depthModeForSublayer(0,n.af.ReadOnly),ne=n.ah.disabled,ce=_.colorModeForDrapableLayerRenderPass(B),ue=Z.projection.name==="globe",de=[n.ak(Z.center.lng),n.al(Z.center.lat)],pe=[];for(let Te=0;Te<b.length;Te++){let Se=b[Te],Be=h.getTile(Se),Oe=Be.getBucket(g);if(!Oe||Oe.projection.name!==Z.projection.name)continue;let Le=Oe.programConfigurations.get(g.id),Ge=n.bT(g),We=_.isTileAffectedByFog(Se);ue&&Ge.push("PROJECTION_GLOBE_VIEW"),Ge.push("DEPTH_D24"),_.terrain&&Z.depthOcclusionForSymbolsAndCircles&&Ge.push("DEPTH_OCCLUSION");let at=_.getOrCreateProgram("circle",{config:Le,defines:Ge,overrideFog:We}),Ye=Oe.layoutVertexBuffer,Ne=Oe.globeExtVertexBuffer,gt=Oe.indexBuffer,ft=Z.projection.createInversionMatrix(Z,Se.canonical),tt={programConfiguration:Le,program:at,layoutVertexBuffer:Ye,globeExtVertexBuffer:Ne,indexBuffer:gt,uniformValues:n.bU(_,Se,Be,ft,de,g),tile:Be};if(z){let Bt=Oe.segments.get();for(let Pt of Bt)pe.push({segments:new n.b([Pt]),sortKey:Pt.sortKey,state:tt})}else pe.push({segments:Oe.segments,sortKey:0,state:tt})}z&&pe.sort((Te,Se)=>Te.sortKey-Se.sortKey);let Me={useDepthForOcclusion:Z.depthOcclusionForSymbolsAndCircles};for(let Te of pe){let{programConfiguration:Se,program:Be,layoutVertexBuffer:Oe,globeExtVertexBuffer:Le,indexBuffer:Ge,uniformValues:We,tile:at}=Te.state,Ye=Te.segments;_.terrain&&_.terrain.setupElevationDraw(at,Be,Me),_.uploadCommonUniforms(G,Be,at.tileID.toUnwrapped()),Be.draw(_,W.TRIANGLES,te,ne,ce,n.ag.disabled,We,g.id,Oe,Ge,Ye,g.paint,Z.zoom,Se,[Le])}},heatmap:function(_,h,g,b){if(g.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){let M=_.context,C=M.gl,R=n.ah.disabled,z=new n.a([C.ONE,C.ONE,C.ONE,C.ONE],n.C.transparent,[!0,!0,!0,!0]);(function(ne,ce,ue,de){let pe=ne.gl,Me=ce.width*de,Te=ce.height*de;ne.activeTexture.set(pe.TEXTURE1),ne.viewport.set([0,0,Me,Te]);let Se=ue.heatmapFbo;if(!Se||Se&&(Se.width!==Me||Se.height!==Te)){Se&&Se.destroy();let Be=pe.createTexture();pe.bindTexture(pe.TEXTURE_2D,Be),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_WRAP_S,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_WRAP_T,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_MIN_FILTER,pe.LINEAR),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_MAG_FILTER,pe.LINEAR),Se=ue.heatmapFbo=ne.createFramebuffer(Me,Te,!0,null),function(Oe,Le,Ge,We,at,Ye){let Ne=Oe.gl;Ne.texImage2D(Ne.TEXTURE_2D,0,Oe.extRenderToTextureHalfFloat?Ne.RGBA16F:Ne.RGBA,at,Ye,0,Ne.RGBA,Oe.extRenderToTextureHalfFloat?Ne.HALF_FLOAT:Ne.UNSIGNED_BYTE,null),We.colorAttachment.set(Ge)}(ne,0,Be,Se,Me,Te)}else pe.bindTexture(pe.TEXTURE_2D,Se.colorAttachment.get()),ne.bindFramebuffer.set(Se.framebuffer)})(M,_,g,_.transform.projection.name==="globe"?.5:.25),M.clear({color:n.C.transparent});let B=_.transform,G=B.projection.name==="globe",W=G?["PROJECTION_GLOBE_VIEW"]:[],Z=G?n.ag.frontCCW:n.ag.disabled,te=[n.ak(B.center.lng),n.al(B.center.lat)];for(let ne=0;ne<b.length;ne++){let ce=b[ne];if(h.hasRenderableParent(ce))continue;let ue=h.getTile(ce),de=ue.getBucket(g);if(!de||de.projection.name!==B.projection.name)continue;let pe=_.isTileAffectedByFog(ce),Me=de.programConfigurations.get(g.id),Te=_.getOrCreateProgram("heatmap",{config:Me,defines:W,overrideFog:pe}),{zoom:Se}=_.transform;_.terrain&&_.terrain.setupElevationDraw(ue,Te),_.uploadCommonUniforms(M,Te,ce.toUnwrapped());let Be=B.projection.createInversionMatrix(B,ce.canonical);Te.draw(_,C.TRIANGLES,n.af.disabled,R,z,Z,EE(_,ce,ue,Be,te,Se,g.paint.get("heatmap-intensity")),g.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,g.paint,_.transform.zoom,Me,G?[de.globeExtVertexBuffer]:null)}M.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(M,C){let R=M.context,z=R.gl,B=C.heatmapFbo;if(!B)return;R.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,B.colorAttachment.get()),R.activeTexture.set(z.TEXTURE1);let G=C.colorRampTexture;G||(G=C.colorRampTexture=new n.T(R,C.colorRamp,z.RGBA)),G.bind(z.LINEAR,z.CLAMP_TO_EDGE),M.getOrCreateProgram("heatmapTexture").draw(M,z.TRIANGLES,n.af.disabled,n.ah.disabled,M.colorModeForRenderPass(),n.ag.disabled,((W,Z,te,ne)=>({u_image:0,u_color_ramp:1,u_opacity:Z.paint.get("heatmap-opacity")}))(0,C),C.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,C.paint,M.transform.zoom)}(_,g))},line:function(_,h,g,b){if(_.renderPass!=="translucent")return;let M=g.paint.get("line-opacity"),C=g.paint.get("line-width");if(M.constantOr(1)===0||C.constantOr(1)===0)return;let R=g.paint.get("line-emissive-strength"),z=g.paint.get("line-occlusion-opacity"),B=_.context,G=B.gl,W=g.layout.get("line-z-offset"),Z=!W.isConstant()||!!W.constantOr(0),te=Z?new n.af(_.depthOcclusion?G.GREATER:G.LEQUAL,n.af.ReadOnly,_.depthRangeFor3D):_.depthModeForSublayer(0,n.af.ReadOnly),ne=_.colorModeForDrapableLayerRenderPass(R),ce=_.terrain&&_.terrain.renderingToTexture,ue=ce?1:n.e.devicePixelRatio,de=g.paint.get("line-dasharray"),pe=de.constantOr(1),Me=g.layout.get("line-cap"),Te=de.constantOr(null),Se=Me.constantOr(null),Be=g.paint.get("line-pattern"),Oe=Be.constantOr(1),Le=Be.constantOr(null),Ge=g.paint.get("line-opacity").constantOr(1),We=!Oe&&Ge!==1||_.depthOcclusion&&z>0&&z<1,at=g.paint.get("line-gradient"),Ye=Oe?"linePattern":"line",Ne=n.bV(g),gt;if(ce&&_.terrain&&_.terrain.clipOrMaskOverlapStencilType()&&(We=!1),z!==0&&_.depthOcclusion){let tt=g.paint._values["line-opacity"];tt&&tt.value&&tt.value.kind==="constant"?gt=tt.value:n.w(`Occlusion opacity for layer ${g.id} is supported only when line-opacity isn't data-driven.`)}if(Z&&(_.forceTerrainMode=!0),!Z&&z!==0&&_.terrain&&!ce)return void n.w(`Occlusion opacity for layer ${g.id} is supported on terrain only if the layer has non-zero line-z-offset.`);let ft=We&&Z?_.stencilModeFor3D():n.ah.disabled;for(let tt of b){let Bt=h.getTile(tt);if(Oe&&!Bt.patternsLoaded())continue;let Pt=Bt.getBucket(g);if(!Pt)continue;_.prepareDrawTile();let ct=Pt.programConfigurations.get(g.id),_t=_.isTileAffectedByFog(tt),Qe=_.getOrCreateProgram(Ye,{config:ct,defines:Z?[...Ne,"ELEVATED"]:Ne,overrideFog:_t});if(Le&&Bt.imageAtlas){let hi=Bt.imageAtlas.patternPositions[Le.toString()];hi&&ct.setConstantPatternPositions(hi)}if(!Oe&&Te&&Se&&Bt.lineAtlas){let hi=Bt.lineAtlas.getDash(Te,Se);hi&&ct.setConstantPatternPositions(hi)}let[Rt,Ft]=g.paint.get("line-trim-offset");(Se==="round"||Se==="square")&&Rt!==Ft&&(Rt===0&&(Rt-=1),Ft===1&&(Ft+=1));let oi=ce?tt.projMatrix:null,ci=Oe?n.bW(_,Bt,g,oi,ue,[Rt,Ft]):n.bX(_,Bt,g,oi,Pt.lineClipsArray.length,ue,[Rt,Ft]);if(at){let hi=Pt.gradients[g.id],ji=hi.texture;if(g.gradientVersion!==hi.version){let cr=256;if(g.stepInterpolant){let Wi=h.getSource().maxzoom,gr=tt.canonical.z===Wi?Math.ceil(1<<_.transform.maxZoom-tt.canonical.z):1;cr=n.au(n.bY(Pt.maxLineLength/n.a4*1024*gr),256,B.maxTextureSize)}hi.gradient=n.bZ({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:cr,image:hi.gradient||void 0,clips:Pt.lineClipsArray}),hi.texture?hi.texture.update(hi.gradient):hi.texture=new n.T(B,hi.gradient,G.RGBA),hi.version=g.gradientVersion,ji=hi.texture}B.activeTexture.set(G.TEXTURE1),ji.bind(g.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}pe&&(B.activeTexture.set(G.TEXTURE0),Bt.lineAtlasTexture&&Bt.lineAtlasTexture.bind(G.LINEAR,G.REPEAT),ct.updatePaintBuffers()),Oe&&(B.activeTexture.set(G.TEXTURE0),Bt.imageAtlasTexture&&Bt.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),ct.updatePaintBuffers()),Z&&_.terrain.setupElevationDraw(Bt,Qe),_.uploadCommonUniforms(B,Qe,tt.toUnwrapped());let Si=hi=>{gt!=null&&(gt.value=Ge*z),Qe.draw(_,G.TRIANGLES,te,hi,ne,n.ag.disabled,ci,g.id,Pt.layoutVertexBuffer,Pt.indexBuffer,Pt.segments,g.paint,_.transform.zoom,ct,[Pt.layoutVertexBuffer2,Pt.patternVertexBuffer,Pt.zOffsetVertexBuffer]),gt!=null&&(gt.value=Ge)};if(We&&!Z){let hi=_.stencilModeForClipping(tt).ref;hi===0&&ce&&B.clear({stencil:0});let ji={func:G.EQUAL,mask:255};ci.u_alpha_discard_threshold=.8,Si(new n.ah(ji,hi,255,G.KEEP,G.KEEP,G.INVERT)),ci.u_alpha_discard_threshold=0,Si(new n.ah(ji,hi,255,G.KEEP,G.KEEP,G.KEEP))}else We&&Z&&(ci.u_alpha_discard_threshold=.001),Si(Z?ft:_.stencilModeForClipping(tt))}We&&(_.resetStencilClippingMasks(),ce&&B.clear({stencil:0})),z===0||_.depthOcclusion||ce||_.layersWithOcclusionOpacity.push(_.currentLayer),Z&&(_.forceTerrainMode=!1)},fill:function(_,h,g,b){let M=g.paint.get("fill-color"),C=g.paint.get("fill-opacity");if(C.constantOr(1)===0)return;let R=g.paint.get("fill-emissive-strength"),z=_.colorModeForDrapableLayerRenderPass(R),B=g.paint.get("fill-pattern"),G=_.opaquePassEnabledForLayer()&&!B.constantOr(1)&&M.constantOr(n.C.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===G){let W=_.depthModeForSublayer(1,_.renderPass==="opaque"?n.af.ReadWrite:n.af.ReadOnly);Gm(_,h,g,b,W,z,!1)}if(_.renderPass==="translucent"&&g.paint.get("fill-antialias")){let W=_.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,n.af.ReadOnly);Gm(_,h,g,b,W,z,!0)}},"fill-extrusion":function(_,h,g,b){let M=g.paint.get("fill-extrusion-opacity"),C=_.context,R=C.gl,z=_.terrain,B=z&&z.renderingToTexture;if(M===0)return;let G=_.conflationActive&&_.style.isLayerClipped(g,h.getSource()),W=_.style.order.indexOf(g.fqid);if(G&&function(Z,te,ne,ce,ue){for(let de of ce){let pe=te.getTile(de).getBucket(ne);pe&&(pe.updateReplacement(de,Z.replacementSource,ue),pe.uploadCentroid(Z.context))}}(_,h,g,b,W),z||G)for(let Z of b){let te=h.getTile(Z).getBucket(g);te&&yP(_.context,h,Z,te,g,z,G)}if(_.renderPass==="shadow"&&_.shadowRenderer){let Z=_.shadowRenderer;if(z&&M<.65&&g._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.Z)return;let te=Z.getShadowPassDepthMode(),ne=Z.getShadowPassColorMode();gd(_,h,g,b,te,n.ah.disabled,ne,G)}else if(_.renderPass==="translucent"){let Z=!g.paint.get("fill-extrusion-pattern").constantOr(1),te=g.paint.get("fill-extrusion-color").constantOr(n.C.white);if(!B&&te.a!==0){let ne=new n.af(_.context.gl.LEQUAL,n.af.ReadWrite,_.depthRangeFor3D);M===1&&Z?gd(_,h,g,b,ne,n.ah.disabled,n.a.unblended,G):(gd(_,h,g,b,ne,n.ah.disabled,n.a.disabled,G),gd(_,h,g,b,ne,_.stencilModeFor3D(),_.colorModeForRenderPass(),G),_.resetStencilClippingMasks())}if(_.style.enable3dLights()&&Z&&(!z&&_.transform.projection.name!=="globe"||B)){let ne=g.paint.get("fill-extrusion-opacity"),ce=g.paint.get("fill-extrusion-ambient-occlusion-intensity"),ue=g.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),de=g.paint.get("fill-extrusion-flood-light-intensity"),pe=g.paint.get("fill-extrusion-flood-light-color").toRenderColor(g.lut).toArray01().slice(0,3),Me=ce>0&&ue>0,Te=de>0,Se=(Oe,Le,Ge)=>(1-Ge)*Oe+Ge*Le,Be=Oe=>{let Le=_.depthModeForSublayer(1,n.af.ReadOnly,R.LEQUAL,!0),Ge=g.paint.get(Oe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),We=Se(.1,3,Ge),at=_._showOverdrawInspector;if(!at){let Ye=new n.ah({func:R.ALWAYS,mask:255},255,255,R.KEEP,R.KEEP,R.REPLACE),Ne=new n.a([R.ONE,R.ONE,R.ONE,R.ONE],n.C.transparent,[!1,!1,!1,!0],R.MIN);Gp(_,h,g,b,Le,Ye,Ne,n.ag.disabled,Oe,"sdf",ne,ce,ue,de,pe,We,G,!1)}{let Ye=at?n.ah.disabled:new n.ah({func:R.EQUAL,mask:255},255,255,R.KEEP,R.DECR,R.DECR),Ne=at?_.colorModeForRenderPass():new n.a([R.ONE_MINUS_DST_ALPHA,R.DST_ALPHA,R.ONE,R.ONE],n.C.transparent,[!0,!0,!0,!0]);Gp(_,h,g,b,Le,Ye,Ne,n.ag.disabled,Oe,"color",ne,ce,ue,de,pe,We,G,!1)}};if(B){let Oe=(Le,Ge,We)=>{let at=_.depthModeForSublayer(1,n.af.ReadOnly,R.LEQUAL,!1),Ye=g.paint.get(Le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ne=Se(.1,3,Ye);{let gt=new n.a([R.ONE,R.ONE,R.ONE,R.ONE],n.C.transparent,[!1,!1,!1,!0]);Gp(_,h,g,b,at,n.ah.disabled,gt,n.ag.disabled,Le,"clear",ne,ce,ue,de,pe,Ne,G,Ge)}{let gt=new n.ah({func:R.ALWAYS,mask:255},255,255,R.KEEP,R.KEEP,R.REPLACE),ft=new n.a([R.ONE,R.ONE,R.ONE,R.ONE],n.C.transparent,[!1,!1,!1,!0],R.MIN);Gp(_,h,g,b,at,gt,ft,n.ag.disabled,Le,"sdf",ne,ce,ue,de,pe,Ne,G,Ge)}{let gt=Le?R.ZERO:R.ONE_MINUS_DST_ALPHA,ft=new n.ah({func:R.EQUAL,mask:255},255,255,R.KEEP,R.DECR,R.DECR),tt=new n.a([gt,R.DST_ALPHA,R.ONE_MINUS_DST_ALPHA,R.ZERO],n.C.transparent,[!0,!0,!0,!0]);Gp(_,h,g,b,at,ft,tt,n.ag.disabled,Le,"color",ne,ce,ue,de,pe,Ne,G,Ge)}{let gt=new n.a([R.ONE,R.ONE,R.ONE,Le?R.ZERO:R.ONE],n.C.transparent,[!1,!1,!1,!0],Le?R.FUNC_ADD:R.MAX);Gp(_,h,g,b,at,n.ah.disabled,gt,n.ag.disabled,Le,"clear",ne,ce,ue,de,pe,Ne,G,Ge,We)}};if(Me||Te){let Le;if(_.prepareDrawTile(),z){let Ge=z.drapeBufferSize[0],We=z.drapeBufferSize[1];Le=z.framebufferCopyTexture,Le&&(!Le||Le.size[0]===Ge&&Le.size[1]===We)||(Le&&Le.destroy(),Le=z.framebufferCopyTexture=new n.T(C,new n.j({width:Ge,height:We}),R.RGBA)),Le.bind(R.LINEAR,R.CLAMP_TO_EDGE),R.copyTexImage2D(R.TEXTURE_2D,0,R.RGBA,0,0,Ge,We,0)}Me&&Oe(!0,!1,Le),Te&&Oe(!1,!0,Le)}}else Me&&Be(!0),Te&&Be(!1),(Me||Te)&&_.resetStencilClippingMasks()}}},hillshade:function(_,h,g,b){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent"||_.style.disableElevatedTerrain)return;let M=_.context,C=_.terrain&&_.terrain.renderingToTexture,[R,z]=_.renderPass!=="translucent"||C?[{},b]:_.stencilConfigForOverlap(b);for(let B of z){let G=h.getTile(B);if(G.needsHillshadePrepare&&_.renderPass==="offscreen")dP(_,G,g);else if(_.renderPass==="translucent"){let W=_.depthModeForSublayer(0,n.af.ReadOnly),Z=g.paint.get("hillshade-emissive-strength"),te=_.colorModeForDrapableLayerRenderPass(Z),ne=C&&_.terrain?_.terrain.stencilModeForRTTOverlap(B):R[B.overscaledZ];hP(_,B,G,g,W,ne,te)}}M.viewport.set([0,0,_.width,_.height]),_.resetStencilClippingMasks()},raster:function(_,h,g,b,M,C){if(_.renderPass!=="translucent"||g.paint.get("raster-opacity")===0)return;let R=_.transform.projection.name==="globe",z=g.paint.get("raster-elevation")!==0,B=z&&R;if(_.renderElevatedRasterBackface&&!B)return;let G=_.context,W=G.gl,Z=h.getSource(),te=function(Oe,Le,Ge,We){let at=Le.paint.get("raster-color"),Ye=Oe.type==="raster-array",Ne=[],gt=Le.paint.get("raster-resampling"),ft=Le.paint.get("raster-color-mix"),tt=Le.paint.get("raster-color-range"),Bt=[ft[0],ft[1],ft[2],0],Pt=ft[3],ct=gt==="nearest"?We.NEAREST:We.LINEAR;if(Ye&&(Ne.push("RASTER_ARRAY"),at||Ne.push("RASTER_COLOR"),gt==="linear"&&Ne.push("RASTER_ARRAY_LINEAR"),ct=We.NEAREST,!tt&&Oe.rasterLayers)){let _t=Oe.rasterLayers.find(({id:Qe})=>Qe===Le.sourceLayer);_t&&_t.fields&&_t.fields.range&&(tt=_t.fields.range)}if(tt=tt||[0,1],at){Ne.push("RASTER_COLOR"),Ge.activeTexture.set(We.TEXTURE2),Le.updateColorRamp(tt);let _t=Le.colorRampTexture;_t||(_t=Le.colorRampTexture=new n.T(Ge,Le.colorRamp,We.RGBA)),_t.bind(We.LINEAR,We.CLAMP_TO_EDGE)}return{mix:Bt,range:tt,offset:Pt,defines:Ne,resampling:ct}}(Z,g,G,W);if(Z instanceof n.bo&&!b.length&&!R)return;let ne=g.paint.get("raster-emissive-strength"),ce=_.colorModeForDrapableLayerRenderPass(ne),ue=_.terrain&&_.terrain.renderingToTexture,de=!_.options.moving,pe=g.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR;if(Z instanceof n.bo&&!b.length&&(Z.onNorthPole||Z.onSouthPole)){let Oe=z?_.stencilModeFor3D():n.ah.disabled;return void gv(!!Z.onNorthPole,null,_,h,g,ne,te,n.ag.disabled,Oe)}if(!b.length)return;let[Me,Te]=Z instanceof n.bo||ue?[{},b]:_.stencilConfigForOverlap(b),Se=Te[Te.length-1].overscaledZ;B&&te.defines.push("PROJECTION_GLOBE_VIEW"),z&&te.defines.push("RENDER_CUTOFF");let Be=(Oe,Le,Ge)=>{for(let We of Oe){let at=We.toUnwrapped(),Ye=h.getTile(We);if(ue&&(!Ye||!Ye.hasData()))continue;G.activeTexture.set(W.TEXTURE0);let Ne=yd(Ye,Z,g,te);if(!Ne||!Ne.texture)continue;let{texture:gt,mix:ft,offset:tt,tileSize:Bt,buffer:Pt}=Ne,ct,_t;ue?(ct=n.af.disabled,_t=We.projMatrix):z?(ct=new n.af(W.LEQUAL,n.af.ReadWrite,_.depthRangeFor3D),_t=R?Float32Array.from(_.transform.expandedFarZProjMatrix):_.transform.calculateProjMatrix(at,de)):(ct=_.depthModeForSublayer(We.overscaledZ-Se,g.paint.get("raster-opacity")===1?n.af.ReadWrite:n.af.ReadOnly,W.LESS),_t=_.transform.calculateProjMatrix(at,de));let Qe=_.terrain&&ue?_.terrain.stencilModeForRTTOverlap(We):Me[We.overscaledZ],Rt=C?0:g.paint.get("raster-fade-duration");Ye.registerFadeDuration(Rt);let Ft=h.findLoadedParent(We,0),oi=av(Ye,Ft,h,_.transform,Rt),ci,Si;_.terrain&&_.terrain.prepareDrawTile(),G.activeTexture.set(W.TEXTURE0),gt.bind(pe,W.CLAMP_TO_EDGE),G.activeTexture.set(W.TEXTURE1),Ft?(Ft.texture&&Ft.texture.bind(pe,W.CLAMP_TO_EDGE),ci=Math.pow(2,Ft.tileID.overscaledZ-Ye.tileID.overscaledZ),Si=[Ye.tileID.canonical.x*ci%1,Ye.tileID.canonical.y*ci%1]):gt.bind(pe,W.CLAMP_TO_EDGE),gt.useMipmap&&G.extTextureFilterAnisotropic&&_.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);let hi=_.transform,ji,cr=z?s1(hi):[0,0,0,0],Wi,gr,Or,zn,xn,Ur=0;if(B&&Z instanceof n.bo&&Z.coordinates.length>3)Wi=Float32Array.from(n.bh(n.bi(new n.aO(0,0,0)))),gr=Float32Array.from(hi.globeMatrix),Or=Float32Array.from(n.bd(hi)),zn=[n.ak(hi.center.lng),n.al(hi.center.lat)],ji=Z.elevatedGlobePerspectiveTransform,xn=Z.elevatedGlobeGridMatrix||new Float32Array(9);else if(B){let ur=n.be(We.canonical);Ur=n.bf(ur.getCenter().lat),Wi=Float32Array.from(n.bh(n.bi(We.canonical))),gr=Float32Array.from(hi.globeMatrix),Or=Float32Array.from(n.bd(hi)),zn=[n.ak(hi.center.lng),n.al(hi.center.lat)],ji=[0,0],xn=Float32Array.from(n.bg(We.canonical,ur,Ur,hi.worldSize/hi._pixelsPerMercatorPixel))}else ji=Z instanceof n.bo?Z.perspectiveTransform:[0,0],Wi=new Float32Array(16),gr=new Float32Array(9),Or=new Float32Array(16),zn=[0,0],xn=new Float32Array(9);let yn=fv(_t,Wi,gr,Or,xn,Si||[0,0],n.a2(_.transform.zoom),zn,cr,ci||1,oi,g,ji,z?g.paint.get("raster-elevation"):0,2,ft,tt,te.range,Bt,Pt,ne),_r=_.isTileAffectedByFog(We),br=_.getOrCreateProgram("raster",{defines:te.defines,overrideFog:_r});if(_.uploadCommonUniforms(G,br,at),Z instanceof n.bo){let ur=Z.elevatedGlobeVertexBuffer,Xr=Z.elevatedGlobeIndexBuffer;if(ue||!R)Z.boundsBuffer&&Z.boundsSegments&&br.draw(_,W.TRIANGLES,ct,n.ah.disabled,ce,n.ag.disabled,yn,g.id,Z.boundsBuffer,_.quadTriangleIndexBuffer,Z.boundsSegments);else if(ur&&Xr){let Ar=hi.zoom<=n.b3?Z.elevatedGlobeSegments:Z.getSegmentsForLongitude(hi.center.lng);Ar&&br.draw(_,W.TRIANGLES,ct,n.ah.disabled,ce,Le,yn,g.id,ur,Xr,Ar)}}else if(B){ct=new n.af(W.LEQUAL,n.af.ReadOnly,_.depthRangeFor3D);let ur=_.globeSharedBuffers;if(ur){let[Xr,Ar,er]=ur.getGridBuffers(Ur,!1);br.draw(_,W.TRIANGLES,ct,Ge||Qe,_.colorModeForRenderPass(),Le,yn,g.id,Xr,Ar,er)}}else{let{tileBoundsBuffer:ur,tileBoundsIndexBuffer:Xr,tileBoundsSegments:Ar}=_.getTileBoundsBuffers(Ye);br.draw(_,W.TRIANGLES,ct,Qe,ce,n.ag.disabled,yn,g.id,ur,Xr,Ar)}}if(!(Z instanceof n.bo)&&B)for(let We of Oe){let at=We.canonical.y===(1<<We.canonical.z)-1;We.canonical.y===0&&gv(!0,We,_,h,g,ne,te,Le,Ge||n.ah.disabled),at&&gv(!1,We,_,h,g,ne,te,Le===n.ag.frontCW?n.ag.backCW:n.ag.frontCW,Ge||n.ah.disabled)}};B?Be(Te,_.renderElevatedRasterBackface?n.ag.backCW:n.ag.frontCW,_.stencilModeFor3D()):Be(Te,n.ag.disabled,void 0),_.resetStencilClippingMasks()},"raster-particle":function(_,h,g,b,M,C){_.renderPass==="offscreen"&&function(R,z,B,G){if(!G.length)return;let W=R.context,Z=W.gl,te=z.getSource();if(!(te instanceof oh))return;let ne=Math.ceil(Math.sqrt(B.paint.get("raster-particle-count"))),ce=B.particlePositionRGBAImage;if(!ce||ce.width!==ne){let Te=function(Se){let Be=Se*Se,Oe=new Uint8Array(4*Be),Le=function(We){return We|=0,We=Math.imul(2747636419^We,2654435769),We=Math.imul(We^We>>>16,2654435769),((We=Math.imul(We^We>>>16,2654435769))>>>0)/4294967296},Ge=1/1.1;for(let We=0;We<Be;We++){let at=Ge*(Le(2*We+0)+Sc),Ye=Ge*(Le(2*We+1)+Sc),Ne=255*at%1,gt=255*Ye%1,ft=Ne,tt=Ye-gt/255,Bt=gt;Oe[4*We+0]=255*(at-Ne/255),Oe[4*We+1]=255*ft,Oe[4*We+2]=255*tt,Oe[4*We+3]=255*Bt}return Oe}(ne);ce=B.particlePositionRGBAImage=new n.j({width:ne,height:ne},Te)}let ue=B.particleFramebuffer;ue?ue.width!==ne&&(ue.destroy(),ue=B.particleFramebuffer=W.createFramebuffer(ne,ne,!0,null)):ue=B.particleFramebuffer=W.createFramebuffer(ne,ne,!0,null);let de=[];for(let Te of G){let Se=z.getTile(Te);if(!(Se instanceof n.c5))continue;let Be=RE(Se,te,B);if(!Be)continue;let Oe=[Se.tileSize,Se.tileSize],Le=B.tileFramebuffer;Le||(Le=B.tileFramebuffer=W.createFramebuffer(Oe[0],Oe[1],!0,null));let Ge=Se.rasterParticleState;Ge||(Ge=Se.rasterParticleState=new Xi(W,Te,Oe,ce));let We=Ge.update(B.lastInvalidatedAt);Ge.particleTextureDimension!==ne&&Ge.updateParticleTexture(Te,ce);let at=Ge.targetColorTexture;Ge.targetColorTexture=Ge.backgroundColorTexture,Ge.backgroundColorTexture=at;let Ye=Ge.particleTexture0;Ge.particleTexture0=Ge.particleTexture1,Ge.particleTexture1=Ye,de.push([Te,Be,Ge,We])}if(de.length===0)return;let pe=n.e.now(),Me=B.previousDrawTimestamp?.001*(pe-B.previousDrawTimestamp):.0167;if(B.previousDrawTimestamp=pe,B.hasColorMap()){W.activeTexture.set(Z.TEXTURE0+2);let Te=B.colorRampTexture;Te||(Te=B.colorRampTexture=new n.T(W,B.colorRamp,Z.RGBA)),Te.bind(Z.LINEAR,Z.CLAMP_TO_EDGE)}W.bindFramebuffer.set(B.tileFramebuffer.framebuffer),function(Te,Se,Be){let Oe=Te.context,Le=Oe.gl,Ge=Se.tileFramebuffer;Oe.activeTexture.set(Le.TEXTURE0);let We={u_texture:0,u_opacity:1.05*(Ye=Se.paint.get("raster-particle-fade-opacity-factor"))/(Ye+.05)},at=Te.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ye;for(let Ne of Be){let[,,gt,ft]=Ne;Ge.colorAttachment.set(gt.targetColorTexture.texture),Oe.viewport.set([0,0,Ge.width,Ge.height]),Oe.clear({color:n.C.transparent}),ft&&(gt.backgroundColorTexture.bind(Le.NEAREST,Le.CLAMP_TO_EDGE),at.draw(Te,Le.TRIANGLES,n.af.disabled,n.ah.disabled,n.a.alphaBlended,n.ag.disabled,We,Se.id,Te.viewportBuffer,Te.quadTriangleIndexBuffer,Te.viewportSegments))}}(R,B,de),function(Te,Se,Be,Oe){let Le=Te.context,Ge=Le.gl,We=Be.tileFramebuffer,at=Te.transform.projection.name==="globe",Ye=Be.paint.get("raster-particle-max-speed");for(let Ne of Oe){let[gt,ft,tt]=Ne;Le.activeTexture.set(Ge.TEXTURE0+0),ft.texture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE),We.colorAttachment.set(tt.targetColorTexture.texture);let Bt=Te.getOrCreateProgram("rasterParticleDraw",{defines:ft.defines,overrideFog:!1});Le.activeTexture.set(Ge.TEXTURE0+1);let Pt=ft.scalarData?[]:[0,1,2,3].map(Qe=>n.b$[Qe](gt));Pt.push(gt);let ct=gt.canonical.x,_t=gt.canonical.y;for(let Qe of Pt){let Rt=Se.getTile(at?Qe.wrapped():Qe);if(!Rt)continue;let Ft=Rt.rasterParticleState;if(!Ft)continue;let oi=Qe.canonical.x+(1<<Qe.canonical.z)*(Qe.wrap-gt.wrap),ci=Qe.canonical.y;Ft.particleTexture0.bind(Ge.NEAREST,Ge.CLAMP_TO_EDGE);let Si=fP(1,Ft.particleTexture0.size[0],[oi-ct,ci-_t],0,ft.texture.size,2,Ye,ft.textureOffset,ft.scale,ft.offset);Bt.draw(Te,Ge.POINTS,n.af.disabled,n.ah.disabled,n.a.alphaBlended,n.ag.disabled,Si,Be.id,Ft.particleIndexBuffer,void 0,Ft.particleSegment)}}}(R,z,B,de),W.bindFramebuffer.set(B.particleFramebuffer.framebuffer),function(Te,Se,Be,Oe){let Le=Te.context,Ge=Le.gl,We=Se.paint.get("raster-particle-max-speed"),at=Oe*Se.paint.get("raster-particle-speed-factor")*.15,Ye=function(gt){return Math.pow(gt,6)}(.01+1*Se.paint.get("raster-particle-reset-rate-factor")),Ne=Se.particleFramebuffer;Le.viewport.set([0,0,Ne.width,Ne.height]);for(let gt of Be){let[,ft,tt]=gt;Le.activeTexture.set(Ge.TEXTURE0+0),ft.texture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE),Le.activeTexture.set(Ge.TEXTURE0+1);let Bt=tt.particleTexture0;Bt.bind(Ge.NEAREST,Ge.CLAMP_TO_EDGE);let Pt=ME(1,Bt.size[0],0,ft.texture.size,We,at,Ye,ft.textureOffset,ft.scale,ft.offset);Ne.colorAttachment.set(tt.particleTexture1.texture),Le.clear({color:n.C.transparent}),Te.getOrCreateProgram("rasterParticleUpdate",{defines:ft.defines}).draw(Te,Ge.TRIANGLES,n.af.disabled,n.ah.disabled,n.a.unblended,n.ag.disabled,Pt,Se.id,Te.viewportBuffer,Te.quadTriangleIndexBuffer,Te.viewportSegments)}}(R,B,de,Me)}(_,h,g,b),_.renderPass==="translucent"&&(function(R,z,B,G,W){let Z=R.context,te=Z.gl,ne=z.getSource().tileSize,ce=5*(1-n.a0(n.aV,n.aV+1,R.transform.zoom))*ne+B.paint.get("raster-particle-elevation"),ue=!R.options.moving,de=R.transform.projection.name==="globe";if(!G.length)return;let[pe,Me]=R.stencilConfigForOverlap(G),Te=[];de&&Te.push("PROJECTION_GLOBE_VIEW");let Se=R.stencilModeFor3D();for(let Be of Me){let Oe=Be.toUnwrapped(),Le=z.getTile(Be);if(!Le.rasterParticleState)continue;let Ge=Le.rasterParticleState,We=100;Le.registerFadeDuration(We);let at=z.findLoadedParent(Be,0),Ye=av(Le,at,z,R.transform,We),Ne,gt;R.terrain&&R.terrain.prepareDrawTile(),Z.activeTexture.set(te.TEXTURE0),Ge.targetColorTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),Z.activeTexture.set(te.TEXTURE1),at&&at.rasterParticleState?(at.rasterParticleState.targetColorTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),Ne=Math.pow(2,at.tileID.overscaledZ-Le.tileID.overscaledZ),gt=[Le.tileID.canonical.x*Ne%1,Le.tileID.canonical.y*Ne%1]):Ge.targetColorTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE);let ft=de?Float32Array.from(R.transform.expandedFarZProjMatrix):R.transform.calculateProjMatrix(Oe,ue),tt=R.transform,Bt=yv(tt),Pt=n.be(Be.canonical),ct=n.bf(Pt.getCenter().lat),_t,Qe,Rt,Ft,oi;de?(_t=Float32Array.from(n.bh(n.bi(Be.canonical))),Qe=Float32Array.from(tt.globeMatrix),Rt=Float32Array.from(n.bd(tt)),Ft=[n.ak(tt.center.lng),n.al(tt.center.lat)],oi=Float32Array.from(n.bg(Be.canonical,Pt,ct,tt.worldSize/tt._pixelsPerMercatorPixel))):(_t=new Float32Array(16),Qe=new Float32Array(9),Rt=new Float32Array(16),Ft=[0,0],oi=new Float32Array(9));let ci=pd(ft,_t,Qe,Rt,oi,gt||[0,0],n.a2(R.transform.zoom),Ft,Bt,Ne||1,Ye,ce),Si=R.isTileAffectedByFog(Be),hi=R.getOrCreateProgram("rasterParticle",{defines:Te,overrideFog:Si});if(R.uploadCommonUniforms(Z,hi,Oe),de){let ji=new n.af(te.LEQUAL,n.af.ReadOnly,R.depthRangeFor3D),cr=0,Wi=R.globeSharedBuffers;if(Wi){let[gr,Or,zn]=Wi.getGridBuffers(ct,cr!==0);hi.draw(R,te.TRIANGLES,ji,Se,n.a.alphaBlended,R.renderElevatedRasterBackface?n.ag.frontCCW:n.ag.backCCW,ci,B.id,gr,Or,zn)}}else{let ji=R.depthModeForSublayer(0,n.af.ReadOnly),cr=pe[Be.overscaledZ],{tileBoundsBuffer:Wi,tileBoundsIndexBuffer:gr,tileBoundsSegments:Or}=R.getTileBoundsBuffers(Le);hi.draw(R,te.TRIANGLES,ji,cr,n.a.alphaBlended,n.ag.disabled,ci,B.id,Wi,gr,Or)}}R.resetStencilClippingMasks()}(_,h,g,b),_.style.map.triggerRepaint())},background:function(_,h,g,b){let M=g.paint.get("background-color"),C=g.paint.get("background-opacity"),R=g.paint.get("background-emissive-strength");if(C===0)return;let z=_.context,B=z.gl,G=_.transform,W=G.tileSize,Z=g.paint.get("background-pattern"),te;if(Z!==void 0&&(Z===null||(te=_.imageManager.getPattern(Z.toString(),g.scope,_.style.getLut(g.scope)),!te)))return;let ne=!Z&&M.a===1&&C===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==ne)return;let ce=n.ah.disabled,ue=_.depthModeForSublayer(0,ne==="opaque"?n.af.ReadWrite:n.af.ReadOnly),de=_.colorModeForDrapableLayerRenderPass(R),pe=Z?"backgroundPattern":"background",Me,Te=b;Te||(Me=_.getBackgroundTiles(),Te=Object.values(Me).map(Se=>Se.tileID)),Z&&(z.activeTexture.set(B.TEXTURE0),_.imageManager.bind(_.context,g.scope));for(let Se of Te){let Be=_.isTileAffectedByFog(Se),Oe=_.getOrCreateProgram(pe,{overrideFog:Be}),Le=Se.toUnwrapped(),Ge=b?Se.projMatrix:_.transform.calculateProjMatrix(Le);_.prepareDrawTile();let We=h?h.getTile(Se):Me?Me[Se.key]:new n.bA(Se,W,G.zoom,_),at=Z?mP(Ge,R,C,_,0,g.scope,te,{tileID:Se,tileSize:W}):t1(Ge,R,C,M.toRenderColor(g.lut));_.uploadCommonUniforms(z,Oe,Le);let{tileBoundsBuffer:Ye,tileBoundsIndexBuffer:Ne,tileBoundsSegments:gt}=_.getTileBoundsBuffers(We);Oe.draw(_,B.TRIANGLES,ue,ce,de,n.ag.disabled,at,g.id,Ye,Ne,gt)}},sky:function(_,h,g){let b=_._atmosphere?n.a2(_.transform.zoom):1,M=g.paint.get("sky-opacity")*b;if(M===0)return;let C=_.context,R=g.paint.get("sky-type"),z=new n.af(C.gl.LEQUAL,n.af.ReadOnly,[0,1]),B=_.frameCounter/1e3%1;R==="atmosphere"?_.renderPass==="offscreen"?g.needsSkyboxCapture(_)&&(function(G,W,Z,te){let ne=G.context,ce=ne.gl,ue=W.skyboxFbo;if(!ue){ue=W.skyboxFbo=ne.createFramebuffer(32,32,!0,null),W.skyboxGeometry=new bi(ne),W.skyboxTexture=ne.gl.createTexture(),ce.bindTexture(ce.TEXTURE_CUBE_MAP,W.skyboxTexture),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_MAG_FILTER,ce.LINEAR);for(let Te=0;Te<6;++Te)ce.texImage2D(ce.TEXTURE_CUBE_MAP_POSITIVE_X+Te,0,ce.RGBA,32,32,0,ce.RGBA,ce.UNSIGNED_BYTE,null)}ne.bindFramebuffer.set(ue.framebuffer),ne.viewport.set([0,0,32,32]);let de=W.getCenter(G,!0),pe=G.getOrCreateProgram("skyboxCapture"),Me=new Float64Array(16);n.ae.identity(Me),n.ae.rotateY(Me,Me,.5*-Math.PI),qr(G,W,pe,Me,de,0),n.ae.identity(Me),n.ae.rotateY(Me,Me,.5*Math.PI),qr(G,W,pe,Me,de,1),n.ae.identity(Me),n.ae.rotateX(Me,Me,.5*-Math.PI),qr(G,W,pe,Me,de,2),n.ae.identity(Me),n.ae.rotateX(Me,Me,.5*Math.PI),qr(G,W,pe,Me,de,3),n.ae.identity(Me),qr(G,W,pe,Me,de,4),n.ae.identity(Me),n.ae.rotateY(Me,Me,Math.PI),qr(G,W,pe,Me,de,5),ne.viewport.set([0,0,G.width,G.height])}(_,g),g.markSkyboxValid(_)):_.renderPass==="sky"&&function(G,W,Z,te,ne){let ce=G.context,ue=ce.gl,de=G.transform,pe=G.getOrCreateProgram("skybox");ce.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_CUBE_MAP,W.skyboxTexture);let Me=((Te,Se,Be,Oe,Le)=>({u_matrix:Te,u_sun_direction:Se,u_cubemap:0,u_opacity:Oe,u_temporal_offset:Le}))(de.skyboxMatrix,W.getCenter(G,!1),0,te,ne);G.uploadCommonUniforms(ce,pe),pe.draw(G,ue.TRIANGLES,Z,n.ah.disabled,G.colorModeForRenderPass(),n.ag.backCW,Me,"skybox",W.skyboxGeometry.vertexBuffer,W.skyboxGeometry.indexBuffer,W.skyboxGeometry.segment)}(_,g,z,M,B):R==="gradient"&&_.renderPass==="sky"&&function(G,W,Z,te,ne){let ce=G.context,ue=ce.gl,de=G.transform,pe=G.getOrCreateProgram("skyboxGradient");W.skyboxGeometry||(W.skyboxGeometry=new bi(ce)),ce.activeTexture.set(ue.TEXTURE0);let Me=W.colorRampTexture;Me||(Me=W.colorRampTexture=new n.T(ce,W.colorRamp,ue.RGBA)),Me.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);let Te=((Se,Be,Oe,Le,Ge)=>({u_matrix:Se,u_color_ramp:0,u_center_direction:Be,u_radius:n.ac(Oe),u_opacity:Le,u_temporal_offset:Ge}))(de.skyboxMatrix,W.getCenter(G,!1),W.paint.get("sky-gradient-radius"),te,ne);G.uploadCommonUniforms(ce,pe),pe.draw(G,ue.TRIANGLES,Z,n.ah.disabled,G.colorModeForRenderPass(),n.ag.backCW,Te,"skyboxGradient",W.skyboxGeometry.vertexBuffer,W.skyboxGeometry.indexBuffer,W.skyboxGeometry.segment)}(_,g,z,M,B)},debug:function(_,h,g,b,M,C){for(let R=0;R<g.length;R++)if(M){let G=new n.C(b.r*.8,b.g*.8,b.b*.8,1);Gi(_,h,g[R],b,-1,-1,C),Gi(_,h,g[R],b,-1,1,C),Gi(_,h,g[R],b,1,1,C),Gi(_,h,g[R],b,1,-1,C),Gi(_,h,g[R],G,0,0,C)}else Gi(_,h,g[R],b,0,0,C)},custom:function(_,h,g,b){let M=_.context,C=g.implementation;if(!_.transform.projection.unsupportedLayers||!_.transform.projection.unsupportedLayers.includes("custom")||_.terrain&&(_.terrain.renderingToTexture||_.renderPass==="offscreen")&&g.isDraped(h)){if(_.renderPass==="offscreen"){let R=C.prerender;if(R){if(_.setCustomLayerDefaults(),M.setColorMode(_.colorModeForRenderPass()),_.transform.projection.name==="globe"){let z=_.transform.pointMerc;R.call(C,M.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),n.a2(_.transform.zoom),[z.x,z.y],_.transform.pixelsPerMeterRatio)}else R.call(C,M.gl,_.transform.customLayerMatrix());M.setDirty(),_.setBaseState()}}else if(_.renderPass==="translucent"){if(_.terrain&&_.terrain.renderingToTexture){let z=C.renderToTile;if(z){let B=b[0].canonical,G=new n._(B.x+b[0].wrap*(1<<B.z),B.y,B.z);M.setDepthMode(n.af.disabled),M.setStencilMode(n.ah.disabled),M.setColorMode(_.colorModeForRenderPass()),_.setCustomLayerDefaults(),z.call(C,M.gl,G),M.setDirty(),_.setBaseState()}return}_.setCustomLayerDefaults(),M.setColorMode(_.colorModeForRenderPass()),M.setStencilMode(n.ah.disabled);let R=C.renderingMode==="3d"?new n.af(_.context.gl.LEQUAL,n.af.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,n.af.ReadOnly);if(M.setDepthMode(R),_.transform.projection.name==="globe"){let z=_.transform.pointMerc;C.render(M.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),n.a2(_.transform.zoom),[z.x,z.y],_.transform.pixelsPerMeterRatio)}else C.render(M.gl,_.transform.customLayerMatrix());M.setDirty(),_.setBaseState(),M.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(_,h,g,b){if(_.renderPass==="opaque")return;let M=g.paint.get("model-opacity");if(M===0)return;let C=g.paint.get("model-cast-shadows");if(_.renderPass==="shadow"&&(!C||_.terrain&&M<.65&&g._transitionablePaint._values["model-opacity"].value.expression instanceof n.Z))return;let R=_.shadowRenderer,z=g.paint.get("model-receive-shadows");R&&(R.useNormalOffset=!0,z||(R.enabled=!1));let B=()=>{R&&(R.useNormalOffset=!0,z||(R.enabled=!0))},G=h.getSource();if(_.renderPass==="light-beam"&&G.type!=="batched-model")return;if(G.type==="vector"||G.type==="geojson")return function(pe,Me,Te,Se,Be){let Oe=pe.transform;if(Oe.projection.name!=="mercator")return void n.w(`Drawing 3D models for ${Oe.projection.name} projection is not yet implemented`);let Le=Oe.getFreeCameraOptions().position;if(!pe.modelManager)return;let Ge=pe.modelManager;Te.modelManager=Ge;let We=pe.shadowRenderer;if(!Te._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let at=Te._unevaluatedLayout._values["model-id"],Ye=me({},Te.layout.get("model-id").parameters),Ne=pe.style.order.indexOf(Te.fqid);for(let gt of Se){let ft=Me.getTile(gt).getBucket(Te);if(!ft||ft.projection.name!==Oe.projection.name)continue;let tt=ft.getModelUris();tt&&!ft.modelsRequested&&(Ge.addModelsFromBucket(tt,Be),ft.modelsRequested=!0);let Bt=Ym(gt,Oe);Ye.zoom=Bt;let Pt=at.possiblyEvaluate(Ye);if(qm(pe,ft,gt),Tl.shadowUniformsInitialized=!1,Tl.useSingleShadowCascade=!!We&&We.getMaxCascadeForTile(gt.toUnwrapped())===0,pe.renderPass==="shadow"&&We){if(pe.currentShadowCascade===1&&ft.isInsideFirstShadowMapFrustum)continue;let Qe=Oe.calculatePosMatrix(gt.toUnwrapped(),Oe.worldSize);if(Tl.tileMatrix.set(Qe),Tl.shadowTileMatrix=Float32Array.from(We.calculateShadowPassMatrixFromMatrix(Qe)),Tl.aabb.min.fill(0),Tl.aabb.max[0]=Tl.aabb.max[1]=n.a4,Tl.aabb.max[2]=0,ea(ft,Tl,pe,Te.scope))continue}let ct=1<<gt.canonical.z,_t=[((Le.x-gt.wrap)*ct-gt.canonical.x)*n.a4,(Le.y*ct-gt.canonical.y)*n.a4,Le.z*ct*n.a4];pe.conflationActive&&Object.keys(ft.instancesPerModel).length>0&&pe.style.isLayerClipped(Te,Me.getSource())&&ft.updateReplacement(gt,pe.replacementSource,Ne,Be)&&(ft.uploaded=!1,ft.upload(pe.context));for(let Qe in ft.instancesPerModel){let Rt=ft.instancesPerModel[Qe];Rt.features.length>0&&(Qe=Pt.evaluate(Rt.features[0].feature,{}));let Ft=Ge.getModel(Qe,Be);if(Ft&&Ft.uploaded)for(let oi of Ft.nodes)xv(pe,Te,oi,Rt,_t,gt,Tl)}}}(_,h,g,b,G.type==="vector"?g.scope:""),void B();if(!G.loaded())return;if(G.type==="batched-model")return function(pe,Me,Te,Se){Te.resetLayerRenderingStats(pe);let Be=pe.context,Oe=pe.transform,Le=pe.style.fog,Ge=pe.shadowRenderer;if(Oe.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${Oe.projection.name} projection is not yet implemented`);let We=pe.transform.getFreeCameraOptions().position,at=n.$.scale([],[We.x,We.y,We.z],pe.transform.worldSize);n.$.negate(at,at);let Ye=n.ae.identity([]),Ne=n.ci(Oe.center.lat,Oe.zoom),gt=n.ae.fromScaling([],[1,1,1/Ne]);n.ae.translate(Ye,Ye,at);let ft=Te.paint.get("model-opacity"),tt=new n.af(Be.gl.LEQUAL,n.af.ReadWrite,pe.depthRangeFor3D),Bt=new n.af(Be.gl.LEQUAL,n.af.ReadOnly,pe.depthRangeFor3D),Pt=new n.b8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ct=pe.renderPass==="shadow",_t=ct&&Ge?Ge.getCurrentCascadeFrustum():Oe.getFrustum(Oe.scaleZoom(Oe.worldSize)),Qe=Te.paint.get("model-front-cutoff"),Rt=Qe[2]<1,Ft=ba(pe,Te.paint.get("model-cutoff-fade-range")),oi=Te.getLayerRenderingStats();(function(ci,Si,hi,ji){let cr=ci.terrain?ci.terrain.exaggeration():0,Wi=ci.transform.zoom;for(let gr of ji){let Or=Si.getTile(gr).getBucket(hi);Or&&(ci.conflationActive&&Or.updateReplacement(gr,ci.replacementSource),Or.evaluateScale(ci,hi),ci.terrain&&cr>0&&Or.elevationUpdate(ci.terrain,cr,gr,hi.source),Or.needsReEvaluation(ci,Wi,hi)&&Or.evaluate(hi))}})(pe,Me,Te,Se),function(){let ci,Si,hi;Rt?(ci=Se.length-1,Si=-1,hi=-1):(ci=0,Si=Se.length,hi=1);for(let ji=ci;ji!==Si;ji+=hi){let cr=Se[ji],Wi=Me.getTile(cr).getBucket(Te);if(!Wi||!Wi.uploaded)continue;let gr=!1;Ge&&(gr=Ge.getMaxCascadeForTile(cr.toUnwrapped())===0);let Or=Oe.calculatePosMatrix(cr.toUnwrapped(),Oe.worldSize),zn=Wi.modelTraits,xn=[];for(let Ur of Wi.getNodesInfo()){if(Ur.hiddenByReplacement||!Ur.node.meshes)continue;let yn=Ur.node,_r=0;pe.terrain&&yn.elevation&&(_r=yn.elevation*pe.terrain.exaggeration());let br=Ur.evaluatedScale;if(br[0]<=1&&br[1]<=1&&br[2]<=1&&(()=>{let yo=Ur.aabb;return Pt.min=[...yo.min],Pt.max=[...yo.max],Pt.min[2]+=_r,Pt.max[2]+=_r,n.$.transformMat4(Pt.min,Pt.min,Or),n.$.transformMat4(Pt.max,Pt.max,Or),Pt})().intersects(_t)===0)continue;let ur=[...Or],Xr=yn.anchor?yn.anchor[0]:0,Ar=yn.anchor?yn.anchor[1]:0;n.ae.translate(ur,ur,[Xr*(br[0]-1),Ar*(br[1]-1),_r]),n.$.exactEquals(br,n.cl)||n.ae.scale(ur,ur,br);let er=n.ae.multiply([],ur,yn.matrix),Is=n.ae.multiply([],Oe.expandedFarZProjMatrix,er),Ps=n.ae.multiply([],Oe.expandedFarZProjMatrix,ur),Fo=n.aB.transformMat4([],[Xr,Ar,_r,1],Is)[2];yn.hidden=!1;let ko=ft;ct||(Rt&&(ko*=OE(ur,Oe,Ur.aabb,Qe)),ko*=Ka(Ft,Fo)),ko!==0?xn.push({nodeInfo:Ur,depth:Fo,opacity:ko,wvpForNode:Is,wvpForTile:Ps,nodeModelMatrix:er,tileModelMatrix:ur}):yn.hidden=!0}ct||xn.sort((Ur,yn)=>!Rt||Ur.opacity===1&&yn.opacity===1?Ur.depth<yn.depth?-1:1:Ur.opacity===1?-1:yn.opacity===1?1:Ur.depth>yn.depth?-1:1);for(let Ur of xn){let yn=Ur.nodeInfo,_r=yn.node,br=n.ae.multiply([],gt,Ur.tileModelMatrix);n.ae.multiply(br,Ye,br);let ur=n.ae.invert([],br);n.ae.transpose(ur,ur),n.ae.scale(ur,ur,bv),br=n.ae.multiply(br,br,_r.matrix);let Xr=pe.renderPass==="light-beam",Ar=zn&n.cn.HasMapboxMeshFeatures,er=Ar?0:yn.evaluatedRMEA[0][2];for(let Is=0;Is<_r.meshes.length;++Is){let Ps=_r.meshes[Is],Fo=Is===_r.lightMeshIndex,ko=Ur.wvpForNode;if(Fo){if(!Xr&&!pe.terrain&&pe.shadowRenderer){pe.currentLayer<pe.firstLightBeamLayer&&(pe.firstLightBeamLayer=pe.currentLayer);continue}ko=Ur.wvpForTile}else if(Xr)continue;let yo={defines:[]},No=[];if(vd(yo.defines,No,Ps,pe,Te.lut),Ar||yo.defines.push("DIFFUSE_SHADED"),gr&&yo.defines.push("SHADOWS_SINGLE_CASCADE"),oi&&(ct?oi.numRenderedVerticesInShadowPass+=Ps.vertexArray.length:oi.numRenderedVerticesInTransparentPass+=Ps.vertexArray.length),ct){u1(Ps,Ur.nodeModelMatrix,pe,Te);continue}let no=null;if(Le){let mt=qp(Ur.nodeModelMatrix,pe.transform);if(no=new Float32Array(mt),Oe.projection.name!=="globe"){let au=Ps.aabb.min,$l=Ps.aabb.max,[lu,cu]=Le.getOpacityForBounds(mt,au[0],au[1],$l[0],$l[1]);yo.overrideFog=lu>=qi||cu>=qi}}let vo=Ps.material,Ht;vo.occlusionTexture&&vo.occlusionTexture.offsetScale&&(Ht=vo.occlusionTexture.offsetScale,yo.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!ct&&Ge&&(Ge.useNormalOffset=!!Ps.normalBuffer);let Mi=pe.getOrCreateProgram("model",yo);!ct&&Ge&&Ge.setupShadowsFromMatrix(Ur.tileModelMatrix,Mi,Ge.useNormalOffset),pe.uploadCommonUniforms(Be,Mi,null,no);let ta=vo.pbrMetallicRoughness;ta.metallicFactor=.9,ta.roughnessFactor=.5;let Dn=fd(new Float32Array(ko),new Float32Array(br),new Float32Array(ur),new Float32Array(_r.matrix),pe,Ur.opacity,ta.baseColorFactor.toRenderColor(null),vo.emissiveFactor,ta.metallicFactor,ta.roughnessFactor,vo,er,Te,[0,0,0],Ht);!Fo&&(yn.hasTranslucentParts||Ur.opacity<1)&&Mi.draw(pe,Be.gl.TRIANGLES,tt,n.ah.disabled,n.a.disabled,n.ag.backCCW,Dn,Te.id,Ps.vertexBuffer,Ps.indexBuffer,Ps.segments,Te.paint,pe.transform.zoom,void 0,No),Mi.draw(pe,Be.gl.TRIANGLES,Fo?Bt:tt,n.ah.disabled,Fo||Ur.opacity<1||yn.hasTranslucentParts?n.a.alphaBlended:n.a.unblended,n.ag.backCCW,Dn,Te.id,Ps.vertexBuffer,Ps.indexBuffer,Ps.segments,Te.paint,pe.transform.zoom,void 0,No)}}}}()}(_,h,g,b),void B();if(G.type!=="model")return;let W=G.getModels(),Z=[],te=_.transform.getFreeCameraOptions().position,ne=n.$.scale([],[te.x,te.y,te.z],_.transform.worldSize);n.$.negate(ne,ne);let ce=[],ue=[],de=0;for(let pe of W){let Me=g.paint.get("model-rotation").constantOr(null),Te=g.paint.get("model-scale").constantOr(null),Se=g.paint.get("model-translation").constantOr(null);pe.computeModelMatrix(_,Me,Te,Se,!0,!0,!1);let Be=n.ae.identity([]),Oe=n.ci(pe.position.lat,_.transform.zoom),Le=n.ae.fromScaling([],[1,1,1/Oe]);n.ae.translate(Be,Be,ne),Z.push({zScaleMatrix:Le,negCameraPosMatrix:Be});for(let Ge of pe.nodes)Es(_.transform,Ge,pe.matrix,_.transform.expandedFarZProjMatrix,de,ce,ue);de++}if(ce.sort((pe,Me)=>Me.depth-pe.depth),_.renderPass!=="shadow"){if(M===1)for(let pe of ue)Lo(pe,_,g,Z[pe.modelIndex],n.ah.disabled,_.colorModeForRenderPass());else{for(let pe of ue)Lo(pe,_,g,Z[pe.modelIndex],n.ah.disabled,n.a.disabled);for(let pe of ue)Lo(pe,_,g,Z[pe.modelIndex],_.stencilModeFor3D(),_.colorModeForRenderPass());_.resetStencilClippingMasks()}for(let pe of ce)Lo(pe,_,g,Z[pe.modelIndex],n.ah.disabled,_.colorModeForRenderPass());B()}else{for(let pe of ue)u1(pe.mesh,pe.nodeModelMatrix,_,g);for(let pe of ce)u1(pe.mesh,pe.nodeModelMatrix,_,g);B()}}},Hs={model:function(_,h,g){let b=h.getSource();if(!b.loaded())return;if(b.type==="vector"||b.type==="geojson")return void(g.modelManager&&g.modelManager.upload(g,b.type==="vector"?_.scope:""));if(b.type==="batched-model"||b.type!=="model")return;let M=b.getModels();for(let C of M)C.upload(g.context)},raster:function(_,h,g){let b=h.getSource();if(!(b instanceof oh&&b.loaded()))return;let M=_.sourceLayer||b.rasterLayerIds&&b.rasterLayerIds[0];if(!M)return;let C=_.paint.get("raster-array-band")||b.getInitialBand(M);if(C==null)return;let R=h.getIds().map(z=>h.getTileByID(z));for(let z of R)z.updateNeeded(M,C)&&b.prepareTile(z,M,C)},"raster-particle":function(_,h,g){let b=h.getSource();if(!(b instanceof oh&&b.loaded()))return;let M=_.sourceLayer||b.rasterLayerIds&&b.rasterLayerIds[0];if(!M)return;let C=_.paint.get("raster-particle-array-band")||b.getInitialBand(M);if(C==null)return;let R=h.getIds().map(z=>h.getTileByID(z));for(let z of R)z.updateNeeded(M,C)&&b.prepareTile(z,M,C)}};class h1{constructor(h,g,b,M){this.context=new Zt(h,g),this.transform=b,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=M,this._timeStamp=n.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let C=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let z of C)this._debugParams.enabledLayers[z]=!0;M.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),M.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),M.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),M.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),M.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let z of C)M.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],z);this.occlusionParams=new Yl(M),this.setup(),this.numSublayers=n.bx.maxUnderzooming+n.bx.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.cp,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new pP(this),this._wireframeDebugCache=new Vs,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];let R=new n.j({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,R,h.RGBA)}updateTerrain(h,g){let b=!!h&&!!h.terrain&&this.transform.projection.supportsTerrain;if(!(b||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Oo(this,h));let M=this._terrain;this.transform.elevation=b?M:null,M.update(h,this.transform,g),this.transform.elevation&&!M.enabled&&(this.transform.elevation=null)}_updateFog(h){let g=h.fog;if(!g||this.transform.projection.name==="globe"||g.getOpacity(this.transform.pitch)<1||g.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[b,M]=g.getFovAdjustedRange(this.transform._fov);if(b>M)return void(this.transform.fogCullDistSq=null);let C=b+.78*(M-b);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(h){h&&!this._terrain&&(this._terrain=new Oo(this,this.style)),this._forceTerrainMode=h}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(h,g){if(this.width=h*n.e.devicePixelRatio,this.height=g*n.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let b of this.style.order)this.style._mergedLayers[b].resize()}setup(){let h=this.context,g=new n.bv;g.emplaceBack(0,0),g.emplaceBack(n.a4,0),g.emplaceBack(0,n.a4),g.emplaceBack(n.a4,n.a4),this.tileExtentBuffer=h.createVertexBuffer(g,n.bt.members),this.tileExtentSegments=n.b.simpleSegment(0,0,4,2);let b=new n.bv;b.emplaceBack(0,0),b.emplaceBack(n.a4,0),b.emplaceBack(0,n.a4),b.emplaceBack(n.a4,n.a4),this.debugBuffer=h.createVertexBuffer(b,n.bt.members),this.debugSegments=n.b.simpleSegment(0,0,4,5);let M=new n.bv;M.emplaceBack(-1,-1),M.emplaceBack(1,-1),M.emplaceBack(-1,1),M.emplaceBack(1,1),this.viewportBuffer=h.createVertexBuffer(M,n.bt.members),this.viewportSegments=n.b.simpleSegment(0,0,4,2);let C=new n.cq;C.emplaceBack(0,0,0,0),C.emplaceBack(n.a4,0,n.a4,0),C.emplaceBack(0,n.a4,0,n.a4),C.emplaceBack(n.a4,n.a4,n.a4,n.a4),this.mercatorBoundsBuffer=h.createVertexBuffer(C,n.cr.members),this.mercatorBoundsSegments=n.b.simpleSegment(0,0,4,2);let R=new n.bw;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=h.createIndexBuffer(R);let z=new n.cs;for(let G of[0,1,3,2,0])z.emplaceBack(G);this.debugIndexBuffer=h.createIndexBuffer(z),this.emptyTexture=new n.T(h,new n.j({width:1,height:1},Uint8Array.of(0,0,0,0)),h.gl.RGBA),this.identityMat=n.ae.create();let B=this.context.gl;this.stencilClearMode=new n.ah({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(h){return h._makeTileBoundsBuffers(this.context,this.transform.projection),h._tileBoundsBuffer?{tileBoundsBuffer:h._tileBoundsBuffer,tileBoundsIndexBuffer:h._tileBoundsIndexBuffer,tileBoundsSegments:h._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let h=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,h.TRIANGLES,n.af.disabled,this.stencilClearMode,n.a.disabled,n.ag.disabled,zm(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(h,g,b){if(!g||this.currentStencilSource===g.id||!h.isTileClipped()||!b||b.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let z=!1;for(let B of b)if(this._tileClippingMaskIDs[B.key]===void 0){z=!0;break}if(!z)return}this.currentStencilSource=g.id;let M=this.context,C=M.gl;this.nextStencilID+b.length>256&&this.clearStencil(),M.setColorMode(n.a.disabled),M.setDepthMode(n.af.disabled);let R=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let z of b){let B=g.getTile(z),G=this._tileClippingMaskIDs[z.key]=this.nextStencilID++,{tileBoundsBuffer:W,tileBoundsIndexBuffer:Z,tileBoundsSegments:te}=this.getTileBoundsBuffers(B);R.draw(this,C.TRIANGLES,n.af.disabled,new n.ah({func:C.ALWAYS,mask:0},G,255,C.KEEP,C.KEEP,C.REPLACE),n.a.disabled,n.ag.disabled,zm(z.projMatrix),"$clipping",W,Z,te)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let h=this.nextStencilID++,g=this.context.gl;return new n.ah({func:g.NOTEQUAL,mask:255},h,255,g.KEEP,g.KEEP,g.REPLACE)}stencilModeForClipping(h){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(h);let g=this.context.gl;return new n.ah({func:g.EQUAL,mask:255},this._tileClippingMaskIDs[h.key],0,g.KEEP,g.KEEP,g.REPLACE)}stencilConfigForOverlap(h){let g=this.context.gl,b=h.sort((R,z)=>z.overscaledZ-R.overscaledZ),M=b[b.length-1].overscaledZ,C=b[0].overscaledZ-M+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();let R={};for(let z=0;z<C;z++)R[z+M]=new n.ah({func:g.GEQUAL,mask:255},z+this.nextStencilID,255,g.KEEP,g.KEEP,g.REPLACE);return this.nextStencilID+=C,[R,b]}return[{[M]:n.ah.disabled},b]}colorModeForRenderPass(){let h=this.context.gl;return this._showOverdrawInspector?new n.a([h.CONSTANT_COLOR,h.ONE,h.CONSTANT_COLOR,h.ONE],new n.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?n.a.unblended:n.a.alphaBlended}colorModeForDrapableLayerRenderPass(h){let g=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new n.a([g.ONE,g.ONE_MINUS_SRC_ALPHA,g.CONSTANT_ALPHA,g.ONE_MINUS_SRC_ALPHA],new n.C(0,0,0,h===void 0?0:h),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(h,g,b,M=!1){if(this.depthOcclusion)return new n.af(this.context.gl.GREATER,n.af.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!M)return n.af.disabled;let C=1-((1+this.currentLayer)*this.numSublayers+h)*this.depthEpsilon;return new n.af(b||this.context.gl.LEQUAL,g,[C,C])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){let h=this.context.gl,g=Math.ceil(this.width),b=Math.ceil(this.height),M=this.context.bindFramebuffer.get(),C=h.getParameter(h.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===g&&this.depthFBO.height===b||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),g!==0&&b!==0&&(this.depthFBO=new Ee(this.context,g,b,!1,"texture"),this.depthTexture=new n.T(this.context,{width:g,height:b,data:null},h.DEPTH_STENCIL),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(M),h.bindTexture(h.TEXTURE_2D,C),this.depthFBO&&(h.bindFramebuffer(h.READ_FRAMEBUFFER,null),h.bindFramebuffer(h.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),h.blitFramebuffer(0,0,g,b,0,0,g,b,h.DEPTH_BUFFER_BIT,h.NEAREST),h.bindFramebuffer(h.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((h,g)=>h+g/this._fpsHistory.length,0))}render(h,g){let b=n.e.now();this._dt=b-this._timeStamp,this._timeStamp=b,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=h.map.repaint,this.style=h,this.options=g;let M=this.style._mergedLayers,C=this.style.order.filter(Ye=>{let Ne=M[Ye];return!(Ne.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ne.type]}),R=!1,z=!1;for(let Ye of C){let Ne=M[Ye];Ne.type==="circle"&&(R=!0),Ne.type==="symbol"&&(Ne.hasInitialOcclusionOpacityProperties?z=!0:R=!0)}let B=C.map(Ye=>M[Ye]),G=this.style._mergedSourceCaches;this.imageManager=h.imageManager,this.modelManager=h.modelManager,this.symbolFadeChange=h.placement.symbolFadeChange(n.e.now()),this.imageManager.beginFrame();let W=0,Z=!1;for(let Ye in G){let Ne=G[Ye];Ne.used&&(Ne.prepare(this.context),Ne.getSource().usedInConflation&&++W)}let te=!1;for(let Ye of B)Ye.isHidden(this.transform.zoom)||(Ye.type==="clip"&&(te=!0),this.prepareLayer(Ye));let ne={},ce={},ue={},de={},pe={};for(let Ye in G){let Ne=G[Ye];ne[Ye]=Ne.getVisibleCoordinates(),ce[Ye]=ne[Ye].slice().reverse(),ue[Ye]=Ne.getVisibleCoordinates(!0).reverse(),de[Ye]=Ne.getShadowCasterCoordinates(),pe[Ye]=Ne.sortCoordinatesByDistance(ne[Ye])}let Me=Ye=>{let Ne=this.style.getLayerSourceCache(Ye);return Ne&&Ne.used?Ne.getSource():null};if(W||te){let Ye=[],Ne=[],gt=0;for(let ft of B)this.isSourceForClippingOrConflation(ft,Me(ft))&&(Ye.push(ft),Ne.push(gt)),gt++;if(Ye&&(te||Ye.length>1)){let ft=[];for(let tt=0;tt<Ye.length;tt++){let Bt=Ye[tt],Pt=Ne[tt],ct=this.style.getLayerSourceCache(Bt);if(!ct||!ct.used||!ct.getSource().usedInConflation&&Bt.type!=="clip")continue;let _t=n.cv,Qe=n.cw.None,Rt=[];if(Bt.type==="clip"){_t=Pt;for(let Ft of Bt.layout.get("clip-layer-types"))Qe|=Ft==="model"?n.cw.Model:Ft==="symbol"?n.cw.Symbol:n.cw.FillExtrusion;for(let Ft of Bt.layout.get("clip-layer-scope"))Rt.push(Ft)}ft.push({layer:Bt.fqid,cache:ct,order:_t,clipMask:Qe,clipScope:Rt})}this.replacementSource.setSources(ft),Z=!0}}Z||this.replacementSource.clear(),this.conflationActive=Z,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ye=0;Ye<B.length;Ye++){let Ne=B[Ye],gt=Ne.cutoffRange();if(this.longestCutoffRange=Math.max(gt,this.longestCutoffRange),gt>0){let ft=Me(Ne);ft&&(this.minCutoffZoom=Math.max(ft.minzoom,this.minCutoffZoom)),Ne.minzoom&&(this.minCutoffZoom=Math.max(Ne.minzoom,this.minCutoffZoom))}Ne.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ye),this._lastOcclusionLayer=Ye)}let Te=this.style&&this.style.fog;Te?(this._fogVisible=Te.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Te.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ue),this.opaquePassCutoff=0);let Se=this._shadowRenderer;if(Se){Se.updateShadowParameters(this.transform,this.style.directionalLight);for(let Ye in G)for(let Ne of ne[Ye]){let gt={min:0,max:0};this.terrain&&(gt=this.terrain.getMinMaxForTile(Ne)||gt),Se.addShadowReceiver(Ne.toUnwrapped(),gt.min,gt.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.ct(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new _v(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!n.cu(this.context.gl))return;this.renderPass="offscreen";for(let Ye of B){let Ne=h.getLayerSourceCache(Ye);if(!Ye.hasOffscreenPass()||Ye.isHidden(this.transform.zoom))continue;let gt=Ne?ce[Ne.id]:void 0;(Ye.type==="custom"||Ye.type==="raster"||Ye.type==="raster-particle"||Ye.isSky()||gt&&gt.length)&&this.renderLayer(this,Ne,Ye,gt)}this.depthRangeFor3D=[0,1-(B.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,de)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let Be=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Oe=(()=>{if(g.showOverdrawInspector)return n.C.black;let Ye=this.style.fog;if(Ye&&this.transform.projection.supportsFog){let Ne=this.style.getLut(Ye.scope);if(!Be){let gt=Ye.properties.get("color").toRenderColor(Ne).toArray01();return new n.C(...gt)}if(Be){let gt=Ye.properties.get("space-color").toRenderColor(Ne).toArray01();return new n.C(...gt)}}return n.C.transparent})();if(this.context.clear({color:Oe,depth:1}),this.clearStencil(),this._showOverdrawInspector=g.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Be&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){let Ye=B[this.currentLayer],Ne=h.getLayerSourceCache(Ye);if(Ye.isSky())continue;let gt=Ne?(Ye.is3D()?pe:ce)[Ne.id]:void 0;this._renderTileClippingMasks(Ye,Ne,gt),this.renderLayer(this,Ne,Ye,gt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Be&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.a2(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){let Ye=B[this.currentLayer],Ne=h.getLayerSourceCache(Ye);Ye.isSky()&&this.renderLayer(this,Ne,Ye,Ne?ce[Ne.id]:void 0)}function Le(Ye,Ne){let gt;return Ne&&(gt=(Ye.type==="symbol"?ue:Ye.is3D()?pe:ce)[Ne.id]),gt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<C.length;){let Ye=B[this.currentLayer];if(Ye.type==="raster"||Ye.type==="raster-particle"){let Ne=h.getLayerSourceCache(Ye);this.renderLayer(this,Ne,Ye,Le(Ye,Ne))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ge=0;Se&&(Ge=Se.getShadowCastingLayerCount());let We=!1,at=-1;for(let Ye=0;Ye<C.length;++Ye){let Ne=B[Ye];Ne.isHidden(this.transform.zoom)||Ne.is3D()&&(at=Ye)}for(z&&at===-1&&(R=!0);this.currentLayer<C.length;){let Ye=B[this.currentLayer],Ne=h.getLayerSourceCache(Ye);if(Ye.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ye)){if(Ye.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(R&&!We&&this.terrain&&!this.transform.isOrthographic&&(We=!0,this.blitDepth()),z&&at!==-1&&this.currentLayer===at+1&&!this.transform.isOrthographic&&this.blitDepth(),Ye.is3D()||this.terrain||this._renderTileClippingMasks(Ye,Ne,Ne?ne[Ne.id]:void 0),this.renderLayer(this,Ne,Ye,Le(Ye,Ne)),!this.terrain&&Se&&Ge>0&&Ye.hasShadowPass()&&--Ge==0&&(Se.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let gt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=gt;this.currentLayer++){let ft=B[this.currentLayer];if(!ft.hasLightBeamPass())continue;let tt=h.getLayerSourceCache(ft);this.renderLayer(this,tt,ft,tt?ce[tt.id]:void 0)}this.currentLayer=gt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let gt=this.currentLayer;this.depthOcclusion=!0;for(let ft of this.layersWithOcclusionOpacity){this.currentLayer=ft;let tt=B[this.currentLayer],Bt=h.getLayerSourceCache(tt),Pt=Bt?ce[Bt.id]:void 0;tt.is3D()||this.terrain||this._renderTileClippingMasks(tt,Bt,Bt?ne[Bt.id]:void 0),this.renderLayer(this,Bt,tt,Pt)}this.depthOcclusion=!1,this.currentLayer=gt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ye=null;B.forEach(Ne=>{let gt=h.getLayerSourceCache(Ne);gt&&!Ne.isHidden(this.transform.zoom)&&gt.getVisibleCoordinates().length&&(!Ye||Ye.getSource().maxzoom<gt.getSource().maxzoom)&&(Ye=gt)}),Ye&&this.options.showTileBoundaries&&Xl.debug(this,Ye,Ye.getVisibleCoordinates(),n.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Xl.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ye){let Ne=Ye.transform.padding;l1(Ye,Ye.transform.height-(Ne.top||0),3,o1),l1(Ye,Ne.bottom||0,3,vv),Wm(Ye,Ne.left||0,3,a1),Wm(Ye,Ye.transform.width-(Ne.right||0),3,en);let gt=Ye.transform.centerPoint;(function(ft,tt,Bt,Pt){Hp(ft,tt-1,Bt-10,2,20,Pt),Hp(ft,tt-10,Bt-1,20,2,Pt)})(Ye,gt.x,Ye.transform.height-gt.y,_P)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Z||(this.conflationActive=!1)}prepareLayer(h){this.gpuTimingStart(h);let{unsupportedLayers:g}=this.transform.projection,b=!g||!g.includes(h.type);if(Hs[h.type]&&(b||this.terrain&&h.type==="custom")){let M=this.style.getLayerSourceCache(h);Hs[h.type](h,M,this)}this.gpuTimingEnd()}renderLayer(h,g,b,M){b.isHidden(this.transform.zoom)||(b.type==="background"||b.type==="sky"||b.type==="custom"||b.type==="model"||b.type==="raster"||b.type==="raster-particle"||M&&M.length)&&(this.id=b.id,this.gpuTimingStart(b),h.transform.projection.unsupportedLayers&&h.transform.projection.unsupportedLayers.includes(b.type)&&(!h.terrain||b.type!=="custom")||b.type==="clip"||Xl[b.type](h,g,b,M,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(h){if(!this.options.gpuTiming)return;let g=this.context.extTimerQuery,b=this.context.gl,M=this.gpuTimers[h.id];M||(M=this.gpuTimers[h.id]={calls:0,cpuTime:0,query:b.createQuery()}),M.calls++,b.beginQuery(g.TIME_ELAPSED_EXT,M.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let h=this.context.extTimerQuery,g=this.context.gl,b=g.createQuery();this.deferredRenderGpuTimeQueries.push(b),g.beginQuery(h.TIME_ELAPSED_EXT,b)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let h=this.gpuTimers;return this.gpuTimers={},h}collectDeferredRenderGpuQueries(){let h=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],h}queryGpuTimers(h){let g={};for(let b in h){let M=h[b],C=this.context.extTimerQuery,R=C.getQueryParameter(M.query,this.context.gl.QUERY_RESULT)/1e6;C.deleteQueryEXT(M.query),g[b]=R}return g}queryGpuTimeDeferredRender(h){if(!this.options.gpuTimingDeferredRender)return 0;let g=this.context.extTimerQuery,b=this.context.gl,M=0;for(let C of h)M+=g.getQueryParameter(C,b.QUERY_RESULT)/1e6,g.deleteQueryEXT(C);return M}translatePosMatrix(h,g,b,M,C){if(!b[0]&&!b[1])return h;let R=C?M==="map"?this.transform.angle:0:M==="viewport"?-this.transform.angle:0;if(R){let G=Math.sin(R),W=Math.cos(R);b=[b[0]*W-b[1]*G,b[0]*G+b[1]*W]}let z=[C?b[0]:n.bD(g,b[0],this.transform.zoom),C?b[1]:n.bD(g,b[1],this.transform.zoom),0],B=new Float32Array(16);return n.ae.translate(B,h,z),B}saveTileTexture(h){let g=h.size[0],b=this._tileTextures[g];b?b.push(h):this._tileTextures[g]=[h]}getTileTexture(h){let g=this._tileTextures[h];return g&&g.length>0?g.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(h,g,b){let M=b===void 0?this.terrain&&this.terrain.renderingToTexture:b,C=[];return this.style&&this.style.enable3dLights()&&(h==="globeRaster"||h==="terrainRaster"?(C.push("LIGHTING_3D_MODE"),C.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):M||C.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||C.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?C.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):C.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(C.push("TERRAIN"),this.linearFloatFilteringSupported()&&C.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&C.push("GLOBE"),!this._fogVisible||M||g!==void 0&&!g||C.push("FOG","FOG_DITHERING"),M&&C.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&C.push("OVERDRAW_INSPECTOR"),C}getOrCreateProgram(h,g){this.cache=this.cache||{};let b=g&&g.defines||[],M=g&&g.config,C=this.currentGlobalDefines(h,g&&g.overrideFog,g&&g.overrideRtt).concat(b),R=Zx.cacheKey(hE[h],h,C,M);return this.cache[R]||(this.cache[R]=new Zx(this.context,h,hE[h],M,TE[h],C)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let h=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(h.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(h,g){if(this.style.enable3dLights()){let b=this.style.directionalLight,M=this.style.ambientLight;if(b&&M){let C=((R,z,B)=>{let G=R.properties.get("direction"),W=R.properties.get("color").toRenderColor(B.getLut(R.scope)).toArray01(),Z=R.properties.get("intensity"),te=z.properties.get("color").toRenderColor(B.getLut(z.scope)).toArray01(),ne=z.properties.get("intensity"),ce=[G.x,G.y,G.z],ue=n.bC(te,ne),de=n.bC(W,Z);return{u_lighting_ambient_color:ue,u_lighting_directional_dir:ce,u_lighting_directional_color:de,u_ground_radiance:_E(ce,de,ue)}})(b,M,this.style);g.setLightsUniformValues(h,C)}}}uploadCommonUniforms(h,g,b,M,C){if(this.uploadCommonLightUniforms(h,g),this.terrain&&this.terrain.renderingToTexture)return;let R=this.style.fog;if(R){let z=R.getOpacity(this.transform.pitch),B=((G,W,Z,te,ne,ce,ue,de,pe,Me,Te,Se)=>{let Be=G.transform,Oe=W.properties.get("color").toRenderColor(G.style.getLut(W.scope)).toArray01();Oe[3]=te;let Le=G.frameCounter/1e3%1,[Ge,We]=W.properties.get("vertical-range");return{u_fog_matrix:Z?Be.calculateFogTileMatrix(Z):Se||G.identityMat,u_fog_range:W.getFovAdjustedRange(Be._fov),u_fog_color:Oe,u_fog_horizon_blend:W.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ge,We),We],u_fog_temporal_offset:Le,u_frustum_tl:ne,u_frustum_tr:ce,u_frustum_br:ue,u_frustum_bl:de,u_globe_pos:pe,u_globe_radius:Me,u_viewport:Te,u_globe_transition:n.a2(Be.zoom),u_is_globe:+(Be.projection.name==="globe")}})(this,R,b,z,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.e.devicePixelRatio,this.transform.height*n.e.devicePixelRatio],M);g.setFogUniformValues(h,B)}C&&g.setCutoffUniformValues(h,C.uniformValues)}setTileLoadedFlag(h){this.tileLoaded=h}saveCanvasCopy(){let h=this.canvasCopy();h&&(this.frameCopies.push(h),this.tileLoaded=!1)}canvasCopy(){let h=this.context.gl,g=h.createTexture();return h.bindTexture(h.TEXTURE_2D,g),h.copyTexImage2D(h.TEXTURE_2D,0,h.RGBA,0,0,h.drawingBufferWidth,h.drawingBufferHeight,0),g}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let h=this.style&&this.style.fog;return!!h&&h.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let h=this._backgroundTiles,g=this._backgroundTiles={},b=this.transform.coveringTiles({tileSize:512});for(let M of b)g[M.key]=h[M.key]||new n.bA(M,512,this.transform.tileZoom,this);return g}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(h,g){return!(!h.is3D()||h.minzoom&&h.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||h.sourceLayer!=="building")&&h.type!=="clip"&&(!g||g.type!=="batched-model"))}isTileAffectedByFog(h){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let g=this._cachedTileFogOpacities[h.key];return g||(this._cachedTileFogOpacities[h.key]=g=this.style.fog.getOpacityForTile(h)),g[0]>=qi||g[1]>=qi}setupDepthForOcclusion(h,g,b){let M=this.context,C=M.gl,R=!!b;var z;b||(b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),M.activeTexture.set(C.TEXTURE3),h&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),b.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],b.u_depth_range_unpack=[2/((z=this.depthRangeFor3D)[1]-z[0]),-1-2*z[0]/(z[1]-z[0])],b.u_occluder_half_size=.5*this.occlusionParams.occluderSize,b.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),M.activeTexture.set(C.TEXTURE0),R||g.setTerrainUniformValues(M,b)}}class Ja{constructor(h,g,b,M){this.screenBounds=h,this.cameraPoint=g,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=b,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,M)}static createFromScreenPoints(h,g){let b,M;if(h instanceof n.P||typeof h[0]=="number"){let C=n.P.convert(h);b=[C],M=g.isPointAboveHorizon(C)}else{let C=n.P.convert(h[0]),R=n.P.convert(h[1]);b=[C,R],M=n.cx(C,R).every(z=>g.isPointAboveHorizon(z))}return new Ja(b,g.getCameraPoint(),M,g)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(h){return n.cx(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],h)}bufferedCameraGeometry(h){let g=this.screenBounds[0],b=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],M=n.cx(g,b,0,!1);return this.cameraPoint.y>b.y&&(this.cameraPoint.x>g.x&&this.cameraPoint.x<b.x?M.splice(3,0,this.cameraPoint):this.cameraPoint.x>=b.x?M[2]=this.cameraPoint:this.cameraPoint.x<=g.x&&(M[3]=this.cameraPoint)),n.cy(M,h)}bufferedCameraGeometryGlobe(h){let g=this.screenBounds[0],b=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],M=n.cx(g,b,h),C=this.cameraPoint.clone();switch(3*((C.y>g.y)+(C.y>b.y))+((C.x>g.x)+(C.x>b.x))){case 0:M[0]=C,M[4]=C.clone();break;case 1:M.splice(1,0,C);break;case 2:M[1]=C;break;case 3:M.splice(4,0,C);break;case 5:M.splice(2,0,C);break;case 6:M[3]=C;break;case 7:M.splice(3,0,C);break;case 8:M[2]=C}return M}containsTile(h,g,b,M=0){let C=h.queryPadding/g._pixelsPerMercatorPixel+1,R=b?this._bufferedCameraMercator(C,g):this._bufferedScreenMercator(C,g),z=h.tileID.wrap+(R.unwrapped?M:0),B=R.polygon.map(de=>n.cz(h.tileTransform,de,z));if(!n.cA(B,0,0,n.a4,n.a4))return;z=h.tileID.wrap+(this.screenGeometryMercator.unwrapped?M:0);let G=this.screenGeometryMercator.polygon.map(de=>n.cB(h.tileTransform,de,z)),W=G.map(de=>new n.P(de[0],de[1])),Z=g.getFreeCameraOptions().position||new n._(0,0,0),te=n.cB(h.tileTransform,Z,z),ne=G.map(de=>{let pe=n.$.sub(de,de,te);return n.$.normalize(pe,pe),new n.aU(te,pe)}),ce=n.bD(h,1,g.zoom)*g._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:W,tilespaceRays:ne,bufferedTilespaceGeometry:B,bufferedTilespaceBounds:(ue=n.cC(B),ue.min.x=n.au(ue.min.x,0,n.a4),ue.min.y=n.au(ue.min.y,0,n.a4),ue.max.x=n.au(ue.max.x,0,n.a4),ue.max.y=n.au(ue.max.y,0,n.a4),ue),tile:h,tileID:h.tileID,pixelToTileUnitsFactor:ce};var ue}_bufferedScreenMercator(h,g){let b=ah(h);if(this._screenRaycastCache[b])return this._screenRaycastCache[b];{let M;return M=g.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(h),g):{polygon:this.bufferedScreenGeometry(h).map(C=>g.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[b]=M,M}}_bufferedCameraMercator(h,g){let b=ah(h);if(this._cameraRaycastCache[b])return this._cameraRaycastCache[b];{let M;return M=g.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(h),g):{polygon:this.bufferedCameraGeometry(h).map(C=>g.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[b]=M,M}}_projectAndResample(h,g){let b=function(C,R){let z=n.ae.multiply([],R.pixelMatrix,R.globeMatrix),B=[0,-n.cF,0,1],G=[0,n.cF,0,1],W=[0,0,0,1];n.aB.transformMat4(B,B,z),n.aB.transformMat4(G,G,z),n.aB.transformMat4(W,W,z);let Z=new n.P(B[0]/B[3],B[1]/B[3]),te=new n.P(G[0]/G[3],G[1]/G[3]),ne=n.cD(C,Z)&&B[3]<W[3],ce=n.cD(C,te)&&G[3]<W[3];if(!ne&&!ce)return null;let ue=function(Le,Ge,We){for(let at=1;at<Le.length;at++){let Ye=ru(Ge.pointCoordinate3D(Le[at-1]).x),Ne=ru(Ge.pointCoordinate3D(Le[at]).x);if(We<0){if(Ye<Ne)return{idx:at,t:-Ye/(Ne-1-Ye)}}else if(Ne<Ye)return{idx:at,t:(1-Ye)/(Ne+1-Ye)}}return null}(C,R,ne?-1:1);if(!ue)return null;let{idx:de,t:pe}=ue,Me=de>1?_d(C.slice(0,de),R):[],Te=de<C.length?_d(C.slice(de),R):[];Me=Me.map(Le=>new n.P(ru(Le.x),Le.y)),Te=Te.map(Le=>new n.P(ru(Le.x),Le.y));let Se=[...Me];Se.length===0&&Se.push(Te[Te.length-1]);let Be=n.a3(Se[Se.length-1].y,(Te.length===0?Me[0]:Te[0]).y,pe),Oe;return Oe=ne?[new n.P(0,Be),new n.P(0,0),new n.P(1,0),new n.P(1,Be)]:[new n.P(1,Be),new n.P(1,1),new n.P(0,1),new n.P(0,Be)],Se.push(...Oe),Te.length===0?Se.push(Me[0]):Se.push(...Te),{polygon:Se.map(Le=>new n._(Le.x,Le.y)),unwrapped:!1}}(h,g);if(b)return b;let M=function(C,R){let z=!1,B=-1/0,G=0;for(let Z=0;Z<C.length-1;Z++)C[Z].x>B&&(B=C[Z].x,G=Z);for(let Z=0;Z<C.length-1;Z++){let te=(G+Z)%(C.length-1),ne=C[te],ce=C[te+1];Math.abs(ne.x-ce.x)>.5&&(ne.x<ce.x?(ne.x+=1,te===0&&(C[C.length-1].x+=1)):(ce.x+=1,te+1===C.length-1&&(C[0].x+=1)),z=!0)}let W=n.ak(R.center.lng);return z&&W<Math.abs(W-1)&&C.forEach(Z=>{Z.x-=1}),{polygon:C,unwrapped:z}}(_d(h,g).map(C=>new n.P(ru(C.x),C.y)),g);return{polygon:M.polygon.map(C=>new n._(C.x,C.y)),unwrapped:M.unwrapped}}}function _d(_,h){return n.cE(_,g=>{let b=h.pointCoordinate3D(g);g.x=b.x,g.y=b.y},1/256)}function ru(_){return _<0?1+_%1:_%1}function ah(_){return 100*_|0}function xP(_,h){let g=n.ae.identity([]);return n.ae.scale(g,g,[.5*_.width,.5*-_.height,1]),n.ae.translate(g,g,[1,-1,0]),n.ae.multiply(g,g,_.calculateProjMatrix(h.toUnwrapped())),Float32Array.from(g)}function nu(_,h,g,b,M,C,R,z=!1){let B=_.tilesIn(b,R,z);B.sort(d1);let G=[];for(let Z of B)G.push({wrappedTileID:Z.tile.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(h,g,_._state,Z,M,C,xP(_.transform,Z.tile.tileID),z)});let W=function(Z){let te={},ne={};for(let ce of Z){let ue=ce.queryResults,de=ce.wrappedTileID,pe=ne[de]=ne[de]||{};for(let Me in ue){let Te=ue[Me],Se=pe[Me]=pe[Me]||{},Be=te[Me]=te[Me]||[];for(let Oe of Te)Se[Oe.featureIndex]||(Se[Oe.featureIndex]=!0,Be.push(Oe))}}return te}(G);for(let Z in W)W[Z].forEach(te=>{let ne=te.feature,ce=ne.layer;ce&&ce.type!=="background"&&ce.type!=="sky"&&ce.type!=="slot"&&(ne.source=ce.source,ce["source-layer"]&&(ne.sourceLayer=ce["source-layer"]),ne.state=ne.id!==void 0?_.getFeatureState(ce["source-layer"],ne.id):{})});return W}function bP(_,h){let g=_.getRenderableIds().map(C=>_.getTileByID(C)),b=[],M={};for(let C=0;C<g.length;C++){let R=g[C],z=R.tileID.canonical.key;M[z]||(M[z]=!0,R.querySourceFeatures(b,h))}return b}function d1(_,h){let g=_.tileID,b=h.tileID;return g.overscaledZ-b.overscaledZ||g.canonical.y-b.canonical.y||g.wrap-b.wrap||g.canonical.x-b.canonical.x}class Fa{constructor(h){this.style=h,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let h=!1,g=!1;for(let b in this.style._mergedLayers){let M=this.style._mergedLayers[b];if(M.type==="fill-extrusion")this.layers.push({layer:M,visible:h,visibilityChanged:g});else if(M.type==="model"){let C=this.style.getLayerSource(M);C&&C.type==="batched-model"&&this.layers.push({layer:M,visible:h,visibilityChanged:g})}}}onNewFrame(h){this.layersGotHidden=!1;for(let g of this.layers){let b=g.layer,M=!1;b.type==="fill-extrusion"?M=!b.isHidden(h)&&b.paint.get("fill-extrusion-opacity")>0:b.type==="model"&&(M=!b.isHidden(h)&&b.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!M&&g.visible,g.visible=M}}updateZOffset(h,g){this.currentBuildingBuckets=[];for(let M of this.layers){let C=M.layer,R=this.style.getLayerSourceCache(C),z=1;C.type==="fill-extrusion"&&(z=M.visible?C.paint.get("fill-extrusion-vertical-scale"):0);let B=R?R.getTile(g):null;if(!B&&R&&g.canonical.z>R.getSource().minzoom){let G=g.scaledTo(Math.min(R.getSource().maxzoom,g.overscaledZ-1));for(;G.overscaledZ>=R.getSource().minzoom&&(B=R.getTile(G),!B&&G.overscaledZ!==0);)G=G.scaledTo(G.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:B?B.getBucket(C):null,tileID:B?B.tileID:g,verticalScale:z})}h.hasAnyZOffset=!1;let b=!1;for(let M=0;M<h.symbolInstances.length;M++){let C=h.symbolInstances.get(M),R=C.zOffset,z=this._getHeightAtTileOffset(g,C.tileAnchorX,C.tileAnchorY);C.zOffset=z!==Number.NEGATIVE_INFINITY?z:R,b||R===C.zOffset||(b=!0),h.hasAnyZOffset||C.zOffset===0||(h.hasAnyZOffset=!0)}b&&(h.zOffsetBuffersNeedUpload=!0,h.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(h,g,b,M){let C=g,R=b;if(h.canonical.z!==M.canonical.z){let z=M.canonical,B=1/(1<<h.canonical.z-z.z);C=(g+h.canonical.x*n.a4)*B-z.x*n.a4|0,R=(b+h.canonical.y*n.a4)*B-z.y*n.a4|0}return{tileX:C,tileY:R}}_getHeightAtTileOffset(h,g,b){let M,C;for(let R=0;R<this.layers.length;++R){if(this.layers[R].layer.type!=="fill-extrusion")continue;let{bucket:z,tileID:B,verticalScale:G}=this.currentBuildingBuckets[R];if(!z)continue;let{tileX:W,tileY:Z}=this._mapCoordToOverlappingTile(h,g,b,B),te=z.getHeightAtTileCoord(W,Z);te&&te.height!==void 0&&(te.hidden?M=te.height:C=Math.max(te.height*G,C||0))}if(C!==void 0)return C;for(let R=0;R<this.layers.length;++R){let z=this.layers[R];if(z.layer.type!=="model"||!z.visible)continue;let{bucket:B,tileID:G}=this.currentBuildingBuckets[R];if(!B)continue;let{tileX:W,tileY:Z}=this._mapCoordToOverlappingTile(h,g,b,G),te=B.getHeightAtTileCoord(W,Z);if(te&&!te.hidden)return te.height===void 0&&M!==void 0?Math.min(te.maxHeight,M)*te.verticalScale:te.height?te.height*te.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function wP(_,h){let g={};for(let b in _)b!=="ref"&&(g[b]=_[b]);return n.cG.forEach(b=>{b in h&&(g[b]=h[b])}),g}function Xm(_){_=_.slice();let h=Object.create(null);for(let g=0;g<_.length;g++)h[_[g].id]=_[g];for(let g=0;g<_.length;g++)"ref"in _[g]&&(_[g]=wP(_[g],h[_[g].ref]));return _}let tn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Xp(_,h,g){g.push({command:tn.addSource,args:[_,h[_]]})}function LE(_,h,g){h.push({command:tn.removeSource,args:[_]}),g[_]=!0}function SP(_,h,g,b){LE(_,g,b),Xp(_,h,g)}function $m(_,h,g){let b;for(b in _[g])if(_[g].hasOwnProperty(b)&&b!=="data"&&!n.d(_[g][b],h[g][b]))return!1;for(b in h[g])if(h[g].hasOwnProperty(b)&&b!=="data"&&!n.d(_[g][b],h[g][b]))return!1;return!0}function lh(_,h,g,b,M,C){let R;for(R in h=h||{},_=_||{})_.hasOwnProperty(R)&&(n.d(_[R],h[R])||g.push({command:C,args:[b,R,h[R],M]}));for(R in h)h.hasOwnProperty(R)&&!_.hasOwnProperty(R)&&(n.d(_[R],h[R])||g.push({command:C,args:[b,R,h[R],M]}))}function wv(_){return _.id}function su(_,h){return _[h.id]=h,_}class zE{constructor(h,g){this.reset(h,g)}reset(h,g){this.points=h||[],this._distances=[0];for(let b=1;b<this.points.length;b++)this._distances[b]=this._distances[b-1]+this.points[b].dist(this.points[b-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(g||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(h){if(this.points.length===1)return this.points[0];h=n.au(h,0,1);let g=1,b=this._distances[g],M=h*this.paddedLength+this.padding;for(;b<M&&g<this._distances.length;)b=this._distances[++g];let C=g-1,R=this._distances[C],z=b-R,B=z>0?(M-R)/z:0;return this.points[C].mult(1-B).add(this.points[g].mult(B))}}class Zm{constructor(h,g,b){let M=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(h/b),this.yCellCount=Math.ceil(g/b);for(let R=0;R<this.xCellCount*this.yCellCount;R++)M.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=h,this.height=g,this.xScale=this.xCellCount/h,this.yScale=this.yCellCount/g,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(h,g,b,M,C){this._forEachCell(g,b,M,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(h),this.bboxes.push(g),this.bboxes.push(b),this.bboxes.push(M),this.bboxes.push(C)}insertCircle(h,g,b,M){this._forEachCell(g-M,b-M,g+M,b+M,this._insertCircleCell,this.circleUid++),this.circleKeys.push(h),this.circles.push(g),this.circles.push(b),this.circles.push(M)}_insertBoxCell(h,g,b,M,C,R){this.boxCells[C].push(R)}_insertCircleCell(h,g,b,M,C,R){this.circleCells[C].push(R)}_query(h,g,b,M,C,R){if(b<0||h>this.width||M<0||g>this.height)return!C&&[];let z=[];if(h<=0&&g<=0&&this.width<=b&&this.height<=M){if(C)return!0;for(let B=0;B<this.boxKeys.length;B++)z.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){let G=this.circles[3*B],W=this.circles[3*B+1],Z=this.circles[3*B+2];z.push({key:this.circleKeys[B],x1:G-Z,y1:W-Z,x2:G+Z,y2:W+Z})}return R?z.filter(R):z}return this._forEachCell(h,g,b,M,this._queryCell,z,{hitTest:C,seenUids:{box:{},circle:{}}},R),C?z.length>0:z}_queryCircle(h,g,b,M,C){let R=h-b,z=h+b,B=g-b,G=g+b;if(z<0||R>this.width||G<0||B>this.height)return!M&&[];let W=[];return this._forEachCell(R,B,z,G,this._queryCellCircle,W,{hitTest:M,circle:{x:h,y:g,radius:b},seenUids:{box:{},circle:{}}},C),M?W.length>0:W}query(h,g,b,M,C){return this._query(h,g,b,M,!1,C)}hitTest(h,g,b,M,C){return this._query(h,g,b,M,!0,C)}hitTestCircle(h,g,b,M){return this._queryCircle(h,g,b,!0,M)}_queryCell(h,g,b,M,C,R,z,B){let G=z.seenUids,W=this.boxCells[C];if(W!==null){let te=this.bboxes;for(let ne of W)if(!G.box[ne]){G.box[ne]=!0;let ce=4*ne;if(h<=te[ce+2]&&g<=te[ce+3]&&b>=te[ce+0]&&M>=te[ce+1]&&(!B||B(this.boxKeys[ne]))){if(z.hitTest)return R.push(!0),!0;R.push({key:this.boxKeys[ne],x1:te[ce],y1:te[ce+1],x2:te[ce+2],y2:te[ce+3]})}}}let Z=this.circleCells[C];if(Z!==null){let te=this.circles;for(let ne of Z)if(!G.circle[ne]){G.circle[ne]=!0;let ce=3*ne;if(this._circleAndRectCollide(te[ce],te[ce+1],te[ce+2],h,g,b,M)&&(!B||B(this.circleKeys[ne]))){if(z.hitTest)return R.push(!0),!0;{let ue=te[ce],de=te[ce+1],pe=te[ce+2];R.push({key:this.circleKeys[ne],x1:ue-pe,y1:de-pe,x2:ue+pe,y2:de+pe})}}}}}_queryCellCircle(h,g,b,M,C,R,z,B){let G=z.circle,W=z.seenUids,Z=this.boxCells[C];if(Z!==null){let ne=this.bboxes;for(let ce of Z)if(!W.box[ce]){W.box[ce]=!0;let ue=4*ce;if(this._circleAndRectCollide(G.x,G.y,G.radius,ne[ue+0],ne[ue+1],ne[ue+2],ne[ue+3])&&(!B||B(this.boxKeys[ce])))return R.push(!0),!0}}let te=this.circleCells[C];if(te!==null){let ne=this.circles;for(let ce of te)if(!W.circle[ce]){W.circle[ce]=!0;let ue=3*ce;if(this._circlesCollide(ne[ue],ne[ue+1],ne[ue+2],G.x,G.y,G.radius)&&(!B||B(this.circleKeys[ce])))return R.push(!0),!0}}}_forEachCell(h,g,b,M,C,R,z,B){let G=this._convertToXCellCoord(h),W=this._convertToYCellCoord(g),Z=this._convertToXCellCoord(b),te=this._convertToYCellCoord(M);for(let ne=G;ne<=Z;ne++)for(let ce=W;ce<=te;ce++)if(C.call(this,h,g,b,M,this.xCellCount*ce+ne,R,z,B))return}_convertToXCellCoord(h){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(h*this.xScale)))}_convertToYCellCoord(h){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(h*this.yScale)))}_circlesCollide(h,g,b,M,C,R){let z=M-h,B=C-g,G=b+R;return G*G>z*z+B*B}_circleAndRectCollide(h,g,b,M,C,R,z){let B=(R-M)/2,G=Math.abs(h-(M+B));if(G>B+b)return!1;let W=(z-C)/2,Z=Math.abs(g-(C+W));if(Z>W+b)return!1;if(G<=B||Z<=W)return!0;let te=G-B,ne=Z-W;return te*te+ne*ne<=b*b}}let zo=100;class EP{constructor(h,g,b=new Zm(h.width+200,h.height+200,25),M=new Zm(h.width+200,h.height+200,25)){this.transform=h,this.grid=b,this.ignoredGrid=M,this.pitchfactor=Math.cos(h._pitch)*h.cameraToCenterDistance,this.screenRightBoundary=h.width+zo,this.screenBottomBoundary=h.height+zo,this.gridRightBoundary=h.width+200,this.gridBottomBoundary=h.height+200,this.fogState=g}placeCollisionBox(h,g,b,M,C,R,z,B){let G=b.projectedAnchorX,W=b.projectedAnchorY,Z=b.projectedAnchorZ,te=b.elevation,ne=b.tileID,ce=h.getProjection();if(te&&ne){let[Oe,Le,Ge]=ce.upVector(ne.canonical,b.tileAnchorX,b.tileAnchorY),We=ce.upVectorScale(ne.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;G+=Oe*te*We,W+=Le*te*We,Z+=Ge*te*We}let ue=this.projectAndGetPerspectiveRatio(z,G,W,Z,b.tileID,ce.name==="globe"||!!te||this.transform.pitch>0,ce),de=R*ue.perspectiveRatio,pe=(b.x1*g+M.x-b.padding)*de+ue.point.x,Me=(b.y1*g+M.y-b.padding)*de+ue.point.y,Te=(b.x2*g+M.x+b.padding)*de+ue.point.x,Se=(b.y2*g+M.y+b.padding)*de+ue.point.y,Be=ue.perspectiveRatio<=.55||ue.occluded;return!this.isInsideGrid(pe,Me,Te,Se)||!C&&this.grid.hitTest(pe,Me,Te,Se,B)||Be?{box:[],offscreen:!1,occluded:ue.occluded}:{box:[pe,Me,Te,Se],offscreen:this.isOffscreen(pe,Me,Te,Se),occluded:!1}}placeCollisionCircles(h,g,b,M,C,R,z,B,G,W,Z,te,ne,ce,ue){let de=[],pe=this.transform.elevation,Me=h.getProjection(),Te=pe?pe.getAtTileOffsetFunc(ue,this.transform.center.lat,this.transform.worldSize,Me):null,Se=new n.P(b.tileAnchorX,b.tileAnchorY),{x:Be,y:Oe,z:Le}=Me.projectTilePoint(Se.x,Se.y,ue.canonical);if(Te){let[Pt,ct,_t]=Te(Se);Be+=Pt,Oe+=ct,Le+=_t}let Ge=Me.name==="globe",We=this.projectAndGetPerspectiveRatio(z,Be,Oe,Le,ue,Ge||!!pe||this.transform.pitch>0,Me),{perspectiveRatio:at}=We,Ye=(Z?R/at:R*at)/n.bP,Ne=ql(Be,Oe,Le,B),gt=We.signedDistanceFromCamera>0?Cm(Ye,C,b.lineOffsetX*Ye,b.lineOffsetY*Ye,!1,Ne,Se,b,M,B,{},pe&&!Z?Te:null,Z&&!!pe,Me,ue,Z):null,ft=!1,tt=!1,Bt=!0;if(gt&&!We.occluded){let Pt=.5*ne*at+ce,ct=new n.P(-100,-100),_t=new n.P(this.screenRightBoundary,this.screenBottomBoundary),Qe=new zE,{first:Rt,last:Ft}=gt,oi=Rt.path.length,ci=[];for(let ji=oi-1;ji>=1;ji--)ci.push(Rt.path[ji]);for(let ji=1;ji<Ft.path.length;ji++)ci.push(Ft.path[ji]);let Si=2.5*Pt;G&&(ci=ci.map(([ji,cr,Wi],gr)=>(Te&&!Ge&&(Wi=Te(gr<oi-1?Rt.tilePath[oi-1-gr]:Ft.tilePath[gr-oi+2])[2]),ql(ji,cr,Wi,G))),ci.some(ji=>ji[3]<=0)&&(ci=[]));let hi=[];if(ci.length>0){let ji=1/0,cr=-1/0,Wi=1/0,gr=-1/0;for(let Or of ci)ji=Math.min(ji,Or[0]),Wi=Math.min(Wi,Or[1]),cr=Math.max(cr,Or[0]),gr=Math.max(gr,Or[1]);cr>=ct.x&&ji<=_t.x&&gr>=ct.y&&Wi<=_t.y&&(hi=[ci.map(Or=>new n.P(Or[0],Or[1]))],(ji<ct.x||cr>_t.x||Wi<ct.y||gr>_t.y)&&(hi=n.cH(hi,ct.x,ct.y,_t.x,_t.y)))}for(let ji of hi){Qe.reset(ji,.25*Pt);let cr=0;cr=Qe.length<=.5*Pt?1:Math.ceil(Qe.paddedLength/Si)+1;for(let Wi=0;Wi<cr;Wi++){let gr=Wi/Math.max(cr-1,1),Or=Qe.lerp(gr),zn=Or.x+zo,xn=Or.y+zo;de.push(zn,xn,Pt,0);let Ur=zn-Pt,yn=xn-Pt,_r=zn+Pt,br=xn+Pt;if(Bt=Bt&&this.isOffscreen(Ur,yn,_r,br),tt=tt||this.isInsideGrid(Ur,yn,_r,br),!g&&this.grid.hitTestCircle(zn,xn,Pt,te)&&(ft=!0,!W))return{circles:[],offscreen:!1,collisionDetected:ft,occluded:!1}}}}return{circles:!W&&ft||!tt?[]:de,offscreen:Bt,collisionDetected:ft,occluded:We.occluded}}queryRenderedSymbols(h){if(h.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let g=[],b=1/0,M=1/0,C=-1/0,R=-1/0;for(let W of h){let Z=new n.P(W.x+zo,W.y+zo);b=Math.min(b,Z.x),M=Math.min(M,Z.y),C=Math.max(C,Z.x),R=Math.max(R,Z.y),g.push(Z)}let z=this.grid.query(b,M,C,R).concat(this.ignoredGrid.query(b,M,C,R)),B={},G={};for(let W of z){let Z=W.key;if(B[Z.bucketInstanceId]===void 0&&(B[Z.bucketInstanceId]={}),B[Z.bucketInstanceId][Z.featureIndex])continue;let te=[new n.P(W.x1,W.y1),new n.P(W.x2,W.y1),new n.P(W.x2,W.y2),new n.P(W.x1,W.y2)];n.cI(g,te)&&(B[Z.bucketInstanceId][Z.featureIndex]=!0,G[Z.bucketInstanceId]===void 0&&(G[Z.bucketInstanceId]=[]),G[Z.bucketInstanceId].push(Z.featureIndex))}return G}insertCollisionBox(h,g,b,M,C){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:b,featureIndex:M,collisionGroupID:C},h[0],h[1],h[2],h[3])}insertCollisionCircles(h,g,b,M,C){let R=g?this.ignoredGrid:this.grid,z={bucketInstanceId:b,featureIndex:M,collisionGroupID:C};for(let B=0;B<h.length;B+=4)R.insertCircle(z,h[B],h[B+1],h[B+2])}projectAndGetPerspectiveRatio(h,g,b,M,C,R,z){let B=[g,b,M,1],G=!1;M||this.transform.pitch>0?(n.aB.transformMat4(B,B,h),this.fogState&&C&&z.name!=="globe"&&(G=function(te,ne,ce,ue,de,pe){let Me=pe.calculateFogTileMatrix(de),Te=[ne,ce,ue];return n.$.transformMat4(Te,Te,Me),vr(te,n.$.length(Te),pe.pitch,pe._fov)}(this.fogState,g,b,M,C.toUnwrapped(),this.transform)>.9)):qx(B,B,h);let W=B[3];return{point:new n.P((B[0]/W+1)/2*this.transform.width+zo,(-B[1]/W+1)/2*this.transform.height+zo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(z)/W*.5,1.5),signedDistanceFromCamera:W,occluded:R&&B[2]>W||G}}isOffscreen(h,g,b,M){return b<zo||h>=this.screenRightBoundary||M<zo||g>this.screenBottomBoundary}isInsideGrid(h,g,b,M){return b>=0&&h<this.gridRightBoundary&&M>=0&&g<this.gridBottomBoundary}getViewportMatrix(){let h=n.ae.identity([]);return n.ae.translate(h,h,[-100,-100,0]),h}}class FE{constructor(h,g,b,M){this.opacity=h?Math.max(0,Math.min(1,h.opacity+(h.placed?g:-g))):M&&b?1:0,this.placed=b}isHidden(){return this.opacity===0&&!this.placed}}class Qm{constructor(h,g,b,M,C,R=!1){this.text=new FE(h?h.text:null,g,b,C),this.icon=new FE(h?h.icon:null,g,M,C),this.clipped=R}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Sv{constructor(h,g,b,M=!1){this.text=h,this.icon=g,this.skipFade=b,this.clipped=M}}class MP{constructor(){this.invProjMatrix=n.ae.create(),this.viewportMatrix=n.ae.create(),this.circles=[]}}class p1{constructor(h,g,b,M,C){this.bucketInstanceId=h,this.featureIndex=g,this.sourceLayerIndex=b,this.bucketIndex=M,this.tileID=C}}class kE{constructor(h){this.crossSourceCollisions=h,this.maxGroupID=0,this.collisionGroups={}}get(h){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[h]){let g=++this.maxGroupID;this.collisionGroups[h]={ID:g,predicate:b=>b.collisionGroupID===g}}return this.collisionGroups[h]}}function f1(_,h,g,b,M){let{horizontalAlign:C,verticalAlign:R}=n.bS(_),z=-(C-.5)*h,B=-(R-.5)*g,G=n.bR(_,b);return new n.P(z+G[0]*M,B+G[1]*M)}function Ev(_,h,g,b,M){let C=new n.P(_,h);return g&&C._rotate(b?M:-M),C}class NE{constructor(h,g,b,M,C,R){this.transform=h.clone(),this.projection=h.projection.name,this.collisionIndex=new EP(this.transform,C),this.buildingIndex=R,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new kE(b),this.collisionCircleArrays={},this.prevPlacement=M,M&&(M.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(h,g,b,M){let C=b.getBucket(g),R=b.latestFeatureIndex;if(!C||!R||g.fqid!==C.layerIds[0])return;let z=C.layers[0].layout,B=b.collisionBoxArray,G=Math.pow(2,this.transform.zoom-b.tileID.overscaledZ),W=b.tileSize/n.a4,Z=b.tileID.toUnwrapped();this.transform.setProjection(C.projection);let te=(ne=b.tileID,ce=C.getProjection(),ue=this.transform,ce.name===this.projection?ue.calculateProjMatrix(ne.toUnwrapped()):md(ue,ce,ne));var ne,ce,ue;let de=z.get("text-pitch-alignment")==="map",pe=z.get("text-rotation-alignment")==="map";g.compileFilter();let Me=g.dynamicFilter(),Te=g.dynamicFilterNeedsFeature(),Se=this.transform.calculatePixelsToTileUnitsMatrix(b),Be=rv(te,b.tileID.canonical,de,pe,this.transform,C.getProjection(),Se),Oe=null;if(de){let We=nv(te,b.tileID.canonical,de,pe,this.transform,C.getProjection(),Se);Oe=n.ae.multiply([],this.transform.labelPlaneMatrix,We)}let Le=null;Me&&b.latestFeatureIndex&&(Le={unwrappedTileID:Z,dynamicFilter:Me,dynamicFilterNeedsFeature:Te,featureIndex:b.latestFeatureIndex}),this.retainedQueryData[C.bucketInstanceId]=new p1(C.bucketInstanceId,R,C.sourceLayerIndex,C.index,b.tileID);let Ge={bucket:C,layout:z,posMatrix:te,textLabelPlaneMatrix:Be,labelToScreenMatrix:Oe,clippingData:Le,scale:G,textPixelRatio:W,holdingForFade:b.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:n.aE(C.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:n.aE(C.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(M)for(let We of C.sortKeyRanges){let{sortKey:at,symbolInstanceStart:Ye,symbolInstanceEnd:Ne}=We;h.push({sortKey:at,symbolInstanceStart:Ye,symbolInstanceEnd:Ne,parameters:Ge})}else h.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:Ge})}attemptAnchorPlacement(h,g,b,M,C,R,z,B,G,W,Z,te,ne,ce,ue,de,pe,Me){let{textOffset0:Te,textOffset1:Se,crossTileID:Be}=te,Oe=[Te,Se],Le=f1(h,b,M,Oe,C),Ge=this.collisionIndex.placeCollisionBox(ce,C,g,Ev(Le.x,Le.y,R,z,this.transform.angle),Z,B,G,W.predicate);if(de){let We=ce.getSymbolInstanceIconSize(Me,this.transform.zoom,te.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ce,We,de,Ev(Le.x,Le.y,R,z,this.transform.angle),Z,B,G,W.predicate).box.length===0)return}if(Ge.box.length>0){let We;return this.prevPlacement&&this.prevPlacement.variableOffsets[Be]&&this.prevPlacement.placements[Be]&&this.prevPlacement.placements[Be].text&&(We=this.prevPlacement.variableOffsets[Be].anchor),this.variableOffsets[Be]={textOffset:Oe,width:b,height:M,anchor:h,textScale:C,prevAnchor:We},this.markUsedJustification(ce,h,te,ue),ce.allowVerticalPlacement&&(this.markUsedOrientation(ce,ue,te),this.placedOrientations[Be]=ue),{shift:Le,placedGlyphBoxes:Ge}}}placeLayerBucketPart(h,g,b,M){let{bucket:C,layout:R,posMatrix:z,textLabelPlaneMatrix:B,labelToScreenMatrix:G,clippingData:W,textPixelRatio:Z,holdingForFade:te,collisionBoxArray:ne,partiallyEvaluatedTextSize:ce,partiallyEvaluatedIconSize:ue,collisionGroup:de}=h.parameters,pe=R.get("text-optional"),Me=R.get("icon-optional"),Te=R.get("text-allow-overlap"),Se=R.get("icon-allow-overlap"),Be=R.get("text-rotation-alignment")==="map",Oe=R.get("text-pitch-alignment")==="map",Le=R.get("symbol-z-order")==="viewport-y",Ge=R.get("symbol-z-elevate");this.transform.setProjection(C.projection);let We=Te&&(Se||!C.hasIconData()||Me),at=Se&&(Te||!C.hasTextData()||pe);!C.collisionArrays&&ne&&C.deserializeCollisionBoxes(ne),b&&M&&C.updateCollisionDebugBuffers(this.transform.zoom,ne);let Ye=(Ne,gt,ft)=>{let{crossTileID:tt,numVerticalGlyphVertices:Bt}=Ne;if(W){let _r={zoom:this.transform.zoom,pitch:this.transform.pitch},br=null;if(W.dynamicFilterNeedsFeature){let ur=this.retainedQueryData[C.bucketInstanceId];br=W.featureIndex.loadFeature({featureIndex:Ne.featureIndex,bucketIndex:ur.bucketIndex,sourceLayerIndex:ur.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,W.dynamicFilter)(_r,br,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new n.P(Ne.tileAnchorX,Ne.tileAnchorY),this.transform.calculateDistanceTileData(W.unwrappedTileID)))return this.placements[tt]=new Sv(!1,!1,!1,!0),void g.add(tt)}if(g.has(tt))return;if(te)return void(this.placements[tt]=new Sv(!1,!1,!1));let Pt=!1,ct=!1,_t=!0,Qe=!1,Rt=!1,Ft=null,oi={box:null,offscreen:null,occluded:null},ci={box:null,offscreen:null,occluded:null},Si=null,hi=null,ji=null,cr=0,Wi=0,gr=0;ft.textFeatureIndex?cr=ft.textFeatureIndex:Ne.useRuntimeCollisionCircles&&(cr=Ne.featureIndex),ft.verticalTextFeatureIndex&&(Wi=ft.verticalTextFeatureIndex);let Or=_r=>{_r.tileID=this.retainedQueryData[C.bucketInstanceId].tileID;let br=this.transform.elevation;_r.elevation=Ne.zOffset+(br?br.getAtTileOffset(_r.tileID,_r.tileAnchorX,_r.tileAnchorY):0)},zn=ft.textBox;if(zn){Or(zn);let _r=ur=>{let Xr=n.aF.horizontal;if(C.allowVerticalPlacement&&!ur&&this.prevPlacement){let Ar=this.prevPlacement.placedOrientations[tt];Ar&&(this.placedOrientations[tt]=Ar,Xr=Ar,this.markUsedOrientation(C,Xr,Ne))}return Xr},br=(ur,Xr)=>{if(C.allowVerticalPlacement&&Bt>0&&ft.verticalTextBox){for(let Ar of C.writingModes)if(Ar===n.aF.vertical?(oi=Xr(),ci=oi):oi=ur(),oi&&oi.box&&oi.box.length)break}else oi=ur()};if(R.get("text-variable-anchor")){let ur=R.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[tt]){let er=this.prevPlacement.variableOffsets[tt];ur.indexOf(er.anchor)>0&&(ur=ur.filter(Is=>Is!==er.anchor),ur.unshift(er.anchor))}let Xr=(er,Is,Ps)=>{let Fo=C.getSymbolInstanceTextSize(ce,Ne,this.transform.zoom,gt),ko=(er.x2-er.x1)*Fo+2*er.padding,yo=(er.y2-er.y1)*Fo+2*er.padding,No=Ne.hasIconTextFit&&!Se?Is:null;No&&Or(No);let no={box:[],offscreen:!1,occluded:!1},vo=Te?2*ur.length:ur.length;for(let Ht=0;Ht<vo;++Ht){let Mi=this.attemptAnchorPlacement(ur[Ht%ur.length],er,ko,yo,Fo,Be,Oe,Z,z,de,Ht>=ur.length,Ne,gt,C,Ps,No,ce,ue);if(Mi&&(no=Mi.placedGlyphBoxes,no&&no.box&&no.box.length)){Pt=!0,Ft=Mi.shift;break}}return no};br(()=>Xr(zn,ft.iconBox,n.aF.horizontal),()=>{let er=ft.verticalTextBox;return er&&Or(er),C.allowVerticalPlacement&&!(oi&&oi.box&&oi.box.length)&&Bt>0&&er?Xr(er,ft.verticalIconBox,n.aF.vertical):{box:null,offscreen:null,occluded:null}}),oi&&(Pt=oi.box,_t=oi.offscreen,Qe=oi.occluded);let Ar=_r(!(!oi||!oi.box));if(!Pt&&this.prevPlacement){let er=this.prevPlacement.variableOffsets[tt];er&&(this.variableOffsets[tt]=er,this.markUsedJustification(C,er.anchor,Ne,Ar))}}else{let ur=(Xr,Ar)=>{let er=C.getSymbolInstanceTextSize(ce,Ne,this.transform.zoom,gt),Is=this.collisionIndex.placeCollisionBox(C,er,Xr,new n.P(0,0),Te,Z,z,de.predicate);return Is&&Is.box&&Is.box.length&&(this.markUsedOrientation(C,Ar,Ne),this.placedOrientations[tt]=Ar),Is};br(()=>ur(zn,n.aF.horizontal),()=>{let Xr=ft.verticalTextBox;return C.allowVerticalPlacement&&Bt>0&&Xr?(Or(Xr),ur(Xr,n.aF.vertical)):{box:null,offscreen:null,occluded:null}}),_r(!!(oi&&oi.box&&oi.box.length))}}if(Si=oi,Pt=Si&&Si.box&&Si.box.length>0,_t=Si&&Si.offscreen,Qe=Si&&Si.occluded,Ne.useRuntimeCollisionCircles){let _r=C.text.placedSymbolArray.get(Ne.centerJustifiedTextSymbolIndex>=0?Ne.centerJustifiedTextSymbolIndex:Ne.verticalPlacedTextSymbolIndex),br=n.aG(C.textSizeData,ce,_r),ur=R.get("text-padding");hi=this.collisionIndex.placeCollisionCircles(C,Te,_r,C.lineVertexArray,C.glyphOffsetArray,br,z,B,G,b,Oe,de.predicate,Ne.collisionCircleDiameter*br/n.bP,ur,this.retainedQueryData[C.bucketInstanceId].tileID),Pt=Te||hi.circles.length>0&&!hi.collisionDetected,_t=_t&&hi.offscreen,Qe=hi.occluded}if(ft.iconFeatureIndex&&(gr=ft.iconFeatureIndex),ft.iconBox){let _r=br=>{Or(br);let ur=Ne.hasIconTextFit&&Ft?Ev(Ft.x,Ft.y,Be,Oe,this.transform.angle):new n.P(0,0),Xr=C.getSymbolInstanceIconSize(ue,this.transform.zoom,Ne.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,Xr,br,ur,Se,Z,z,de.predicate)};ci&&ci.box&&ci.box.length&&ft.verticalIconBox?(ji=_r(ft.verticalIconBox),ct=ji.box.length>0):(ji=_r(ft.iconBox),ct=ji.box.length>0),_t=_t&&ji.offscreen,Rt=ji.occluded}let xn=pe||Ne.numHorizontalGlyphVertices===0&&Bt===0,Ur=Me||Ne.numIconVertices===0;if(xn||Ur?Ur?xn||(ct=ct&&Pt):Pt=ct&&Pt:ct=Pt=ct&&Pt,Pt&&Si&&Si.box&&this.collisionIndex.insertCollisionBox(Si.box,R.get("text-ignore-placement"),C.bucketInstanceId,ci&&ci.box&&Wi?Wi:cr,de.ID),ct&&ji&&this.collisionIndex.insertCollisionBox(ji.box,R.get("icon-ignore-placement"),C.bucketInstanceId,gr,de.ID),hi&&(Pt&&this.collisionIndex.insertCollisionCircles(hi.circles,R.get("text-ignore-placement"),C.bucketInstanceId,cr,de.ID),b)){let _r=C.bucketInstanceId,br=this.collisionCircleArrays[_r];br===void 0&&(br=this.collisionCircleArrays[_r]=new MP);for(let ur=0;ur<hi.circles.length;ur+=4)br.circles.push(hi.circles[ur+0]),br.circles.push(hi.circles[ur+1]),br.circles.push(hi.circles[ur+2]),br.circles.push(hi.collisionDetected?1:0)}let yn=C.projection.name!=="globe";We=We&&(yn||!Qe),at=at&&(yn||!Rt),this.placements[tt]=new Sv(Pt||We,ct||at,_t||C.justReloaded),g.add(tt)};if(Ge&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,this.retainedQueryData[C.bucketInstanceId].tileID),C.updateZOffset()),Le){let Ne=C.getSortedSymbolIndexes(this.transform.angle);for(let gt=Ne.length-1;gt>=0;--gt){let ft=Ne[gt];Ye(C.symbolInstances.get(ft),ft,C.collisionArrays[ft])}C.hasAnyZOffset&&n.w(`${C.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(C.hasAnyZOffset){let Ne=C.getSortedIndexesByZOffset();for(let gt=0;gt<Ne.length;++gt){let ft=Ne[gt];Ye(C.symbolInstances.get(ft),ft,C.collisionArrays[ft])}}else for(let Ne=h.symbolInstanceStart;Ne<h.symbolInstanceEnd;Ne++)Ye(C.symbolInstances.get(Ne),Ne,C.collisionArrays[Ne]);if(b&&C.bucketInstanceId in this.collisionCircleArrays){let Ne=this.collisionCircleArrays[C.bucketInstanceId];n.ae.invert(Ne.invProjMatrix,z),Ne.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(h,g,b,M){let{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:R,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:B,crossTileID:G}=b,W=n.cM(g),Z=M===n.aF.vertical?B:W==="left"?C:W==="center"?R:W==="right"?z:-1;C>=0&&(h.text.placedSymbolArray.get(C).crossTileID=Z>=0&&C!==Z?0:G),R>=0&&(h.text.placedSymbolArray.get(R).crossTileID=Z>=0&&R!==Z?0:G),z>=0&&(h.text.placedSymbolArray.get(z).crossTileID=Z>=0&&z!==Z?0:G),B>=0&&(h.text.placedSymbolArray.get(B).crossTileID=Z>=0&&B!==Z?0:G)}markUsedOrientation(h,g,b){let M=g===n.aF.horizontal||g===n.aF.horizontalOnly?g:0,C=g===n.aF.vertical?g:0,{leftJustifiedTextSymbolIndex:R,centerJustifiedTextSymbolIndex:z,rightJustifiedTextSymbolIndex:B,verticalPlacedTextSymbolIndex:G}=b,W=h.text.placedSymbolArray;R>=0&&(W.get(R).placedOrientation=M),z>=0&&(W.get(z).placedOrientation=M),B>=0&&(W.get(B).placedOrientation=M),G>=0&&(W.get(G).placedOrientation=C)}commit(h){this.commitTime=h,this.zoomAtLastRecencyCheck=this.transform.zoom;let g=this.prevPlacement,b=!1;this.prevZoomAdjustment=g?g.zoomAdjustment(this.transform.zoom):0;let M=g?g.symbolFadeChange(h):1,C=g?g.opacities:{},R=g?g.variableOffsets:{},z=g?g.placedOrientations:{};for(let B in this.placements){let G=this.placements[B],W=C[B];W?(this.opacities[B]=new Qm(W,M,G.text,G.icon,null,G.clipped),b=b||G.text!==W.text.placed||G.icon!==W.icon.placed):(this.opacities[B]=new Qm(null,M,G.text,G.icon,G.skipFade,G.clipped),b=b||G.text||G.icon)}for(let B in C){let G=C[B];if(!this.opacities[B]){let W=new Qm(G,M,!1,!1);W.isHidden()||(this.opacities[B]=W,b=b||G.text.placed||G.icon.placed)}}for(let B in R)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=R[B]);for(let B in z)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=z[B]);b?this.lastPlacementChangeTime=h:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=g?g.lastPlacementChangeTime:h)}updateLayerOpacities(h,g,b,M){let C=new Set;for(let R of g){let z=R.getBucket(h);z&&R.latestFeatureIndex&&h.fqid===z.layerIds[0]&&(this.updateBucketOpacities(z,C,R.collisionBoxArray,b,M,R.tileID,h.scope),z.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(z,R.tileID),z.updateZOffset()))}}updateBucketOpacities(h,g,b,M,C,R,z){h.hasTextData()&&h.text.opacityVertexArray.clear(),h.hasIconData()&&h.icon.opacityVertexArray.clear(),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexArray.clear(),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexArray.clear();let B=h.layers[0].layout,G=!!h.layers[0].dynamicFilter(),W=new Qm(null,0,!1,!1,!0),Z=B.get("text-allow-overlap"),te=B.get("icon-allow-overlap"),ne=B.get("text-variable-anchor"),ce=B.get("text-rotation-alignment")==="map",ue=B.get("text-pitch-alignment")==="map",de=new Qm(null,0,Z&&(te||!h.hasIconData()||B.get("icon-optional")),te&&(Z||!h.hasTextData()||B.get("text-optional")),!0);!h.collisionArrays&&b&&(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData())&&h.deserializeCollisionBoxes(b);let pe=(Te,Se,Be)=>{for(let Oe=0;Oe<Se/4;Oe++)Te.opacityVertexArray.emplaceBack(Be)},Me=0;C&&h.updateReplacement(R,C);for(let Te=0;Te<h.symbolInstances.length;Te++){let Se=h.symbolInstances.get(Te),{numHorizontalGlyphVertices:Be,numVerticalGlyphVertices:Oe,crossTileID:Le,numIconVertices:Ge,tileAnchorX:We,tileAnchorY:at}=Se,Ye=g.has(Le),Ne=this.opacities[Le];Ye?Ne=W:Ne||(Ne=de,this.opacities[Le]=Ne),g.add(Le);let gt=Be>0||Oe>0,ft=Ge>0,tt=this.placedOrientations[Le],Bt=tt===n.aF.vertical,Pt=tt===n.aF.horizontal||tt===n.aF.horizontalOnly;!gt&&!ft||Ne.isHidden()||Me++;let ct=!1;if((gt||ft)&&C)for(let _t of h.activeReplacements){if(n.cJ(_t,M,n.cw.Symbol,z)||_t.min.x>We||We>_t.max.x||_t.min.y>at||at>_t.max.y)continue;let Qe=n.cK(We,at,R.canonical,_t.footprintTileId.canonical);if(ct=n.cL(Qe,_t),ct)break}if(gt){let _t=ct?ch:el(Ne.text);pe(h.text,Be,Bt?ch:_t),pe(h.text,Oe,Pt?ch:_t);let Qe=Ne.text.isHidden(),{leftJustifiedTextSymbolIndex:Rt,centerJustifiedTextSymbolIndex:Ft,rightJustifiedTextSymbolIndex:oi,verticalPlacedTextSymbolIndex:ci}=Se,Si=h.text.placedSymbolArray,hi=Qe||Bt?1:0;Rt>=0&&(Si.get(Rt).hidden=hi),Ft>=0&&(Si.get(Ft).hidden=hi),oi>=0&&(Si.get(oi).hidden=hi),ci>=0&&(Si.get(ci).hidden=Qe||Pt?1:0);let ji=this.variableOffsets[Le];ji&&this.markUsedJustification(h,ji.anchor,Se,tt);let cr=this.placedOrientations[Le];cr&&(this.markUsedJustification(h,"left",Se,cr),this.markUsedOrientation(h,cr,Se))}if(ft){let _t=ct?ch:el(Ne.icon),{placedIconSymbolIndex:Qe,verticalPlacedIconSymbolIndex:Rt}=Se,Ft=h.icon.placedSymbolArray,oi=Ne.icon.isHidden()?1:0;Qe>=0&&(pe(h.icon,Ge,Bt?ch:_t),Ft.get(Qe).hidden=oi),Rt>=0&&(pe(h.icon,Se.numVerticalIconVertices,Pt?ch:_t),Ft.get(Rt).hidden=oi)}if(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData()){let _t=h.collisionArrays[Te];if(_t){let Qe=new n.P(0,0),Rt=!0;if(_t.textBox||_t.verticalTextBox){if(ne){let oi=this.variableOffsets[Le];oi?(Qe=f1(oi.anchor,oi.width,oi.height,oi.textOffset,oi.textScale),ce&&Qe._rotate(ue?this.transform.angle:-this.transform.angle)):Rt=!1}G&&(Rt=!Ne.clipped),_t.textBox&&Tc(h.textCollisionBox.collisionVertexArray,Ne.text.placed,!Rt||Bt,Qe.x,Qe.y),_t.verticalTextBox&&Tc(h.textCollisionBox.collisionVertexArray,Ne.text.placed,!Rt||Pt,Qe.x,Qe.y)}let Ft=Rt&&!!(!Pt&&_t.verticalIconBox);_t.iconBox&&Tc(h.iconCollisionBox.collisionVertexArray,Ne.icon.placed,Ft,Se.hasIconTextFit?Qe.x:0,Se.hasIconTextFit?Qe.y:0),_t.verticalIconBox&&Tc(h.iconCollisionBox.collisionVertexArray,Ne.icon.placed,!Ft,Se.hasIconTextFit?Qe.x:0,Se.hasIconTextFit?Qe.y:0)}}}if(h.fullyClipped=Me===0,h.sortFeatures(this.transform.angle),this.retainedQueryData[h.bucketInstanceId]&&(this.retainedQueryData[h.bucketInstanceId].featureSortOrder=h.featureSortOrder),h.hasTextData()&&h.text.opacityVertexBuffer&&h.text.opacityVertexBuffer.updateData(h.text.opacityVertexArray),h.hasIconData()&&h.icon.opacityVertexBuffer&&h.icon.opacityVertexBuffer.updateData(h.icon.opacityVertexArray),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexBuffer&&h.iconCollisionBox.collisionVertexBuffer.updateData(h.iconCollisionBox.collisionVertexArray),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexBuffer&&h.textCollisionBox.collisionVertexBuffer.updateData(h.textCollisionBox.collisionVertexArray),h.bucketInstanceId in this.collisionCircleArrays){let Te=this.collisionCircleArrays[h.bucketInstanceId];h.placementInvProjMatrix=Te.invProjMatrix,h.placementViewportMatrix=Te.viewportMatrix,h.collisionCircleArray=Te.circles,delete this.collisionCircleArrays[h.bucketInstanceId]}}symbolFadeChange(h){return this.fadeDuration===0?1:(h-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(h){return Math.max(0,(this.transform.zoom-h)/1.5)}hasTransitions(h){return this.stale||h-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(h,g){let b=this.zoomAtLastRecencyCheck===g?1-this.zoomAdjustment(g):1;return this.zoomAtLastRecencyCheck=g,this.commitTime+this.fadeDuration*b>h}setStale(){this.stale=!0}}function Tc(_,h,g,b,M){_.emplaceBack(h?1:0,g?1:0,b||0,M||0),_.emplaceBack(h?1:0,g?1:0,b||0,M||0),_.emplaceBack(h?1:0,g?1:0,b||0,M||0),_.emplaceBack(h?1:0,g?1:0,b||0,M||0)}let Mv=Math.pow(2,25),BE=Math.pow(2,24),UE=Math.pow(2,17),Km=Math.pow(2,16),Jm=Math.pow(2,9),jE=Math.pow(2,8),m1=Math.pow(2,1);function el(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;let h=_.placed?1:0,g=Math.floor(127*_.opacity);return g*Mv+h*BE+g*UE+h*Km+g*Jm+h*jE+g*m1+h}let ch=0;class ti{constructor(h){this._sortAcrossTiles=h.layout.get("symbol-z-order")!=="viewport-y"&&h.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(h,g,b,M,C){let R=this._bucketParts;for(;this._currentTileIndex<h.length;)if(g.getBucketParts(R,M,h[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort((z,B)=>z.sortKey-B.sortKey));this._currentPartIndex<R.length;){let z=R[this._currentPartIndex];if(g.placeLayerBucketPart(z,this._seenCrossTileIDs,b,z.symbolInstanceStart===0),this._currentPartIndex++,C())return!0}return!1}}class VE{constructor(h,g,b,M,C,R,z,B,G){this.placement=new NE(h,C,R,z,B,G),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=b,this._showCollisionBoxes=M,this._done=!1}isDone(){return this._done}continuePlacement(h,g,b,M){let C=n.e.now(),R=()=>{let z=n.e.now()-C;return!this._forceFullPlacement&&z>2};for(;this._currentPlacementIndex>=0;){let z=g[h[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(z.type==="symbol"&&(!z.minzoom||z.minzoom<=B)&&(!z.maxzoom||z.maxzoom>B)){let G=z,W=G.layout.get("symbol-z-elevate"),Z=this._inProgressLayer=this._inProgressLayer||new ti(G),te=n.am(z.source,z.scope);if(Z.continuePlacement(W?M[te]:b[te],this.placement,this._showCollisionBoxes,z,R))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(h){return this.placement.commit(h),this.placement}}let eg=512/n.a4/2;class g1{constructor(h,g,b){this.tileID=h,this.bucketInstanceId=b,this.index=new n.cN(g.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let M=h.canonical.x*n.a4,C=h.canonical.y*n.a4;for(let R=0;R<g.length;R++){let{key:z,crossTileID:B,tileAnchorX:G,tileAnchorY:W}=g.get(R),Z=Math.floor((M+G)*eg),te=Math.floor((C+W)*eg);this.index.add(Z,te),this.keys.push(z),this.crossTileIDs.push(B)}this.index.finish()}findMatches(h,g,b){let M=this.tileID.canonical.z<g.canonical.z?1:Math.pow(2,this.tileID.canonical.z-g.canonical.z),C=eg/Math.pow(2,g.canonical.z-this.tileID.canonical.z),R=g.canonical.x*n.a4,z=g.canonical.y*n.a4;for(let B=0;B<h.length;B++){let G=h.get(B);if(G.crossTileID)continue;let{key:W,tileAnchorX:Z,tileAnchorY:te}=G,ne=Math.floor((R+Z)*C),ce=Math.floor((z+te)*C),ue=this.index.range(ne-M,ce-M,ne+M,ce+M);for(let de of ue){let pe=this.crossTileIDs[de];if(this.keys[de]===W&&!b.has(pe)){b.add(pe),G.crossTileID=pe;break}}}}}class GE{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Tv{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(h){let g=Math.round((h-this.lng)/360);if(g!==0)for(let b in this.indexes){let M=this.indexes[b],C={};for(let R in M){let z=M[R];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+g),C[z.tileID.key]=z}this.indexes[b]=C}this.lng=h}addBucket(h,g,b){if(this.indexes[h.overscaledZ]&&this.indexes[h.overscaledZ][h.key]){if(this.indexes[h.overscaledZ][h.key].bucketInstanceId===g.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(h.overscaledZ,this.indexes[h.overscaledZ][h.key])}for(let C=0;C<g.symbolInstances.length;C++)g.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[h.overscaledZ]||(this.usedCrossTileIDs[h.overscaledZ]=new Set);let M=this.usedCrossTileIDs[h.overscaledZ];for(let C in this.indexes){let R=this.indexes[C];if(Number(C)>h.overscaledZ)for(let z in R){let B=R[z];B.tileID.isChildOf(h)&&B.findMatches(g.symbolInstances,h,M)}else{let z=R[h.scaledTo(Number(C)).key];z&&z.findMatches(g.symbolInstances,h,M)}}for(let C=0;C<g.symbolInstances.length;C++){let R=g.symbolInstances.get(C);R.crossTileID||(R.crossTileID=b.generate(),M.add(R.crossTileID))}return this.indexes[h.overscaledZ]===void 0&&(this.indexes[h.overscaledZ]={}),this.indexes[h.overscaledZ][h.key]=new g1(h,g.symbolInstances,g.bucketInstanceId),!0}removeBucketCrossTileIDs(h,g){for(let b of g.crossTileIDs)this.usedCrossTileIDs[h].delete(b)}removeStaleBuckets(h){let g=!1;for(let b in this.indexes){let M=this.indexes[b];for(let C in M)h[M[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(b,M[C]),delete M[C],g=!0)}return g}}class ou{constructor(){this.layerIndexes={},this.crossTileIDs=new GE,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(h,g,b,M){let C=this.layerIndexes[h.fqid];C===void 0&&(C=this.layerIndexes[h.fqid]=new Tv);let R=!1,z={};M.name!=="globe"&&C.handleWrapJump(b);for(let B of g){let G=B.getBucket(h);G&&h.fqid===G.layerIds[0]&&(G.bucketInstanceId||(G.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(B.tileID,G,this.crossTileIDs)&&(R=!0),z[G.bucketInstanceId]=!0)}return C.removeStaleBuckets(z)&&(R=!0),R}pruneUnusedLayers(h){let g={};h.forEach(b=>{g[b]=!0});for(let b in this.layerIndexes)g[b]||delete this.layerIndexes[b]}}let y1=new n.U({data:new n.W(n.N.colorTheme.data)}),tl=(_,h)=>Ci(_,h&&h.filter(g=>g.identifier!=="source.canvas")),Av=n.ai(tn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),$p=n.ai(tn,["setCenter","setZoom","setBearing","setPitch"]),HE={version:8,layers:[],sources:{}},WE={duration:300,delay:0};class il extends n.E{constructor(h,g={}){super(),this.map=h,this.scope=g.scope||"",this.globalId=null,this.fragments=[],this.importDepth=g.importDepth||0,this.importsCache=g.importsCache||new Map,this.resolvedImports=g.resolvedImports||new Set,this.transition=n.Q({},WE),this._buildingIndex=new Fa(this),this.crossTileSymbolIndex=new ou,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=g.styleChanges||new Y,this.dispatcher=g.dispatcher?g.dispatcher:new n.by(n.bz(),this),g.imageManager?this.imageManager=g.imageManager:(this.imageManager=new vi,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=g.glyphManager?g.glyphManager:new n.cP(h._requestManager,g.localFontFamily?n.cQ.all:g.localIdeographFontFamily?n.cQ.ideographs:n.cQ.none,g.localFontFamily||g.localIdeographFontFamily),g.modelManager?this.modelManager=g.modelManager:(this.modelManager=new Pi(h._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=g.configOptions?g.configOptions:new Map,this._configDependentLayers=g.configDependentLayers?g.configDependentLayers:new Set,this._config=g.config,this._initialConfig=g.initialConfig,this.dispatcher.broadcast("setReferrer",n.cR());let b=this;this._rtlTextPluginCallback=il.registerForPluginStateChange(M=>{b.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:M.pluginStatus,pluginURL:M.pluginURL},(C,R)=>{if(n.cS(C),R&&R.every(z=>z))for(let z in b._sourceCaches){let B=b._sourceCaches[z],G=B.getSource().type;G!=="vector"&&G!=="geojson"||B.reload()}})}),this.on("data",M=>{if(M.dataType!=="source"||M.sourceDataType!=="metadata")return;let C=this.getOwnSource(M.sourceId);if(C&&C.vectorLayerIds)for(let R in this._layers){let z=this._layers[R];z.source===C.id&&this._validateLayer(z)}})}load(h){return h?(typeof h=="string"?this.loadURL(h):this.loadJSON(h),this):this}_getGlobalId(h){if(!h)return null;if(typeof h=="string"){if(n.cT(h))return h;let g=n.cU(h);if(!g.startsWith("http"))try{return new URL(g,location.href).toString()}catch{return g}return g}return`json://${n.cV(JSON.stringify(h))}`}_diffStyle(h,g,b){this.globalId=this._getGlobalId(h);let M=(C,R)=>{try{R(null,this.setState(C,b))}catch(z){R(z,!1)}};if(typeof h=="string"){let C=this.map._requestManager.normalizeStyleURL(h),R=this.map._requestManager.transformRequest(C,n.R.Style);n.h(R,(z,B)=>{z?this.fire(new n.f(z)):B&&M(B,g)})}else typeof h=="object"&&M(h,g)}loadURL(h,g={}){this.fire(new n.g("dataloading",{dataType:"style"}));let b=typeof g.validate=="boolean"?g.validate:!n.cT(h);this.globalId=this._getGlobalId(h),h=this.map._requestManager.normalizeStyleURL(h,g.accessToken),this.resolvedImports.add(h);let M=this.importsCache.get(h);if(M)return this._load(M,b);let C=this.map._requestManager.transformRequest(h,n.R.Style);this._request=n.h(C,(R,z)=>{if(this._request=null,R)this.fire(new n.f(R));else if(z)return this.importsCache.set(h,z),this._load(z,b)})}loadJSON(h,g={}){this.fire(new n.g("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(h),this._request=n.e.frame(()=>{this._request=null,this._load(h,g.validate!==!1)})}loadEmpty(){this.fire(new n.g("dataloading",{dataType:"style"})),this._load(HE,!1)}_loadImports(h,g,b){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let M=[];for(let C of h){let R=this._createFragmentStyle(C),z=new Promise(W=>{R.once("style.import.load",W),R.once("error",W)}).then(()=>this.mergeAll());if(M.push(z),this.resolvedImports.has(C.url)){R.loadEmpty();continue}let B=C.data||this.importsCache.get(C.url);B?(R.loadJSON(B,{validate:g}),this._isInternalStyle(B)&&(R.globalId=null)):C.url?R.loadURL(C.url,{validate:g}):R.loadEmpty();let G={style:R,id:C.id,config:C.config};if(b){let W=this.fragments.findIndex(({id:Z})=>Z===b);this.fragments=this.fragments.slice(0,W).concat(G).concat(this.fragments.slice(W))}else this.fragments.push(G)}return Promise.allSettled(M)}getImportGlobalIds(h=this,g=new Set){for(let b of h.fragments)b.style.globalId&&g.add(b.style.globalId),this.getImportGlobalIds(b.style,g);return[...g.values()]}_createFragmentStyle(h){let g=this.scope?n.am(h.id,this.scope):h.id,b,M=this._initialConfig&&this._initialConfig[g];(h.config||M)&&(b=n.Q({},h.config,M));let C=new il(this.map,{scope:g,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:b,configOptions:this.options,configDependentLayers:this._configDependentLayers});return C.setEventedParent(this.map,{style:C}),C}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(h){return this.isRootStyle()&&(h.fragment||!!h.schema&&h.fragment!==!1)}_load(h,g){let b=h.schema;if(this._isInternalStyle(h)){let R=n.Q({},HE,{imports:[{id:"basemap",data:h,url:""}]});return void this._load(R,g)}if(this.updateConfig(this._config,b),g&&tl(this,ie(h)))return;this._loaded=!0,this.stylesheet=n.cW(h);let M=()=>{for(let G in h.sources)this.addSource(G,h.sources[G],{validate:!1,isInitialLoad:!0});h.sprite?this._loadSprite(h.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(h.glyphs,this.scope);let R=Xm(this.stylesheet.layers);if(this._order=R.map(G=>G.id),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let G=this.stylesheet.lights[0];this.light=new Qi(G.properties,G.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Qi(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let G of R){let W=n.c$(G,this.scope,this._styleColorTheme.lut,this.options);W.configDependencies.size!==0&&this._configDependentLayers.add(W.fqid),W.setEventedParent(this,{layer:{id:W.id}}),this._layers[W.id]=W,this._serializedLayers[W.id]=W.serialize();let Z=this.getOwnLayerSourceCache(W),te=!!this.directionalLight&&this.directionalLight.shadowsEnabled();Z&&W.canCastShadows()&&te&&(Z.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let z=this.stylesheet.terrain;z&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(z,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.g("data",{dataType:"style"}));let B=this.isRootStyle();h.imports?this._loadImports(h.imports,g).then(()=>{this._reloadImports(),this.fire(new n.g(B?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new n.g(B?"style.load":"style.import.load")))},C=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=C,C){let R=this._evaluateColorThemeData(C);this._loadColorTheme(R).then(()=>{M()}).catch(z=>{n.w(`Couldn't load color theme from the stylesheet: ${z}`),M()})}else this._styleColorTheme.lut=null,M()}isRootStyle(){return this.importDepth===0}mergeAll(){let h,g,b,M,C,R,z,B,G={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(W=>{if(W.stylesheet){if(W.light!=null&&(h=W.light),W.stylesheet.lights)for(let Z of W.stylesheet.lights)Z.type==="ambient"&&W.ambientLight!=null&&(g=W.ambientLight),Z.type==="directional"&&W.directionalLight!=null&&(b=W.directionalLight);M=this._prioritizeTerrain(M,W.terrain,W.stylesheet.terrain),W.stylesheet.fog&&W.fog!=null&&(C=W.fog),W.stylesheet.camera!=null&&(B=W.stylesheet.camera),W.stylesheet.projection!=null&&(R=W.stylesheet.projection),W.stylesheet.transition!=null&&(z=W.stylesheet.transition),G[W.scope]=W._styleColorTheme}}),this.light=h,this.ambientLight=g,this.directionalLight=b,this.fog=C,this._styleColorThemeForScope=G,M===null?delete this.terrain:this.terrain=M,this.camera=B||{"camera-projection":"perspective"},this.projection=R||{name:"mercator"},this.transition=n.Q({},WE,z),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(h){let g=b=>{for(let M of b.fragments)g(M.style);h(b)};g(this)}_prioritizeTerrain(h,g,b){let M=h&&h.drapeRenderMode===0;return b===null?g&&g.drapeRenderMode===0?g:M?h:null:g!=null&&(!h||M||g&&g.drapeRenderMode===1)?g:h}mergeTerrain(){let h;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(g=>{h=this._prioritizeTerrain(h,g.terrain,g.stylesheet.terrain)}),h===null?delete this.terrain:this.terrain=h}mergeProjection(){let h;this.forEachFragmentStyle(g=>{g.stylesheet.projection!=null&&(h=g.stylesheet.projection)}),this.projection=h||{name:"mercator"}}mergeSources(){let h={},g={},b={};this.forEachFragmentStyle(M=>{for(let C in M._sourceCaches){let R=n.am(C,M.scope);h[R]=M._sourceCaches[C]}for(let C in M._otherSourceCaches){let R=n.am(C,M.scope);g[R]=M._otherSourceCaches[C]}for(let C in M._symbolSourceCaches){let R=n.am(C,M.scope);b[R]=M._symbolSourceCaches[C]}}),this._mergedSourceCaches=h,this._mergedOtherSourceCaches=g,this._mergedSymbolSourceCaches=b}mergeLayers(){let h={},g=[],b={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(R=>{for(let z of R._order){let B=R._layers[z];if(B.type==="slot"){let G=n.cX(z);if(h[G])continue;h[G]=[]}B.slot&&h[B.slot]?h[B.slot].push(B):g.push(B)}}),this._mergedOrder=[],this._clipLayerIndices=[];let M=0,C=(R=[])=>{for(let z of R)if(z.type==="slot"){let B=n.cX(z.id);h[B]&&C(h[B]),this._mergedSlots.push(B)}else{let B=n.am(z.id,z.scope);this._mergedOrder.push(B),b[B]=z,z.is3D()&&(this._has3DLayers=!0),z.type==="circle"&&(this._hasCircleLayers=!0),z.type==="symbol"&&(this._hasSymbolLayers=!0),z.type==="clip"&&this._clipLayerIndices.push(M),M++}};C(g),this._mergedOrder.sort((R,z)=>{let B=b[R],G=b[z];return B.hasInitialOcclusionOpacityProperties?G.is3D()?1:0:B.is3D()&&G.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=b,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(h){return this.stylesheet.camera=n.Q({},this.stylesheet.camera,h),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(h){return h.data?function(g,b,M){let C=n.Q({},b);for(let z of Object.keys(n.N.colorTheme))C[z]===void 0&&(C[z]=n.N.colorTheme[z].default);let R=new n.O(y1,g,new Map(M));return R.setTransitionOrValue(C,M),R.untransitioned().possiblyEvaluate(new n.Y(0))}(this.scope,h,this.options).get("data"):null}_loadColorTheme(h){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;let g=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((b,M)=>{let C="data:image/png;base64,";if(!h||h.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void b();let R=h;R.startsWith(C)||(R=C+R);let z="mapbox-reserved-lut",B=new Image;B.src=R,B.onerror=()=>{this._styleColorTheme.lutLoading=!1,M(new Error("Failed to load image data"))},B.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==g)return void b();this._styleColorTheme.lutLoading=!1;let{width:G,height:W,data:Z}=n.e.getImageData(B);if(W>32)return void M(new Error("The height of the image must be less than or equal to 32 pixels."));if(G!==W*W)return void M(new Error("The width of the image must be equal to the height squared."));this.getImage(z)&&this.removeImage(z),this.addImage(z,{data:new n.j({width:G,height:W},Z),pixelRatio:1,sdf:!1,version:0});let te=this.imageManager.getImage(z,this.scope);te?(this._styleColorTheme.lut={image:te.data,data:h},b()):M(new Error("Missing LUT image."))}})}getLut(h){let g=this._styleColorThemeForScope[h];return g?g.lut:null}setProjection(h){h?this.stylesheet.projection=h:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(h){this._spriteRequest=function(g,b,M){let C,R,z,B=n.e.devicePixelRatio>1?"@2x":"",G=n.h(b.transformRequest(b.normalizeSpriteURL(g,B,".json"),n.R.SpriteJSON),(te,ne)=>{G=null,z||(z=te,C=ne,Z())}),W=n.i(b.transformRequest(b.normalizeSpriteURL(g,B,".png"),n.R.SpriteImage),(te,ne)=>{W=null,z||(z=te,R=ne,Z())});function Z(){if(z)M(z);else if(C&&R){let te=n.e.getImageData(R),ne={};for(let ce in C){let{width:ue,height:de,x:pe,y:Me,sdf:Te,pixelRatio:Se,stretchX:Be,stretchY:Oe,content:Le}=C[ce],Ge=new n.j({width:ue,height:de});n.j.copy(te,Ge,{x:pe,y:Me},{x:0,y:0},{width:ue,height:de},null),ne[ce]={data:Ge,pixelRatio:Se,sdf:Te,stretchX:Be,stretchY:Oe,content:Le}}M(null,ne)}}return{cancel(){G&&(G.cancel(),G=null),W&&(W.cancel(),W=null)}}}(h,this.map._requestManager,(g,b)=>{if(this._spriteRequest=null,g)this.fire(new n.f(g));else if(b)for(let M in b)this.imageManager.addImage(M,this.scope,b[M]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.g("data",{dataType:"style"}))})}_validateLayer(h){let g=this.getOwnSource(h.source);if(!g)return;let b=h.sourceLayer;b&&(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(b)===-1)&&this.fire(new n.f(new Error(`Source layer "${b}" does not exist on source "${g.id}" as specified by style layer "${h.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let h in this._sourceCaches)if(!this._sourceCaches[h].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:h}of this.fragments)if(!h.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((h,g)=>{let b=this.fragments[g];return b&&b.style&&(h.data=b.style.serialize()),h})}_serializeSources(){let h={};for(let g in this._sourceCaches){let b=this._sourceCaches[g].getSource();h[b.id]||(h[b.id]=b.serialize())}return h}_serializeLayers(h){let g=[];for(let b of h){let M=this._layers[b];M&&M.type!=="custom"&&g.push(M.serialize())}return g}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let h in this._sourceCaches)if(this._sourceCaches[h].hasTransition())return!0;for(let h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(h){return!!this.terrain&&h.isDraped(this.getLayerSourceCache(h))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(h){let g=this.getOwnLayer(h);if(g)return g;this.fire(new n.f(new Error(`The layer '${h}' does not exist in the map's style.`)))}_checkSource(h){let g=this.getOwnSource(h);if(g)return g;this.fire(new n.f(new Error(`The source '${h}' does not exist in the map's style.`)))}precompilePrograms(h,g){let b=this.map.painter;if(b)for(let M=h.minzoom||0;M<(h.maxzoom||25.5);M++){let C=h.getProgramIds();if(C)for(let R of C){let z=h.getDefaultProgramParams(R,g.zoom,this._styleColorTheme.lut);z&&(b.style=this,this.fog&&(b._fogVisible=!0,z.overrideFog=!0,b.getOrCreateProgram(R,z)),b._fogVisible=!1,z.overrideFog=!1,b.getOrCreateProgram(R,z),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(z.overrideRtt=!0,b.getOrCreateProgram(R,z)))}}}update(h){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(h),this.directionalLight&&this.directionalLight.recalculate(h);let g=this.calculateLightsBrightness();h.brightness=g||0,g!==this._brightness&&(this._brightness=g,this.dispatcher.broadcast("setBrightness",g));let b=this._changes.isDirty(),M=!1;if(this._changes.isDirty()){let R=this._changes.getLayerUpdatesByScope();for(let z in R){let{updatedIds:B,removedIds:G}=R[z];(B||G)&&(this._updateWorkerLayers(z,B,G),M=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(h),this.light&&this.light.updateTransitions(h),this.ambientLight&&this.ambientLight.updateTransitions(h),this.directionalLight&&this.directionalLight.updateTransitions(h),this.fog&&this.fog.updateTransitions(h),this._changes.reset()}let C={};for(let R in this._mergedSourceCaches){let z=this._mergedSourceCaches[R];C[R]=z.used,z.used=!1,z.tileCoverLift=0}for(let R of this._mergedOrder){let z=this._mergedLayers[R];if(z.recalculate(h,this._availableImages),!z.isHidden(h.zoom)){let B=this.getLayerSourceCache(z);B&&(B.used=!0,B.tileCoverLift=Math.max(B.tileCoverLift,z.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(z,h)}):this.precompilePrograms(z,h))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&M&&this.mergeLayers();for(let R in C){let z=this._mergedSourceCaches[R];C[R]!==z.used&&z.getSource().fire(new n.g("data",{sourceDataType:"visibility",dataType:"source",sourceId:z.getSource().id}))}this.light&&this.light.recalculate(h),this.terrain&&this.terrain.recalculate(h),this.fog&&this.fog.recalculate(h),this.z=h.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),b&&this.fire(new n.g("data",{dataType:"style"}))}_updateTilesForChangedImages(){let h=this._changes.getUpdatedImages();if(h.length){for(let g in this._sourceCaches)this._sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],h);this._changes.resetUpdatedImages()}}_updateWorkerLayers(h,g,b){let M=this.getFragmentStyle(h);M&&this.dispatcher.broadcast("updateLayers",{layers:g?M._serializeLayers(g):[],scope:h,removedIds:b||[],options:M.options})}setState(h,g){if(this._checkLoaded(),tl(this,ie(h)))return!1;(h=n.cW(h)).layers=Xm(h.layers);let b=function(R,z){if(!R)return[{command:tn.setStyle,args:[z]}];let B=[];try{if(!n.d(R.version,z.version))return[{command:tn.setStyle,args:[z]}];if(n.d(R.center,z.center)||B.push({command:tn.setCenter,args:[z.center]}),n.d(R.zoom,z.zoom)||B.push({command:tn.setZoom,args:[z.zoom]}),n.d(R.bearing,z.bearing)||B.push({command:tn.setBearing,args:[z.bearing]}),n.d(R.pitch,z.pitch)||B.push({command:tn.setPitch,args:[z.pitch]}),n.d(R.sprite,z.sprite)||B.push({command:tn.setSprite,args:[z.sprite]}),n.d(R.glyphs,z.glyphs)||B.push({command:tn.setGlyphs,args:[z.glyphs]}),n.d(R.imports,z.imports)||function(ne=[],ce=[],ue){ce=ce||[];let de=(ne=ne||[]).map(wv),pe=ce.map(wv),Me=ne.reduce(su,{}),Te=ce.reduce(su,{}),Se=de.slice(),Be,Oe,Le,Ge;for(Be=0,Oe=0;Be<de.length;Be++)Le=de[Be],Te.hasOwnProperty(Le)?Oe++:(ue.push({command:tn.removeImport,args:[Le]}),Se.splice(Se.indexOf(Le,Oe),1));for(Be=0,Oe=0;Be<pe.length;Be++)Le=pe[pe.length-1-Be],Se[Se.length-1-Be]!==Le&&(Me.hasOwnProperty(Le)?(ue.push({command:tn.removeImport,args:[Le]}),Se.splice(Se.lastIndexOf(Le,Se.length-Oe),1)):Oe++,Ge=Se[Se.length-Be],ue.push({command:tn.addImport,args:[Te[Le],Ge]}),Se.splice(Se.length-Be,0,Le));for(let We of ce){let at=Me[We.id];at&&!n.d(at,We)&&ue.push({command:tn.updateImport,args:[We.id,We]})}}(R.imports,z.imports,B),n.d(R.transition,z.transition)||B.push({command:tn.setTransition,args:[z.transition]}),n.d(R.light,z.light)||B.push({command:tn.setLight,args:[z.light]}),n.d(R.fog,z.fog)||B.push({command:tn.setFog,args:[z.fog]}),n.d(R.projection,z.projection)||B.push({command:tn.setProjection,args:[z.projection]}),n.d(R.lights,z.lights)||B.push({command:tn.setLights,args:[z.lights]}),n.d(R.camera,z.camera)||B.push({command:tn.setCamera,args:[z.camera]}),!n.d(R["color-theme"],z["color-theme"]))return[{command:tn.setStyle,args:[z]}];let G={},W=[];(function(ne,ce,ue,de){let pe;for(pe in ce=ce||{},ne=ne||{})ne.hasOwnProperty(pe)&&(ce.hasOwnProperty(pe)||LE(pe,ue,de));for(pe in ce){if(!ce.hasOwnProperty(pe))continue;let Me=ce[pe];ne.hasOwnProperty(pe)?n.d(ne[pe],Me)||(ne[pe].type==="geojson"&&Me.type==="geojson"&&$m(ne,ce,pe)?ue.push({command:tn.setGeoJSONSourceData,args:[pe,Me.data]}):SP(pe,ce,ue,de)):Xp(pe,ce,ue)}})(R.sources,z.sources,W,G);let Z=[];R.layers&&R.layers.forEach(ne=>{ne.source&&G[ne.source]?B.push({command:tn.removeLayer,args:[ne.id]}):Z.push(ne)});let te=R.terrain;te&&G[te.source]&&(B.push({command:tn.setTerrain,args:[void 0]}),te=void 0),B=B.concat(W),n.d(te,z.terrain)||B.push({command:tn.setTerrain,args:[z.terrain]}),function(ne,ce,ue){ce=ce||[];let de=(ne=ne||[]).map(wv),pe=ce.map(wv),Me=ne.reduce(su,{}),Te=ce.reduce(su,{}),Se=de.slice(),Be=Object.create(null),Oe,Le,Ge,We,at,Ye,Ne;for(Oe=0,Le=0;Oe<de.length;Oe++)Ge=de[Oe],Te.hasOwnProperty(Ge)?Le++:(ue.push({command:tn.removeLayer,args:[Ge]}),Se.splice(Se.indexOf(Ge,Le),1));for(Oe=0,Le=0;Oe<pe.length;Oe++)Ge=pe[pe.length-1-Oe],Se[Se.length-1-Oe]!==Ge&&(Me.hasOwnProperty(Ge)?(ue.push({command:tn.removeLayer,args:[Ge]}),Se.splice(Se.lastIndexOf(Ge,Se.length-Le),1)):Le++,Ye=Se[Se.length-Oe],ue.push({command:tn.addLayer,args:[Te[Ge],Ye]}),Se.splice(Se.length-Oe,0,Ge),Be[Ge]=!0);for(Oe=0;Oe<pe.length;Oe++)if(Ge=pe[Oe],We=Me[Ge],at=Te[Ge],!Be[Ge]&&!n.d(We,at))if(n.d(We.source,at.source)&&n.d(We["source-layer"],at["source-layer"])&&n.d(We.type,at.type)){for(Ne in lh(We.layout,at.layout,ue,Ge,null,tn.setLayoutProperty),lh(We.paint,at.paint,ue,Ge,null,tn.setPaintProperty),n.d(We.slot,at.slot)||ue.push({command:tn.setSlot,args:[Ge,at.slot]}),n.d(We.filter,at.filter)||ue.push({command:tn.setFilter,args:[Ge,at.filter]}),n.d(We.minzoom,at.minzoom)&&n.d(We.maxzoom,at.maxzoom)||ue.push({command:tn.setLayerZoomRange,args:[Ge,at.minzoom,at.maxzoom]}),We)We.hasOwnProperty(Ne)&&Ne!=="layout"&&Ne!=="paint"&&Ne!=="filter"&&Ne!=="metadata"&&Ne!=="minzoom"&&Ne!=="maxzoom"&&Ne!=="slot"&&(Ne.indexOf("paint.")===0?lh(We[Ne],at[Ne],ue,Ge,Ne.slice(6),tn.setPaintProperty):n.d(We[Ne],at[Ne])||ue.push({command:tn.setLayerProperty,args:[Ge,Ne,at[Ne]]}));for(Ne in at)at.hasOwnProperty(Ne)&&!We.hasOwnProperty(Ne)&&Ne!=="layout"&&Ne!=="paint"&&Ne!=="filter"&&Ne!=="metadata"&&Ne!=="minzoom"&&Ne!=="maxzoom"&&Ne!=="slot"&&(Ne.indexOf("paint.")===0?lh(We[Ne],at[Ne],ue,Ge,Ne.slice(6),tn.setPaintProperty):n.d(We[Ne],at[Ne])||ue.push({command:tn.setLayerProperty,args:[Ge,Ne,at[Ne]]}))}else ue.push({command:tn.removeLayer,args:[Ge]}),Ye=Se[Se.lastIndexOf(Ge)+1],ue.push({command:tn.addLayer,args:[at,Ye]})}(Z,z.layers,B)}catch(G){console.warn("Unable to compute style diff:",G),B=[{command:tn.setStyle,args:[z]}]}return B}(this.serialize(),h).filter(R=>!(R.command in $p));if(b.length===0)return!1;let M=b.filter(R=>!(R.command in Av));if(M.length>0)throw new Error(`Unimplemented: ${M.map(R=>R.command).join(", ")}.`);let C=[];return b.forEach(R=>{C.push(this[R.command].apply(this,R.args))}),g&&Promise.all(C).then(g),this.stylesheet=h,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(h,g){return this.getImage(h)?this.fire(new n.f(new Error("An image with this name already exists."))):(this.imageManager.addImage(h,this.scope,g),this._afterImageUpdated(h),this)}updateImage(h,g){this.imageManager.updateImage(h,this.scope,g)}getImage(h){return this.imageManager.getImage(h,this.scope)}removeImage(h){return this.getImage(h)?(this.imageManager.removeImage(h,this.scope),this._afterImageUpdated(h),this):this.fire(new n.f(new Error("No image with this name exists.")))}_afterImageUpdated(h){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(h),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new n.g("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(h,g,b={}){return this._checkLoaded(),this._validate(It,`models.${h}`,g,null,b)||(this.modelManager.addModel(h,g,this.scope),this._changes.setDirty()),this}hasModel(h){return this.modelManager.hasModel(h,this.scope)}removeModel(h){return this.hasModel(h)?(this.modelManager.removeModel(h,this.scope),this):this.fire(new n.f(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(h,g,b={}){if(this._checkLoaded(),this.getOwnSource(h)!==void 0)throw new Error(`There is already a source with ID "${h}".`);if(!g.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(g).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(re,`sources.${h}`,g,null,b))return;this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);let M=cv(h,g,this.dispatcher,this);M.scope=this.scope,M.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(M.id),source:M.serialize(),sourceId:M.id}));let C=R=>{let z=(R?"symbol:":"other:")+M.id,B=n.am(z,this.scope),G=this._sourceCaches[z]=new n.bx(B,M,R);(R?this._symbolSourceCaches:this._otherSourceCaches)[M.id]=G,G.onAdd(this.map)};C(!1),g.type!=="vector"&&g.type!=="geojson"||C(!0),M.onAdd&&M.onAdd(this.map),b.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(h){this._checkLoaded();let g=this.getOwnSource(h);if(!g)throw new Error("There is no source with this ID");for(let M in this._layers)if(this._layers[M].source===h)return this.fire(new n.f(new Error(`Source "${h}" cannot be removed while layer "${M}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===h)return this.fire(new n.f(new Error(`Source "${h}" cannot be removed while terrain is using it.`)));let b=this.getOwnSourceCaches(h);for(let M of b){let C=n.cX(M.id);delete this._sourceCaches[C],this._changes.discardSourceCacheUpdate(M.id),M.fire(new n.g("data",{sourceDataType:"metadata",dataType:"source",sourceId:M.getSource().id})),M.setEventedParent(null),M.clearTiles()}return delete this._otherSourceCaches[h],delete this._symbolSourceCaches[h],this.mergeSources(),g.setEventedParent(null),g.onRemove&&g.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(h,g){this._checkLoaded(),this.getOwnSource(h).setData(g),this._changes.setDirty()}getOwnSource(h){let g=this.getOwnSourceCache(h);return g&&g.getSource()}getOwnSources(){let h=[];for(let g in this._otherSourceCaches){let b=this.getOwnSourceCache(g);b&&h.push(b.getSource())}return h}areTilesLoaded(){let h=this._mergedSourceCaches;for(let g in h){let b=h[g]._tiles;for(let M in b){let C=b[M];if(C.state!=="loaded"&&C.state!=="errored")return!1}}return!0}setLights(h){if(this._checkLoaded(),!h)return delete this.ambientLight,void delete this.directionalLight;let g=this._getTransitionParameters();for(let M of h){if(this._validate(De,"lights",M))return;switch(M.type){case"ambient":if(this.ambientLight){let C=this.ambientLight;C.set(M),C.updateTransitions(g)}else this.ambientLight=new Br(M,cd||(cd=new n.U({color:new n.W(n.N.properties_light_ambient.color),intensity:new n.W(n.N.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){let C=this.directionalLight;C.set(M),C.updateTransitions(g)}else this.directionalLight=new Br(M,Wl||(Wl=new n.U({direction:new n.a6(n.N.properties_light_directional.direction),color:new n.W(n.N.properties_light_directional.color),intensity:new n.W(n.N.properties_light_directional.intensity),"cast-shadows":new n.W(n.N.properties_light_directional["cast-shadows"]),"shadow-intensity":new n.W(n.N.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}let b=new n.Y(this.z||0,g);this.ambientLight&&this.ambientLight.recalculate(b),this.directionalLight&&this.directionalLight.recalculate(b),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let h=this.directionalLight,g=this.ambientLight;if(!h||!g)return;let b=Z=>.2126*(Z[0]<=.03928?Z[0]/12.92:Math.pow((Z[0]+.055)/1.055,2.4))+.7152*(Z[1]<=.03928?Z[1]/12.92:Math.pow((Z[1]+.055)/1.055,2.4))+.0722*(Z[2]<=.03928?Z[2]/12.92:Math.pow((Z[2]+.055)/1.055,2.4)),M=h.properties.get("color").toRenderColor(null).toArray01(),C=h.properties.get("intensity"),R=h.properties.get("direction"),z=1-n.ad(R.x,R.y,R.z)[2]/90,B=b(M)*C*z,G=g.properties.get("color").toRenderColor(null).toArray01(),W=g.properties.get("intensity");return(B+b(G)*W)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let h=[];return this.directionalLight&&h.push(this.directionalLight.get()),this.ambientLight&&h.push(this.ambientLight.get()),h}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(h){if(!h)return this;if(n.cY(h)){let g=n.cZ(h),b=this.fragments.find(({id:C})=>C===g);if(!b)throw new Error(`Style import not found: ${h}`);let M=n.cX(h);return b.style.getFragmentStyle(M)}{let g=this.fragments.find(({id:b})=>b===h);if(!g)throw new Error(`Style import not found: ${h}`);return g.style}}getConfigProperty(h,g){let b=this.getFragmentStyle(h);if(!b)return null;let M=n.am(g,b.scope),C=b.options.get(M),R=C?C.value||C.default:null;return R?R.serialize():null}setConfigProperty(h,g,b){let M=this.getFragmentStyle(h);if(!M)return;let C=M.stylesheet.schema;if(!C||!C[g])return;let R=n.z(b);if(R.result!=="success")return void tl(this,R.value);let z=R.value.expression,B=n.am(g,M.scope),G=M.options.get(B);if(!G)return;let W,{minValue:Z,maxValue:te,stepValue:ne,type:ce,values:ue}=C[g],de=n.z(C[g].default);de.result==="success"&&(W=de.value.expression),W?(this.options.set(B,pt(me({},G),{value:z,default:W,minValue:Z,maxValue:te,stepValue:ne,type:ce,values:ue})),this.updateConfigDependencies(g)):this.fire(new n.f(new Error(`No schema defined for the config option "${g}" in the "${h}" fragment.`)))}getConfig(h){let g=this.getFragmentStyle(h);if(!g)return null;let b=g.stylesheet.schema;if(!b)return null;let M={};for(let C in b){let R=n.am(C,g.scope),z=g.options.get(R),B=z?z.value||z.default:null;M[C]=B?B.serialize():null}return M}setConfig(h,g){let b=this.getFragmentStyle(h);b&&(b.updateConfig(g,b.stylesheet.schema),this.updateConfigDependencies())}getSchema(h){let g=this.getFragmentStyle(h);return g?g.stylesheet.schema:null}setSchema(h,g){let b=this.getFragmentStyle(h);b&&(b.stylesheet.schema=g,b.updateConfig(b._config,g),this.updateConfigDependencies())}updateConfig(h,g){if(this._config=h,h||g)if(g)for(let b in g){let M,C,R=n.z(g[b].default);if(R.result==="success"&&(M=R.value.expression),h&&h[b]!==void 0){let te=n.z(h[b]);te.result==="success"&&(C=te.value.expression)}let{minValue:z,maxValue:B,stepValue:G,type:W,values:Z}=g[b];if(M){let te=n.am(b,this.scope);this.options.set(te,{default:M,value:C,minValue:z,maxValue:B,stepValue:G,type:W,values:Z})}else this.fire(new n.f(new Error(`No schema defined for config option "${b}".`)))}else this.fire(new n.f(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(h){for(let g of this._configDependentLayers){let b=this.getLayer(g);if(b){if(h&&!b.configDependencies.has(h))continue;b.possiblyEvaluateVisibility(),this._updateLayer(b)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(g=>{if(g._styleColorTheme.colorTheme){let b=g._evaluateColorThemeData(g._styleColorTheme.colorTheme);(!g._styleColorTheme.lut&&b!==""||g._styleColorTheme.lut&&b!==g._styleColorTheme.lut.data)&&g.setColorTheme(g._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(h,g,b={}){this._checkLoaded();let M=h.id;if(this._layers[M])return void this.fire(new n.f(new Error(`Layer with id "${M}" already exists on this map`)));let C;if(h.type==="custom"){if(tl(this,n.c_(h)))return;C=n.c$(h,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof h.source=="object"&&(this.addSource(M,h.source),h=n.cW(h),h=n.Q(h,{source:M})),this._validate(nt,`layers.${M}`,h,{arrayIndex:-1},b))return;C=n.c$(h,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(C),C.setEventedParent(this,{layer:{id:M}}),this._serializedLayers[C.id]=C.serialize()}C.configDependencies.size!==0&&this._configDependentLayers.add(C.fqid);let R=this._order.length;if(g){let W=this._order.indexOf(g);if(W===-1)return void this.fire(new n.f(new Error(`Layer with id "${g}" does not exist on this map.`)));C.slot===this._layers[g].slot?R=W:n.w(`Layer with id "${g}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(R,0,M),this._layerOrderChanged=!0,this._layers[M]=C;let z=this.getOwnLayerSourceCache(C),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&C.canCastShadows()&&B&&(z.castsShadows=!0);let G=this._changes.getRemovedLayer(C);if(G&&C.source&&z&&C.type!=="custom"){this._changes.discardLayerRemoval(C);let W=n.am(C.source,C.scope);G.type!==C.type?this._changes.updateSourceCache(W,"clear"):(this._changes.updateSourceCache(W,"reload"),z.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),C.scope=this.scope,this.mergeLayers()}moveLayer(h,g){this._checkLoaded();let b=this._checkLayer(h);if(!b||h===g)return;let M=this._order.indexOf(h);this._order.splice(M,1);let C=this._order.length;if(g){let R=this._order.indexOf(g);if(R===-1)return void this.fire(new n.f(new Error(`Layer with id "${g}" does not exist on this map.`)));b.slot===this._layers[g].slot?C=R:n.w(`Layer with id "${g}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(C,0,h),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(h){this._checkLoaded();let g=this._checkLayer(h);if(!g)return;g.setEventedParent(null);let b=this._order.indexOf(h);this._order.splice(b,1),delete this._layers[h],delete this._serializedLayers[h],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(g.fqid),this._changes.removeLayer(g);let M=this.getOwnLayerSourceCache(g);if(M&&M.castsShadows){let C=!1;for(let R in this._layers)if(this._layers[R].source===g.source&&this._layers[R].canCastShadows()){C=!0;break}M.castsShadows=C}g.onRemove&&g.onRemove(this.map),this.mergeLayers()}getOwnLayer(h){return this._layers[h]}hasLayer(h){return h in this._mergedLayers}hasLayerType(h){for(let g in this._layers)if(this._layers[g].type===h)return!0;return!1}setLayerZoomRange(h,g,b){this._checkLoaded();let M=this._checkLayer(h);M&&(M.minzoom===g&&M.maxzoom===b||(g!=null&&(M.minzoom=g),b!=null&&(M.maxzoom=b),this._updateLayer(M)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(h,g){this._checkLoaded();let b=this._checkLayer(h);b&&b.slot!==g&&(b.slot=g,this._updateLayer(b))}setFilter(h,g,b={}){this._checkLoaded();let M=this._checkLayer(h);if(M&&!n.d(M.filter,g))return g==null?(M.filter=void 0,void this._updateLayer(M)):void(this._validate(qe,`layers.${M.id}.filter`,g,{layerType:M.type},b)||(M.filter=n.cW(g),this._updateLayer(M)))}getFilter(h){let g=this._checkLayer(h);if(g)return n.cW(g.filter)}setLayoutProperty(h,g,b,M={}){this._checkLoaded();let C=this._checkLayer(h);if(C&&!n.d(C.getLayoutProperty(g),b)){if(b!=null&&(!M||M.validate!==!1)&&tl(C,St.call(ie,{key:`layers.${h}.layout.${g}`,layerType:C.type,objectKey:g,value:b,styleSpec:n.N,style:{glyphs:!0,sprite:!0}})))return;C.setLayoutProperty(g,b),C.configDependencies.size!==0&&this._configDependentLayers.add(C.fqid),this._updateLayer(C)}}getLayoutProperty(h,g){let b=this._checkLayer(h);if(b)return b.getLayoutProperty(g)}setPaintProperty(h,g,b,M={}){this._checkLoaded();let C=this._checkLayer(h);if(!C||n.d(C.getPaintProperty(g),b)||b!=null&&(!M||M.validate!==!1)&&tl(C,st.call(ie,{key:`layers.${h}.paint.${g}`,layerType:C.type,objectKey:g,value:b,styleSpec:n.N})))return;let R=C.setPaintProperty(g,b);C.configDependencies.size!==0&&this._configDependentLayers.add(C.fqid),R&&this._updateLayer(C),this._changes.updatePaintProperties(C)}getPaintProperty(h,g){let b=this._checkLayer(h);if(b)return b.getPaintProperty(g)}setFeatureState(h,g){this._checkLoaded();let b=h.source,M=h.sourceLayer,C=this._checkSource(b);if(!C)return;let R=C.type;if(R==="geojson"&&M)return void this.fire(new n.f(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(R==="vector"&&!M)return void this.fire(new n.f(new Error("The sourceLayer parameter must be provided for vector source types.")));h.id===void 0&&this.fire(new n.f(new Error("The feature id parameter must be provided.")));let z=this.getOwnSourceCaches(b);for(let B of z)B.setFeatureState(M,h.id,g)}removeFeatureState(h,g){this._checkLoaded();let b=h.source,M=this._checkSource(b);if(!M)return;let C=M.type,R=C==="vector"?h.sourceLayer:void 0;if(C==="vector"&&!R)return void this.fire(new n.f(new Error("The sourceLayer parameter must be provided for vector source types.")));if(g&&typeof h.id!="string"&&typeof h.id!="number")return void this.fire(new n.f(new Error("A feature id is required to remove its specific state property.")));let z=this.getOwnSourceCaches(b);for(let B of z)B.removeFeatureState(R,h.id,g)}getFeatureState(h){this._checkLoaded();let g=h.source,b=h.sourceLayer,M=this._checkSource(g);if(M){if(M.type!=="vector"||b)return h.id===void 0&&this.fire(new n.f(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(g)[0].getFeatureState(b,h.id);this.fire(new n.f(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(h){return this.stylesheet.transition=n.Q({},this.stylesheet.transition,h),this.transition=this.stylesheet.transition,this}getTransition(){return n.Q({},this.stylesheet.transition)}serialize(){this._checkLoaded();let h=this.getTerrain(),g=h&&this.terrain&&this.terrain.scope===this.scope?h:this.stylesheet.terrain;return n.d0({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:g,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},b=>b!==void 0)}_updateLayer(h){this._changes.updateLayer(h);let g=this.getLayerSourceCache(h),b=n.am(h.source,h.scope),M=this._changes.getUpdatedSourceCaches();h.source&&!M[b]&&g&&g.getSource().type!=="raster"&&(this._changes.updateSourceCache(b,"reload"),g.pause()),h.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(h){let g=z=>this._mergedLayers[z].type==="fill-extrusion"||this._mergedLayers[z].type==="model",b=this.order,M={},C=[];for(let z=b.length-1;z>=0;z--){let B=b[z];if(g(B)){M[B]=z;for(let G of h){let W=G[B];if(W)for(let Z of W)C.push(Z)}}}C.sort((z,B)=>B.intersectionZ-z.intersectionZ);let R=[];for(let z=b.length-1;z>=0;z--){let B=b[z];if(g(B))for(let G=C.length-1;G>=0;G--){let W=C[G].feature;if(W.layer&&M[W.layer.id]<z)break;R.push(W),C.pop()}else for(let G of h){let W=G[B];if(W)for(let Z of W)R.push(Z.feature)}}return R}queryRenderedFeatures(h,g,b){g&&g.filter&&this._validate(qe,"queryRenderedFeatures.filter",g.filter,null,g),g.scope=this.scope,g.availableImages=this._availableImages,g.serializedLayers=this._serializedLayers;let M={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new n.f(new Error("parameters.layers must be an Array."))),[];for(let G of g.layers){let W=this._mergedLayers[G];if(!W)return this.fire(new n.f(new Error(`The layer '${G}' does not exist in the map's style and cannot be queried for features.`))),[];M[W.source]=!0}}let C=[],R=g.serializedLayers||{},z=g&&g.layers?g.layers.some(G=>{let W=this.getLayer(G);return W&&W.is3D()}):this.has3DLayers(),B=Ja.createFromScreenPoints(h,b);for(let G in this._mergedSourceCaches){let W=this._mergedSourceCaches[G].getSource();if(!W||W.scope!==g.scope)continue;let Z=this._mergedSourceCaches[G].getSource().id;g.layers&&!M[Z]||C.push(nu(this._mergedSourceCaches[G],this._mergedLayers,R,B,g,b,z,!!this.map._showQueryGeometry))}return this.placement&&C.push(function(G,W,Z,te,ne,ce,ue){let de={},pe=ce.queryRenderedSymbols(te),Me=[];for(let Te of Object.keys(pe).map(Number))Me.push(ue[Te]);Me.sort(d1);for(let Te of Me){let Se=Te.featureIndex.lookupSymbolFeatures(pe[Te.bucketInstanceId],W,Te.bucketIndex,Te.sourceLayerIndex,ne.filter,ne.layers,ne.availableImages,G);for(let Be in Se){let Oe=de[Be]=de[Be]||[],Le=Se[Be];Le.sort((Ge,We)=>{let at=Te.featureSortOrder;if(at){let Ye=at.indexOf(Ge.featureIndex);return at.indexOf(We.featureIndex)-Ye}return We.featureIndex-Ge.featureIndex});for(let Ge of Le)Oe.push(Ge)}}for(let Te in de)de[Te].forEach(Se=>{let Be=Se.feature,Oe=Z(G[Te]);if(!Oe)return;let Le=Oe.getFeatureState(Be.layer["source-layer"],Be.id);Be.source=Be.layer.source,Be.layer["source-layer"]&&(Be.sourceLayer=Be.layer["source-layer"]),Be.state=Le});return de}(this._mergedLayers,R,this.getLayerSourceCache.bind(this),B.screenGeometry,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(h,g){g&&g.filter&&this._validate(qe,"querySourceFeatures.filter",g.filter,null,g);let b=this.getOwnSourceCaches(h),M=[];for(let C of b)M=M.concat(bP(C,g));return M}addSourceType(h,g,b){return il.getSourceType(h)?b(new Error(`A source type called "${h}" already exists.`)):(il.setSourceType(h,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:g.workerSourceURL},b):b(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(h,g,b={}){this._checkLoaded();let M=this.light.getLight(),C=!1;for(let z in h)if(!n.d(h[z],M[z])){C=!0;break}if(!C)return;let R=this._getTransitionParameters();this.light.setLight(h,g,b),this.light.updateTransitions(R)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(h,g=1){if(this._checkLoaded(),!h)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),g===0&&delete this.terrain,h===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let b=h,M=h.source==null;if(g===1){if(this.disableElevatedTerrain)return;if(typeof b.source=="object"){let z="terrain-dem-src";this.addSource(z,b.source),b=n.cW(b),b=n.Q(b,{source:z})}let C=n.Q({},b),R={};if(this.terrain&&M){C.source=this.terrain.get().source;let z=this.terrain?this.getFragmentStyle(this.terrain.scope):null;z&&(R.style=z.serialize())}if(this._validate(Ie,"terrain",C,R))return}if(!this.terrain||this.terrain.scope!==this.scope&&!M||this.terrain&&g!==this.terrain.drapeRenderMode){if(!b)return;this._createTerrain(b,g),this.fire(new n.g("data",{dataType:"style"}))}else{let C=this.terrain,R=C.get();for(let z of Object.keys(n.N.terrain))!b.hasOwnProperty(z)&&n.N.terrain[z].default&&(b[z]=n.N.terrain[z].default);for(let z in h)if(!n.d(h[z],R[z])){C.set(h,this.options),this.stylesheet.terrain=h;let B=this._getTransitionParameters({duration:0});C.updateTransitions(B),this.fire(new n.g("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(h){let g=this.fog=new _n(h,this.map.transform,this.scope,this.options);this.stylesheet.fog=g.get();let b=this._getTransitionParameters({duration:0});g.updateTransitions(b)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let h of this.map._markers)h._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(h){if(this._checkLoaded(),!h)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let g=this.fog;if(!n.d(g.get(),h)){g.set(h,this.options),this.stylesheet.fog=g.get();let b=this._getTransitionParameters({duration:0});g.updateTransitions(b)}}else this._createFog(h);this._markersNeedUpdate=!0}setColorTheme(h){this._checkLoaded();let g=()=>{for(let M in this._layers)this._layers[M].lut=this._styleColorTheme.lut;for(let M in this._sourceCaches)this._sourceCaches[M].clearTiles()};if(this._styleColorTheme.colorTheme=h,!h)return this._styleColorTheme.lut=null,void g();let b=this._evaluateColorThemeData(h);this._loadColorTheme(b).then(()=>{this.fire(new n.g("colorthemeset")),g()}).catch(M=>{n.w(`Couldn't set color theme: ${M}`)})}_getTransitionParameters(h){return{now:n.e.now(),transition:n.Q(this.transition,h)}}updateDrapeFirstLayers(){if(!this.terrain)return;let h=[],g=[];for(let b of this._mergedOrder)this.isLayerDraped(this._mergedLayers[b])?h.push(b):g.push(b);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...h),this._drapedFirstOrder.push(...g)}_createTerrain(h,g){let b=this.terrain=new Sr(h,g,this.scope,this.options);g===1&&(this.stylesheet.terrain=h),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let M=this._getTransitionParameters({duration:0});b.updateTransitions(M)}_force3DLayerUpdate(){for(let h in this._layers){let g=this._layers[h];g.type==="fill-extrusion"&&this._updateLayer(g)}}_forceSymbolLayerUpdate(){for(let h in this._layers){let g=this._layers[h];g.type==="symbol"&&this._updateLayer(g)}}_validate(h,g,b,M,C={}){if(C&&C.validate===!1)return!1;let R=n.Q({},this.serialize());return tl(this,h.call(ie,n.Q({key:g,style:R,value:b,styleSpec:n.N},M)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.d1.off("pluginStateChange",this._rtlTextPluginCallback);for(let h in this._mergedLayers)this._mergedLayers[h].setEventedParent(null);for(let h in this._mergedSourceCaches)this._mergedSourceCaches[h].clearTiles(),this._mergedSourceCaches[h].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(h){let g=this.getSourceCaches(h);for(let b of g)b.clearTiles()}clearSources(){for(let h in this._mergedSourceCaches)this._mergedSourceCaches[h].clearTiles()}reloadSource(h){let g=this.getSourceCaches(h);for(let b of g)b.resume(),b.reload()}reloadSources(){for(let h of this.getSources())h.reload&&h.reload()}updateSources(h){let g;this.directionalLight&&(g=Bp(this.directionalLight));for(let b in this._mergedSourceCaches)this._mergedSourceCaches[b].update(h,void 0,void 0,g)}_generateCollisionBoxes(){for(let h in this._sourceCaches){let g=this._sourceCaches[h];g.resume(),g.reload()}}_updatePlacement(h,g,b,M,C,R,z=!1){let B=!1,G=!1,W={},Z={};for(let te of this._mergedOrder){let ne=this._mergedLayers[te];if(ne.type!=="symbol")continue;let ce=n.am(ne.source,ne.scope),ue=W[ce];if(!ue){let pe=this.getLayerSourceCache(ne);if(!pe)continue;let Me=pe.getRenderableIds(!0).map(Te=>pe.getTileByID(Te));Z[ce]=Me.slice(),ue=W[ce]=Me.sort((Te,Se)=>Se.tileID.overscaledZ-Te.tileID.overscaledZ||(Te.tileID.isLessThan(Se.tileID)?-1:1))}let de=this.crossTileSymbolIndex.addLayer(ne,ue,g.center.lng,g.projection);B=B||de}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),z=z||this._layerOrderChanged||M===0,this._layerOrderChanged&&this.fire(new n.g("neworder")),(z||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.e.now(),g.zoom))&&(this.pauseablePlacement=new VE(g,this._mergedOrder,z,b,M,C,this.placement,this.fog&&g.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,W,Z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.e.now()),G=!0),B&&this.pauseablePlacement.placement.setStale()),G||B){this._buildingIndex.onNewFrame(g.zoom);for(let te=0;te<this._mergedOrder.length;te++){let ne=this._mergedLayers[this._mergedOrder[te]];if(ne.type!=="symbol")continue;let ce=this.isLayerClipped(ne)&&this._clipLayerIndices.some(ue=>te<ue);this.placement.updateLayerOpacities(ne,W[n.am(ne.source,ne.scope)],te,ce?R:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.e.now())}}_releaseSymbolFadeTiles(){for(let h in this._sourceCaches)this._sourceCaches[h].releaseSymbolFadeTiles()}addImport(h,g){this._checkLoaded();let b=this.stylesheet.imports=this.stylesheet.imports||[];if(b.findIndex(({id:C})=>C===h.id)!==-1)return void this.fire(new n.f(new Error(`Import with id '${h.id}' already exists in the map's style.`)));if(!g)return b.push(h),this._loadImports([h],!0);let M=b.findIndex(({id:C})=>C===g);return M===-1&&this.fire(new n.f(new Error(`Import with id "${g}" does not exist on this map.`))),this.stylesheet.imports=b.slice(0,M).concat(h).concat(b.slice(M)),this._loadImports([h],!0,g)}updateImport(h,g){this._checkLoaded();let b=this.stylesheet.imports||[],M=this.getImportIndex(h);return M===-1?this:typeof g=="string"?(this.setImportUrl(h,g),this):(g.url&&g.url!==b[M].url&&this.setImportUrl(h,g.url),n.d(g.config,b[M].config)||this.setImportConfig(h,g.config),n.d(g.data,b[M].data)||this.setImportData(h,g.data),this)}moveImport(h,g){this._checkLoaded();let b=this.stylesheet.imports||[],M=this.getImportIndex(h);if(M===-1)return this;let C=this.getImportIndex(g);if(C===-1)return this;let R=b[M],z=this.fragments[M];return b=b.filter(({id:B})=>B!==h),this.fragments=this.fragments.filter(({id:B})=>B!==h),this.stylesheet.imports=b.slice(0,C).concat(R).concat(b.slice(C)),this.fragments=this.fragments.slice(0,C).concat(z).concat(this.fragments.slice(C)),this.mergeLayers(),this}setImportUrl(h,g){this._checkLoaded();let b=this.stylesheet.imports||[],M=this.getImportIndex(h);if(M===-1)return this;b[M].url=g;let C=this.fragments[M];return C.style=this._createFragmentStyle(b[M]),C.style.on("style.import.load",()=>this.mergeAll()),C.style.loadURL(g),this}setImportData(h,g){this._checkLoaded();let b=this.getImportIndex(h),M=this.stylesheet.imports||[];return b===-1?this:g?(this.fragments[b].style.setState(g),this._reloadImports(),this):(delete M[b].data,this.setImportUrl(h,M[b].url))}setImportConfig(h,g){this._checkLoaded();let b=this.getImportIndex(h),M=this.stylesheet.imports||[];if(b===-1)return this;g?M[b].config=g:delete M[b].config;let C=this.fragments[b],R=C.style.stylesheet&&C.style.stylesheet.schema;return C.config=g,C.style.updateConfig(g,R),this.updateConfigDependencies(),this}removeImport(h){this._checkLoaded();let g=this.stylesheet.imports||[],b=this.getImportIndex(h);b!==-1&&(g.splice(b,1),this.fragments[b].style._remove(),this.fragments.splice(b,1),this._reloadImports())}getImportIndex(h){let g=(this.stylesheet.imports||[]).findIndex(b=>b.id===h);return g===-1&&this.fire(new n.f(new Error(`Import '${h}' does not exist in the map's style and cannot be updated.`))),g}getLayer(h){return this._mergedLayers[h]}getSources(){let h=[];for(let g in this._mergedOtherSourceCaches){let b=this._mergedOtherSourceCaches[g];b&&h.push(b.getSource())}return h}getSource(h,g){let b=this.getSourceCache(h,g);return b&&b.getSource()}getLayerSource(h){let g=this.getLayerSourceCache(h);return g&&g.getSource()}getSourceCache(h,g){let b=n.am(h,g);return this._mergedOtherSourceCaches[b]}getLayerSourceCache(h){let g=n.am(h.source,h.scope);return h.type==="symbol"?this._mergedSymbolSourceCaches[g]:this._mergedOtherSourceCaches[g]}getSourceCaches(h){if(h==null)return Object.values(this._mergedSourceCaches);let g=[];return this._mergedOtherSourceCaches[h]&&g.push(this._mergedOtherSourceCaches[h]),this._mergedSymbolSourceCaches[h]&&g.push(this._mergedSymbolSourceCaches[h]),g}updateSourceCaches(){let h=this._changes.getUpdatedSourceCaches();for(let g in h){let b=h[g];b==="reload"?this.reloadSource(g):b==="clear"&&this.clearSource(g)}}updateLayers(h){let g=this._changes.getUpdatedPaintProperties();for(let b of g){let M=this.getLayer(b);M&&M.updateTransitions(h)}}getImages(h,g,b){this.imageManager.getImages(g.icons,g.scope,b),this._updateTilesForChangedImages();let M=C=>{C&&C.setDependencies(g.tileID.key,g.type,g.icons)};M(this._otherSourceCaches[g.source]),M(this._symbolSourceCaches[g.source])}getGlyphs(h,g,b){this.glyphManager.getGlyphs(g.stacks,g.scope,b)}getResource(h,g,b){return n.d2(g,b)}getOwnSourceCache(h){return this._otherSourceCaches[h]}getOwnLayerSourceCache(h){return h.type==="symbol"?this._symbolSourceCaches[h.source]:this._otherSourceCaches[h.source]}getOwnSourceCaches(h){let g=[];return this._otherSourceCaches[h]&&g.push(this._otherSourceCaches[h]),this._symbolSourceCaches[h]&&g.push(this._symbolSourceCaches[h]),g}_isSourceCacheLoaded(h){let g=this.getOwnSourceCaches(h);return g.length===0?(this.fire(new n.f(new Error(`There is no source with ID '${h}'`))),!1):g.every(b=>b.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(h,g){if(this._clipLayerIndices.length===0&&h.type!=="fill-extrusion")return!1;let b=h.type==="fill-extrusion"&&h.sourceLayer==="building",M=0;if(h.is3D()){if(b||g&&g.type==="batched-model")return!0;h.type==="model"&&(M=n.cw.Model)}else h.type==="symbol"&&(M=n.cw.Symbol);for(let C of this._clipLayerIndices){let R=this._mergedLayers[this._mergedOrder[C]];if(!R)continue;let z=[];for(let B of R.layout.get("clip-layer-types"))z.push(B==="model"?n.cw.Model:B==="symbol"?n.cw.Symbol:n.cw.FillExtrusion);for(let B of z)if(M&B)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(h=>{h.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function qE(_,h){let g=!1,b=null,M=()=>{b=null,g&&(_(),b=setTimeout(M,h),g=!1)};return()=>(g=!0,b||M(),b)}il.getSourceType=function(_){return lv[_]},il.setSourceType=function(_,h){lv[_]=h},il.registerForPluginStateChange=n.cO;class YE{constructor(h){this._hashName=h&&encodeURIComponent(h),n.br(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=qE(this._updateHashUnthrottled.bind(this),300)}addTo(h){return this._map=h,window.addEventListener("hashchange",this._onHashChange,!1),h.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let h=this._map;if(!h)return"";let g=v1(h);if(this._hashName){let b=this._hashName,M=!1,C=location.hash.slice(1).split("&").map(R=>{let z=R.split("=")[0];return z===b?(M=!0,`${z}=${g}`):R}).filter(R=>R);return M||C.push(`${b}=${g}`),`#${C.join("&")}`}return`#${g}`}_getCurrentHash(){let h=location.hash.replace("#","");if(this._hashName){let g;return h.split("&").map(b=>b.split("=")).forEach(b=>{b[0]===this._hashName&&(g=b)}),(g&&g[1]||"").split("/")}return h.split("/")}_onHashChange(){let h=this._map;if(!h)return!1;let g=this._getCurrentHash();if(g.length>=3&&!g.some(b=>isNaN(b))){let b=h.dragRotate.isEnabled()&&h.touchZoomRotate.isEnabled()?+(g[3]||0):h.getBearing();return h.jumpTo({center:[+g[2],+g[1]],zoom:+g[0],bearing:b,pitch:+(g[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function v1(_,h){let g=_.getCenter(),b=Math.round(100*_.getZoom())/100,M=Math.ceil((b*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,M),R=Math.round(g.lng*C)/C,z=Math.round(g.lat*C)/C,B=_.getBearing(),G=_.getPitch(),W=h?`/${R}/${z}/${b}`:`${b}/${z}/${R}`;return(B||G)&&(W+="/"+Math.round(10*B)/10),G&&(W+=`/${Math.round(G)}`),W}let Zp={linearity:.3,easing:n.d3(0,0,.3,1)},TP=n.Q({deceleration:2500,maxSpeed:1400},Zp),AP=n.Q({deceleration:20,maxSpeed:1400},Zp),CP=n.Q({deceleration:1e3,maxSpeed:360},Zp),DP=n.Q({deceleration:1e3,maxSpeed:90},Zp);class XE{constructor(h){this._map=h,this.clear()}clear(){this._inertiaBuffer=[]}record(h){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.e.now(),settings:h})}_drainInertiaBuffer(){let h=this._inertiaBuffer,g=n.e.now();for(;h.length>0&&g-h[0].time>160;)h.shift()}_onMoveEnd(h){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let g={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:C}of this._inertiaBuffer)g.zoom+=C.zoomDelta||0,g.bearing+=C.bearingDelta||0,g.pitch+=C.pitchDelta||0,C.panDelta&&g.pan._add(C.panDelta),C.around&&(g.around=C.around),C.pinchAround&&(g.pinchAround=C.pinchAround);let b=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(g.pan.mag()){let C=xd(g.pan.mag(),b,n.Q({},TP,h||{}));M.offset=g.pan.mult(C.amount/g.pan.mag()),M.center=this._map.transform.center,Cv(M,C)}if(g.zoom){let C=xd(g.zoom,b,AP);M.zoom=this._map.transform.zoom+C.amount,Cv(M,C)}if(g.bearing){let C=xd(g.bearing,b,CP);M.bearing=this._map.transform.bearing+n.au(C.amount,-179,179),Cv(M,C)}if(g.pitch){let C=xd(g.pitch,b,DP);M.pitch=this._map.transform.pitch+C.amount,Cv(M,C)}if(M.zoom||M.bearing){let C=g.pinchAround===void 0?g.around:g.pinchAround;M.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),M.noMoveStart=!0,M}}function Cv(_,h){(!_.duration||_.duration<h.duration)&&(_.duration=h.duration,_.easing=h.easing)}function xd(_,h,g){let{maxSpeed:b,linearity:M,deceleration:C}=g,R=n.au(_*M/(h/1e3),-b,b),z=Math.abs(R)/(C*M);return{easing:g.easing,duration:1e3*z,amount:R*(z/2)}}class rl extends n.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,g,b,M={}){let C=U(g.getCanvasContainer(),b),R=g.unproject(C);super(h,n.Q({point:C,lngLat:R,originalEvent:b},M)),this._defaultPrevented=!1,this.target=g}}class tg extends n.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,g,b){let M=h==="touchend"?b.changedTouches:b.touches,C=j(g.getCanvasContainer(),M),R=C.map(B=>g.unproject(B)),z=C.reduce((B,G,W,Z)=>B.add(G.div(Z.length)),new n.P(0,0));super(h,{points:C,point:z,lngLats:R,lngLat:g.unproject(z),originalEvent:b}),this._defaultPrevented=!1}}class _1 extends n.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(h,g){super("wheel",{originalEvent:g}),this._defaultPrevented=!1}}class Dv{constructor(h,g){this._map=h,this._clickTolerance=g.clickTolerance}reset(){this._mousedownPos=void 0}wheel(h){return this._firePreventable(new _1(this._map,h))}mousedown(h,g){return this._mousedownPos=g,this._firePreventable(new rl(h.type,this._map,h))}mouseup(h){this._map.fire(new rl(h.type,this._map,h))}preclick(h){let g=n.Q({},h);g.type="preclick",this._map.fire(new rl(g.type,this._map,g))}click(h,g){this._mousedownPos&&this._mousedownPos.dist(g)>=this._clickTolerance||(this.preclick(h),this._map.fire(new rl(h.type,this._map,h)))}dblclick(h){return this._firePreventable(new rl(h.type,this._map,h))}mouseover(h){this._map.fire(new rl(h.type,this._map,h))}mouseout(h){this._map.fire(new rl(h.type,this._map,h))}touchstart(h){return this._firePreventable(new tg(h.type,this._map,h))}touchmove(h){this._map.fire(new tg(h.type,this._map,h))}touchend(h){this._map.fire(new tg(h.type,this._map,h))}touchcancel(h){this._map.fire(new tg(h.type,this._map,h))}_firePreventable(h){if(this._map.fire(h),h.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class x1{constructor(h){this._map=h}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(h){this._map.fire(new rl(h.type,this._map,h))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new rl("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(h){this._delayContextMenu?this._contextMenuEvent=h:this._map.fire(new rl(h.type,this._map,h)),this._map.listens("contextmenu")&&h.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bd{constructor(h,g){this._map=h,this._el=h.getCanvasContainer(),this._container=h.getContainer(),this._clickTolerance=g.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(h,g){this.isEnabled()&&h.shiftKey&&h.button===0&&(I(),this._startPos=this._lastPos=g,this._active=!0)}mousemoveWindow(h,g){if(!this._active)return;let b=g,M=this._startPos,C=this._lastPos;if(!M||!C||C.equals(b)||!this._box&&b.dist(M)<this._clickTolerance)return;this._lastPos=b,this._box||(this._box=f("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",h));let R=Math.min(M.x,b.x),z=Math.max(M.x,b.x),B=Math.min(M.y,b.y),G=Math.max(M.y,b.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${R}px,${B}px)`,this._box.style.width=z-R+"px",this._box.style.height=G-B+"px")})}mouseupWindow(h,g){if(!this._active)return;let b=this._startPos,M=g;if(b&&h.button===0){if(this.reset(),k(),b.x!==M.x||b.y!==M.y)return this._map.fire(new n.g("boxzoomend",{originalEvent:h})),{cameraAnimation:C=>C.fitScreenCoordinates(b,M,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",h)}}keydown(h){this._active&&h.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",h))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),P(),delete this._startPos,delete this._lastPos}_fireEvent(h,g){return this._map.fire(new n.g(h,{originalEvent:g}))}}function ig(_,h){let g={};for(let b=0;b<_.length;b++)g[_[b].identifier]=h[b];return g}class $E{constructor(h){this.reset(),this.numTouches=h.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(h,g,b){(this.centroid||b.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=h.timeStamp),b.length===this.numTouches&&(this.centroid=function(M){let C=new n.P(0,0);for(let R of M)C._add(R);return C.div(M.length)}(g),this.touches=ig(b,g)))}touchmove(h,g,b){if(this.aborted||!this.centroid)return;let M=ig(b,g);for(let C in this.touches){let R=M[C];(!R||R.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(h,g,b){if((!this.centroid||h.timeStamp-this.startTime>500)&&(this.aborted=!0),b.length===0){let M=!this.aborted&&this.centroid;if(this.reset(),M)return M}}}class uh{constructor(h){this.singleTap=new $E(h),this.numTaps=h.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(h,g,b){this.singleTap.touchstart(h,g,b)}touchmove(h,g,b){this.singleTap.touchmove(h,g,b)}touchend(h,g,b){let M=this.singleTap.touchend(h,g,b);if(M){let C=h.timeStamp-this.lastTime<500,R=!this.lastTap||this.lastTap.dist(M)<30;if(C&&R||this.reset(),this.count++,this.lastTime=h.timeStamp,this.lastTap=M,this.count===this.numTaps)return this.reset(),M}}}class rg{constructor(){this._zoomIn=new uh({numTouches:1,numTaps:2}),this._zoomOut=new uh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(h,g,b){this._zoomIn.touchstart(h,g,b),this._zoomOut.touchstart(h,g,b)}touchmove(h,g,b){this._zoomIn.touchmove(h,g,b),this._zoomOut.touchmove(h,g,b)}touchend(h,g,b){let M=this._zoomIn.touchend(h,g,b),C=this._zoomOut.touchend(h,g,b);return M?(this._active=!0,h.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(M)},{originalEvent:h})}):C?(this._active=!0,h.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(C)},{originalEvent:h})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Iv={0:1,2:2};class ng{constructor(h){this.reset(),this._clickTolerance=h.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(h,g){return!1}_move(h,g){return{}}mousedown(h,g){if(this._lastPoint)return;let b=V(h);this._correctButton(h,b)&&(this._lastPoint=g,this._eventButton=b)}mousemoveWindow(h,g){let b=this._lastPoint;if(b){if(h.preventDefault(),this._eventButton!=null&&function(M,C){let R=Iv[C];return M.buttons===void 0||(M.buttons&R)!==R}(h,this._eventButton))this.reset();else if(this._moved||!(g.dist(b)<this._clickTolerance))return this._moved=!0,this._lastPoint=g,this._move(b,g)}}mouseupWindow(h){this._lastPoint&&V(h)===this._eventButton&&(this._moved&&k(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sg extends ng{mousedown(h,g){super.mousedown(h,g),this._lastPoint&&(this._active=!0)}_correctButton(h,g){return g===0&&!h.ctrlKey}_move(h,g){return{around:g,panDelta:g.sub(h)}}}class og extends ng{_correctButton(h,g){return g===0&&h.ctrlKey||g===2}_move(h,g){let b=.8*(g.x-h.x);if(b)return this._active=!0,{bearingDelta:b}}contextmenu(h){h.preventDefault()}}class Pv extends ng{_correctButton(h,g){return g===0&&h.ctrlKey||g===2}_move(h,g){let b=-.5*(g.y-h.y);if(b)return this._active=!0,{pitchDelta:b}}contextmenu(h){h.preventDefault()}}class ZE{constructor(h,g){this._map=h,this._el=h.getCanvasContainer(),this._minTouches=1,this._clickTolerance=g.clickTolerance||1,this.reset(),n.br(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(h,g,b){return this._calculateTransform(h,g,b)}touchmove(h,g,b){if(this._active&&!(b.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(b.length===1&&!n.d4())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return h.cancelable&&h.preventDefault(),this._calculateTransform(h,g,b)}}touchend(h,g,b){this._calculateTransform(h,g,b),this._active&&b.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(h,g,b){b.length>0&&(this._active=!0);let M=ig(b,g),C=new n.P(0,0),R=new n.P(0,0),z=0;for(let G in M){let W=M[G],Z=this._touches[G];Z&&(C._add(W),R._add(W.sub(Z)),z++,M[G]=W)}if(this._touches=M,z<this._minTouches||!R.mag())return;let B=R.div(z);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(z),panDelta:B}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=f("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class ag{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(h){}_move(h,g,b){return{}}touchstart(h,g,b){this._firstTwoTouches||b.length<2||(this._firstTwoTouches=[b[0].identifier,b[1].identifier],this._start([g[0],g[1]]))}touchmove(h,g,b){let M=this._firstTwoTouches;if(!M)return;h.preventDefault();let[C,R]=M,z=wd(b,g,C),B=wd(b,g,R);if(!z||!B)return;let G=this._aroundCenter?null:z.add(B).div(2);return this._move([z,B],G,h)}touchend(h,g,b){if(!this._firstTwoTouches)return;let[M,C]=this._firstTwoTouches,R=wd(b,g,M),z=wd(b,g,C);R&&z||(this._active&&k(),this.reset())}touchcancel(){this.reset()}enable(h){this._enabled=!0,this._aroundCenter=!!h&&h.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function wd(_,h,g){for(let b=0;b<_.length;b++)if(_[b].identifier===g)return h[b]}function Qp(_,h){return Math.log(_/h)/Math.LN2}class QE extends ag{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(h){this._startDistance=this._distance=h[0].dist(h[1])}_move(h,g){let b=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(Qp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Qp(this._distance,b),pinchAround:g}}}function b1(_,h){return 180*_.angleWith(h)/Math.PI}class KE extends ag{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])}_move(h,g){let b=this._vector;if(this._vector=h[0].sub(h[1]),b&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:b1(this._vector,b),pinchAround:g}}_isBelowThreshold(h){this._minDiameter=Math.min(this._minDiameter,h.mag());let g=25/(Math.PI*this._minDiameter)*360,b=this._startVector;if(!b)return!1;let M=b1(h,b);return Math.abs(M)<g}}function hh(_){return Math.abs(_.y)>Math.abs(_.x)}class JE extends ag{constructor(h){super(),this._map=h}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(h){this._lastPoints=h,hh(h[0].sub(h[1]))&&(this._valid=!1)}_move(h,g,b){let M=this._lastPoints;if(!M)return;let C=h[0].sub(M[0]),R=h[1].sub(M[1]);return this._map._cooperativeGestures&&!n.d4()&&b.touches.length<3||(this._valid=this.gestureBeginsVertically(C,R,b.timeStamp),!this._valid)?void 0:(this._lastPoints=h,this._active=!0,{pitchDelta:(C.y+R.y)/2*-.5})}gestureBeginsVertically(h,g,b){if(this._valid!==void 0)return this._valid;let M=h.mag()>=2,C=g.mag()>=2;if(!M&&!C)return;if(!M||!C)return this._firstMove==null&&(this._firstMove=b),b-this._firstMove<100&&void 0;let R=h.y>0==g.y>0;return hh(h)&&hh(g)&&R}}let IP={panStep:100,bearingStep:15,pitchStep:10};class PP{constructor(){let h=IP;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(h){if(h.altKey||h.ctrlKey||h.metaKey)return;let g=0,b=0,M=0,C=0,R=0;switch(h.keyCode){case 61:case 107:case 171:case 187:g=1;break;case 189:case 109:case 173:g=-1;break;case 37:h.shiftKey?b=-1:(h.preventDefault(),C=-1);break;case 39:h.shiftKey?b=1:(h.preventDefault(),C=1);break;case 38:h.shiftKey?M=1:(h.preventDefault(),R=-1);break;case 40:h.shiftKey?M=-1:(h.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(b=0,M=0),{cameraAnimation:z=>{let B=z.getZoom();z.easeTo({duration:300,easeId:"keyboardHandler",easing:RP,zoom:g?Math.round(B)+g*(h.shiftKey?2:1):B,bearing:z.getBearing()+b*this._bearingStep,pitch:z.getPitch()+M*this._pitchStep,offset:[-C*this._panStep,-R*this._panStep],center:z.getCenter()},{originalEvent:h})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function RP(_){return _*(2-_)}let Rv=4.000244140625,w1=1/450;class S1{constructor(h,g){this._map=h,this._el=h.getCanvasContainer(),this._handler=g,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=w1,n.br(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(h){this._defaultZoomRate=h}setWheelZoomRate(h){this._wheelZoomRate=h}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(h){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!h&&h.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(h){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(h.ctrlKey||h.metaKey||this.isZooming()||n.d4()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let g=h.deltaMode===WheelEvent.DOM_DELTA_LINE?40*h.deltaY:h.deltaY,b=n.e.now(),M=b-(this._lastWheelEventTime||0);this._lastWheelEventTime=b,g!==0&&g%Rv==0?this._type="wheel":g!==0&&Math.abs(g)<4?this._type="trackpad":M>400?(this._type=null,this._lastValue=g,this._timeout=window.setTimeout(this._onTimeout,40,h)):this._type||(this._type=Math.abs(M*g)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,g+=this._lastValue)),h.shiftKey&&g&&(g/=4),this._type&&(this._lastWheelEvent=h,this._delta-=g,this._active||this._start(h)),h.preventDefault()}_onTimeout(h){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)}_start(h){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let g=U(this._el,h);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:g,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let h=this._map.transform;this._type==="wheel"&&h.projection.wrap&&(h._center.lng>=180||h._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let g=()=>h._terrainEnabled()&&this._aroundCoord?h.computeZoomRelativeTo(this._aroundCoord):h.zoom;if(this._delta!==0){let G=this._type==="wheel"&&Math.abs(this._delta)>Rv?this._wheelZoomRate:this._defaultZoomRate,W=2/(1+Math.exp(-Math.abs(this._delta*G)));this._delta<0&&W!==0&&(W=1/W);let Z=g(),te=Math.pow(2,Z),ne=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):te;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(ne*W))),this._type==="wheel"&&(this._startZoom=Z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let b=typeof this._targetZoom=="number"?this._targetZoom:g(),M=this._startZoom,C=this._easing,R,z=!1;if(this._type==="wheel"&&M&&C){let G=Math.min((n.e.now()-this._lastWheelEventTime)/200,1),W=C(G);R=n.a3(M,b,W),G<1?this._frameId||(this._frameId=!0):z=!0}else R=b,z=!0;this._active=!0,z&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let B=R-g();return B*this._lastDelta<0&&(B=0),{noInertia:!0,needsRenderFrame:!z,zoomDelta:B,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(h){let g=n.d5;if(this._prevEase){let b=this._prevEase,M=(n.e.now()-b.start)/b.duration,C=b.easing(M+.01)-b.easing(M),R=.27/Math.sqrt(C*C+1e-4)*.01,z=Math.sqrt(.0729-R*R);g=n.d3(R,z,.25,1)}return this._prevEase={start:n.e.now(),duration:h,easing:g},g}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=f("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class E1{constructor(h,g){this._clickZoom=h,this._tapZoom=g}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class eM{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(h,g){return h.preventDefault(),{cameraAnimation:b=>{b.easeTo({duration:300,zoom:b.getZoom()+(h.shiftKey?-1:1),around:b.unproject(g)},{originalEvent:h})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tM{constructor(){this._tap=new uh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(h,g,b){this._swipePoint||(this._tapTime&&h.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?b.length>0&&(this._swipePoint=g[0],this._swipeTouch=b[0].identifier):this._tap.touchstart(h,g,b))}touchmove(h,g,b){if(this._tapTime){if(this._swipePoint){if(b[0].identifier!==this._swipeTouch)return;let M=g[0],C=M.y-this._swipePoint.y;return this._swipePoint=M,h.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(h,g,b)}touchend(h,g,b){this._tapTime?this._swipePoint&&b.length===0&&this.reset():this._tap.touchend(h,g,b)&&(this._tapTime=h.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class OP{constructor(h,g,b){this._el=h,this._mousePan=g,this._touchPan=b}enable(h){this._inertiaOptions=h||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class lg{constructor(h,g,b){this._pitchWithRotate=h.pitchWithRotate,this._mouseRotate=g,this._mousePitch=b}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class cg{constructor(h,g,b,M){this._el=h,this._touchZoom=g,this._touchRotate=b,this._tapDragZoom=M,this._rotationDisabled=!1,this._enabled=!0}enable(h){this._touchZoom.enable(h),this._rotationDisabled||this._touchRotate.enable(h),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let ug=_=>_.zoom||_.drag||_.pitch||_.rotate;class nl extends n.g{}class M1{constructor(){this.constants=[1,1,.01],this.radius=0}setup(h,g){let b=n.$.sub([],g,h);this.radius=n.$.length(b[2]<0?n.$.div([],b,this.constants):[b[0],b[1],0])}projectRay(h){n.$.div(h,h,this.constants),n.$.normalize(h,h),n.$.mul(h,h,this.constants);let g=n.$.scale([],h,this.radius);if(g[2]>0){let b=n.$.scale([],[0,0,1],n.$.dot(g,[0,0,1])),M=n.$.scale([],n.$.normalize([],[g[0],g[1],0]),this.radius),C=n.$.add([],g,n.$.scale([],n.$.sub([],n.$.add([],M,b),g),2));g[0]=C[0],g[1]=C[1]}return g}}function Sd(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class Ov{constructor(h,g){this._map=h,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new XE(h),this._bearingSnap=g.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new M1,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(g),n.br(["handleEvent","handleWindowEvent"],this);let b=this._el;this._listeners=[[b,"touchstart",{passive:!0}],[b,"touchmove",{passive:!1}],[b,"touchend",void 0],[b,"touchcancel",void 0],[b,"mousedown",void 0],[b,"mousemove",void 0],[b,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[b,"mouseover",void 0],[b,"mouseout",void 0],[b,"dblclick",void 0],[b,"click",void 0],[b,"keydown",{capture:!1}],[b,"keyup",void 0],[b,"wheel",{passive:!1}],[b,"contextmenu",void 0],[window,"blur",void 0]];for(let[M,C,R]of this._listeners){let z=M===document?this.handleWindowEvent:this.handleEvent;M.addEventListener(C,z,R)}}destroy(){for(let[h,g,b]of this._listeners){let M=h===document?this.handleWindowEvent:this.handleEvent;h.removeEventListener(g,M,b)}}_addDefaultHandlers(h){let g=this._map,b=g.getCanvasContainer();this._add("mapEvent",new Dv(g,h));let M=g.boxZoom=new bd(g,h);this._add("boxZoom",M);let C=new rg,R=new eM;g.doubleClickZoom=new E1(R,C),this._add("tapZoom",C),this._add("clickZoom",R);let z=new tM;this._add("tapDragZoom",z);let B=g.touchPitch=new JE(g);this._add("touchPitch",B);let G=new og(h),W=new Pv(h);g.dragRotate=new lg(h,G,W),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",W,["mouseRotate"]);let Z=new sg(h),te=new ZE(g,h);g.dragPan=new OP(b,Z,te),this._add("mousePan",Z),this._add("touchPan",te,["touchZoom","touchRotate"]);let ne=new KE,ce=new QE;g.touchZoomRotate=new cg(b,ce,ne,z),this._add("touchRotate",ne,["touchPan","touchZoom"]),this._add("touchZoom",ce,["touchPan","touchRotate"]),this._add("blockableMapEvent",new x1(g));let ue=g.scrollZoom=new S1(g,this);this._add("scrollZoom",ue,["mousePan"]);let de=g.keyboard=new PP;this._add("keyboard",de);for(let pe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])h.interactive&&h[pe]&&g[pe].enable(h[pe])}_add(h,g,b){this._handlers.push({handlerName:h,handler:g,allowed:b}),this._handlersById[h]=g}stop(h){if(!this._updatingCamera){for(let{handler:g}of this._handlers)g.reset();this._inertia.clear(),this._fireEvents({},{},h),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:h}of this._handlers)if(h.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ug(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(h,g,b){for(let M in h)if(M!==b&&(!g||g.indexOf(M)<0))return!0;return!1}handleWindowEvent(h){this.handleEvent(h,`${h.type}Window`)}_getMapTouches(h){let g=[];for(let b of h)this._el.contains(b.target)&&g.push(b);return g}handleEvent(h,g){this._updatingCamera=!0;let b=h.type==="renderFrame",M=b?void 0:h,C={needsRenderFrame:!1},R={},z={},B=h.touches?this._getMapTouches(h.touches):void 0,G=B?j(this._el,B):b?void 0:U(this._el,h);for(let{handlerName:te,handler:ne,allowed:ce}of this._handlers){if(!ne.isEnabled())continue;let ue;this._blockedByActive(z,ce,te)?ne.reset():ne[g||h.type]&&(ue=ne[g||h.type](h,G,B),this.mergeHandlerResult(C,R,ue,te,M),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()),(ue||ne.isActive())&&(z[te]=ne)}let W={};for(let te in this._previousActiveHandlers)z[te]||(W[te]=M);this._previousActiveHandlers=z,(Object.keys(W).length||Sd(C))&&(this._changes.push([C,R,W]),this._triggerRenderFrame()),(Object.keys(z).length||Sd(C))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:Z}=C;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))}mergeHandlerResult(h,g,b,M,C){if(!b)return;n.Q(h,b);let R={handlerName:M,originalEvent:b.originalEvent||C};b.zoomDelta!==void 0&&(g.zoom=R),b.panDelta!==void 0&&(g.drag=R),b.pitchDelta!==void 0&&(g.pitch=R),b.bearingDelta!==void 0&&(g.rotate=R)}_applyChanges(){let h={},g={},b={};for(let[M,C,R]of this._changes)M.panDelta&&(h.panDelta=(h.panDelta||new n.P(0,0))._add(M.panDelta)),M.zoomDelta&&(h.zoomDelta=(h.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(h.bearingDelta=(h.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(h.pitchDelta=(h.pitchDelta||0)+M.pitchDelta),M.around!==void 0&&(h.around=M.around),M.aroundCoord!==void 0&&(h.aroundCoord=M.aroundCoord),M.pinchAround!==void 0&&(h.pinchAround=M.pinchAround),M.noInertia&&(h.noInertia=M.noInertia),n.Q(g,C),n.Q(b,R);this._updateMapTransform(h,g,b),this._changes=[]}_updateMapTransform(h,g,b){let M=this._map,C=M.transform,R=Me=>[Me.x,Me.y,Me.z];if((Me=>{let Te=this._eventsInProgress.drag;return Te&&!this._handlersById[Te.handlerName].isActive()})()&&!Sd(h)){let Me=C.zoom;C.cameraElevationReference="sea",this._originalZoom!=null&&C._orthographicProjectionAtLowPitch&&C.projection.name!=="globe"&&C.pitch===0?(C.cameraElevationReference="ground",C.zoom=this._originalZoom):(C.recenterOnTerrain(),C.cameraElevationReference="ground"),Me!==C.zoom&&this._map._update(!0)}if(C._isCameraConstrained&&M._stop(!0),!Sd(h))return void this._fireEvents(g,b,!0);let{panDelta:z,zoomDelta:B,bearingDelta:G,pitchDelta:W,around:Z,aroundCoord:te,pinchAround:ne}=h;C._isCameraConstrained&&(B>0&&(B=0),C._isCameraConstrained=!1),ne!==void 0&&(Z=ne),(B||(Me=>g[Me]&&!this._eventsInProgress[Me])("drag"))&&Z&&(this._dragOrigin=R(C.pointCoordinate3D(Z)),this._originalZoom=C.zoom,this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",M._stop(!0),Z=Z||M.transform.centerPoint,G&&(C.bearing+=G),W&&(C.pitch+=W),C._updateCameraState();let ce=[0,0,0];if(z)if(C.projection.name==="mercator"){let Me=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(Z).dir),Te=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(Z.sub(z)).dir);ce[0]=Te[0]-Me[0],ce[1]=Te[1]-Me[1]}else{let Me=C.pointCoordinate(Z);if(C.projection.name==="globe"){z=z.rotate(-C.angle);let Te=C._pixelsPerMercatorPixel/C.worldSize;ce[0]=-z.x*n.d6(n.az(Me.y))*Te,ce[1]=-z.y*n.d6(C.center.lat)*Te}else{let Te=C.pointCoordinate(Z.sub(z));Me&&Te&&(ce[0]=Te.x-Me.x,ce[1]=Te.y-Me.y)}}let ue=C.zoom,de=[0,0,0];if(B){let Me=R(te||C.pointCoordinate3D(Z)),Te={dir:n.$.normalize([],n.$.sub([],Me,C._camera.position))};if(Te.dir[2]<0){let Se=C.zoomDeltaToMovement(Me,B);n.$.scale(de,Te.dir,Se)}}let pe=n.$.add(ce,ce,de);C._translateCameraConstrained(pe),B&&Math.abs(C.zoom-ue)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),h.noInertia||this._inertia.record(h),this._fireEvents(g,b,!0)}_fireEvents(h,g,b){let M=ug(this._eventsInProgress),C=ug(h),R={};for(let W in h){let{originalEvent:Z}=h[W];this._eventsInProgress[W]||(R[`${W}start`]=Z),this._eventsInProgress[W]=h[W]}!M&&C&&this._fireEvent("movestart",C.originalEvent);for(let W in R)this._fireEvent(W,R[W]);C&&this._fireEvent("move",C.originalEvent);for(let W in h){let{originalEvent:Z}=h[W];this._fireEvent(W,Z)}let z={},B;for(let W in this._eventsInProgress){let{handlerName:Z,originalEvent:te}=this._eventsInProgress[W];this._handlersById[Z].isActive()||(delete this._eventsInProgress[W],B=g[Z]||te,z[`${W}end`]=B)}for(let W in z)this._fireEvent(W,z[W]);let G=ug(this._eventsInProgress);if(b&&(M||C)&&!G){this._updatingCamera=!0;let W=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=te=>te!==0&&-this._bearingSnap<te&&te<this._bearingSnap;W?(Z(W.bearing||this._map.getBearing())&&(W.bearing=0),this._map.easeTo(W,{originalEvent:B})):(this._map.fire(new n.g("moveend",{originalEvent:B})),Z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(h,g){this._map.fire(new n.g(h,g?{originalEvent:g}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(h=>{this._frameId=void 0,this.handleEvent(new nl("renderFrame",{timeStamp:h})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Lv="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class T1 extends n.E{constructor(h,g){super(),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=g.bearingSnap,this._respectPrefersReducedMotion=g.respectPrefersReducedMotion!==!1,n.br(["_renderFrameCallback"],this)}getCenter(){return new n.aJ(this.transform.center.lng,this.transform.center.lat)}setCenter(h,g){return this.jumpTo({center:h},g)}panBy(h,g,b){return h=n.P.convert(h).mult(-1),this.panTo(this.transform.center,n.Q({offset:h},g),b)}panTo(h,g,b){return this.easeTo(n.Q({center:h},g),b)}getZoom(){return this.transform.zoom}setZoom(h,g){return this.jumpTo({zoom:h},g),this}zoomTo(h,g,b){return this.easeTo(n.Q({zoom:h},g),b)}zoomIn(h,g){return this.zoomTo(this.getZoom()+1,h,g),this}zoomOut(h,g){return this.zoomTo(this.getZoom()-1,h,g),this}getBearing(){return this.transform.bearing}setBearing(h,g){return this.jumpTo({bearing:h},g),this}getPadding(){return this.transform.padding}setPadding(h,g){return this.jumpTo({padding:h},g),this}rotateTo(h,g,b){return this.easeTo(n.Q({bearing:h},g),b)}resetNorth(h,g){return this.rotateTo(0,n.Q({duration:1e3},h),g),this}resetNorthPitch(h,g){return this.easeTo(n.Q({bearing:0,pitch:0,duration:1e3},h),g),this}snapToNorth(h,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,g):this}getPitch(){return this.transform.pitch}setPitch(h,g){return this.jumpTo({pitch:h},g),this}cameraForBounds(h,g){h=n.aj.convert(h);let b=g&&g.bearing||0,M=g&&g.pitch||0,C=h.getNorthWest(),R=h.getSouthEast();return this._cameraForBounds(this.transform,C,R,b,M,g)}_extendPadding(h){let g={top:0,right:0,bottom:0,left:0};return h==null?n.Q({},g,this.transform.padding):typeof h=="number"?{top:h,bottom:h,right:h,left:h}:n.Q({},g,h)}_extendCameraOptions(h){return(h=n.Q({offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=this._extendPadding(h.padding),h}_minimumAABBFrustumDistance(h,g){let b=g.max[0]-g.min[0],M=g.max[1]-g.min[1];return b/M>h.aspect?b/(2*Math.tan(.5*h.fovX)*h.aspect):M/(2*Math.tan(.5*h.fovY)*h.aspect)}_cameraForBoundsOnGlobe(h,g,b,M,C,R){let z=h.clone(),B=this._extendCameraOptions(R);z.bearing=M,z.pitch=C;let G=n.aJ.convert(g),W=n.aJ.convert(b),Z=.5*(G.lat+W.lat),te=.5*(G.lng+W.lng),ne=n.d7(Z,te),ce=n.$.normalize([],ne),ue=n.$.normalize([],n.$.cross([],ce,[0,1,0])),de=n.$.cross([],ue,ce),pe=[ue[0],ue[1],ue[2],0,de[0],de[1],de[2],0,ce[0],ce[1],ce[2],0,0,0,0,1],Me=[ne,n.d7(G.lat,G.lng),n.d7(W.lat,G.lng),n.d7(W.lat,W.lng),n.d7(G.lat,W.lng),n.d7(Z,G.lng),n.d7(Z,W.lng),n.d7(G.lat,te),n.d7(W.lat,te)],Te=n.b8.fromPoints(Me.map(Qe=>[n.$.dot(ue,Qe),n.$.dot(de,Qe),n.$.dot(ce,Qe)])),Se=n.$.transformMat4([],Te.center,pe);n.$.squaredLength(Se)===0&&n.$.set(Se,0,0,1),n.$.normalize(Se,Se),n.$.scale(Se,Se,n.cF),z.center=n.d8(Se);let Be=z.getWorldToCameraMatrix(),Oe=n.ae.invert(new Float64Array(16),Be);Te=n.b8.applyTransform(Te,n.ae.multiply([],Be,pe));let Le=this._extendAABB(Te,z,B,M);if(!Le)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Te=Le,n.$.transformMat4(Se,Se,Be);let Ge=.5*(Te.max[2]-Te.min[2]),We=this._minimumAABBFrustumDistance(z,Te),at=n.$.scale([],[0,0,1],Ge),Ye=n.$.add(at,Se,at),Ne=We+(z.pitch===0?0:n.$.distance(Se,Ye)),gt=z.globeCenterInViewSpace,ft=n.$.sub([],Se,[gt[0],gt[1],gt[2]]);n.$.normalize(ft,ft),n.$.scale(ft,ft,Ne);let tt=n.$.add([],Se,ft);n.$.transformMat4(tt,tt,Oe);let Bt=n.da/n.cF,Pt=n.$.length(tt),ct=n.ay(Math.max(Pt*Bt-n.da,Number.EPSILON),0),_t=Math.min(z.zoomFromMercatorZAdjusted(ct),B.maxZoom);return _t>.5*(n.b3+n.aV)?(z.setProjection({name:"mercator"}),z.zoom=_t,this._cameraForBounds(z,g,b,M,C,R)):{center:z.center,zoom:_t,bearing:M,pitch:C}}_extendAABB(h,g,b,M){let C=.5*((b.padding.left||0)+(b.padding.right||0)),R=.5*((b.padding.top||0)+(b.padding.bottom||0)),z=R,B=C,G=C,W=R,Z=g.width-(B+G),te=g.height-(z+W),ne=n.$.sub([],h.max,h.min),ce=Math.min(Z/ne[0],te/ne[1]),ue=Math.min(g.scaleZoom(g.scale*ce),b.maxZoom);if(isNaN(ue))return null;let de=g.scale/g.zoomScale(ue),pe=new n.b8([h.min[0]-B*de,h.min[1]-W*de,h.min[2]],[h.max[0]+G*de,h.max[1]+z*de,h.max[2]]),Me=(typeof b.offset.x=="number"&&typeof b.offset.y=="number"?new n.P(b.offset.x,b.offset.y):n.P.convert(b.offset)).rotate(-n.ac(M));return pe.center[0]-=Me.x*de,pe.center[1]+=Me.y*de,pe}queryTerrainElevation(h,g){let b=this.transform.elevation;return b?(g=n.Q({},{exaggerated:!0},g),b.getAtPoint(n._.fromLngLat(h),null,g.exaggerated)):null}_cameraForBounds(h,g,b,M,C,R){if(h.projection.name==="globe")return this._cameraForBoundsOnGlobe(h,g,b,M,C,R);let z=h.clone(),B=this._extendCameraOptions(R);z.bearing=M,z.pitch=C;let G=n.aJ.convert(g),W=n.aJ.convert(b),Z=new n.aJ(G.lng,W.lat),te=new n.aJ(W.lng,G.lat),ne=z.project(G),ce=z.project(W),ue=this.queryTerrainElevation(G),de=this.queryTerrainElevation(W),pe=this.queryTerrainElevation(Z),Me=this.queryTerrainElevation(te),Te=[[ne.x,ne.y,Math.min(ue||0,de||0,pe||0,Me||0)],[ce.x,ce.y,Math.max(ue||0,de||0,pe||0,Me||0)]],Se=n.b8.fromPoints(Te),Be=z.getWorldToCameraMatrix(),Oe=n.ae.invert(new Float64Array(16),Be);Se=n.b8.applyTransform(Se,Be);let Le=this._extendAABB(Se,z,B,M);if(!Le)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Se=Le;let Ge=.5*n.$.sub([],Se.max,Se.min)[2],We=this._minimumAABBFrustumDistance(z,Se),at=[0,0,1,0];n.aB.transformMat4(at,at,Be),n.aB.normalize(at,at);let Ye=n.$.scale([],at,We+Ge),Ne=n.$.add([],Se.center,Ye);n.$.transformMat4(Se.center,Se.center,Oe),n.$.transformMat4(Ne,Ne,Oe);let gt=[Se.center[0],Se.center[1],Ne[2]*z.pixelsPerMeter];n.$.scale(gt,gt,1/z.worldSize);let ft=n.d9(gt[0]),tt=n.az(gt[1]),Bt=Math.min(z._zoomFromMercatorZ(gt[2]),B.maxZoom),Pt=new n.aJ(ft,tt);return z.mercatorFromTransition&&Bt<.5*(n.b3+n.aV)?(z.setProjection({name:"globe"}),z.zoom=Bt,this._cameraForBounds(z,g,b,M,C,R)):{center:Pt,zoom:Bt,bearing:M,pitch:C}}fitBounds(h,g,b){let M=this.cameraForBounds(h,g);return this._fitInternal(M,g,b)}fitScreenCoordinates(h,g,b,M,C){let R=n.P.convert(h),z=n.P.convert(g),B=new n.P(Math.min(R.x,z.x),Math.min(R.y,z.y)),G=new n.P(Math.max(R.x,z.x),Math.max(R.y,z.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(R,z))return this;let W=this.transform.pointLocation3D(B),Z=this.transform.pointLocation3D(G),te=this.transform.pointLocation3D(new n.P(B.x,G.y)),ne=this.transform.pointLocation3D(new n.P(G.x,B.y)),ce=[Math.min(W.lng,Z.lng,te.lng,ne.lng),Math.min(W.lat,Z.lat,te.lat,ne.lat)],ue=[Math.max(W.lng,Z.lng,te.lng,ne.lng),Math.max(W.lat,Z.lat,te.lat,ne.lat)],de=M&&M.pitch?M.pitch:this.getPitch(),pe=this._cameraForBounds(this.transform,ce,ue,b,de,M);return this._fitInternal(pe,M,C)}_fitInternal(h,g,b){return h?(g=n.Q(h,g)).linear?this.easeTo(g,b):this.flyTo(g,b):this}jumpTo(h,g){this.stop();let b=h.preloadOnly?this.transform.clone():this.transform,M=!1,C=!1,R=!1;if("zoom"in h&&b.zoom!==+h.zoom&&(M=!0,b.zoom=+h.zoom),h.center!==void 0&&(b.center=n.aJ.convert(h.center)),"bearing"in h&&b.bearing!==+h.bearing&&(C=!0,b.bearing=+h.bearing),"pitch"in h&&b.pitch!==+h.pitch&&(R=!0,b.pitch=+h.pitch),h.padding!=null){let z=typeof h.padding=="number"?this._extendPadding(h.padding):h.padding;b.isPaddingEqual(z)||(b.padding=z)}return h.preloadOnly?(this._preloadTiles(b),this):(this.fire(new n.g("movestart",g)).fire(new n.g("move",g)),M&&this.fire(new n.g("zoomstart",g)).fire(new n.g("zoom",g)).fire(new n.g("zoomend",g)),C&&this.fire(new n.g("rotatestart",g)).fire(new n.g("rotate",g)).fire(new n.g("rotateend",g)),R&&this.fire(new n.g("pitchstart",g)).fire(new n.g("pitch",g)).fire(new n.g("pitchend",g)),this.fire(new n.g("moveend",g)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(Lv),this.transform.getFreeCameraOptions()}setFreeCameraOptions(h,g){let b=this.transform;if(!b.projection.supportsFreeCamera)return n.w(Lv),this;this.stop();let M=b.zoom,C=b.pitch,R=b.bearing;b.setFreeCameraOptions(h);let z=M!==b.zoom,B=C!==b.pitch,G=R!==b.bearing;return this.fire(new n.g("movestart",g)).fire(new n.g("move",g)),z&&this.fire(new n.g("zoomstart",g)).fire(new n.g("zoom",g)).fire(new n.g("zoomend",g)),G&&this.fire(new n.g("rotatestart",g)).fire(new n.g("rotate",g)).fire(new n.g("rotateend",g)),B&&this.fire(new n.g("pitchstart",g)).fire(new n.g("pitch",g)).fire(new n.g("pitchend",g)),this.fire(new n.g("moveend",g)),this}easeTo(h,g){this._stop(!1,h.easeId),((h=n.Q({offset:[0,0],duration:500,easing:n.d5},h)).animate===!1||this._prefersReducedMotion(h))&&(h.duration=0);let b=this.transform,M=this.getZoom(),C=this.getBearing(),R=this.getPitch(),z=this.getPadding(),B="zoom"in h?+h.zoom:M,G="bearing"in h?this._normalizeBearing(h.bearing,C):C,W="pitch"in h?+h.pitch:R,Z=this._extendPadding(h.padding),te=n.P.convert(h.offset),ne,ce,ue;if(b.projection.name==="globe"){let We=n._.fromLngLat(b.center),at=te.rotate(-b.angle);We.x+=at.x/b.worldSize,We.y+=at.y/b.worldSize;let Ye=We.toLngLat(),Ne=n.aJ.convert(h.center||Ye);this._normalizeCenter(Ne),ne=b.centerPoint.add(at),ce=new n.P(We.x,We.y).mult(b.worldSize),ue=new n.P(n.ak(Ne.lng),n.al(Ne.lat)).mult(b.worldSize).sub(ce)}else{ne=b.centerPoint.add(te);let We=b.pointLocation(ne),at=n.aJ.convert(h.center||We);this._normalizeCenter(at),ce=b.project(We),ue=b.project(at).sub(ce)}let de=b.zoomScale(B-M),pe,Me;h.around&&(pe=n.aJ.convert(h.around),Me=b.locationPoint(pe));let Te=this._zooming||B!==M,Se=this._rotating||C!==G,Be=this._pitching||W!==R,Oe=!b.isPaddingEqual(Z),Le=We=>at=>{if(Te&&(We.zoom=n.a3(M,B,at)),Se&&(We.bearing=n.a3(C,G,at)),Be&&(We.pitch=n.a3(R,W,at)),Oe&&(We.interpolatePadding(z,Z,at),ne=We.centerPoint.add(te)),pe)We.setLocationAtPoint(pe,Me);else{let Ye=We.zoomScale(We.zoom-M),Ne=B>M?Math.min(2,de):Math.max(.5,de),gt=Math.pow(Ne,1-at),ft=We.unproject(ce.add(ue.mult(at*gt)).mult(Ye));We.setLocationAtPoint(We.renderWorldCopies?ft.wrap():ft,ne)}return h.preloadOnly||this._fireMoveEvents(g),We};if(h.preloadOnly){let We=this._emulate(Le,h.duration,b);return this._preloadTiles(We),this}let Ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Te,this._rotating=Se,this._pitching=Be,this._padding=Oe,this._easeId=h.easeId,this._prepareEase(g,h.noMoveStart,Ge),this._ease(Le(b),We=>{b.cameraElevationReference==="sea"&&b.recenterOnTerrain(),this._afterEase(g,We)},h),this}_prepareEase(h,g,b={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),g||b.moving||this.fire(new n.g("movestart",h)),this._zooming&&!b.zooming&&this.fire(new n.g("zoomstart",h)),this._rotating&&!b.rotating&&this.fire(new n.g("rotatestart",h)),this._pitching&&!b.pitching&&this.fire(new n.g("pitchstart",h))}_fireMoveEvents(h){this.fire(new n.g("move",h)),this._zooming&&this.fire(new n.g("zoom",h)),this._rotating&&this.fire(new n.g("rotate",h)),this._pitching&&this.fire(new n.g("pitch",h))}_afterEase(h,g){if(this._easeId&&g&&this._easeId===g)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let b=this._zooming,M=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,b&&this.fire(new n.g("zoomend",h)),M&&this.fire(new n.g("rotateend",h)),C&&this.fire(new n.g("pitchend",h)),this.fire(new n.g("moveend",h))}flyTo(h,g){if(this._prefersReducedMotion(h)){let _t=n.ai(h,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(_t,g)}this.stop(),h=n.Q({offset:[0,0],speed:1.2,curve:1.42,easing:n.d5},h);let b=this.transform,M=this.getZoom(),C=this.getBearing(),R=this.getPitch(),z=this.getPadding(),B="zoom"in h?n.au(+h.zoom,b.minZoom,b.maxZoom):M,G="bearing"in h?this._normalizeBearing(h.bearing,C):C,W="pitch"in h?+h.pitch:R,Z=this._extendPadding(h.padding),te=b.zoomScale(B-M),ne=n.P.convert(h.offset),ce=b.centerPoint.add(ne),ue=b.pointLocation(ce),de=n.aJ.convert(h.center||ue);this._normalizeCenter(de);let pe=b.project(ue),Me=b.project(de).sub(pe),Te=h.curve,Se=Math.max(b.width,b.height),Be=Se/te,Oe=Me.mag();if("minZoom"in h){let _t=n.au(Math.min(h.minZoom,M,B),b.minZoom,b.maxZoom),Qe=Se/b.zoomScale(_t-M);Te=Math.sqrt(Qe/Oe*2)}let Le=Te*Te;function Ge(_t){let Qe=(Be*Be-Se*Se+(_t?-1:1)*Le*Le*Oe*Oe)/(2*(_t?Be:Se)*Le*Oe);return Math.log(Math.sqrt(Qe*Qe+1)-Qe)}function We(_t){return(Math.exp(_t)-Math.exp(-_t))/2}function at(_t){return(Math.exp(_t)+Math.exp(-_t))/2}let Ye=Ge(0),Ne=function(_t){return at(Ye)/at(Ye+Te*_t)},gt=function(_t){return Se*((at(Ye)*(We(Qe=Ye+Te*_t)/at(Qe))-We(Ye))/Le)/Oe;var Qe},ft=(Ge(1)-Ye)/Te;if(Math.abs(Oe)<1e-6||!isFinite(ft)){if(Math.abs(Se-Be)<1e-6)return this.easeTo(h,g);let _t=Be<Se?-1:1;ft=Math.abs(Math.log(Be/Se))/Te,gt=function(){return 0},Ne=function(Qe){return Math.exp(_t*Te*Qe)}}h.duration="duration"in h?+h.duration:1e3*ft/("screenSpeed"in h?+h.screenSpeed/Te:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0);let tt=C!==G,Bt=W!==R,Pt=!b.isPaddingEqual(Z),ct=_t=>Qe=>{let Rt=Qe*ft,Ft=1/Ne(Rt);_t.zoom=Qe===1?B:M+_t.scaleZoom(Ft),tt&&(_t.bearing=n.a3(C,G,Qe)),Bt&&(_t.pitch=n.a3(R,W,Qe)),Pt&&(_t.interpolatePadding(z,Z,Qe),ce=_t.centerPoint.add(ne));let oi=Qe===1?de:_t.unproject(pe.add(Me.mult(gt(Rt))).mult(Ft));return _t.setLocationAtPoint(_t.renderWorldCopies?oi.wrap():oi,ce),_t._updateCameraOnTerrain(),h.preloadOnly||this._fireMoveEvents(g),_t};if(h.preloadOnly){let _t=this._emulate(ct,h.duration,b);return this._preloadTiles(_t),this}return this._zooming=!0,this._rotating=tt,this._pitching=Bt,this._padding=Pt,this._prepareEase(g,!1),this._ease(ct(b),()=>this._afterEase(g),h),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(h){}_cancelRenderFrame(h){}_stop(h,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let b=this._onEaseEnd;this._onEaseEnd=void 0,b.call(this,g)}if(!h){let b=this.handlers;b&&b.stop(!1)}return this}_ease(h,g,b){b.animate===!1||b.duration===0?(h(1),g()):(this._easeStart=n.e.now(),this._easeOptions=b,this._onEaseFrame=h,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let h=Math.min((n.e.now()-this._easeStart)/this._easeOptions.duration,1),g=this._onEaseFrame;g&&g(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(h,g){h=n.av(h,-180,180);let b=Math.abs(h-g);return Math.abs(h-360-g)<b&&(h-=360),Math.abs(h+360-g)<b&&(h+=360),h}_normalizeCenter(h){let g=this.transform;if(g.maxBounds||g.projection.name!=="globe"&&!g.renderWorldCopies)return;let b=h.lng-g.center.lng;h.lng+=b>180?-360:b<-180?360:0}_prefersReducedMotion(h){return this._respectPrefersReducedMotion&&n.e.prefersReducedMotion&&!(h&&h.essential)}_emulate(h,g,b){let M=Math.ceil(15*g/1e3),C=[],R=h(b.clone());for(let z=0;z<=M;z++){let B=R(z/M);C.push(B.clone())}return C}_preloadTiles(h,g){}}class hg{constructor(h={}){this.options=h,n.br(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(h){let g=this.options&&this.options.compact,b=h._getUIString("AttributionControl.ToggleAttribution");this._map=h,this._container=f("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=f("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",b);let M=f("span","mapboxgl-ctrl-icon",this._compactButton);return M.setAttribute("aria-hidden","true"),M.setAttribute("title",b),this._innerContainer=f("div","mapboxgl-ctrl-attrib-inner",this._container),g&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),g===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let h=this._editLink;h||(h=this._editLink=this._container.querySelector(".mapbox-improve-map"));let g=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.db.ACCESS_TOKEN}];if(h){let b=g.reduce((M,C,R)=>(C.value&&(M+=`${C.key}=${C.value}${R<g.length-1?"&":""}`),M),"?");h.href=`${n.db.FEEDBACK_URL}/${b}#${v1(this._map,!0)}`,h.rel="noopener nofollow"}}_updateData(h){!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let h=[];if(this._map.style.stylesheet){let M=this._map.style.stylesheet;this.styleOwner=M.owner,this.styleId=M.id}let g=this._map.style._mergedSourceCaches;for(let M in g){let C=g[M];if(C.used){let R=C.getSource();R.attribution&&h.indexOf(R.attribution)<0&&h.push(R.attribution)}}h.sort((M,C)=>M.length-C.length),h=h.filter((M,C)=>{for(let R=C+1;R<h.length;R++)if(h[R].indexOf(M)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?h=[...this.options.customAttribution,...h]:h.unshift(this.options.customAttribution));let b=h.join(" | ");b!==this._attribHTML&&(this._attribHTML=b,h.length?(this._innerContainer.innerHTML=b,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class zv{constructor(){n.br(["_updateLogo","_updateCompact"],this)}onAdd(h){this._map=h,this._container=f("div","mapboxgl-ctrl");let g=f("a","mapboxgl-ctrl-logo");return g.target="_blank",g.rel="noopener nofollow",g.href="https://www.mapbox.com/",g.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),g.setAttribute("rel","noopener nofollow"),this._container.appendChild(g),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(h){h&&h.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let h=this._map.style._sourceCaches;if(Object.entries(h).length===0)return!0;for(let g in h){let b=h[g].getSource();if(b.hasOwnProperty("mapbox_logo")&&!b.mapbox_logo)return!1}return!0}_updateCompact(){let h=this._container.children;if(h.length){let g=h[0];this._map.getCanvasContainer().offsetWidth<250?g.classList.add("mapboxgl-compact"):g.classList.remove("mapboxgl-compact")}}}class Fv{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(h){let g=++this._id;return this._queue.push({callback:h,id:g,cancelled:!1}),g}remove(h){let g=this._currentlyRunning,b=g?this._queue.concat(g):this._queue;for(let M of b)if(M.id===h)return void(M.cancelled=!0)}run(h=0){let g=this._currentlyRunning=this._queue;this._queue=[];for(let b of g)if(!b.cancelled&&(b.callback(h),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function dg(_,h,g){if(_=new n.aJ(_.lng,_.lat),h){let b=new n.aJ(_.lng-360,_.lat),M=new n.aJ(_.lng+360,_.lat),C=360*Math.ceil(Math.abs(_.lng-g.center.lng)/360),R=g.locationPoint(_).distSqr(h),z=h.x<0||h.y<0||h.x>g.width||h.y>g.height;g.locationPoint(b).distSqr(h)<R&&(z||Math.abs(b.lng-g.center.lng)<C)?_=b:g.locationPoint(M).distSqr(h)<R&&(z||Math.abs(M.lng-g.center.lng)<C)&&(_=M)}for(;Math.abs(_.lng-g.center.lng)>180;){let b=g.locationPoint(_);if(b.x>=0&&b.y>=0&&b.x<=g.width&&b.y<=g.height)break;_.lng>g.center.lng?_.lng-=360:_.lng+=360}return _}let kv={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Nv extends n.E{constructor(h,g){if(super(),(h instanceof HTMLElement||g)&&(h=n.Q({element:h},g)),n.br(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=h&&h.occludedOpacity||.2,h&&h.element)this._element=h.element,this._offset=n.P.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=f("div");let C=41,R=27,z=x("svg",{display:"block",height:C*this._scale+"px",width:R*this._scale+"px",viewBox:`0 0 ${R} ${C}`},this._element),B=x("radialGradient",{id:"shadowGradient"},x("defs",{},z));x("stop",{offset:"10%","stop-opacity":.4},B),x("stop",{offset:"100%","stop-opacity":.05},B),x("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},z),x("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},z),x("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},z),x("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},z),this._offset=n.P.convert(h&&h.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",C=>{C.preventDefault()}),this._element.addEventListener("mousedown",C=>{C.preventDefault()});let b=this._element.classList;for(let C in kv)b.remove(`mapboxgl-marker-anchor-${C}`);b.add(`mapboxgl-marker-anchor-${this._anchor}`);let M=h&&h.className?h.className.trim().split(/\s+/):[];b.add(...M),this._popup=null}addTo(h){return h===this._map||(this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._updateMoving),h.on("moveend",this._update),h.on("remove",this._clearFadeTimer),h._addMarker(this),this.setDraggable(this._draggable),this._update(),h.on("click",this._onMapClick)),this}remove(){let h=this._map;return h&&(h.off("click",this._onMapClick),h.off("move",this._updateMoving),h.off("moveend",this._update),h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler),h.off("mouseup",this._onUp),h.off("touchend",this._onUp),h.off("mousemove",this._onMove),h.off("touchmove",this._onMove),h.off("remove",this._clearFadeTimer),h._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=n.aJ.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){let M=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[M,-1*(38.1-13.5+M)],"bottom-right":[-M,-1*(38.1-13.5+M)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=h,h._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(h){let g=h.code,b=h.charCode||h.keyCode;g!=="Space"&&g!=="Enter"&&b!==32&&b!==13||this.togglePopup()}_onMapClick(h){let g=h.originalEvent.target,b=this._element;this._popup&&(g===b||b.contains(g))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let h=this._popup;return h?(h.isOpen()?(h.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(h.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let h=this._map,g=this._pos;if(!h||!g)return!1;let b=h.unproject(g),M=h.getFreeCameraOptions();if(!M.position)return!1;let C=M.position.toLngLat();return C.distanceTo(b)<.9*C.distanceTo(this._lngLat)}_evaluateOpacity(){let h=this._map;if(!h)return;let g=this._pos;if(!g||g.x<0||g.x>h.transform.width||g.y<0||g.y>h.transform.height)return void this._clearFadeTimer();let b=h.unproject(g),M;h._showingGlobe()&&n.dc(h.transform,this._lngLat)?M=0:(M=1-h._queryFogOpacity(b),h.transform._terrainEnabled()&&h.getTerrain()&&this._behindTerrain()&&(M*=this._occludedOpacity)),this._element.style.opacity=`${M}`,this._element.style.pointerEvents=M>0?"auto":"none",this._popup&&this._popup._setOpacity(M),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let h=this._pos;if(!h||!this._map)return;let g=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${h.x}px,${h.y}px)
            ${kv[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${g.x}px,${g.y}px)
        `}_calculateXYTransform(){let h=this._pos,g=this._map,b=this.getPitchAlignment();if(!g||!h||b!=="map")return"";if(!g._showingGlobe()){let B=g.getPitch();return B?`rotateX(${B}deg)`:""}let M=n.b1(n.dd(g.transform,this._lngLat)),C=h.sub(n.de(g.transform)),R=Math.abs(C.x)+Math.abs(C.y);if(R===0)return"";let z=M/R;return`rotateX(${-C.y*z}deg) rotateY(${C.x*z}deg)`}_calculateZTransform(){let h=this._pos,g=this._map;if(!g||!h)return"";let b=0,M=this.getRotationAlignment();if(M==="map")if(g._showingGlobe()){let C=g.project(new n.aJ(this._lngLat.lng,this._lngLat.lat+.001)),R=g.project(new n.aJ(this._lngLat.lng,this._lngLat.lat-.001)).sub(C);b=n.b1(Math.atan2(R.y,R.x))-90}else b=-g.getBearing();else if(M==="horizon"){let C=n.a0(4,6,g.getZoom()),R=n.de(g.transform);R.y+=C*g.transform.height;let z=h.sub(R),B=n.b1(Math.atan2(z.y,z.x));b=(B>90?B-270:B+90)*(1-C)}return b+=this._rotation,b?`rotateZ(${b}deg)`:""}_update(h){cancelAnimationFrame(this._updateFrameId);let g=this._map;g&&(g.transform.renderWorldCopies&&(this._lngLat=dg(this._lngLat,this._pos,g.transform)),this._pos=g.project(this._lngLat),h===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),g._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(g._showingGlobe()||g.getTerrain()||g.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(h){return this._offset=n.P.convert(h),this._update(),this}addClassName(h){return this._element.classList.add(h),this}removeClassName(h){return this._element.classList.remove(h),this}toggleClassName(h){return this._element.classList.toggle(h)}_onMove(h){let g=this._map;if(!g)return;let b=this._pointerdownPos,M=this._positionDelta;if(b&&M){if(!this._isDragging){let C=this._clickTolerance||g._clickTolerance;if(h.point.dist(b)<C)return;this._isDragging=!0}this._pos=h.point.sub(M),this._lngLat=g.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.g("dragstart"))),this.fire(new n.g("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let h=this._map;h&&(h.off("mousemove",this._onMove),h.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.g("dragend")),this._state="inactive"}_addDragHandler(h){let g=this._map,b=this._pos;g&&b&&this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(b),this._pointerdownPos=h.point,this._state="pending",g.on("mousemove",this._onMove),g.on("touchmove",this._onMove),g.once("mouseup",this._onUp),g.once("touchend",this._onUp))}setDraggable(h){this._draggable=!!h;let g=this._map;return g&&(h?(g.on("mousedown",this._addDragHandler),g.on("touchstart",this._addDragHandler)):(g.off("mousedown",this._addDragHandler),g.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(h){return this._rotation=h||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(h){return this._rotationAlignment=h||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(h){return this._pitchAlignment=h||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(h){return this._occludedOpacity=h||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let Kp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},LP=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function iM(_=new n.P(0,0),h="bottom"){if(typeof _=="number"){let g=Math.round(Math.sqrt(.5*Math.pow(_,2)));switch(h){case"top":return new n.P(0,_);case"top-left":return new n.P(g,g);case"top-right":return new n.P(-g,g);case"bottom":return new n.P(0,-_);case"bottom-left":return new n.P(g,-g);case"bottom-right":return new n.P(-g,-g);case"left":return new n.P(_,0);case"right":return new n.P(-_,0)}return new n.P(0,0)}return _ instanceof n.P||Array.isArray(_)?n.P.convert(_):n.P.convert(_[h]||[0,0])}class zP{constructor(h){this.jumpTo(h)}getValue(h){if(h<=this._startTime)return this._start;if(h>=this._endTime)return this._end;let g=n.bb((h-this._startTime)/(this._endTime-this._startTime));return this._start*(1-g)+this._end*g}isEasing(h){return h>=this._startTime&&h<=this._endTime}jumpTo(h){this._startTime=-1/0,this._endTime=-1/0,this._start=h,this._end=h}easeTo(h,g,b){this._start=this.getValue(g),this._end=h,this._startTime=g,this._endTime=g+b}}let FP={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class kP{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let NP={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},A1={showCompass:!0,showZoom:!0,visualizePitch:!1};class C1{constructor(h,g,b=!1){this._clickTolerance=10,this.element=g,this.mouseRotate=new og({clickTolerance:h.dragRotate._mouseRotate._clickTolerance}),this.map=h,b&&(this.mousePitch=new Pv({clickTolerance:h.dragRotate._mousePitch._clickTolerance})),n.br(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),g.addEventListener("mousedown",this.mousedown),g.addEventListener("touchstart",this.touchstart,{passive:!1}),g.addEventListener("touchmove",this.touchmove),g.addEventListener("touchend",this.touchend),g.addEventListener("touchcancel",this.reset)}down(h,g){this.mouseRotate.mousedown(h,g),this.mousePitch&&this.mousePitch.mousedown(h,g),I()}move(h,g){let b=this.map,M=this.mouseRotate.mousemoveWindow(h,g),C=M&&M.bearingDelta;if(C&&b.setBearing(b.getBearing()+C),this.mousePitch){let R=this.mousePitch.mousemoveWindow(h,g),z=R&&R.pitchDelta;z&&b.setPitch(b.getPitch()+z)}}off(){let h=this.element;h.removeEventListener("mousedown",this.mousedown),h.removeEventListener("touchstart",this.touchstart,{passive:!1}),h.removeEventListener("touchmove",this.touchmove),h.removeEventListener("touchend",this.touchend),h.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){P(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(h){this.down(n.Q({},h,{ctrlKey:!0,preventDefault:()=>h.preventDefault()}),U(this.element,h)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(h){this.move(h,U(this.element,h))}mouseup(h){this.mouseRotate.mouseupWindow(h),this.mousePitch&&this.mousePitch.mouseupWindow(h),this.offTemp()}touchstart(h){h.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=j(this.element,h.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>h.preventDefault()},this._startPos))}touchmove(h){h.targetTouches.length!==1?this.reset():(this._lastPos=j(this.element,h.targetTouches)[0],this.move({preventDefault:()=>h.preventDefault()},this._lastPos))}touchend(h){h.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let rM={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Jp={maxWidth:100,unit:"metric"},nM={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:n.dw,supported:c,setRTLTextPlugin:n.dy,getRTLTextPluginStatus:n.dz,Map:class extends T1{constructor(_){n.df.mark(n.dg.create);let h=_;if((_=n.Q({},NP,_)).minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(_.antialias&&n.dh(window)&&(_.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Im(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),_),this._repaint=!!_.repaint,this._interactive=_.interactive,this._minTileCacheSize=_.minTileCacheSize,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=_.crossSourceCollisions,this._collectResourceTiming=_.collectResourceTiming,this._language=this._parseLanguage(_.language),this._worldview=_.worldview,this._renderTaskQueue=new Fv,this._domRenderTaskQueue=new Fv,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.di(),this._locale=n.Q({},FP,_.locale),this._clickTolerance=_.clickTolerance,this._cooperativeGestures=_.cooperativeGestures,this._performanceMetricsCollection=_.performanceMetricsCollection,this._tessellationStep=_.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=_.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new zP(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new n.dj(_.transformRequest,_.accessToken,_.testMode),this._silenceAuthErrors=!!_.testMode,this._contextCreateOptions=_.contextCreateOptions?me({},_.contextCreateOptions):{},typeof _.container=="string"){let g=document.getElementById(_.container);if(!g)throw new Error(`Container '${_.container.toString()}' not found.`);this._container=g}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),_.maxBounds&&this.setMaxBounds(_.maxBounds),n.br(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new kP),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Ov(this,_),this._localFontFamily=_.localFontFamily,this._localIdeographFontFamily=_.localIdeographFontFamily,(_.style||!_.testMode)&&this.setStyle(_.style||n.db.DEFAULT_STYLE,{config:_.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),_.projection&&this.setProjection(_.projection),_.hash&&(this._hash=new YE(typeof _.hash=="string"&&_.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){h.center==null&&h.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch});let g=_.bounds;g&&(this.resize(),this.fitBounds(g,n.Q({},_.fitBoundsOptions,{duration:0})))}this.resize(),_.attributionControl&&this.addControl(new hg({customAttribution:_.customAttribution})),this._logoControl=new zv,this.addControl(this._logoControl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",g=>{this._update(g.dataType==="style"),this.fire(new n.g(`${g.dataType}data`,g))}),this.on("dataloading",g=>{this.fire(new n.g(`${g.dataType}dataloading`,g))})}_getMapId(){return this._mapId}addControl(_,h){if(h===void 0&&(h=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new n.f(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let g=_.onAdd(this);this._controls.push(_);let b=this._controlPositions[h];return h.indexOf("bottom")!==-1?b.insertBefore(g,b.firstChild):b.appendChild(g),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new n.f(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let h=this._controls.indexOf(_);return h>-1&&this._controls.splice(h,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(_){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let h=!this._moving;return h&&this.fire(new n.g("movestart",_)).fire(new n.g("move",_)),this.fire(new n.g("resize",_)),h&&this.fire(new n.g("moveend",_)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(_){return this.transform.setMaxBounds(n.aj.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_?this.setZoom(_):this.fire(new n.g("zoomstart")).fire(new n.g("zoom")).fire(new n.g("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_?this.setZoom(_):this.fire(new n.g("zoomstart")).fire(new n.g("zoom")).fire(new n.g("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_?this.setPitch(_):this.fire(new n.g("pitchstart")).fire(new n.g("pitch")).fire(new n.g("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_?this.setPitch(_):this.fire(new n.g("pitchstart")).fire(new n.g("pitch")).fire(new n.g("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(_){return _==="auto"?navigator.language:Array.isArray(_)?_.length===0?void 0:_.map(h=>h==="auto"?navigator.language:h):_}setLanguage(_){let h=this._parseLanguage(_);if(!this.style||h===this._language)return this;this._language=h,this.style.reloadSources();for(let g of this._controls)g._setLanguage&&g._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(_){return this.style&&_!==this._worldview?(this._worldview=_,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(_){return this._lazyInitEmptyStyle(),_?typeof _=="string"&&(_={name:_}):_=null,this._useExplicitProjection=!!_,this._prioritizeAndUpdateProjection(_,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let _=this.transform,h=_.projection.name,g;h==="globe"&&_.zoom>=n.aV?(_.setMercatorFromTransition(),g=!0):h==="mercator"&&_.zoom<n.aV&&(_.setProjection({name:"globe"}),g=!0),g&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(_,h){return this._updateProjection(_||h||{name:"mercator"})}_updateProjection(_){let h;return h=_.name==="globe"&&this.transform.zoom>=n.aV?this.transform.setMercatorFromTransition():this.transform.setProjection(_),this.style.applyProjectionUpdate(),h&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(_){return this.transform.locationPoint3D(n.aJ.convert(_))}unproject(_){return this.transform.pointLocation3D(n.P.convert(_))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(_,h,g){if(_==="mouseenter"||_==="mouseover"){let b=!1,M=R=>{let z=h.filter(G=>this.getLayer(G)),B=z.length?this.queryRenderedFeatures(R.point,{layers:z}):[];B.length?b||(b=!0,g.call(this,new rl(_,this,R.originalEvent,{features:B}))):b=!1},C=()=>{b=!1};return{layers:new Set(h),listener:g,delegates:{mousemove:M,mouseout:C}}}if(_==="mouseleave"||_==="mouseout"){let b=!1,M=R=>{let z=h.filter(B=>this.getLayer(B));(z.length?this.queryRenderedFeatures(R.point,{layers:z}):[]).length?b=!0:b&&(b=!1,g.call(this,new rl(_,this,R.originalEvent)))},C=R=>{b&&(b=!1,g.call(this,new rl(_,this,R.originalEvent)))};return{layers:new Set(h),listener:g,delegates:{mousemove:M,mouseout:C}}}{let b=M=>{let C=h.filter(z=>this.getLayer(z)),R=C.length?this.queryRenderedFeatures(M.point,{layers:C}):[];R.length&&(M.features=R,g.call(this,M),delete M.features)};return{layers:new Set(h),listener:g,delegates:{[_]:b}}}}on(_,h,g){if(typeof h=="function"||g===void 0)return super.on(_,h);if(Array.isArray(h)||(h=[h]),h){for(let M of h)if(!this._isValidId(M))return this}let b=this._createDelegatedListener(_,h,g);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(b);for(let M in b.delegates)this.on(M,b.delegates[M]);return this}once(_,h,g){if(typeof h=="function"||g===void 0)return super.once(_,h);if(Array.isArray(h)||(h=[h]),h){for(let M of h)if(!this._isValidId(M))return this}let b=this._createDelegatedListener(_,h,g);for(let M in b.delegates)this.once(M,b.delegates[M]);return this}off(_,h,g){if(typeof h=="function"||g===void 0)return super.off(_,h);let b=new Set(Array.isArray(h)?h:[h]);for(let R of b)if(!this._isValidId(R))return this;let M=(R,z)=>{if(R.size!==z.size)return!1;for(let B of R)if(!z.has(B))return!1;return!0},C=this._delegatedListeners?this._delegatedListeners[_]:void 0;return C&&(R=>{for(let z=0;z<R.length;z++){let B=R[z];if(B.listener===g&&M(B.layers,b)){for(let G in B.delegates)this.off(G,B.delegates[G]);return R.splice(z,1),this}}})(C),this}queryRenderedFeatures(_,h){if(!this.style)return[];if(h!==void 0||_===void 0||_ instanceof n.P||Array.isArray(_)||(h=_,_=void 0),_=_||[[0,0],[this.transform.width,this.transform.height]],(h=h||{}).layers&&Array.isArray(h.layers)){for(let g of h.layers)if(!this._isValidId(g))return[]}return this.style.queryRenderedFeatures(_,h,this.transform)}querySourceFeatures(_,h){return this._isValidId(_)?this.style.querySourceFeatures(_,h):[]}isPointOnSurface(_){let{name:h}=this.transform.projection;return h!=="globe"&&h!=="mercator"&&n.w(`${h} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(_))}setStyle(_,h){return h=n.Q({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},h),this.style&&_&&h.diff!==!1&&h.localFontFamily===this._localFontFamily&&h.localIdeographFontFamily===this._localIdeographFontFamily&&!h.config?(this.style._diffStyle(_,(g,b)=>{g?(n.w(`Unable to perform style diff: ${String(g.message||g.error||g)}. Rebuilding the style from scratch.`),this._updateStyle(_,h)):b&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=h.localIdeographFontFamily,this._localFontFamily=h.localFontFamily,this._updateStyle(_,h))}_getUIString(_){let h=this._locale[_];if(h==null)throw new Error(`Missing UI string '${_}'`);return h}_updateStyle(_,h){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),_){let g=n.Q({},h);h&&h.config&&(g.initialConfig=h.config,delete g.config),this.style=new il(this,g).load(_),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new il(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(_){return _==null?(this.fire(new n.f(new Error("IDs can't be empty."))),!1):!n.cY(_)||(this.fire(new n.f(new Error(`IDs can't contain special symbols: "${_}".`))),!1)}addSource(_,h){return this._isValidId(_)?(this._lazyInitEmptyStyle(),this.style.addSource(_,h),this._update(!0)):this}isSourceLoaded(_){return!!this._isValidId(_)&&!!this.style&&this.style._isSourceCacheLoaded(_)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(_,h,g){this._lazyInitEmptyStyle(),this.style.addSourceType(_,h,g)}removeSource(_){return this._isValidId(_)?(this.style.removeSource(_),this._updateTerrain(),this._update(!0)):this}getSource(_){return this._isValidId(_)?this.style.getOwnSource(_):null}addImage(_,h,{pixelRatio:g=1,sdf:b=!1,stretchX:M,stretchY:C,content:R}={}){if(this._lazyInitEmptyStyle(),h instanceof HTMLImageElement||ImageBitmap&&h instanceof ImageBitmap){let{width:z,height:B,data:G}=n.e.getImageData(h);this.style.addImage(_,{data:new n.j({width:z,height:B},G),pixelRatio:g,stretchX:M,stretchY:C,content:R,sdf:b,version:0})}else if(h.width===void 0||h.height===void 0)this.fire(new n.f(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:z,height:B}=h,G=h;this.style.addImage(_,{data:new n.j({width:z,height:B},new Uint8Array(G.data)),pixelRatio:g,stretchX:M,stretchY:C,content:R,sdf:b,version:0,userImage:G}),G.onAdd&&G.onAdd(this,_)}}updateImage(_,h){this._lazyInitEmptyStyle();let g=this.style.getImage(_);if(!g)return void this.fire(new n.f(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let b=h instanceof HTMLImageElement||ImageBitmap&&h instanceof ImageBitmap?n.e.getImageData(h):h,{width:M,height:C,data:R}=b;if(M===void 0||C===void 0)return void this.fire(new n.f(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(M!==g.data.width||C!==g.data.height)return void this.fire(new n.f(new Error(`The width and height of the updated image (${M}, ${C})
                must be that same as the previous version of the image
                (${g.data.width}, ${g.data.height})`)));let z=!(h instanceof HTMLImageElement||ImageBitmap&&h instanceof ImageBitmap);g.data.replace(R,z),this.style.updateImage(_,g)}hasImage(_){return _?!!this.style&&!!this.style.getImage(_):(this.fire(new n.f(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,h){n.i(this._requestManager.transformRequest(_,n.R.Image),(g,b)=>{h(g,b instanceof HTMLImageElement?n.e.getImageData(b):b)})}listImages(){return this.style.listImages()}addModel(_,h){this._lazyInitEmptyStyle(),this.style.addModel(_,h)}hasModel(_){return _?this.style.hasModel(_):(this.fire(new n.f(new Error("Missing required model id"))),!1)}removeModel(_){this.style.removeModel(_)}listModels(){return this.style.listModels()}addLayer(_,h){return this._isValidId(_.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(_,h),this._update(!0)):this}getSlot(_){let h=this.getLayer(_);return h&&h.slot||null}setSlot(_,h){return this.style.setSlot(_,h),this.style.mergeLayers(),this._update(!0)}addImport(_,h){return this.style.addImport(_,h),this}updateImport(_,h){return typeof h!="string"&&h.id!==_?(this.removeImport(_),this.addImport(h)):(this.style.updateImport(_,h),this._update(!0))}removeImport(_){return this.style.removeImport(_),this}moveImport(_,h){return this.style.moveImport(_,h),this._update(!0)}moveLayer(_,h){return this._isValidId(_)?(this.style.moveLayer(_,h),this._update(!0)):this}removeLayer(_){return this._isValidId(_)?(this.style.removeLayer(_),this._update(!0)):this}getLayer(_){if(!this._isValidId(_))return null;let h=this.style.getOwnLayer(_);return h?h.type==="custom"?h.implementation:h.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(_,h,g){return this._isValidId(_)?(this.style.setLayerZoomRange(_,h,g),this._update(!0)):this}setFilter(_,h,g={}){return this._isValidId(_)?(this.style.setFilter(_,h,g),this._update(!0)):this}getFilter(_){return this._isValidId(_)?this.style.getFilter(_):null}setPaintProperty(_,h,g,b={}){return this._isValidId(_)?(this.style.setPaintProperty(_,h,g,b),this._update(!0)):this}getPaintProperty(_,h){return this._isValidId(_)?this.style.getPaintProperty(_,h):null}setLayoutProperty(_,h,g,b={}){return this._isValidId(_)?(this.style.setLayoutProperty(_,h,g,b),this._update(!0)):this}getLayoutProperty(_,h){return this._isValidId(_)?this.style.getLayoutProperty(_,h):null}getSchema(_){return this.style.getSchema(_)}setSchema(_,h){return this.style.setSchema(_,h),this._update(!0)}getConfig(_){return this.style.getConfig(_)}setConfig(_,h){return this.style.setConfig(_,h),this._update(!0)}getConfigProperty(_,h){return this.style.getConfigProperty(_,h)}setConfigProperty(_,h,g){return this.style.setConfigProperty(_,h,g),this._update(!0)}setLights(_){if(this._lazyInitEmptyStyle(),_&&_.length===1&&_[0].type==="flat"){let h=_[0];h.properties?this.style.setFlatLight(h.properties,h.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(_),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let _=this.style.getLights()||[];return _.length===0&&_.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),_}setLight(_,h={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:_}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(_){return this._lazyInitEmptyStyle(),!_&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(_),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(_){return this._lazyInitEmptyStyle(),this.style.setFog(_),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(_){return this._lazyInitEmptyStyle(),this.style.setColorTheme(_),this._update(!0)}setCamera(_){return this.style.setCamera(_),this._triggerCameraUpdate(_)}_triggerCameraUpdate(_){return this._update(this.transform.setOrthographicProjectionAtLowPitch(_["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(_){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.aJ.convert(_),this.transform):0}setFeatureState(_,h){return this._isValidId(_.source)?(this.style.setFeatureState(_,h),this._update()):this}removeFeatureState(_,h){return this._isValidId(_.source)?(this.style.removeFeatureState(_,h),this._update()):this}getFeatureState(_){return this._isValidId(_.source)?this.style.getFeatureState(_):null}_updateContainerDimensions(){if(!this._container)return;let _=this._container.getBoundingClientRect().width||400,h=this._container.getBoundingClientRect().height||300,g,b,M,C=this._container;for(;C&&(!b||!M);){let R=window.getComputedStyle(C).transform;R&&R!=="none"&&(g=R.match(/matrix.*\((.+)\)/)[1].split(", "),g[0]&&g[0]!=="0"&&g[0]!=="1"&&(b=g[0]),g[3]&&g[3]!=="0"&&g[3]!=="1"&&(M=g[3])),C=C.parentElement}this._containerWidth=b?Math.abs(_/b):_,this._containerHeight=M?Math.abs(h/M):h}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=f("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();let h=this._canvasContainer=f("div","mapboxgl-canvas-container",_);this._canvas=f("canvas","mapboxgl-canvas",h),this._interactive&&(h.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let g=this._controlContainer=f("div","mapboxgl-control-container",_),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(M=>{b[M]=f("div",`mapboxgl-ctrl-${M}`,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,h){let g=n.e.devicePixelRatio||1;this._canvas.width=g*Math.ceil(_),this._canvas.height=g*Math.ceil(h),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${h}px`}_addMarker(_){this._markers.push(_)}_removeMarker(_){let h=this._markers.indexOf(_);h!==-1&&this._markers.splice(h,1)}_addPopup(_){this._popups.push(_)}_removePopup(_){let h=this._popups.indexOf(_);h!==-1&&this._popups.splice(h,1)}_setupPainter(){let _=n.Q({},c.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),h=this._canvas.getContext("webgl2",_);h?(n.dk(h,!0),this.painter=new h1(h,this._contextCreateOptions,this.transform,this._tp),this.on("data",g=>{g.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.dl.testSupport(h)):this.fire(new n.f(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.g("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.resize(),this._update(),this.fire(new n.g("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_requestDomTask(_){!this.loaded()||this.loaded()&&!this.isMoving()?_():this._domRenderTaskQueue.add(_)}_render(_){let h;this.fire(new n.g("renderstart")),++this._frameId;let g=this.painter.context.extTimerQuery,b=n.e.now(),M=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(h=M.createQuery(),M.beginQuery(g.TIME_ELAPSED_EXT,h)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(_),this._domRenderTaskQueue.run(_),this._removed)return;this._updateProjectionTransition();let C=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let G=this.transform.zoom,W=this.transform.pitch,Z=n.e.now(),te=new n.Y(G,{now:Z,fadeDuration:C,pitch:W,transition:this.style.transition});this.style.update(te)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let R=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),R=this._updateAverageElevation(b),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):R=this._updateAverageElevation(b);let z=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,this.painter.replacementSource);if(z&&(this._placementDirty=z.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.g("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,n.df.mark(n.dg.load),this.fire(new n.g("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),h){let G=n.e.now()-b;M.endQuery(g.TIME_ELAPSED_EXT),setTimeout(()=>{let W=M.getQueryParameter(h,M.QUERY_RESULT)/1e6;M.deleteQuery(h),this.fire(new n.g("gpu-timing-frame",{cpuTime:G,gpuTime:W}))},50)}if(this.listens("gpu-timing-layer")){let G=this.painter.collectGpuTimers();setTimeout(()=>{let W=this.painter.queryGpuTimers(G);this.fire(new n.g("gpu-timing-layer",{layerTimes:W}))},50)}if(this.listens("gpu-timing-deferred-render")){let G=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let W=this.painter.queryGpuTimeDeferredRender(G);this.fire(new n.g("gpu-timing-deferred-render",{gpuTime:W}))},50)}let B=this._sourcesDirty||this._styleDirty||this._placementDirty||R;if(B||this._repaint)this.triggerRepaint();else{let G=this.idle();if(G&&(R=this._updateAverageElevation(b,!0)),R)this.triggerRepaint();else if(this._triggerFrame(!1),G&&(this.fire(new n.g("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let W=this._calculateSpeedIndex();this.fire(new n.g("speedindexcompleted",{speedIndex:W})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,n.df.mark(n.dg.fullLoad),this._performanceMetricsCollection&&n.dm(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(_){for(let h of this._markers)_&&!this.getRenderWorldCopies()&&(h._lngLat=h._lngLat.wrap()),h._update();for(let h of this._popups)!_||this.getRenderWorldCopies()||h._trackPointer||(h._lngLat=h._lngLat.wrap()),h._update()}_updateAverageElevation(_,h=!1){let g=M=>(this.transform.averageElevation=M,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&g(0);let b=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(b||(h||_-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(_)){let M=this.transform.averageElevation,C=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(C)?C=0:this._averageElevationLastSampledAt=_;let R=Math.abs(M-C);if(R>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(C),g(C);this._averageElevation.easeTo(C,_,300)}else if(R>1e-4)return this._averageElevation.jumpTo(C),g(C)}return!!this._averageElevation.isEasing(_)&&g(this._averageElevation.getValue(_))}_authenticate(){n.dn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,_=>{if(_&&(_.message===n.dp||_.status===401)){let h=this.painter.context.gl;n.dk(h,!1),this._logoControl instanceof zv&&this._logoControl._updateLogo(),h&&h.clear(h.DEPTH_BUFFER_BIT|h.COLOR_BUFFER_BIT|h.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.f(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),n.dq(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&n.dr(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let _=this._isDragging();this.painter.updateTerrain(this.style,_)}_calculateSpeedIndex(){let _=this.painter.canvasCopy(),h=this.painter.getCanvasCopiesAndTimestamps();h.timeStamps.push(performance.now());let g=this.painter.context.gl,b=g.createFramebuffer();function M(C){g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,C,0);let R=new Uint8Array(g.drawingBufferWidth*g.drawingBufferHeight*4);return g.readPixels(0,0,g.drawingBufferWidth,g.drawingBufferHeight,g.RGBA,g.UNSIGNED_BYTE,R),R}return g.bindFramebuffer(g.FRAMEBUFFER,b),this._canvasPixelComparison(M(_),h.canvasCopies.map(M),h.timeStamps)}_canvasPixelComparison(_,h,g){let b=g[1]-g[0],M=_.length/4;for(let C=0;C<h.length;C++){let R=h[C],z=0;for(let B=0;B<R.length;B+=4)R[B]===_[B]&&R[B+1]===_[B+1]&&R[B+2]===_[B+2]&&R[B+3]===_[B+3]&&(z+=1);b+=(g[C+2]-g[C+1])*(1-z/M)}return b}remove(){this._hash&&this._hash.remove();for(let h of this._controls)h.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),n.ds(this.painter.context.gl),n.dt.remove(),n.du.remove(),this._removed=!0,this.fire(new n.g("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(_){this._renderNextFrame=this._renderNextFrame||_,this.style&&!this._frame&&(this._frame=n.e.frame(h=>{let g=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,g&&this._render(h)}))}_preloadTiles(_){let h=this.style?this.style.getSourceCaches():[];return n.dv(h,(g,b)=>g._preloadTiles(_,b),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(_){this._showParseStatus!==_&&(this._showParseStatus=_,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(_){this._showTerrainWireframe!==_&&(this._showTerrainWireframe=_,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(_){this._showLayers2DWireframe!==_&&(this._showLayers2DWireframe=_,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(_){this._showLayers3DWireframe!==_&&(this._showLayers3DWireframe=_,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(_){this._speedIndexTiming!==_&&(this._speedIndexTiming=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,this._tp.refreshUI(),_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(_){this._showTileAABBs!==_&&(this._showTileAABBs=_,this._tp.refreshUI(),_&&this._update())}_setCacheLimits(_,h){n.dx(_,h)}get version(){return n.dw}},NavigationControl:class{constructor(_={}){this.options=n.Q({},A1,_),this._container=f("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",h=>h.preventDefault()),this.options.showZoom&&(n.br(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",h=>{this._map&&this._map.zoomIn({},{originalEvent:h})}),f("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",h=>{this._map&&this._map.zoomOut({},{originalEvent:h})}),f("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.br(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",h=>{let g=this._map;g&&(this.options.visualizePitch?g.resetNorthPitch({},{originalEvent:h}):g.resetNorth({},{originalEvent:h}))}),this._compassIcon=f("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let _=this._map;if(!_)return;let h=_.getZoom(),g=h===_.getMaxZoom(),b=h===_.getMinZoom();this._zoomInButton.disabled=g,this._zoomOutButton.disabled=b,this._zoomInButton.setAttribute("aria-disabled",g.toString()),this._zoomOutButton.setAttribute("aria-disabled",b.toString())}_rotateCompassArrow(){let _=this._map;if(!_)return;let h=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(_.transform.pitch*(Math.PI/180)),.5)}) rotateX(${_.transform.pitch}deg) rotateZ(${_.transform.angle*(180/Math.PI)}deg)`:`rotate(${_.transform.angle*(180/Math.PI)}deg)`;_._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=h)})}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),_.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&_.on("pitch",this._rotateCompassArrow),_.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new C1(_,this._compass,this.options.visualizePitch)),this._container}onRemove(){let _=this._map;_&&(this._container.remove(),this.options.showZoom&&_.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&_.off("pitch",this._rotateCompassArrow),_.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(_,h){let g=f("button",_,this._container);return g.type="button",g.addEventListener("click",h),g}_setButtonTitle(_,h){if(!this._map)return;let g=this._map._getUIString(`NavigationControl.${h}`);_.setAttribute("aria-label",g),_.firstElementChild&&_.firstElementChild.setAttribute("title",g)}},GeolocateControl:class extends n.E{constructor(_={}){super();let h=navigator.geolocation;this.options=n.Q({geolocation:h},rM,_),n.br(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=qE(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(_){return this._map=_,this._container=f("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(_){let h=(g=!!this.options.geolocation)=>{this._supportsGeolocation=g,_(g)};this._supportsGeolocation!==void 0?_(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(g=>h(g.state!=="denied")).catch(()=>h()):h()}_isOutOfMapMaxBounds(_){let h=this._map.getMaxBounds(),g=_.coords;return!!h&&(g.longitude<h.getWest()||g.longitude>h.getEast()||g.latitude<h.getSouth()||g.latitude>h.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new n.g("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(_),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(_),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.g("geolocate",_)),this._finish()}}_updateCamera(_){let h=new n.aJ(_.coords.longitude,_.coords.latitude),g=_.coords.accuracy,b=this._map.getBearing(),M=n.Q({bearing:b},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(g),M,{geolocateSource:!0})}_updateMarker(_){if(_){let h=new n.aJ(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let _=this._map.transform,h=n.ay(1,_._center.lat)*_.worldSize,g=Math.ceil(2*this._accuracy*h);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(_){if(this._map){if(this.options.trackUserLocation)if(_.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",h),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(_.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.g("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=f("button","mapboxgl-ctrl-geolocate",this._container),f("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",_===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");let h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",h),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",h)}else{let h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",h),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=f("div","mapboxgl-user-location"),this._dotElement.appendChild(f("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(f("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Nv({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=f("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Nv({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.g("trackuserlocationend")))})}}_onDeviceOrientation(_){this._userLocationDotMarker&&(_.webkitCompassHeading?this._heading=_.webkitCompassHeading:_.absolute===!0&&(this._heading=-1*_.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.g("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.g("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.g("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(_={maximumAge:6e5,timeout:0},this._noTimeout=!0):(_=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,_),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let _=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(h=>{h==="granted"&&_()}).catch(console.error):_()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:hg,ScaleControl:class{constructor(_={}){this.options=n.Q({},Jp,_),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.br(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let _=this.options.maxWidth||100,h=this._map,g=h._containerHeight/2,b=h._containerWidth/2-_/2,M=h.unproject([b,g]),C=h.unproject([b+_,g]),R=M.distanceTo(C);if(this.options.unit==="imperial"){let z=3.2808*R;z>5280?this._setScale(_,z/5280,"mile"):this._setScale(_,z,"foot")}else this.options.unit==="nautical"?this._setScale(_,R/1852,"nautical-mile"):R>=1e3?this._setScale(_,R/1e3,"kilometer"):this._setScale(_,R,"meter")}_setScale(_,h,g){this._map._requestDomTask(()=>{let b=function(C){let R=Math.pow(10,`${Math.floor(C)}`.length-1),z=C/R;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:function(B){let G=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*G)/G}(z),R*z}(h),M=b/h;this._container.innerHTML=this._isNumberFormatSupported&&g!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:g}).format(b):`${b}&nbsp;${nM[g]}`,this._container.style.width=_*M+"px"})}onAdd(_){return this._map=_,this._language=_.getLanguage(),this._container=f("div","mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(_){this._language=_,this._update()}setUnit(_){this.options.unit=_,this._update()}},FullscreenControl:class{constructor(_={}){this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:n.w("Full screen control 'container' must be a DOM element.")),n.br(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=f("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let _=this._fullscreenButton=f("button","mapboxgl-ctrl-fullscreen",this._controlContainer);f("span","mapboxgl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",_)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.E{constructor(_){super(),this.options=n.Q(Object.create(Kp),_),n.br(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(_&&_.className?_.className.trim().split(/\s+/):[])}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&_.on("preclick",this._onClose),this.options.closeOnMove&&_.on("move",this._onClose),_.on("remove",this.remove),this._update(),_._addPopup(this),this._focusFirstElement(),this._trackPointer?(_.on("mousemove",this._onMouseEvent),_.on("mouseup",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")):_.on("move",this._update),this.fire(new n.g("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let _=this._map;return _&&(_.off("move",this._update),_.off("move",this._onClose),_.off("preclick",this._onClose),_.off("click",this._onClose),_.off("remove",this.remove),_.off("mousemove",this._onMouseEvent),_.off("mouseup",this._onMouseEvent),_.off("drag",this._onMouseEvent),_._canvasContainer&&_._canvasContainer.classList.remove("mapboxgl-track-pointer"),_._removePopup(this),this._map=void 0),this.fire(new n.g("close")),this}getLngLat(){return this._lngLat}setLngLat(_){this._lngLat=n.aJ.convert(_),this._pos=null,this._trackPointer=!1,this._update();let h=this._map;return h&&(h.on("move",this._update),h.off("mousemove",this._onMouseEvent),h._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let _=this._map;return _&&(_.off("move",this._update),_.on("mousemove",this._onMouseEvent),_.on("drag",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){let h=document.createDocumentFragment(),g=document.createElement("body"),b;for(g.innerHTML=_;b=g.firstChild,b;)h.appendChild(b);return this.setDOMContent(h)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){let h=this._content;if(h)for(;h.hasChildNodes();)h.firstChild&&h.removeChild(h.firstChild);else h=this._content=f("div","mapboxgl-popup-content",this._container||void 0);if(h.appendChild(_),this.options.closeButton){let g=this._closeButton=f("button","mapboxgl-popup-close-button",h);g.type="button",g.setAttribute("aria-label","Close popup"),g.setAttribute("aria-hidden","true"),g.innerHTML="&#215;",g.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(_){return this._classList.add(_),this._updateClassList(),this}removeClassName(_){return this._classList.delete(_),this._updateClassList(),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){let h;return this._classList.delete(_)?h=!1:(this._classList.add(_),h=!0),this._updateClassList(),h}_onMouseEvent(_){this._update(_.point)}_getAnchor(_){if(this.options.anchor)return this.options.anchor;let h=this._map,g=this._container,b=this._pos;if(!h||!g||!b)return"bottom";let M=g.offsetWidth,C=g.offsetHeight,R=b.x<M/2,z=b.x>h.transform.width-M/2;if(b.y+_<C)return R?"top-left":z?"top-right":"top";if(b.y>h.transform.height-C){if(R)return"bottom-left";if(z)return"bottom-right"}return R?"left":z?"right":"bottom"}_updateClassList(){let _=this._container;if(!_)return;let h=[...this._classList];h.push("mapboxgl-popup"),this._anchor&&h.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&h.push("mapboxgl-popup-track-pointer"),_.className=h.join(" ")}_update(_){let h=this._map,g=this._content;if(!h||!this._lngLat&&!this._trackPointer||!g)return;let b=this._container;if(b||(b=this._container=f("div","mapboxgl-popup",h.getContainer()),this._tip=f("div","mapboxgl-popup-tip",b),b.appendChild(g)),this.options.maxWidth&&b.style.maxWidth!==this.options.maxWidth&&(b.style.maxWidth=this.options.maxWidth),h.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=dg(this._lngLat,this._pos,h.transform)),!this._trackPointer||_){let M=this._pos=this._trackPointer&&_ instanceof n.P?_:h.project(this._lngLat),C=iM(this.options.offset),R=this._anchor=this._getAnchor(C.y),z=iM(this.options.offset,R),B=M.add(z).round();h._requestDomTask(()=>{this._container&&R&&(this._container.style.transform=`${kv[R]} translate(${B.x}px,${B.y}px)`)})}if(!this._marker&&h._showingGlobe()){let M=n.dc(h.transform,this._lngLat)?0:1;this._setOpacity(M)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let _=this._container.querySelector(LP);_&&_.focus()}_onClose(){this.remove()}_setOpacity(_){this._container&&(this._container.style.opacity=`${_}`),this._content&&(this._content.style.pointerEvents=_?"auto":"none")}},Marker:Nv,Style:il,LngLat:n.aJ,LngLatBounds:n.aj,Point:n.P,MercatorCoordinate:n._,FreeCameraOptions:mE,Evented:n.E,config:n.db,prewarm:n.dA,clearPrewarmedResources:n.dB,get accessToken(){return n.db.ACCESS_TOKEN},set accessToken(_){n.db.ACCESS_TOKEN=_},get baseApiUrl(){return n.db.API_URL},set baseApiUrl(_){n.db.API_URL=_},get workerCount(){return n.dC.workerCount},set workerCount(_){n.dC.workerCount=_},get maxParallelImageRequests(){return n.db.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){n.db.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){n.dD(_)},get workerUrl(){return n.dE.workerUrl},set workerUrl(_){n.dE.workerUrl=_},get workerClass(){return n.dE.workerClass},set workerClass(_){n.dE.workerClass=_},get workerParams(){return n.dE.workerParams},set workerParams(_){n.dE.workerParams=_},get dracoUrl(){return n.dF()},set dracoUrl(_){n.dG(_)},get meshoptUrl(){return n.dH()},set meshoptUrl(_){n.dI(_)},setNow:n.e.setNow,restoreNow:n.e.restoreNow}});var s=i;return s})});var kG=null;var CO=1,NG=Symbol("SIGNAL");function ts(e){let t=kG;return kG=e,t}var BG={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function nae(e){if(!(PO(e)&&!e.dirty)&&!(!e.dirty&&e.lastCleanEpoch===CO)){if(!e.producerMustRecompute(e)&&!DO(e)){e.dirty=!1,e.lastCleanEpoch=CO;return}e.producerRecomputeValue(e),e.dirty=!1,e.lastCleanEpoch=CO}}function UG(e){return e&&(e.nextProducerIndex=0),ts(e)}function jG(e,t){if(ts(t),!(!e||e.producerNode===void 0||e.producerIndexOfThis===void 0||e.producerLastReadVersion===void 0)){if(PO(e))for(let i=e.nextProducerIndex;i<e.producerNode.length;i++)IO(e.producerNode[i],e.producerIndexOfThis[i]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function DO(e){dT(e);for(let t=0;t<e.producerNode.length;t++){let i=e.producerNode[t],r=e.producerLastReadVersion[t];if(r!==i.version||(nae(i),r!==i.version))return!0}return!1}function VG(e){if(dT(e),PO(e))for(let t=0;t<e.producerNode.length;t++)IO(e.producerNode[t],e.producerIndexOfThis[t]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function IO(e,t){if(sae(e),dT(e),e.liveConsumerNode.length===1)for(let r=0;r<e.producerNode.length;r++)IO(e.producerNode[r],e.producerIndexOfThis[r]);let i=e.liveConsumerNode.length-1;if(e.liveConsumerNode[t]=e.liveConsumerNode[i],e.liveConsumerIndexOfThis[t]=e.liveConsumerIndexOfThis[i],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,t<e.liveConsumerNode.length){let r=e.liveConsumerIndexOfThis[t],s=e.liveConsumerNode[t];dT(s),s.producerIndexOfThis[r]=t}}function PO(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function dT(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}function sae(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}function oae(){throw new Error}var aae=oae;function GG(e){aae=e}function pn(e){return typeof e=="function"}function p0(e){let i=e(r=>{Error.call(r),r.stack=new Error().stack});return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}var pT=p0(e=>function(i){e(this),this.message=i?`${i.length} errors occurred during unsubscription:
${i.map((r,s)=>`${s+1}) ${r.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=i});function _b(e,t){if(e){let i=e.indexOf(t);0<=i&&e.splice(i,1)}}var jo=class e{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;let{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(let n of i)n.remove(this);else i.remove(this);let{initialTeardown:r}=this;if(pn(r))try{r()}catch(n){t=n instanceof pT?n.errors:[n]}let{_finalizers:s}=this;if(s){this._finalizers=null;for(let n of s)try{HG(n)}catch(c){t=t??[],c instanceof pT?t=[...t,...c.errors]:t.push(c)}}if(t)throw new pT(t)}}add(t){var i;if(t&&t!==this)if(this.closed)HG(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(i=this._finalizers)!==null&&i!==void 0?i:[]).push(t)}}_hasParent(t){let{_parentage:i}=this;return i===t||Array.isArray(i)&&i.includes(t)}_addParent(t){let{_parentage:i}=this;this._parentage=Array.isArray(i)?(i.push(t),i):i?[i,t]:t}_removeParent(t){let{_parentage:i}=this;i===t?this._parentage=null:Array.isArray(i)&&_b(i,t)}remove(t){let{_finalizers:i}=this;i&&_b(i,t),t instanceof e&&t._removeParent(this)}};jo.EMPTY=(()=>{let e=new jo;return e.closed=!0,e})();var RO=jo.EMPTY;function fT(e){return e instanceof jo||e&&"closed"in e&&pn(e.remove)&&pn(e.add)&&pn(e.unsubscribe)}function HG(e){pn(e)?e():e.unsubscribe()}var xu={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var f0={setTimeout(e,t,...i){let{delegate:r}=f0;return r?.setTimeout?r.setTimeout(e,t,...i):setTimeout(e,t,...i)},clearTimeout(e){let{delegate:t}=f0;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function mT(e){f0.setTimeout(()=>{let{onUnhandledError:t}=xu;if(t)t(e);else throw e})}function xb(){}var WG=OO("C",void 0,void 0);function qG(e){return OO("E",void 0,e)}function YG(e){return OO("N",e,void 0)}function OO(e,t,i){return{kind:e,value:t,error:i}}var Dg=null;function m0(e){if(xu.useDeprecatedSynchronousErrorHandling){let t=!Dg;if(t&&(Dg={errorThrown:!1,error:null}),e(),t){let{errorThrown:i,error:r}=Dg;if(Dg=null,i)throw r}}else e()}function XG(e){xu.useDeprecatedSynchronousErrorHandling&&Dg&&(Dg.errorThrown=!0,Dg.error=e)}var Ig=class extends jo{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,fT(t)&&t.add(this)):this.destination=uae}static create(t,i,r){return new g0(t,i,r)}next(t){this.isStopped?zO(YG(t),this):this._next(t)}error(t){this.isStopped?zO(qG(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?zO(WG,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},lae=Function.prototype.bind;function LO(e,t){return lae.call(e,t)}var FO=class{constructor(t){this.partialObserver=t}next(t){let{partialObserver:i}=this;if(i.next)try{i.next(t)}catch(r){gT(r)}}error(t){let{partialObserver:i}=this;if(i.error)try{i.error(t)}catch(r){gT(r)}else gT(t)}complete(){let{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(i){gT(i)}}},g0=class extends Ig{constructor(t,i,r){super();let s;if(pn(t)||!t)s={next:t??void 0,error:i??void 0,complete:r??void 0};else{let n;this&&xu.useDeprecatedNextContext?(n=Object.create(t),n.unsubscribe=()=>this.unsubscribe(),s={next:t.next&&LO(t.next,n),error:t.error&&LO(t.error,n),complete:t.complete&&LO(t.complete,n)}):s=t}this.destination=new FO(s)}};function gT(e){xu.useDeprecatedSynchronousErrorHandling?XG(e):mT(e)}function cae(e){throw e}function zO(e,t){let{onStoppedNotification:i}=xu;i&&f0.setTimeout(()=>i(e,t))}var uae={closed:!0,next:xb,error:cae,complete:xb};var y0=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Jl(e){return e}function kO(...e){return NO(e)}function NO(e){return e.length===0?Jl:e.length===1?e[0]:function(i){return e.reduce((r,s)=>s(r),i)}}var is=(()=>{class e{constructor(i){i&&(this._subscribe=i)}lift(i){let r=new e;return r.source=this,r.operator=i,r}subscribe(i,r,s){let n=dae(i)?i:new g0(i,r,s);return m0(()=>{let{operator:c,source:u}=this;n.add(c?c.call(n,u):u?this._subscribe(n):this._trySubscribe(n))}),n}_trySubscribe(i){try{return this._subscribe(i)}catch(r){i.error(r)}}forEach(i,r){return r=$G(r),new r((s,n)=>{let c=new g0({next:u=>{try{i(u)}catch(p){n(p),c.unsubscribe()}},error:n,complete:s});this.subscribe(c)})}_subscribe(i){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(i)}[y0](){return this}pipe(...i){return NO(i)(this)}toPromise(i){return i=$G(i),new i((r,s)=>{let n;this.subscribe(c=>n=c,c=>s(c),()=>r(n))})}}return e.create=t=>new e(t),e})();function $G(e){var t;return(t=e??xu.Promise)!==null&&t!==void 0?t:Promise}function hae(e){return e&&pn(e.next)&&pn(e.error)&&pn(e.complete)}function dae(e){return e&&e instanceof Ig||hae(e)&&fT(e)}function BO(e){return pn(e?.lift)}function Vn(e){return t=>{if(BO(t))return t.lift(function(i){try{return e(i,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Gn(e,t,i,r,s){return new UO(e,t,i,r,s)}var UO=class extends Ig{constructor(t,i,r,s,n,c){super(t),this.onFinalize=n,this.shouldUnsubscribe=c,this._next=i?function(u){try{i(u)}catch(p){t.error(p)}}:super._next,this._error=s?function(u){try{s(u)}catch(p){t.error(p)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(u){t.error(u)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:i}=this;super.unsubscribe(),!i&&((t=this.onFinalize)===null||t===void 0||t.call(this))}}};function v0(){return Vn((e,t)=>{let i=null;e._refCount++;let r=Gn(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount){i=null;return}let s=e._connection,n=i;i=null,s&&(!n||s===n)&&s.unsubscribe(),t.unsubscribe()});e.subscribe(r),r.closed||(i=e.connect())})}var _0=class extends is{constructor(t,i){super(),this.source=t,this.subjectFactory=i,this._subject=null,this._refCount=0,this._connection=null,BO(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){let t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new jo;let i=this.getSubject();t.add(this.source.subscribe(Gn(i,void 0,()=>{this._teardown(),i.complete()},r=>{this._teardown(),i.error(r)},()=>this._teardown()))),t.closed&&(this._connection=null,t=jo.EMPTY)}return t}refCount(){return v0()(this)}};var ZG=p0(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var cl=(()=>{class e extends is{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(i){let r=new yT(this,this);return r.operator=i,r}_throwIfClosed(){if(this.closed)throw new ZG}next(i){m0(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(i)}})}error(i){m0(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=i;let{observers:r}=this;for(;r.length;)r.shift().error(i)}})}complete(){m0(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:i}=this;for(;i.length;)i.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var i;return((i=this.observers)===null||i===void 0?void 0:i.length)>0}_trySubscribe(i){return this._throwIfClosed(),super._trySubscribe(i)}_subscribe(i){return this._throwIfClosed(),this._checkFinalizedStatuses(i),this._innerSubscribe(i)}_innerSubscribe(i){let{hasError:r,isStopped:s,observers:n}=this;return r||s?RO:(this.currentObservers=null,n.push(i),new jo(()=>{this.currentObservers=null,_b(n,i)}))}_checkFinalizedStatuses(i){let{hasError:r,thrownError:s,isStopped:n}=this;r?i.error(s):n&&i.complete()}asObservable(){let i=new is;return i.source=this,i}}return e.create=(t,i)=>new yT(t,i),e})(),yT=class extends cl{constructor(t,i){super(),this.destination=t,this.source=i}next(t){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.next)===null||r===void 0||r.call(i,t)}error(t){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.error)===null||r===void 0||r.call(i,t)}complete(){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||i===void 0||i.call(t)}_subscribe(t){var i,r;return(r=(i=this.source)===null||i===void 0?void 0:i.subscribe(t))!==null&&r!==void 0?r:RO}};var wa=class extends cl{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){let i=super._subscribe(t);return!i.closed&&t.next(this._value),i}getValue(){let{hasError:t,thrownError:i,_value:r}=this;if(t)throw i;return this._throwIfClosed(),r}next(t){super.next(this._value=t)}};var ec=new is(e=>e.complete());function QG(e){return e&&pn(e.schedule)}function KG(e){return e[e.length-1]}function JG(e){return pn(KG(e))?e.pop():void 0}function bf(e){return QG(KG(e))?e.pop():void 0}function tH(e,t,i,r){function s(n){return n instanceof i?n:new i(function(c){c(n)})}return new(i||(i=Promise))(function(n,c){function u(x){try{f(r.next(x))}catch(w){c(w)}}function p(x){try{f(r.throw(x))}catch(w){c(w)}}function f(x){x.done?n(x.value):s(x.value).then(u,p)}f((r=r.apply(e,t||[])).next())})}function eH(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Pg(e){return this instanceof Pg?(this.v=e,this):new Pg(e)}function iH(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=i.apply(e,t||[]),s,n=[];return s={},u("next"),u("throw"),u("return",c),s[Symbol.asyncIterator]=function(){return this},s;function c(A){return function(I){return Promise.resolve(I).then(A,w)}}function u(A,I){r[A]&&(s[A]=function(P){return new Promise(function(O,k){n.push([A,P,O,k])>1||p(A,P)})},I&&(s[A]=I(s[A])))}function p(A,I){try{f(r[A](I))}catch(P){E(n[0][3],P)}}function f(A){A.value instanceof Pg?Promise.resolve(A.value.v).then(x,w):E(n[0][2],A)}function x(A){p("next",A)}function w(A){p("throw",A)}function E(A,I){A(I),n.shift(),n.length&&p(n[0][0],n[0][1])}}function rH(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],i;return t?t.call(e):(e=typeof eH=="function"?eH(e):e[Symbol.iterator](),i={},r("next"),r("throw"),r("return"),i[Symbol.asyncIterator]=function(){return this},i);function r(n){i[n]=e[n]&&function(c){return new Promise(function(u,p){c=e[n](c),s(u,p,c.done,c.value)})}}function s(n,c,u,p){Promise.resolve(p).then(function(f){n({value:f,done:u})},c)}}var vT=e=>e&&typeof e.length=="number"&&typeof e!="function";function _T(e){return pn(e?.then)}function xT(e){return pn(e[y0])}function bT(e){return Symbol.asyncIterator&&pn(e?.[Symbol.asyncIterator])}function wT(e){return new TypeError(`You provided ${e!==null&&typeof e=="object"?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function pae(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ST=pae();function ET(e){return pn(e?.[ST])}function MT(e){return iH(this,arguments,function*(){let i=e.getReader();try{for(;;){let{value:r,done:s}=yield Pg(i.read());if(s)return yield Pg(void 0);yield yield Pg(r)}}finally{i.releaseLock()}})}function TT(e){return pn(e?.getReader)}function ra(e){if(e instanceof is)return e;if(e!=null){if(xT(e))return fae(e);if(vT(e))return mae(e);if(_T(e))return gae(e);if(bT(e))return nH(e);if(ET(e))return yae(e);if(TT(e))return vae(e)}throw wT(e)}function fae(e){return new is(t=>{let i=e[y0]();if(pn(i.subscribe))return i.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function mae(e){return new is(t=>{for(let i=0;i<e.length&&!t.closed;i++)t.next(e[i]);t.complete()})}function gae(e){return new is(t=>{e.then(i=>{t.closed||(t.next(i),t.complete())},i=>t.error(i)).then(null,mT)})}function yae(e){return new is(t=>{for(let i of e)if(t.next(i),t.closed)return;t.complete()})}function nH(e){return new is(t=>{_ae(e,t).catch(i=>t.error(i))})}function vae(e){return nH(MT(e))}function _ae(e,t){var i,r,s,n;return tH(this,void 0,void 0,function*(){try{for(i=rH(e);r=yield i.next(),!r.done;){let c=r.value;if(t.next(c),t.closed)return}}catch(c){s={error:c}}finally{try{r&&!r.done&&(n=i.return)&&(yield n.call(i))}finally{if(s)throw s.error}}t.complete()})}function Pl(e,t,i,r=0,s=!1){let n=t.schedule(function(){i(),s?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(n),!s)return n}function AT(e,t=0){return Vn((i,r)=>{i.subscribe(Gn(r,s=>Pl(r,e,()=>r.next(s),t),()=>Pl(r,e,()=>r.complete(),t),s=>Pl(r,e,()=>r.error(s),t)))})}function CT(e,t=0){return Vn((i,r)=>{r.add(e.schedule(()=>i.subscribe(r),t))})}function sH(e,t){return ra(e).pipe(CT(t),AT(t))}function oH(e,t){return ra(e).pipe(CT(t),AT(t))}function aH(e,t){return new is(i=>{let r=0;return t.schedule(function(){r===e.length?i.complete():(i.next(e[r++]),i.closed||this.schedule())})})}function lH(e,t){return new is(i=>{let r;return Pl(i,t,()=>{r=e[ST](),Pl(i,t,()=>{let s,n;try{({value:s,done:n}=r.next())}catch(c){i.error(c);return}n?i.complete():i.next(s)},0,!0)}),()=>pn(r?.return)&&r.return()})}function DT(e,t){if(!e)throw new Error("Iterable cannot be null");return new is(i=>{Pl(i,t,()=>{let r=e[Symbol.asyncIterator]();Pl(i,t,()=>{r.next().then(s=>{s.done?i.complete():i.next(s.value)})},0,!0)})})}function cH(e,t){return DT(MT(e),t)}function uH(e,t){if(e!=null){if(xT(e))return sH(e,t);if(vT(e))return aH(e,t);if(_T(e))return oH(e,t);if(bT(e))return DT(e,t);if(ET(e))return lH(e,t);if(TT(e))return cH(e,t)}throw wT(e)}function ao(e,t){return t?uH(e,t):ra(e)}function rn(...e){let t=bf(e);return ao(e,t)}function x0(e,t){let i=pn(e)?e:()=>e,r=s=>s.error(i());return new is(t?s=>t.schedule(r,0,s):r)}function jO(e){return!!e&&(e instanceof is||pn(e.lift)&&pn(e.subscribe))}var Ld=p0(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function Ti(e,t){return Vn((i,r)=>{let s=0;i.subscribe(Gn(r,n=>{r.next(e.call(t,n,s++))}))})}var{isArray:xae}=Array;function bae(e,t){return xae(t)?e(...t):e(t)}function hH(e){return Ti(t=>bae(e,t))}var{isArray:wae}=Array,{getPrototypeOf:Sae,prototype:Eae,keys:Mae}=Object;function dH(e){if(e.length===1){let t=e[0];if(wae(t))return{args:t,keys:null};if(Tae(t)){let i=Mae(t);return{args:i.map(r=>t[r]),keys:i}}}return{args:e,keys:null}}function Tae(e){return e&&typeof e=="object"&&Sae(e)===Eae}function pH(e,t){return e.reduce((i,r,s)=>(i[r]=t[s],i),{})}function IT(...e){let t=bf(e),i=JG(e),{args:r,keys:s}=dH(e);if(r.length===0)return ao([],t);let n=new is(Aae(r,t,s?c=>pH(s,c):Jl));return i?n.pipe(hH(i)):n}function Aae(e,t,i=Jl){return r=>{fH(t,()=>{let{length:s}=e,n=new Array(s),c=s,u=s;for(let p=0;p<s;p++)fH(t,()=>{let f=ao(e[p],t),x=!1;f.subscribe(Gn(r,w=>{n[p]=w,x||(x=!0,u--),u||r.next(i(n.slice()))},()=>{--c||r.complete()}))},r)},r)}}function fH(e,t,i){e?Pl(i,e,t):t()}function mH(e,t,i,r,s,n,c,u){let p=[],f=0,x=0,w=!1,E=()=>{w&&!p.length&&!f&&t.complete()},A=P=>f<r?I(P):p.push(P),I=P=>{n&&t.next(P),f++;let O=!1;ra(i(P,x++)).subscribe(Gn(t,k=>{s?.(k),n?A(k):t.next(k)},()=>{O=!0},void 0,()=>{if(O)try{for(f--;p.length&&f<r;){let k=p.shift();c?Pl(t,c,()=>I(k)):I(k)}E()}catch(k){t.error(k)}}))};return e.subscribe(Gn(t,A,()=>{w=!0,E()})),()=>{u?.()}}function Vo(e,t,i=1/0){return pn(t)?Vo((r,s)=>Ti((n,c)=>t(r,n,s,c))(ra(e(r,s))),i):(typeof t=="number"&&(i=t),Vn((r,s)=>mH(r,s,e,i)))}function VO(e=1/0){return Vo(Jl,e)}function gH(){return VO(1)}function b0(...e){return gH()(ao(e,bf(e)))}function PT(e){return new is(t=>{ra(e()).subscribe(t)})}function Nr(e,t){return Vn((i,r)=>{let s=0;i.subscribe(Gn(r,n=>e.call(t,n,s++)&&r.next(n)))})}function wf(e){return Vn((t,i)=>{let r=null,s=!1,n;r=t.subscribe(Gn(i,void 0,void 0,c=>{n=ra(e(c,wf(e)(t))),r?(r.unsubscribe(),r=null,n.subscribe(i)):s=!0})),s&&(r.unsubscribe(),r=null,n.subscribe(i))})}function yH(e,t,i,r,s){return(n,c)=>{let u=i,p=t,f=0;n.subscribe(Gn(c,x=>{let w=f++;p=u?e(p,x,w):(u=!0,x),r&&c.next(p)},s&&(()=>{u&&c.next(p),c.complete()})))}}function Sf(e,t){return pn(t)?Vo(e,t,1):Vo(e,1)}function Ef(e){return Vn((t,i)=>{let r=!1;t.subscribe(Gn(i,s=>{r=!0,i.next(s)},()=>{r||i.next(e),i.complete()}))})}function zd(e){return e<=0?()=>ec:Vn((t,i)=>{let r=0;t.subscribe(Gn(i,s=>{++r<=e&&(i.next(s),e<=r&&i.complete())}))})}function GO(e){return Ti(()=>e)}function RT(e=Cae){return Vn((t,i)=>{let r=!1;t.subscribe(Gn(i,s=>{r=!0,i.next(s)},()=>r?i.complete():i.error(e())))})}function Cae(){return new Ld}function Mf(e){return Vn((t,i)=>{try{t.subscribe(i)}finally{i.add(e)}})}function xh(e,t){let i=arguments.length>=2;return r=>r.pipe(e?Nr((s,n)=>e(s,n,r)):Jl,zd(1),i?Ef(t):RT(()=>new Ld))}function w0(e){return e<=0?()=>ec:Vn((t,i)=>{let r=[];t.subscribe(Gn(i,s=>{r.push(s),e<r.length&&r.shift()},()=>{for(let s of r)i.next(s);i.complete()},void 0,()=>{r=null}))})}function HO(e,t){let i=arguments.length>=2;return r=>r.pipe(e?Nr((s,n)=>e(s,n,r)):Jl,w0(1),i?Ef(t):RT(()=>new Ld))}function WO(e,t){return Vn(yH(e,t,arguments.length>=2,!0))}function qO(...e){let t=bf(e);return Vn((i,r)=>{(t?b0(e,i,t):b0(e,i)).subscribe(r)})}function tc(e,t){return Vn((i,r)=>{let s=null,n=0,c=!1,u=()=>c&&!s&&r.complete();i.subscribe(Gn(r,p=>{s?.unsubscribe();let f=0,x=n++;ra(e(p,x)).subscribe(s=Gn(r,w=>r.next(t?t(p,w,x,f++):w),()=>{s=null,u()}))},()=>{c=!0,u()}))})}function YO(e){return Vn((t,i)=>{ra(e).subscribe(Gn(i,()=>i.complete(),xb)),!i.closed&&t.subscribe(i)})}function na(e,t,i){let r=pn(e)||t||i?{next:e,error:t,complete:i}:e;return r?Vn((s,n)=>{var c;(c=r.subscribe)===null||c===void 0||c.call(r);let u=!0;s.subscribe(Gn(n,p=>{var f;(f=r.next)===null||f===void 0||f.call(r,p),n.next(p)},()=>{var p;u=!1,(p=r.complete)===null||p===void 0||p.call(r),n.complete()},p=>{var f;u=!1,(f=r.error)===null||f===void 0||f.call(r,p),n.error(p)},()=>{var p,f;u&&((p=r.unsubscribe)===null||p===void 0||p.call(r)),(f=r.finalize)===null||f===void 0||f.call(r)}))}):Jl}var Dae="https://g.co/ng/security#xss",Ui=class extends Error{constructor(t,i){super(nA(t,i)),this.code=t}};function nA(e,t){return`${`NG0${Math.abs(e)}`}${t?": "+t:""}`}function Fb(e){return{toString:e}.toString()}var OT="__parameters__";function Iae(e){return function(...i){if(e){let r=e(...i);for(let s in r)this[s]=r[s]}}}function t8(e,t,i){return Fb(()=>{let r=Iae(t);function s(...n){if(this instanceof s)return r.apply(this,n),this;let c=new s(...n);return u.annotation=c,u;function u(p,f,x){let w=p.hasOwnProperty(OT)?p[OT]:Object.defineProperty(p,OT,{value:[]})[OT];for(;w.length<=x;)w.push(null);return(w[x]=w[x]||[]).push(c),p}}return i&&(s.prototype=Object.create(i.prototype)),s.prototype.ngMetadataName=e,s.annotationCls=s,s})}var bb=globalThis;function As(e){for(let t in e)if(e[t]===As)return t;throw Error("Could not find renamed property on target object.")}function ul(e){if(typeof e=="string")return e;if(Array.isArray(e))return"["+e.map(ul).join(", ")+"]";if(e==null)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;let t=e.toString();if(t==null)return""+t;let i=t.indexOf(`
`);return i===-1?t:t.substring(0,i)}function vH(e,t){return e==null||e===""?t===null?"":t:t==null||t===""?e:e+" "+t}var Pae=As({__forward_ref__:As});function i8(e){return e.__forward_ref__=i8,e.toString=function(){return ul(this())},e}function zc(e){return r8(e)?e():e}function r8(e){return typeof e=="function"&&e.hasOwnProperty(Pae)&&e.__forward_ref__===i8}function hr(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Vg(e){return{providers:e.providers||[],imports:e.imports||[]}}function sA(e){return _H(e,s8)||_H(e,o8)}function n8(e){return sA(e)!==null}function _H(e,t){return e.hasOwnProperty(t)?e[t]:null}function Rae(e){let t=e&&(e[s8]||e[o8]);return t||null}function xH(e){return e&&(e.hasOwnProperty(bH)||e.hasOwnProperty(Oae))?e[bH]:null}var s8=As({\u0275prov:As}),bH=As({\u0275inj:As}),o8=As({ngInjectableDef:As}),Oae=As({ngInjectorDef:As}),an=class{constructor(t,i){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof i=="number"?this.__NG_ELEMENT_ID__=i:i!==void 0&&(this.\u0275prov=hr({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function a8(e){return e&&!!e.\u0275providers}var Lae=As({\u0275cmp:As}),zae=As({\u0275dir:As}),Fae=As({\u0275pipe:As}),kae=As({\u0275mod:As}),jT=As({\u0275fac:As}),wb=As({__NG_ELEMENT_ID__:As}),wH=As({__NG_ENV_ID__:As});function l8(e){return typeof e=="string"?e:e==null?"":String(e)}function Nae(e){return typeof e=="function"?e.name||e.toString():typeof e=="object"&&e!=null&&typeof e.type=="function"?e.type.name||e.type.toString():l8(e)}function Bae(e,t){let i=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new Ui(-200,e)}function Z3(e,t){throw new Ui(-201,!1)}var Mn=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Mn||{}),a3;function c8(){return a3}function Lc(e){let t=a3;return a3=e,t}function u8(e,t,i){let r=sA(e);if(r&&r.providedIn=="root")return r.value===void 0?r.value=r.factory():r.value;if(i&Mn.Optional)return null;if(t!==void 0)return t;Z3(e,"Injector")}var Uae={},Sb=Uae,l3="__NG_DI_FLAG__",VT="ngTempTokenPath",jae="ngTokenPath",Vae=/\n/gm,Gae="\u0275",SH="__source",T0;function Hae(){return T0}function Tf(e){let t=T0;return T0=e,t}function Wae(e,t=Mn.Default){if(T0===void 0)throw new Ui(-203,!1);return T0===null?u8(e,void 0,t):T0.get(e,t&Mn.Optional?null:void 0,t)}function Er(e,t=Mn.Default){return(c8()||Wae)(zc(e),t)}function tr(e,t=Mn.Default){return Er(e,oA(t))}function oA(e){return typeof e>"u"||typeof e=="number"?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function c3(e){let t=[];for(let i=0;i<e.length;i++){let r=zc(e[i]);if(Array.isArray(r)){if(r.length===0)throw new Ui(900,!1);let s,n=Mn.Default;for(let c=0;c<r.length;c++){let u=r[c],p=qae(u);typeof p=="number"?p===-1?s=u.token:n|=p:s=u}t.push(Er(s,n))}else t.push(Er(r))}return t}function h8(e,t){return e[l3]=t,e.prototype[l3]=t,e}function qae(e){return e[l3]}function Yae(e,t,i,r){let s=e[VT];throw t[SH]&&s.unshift(t[SH]),e.message=Xae(`
`+e.message,s,i,r),e[jae]=s,e[VT]=null,e}function Xae(e,t,i,r=null){e=e&&e.charAt(0)===`
`&&e.charAt(1)==Gae?e.slice(2):e;let s=ul(t);if(Array.isArray(t))s=t.map(ul).join(" -> ");else if(typeof t=="object"){let n=[];for(let c in t)if(t.hasOwnProperty(c)){let u=t[c];n.push(c+":"+(typeof u=="string"?JSON.stringify(u):ul(u)))}s=`{${n.join(", ")}}`}return`${i}${r?"("+r+")":""}[${s}]: ${e.replace(Vae,`
  `)}`}var Q3=h8(t8("Optional"),8);var d8=h8(t8("SkipSelf"),4);function C0(e,t){let i=e.hasOwnProperty(jT);return i?e[jT]:null}function $ae(e,t,i){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){let s=e[r],n=t[r];if(i&&(s=i(s),n=i(n)),n!==s)return!1}return!0}function Zae(e){return e.flat(Number.POSITIVE_INFINITY)}function K3(e,t){e.forEach(i=>Array.isArray(i)?K3(i,t):t(i))}function p8(e,t,i){t>=e.length?e.push(i):e.splice(t,0,i)}function GT(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function Qae(e,t){let i=[];for(let r=0;r<e;r++)i.push(t);return i}function Kae(e,t,i,r){let s=e.length;if(s==t)e.push(i,r);else if(s===1)e.push(r,e[0]),e[0]=i;else{for(s--,e.push(e[s-1],e[s]);s>t;){let n=s-2;e[s]=e[n],s--}e[t]=i,e[t+1]=r}}function Jae(e,t,i){let r=kb(e,t);return r>=0?e[r|1]=i:(r=~r,Kae(e,r,t,i)),r}function XO(e,t){let i=kb(e,t);if(i>=0)return e[i|1]}function kb(e,t){return ele(e,t,1)}function ele(e,t,i){let r=0,s=e.length>>i;for(;s!==r;){let n=r+(s-r>>1),c=e[n<<i];if(t===c)return n<<i;c>t?s=n:r=n+1}return~(s<<i)}var Eb={},wu=[],D0=new an(""),f8=new an("",-1),m8=new an(""),HT=class{get(t,i=Sb){if(i===Sb){let r=new Error(`NullInjectorError: No provider for ${ul(t)}!`);throw r.name="NullInjectorError",r}return i}},g8=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(g8||{}),Sh=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(Sh||{}),Fd=function(e){return e[e.None=0]="None",e[e.SignalBased=1]="SignalBased",e[e.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",e}(Fd||{});function tle(e,t,i){let r=e.length;for(;;){let s=e.indexOf(t,i);if(s===-1)return s;if(s===0||e.charCodeAt(s-1)<=32){let n=t.length;if(s+n===r||e.charCodeAt(s+n)<=32)return s}i=s+1}}function u3(e,t,i){let r=0;for(;r<i.length;){let s=i[r];if(typeof s=="number"){if(s!==0)break;r++;let n=i[r++],c=i[r++],u=i[r++];e.setAttribute(t,c,u,n)}else{let n=s,c=i[++r];rle(n)?e.setProperty(t,n,c):e.setAttribute(t,n,c),r++}}return r}function ile(e){return e===3||e===4||e===6}function rle(e){return e.charCodeAt(0)===64}function J3(e,t){if(!(t===null||t.length===0))if(e===null||e.length===0)e=t.slice();else{let i=-1;for(let r=0;r<t.length;r++){let s=t[r];typeof s=="number"?i=s:i===0||(i===-1||i===2?EH(e,i,s,null,t[++r]):EH(e,i,s,null,null))}}return e}function EH(e,t,i,r,s){let n=0,c=e.length;if(t===-1)c=-1;else for(;n<e.length;){let u=e[n++];if(typeof u=="number"){if(u===t){c=-1;break}else if(u>t){c=n-1;break}}}for(;n<e.length;){let u=e[n];if(typeof u=="number")break;if(u===i){if(r===null){s!==null&&(e[n+1]=s);return}else if(r===e[n+1]){e[n+2]=s;return}}n++,r!==null&&n++,s!==null&&n++}c!==-1&&(e.splice(c,0,t),n=c+1),e.splice(n++,0,i),r!==null&&e.splice(n++,0,r),s!==null&&e.splice(n++,0,s)}var y8="ng-template";function nle(e,t,i,r){let s=0;if(r){for(;s<t.length&&typeof t[s]=="string";s+=2)if(t[s]==="class"&&tle(t[s+1].toLowerCase(),i,0)!==-1)return!0}else if(eL(e))return!1;if(s=t.indexOf(1,s),s>-1){let n;for(;++s<t.length&&typeof(n=t[s])=="string";)if(n.toLowerCase()===i)return!0}return!1}function eL(e){return e.type===4&&e.value!==y8}function sle(e,t,i){let r=e.type===4&&!i?y8:e.value;return t===r}function ole(e,t,i){let r=4,s=e.attrs,n=s!==null?cle(s):0,c=!1;for(let u=0;u<t.length;u++){let p=t[u];if(typeof p=="number"){if(!c&&!bu(r)&&!bu(p))return!1;if(c&&bu(p))continue;c=!1,r=p|r&1;continue}if(!c)if(r&4){if(r=2|r&1,p!==""&&!sle(e,p,i)||p===""&&t.length===1){if(bu(r))return!1;c=!0}}else if(r&8){if(s===null||!nle(e,s,p,i)){if(bu(r))return!1;c=!0}}else{let f=t[++u],x=ale(p,s,eL(e),i);if(x===-1){if(bu(r))return!1;c=!0;continue}if(f!==""){let w;if(x>n?w="":w=s[x+1].toLowerCase(),r&2&&f!==w){if(bu(r))return!1;c=!0}}}}return bu(r)||c}function bu(e){return(e&1)===0}function ale(e,t,i,r){if(t===null)return-1;let s=0;if(r||!i){let n=!1;for(;s<t.length;){let c=t[s];if(c===e)return s;if(c===3||c===6)n=!0;else if(c===1||c===2){let u=t[++s];for(;typeof u=="string";)u=t[++s];continue}else{if(c===4)break;if(c===0){s+=4;continue}}s+=n?1:2}return-1}else return ule(t,e)}function v8(e,t,i=!1){for(let r=0;r<t.length;r++)if(ole(e,t[r],i))return!0;return!1}function lle(e){let t=e.attrs;if(t!=null){let i=t.indexOf(5);if(!(i&1))return t[i+1]}return null}function cle(e){for(let t=0;t<e.length;t++){let i=e[t];if(ile(i))return t}return e.length}function ule(e,t){let i=e.indexOf(4);if(i>-1)for(i++;i<e.length;){let r=e[i];if(typeof r=="number")return-1;if(r===t)return i;i++}return-1}function hle(e,t){e:for(let i=0;i<t.length;i++){let r=t[i];if(e.length===r.length){for(let s=0;s<e.length;s++)if(e[s]!==r[s])continue e;return!0}}return!1}function MH(e,t){return e?":not("+t.trim()+")":t}function dle(e){let t=e[0],i=1,r=2,s="",n=!1;for(;i<e.length;){let c=e[i];if(typeof c=="string")if(r&2){let u=e[++i];s+="["+c+(u.length>0?'="'+u+'"':"")+"]"}else r&8?s+="."+c:r&4&&(s+=" "+c);else s!==""&&!bu(c)&&(t+=MH(n,s),s=""),r=c,n=n||!bu(r);i++}return s!==""&&(t+=MH(n,s)),t}function ple(e){return e.map(dle).join(",")}function fle(e){let t=[],i=[],r=1,s=2;for(;r<e.length;){let n=e[r];if(typeof n=="string")s===2?n!==""&&t.push(n,e[++r]):s===8&&i.push(n);else{if(!bu(s))break;s=n}r++}return{attrs:t,classes:i}}function xo(e){return Fb(()=>{let t=S8(e),i=pt(me({},t),{decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===g8.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Sh.Emulated,styles:e.styles||wu,_:null,schemas:e.schemas||null,tView:null,id:""});E8(i);let r=e.dependencies;return i.directiveDefs=AH(r,!1),i.pipeDefs=AH(r,!0),i.id=yle(i),i})}function mle(e){return Lg(e)||_8(e)}function gle(e){return e!==null}function Gg(e){return Fb(()=>({type:e.type,bootstrap:e.bootstrap||wu,declarations:e.declarations||wu,imports:e.imports||wu,exports:e.exports||wu,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function TH(e,t){if(e==null)return Eb;let i={};for(let r in e)if(e.hasOwnProperty(r)){let s=e[r],n,c,u=Fd.None;Array.isArray(s)?(u=s[0],n=s[1],c=s[2]??n):(n=s,c=s),t?(i[n]=u!==Fd.None?[r,u]:r,t[n]=c):i[n]=r}return i}function Hg(e){return Fb(()=>{let t=S8(e);return E8(t),t})}function Lg(e){return e[Lae]||null}function _8(e){return e[zae]||null}function x8(e){return e[Fae]||null}function b8(e){let t=Lg(e)||_8(e)||x8(e);return t!==null?t.standalone:!1}function w8(e,t){let i=e[kae]||null;if(!i&&t===!0)throw new Error(`Type ${ul(e)} does not have '\u0275mod' property.`);return i}function S8(e){let t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputTransforms:null,inputConfig:e.inputs||Eb,exportAs:e.exportAs||null,standalone:e.standalone===!0,signals:e.signals===!0,selectors:e.selectors||wu,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:TH(e.inputs,t),outputs:TH(e.outputs),debugInfo:null}}function E8(e){e.features?.forEach(t=>t(e))}function AH(e,t){if(!e)return null;let i=t?x8:mle;return()=>(typeof e=="function"?e():e).map(r=>i(r)).filter(gle)}function yle(e){let t=0,i=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(let s of i)t=Math.imul(31,t)+s.charCodeAt(0)<<0;return t+=2147483648,"c"+t}function z0(e){return{\u0275providers:e}}function vle(...e){return{\u0275providers:M8(!0,e),\u0275fromNgModule:!0}}function M8(e,...t){let i=[],r=new Set,s,n=c=>{i.push(c)};return K3(t,c=>{let u=c;h3(u,n,[],r)&&(s||=[],s.push(u))}),s!==void 0&&T8(s,n),i}function T8(e,t){for(let i=0;i<e.length;i++){let{ngModule:r,providers:s}=e[i];tL(s,n=>{t(n,r)})}}function h3(e,t,i,r){if(e=zc(e),!e)return!1;let s=null,n=xH(e),c=!n&&Lg(e);if(!n&&!c){let p=e.ngModule;if(n=xH(p),n)s=p;else return!1}else{if(c&&!c.standalone)return!1;s=e}let u=r.has(s);if(c){if(u)return!1;if(r.add(s),c.dependencies){let p=typeof c.dependencies=="function"?c.dependencies():c.dependencies;for(let f of p)h3(f,t,i,r)}}else if(n){if(n.imports!=null&&!u){r.add(s);let f;try{K3(n.imports,x=>{h3(x,t,i,r)&&(f||=[],f.push(x))})}finally{}f!==void 0&&T8(f,t)}if(!u){let f=C0(s)||(()=>new s);t({provide:s,useFactory:f,deps:wu},s),t({provide:m8,useValue:s,multi:!0},s),t({provide:D0,useValue:()=>Er(s),multi:!0},s)}let p=n.providers;if(p!=null&&!u){let f=e;tL(p,x=>{t(x,f)})}}else return!1;return s!==e&&e.providers!==void 0}function tL(e,t){for(let i of e)a8(i)&&(i=i.\u0275providers),Array.isArray(i)?tL(i,t):t(i)}var _le=As({provide:String,useValue:As});function A8(e){return e!==null&&typeof e=="object"&&_le in e}function xle(e){return!!(e&&e.useExisting)}function ble(e){return!!(e&&e.useFactory)}function d3(e){return typeof e=="function"}var aA=new an(""),zT={},wle={},$O;function iL(){return $O===void 0&&($O=new HT),$O}var Rl=class{},Mb=class extends Rl{get destroyed(){return this._destroyed}constructor(t,i,r,s){super(),this.parent=i,this.source=r,this.scopes=s,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,f3(t,c=>this.processProvider(c)),this.records.set(f8,S0(void 0,this)),s.has("environment")&&this.records.set(Rl,S0(void 0,this));let n=this.records.get(aA);n!=null&&typeof n.value=="string"&&this.scopes.add(n.value),this.injectorDefTypes=new Set(this.get(m8,wu,Mn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let t=ts(null);try{for(let r of this._ngOnDestroyHooks)r.ngOnDestroy();let i=this._onDestroyHooks;this._onDestroyHooks=[];for(let r of i)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),ts(t)}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();let i=Tf(this),r=Lc(void 0),s;try{return t()}finally{Tf(i),Lc(r)}}get(t,i=Sb,r=Mn.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(wH))return t[wH](this);r=oA(r);let s,n=Tf(this),c=Lc(void 0);try{if(!(r&Mn.SkipSelf)){let p=this.records.get(t);if(p===void 0){let f=Cle(t)&&sA(t);f&&this.injectableDefInScope(f)?p=S0(p3(t),zT):p=null,this.records.set(t,p)}if(p!=null)return this.hydrate(t,p)}let u=r&Mn.Self?iL():this.parent;return i=r&Mn.Optional&&i===Sb?null:i,u.get(t,i)}catch(u){if(u.name==="NullInjectorError"){if((u[VT]=u[VT]||[]).unshift(ul(t)),n)throw u;return Yae(u,t,"R3InjectorError",this.source)}else throw u}finally{Lc(c),Tf(n)}}resolveInjectorInitializers(){let t=ts(null),i=Tf(this),r=Lc(void 0),s;try{let n=this.get(D0,wu,Mn.Self);for(let c of n)c()}finally{Tf(i),Lc(r),ts(t)}}toString(){let t=[],i=this.records;for(let r of i.keys())t.push(ul(r));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Ui(205,!1)}processProvider(t){t=zc(t);let i=d3(t)?t:zc(t&&t.provide),r=Ele(t);if(!d3(t)&&t.multi===!0){let s=this.records.get(i);s||(s=S0(void 0,zT,!0),s.factory=()=>c3(s.multi),this.records.set(i,s)),i=t,s.multi.push(t)}this.records.set(i,r)}hydrate(t,i){let r=ts(null);try{return i.value===zT&&(i.value=wle,i.value=i.factory()),typeof i.value=="object"&&i.value&&Ale(i.value)&&this._ngOnDestroyHooks.add(i.value),i.value}finally{ts(r)}}injectableDefInScope(t){if(!t.providedIn)return!1;let i=zc(t.providedIn);return typeof i=="string"?i==="any"||this.scopes.has(i):this.injectorDefTypes.has(i)}removeOnDestroy(t){let i=this._onDestroyHooks.indexOf(t);i!==-1&&this._onDestroyHooks.splice(i,1)}};function p3(e){let t=sA(e),i=t!==null?t.factory:C0(e);if(i!==null)return i;if(e instanceof an)throw new Ui(204,!1);if(e instanceof Function)return Sle(e);throw new Ui(204,!1)}function Sle(e){if(e.length>0)throw new Ui(204,!1);let i=Rae(e);return i!==null?()=>i.factory(e):()=>new e}function Ele(e){if(A8(e))return S0(void 0,e.useValue);{let t=Mle(e);return S0(t,zT)}}function Mle(e,t,i){let r;if(d3(e)){let s=zc(e);return C0(s)||p3(s)}else if(A8(e))r=()=>zc(e.useValue);else if(ble(e))r=()=>e.useFactory(...c3(e.deps||[]));else if(xle(e))r=()=>Er(zc(e.useExisting));else{let s=zc(e&&(e.useClass||e.provide));if(Tle(e))r=()=>new s(...c3(e.deps));else return C0(s)||p3(s)}return r}function S0(e,t,i=!1){return{factory:e,value:t,multi:i?[]:void 0}}function Tle(e){return!!e.deps}function Ale(e){return e!==null&&typeof e=="object"&&typeof e.ngOnDestroy=="function"}function Cle(e){return typeof e=="function"||typeof e=="object"&&e instanceof an}function f3(e,t){for(let i of e)Array.isArray(i)?f3(i,t):i&&a8(i)?f3(i.\u0275providers,t):t(i)}function Ud(e,t){e instanceof Mb&&e.assertNotDestroyed();let i,r=Tf(e),s=Lc(void 0);try{return t()}finally{Tf(r),Lc(s)}}function Dle(){return c8()!==void 0||Hae()!=null}function Ile(e){return typeof e=="function"}var jd=0,Tn=1,$r=2,Sa=3,Su=4,rc=5,Tb=6,Ab=7,Eu=8,I0=9,Eh=10,Go=11,Cb=12,CH=13,F0=14,Mu=15,Nb=16,E0=17,kd=18,lA=19,C8=20,Af=21,ZO=22,zg=23,Tu=25,D8=1;var Fg=7,WT=8,P0=9,ic=10,rL=function(e){return e[e.None=0]="None",e[e.HasTransplantedViews=2]="HasTransplantedViews",e}(rL||{});function Rg(e){return Array.isArray(e)&&typeof e[D8]=="object"}function Vd(e){return Array.isArray(e)&&e[D8]===!0}function nL(e){return(e.flags&4)!==0}function cA(e){return e.componentOffset>-1}function uA(e){return(e.flags&1)===1}function Bb(e){return!!e.template}function Ple(e){return(e[$r]&512)!==0}var m3=class{constructor(t,i,r){this.previousValue=t,this.currentValue=i,this.firstChange=r}isFirstChange(){return this.firstChange}};function I8(e,t,i,r){t!==null?t.applyValueToInputSignal(t,r):e[i]=r}function Ub(){return P8}function P8(e){return e.type.prototype.ngOnChanges&&(e.setInput=Ole),Rle}Ub.ngInherit=!0;function Rle(){let e=O8(this),t=e?.current;if(t){let i=e.previous;if(i===Eb)e.previous=t;else for(let r in t)i[r]=t[r];e.current=null,this.ngOnChanges(t)}}function Ole(e,t,i,r,s){let n=this.declaredInputs[r],c=O8(e)||Lle(e,{previous:Eb,current:null}),u=c.current||(c.current={}),p=c.previous,f=p[n];u[n]=new m3(f&&f.currentValue,i,p===Eb),I8(e,t,s,i)}var R8="__ngSimpleChanges__";function O8(e){return e[R8]||null}function Lle(e,t){return e[R8]=t}var DH=null;var bh=function(e,t,i){DH?.(e,t,i)},zle="svg",Fle="math",kle=!1;function Nle(){return kle}function Mh(e){for(;Array.isArray(e);)e=e[jd];return e}function L8(e,t){return Mh(t[e])}function Au(e,t){return Mh(t[e.index])}function z8(e,t){return e.data[t]}function Ble(e,t){return e[t]}function If(e,t){let i=t[e];return Rg(i)?i:i[jd]}function Ule(e){return(e[$r]&4)===4}function sL(e){return(e[$r]&128)===128}function jle(e){return Vd(e[Sa])}function R0(e,t){return t==null?null:e[t]}function F8(e){e[E0]=0}function Vle(e){e[$r]&1024||(e[$r]|=1024,sL(e)&&Db(e))}function Gle(e,t){for(;e>0;)t=t[F0],e--;return t}function oL(e){return!!(e[$r]&9216||e[zg]?.dirty)}function g3(e){e[Eh].changeDetectionScheduler?.notify(1),oL(e)?Db(e):e[$r]&64&&(Nle()?(e[$r]|=1024,Db(e)):e[Eh].changeDetectionScheduler?.notify())}function Db(e){e[Eh].changeDetectionScheduler?.notify();let t=Ib(e);for(;t!==null&&!(t[$r]&8192||(t[$r]|=8192,!sL(t)));)t=Ib(t)}function k8(e,t){if((e[$r]&256)===256)throw new Ui(911,!1);e[Af]===null&&(e[Af]=[]),e[Af].push(t)}function Hle(e,t){if(e[Af]===null)return;let i=e[Af].indexOf(t);i!==-1&&e[Af].splice(i,1)}function Ib(e){let t=e[Sa];return Vd(t)?t[Sa]:t}var An={lFrame:W8(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Wle(){return An.lFrame.elementDepthCount}function qle(){An.lFrame.elementDepthCount++}function Yle(){An.lFrame.elementDepthCount--}function N8(){return An.bindingsEnabled}function B8(){return An.skipHydrationRootTNode!==null}function Xle(e){return An.skipHydrationRootTNode===e}function $le(){An.skipHydrationRootTNode=null}function vs(){return An.lFrame.lView}function hl(){return An.lFrame.tView}function hA(e){return An.lFrame.contextLView=e,e[Eu]}function dA(e){return An.lFrame.contextLView=null,e}function nc(){let e=U8();for(;e!==null&&e.type===64;)e=e.parent;return e}function U8(){return An.lFrame.currentTNode}function Zle(){let e=An.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}function Wg(e,t){let i=An.lFrame;i.currentTNode=e,i.isParent=t}function aL(){return An.lFrame.isParent}function lL(){An.lFrame.isParent=!1}function Qle(){return An.lFrame.contextLView}function Kle(e){return An.lFrame.bindingIndex=e}function j8(){return An.lFrame.bindingIndex++}function Jle(e){let t=An.lFrame,i=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,i}function ece(){return An.lFrame.inI18n}function tce(e,t){let i=An.lFrame;i.bindingIndex=i.bindingRootIndex=e,y3(t)}function ice(){return An.lFrame.currentDirectiveIndex}function y3(e){An.lFrame.currentDirectiveIndex=e}function rce(e){let t=An.lFrame.currentDirectiveIndex;return t===-1?null:e[t]}function V8(){return An.lFrame.currentQueryIndex}function cL(e){An.lFrame.currentQueryIndex=e}function nce(e){let t=e[Tn];return t.type===2?t.declTNode:t.type===1?e[rc]:null}function G8(e,t,i){if(i&Mn.SkipSelf){let s=t,n=e;for(;s=s.parent,s===null&&!(i&Mn.Host);)if(s=nce(n),s===null||(n=n[F0],s.type&10))break;if(s===null)return!1;t=s,e=n}let r=An.lFrame=H8();return r.currentTNode=t,r.lView=e,!0}function uL(e){let t=H8(),i=e[Tn];An.lFrame=t,t.currentTNode=i.firstChild,t.lView=e,t.tView=i,t.contextLView=e,t.bindingIndex=i.bindingStartIndex,t.inI18n=!1}function H8(){let e=An.lFrame,t=e===null?null:e.child;return t===null?W8(e):t}function W8(e){let t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return e!==null&&(e.child=t),t}function q8(){let e=An.lFrame;return An.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}var Y8=q8;function hL(){let e=q8();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function sce(e){return(An.lFrame.contextLView=Gle(e,An.lFrame.contextLView))[Eu]}function k0(){return An.lFrame.selectedIndex}function kg(e){An.lFrame.selectedIndex=e}function X8(){let e=An.lFrame;return z8(e.tView,e.selectedIndex)}function oce(){return An.lFrame.currentNamespace}var $8=!0;function pA(){return $8}function fA(e){$8=e}function ace(e,t,i){let{ngOnChanges:r,ngOnInit:s,ngDoCheck:n}=t.type.prototype;if(r){let c=P8(t);(i.preOrderHooks??=[]).push(e,c),(i.preOrderCheckHooks??=[]).push(e,c)}s&&(i.preOrderHooks??=[]).push(0-e,s),n&&((i.preOrderHooks??=[]).push(e,n),(i.preOrderCheckHooks??=[]).push(e,n))}function mA(e,t){for(let i=t.directiveStart,r=t.directiveEnd;i<r;i++){let n=e.data[i].type.prototype,{ngAfterContentInit:c,ngAfterContentChecked:u,ngAfterViewInit:p,ngAfterViewChecked:f,ngOnDestroy:x}=n;c&&(e.contentHooks??=[]).push(-i,c),u&&((e.contentHooks??=[]).push(i,u),(e.contentCheckHooks??=[]).push(i,u)),p&&(e.viewHooks??=[]).push(-i,p),f&&((e.viewHooks??=[]).push(i,f),(e.viewCheckHooks??=[]).push(i,f)),x!=null&&(e.destroyHooks??=[]).push(i,x)}}function FT(e,t,i){Z8(e,t,3,i)}function kT(e,t,i,r){(e[$r]&3)===i&&Z8(e,t,i,r)}function QO(e,t){let i=e[$r];(i&3)===t&&(i&=16383,i+=1,e[$r]=i)}function Z8(e,t,i,r){let s=r!==void 0?e[E0]&65535:0,n=r??-1,c=t.length-1,u=0;for(let p=s;p<c;p++)if(typeof t[p+1]=="number"){if(u=t[p],r!=null&&u>=r)break}else t[p]<0&&(e[E0]+=65536),(u<n||n==-1)&&(lce(e,i,t,p),e[E0]=(e[E0]&4294901760)+p+2),p++}function IH(e,t){bh(4,e,t);let i=ts(null);try{t.call(e)}finally{ts(i),bh(5,e,t)}}function lce(e,t,i,r){let s=i[r]<0,n=i[r+1],c=s?-i[r]:i[r],u=e[c];s?e[$r]>>14<e[E0]>>16&&(e[$r]&3)===t&&(e[$r]+=16384,IH(u,n)):IH(u,n)}var A0=-1,Pb=class{constructor(t,i,r){this.factory=t,this.resolving=!1,this.canSeeViewProviders=i,this.injectImpl=r}};function cce(e){return e instanceof Pb}function uce(e){return(e.flags&8)!==0}function hce(e){return(e.flags&16)!==0}function Q8(e){return e!==A0}function qT(e){return e&32767}function dce(e){return e>>16}function YT(e,t){let i=dce(e),r=t;for(;i>0;)r=r[F0],i--;return r}var v3=!0;function PH(e){let t=v3;return v3=e,t}var pce=256,K8=pce-1,J8=5,fce=0,wh={};function mce(e,t,i){let r;typeof i=="string"?r=i.charCodeAt(0)||0:i.hasOwnProperty(wb)&&(r=i[wb]),r==null&&(r=i[wb]=fce++);let s=r&K8,n=1<<s;t.data[e+(s>>J8)]|=n}function eW(e,t){let i=tW(e,t);if(i!==-1)return i;let r=t[Tn];r.firstCreatePass&&(e.injectorIndex=t.length,KO(r.data,e),KO(t,null),KO(r.blueprint,null));let s=dL(e,t),n=e.injectorIndex;if(Q8(s)){let c=qT(s),u=YT(s,t),p=u[Tn].data;for(let f=0;f<8;f++)t[n+f]=u[c+f]|p[c+f]}return t[n+8]=s,n}function KO(e,t){e.push(0,0,0,0,0,0,0,0,t)}function tW(e,t){return e.injectorIndex===-1||e.parent&&e.parent.injectorIndex===e.injectorIndex||t[e.injectorIndex+8]===null?-1:e.injectorIndex}function dL(e,t){if(e.parent&&e.parent.injectorIndex!==-1)return e.parent.injectorIndex;let i=0,r=null,s=t;for(;s!==null;){if(r=oW(s),r===null)return A0;if(i++,s=s[F0],r.injectorIndex!==-1)return r.injectorIndex|i<<16}return A0}function gce(e,t,i){mce(e,t,i)}function iW(e,t,i){if(i&Mn.Optional||e!==void 0)return e;Z3(t,"NodeInjector")}function rW(e,t,i,r){if(i&Mn.Optional&&r===void 0&&(r=null),!(i&(Mn.Self|Mn.Host))){let s=e[I0],n=Lc(void 0);try{return s?s.get(t,r,i&Mn.Optional):u8(t,r,i&Mn.Optional)}finally{Lc(n)}}return iW(r,t,i)}function nW(e,t,i,r=Mn.Default,s){if(e!==null){if(t[$r]&2048&&!(r&Mn.Self)){let c=xce(e,t,i,r,wh);if(c!==wh)return c}let n=sW(e,t,i,r,wh);if(n!==wh)return n}return rW(t,i,r,s)}function sW(e,t,i,r,s){let n=vce(i);if(typeof n=="function"){if(!G8(t,e,r))return r&Mn.Host?iW(s,i,r):rW(t,i,r,s);try{let c;if(c=n(r),c==null&&!(r&Mn.Optional))Z3(i);else return c}finally{Y8()}}else if(typeof n=="number"){let c=null,u=tW(e,t),p=A0,f=r&Mn.Host?t[Mu][rc]:null;for((u===-1||r&Mn.SkipSelf)&&(p=u===-1?dL(e,t):t[u+8],p===A0||!OH(r,!1)?u=-1:(c=t[Tn],u=qT(p),t=YT(p,t)));u!==-1;){let x=t[Tn];if(RH(n,u,x.data)){let w=yce(u,t,i,c,r,f);if(w!==wh)return w}p=t[u+8],p!==A0&&OH(r,t[Tn].data[u+8]===f)&&RH(n,u,t)?(c=x,u=qT(p),t=YT(p,t)):u=-1}}return s}function yce(e,t,i,r,s,n){let c=t[Tn],u=c.data[e+8],p=r==null?cA(u)&&v3:r!=c&&(u.type&3)!==0,f=s&Mn.Host&&n===u,x=NT(u,c,i,p,f);return x!==null?O0(t,c,x,u):wh}function NT(e,t,i,r,s){let n=e.providerIndexes,c=t.data,u=n&1048575,p=e.directiveStart,f=e.directiveEnd,x=n>>20,w=r?u:u+x,E=s?u+x:f;for(let A=w;A<E;A++){let I=c[A];if(A<p&&i===I||A>=p&&I.type===i)return A}if(s){let A=c[p];if(A&&Bb(A)&&A.type===i)return p}return null}function O0(e,t,i,r){let s=e[i],n=t.data;if(cce(s)){let c=s;c.resolving&&Bae(Nae(n[i]));let u=PH(c.canSeeViewProviders);c.resolving=!0;let p,f=c.injectImpl?Lc(c.injectImpl):null,x=G8(e,r,Mn.Default);try{s=e[i]=c.factory(void 0,n,e,r),t.firstCreatePass&&i>=r.directiveStart&&ace(i,n[i],t)}finally{f!==null&&Lc(f),PH(u),c.resolving=!1,Y8()}}return s}function vce(e){if(typeof e=="string")return e.charCodeAt(0)||0;let t=e.hasOwnProperty(wb)?e[wb]:void 0;return typeof t=="number"?t>=0?t&K8:_ce:t}function RH(e,t,i){let r=1<<e;return!!(i[t+(e>>J8)]&r)}function OH(e,t){return!(e&Mn.Self)&&!(e&Mn.Host&&t)}var Og=class{constructor(t,i){this._tNode=t,this._lView=i}get(t,i,r){return nW(this._tNode,this._lView,t,oA(r),i)}};function _ce(){return new Og(nc(),vs())}function pL(e){return Fb(()=>{let t=e.prototype.constructor,i=t[jT]||_3(t),r=Object.prototype,s=Object.getPrototypeOf(e.prototype).constructor;for(;s&&s!==r;){let n=s[jT]||_3(s);if(n&&n!==i)return n;s=Object.getPrototypeOf(s)}return n=>new n})}function _3(e){return r8(e)?()=>{let t=_3(zc(e));return t&&t()}:C0(e)}function xce(e,t,i,r,s){let n=e,c=t;for(;n!==null&&c!==null&&c[$r]&2048&&!(c[$r]&512);){let u=sW(n,c,i,r|Mn.Self,wh);if(u!==wh)return u;let p=n.parent;if(!p){let f=c[C8];if(f){let x=f.get(i,wh,r);if(x!==wh)return x}p=oW(c),c=c[F0]}n=p}return s}function oW(e){let t=e[Tn],i=t.type;return i===2?t.declTNode:i===1?e[rc]:null}function LH(e,t=null,i=null,r){let s=aW(e,t,i,r);return s.resolveInjectorInitializers(),s}function aW(e,t=null,i=null,r,s=new Set){let n=[i||wu,vle(e)];return r=r||(typeof e=="object"?void 0:ul(e)),new Mb(n,t||iL(),r||null,s)}var qg=(()=>{let t=class t{static create(r,s){if(Array.isArray(r))return LH({name:""},s,r,"");{let n=r.name??"";return LH({name:n},r.parent,r.providers,n)}}};t.THROW_IF_NOT_FOUND=Sb,t.NULL=new HT,t.\u0275prov=hr({token:t,providedIn:"any",factory:()=>Er(f8)}),t.__NG_ELEMENT_ID__=-1;let e=t;return e})();var bce="ngOriginalError";function JO(e){return e[bce]}var Nd=class{constructor(){this._console=console}handleError(t){let i=this._findOriginalError(t);this._console.error("ERROR",t),i&&this._console.error("ORIGINAL ERROR",i)}_findOriginalError(t){let i=t&&JO(t);for(;i&&JO(i);)i=JO(i);return i||null}},lW=new an("",{providedIn:"root",factory:()=>tr(Nd).handleError.bind(void 0)}),cW=(()=>{let t=class t{};t.__NG_ELEMENT_ID__=wce,t.__NG_ENV_ID__=r=>r;let e=t;return e})(),x3=class extends cW{constructor(t){super(),this._lView=t}onDestroy(t){return k8(this._lView,t),()=>Hle(this._lView,t)}};function wce(){return new x3(vs())}function Sce(){return N0(nc(),vs())}function N0(e,t){return new Pf(Au(e,t))}var Pf=(()=>{let t=class t{constructor(r){this.nativeElement=r}};t.__NG_ELEMENT_ID__=Sce;let e=t;return e})();function Ece(e){return e instanceof Pf?e.nativeElement:e}var b3=class extends cl{constructor(t=!1){super(),this.destroyRef=void 0,this.__isAsync=t,Dle()&&(this.destroyRef=tr(cW,{optional:!0})??void 0)}emit(t){let i=ts(null);try{super.next(t)}finally{ts(i)}}subscribe(t,i,r){let s=t,n=i||(()=>null),c=r;if(t&&typeof t=="object"){let p=t;s=p.next?.bind(p),n=p.error?.bind(p),c=p.complete?.bind(p)}this.__isAsync&&(n=e3(n),s&&(s=e3(s)),c&&(c=e3(c)));let u=super.subscribe({next:s,error:n,complete:c});return t instanceof jo&&t.add(u),u}};function e3(e){return t=>{setTimeout(e,void 0,t)}}var Fc=b3;function Mce(){return this._results[Symbol.iterator]()}var w3=class e{get changes(){return this._changes??=new Fc}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let i=e.prototype;i[Symbol.iterator]||(i[Symbol.iterator]=Mce)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,i){return this._results.reduce(t,i)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,i){this.dirty=!1;let r=Zae(t);(this._changesDetected=!$ae(this._results,r,i))&&(this._results=r,this.length=r.length,this.last=r[this.length-1],this.first=r[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(t){this._onDirty=t}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}};function uW(e){return(e.flags&128)===128}var hW=new Map,Tce=0;function Ace(){return Tce++}function Cce(e){hW.set(e[lA],e)}function Dce(e){hW.delete(e[lA])}var zH="__ngContext__";function Cf(e,t){Rg(t)?(e[zH]=t[lA],Cce(t)):e[zH]=t}function dW(e){return fW(e[Cb])}function pW(e){return fW(e[Su])}function fW(e){for(;e!==null&&!Vd(e);)e=e[Su];return e}var S3;function mW(e){S3=e}function Ice(){if(S3!==void 0)return S3;if(typeof document<"u")return document;throw new Ui(210,!1)}var fL=new an("",{providedIn:"root",factory:()=>Pce}),Pce="ng",mL=new an(""),Rf=new an("",{providedIn:"platform",factory:()=>"unknown"});var gL=new an(""),yL=new an("",{providedIn:"root",factory:()=>Ice().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var Rce="h",Oce="b";var Lce=()=>null;function vL(e,t,i=!1){return Lce(e,t,i)}var gW=!1,zce=new an("",{providedIn:"root",factory:()=>gW});var E3=class{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Dae})`}};function _L(e){return e instanceof E3?e.changingThisBreaksApplicationSecurity:e}var Fce=/^>|^->|<!--|-->|--!>|<!-$/g,kce=/(<|>)/g,Nce="\u200B$1\u200B";function Bce(e){return e.replace(Fce,t=>t.replace(kce,Nce))}function yW(e){return e instanceof Function?e():e}var Bd=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(Bd||{}),Uce;function xL(e,t){return Uce(e,t)}function M0(e,t,i,r,s){if(r!=null){let n,c=!1;Vd(r)?n=r:Rg(r)&&(c=!0,r=r[jd]);let u=Mh(r);e===0&&i!==null?s==null?SW(t,i,u):XT(t,i,u,s||null,!0):e===1&&i!==null?XT(t,i,u,s||null,!0):e===2?iue(t,u,c):e===3&&t.destroyNode(u),n!=null&&nue(t,e,n,i,s)}}function jce(e,t){return e.createText(t)}function Vce(e,t,i){e.setValue(t,i)}function Gce(e,t){return e.createComment(Bce(t))}function vW(e,t,i){return e.createElement(t,i)}function Hce(e,t){_W(e,t),t[jd]=null,t[rc]=null}function Wce(e,t,i,r,s,n){r[jd]=s,r[rc]=t,yA(e,r,i,1,s,n)}function _W(e,t){t[Eh].changeDetectionScheduler?.notify(1),yA(e,t,t[Go],2,null,null)}function qce(e){let t=e[Cb];if(!t)return t3(e[Tn],e);for(;t;){let i=null;if(Rg(t))i=t[Cb];else{let r=t[ic];r&&(i=r)}if(!i){for(;t&&!t[Su]&&t!==e;)Rg(t)&&t3(t[Tn],t),t=t[Sa];t===null&&(t=e),Rg(t)&&t3(t[Tn],t),i=t&&t[Su]}t=i}}function Yce(e,t,i,r){let s=ic+r,n=i.length;r>0&&(i[s-1][Su]=t),r<n-ic?(t[Su]=i[s],p8(i,ic+r,t)):(i.push(t),t[Su]=null),t[Sa]=i;let c=t[Nb];c!==null&&i!==c&&Xce(c,t);let u=t[kd];u!==null&&u.insertView(e),g3(t),t[$r]|=128}function Xce(e,t){let i=e[P0],s=t[Sa][Sa][Mu];t[Mu]!==s&&(e[$r]|=rL.HasTransplantedViews),i===null?e[P0]=[t]:i.push(t)}function xW(e,t){let i=e[P0],r=i.indexOf(t);i.splice(r,1)}function M3(e,t){if(e.length<=ic)return;let i=ic+t,r=e[i];if(r){let s=r[Nb];s!==null&&s!==e&&xW(s,r),t>0&&(e[i-1][Su]=r[Su]);let n=GT(e,ic+t);Hce(r[Tn],r);let c=n[kd];c!==null&&c.detachView(n[Tn]),r[Sa]=null,r[Su]=null,r[$r]&=-129}return r}function bW(e,t){if(!(t[$r]&256)){let i=t[Go];i.destroyNode&&yA(e,t,i,3,null,null),qce(t)}}function t3(e,t){if(t[$r]&256)return;let i=ts(null);try{t[$r]&=-129,t[$r]|=256,t[zg]&&VG(t[zg]),Zce(e,t),$ce(e,t),t[Tn].type===1&&t[Go].destroy();let r=t[Nb];if(r!==null&&Vd(t[Sa])){r!==t[Sa]&&xW(r,t);let s=t[kd];s!==null&&s.detachView(e)}Dce(t)}finally{ts(i)}}function $ce(e,t){let i=e.cleanup,r=t[Ab];if(i!==null)for(let n=0;n<i.length-1;n+=2)if(typeof i[n]=="string"){let c=i[n+3];c>=0?r[c]():r[-c].unsubscribe(),n+=2}else{let c=r[i[n+1]];i[n].call(c)}r!==null&&(t[Ab]=null);let s=t[Af];if(s!==null){t[Af]=null;for(let n=0;n<s.length;n++){let c=s[n];c()}}}function Zce(e,t){let i;if(e!=null&&(i=e.destroyHooks)!=null)for(let r=0;r<i.length;r+=2){let s=t[i[r]];if(!(s instanceof Pb)){let n=i[r+1];if(Array.isArray(n))for(let c=0;c<n.length;c+=2){let u=s[n[c]],p=n[c+1];bh(4,u,p);try{p.call(u)}finally{bh(5,u,p)}}else{bh(4,s,n);try{n.call(s)}finally{bh(5,s,n)}}}}}function wW(e,t,i){return Qce(e,t.parent,i)}function Qce(e,t,i){let r=t;for(;r!==null&&r.type&40;)t=r,r=t.parent;if(r===null)return i[jd];{let{componentOffset:s}=r;if(s>-1){let{encapsulation:n}=e.data[r.directiveStart+s];if(n===Sh.None||n===Sh.Emulated)return null}return Au(r,i)}}function XT(e,t,i,r,s){e.insertBefore(t,i,r,s)}function SW(e,t,i){e.appendChild(t,i)}function FH(e,t,i,r,s){r!==null?XT(e,t,i,r,s):SW(e,t,i)}function Kce(e,t,i,r){e.removeChild(t,i,r)}function bL(e,t){return e.parentNode(t)}function Jce(e,t){return e.nextSibling(t)}function EW(e,t,i){return tue(e,t,i)}function eue(e,t,i){return e.type&40?Au(e,i):null}var tue=eue,kH;function gA(e,t,i,r){let s=wW(e,r,t),n=t[Go],c=r.parent||t[rc],u=EW(c,r,t);if(s!=null)if(Array.isArray(i))for(let p=0;p<i.length;p++)FH(n,s,i[p],u,!1);else FH(n,s,i,u,!1);kH!==void 0&&kH(n,r,t,i,s)}function BT(e,t){if(t!==null){let i=t.type;if(i&3)return Au(t,e);if(i&4)return T3(-1,e[t.index]);if(i&8){let r=t.child;if(r!==null)return BT(e,r);{let s=e[t.index];return Vd(s)?T3(-1,s):Mh(s)}}else{if(i&32)return xL(t,e)()||Mh(e[t.index]);{let r=MW(e,t);if(r!==null){if(Array.isArray(r))return r[0];let s=Ib(e[Mu]);return BT(s,r)}else return BT(e,t.next)}}}return null}function MW(e,t){if(t!==null){let r=e[Mu][rc],s=t.projection;return r.projection[s]}return null}function T3(e,t){let i=ic+e+1;if(i<t.length){let r=t[i],s=r[Tn].firstChild;if(s!==null)return BT(r,s)}return t[Fg]}function iue(e,t,i){let r=bL(e,t);r&&Kce(e,r,t,i)}function wL(e,t,i,r,s,n,c){for(;i!=null;){let u=r[i.index],p=i.type;if(c&&t===0&&(u&&Cf(Mh(u),r),i.flags|=2),(i.flags&32)!==32)if(p&8)wL(e,t,i.child,r,s,n,!1),M0(t,e,s,u,n);else if(p&32){let f=xL(i,r),x;for(;x=f();)M0(t,e,s,x,n);M0(t,e,s,u,n)}else p&16?TW(e,t,r,i,s,n):M0(t,e,s,u,n);i=c?i.projectionNext:i.next}}function yA(e,t,i,r,s,n){wL(i,r,e.firstChild,t,s,n,!1)}function rue(e,t,i){let r=t[Go],s=wW(e,i,t),n=i.parent||t[rc],c=EW(n,i,t);TW(r,0,t,i,s,c)}function TW(e,t,i,r,s,n){let c=i[Mu],p=c[rc].projection[r.projection];if(Array.isArray(p))for(let f=0;f<p.length;f++){let x=p[f];M0(t,e,s,x,n)}else{let f=p,x=c[Sa];uW(r)&&(f.flags|=128),wL(e,t,f,x,s,n,!0)}}function nue(e,t,i,r,s){let n=i[Fg],c=Mh(i);n!==c&&M0(t,e,r,n,s);for(let u=ic;u<i.length;u++){let p=i[u];yA(p[Tn],p,e,t,r,n)}}function sue(e,t,i,r,s){if(t)s?e.addClass(i,r):e.removeClass(i,r);else{let n=r.indexOf("-")===-1?void 0:Bd.DashCase;s==null?e.removeStyle(i,r,n):(typeof s=="string"&&s.endsWith("!important")&&(s=s.slice(0,-10),n|=Bd.Important),e.setStyle(i,r,s,n))}}function oue(e,t,i){e.setAttribute(t,"style",i)}function AW(e,t,i){i===""?e.removeAttribute(t,"class"):e.setAttribute(t,"class",i)}function CW(e,t,i){let{mergedAttrs:r,classes:s,styles:n}=i;r!==null&&u3(e,t,r),s!==null&&AW(e,t,s),n!==null&&oue(e,t,n)}var Yg={};function Qs(e=1){DW(hl(),vs(),k0()+e,!1)}function DW(e,t,i,r){if(!r)if((t[$r]&3)===3){let n=e.preOrderCheckHooks;n!==null&&FT(t,n,i)}else{let n=e.preOrderHooks;n!==null&&kT(t,n,0,i)}kg(i)}function _s(e,t=Mn.Default){let i=vs();if(i===null)return Er(e,t);let r=nc();return nW(r,i,zc(e),t)}function IW(e,t,i,r,s,n){let c=ts(null);try{let u=null;s&Fd.SignalBased&&(u=t[r][NG]),u!==null&&u.transformFn!==void 0&&(n=u.transformFn(n)),s&Fd.HasDecoratorInputTransform&&(n=e.inputTransforms[r].call(t,n)),e.setInput!==null?e.setInput(t,u,n,i,r):I8(t,u,r,n)}finally{ts(c)}}function aue(e,t){let i=e.hostBindingOpCodes;if(i!==null)try{for(let r=0;r<i.length;r++){let s=i[r];if(s<0)kg(~s);else{let n=s,c=i[++r],u=i[++r];tce(c,n);let p=t[n];u(2,p)}}}finally{kg(-1)}}function vA(e,t,i,r,s,n,c,u,p,f,x){let w=t.blueprint.slice();return w[jd]=s,w[$r]=r|4|128|8|64,(f!==null||e&&e[$r]&2048)&&(w[$r]|=2048),F8(w),w[Sa]=w[F0]=e,w[Eu]=i,w[Eh]=c||e&&e[Eh],w[Go]=u||e&&e[Go],w[I0]=p||e&&e[I0]||null,w[rc]=n,w[lA]=Ace(),w[Tb]=x,w[C8]=f,w[Mu]=t.type==2?e[Mu]:w,w}function B0(e,t,i,r,s){let n=e.data[t];if(n===null)n=lue(e,t,i,r,s),ece()&&(n.flags|=32);else if(n.type&64){n.type=i,n.value=r,n.attrs=s;let c=Zle();n.injectorIndex=c===null?-1:c.injectorIndex}return Wg(n,!0),n}function lue(e,t,i,r,s){let n=U8(),c=aL(),u=c?n:n&&n.parent,p=e.data[t]=fue(e,u,i,t,r,s);return e.firstChild===null&&(e.firstChild=p),n!==null&&(c?n.child==null&&p.parent!==null&&(n.child=p):n.next===null&&(n.next=p,p.prev=n)),p}function PW(e,t,i,r){if(i===0)return-1;let s=t.length;for(let n=0;n<i;n++)t.push(r),e.blueprint.push(r),e.data.push(null);return s}function RW(e,t,i,r,s){let n=k0(),c=r&2;try{kg(-1),c&&t.length>Tu&&DW(e,t,Tu,!1),bh(c?2:0,s),i(r,s)}finally{kg(n),bh(c?3:1,s)}}function SL(e,t,i){if(nL(t)){let r=ts(null);try{let s=t.directiveStart,n=t.directiveEnd;for(let c=s;c<n;c++){let u=e.data[c];if(u.contentQueries){let p=i[c];u.contentQueries(1,p,c)}}}finally{ts(r)}}}function EL(e,t,i){N8()&&(xue(e,t,i,Au(i,t)),(i.flags&64)===64&&FW(e,t,i))}function ML(e,t,i=Au){let r=t.localNames;if(r!==null){let s=t.index+1;for(let n=0;n<r.length;n+=2){let c=r[n+1],u=c===-1?i(t,e):e[c];e[s++]=u}}}function OW(e){let t=e.tView;return t===null||t.incompleteFirstPass?e.tView=TL(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function TL(e,t,i,r,s,n,c,u,p,f,x){let w=Tu+r,E=w+s,A=cue(w,E),I=typeof f=="function"?f():f;return A[Tn]={type:e,blueprint:A,template:i,queries:null,viewQuery:u,declTNode:t,data:A.slice().fill(null,w),bindingStartIndex:w,expandoStartIndex:E,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof n=="function"?n():n,pipeRegistry:typeof c=="function"?c():c,firstChild:null,schemas:p,consts:I,incompleteFirstPass:!1,ssrId:x}}function cue(e,t){let i=[];for(let r=0;r<t;r++)i.push(r<e?null:Yg);return i}function uue(e,t,i,r){let n=r.get(zce,gW)||i===Sh.ShadowDom,c=e.selectRootElement(t,n);return hue(c),c}function hue(e){due(e)}var due=()=>null;function pue(e,t,i,r){let s=BW(t);s.push(i),e.firstCreatePass&&UW(e).push(r,s.length-1)}function fue(e,t,i,r,s,n){let c=t?t.injectorIndex:-1,u=0;return B8()&&(u|=128),{type:i,index:r,insertBeforeIndex:null,injectorIndex:c,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:u,providerIndexes:0,value:s,attrs:n,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function NH(e,t,i,r,s){for(let n in t){if(!t.hasOwnProperty(n))continue;let c=t[n];if(c===void 0)continue;r??={};let u,p=Fd.None;Array.isArray(c)?(u=c[0],p=c[1]):u=c;let f=n;if(s!==null){if(!s.hasOwnProperty(n))continue;f=s[n]}e===0?BH(r,i,f,u,p):BH(r,i,f,u)}return r}function BH(e,t,i,r,s){let n;e.hasOwnProperty(i)?(n=e[i]).push(t,r):n=e[i]=[t,r],s!==void 0&&n.push(s)}function mue(e,t,i){let r=t.directiveStart,s=t.directiveEnd,n=e.data,c=t.attrs,u=[],p=null,f=null;for(let x=r;x<s;x++){let w=n[x],E=i?i.get(w):null,A=E?E.inputs:null,I=E?E.outputs:null;p=NH(0,w.inputs,x,p,A),f=NH(1,w.outputs,x,f,I);let P=p!==null&&c!==null&&!eL(t)?Due(p,x,c):null;u.push(P)}p!==null&&(p.hasOwnProperty("class")&&(t.flags|=8),p.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=u,t.inputs=p,t.outputs=f}function gue(e){return e==="class"?"className":e==="for"?"htmlFor":e==="formaction"?"formAction":e==="innerHtml"?"innerHTML":e==="readonly"?"readOnly":e==="tabindex"?"tabIndex":e}function LW(e,t,i,r,s,n,c,u){let p=Au(t,i),f=t.inputs,x;!u&&f!=null&&(x=f[r])?(CL(e,i,x,r,s),cA(t)&&yue(i,t.index)):t.type&3?(r=gue(r),s=c!=null?c(s,t.value||"",r):s,n.setProperty(p,r,s)):t.type&12}function yue(e,t){let i=If(t,e);i[$r]&16||(i[$r]|=64)}function AL(e,t,i,r){if(N8()){let s=r===null?null:{"":-1},n=wue(e,i),c,u;n===null?c=u=null:[c,u]=n,c!==null&&zW(e,t,i,c,s,u),s&&Sue(i,r,s)}i.mergedAttrs=J3(i.mergedAttrs,i.attrs)}function zW(e,t,i,r,s,n){for(let f=0;f<r.length;f++)gce(eW(i,t),e,r[f].type);Mue(i,e.data.length,r.length);for(let f=0;f<r.length;f++){let x=r[f];x.providersResolver&&x.providersResolver(x)}let c=!1,u=!1,p=PW(e,t,r.length,null);for(let f=0;f<r.length;f++){let x=r[f];i.mergedAttrs=J3(i.mergedAttrs,x.hostAttrs),Tue(e,i,t,p,x),Eue(p,x,s),x.contentQueries!==null&&(i.flags|=4),(x.hostBindings!==null||x.hostAttrs!==null||x.hostVars!==0)&&(i.flags|=64);let w=x.type.prototype;!c&&(w.ngOnChanges||w.ngOnInit||w.ngDoCheck)&&((e.preOrderHooks??=[]).push(i.index),c=!0),!u&&(w.ngOnChanges||w.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(i.index),u=!0),p++}mue(e,i,n)}function vue(e,t,i,r,s){let n=s.hostBindings;if(n){let c=e.hostBindingOpCodes;c===null&&(c=e.hostBindingOpCodes=[]);let u=~t.index;_ue(c)!=u&&c.push(u),c.push(i,r,n)}}function _ue(e){let t=e.length;for(;t>0;){let i=e[--t];if(typeof i=="number"&&i<0)return i}return 0}function xue(e,t,i,r){let s=i.directiveStart,n=i.directiveEnd;cA(i)&&Aue(t,i,e.data[s+i.componentOffset]),e.firstCreatePass||eW(i,t),Cf(r,t);let c=i.initialInputs;for(let u=s;u<n;u++){let p=e.data[u],f=O0(t,e,u,i);if(Cf(f,t),c!==null&&Cue(t,u-s,f,p,i,c),Bb(p)){let x=If(i.index,t);x[Eu]=O0(t,e,u,i)}}}function FW(e,t,i){let r=i.directiveStart,s=i.directiveEnd,n=i.index,c=ice();try{kg(n);for(let u=r;u<s;u++){let p=e.data[u],f=t[u];y3(u),(p.hostBindings!==null||p.hostVars!==0||p.hostAttrs!==null)&&bue(p,f)}}finally{kg(-1),y3(c)}}function bue(e,t){e.hostBindings!==null&&e.hostBindings(1,t)}function wue(e,t){let i=e.directiveRegistry,r=null,s=null;if(i)for(let n=0;n<i.length;n++){let c=i[n];if(v8(t,c.selectors,!1))if(r||(r=[]),Bb(c))if(c.findHostDirectiveDefs!==null){let u=[];s=s||new Map,c.findHostDirectiveDefs(c,u,s),r.unshift(...u,c);let p=u.length;A3(e,t,p)}else r.unshift(c),A3(e,t,0);else s=s||new Map,c.findHostDirectiveDefs?.(c,r,s),r.push(c)}return r===null?null:[r,s]}function A3(e,t,i){t.componentOffset=i,(e.components??=[]).push(t.index)}function Sue(e,t,i){if(t){let r=e.localNames=[];for(let s=0;s<t.length;s+=2){let n=i[t[s+1]];if(n==null)throw new Ui(-301,!1);r.push(t[s],n)}}}function Eue(e,t,i){if(i){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)i[t.exportAs[r]]=e;Bb(t)&&(i[""]=e)}}function Mue(e,t,i){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+i,e.providerIndexes=t}function Tue(e,t,i,r,s){e.data[r]=s;let n=s.factory||(s.factory=C0(s.type,!0)),c=new Pb(n,Bb(s),_s);e.blueprint[r]=c,i[r]=c,vue(e,t,r,PW(e,i,s.hostVars,Yg),s)}function Aue(e,t,i){let r=Au(t,e),s=OW(i),n=e[Eh].rendererFactory,c=16;i.signals?c=4096:i.onPush&&(c=64);let u=_A(e,vA(e,s,null,c,r,t,null,n.createRenderer(r,i),null,null,null));e[t.index]=u}function Cue(e,t,i,r,s,n){let c=n[t];if(c!==null)for(let u=0;u<c.length;){let p=c[u++],f=c[u++],x=c[u++],w=c[u++];IW(r,i,p,f,x,w)}}function Due(e,t,i){let r=null,s=0;for(;s<i.length;){let n=i[s];if(n===0){s+=4;continue}else if(n===5){s+=2;continue}if(typeof n=="number")break;if(e.hasOwnProperty(n)){r===null&&(r=[]);let c=e[n];for(let u=0;u<c.length;u+=3)if(c[u]===t){r.push(n,c[u+1],c[u+2],i[s+1]);break}}s+=2}return r}function kW(e,t,i,r){return[e,!0,0,t,null,r,null,i,null,null]}function NW(e,t){let i=e.contentQueries;if(i!==null){let r=ts(null);try{for(let s=0;s<i.length;s+=2){let n=i[s],c=i[s+1];if(c!==-1){let u=e.data[c];cL(n),u.contentQueries(2,t[c],c)}}}finally{ts(r)}}}function _A(e,t){return e[Cb]?e[CH][Su]=t:e[Cb]=t,e[CH]=t,t}function C3(e,t,i){cL(0);let r=ts(null);try{t(e,i)}finally{ts(r)}}function BW(e){return e[Ab]||(e[Ab]=[])}function UW(e){return e.cleanup||(e.cleanup=[])}function jW(e,t){let i=e[I0],r=i?i.get(Nd,null):null;r&&r.handleError(t)}function CL(e,t,i,r,s){for(let n=0;n<i.length;){let c=i[n++],u=i[n++],p=i[n++],f=t[c],x=e.data[c];IW(x,f,r,u,p,s)}}function Iue(e,t,i){let r=L8(t,e);Vce(e[Go],r,i)}function Pue(e,t){let i=If(t,e),r=i[Tn];Rue(r,i);let s=i[jd];s!==null&&i[Tb]===null&&(i[Tb]=vL(s,i[I0])),DL(r,i,i[Eu])}function Rue(e,t){for(let i=t.length;i<e.blueprint.length;i++)t.push(e.blueprint[i])}function DL(e,t,i){uL(t);try{let r=e.viewQuery;r!==null&&C3(1,r,i);let s=e.template;s!==null&&RW(e,t,s,1,i),e.firstCreatePass&&(e.firstCreatePass=!1),t[kd]?.finishViewCreation(e),e.staticContentQueries&&NW(e,t),e.staticViewQueries&&C3(2,e.viewQuery,i);let n=e.components;n!==null&&Oue(t,n)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[$r]&=-5,hL()}}function Oue(e,t){for(let i=0;i<t.length;i++)Pue(e,t[i])}function Lue(e,t,i,r){let s=ts(null);try{let n=t.tView,u=e[$r]&4096?4096:16,p=vA(e,n,i,u,null,t,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null),f=e[t.index];p[Nb]=f;let x=e[kd];return x!==null&&(p[kd]=x.createEmbeddedView(n)),DL(n,p,i),p}finally{ts(s)}}function UH(e,t){return!t||t.firstChild===null||uW(e)}function zue(e,t,i,r=!0){let s=t[Tn];if(Yce(s,t,e,i),r){let c=T3(i,e),u=t[Go],p=bL(u,e[Fg]);p!==null&&Wce(s,e[rc],u,t,p,c)}let n=t[Tb];n!==null&&n.firstChild!==null&&(n.firstChild=null)}function $T(e,t,i,r,s=!1){for(;i!==null;){let n=t[i.index];n!==null&&r.push(Mh(n)),Vd(n)&&Fue(n,r);let c=i.type;if(c&8)$T(e,t,i.child,r);else if(c&32){let u=xL(i,t),p;for(;p=u();)r.push(p)}else if(c&16){let u=MW(t,i);if(Array.isArray(u))r.push(...u);else{let p=Ib(t[Mu]);$T(p[Tn],p,u,r,!0)}}i=s?i.projectionNext:i.next}return r}function Fue(e,t){for(let i=ic;i<e.length;i++){let r=e[i],s=r[Tn].firstChild;s!==null&&$T(r[Tn],r,s,t)}e[Fg]!==e[jd]&&t.push(e[Fg])}var VW=[];function kue(e){return e[zg]??Nue(e)}function Nue(e){let t=VW.pop()??Object.create(Uue);return t.lView=e,t}function Bue(e){e.lView[zg]!==e&&(e.lView=null,VW.push(e))}var Uue=pt(me({},BG),{consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{Db(e.lView)},consumerOnSignalRead(){this.lView[zg]=this}}),GW=100;function HW(e,t=!0,i=0){let r=e[Eh],s=r.rendererFactory,n=!1;n||s.begin?.();try{jue(e,i)}catch(c){throw t&&jW(e,c),c}finally{n||(s.end?.(),r.inlineEffectRunner?.flush())}}function jue(e,t){D3(e,t);let i=0;for(;oL(e);){if(i===GW)throw new Ui(103,!1);i++,D3(e,1)}}function Vue(e,t,i,r){let s=t[$r];if((s&256)===256)return;let n=!1;!n&&t[Eh].inlineEffectRunner?.flush(),uL(t);let c=null,u=null;!n&&Gue(e)&&(u=kue(t),c=UG(u));try{F8(t),Kle(e.bindingStartIndex),i!==null&&RW(e,t,i,2,r);let p=(s&3)===3;if(!n)if(p){let w=e.preOrderCheckHooks;w!==null&&FT(t,w,null)}else{let w=e.preOrderHooks;w!==null&&kT(t,w,0,null),QO(t,0)}if(Hue(t),WW(t,0),e.contentQueries!==null&&NW(e,t),!n)if(p){let w=e.contentCheckHooks;w!==null&&FT(t,w)}else{let w=e.contentHooks;w!==null&&kT(t,w,1),QO(t,1)}aue(e,t);let f=e.components;f!==null&&YW(t,f,0);let x=e.viewQuery;if(x!==null&&C3(2,x,r),!n)if(p){let w=e.viewCheckHooks;w!==null&&FT(t,w)}else{let w=e.viewHooks;w!==null&&kT(t,w,2),QO(t,2)}if(e.firstUpdatePass===!0&&(e.firstUpdatePass=!1),t[ZO]){for(let w of t[ZO])w();t[ZO]=null}n||(t[$r]&=-73)}catch(p){throw Db(t),p}finally{u!==null&&(jG(u,c),Bue(u)),hL()}}function Gue(e){return e.type!==2}function WW(e,t){for(let i=dW(e);i!==null;i=pW(i))for(let r=ic;r<i.length;r++){let s=i[r];qW(s,t)}}function Hue(e){for(let t=dW(e);t!==null;t=pW(t)){if(!(t[$r]&rL.HasTransplantedViews))continue;let i=t[P0];for(let r=0;r<i.length;r++){let s=i[r],n=s[Sa];Vle(s)}}}function Wue(e,t,i){let r=If(t,e);qW(r,i)}function qW(e,t){sL(e)&&D3(e,t)}function D3(e,t){let r=e[Tn],s=e[$r],n=e[zg],c=!!(t===0&&s&16);if(c||=!!(s&64&&t===0),c||=!!(s&1024),c||=!!(n?.dirty&&DO(n)),n&&(n.dirty=!1),e[$r]&=-9217,c)Vue(r,e,r.template,e[Eu]);else if(s&8192){WW(e,1);let u=r.components;u!==null&&YW(e,u,1)}}function YW(e,t,i){for(let r=0;r<t.length;r++)Wue(e,t[r],i)}function IL(e){for(e[Eh].changeDetectionScheduler?.notify();e;){e[$r]|=64;let t=Ib(e);if(Ple(e)&&!t)return e;e=t}return null}var Ng=class{get rootNodes(){let t=this._lView,i=t[Tn];return $T(i,t,i.firstChild,[])}constructor(t,i,r=!0){this._lView=t,this._cdRefInjectingView=i,this.notifyErrorHandler=r,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Eu]}set context(t){this._lView[Eu]=t}get destroyed(){return(this._lView[$r]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let t=this._lView[Sa];if(Vd(t)){let i=t[WT],r=i?i.indexOf(this):-1;r>-1&&(M3(t,r),GT(i,r))}this._attachedToViewContainer=!1}bW(this._lView[Tn],this._lView)}onDestroy(t){k8(this._lView,t)}markForCheck(){IL(this._cdRefInjectingView||this._lView)}detach(){this._lView[$r]&=-129}reattach(){g3(this._lView),this._lView[$r]|=128}detectChanges(){this._lView[$r]|=1024,HW(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ui(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,_W(this._lView[Tn],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Ui(902,!1);this._appRef=t,g3(this._lView)}},Bg=(()=>{let t=class t{};t.__NG_ELEMENT_ID__=Xue;let e=t;return e})(),que=Bg,Yue=class extends que{constructor(t,i,r){super(),this._declarationLView=t,this._declarationTContainer=i,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,i){return this.createEmbeddedViewImpl(t,i)}createEmbeddedViewImpl(t,i,r){let s=Lue(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:i,dehydratedView:r});return new Ng(s)}};function Xue(){return xA(nc(),vs())}function xA(e,t){return e.type&4?new Yue(t,e,N0(e,t)):null}var z8e=new RegExp(`^(\\d+)*(${Oce}|${Rce})*(.*)`);var $ue=()=>null;function jH(e,t){return $ue(e,t)}var Rb=class{},I3=class{},ZT=class{};function Zue(e){let t=Error(`No component factory found for ${ul(e)}.`);return t[Que]=e,t}var Que="ngComponent";var P3=class{resolveComponentFactory(t){throw Zue(t)}},U0=(()=>{let t=class t{};t.NULL=new P3;let e=t;return e})(),Ug=class{},bA=(()=>{let t=class t{constructor(){this.destroyNode=null}};t.__NG_ELEMENT_ID__=()=>Kue();let e=t;return e})();function Kue(){let e=vs(),t=nc(),i=If(t.index,e);return(Rg(i)?i:e)[Go]}var Jue=(()=>{let t=class t{};t.\u0275prov=hr({token:t,providedIn:"root",factory:()=>null});let e=t;return e})(),i3={};var VH=new Set;function jb(e){VH.has(e)||(VH.add(e),performance?.mark?.("mark_feature_usage",{detail:{feature:e}}))}function GH(...e){}function ehe(){let e=typeof bb.requestAnimationFrame=="function",t=bb[e?"requestAnimationFrame":"setTimeout"],i=bb[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&t&&i){let r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r);let s=i[Zone.__symbol__("OriginalDelegate")];s&&(i=s)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:i}}var Ys=class e{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Fc(!1),this.onMicrotaskEmpty=new Fc(!1),this.onStable=new Fc(!1),this.onError=new Fc(!1),typeof Zone>"u")throw new Ui(908,!1);Zone.assertZonePatched();let s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!r&&i,s.shouldCoalesceRunChangeDetection=r,s.lastRequestAnimationFrameId=-1,s.nativeRequestAnimationFrame=ehe().nativeRequestAnimationFrame,rhe(s)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!e.isInAngularZone())throw new Ui(909,!1)}static assertNotInAngularZone(){if(e.isInAngularZone())throw new Ui(909,!1)}run(t,i,r){return this._inner.run(t,i,r)}runTask(t,i,r,s){let n=this._inner,c=n.scheduleEventTask("NgZoneEvent: "+s,t,the,GH,GH);try{return n.runTask(c,i,r)}finally{n.cancelTask(c)}}runGuarded(t,i,r){return this._inner.runGuarded(t,i,r)}runOutsideAngular(t){return this._outer.run(t)}},the={};function PL(e){if(e._nesting==0&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function ihe(e){e.isCheckStableRunning||e.lastRequestAnimationFrameId!==-1||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(bb,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,R3(e),e.isCheckStableRunning=!0,PL(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),R3(e))}function rhe(e){let t=()=>{ihe(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(i,r,s,n,c,u)=>{if(nhe(u))return i.invokeTask(s,n,c,u);try{return HH(e),i.invokeTask(s,n,c,u)}finally{(e.shouldCoalesceEventChangeDetection&&n.type==="eventTask"||e.shouldCoalesceRunChangeDetection)&&t(),WH(e)}},onInvoke:(i,r,s,n,c,u,p)=>{try{return HH(e),i.invoke(s,n,c,u,p)}finally{e.shouldCoalesceRunChangeDetection&&t(),WH(e)}},onHasTask:(i,r,s,n)=>{i.hasTask(s,n),r===s&&(n.change=="microTask"?(e._hasPendingMicrotasks=n.microTask,R3(e),PL(e)):n.change=="macroTask"&&(e.hasPendingMacrotasks=n.macroTask))},onHandleError:(i,r,s,n)=>(i.handleError(s,n),e.runOutsideAngular(()=>e.onError.emit(n)),!1)})}function R3(e){e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&e.lastRequestAnimationFrameId!==-1?e.hasPendingMicrotasks=!0:e.hasPendingMicrotasks=!1}function HH(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function WH(e){e._nesting--,PL(e)}function nhe(e){return!Array.isArray(e)||e.length!==1?!1:e[0].data?.__ignore_ng_zone__===!0}var XW=(()=>{let t=class t{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let r=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let s of r)s()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};t.\u0275prov=hr({token:t,providedIn:"root",factory:()=>new t});let e=t;return e})();function QT(e,t,i){let r=i?e.styles:null,s=i?e.classes:null,n=0;if(t!==null)for(let c=0;c<t.length;c++){let u=t[c];if(typeof u=="number")n=u;else if(n==1)s=vH(s,u);else if(n==2){let p=u,f=t[++c];r=vH(r,p+": "+f+";")}}i?e.styles=r:e.stylesWithoutHost=r,i?e.classes=s:e.classesWithoutHost=s}var KT=class extends U0{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){let i=Lg(t);return new Ob(i,this.ngModule)}};function qH(e){let t=[];for(let i in e){if(!e.hasOwnProperty(i))continue;let r=e[i];r!==void 0&&t.push({propName:Array.isArray(r)?r[0]:r,templateName:i})}return t}function she(e){let t=e.toLowerCase();return t==="svg"?zle:t==="math"?Fle:null}var O3=class{constructor(t,i){this.injector=t,this.parentInjector=i}get(t,i,r){r=oA(r);let s=this.injector.get(t,i3,r);return s!==i3||i===i3?s:this.parentInjector.get(t,i,r)}},Ob=class extends ZT{get inputs(){let t=this.componentDef,i=t.inputTransforms,r=qH(t.inputs);if(i!==null)for(let s of r)i.hasOwnProperty(s.propName)&&(s.transform=i[s.propName]);return r}get outputs(){return qH(this.componentDef.outputs)}constructor(t,i){super(),this.componentDef=t,this.ngModule=i,this.componentType=t.type,this.selector=ple(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!i}create(t,i,r,s){let n=ts(null);try{s=s||this.ngModule;let c=s instanceof Rl?s:s?.injector;c&&this.componentDef.getStandaloneInjector!==null&&(c=this.componentDef.getStandaloneInjector(c)||c);let u=c?new O3(t,c):t,p=u.get(Ug,null);if(p===null)throw new Ui(407,!1);let f=u.get(Jue,null),x=u.get(XW,null),w=u.get(Rb,null),E={rendererFactory:p,sanitizer:f,inlineEffectRunner:null,afterRenderEventManager:x,changeDetectionScheduler:w},A=p.createRenderer(null,this.componentDef),I=this.componentDef.selectors[0][0]||"div",P=r?uue(A,r,this.componentDef.encapsulation,u):vW(A,I,she(I)),O=512;this.componentDef.signals?O|=4096:this.componentDef.onPush||(O|=16);let k=null;P!==null&&(k=vL(P,u,!0));let U=TL(0,null,null,1,0,null,null,null,null,null,null),j=vA(null,U,null,O,null,null,E,A,u,null,k);uL(j);let V,$;try{let Y=this.componentDef,J,X=null;Y.findHostDirectiveDefs?(J=[],X=new Map,Y.findHostDirectiveDefs(Y,J,X),J.push(Y)):J=[Y];let ee=ohe(j,P),oe=ahe(ee,P,Y,J,j,E,A);$=z8(U,Tu),P&&uhe(A,Y,P,r),i!==void 0&&hhe($,this.ngContentSelectors,i),V=che(oe,Y,J,X,j,[dhe]),DL(U,j,null)}finally{hL()}return new L3(this.componentType,V,N0($,j),j,$)}finally{ts(n)}}},L3=class extends I3{constructor(t,i,r,s,n){super(),this.location=r,this._rootLView=s,this._tNode=n,this.previousInputValues=null,this.instance=i,this.hostView=this.changeDetectorRef=new Ng(s,void 0,!1),this.componentType=t}setInput(t,i){let r=this._tNode.inputs,s;if(r!==null&&(s=r[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),i))return;let n=this._rootLView;CL(n[Tn],n,s,t,i),this.previousInputValues.set(t,i);let c=If(this._tNode.index,n);IL(c)}}get injector(){return new Og(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}};function ohe(e,t){let i=e[Tn],r=Tu;return e[r]=t,B0(i,r,2,"#host",null)}function ahe(e,t,i,r,s,n,c){let u=s[Tn];lhe(r,e,t,c);let p=null;t!==null&&(p=vL(t,s[I0]));let f=n.rendererFactory.createRenderer(t,i),x=16;i.signals?x=4096:i.onPush&&(x=64);let w=vA(s,OW(i),null,x,s[e.index],e,n,f,null,null,p);return u.firstCreatePass&&A3(u,e,r.length-1),_A(s,w),s[e.index]=w}function lhe(e,t,i,r){for(let s of e)t.mergedAttrs=J3(t.mergedAttrs,s.hostAttrs);t.mergedAttrs!==null&&(QT(t,t.mergedAttrs,!0),i!==null&&CW(r,i,t))}function che(e,t,i,r,s,n){let c=nc(),u=s[Tn],p=Au(c,s);zW(u,s,c,i,null,r);for(let x=0;x<i.length;x++){let w=c.directiveStart+x,E=O0(s,u,w,c);Cf(E,s)}FW(u,s,c),p&&Cf(p,s);let f=O0(s,u,c.directiveStart+c.componentOffset,c);if(e[Eu]=s[Eu]=f,n!==null)for(let x of n)x(f,t);return SL(u,c,s),f}function uhe(e,t,i,r){if(r)u3(e,i,["ng-version","17.3.12"]);else{let{attrs:s,classes:n}=fle(t.selectors[0]);s&&u3(e,i,s),n&&n.length>0&&AW(e,i,n.join(" "))}}function hhe(e,t,i){let r=e.projection=[];for(let s=0;s<t.length;s++){let n=i[s];r.push(n!=null?Array.from(n):null)}}function dhe(){let e=nc();mA(vs()[Tn],e)}var Gd=(()=>{let t=class t{};t.__NG_ELEMENT_ID__=phe;let e=t;return e})();function phe(){let e=nc();return ZW(e,vs())}var fhe=Gd,$W=class extends fhe{constructor(t,i,r){super(),this._lContainer=t,this._hostTNode=i,this._hostLView=r}get element(){return N0(this._hostTNode,this._hostLView)}get injector(){return new Og(this._hostTNode,this._hostLView)}get parentInjector(){let t=dL(this._hostTNode,this._hostLView);if(Q8(t)){let i=YT(t,this._hostLView),r=qT(t),s=i[Tn].data[r+8];return new Og(s,i)}else return new Og(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){let i=YH(this._lContainer);return i!==null&&i[t]||null}get length(){return this._lContainer.length-ic}createEmbeddedView(t,i,r){let s,n;typeof r=="number"?s=r:r!=null&&(s=r.index,n=r.injector);let c=jH(this._lContainer,t.ssrId),u=t.createEmbeddedViewImpl(i||{},n,c);return this.insertImpl(u,s,UH(this._hostTNode,c)),u}createComponent(t,i,r,s,n){let c=t&&!Ile(t),u;if(c)u=i;else{let I=i||{};u=I.index,r=I.injector,s=I.projectableNodes,n=I.environmentInjector||I.ngModuleRef}let p=c?t:new Ob(Lg(t)),f=r||this.parentInjector;if(!n&&p.ngModule==null){let P=(c?f:this.parentInjector).get(Rl,null);P&&(n=P)}let x=Lg(p.componentType??{}),w=jH(this._lContainer,x?.id??null),E=w?.firstChild??null,A=p.create(f,s,E,n);return this.insertImpl(A.hostView,u,UH(this._hostTNode,w)),A}insert(t,i){return this.insertImpl(t,i,!0)}insertImpl(t,i,r){let s=t._lView;if(jle(s)){let u=this.indexOf(t);if(u!==-1)this.detach(u);else{let p=s[Sa],f=new $W(p,p[rc],p[Sa]);f.detach(f.indexOf(t))}}let n=this._adjustIndex(i),c=this._lContainer;return zue(c,s,n,r),t.attachToViewContainerRef(),p8(r3(c),n,t),t}move(t,i){return this.insert(t,i)}indexOf(t){let i=YH(this._lContainer);return i!==null?i.indexOf(t):-1}remove(t){let i=this._adjustIndex(t,-1),r=M3(this._lContainer,i);r&&(GT(r3(this._lContainer),i),bW(r[Tn],r))}detach(t){let i=this._adjustIndex(t,-1),r=M3(this._lContainer,i);return r&&GT(r3(this._lContainer),i)!=null?new Ng(r):null}_adjustIndex(t,i=0){return t??this.length+i}};function YH(e){return e[WT]}function r3(e){return e[WT]||(e[WT]=[])}function ZW(e,t){let i,r=t[e.index];return Vd(r)?i=r:(i=kW(r,t,null,e),t[e.index]=i,_A(t,i)),ghe(i,t,e,r),new $W(i,e,t)}function mhe(e,t){let i=e[Go],r=i.createComment(""),s=Au(t,e),n=bL(i,s);return XT(i,n,r,Jce(i,s),!1),r}var ghe=_he,yhe=()=>!1;function vhe(e,t,i){return yhe(e,t,i)}function _he(e,t,i,r){if(e[Fg])return;let s;i.type&8?s=Mh(r):s=mhe(t,i),e[Fg]=s}var z3=class e{constructor(t){this.queryList=t,this.matches=null}clone(){return new e(this.queryList)}setDirty(){this.queryList.setDirty()}},F3=class e{constructor(t=[]){this.queries=t}createEmbeddedView(t){let i=t.queries;if(i!==null){let r=t.contentQueries!==null?t.contentQueries[0]:i.length,s=[];for(let n=0;n<r;n++){let c=i.getByIndex(n),u=this.queries[c.indexInDeclarationView];s.push(u.clone())}return new e(s)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}finishViewCreation(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let i=0;i<this.queries.length;i++)RL(t,i).matches!==null&&this.queries[i].setDirty()}},JT=class{constructor(t,i,r=null){this.flags=i,this.read=r,typeof t=="string"?this.predicate=Ahe(t):this.predicate=t}},k3=class e{constructor(t=[]){this.queries=t}elementStart(t,i){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(t,i)}elementEnd(t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(t)}embeddedTView(t){let i=null;for(let r=0;r<this.length;r++){let s=i!==null?i.length:0,n=this.getByIndex(r).embeddedTView(t,s);n&&(n.indexInDeclarationView=r,i!==null?i.push(n):i=[n])}return i!==null?new e(i):null}template(t,i){for(let r=0;r<this.queries.length;r++)this.queries[r].template(t,i)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}},N3=class e{constructor(t,i=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=i}elementStart(t,i){this.isApplyingToNode(i)&&this.matchTNode(t,i)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,i){this.elementStart(t,i)}embeddedTView(t,i){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,i),new e(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let i=this._declarationNodeIndex,r=t.parent;for(;r!==null&&r.type&8&&r.index!==i;)r=r.parent;return i===(r!==null?r.index:-1)}return this._appliesToNextNode}matchTNode(t,i){let r=this.metadata.predicate;if(Array.isArray(r))for(let s=0;s<r.length;s++){let n=r[s];this.matchTNodeWithReadOption(t,i,xhe(i,n)),this.matchTNodeWithReadOption(t,i,NT(i,t,n,!1,!1))}else r===Bg?i.type&4&&this.matchTNodeWithReadOption(t,i,-1):this.matchTNodeWithReadOption(t,i,NT(i,t,r,!1,!1))}matchTNodeWithReadOption(t,i,r){if(r!==null){let s=this.metadata.read;if(s!==null)if(s===Pf||s===Gd||s===Bg&&i.type&4)this.addMatch(i.index,-2);else{let n=NT(i,t,s,!1,!1);n!==null&&this.addMatch(i.index,n)}else this.addMatch(i.index,r)}}addMatch(t,i){this.matches===null?this.matches=[t,i]:this.matches.push(t,i)}};function xhe(e,t){let i=e.localNames;if(i!==null){for(let r=0;r<i.length;r+=2)if(i[r]===t)return i[r+1]}return null}function bhe(e,t){return e.type&11?N0(e,t):e.type&4?xA(e,t):null}function whe(e,t,i,r){return i===-1?bhe(t,e):i===-2?She(e,t,r):O0(e,e[Tn],i,t)}function She(e,t,i){if(i===Pf)return N0(t,e);if(i===Bg)return xA(t,e);if(i===Gd)return ZW(t,e)}function QW(e,t,i,r){let s=t[kd].queries[r];if(s.matches===null){let n=e.data,c=i.matches,u=[];for(let p=0;c!==null&&p<c.length;p+=2){let f=c[p];if(f<0)u.push(null);else{let x=n[f];u.push(whe(t,x,c[p+1],i.metadata.read))}}s.matches=u}return s.matches}function B3(e,t,i,r){let s=e.queries.getByIndex(i),n=s.matches;if(n!==null){let c=QW(e,t,s,i);for(let u=0;u<n.length;u+=2){let p=n[u];if(p>0)r.push(c[u/2]);else{let f=n[u+1],x=t[-p];for(let w=ic;w<x.length;w++){let E=x[w];E[Nb]===E[Sa]&&B3(E[Tn],E,f,r)}if(x[P0]!==null){let w=x[P0];for(let E=0;E<w.length;E++){let A=w[E];B3(A[Tn],A,f,r)}}}}}return r}function Ehe(e,t){return e[kd].queries[t].queryList}function KW(e,t,i){let r=new w3((i&4)===4);return pue(e,t,r,r.destroy),(t[kd]??=new F3).queries.push(new z3(r))-1}function Mhe(e,t,i){let r=hl();return r.firstCreatePass&&(JW(r,new JT(e,t,i),-1),(t&2)===2&&(r.staticViewQueries=!0)),KW(r,vs(),t)}function The(e,t,i,r){let s=hl();if(s.firstCreatePass){let n=nc();JW(s,new JT(t,i,r),n.index),Che(s,e),(i&2)===2&&(s.staticContentQueries=!0)}return KW(s,vs(),i)}function Ahe(e){return e.split(",").map(t=>t.trim())}function JW(e,t,i){e.queries===null&&(e.queries=new k3),e.queries.track(new N3(t,i))}function Che(e,t){let i=e.contentQueries||(e.contentQueries=[]),r=i.length?i[i.length-1]:-1;t!==r&&i.push(e.queries.length-1,t)}function RL(e,t){return e.queries.getByIndex(t)}function Dhe(e,t){let i=e[Tn],r=RL(i,t);return r.crossesNgTemplate?B3(i,e,t,[]):QW(i,e,r,t)}var Df=class{},Lb=class{};var U3=class extends Df{constructor(t,i,r){super(),this._parent=i,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new KT(this);let s=w8(t);this._bootstrapComponents=yW(s.bootstrap),this._r3Injector=aW(t,i,[{provide:Df,useValue:this},{provide:U0,useValue:this.componentFactoryResolver},...r],ul(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){let t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}},j3=class extends Lb{constructor(t){super(),this.moduleType=t}create(t){return new U3(this.moduleType,t,[])}};var eA=class extends Df{constructor(t){super(),this.componentFactoryResolver=new KT(this),this.instance=null;let i=new Mb([...t.providers,{provide:Df,useValue:this},{provide:U0,useValue:this.componentFactoryResolver}],t.parent||iL(),t.debugName,new Set(["environment"]));this.injector=i,t.runEnvironmentInitializers&&i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}};function OL(e,t,i=null){return new eA({providers:e,parent:t,debugName:i,runEnvironmentInitializers:!0}).injector}var Xg=(()=>{let t=class t{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new wa(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let r=this.taskId++;return this.pendingTasks.add(r),r}remove(r){this.pendingTasks.delete(r),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function e9(e){return Phe(e)?Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e:!1}function Ihe(e,t){if(Array.isArray(e))for(let i=0;i<e.length;i++)t(e[i]);else{let i=e[Symbol.iterator](),r;for(;!(r=i.next()).done;)t(r.value)}}function Phe(e){return e!==null&&(typeof e=="function"||typeof e=="object")}function LL(e,t,i){let r=e[t];return Object.is(r,i)?!1:(e[t]=i,!0)}function Rhe(e){return(e.flags&32)===32}function Ohe(e,t,i,r,s,n,c,u,p){let f=t.consts,x=B0(t,e,4,c||null,R0(f,u));AL(t,i,x,R0(f,p)),mA(t,x);let w=x.tView=TL(2,x,r,s,n,t.directiveRegistry,t.pipeRegistry,null,t.schemas,f,null);return t.queries!==null&&(t.queries.template(t,x),w.queries=t.queries.embeddedTView(x)),x}function sc(e,t,i,r,s,n,c,u){let p=vs(),f=hl(),x=e+Tu,w=f.firstCreatePass?Ohe(x,f,p,t,i,r,s,n,c):f.data[x];Wg(w,!1);let E=Lhe(f,p,w,e);pA()&&gA(f,p,E,w),Cf(E,p);let A=kW(E,p,E,w);return p[x]=A,_A(p,A),vhe(A,w,p),uA(w)&&EL(f,p,w),c!=null&&ML(p,w,u),sc}var Lhe=zhe;function zhe(e,t,i,r){return fA(!0),t[Go].createComment("")}function t9(e,t,i,r){return LL(e,j8(),i)?t+l8(i)+r:Yg}function LT(e,t){return e<<17|t<<2}function jg(e){return e>>17&32767}function Fhe(e){return(e&2)==2}function khe(e,t){return e&131071|t<<17}function V3(e){return e|2}function L0(e){return(e&131068)>>2}function n3(e,t){return e&-131069|t<<2}function Nhe(e){return(e&1)===1}function G3(e){return e|1}function Bhe(e,t,i,r,s,n){let c=n?t.classBindings:t.styleBindings,u=jg(c),p=L0(c);e[r]=i;let f=!1,x;if(Array.isArray(i)){let w=i;x=w[1],(x===null||kb(w,x)>0)&&(f=!0)}else x=i;if(s)if(p!==0){let E=jg(e[u+1]);e[r+1]=LT(E,u),E!==0&&(e[E+1]=n3(e[E+1],r)),e[u+1]=khe(e[u+1],r)}else e[r+1]=LT(u,0),u!==0&&(e[u+1]=n3(e[u+1],r)),u=r;else e[r+1]=LT(p,0),u===0?u=r:e[p+1]=n3(e[p+1],r),p=r;f&&(e[r+1]=V3(e[r+1])),XH(e,x,r,!0),XH(e,x,r,!1),Uhe(t,x,e,r,n),c=LT(u,p),n?t.classBindings=c:t.styleBindings=c}function Uhe(e,t,i,r,s){let n=s?e.residualClasses:e.residualStyles;n!=null&&typeof t=="string"&&kb(n,t)>=0&&(i[r+1]=G3(i[r+1]))}function XH(e,t,i,r){let s=e[i+1],n=t===null,c=r?jg(s):L0(s),u=!1;for(;c!==0&&(u===!1||n);){let p=e[c],f=e[c+1];jhe(p,t)&&(u=!0,e[c+1]=r?G3(f):V3(f)),c=r?jg(f):L0(f)}u&&(e[i+1]=r?V3(s):G3(s))}function jhe(e,t){return e===null||t==null||(Array.isArray(e)?e[1]:e)===t?!0:Array.isArray(e)&&typeof t=="string"?kb(e,t)>=0:!1}function sa(e,t,i){let r=vs(),s=j8();if(LL(r,s,t)){let n=hl(),c=X8();LW(n,c,r,e,t,r[Go],i,!1)}return sa}function $H(e,t,i,r,s){let n=t.inputs,c=s?"class":"style";CL(e,i,n[c],c,r)}function Vb(e,t,i){return i9(e,t,i,!1),Vb}function zL(e,t){return i9(e,t,null,!0),zL}function i9(e,t,i,r){let s=vs(),n=hl(),c=Jle(2);if(n.firstUpdatePass&&Ghe(n,e,c,r),t!==Yg&&LL(s,c,t)){let u=n.data[k0()];Xhe(n,u,s,s[Go],e,s[c+1]=$he(t,i),r,c)}}function Vhe(e,t){return t>=e.expandoStartIndex}function Ghe(e,t,i,r){let s=e.data;if(s[i+1]===null){let n=s[k0()],c=Vhe(e,i);Zhe(n,r)&&t===null&&!c&&(t=!1),t=Hhe(s,n,t,r),Bhe(s,n,t,i,c,r)}}function Hhe(e,t,i,r){let s=rce(e),n=r?t.residualClasses:t.residualStyles;if(s===null)(r?t.classBindings:t.styleBindings)===0&&(i=s3(null,e,t,i,r),i=zb(i,t.attrs,r),n=null);else{let c=t.directiveStylingLast;if(c===-1||e[c]!==s)if(i=s3(s,e,t,i,r),n===null){let p=Whe(e,t,r);p!==void 0&&Array.isArray(p)&&(p=s3(null,e,t,p[1],r),p=zb(p,t.attrs,r),qhe(e,t,r,p))}else n=Yhe(e,t,r)}return n!==void 0&&(r?t.residualClasses=n:t.residualStyles=n),i}function Whe(e,t,i){let r=i?t.classBindings:t.styleBindings;if(L0(r)!==0)return e[jg(r)]}function qhe(e,t,i,r){let s=i?t.classBindings:t.styleBindings;e[jg(s)]=r}function Yhe(e,t,i){let r,s=t.directiveEnd;for(let n=1+t.directiveStylingLast;n<s;n++){let c=e[n].hostAttrs;r=zb(r,c,i)}return zb(r,t.attrs,i)}function s3(e,t,i,r,s){let n=null,c=i.directiveEnd,u=i.directiveStylingLast;for(u===-1?u=i.directiveStart:u++;u<c&&(n=t[u],r=zb(r,n.hostAttrs,s),n!==e);)u++;return e!==null&&(i.directiveStylingLast=u),r}function zb(e,t,i){let r=i?1:2,s=-1;if(t!==null)for(let n=0;n<t.length;n++){let c=t[n];typeof c=="number"?s=c:s===r&&(Array.isArray(e)||(e=e===void 0?[]:["",e]),Jae(e,c,i?!0:t[++n]))}return e===void 0?null:e}function Xhe(e,t,i,r,s,n,c,u){if(!(t.type&3))return;let p=e.data,f=p[u+1],x=Nhe(f)?ZH(p,t,i,s,L0(f),c):void 0;if(!tA(x)){tA(n)||Fhe(f)&&(n=ZH(p,null,i,s,u,c));let w=L8(k0(),i);sue(r,c,w,s,n)}}function ZH(e,t,i,r,s,n){let c=t===null,u;for(;s>0;){let p=e[s],f=Array.isArray(p),x=f?p[1]:p,w=x===null,E=i[s+1];E===Yg&&(E=w?wu:void 0);let A=w?XO(E,r):x===r?E:void 0;if(f&&!tA(A)&&(A=XO(p,r)),tA(A)&&(u=A,c))return u;let I=e[s+1];s=c?jg(I):L0(I)}if(t!==null){let p=n?t.residualClasses:t.residualStyles;p!=null&&(u=XO(p,r))}return u}function tA(e){return e!==void 0}function $he(e,t){return e==null||e===""||(typeof t=="string"?e=e+t:typeof e=="object"&&(e=ul(_L(e)))),e}function Zhe(e,t){return(e.flags&(t?8:16))!==0}function Qhe(e,t,i,r,s,n){let c=t.consts,u=R0(c,s),p=B0(t,e,2,r,u);return AL(t,i,p,R0(c,n)),p.attrs!==null&&QT(p,p.attrs,!1),p.mergedAttrs!==null&&QT(p,p.mergedAttrs,!0),t.queries!==null&&t.queries.elementStart(t,p),p}function Pn(e,t,i,r){let s=vs(),n=hl(),c=Tu+e,u=s[Go],p=n.firstCreatePass?Qhe(c,n,s,t,i,r):n.data[c],f=Khe(n,s,p,u,t,e);s[c]=f;let x=uA(p);return Wg(p,!0),CW(u,f,p),!Rhe(p)&&pA()&&gA(n,s,f,p),Wle()===0&&Cf(f,s),qle(),x&&(EL(n,s,p),SL(n,p,s)),r!==null&&ML(s,p),Pn}function kn(){let e=nc();aL()?lL():(e=e.parent,Wg(e,!1));let t=e;Xle(t)&&$le(),Yle();let i=hl();return i.firstCreatePass&&(mA(i,e),nL(e)&&i.queries.elementEnd(e)),t.classesWithoutHost!=null&&uce(t)&&$H(i,t,vs(),t.classesWithoutHost,!0),t.stylesWithoutHost!=null&&hce(t)&&$H(i,t,vs(),t.stylesWithoutHost,!1),kn}function Os(e,t,i,r){return Pn(e,t,i,r),kn(),Os}var Khe=(e,t,i,r,s,n)=>(fA(!0),vW(r,s,oce()));function Jhe(e,t,i,r,s){let n=t.consts,c=R0(n,r),u=B0(t,e,8,"ng-container",c);c!==null&&QT(u,c,!0);let p=R0(n,s);return AL(t,i,u,p),t.queries!==null&&t.queries.elementStart(t,u),u}function wA(e,t,i){let r=vs(),s=hl(),n=e+Tu,c=s.firstCreatePass?Jhe(n,s,r,t,i):s.data[n];Wg(c,!0);let u=ede(s,r,c,e);return r[n]=u,pA()&&gA(s,r,u,c),Cf(u,r),uA(c)&&(EL(s,r,c),SL(s,c,r)),i!=null&&ML(r,c),wA}function SA(){let e=nc(),t=hl();return aL()?lL():(e=e.parent,Wg(e,!1)),t.firstCreatePass&&(mA(t,e),nL(e)&&t.queries.elementEnd(e)),SA}function EA(e,t,i){return wA(e,t,i),SA(),EA}var ede=(e,t,i,r)=>(fA(!0),Gce(t[Go],""));function MA(){return vs()}var iA="en-US";var tde=iA;function ide(e){typeof e=="string"&&(tde=e.toLowerCase().replace(/_/g,"-"))}function oc(e,t,i,r){let s=vs(),n=hl(),c=nc();return nde(n,s,s[Go],c,e,t,r),oc}function rde(e,t,i,r){let s=e.cleanup;if(s!=null)for(let n=0;n<s.length-1;n+=2){let c=s[n];if(c===i&&s[n+1]===r){let u=t[Ab],p=s[n+2];return u.length>p?u[p]:null}typeof c=="string"&&(n+=2)}return null}function nde(e,t,i,r,s,n,c){let u=uA(r),f=e.firstCreatePass&&UW(e),x=t[Eu],w=BW(t),E=!0;if(r.type&3||c){let P=Au(r,t),O=c?c(P):P,k=w.length,U=c?V=>c(Mh(V[r.index])):r.index,j=null;if(!c&&u&&(j=rde(e,t,s,r.index)),j!==null){let V=j.__ngLastListenerFn__||j;V.__ngNextListenerFn__=n,j.__ngLastListenerFn__=n,E=!1}else{n=KH(r,t,x,n,!1);let V=i.listen(O,s,n);w.push(n,V),f&&f.push(s,U,k,k+1)}}else n=KH(r,t,x,n,!1);let A=r.outputs,I;if(E&&A!==null&&(I=A[s])){let P=I.length;if(P)for(let O=0;O<P;O+=2){let k=I[O],U=I[O+1],$=t[k][U].subscribe(n),Y=w.length;w.push(n,$),f&&f.push(s,r.index,Y,-(Y+1))}}}function QH(e,t,i,r){let s=ts(null);try{return bh(6,t,i),i(r)!==!1}catch(n){return jW(e,n),!1}finally{bh(7,t,i),ts(s)}}function KH(e,t,i,r,s){return function n(c){if(c===Function)return r;let u=e.componentOffset>-1?If(e.index,t):t;IL(u);let p=QH(t,i,r,c),f=n.__ngNextListenerFn__;for(;f;)p=QH(t,i,f,c)&&p,f=f.__ngNextListenerFn__;return s&&p===!1&&c.preventDefault(),p}}function Of(e=1){return sce(e)}function sde(e,t){let i=null,r=lle(e);for(let s=0;s<t.length;s++){let n=t[s];if(n==="*"){i=s;continue}if(r===null?v8(e,n,!0):hle(r,n))return s}return i}function TA(e){let t=vs()[Mu][rc];if(!t.projection){let i=e?e.length:1,r=t.projection=Qae(i,null),s=r.slice(),n=t.child;for(;n!==null;){let c=e?sde(n,e):0;c!==null&&(s[c]?s[c].projectionNext=n:r[c]=n,s[c]=n),n=n.next}}}function AA(e,t=0,i){let r=vs(),s=hl(),n=B0(s,Tu+e,16,null,i||null);n.projection===null&&(n.projection=t),lL(),(!r[Tb]||B8())&&(n.flags&32)!==32&&rue(s,r,n)}function FL(e,t,i){return r9(e,"",t,"",i),FL}function r9(e,t,i,r,s){let n=vs(),c=t9(n,t,i,r);if(c!==Yg){let u=hl(),p=X8();LW(u,p,n,e,c,n[Go],s,!1)}return r9}function kL(e,t,i,r){The(e,t,i,r)}function n9(e,t,i){Mhe(e,t,i)}function Gb(e){let t=vs(),i=hl(),r=V8();cL(r+1);let s=RL(i,r);if(e.dirty&&Ule(t)===((s.metadata.flags&2)===2)){if(s.matches===null)e.reset([]);else{let n=Dhe(t,r);e.reset(n,Ece),e.notifyOnChanges()}return!0}return!1}function Hb(){return Ehe(vs(),V8())}function NL(e){let t=Qle();return Ble(t,Tu+e)}function ac(e,t=""){let i=vs(),r=hl(),s=e+Tu,n=r.firstCreatePass?B0(r,s,1,t,null):r.data[s],c=ode(r,i,n,t,e);i[s]=c,pA()&&gA(r,i,c,n),Wg(n,!1)}var ode=(e,t,i,r,s)=>(fA(!0),jce(t[Go],r));function Wb(e){return Hd("",e,""),Wb}function Hd(e,t,i){let r=vs(),s=t9(r,e,t,i);return s!==Yg&&Iue(r,k0(),s),Hd}var ade=(()=>{let t=class t{constructor(r){this._injector=r,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(r){if(!r.standalone)return null;if(!this.cachedInjectors.has(r)){let s=M8(!1,r.type),n=s.length>0?OL([s],this._injector,`Standalone[${r.type.name}]`):null;this.cachedInjectors.set(r,n)}return this.cachedInjectors.get(r)}ngOnDestroy(){try{for(let r of this.cachedInjectors.values())r!==null&&r.destroy()}finally{this.cachedInjectors.clear()}}};t.\u0275prov=hr({token:t,providedIn:"environment",factory:()=>new t(Er(Rl))});let e=t;return e})();function bo(e){jb("NgStandalone"),e.getStandaloneInjector=t=>t.get(ade).getOrCreateStandaloneInjector(e)}function BL(e,t){return xA(e,t)}var CA=(()=>{let t=class t{log(r){console.log(r)}warn(r){console.warn(r)}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"platform"});let e=t;return e})();var s9=new an("");function qb(e){return!!e&&typeof e.then=="function"}function o9(e){return!!e&&typeof e.subscribe=="function"}var a9=new an(""),l9=(()=>{let t=class t{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,s)=>{this.resolve=r,this.reject=s}),this.appInits=tr(a9,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let r=[];for(let n of this.appInits){let c=n();if(qb(c))r.push(c);else if(o9(c)){let u=new Promise((p,f)=>{c.subscribe({complete:p,error:f})});r.push(u)}}let s=()=>{this.done=!0,this.resolve()};Promise.all(r).then(()=>{s()}).catch(n=>{this.reject(n)}),r.length===0&&s(),this.initialized=!0}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})(),DA=new an("");function lde(){GG(()=>{throw new Ui(600,!1)})}function cde(e){return e.isBoundToModule}function ude(e,t,i){try{let r=i();return qb(r)?r.catch(s=>{throw t.runOutsideAngular(()=>e.handleError(s)),s}):r}catch(r){throw t.runOutsideAngular(()=>e.handleError(r)),r}}var j0=(()=>{let t=class t{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=tr(lW),this.afterRenderEffectManager=tr(XW),this.externalTestViews=new Set,this.beforeRender=new cl,this.afterTick=new cl,this.componentTypes=[],this.components=[],this.isStable=tr(Xg).hasPendingTasks.pipe(Ti(r=>!r)),this._injector=tr(Rl)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(r,s){let n=r instanceof ZT;if(!this._injector.get(l9).done){let A=!n&&b8(r),I=!1;throw new Ui(405,I)}let u;n?u=r:u=this._injector.get(U0).resolveComponentFactory(r),this.componentTypes.push(u.componentType);let p=cde(u)?void 0:this._injector.get(Df),f=s||u.selector,x=u.create(qg.NULL,[],f,p),w=x.location.nativeElement,E=x.injector.get(s9,null);return E?.registerApplication(w),x.onDestroy(()=>{this.detachView(x.hostView),o3(this.components,x),E?.unregisterApplication(w)}),this._loadComponent(x),x}tick(){this._tick(!0)}_tick(r){if(this._runningTick)throw new Ui(101,!1);let s=ts(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(r)}catch(n){this.internalErrorHandler(n)}finally{this.afterTick.next(),this._runningTick=!1,ts(s)}}detectChangesInAttachedViews(r){let s=0,n=this.afterRenderEffectManager;for(;;){if(s===GW)throw new Ui(103,!1);if(r){let c=s===0;this.beforeRender.next(c);for(let{_lView:u,notifyErrorHandler:p}of this._views)hde(u,c,p)}if(s++,n.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:c})=>H3(c))&&(n.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:c})=>H3(c))))break}}attachView(r){let s=r;this._views.push(s),s.attachToAppRef(this)}detachView(r){let s=r;o3(this._views,s),s.detachFromAppRef()}_loadComponent(r){this.attachView(r.hostView),this.tick(),this.components.push(r);let s=this._injector.get(DA,[]);[...this._bootstrapListeners,...s].forEach(n=>n(r))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(r=>r()),this._views.slice().forEach(r=>r.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(r){return this._destroyListeners.push(r),()=>o3(this._destroyListeners,r)}destroy(){if(this._destroyed)throw new Ui(406,!1);let r=this._injector;r.destroy&&!r.destroyed&&r.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function o3(e,t){let i=e.indexOf(t);i>-1&&e.splice(i,1)}function hde(e,t,i){!t&&!H3(e)||dde(e,i,t)}function H3(e){return oL(e)}function dde(e,t,i){let r;i?(r=0,e[$r]|=1024):e[$r]&64?r=0:r=1,HW(e,t,r)}var W3=class{constructor(t,i){this.ngModuleFactory=t,this.componentFactories=i}},UL=(()=>{let t=class t{compileModuleSync(r){return new j3(r)}compileModuleAsync(r){return Promise.resolve(this.compileModuleSync(r))}compileModuleAndAllComponentsSync(r){let s=this.compileModuleSync(r),n=w8(r),c=yW(n.declarations).reduce((u,p)=>{let f=Lg(p);return f&&u.push(new Ob(f)),u},[]);return new W3(s,c)}compileModuleAndAllComponentsAsync(r){return Promise.resolve(this.compileModuleAndAllComponentsSync(r))}clearCache(){}clearCacheFor(r){}getModuleId(r){}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var pde=(()=>{let t=class t{constructor(){this.zone=tr(Ys),this.applicationRef=tr(j0)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function fde(e){return[{provide:Ys,useFactory:e},{provide:D0,multi:!0,useFactory:()=>{let t=tr(pde,{optional:!0});return()=>t.initialize()}},{provide:D0,multi:!0,useFactory:()=>{let t=tr(vde);return()=>{t.initialize()}}},{provide:lW,useFactory:mde}]}function mde(){let e=tr(Ys),t=tr(Nd);return i=>e.runOutsideAngular(()=>t.handleError(i))}function gde(e){let t=fde(()=>new Ys(yde(e)));return z0([[],t])}function yde(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}var vde=(()=>{let t=class t{constructor(){this.subscription=new jo,this.initialized=!1,this.zone=tr(Ys),this.pendingTasks=tr(Xg)}initialize(){if(this.initialized)return;this.initialized=!0;let r=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(r=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Ys.assertNotInAngularZone(),queueMicrotask(()=>{r!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(r),r=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Ys.assertInAngularZone(),r??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function _de(){return typeof $localize<"u"&&$localize.locale||iA}var jL=new an("",{providedIn:"root",factory:()=>tr(jL,Mn.Optional|Mn.SkipSelf)||_de()});var c9=new an("");var UT=null;function xde(e=[],t){return qg.create({name:t,providers:[{provide:aA,useValue:"platform"},{provide:c9,useValue:new Set([()=>UT=null])},...e]})}function bde(e=[]){if(UT)return UT;let t=xde(e);return UT=t,lde(),wde(t),t}function wde(e){e.get(mL,null)?.forEach(i=>i())}var Yb=(()=>{let t=class t{};t.__NG_ELEMENT_ID__=Sde;let e=t;return e})();function Sde(e){return Ede(nc(),vs(),(e&16)===16)}function Ede(e,t,i){if(cA(e)&&!i){let r=If(e.index,t);return new Ng(r,r)}else if(e.type&47){let r=t[Mu];return new Ng(r,t)}return null}var q3=class{constructor(){}supports(t){return e9(t)}create(t){return new Y3(t)}},Mde=(e,t)=>t,Y3=class{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Mde}forEachItem(t){let i;for(i=this._itHead;i!==null;i=i._next)t(i)}forEachOperation(t){let i=this._itHead,r=this._removalsHead,s=0,n=null;for(;i||r;){let c=!r||i&&i.currentIndex<JH(r,s,n)?i:r,u=JH(c,s,n),p=c.currentIndex;if(c===r)s--,r=r._nextRemoved;else if(i=i._next,c.previousIndex==null)s++;else{n||(n=[]);let f=u-s,x=p-s;if(f!=x){for(let E=0;E<f;E++){let A=E<n.length?n[E]:n[E]=0,I=A+E;x<=I&&I<f&&(n[E]=A+1)}let w=c.previousIndex;n[w]=x-f}}u!==p&&t(c,u,p)}}forEachPreviousItem(t){let i;for(i=this._previousItHead;i!==null;i=i._nextPrevious)t(i)}forEachAddedItem(t){let i;for(i=this._additionsHead;i!==null;i=i._nextAdded)t(i)}forEachMovedItem(t){let i;for(i=this._movesHead;i!==null;i=i._nextMoved)t(i)}forEachRemovedItem(t){let i;for(i=this._removalsHead;i!==null;i=i._nextRemoved)t(i)}forEachIdentityChange(t){let i;for(i=this._identityChangesHead;i!==null;i=i._nextIdentityChange)t(i)}diff(t){if(t==null&&(t=[]),!e9(t))throw new Ui(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let i=this._itHead,r=!1,s,n,c;if(Array.isArray(t)){this.length=t.length;for(let u=0;u<this.length;u++)n=t[u],c=this._trackByFn(u,n),i===null||!Object.is(i.trackById,c)?(i=this._mismatch(i,n,c,u),r=!0):(r&&(i=this._verifyReinsertion(i,n,c,u)),Object.is(i.item,n)||this._addIdentityChange(i,n)),i=i._next}else s=0,Ihe(t,u=>{c=this._trackByFn(s,u),i===null||!Object.is(i.trackById,c)?(i=this._mismatch(i,u,c,s),r=!0):(r&&(i=this._verifyReinsertion(i,u,c,s)),Object.is(i.item,u)||this._addIdentityChange(i,u)),i=i._next,s++}),this.length=s;return this._truncate(i),this.collection=t,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;t!==null;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;t!==null;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;t!==null;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,i,r,s){let n;return t===null?n=this._itTail:(n=t._prev,this._remove(t)),t=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null),t!==null?(Object.is(t.item,i)||this._addIdentityChange(t,i),this._reinsertAfter(t,n,s)):(t=this._linkedRecords===null?null:this._linkedRecords.get(r,s),t!==null?(Object.is(t.item,i)||this._addIdentityChange(t,i),this._moveAfter(t,n,s)):t=this._addAfter(new X3(i,r),n,s)),t}_verifyReinsertion(t,i,r,s){let n=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null);return n!==null?t=this._reinsertAfter(n,t._prev,s):t.currentIndex!=s&&(t.currentIndex=s,this._addToMoves(t,s)),t}_truncate(t){for(;t!==null;){let i=t._next;this._addToRemovals(this._unlink(t)),t=i}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,i,r){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(t);let s=t._prevRemoved,n=t._nextRemoved;return s===null?this._removalsHead=n:s._nextRemoved=n,n===null?this._removalsTail=s:n._prevRemoved=s,this._insertAfter(t,i,r),this._addToMoves(t,r),t}_moveAfter(t,i,r){return this._unlink(t),this._insertAfter(t,i,r),this._addToMoves(t,r),t}_addAfter(t,i,r){return this._insertAfter(t,i,r),this._additionsTail===null?this._additionsTail=this._additionsHead=t:this._additionsTail=this._additionsTail._nextAdded=t,t}_insertAfter(t,i,r){let s=i===null?this._itHead:i._next;return t._next=s,t._prev=i,s===null?this._itTail=t:s._prev=t,i===null?this._itHead=t:i._next=t,this._linkedRecords===null&&(this._linkedRecords=new rA),this._linkedRecords.put(t),t.currentIndex=r,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){this._linkedRecords!==null&&this._linkedRecords.remove(t);let i=t._prev,r=t._next;return i===null?this._itHead=r:i._next=r,r===null?this._itTail=i:r._prev=i,t}_addToMoves(t,i){return t.previousIndex===i||(this._movesTail===null?this._movesTail=this._movesHead=t:this._movesTail=this._movesTail._nextMoved=t),t}_addToRemovals(t){return this._unlinkedRecords===null&&(this._unlinkedRecords=new rA),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,i){return t.item=i,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=t:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=t,t}},X3=class{constructor(t,i){this.item=t,this.trackById=i,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},$3=class{constructor(){this._head=null,this._tail=null}add(t){this._head===null?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,i){let r;for(r=this._head;r!==null;r=r._nextDup)if((i===null||i<=r.currentIndex)&&Object.is(r.trackById,t))return r;return null}remove(t){let i=t._prevDup,r=t._nextDup;return i===null?this._head=r:i._nextDup=r,r===null?this._tail=i:r._prevDup=i,this._head===null}},rA=class{constructor(){this.map=new Map}put(t){let i=t.trackById,r=this.map.get(i);r||(r=new $3,this.map.set(i,r)),r.add(t)}get(t,i){let r=t,s=this.map.get(r);return s?s.get(t,i):null}remove(t){let i=t.trackById;return this.map.get(i).remove(t)&&this.map.delete(i),t}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function JH(e,t,i){let r=e.previousIndex;if(r===null)return r;let s=0;return i&&r<i.length&&(s=i[r]),r+t+s}function e8(){return new VL([new q3])}var VL=(()=>{let t=class t{constructor(r){this.factories=r}static create(r,s){if(s!=null){let n=s.factories.slice();r=r.concat(n)}return new t(r)}static extend(r){return{provide:t,useFactory:s=>t.create(r,s||e8()),deps:[[t,new d8,new Q3]]}}find(r){let s=this.factories.find(n=>n.supports(r));if(s!=null)return s;throw new Ui(901,!1)}};t.\u0275prov=hr({token:t,providedIn:"root",factory:e8});let e=t;return e})();function u9(e){try{let{rootComponent:t,appProviders:i,platformProviders:r}=e,s=bde(r),n=[gde(),...i||[]],u=new eA({providers:n,parent:s,debugName:"",runEnvironmentInitializers:!1}).injector,p=u.get(Ys);return p.run(()=>{u.resolveInjectorInitializers();let f=u.get(Nd,null),x;p.runOutsideAngular(()=>{x=p.onError.subscribe({next:A=>{f.handleError(A)}})});let w=()=>u.destroy(),E=s.get(c9);return E.add(w),u.onDestroy(()=>{x.unsubscribe(),E.delete(w)}),ude(f,p,()=>{let A=u.get(l9);return A.runInitializers(),A.donePromise.then(()=>{let I=u.get(jL,iA);ide(I||iA);let P=u.get(j0);return t!==void 0&&P.bootstrap(t),P})})})}catch(t){return Promise.reject(t)}}var y9=null;function V0(){return y9}function v9(e){y9??=e}var IA=class{};var Ks=new an(""),_9=(()=>{let t=class t{historyGo(r){throw new Error("")}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:()=>tr(Dde),providedIn:"platform"});let e=t;return e})();var Dde=(()=>{let t=class t extends _9{constructor(){super(),this._doc=tr(Ks),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return V0().getBaseHref(this._doc)}onPopState(r){let s=V0().getGlobalEventTarget(this._doc,"window");return s.addEventListener("popstate",r,!1),()=>s.removeEventListener("popstate",r)}onHashChange(r){let s=V0().getGlobalEventTarget(this._doc,"window");return s.addEventListener("hashchange",r,!1),()=>s.removeEventListener("hashchange",r)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(r){this._location.pathname=r}pushState(r,s,n){this._history.pushState(r,s,n)}replaceState(r,s,n){this._history.replaceState(r,s,n)}forward(){this._history.forward()}back(){this._history.back()}historyGo(r=0){this._history.go(r)}getState(){return this._history.state}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:()=>new t,providedIn:"platform"});let e=t;return e})();function x9(e,t){if(e.length==0)return t;if(t.length==0)return e;let i=0;return e.endsWith("/")&&i++,t.startsWith("/")&&i++,i==2?e+t.substring(1):i==1?e+t:e+"/"+t}function h9(e){let t=e.match(/#|\?|$/),i=t&&t.index||e.length,r=i-(e[i-1]==="/"?1:0);return e.slice(0,r)+e.slice(i)}function $g(e){return e&&e[0]!=="?"?"?"+e:e}var PA=(()=>{let t=class t{historyGo(r){throw new Error("")}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:()=>tr(b9),providedIn:"root"});let e=t;return e})(),Ide=new an(""),b9=(()=>{let t=class t extends PA{constructor(r,s){super(),this._platformLocation=r,this._removeListenerFns=[],this._baseHref=s??this._platformLocation.getBaseHrefFromDOM()??tr(Ks).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(r){this._removeListenerFns.push(this._platformLocation.onPopState(r),this._platformLocation.onHashChange(r))}getBaseHref(){return this._baseHref}prepareExternalUrl(r){return x9(this._baseHref,r)}path(r=!1){let s=this._platformLocation.pathname+$g(this._platformLocation.search),n=this._platformLocation.hash;return n&&r?`${s}${n}`:s}pushState(r,s,n,c){let u=this.prepareExternalUrl(n+$g(c));this._platformLocation.pushState(r,s,u)}replaceState(r,s,n,c){let u=this.prepareExternalUrl(n+$g(c));this._platformLocation.replaceState(r,s,u)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(r=0){this._platformLocation.historyGo?.(r)}};t.\u0275fac=function(s){return new(s||t)(Er(_9),Er(Ide,8))},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var Xb=(()=>{let t=class t{constructor(r){this._subject=new Fc,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=r;let s=this._locationStrategy.getBaseHref();this._basePath=Ode(h9(d9(s))),this._locationStrategy.onPopState(n=>{this._subject.emit({url:this.path(!0),pop:!0,state:n.state,type:n.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(r=!1){return this.normalize(this._locationStrategy.path(r))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(r,s=""){return this.path()==this.normalize(r+$g(s))}normalize(r){return t.stripTrailingSlash(Rde(this._basePath,d9(r)))}prepareExternalUrl(r){return r&&r[0]!=="/"&&(r="/"+r),this._locationStrategy.prepareExternalUrl(r)}go(r,s="",n=null){this._locationStrategy.pushState(n,"",r,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(r+$g(s)),n)}replaceState(r,s="",n=null){this._locationStrategy.replaceState(n,"",r,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(r+$g(s)),n)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(r=0){this._locationStrategy.historyGo?.(r)}onUrlChange(r){return this._urlChangeListeners.push(r),this._urlChangeSubscription??=this.subscribe(s=>{this._notifyUrlChangeListeners(s.url,s.state)}),()=>{let s=this._urlChangeListeners.indexOf(r);this._urlChangeListeners.splice(s,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(r="",s){this._urlChangeListeners.forEach(n=>n(r,s))}subscribe(r,s,n){return this._subject.subscribe({next:r,error:s,complete:n})}};t.normalizeQueryParams=$g,t.joinWithSlash=x9,t.stripTrailingSlash=h9,t.\u0275fac=function(s){return new(s||t)(Er(PA))},t.\u0275prov=hr({token:t,factory:()=>Pde(),providedIn:"root"});let e=t;return e})();function Pde(){return new Xb(Er(PA))}function Rde(e,t){if(!e||!t.startsWith(e))return t;let i=t.substring(e.length);return i===""||["/",";","?","#"].includes(i[0])?i:t}function d9(e){return e.replace(/\/index.html$/,"")}function Ode(e){if(new RegExp("^(https?:)?//").test(e)){let[,i]=e.split(/\/\/[^\/]+/);return i}return e}function RA(e,t){t=encodeURIComponent(t);for(let i of e.split(";")){let r=i.indexOf("="),[s,n]=r==-1?[i,""]:[i.slice(0,r),i.slice(r+1)];if(s.trim()===t)return decodeURIComponent(n)}return null}var GL=/\s+/,p9=[],OA=(()=>{let t=class t{constructor(r,s){this._ngEl=r,this._renderer=s,this.initialClasses=p9,this.stateMap=new Map}set klass(r){this.initialClasses=r!=null?r.trim().split(GL):p9}set ngClass(r){this.rawClass=typeof r=="string"?r.trim().split(GL):r}ngDoCheck(){for(let s of this.initialClasses)this._updateState(s,!0);let r=this.rawClass;if(Array.isArray(r)||r instanceof Set)for(let s of r)this._updateState(s,!0);else if(r!=null)for(let s of Object.keys(r))this._updateState(s,!!r[s]);this._applyStateDiff()}_updateState(r,s){let n=this.stateMap.get(r);n!==void 0?(n.enabled!==s&&(n.changed=!0,n.enabled=s),n.touched=!0):this.stateMap.set(r,{enabled:s,changed:!0,touched:!0})}_applyStateDiff(){for(let r of this.stateMap){let s=r[0],n=r[1];n.changed?(this._toggleClass(s,n.enabled),n.changed=!1):n.touched||(n.enabled&&this._toggleClass(s,!1),this.stateMap.delete(s)),n.touched=!1}}_toggleClass(r,s){r=r.trim(),r.length>0&&r.split(GL).forEach(n=>{s?this._renderer.addClass(this._ngEl.nativeElement,n):this._renderer.removeClass(this._ngEl.nativeElement,n)})}};t.\u0275fac=function(s){return new(s||t)(_s(Pf),_s(bA))},t.\u0275dir=Hg({type:t,selectors:[["","ngClass",""]],inputs:{klass:[Fd.None,"class","klass"],ngClass:"ngClass"},standalone:!0});let e=t;return e})();var HL=class{constructor(t,i,r,s){this.$implicit=t,this.ngForOf=i,this.index=r,this.count=s}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},LA=(()=>{let t=class t{set ngForOf(r){this._ngForOf=r,this._ngForOfDirty=!0}set ngForTrackBy(r){this._trackByFn=r}get ngForTrackBy(){return this._trackByFn}constructor(r,s,n){this._viewContainer=r,this._template=s,this._differs=n,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(r){r&&(this._template=r)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let r=this._ngForOf;if(!this._differ&&r)if(0)try{}catch{}else this._differ=this._differs.find(r).create(this.ngForTrackBy)}if(this._differ){let r=this._differ.diff(this._ngForOf);r&&this._applyChanges(r)}}_applyChanges(r){let s=this._viewContainer;r.forEachOperation((n,c,u)=>{if(n.previousIndex==null)s.createEmbeddedView(this._template,new HL(n.item,this._ngForOf,-1,-1),u===null?void 0:u);else if(u==null)s.remove(c===null?void 0:c);else if(c!==null){let p=s.get(c);s.move(p,u),f9(p,n)}});for(let n=0,c=s.length;n<c;n++){let p=s.get(n).context;p.index=n,p.count=c,p.ngForOf=this._ngForOf}r.forEachIdentityChange(n=>{let c=s.get(n.currentIndex);f9(c,n)})}static ngTemplateContextGuard(r,s){return!0}};t.\u0275fac=function(s){return new(s||t)(_s(Gd),_s(Bg),_s(VL))},t.\u0275dir=Hg({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0});let e=t;return e})();function f9(e,t){e.context.$implicit=t.item}var H0=(()=>{let t=class t{constructor(r,s){this._viewContainer=r,this._context=new WL,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=s}set ngIf(r){this._context.$implicit=this._context.ngIf=r,this._updateView()}set ngIfThen(r){m9("ngIfThen",r),this._thenTemplateRef=r,this._thenViewRef=null,this._updateView()}set ngIfElse(r){m9("ngIfElse",r),this._elseTemplateRef=r,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(r,s){return!0}};t.\u0275fac=function(s){return new(s||t)(_s(Gd),_s(Bg))},t.\u0275dir=Hg({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let e=t;return e})(),WL=class{constructor(){this.$implicit=null,this.ngIf=null}};function m9(e,t){if(!!!(!t||t.createEmbeddedView))throw new Error(`${e} must be a TemplateRef, but received '${ul(t)}'.`)}var w9=(()=>{let t=class t{constructor(r){this._viewContainerRef=r,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(r){if(this._shouldRecreateView(r)){let s=this._viewContainerRef;if(this._viewRef&&s.remove(s.indexOf(this._viewRef)),!this.ngTemplateOutlet){this._viewRef=null;return}let n=this._createContextForwardProxy();this._viewRef=s.createEmbeddedView(this.ngTemplateOutlet,n,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(r){return!!r.ngTemplateOutlet||!!r.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(r,s,n)=>this.ngTemplateOutletContext?Reflect.set(this.ngTemplateOutletContext,s,n):!1,get:(r,s,n)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,s,n)}})}};t.\u0275fac=function(s){return new(s||t)(_s(Gd))},t.\u0275dir=Hg({type:t,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[Ub]});let e=t;return e})();var lc=(()=>{let t=class t{};t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=Gg({type:t}),t.\u0275inj=Vg({});let e=t;return e})(),S9="browser",Lde="server";function zA(e){return e===Lde}var G0=class{};var $b=class{},kA=class{},Cu=class e{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?typeof t=="string"?this.lazyInit=()=>{this.headers=new Map,t.split(`
`).forEach(i=>{let r=i.indexOf(":");if(r>0){let s=i.slice(0,r),n=s.toLowerCase(),c=i.slice(r+1).trim();this.maybeSetNormalizedName(s,n),this.headers.has(n)?this.headers.get(n).push(c):this.headers.set(n,[c])}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((i,r)=>{this.setHeaderEntries(r,i)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([i,r])=>{this.setHeaderEntries(i,r)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();let i=this.headers.get(t.toLowerCase());return i&&i.length>0?i[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,i){return this.clone({name:t,value:i,op:"a"})}set(t,i){return this.clone({name:t,value:i,op:"s"})}delete(t,i){return this.clone({name:t,value:i,op:"d"})}maybeSetNormalizedName(t,i){this.normalizedNames.has(i)||this.normalizedNames.set(i,t)}init(){this.lazyInit&&(this.lazyInit instanceof e?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(i=>{this.headers.set(i,t.headers.get(i)),this.normalizedNames.set(i,t.normalizedNames.get(i))})}clone(t){let i=new e;return i.lazyInit=this.lazyInit&&this.lazyInit instanceof e?this.lazyInit:this,i.lazyUpdate=(this.lazyUpdate||[]).concat([t]),i}applyUpdate(t){let i=t.name.toLowerCase();switch(t.op){case"a":case"s":let r=t.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(t.name,i);let s=(t.op==="a"?this.headers.get(i):void 0)||[];s.push(...r),this.headers.set(i,s);break;case"d":let n=t.value;if(!n)this.headers.delete(i),this.normalizedNames.delete(i);else{let c=this.headers.get(i);if(!c)return;c=c.filter(u=>n.indexOf(u)===-1),c.length===0?(this.headers.delete(i),this.normalizedNames.delete(i)):this.headers.set(i,c)}break}}setHeaderEntries(t,i){let r=(Array.isArray(i)?i:[i]).map(n=>n.toString()),s=t.toLowerCase();this.headers.set(s,r),this.maybeSetNormalizedName(t,s)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(i=>t(this.normalizedNames.get(i),this.headers.get(i)))}};var YL=class{encodeKey(t){return E9(t)}encodeValue(t){return E9(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}};function kde(e,t){let i=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(s=>{let n=s.indexOf("="),[c,u]=n==-1?[t.decodeKey(s),""]:[t.decodeKey(s.slice(0,n)),t.decodeValue(s.slice(n+1))],p=i.get(c)||[];p.push(u),i.set(c,p)}),i}var Nde=/%(\d[a-f0-9])/gi,Bde={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function E9(e){return encodeURIComponent(e).replace(Nde,(t,i)=>Bde[i]??t)}function FA(e){return`${e}`}var Th=class e{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new YL,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=kde(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(i=>{let r=t.fromObject[i],s=Array.isArray(r)?r.map(FA):[FA(r)];this.map.set(i,s)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();let i=this.map.get(t);return i?i[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,i){return this.clone({param:t,value:i,op:"a"})}appendAll(t){let i=[];return Object.keys(t).forEach(r=>{let s=t[r];Array.isArray(s)?s.forEach(n=>{i.push({param:r,value:n,op:"a"})}):i.push({param:r,value:s,op:"a"})}),this.clone(i)}set(t,i){return this.clone({param:t,value:i,op:"s"})}delete(t,i){return this.clone({param:t,value:i,op:"d"})}toString(){return this.init(),this.keys().map(t=>{let i=this.encoder.encodeKey(t);return this.map.get(t).map(r=>i+"="+this.encoder.encodeValue(r)).join("&")}).filter(t=>t!=="").join("&")}clone(t){let i=new e({encoder:this.encoder});return i.cloneFrom=this.cloneFrom||this,i.updates=(this.updates||[]).concat(t),i}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":let i=(t.op==="a"?this.map.get(t.param):void 0)||[];i.push(FA(t.value)),this.map.set(t.param,i);break;case"d":if(t.value!==void 0){let r=this.map.get(t.param)||[],s=r.indexOf(FA(t.value));s!==-1&&r.splice(s,1),r.length>0?this.map.set(t.param,r):this.map.delete(t.param)}else{this.map.delete(t.param);break}}}),this.cloneFrom=this.updates=null)}};var XL=class{constructor(){this.map=new Map}set(t,i){return this.map.set(t,i),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}};function Ude(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function M9(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function T9(e){return typeof Blob<"u"&&e instanceof Blob}function A9(e){return typeof FormData<"u"&&e instanceof FormData}function jde(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}var Zg=class e{constructor(t,i,r,s){this.url=i,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase();let n;if(Ude(this.method)||s?(this.body=r!==void 0?r:null,n=s):n=r,n&&(this.reportProgress=!!n.reportProgress,this.withCredentials=!!n.withCredentials,n.responseType&&(this.responseType=n.responseType),n.headers&&(this.headers=n.headers),n.context&&(this.context=n.context),n.params&&(this.params=n.params),this.transferCache=n.transferCache),this.headers??=new Cu,this.context??=new XL,!this.params)this.params=new Th,this.urlWithParams=i;else{let c=this.params.toString();if(c.length===0)this.urlWithParams=i;else{let u=i.indexOf("?"),p=u===-1?"?":u<i.length-1?"&":"";this.urlWithParams=i+p+c}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||M9(this.body)||T9(this.body)||A9(this.body)||jde(this.body)?this.body:this.body instanceof Th?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||A9(this.body)?null:T9(this.body)?this.body.type||null:M9(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof Th?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(t={}){let i=t.method||this.method,r=t.url||this.url,s=t.responseType||this.responseType,n=t.transferCache??this.transferCache,c=t.body!==void 0?t.body:this.body,u=t.withCredentials??this.withCredentials,p=t.reportProgress??this.reportProgress,f=t.headers||this.headers,x=t.params||this.params,w=t.context??this.context;return t.setHeaders!==void 0&&(f=Object.keys(t.setHeaders).reduce((E,A)=>E.set(A,t.setHeaders[A]),f)),t.setParams&&(x=Object.keys(t.setParams).reduce((E,A)=>E.set(A,t.setParams[A]),x)),new e(i,r,c,{params:x,headers:f,context:w,reportProgress:p,responseType:s,withCredentials:u,transferCache:n})}},q0=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(q0||{}),Zb=class{constructor(t,i=BA.Ok,r="OK"){this.headers=t.headers||new Cu,this.status=t.status!==void 0?t.status:i,this.statusText=t.statusText||r,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}},$L=class e extends Zb{constructor(t={}){super(t),this.type=q0.ResponseHeader}clone(t={}){return new e({headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}},mn=class e extends Zb{constructor(t={}){super(t),this.type=q0.Response,this.body=t.body!==void 0?t.body:null}clone(t={}){return new e({body:t.body!==void 0?t.body:this.body,headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}},NA=class extends Zb{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${t.url||"(unknown url)"}`:this.message=`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}},BA=function(e){return e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.UriTooLong=414]="UriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",e}(BA||{});function qL(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials,transferCache:e.transferCache}}var Qg=(()=>{let t=class t{constructor(r){this.handler=r}request(r,s,n={}){let c;if(r instanceof Zg)c=r;else{let f;n.headers instanceof Cu?f=n.headers:f=new Cu(n.headers);let x;n.params&&(n.params instanceof Th?x=n.params:x=new Th({fromObject:n.params})),c=new Zg(r,s,n.body!==void 0?n.body:null,{headers:f,context:n.context,params:x,reportProgress:n.reportProgress,responseType:n.responseType||"json",withCredentials:n.withCredentials,transferCache:n.transferCache})}let u=rn(c).pipe(Sf(f=>this.handler.handle(f)));if(r instanceof Zg||n.observe==="events")return u;let p=u.pipe(Nr(f=>f instanceof mn));switch(n.observe||"body"){case"body":switch(c.responseType){case"arraybuffer":return p.pipe(Ti(f=>{if(f.body!==null&&!(f.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return f.body}));case"blob":return p.pipe(Ti(f=>{if(f.body!==null&&!(f.body instanceof Blob))throw new Error("Response is not a Blob.");return f.body}));case"text":return p.pipe(Ti(f=>{if(f.body!==null&&typeof f.body!="string")throw new Error("Response is not a string.");return f.body}));case"json":default:return p.pipe(Ti(f=>f.body))}case"response":return p;default:throw new Error(`Unreachable: unhandled observe type ${n.observe}}`)}}delete(r,s={}){return this.request("DELETE",r,s)}get(r,s={}){return this.request("GET",r,s)}head(r,s={}){return this.request("HEAD",r,s)}jsonp(r,s){return this.request("JSONP",r,{params:new Th().append(s,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(r,s={}){return this.request("OPTIONS",r,s)}patch(r,s,n={}){return this.request("PATCH",r,qL(n,s))}post(r,s,n={}){return this.request("POST",r,qL(n,s))}put(r,s,n={}){return this.request("PUT",r,qL(n,s))}};t.\u0275fac=function(s){return new(s||t)(Er($b))},t.\u0275prov=hr({token:t,factory:t.\u0275fac});let e=t;return e})();function P9(e,t){return t(e)}function Vde(e,t){return(i,r)=>t.intercept(i,{handle:s=>e(s,r)})}function Gde(e,t,i){return(r,s)=>Ud(i,()=>t(r,n=>e(n,s)))}var Hde=new an(""),ZL=new an(""),Wde=new an(""),qde=new an("");function Yde(){let e=null;return(t,i)=>{e===null&&(e=(tr(Hde,{optional:!0})??[]).reduceRight(Vde,P9));let r=tr(Xg),s=r.add();return e(t,i).pipe(Mf(()=>r.remove(s)))}}var C9=(()=>{let t=class t extends $b{constructor(r,s){super(),this.backend=r,this.injector=s,this.chain=null,this.pendingTasks=tr(Xg);let n=tr(qde,{optional:!0});this.backend=n??r}handle(r){if(this.chain===null){let n=Array.from(new Set([...this.injector.get(ZL),...this.injector.get(Wde,[])]));this.chain=n.reduceRight((c,u)=>Gde(c,u,this.injector),P9)}let s=this.pendingTasks.add();return this.chain(r,n=>this.backend.handle(n)).pipe(Mf(()=>this.pendingTasks.remove(s)))}};t.\u0275fac=function(s){return new(s||t)(Er(kA),Er(Rl))},t.\u0275prov=hr({token:t,factory:t.\u0275fac});let e=t;return e})();var Xde=/^\)\]\}',?\n/;function $de(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}var D9=(()=>{let t=class t{constructor(r){this.xhrFactory=r}handle(r){if(r.method==="JSONP")throw new Ui(-2800,!1);let s=this.xhrFactory;return(s.\u0275loadImpl?ao(s.\u0275loadImpl()):rn(null)).pipe(tc(()=>new is(c=>{let u=s.build();if(u.open(r.method,r.urlWithParams),r.withCredentials&&(u.withCredentials=!0),r.headers.forEach((O,k)=>u.setRequestHeader(O,k.join(","))),r.headers.has("Accept")||u.setRequestHeader("Accept","application/json, text/plain, */*"),!r.headers.has("Content-Type")){let O=r.detectContentTypeHeader();O!==null&&u.setRequestHeader("Content-Type",O)}if(r.responseType){let O=r.responseType.toLowerCase();u.responseType=O!=="json"?O:"text"}let p=r.serializeBody(),f=null,x=()=>{if(f!==null)return f;let O=u.statusText||"OK",k=new Cu(u.getAllResponseHeaders()),U=$de(u)||r.url;return f=new $L({headers:k,status:u.status,statusText:O,url:U}),f},w=()=>{let{headers:O,status:k,statusText:U,url:j}=x(),V=null;k!==BA.NoContent&&(V=typeof u.response>"u"?u.responseText:u.response),k===0&&(k=V?BA.Ok:0);let $=k>=200&&k<300;if(r.responseType==="json"&&typeof V=="string"){let Y=V;V=V.replace(Xde,"");try{V=V!==""?JSON.parse(V):null}catch(J){V=Y,$&&($=!1,V={error:J,text:V})}}$?(c.next(new mn({body:V,headers:O,status:k,statusText:U,url:j||void 0})),c.complete()):c.error(new NA({error:V,headers:O,status:k,statusText:U,url:j||void 0}))},E=O=>{let{url:k}=x(),U=new NA({error:O,status:u.status||0,statusText:u.statusText||"Unknown Error",url:k||void 0});c.error(U)},A=!1,I=O=>{A||(c.next(x()),A=!0);let k={type:q0.DownloadProgress,loaded:O.loaded};O.lengthComputable&&(k.total=O.total),r.responseType==="text"&&u.responseText&&(k.partialText=u.responseText),c.next(k)},P=O=>{let k={type:q0.UploadProgress,loaded:O.loaded};O.lengthComputable&&(k.total=O.total),c.next(k)};return u.addEventListener("load",w),u.addEventListener("error",E),u.addEventListener("timeout",E),u.addEventListener("abort",E),r.reportProgress&&(u.addEventListener("progress",I),p!==null&&u.upload&&u.upload.addEventListener("progress",P)),u.send(p),c.next({type:q0.Sent}),()=>{u.removeEventListener("error",E),u.removeEventListener("abort",E),u.removeEventListener("load",w),u.removeEventListener("timeout",E),r.reportProgress&&(u.removeEventListener("progress",I),p!==null&&u.upload&&u.upload.removeEventListener("progress",P)),u.readyState!==u.DONE&&u.abort()}})))}};t.\u0275fac=function(s){return new(s||t)(Er(G0))},t.\u0275prov=hr({token:t,factory:t.\u0275fac});let e=t;return e})(),R9=new an(""),Zde="XSRF-TOKEN",Qde=new an("",{providedIn:"root",factory:()=>Zde}),Kde="X-XSRF-TOKEN",Jde=new an("",{providedIn:"root",factory:()=>Kde}),UA=class{},epe=(()=>{let t=class t{constructor(r,s,n){this.doc=r,this.platform=s,this.cookieName=n,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let r=this.doc.cookie||"";return r!==this.lastCookieString&&(this.parseCount++,this.lastToken=RA(r,this.cookieName),this.lastCookieString=r),this.lastToken}};t.\u0275fac=function(s){return new(s||t)(Er(Ks),Er(Rf),Er(Qde))},t.\u0275prov=hr({token:t,factory:t.\u0275fac});let e=t;return e})();function tpe(e,t){let i=e.url.toLowerCase();if(!tr(R9)||e.method==="GET"||e.method==="HEAD"||i.startsWith("http://")||i.startsWith("https://"))return t(e);let r=tr(UA).getToken(),s=tr(Jde);return r!=null&&!e.headers.has(s)&&(e=e.clone({headers:e.headers.set(s,r)})),t(e)}var O9=function(e){return e[e.Interceptors=0]="Interceptors",e[e.LegacyInterceptors=1]="LegacyInterceptors",e[e.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",e[e.NoXsrfProtection=3]="NoXsrfProtection",e[e.JsonpSupport=4]="JsonpSupport",e[e.RequestsMadeViaParent=5]="RequestsMadeViaParent",e[e.Fetch=6]="Fetch",e}(O9||{});function ipe(e,t){return{\u0275kind:e,\u0275providers:t}}function QL(...e){let t=[Qg,D9,C9,{provide:$b,useExisting:C9},{provide:kA,useExisting:D9},{provide:ZL,useValue:tpe,multi:!0},{provide:R9,useValue:!0},{provide:UA,useClass:epe}];for(let i of e)t.push(...i.\u0275providers);return z0(t)}var I9=new an("");function rpe(){return ipe(O9.LegacyInterceptors,[{provide:I9,useFactory:Yde},{provide:ZL,useExisting:I9,multi:!0}])}var L9=(()=>{let t=class t{};t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=Gg({type:t}),t.\u0275inj=Vg({providers:[QL(rpe())]});let e=t;return e})();var tz=class extends IA{constructor(){super(...arguments),this.supportsDOMEvents=!0}},iz=class e extends tz{static makeCurrent(){v9(new e)}onAndCancel(t,i,r){return t.addEventListener(i,r),()=>{t.removeEventListener(i,r)}}dispatchEvent(t,i){t.dispatchEvent(i)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,i){return i=i||this.getDefaultDocument(),i.createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,i){return i==="window"?window:i==="document"?t:i==="body"?t.body:null}getBaseHref(t){let i=npe();return i==null?null:spe(i)}resetBaseElement(){Qb=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return RA(document.cookie,t)}},Qb=null;function npe(){return Qb=Qb||document.querySelector("base"),Qb?Qb.getAttribute("href"):null}function spe(e){return new URL(e,document.baseURI).pathname}var ope=(()=>{let t=class t{build(){return new XMLHttpRequest}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac});let e=t;return e})(),rz=new an(""),k9=(()=>{let t=class t{constructor(r,s){this._zone=s,this._eventNameToPlugin=new Map,r.forEach(n=>{n.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,s,n){return this._findPluginFor(s).addEventListener(r,s,n)}getZone(){return this._zone}_findPluginFor(r){let s=this._eventNameToPlugin.get(r);if(s)return s;if(s=this._plugins.find(c=>c.supports(r)),!s)throw new Ui(5101,!1);return this._eventNameToPlugin.set(r,s),s}};t.\u0275fac=function(s){return new(s||t)(Er(rz),Er(Ys))},t.\u0275prov=hr({token:t,factory:t.\u0275fac});let e=t;return e})(),jA=class{constructor(t){this._doc=t}},JL="ng-app-id",N9=(()=>{let t=class t{constructor(r,s,n,c={}){this.doc=r,this.appId=s,this.nonce=n,this.platformId=c,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=zA(c),this.resetHostNodes()}addStyles(r){for(let s of r)this.changeUsageCount(s,1)===1&&this.onStyleAdded(s)}removeStyles(r){for(let s of r)this.changeUsageCount(s,-1)<=0&&this.onStyleRemoved(s)}ngOnDestroy(){let r=this.styleNodesInDOM;r&&(r.forEach(s=>s.remove()),r.clear());for(let s of this.getAllStyles())this.onStyleRemoved(s);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(let s of this.getAllStyles())this.addStyleToHost(r,s)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(let s of this.hostNodes)this.addStyleToHost(s,r)}onStyleRemoved(r){let s=this.styleRef;s.get(r)?.elements?.forEach(n=>n.remove()),s.delete(r)}collectServerRenderedStyles(){let r=this.doc.head?.querySelectorAll(`style[${JL}="${this.appId}"]`);if(r?.length){let s=new Map;return r.forEach(n=>{n.textContent!=null&&s.set(n.textContent,n)}),s}return null}changeUsageCount(r,s){let n=this.styleRef;if(n.has(r)){let c=n.get(r);return c.usage+=s,c.usage}return n.set(r,{usage:s,elements:[]}),s}getStyleElement(r,s){let n=this.styleNodesInDOM,c=n?.get(s);if(c?.parentNode===r)return n.delete(s),c.removeAttribute(JL),c;{let u=this.doc.createElement("style");return this.nonce&&u.setAttribute("nonce",this.nonce),u.textContent=s,this.platformIsServer&&u.setAttribute(JL,this.appId),r.appendChild(u),u}}addStyleToHost(r,s){let n=this.getStyleElement(r,s),c=this.styleRef,u=c.get(s)?.elements;u?u.push(n):c.set(s,{elements:[n],usage:1})}resetHostNodes(){let r=this.hostNodes;r.clear(),r.add(this.doc.head)}};t.\u0275fac=function(s){return new(s||t)(Er(Ks),Er(fL),Er(yL,8),Er(Rf))},t.\u0275prov=hr({token:t,factory:t.\u0275fac});let e=t;return e})(),ez={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},sz=/%COMP%/g,B9="%COMP%",ape=`_nghost-${B9}`,lpe=`_ngcontent-${B9}`,cpe=!0,upe=new an("",{providedIn:"root",factory:()=>cpe});function hpe(e){return lpe.replace(sz,e)}function dpe(e){return ape.replace(sz,e)}function U9(e,t){return t.map(i=>i.replace(sz,e))}var VA=(()=>{let t=class t{constructor(r,s,n,c,u,p,f,x=null){this.eventManager=r,this.sharedStylesHost=s,this.appId=n,this.removeStylesOnCompDestroy=c,this.doc=u,this.platformId=p,this.ngZone=f,this.nonce=x,this.rendererByCompId=new Map,this.platformIsServer=zA(p),this.defaultRenderer=new Kb(r,u,f,this.platformIsServer)}createRenderer(r,s){if(!r||!s)return this.defaultRenderer;this.platformIsServer&&s.encapsulation===Sh.ShadowDom&&(s=pt(me({},s),{encapsulation:Sh.Emulated}));let n=this.getOrCreateRenderer(r,s);return n instanceof GA?n.applyToHost(r):n instanceof Jb&&n.applyStyles(),n}getOrCreateRenderer(r,s){let n=this.rendererByCompId,c=n.get(s.id);if(!c){let u=this.doc,p=this.ngZone,f=this.eventManager,x=this.sharedStylesHost,w=this.removeStylesOnCompDestroy,E=this.platformIsServer;switch(s.encapsulation){case Sh.Emulated:c=new GA(f,x,s,this.appId,w,u,p,E);break;case Sh.ShadowDom:return new nz(f,x,r,s,u,p,this.nonce,E);default:c=new Jb(f,x,s,w,u,p,E);break}n.set(s.id,c)}return c}ngOnDestroy(){this.rendererByCompId.clear()}};t.\u0275fac=function(s){return new(s||t)(Er(k9),Er(N9),Er(fL),Er(upe),Er(Ks),Er(Rf),Er(Ys),Er(yL))},t.\u0275prov=hr({token:t,factory:t.\u0275fac});let e=t;return e})(),Kb=class{constructor(t,i,r,s){this.eventManager=t,this.doc=i,this.ngZone=r,this.platformIsServer=s,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(t,i){return i?this.doc.createElementNS(ez[i]||i,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,i){(z9(t)?t.content:t).appendChild(i)}insertBefore(t,i,r){t&&(z9(t)?t.content:t).insertBefore(i,r)}removeChild(t,i){t&&t.removeChild(i)}selectRootElement(t,i){let r=typeof t=="string"?this.doc.querySelector(t):t;if(!r)throw new Ui(-5104,!1);return i||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,i,r,s){if(s){i=s+":"+i;let n=ez[s];n?t.setAttributeNS(n,i,r):t.setAttribute(i,r)}else t.setAttribute(i,r)}removeAttribute(t,i,r){if(r){let s=ez[r];s?t.removeAttributeNS(s,i):t.removeAttribute(`${r}:${i}`)}else t.removeAttribute(i)}addClass(t,i){t.classList.add(i)}removeClass(t,i){t.classList.remove(i)}setStyle(t,i,r,s){s&(Bd.DashCase|Bd.Important)?t.style.setProperty(i,r,s&Bd.Important?"important":""):t.style[i]=r}removeStyle(t,i,r){r&Bd.DashCase?t.style.removeProperty(i):t.style[i]=""}setProperty(t,i,r){t!=null&&(t[i]=r)}setValue(t,i){t.nodeValue=i}listen(t,i,r){if(typeof t=="string"&&(t=V0().getGlobalEventTarget(this.doc,t),!t))throw new Error(`Unsupported event target ${t} for event ${i}`);return this.eventManager.addEventListener(t,i,this.decoratePreventDefault(r))}decoratePreventDefault(t){return i=>{if(i==="__ngUnwrap__")return t;(this.platformIsServer?this.ngZone.runGuarded(()=>t(i)):t(i))===!1&&i.preventDefault()}}};function z9(e){return e.tagName==="TEMPLATE"&&e.content!==void 0}var nz=class extends Kb{constructor(t,i,r,s,n,c,u,p){super(t,n,c,p),this.sharedStylesHost=i,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let f=U9(s.id,s.styles);for(let x of f){let w=document.createElement("style");u&&w.setAttribute("nonce",u),w.textContent=x,this.shadowRoot.appendChild(w)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,i){return super.appendChild(this.nodeOrShadowRoot(t),i)}insertBefore(t,i,r){return super.insertBefore(this.nodeOrShadowRoot(t),i,r)}removeChild(t,i){return super.removeChild(this.nodeOrShadowRoot(t),i)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Jb=class extends Kb{constructor(t,i,r,s,n,c,u,p){super(t,n,c,u),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=s,this.styles=p?U9(p,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},GA=class extends Jb{constructor(t,i,r,s,n,c,u,p){let f=s+"-"+r.id;super(t,i,r,n,c,u,p,f),this.contentAttr=hpe(f),this.hostAttr=dpe(f)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,i){let r=super.createElement(t,i);return super.setAttribute(r,this.contentAttr,""),r}},ppe=(()=>{let t=class t extends jA{constructor(r){super(r)}supports(r){return!0}addEventListener(r,s,n){return r.addEventListener(s,n,!1),()=>this.removeEventListener(r,s,n)}removeEventListener(r,s,n){return r.removeEventListener(s,n)}};t.\u0275fac=function(s){return new(s||t)(Er(Ks))},t.\u0275prov=hr({token:t,factory:t.\u0275fac});let e=t;return e})(),F9=["alt","control","meta","shift"],fpe={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},mpe={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey},gpe=(()=>{let t=class t extends jA{constructor(r){super(r)}supports(r){return t.parseEventName(r)!=null}addEventListener(r,s,n){let c=t.parseEventName(s),u=t.eventCallback(c.fullKey,n,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>V0().onAndCancel(r,c.domEventName,u))}static parseEventName(r){let s=r.toLowerCase().split("."),n=s.shift();if(s.length===0||!(n==="keydown"||n==="keyup"))return null;let c=t._normalizeKey(s.pop()),u="",p=s.indexOf("code");if(p>-1&&(s.splice(p,1),u="code."),F9.forEach(x=>{let w=s.indexOf(x);w>-1&&(s.splice(w,1),u+=x+".")}),u+=c,s.length!=0||c.length===0)return null;let f={};return f.domEventName=n,f.fullKey=u,f}static matchEventFullKeyCode(r,s){let n=fpe[r.key]||r.key,c="";return s.indexOf("code.")>-1&&(n=r.code,c="code."),n==null||!n?!1:(n=n.toLowerCase(),n===" "?n="space":n==="."&&(n="dot"),F9.forEach(u=>{if(u!==n){let p=mpe[u];p(r)&&(c+=u+".")}}),c+=n,c===s)}static eventCallback(r,s,n){return c=>{t.matchEventFullKeyCode(c,r)&&n.runGuarded(()=>s(c))}}static _normalizeKey(r){return r==="esc"?"escape":r}};t.\u0275fac=function(s){return new(s||t)(Er(Ks))},t.\u0275prov=hr({token:t,factory:t.\u0275fac});let e=t;return e})();function j9(e,t){return u9(me({rootComponent:e},ype(t)))}function ype(e){return{appProviders:[...wpe,...e?.providers??[]],platformProviders:bpe}}function vpe(){iz.makeCurrent()}function _pe(){return new Nd}function xpe(){return mW(document),document}var bpe=[{provide:Rf,useValue:S9},{provide:mL,useValue:vpe,multi:!0},{provide:Ks,useFactory:xpe,deps:[]}];var wpe=[{provide:aA,useValue:"root"},{provide:Nd,useFactory:_pe,deps:[]},{provide:rz,useClass:ppe,multi:!0,deps:[Ks,Ys,Rf]},{provide:rz,useClass:gpe,multi:!0,deps:[Ks]},VA,N9,k9,{provide:Ug,useExisting:VA},{provide:G0,useClass:ope,deps:[]},[]];var V9=(()=>{let t=class t{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}};t.\u0275fac=function(s){return new(s||t)(Er(Ks))},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var vn="primary",fw=Symbol("RouteTitle"),uz=class{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){let i=this.params[t];return Array.isArray(i)?i[0]:i}return null}getAll(t){if(this.has(t)){let i=this.params[t];return Array.isArray(i)?i:[i]}return[]}get keys(){return Object.keys(this.params)}};function Q0(e){return new uz(e)}function Epe(e,t,i){let r=i.path.split("/");if(r.length>e.length||i.pathMatch==="full"&&(t.hasChildren()||r.length<e.length))return null;let s={};for(let n=0;n<r.length;n++){let c=r[n],u=e[n];if(c.startsWith(":"))s[c.substring(1)]=u;else if(c!==u.path)return null}return{consumed:e.slice(0,r.length),posParams:s}}function Mpe(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(!Ah(e[i],t[i]))return!1;return!0}function Ah(e,t){let i=e?hz(e):void 0,r=t?hz(t):void 0;if(!i||!r||i.length!=r.length)return!1;let s;for(let n=0;n<i.length;n++)if(s=i[n],!X9(e[s],t[s]))return!1;return!0}function hz(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function X9(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;let i=[...e].sort(),r=[...t].sort();return i.every((s,n)=>r[n]===s)}else return e===t}function $9(e){return e.length>0?e[e.length-1]:null}function kf(e){return jO(e)?e:qb(e)?ao(Promise.resolve(e)):rn(e)}var Tpe={exact:Q9,subset:K9},Z9={exact:Ape,subset:Cpe,ignored:()=>!0};function G9(e,t,i){return Tpe[i.paths](e.root,t.root,i.matrixParams)&&Z9[i.queryParams](e.queryParams,t.queryParams)&&!(i.fragment==="exact"&&e.fragment!==t.fragment)}function Ape(e,t){return Ah(e,t)}function Q9(e,t,i){if(!Jg(e.segments,t.segments)||!qA(e.segments,t.segments,i)||e.numberOfChildren!==t.numberOfChildren)return!1;for(let r in t.children)if(!e.children[r]||!Q9(e.children[r],t.children[r],i))return!1;return!0}function Cpe(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(i=>X9(e[i],t[i]))}function K9(e,t,i){return J9(e,t,t.segments,i)}function J9(e,t,i,r){if(e.segments.length>i.length){let s=e.segments.slice(0,i.length);return!(!Jg(s,i)||t.hasChildren()||!qA(s,i,r))}else if(e.segments.length===i.length){if(!Jg(e.segments,i)||!qA(e.segments,i,r))return!1;for(let s in t.children)if(!e.children[s]||!K9(e.children[s],t.children[s],r))return!1;return!0}else{let s=i.slice(0,e.segments.length),n=i.slice(e.segments.length);return!Jg(e.segments,s)||!qA(e.segments,s,r)||!e.children[vn]?!1:J9(e.children[vn],t,n,r)}}function qA(e,t,i){return t.every((r,s)=>Z9[i](e[s].parameters,r.parameters))}var Lf=class{constructor(t=new os([],{}),i={},r=null){this.root=t,this.queryParams=i,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Q0(this.queryParams),this._queryParamMap}toString(){return Ppe.serialize(this)}},os=class{constructor(t,i){this.segments=t,this.children=i,this.parent=null,Object.values(i).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return YA(this)}},Kg=class{constructor(t,i){this.path=t,this.parameters=i}get parameterMap(){return this._parameterMap??=Q0(this.parameters),this._parameterMap}toString(){return tq(this)}};function Dpe(e,t){return Jg(e,t)&&e.every((i,r)=>Ah(i.parameters,t[r].parameters))}function Jg(e,t){return e.length!==t.length?!1:e.every((i,r)=>i.path===t[r].path)}function Ipe(e,t){let i=[];return Object.entries(e.children).forEach(([r,s])=>{r===vn&&(i=i.concat(t(s,r)))}),Object.entries(e.children).forEach(([r,s])=>{r!==vn&&(i=i.concat(t(s,r)))}),i}var kz=(()=>{let t=class t{};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:()=>new $A,providedIn:"root"});let e=t;return e})(),$A=class{parse(t){let i=new pz(t);return new Lf(i.parseRootSegment(),i.parseQueryParams(),i.parseFragment())}serialize(t){let i=`/${ew(t.root,!0)}`,r=Lpe(t.queryParams),s=typeof t.fragment=="string"?`#${Rpe(t.fragment)}`:"";return`${i}${r}${s}`}},Ppe=new $A;function YA(e){return e.segments.map(t=>tq(t)).join("/")}function ew(e,t){if(!e.hasChildren())return YA(e);if(t){let i=e.children[vn]?ew(e.children[vn],!1):"",r=[];return Object.entries(e.children).forEach(([s,n])=>{s!==vn&&r.push(`${s}:${ew(n,!1)}`)}),r.length>0?`${i}(${r.join("//")})`:i}else{let i=Ipe(e,(r,s)=>s===vn?[ew(e.children[vn],!1)]:[`${s}:${ew(r,!1)}`]);return Object.keys(e.children).length===1&&e.children[vn]!=null?`${YA(e)}/${i[0]}`:`${YA(e)}/(${i.join("//")})`}}function eq(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function HA(e){return eq(e).replace(/%3B/gi,";")}function Rpe(e){return encodeURI(e)}function dz(e){return eq(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function XA(e){return decodeURIComponent(e)}function H9(e){return XA(e.replace(/\+/g,"%20"))}function tq(e){return`${dz(e.path)}${Ope(e.parameters)}`}function Ope(e){return Object.entries(e).map(([t,i])=>`;${dz(t)}=${dz(i)}`).join("")}function Lpe(e){let t=Object.entries(e).map(([i,r])=>Array.isArray(r)?r.map(s=>`${HA(i)}=${HA(s)}`).join("&"):`${HA(i)}=${HA(r)}`).filter(i=>i);return t.length?`?${t.join("&")}`:""}var zpe=/^[^\/()?;#]+/;function oz(e){let t=e.match(zpe);return t?t[0]:""}var Fpe=/^[^\/()?;=#]+/;function kpe(e){let t=e.match(Fpe);return t?t[0]:""}var Npe=/^[^=?&#]+/;function Bpe(e){let t=e.match(Npe);return t?t[0]:""}var Upe=/^[^&#]+/;function jpe(e){let t=e.match(Upe);return t?t[0]:""}var pz=class{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new os([],{}):new os([],this.parseChildren())}parseQueryParams(){let t={};if(this.consumeOptional("?"))do this.parseQueryParam(t);while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let i={};this.peekStartsWith("/(")&&(this.capture("/"),i=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(i).length>0)&&(r[vn]=new os(t,i)),r}parseSegment(){let t=oz(this.remaining);if(t===""&&this.peekStartsWith(";"))throw new Ui(4009,!1);return this.capture(t),new Kg(XA(t),this.parseMatrixParams())}parseMatrixParams(){let t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){let i=kpe(this.remaining);if(!i)return;this.capture(i);let r="";if(this.consumeOptional("=")){let s=oz(this.remaining);s&&(r=s,this.capture(r))}t[XA(i)]=XA(r)}parseQueryParam(t){let i=Bpe(this.remaining);if(!i)return;this.capture(i);let r="";if(this.consumeOptional("=")){let c=jpe(this.remaining);c&&(r=c,this.capture(r))}let s=H9(i),n=H9(r);if(t.hasOwnProperty(s)){let c=t[s];Array.isArray(c)||(c=[c],t[s]=c),c.push(n)}else t[s]=n}parseParens(t){let i={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=oz(this.remaining),s=this.remaining[r.length];if(s!=="/"&&s!==")"&&s!==";")throw new Ui(4010,!1);let n;r.indexOf(":")>-1?(n=r.slice(0,r.indexOf(":")),this.capture(n),this.capture(":")):t&&(n=vn);let c=this.parseChildren();i[n]=Object.keys(c).length===1?c[vn]:new os([],c),this.consumeOptional("//")}return i}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return this.peekStartsWith(t)?(this.remaining=this.remaining.substring(t.length),!0):!1}capture(t){if(!this.consumeOptional(t))throw new Ui(4011,!1)}};function iq(e){return e.segments.length>0?new os([],{[vn]:e}):e}function rq(e){let t={};for(let[r,s]of Object.entries(e.children)){let n=rq(s);if(r===vn&&n.segments.length===0&&n.hasChildren())for(let[c,u]of Object.entries(n.children))t[c]=u;else(n.segments.length>0||n.hasChildren())&&(t[r]=n)}let i=new os(e.segments,t);return Vpe(i)}function Vpe(e){if(e.numberOfChildren===1&&e.children[vn]){let t=e.children[vn];return new os(e.segments.concat(t.segments),t.children)}return e}function K0(e){return e instanceof Lf}function Gpe(e,t,i=null,r=null){let s=nq(e);return sq(s,t,i,r)}function nq(e){let t;function i(n){let c={};for(let p of n.children){let f=i(p);c[p.outlet]=f}let u=new os(n.url,c);return n===e&&(t=u),u}let r=i(e.root),s=iq(r);return t??s}function sq(e,t,i,r){let s=e;for(;s.parent;)s=s.parent;if(t.length===0)return az(s,s,s,i,r);let n=Hpe(t);if(n.toRoot())return az(s,s,new os([],{}),i,r);let c=Wpe(n,s,e),u=c.processChildren?rw(c.segmentGroup,c.index,n.commands):aq(c.segmentGroup,c.index,n.commands);return az(s,c.segmentGroup,u,i,r)}function ZA(e){return typeof e=="object"&&e!=null&&!e.outlets&&!e.segmentPath}function ow(e){return typeof e=="object"&&e!=null&&e.outlets}function az(e,t,i,r,s){let n={};r&&Object.entries(r).forEach(([p,f])=>{n[p]=Array.isArray(f)?f.map(x=>`${x}`):`${f}`});let c;e===t?c=i:c=oq(e,t,i);let u=iq(rq(c));return new Lf(u,n,s)}function oq(e,t,i){let r={};return Object.entries(e.children).forEach(([s,n])=>{n===t?r[s]=i:r[s]=oq(n,t,i)}),new os(e.segments,r)}var QA=class{constructor(t,i,r){if(this.isAbsolute=t,this.numberOfDoubleDots=i,this.commands=r,t&&r.length>0&&ZA(r[0]))throw new Ui(4003,!1);let s=r.find(ow);if(s&&s!==$9(r))throw new Ui(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function Hpe(e){if(typeof e[0]=="string"&&e.length===1&&e[0]==="/")return new QA(!0,0,e);let t=0,i=!1,r=e.reduce((s,n,c)=>{if(typeof n=="object"&&n!=null){if(n.outlets){let u={};return Object.entries(n.outlets).forEach(([p,f])=>{u[p]=typeof f=="string"?f.split("/"):f}),[...s,{outlets:u}]}if(n.segmentPath)return[...s,n.segmentPath]}return typeof n!="string"?[...s,n]:c===0?(n.split("/").forEach((u,p)=>{p==0&&u==="."||(p==0&&u===""?i=!0:u===".."?t++:u!=""&&s.push(u))}),s):[...s,n]},[]);return new QA(i,t,r)}var $0=class{constructor(t,i,r){this.segmentGroup=t,this.processChildren=i,this.index=r}};function Wpe(e,t,i){if(e.isAbsolute)return new $0(t,!0,0);if(!i)return new $0(t,!1,NaN);if(i.parent===null)return new $0(i,!0,0);let r=ZA(e.commands[0])?0:1,s=i.segments.length-1+r;return qpe(i,s,e.numberOfDoubleDots)}function qpe(e,t,i){let r=e,s=t,n=i;for(;n>s;){if(n-=s,r=r.parent,!r)throw new Ui(4005,!1);s=r.segments.length}return new $0(r,!1,s-n)}function Ype(e){return ow(e[0])?e[0].outlets:{[vn]:e}}function aq(e,t,i){if(e??=new os([],{}),e.segments.length===0&&e.hasChildren())return rw(e,t,i);let r=Xpe(e,t,i),s=i.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){let n=new os(e.segments.slice(0,r.pathIndex),{});return n.children[vn]=new os(e.segments.slice(r.pathIndex),e.children),rw(n,0,s)}else return r.match&&s.length===0?new os(e.segments,{}):r.match&&!e.hasChildren()?fz(e,t,i):r.match?rw(e,0,s):fz(e,t,i)}function rw(e,t,i){if(i.length===0)return new os(e.segments,{});{let r=Ype(i),s={};if(Object.keys(r).some(n=>n!==vn)&&e.children[vn]&&e.numberOfChildren===1&&e.children[vn].segments.length===0){let n=rw(e.children[vn],t,i);return new os(e.segments,n.children)}return Object.entries(r).forEach(([n,c])=>{typeof c=="string"&&(c=[c]),c!==null&&(s[n]=aq(e.children[n],t,c))}),Object.entries(e.children).forEach(([n,c])=>{r[n]===void 0&&(s[n]=c)}),new os(e.segments,s)}}function Xpe(e,t,i){let r=0,s=t,n={match:!1,pathIndex:0,commandIndex:0};for(;s<e.segments.length;){if(r>=i.length)return n;let c=e.segments[s],u=i[r];if(ow(u))break;let p=`${u}`,f=r<i.length-1?i[r+1]:null;if(s>0&&p===void 0)break;if(p&&f&&typeof f=="object"&&f.outlets===void 0){if(!q9(p,f,c))return n;r+=2}else{if(!q9(p,{},c))return n;r++}s++}return{match:!0,pathIndex:s,commandIndex:r}}function fz(e,t,i){let r=e.segments.slice(0,t),s=0;for(;s<i.length;){let n=i[s];if(ow(n)){let p=$pe(n.outlets);return new os(r,p)}if(s===0&&ZA(i[0])){let p=e.segments[t];r.push(new Kg(p.path,W9(i[0]))),s++;continue}let c=ow(n)?n.outlets[vn]:`${n}`,u=s<i.length-1?i[s+1]:null;c&&u&&ZA(u)?(r.push(new Kg(c,W9(u))),s+=2):(r.push(new Kg(c,{})),s++)}return new os(r,{})}function $pe(e){let t={};return Object.entries(e).forEach(([i,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(t[i]=fz(new os([],{}),0,r))}),t}function W9(e){let t={};return Object.entries(e).forEach(([i,r])=>t[i]=`${r}`),t}function q9(e,t,i){return e==i.path&&Ah(t,i.parameters)}var nw="imperative",Ea=function(e){return e[e.NavigationStart=0]="NavigationStart",e[e.NavigationEnd=1]="NavigationEnd",e[e.NavigationCancel=2]="NavigationCancel",e[e.NavigationError=3]="NavigationError",e[e.RoutesRecognized=4]="RoutesRecognized",e[e.ResolveStart=5]="ResolveStart",e[e.ResolveEnd=6]="ResolveEnd",e[e.GuardsCheckStart=7]="GuardsCheckStart",e[e.GuardsCheckEnd=8]="GuardsCheckEnd",e[e.RouteConfigLoadStart=9]="RouteConfigLoadStart",e[e.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",e[e.ChildActivationStart=11]="ChildActivationStart",e[e.ChildActivationEnd=12]="ChildActivationEnd",e[e.ActivationStart=13]="ActivationStart",e[e.ActivationEnd=14]="ActivationEnd",e[e.Scroll=15]="Scroll",e[e.NavigationSkipped=16]="NavigationSkipped",e}(Ea||{}),kc=class{constructor(t,i){this.id=t,this.url=i}},aw=class extends kc{constructor(t,i,r="imperative",s=null){super(t,i),this.type=Ea.NavigationStart,this.navigationTrigger=r,this.restoredState=s}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},ey=class extends kc{constructor(t,i,r){super(t,i),this.urlAfterRedirects=r,this.type=Ea.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},uc=function(e){return e[e.Redirect=0]="Redirect",e[e.SupersededByNewNavigation=1]="SupersededByNewNavigation",e[e.NoDataFromResolver=2]="NoDataFromResolver",e[e.GuardRejected=3]="GuardRejected",e}(uc||{}),mz=function(e){return e[e.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",e[e.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",e}(mz||{}),zf=class extends kc{constructor(t,i,r,s){super(t,i),this.reason=r,this.code=s,this.type=Ea.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},ty=class extends kc{constructor(t,i,r,s){super(t,i),this.reason=r,this.code=s,this.type=Ea.NavigationSkipped}},lw=class extends kc{constructor(t,i,r,s){super(t,i),this.error=r,this.target=s,this.type=Ea.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},KA=class extends kc{constructor(t,i,r,s){super(t,i),this.urlAfterRedirects=r,this.state=s,this.type=Ea.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},gz=class extends kc{constructor(t,i,r,s){super(t,i),this.urlAfterRedirects=r,this.state=s,this.type=Ea.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},yz=class extends kc{constructor(t,i,r,s,n){super(t,i),this.urlAfterRedirects=r,this.state=s,this.shouldActivate=n,this.type=Ea.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},vz=class extends kc{constructor(t,i,r,s){super(t,i),this.urlAfterRedirects=r,this.state=s,this.type=Ea.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},_z=class extends kc{constructor(t,i,r,s){super(t,i),this.urlAfterRedirects=r,this.state=s,this.type=Ea.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},xz=class{constructor(t){this.route=t,this.type=Ea.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},bz=class{constructor(t){this.route=t,this.type=Ea.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},wz=class{constructor(t){this.snapshot=t,this.type=Ea.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Sz=class{constructor(t){this.snapshot=t,this.type=Ea.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Ez=class{constructor(t){this.snapshot=t,this.type=Ea.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Mz=class{constructor(t){this.snapshot=t,this.type=Ea.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var cw=class{},uw=class{constructor(t){this.url=t}};var Tz=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new nC,this.attachRef=null}},nC=(()=>{let t=class t{constructor(){this.contexts=new Map}onChildOutletCreated(r,s){let n=this.getOrCreateContext(r);n.outlet=s,this.contexts.set(r,n)}onChildOutletDestroyed(r){let s=this.getContext(r);s&&(s.outlet=null,s.attachRef=null)}onOutletDeactivated(){let r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let s=this.getContext(r);return s||(s=new Tz,this.contexts.set(r,s)),s}getContext(r){return this.contexts.get(r)||null}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})(),JA=class{constructor(t){this._root=t}get root(){return this._root.value}parent(t){let i=this.pathFromRoot(t);return i.length>1?i[i.length-2]:null}children(t){let i=Az(t,this._root);return i?i.children.map(r=>r.value):[]}firstChild(t){let i=Az(t,this._root);return i&&i.children.length>0?i.children[0].value:null}siblings(t){let i=Cz(t,this._root);return i.length<2?[]:i[i.length-2].children.map(s=>s.value).filter(s=>s!==t)}pathFromRoot(t){return Cz(t,this._root).map(i=>i.value)}};function Az(e,t){if(e===t.value)return t;for(let i of t.children){let r=Az(e,i);if(r)return r}return null}function Cz(e,t){if(e===t.value)return[t];for(let i of t.children){let r=Cz(e,i);if(r.length)return r.unshift(t),r}return[]}var cc=class{constructor(t,i){this.value=t,this.children=i}toString(){return`TreeNode(${this.value})`}};function X0(e){let t={};return e&&e.children.forEach(i=>t[i.value.outlet]=i),t}var eC=class extends JA{constructor(t,i){super(t),this.snapshot=i,Bz(this,t)}toString(){return this.snapshot.toString()}};function lq(e){let t=Zpe(e),i=new wa([new Kg("",{})]),r=new wa({}),s=new wa({}),n=new wa({}),c=new wa(""),u=new Ff(i,r,n,c,s,vn,e,t.root);return u.snapshot=t.root,new eC(new cc(u,[]),t)}function Zpe(e){let t={},i={},r={},s="",n=new hw([],t,r,s,i,vn,e,null,{});return new tC("",new cc(n,[]))}var Ff=class{constructor(t,i,r,s,n,c,u,p){this.urlSubject=t,this.paramsSubject=i,this.queryParamsSubject=r,this.fragmentSubject=s,this.dataSubject=n,this.outlet=c,this.component=u,this._futureSnapshot=p,this.title=this.dataSubject?.pipe(Ti(f=>f[fw]))??rn(void 0),this.url=t,this.params=i,this.queryParams=r,this.fragment=s,this.data=n}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Ti(t=>Q0(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Ti(t=>Q0(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Nz(e,t,i="emptyOnly"){let r,{routeConfig:s}=e;return t!==null&&(i==="always"||s?.path===""||!t.component&&!t.routeConfig?.loadComponent)?r={params:me(me({},t.params),e.params),data:me(me({},t.data),e.data),resolve:me(me(me(me({},e.data),t.data),s?.data),e._resolvedData)}:r={params:me({},e.params),data:me({},e.data),resolve:me(me({},e.data),e._resolvedData??{})},s&&uq(s)&&(r.resolve[fw]=s.title),r}var hw=class{get title(){return this.data?.[fw]}constructor(t,i,r,s,n,c,u,p,f){this.url=t,this.params=i,this.queryParams=r,this.fragment=s,this.data=n,this.outlet=c,this.component=u,this.routeConfig=p,this._resolve=f}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Q0(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Q0(this.queryParams),this._queryParamMap}toString(){let t=this.url.map(r=>r.toString()).join("/"),i=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${t}', path:'${i}')`}},tC=class extends JA{constructor(t,i){super(i),this.url=t,Bz(this,i)}toString(){return cq(this._root)}};function Bz(e,t){t.value._routerState=e,t.children.forEach(i=>Bz(e,i))}function cq(e){let t=e.children.length>0?` { ${e.children.map(cq).join(", ")} } `:"";return`${e.value}${t}`}function lz(e){if(e.snapshot){let t=e.snapshot,i=e._futureSnapshot;e.snapshot=i,Ah(t.queryParams,i.queryParams)||e.queryParamsSubject.next(i.queryParams),t.fragment!==i.fragment&&e.fragmentSubject.next(i.fragment),Ah(t.params,i.params)||e.paramsSubject.next(i.params),Mpe(t.url,i.url)||e.urlSubject.next(i.url),Ah(t.data,i.data)||e.dataSubject.next(i.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function Dz(e,t){let i=Ah(e.params,t.params)&&Dpe(e.url,t.url),r=!e.parent!=!t.parent;return i&&!r&&(!e.parent||Dz(e.parent,t.parent))}function uq(e){return typeof e.title=="string"||e.title===null}var Uz=(()=>{let t=class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=vn,this.activateEvents=new Fc,this.deactivateEvents=new Fc,this.attachEvents=new Fc,this.detachEvents=new Fc,this.parentContexts=tr(nC),this.location=tr(Gd),this.changeDetector=tr(Yb),this.environmentInjector=tr(Rl),this.inputBinder=tr(jz,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){let{firstChange:s,previousValue:n}=r.name;if(s)return;this.isTrackedInParentContexts(n)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(n)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Ui(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Ui(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Ui(4012,!1);this.location.detach();let r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,s){this.activated=r,this._activatedRoute=s,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){let r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,s){if(this.isActivated)throw new Ui(4013,!1);this._activatedRoute=r;let n=this.location,u=r.snapshot.component,p=this.parentContexts.getOrCreateContext(this.name).children,f=new Iz(r,p,n.injector);this.activated=n.createComponent(u,{index:n.length,injector:f,environmentInjector:s??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};t.\u0275fac=function(s){return new(s||t)},t.\u0275dir=Hg({type:t,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Ub]});let e=t;return e})(),Iz=class e{__ngOutletInjector(t){return new e(this.route,this.childContexts,t)}constructor(t,i,r){this.route=t,this.childContexts=i,this.parent=r}get(t,i){return t===Ff?this.route:t===nC?this.childContexts:this.parent.get(t,i)}},jz=new an("");function Qpe(e,t,i){let r=dw(e,t._root,i?i._root:void 0);return new eC(r,t)}function dw(e,t,i){if(i&&e.shouldReuseRoute(t.value,i.value.snapshot)){let r=i.value;r._futureSnapshot=t.value;let s=Kpe(e,t,i);return new cc(r,s)}else{if(e.shouldAttach(t.value)){let n=e.retrieve(t.value);if(n!==null){let c=n.route;return c.value._futureSnapshot=t.value,c.children=t.children.map(u=>dw(e,u)),c}}let r=Jpe(t.value),s=t.children.map(n=>dw(e,n));return new cc(r,s)}}function Kpe(e,t,i){return t.children.map(r=>{for(let s of i.children)if(e.shouldReuseRoute(r.value,s.value.snapshot))return dw(e,r,s);return dw(e,r)})}function Jpe(e){return new Ff(new wa(e.url),new wa(e.params),new wa(e.queryParams),new wa(e.fragment),new wa(e.data),e.outlet,e.component,e)}var hq="ngNavigationCancelingError";function dq(e,t){let{redirectTo:i,navigationBehaviorOptions:r}=K0(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,s=pq(!1,uc.Redirect);return s.url=i,s.navigationBehaviorOptions=r,s}function pq(e,t){let i=new Error(`NavigationCancelingError: ${e||""}`);return i[hq]=!0,i.cancellationCode=t,i}function efe(e){return fq(e)&&K0(e.url)}function fq(e){return!!e&&e[hq]}var tfe=(()=>{let t=class t{};t.\u0275fac=function(s){return new(s||t)},t.\u0275cmp=xo({type:t,selectors:[["ng-component"]],standalone:!0,features:[bo],decls:1,vars:0,template:function(s,n){s&1&&Os(0,"router-outlet")},dependencies:[Uz],encapsulation:2});let e=t;return e})();function ife(e,t){return e.providers&&!e._injector&&(e._injector=OL(e.providers,t,`Route: ${e.path}`)),e._injector??t}function Vz(e){let t=e.children&&e.children.map(Vz),i=t?pt(me({},e),{children:t}):me({},e);return!i.component&&!i.loadComponent&&(t||i.loadChildren)&&i.outlet&&i.outlet!==vn&&(i.component=tfe),i}function Ch(e){return e.outlet||vn}function rfe(e,t){let i=e.filter(r=>Ch(r)===t);return i.push(...e.filter(r=>Ch(r)!==t)),i}function mw(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){let i=t.routeConfig;if(i?._loadedInjector)return i._loadedInjector;if(i?._injector)return i._injector}return null}var nfe=(e,t,i,r)=>Ti(s=>(new Pz(t,s.targetRouterState,s.currentRouterState,i,r).activate(e),s)),Pz=class{constructor(t,i,r,s,n){this.routeReuseStrategy=t,this.futureState=i,this.currState=r,this.forwardEvent=s,this.inputBindingEnabled=n}activate(t){let i=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(i,r,t),lz(this.futureState.root),this.activateChildRoutes(i,r,t)}deactivateChildRoutes(t,i,r){let s=X0(i);t.children.forEach(n=>{let c=n.value.outlet;this.deactivateRoutes(n,s[c],r),delete s[c]}),Object.values(s).forEach(n=>{this.deactivateRouteAndItsChildren(n,r)})}deactivateRoutes(t,i,r){let s=t.value,n=i?i.value:null;if(s===n)if(s.component){let c=r.getContext(s.outlet);c&&this.deactivateChildRoutes(t,i,c.children)}else this.deactivateChildRoutes(t,i,r);else n&&this.deactivateRouteAndItsChildren(i,r)}deactivateRouteAndItsChildren(t,i){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,i):this.deactivateRouteAndOutlet(t,i)}detachAndStoreRouteSubtree(t,i){let r=i.getContext(t.value.outlet),s=r&&t.value.component?r.children:i,n=X0(t);for(let c of Object.values(n))this.deactivateRouteAndItsChildren(c,s);if(r&&r.outlet){let c=r.outlet.detach(),u=r.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:c,route:t,contexts:u})}}deactivateRouteAndOutlet(t,i){let r=i.getContext(t.value.outlet),s=r&&t.value.component?r.children:i,n=X0(t);for(let c of Object.values(n))this.deactivateRouteAndItsChildren(c,s);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(t,i,r){let s=X0(i);t.children.forEach(n=>{this.activateRoutes(n,s[n.value.outlet],r),this.forwardEvent(new Mz(n.value.snapshot))}),t.children.length&&this.forwardEvent(new Sz(t.value.snapshot))}activateRoutes(t,i,r){let s=t.value,n=i?i.value:null;if(lz(s),s===n)if(s.component){let c=r.getOrCreateContext(s.outlet);this.activateChildRoutes(t,i,c.children)}else this.activateChildRoutes(t,i,r);else if(s.component){let c=r.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){let u=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),c.children.onOutletReAttached(u.contexts),c.attachRef=u.componentRef,c.route=u.route.value,c.outlet&&c.outlet.attach(u.componentRef,u.route.value),lz(u.route.value),this.activateChildRoutes(t,null,c.children)}else{let u=mw(s.snapshot);c.attachRef=null,c.route=s,c.injector=u,c.outlet&&c.outlet.activateWith(s,c.injector),this.activateChildRoutes(t,null,c.children)}}else this.activateChildRoutes(t,null,r)}},iC=class{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}},Z0=class{constructor(t,i){this.component=t,this.route=i}};function sfe(e,t,i){let r=e._root,s=t?t._root:null;return tw(r,s,i,[r.value])}function ofe(e){let t=e.routeConfig?e.routeConfig.canActivateChild:null;return!t||t.length===0?null:{node:e,guards:t}}function e_(e,t){let i=Symbol(),r=t.get(e,i);return r===i?typeof e=="function"&&!n8(e)?e:t.get(e):r}function tw(e,t,i,r,s={canDeactivateChecks:[],canActivateChecks:[]}){let n=X0(t);return e.children.forEach(c=>{afe(c,n[c.value.outlet],i,r.concat([c.value]),s),delete n[c.value.outlet]}),Object.entries(n).forEach(([c,u])=>sw(u,i.getContext(c),s)),s}function afe(e,t,i,r,s={canDeactivateChecks:[],canActivateChecks:[]}){let n=e.value,c=t?t.value:null,u=i?i.getContext(e.value.outlet):null;if(c&&n.routeConfig===c.routeConfig){let p=lfe(c,n,n.routeConfig.runGuardsAndResolvers);p?s.canActivateChecks.push(new iC(r)):(n.data=c.data,n._resolvedData=c._resolvedData),n.component?tw(e,t,u?u.children:null,r,s):tw(e,t,i,r,s),p&&u&&u.outlet&&u.outlet.isActivated&&s.canDeactivateChecks.push(new Z0(u.outlet.component,c))}else c&&sw(t,u,s),s.canActivateChecks.push(new iC(r)),n.component?tw(e,null,u?u.children:null,r,s):tw(e,null,i,r,s);return s}function lfe(e,t,i){if(typeof i=="function")return i(e,t);switch(i){case"pathParamsChange":return!Jg(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Jg(e.url,t.url)||!Ah(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Dz(e,t)||!Ah(e.queryParams,t.queryParams);case"paramsChange":default:return!Dz(e,t)}}function sw(e,t,i){let r=X0(e),s=e.value;Object.entries(r).forEach(([n,c])=>{s.component?t?sw(c,t.children.getContext(n),i):sw(c,null,i):sw(c,t,i)}),s.component?t&&t.outlet&&t.outlet.isActivated?i.canDeactivateChecks.push(new Z0(t.outlet.component,s)):i.canDeactivateChecks.push(new Z0(null,s)):i.canDeactivateChecks.push(new Z0(null,s))}function gw(e){return typeof e=="function"}function cfe(e){return typeof e=="boolean"}function ufe(e){return e&&gw(e.canLoad)}function hfe(e){return e&&gw(e.canActivate)}function dfe(e){return e&&gw(e.canActivateChild)}function pfe(e){return e&&gw(e.canDeactivate)}function ffe(e){return e&&gw(e.canMatch)}function mq(e){return e instanceof Ld||e?.name==="EmptyError"}var WA=Symbol("INITIAL_VALUE");function J0(){return tc(e=>IT(e.map(t=>t.pipe(zd(1),qO(WA)))).pipe(Ti(t=>{for(let i of t)if(i!==!0){if(i===WA)return WA;if(i===!1||i instanceof Lf)return i}return!0}),Nr(t=>t!==WA),zd(1)))}function mfe(e,t){return Vo(i=>{let{targetSnapshot:r,currentSnapshot:s,guards:{canActivateChecks:n,canDeactivateChecks:c}}=i;return c.length===0&&n.length===0?rn(pt(me({},i),{guardsResult:!0})):gfe(c,r,s,e).pipe(Vo(u=>u&&cfe(u)?yfe(r,n,e,t):rn(u)),Ti(u=>pt(me({},i),{guardsResult:u})))})}function gfe(e,t,i,r){return ao(e).pipe(Vo(s=>wfe(s.component,s.route,i,t,r)),xh(s=>s!==!0,!0))}function yfe(e,t,i,r){return ao(t).pipe(Sf(s=>b0(_fe(s.route.parent,r),vfe(s.route,r),bfe(e,s.path,i),xfe(e,s.route,i))),xh(s=>s!==!0,!0))}function vfe(e,t){return e!==null&&t&&t(new Ez(e)),rn(!0)}function _fe(e,t){return e!==null&&t&&t(new wz(e)),rn(!0)}function xfe(e,t,i){let r=t.routeConfig?t.routeConfig.canActivate:null;if(!r||r.length===0)return rn(!0);let s=r.map(n=>PT(()=>{let c=mw(t)??i,u=e_(n,c),p=hfe(u)?u.canActivate(t,e):Ud(c,()=>u(t,e));return kf(p).pipe(xh())}));return rn(s).pipe(J0())}function bfe(e,t,i){let r=t[t.length-1],n=t.slice(0,t.length-1).reverse().map(c=>ofe(c)).filter(c=>c!==null).map(c=>PT(()=>{let u=c.guards.map(p=>{let f=mw(c.node)??i,x=e_(p,f),w=dfe(x)?x.canActivateChild(r,e):Ud(f,()=>x(r,e));return kf(w).pipe(xh())});return rn(u).pipe(J0())}));return rn(n).pipe(J0())}function wfe(e,t,i,r,s){let n=t&&t.routeConfig?t.routeConfig.canDeactivate:null;if(!n||n.length===0)return rn(!0);let c=n.map(u=>{let p=mw(t)??s,f=e_(u,p),x=pfe(f)?f.canDeactivate(e,t,i,r):Ud(p,()=>f(e,t,i,r));return kf(x).pipe(xh())});return rn(c).pipe(J0())}function Sfe(e,t,i,r){let s=t.canLoad;if(s===void 0||s.length===0)return rn(!0);let n=s.map(c=>{let u=e_(c,e),p=ufe(u)?u.canLoad(t,i):Ud(e,()=>u(t,i));return kf(p)});return rn(n).pipe(J0(),gq(r))}function gq(e){return kO(na(t=>{if(K0(t))throw dq(e,t)}),Ti(t=>t===!0))}function Efe(e,t,i,r){let s=t.canMatch;if(!s||s.length===0)return rn(!0);let n=s.map(c=>{let u=e_(c,e),p=ffe(u)?u.canMatch(t,i):Ud(e,()=>u(t,i));return kf(p)});return rn(n).pipe(J0(),gq(r))}var pw=class{constructor(t){this.segmentGroup=t||null}},rC=class extends Error{constructor(t){super(),this.urlTree=t}};function Y0(e){return x0(new pw(e))}function Mfe(e){return x0(new Ui(4e3,!1))}function Tfe(e){return x0(pq(!1,uc.GuardRejected))}var Rz=class{constructor(t,i){this.urlSerializer=t,this.urlTree=i}lineralizeSegments(t,i){let r=[],s=i.root;for(;;){if(r=r.concat(s.segments),s.numberOfChildren===0)return rn(r);if(s.numberOfChildren>1||!s.children[vn])return Mfe(t.redirectTo);s=s.children[vn]}}applyRedirectCommands(t,i,r){let s=this.applyRedirectCreateUrlTree(i,this.urlSerializer.parse(i),t,r);if(i.startsWith("/"))throw new rC(s);return s}applyRedirectCreateUrlTree(t,i,r,s){let n=this.createSegmentGroup(t,i.root,r,s);return new Lf(n,this.createQueryParams(i.queryParams,this.urlTree.queryParams),i.fragment)}createQueryParams(t,i){let r={};return Object.entries(t).forEach(([s,n])=>{if(typeof n=="string"&&n.startsWith(":")){let u=n.substring(1);r[s]=i[u]}else r[s]=n}),r}createSegmentGroup(t,i,r,s){let n=this.createSegments(t,i.segments,r,s),c={};return Object.entries(i.children).forEach(([u,p])=>{c[u]=this.createSegmentGroup(t,p,r,s)}),new os(n,c)}createSegments(t,i,r,s){return i.map(n=>n.path.startsWith(":")?this.findPosParam(t,n,s):this.findOrReturn(n,r))}findPosParam(t,i,r){let s=r[i.path.substring(1)];if(!s)throw new Ui(4001,!1);return s}findOrReturn(t,i){let r=0;for(let s of i){if(s.path===t.path)return i.splice(r),s;r++}return t}},Oz={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Afe(e,t,i,r,s){let n=Gz(e,t,i);return n.matched?(r=ife(t,r),Efe(r,t,i,s).pipe(Ti(c=>c===!0?n:me({},Oz)))):rn(n)}function Gz(e,t,i){if(t.path==="**")return Cfe(i);if(t.path==="")return t.pathMatch==="full"&&(e.hasChildren()||i.length>0)?me({},Oz):{matched:!0,consumedSegments:[],remainingSegments:i,parameters:{},positionalParamSegments:{}};let s=(t.matcher||Epe)(i,e,t);if(!s)return me({},Oz);let n={};Object.entries(s.posParams??{}).forEach(([u,p])=>{n[u]=p.path});let c=s.consumed.length>0?me(me({},n),s.consumed[s.consumed.length-1].parameters):n;return{matched:!0,consumedSegments:s.consumed,remainingSegments:i.slice(s.consumed.length),parameters:c,positionalParamSegments:s.posParams??{}}}function Cfe(e){return{matched:!0,parameters:e.length>0?$9(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}function Y9(e,t,i,r){return i.length>0&&Pfe(e,i,r)?{segmentGroup:new os(t,Ife(r,new os(i,e.children))),slicedSegments:[]}:i.length===0&&Rfe(e,i,r)?{segmentGroup:new os(e.segments,Dfe(e,i,r,e.children)),slicedSegments:i}:{segmentGroup:new os(e.segments,e.children),slicedSegments:i}}function Dfe(e,t,i,r){let s={};for(let n of i)if(sC(e,t,n)&&!r[Ch(n)]){let c=new os([],{});s[Ch(n)]=c}return me(me({},r),s)}function Ife(e,t){let i={};i[vn]=t;for(let r of e)if(r.path===""&&Ch(r)!==vn){let s=new os([],{});i[Ch(r)]=s}return i}function Pfe(e,t,i){return i.some(r=>sC(e,t,r)&&Ch(r)!==vn)}function Rfe(e,t,i){return i.some(r=>sC(e,t,r))}function sC(e,t,i){return(e.hasChildren()||t.length>0)&&i.pathMatch==="full"?!1:i.path===""}function Ofe(e,t,i,r){return Ch(e)!==r&&(r===vn||!sC(t,i,e))?!1:Gz(t,e,i).matched}function Lfe(e,t,i){return t.length===0&&!e.children[i]}var Lz=class{};function zfe(e,t,i,r,s,n,c="emptyOnly"){return new zz(e,t,i,r,s,c,n).recognize()}var Ffe=31,zz=class{constructor(t,i,r,s,n,c,u){this.injector=t,this.configLoader=i,this.rootComponentType=r,this.config=s,this.urlTree=n,this.paramsInheritanceStrategy=c,this.urlSerializer=u,this.applyRedirects=new Rz(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(t){return new Ui(4002,`'${t.segmentGroup}'`)}recognize(){let t=Y9(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe(Ti(i=>{let r=new hw([],Object.freeze({}),Object.freeze(me({},this.urlTree.queryParams)),this.urlTree.fragment,{},vn,this.rootComponentType,null,{}),s=new cc(r,i),n=new tC("",s),c=Gpe(r,[],this.urlTree.queryParams,this.urlTree.fragment);return c.queryParams=this.urlTree.queryParams,n.url=this.urlSerializer.serialize(c),this.inheritParamsAndData(n._root,null),{state:n,tree:c}}))}match(t){return this.processSegmentGroup(this.injector,this.config,t,vn).pipe(wf(r=>{if(r instanceof rC)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof pw?this.noMatchError(r):r}))}inheritParamsAndData(t,i){let r=t.value,s=Nz(r,i,this.paramsInheritanceStrategy);r.params=Object.freeze(s.params),r.data=Object.freeze(s.data),t.children.forEach(n=>this.inheritParamsAndData(n,r))}processSegmentGroup(t,i,r,s){return r.segments.length===0&&r.hasChildren()?this.processChildren(t,i,r):this.processSegment(t,i,r,r.segments,s,!0).pipe(Ti(n=>n instanceof cc?[n]:[]))}processChildren(t,i,r){let s=[];for(let n of Object.keys(r.children))n==="primary"?s.unshift(n):s.push(n);return ao(s).pipe(Sf(n=>{let c=r.children[n],u=rfe(i,n);return this.processSegmentGroup(t,u,c,n)}),WO((n,c)=>(n.push(...c),n)),Ef(null),HO(),Vo(n=>{if(n===null)return Y0(r);let c=yq(n);return kfe(c),rn(c)}))}processSegment(t,i,r,s,n,c){return ao(i).pipe(Sf(u=>this.processSegmentAgainstRoute(u._injector??t,i,u,r,s,n,c).pipe(wf(p=>{if(p instanceof pw)return rn(null);throw p}))),xh(u=>!!u),wf(u=>{if(mq(u))return Lfe(r,s,n)?rn(new Lz):Y0(r);throw u}))}processSegmentAgainstRoute(t,i,r,s,n,c,u){return Ofe(r,s,n,c)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(t,s,r,n,c):this.allowRedirects&&u?this.expandSegmentAgainstRouteUsingRedirect(t,s,i,r,n,c):Y0(s):Y0(s)}expandSegmentAgainstRouteUsingRedirect(t,i,r,s,n,c){let{matched:u,consumedSegments:p,positionalParamSegments:f,remainingSegments:x}=Gz(i,s,n);if(!u)return Y0(i);s.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>Ffe&&(this.allowRedirects=!1));let w=this.applyRedirects.applyRedirectCommands(p,s.redirectTo,f);return this.applyRedirects.lineralizeSegments(s,w).pipe(Vo(E=>this.processSegment(t,r,i,E.concat(x),c,!1)))}matchSegmentAgainstRoute(t,i,r,s,n){let c=Afe(i,r,s,t,this.urlSerializer);return r.path==="**"&&(i.children={}),c.pipe(tc(u=>u.matched?(t=r._injector??t,this.getChildConfig(t,r,s).pipe(tc(({routes:p})=>{let f=r._loadedInjector??t,{consumedSegments:x,remainingSegments:w,parameters:E}=u,A=new hw(x,E,Object.freeze(me({},this.urlTree.queryParams)),this.urlTree.fragment,Bfe(r),Ch(r),r.component??r._loadedComponent??null,r,Ufe(r)),{segmentGroup:I,slicedSegments:P}=Y9(i,x,w,p);if(P.length===0&&I.hasChildren())return this.processChildren(f,p,I).pipe(Ti(k=>k===null?null:new cc(A,k)));if(p.length===0&&P.length===0)return rn(new cc(A,[]));let O=Ch(r)===n;return this.processSegment(f,p,I,P,O?vn:n,!0).pipe(Ti(k=>new cc(A,k instanceof cc?[k]:[])))}))):Y0(i)))}getChildConfig(t,i,r){return i.children?rn({routes:i.children,injector:t}):i.loadChildren?i._loadedRoutes!==void 0?rn({routes:i._loadedRoutes,injector:i._loadedInjector}):Sfe(t,i,r,this.urlSerializer).pipe(Vo(s=>s?this.configLoader.loadChildren(t,i).pipe(na(n=>{i._loadedRoutes=n.routes,i._loadedInjector=n.injector})):Tfe(i))):rn({routes:[],injector:t})}};function kfe(e){e.sort((t,i)=>t.value.outlet===vn?-1:i.value.outlet===vn?1:t.value.outlet.localeCompare(i.value.outlet))}function Nfe(e){let t=e.value.routeConfig;return t&&t.path===""}function yq(e){let t=[],i=new Set;for(let r of e){if(!Nfe(r)){t.push(r);continue}let s=t.find(n=>r.value.routeConfig===n.value.routeConfig);s!==void 0?(s.children.push(...r.children),i.add(s)):t.push(r)}for(let r of i){let s=yq(r.children);t.push(new cc(r.value,s))}return t.filter(r=>!i.has(r))}function Bfe(e){return e.data||{}}function Ufe(e){return e.resolve||{}}function jfe(e,t,i,r,s,n){return Vo(c=>zfe(e,t,i,r,c.extractedUrl,s,n).pipe(Ti(({state:u,tree:p})=>pt(me({},c),{targetSnapshot:u,urlAfterRedirects:p}))))}function Vfe(e,t){return Vo(i=>{let{targetSnapshot:r,guards:{canActivateChecks:s}}=i;if(!s.length)return rn(i);let n=new Set(s.map(p=>p.route)),c=new Set;for(let p of n)if(!c.has(p))for(let f of vq(p))c.add(f);let u=0;return ao(c).pipe(Sf(p=>n.has(p)?Gfe(p,r,e,t):(p.data=Nz(p,p.parent,e).resolve,rn(void 0))),na(()=>u++),w0(1),Vo(p=>u===c.size?rn(i):ec))})}function vq(e){let t=e.children.map(i=>vq(i)).flat();return[e,...t]}function Gfe(e,t,i,r){let s=e.routeConfig,n=e._resolve;return s?.title!==void 0&&!uq(s)&&(n[fw]=s.title),Hfe(n,e,t,r).pipe(Ti(c=>(e._resolvedData=c,e.data=Nz(e,e.parent,i).resolve,null)))}function Hfe(e,t,i,r){let s=hz(e);if(s.length===0)return rn({});let n={};return ao(s).pipe(Vo(c=>Wfe(e[c],t,i,r).pipe(xh(),na(u=>{n[c]=u}))),w0(1),GO(n),wf(c=>mq(c)?ec:x0(c)))}function Wfe(e,t,i,r){let s=mw(t)??r,n=e_(e,s),c=n.resolve?n.resolve(t,i):Ud(s,()=>n(t,i));return kf(c)}function cz(e){return tc(t=>{let i=e(t);return i?ao(i).pipe(Ti(()=>t)):rn(t)})}var _q=(()=>{let t=class t{buildTitle(r){let s,n=r.root;for(;n!==void 0;)s=this.getResolvedTitleForRoute(n)??s,n=n.children.find(c=>c.outlet===vn);return s}getResolvedTitleForRoute(r){return r.data[fw]}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:()=>tr(qfe),providedIn:"root"});let e=t;return e})(),qfe=(()=>{let t=class t extends _q{constructor(r){super(),this.title=r}updateTitle(r){let s=this.buildTitle(r);s!==void 0&&this.title.setTitle(s)}};t.\u0275fac=function(s){return new(s||t)(Er(V9))},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})(),Hz=new an("",{providedIn:"root",factory:()=>({})}),Wz=new an(""),Yfe=(()=>{let t=class t{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=tr(UL)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return rn(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);let s=kf(r.loadComponent()).pipe(Ti(xq),na(c=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=c}),Mf(()=>{this.componentLoaders.delete(r)})),n=new _0(s,()=>new cl).pipe(v0());return this.componentLoaders.set(r,n),n}loadChildren(r,s){if(this.childrenLoaders.get(s))return this.childrenLoaders.get(s);if(s._loadedRoutes)return rn({routes:s._loadedRoutes,injector:s._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(s);let c=Xfe(s,this.compiler,r,this.onLoadEndListener).pipe(Mf(()=>{this.childrenLoaders.delete(s)})),u=new _0(c,()=>new cl).pipe(v0());return this.childrenLoaders.set(s,u),u}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function Xfe(e,t,i,r){return kf(e.loadChildren()).pipe(Ti(xq),Vo(s=>s instanceof Lb||Array.isArray(s)?rn(s):ao(t.compileModuleAsync(s))),Ti(s=>{r&&r(e);let n,c,u=!1;return Array.isArray(s)?(c=s,u=!0):(n=s.create(i).injector,c=n.get(Wz,[],{optional:!0,self:!0}).flat()),{routes:c.map(Vz),injector:n}}))}function $fe(e){return e&&typeof e=="object"&&"default"in e}function xq(e){return $fe(e)?e.default:e}var qz=(()=>{let t=class t{};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:()=>tr(Zfe),providedIn:"root"});let e=t;return e})(),Zfe=(()=>{let t=class t{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,s){return r}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})(),Qfe=new an("");var Kfe=(()=>{let t=class t{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new cl,this.transitionAbortSubject=new cl,this.configLoader=tr(Yfe),this.environmentInjector=tr(Rl),this.urlSerializer=tr(kz),this.rootContexts=tr(nC),this.location=tr(Xb),this.inputBindingEnabled=tr(jz,{optional:!0})!==null,this.titleStrategy=tr(_q),this.options=tr(Hz,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=tr(qz),this.createViewTransition=tr(Qfe,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>rn(void 0),this.rootComponentType=null;let r=n=>this.events.next(new xz(n)),s=n=>this.events.next(new bz(n));this.configLoader.onLoadEndListener=s,this.configLoader.onLoadStartListener=r}complete(){this.transitions?.complete()}handleNavigationRequest(r){let s=++this.navigationId;this.transitions?.next(pt(me(me({},this.transitions.value),r),{id:s}))}setupNavigations(r,s,n){return this.transitions=new wa({id:0,currentUrlTree:s,currentRawUrl:s,extractedUrl:this.urlHandlingStrategy.extract(s),urlAfterRedirects:this.urlHandlingStrategy.extract(s),rawUrl:s,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:nw,restoredState:null,currentSnapshot:n.snapshot,targetSnapshot:null,currentRouterState:n,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Nr(c=>c.id!==0),Ti(c=>pt(me({},c),{extractedUrl:this.urlHandlingStrategy.extract(c.rawUrl)})),tc(c=>{let u=!1,p=!1;return rn(c).pipe(tc(f=>{if(this.navigationId>c.id)return this.cancelNavigationTransition(c,"",uc.SupersededByNewNavigation),ec;this.currentTransition=c,this.currentNavigation={id:f.id,initialUrl:f.rawUrl,extractedUrl:f.extractedUrl,trigger:f.source,extras:f.extras,previousNavigation:this.lastSuccessfulNavigation?pt(me({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let x=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),w=f.extras.onSameUrlNavigation??r.onSameUrlNavigation;if(!x&&w!=="reload"){let E="";return this.events.next(new ty(f.id,this.urlSerializer.serialize(f.rawUrl),E,mz.IgnoredSameUrlNavigation)),f.resolve(null),ec}if(this.urlHandlingStrategy.shouldProcessUrl(f.rawUrl))return rn(f).pipe(tc(E=>{let A=this.transitions?.getValue();return this.events.next(new aw(E.id,this.urlSerializer.serialize(E.extractedUrl),E.source,E.restoredState)),A!==this.transitions?.getValue()?ec:Promise.resolve(E)}),jfe(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),na(E=>{c.targetSnapshot=E.targetSnapshot,c.urlAfterRedirects=E.urlAfterRedirects,this.currentNavigation=pt(me({},this.currentNavigation),{finalUrl:E.urlAfterRedirects});let A=new KA(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(A)}));if(x&&this.urlHandlingStrategy.shouldProcessUrl(f.currentRawUrl)){let{id:E,extractedUrl:A,source:I,restoredState:P,extras:O}=f,k=new aw(E,this.urlSerializer.serialize(A),I,P);this.events.next(k);let U=lq(this.rootComponentType).snapshot;return this.currentTransition=c=pt(me({},f),{targetSnapshot:U,urlAfterRedirects:A,extras:pt(me({},O),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=A,rn(c)}else{let E="";return this.events.next(new ty(f.id,this.urlSerializer.serialize(f.extractedUrl),E,mz.IgnoredByUrlHandlingStrategy)),f.resolve(null),ec}}),na(f=>{let x=new gz(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(x)}),Ti(f=>(this.currentTransition=c=pt(me({},f),{guards:sfe(f.targetSnapshot,f.currentSnapshot,this.rootContexts)}),c)),mfe(this.environmentInjector,f=>this.events.next(f)),na(f=>{if(c.guardsResult=f.guardsResult,K0(f.guardsResult))throw dq(this.urlSerializer,f.guardsResult);let x=new yz(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot,!!f.guardsResult);this.events.next(x)}),Nr(f=>f.guardsResult?!0:(this.cancelNavigationTransition(f,"",uc.GuardRejected),!1)),cz(f=>{if(f.guards.canActivateChecks.length)return rn(f).pipe(na(x=>{let w=new vz(x.id,this.urlSerializer.serialize(x.extractedUrl),this.urlSerializer.serialize(x.urlAfterRedirects),x.targetSnapshot);this.events.next(w)}),tc(x=>{let w=!1;return rn(x).pipe(Vfe(this.paramsInheritanceStrategy,this.environmentInjector),na({next:()=>w=!0,complete:()=>{w||this.cancelNavigationTransition(x,"",uc.NoDataFromResolver)}}))}),na(x=>{let w=new _z(x.id,this.urlSerializer.serialize(x.extractedUrl),this.urlSerializer.serialize(x.urlAfterRedirects),x.targetSnapshot);this.events.next(w)}))}),cz(f=>{let x=w=>{let E=[];w.routeConfig?.loadComponent&&!w.routeConfig._loadedComponent&&E.push(this.configLoader.loadComponent(w.routeConfig).pipe(na(A=>{w.component=A}),Ti(()=>{})));for(let A of w.children)E.push(...x(A));return E};return IT(x(f.targetSnapshot.root)).pipe(Ef(null),zd(1))}),cz(()=>this.afterPreactivation()),tc(()=>{let{currentSnapshot:f,targetSnapshot:x}=c,w=this.createViewTransition?.(this.environmentInjector,f.root,x.root);return w?ao(w).pipe(Ti(()=>c)):rn(c)}),Ti(f=>{let x=Qpe(r.routeReuseStrategy,f.targetSnapshot,f.currentRouterState);return this.currentTransition=c=pt(me({},f),{targetRouterState:x}),this.currentNavigation.targetRouterState=x,c}),na(()=>{this.events.next(new cw)}),nfe(this.rootContexts,r.routeReuseStrategy,f=>this.events.next(f),this.inputBindingEnabled),zd(1),na({next:f=>{u=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new ey(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects))),this.titleStrategy?.updateTitle(f.targetRouterState.snapshot),f.resolve(!0)},complete:()=>{u=!0}}),YO(this.transitionAbortSubject.pipe(na(f=>{throw f}))),Mf(()=>{!u&&!p&&this.cancelNavigationTransition(c,"",uc.SupersededByNewNavigation),this.currentTransition?.id===c.id&&(this.currentNavigation=null,this.currentTransition=null)}),wf(f=>{if(p=!0,fq(f))this.events.next(new zf(c.id,this.urlSerializer.serialize(c.extractedUrl),f.message,f.cancellationCode)),efe(f)?this.events.next(new uw(f.url)):c.resolve(!1);else{this.events.next(new lw(c.id,this.urlSerializer.serialize(c.extractedUrl),f,c.targetSnapshot??void 0));try{c.resolve(r.errorHandler(f))}catch(x){this.options.resolveNavigationPromiseOnError?c.resolve(!1):c.reject(x)}}return ec}))}))}cancelNavigationTransition(r,s,n){let c=new zf(r.id,this.urlSerializer.serialize(r.extractedUrl),s,n);this.events.next(c),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function Jfe(e){return e!==nw}var eme=(()=>{let t=class t{};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:()=>tr(tme),providedIn:"root"});let e=t;return e})(),Fz=class{shouldDetach(t){return!1}store(t,i){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,i){return t.routeConfig===i.routeConfig}},tme=(()=>{let t=class t extends Fz{};t.\u0275fac=(()=>{let r;return function(n){return(r||(r=pL(t)))(n||t)}})(),t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})(),bq=(()=>{let t=class t{};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:()=>tr(ime),providedIn:"root"});let e=t;return e})(),ime=(()=>{let t=class t extends bq{constructor(){super(...arguments),this.location=tr(Xb),this.urlSerializer=tr(kz),this.options=tr(Hz,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=tr(qz),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Lf,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=lq(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(r){return this.location.subscribe(s=>{s.type==="popstate"&&r(s.url,s.state)})}handleRouterEvent(r,s){if(r instanceof aw)this.stateMemento=this.createStateMemento();else if(r instanceof ty)this.rawUrlTree=s.initialUrl;else if(r instanceof KA){if(this.urlUpdateStrategy==="eager"&&!s.extras.skipLocationChange){let n=this.urlHandlingStrategy.merge(s.finalUrl,s.initialUrl);this.setBrowserUrl(n,s)}}else r instanceof cw?(this.currentUrlTree=s.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(s.finalUrl,s.initialUrl),this.routerState=s.targetRouterState,this.urlUpdateStrategy==="deferred"&&(s.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,s))):r instanceof zf&&(r.code===uc.GuardRejected||r.code===uc.NoDataFromResolver)?this.restoreHistory(s):r instanceof lw?this.restoreHistory(s,!0):r instanceof ey&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,s){let n=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(n)||s.extras.replaceUrl){let c=this.browserPageId,u=me(me({},s.extras.state),this.generateNgRouterState(s.id,c));this.location.replaceState(n,"",u)}else{let c=me(me({},s.extras.state),this.generateNgRouterState(s.id,this.browserPageId+1));this.location.go(n,"",c)}}restoreHistory(r,s=!1){if(this.canceledNavigationResolution==="computed"){let n=this.browserPageId,c=this.currentPageId-n;c!==0?this.location.historyGo(c):this.currentUrlTree===r.finalUrl&&c===0&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(s&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,s){return this.canceledNavigationResolution==="computed"?{navigationId:r,\u0275routerPageId:s}:{navigationId:r}}};t.\u0275fac=(()=>{let r;return function(n){return(r||(r=pL(t)))(n||t)}})(),t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})(),iw=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(iw||{});function rme(e,t){e.events.pipe(Nr(i=>i instanceof ey||i instanceof zf||i instanceof lw||i instanceof ty),Ti(i=>i instanceof ey||i instanceof ty?iw.COMPLETE:(i instanceof zf?i.code===uc.Redirect||i.code===uc.SupersededByNewNavigation:!1)?iw.REDIRECTING:iw.FAILED),Nr(i=>i!==iw.REDIRECTING),zd(1)).subscribe(()=>{t()})}function nme(e){throw e}var sme={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},ome={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},oC=(()=>{let t=class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=tr(CA),this.stateManager=tr(bq),this.options=tr(Hz,{optional:!0})||{},this.pendingTasks=tr(Xg),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=tr(Kfe),this.urlSerializer=tr(kz),this.location=tr(Xb),this.urlHandlingStrategy=tr(qz),this._events=new cl,this.errorHandler=this.options.errorHandler||nme,this.navigated=!1,this.routeReuseStrategy=tr(eme),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=tr(Wz,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!tr(jz,{optional:!0}),this.eventsSubscription=new jo,this.isNgZoneEnabled=tr(Ys)instanceof Ys&&Ys.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let r=this.navigationTransitions.events.subscribe(s=>{try{let n=this.navigationTransitions.currentTransition,c=this.navigationTransitions.currentNavigation;if(n!==null&&c!==null){if(this.stateManager.handleRouterEvent(s,c),s instanceof zf&&s.code!==uc.Redirect&&s.code!==uc.SupersededByNewNavigation)this.navigated=!0;else if(s instanceof ey)this.navigated=!0;else if(s instanceof uw){let u=this.urlHandlingStrategy.merge(s.url,n.currentRawUrl),p={info:n.extras.info,skipLocationChange:n.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||Jfe(n.source)};this.scheduleNavigation(u,nw,null,p,{resolve:n.resolve,reject:n.reject,promise:n.promise})}}lme(s)&&this._events.next(s)}catch(n){this.navigationTransitions.transitionAbortSubject.next(n)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),nw,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((r,s)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(r,"popstate",s)},0)})}navigateToSyncWithBrowser(r,s,n){let c={replaceUrl:!0},u=n?.navigationId?n:null;if(n){let f=me({},n);delete f.navigationId,delete f.\u0275routerPageId,Object.keys(f).length!==0&&(c.state=f)}let p=this.parseUrl(r);this.scheduleNavigation(p,s,u,c)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map(Vz),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,s={}){let{relativeTo:n,queryParams:c,fragment:u,queryParamsHandling:p,preserveFragment:f}=s,x=f?this.currentUrlTree.fragment:u,w=null;switch(p){case"merge":w=me(me({},this.currentUrlTree.queryParams),c);break;case"preserve":w=this.currentUrlTree.queryParams;break;default:w=c||null}w!==null&&(w=this.removeEmptyProps(w));let E;try{let A=n?n.snapshot:this.routerState.snapshot.root;E=nq(A)}catch{(typeof r[0]!="string"||!r[0].startsWith("/"))&&(r=[]),E=this.currentUrlTree.root}return sq(E,r,w,x??null)}navigateByUrl(r,s={skipLocationChange:!1}){let n=K0(r)?r:this.parseUrl(r),c=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(c,nw,null,s)}navigate(r,s={skipLocationChange:!1}){return ame(r),this.navigateByUrl(this.createUrlTree(r,s),s)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,s){let n;if(s===!0?n=me({},sme):s===!1?n=me({},ome):n=s,K0(r))return G9(this.currentUrlTree,r,n);let c=this.parseUrl(r);return G9(this.currentUrlTree,c,n)}removeEmptyProps(r){return Object.entries(r).reduce((s,[n,c])=>(c!=null&&(s[n]=c),s),{})}scheduleNavigation(r,s,n,c,u){if(this.disposed)return Promise.resolve(!1);let p,f,x;u?(p=u.resolve,f=u.reject,x=u.promise):x=new Promise((E,A)=>{p=E,f=A});let w=this.pendingTasks.add();return rme(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(w))}),this.navigationTransitions.handleNavigationRequest({source:s,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:c,resolve:p,reject:f,promise:x,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),x.catch(E=>Promise.reject(E))}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function ame(e){for(let t=0;t<e.length;t++)if(e[t]==null)throw new Ui(4008,!1)}function lme(e){return!(e instanceof cw)&&!(e instanceof uw)}var cme=new an("");function wq(e,...t){return z0([{provide:Wz,multi:!0,useValue:e},[],{provide:Ff,useFactory:ume,deps:[oC]},{provide:DA,multi:!0,useFactory:hme},t.map(i=>i.\u0275providers)])}function ume(e){return e.routerState.root}function hme(){let e=tr(qg);return t=>{let i=e.get(j0);if(t!==i.components[0])return;let r=e.get(oC),s=e.get(dme);e.get(pme)===1&&r.initialNavigation(),e.get(fme,null,Mn.Optional)?.setUpPreloading(),e.get(cme,null,Mn.Optional)?.init(),r.resetRootComponentType(i.componentTypes[0]),s.closed||(s.next(),s.complete(),s.unsubscribe())}}var dme=new an("",{factory:()=>new cl}),pme=new an("",{providedIn:"root",factory:()=>1});var fme=new an("");var tF=FG($z());function mme(e,t){if(e&1&&(Pn(0,"div",5),ac(1),kn()),e&2){let i=Of();Qs(),Wb(i.locationCount)}}function gme(e,t){if(e&1&&(Pn(0,"div",6),ac(1),kn()),e&2){let i=Of();Qs(),Hd(" ",i.alarmCount," ")}}var Mq=(()=>{let t=class t{constructor(){this.scale=.7,this.locationCount=5,this.alarmCount=3,this.indicatorState=t_.CLUSTERED,this.IndicatorState=t_}showAlarmCount(){return this.alarmCount!==0&&![t_.SUBMENU,t_.DEVICES,t_.INACTIVE].includes(this.indicatorState)}};t.\u0275fac=function(s){return new(s||t)},t.\u0275cmp=xo({type:t,selectors:[["app-marker"]],inputs:{scale:"scale",locationCount:"locationCount",alarmCount:"alarmCount",indicatorState:"indicatorState"},standalone:!0,features:[bo],decls:5,vars:6,consts:[[1,"container"],["class","location-count",4,"ngIf"],["src","../../../assets/indicator.svg","alt","",1,"indicator"],["src","../../../assets/indiciator-shadow.svg",1,"shadow"],["class","alarm-count",4,"ngIf"],[1,"location-count"],[1,"alarm-count"]],template:function(s,n){s&1&&(Pn(0,"div",0),sc(1,mme,2,1,"div",1),Os(2,"img",2)(3,"img",3),sc(4,gme,2,1,"div",4),kn()),s&2&&(Vb("scale",n.scale),Qs(),sa("ngIf",n.indicatorState===n.IndicatorState.CLUSTERED&&n.locationCount>1),Qs(),Vb("opacity",n.indicatorState===n.IndicatorState.INACTIVE?.5:1),Qs(2),sa("ngIf",n.showAlarmCount()))},dependencies:[lc,H0],styles:[".container[_ngcontent-%COMP%]{width:50px;height:50px;position:static;z-index:1000;cursor:pointer}.container[_ngcontent-%COMP%]   .indicator[_ngcontent-%COMP%]{width:100%;height:100%}.container[_ngcontent-%COMP%]   .shadow[_ngcontent-%COMP%]{position:relative;width:100%;display:flex;top:-35px;align-items:center;align-content:center}.container[_ngcontent-%COMP%]   .location-count[_ngcontent-%COMP%]{color:#918b8b;color:#918b8be0;float:left;position:absolute;display:flex;width:100%;height:100%;font-size:25px;margin-top:-5px;justify-content:center;align-items:center}.container[_ngcontent-%COMP%]   .alarm-count[_ngcontent-%COMP%]{background:radial-gradient(circle,#f43939,#ca0f0f 50%);width:30px;height:30px;position:absolute;top:-12px;right:-12px;border-radius:50%;color:#fff;display:flex;font-size:15px;justify-content:center;align-items:center}"],changeDetection:0});let e=t;return e})(),t_=function(e){return e.CLUSTERED="clustered",e.LOCATION="location",e.DEVICES="devices",e.SUBMENU="submenu",e.INACTIVE="inactive",e}(t_||{});var yme=[{id:"1",latitude:50.05423456789012,longitude:19.93845678901234},{id:"2",latitude:50.051601681737964,longitude:19.94527204613522},{id:"3",latitude:50.05773375024379,longitude:19.943222265625},{id:"4",latitude:50.05490381469543,longitude:19.93778991699219},{id:"5",latitude:50.05760487599164,longitude:19.937191009521484},{id:"6",latitude:50.05824547073284,longitude:19.930737670577457},{id:"7",latitude:50.05684123456789,longitude:19.93645678012345},{id:"8",latitude:50.05567891234567,longitude:19.94123456789012},{id:"9",latitude:50.05345678901234,longitude:19.93987654321098},{id:"10",latitude:50.05234567890123,longitude:19.93876543210987},{id:"11",latitude:50.05123456789012,longitude:19.94098765432109},{id:"12",latitude:50.05987654321098,longitude:19.93567890123456},{id:"13",latitude:50.05876543210987,longitude:19.94456789012345},{id:"14",latitude:50.05432109876543,longitude:19.94234567890123},{id:"15",latitude:50.05543210987654,longitude:19.94345678901234},{id:"16",latitude:50.05754321098765,longitude:19.94198765432109},{id:"17",latitude:50.05643210987654,longitude:19.93912345678901},{id:"18",latitude:50.05321098765432,longitude:19.9380123456789},{id:"19",latitude:50.05210987654321,longitude:19.93765432109876},{id:"20",latitude:50.05198765432109,longitude:19.93654321098765},{id:"21",latitude:50.05123456789012,longitude:19.93712345678901},{id:"22",latitude:50.05234567890123,longitude:19.94123456789012},{id:"23",latitude:50.05345678901234,longitude:19.94234567890123},{id:"24",latitude:50.05456789012345,longitude:19.93845678901234},{id:"25",latitude:50.05567890123456,longitude:19.93956789012345},{id:"26",latitude:50.05678901234567,longitude:19.94067890123456},{id:"27",latitude:50.05789012345678,longitude:19.93578901234567},{id:"28",latitude:50.05890123456789,longitude:19.93689012345678},{id:"29",latitude:50.0590123456789,longitude:19.94112345678901},{id:"30",latitude:50.05112345678901,longitude:19.94323456789012},{id:"31",latitude:50.05223456789012,longitude:19.93734567890123},{id:"32",latitude:50.05334567890123,longitude:19.94245678901234},{id:"33",latitude:50.05445678901234,longitude:19.93856789012345},{id:"34",latitude:50.05556789012345,longitude:19.93967890123456},{id:"35",latitude:50.05667890123456,longitude:19.94078901234567},{id:"36",latitude:50.05778901234567,longitude:19.93589012345678},{id:"37",latitude:50.05889012345678,longitude:19.93690123456789},{id:"38",latitude:50.05990123456789,longitude:19.9410123456789},{id:"39",latitude:50.0510123456789,longitude:19.94312345678901},{id:"40",latitude:50.05212345678901,longitude:19.93723456789012},{id:"41",latitude:50.05323456789012,longitude:19.94234567890123},{id:"42",latitude:50.05434567890123,longitude:19.93845678901234},{id:"43",latitude:50.05545678901234,longitude:19.93956789012345},{id:"44",latitude:50.05656789012345,longitude:19.94067890123456},{id:"45",latitude:50.05767890123456,longitude:19.93578901234567},{id:"46",latitude:50.05878901234567,longitude:19.93689012345678},{id:"47",latitude:50.05989012345678,longitude:19.9410123456789},{id:"48",latitude:50.05190123456789,longitude:19.94312345678901},{id:"49",latitude:50.0520123456789,longitude:19.93723456789012},{id:"50",latitude:50.05312345678901,longitude:19.94234567890123}],Tq=yme;var Aq=(()=>{let t=class t{constructor(){this.url="http://localhost:3000/places",this.dev="http://demo.dev.sencity.ai/devices/search/geospatial-map"}getAllLocations(){return jn(this,null,function*(){let s=yield(yield fetch(this.url)).text();return JSON.parse(s)??[]})}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var Cq=FG($z());var i_=(()=>{let t=class t{constructor(){this.ACCESS_TOKEN="pk.eyJ1IjoiY2V6YXJ5a3V6bmlhcnoiLCJhIjoiY2x6aWdpd2k5MGJsdDJ4czFuYXhkdXBjZCJ9.574g_uNi81hRSz3gg7CTmg",this.mapStyle="mapbox://styles/cezarykuzniarz/cm03j6upu00c501phcmvjemfd",this.map=null}setMap(r){this.map||(this.map=r)}initializeMap(r){let p=r,{container:s,zoom:n,center:c}=p,u=ll(p,["container","zoom","center"]);return this.map=new Cq.default.Map(me({accessToken:this.ACCESS_TOKEN,container:s,style:this.mapStyle,zoom:n??12,center:c},u)),this.map}updateZoom(r){let s=this.map.getCenter(),n=this.map.getZoom();this.map.easeTo({center:s,zoom:r,duration:2e3,linear:!0})}updatePitch(r){let s=this.map.getCenter(),n=this.map.getZoom();this.map.easeTo({center:s,zoom:n,pitch:r,duration:1e3,linear:!0})}handleRightBarMovement(r){if(!Number.isNaN(r)){let s=this.map.getCenter(),n=this.map.getZoom();this.map.easeTo({center:s,zoom:12+r/1e3,duration:2,linear:!0})}}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var aC=(()=>{let t=class t{constructor(){this.rootUrl="http://localhost"}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var Iq=(()=>{let t=class t{constructor(r,s){this.config=r,this.http=s}get rootUrl(){return this._rootUrl||this.config.rootUrl}set rootUrl(r){this._rootUrl=r}};t.\u0275fac=function(s){return new(s||t)(Er(aC),Er(Qg))},t.\u0275prov=hr({token:t,factory:t.\u0275fac});let e=t;return e})();var Qz=class{encodeKey(t){return encodeURIComponent(t)}encodeValue(t){return encodeURIComponent(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}},_me=new Qz,yw=class{constructor(t,i,r,s,n){this.name=t,this.value=i,this.options=r,this.options=r||{},(this.options.style===null||this.options.style===void 0)&&(this.options.style=s),(this.options.explode===null||this.options.explode===void 0)&&(this.options.explode=n)}serializeValue(t,i=","){if(t==null)return"";if(t instanceof Array)return t.map(r=>this.serializeValue(r).split(i).join(encodeURIComponent(i))).join(i);if(typeof t=="object"){let r=[];for(let s of Object.keys(t)){let n=t[s];n!=null&&(n=this.serializeValue(n).split(i).join(encodeURIComponent(i)),this.options.explode?r.push(`${s}=${n}`):(r.push(s),r.push(n)))}return r.join(i)}else return String(t)}},Kz=class extends yw{constructor(t,i,r){super(t,i,r,"simple",!1)}append(t){let i=this.value;i==null&&(i="");let r=this.options.style==="label"?".":"",s=this.options.explode?r===""?",":r:",",n=!1;return this.options.style==="matrix"&&(r=`;${this.name}=`,this.options.explode&&typeof i=="object"&&(r=";",i instanceof Array?(i=i.map(c=>`${this.name}=${this.serializeValue(c,";")}`),i=i.join(";"),n=!0):(i=this.serializeValue(i,";"),n=!0))),i=r+(n?i:this.serializeValue(i,s)),t=t.replace(`{${this.name}}`,i),t=t.replace(`{${r}${this.name}${this.options.explode?"*":""}}`,i),t}serializeValue(t,i=","){var r=typeof t=="string"?encodeURIComponent(t):super.serializeValue(t,i);return r=r.replace(/%3D/g,"="),r=r.replace(/%3B/g,";"),r=r.replace(/%2C/g,","),r}},Jz=class extends yw{constructor(t,i,r){super(t,i,r,"form",!0)}append(t){if(this.value instanceof Array)if(this.options.explode)for(let i of this.value)t=t.append(this.name,this.serializeValue(i));else{let i=this.options.style==="spaceDelimited"?" ":this.options.style==="pipeDelimited"?"|":",";return t.append(this.name,this.serializeValue(this.value,i))}else if(this.value!==null&&typeof this.value=="object")if(this.options.style==="deepObject")for(let i of Object.keys(this.value)){let r=this.value[i];r!=null&&(t=t.append(`${this.name}[${i}]`,this.serializeValue(r)))}else if(this.options.explode)for(let i of Object.keys(this.value)){let r=this.value[i];r!=null&&(t=t.append(i,this.serializeValue(r)))}else{let i=[];for(let r of Object.keys(this.value)){let s=this.value[r];s!=null&&(i.push(r),i.push(s))}t=t.append(this.name,this.serializeValue(i))}else this.value!==null&&this.value!==void 0&&(t=t.append(this.name,this.serializeValue(this.value)));return t}},eF=class extends yw{constructor(t,i,r){super(t,i,r,"simple",!1)}append(t){if(this.value!==null&&this.value!==void 0)if(this.value instanceof Array)for(let i of this.value)t=t.append(this.name,this.serializeValue(i));else t=t.append(this.name,this.serializeValue(this.value));return t}},bn=class{constructor(t,i,r){this.rootUrl=t,this.operationPath=i,this.method=r,this._path=new Map,this._query=new Map,this._header=new Map}path(t,i,r){this._path.set(t,new Kz(t,i,r||{}))}query(t,i,r){this._query.set(t,new Jz(t,i,r||{}))}header(t,i,r){this._header.set(t,new eF(t,i,r||{}))}body(t,i="application/json"){if(t instanceof Blob?this._bodyContentType=t.type:this._bodyContentType=i,this._bodyContentType==="application/x-www-form-urlencoded"&&t!==null&&typeof t=="object"){let r=[];for(let s of Object.keys(t)){let n=t[s];n instanceof Array||(n=[n]);for(let c of n){let u=this.formDataValue(c);u!==null&&r.push([s,u])}}this._bodyContent=r.map(s=>`${encodeURIComponent(s[0])}=${encodeURIComponent(s[1])}`).join("&")}else if(this._bodyContentType==="multipart/form-data"){let r=new FormData;if(t!=null)for(let s of Object.keys(t)){let n=t[s];if(n instanceof Array)for(let c of n){let u=this.formDataValue(c);u!==null&&r.append(s,u)}else{let c=this.formDataValue(n);c!==null&&r.set(s,c)}}this._bodyContent=r}else this._bodyContent=t}formDataValue(t){return t==null?null:t instanceof Blob?t:typeof t=="object"?new Blob([JSON.stringify(t)],{type:"application/json"}):String(t)}build(t){t=t||{};let i=this.operationPath;for(let c of this._path.values())i=c.append(i);let r=this.rootUrl+i,s=new Th({encoder:_me});for(let c of this._query.values())s=c.append(s);let n=new Cu;t.accept&&(n=n.append("Accept",t.accept));for(let c of this._header.values())n=c.append(n);return this._bodyContentType&&!(this._bodyContent instanceof FormData)&&(n=n.set("Content-Type",this._bodyContentType)),new Zg(this.method.toUpperCase(),r,this._bodyContent,{params:s,headers:n,responseType:t.responseType,reportProgress:t.reportProgress,context:t.context})}};function lC(e,t,i,r){let s=new bn(t,lC.PATH,"post");return i&&(s.path("id",i.id,{}),s.body(i.body,"application/json")),e.request(s.build({responseType:"text",accept:"*/*",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n.clone({body:void 0})))}lC.PATH="/devices/{id}/tags";function cC(e,t,i,r){let s=new bn(t,cC.PATH,"post");return i&&(s.path("id",i.id,{}),s.body(i.body,"text/plain")),e.request(s.build({responseType:"text",accept:"*/*",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n.clone({body:void 0})))}cC.PATH="/devices/{id}/tags";function uC(e,t,i,r){let s=new bn(t,uC.PATH,"put");return i&&s.body(i.body,"application/json"),e.request(s.build({responseType:"text",accept:"*/*",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n.clone({body:void 0})))}uC.PATH="/devices/assign";function hC(e,t,i,r){let s=new bn(t,hC.PATH,"delete");return i&&s.path("id",i.id,{}),e.request(s.build({responseType:"text",accept:"*/*",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n.clone({body:void 0})))}hC.PATH="/devices/{id}";function dC(e,t,i,r){let s=new bn(t,dC.PATH,"delete");return i&&(s.path("id",i.id,{}),s.path("tagId",i.tagId,{})),e.request(s.build({responseType:"text",accept:"*/*",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n.clone({body:void 0})))}dC.PATH="/devices/{id}/tags/{tagId}";function pC(e,t,i,r){let s=new bn(t,pC.PATH,"get");return i&&s.path("id",i.id,{}),e.request(s.build({responseType:"json",accept:"application/json",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n))}pC.PATH="/devices/{id}";function fC(e,t,i,r){let s=new bn(t,fC.PATH,"get");return i&&s.path("id",i.id,{}),e.request(s.build({responseType:"json",accept:"application/json",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n))}fC.PATH="/devices/{id}/rules";function mC(e,t,i,r){let s=new bn(t,mC.PATH,"post");return i&&(s.path("id",i.id,{}),s.body(i.body,"application/json")),e.request(s.build({responseType:"json",accept:"application/json",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n))}mC.PATH="/devices/{id}/chart";function gC(e,t,i,r){let s=new bn(t,gC.PATH,"post");return i&&(s.path("id",i.id,{}),s.body(i.body,"application/json")),e.request(s.build({responseType:"json",accept:"application/json",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n))}gC.PATH="/devices/{id}/chart/period";function yC(e,t,i,r){let s=new bn(t,yC.PATH,"get");return i&&s.path("id",i.id,{}),e.request(s.build({responseType:"json",accept:"application/json",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n))}yC.PATH="/devices/{id}/workspacePath";function vC(e,t,i,r){let s=new bn(t,vC.PATH,"get");return i&&s.path("oid",i.oid,{}),e.request(s.build({responseType:"json",accept:"application/json",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n))}vC.PATH="/devices/oid/{oid}";function _C(e,t,i,r){let s=new bn(t,_C.PATH,"get");return i&&s.path("id",i.id,{}),e.request(s.build({responseType:"json",accept:"application/json",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n))}_C.PATH="/devices/{id}/supportedParams";function xC(e,t,i,r){let s=new bn(t,xC.PATH,"post");return i&&s.body(i.body,"application/json"),e.request(s.build({responseType:"json",accept:"application/json",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n))}xC.PATH="/devices/register/kit/bulk";function bC(e,t,i,r){let s=new bn(t,bC.PATH,"post");return i&&s.body(i.body,"application/json"),e.request(s.build({responseType:"json",accept:"application/json",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n))}bC.PATH="/devices/register/bulk";function wC(e,t,i,r){let s=new bn(t,wC.PATH,"post");return i&&(s.path("id",i.id,{}),s.body(i.body,"application/json")),e.request(s.build({responseType:"json",accept:"application/json",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n))}wC.PATH="/devices/{id}/alarms/search";function SC(e,t,i,r){let s=new bn(t,SC.PATH,"post");return i&&s.body(i.body,"application/json"),e.request(s.build({responseType:"json",accept:"application/json",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n))}SC.PATH="/devices/search";function EC(e,t,i,r){let s=new bn(t,EC.PATH,"post");return i&&s.body(i.body,"application/json"),e.request(s.build({responseType:"json",accept:"application/json",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n))}EC.PATH="/devices/search/geospatial-map";function MC(e,t,i,r){let s=new bn(t,MC.PATH,"post");return i&&s.body(i.body,"application/json"),e.request(s.build({responseType:"json",accept:"application/json",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n))}MC.PATH="/devices/models/search";function TC(e,t,i,r){let s=new bn(t,TC.PATH,"put");return i&&(s.path("id",i.id,{}),s.body(i.body,"application/json")),e.request(s.build({responseType:"text",accept:"*/*",context:r})).pipe(Nr(n=>n instanceof mn),Ti(n=>n.clone({body:void 0})))}TC.PATH="/devices/{id}/mapCoordinates";var Pq=(()=>{let t=class t extends Iq{constructor(r,s){super(r,s)}setMapCoordinates$Response(r,s){return TC(this.http,this.rootUrl,r,s)}setMapCoordinates(r,s){return this.setMapCoordinates$Response(r,s).pipe(Ti(n=>n.body))}assign$Response(r,s){return uC(this.http,this.rootUrl,r,s)}assign(r,s){return this.assign$Response(r,s).pipe(Ti(n=>n.body))}addTag$Json$Response(r,s){return lC(this.http,this.rootUrl,r,s)}addTag$Json(r,s){return this.addTag$Json$Response(r,s).pipe(Ti(n=>n.body))}addTag$Plain$Response(r,s){return cC(this.http,this.rootUrl,r,s)}addTag$Plain(r,s){return this.addTag$Plain$Response(r,s).pipe(Ti(n=>n.body))}getDeviceDataForChartCustom$Response(r,s){return mC(this.http,this.rootUrl,r,s)}getDeviceDataForChartCustom(r,s){return this.getDeviceDataForChartCustom$Response(r,s).pipe(Ti(n=>n.body))}getDeviceDataForChartPeriod$Response(r,s){return gC(this.http,this.rootUrl,r,s)}getDeviceDataForChartPeriod(r,s){return this.getDeviceDataForChartPeriod$Response(r,s).pipe(Ti(n=>n.body))}searchDeviceAlarms$Response(r,s){return wC(this.http,this.rootUrl,r,s)}searchDeviceAlarms(r,s){return this.searchDeviceAlarms$Response(r,s).pipe(Ti(n=>n.body))}searchDevices$Response(r,s){return SC(this.http,this.rootUrl,r,s)}searchDevices(r,s){return this.searchDevices$Response(r,s).pipe(Ti(n=>n.body))}searchDevicesGeospatial$Response(r,s){return EC(this.http,this.rootUrl,r,s)}searchDevicesGeospatial(r,s){return this.searchDevicesGeospatial$Response(r,s).pipe(Ti(n=>n.body))}registerDeviceKits$Response(r,s){return xC(this.http,this.rootUrl,r,s)}registerDeviceKits(r,s){return this.registerDeviceKits$Response(r,s).pipe(Ti(n=>n.body))}registerDevices$Response(r,s){return bC(this.http,this.rootUrl,r,s)}registerDevices(r,s){return this.registerDevices$Response(r,s).pipe(Ti(n=>n.body))}searchModels$Response(r,s){return MC(this.http,this.rootUrl,r,s)}searchModels(r,s){return this.searchModels$Response(r,s).pipe(Ti(n=>n.body))}getDevice$Response(r,s){return pC(this.http,this.rootUrl,r,s)}getDevice(r,s){return this.getDevice$Response(r,s).pipe(Ti(n=>n.body))}deleteDevice$Response(r,s){return hC(this.http,this.rootUrl,r,s)}deleteDevice(r,s){return this.deleteDevice$Response(r,s).pipe(Ti(n=>n.body))}getDeviceWorkspacePath$Response(r,s){return yC(this.http,this.rootUrl,r,s)}getDeviceWorkspacePath(r,s){return this.getDeviceWorkspacePath$Response(r,s).pipe(Ti(n=>n.body))}getSupportedMeasuredParameter$Response(r,s){return _C(this.http,this.rootUrl,r,s)}getSupportedMeasuredParameter(r,s){return this.getSupportedMeasuredParameter$Response(r,s).pipe(Ti(n=>n.body))}getDeviceAlarmRules$Response(r,s){return fC(this.http,this.rootUrl,r,s)}getDeviceAlarmRules(r,s){return this.getDeviceAlarmRules$Response(r,s).pipe(Ti(n=>n.body))}getScannedDevices$Response(r,s){return vC(this.http,this.rootUrl,r,s)}getScannedDevices(r,s){return this.getScannedDevices$Response(r,s).pipe(Ti(n=>n.body))}deleteDeviceTag$Response(r,s){return dC(this.http,this.rootUrl,r,s)}deleteDeviceTag(r,s){return this.deleteDeviceTag$Response(r,s).pipe(Ti(n=>n.body))}};t.SetMapCoordinatesPath="/devices/{id}/mapCoordinates",t.AssignPath="/devices/assign",t.AddTagPath="/devices/{id}/tags",t.GetDeviceDataForChartCustomPath="/devices/{id}/chart",t.GetDeviceDataForChartPeriodPath="/devices/{id}/chart/period",t.SearchDeviceAlarmsPath="/devices/{id}/alarms/search",t.SearchDevicesPath="/devices/search",t.SearchDevicesGeospatialPath="/devices/search/geospatial-map",t.RegisterDeviceKitsPath="/devices/register/kit/bulk",t.RegisterDevicesPath="/devices/register/bulk",t.SearchModelsPath="/devices/models/search",t.GetDevicePath="/devices/{id}",t.DeleteDevicePath="/devices/{id}",t.GetDeviceWorkspacePathPath="/devices/{id}/workspacePath",t.GetSupportedMeasuredParameterPath="/devices/{id}/supportedParams",t.GetDeviceAlarmRulesPath="/devices/{id}/rules",t.GetScannedDevicesPath="/devices/oid/{oid}",t.DeleteDeviceTagPath="/devices/{id}/tags/{tagId}",t.\u0275fac=function(s){return new(s||t)(Er(aC),Er(Qg))},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var bme=["mapContainer"],Rq=(()=>{let t=class t{constructor(r,s,n,c,u,p){this.resolver=r,this.injector=s,this.mockService=n,this.mapService=c,this.devicesControllerService=u,this.http=p,this.ACCESS_TOKEN="pk.eyJ1IjoiY2V6YXJ5a3V6bmlhcnoiLCJhIjoiY2x6aWdpd2k5MGJsdDJ4czFuYXhkdXBjZCJ9.574g_uNi81hRSz3gg7CTmg",this.mapStyle="mapbox://styles/cezarykuzniarz/cm03j6upu00c501phcmvjemfd",this.markersReferenceArray=[],this.mockData=[],this.headers=new Cu({"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJXZHNSc0N2bldMV3pyZFFIYmNKbmdaOVNpUi1JeEtQc3VZbVpPSmZGaWlRIn0.eyJleHAiOjE3MjQ4Mjg5MDIsImlhdCI6MTcyNDgyODYwMiwiYXV0aF90aW1lIjoxNzI0ODI4MjM5LCJqdGkiOiIzYzdmYTQxYi04NjRiLTQwYmMtYTMyNy04OTQ2OWIyOGMxNTEiLCJpc3MiOiJodHRwczovL2tleWNsb2FrLmRldi5zZW5jaXR5LmFpL3JlYWxtcy9zZW5jaXR5LXJlYWxtIiwiYXVkIjpbInJlYWxtLW1hbmFnZW1lbnQiLCJhY2NvdW50Il0sInN1YiI6ImVlZTQyNWFjLTlmYmUtNDIwNS1iNDZkLTUwNzgxMDg4NjdhNiIsInR5cCI6IkJlYXJlciIsImF6cCI6InNlbmNpdHktZ3VpIiwibm9uY2UiOiJjNmE3YWY2MC1jMTcwLTQ0ZjktODVkMS1iMDYxMTYxZjk4ZDEiLCJzZXNzaW9uX3N0YXRlIjoiNzc5ZGRjYjctNWNmZi00YzhhLWI5ZjAtYjg5YmJhMzk5Nzc2IiwiYWNyIjoiMCIsImFsbG93ZWQtb3JpZ2lucyI6WyJodHRwOi8vbG9jYWxob3N0OjgwODAiLCJodHRwczovL2RlbW8uZGV2LnNlbmNpdHkuYWkiLCJodHRwOi8vbG9jYWxob3N0OjQyMDAiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iLCJkZWZhdWx0LXJvbGVzLXNlbmNpdHktcmVhbG0iXX0sInJlc291cmNlX2FjY2VzcyI6eyJyZWFsbS1tYW5hZ2VtZW50Ijp7InJvbGVzIjpbIm1hbmFnZS11c2VycyJdfSwic2VuY2l0eS1ndWkiOnsicm9sZXMiOlsiTU9EVUxFX1NFVFRJTkdTIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6Im9wZW5pZCBwcm9maWxlIGVtYWlsIiwic2lkIjoiNzc5ZGRjYjctNWNmZi00YzhhLWI5ZjAtYjg5YmJhMzk5Nzc2Iiwiem9uZWluZm8iOiJFdXJvcGUvV2Fyc2F3IiwiZW1haWxfdmVyaWZpZWQiOnRydWUsInBlcm1pc3Npb25zIjpbIk1PRFVMRV9TRVRUSU5HUyJdLCJyb2xlcyI6WyJBRE1JTiJdLCJ0ZW5hbnRJZCI6WyIwODRkOWIyYS02MWEyLTQ3MmEtYTM5ZS04MDNjZWQwODFmYjYiXSwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VuY2l0eSIsImxvY2FsZSI6InBsLVBMIiwiZ2l2ZW5fbmFtZSI6IiIsImZhbWlseV9uYW1lIjoiIiwiZW1haWwiOiJzZW5jaXR5QHNlbmNpdHkuY29tIn0.X6AvXGXM32bMACvG-wMeVuQd15ATDS3IDO7JdBVWqJbqDWvY3JRoueUqrCHPZEjgumjdRN9rg6djbVJ4-ZRpHPEoNmVNulVclAT5dK1SnyJuPKzFVlHkQOsUDODeppcZywu9TcxNzPm_jppJn5_YUn5pPjBLvrtB7UkC5xWxEQ2dRR_u4wR-ERc6XsTWlrsplOxUUMY5X1SrS7EAu98D0Szqe5Dd_o4kUxjWNVR91b7u5ul-beZ87-KRhSCXY9YNWxQbZ7DSx1elNZdUWO3Z0g82d4pT2DBdl81ok9ZSbbYaS4YmfTV43tnYBKcsLEJI2JV0CDnlaaehNQ40EVfOWg"})}ngOnInit(){tF.default.accessToken=this.ACCESS_TOKEN,this.map=this.mapService.initializeMap({container:this.mapContainer.nativeElement,center:[19.944544,50.04968],pitch:60,zoom:12,minZoom:6})}ngAfterViewInit(){this.mockService.getAllLocations().then(r=>{r.forEach(s=>{})}).catch(r=>{console.log(r),this.mockData=Tq,this.transformIntoGeoJson(this.mockData),console.log(this.geojsonData),this.mockData.forEach(s=>{this.addCustomMarker([s.longitude,s.latitude],s.id)})})}ngOnDestroy(){this.map.remove()}addCustomMarker(r,s){let c=this.resolver.resolveComponentFactory(Mq).create(this.injector);c.setInput("locationCount",parseInt(s)%15),c.setInput("alarmCount",parseInt(s)),this.markersReferenceArray.push(c),c.hostView.detectChanges();let u=c.hostView.rootNodes[0];new tF.default.Marker(u,{draggable:!1}).setLngLat(r).addTo(this.map)}transformIntoGeoJson(r){this.geojsonData={type:"FeatureCollection",features:r.map(s=>({type:"Feature",geometry:{type:"Point",coordinates:[s.longitude,s.latitude]},properties:{id:s.id}}))}}};t.\u0275fac=function(s){return new(s||t)(_s(U0),_s(qg),_s(Aq),_s(i_),_s(Pq),_s(Qg))},t.\u0275cmp=xo({type:t,selectors:[["app-map-view"]],viewQuery:function(s,n){if(s&1&&n9(bme,7),s&2){let c;Gb(c=Hb())&&(n.mapContainer=c.first)}},standalone:!0,features:[bo],decls:3,vars:0,consts:[["mapContainer",""],["id","match-parent",1,"match-parent"],["id","map",2,"position","absolute","z-index","200","width","100vw","height","100vh"]],template:function(s,n){s&1&&Os(0,"div",1)(1,"div",2,0)},dependencies:[L9],styles:['.match-parent[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute}#map[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;z-index:10;pointer-events:none;-webkit-box-shadow:inset 0 0 70px 60px white;-moz-box-shadow:inset 0 0 70px 60px white;box-shadow:inset 0 0 70px 60px #fff}']});let e=t;return e})();var wme=Object.create,yI=Object.defineProperty,Sme=Object.getOwnPropertyDescriptor,Eme=Object.getOwnPropertyNames,Mme=Object.getPrototypeOf,Tme=Object.prototype.hasOwnProperty,Ame=(e,t,i)=>t in e?yI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Cp=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Cme=(e,t)=>{for(var i in t)yI(e,i,{get:t[i],enumerable:!0})},Dme=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Eme(t))!Tme.call(e,s)&&s!==i&&yI(e,s,{get:()=>t[s],enumerable:!(r=Sme(t,s))||r.enumerable});return e},Dp=(e,t,i)=>(i=e!=null?wme(Mme(e)):{},Dme(t||!e||!e.__esModule?yI(i,"default",{value:e,enumerable:!0}):i,e)),Xw=(e,t,i)=>(Ame(e,typeof t!="symbol"?t+"":t,i),i),Ime=Cp((e,t)=>{(function(i,r){typeof e=="object"?t.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(e,function(){"use strict";return i.importState=function(s){var n=new i;return n.importState(s),n},i;function i(){return function(s){var n=0,c=0,u=0,p=1;s.length==0&&(s=[+new Date]);var f=r();n=f(" "),c=f(" "),u=f(" ");for(var x=0;x<s.length;x++)n-=f(s[x]),n<0&&(n+=1),c-=f(s[x]),c<0&&(c+=1),u-=f(s[x]),u<0&&(u+=1);f=null;var w=function(){var E=2091639*n+p*23283064365386963e-26;return n=c,c=u,u=E-(p=E|0)};return w.next=w,w.uint32=function(){return w()*4294967296},w.fract53=function(){return w()+(w()*2097152|0)*11102230246251565e-32},w.version="Alea 0.9",w.args=s,w.exportState=function(){return[n,c,u,p]},w.importState=function(E){n=+E[0]||0,c=+E[1]||0,u=+E[2]||0,p=+E[3]||0},w}(Array.prototype.slice.call(arguments))}function r(){var s=4022871197,n=function(c){c=c.toString();for(var u=0;u<c.length;u++){s+=c.charCodeAt(u);var p=.02519603282416938*s;s=p>>>0,p-=s,p*=s,s=p>>>0,p-=s,s+=p*4294967296}return(s>>>0)*23283064365386963e-26};return n.version="Mash 0.9",n}})}),UQ=Cp((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?r(e):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(e,function(i){"use strict";i.SVD=function(r,s,n,c,u){if(s=s===void 0||s,n=n===void 0||n,u=1e-64/(c=c||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var p,f,x,w,E,A,I,P,O,k,U,j,V=r[0].length,$=r.length;if($<V)throw new TypeError("Invalid matrix: m < n");for(var Y=[],J=[],X=[],ee=s==="f"?$:V,oe=k=I=0;oe<$;oe++)J[oe]=new Array(ee).fill(0);for(oe=0;oe<V;oe++)X[oe]=new Array(V).fill(0);var le,ve=new Array(V).fill(0);for(oe=0;oe<$;oe++)for(p=0;p<V;p++)J[oe][p]=r[oe][p];for(oe=0;oe<V;oe++){for(Y[oe]=I,O=0,x=oe+1,p=oe;p<$;p++)O+=Math.pow(J[p][oe],2);if(O<u)I=0;else for(P=(A=J[oe][oe])*(I=A<0?Math.sqrt(O):-Math.sqrt(O))-O,J[oe][oe]=A-I,p=x;p<V;p++){for(O=0,f=oe;f<$;f++)O+=J[f][oe]*J[f][p];for(A=O/P,f=oe;f<$;f++)J[f][p]=J[f][p]+A*J[f][oe]}for(ve[oe]=I,O=0,p=x;p<V;p++)O+=Math.pow(J[oe][p],2);if(O<u)I=0;else{for(P=(A=J[oe][oe+1])*(I=A<0?Math.sqrt(O):-Math.sqrt(O))-O,J[oe][oe+1]=A-I,p=x;p<V;p++)Y[p]=J[oe][p]/P;for(p=x;p<$;p++){for(O=0,f=x;f<V;f++)O+=J[p][f]*J[oe][f];for(f=x;f<V;f++)J[p][f]=J[p][f]+O*Y[f]}}k<(U=Math.abs(ve[oe])+Math.abs(Y[oe]))&&(k=U)}if(n)for(oe=V-1;0<=oe;oe--){if(I!==0){for(P=J[oe][oe+1]*I,p=x;p<V;p++)X[p][oe]=J[oe][p]/P;for(p=x;p<V;p++){for(O=0,f=x;f<V;f++)O+=J[oe][f]*X[f][p];for(f=x;f<V;f++)X[f][p]=X[f][p]+O*X[f][oe]}}for(p=x;p<V;p++)X[oe][p]=0,X[p][oe]=0;X[oe][oe]=1,I=Y[oe],x=oe}if(s){if(s==="f")for(oe=V;oe<$;oe++){for(p=V;p<$;p++)J[oe][p]=0;J[oe][oe]=1}for(oe=V-1;0<=oe;oe--){for(x=oe+1,I=ve[oe],p=x;p<ee;p++)J[oe][p]=0;if(I!==0){for(P=J[oe][oe]*I,p=x;p<ee;p++){for(O=0,f=x;f<$;f++)O+=J[f][oe]*J[f][p];for(A=O/P,f=oe;f<$;f++)J[f][p]=J[f][p]+A*J[f][oe]}for(p=oe;p<$;p++)J[p][oe]=J[p][oe]/I}else for(p=oe;p<$;p++)J[p][oe]=0;J[oe][oe]=J[oe][oe]+1}}for(c*=k,f=V-1;0<=f;f--)for(var we=0;we<50;we++){for(le=!1,x=f;0<=x;x--){if(Math.abs(Y[x])<=c){le=!0;break}if(Math.abs(ve[x-1])<=c)break}if(!le){for(E=0,w=x-(O=1),oe=x;oe<f+1&&(A=O*Y[oe],Y[oe]=E*Y[oe],!(Math.abs(A)<=c));oe++)if(I=ve[oe],ve[oe]=Math.sqrt(A*A+I*I),E=I/(P=ve[oe]),O=-A/P,s)for(p=0;p<$;p++)U=J[p][w],j=J[p][oe],J[p][w]=U*E+j*O,J[p][oe]=-U*O+j*E}if(j=ve[f],x===f){if(j<0&&(ve[f]=-j,n))for(p=0;p<V;p++)X[p][f]=-X[p][f];break}for(k=ve[x],A=(((U=ve[f-1])-j)*(U+j)+((I=Y[f-1])-(P=Y[f]))*(I+P))/(2*P*U),I=Math.sqrt(A*A+1),A=((k-j)*(k+j)+P*(U/(A<0?A-I:A+I)-P))/k,oe=x+(O=E=1);oe<f+1;oe++){if(I=Y[oe],U=ve[oe],P=O*I,I*=E,j=Math.sqrt(A*A+P*P),A=k*(E=A/(Y[oe-1]=j))+I*(O=P/j),I=-k*O+I*E,P=U*O,U*=E,n)for(p=0;p<V;p++)k=X[p][oe-1],j=X[p][oe],X[p][oe-1]=k*E+j*O,X[p][oe]=-k*O+j*E;if(j=Math.sqrt(A*A+P*P),A=(E=A/(ve[oe-1]=j))*I+(O=P/j)*U,k=-O*I+E*U,s)for(p=0;p<$;p++)U=J[p][oe-1],j=J[p][oe],J[p][oe-1]=U*E+j*O,J[p][oe]=-U*O+j*E}Y[x]=0,Y[f]=A,ve[f]=k}for(oe=0;oe<V;oe++)ve[oe]<c&&(ve[oe]=0);return{u:J,q:ve,v:X}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),Pme=Cp((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?t.exports=r():typeof define=="function"&&define.amd?define(r):(i=i||self,i.TinyQueue=r())})(e,function(){"use strict";var i=function(s,n){if(s===void 0&&(s=[]),n===void 0&&(n=r),this.data=s,this.length=this.data.length,this.compare=n,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};i.prototype.push=function(s){this.data.push(s),this.length++,this._up(this.length-1)},i.prototype.pop=function(){if(this.length!==0){var s=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),s}},i.prototype.peek=function(){return this.data[0]},i.prototype._up=function(s){for(var n=this,c=n.data,u=n.compare,p=c[s];s>0;){var f=s-1>>1,x=c[f];if(u(p,x)>=0)break;c[s]=x,s=f}c[s]=p},i.prototype._down=function(s){for(var n=this,c=n.data,u=n.compare,p=this.length>>1,f=c[s];s<p;){var x=(s<<1)+1,w=c[x],E=x+1;if(E<this.length&&u(c[E],w)<0&&(x=E,w=c[E]),u(w,f)>=0)break;c[s]=w,s=x}c[s]=f};function r(s,n){return s<n?-1:s>n?1:0}return i})}),Rme=Cp((e,t)=>{"use strict";var i=Pme();i.default&&(i=i.default),t.exports=r,t.exports.default=r;function r(f,x,w){x=x||1;for(var E,A,I,P,O=0;O<f[0].length;O++){var k=f[0][O];(!O||k[0]<E)&&(E=k[0]),(!O||k[1]<A)&&(A=k[1]),(!O||k[0]>I)&&(I=k[0]),(!O||k[1]>P)&&(P=k[1])}var U=I-E,j=P-A,V=Math.min(U,j),$=V/2;if(V===0){var Y=[E,A];return Y.distance=0,Y}for(var J=new i(void 0,s),X=E;X<I;X+=V)for(var ee=A;ee<P;ee+=V)J.push(new n(X+$,ee+$,$,f));var oe=u(f),le=new n(E+U/2,A+j/2,0,f);le.d>oe.d&&(oe=le);for(var ve=J.length;J.length;){var we=J.pop();we.d>oe.d&&(oe=we,w&&console.log("found best %d after %d probes",Math.round(1e4*we.d)/1e4,ve)),!(we.max-oe.d<=x)&&($=we.h/2,J.push(new n(we.x-$,we.y-$,$,f)),J.push(new n(we.x+$,we.y-$,$,f)),J.push(new n(we.x-$,we.y+$,$,f)),J.push(new n(we.x+$,we.y+$,$,f)),ve+=4)}w&&(console.log("num probes: "+ve),console.log("best distance: "+oe.d));var fe=[oe.x,oe.y];return fe.distance=oe.d,fe}function s(f,x){return x.max-f.max}function n(f,x,w,E){this.x=f,this.y=x,this.h=w,this.d=c(f,x,E),this.max=this.d+this.h*Math.SQRT2}function c(f,x,w){for(var E=!1,A=1/0,I=0;I<w.length;I++)for(var P=w[I],O=0,k=P.length,U=k-1;O<k;U=O++){var j=P[O],V=P[U];j[1]>x!=V[1]>x&&f<(V[0]-j[0])*(x-j[1])/(V[1]-j[1])+j[0]&&(E=!E),A=Math.min(A,p(f,x,j,V))}return A===0?0:(E?1:-1)*Math.sqrt(A)}function u(f){for(var x=0,w=0,E=0,A=f[0],I=0,P=A.length,O=P-1;I<P;O=I++){var k=A[I],U=A[O],j=k[0]*U[1]-U[0]*k[1];w+=(k[0]+U[0])*j,E+=(k[1]+U[1])*j,x+=j*3}return x===0?new n(A[0][0],A[0][1],0,f):new n(w/x,E/x,0,f)}function p(f,x,w,E){var A=w[0],I=w[1],P=E[0]-A,O=E[1]-I;if(P!==0||O!==0){var k=((f-A)*P+(x-I)*O)/(P*P+O*O);k>1?(A=E[0],I=E[1]):k>0&&(A+=P*k,I+=O*k)}return P=f-A,O=x-I,P*P+O*O}}),Ome=Cp((e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){if(r===null||r===!0||r===!1)return NaN;var s=Number(r);return isNaN(s)?s:s<0?Math.ceil(s):Math.floor(s)}t.exports=e.default}),Lme=Cp((e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){var s=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return s.setUTCFullYear(r.getFullYear()),r.getTime()-s.getTime()}t.exports=e.default}),zme=Cp((e,t)=>{"use strict";function i(n,c){function u(){this.constructor=n}u.prototype=c.prototype,n.prototype=new u}function r(n,c,u,p){this.message=n,this.expected=c,this.found=u,this.location=p,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,r)}i(r,Error),r.buildMessage=function(n,c){var u={literal:function(I){return'"'+f(I.text)+'"'},class:function(I){var P="",O;for(O=0;O<I.parts.length;O++)P+=I.parts[O]instanceof Array?x(I.parts[O][0])+"-"+x(I.parts[O][1]):x(I.parts[O]);return"["+(I.inverted?"^":"")+P+"]"},any:function(I){return"any character"},end:function(I){return"end of input"},other:function(I){return I.description}};function p(I){return I.charCodeAt(0).toString(16).toUpperCase()}function f(I){return I.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(P){return"\\x0"+p(P)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(P){return"\\x"+p(P)})}function x(I){return I.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(P){return"\\x0"+p(P)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(P){return"\\x"+p(P)})}function w(I){return u[I.type](I)}function E(I){var P=new Array(I.length),O,k;for(O=0;O<I.length;O++)P[O]=w(I[O]);if(P.sort(),P.length>0){for(O=1,k=1;O<P.length;O++)P[O-1]!==P[O]&&(P[k]=P[O],k++);P.length=k}switch(P.length){case 1:return P[0];case 2:return P[0]+" or "+P[1];default:return P.slice(0,-1).join(", ")+", or "+P[P.length-1]}}function A(I){return I?'"'+f(I)+'"':"end of input"}return"Expected "+E(n)+" but "+A(c)+" found."};function s(n,c){c=c!==void 0?c:{};var u={},p={svg_path:ks},f=ks,x=function(ye){if(!ye)return[];for(var Ce=[],ht=0;ht<ye.length;ht++)Ce=Ce.concat.apply(Ce,ye[ht]);var Ve=Ce[0];return Ve&&Ve.code=="m"&&(delete Ve.relative,Ve.code="M"),Ce},w=function(ye,Ce){return cd(ye,Ce)},E=/^[Mm]/,A=kr(["M","m"],!1,!1),I=function(ye,Ce,ht){var Ve=rr(ye,[Ce]);return ht&&(Ve=Ve.concat(rr(ye=="M"?"L":"l",ht[1]))),Ve},P=/^[Zz]/,O=kr(["Z","z"],!1,!1),k=function(){return rr("Z")},U=/^[Ll]/,j=kr(["L","l"],!1,!1),V=function(ye,Ce){return rr(ye,Ce)},$=/^[Hh]/,Y=kr(["H","h"],!1,!1),J=function(ye,Ce){return rr(ye,Ce.map(function(ht){return{x:ht}}))},X=/^[Vv]/,ee=kr(["V","v"],!1,!1),oe=function(ye,Ce){return rr(ye,Ce.map(function(ht){return{y:ht}}))},le=/^[Cc]/,ve=kr(["C","c"],!1,!1),we=function(ye,Ce,ht){return{x1:ye.x,y1:ye.y,x2:Ce.x,y2:Ce.y,x:ht.x,y:ht.y}},fe=/^[Ss]/,Ue=kr(["S","s"],!1,!1),Fe=function(ye,Ce){return{x2:ye.x,y2:ye.y,x:Ce.x,y:Ce.y}},Pe=/^[Qq]/,Ae=kr(["Q","q"],!1,!1),et=function(ye,Ce){return{x1:ye.x,y1:ye.y,x:Ce.x,y:Ce.y}},$e=/^[Tt]/,rt=kr(["T","t"],!1,!1),Je=/^[Aa]/,bt=kr(["A","a"],!1,!1),ot=function(ye,Ce,ht,Ve,Et,xi){return{rx:ye,ry:Ce,xAxisRotation:ht,largeArc:Ve,sweep:Et,x:xi.x,y:xi.y}},xt=function(ye,Ce){return{x:ye,y:Ce}},Xe=function(ye){return ye*1},kt=function(ye){return ye.join("")*1},yt=/^[01]/,Nt=kr(["0","1"],!1,!1),Mt=function(ye){return ye=="1"},li=function(){return""},Qt=",",Wt=Sn(",",!1),Di=function(ye){return ye.join("")},Ii=".",Li=Sn(".",!1),$t=/^[eE]/,Ut=kr(["e","E"],!1,!1),wi=/^[+\-]/,Hi=kr(["+","-"],!1,!1),lr=/^[0-9]/,Ke=kr([["0","9"]],!1,!1),Re=function(ye){return ye.join("")},Lt=/^[ \t\n\r]/,pi=kr([" ","	",`
`,"\r"],!1,!1),Ee=0,Zt=0,Xi=[{line:1,column:1}],Pi=0,si=[],vi=0,ki;if("startRule"in c){if(!(c.startRule in p))throw new Error(`Can't start parsing from rule "`+c.startRule+'".');f=p[c.startRule]}function Jt(){return n.substring(Zt,Ee)}function mr(){return ir(Zt,Ee)}function $i(ye,Ce){throw Ce=Ce!==void 0?Ce:ir(Zt,Ee),gs([yi(ye)],n.substring(Zt,Ee),Ce)}function Hr(ye,Ce){throw Ce=Ce!==void 0?Ce:ir(Zt,Ee),Rn(ye,Ce)}function Sn(ye,Ce){return{type:"literal",text:ye,ignoreCase:Ce}}function kr(ye,Ce,ht){return{type:"class",parts:ye,inverted:Ce,ignoreCase:ht}}function wt(){return{type:"any"}}function Yt(){return{type:"end"}}function yi(ye){return{type:"other",description:ye}}function Ai(ye){var Ce=Xi[ye],ht;if(Ce)return Ce;for(ht=ye-1;!Xi[ht];)ht--;for(Ce=Xi[ht],Ce={line:Ce.line,column:Ce.column};ht<ye;)n.charCodeAt(ht)===10?(Ce.line++,Ce.column=1):Ce.column++,ht++;return Xi[ye]=Ce,Ce}function ir(ye,Ce){var ht=Ai(ye),Ve=Ai(Ce);return{start:{offset:ye,line:ht.line,column:ht.column},end:{offset:Ce,line:Ve.line,column:Ve.column}}}function dr(ye){Ee<Pi||(Ee>Pi&&(Pi=Ee,si=[]),si.push(ye))}function Rn(ye,Ce){return new r(ye,null,null,Ce)}function gs(ye,Ce,ht){return new r(r.buildMessage(ye,Ce),ye,Ce,ht)}function ks(){var ye,Ce,ht,Ve,Et;for(ye=Ee,Ce=[],ht=Br();ht!==u;)Ce.push(ht),ht=Br();if(Ce!==u)if(ht=Xn(),ht===u&&(ht=null),ht!==u){for(Ve=[],Et=Br();Et!==u;)Ve.push(Et),Et=Br();Ve!==u?(Zt=ye,Ce=x(ht),ye=Ce):(Ee=ye,ye=u)}else Ee=ye,ye=u;else Ee=ye,ye=u;return ye}function Xn(){var ye,Ce,ht,Ve,Et,xi;if(ye=Ee,Ce=ys(),Ce!==u){for(ht=[],Ve=Ee,Et=[],xi=Br();xi!==u;)Et.push(xi),xi=Br();for(Et!==u?(xi=ys(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u);Ve!==u;){for(ht.push(Ve),Ve=Ee,Et=[],xi=Br();xi!==u;)Et.push(xi),xi=Br();Et!==u?(xi=ys(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u)}ht!==u?(Zt=ye,Ce=w(Ce,ht),ye=Ce):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function ys(){var ye,Ce,ht,Ve,Et,xi;if(ye=Ee,Ce=vc(),Ce!==u){for(ht=[],Ve=Ee,Et=[],xi=Br();xi!==u;)Et.push(xi),xi=Br();for(Et!==u?(xi=On(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u);Ve!==u;){for(ht.push(Ve),Ve=Ee,Et=[],xi=Br();xi!==u;)Et.push(xi),xi=Br();Et!==u?(xi=On(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u)}ht!==u?(Zt=ye,Ce=w(Ce,ht),ye=Ce):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function On(){var ye;return ye=Hl(),ye===u&&(ye=_c(),ye===u&&(ye=Ze(),ye===u&&(ye=ie(),ye===u&&(ye=re(),ye===u&&(ye=Ie(),ye===u&&(ye=qe(),ye===u&&(ye=It(),ye===u&&(ye=Ci())))))))),ye}function vc(){var ye,Ce,ht,Ve,Et,xi,xc;if(ye=Ee,E.test(n.charAt(Ee))?(Ce=n.charAt(Ee),Ee++):(Ce=u,vi===0&&dr(A)),Ce!==u){for(ht=[],Ve=Br();Ve!==u;)ht.push(Ve),Ve=Br();ht!==u?(Ve=fi(),Ve!==u?(Et=Ee,xi=qi(),xi===u&&(xi=null),xi!==u?(xc=cs(),xc!==u?(xi=[xi,xc],Et=xi):(Ee=Et,Et=u)):(Ee=Et,Et=u),Et===u&&(Et=null),Et!==u?(Zt=ye,Ce=I(Ce,Ve,Et),ye=Ce):(Ee=ye,ye=u)):(Ee=ye,ye=u)):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function Hl(){var ye,Ce;return ye=Ee,P.test(n.charAt(Ee))?(Ce=n.charAt(Ee),Ee++):(Ce=u,vi===0&&dr(O)),Ce!==u&&(Zt=ye,Ce=k()),ye=Ce,ye}function _c(){var ye,Ce,ht,Ve;if(ye=Ee,U.test(n.charAt(Ee))?(Ce=n.charAt(Ee),Ee++):(Ce=u,vi===0&&dr(j)),Ce!==u){for(ht=[],Ve=Br();Ve!==u;)ht.push(Ve),Ve=Br();ht!==u?(Ve=cs(),Ve!==u?(Zt=ye,Ce=V(Ce,Ve),ye=Ce):(Ee=ye,ye=u)):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function cs(){var ye,Ce,ht,Ve,Et,xi;if(ye=Ee,Ce=fi(),Ce!==u){for(ht=[],Ve=Ee,Et=qi(),Et===u&&(Et=null),Et!==u?(xi=fi(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u);Ve!==u;)ht.push(Ve),Ve=Ee,Et=qi(),Et===u&&(Et=null),Et!==u?(xi=fi(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u);ht!==u?(Zt=ye,Ce=w(Ce,ht),ye=Ce):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function Ze(){var ye,Ce,ht,Ve;if(ye=Ee,$.test(n.charAt(Ee))?(Ce=n.charAt(Ee),Ee++):(Ce=u,vi===0&&dr(Y)),Ce!==u){for(ht=[],Ve=Br();Ve!==u;)ht.push(Ve),Ve=Br();ht!==u?(Ve=xe(),Ve!==u?(Zt=ye,Ce=J(Ce,Ve),ye=Ce):(Ee=ye,ye=u)):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function xe(){var ye,Ce,ht,Ve,Et,xi;if(ye=Ee,Ce=_i(),Ce!==u){for(ht=[],Ve=Ee,Et=qi(),Et===u&&(Et=null),Et!==u?(xi=_i(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u);Ve!==u;)ht.push(Ve),Ve=Ee,Et=qi(),Et===u&&(Et=null),Et!==u?(xi=_i(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u);ht!==u?(Zt=ye,Ce=w(Ce,ht),ye=Ce):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function ie(){var ye,Ce,ht,Ve;if(ye=Ee,X.test(n.charAt(Ee))?(Ce=n.charAt(Ee),Ee++):(Ce=u,vi===0&&dr(ee)),Ce!==u){for(ht=[],Ve=Br();Ve!==u;)ht.push(Ve),Ve=Br();ht!==u?(Ve=xe(),Ve!==u?(Zt=ye,Ce=oe(Ce,Ve),ye=Ce):(Ee=ye,ye=u)):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function re(){var ye,Ce,ht,Ve;if(ye=Ee,le.test(n.charAt(Ee))?(Ce=n.charAt(Ee),Ee++):(Ce=u,vi===0&&dr(ve)),Ce!==u){for(ht=[],Ve=Br();Ve!==u;)ht.push(Ve),Ve=Br();ht!==u?(Ve=he(),Ve!==u?(Zt=ye,Ce=V(Ce,Ve),ye=Ce):(Ee=ye,ye=u)):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function he(){var ye,Ce,ht,Ve,Et,xi;if(ye=Ee,Ce=De(),Ce!==u){for(ht=[],Ve=Ee,Et=qi(),Et===u&&(Et=null),Et!==u?(xi=De(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u);Ve!==u;)ht.push(Ve),Ve=Ee,Et=qi(),Et===u&&(Et=null),Et!==u?(xi=De(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u);ht!==u?(Zt=ye,Ce=w(Ce,ht),ye=Ce):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function De(){var ye,Ce,ht,Ve,Et,xi;return ye=Ee,Ce=fi(),Ce!==u?(ht=qi(),ht===u&&(ht=null),ht!==u?(Ve=fi(),Ve!==u?(Et=qi(),Et===u&&(Et=null),Et!==u?(xi=fi(),xi!==u?(Zt=ye,Ce=we(Ce,Ve,xi),ye=Ce):(Ee=ye,ye=u)):(Ee=ye,ye=u)):(Ee=ye,ye=u)):(Ee=ye,ye=u)):(Ee=ye,ye=u),ye}function Ie(){var ye,Ce,ht,Ve;if(ye=Ee,fe.test(n.charAt(Ee))?(Ce=n.charAt(Ee),Ee++):(Ce=u,vi===0&&dr(Ue)),Ce!==u){for(ht=[],Ve=Br();Ve!==u;)ht.push(Ve),Ve=Br();ht!==u?(Ve=He(),Ve!==u?(Zt=ye,Ce=V(Ce,Ve),ye=Ce):(Ee=ye,ye=u)):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function He(){var ye,Ce,ht,Ve,Et,xi;if(ye=Ee,Ce=nt(),Ce!==u){for(ht=[],Ve=Ee,Et=qi(),Et===u&&(Et=null),Et!==u?(xi=nt(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u);Ve!==u;)ht.push(Ve),Ve=Ee,Et=qi(),Et===u&&(Et=null),Et!==u?(xi=nt(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u);ht!==u?(Zt=ye,Ce=w(Ce,ht),ye=Ce):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function nt(){var ye,Ce,ht,Ve;return ye=Ee,Ce=fi(),Ce!==u?(ht=qi(),ht===u&&(ht=null),ht!==u?(Ve=fi(),Ve!==u?(Zt=ye,Ce=Fe(Ce,Ve),ye=Ce):(Ee=ye,ye=u)):(Ee=ye,ye=u)):(Ee=ye,ye=u),ye}function qe(){var ye,Ce,ht,Ve;if(ye=Ee,Pe.test(n.charAt(Ee))?(Ce=n.charAt(Ee),Ee++):(Ce=u,vi===0&&dr(Ae)),Ce!==u){for(ht=[],Ve=Br();Ve!==u;)ht.push(Ve),Ve=Br();ht!==u?(Ve=st(),Ve!==u?(Zt=ye,Ce=V(Ce,Ve),ye=Ce):(Ee=ye,ye=u)):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function st(){var ye,Ce,ht,Ve,Et,xi;if(ye=Ee,Ce=St(),Ce!==u){for(ht=[],Ve=Ee,Et=qi(),Et===u&&(Et=null),Et!==u?(xi=St(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u);Ve!==u;)ht.push(Ve),Ve=Ee,Et=qi(),Et===u&&(Et=null),Et!==u?(xi=St(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u);ht!==u?(Zt=ye,Ce=w(Ce,ht),ye=Ce):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function St(){var ye,Ce,ht,Ve;return ye=Ee,Ce=fi(),Ce!==u?(ht=qi(),ht===u&&(ht=null),ht!==u?(Ve=fi(),Ve!==u?(Zt=ye,Ce=et(Ce,Ve),ye=Ce):(Ee=ye,ye=u)):(Ee=ye,ye=u)):(Ee=ye,ye=u),ye}function It(){var ye,Ce,ht,Ve;if(ye=Ee,$e.test(n.charAt(Ee))?(Ce=n.charAt(Ee),Ee++):(Ce=u,vi===0&&dr(rt)),Ce!==u){for(ht=[],Ve=Br();Ve!==u;)ht.push(Ve),Ve=Br();ht!==u?(Ve=ni(),Ve!==u?(Zt=ye,Ce=V(Ce,Ve),ye=Ce):(Ee=ye,ye=u)):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function ni(){var ye,Ce,ht,Ve,Et,xi;if(ye=Ee,Ce=fi(),Ce!==u){for(ht=[],Ve=Ee,Et=qi(),Et===u&&(Et=null),Et!==u?(xi=fi(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u);Ve!==u;)ht.push(Ve),Ve=Ee,Et=qi(),Et===u&&(Et=null),Et!==u?(xi=fi(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u);ht!==u?(Zt=ye,Ce=w(Ce,ht),ye=Ce):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function Ci(){var ye,Ce,ht,Ve;if(ye=Ee,Je.test(n.charAt(Ee))?(Ce=n.charAt(Ee),Ee++):(Ce=u,vi===0&&dr(bt)),Ce!==u){for(ht=[],Ve=Br();Ve!==u;)ht.push(Ve),Ve=Br();ht!==u?(Ve=Bi(),Ve!==u?(Zt=ye,Ce=V(Ce,Ve),ye=Ce):(Ee=ye,ye=u)):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function Bi(){var ye,Ce,ht,Ve,Et,xi;if(ye=Ee,Ce=Qi(),Ce!==u){for(ht=[],Ve=Ee,Et=qi(),Et===u&&(Et=null),Et!==u?(xi=Qi(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u);Ve!==u;)ht.push(Ve),Ve=Ee,Et=qi(),Et===u&&(Et=null),Et!==u?(xi=Qi(),xi!==u?(Et=[Et,xi],Ve=Et):(Ee=Ve,Ve=u)):(Ee=Ve,Ve=u);ht!==u?(Zt=ye,Ce=w(Ce,ht),ye=Ce):(Ee=ye,ye=u)}else Ee=ye,ye=u;return ye}function Qi(){var ye,Ce,ht,Ve,Et,xi,xc,ud,th,iu,bc,ih;return ye=Ee,Ce=Sr(),Ce!==u?(ht=qi(),ht===u&&(ht=null),ht!==u?(Ve=Sr(),Ve!==u?(Et=qi(),Et===u&&(Et=null),Et!==u?(xi=_i(),xi!==u?(xc=qi(),xc!==u?(ud=un(),ud!==u?(th=qi(),th===u&&(th=null),th!==u?(iu=un(),iu!==u?(bc=qi(),bc===u&&(bc=null),bc!==u?(ih=fi(),ih!==u?(Zt=ye,Ce=ot(Ce,Ve,xi,ud,iu,ih),ye=Ce):(Ee=ye,ye=u)):(Ee=ye,ye=u)):(Ee=ye,ye=u)):(Ee=ye,ye=u)):(Ee=ye,ye=u)):(Ee=ye,ye=u)):(Ee=ye,ye=u)):(Ee=ye,ye=u)):(Ee=ye,ye=u)):(Ee=ye,ye=u)):(Ee=ye,ye=u),ye}function fi(){var ye,Ce,ht,Ve;return ye=Ee,Ce=_i(),Ce!==u?(ht=qi(),ht===u&&(ht=null),ht!==u?(Ve=_i(),Ve!==u?(Zt=ye,Ce=xt(Ce,Ve),ye=Ce):(Ee=ye,ye=u)):(Ee=ye,ye=u)):(Ee=ye,ye=u),ye}function Sr(){var ye,Ce;return ye=Ee,Ce=qn(),Ce===u&&(Ce=_n()),Ce!==u&&(Zt=ye,Ce=Xe(Ce)),ye=Ce,ye}function _i(){var ye,Ce,ht,Ve;return ye=Ee,Ce=Ee,ht=Ss(),ht===u&&(ht=null),ht!==u?(Ve=qn(),Ve!==u?(ht=[ht,Ve],Ce=ht):(Ee=Ce,Ce=u)):(Ee=Ce,Ce=u),Ce===u&&(Ce=Ee,ht=Ss(),ht===u&&(ht=null),ht!==u?(Ve=_n(),Ve!==u?(ht=[ht,Ve],Ce=ht):(Ee=Ce,Ce=u)):(Ee=Ce,Ce=u)),Ce!==u&&(Zt=ye,Ce=kt(Ce)),ye=Ce,ye}function un(){var ye,Ce;return ye=Ee,yt.test(n.charAt(Ee))?(Ce=n.charAt(Ee),Ee++):(Ce=u,vi===0&&dr(Nt)),Ce!==u&&(Zt=ye,Ce=Mt(Ce)),ye=Ce,ye}function qi(){var ye,Ce,ht,Ve,Et;if(ye=Ee,Ce=[],ht=Br(),ht!==u)for(;ht!==u;)Ce.push(ht),ht=Br();else Ce=u;if(Ce!==u)if(ht=vr(),ht===u&&(ht=null),ht!==u){for(Ve=[],Et=Br();Et!==u;)Ve.push(Et),Et=Br();Ve!==u?(Ce=[Ce,ht,Ve],ye=Ce):(Ee=ye,ye=u)}else Ee=ye,ye=u;else Ee=ye,ye=u;if(ye===u){if(ye=Ee,Ce=Ee,ht=vr(),ht!==u){for(Ve=[],Et=Br();Et!==u;)Ve.push(Et),Et=Br();Ve!==u?(ht=[ht,Ve],Ce=ht):(Ee=Ce,Ce=u)}else Ee=Ce,Ce=u;Ce!==u&&(Zt=ye,Ce=li()),ye=Ce}return ye}function vr(){var ye;return n.charCodeAt(Ee)===44?(ye=Qt,Ee++):(ye=u,vi===0&&dr(Wt)),ye}function qn(){var ye,Ce,ht,Ve;return ye=Ee,Ce=Ee,ht=Zr(),ht!==u?(Ve=Yn(),Ve===u&&(Ve=null),Ve!==u?(ht=[ht,Ve],Ce=ht):(Ee=Ce,Ce=u)):(Ee=Ce,Ce=u),Ce===u&&(Ce=Ee,ht=_n(),ht!==u?(Ve=Yn(),Ve!==u?(ht=[ht,Ve],Ce=ht):(Ee=Ce,Ce=u)):(Ee=Ce,Ce=u)),Ce!==u&&(Zt=ye,Ce=Di(Ce)),ye=Ce,ye}function Zr(){var ye,Ce,ht,Ve,Et;return ye=Ee,Ce=Ee,ht=_n(),ht===u&&(ht=null),ht!==u?(n.charCodeAt(Ee)===46?(Ve=Ii,Ee++):(Ve=u,vi===0&&dr(Li)),Ve!==u?(Et=_n(),Et!==u?(ht=[ht,Ve,Et],Ce=ht):(Ee=Ce,Ce=u)):(Ee=Ce,Ce=u)):(Ee=Ce,Ce=u),Ce===u&&(Ce=Ee,ht=_n(),ht!==u?(n.charCodeAt(Ee)===46?(Ve=Ii,Ee++):(Ve=u,vi===0&&dr(Li)),Ve!==u?(ht=[ht,Ve],Ce=ht):(Ee=Ce,Ce=u)):(Ee=Ce,Ce=u)),Ce!==u&&(Zt=ye,Ce=Di(Ce)),ye=Ce,ye}function Yn(){var ye,Ce,ht,Ve,Et;return ye=Ee,Ce=Ee,$t.test(n.charAt(Ee))?(ht=n.charAt(Ee),Ee++):(ht=u,vi===0&&dr(Ut)),ht!==u?(Ve=Ss(),Ve===u&&(Ve=null),Ve!==u?(Et=_n(),Et!==u?(ht=[ht,Ve,Et],Ce=ht):(Ee=Ce,Ce=u)):(Ee=Ce,Ce=u)):(Ee=Ce,Ce=u),Ce!==u&&(Zt=ye,Ce=Di(Ce)),ye=Ce,ye}function Ss(){var ye;return wi.test(n.charAt(Ee))?(ye=n.charAt(Ee),Ee++):(ye=u,vi===0&&dr(Hi)),ye}function _n(){var ye,Ce,ht;if(ye=Ee,Ce=[],lr.test(n.charAt(Ee))?(ht=n.charAt(Ee),Ee++):(ht=u,vi===0&&dr(Ke)),ht!==u)for(;ht!==u;)Ce.push(ht),lr.test(n.charAt(Ee))?(ht=n.charAt(Ee),Ee++):(ht=u,vi===0&&dr(Ke));else Ce=u;return Ce!==u&&(Zt=ye,Ce=Re(Ce)),ye=Ce,ye}function Br(){var ye,Ce;return ye=Ee,Lt.test(n.charAt(Ee))?(Ce=n.charAt(Ee),Ee++):(Ce=u,vi===0&&dr(pi)),Ce!==u&&(Zt=ye,Ce=li()),ye=Ce,ye}function cd(ye,Ce){if(!Ce)return[ye];for(var ht=[ye],Ve=0,Et=Ce.length;Ve<Et;Ve++)ht[Ve+1]=Ce[Ve][1];return ht}var Wl={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var eh in Wl)Wl[eh.toUpperCase()]=Wl[eh];function rr(ye,Ce){Ce||(Ce=[{}]);for(var ht=Ce.length;ht--;){var Ve={code:ye,command:Wl[ye]};ye==ye.toLowerCase()&&(Ve.relative=!0);for(var Et in Ce[ht])Ve[Et]=Ce[ht][Et];Ce[ht]=Ve}return Ce}if(ki=f(),ki!==u&&Ee===n.length)return ki;throw ki!==u&&Ee<n.length&&dr(Yt()),gs(si,Pi<n.length?n.charAt(Pi):null,Pi<n.length?ir(Pi,Pi+1):ir(Pi,Pi))}t.exports={SyntaxError:r,parse:s}}),jQ=Cp((e,t)=>{var i=zme().parse;i.parseSVG=i,i.makeAbsolute=r,t.exports=i;function r(s){var n,c={x:0,y:0},u={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return s.forEach(function(p){p.command==="moveto"&&(n=p),p.x0=c.x,p.y0=c.y;for(var f in u)f in p&&(p[f]+=p.relative?p[u[f]]:0);"x"in p||(p.x=c.x),"y"in p||(p.y=c.y),p.relative=!1,p.code=p.code.toUpperCase(),p.command=="closepath"&&(p.x=n.x,p.y=n.y),c=p}),s}}),Fme=Cp((e,t)=>{t.exports=function(i,r){for(var s=i.split("."),n=r.split("."),c=0;c<3;c++){var u=Number(s[c]),p=Number(n[c]);if(u>p)return 1;if(p>u)return-1;if(!isNaN(u)&&isNaN(p))return 1;if(isNaN(u)&&!isNaN(p))return-1}return 0}}),wx="149",Nc={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},kme=0,Oq=1,Nme=2,u4=1,Bme=2,$w=3,Yu=0,fa=1,Wa=2,Co=0,Iy=1,Lq=2,zq=3,Fq=4,Ume=5,L_=100,jme=101,Vme=102,kq=103,Nq=104,Gme=200,Hme=201,Wme=202,qme=203,VQ=204,GQ=205,Yme=206,Xme=207,$me=208,Zme=209,Qme=210,Kme=0,Jme=1,ege=2,lN=3,tge=4,ige=5,rge=6,nge=7,HQ=0,sge=1,oge=2,Zh=0,age=1,lge=2,cge=3,uge=4,hge=5,WQ=300,ky=301,Ny=302,cN=303,uN=304,US=306,pp=1e3,js=1001,hN=1002,ns=1003,Bq=1004,iF=1005,cn=1006,dge=1007,ax=1008,$a=1009,pge=1010,fge=1011,qQ=1012,mge=1013,fp=1014,To=1015,wp=1016,gge=1017,yge=1018,Py=1020,vge=1021,da=1023,_ge=1024,xge=1025,Ry=1026,By=1027,bge=1028,wge=1029,fD=1030,Sge=1031,YQ=1033,rF=33776,nF=33777,sF=33778,oF=33779,Uq=35840,jq=35841,Vq=35842,Gq=35843,Ege=36196,Hq=37492,Wq=37496,qq=37808,Yq=37809,Xq=37810,$q=37811,Zq=37812,Qq=37813,Kq=37814,Jq=37815,e7=37816,t7=37817,i7=37818,r7=37819,n7=37820,s7=37821,aF=36492,Mge=36283,o7=36284,a7=36285,l7=36286,XQ=2200,$Q=2201,h4=2202,mD=2300,gD=2301,lF=2302,j_=2400,V_=2401,yD=2402,d4=2500,Tge=2501,Xu=3e3,sn=3001,Ip=3200,ZQ=3201,Age=0,Cge=1,jh="srgb",vD="srgb-linear",cF=7680,Dge=519,dN=35044,Ige=35048,c7="300 es",pN=1035,za=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let i=t.slice(0);for(let r=0,s=i.length;r<s;r++)i[r].call(this,e);e.target=null}}},Ua=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],u7=1234567,nS=Math.PI/180,yS=180/Math.PI;function Zc(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Ua[e&255]+Ua[e>>8&255]+Ua[e>>16&255]+Ua[e>>24&255]+"-"+Ua[t&255]+Ua[t>>8&255]+"-"+Ua[t>>16&15|64]+Ua[t>>24&255]+"-"+Ua[i&63|128]+Ua[i>>8&255]+"-"+Ua[i>>16&255]+Ua[i>>24&255]+Ua[r&255]+Ua[r>>8&255]+Ua[r>>16&255]+Ua[r>>24&255]).toLowerCase()}function Eo(e,t,i){return Math.max(t,Math.min(i,e))}function p4(e,t){return(e%t+t)%t}function Pge(e,t,i,r,s){return r+(e-t)*(s-r)/(i-t)}function Rge(e,t,i){return e!==t?(i-e)/(t-e):0}function sS(e,t,i){return(1-i)*e+i*t}function Oge(e,t,i,r){return sS(e,t,1-Math.exp(-i*r))}function Lge(e,t=1){return t-Math.abs(p4(e,t*2)-t)}function zge(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function Fge(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function kge(e,t){return e+Math.floor(Math.random()*(t-e+1))}function Nge(e,t){return e+Math.random()*(t-e)}function Bge(e){return e*(.5-Math.random())}function Uge(e){e!==void 0&&(u7=e);let t=u7+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function jge(e){return e*nS}function Vge(e){return e*yS}function fN(e){return(e&e-1)===0&&e!==0}function QQ(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function _D(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Gge(e,t,i,r,s){let n=Math.cos,c=Math.sin,u=n(i/2),p=c(i/2),f=n((t+r)/2),x=c((t+r)/2),w=n((t-r)/2),E=c((t-r)/2),A=n((r-t)/2),I=c((r-t)/2);switch(s){case"XYX":e.set(u*x,p*w,p*E,u*f);break;case"YZY":e.set(p*E,u*x,p*w,u*f);break;case"ZXZ":e.set(p*w,p*E,u*x,u*f);break;case"XZX":e.set(u*x,p*I,p*A,u*f);break;case"YXY":e.set(p*A,u*x,p*I,u*f);break;case"ZYZ":e.set(p*I,p*A,u*x,u*f);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function mp(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Cs(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var Yi=Object.freeze({__proto__:null,DEG2RAD:nS,RAD2DEG:yS,ceilPowerOfTwo:QQ,clamp:Eo,damp:Oge,degToRad:jge,denormalize:mp,euclideanModulo:p4,floorPowerOfTwo:_D,generateUUID:Zc,inverseLerp:Rge,isPowerOfTwo:fN,lerp:sS,mapLinear:Pge,normalize:Cs,pingpong:Lge,radToDeg:Vge,randFloat:Nge,randFloatSpread:Bge,randInt:kge,seededRandom:Uge,setQuaternionFromProperEuler:Gge,smootherstep:Fge,smoothstep:zge}),lt=class{constructor(e=0,t=0){lt.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,n=this.y-e.y;return this.x=s*i-n*r+e.x,this.y=s*r+n*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Ao=class{constructor(){Ao.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,s,n,c,u,p){let f=this.elements;return f[0]=e,f[1]=r,f[2]=c,f[3]=t,f[4]=s,f[5]=u,f[6]=i,f[7]=n,f[8]=p,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,s=this.elements,n=i[0],c=i[3],u=i[6],p=i[1],f=i[4],x=i[7],w=i[2],E=i[5],A=i[8],I=r[0],P=r[3],O=r[6],k=r[1],U=r[4],j=r[7],V=r[2],$=r[5],Y=r[8];return s[0]=n*I+c*k+u*V,s[3]=n*P+c*U+u*$,s[6]=n*O+c*j+u*Y,s[1]=p*I+f*k+x*V,s[4]=p*P+f*U+x*$,s[7]=p*O+f*j+x*Y,s[2]=w*I+E*k+A*V,s[5]=w*P+E*U+A*$,s[8]=w*O+E*j+A*Y,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],c=e[5],u=e[6],p=e[7],f=e[8];return t*n*f-t*c*p-i*s*f+i*c*u+r*s*p-r*n*u}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],c=e[5],u=e[6],p=e[7],f=e[8],x=f*n-c*p,w=c*u-f*s,E=p*s-n*u,A=t*x+i*w+r*E;if(A===0)return this.set(0,0,0,0,0,0,0,0,0);let I=1/A;return e[0]=x*I,e[1]=(r*p-f*i)*I,e[2]=(c*i-r*n)*I,e[3]=w*I,e[4]=(f*t-r*u)*I,e[5]=(r*s-c*t)*I,e[6]=E*I,e[7]=(i*u-p*t)*I,e[8]=(n*t-i*s)*I,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,n,c){let u=Math.cos(s),p=Math.sin(s);return this.set(i*u,i*p,-i*(u*n+p*c)+n+e,-r*p,r*u,-r*(-p*n+u*c)+c+t,0,0,1),this}scale(e,t){return this.premultiply(uF.makeScale(e,t)),this}rotate(e){return this.premultiply(uF.makeRotation(-e)),this}translate(e,t){return this.premultiply(uF.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}},uF=new Ao;function KQ(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var Hge={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function AC(e,t){return new Hge[e](t)}function vS(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Oy(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function Z2(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}var hF={[jh]:{[vD]:Oy},[vD]:{[jh]:Z2}},dl={legacyMode:!0,get workingColorSpace(){return vD},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(hF[t]&&hF[t][i]!==void 0){let r=hF[t][i];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},JQ={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ho={r:0,g:0,b:0},Du={h:0,s:0,l:0},CC={h:0,s:0,l:0};function dF(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}function DC(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var Tr=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=jh){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,dl.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=dl.workingColorSpace){return this.r=e,this.g=t,this.b=i,dl.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=dl.workingColorSpace){if(e=p4(e,1),t=Eo(t,0,1),i=Eo(i,0,1),t===0)this.r=this.g=this.b=i;else{let s=i<=.5?i*(1+t):i+t-i*t,n=2*i-s;this.r=dF(n,s,e+1/3),this.g=dF(n,s,e),this.b=dF(n,s,e-1/3)}return dl.toWorkingColorSpace(this,r),this}setStyle(e,t=jh){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let s,n=r[1],c=r[2];switch(n){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,dl.toWorkingColorSpace(this,t),i(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,dl.toWorkingColorSpace(this,t),i(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c)){let u=parseFloat(s[1])/360,p=parseFloat(s[2])/100,f=parseFloat(s[3])/100;return i(s[4]),this.setHSL(u,p,f,t)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){let s=r[1],n=s.length;if(n===3)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,dl.toWorkingColorSpace(this,t),this;if(n===6)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,dl.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=jh){let i=JQ[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Oy(e.r),this.g=Oy(e.g),this.b=Oy(e.b),this}copyLinearToSRGB(e){return this.r=Z2(e.r),this.g=Z2(e.g),this.b=Z2(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=jh){return dl.fromWorkingColorSpace(DC(this,Ho),e),Eo(Ho.r*255,0,255)<<16^Eo(Ho.g*255,0,255)<<8^Eo(Ho.b*255,0,255)<<0}getHexString(e=jh){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=dl.workingColorSpace){dl.fromWorkingColorSpace(DC(this,Ho),t);let i=Ho.r,r=Ho.g,s=Ho.b,n=Math.max(i,r,s),c=Math.min(i,r,s),u,p,f=(c+n)/2;if(c===n)u=0,p=0;else{let x=n-c;switch(p=f<=.5?x/(n+c):x/(2-n-c),n){case i:u=(r-s)/x+(r<s?6:0);break;case r:u=(s-i)/x+2;break;case s:u=(i-r)/x+4;break}u/=6}return e.h=u,e.s=p,e.l=f,e}getRGB(e,t=dl.workingColorSpace){return dl.fromWorkingColorSpace(DC(this,Ho),t),e.r=Ho.r,e.g=Ho.g,e.b=Ho.b,e}getStyle(e=jh){return dl.fromWorkingColorSpace(DC(this,Ho),e),e!==jh?`color(${e} ${Ho.r} ${Ho.g} ${Ho.b})`:`rgb(${Ho.r*255|0},${Ho.g*255|0},${Ho.b*255|0})`}offsetHSL(e,t,i){return this.getHSL(Du),Du.h+=e,Du.s+=t,Du.l+=i,this.setHSL(Du.h,Du.s,Du.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Du),e.getHSL(CC);let i=sS(Du.h,CC.h,t),r=sS(Du.s,CC.s,t),s=sS(Du.l,CC.l,t);return this.setHSL(i,r,s),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};Tr.NAMES=JQ;var r_,eK=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{r_===void 0&&(r_=vS("canvas")),r_.width=e.width,r_.height=e.height;let i=r_.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=r_}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=vS("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let n=0;n<s.length;n++)s[n]=Oy(s[n]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){let t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Oy(t[i]/255)*255):t[i]=Oy(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},tK=class{constructor(e=null){this.isSource=!0,this.uuid=Zc(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let n=0,c=r.length;n<c;n++)r[n].isDataTexture?s.push(pF(r[n].image)):s.push(pF(r[n]))}else s=pF(r);i.url=s}return t||(e.images[this.uuid]=i),i}};function pF(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?eK.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Wge=0,Zs=class extends za{constructor(e=Zs.DEFAULT_IMAGE,t=Zs.DEFAULT_MAPPING,i=js,r=js,s=cn,n=ax,c=da,u=$a,p=Zs.DEFAULT_ANISOTROPY,f=Xu){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Wge++}),this.uuid=Zc(),this.name="",this.source=new tK(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=n,this.anisotropy=p,this.format=c,this.internalFormat=null,this.type=u,this.offset=new lt(0,0),this.repeat=new lt(1,1),this.center=new lt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ao,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=f,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==WQ)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case pp:e.x=e.x-Math.floor(e.x);break;case js:e.x=e.x<0?0:1;break;case hN:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case pp:e.y=e.y-Math.floor(e.y);break;case js:e.y=e.y<0?0:1;break;case hN:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Zs.DEFAULT_IMAGE=null;Zs.DEFAULT_MAPPING=WQ;Zs.DEFAULT_ANISOTROPY=1;var Gr=class{constructor(e=0,t=0,i=0,r=1){Gr.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,s=this.w,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r+n[12]*s,this.y=n[1]*t+n[5]*i+n[9]*r+n[13]*s,this.z=n[2]*t+n[6]*i+n[10]*r+n[14]*s,this.w=n[3]*t+n[7]*i+n[11]*r+n[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s,n=e.elements,c=n[0],u=n[4],p=n[8],f=n[1],x=n[5],w=n[9],E=n[2],A=n[6],I=n[10];if(Math.abs(u-f)<.01&&Math.abs(p-E)<.01&&Math.abs(w-A)<.01){if(Math.abs(u+f)<.1&&Math.abs(p+E)<.1&&Math.abs(w+A)<.1&&Math.abs(c+x+I-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let O=(c+1)/2,k=(x+1)/2,U=(I+1)/2,j=(u+f)/4,V=(p+E)/4,$=(w+A)/4;return O>k&&O>U?O<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(O),r=j/i,s=V/i):k>U?k<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(k),i=j/r,s=$/r):U<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(U),i=V/s,r=$/s),this.set(i,r,s,t),this}let P=Math.sqrt((A-w)*(A-w)+(p-E)*(p-E)+(f-u)*(f-u));return Math.abs(P)<.001&&(P=1),this.x=(A-w)/P,this.y=(p-E)/P,this.z=(f-u)/P,this.w=Math.acos((c+x+I-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Zn=class extends za{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Gr(0,0,e,t),this.scissorTest=!1,this.viewport=new Gr(0,0,e,t);let r={width:e,height:t,depth:1};this.texture=new Zs(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:cn,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new tK(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},iK=class extends Zs{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=ns,this.minFilter=ns,this.wrapR=js,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},qge=class extends Zs{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=ns,this.minFilter=ns,this.wrapR=js,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Yge=class extends Zn{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;let s=this.texture;this.texture=[];for(let n=0;n<i;n++)this.texture[n]=s.clone(),this.texture[n].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,s=this.texture.length;r<s;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},Vr=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,n,c){let u=i[r+0],p=i[r+1],f=i[r+2],x=i[r+3],w=s[n+0],E=s[n+1],A=s[n+2],I=s[n+3];if(c===0){e[t+0]=u,e[t+1]=p,e[t+2]=f,e[t+3]=x;return}if(c===1){e[t+0]=w,e[t+1]=E,e[t+2]=A,e[t+3]=I;return}if(x!==I||u!==w||p!==E||f!==A){let P=1-c,O=u*w+p*E+f*A+x*I,k=O>=0?1:-1,U=1-O*O;if(U>Number.EPSILON){let V=Math.sqrt(U),$=Math.atan2(V,O*k);P=Math.sin(P*$)/V,c=Math.sin(c*$)/V}let j=c*k;if(u=u*P+w*j,p=p*P+E*j,f=f*P+A*j,x=x*P+I*j,P===1-c){let V=1/Math.sqrt(u*u+p*p+f*f+x*x);u*=V,p*=V,f*=V,x*=V}}e[t]=u,e[t+1]=p,e[t+2]=f,e[t+3]=x}static multiplyQuaternionsFlat(e,t,i,r,s,n){let c=i[r],u=i[r+1],p=i[r+2],f=i[r+3],x=s[n],w=s[n+1],E=s[n+2],A=s[n+3];return e[t]=c*A+f*x+u*E-p*w,e[t+1]=u*A+f*w+p*x-c*E,e[t+2]=p*A+f*E+c*w-u*x,e[t+3]=f*A-c*x-u*w-p*E,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,r=e._y,s=e._z,n=e._order,c=Math.cos,u=Math.sin,p=c(i/2),f=c(r/2),x=c(s/2),w=u(i/2),E=u(r/2),A=u(s/2);switch(n){case"XYZ":this._x=w*f*x+p*E*A,this._y=p*E*x-w*f*A,this._z=p*f*A+w*E*x,this._w=p*f*x-w*E*A;break;case"YXZ":this._x=w*f*x+p*E*A,this._y=p*E*x-w*f*A,this._z=p*f*A-w*E*x,this._w=p*f*x+w*E*A;break;case"ZXY":this._x=w*f*x-p*E*A,this._y=p*E*x+w*f*A,this._z=p*f*A+w*E*x,this._w=p*f*x-w*E*A;break;case"ZYX":this._x=w*f*x-p*E*A,this._y=p*E*x+w*f*A,this._z=p*f*A-w*E*x,this._w=p*f*x+w*E*A;break;case"YZX":this._x=w*f*x+p*E*A,this._y=p*E*x+w*f*A,this._z=p*f*A-w*E*x,this._w=p*f*x-w*E*A;break;case"XZY":this._x=w*f*x-p*E*A,this._y=p*E*x-w*f*A,this._z=p*f*A+w*E*x,this._w=p*f*x+w*E*A;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],s=t[8],n=t[1],c=t[5],u=t[9],p=t[2],f=t[6],x=t[10],w=i+c+x;if(w>0){let E=.5/Math.sqrt(w+1);this._w=.25/E,this._x=(f-u)*E,this._y=(s-p)*E,this._z=(n-r)*E}else if(i>c&&i>x){let E=2*Math.sqrt(1+i-c-x);this._w=(f-u)/E,this._x=.25*E,this._y=(r+n)/E,this._z=(s+p)/E}else if(c>x){let E=2*Math.sqrt(1+c-i-x);this._w=(s-p)/E,this._x=(r+n)/E,this._y=.25*E,this._z=(u+f)/E}else{let E=2*Math.sqrt(1+x-i-c);this._w=(n-r)/E,this._x=(s+p)/E,this._y=(u+f)/E,this._z=.25*E}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Eo(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(i===0)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,s=e._z,n=e._w,c=t._x,u=t._y,p=t._z,f=t._w;return this._x=i*f+n*c+r*p-s*u,this._y=r*f+n*u+s*c-i*p,this._z=s*f+n*p+i*u-r*c,this._w=n*f-i*c-r*u-s*p,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let i=this._x,r=this._y,s=this._z,n=this._w,c=n*e._w+i*e._x+r*e._y+s*e._z;if(c<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,c=-c):this.copy(e),c>=1)return this._w=n,this._x=i,this._y=r,this._z=s,this;let u=1-c*c;if(u<=Number.EPSILON){let E=1-t;return this._w=E*n+t*this._w,this._x=E*i+t*this._x,this._y=E*r+t*this._y,this._z=E*s+t*this._z,this.normalize(),this._onChangeCallback(),this}let p=Math.sqrt(u),f=Math.atan2(p,c),x=Math.sin((1-t)*f)/p,w=Math.sin(t*f)/p;return this._w=n*x+this._w*w,this._x=i*x+this._x*w,this._y=r*x+this._y*w,this._z=s*x+this._z*w,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(s),i*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},se=class{constructor(e=0,t=0,i=0){se.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(h7.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(h7.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,s=e.elements,n=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*n,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*n,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*n,this}applyQuaternion(e){let t=this.x,i=this.y,r=this.z,s=e.x,n=e.y,c=e.z,u=e.w,p=u*t+n*r-c*i,f=u*i+c*t-s*r,x=u*r+s*i-n*t,w=-s*t-n*i-c*r;return this.x=p*u+w*-s+f*-c-x*-n,this.y=f*u+w*-n+x*-s-p*-c,this.z=x*u+w*-c+p*-n-f*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,r=e.y,s=e.z,n=t.x,c=t.y,u=t.z;return this.x=r*u-s*c,this.y=s*n-i*u,this.z=i*c-r*n,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return fF.copy(this).projectOnVector(e),this.sub(fF)}reflect(e){return this.sub(fF.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(Eo(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},fF=new se,h7=new Vr,mo=class{constructor(e=new se(1/0,1/0,1/0),t=new se(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,s=-1/0,n=-1/0,c=-1/0;for(let u=0,p=e.length;u<p;u+=3){let f=e[u],x=e[u+1],w=e[u+2];f<t&&(t=f),x<i&&(i=x),w<r&&(r=w),f>s&&(s=f),x>n&&(n=x),w>c&&(c=w)}return this.min.set(t,i,r),this.max.set(s,n,c),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,s=-1/0,n=-1/0,c=-1/0;for(let u=0,p=e.count;u<p;u++){let f=e.getX(u),x=e.getY(u),w=e.getZ(u);f<t&&(t=f),x<i&&(i=x),w<r&&(r=w),f>s&&(s=f),x>n&&(n=x),w>c&&(c=w)}return this.min.set(t,i,r),this.max.set(s,n,c),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=iy.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){let s=i.attributes.position;for(let n=0,c=s.count;n<c;n++)iy.fromBufferAttribute(s,n).applyMatrix4(e.matrixWorld),this.expandByPoint(iy)}else i.boundingBox===null&&i.computeBoundingBox(),mF.copy(i.boundingBox),mF.applyMatrix4(e.matrixWorld),this.union(mF);let r=e.children;for(let s=0,n=r.length;s<n;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,iy),iy.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(vw),IC.subVectors(this.max,vw),n_.subVectors(e.a,vw),s_.subVectors(e.b,vw),o_.subVectors(e.c,vw),Nf.subVectors(s_,n_),Bf.subVectors(o_,s_),ry.subVectors(n_,o_);let t=[0,-Nf.z,Nf.y,0,-Bf.z,Bf.y,0,-ry.z,ry.y,Nf.z,0,-Nf.x,Bf.z,0,-Bf.x,ry.z,0,-ry.x,-Nf.y,Nf.x,0,-Bf.y,Bf.x,0,-ry.y,ry.x,0];return!gF(t,n_,s_,o_,IC)||(t=[1,0,0,0,1,0,0,0,1],!gF(t,n_,s_,o_,IC))?!1:(PC.crossVectors(Nf,Bf),t=[PC.x,PC.y,PC.z],gF(t,n_,s_,o_,IC))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return iy.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(iy).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Wd[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Wd[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Wd[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Wd[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Wd[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Wd[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Wd[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Wd[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Wd),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Wd=[new se,new se,new se,new se,new se,new se,new se,new se],iy=new se,mF=new mo,n_=new se,s_=new se,o_=new se,Nf=new se,Bf=new se,ry=new se,vw=new se,IC=new se,PC=new se,ny=new se;function gF(e,t,i,r,s){for(let n=0,c=e.length-3;n<=c;n+=3){ny.fromArray(e,n);let u=s.x*Math.abs(ny.x)+s.y*Math.abs(ny.y)+s.z*Math.abs(ny.z),p=t.dot(ny),f=i.dot(ny),x=r.dot(ny);if(Math.max(-Math.max(p,f,x),Math.min(p,f,x))>u)return!1}return!0}var Xge=new mo,_w=new se,yF=new se,jl=class{constructor(e=new se,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;t!==void 0?i.copy(t):Xge.setFromPoints(e).getCenter(i);let r=0;for(let s=0,n=e.length;s<n;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;_w.subVectors(e,this.center);let t=_w.lengthSq();if(t>this.radius*this.radius){let i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(_w,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(yF.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(_w.copy(e.center).add(yF)),this.expandByPoint(_w.copy(e.center).sub(yF))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},qd=new se,vF=new se,RC=new se,Uf=new se,_F=new se,OC=new se,xF=new se,Sx=class{constructor(e=new se,t=new se(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,qd)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=qd.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(qd.copy(this.direction).multiplyScalar(t).add(this.origin),qd.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){vF.copy(e).add(t).multiplyScalar(.5),RC.copy(t).sub(e).normalize(),Uf.copy(this.origin).sub(vF);let s=e.distanceTo(t)*.5,n=-this.direction.dot(RC),c=Uf.dot(this.direction),u=-Uf.dot(RC),p=Uf.lengthSq(),f=Math.abs(1-n*n),x,w,E,A;if(f>0)if(x=n*u-c,w=n*c-u,A=s*f,x>=0)if(w>=-A)if(w<=A){let I=1/f;x*=I,w*=I,E=x*(x+n*w+2*c)+w*(n*x+w+2*u)+p}else w=s,x=Math.max(0,-(n*w+c)),E=-x*x+w*(w+2*u)+p;else w=-s,x=Math.max(0,-(n*w+c)),E=-x*x+w*(w+2*u)+p;else w<=-A?(x=Math.max(0,-(-n*s+c)),w=x>0?-s:Math.min(Math.max(-s,-u),s),E=-x*x+w*(w+2*u)+p):w<=A?(x=0,w=Math.min(Math.max(-s,-u),s),E=w*(w+2*u)+p):(x=Math.max(0,-(n*s+c)),w=x>0?s:Math.min(Math.max(-s,-u),s),E=-x*x+w*(w+2*u)+p);else w=n>0?-s:s,x=Math.max(0,-(n*w+c)),E=-x*x+w*(w+2*u)+p;return i&&i.copy(this.direction).multiplyScalar(x).add(this.origin),r&&r.copy(RC).multiplyScalar(w).add(vF),E}intersectSphere(e,t){qd.subVectors(e.center,this.origin);let i=qd.dot(this.direction),r=qd.dot(qd)-i*i,s=e.radius*e.radius;if(r>s)return null;let n=Math.sqrt(s-r),c=i-n,u=i+n;return c<0&&u<0?null:c<0?this.at(u,t):this.at(c,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,n,c,u,p=1/this.direction.x,f=1/this.direction.y,x=1/this.direction.z,w=this.origin;return p>=0?(i=(e.min.x-w.x)*p,r=(e.max.x-w.x)*p):(i=(e.max.x-w.x)*p,r=(e.min.x-w.x)*p),f>=0?(s=(e.min.y-w.y)*f,n=(e.max.y-w.y)*f):(s=(e.max.y-w.y)*f,n=(e.min.y-w.y)*f),i>n||s>r||((s>i||isNaN(i))&&(i=s),(n<r||isNaN(r))&&(r=n),x>=0?(c=(e.min.z-w.z)*x,u=(e.max.z-w.z)*x):(c=(e.max.z-w.z)*x,u=(e.min.z-w.z)*x),i>u||c>r)||((c>i||i!==i)&&(i=c),(u<r||r!==r)&&(r=u),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,qd)!==null}intersectTriangle(e,t,i,r,s){_F.subVectors(t,e),OC.subVectors(i,e),xF.crossVectors(_F,OC);let n=this.direction.dot(xF),c;if(n>0){if(r)return null;c=1}else if(n<0)c=-1,n=-n;else return null;Uf.subVectors(this.origin,e);let u=c*this.direction.dot(OC.crossVectors(Uf,OC));if(u<0)return null;let p=c*this.direction.dot(_F.cross(Uf));if(p<0||u+p>n)return null;let f=-c*Uf.dot(xF);return f<0?null:this.at(f/n,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},mi=class{constructor(){mi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,r,s,n,c,u,p,f,x,w,E,A,I,P){let O=this.elements;return O[0]=e,O[4]=t,O[8]=i,O[12]=r,O[1]=s,O[5]=n,O[9]=c,O[13]=u,O[2]=p,O[6]=f,O[10]=x,O[14]=w,O[3]=E,O[7]=A,O[11]=I,O[15]=P,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new mi().fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,r=1/a_.setFromMatrixColumn(e,0).length(),s=1/a_.setFromMatrixColumn(e,1).length(),n=1/a_.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*n,t[9]=i[9]*n,t[10]=i[10]*n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,i=e.x,r=e.y,s=e.z,n=Math.cos(i),c=Math.sin(i),u=Math.cos(r),p=Math.sin(r),f=Math.cos(s),x=Math.sin(s);if(e.order==="XYZ"){let w=n*f,E=n*x,A=c*f,I=c*x;t[0]=u*f,t[4]=-u*x,t[8]=p,t[1]=E+A*p,t[5]=w-I*p,t[9]=-c*u,t[2]=I-w*p,t[6]=A+E*p,t[10]=n*u}else if(e.order==="YXZ"){let w=u*f,E=u*x,A=p*f,I=p*x;t[0]=w+I*c,t[4]=A*c-E,t[8]=n*p,t[1]=n*x,t[5]=n*f,t[9]=-c,t[2]=E*c-A,t[6]=I+w*c,t[10]=n*u}else if(e.order==="ZXY"){let w=u*f,E=u*x,A=p*f,I=p*x;t[0]=w-I*c,t[4]=-n*x,t[8]=A+E*c,t[1]=E+A*c,t[5]=n*f,t[9]=I-w*c,t[2]=-n*p,t[6]=c,t[10]=n*u}else if(e.order==="ZYX"){let w=n*f,E=n*x,A=c*f,I=c*x;t[0]=u*f,t[4]=A*p-E,t[8]=w*p+I,t[1]=u*x,t[5]=I*p+w,t[9]=E*p-A,t[2]=-p,t[6]=c*u,t[10]=n*u}else if(e.order==="YZX"){let w=n*u,E=n*p,A=c*u,I=c*p;t[0]=u*f,t[4]=I-w*x,t[8]=A*x+E,t[1]=x,t[5]=n*f,t[9]=-c*f,t[2]=-p*f,t[6]=E*x+A,t[10]=w-I*x}else if(e.order==="XZY"){let w=n*u,E=n*p,A=c*u,I=c*p;t[0]=u*f,t[4]=-x,t[8]=p*f,t[1]=w*x+I,t[5]=n*f,t[9]=E*x-A,t[2]=A*x-E,t[6]=c*f,t[10]=I*x+w}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose($ge,e,Zge)}lookAt(e,t,i){let r=this.elements;return hc.subVectors(e,t),hc.lengthSq()===0&&(hc.z=1),hc.normalize(),jf.crossVectors(i,hc),jf.lengthSq()===0&&(Math.abs(i.z)===1?hc.x+=1e-4:hc.z+=1e-4,hc.normalize(),jf.crossVectors(i,hc)),jf.normalize(),LC.crossVectors(hc,jf),r[0]=jf.x,r[4]=LC.x,r[8]=hc.x,r[1]=jf.y,r[5]=LC.y,r[9]=hc.y,r[2]=jf.z,r[6]=LC.z,r[10]=hc.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,s=this.elements,n=i[0],c=i[4],u=i[8],p=i[12],f=i[1],x=i[5],w=i[9],E=i[13],A=i[2],I=i[6],P=i[10],O=i[14],k=i[3],U=i[7],j=i[11],V=i[15],$=r[0],Y=r[4],J=r[8],X=r[12],ee=r[1],oe=r[5],le=r[9],ve=r[13],we=r[2],fe=r[6],Ue=r[10],Fe=r[14],Pe=r[3],Ae=r[7],et=r[11],$e=r[15];return s[0]=n*$+c*ee+u*we+p*Pe,s[4]=n*Y+c*oe+u*fe+p*Ae,s[8]=n*J+c*le+u*Ue+p*et,s[12]=n*X+c*ve+u*Fe+p*$e,s[1]=f*$+x*ee+w*we+E*Pe,s[5]=f*Y+x*oe+w*fe+E*Ae,s[9]=f*J+x*le+w*Ue+E*et,s[13]=f*X+x*ve+w*Fe+E*$e,s[2]=A*$+I*ee+P*we+O*Pe,s[6]=A*Y+I*oe+P*fe+O*Ae,s[10]=A*J+I*le+P*Ue+O*et,s[14]=A*X+I*ve+P*Fe+O*$e,s[3]=k*$+U*ee+j*we+V*Pe,s[7]=k*Y+U*oe+j*fe+V*Ae,s[11]=k*J+U*le+j*Ue+V*et,s[15]=k*X+U*ve+j*Fe+V*$e,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],n=e[1],c=e[5],u=e[9],p=e[13],f=e[2],x=e[6],w=e[10],E=e[14],A=e[3],I=e[7],P=e[11],O=e[15];return A*(+s*u*x-r*p*x-s*c*w+i*p*w+r*c*E-i*u*E)+I*(+t*u*E-t*p*w+s*n*w-r*n*E+r*p*f-s*u*f)+P*(+t*p*x-t*c*E-s*n*x+i*n*E+s*c*f-i*p*f)+O*(-r*c*f-t*u*x+t*c*w+r*n*x-i*n*w+i*u*f)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],c=e[5],u=e[6],p=e[7],f=e[8],x=e[9],w=e[10],E=e[11],A=e[12],I=e[13],P=e[14],O=e[15],k=x*P*p-I*w*p+I*u*E-c*P*E-x*u*O+c*w*O,U=A*w*p-f*P*p-A*u*E+n*P*E+f*u*O-n*w*O,j=f*I*p-A*x*p+A*c*E-n*I*E-f*c*O+n*x*O,V=A*x*u-f*I*u-A*c*w+n*I*w+f*c*P-n*x*P,$=t*k+i*U+r*j+s*V;if($===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let Y=1/$;return e[0]=k*Y,e[1]=(I*w*s-x*P*s-I*r*E+i*P*E+x*r*O-i*w*O)*Y,e[2]=(c*P*s-I*u*s+I*r*p-i*P*p-c*r*O+i*u*O)*Y,e[3]=(x*u*s-c*w*s-x*r*p+i*w*p+c*r*E-i*u*E)*Y,e[4]=U*Y,e[5]=(f*P*s-A*w*s+A*r*E-t*P*E-f*r*O+t*w*O)*Y,e[6]=(A*u*s-n*P*s-A*r*p+t*P*p+n*r*O-t*u*O)*Y,e[7]=(n*w*s-f*u*s+f*r*p-t*w*p-n*r*E+t*u*E)*Y,e[8]=j*Y,e[9]=(A*x*s-f*I*s-A*i*E+t*I*E+f*i*O-t*x*O)*Y,e[10]=(n*I*s-A*c*s+A*i*p-t*I*p-n*i*O+t*c*O)*Y,e[11]=(f*c*s-n*x*s-f*i*p+t*x*p+n*i*E-t*c*E)*Y,e[12]=V*Y,e[13]=(f*I*r-A*x*r+A*i*w-t*I*w-f*i*P+t*x*P)*Y,e[14]=(A*c*r-n*I*r-A*i*u+t*I*u+n*i*P-t*c*P)*Y,e[15]=(n*x*r-f*c*r+f*i*u-t*x*u-n*i*w+t*c*w)*Y,this}scale(e){let t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),r=Math.sin(t),s=1-i,n=e.x,c=e.y,u=e.z,p=s*n,f=s*c;return this.set(p*n+i,p*c-r*u,p*u+r*c,0,p*c+r*u,f*c+i,f*u-r*n,0,p*u-r*c,f*u+r*n,s*u*u+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,n){return this.set(1,i,s,0,e,1,n,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){let r=this.elements,s=t._x,n=t._y,c=t._z,u=t._w,p=s+s,f=n+n,x=c+c,w=s*p,E=s*f,A=s*x,I=n*f,P=n*x,O=c*x,k=u*p,U=u*f,j=u*x,V=i.x,$=i.y,Y=i.z;return r[0]=(1-(I+O))*V,r[1]=(E+j)*V,r[2]=(A-U)*V,r[3]=0,r[4]=(E-j)*$,r[5]=(1-(w+O))*$,r[6]=(P+k)*$,r[7]=0,r[8]=(A+U)*Y,r[9]=(P-k)*Y,r[10]=(1-(w+I))*Y,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){let r=this.elements,s=a_.set(r[0],r[1],r[2]).length(),n=a_.set(r[4],r[5],r[6]).length(),c=a_.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],Iu.copy(this);let u=1/s,p=1/n,f=1/c;return Iu.elements[0]*=u,Iu.elements[1]*=u,Iu.elements[2]*=u,Iu.elements[4]*=p,Iu.elements[5]*=p,Iu.elements[6]*=p,Iu.elements[8]*=f,Iu.elements[9]*=f,Iu.elements[10]*=f,t.setFromRotationMatrix(Iu),i.x=s,i.y=n,i.z=c,this}makePerspective(e,t,i,r,s,n){let c=this.elements,u=2*s/(t-e),p=2*s/(i-r),f=(t+e)/(t-e),x=(i+r)/(i-r),w=-(n+s)/(n-s),E=-2*n*s/(n-s);return c[0]=u,c[4]=0,c[8]=f,c[12]=0,c[1]=0,c[5]=p,c[9]=x,c[13]=0,c[2]=0,c[6]=0,c[10]=w,c[14]=E,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,i,r,s,n){let c=this.elements,u=1/(t-e),p=1/(i-r),f=1/(n-s),x=(t+e)*u,w=(i+r)*p,E=(n+s)*f;return c[0]=2*u,c[4]=0,c[8]=0,c[12]=-x,c[1]=0,c[5]=2*p,c[9]=0,c[13]=-w,c[2]=0,c[6]=0,c[10]=-2*f,c[14]=-E,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},a_=new se,Iu=new mi,$ge=new se(0,0,0),Zge=new se(1,1,1),jf=new se,LC=new se,hc=new se,d7=new mi,p7=new Vr,$o=class{constructor(e=0,t=0,i=0,r=$o.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let r=e.elements,s=r[0],n=r[4],c=r[8],u=r[1],p=r[5],f=r[9],x=r[2],w=r[6],E=r[10];switch(t){case"XYZ":this._y=Math.asin(Eo(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-f,E),this._z=Math.atan2(-n,s)):(this._x=Math.atan2(w,p),this._z=0);break;case"YXZ":this._x=Math.asin(-Eo(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(c,E),this._z=Math.atan2(u,p)):(this._y=Math.atan2(-x,s),this._z=0);break;case"ZXY":this._x=Math.asin(Eo(w,-1,1)),Math.abs(w)<.9999999?(this._y=Math.atan2(-x,E),this._z=Math.atan2(-n,p)):(this._y=0,this._z=Math.atan2(u,s));break;case"ZYX":this._y=Math.asin(-Eo(x,-1,1)),Math.abs(x)<.9999999?(this._x=Math.atan2(w,E),this._z=Math.atan2(u,s)):(this._x=0,this._z=Math.atan2(-n,p));break;case"YZX":this._z=Math.asin(Eo(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-f,p),this._y=Math.atan2(-x,s)):(this._x=0,this._y=Math.atan2(c,E));break;case"XZY":this._z=Math.asin(-Eo(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(w,p),this._y=Math.atan2(c,s)):(this._x=Math.atan2(-f,E),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return d7.makeRotationFromQuaternion(e),this.setFromRotationMatrix(d7,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return p7.setFromEuler(this),this.setFromQuaternion(p7,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};$o.DEFAULT_ORDER="XYZ";var f4=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},Qge=0,f7=new se,l_=new Vr,Yd=new mi,zC=new se,xw=new se,Kge=new se,Jge=new Vr,m7=new se(1,0,0),g7=new se(0,1,0),y7=new se(0,0,1),eye={type:"added"},v7={type:"removed"},ls=class extends za{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Qge++}),this.uuid=Zc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ls.DEFAULT_UP.clone();let e=new se,t=new $o,i=new Vr,r=new se(1,1,1);function s(){i.setFromEuler(t,!1)}function n(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(n),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new mi},normalMatrix:{value:new Ao}}),this.matrix=new mi,this.matrixWorld=new mi,this.matrixAutoUpdate=ls.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=ls.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new f4,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return l_.setFromAxisAngle(e,t),this.quaternion.multiply(l_),this}rotateOnWorldAxis(e,t){return l_.setFromAxisAngle(e,t),this.quaternion.premultiply(l_),this}rotateX(e){return this.rotateOnAxis(m7,e)}rotateY(e){return this.rotateOnAxis(g7,e)}rotateZ(e){return this.rotateOnAxis(y7,e)}translateOnAxis(e,t){return f7.copy(e).applyQuaternion(this.quaternion),this.position.add(f7.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(m7,e)}translateY(e){return this.translateOnAxis(g7,e)}translateZ(e){return this.translateOnAxis(y7,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Yd.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?zC.copy(e):zC.set(e,t,i);let r=this.parent;this.updateWorldMatrix(!0,!1),xw.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Yd.lookAt(xw,zC,this.up):Yd.lookAt(zC,xw,this.up),this.quaternion.setFromRotationMatrix(Yd),r&&(Yd.extractRotation(r.matrixWorld),l_.setFromRotationMatrix(Yd),this.quaternion.premultiply(l_.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(eye)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(v7)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(v7)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Yd.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Yd.multiply(e.parent.matrixWorld)),e.applyMatrix4(Yd),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){let s=this.children[i].getObjectByProperty(e,t);if(s!==void 0)return s}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let r=0,s=this.children.length;r<s;r++){let n=this.children[r].getObjectsByProperty(e,t);n.length>0&&(i=i.concat(n))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xw,e,Kge),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xw,Jge,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,r=t.length;i<r;i++){let s=t[i];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let r=this.children;for(let s=0,n=r.length;s<n;s++){let c=r[s];c.matrixWorldAutoUpdate===!0&&c.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function s(c,u){return c[u.uuid]===void 0&&(c[u.uuid]=u.toJSON(e)),u.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);let c=this.geometry.parameters;if(c!==void 0&&c.shapes!==void 0){let u=c.shapes;if(Array.isArray(u))for(let p=0,f=u.length;p<f;p++){let x=u[p];s(e.shapes,x)}else s(e.shapes,u)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let c=[];for(let u=0,p=this.material.length;u<p;u++)c.push(s(e.materials,this.material[u]));r.material=c}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let c=0;c<this.children.length;c++)r.children.push(this.children[c].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let c=0;c<this.animations.length;c++){let u=this.animations[c];r.animations.push(s(e.animations,u))}}if(t){let c=n(e.geometries),u=n(e.materials),p=n(e.textures),f=n(e.images),x=n(e.shapes),w=n(e.skeletons),E=n(e.animations),A=n(e.nodes);c.length>0&&(i.geometries=c),u.length>0&&(i.materials=u),p.length>0&&(i.textures=p),f.length>0&&(i.images=f),x.length>0&&(i.shapes=x),w.length>0&&(i.skeletons=w),E.length>0&&(i.animations=E),A.length>0&&(i.nodes=A)}return i.object=r,i;function n(c){let u=[];for(let p in c){let f=c[p];delete f.metadata,u.push(f)}return u}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){let r=e.children[i];this.add(r.clone())}return this}};ls.DEFAULT_UP=new se(0,1,0);ls.DEFAULT_MATRIX_AUTO_UPDATE=!0;ls.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var Pu=new se,Xd=new se,bF=new se,$d=new se,c_=new se,u_=new se,_7=new se,wF=new se,SF=new se,EF=new se,Ia=class{constructor(e=new se,t=new se,i=new se){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),Pu.subVectors(e,t),r.cross(Pu);let s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){Pu.subVectors(r,t),Xd.subVectors(i,t),bF.subVectors(e,t);let n=Pu.dot(Pu),c=Pu.dot(Xd),u=Pu.dot(bF),p=Xd.dot(Xd),f=Xd.dot(bF),x=n*p-c*c;if(x===0)return s.set(-2,-1,-1);let w=1/x,E=(p*u-c*f)*w,A=(n*f-c*u)*w;return s.set(1-E-A,A,E)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,$d),$d.x>=0&&$d.y>=0&&$d.x+$d.y<=1}static getUV(e,t,i,r,s,n,c,u){return this.getBarycoord(e,t,i,r,$d),u.set(0,0),u.addScaledVector(s,$d.x),u.addScaledVector(n,$d.y),u.addScaledVector(c,$d.z),u}static isFrontFacing(e,t,i,r){return Pu.subVectors(i,t),Xd.subVectors(e,t),Pu.cross(Xd).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Pu.subVectors(this.c,this.b),Xd.subVectors(this.a,this.b),Pu.cross(Xd).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ia.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ia.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,s){return Ia.getUV(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return Ia.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ia.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i=this.a,r=this.b,s=this.c,n,c;c_.subVectors(r,i),u_.subVectors(s,i),wF.subVectors(e,i);let u=c_.dot(wF),p=u_.dot(wF);if(u<=0&&p<=0)return t.copy(i);SF.subVectors(e,r);let f=c_.dot(SF),x=u_.dot(SF);if(f>=0&&x<=f)return t.copy(r);let w=u*x-f*p;if(w<=0&&u>=0&&f<=0)return n=u/(u-f),t.copy(i).addScaledVector(c_,n);EF.subVectors(e,s);let E=c_.dot(EF),A=u_.dot(EF);if(A>=0&&E<=A)return t.copy(s);let I=E*p-u*A;if(I<=0&&p>=0&&A<=0)return c=p/(p-A),t.copy(i).addScaledVector(u_,c);let P=f*A-E*x;if(P<=0&&x-f>=0&&E-A>=0)return _7.subVectors(s,r),c=(x-f)/(x-f+(E-A)),t.copy(r).addScaledVector(_7,c);let O=1/(P+I+w);return n=I*O,c=w*O,t.copy(i).addScaledVector(c_,n).addScaledVector(u_,c)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},tye=0,jS=class extends za{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:tye++}),this.uuid=Zc(),this.name="",this.type="Material",this.blending=Iy,this.side=Yu,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=VQ,this.blendDst=GQ,this.blendEquation=L_,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=lN,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Dge,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=cF,this.stencilZFail=cF,this.stencilZPass=cF,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Iy&&(i.blending=this.blending),this.side!==Yu&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){let n=[];for(let c in s){let u=s[c];delete u.metadata,n.push(u)}return n}if(t){let s=r(e.textures),n=r(e.images);s.length>0&&(i.textures=s),n.length>0&&(i.images=n)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(t!==null){let r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},Sp=class extends jS{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Tr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=HQ,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},wo=new se,FC=new lt,Fr=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=dN,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)FC.fromBufferAttribute(this,t),FC.applyMatrix3(e),this.setXY(t,FC.x,FC.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)wo.fromBufferAttribute(this,t),wo.applyMatrix3(e),this.setXYZ(t,wo.x,wo.y,wo.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)wo.fromBufferAttribute(this,t),wo.applyMatrix4(e),this.setXYZ(t,wo.x,wo.y,wo.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)wo.fromBufferAttribute(this,t),wo.applyNormalMatrix(e),this.setXYZ(t,wo.x,wo.y,wo.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)wo.fromBufferAttribute(this,t),wo.transformDirection(e),this.setXYZ(t,wo.x,wo.y,wo.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=mp(t,this.array)),t}setX(e,t){return this.normalized&&(t=Cs(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=mp(t,this.array)),t}setY(e,t){return this.normalized&&(t=Cs(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=mp(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Cs(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=mp(t,this.array)),t}setW(e,t){return this.normalized&&(t=Cs(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Cs(t,this.array),i=Cs(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Cs(t,this.array),i=Cs(i,this.array),r=Cs(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=Cs(t,this.array),i=Cs(i,this.array),r=Cs(r,this.array),s=Cs(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==dN&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},rK=class extends Fr{constructor(e,t,i){super(new Uint16Array(e),t,i)}},X_=class extends Fr{constructor(e,t,i){super(new Uint32Array(e),t,i)}},Vi=class extends Fr{constructor(e,t,i){super(new Float32Array(e),t,i)}},iye=0,Bc=new mi,MF=new ls,h_=new se,dc=new mo,bw=new mo,oa=new se,fr=class extends za{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:iye++}),this.uuid=Zc(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(KQ(e)?X_:rK)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let s=new Ao().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Bc.makeRotationFromQuaternion(e),this.applyMatrix4(Bc),this}rotateX(e){return Bc.makeRotationX(e),this.applyMatrix4(Bc),this}rotateY(e){return Bc.makeRotationY(e),this.applyMatrix4(Bc),this}rotateZ(e){return Bc.makeRotationZ(e),this.applyMatrix4(Bc),this}translate(e,t,i){return Bc.makeTranslation(e,t,i),this.applyMatrix4(Bc),this}scale(e,t,i){return Bc.makeScale(e,t,i),this.applyMatrix4(Bc),this}lookAt(e){return MF.lookAt(e),MF.updateMatrix(),this.applyMatrix4(MF.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(h_).negate(),this.translate(h_.x,h_.y,h_.z),this}setFromPoints(e){let t=[];for(let i=0,r=e.length;i<r;i++){let s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Vi(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new mo);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new se(-1/0,-1/0,-1/0),new se(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){let s=t[i];dc.setFromBufferAttribute(s),this.morphTargetsRelative?(oa.addVectors(this.boundingBox.min,dc.min),this.boundingBox.expandByPoint(oa),oa.addVectors(this.boundingBox.max,dc.max),this.boundingBox.expandByPoint(oa)):(this.boundingBox.expandByPoint(dc.min),this.boundingBox.expandByPoint(dc.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new jl);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new se,1/0);return}if(e){let i=this.boundingSphere.center;if(dc.setFromBufferAttribute(e),t)for(let s=0,n=t.length;s<n;s++){let c=t[s];bw.setFromBufferAttribute(c),this.morphTargetsRelative?(oa.addVectors(dc.min,bw.min),dc.expandByPoint(oa),oa.addVectors(dc.max,bw.max),dc.expandByPoint(oa)):(dc.expandByPoint(bw.min),dc.expandByPoint(bw.max))}dc.getCenter(i);let r=0;for(let s=0,n=e.count;s<n;s++)oa.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(oa));if(t)for(let s=0,n=t.length;s<n;s++){let c=t[s],u=this.morphTargetsRelative;for(let p=0,f=c.count;p<f;p++)oa.fromBufferAttribute(c,p),u&&(h_.fromBufferAttribute(e,p),oa.add(h_)),r=Math.max(r,i.distanceToSquared(oa))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=e.array,r=t.position.array,s=t.normal.array,n=t.uv.array,c=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Fr(new Float32Array(4*c),4));let u=this.getAttribute("tangent").array,p=[],f=[];for(let ee=0;ee<c;ee++)p[ee]=new se,f[ee]=new se;let x=new se,w=new se,E=new se,A=new lt,I=new lt,P=new lt,O=new se,k=new se;function U(ee,oe,le){x.fromArray(r,ee*3),w.fromArray(r,oe*3),E.fromArray(r,le*3),A.fromArray(n,ee*2),I.fromArray(n,oe*2),P.fromArray(n,le*2),w.sub(x),E.sub(x),I.sub(A),P.sub(A);let ve=1/(I.x*P.y-P.x*I.y);!isFinite(ve)||(O.copy(w).multiplyScalar(P.y).addScaledVector(E,-I.y).multiplyScalar(ve),k.copy(E).multiplyScalar(I.x).addScaledVector(w,-P.x).multiplyScalar(ve),p[ee].add(O),p[oe].add(O),p[le].add(O),f[ee].add(k),f[oe].add(k),f[le].add(k))}let j=this.groups;j.length===0&&(j=[{start:0,count:i.length}]);for(let ee=0,oe=j.length;ee<oe;++ee){let le=j[ee],ve=le.start,we=le.count;for(let fe=ve,Ue=ve+we;fe<Ue;fe+=3)U(i[fe+0],i[fe+1],i[fe+2])}let V=new se,$=new se,Y=new se,J=new se;function X(ee){Y.fromArray(s,ee*3),J.copy(Y);let oe=p[ee];V.copy(oe),V.sub(Y.multiplyScalar(Y.dot(oe))).normalize(),$.crossVectors(J,oe);let le=$.dot(f[ee])<0?-1:1;u[ee*4]=V.x,u[ee*4+1]=V.y,u[ee*4+2]=V.z,u[ee*4+3]=le}for(let ee=0,oe=j.length;ee<oe;++ee){let le=j[ee],ve=le.start,we=le.count;for(let fe=ve,Ue=ve+we;fe<Ue;fe+=3)X(i[fe+0]),X(i[fe+1]),X(i[fe+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Fr(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let w=0,E=i.count;w<E;w++)i.setXYZ(w,0,0,0);let r=new se,s=new se,n=new se,c=new se,u=new se,p=new se,f=new se,x=new se;if(e)for(let w=0,E=e.count;w<E;w+=3){let A=e.getX(w+0),I=e.getX(w+1),P=e.getX(w+2);r.fromBufferAttribute(t,A),s.fromBufferAttribute(t,I),n.fromBufferAttribute(t,P),f.subVectors(n,s),x.subVectors(r,s),f.cross(x),c.fromBufferAttribute(i,A),u.fromBufferAttribute(i,I),p.fromBufferAttribute(i,P),c.add(f),u.add(f),p.add(f),i.setXYZ(A,c.x,c.y,c.z),i.setXYZ(I,u.x,u.y,u.z),i.setXYZ(P,p.x,p.y,p.z)}else for(let w=0,E=t.count;w<E;w+=3)r.fromBufferAttribute(t,w+0),s.fromBufferAttribute(t,w+1),n.fromBufferAttribute(t,w+2),f.subVectors(n,s),x.subVectors(r,s),f.cross(x),i.setXYZ(w+0,f.x,f.y,f.z),i.setXYZ(w+1,f.x,f.y,f.z),i.setXYZ(w+2,f.x,f.y,f.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)oa.fromBufferAttribute(e,t),oa.normalize(),e.setXYZ(t,oa.x,oa.y,oa.z)}toNonIndexed(){function e(c,u){let p=c.array,f=c.itemSize,x=c.normalized,w=new p.constructor(u.length*f),E=0,A=0;for(let I=0,P=u.length;I<P;I++){c.isInterleavedBufferAttribute?E=u[I]*c.data.stride+c.offset:E=u[I]*f;for(let O=0;O<f;O++)w[A++]=p[E++]}return new Fr(w,f,x)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new fr,i=this.index.array,r=this.attributes;for(let c in r){let u=r[c],p=e(u,i);t.setAttribute(c,p)}let s=this.morphAttributes;for(let c in s){let u=[],p=s[c];for(let f=0,x=p.length;f<x;f++){let w=p[f],E=e(w,i);u.push(E)}t.morphAttributes[c]=u}t.morphTargetsRelative=this.morphTargetsRelative;let n=this.groups;for(let c=0,u=n.length;c<u;c++){let p=n[c];t.addGroup(p.start,p.count,p.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let u=this.parameters;for(let p in u)u[p]!==void 0&&(e[p]=u[p]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let u in i){let p=i[u];e.data.attributes[u]=p.toJSON(e.data)}let r={},s=!1;for(let u in this.morphAttributes){let p=this.morphAttributes[u],f=[];for(let x=0,w=p.length;x<w;x++){let E=p[x];f.push(E.toJSON(e.data))}f.length>0&&(r[u]=f,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let n=this.groups;n.length>0&&(e.data.groups=JSON.parse(JSON.stringify(n)));let c=this.boundingSphere;return c!==null&&(e.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;i!==null&&this.setIndex(i.clone(t));let r=e.attributes;for(let p in r){let f=r[p];this.setAttribute(p,f.clone(t))}let s=e.morphAttributes;for(let p in s){let f=[],x=s[p];for(let w=0,E=x.length;w<E;w++)f.push(x[w].clone(t));this.morphAttributes[p]=f}this.morphTargetsRelative=e.morphTargetsRelative;let n=e.groups;for(let p=0,f=n.length;p<f;p++){let x=n[p];this.addGroup(x.start,x.count,x.materialIndex)}let c=e.boundingBox;c!==null&&(this.boundingBox=c.clone());let u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},x7=new mi,d_=new Sx,TF=new jl,ww=new se,Sw=new se,Ew=new se,AF=new se,kC=new se,NC=new lt,BC=new lt,UC=new lt,CF=new se,jC=new se,$s=class extends ls{constructor(e=new fr,t=new Sp){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let n=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=r}}}}getVertexPosition(e,t){let i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,n=i.morphTargetsRelative;t.fromBufferAttribute(r,e);let c=this.morphTargetInfluences;if(s&&c){kC.set(0,0,0);for(let u=0,p=s.length;u<p;u++){let f=c[u],x=s[u];f!==0&&(AF.fromBufferAttribute(x,e),n?kC.addScaledVector(AF,f):kC.addScaledVector(AF.sub(t),f))}t.add(kC)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){let i=this.geometry,r=this.material,s=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),TF.copy(i.boundingSphere),TF.applyMatrix4(s),e.ray.intersectsSphere(TF)===!1)||(x7.copy(s).invert(),d_.copy(e.ray).applyMatrix4(x7),i.boundingBox!==null&&d_.intersectsBox(i.boundingBox)===!1))return;let n,c=i.index,u=i.attributes.position,p=i.attributes.uv,f=i.attributes.uv2,x=i.groups,w=i.drawRange;if(c!==null)if(Array.isArray(r))for(let E=0,A=x.length;E<A;E++){let I=x[E],P=r[I.materialIndex],O=Math.max(I.start,w.start),k=Math.min(c.count,Math.min(I.start+I.count,w.start+w.count));for(let U=O,j=k;U<j;U+=3){let V=c.getX(U),$=c.getX(U+1),Y=c.getX(U+2);n=VC(this,P,e,d_,p,f,V,$,Y),n&&(n.faceIndex=Math.floor(U/3),n.face.materialIndex=I.materialIndex,t.push(n))}}else{let E=Math.max(0,w.start),A=Math.min(c.count,w.start+w.count);for(let I=E,P=A;I<P;I+=3){let O=c.getX(I),k=c.getX(I+1),U=c.getX(I+2);n=VC(this,r,e,d_,p,f,O,k,U),n&&(n.faceIndex=Math.floor(I/3),t.push(n))}}else if(u!==void 0)if(Array.isArray(r))for(let E=0,A=x.length;E<A;E++){let I=x[E],P=r[I.materialIndex],O=Math.max(I.start,w.start),k=Math.min(u.count,Math.min(I.start+I.count,w.start+w.count));for(let U=O,j=k;U<j;U+=3){let V=U,$=U+1,Y=U+2;n=VC(this,P,e,d_,p,f,V,$,Y),n&&(n.faceIndex=Math.floor(U/3),n.face.materialIndex=I.materialIndex,t.push(n))}}else{let E=Math.max(0,w.start),A=Math.min(u.count,w.start+w.count);for(let I=E,P=A;I<P;I+=3){let O=I,k=I+1,U=I+2;n=VC(this,r,e,d_,p,f,O,k,U),n&&(n.faceIndex=Math.floor(I/3),t.push(n))}}}};function rye(e,t,i,r,s,n,c,u){let p;if(t.side===fa?p=r.intersectTriangle(c,n,s,!0,u):p=r.intersectTriangle(s,n,c,t.side===Yu,u),p===null)return null;jC.copy(u),jC.applyMatrix4(e.matrixWorld);let f=i.ray.origin.distanceTo(jC);return f<i.near||f>i.far?null:{distance:f,point:jC.clone(),object:e}}function VC(e,t,i,r,s,n,c,u,p){e.getVertexPosition(c,ww),e.getVertexPosition(u,Sw),e.getVertexPosition(p,Ew);let f=rye(e,t,i,r,ww,Sw,Ew,CF);if(f){s&&(NC.fromBufferAttribute(s,c),BC.fromBufferAttribute(s,u),UC.fromBufferAttribute(s,p),f.uv=Ia.getUV(CF,ww,Sw,Ew,NC,BC,UC,new lt)),n&&(NC.fromBufferAttribute(n,c),BC.fromBufferAttribute(n,u),UC.fromBufferAttribute(n,p),f.uv2=Ia.getUV(CF,ww,Sw,Ew,NC,BC,UC,new lt));let x={a:c,b:u,c:p,normal:new se,materialIndex:0};Ia.getNormal(ww,Sw,Ew,x.normal),f.face=x}return f}var $u=class extends fr{constructor(e=1,t=1,i=1,r=1,s=1,n=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:n};let c=this;r=Math.floor(r),s=Math.floor(s),n=Math.floor(n);let u=[],p=[],f=[],x=[],w=0,E=0;A("z","y","x",-1,-1,i,t,e,n,s,0),A("z","y","x",1,-1,i,t,-e,n,s,1),A("x","z","y",1,1,e,i,t,r,n,2),A("x","z","y",1,-1,e,i,-t,r,n,3),A("x","y","z",1,-1,e,t,i,r,s,4),A("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(u),this.setAttribute("position",new Vi(p,3)),this.setAttribute("normal",new Vi(f,3)),this.setAttribute("uv",new Vi(x,2));function A(I,P,O,k,U,j,V,$,Y,J,X){let ee=j/Y,oe=V/J,le=j/2,ve=V/2,we=$/2,fe=Y+1,Ue=J+1,Fe=0,Pe=0,Ae=new se;for(let et=0;et<Ue;et++){let $e=et*oe-ve;for(let rt=0;rt<fe;rt++){let Je=rt*ee-le;Ae[I]=Je*k,Ae[P]=$e*U,Ae[O]=we,p.push(Ae.x,Ae.y,Ae.z),Ae[I]=0,Ae[P]=0,Ae[O]=$>0?1:-1,f.push(Ae.x,Ae.y,Ae.z),x.push(rt/Y),x.push(1-et/J),Fe+=1}}for(let et=0;et<J;et++)for(let $e=0;$e<Y;$e++){let rt=w+$e+fe*et,Je=w+$e+fe*(et+1),bt=w+($e+1)+fe*(et+1),ot=w+($e+1)+fe*et;u.push(rt,Je,ot),u.push(Je,bt,ot),Pe+=6}c.addGroup(E,Pe,X),E+=Pe,w+=Fe}}static fromJSON(e){return new $u(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function lx(e){let t={};for(let i in e){t[i]={};for(let r in e[i]){let s=e[i][r];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?t[i][r]=s.clone():Array.isArray(s)?t[i][r]=s.slice():t[i][r]=s}}return t}function gl(e){let t={};for(let i=0;i<e.length;i++){let r=lx(e[i]);for(let s in r)t[s]=r[s]}return t}function nye(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function nK(e){return e.getRenderTarget()===null&&e.outputEncoding===sn?jh:vD}var Ex={clone:lx,merge:gl},sye=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,oye=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Qn=class extends jS{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=sye,this.fragmentShader=oye,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=lx(e.uniforms),this.uniformsGroups=nye(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let r in this.uniforms){let s=this.uniforms[r].value;s&&s.isTexture?t.uniforms[r]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?t.uniforms[r]={type:"c",value:s.getHex()}:s&&s.isVector2?t.uniforms[r]={type:"v2",value:s.toArray()}:s&&s.isVector3?t.uniforms[r]={type:"v3",value:s.toArray()}:s&&s.isVector4?t.uniforms[r]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?t.uniforms[r]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?t.uniforms[r]={type:"m4",value:s.toArray()}:t.uniforms[r]={value:s}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},Hy=class extends ls{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new mi,this.projectionMatrix=new mi,this.projectionMatrixInverse=new mi}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},Ga=class extends Hy{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=yS*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(nS*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return yS*2*Math.atan(Math.tan(nS*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,s,n){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(nS*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r,n=this.view;if(this.view!==null&&this.view.enabled){let u=n.fullWidth,p=n.fullHeight;s+=n.offsetX*r/u,t-=n.offsetY*i/p,r*=n.width/u,i*=n.height/p}let c=this.filmOffset;c!==0&&(s+=e*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},p_=-90,f_=1,aye=class extends ls{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;let r=new Ga(p_,f_,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);let s=new Ga(p_,f_,e,t);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(-1,0,0),this.add(s);let n=new Ga(p_,f_,e,t);n.layers=this.layers,n.up.set(0,0,-1),n.lookAt(0,1,0),this.add(n);let c=new Ga(p_,f_,e,t);c.layers=this.layers,c.up.set(0,0,1),c.lookAt(0,-1,0),this.add(c);let u=new Ga(p_,f_,e,t);u.layers=this.layers,u.up.set(0,1,0),u.lookAt(0,0,1),this.add(u);let p=new Ga(p_,f_,e,t);p.layers=this.layers,p.up.set(0,1,0),p.lookAt(0,0,-1),this.add(p)}update(e,t){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[r,s,n,c,u,p]=this.children,f=e.getRenderTarget(),x=e.toneMapping,w=e.xr.enabled;e.toneMapping=Zh,e.xr.enabled=!1;let E=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,s),e.setRenderTarget(i,2),e.render(t,n),e.setRenderTarget(i,3),e.render(t,c),e.setRenderTarget(i,4),e.render(t,u),i.texture.generateMipmaps=E,e.setRenderTarget(i,5),e.render(t,p),e.setRenderTarget(f),e.toneMapping=x,e.xr.enabled=w,i.texture.needsPMREMUpdate=!0}},m4=class extends Zs{constructor(e,t,i,r,s,n,c,u,p,f){e=e!==void 0?e:[],t=t!==void 0?t:ky,super(e,t,i,r,s,n,c,u,p,f),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},lye=class extends Zn{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new m4(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:cn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new $u(5,5,5),s=new Qn({name:"CubemapFromEquirect",uniforms:lx(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:fa,blending:Co});s.uniforms.tEquirect.value=t;let n=new $s(r,s),c=t.minFilter;return t.minFilter===ax&&(t.minFilter=cn),new aye(1,10,this).update(e,n),t.minFilter=c,n.geometry.dispose(),n.material.dispose(),this}clear(e,t,i,r){let s=e.getRenderTarget();for(let n=0;n<6;n++)e.setRenderTarget(this,n),e.clear(t,i,r);e.setRenderTarget(s)}},DF=new se,cye=new se,uye=new Ao,zl=class{constructor(e=new se(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let r=DF.subVectors(i,t).cross(cye.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(DF),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(i).multiplyScalar(s).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||uye.getNormalMatrix(e),r=this.coplanarPoint(DF).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},m_=new jl,GC=new se,g4=class{constructor(e=new zl,t=new zl,i=new zl,r=new zl,s=new zl,n=new zl){this.planes=[e,t,i,r,s,n]}set(e,t,i,r,s,n){let c=this.planes;return c[0].copy(e),c[1].copy(t),c[2].copy(i),c[3].copy(r),c[4].copy(s),c[5].copy(n),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,r=i[0],s=i[1],n=i[2],c=i[3],u=i[4],p=i[5],f=i[6],x=i[7],w=i[8],E=i[9],A=i[10],I=i[11],P=i[12],O=i[13],k=i[14],U=i[15];return t[0].setComponents(c-r,x-u,I-w,U-P).normalize(),t[1].setComponents(c+r,x+u,I+w,U+P).normalize(),t[2].setComponents(c+s,x+p,I+E,U+O).normalize(),t[3].setComponents(c-s,x-p,I-E,U-O).normalize(),t[4].setComponents(c-n,x-f,I-A,U-k).normalize(),t[5].setComponents(c+n,x+f,I+A,U+k).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),m_.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(m_)}intersectsSprite(e){return m_.center.set(0,0,0),m_.radius=.7071067811865476,m_.applyMatrix4(e.matrixWorld),this.intersectsSphere(m_)}intersectsSphere(e){let t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let r=t[i];if(GC.x=r.normal.x>0?e.max.x:e.min.x,GC.y=r.normal.y>0?e.max.y:e.min.y,GC.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(GC)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function sK(){let e=null,t=!1,i=null,r=null;function s(n,c){i(n,c),r=e.requestAnimationFrame(s)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(s),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(n){i=n},setContext:function(n){e=n}}}function hye(e,t){let i=t.isWebGL2,r=new WeakMap;function s(f,x){let w=f.array,E=f.usage,A=e.createBuffer();e.bindBuffer(x,A),e.bufferData(x,w,E),f.onUploadCallback();let I;if(w instanceof Float32Array)I=5126;else if(w instanceof Uint16Array)if(f.isFloat16BufferAttribute)if(i)I=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else I=5123;else if(w instanceof Int16Array)I=5122;else if(w instanceof Uint32Array)I=5125;else if(w instanceof Int32Array)I=5124;else if(w instanceof Int8Array)I=5120;else if(w instanceof Uint8Array)I=5121;else if(w instanceof Uint8ClampedArray)I=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+w);return{buffer:A,type:I,bytesPerElement:w.BYTES_PER_ELEMENT,version:f.version}}function n(f,x,w){let E=x.array,A=x.updateRange;e.bindBuffer(w,f),A.count===-1?e.bufferSubData(w,0,E):(i?e.bufferSubData(w,A.offset*E.BYTES_PER_ELEMENT,E,A.offset,A.count):e.bufferSubData(w,A.offset*E.BYTES_PER_ELEMENT,E.subarray(A.offset,A.offset+A.count)),A.count=-1),x.onUploadCallback()}function c(f){return f.isInterleavedBufferAttribute&&(f=f.data),r.get(f)}function u(f){f.isInterleavedBufferAttribute&&(f=f.data);let x=r.get(f);x&&(e.deleteBuffer(x.buffer),r.delete(f))}function p(f,x){if(f.isGLBufferAttribute){let E=r.get(f);(!E||E.version<f.version)&&r.set(f,{buffer:f.buffer,type:f.type,bytesPerElement:f.elementSize,version:f.version});return}f.isInterleavedBufferAttribute&&(f=f.data);let w=r.get(f);w===void 0?r.set(f,s(f,x)):w.version<f.version&&(n(w.buffer,f,x),w.version=f.version)}return{get:c,remove:u,update:p}}var Ep=class extends fr{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};let s=e/2,n=t/2,c=Math.floor(i),u=Math.floor(r),p=c+1,f=u+1,x=e/c,w=t/u,E=[],A=[],I=[],P=[];for(let O=0;O<f;O++){let k=O*w-n;for(let U=0;U<p;U++){let j=U*x-s;A.push(j,-k,0),I.push(0,0,1),P.push(U/c),P.push(1-O/u)}}for(let O=0;O<u;O++)for(let k=0;k<c;k++){let U=k+p*O,j=k+p*(O+1),V=k+1+p*(O+1),$=k+1+p*O;E.push(U,j,$),E.push(j,V,$)}this.setIndex(E),this.setAttribute("position",new Vi(A,3)),this.setAttribute("normal",new Vi(I,3)),this.setAttribute("uv",new Vi(P,2))}static fromJSON(e){return new Ep(e.width,e.height,e.widthSegments,e.heightSegments)}},dye=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,pye=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,fye=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,mye=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,gye=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,yye=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,vye="vec3 transformed = vec3( position );",_ye=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,xye=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,bye=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,wye=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Sye=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Eye=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Mye=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Tye=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Aye=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Cye=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Dye=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Iye=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Pye=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Rye=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Oye=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Lye=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,zye=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Fye=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,kye=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Nye="gl_FragColor = linearToOutputTexel( gl_FragColor );",Bye=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Uye=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,jye=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Vye=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Gye=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Hye=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Wye=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,qye=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Yye=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Xye=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,$ye=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Zye=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Qye=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Kye=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Jye=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,eve=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,tve=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,ive=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,rve=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,nve=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,sve=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,ove=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,ave=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lve=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,cve=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,uve=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,hve=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,dve=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,pve=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,fve=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,mve=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,gve=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,yve=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,vve=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,_ve=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,xve=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,bve=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,wve=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,Sve=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,Eve=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,Mve=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,Tve=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Ave=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Cve=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Dve=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Ive=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,Pve=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,Rve=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,Ove=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,Lve=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,zve=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Fve=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,kve=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Nve=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Bve=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Uve=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,jve=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Vve=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Gve=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Hve=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Wve=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,qve=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Yve=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Xve=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,$ve=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Zve=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Qve=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Kve=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Jve=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,e0e=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,t0e=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,i0e=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,r0e=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,n0e=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,s0e=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,o0e=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,a0e=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,l0e=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,c0e=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,u0e=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,h0e=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,d0e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,p0e=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,f0e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,m0e=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,g0e=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,y0e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,v0e=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,_0e=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,x0e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,b0e=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,w0e=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,S0e=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,E0e=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,M0e=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,T0e=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,A0e=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,C0e=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,D0e=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,I0e=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,P0e=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,R0e=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,O0e=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,L0e=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,z0e=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,F0e=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,k0e=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,N0e=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,B0e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,U0e=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,j0e=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,V0e=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,G0e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,ln={alphamap_fragment:dye,alphamap_pars_fragment:pye,alphatest_fragment:fye,alphatest_pars_fragment:mye,aomap_fragment:gye,aomap_pars_fragment:yye,begin_vertex:vye,beginnormal_vertex:_ye,bsdfs:xye,iridescence_fragment:bye,bumpmap_pars_fragment:wye,clipping_planes_fragment:Sye,clipping_planes_pars_fragment:Eye,clipping_planes_pars_vertex:Mye,clipping_planes_vertex:Tye,color_fragment:Aye,color_pars_fragment:Cye,color_pars_vertex:Dye,color_vertex:Iye,common:Pye,cube_uv_reflection_fragment:Rye,defaultnormal_vertex:Oye,displacementmap_pars_vertex:Lye,displacementmap_vertex:zye,emissivemap_fragment:Fye,emissivemap_pars_fragment:kye,encodings_fragment:Nye,encodings_pars_fragment:Bye,envmap_fragment:Uye,envmap_common_pars_fragment:jye,envmap_pars_fragment:Vye,envmap_pars_vertex:Gye,envmap_physical_pars_fragment:tve,envmap_vertex:Hye,fog_vertex:Wye,fog_pars_vertex:qye,fog_fragment:Yye,fog_pars_fragment:Xye,gradientmap_pars_fragment:$ye,lightmap_fragment:Zye,lightmap_pars_fragment:Qye,lights_lambert_fragment:Kye,lights_lambert_pars_fragment:Jye,lights_pars_begin:eve,lights_toon_fragment:ive,lights_toon_pars_fragment:rve,lights_phong_fragment:nve,lights_phong_pars_fragment:sve,lights_physical_fragment:ove,lights_physical_pars_fragment:ave,lights_fragment_begin:lve,lights_fragment_maps:cve,lights_fragment_end:uve,logdepthbuf_fragment:hve,logdepthbuf_pars_fragment:dve,logdepthbuf_pars_vertex:pve,logdepthbuf_vertex:fve,map_fragment:mve,map_pars_fragment:gve,map_particle_fragment:yve,map_particle_pars_fragment:vve,metalnessmap_fragment:_ve,metalnessmap_pars_fragment:xve,morphcolor_vertex:bve,morphnormal_vertex:wve,morphtarget_pars_vertex:Sve,morphtarget_vertex:Eve,normal_fragment_begin:Mve,normal_fragment_maps:Tve,normal_pars_fragment:Ave,normal_pars_vertex:Cve,normal_vertex:Dve,normalmap_pars_fragment:Ive,clearcoat_normal_fragment_begin:Pve,clearcoat_normal_fragment_maps:Rve,clearcoat_pars_fragment:Ove,iridescence_pars_fragment:Lve,output_fragment:zve,packing:Fve,premultiplied_alpha_fragment:kve,project_vertex:Nve,dithering_fragment:Bve,dithering_pars_fragment:Uve,roughnessmap_fragment:jve,roughnessmap_pars_fragment:Vve,shadowmap_pars_fragment:Gve,shadowmap_pars_vertex:Hve,shadowmap_vertex:Wve,shadowmask_pars_fragment:qve,skinbase_vertex:Yve,skinning_pars_vertex:Xve,skinning_vertex:$ve,skinnormal_vertex:Zve,specularmap_fragment:Qve,specularmap_pars_fragment:Kve,tonemapping_fragment:Jve,tonemapping_pars_fragment:e0e,transmission_fragment:t0e,transmission_pars_fragment:i0e,uv_pars_fragment:r0e,uv_pars_vertex:n0e,uv_vertex:s0e,uv2_pars_fragment:o0e,uv2_pars_vertex:a0e,uv2_vertex:l0e,worldpos_vertex:c0e,background_vert:u0e,background_frag:h0e,backgroundCube_vert:d0e,backgroundCube_frag:p0e,cube_vert:f0e,cube_frag:m0e,depth_vert:g0e,depth_frag:y0e,distanceRGBA_vert:v0e,distanceRGBA_frag:_0e,equirect_vert:x0e,equirect_frag:b0e,linedashed_vert:w0e,linedashed_frag:S0e,meshbasic_vert:E0e,meshbasic_frag:M0e,meshlambert_vert:T0e,meshlambert_frag:A0e,meshmatcap_vert:C0e,meshmatcap_frag:D0e,meshnormal_vert:I0e,meshnormal_frag:P0e,meshphong_vert:R0e,meshphong_frag:O0e,meshphysical_vert:L0e,meshphysical_frag:z0e,meshtoon_vert:F0e,meshtoon_frag:k0e,points_vert:N0e,points_frag:B0e,shadow_vert:U0e,shadow_frag:j0e,sprite_vert:V0e,sprite_frag:G0e},Fi={common:{diffuse:{value:new Tr(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ao},uv2Transform:{value:new Ao},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new lt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Tr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Tr(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ao}},sprite:{diffuse:{value:new Tr(16777215)},opacity:{value:1},center:{value:new lt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ao}}},Gh={basic:{uniforms:gl([Fi.common,Fi.specularmap,Fi.envmap,Fi.aomap,Fi.lightmap,Fi.fog]),vertexShader:ln.meshbasic_vert,fragmentShader:ln.meshbasic_frag},lambert:{uniforms:gl([Fi.common,Fi.specularmap,Fi.envmap,Fi.aomap,Fi.lightmap,Fi.emissivemap,Fi.bumpmap,Fi.normalmap,Fi.displacementmap,Fi.fog,Fi.lights,{emissive:{value:new Tr(0)}}]),vertexShader:ln.meshlambert_vert,fragmentShader:ln.meshlambert_frag},phong:{uniforms:gl([Fi.common,Fi.specularmap,Fi.envmap,Fi.aomap,Fi.lightmap,Fi.emissivemap,Fi.bumpmap,Fi.normalmap,Fi.displacementmap,Fi.fog,Fi.lights,{emissive:{value:new Tr(0)},specular:{value:new Tr(1118481)},shininess:{value:30}}]),vertexShader:ln.meshphong_vert,fragmentShader:ln.meshphong_frag},standard:{uniforms:gl([Fi.common,Fi.envmap,Fi.aomap,Fi.lightmap,Fi.emissivemap,Fi.bumpmap,Fi.normalmap,Fi.displacementmap,Fi.roughnessmap,Fi.metalnessmap,Fi.fog,Fi.lights,{emissive:{value:new Tr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ln.meshphysical_vert,fragmentShader:ln.meshphysical_frag},toon:{uniforms:gl([Fi.common,Fi.aomap,Fi.lightmap,Fi.emissivemap,Fi.bumpmap,Fi.normalmap,Fi.displacementmap,Fi.gradientmap,Fi.fog,Fi.lights,{emissive:{value:new Tr(0)}}]),vertexShader:ln.meshtoon_vert,fragmentShader:ln.meshtoon_frag},matcap:{uniforms:gl([Fi.common,Fi.bumpmap,Fi.normalmap,Fi.displacementmap,Fi.fog,{matcap:{value:null}}]),vertexShader:ln.meshmatcap_vert,fragmentShader:ln.meshmatcap_frag},points:{uniforms:gl([Fi.points,Fi.fog]),vertexShader:ln.points_vert,fragmentShader:ln.points_frag},dashed:{uniforms:gl([Fi.common,Fi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ln.linedashed_vert,fragmentShader:ln.linedashed_frag},depth:{uniforms:gl([Fi.common,Fi.displacementmap]),vertexShader:ln.depth_vert,fragmentShader:ln.depth_frag},normal:{uniforms:gl([Fi.common,Fi.bumpmap,Fi.normalmap,Fi.displacementmap,{opacity:{value:1}}]),vertexShader:ln.meshnormal_vert,fragmentShader:ln.meshnormal_frag},sprite:{uniforms:gl([Fi.sprite,Fi.fog]),vertexShader:ln.sprite_vert,fragmentShader:ln.sprite_frag},background:{uniforms:{uvTransform:{value:new Ao},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ln.background_vert,fragmentShader:ln.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ln.backgroundCube_vert,fragmentShader:ln.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ln.cube_vert,fragmentShader:ln.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ln.equirect_vert,fragmentShader:ln.equirect_frag},distanceRGBA:{uniforms:gl([Fi.common,Fi.displacementmap,{referencePosition:{value:new se},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ln.distanceRGBA_vert,fragmentShader:ln.distanceRGBA_frag},shadow:{uniforms:gl([Fi.lights,Fi.fog,{color:{value:new Tr(0)},opacity:{value:1}}]),vertexShader:ln.shadow_vert,fragmentShader:ln.shadow_frag}};Gh.physical={uniforms:gl([Gh.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new lt(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Tr(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new lt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Tr(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Tr(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ln.meshphysical_vert,fragmentShader:ln.meshphysical_frag};var HC={r:0,b:0,g:0};function H0e(e,t,i,r,s,n,c){let u=new Tr(0),p=n===!0?0:1,f,x,w=null,E=0,A=null;function I(O,k){let U=!1,j=k.isScene===!0?k.background:null;j&&j.isTexture&&(j=(k.backgroundBlurriness>0?i:t).get(j));let V=e.xr,$=V.getSession&&V.getSession();$&&$.environmentBlendMode==="additive"&&(j=null),j===null?P(u,p):j&&j.isColor&&(P(j,1),U=!0),(e.autoClear||U)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),j&&(j.isCubeTexture||j.mapping===US)?(x===void 0&&(x=new $s(new $u(1,1,1),new Qn({name:"BackgroundCubeMaterial",uniforms:lx(Gh.backgroundCube.uniforms),vertexShader:Gh.backgroundCube.vertexShader,fragmentShader:Gh.backgroundCube.fragmentShader,side:fa,depthTest:!1,depthWrite:!1,fog:!1})),x.geometry.deleteAttribute("normal"),x.geometry.deleteAttribute("uv"),x.onBeforeRender=function(Y,J,X){this.matrixWorld.copyPosition(X.matrixWorld)},Object.defineProperty(x.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(x)),x.material.uniforms.envMap.value=j,x.material.uniforms.flipEnvMap.value=j.isCubeTexture&&j.isRenderTargetTexture===!1?-1:1,x.material.uniforms.backgroundBlurriness.value=k.backgroundBlurriness,x.material.uniforms.backgroundIntensity.value=k.backgroundIntensity,x.material.toneMapped=j.encoding!==sn,(w!==j||E!==j.version||A!==e.toneMapping)&&(x.material.needsUpdate=!0,w=j,E=j.version,A=e.toneMapping),x.layers.enableAll(),O.unshift(x,x.geometry,x.material,0,0,null)):j&&j.isTexture&&(f===void 0&&(f=new $s(new Ep(2,2),new Qn({name:"BackgroundMaterial",uniforms:lx(Gh.background.uniforms),vertexShader:Gh.background.vertexShader,fragmentShader:Gh.background.fragmentShader,side:Yu,depthTest:!1,depthWrite:!1,fog:!1})),f.geometry.deleteAttribute("normal"),Object.defineProperty(f.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(f)),f.material.uniforms.t2D.value=j,f.material.uniforms.backgroundIntensity.value=k.backgroundIntensity,f.material.toneMapped=j.encoding!==sn,j.matrixAutoUpdate===!0&&j.updateMatrix(),f.material.uniforms.uvTransform.value.copy(j.matrix),(w!==j||E!==j.version||A!==e.toneMapping)&&(f.material.needsUpdate=!0,w=j,E=j.version,A=e.toneMapping),f.layers.enableAll(),O.unshift(f,f.geometry,f.material,0,0,null))}function P(O,k){O.getRGB(HC,nK(e)),r.buffers.color.setClear(HC.r,HC.g,HC.b,k,c)}return{getClearColor:function(){return u},setClearColor:function(O,k=1){u.set(O),p=k,P(u,p)},getClearAlpha:function(){return p},setClearAlpha:function(O){p=O,P(u,p)},render:I}}function W0e(e,t,i,r){let s=e.getParameter(34921),n=r.isWebGL2?null:t.get("OES_vertex_array_object"),c=r.isWebGL2||n!==null,u={},p=O(null),f=p,x=!1;function w(fe,Ue,Fe,Pe,Ae){let et=!1;if(c){let $e=P(Pe,Fe,Ue);f!==$e&&(f=$e,A(f.object)),et=k(fe,Pe,Fe,Ae),et&&U(fe,Pe,Fe,Ae)}else{let $e=Ue.wireframe===!0;(f.geometry!==Pe.id||f.program!==Fe.id||f.wireframe!==$e)&&(f.geometry=Pe.id,f.program=Fe.id,f.wireframe=$e,et=!0)}Ae!==null&&i.update(Ae,34963),(et||x)&&(x=!1,X(fe,Ue,Fe,Pe),Ae!==null&&e.bindBuffer(34963,i.get(Ae).buffer))}function E(){return r.isWebGL2?e.createVertexArray():n.createVertexArrayOES()}function A(fe){return r.isWebGL2?e.bindVertexArray(fe):n.bindVertexArrayOES(fe)}function I(fe){return r.isWebGL2?e.deleteVertexArray(fe):n.deleteVertexArrayOES(fe)}function P(fe,Ue,Fe){let Pe=Fe.wireframe===!0,Ae=u[fe.id];Ae===void 0&&(Ae={},u[fe.id]=Ae);let et=Ae[Ue.id];et===void 0&&(et={},Ae[Ue.id]=et);let $e=et[Pe];return $e===void 0&&($e=O(E()),et[Pe]=$e),$e}function O(fe){let Ue=[],Fe=[],Pe=[];for(let Ae=0;Ae<s;Ae++)Ue[Ae]=0,Fe[Ae]=0,Pe[Ae]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Ue,enabledAttributes:Fe,attributeDivisors:Pe,object:fe,attributes:{},index:null}}function k(fe,Ue,Fe,Pe){let Ae=f.attributes,et=Ue.attributes,$e=0,rt=Fe.getAttributes();for(let Je in rt)if(rt[Je].location>=0){let bt=Ae[Je],ot=et[Je];if(ot===void 0&&(Je==="instanceMatrix"&&fe.instanceMatrix&&(ot=fe.instanceMatrix),Je==="instanceColor"&&fe.instanceColor&&(ot=fe.instanceColor)),bt===void 0||bt.attribute!==ot||ot&&bt.data!==ot.data)return!0;$e++}return f.attributesNum!==$e||f.index!==Pe}function U(fe,Ue,Fe,Pe){let Ae={},et=Ue.attributes,$e=0,rt=Fe.getAttributes();for(let Je in rt)if(rt[Je].location>=0){let bt=et[Je];bt===void 0&&(Je==="instanceMatrix"&&fe.instanceMatrix&&(bt=fe.instanceMatrix),Je==="instanceColor"&&fe.instanceColor&&(bt=fe.instanceColor));let ot={};ot.attribute=bt,bt&&bt.data&&(ot.data=bt.data),Ae[Je]=ot,$e++}f.attributes=Ae,f.attributesNum=$e,f.index=Pe}function j(){let fe=f.newAttributes;for(let Ue=0,Fe=fe.length;Ue<Fe;Ue++)fe[Ue]=0}function V(fe){$(fe,0)}function $(fe,Ue){let Fe=f.newAttributes,Pe=f.enabledAttributes,Ae=f.attributeDivisors;Fe[fe]=1,Pe[fe]===0&&(e.enableVertexAttribArray(fe),Pe[fe]=1),Ae[fe]!==Ue&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](fe,Ue),Ae[fe]=Ue)}function Y(){let fe=f.newAttributes,Ue=f.enabledAttributes;for(let Fe=0,Pe=Ue.length;Fe<Pe;Fe++)Ue[Fe]!==fe[Fe]&&(e.disableVertexAttribArray(Fe),Ue[Fe]=0)}function J(fe,Ue,Fe,Pe,Ae,et){r.isWebGL2===!0&&(Fe===5124||Fe===5125)?e.vertexAttribIPointer(fe,Ue,Fe,Ae,et):e.vertexAttribPointer(fe,Ue,Fe,Pe,Ae,et)}function X(fe,Ue,Fe,Pe){if(r.isWebGL2===!1&&(fe.isInstancedMesh||Pe.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;j();let Ae=Pe.attributes,et=Fe.getAttributes(),$e=Ue.defaultAttributeValues;for(let rt in et){let Je=et[rt];if(Je.location>=0){let bt=Ae[rt];if(bt===void 0&&(rt==="instanceMatrix"&&fe.instanceMatrix&&(bt=fe.instanceMatrix),rt==="instanceColor"&&fe.instanceColor&&(bt=fe.instanceColor)),bt!==void 0){let ot=bt.normalized,xt=bt.itemSize,Xe=i.get(bt);if(Xe===void 0)continue;let kt=Xe.buffer,yt=Xe.type,Nt=Xe.bytesPerElement;if(bt.isInterleavedBufferAttribute){let Mt=bt.data,li=Mt.stride,Qt=bt.offset;if(Mt.isInstancedInterleavedBuffer){for(let Wt=0;Wt<Je.locationSize;Wt++)$(Je.location+Wt,Mt.meshPerAttribute);fe.isInstancedMesh!==!0&&Pe._maxInstanceCount===void 0&&(Pe._maxInstanceCount=Mt.meshPerAttribute*Mt.count)}else for(let Wt=0;Wt<Je.locationSize;Wt++)V(Je.location+Wt);e.bindBuffer(34962,kt);for(let Wt=0;Wt<Je.locationSize;Wt++)J(Je.location+Wt,xt/Je.locationSize,yt,ot,li*Nt,(Qt+xt/Je.locationSize*Wt)*Nt)}else{if(bt.isInstancedBufferAttribute){for(let Mt=0;Mt<Je.locationSize;Mt++)$(Je.location+Mt,bt.meshPerAttribute);fe.isInstancedMesh!==!0&&Pe._maxInstanceCount===void 0&&(Pe._maxInstanceCount=bt.meshPerAttribute*bt.count)}else for(let Mt=0;Mt<Je.locationSize;Mt++)V(Je.location+Mt);e.bindBuffer(34962,kt);for(let Mt=0;Mt<Je.locationSize;Mt++)J(Je.location+Mt,xt/Je.locationSize,yt,ot,xt*Nt,xt/Je.locationSize*Mt*Nt)}}else if($e!==void 0){let ot=$e[rt];if(ot!==void 0)switch(ot.length){case 2:e.vertexAttrib2fv(Je.location,ot);break;case 3:e.vertexAttrib3fv(Je.location,ot);break;case 4:e.vertexAttrib4fv(Je.location,ot);break;default:e.vertexAttrib1fv(Je.location,ot)}}}}Y()}function ee(){ve();for(let fe in u){let Ue=u[fe];for(let Fe in Ue){let Pe=Ue[Fe];for(let Ae in Pe)I(Pe[Ae].object),delete Pe[Ae];delete Ue[Fe]}delete u[fe]}}function oe(fe){if(u[fe.id]===void 0)return;let Ue=u[fe.id];for(let Fe in Ue){let Pe=Ue[Fe];for(let Ae in Pe)I(Pe[Ae].object),delete Pe[Ae];delete Ue[Fe]}delete u[fe.id]}function le(fe){for(let Ue in u){let Fe=u[Ue];if(Fe[fe.id]===void 0)continue;let Pe=Fe[fe.id];for(let Ae in Pe)I(Pe[Ae].object),delete Pe[Ae];delete Fe[fe.id]}}function ve(){we(),x=!0,f!==p&&(f=p,A(f.object))}function we(){p.geometry=null,p.program=null,p.wireframe=!1}return{setup:w,reset:ve,resetDefaultState:we,dispose:ee,releaseStatesOfGeometry:oe,releaseStatesOfProgram:le,initAttributes:j,enableAttribute:V,disableUnusedAttributes:Y}}function q0e(e,t,i,r){let s=r.isWebGL2,n;function c(f){n=f}function u(f,x){e.drawArrays(n,f,x),i.update(x,n,1)}function p(f,x,w){if(w===0)return;let E,A;if(s)E=e,A="drawArraysInstanced";else if(E=t.get("ANGLE_instanced_arrays"),A="drawArraysInstancedANGLE",E===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}E[A](n,f,x,w),i.update(x,n,w)}this.setMode=c,this.render=u,this.renderInstances=p}function Y0e(e,t,i){let r;function s(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){let J=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(J.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function n(J){if(J==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";J="mediump"}return J==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let c=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,u=i.precision!==void 0?i.precision:"highp",p=n(u);p!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",p,"instead."),u=p);let f=c||t.has("WEBGL_draw_buffers"),x=i.logarithmicDepthBuffer===!0,w=e.getParameter(34930),E=e.getParameter(35660),A=e.getParameter(3379),I=e.getParameter(34076),P=e.getParameter(34921),O=e.getParameter(36347),k=e.getParameter(36348),U=e.getParameter(36349),j=E>0,V=c||t.has("OES_texture_float"),$=j&&V,Y=c?e.getParameter(36183):0;return{isWebGL2:c,drawBuffers:f,getMaxAnisotropy:s,getMaxPrecision:n,precision:u,logarithmicDepthBuffer:x,maxTextures:w,maxVertexTextures:E,maxTextureSize:A,maxCubemapSize:I,maxAttributes:P,maxVertexUniforms:O,maxVaryings:k,maxFragmentUniforms:U,vertexTextures:j,floatFragmentTextures:V,floatVertexTextures:$,maxSamples:Y}}function X0e(e){let t=this,i=null,r=0,s=!1,n=!1,c=new zl,u=new Ao,p={value:null,needsUpdate:!1};this.uniform=p,this.numPlanes=0,this.numIntersection=0,this.init=function(w,E){let A=w.length!==0||E||r!==0||s;return s=E,r=w.length,A},this.beginShadows=function(){n=!0,x(null)},this.endShadows=function(){n=!1},this.setGlobalState=function(w,E){i=x(w,E,0)},this.setState=function(w,E,A){let I=w.clippingPlanes,P=w.clipIntersection,O=w.clipShadows,k=e.get(w);if(!s||I===null||I.length===0||n&&!O)n?x(null):f();else{let U=n?0:r,j=U*4,V=k.clippingState||null;p.value=V,V=x(I,E,j,A);for(let $=0;$!==j;++$)V[$]=i[$];k.clippingState=V,this.numIntersection=P?this.numPlanes:0,this.numPlanes+=U}};function f(){p.value!==i&&(p.value=i,p.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function x(w,E,A,I){let P=w!==null?w.length:0,O=null;if(P!==0){if(O=p.value,I!==!0||O===null){let k=A+P*4,U=E.matrixWorldInverse;u.getNormalMatrix(U),(O===null||O.length<k)&&(O=new Float32Array(k));for(let j=0,V=A;j!==P;++j,V+=4)c.copy(w[j]).applyMatrix4(U,u),c.normal.toArray(O,V),O[V+3]=c.constant}p.value=O,p.needsUpdate=!0}return t.numPlanes=P,t.numIntersection=0,O}}function $0e(e){let t=new WeakMap;function i(c,u){return u===cN?c.mapping=ky:u===uN&&(c.mapping=Ny),c}function r(c){if(c&&c.isTexture&&c.isRenderTargetTexture===!1){let u=c.mapping;if(u===cN||u===uN)if(t.has(c)){let p=t.get(c).texture;return i(p,c.mapping)}else{let p=c.image;if(p&&p.height>0){let f=new lye(p.height/2);return f.fromEquirectangularTexture(e,c),t.set(c,f),c.addEventListener("dispose",s),i(f.texture,c.mapping)}else return null}}return c}function s(c){let u=c.target;u.removeEventListener("dispose",s);let p=t.get(u);p!==void 0&&(t.delete(u),p.dispose())}function n(){t=new WeakMap}return{get:r,dispose:n}}var vI=class extends Hy{constructor(e=-1,t=1,i=1,r=-1,s=.1,n=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=n,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,n){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,s=i-e,n=i+e,c=r+t,u=r-t;if(this.view!==null&&this.view.enabled){let p=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=p*this.view.offsetX,n=s+p*this.view.width,c-=f*this.view.offsetY,u=c-f*this.view.height}this.projectionMatrix.makeOrthographic(s,n,c,u,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},G_=4,b7=[.125,.215,.35,.446,.526,.582],my=20,IF=new vI,w7=new Tr,PF=null,hy=(1+Math.sqrt(5))/2,g_=1/hy,S7=[new se(1,1,1),new se(-1,1,1),new se(1,1,-1),new se(-1,1,-1),new se(0,hy,g_),new se(0,hy,-g_),new se(g_,0,hy),new se(-g_,0,hy),new se(hy,g_,0),new se(-hy,g_,0)],E7=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){PF=this._renderer.getRenderTarget(),this._setSize(256);let s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=A7(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=T7(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(PF),e.scissorTest=!1,WC(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ky||e.mapping===Ny?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),PF=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:cn,minFilter:cn,generateMipmaps:!1,type:wp,format:da,encoding:Xu,depthBuffer:!1},r=M7(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=M7(e,t,i);let{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Z0e(s)),this._blurMaterial=Q0e(s,e,t)}return r}_compileMaterial(e){let t=new $s(this._lodPlanes[0],e);this._renderer.compile(t,IF)}_sceneToCubeUV(e,t,i,r){let s=new Ga(90,1,t,i),n=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,p=u.autoClear,f=u.toneMapping;u.getClearColor(w7),u.toneMapping=Zh,u.autoClear=!1;let x=new Sp({name:"PMREM.Background",side:fa,depthWrite:!1,depthTest:!1}),w=new $s(new $u,x),E=!1,A=e.background;A?A.isColor&&(x.color.copy(A),e.background=null,E=!0):(x.color.copy(w7),E=!0);for(let I=0;I<6;I++){let P=I%3;P===0?(s.up.set(0,n[I],0),s.lookAt(c[I],0,0)):P===1?(s.up.set(0,0,n[I]),s.lookAt(0,c[I],0)):(s.up.set(0,n[I],0),s.lookAt(0,0,c[I]));let O=this._cubeSize;WC(r,P*O,I>2?O:0,O,O),u.setRenderTarget(r),E&&u.render(w,s),u.render(e,s)}w.geometry.dispose(),w.material.dispose(),u.toneMapping=f,u.autoClear=p,e.background=A}_textureToCubeUV(e,t){let i=this._renderer,r=e.mapping===ky||e.mapping===Ny;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=A7()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=T7());let s=r?this._cubemapMaterial:this._equirectMaterial,n=new $s(this._lodPlanes[0],s),c=s.uniforms;c.envMap.value=e;let u=this._cubeSize;WC(t,0,0,3*u,2*u),i.setRenderTarget(t),i.render(n,IF)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),n=S7[(r-1)%S7.length];this._blur(e,r-1,r,s,n)}t.autoClear=i}_blur(e,t,i,r,s){let n=this._pingPongRenderTarget;this._halfBlur(e,n,t,i,r,"latitudinal",s),this._halfBlur(n,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,n,c){let u=this._renderer,p=this._blurMaterial;n!=="latitudinal"&&n!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let f=3,x=new $s(this._lodPlanes[r],p),w=p.uniforms,E=this._sizeLods[i]-1,A=isFinite(s)?Math.PI/(2*E):2*Math.PI/(2*my-1),I=s/A,P=isFinite(s)?1+Math.floor(f*I):my;P>my&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${P} samples when the maximum is set to ${my}`);let O=[],k=0;for(let Y=0;Y<my;++Y){let J=Y/I,X=Math.exp(-J*J/2);O.push(X),Y===0?k+=X:Y<P&&(k+=2*X)}for(let Y=0;Y<O.length;Y++)O[Y]=O[Y]/k;w.envMap.value=e.texture,w.samples.value=P,w.weights.value=O,w.latitudinal.value=n==="latitudinal",c&&(w.poleAxis.value=c);let{_lodMax:U}=this;w.dTheta.value=A,w.mipInt.value=U-i;let j=this._sizeLods[r],V=3*j*(r>U-G_?r-U+G_:0),$=4*(this._cubeSize-j);WC(t,V,$,3*j,2*j),u.setRenderTarget(t),u.render(x,IF)}};function Z0e(e){let t=[],i=[],r=[],s=e,n=e-G_+1+b7.length;for(let c=0;c<n;c++){let u=Math.pow(2,s);i.push(u);let p=1/u;c>e-G_?p=b7[c-e+G_-1]:c===0&&(p=0),r.push(p);let f=1/(u-2),x=-f,w=1+f,E=[x,x,w,x,w,w,x,x,w,w,x,w],A=6,I=6,P=3,O=2,k=1,U=new Float32Array(P*I*A),j=new Float32Array(O*I*A),V=new Float32Array(k*I*A);for(let Y=0;Y<A;Y++){let J=Y%3*2/3-1,X=Y>2?0:-1,ee=[J,X,0,J+2/3,X,0,J+2/3,X+1,0,J,X,0,J+2/3,X+1,0,J,X+1,0];U.set(ee,P*I*Y),j.set(E,O*I*Y);let oe=[Y,Y,Y,Y,Y,Y];V.set(oe,k*I*Y)}let $=new fr;$.setAttribute("position",new Fr(U,P)),$.setAttribute("uv",new Fr(j,O)),$.setAttribute("faceIndex",new Fr(V,k)),t.push($),s>G_&&s--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function M7(e,t,i){let r=new Zn(e,t,i);return r.texture.mapping=US,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function WC(e,t,i,r,s){e.viewport.set(t,i,r,s),e.scissor.set(t,i,r,s)}function Q0e(e,t,i){let r=new Float32Array(my),s=new se(0,1,0);return new Qn({name:"SphericalGaussianBlur",defines:{n:my,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:y4(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Co,depthTest:!1,depthWrite:!1})}function T7(){return new Qn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:y4(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Co,depthTest:!1,depthWrite:!1})}function A7(){return new Qn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:y4(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Co,depthTest:!1,depthWrite:!1})}function y4(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function K0e(e){let t=new WeakMap,i=null;function r(u){if(u&&u.isTexture){let p=u.mapping,f=p===cN||p===uN,x=p===ky||p===Ny;if(f||x)if(u.isRenderTargetTexture&&u.needsPMREMUpdate===!0){u.needsPMREMUpdate=!1;let w=t.get(u);return i===null&&(i=new E7(e)),w=f?i.fromEquirectangular(u,w):i.fromCubemap(u,w),t.set(u,w),w.texture}else{if(t.has(u))return t.get(u).texture;{let w=u.image;if(f&&w&&w.height>0||x&&w&&s(w)){i===null&&(i=new E7(e));let E=f?i.fromEquirectangular(u):i.fromCubemap(u);return t.set(u,E),u.addEventListener("dispose",n),E.texture}else return null}}}return u}function s(u){let p=0,f=6;for(let x=0;x<f;x++)u[x]!==void 0&&p++;return p===f}function n(u){let p=u.target;p.removeEventListener("dispose",n);let f=t.get(p);f!==void 0&&(t.delete(p),f.dispose())}function c(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:c}}function J0e(e){let t={};function i(r){if(t[r]!==void 0)return t[r];let s;switch(r){case"WEBGL_depth_texture":s=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=e.getExtension(r)}return t[r]=s,s}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let s=i(r);return s===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),s}}}function e_e(e,t,i,r){let s={},n=new WeakMap;function c(w){let E=w.target;E.index!==null&&t.remove(E.index);for(let I in E.attributes)t.remove(E.attributes[I]);E.removeEventListener("dispose",c),delete s[E.id];let A=n.get(E);A&&(t.remove(A),n.delete(E)),r.releaseStatesOfGeometry(E),E.isInstancedBufferGeometry===!0&&delete E._maxInstanceCount,i.memory.geometries--}function u(w,E){return s[E.id]===!0||(E.addEventListener("dispose",c),s[E.id]=!0,i.memory.geometries++),E}function p(w){let E=w.attributes;for(let I in E)t.update(E[I],34962);let A=w.morphAttributes;for(let I in A){let P=A[I];for(let O=0,k=P.length;O<k;O++)t.update(P[O],34962)}}function f(w){let E=[],A=w.index,I=w.attributes.position,P=0;if(A!==null){let U=A.array;P=A.version;for(let j=0,V=U.length;j<V;j+=3){let $=U[j+0],Y=U[j+1],J=U[j+2];E.push($,Y,Y,J,J,$)}}else{let U=I.array;P=I.version;for(let j=0,V=U.length/3-1;j<V;j+=3){let $=j+0,Y=j+1,J=j+2;E.push($,Y,Y,J,J,$)}}let O=new(KQ(E)?X_:rK)(E,1);O.version=P;let k=n.get(w);k&&t.remove(k),n.set(w,O)}function x(w){let E=n.get(w);if(E){let A=w.index;A!==null&&E.version<A.version&&f(w)}else f(w);return n.get(w)}return{get:u,update:p,getWireframeAttribute:x}}function t_e(e,t,i,r){let s=r.isWebGL2,n;function c(E){n=E}let u,p;function f(E){u=E.type,p=E.bytesPerElement}function x(E,A){e.drawElements(n,A,u,E*p),i.update(A,n,1)}function w(E,A,I){if(I===0)return;let P,O;if(s)P=e,O="drawElementsInstanced";else if(P=t.get("ANGLE_instanced_arrays"),O="drawElementsInstancedANGLE",P===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}P[O](n,A,u,E*p,I),i.update(A,n,I)}this.setMode=c,this.setIndex=f,this.render=x,this.renderInstances=w}function i_e(e){let t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(n,c,u){switch(i.calls++,c){case 4:i.triangles+=u*(n/3);break;case 1:i.lines+=u*(n/2);break;case 3:i.lines+=u*(n-1);break;case 2:i.lines+=u*n;break;case 0:i.points+=u*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",c);break}}function s(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:s,update:r}}function r_e(e,t){return e[0]-t[0]}function n_e(e,t){return Math.abs(t[1])-Math.abs(e[1])}function s_e(e,t,i){let r={},s=new Float32Array(8),n=new WeakMap,c=new Gr,u=[];for(let f=0;f<8;f++)u[f]=[f,0];function p(f,x,w,E){let A=f.morphTargetInfluences;if(t.isWebGL2===!0){let I=x.morphAttributes.position||x.morphAttributes.normal||x.morphAttributes.color,P=I!==void 0?I.length:0,O=n.get(x);if(O===void 0||O.count!==P){let j=function(){fe.dispose(),n.delete(x),x.removeEventListener("dispose",j)};O!==void 0&&O.texture.dispose();let V=x.morphAttributes.position!==void 0,$=x.morphAttributes.normal!==void 0,Y=x.morphAttributes.color!==void 0,J=x.morphAttributes.position||[],X=x.morphAttributes.normal||[],ee=x.morphAttributes.color||[],oe=0;V===!0&&(oe=1),$===!0&&(oe=2),Y===!0&&(oe=3);let le=x.attributes.position.count*oe,ve=1;le>t.maxTextureSize&&(ve=Math.ceil(le/t.maxTextureSize),le=t.maxTextureSize);let we=new Float32Array(le*ve*4*P),fe=new iK(we,le,ve,P);fe.type=To,fe.needsUpdate=!0;let Ue=oe*4;for(let Fe=0;Fe<P;Fe++){let Pe=J[Fe],Ae=X[Fe],et=ee[Fe],$e=le*ve*4*Fe;for(let rt=0;rt<Pe.count;rt++){let Je=rt*Ue;V===!0&&(c.fromBufferAttribute(Pe,rt),we[$e+Je+0]=c.x,we[$e+Je+1]=c.y,we[$e+Je+2]=c.z,we[$e+Je+3]=0),$===!0&&(c.fromBufferAttribute(Ae,rt),we[$e+Je+4]=c.x,we[$e+Je+5]=c.y,we[$e+Je+6]=c.z,we[$e+Je+7]=0),Y===!0&&(c.fromBufferAttribute(et,rt),we[$e+Je+8]=c.x,we[$e+Je+9]=c.y,we[$e+Je+10]=c.z,we[$e+Je+11]=et.itemSize===4?c.w:1)}}O={count:P,texture:fe,size:new lt(le,ve)},n.set(x,O),x.addEventListener("dispose",j)}let k=0;for(let j=0;j<A.length;j++)k+=A[j];let U=x.morphTargetsRelative?1:1-k;E.getUniforms().setValue(e,"morphTargetBaseInfluence",U),E.getUniforms().setValue(e,"morphTargetInfluences",A),E.getUniforms().setValue(e,"morphTargetsTexture",O.texture,i),E.getUniforms().setValue(e,"morphTargetsTextureSize",O.size)}else{let I=A===void 0?0:A.length,P=r[x.id];if(P===void 0||P.length!==I){P=[];for(let V=0;V<I;V++)P[V]=[V,0];r[x.id]=P}for(let V=0;V<I;V++){let $=P[V];$[0]=V,$[1]=A[V]}P.sort(n_e);for(let V=0;V<8;V++)V<I&&P[V][1]?(u[V][0]=P[V][0],u[V][1]=P[V][1]):(u[V][0]=Number.MAX_SAFE_INTEGER,u[V][1]=0);u.sort(r_e);let O=x.morphAttributes.position,k=x.morphAttributes.normal,U=0;for(let V=0;V<8;V++){let $=u[V],Y=$[0],J=$[1];Y!==Number.MAX_SAFE_INTEGER&&J?(O&&x.getAttribute("morphTarget"+V)!==O[Y]&&x.setAttribute("morphTarget"+V,O[Y]),k&&x.getAttribute("morphNormal"+V)!==k[Y]&&x.setAttribute("morphNormal"+V,k[Y]),s[V]=J,U+=J):(O&&x.hasAttribute("morphTarget"+V)===!0&&x.deleteAttribute("morphTarget"+V),k&&x.hasAttribute("morphNormal"+V)===!0&&x.deleteAttribute("morphNormal"+V),s[V]=0)}let j=x.morphTargetsRelative?1:1-U;E.getUniforms().setValue(e,"morphTargetBaseInfluence",j),E.getUniforms().setValue(e,"morphTargetInfluences",s)}}return{update:p}}function o_e(e,t,i,r){let s=new WeakMap;function n(p){let f=r.render.frame,x=p.geometry,w=t.get(p,x);return s.get(w)!==f&&(t.update(w),s.set(w,f)),p.isInstancedMesh&&(p.hasEventListener("dispose",u)===!1&&p.addEventListener("dispose",u),i.update(p.instanceMatrix,34962),p.instanceColor!==null&&i.update(p.instanceColor,34962)),w}function c(){s=new WeakMap}function u(p){let f=p.target;f.removeEventListener("dispose",u),i.remove(f.instanceMatrix),f.instanceColor!==null&&i.remove(f.instanceColor)}return{update:n,dispose:c}}var oK=new Zs,aK=new iK,lK=new qge,cK=new m4,C7=[],D7=[],I7=new Float32Array(16),P7=new Float32Array(9),R7=new Float32Array(4);function Mx(e,t,i){let r=e[0];if(r<=0||r>0)return e;let s=t*i,n=C7[s];if(n===void 0&&(n=new Float32Array(s),C7[s]=n),t!==0){r.toArray(n,0);for(let c=1,u=0;c!==t;++c)u+=i,e[c].toArray(n,u)}return n}function Qo(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function Ko(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function _I(e,t){let i=D7[t];i===void 0&&(i=new Int32Array(t),D7[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function a_e(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function l_e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Qo(i,t))return;e.uniform2fv(this.addr,t),Ko(i,t)}}function c_e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Qo(i,t))return;e.uniform3fv(this.addr,t),Ko(i,t)}}function u_e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Qo(i,t))return;e.uniform4fv(this.addr,t),Ko(i,t)}}function h_e(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Qo(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Ko(i,t)}else{if(Qo(i,r))return;R7.set(r),e.uniformMatrix2fv(this.addr,!1,R7),Ko(i,r)}}function d_e(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Qo(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Ko(i,t)}else{if(Qo(i,r))return;P7.set(r),e.uniformMatrix3fv(this.addr,!1,P7),Ko(i,r)}}function p_e(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Qo(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Ko(i,t)}else{if(Qo(i,r))return;I7.set(r),e.uniformMatrix4fv(this.addr,!1,I7),Ko(i,r)}}function f_e(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function m_e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Qo(i,t))return;e.uniform2iv(this.addr,t),Ko(i,t)}}function g_e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Qo(i,t))return;e.uniform3iv(this.addr,t),Ko(i,t)}}function y_e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Qo(i,t))return;e.uniform4iv(this.addr,t),Ko(i,t)}}function v_e(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function __e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Qo(i,t))return;e.uniform2uiv(this.addr,t),Ko(i,t)}}function x_e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Qo(i,t))return;e.uniform3uiv(this.addr,t),Ko(i,t)}}function b_e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Qo(i,t))return;e.uniform4uiv(this.addr,t),Ko(i,t)}}function w_e(e,t,i){let r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(e.uniform1i(this.addr,s),r[0]=s),i.setTexture2D(t||oK,s)}function S_e(e,t,i){let r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(e.uniform1i(this.addr,s),r[0]=s),i.setTexture3D(t||lK,s)}function E_e(e,t,i){let r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(e.uniform1i(this.addr,s),r[0]=s),i.setTextureCube(t||cK,s)}function M_e(e,t,i){let r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(e.uniform1i(this.addr,s),r[0]=s),i.setTexture2DArray(t||aK,s)}function T_e(e){switch(e){case 5126:return a_e;case 35664:return l_e;case 35665:return c_e;case 35666:return u_e;case 35674:return h_e;case 35675:return d_e;case 35676:return p_e;case 5124:case 35670:return f_e;case 35667:case 35671:return m_e;case 35668:case 35672:return g_e;case 35669:case 35673:return y_e;case 5125:return v_e;case 36294:return __e;case 36295:return x_e;case 36296:return b_e;case 35678:case 36198:case 36298:case 36306:case 35682:return w_e;case 35679:case 36299:case 36307:return S_e;case 35680:case 36300:case 36308:case 36293:return E_e;case 36289:case 36303:case 36311:case 36292:return M_e}}function A_e(e,t){e.uniform1fv(this.addr,t)}function C_e(e,t){let i=Mx(t,this.size,2);e.uniform2fv(this.addr,i)}function D_e(e,t){let i=Mx(t,this.size,3);e.uniform3fv(this.addr,i)}function I_e(e,t){let i=Mx(t,this.size,4);e.uniform4fv(this.addr,i)}function P_e(e,t){let i=Mx(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function R_e(e,t){let i=Mx(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function O_e(e,t){let i=Mx(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function L_e(e,t){e.uniform1iv(this.addr,t)}function z_e(e,t){e.uniform2iv(this.addr,t)}function F_e(e,t){e.uniform3iv(this.addr,t)}function k_e(e,t){e.uniform4iv(this.addr,t)}function N_e(e,t){e.uniform1uiv(this.addr,t)}function B_e(e,t){e.uniform2uiv(this.addr,t)}function U_e(e,t){e.uniform3uiv(this.addr,t)}function j_e(e,t){e.uniform4uiv(this.addr,t)}function V_e(e,t,i){let r=this.cache,s=t.length,n=_I(i,s);Qo(r,n)||(e.uniform1iv(this.addr,n),Ko(r,n));for(let c=0;c!==s;++c)i.setTexture2D(t[c]||oK,n[c])}function G_e(e,t,i){let r=this.cache,s=t.length,n=_I(i,s);Qo(r,n)||(e.uniform1iv(this.addr,n),Ko(r,n));for(let c=0;c!==s;++c)i.setTexture3D(t[c]||lK,n[c])}function H_e(e,t,i){let r=this.cache,s=t.length,n=_I(i,s);Qo(r,n)||(e.uniform1iv(this.addr,n),Ko(r,n));for(let c=0;c!==s;++c)i.setTextureCube(t[c]||cK,n[c])}function W_e(e,t,i){let r=this.cache,s=t.length,n=_I(i,s);Qo(r,n)||(e.uniform1iv(this.addr,n),Ko(r,n));for(let c=0;c!==s;++c)i.setTexture2DArray(t[c]||aK,n[c])}function q_e(e){switch(e){case 5126:return A_e;case 35664:return C_e;case 35665:return D_e;case 35666:return I_e;case 35674:return P_e;case 35675:return R_e;case 35676:return O_e;case 5124:case 35670:return L_e;case 35667:case 35671:return z_e;case 35668:case 35672:return F_e;case 35669:case 35673:return k_e;case 5125:return N_e;case 36294:return B_e;case 36295:return U_e;case 36296:return j_e;case 35678:case 36198:case 36298:case 36306:case 35682:return V_e;case 35679:case 36299:case 36307:return G_e;case 35680:case 36300:case 36308:case 36293:return H_e;case 36289:case 36303:case 36311:case 36292:return W_e}}var Y_e=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=T_e(t.type)}},X_e=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=q_e(t.type)}},$_e=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){let r=this.seq;for(let s=0,n=r.length;s!==n;++s){let c=r[s];c.setValue(e,t[c.id],i)}}},RF=/(\w+)(\])?(\[|\.)?/g;function O7(e,t){e.seq.push(t),e.map[t.id]=t}function Z_e(e,t,i){let r=e.name,s=r.length;for(RF.lastIndex=0;;){let n=RF.exec(r),c=RF.lastIndex,u=n[1],p=n[2]==="]",f=n[3];if(p&&(u=u|0),f===void 0||f==="["&&c+2===s){O7(i,f===void 0?new Y_e(u,e,t):new X_e(u,e,t));break}else{let x=i.map[u];x===void 0&&(x=new $_e(u),O7(i,x)),i=x}}}var Q2=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){let s=e.getActiveUniform(t,r),n=e.getUniformLocation(t,s.name);Z_e(s,n,this)}}setValue(e,t,i,r){let s=this.map[t];s!==void 0&&s.setValue(e,i,r)}setOptional(e,t,i){let r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,n=t.length;s!==n;++s){let c=t[s],u=i[c.id];u.needsUpdate!==!1&&c.setValue(e,u.value,r)}}static seqWithValue(e,t){let i=[];for(let r=0,s=e.length;r!==s;++r){let n=e[r];n.id in t&&i.push(n)}return i}};function L7(e,t,i){let r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}var Q_e=0;function K_e(e,t){let i=e.split(`
`),r=[],s=Math.max(t-6,0),n=Math.min(t+6,i.length);for(let c=s;c<n;c++){let u=c+1;r.push(`${u===t?">":" "} ${u}: ${i[c]}`)}return r.join(`
`)}function J_e(e){switch(e){case Xu:return["Linear","( value )"];case sn:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function z7(e,t,i){let r=e.getShaderParameter(t,35713),s=e.getShaderInfoLog(t).trim();if(r&&s==="")return"";let n=/ERROR: 0:(\d+)/.exec(s);if(n){let c=parseInt(n[1]);return i.toUpperCase()+`

`+s+`

`+K_e(e.getShaderSource(t),c)}else return s}function exe(e,t){let i=J_e(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function txe(e,t){let i;switch(t){case age:i="Linear";break;case lge:i="Reinhard";break;case cge:i="OptimizedCineon";break;case uge:i="ACESFilmic";break;case hge:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function ixe(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Zw).join(`
`)}function rxe(e){let t=[];for(let i in e){let r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function nxe(e,t){let i={},r=e.getProgramParameter(t,35721);for(let s=0;s<r;s++){let n=e.getActiveAttrib(t,s),c=n.name,u=1;n.type===35674&&(u=2),n.type===35675&&(u=3),n.type===35676&&(u=4),i[c]={type:n.type,location:e.getAttribLocation(t,c),locationSize:u}}return i}function Zw(e){return e!==""}function F7(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function k7(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var sxe=/^[ \t]*#include +<([\w\d./]+)>/gm;function mN(e){return e.replace(sxe,oxe)}function oxe(e,t){let i=ln[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return mN(i)}var axe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function N7(e){return e.replace(axe,lxe)}function lxe(e,t,i,r){let s="";for(let n=parseInt(t);n<parseInt(i);n++)s+=r.replace(/\[\s*i\s*\]/g,"[ "+n+" ]").replace(/UNROLLED_LOOP_INDEX/g,n);return s}function B7(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function cxe(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===u4?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===Bme?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===$w&&(t="SHADOWMAP_TYPE_VSM"),t}function uxe(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ky:case Ny:t="ENVMAP_TYPE_CUBE";break;case US:t="ENVMAP_TYPE_CUBE_UV";break}return t}function hxe(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case Ny:t="ENVMAP_MODE_REFRACTION";break}return t}function dxe(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case HQ:t="ENVMAP_BLENDING_MULTIPLY";break;case sge:t="ENVMAP_BLENDING_MIX";break;case oge:t="ENVMAP_BLENDING_ADD";break}return t}function pxe(e){let t=e.envMapCubeUVHeight;if(t===null)return null;let i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function fxe(e,t,i,r){let s=e.getContext(),n=i.defines,c=i.vertexShader,u=i.fragmentShader,p=cxe(i),f=uxe(i),x=hxe(i),w=dxe(i),E=pxe(i),A=i.isWebGL2?"":ixe(i),I=rxe(n),P=s.createProgram(),O,k,U=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(O=[I].filter(Zw).join(`
`),O.length>0&&(O+=`
`),k=[A,I].filter(Zw).join(`
`),k.length>0&&(k+=`
`)):(O=[B7(i),"#define SHADER_NAME "+i.shaderName,I,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+x:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+p:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Zw).join(`
`),k=[A,B7(i),"#define SHADER_NAME "+i.shaderName,I,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+f:"",i.envMap?"#define "+x:"",i.envMap?"#define "+w:"",E?"#define CUBEUV_TEXEL_WIDTH "+E.texelWidth:"",E?"#define CUBEUV_TEXEL_HEIGHT "+E.texelHeight:"",E?"#define CUBEUV_MAX_MIP "+E.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+p:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Zh?"#define TONE_MAPPING":"",i.toneMapping!==Zh?ln.tonemapping_pars_fragment:"",i.toneMapping!==Zh?txe("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",ln.encodings_pars_fragment,exe("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Zw).join(`
`)),c=mN(c),c=F7(c,i),c=k7(c,i),u=mN(u),u=F7(u,i),u=k7(u,i),c=N7(c),u=N7(u),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(U=`#version 300 es
`,O=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+O,k=["#define varying in",i.glslVersion===c7?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===c7?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+k);let j=U+O+c,V=U+k+u,$=L7(s,35633,j),Y=L7(s,35632,V);if(s.attachShader(P,$),s.attachShader(P,Y),i.index0AttributeName!==void 0?s.bindAttribLocation(P,0,i.index0AttributeName):i.morphTargets===!0&&s.bindAttribLocation(P,0,"position"),s.linkProgram(P),e.debug.checkShaderErrors){let ee=s.getProgramInfoLog(P).trim(),oe=s.getShaderInfoLog($).trim(),le=s.getShaderInfoLog(Y).trim(),ve=!0,we=!0;if(s.getProgramParameter(P,35714)===!1){ve=!1;let fe=z7(s,$,"vertex"),Ue=z7(s,Y,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(P,35715)+`

Program Info Log: `+ee+`
`+fe+`
`+Ue)}else ee!==""?console.warn("THREE.WebGLProgram: Program Info Log:",ee):(oe===""||le==="")&&(we=!1);we&&(this.diagnostics={runnable:ve,programLog:ee,vertexShader:{log:oe,prefix:O},fragmentShader:{log:le,prefix:k}})}s.deleteShader($),s.deleteShader(Y);let J;this.getUniforms=function(){return J===void 0&&(J=new Q2(s,P)),J};let X;return this.getAttributes=function(){return X===void 0&&(X=nxe(s,P)),X},this.destroy=function(){r.releaseStatesOfProgram(this),s.deleteProgram(P),this.program=void 0},this.name=i.shaderName,this.id=Q_e++,this.cacheKey=t,this.usedTimes=1,this.program=P,this.vertexShader=$,this.fragmentShader=Y,this}var mxe=0,gxe=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(i),n=this._getShaderCacheForMaterial(e);return n.has(r)===!1&&(n.add(r),r.usedTimes++),n.has(s)===!1&&(n.add(s),s.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return i===void 0&&(i=new yxe(e),t.set(e,i)),i}},yxe=class{constructor(e){this.id=mxe++,this.code=e,this.usedTimes=0}};function vxe(e,t,i,r,s,n,c){let u=new f4,p=new gxe,f=[],x=s.isWebGL2,w=s.logarithmicDepthBuffer,E=s.vertexTextures,A=s.precision,I={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function P(X,ee,oe,le,ve){let we=le.fog,fe=ve.geometry,Ue=X.isMeshStandardMaterial?le.environment:null,Fe=(X.isMeshStandardMaterial?i:t).get(X.envMap||Ue),Pe=Fe&&Fe.mapping===US?Fe.image.height:null,Ae=I[X.type];X.precision!==null&&(A=s.getMaxPrecision(X.precision),A!==X.precision&&console.warn("THREE.WebGLProgram.getParameters:",X.precision,"not supported, using",A,"instead."));let et=fe.morphAttributes.position||fe.morphAttributes.normal||fe.morphAttributes.color,$e=et!==void 0?et.length:0,rt=0;fe.morphAttributes.position!==void 0&&(rt=1),fe.morphAttributes.normal!==void 0&&(rt=2),fe.morphAttributes.color!==void 0&&(rt=3);let Je,bt,ot,xt;if(Ae){let Mt=Gh[Ae];Je=Mt.vertexShader,bt=Mt.fragmentShader}else Je=X.vertexShader,bt=X.fragmentShader,p.update(X),ot=p.getVertexShaderID(X),xt=p.getFragmentShaderID(X);let Xe=e.getRenderTarget(),kt=X.alphaTest>0,yt=X.clearcoat>0,Nt=X.iridescence>0;return{isWebGL2:x,shaderID:Ae,shaderName:X.type,vertexShader:Je,fragmentShader:bt,defines:X.defines,customVertexShaderID:ot,customFragmentShaderID:xt,isRawShaderMaterial:X.isRawShaderMaterial===!0,glslVersion:X.glslVersion,precision:A,instancing:ve.isInstancedMesh===!0,instancingColor:ve.isInstancedMesh===!0&&ve.instanceColor!==null,supportsVertexTextures:E,outputEncoding:Xe===null?e.outputEncoding:Xe.isXRRenderTarget===!0?Xe.texture.encoding:Xu,map:!!X.map,matcap:!!X.matcap,envMap:!!Fe,envMapMode:Fe&&Fe.mapping,envMapCubeUVHeight:Pe,lightMap:!!X.lightMap,aoMap:!!X.aoMap,emissiveMap:!!X.emissiveMap,bumpMap:!!X.bumpMap,normalMap:!!X.normalMap,objectSpaceNormalMap:X.normalMapType===Cge,tangentSpaceNormalMap:X.normalMapType===Age,decodeVideoTexture:!!X.map&&X.map.isVideoTexture===!0&&X.map.encoding===sn,clearcoat:yt,clearcoatMap:yt&&!!X.clearcoatMap,clearcoatRoughnessMap:yt&&!!X.clearcoatRoughnessMap,clearcoatNormalMap:yt&&!!X.clearcoatNormalMap,iridescence:Nt,iridescenceMap:Nt&&!!X.iridescenceMap,iridescenceThicknessMap:Nt&&!!X.iridescenceThicknessMap,displacementMap:!!X.displacementMap,roughnessMap:!!X.roughnessMap,metalnessMap:!!X.metalnessMap,specularMap:!!X.specularMap,specularIntensityMap:!!X.specularIntensityMap,specularColorMap:!!X.specularColorMap,opaque:X.transparent===!1&&X.blending===Iy,alphaMap:!!X.alphaMap,alphaTest:kt,gradientMap:!!X.gradientMap,sheen:X.sheen>0,sheenColorMap:!!X.sheenColorMap,sheenRoughnessMap:!!X.sheenRoughnessMap,transmission:X.transmission>0,transmissionMap:!!X.transmissionMap,thicknessMap:!!X.thicknessMap,combine:X.combine,vertexTangents:!!X.normalMap&&!!fe.attributes.tangent,vertexColors:X.vertexColors,vertexAlphas:X.vertexColors===!0&&!!fe.attributes.color&&fe.attributes.color.itemSize===4,vertexUvs:!!X.map||!!X.bumpMap||!!X.normalMap||!!X.specularMap||!!X.alphaMap||!!X.emissiveMap||!!X.roughnessMap||!!X.metalnessMap||!!X.clearcoatMap||!!X.clearcoatRoughnessMap||!!X.clearcoatNormalMap||!!X.iridescenceMap||!!X.iridescenceThicknessMap||!!X.displacementMap||!!X.transmissionMap||!!X.thicknessMap||!!X.specularIntensityMap||!!X.specularColorMap||!!X.sheenColorMap||!!X.sheenRoughnessMap,uvsVertexOnly:!(X.map||X.bumpMap||X.normalMap||X.specularMap||X.alphaMap||X.emissiveMap||X.roughnessMap||X.metalnessMap||X.clearcoatNormalMap||X.iridescenceMap||X.iridescenceThicknessMap||X.transmission>0||X.transmissionMap||X.thicknessMap||X.specularIntensityMap||X.specularColorMap||X.sheen>0||X.sheenColorMap||X.sheenRoughnessMap)&&!!X.displacementMap,fog:!!we,useFog:X.fog===!0,fogExp2:we&&we.isFogExp2,flatShading:!!X.flatShading,sizeAttenuation:X.sizeAttenuation,logarithmicDepthBuffer:w,skinning:ve.isSkinnedMesh===!0,morphTargets:fe.morphAttributes.position!==void 0,morphNormals:fe.morphAttributes.normal!==void 0,morphColors:fe.morphAttributes.color!==void 0,morphTargetsCount:$e,morphTextureStride:rt,numDirLights:ee.directional.length,numPointLights:ee.point.length,numSpotLights:ee.spot.length,numSpotLightMaps:ee.spotLightMap.length,numRectAreaLights:ee.rectArea.length,numHemiLights:ee.hemi.length,numDirLightShadows:ee.directionalShadowMap.length,numPointLightShadows:ee.pointShadowMap.length,numSpotLightShadows:ee.spotShadowMap.length,numSpotLightShadowsWithMaps:ee.numSpotLightShadowsWithMaps,numClippingPlanes:c.numPlanes,numClipIntersection:c.numIntersection,dithering:X.dithering,shadowMapEnabled:e.shadowMap.enabled&&oe.length>0,shadowMapType:e.shadowMap.type,toneMapping:X.toneMapped?e.toneMapping:Zh,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:X.premultipliedAlpha,doubleSided:X.side===Wa,flipSided:X.side===fa,useDepthPacking:!!X.depthPacking,depthPacking:X.depthPacking||0,index0AttributeName:X.index0AttributeName,extensionDerivatives:X.extensions&&X.extensions.derivatives,extensionFragDepth:X.extensions&&X.extensions.fragDepth,extensionDrawBuffers:X.extensions&&X.extensions.drawBuffers,extensionShaderTextureLOD:X.extensions&&X.extensions.shaderTextureLOD,rendererExtensionFragDepth:x||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:x||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:x||r.has("EXT_shader_texture_lod"),customProgramCacheKey:X.customProgramCacheKey()}}function O(X){let ee=[];if(X.shaderID?ee.push(X.shaderID):(ee.push(X.customVertexShaderID),ee.push(X.customFragmentShaderID)),X.defines!==void 0)for(let oe in X.defines)ee.push(oe),ee.push(X.defines[oe]);return X.isRawShaderMaterial===!1&&(k(ee,X),U(ee,X),ee.push(e.outputEncoding)),ee.push(X.customProgramCacheKey),ee.join()}function k(X,ee){X.push(ee.precision),X.push(ee.outputEncoding),X.push(ee.envMapMode),X.push(ee.envMapCubeUVHeight),X.push(ee.combine),X.push(ee.vertexUvs),X.push(ee.fogExp2),X.push(ee.sizeAttenuation),X.push(ee.morphTargetsCount),X.push(ee.morphAttributeCount),X.push(ee.numDirLights),X.push(ee.numPointLights),X.push(ee.numSpotLights),X.push(ee.numSpotLightMaps),X.push(ee.numHemiLights),X.push(ee.numRectAreaLights),X.push(ee.numDirLightShadows),X.push(ee.numPointLightShadows),X.push(ee.numSpotLightShadows),X.push(ee.numSpotLightShadowsWithMaps),X.push(ee.shadowMapType),X.push(ee.toneMapping),X.push(ee.numClippingPlanes),X.push(ee.numClipIntersection),X.push(ee.depthPacking)}function U(X,ee){u.disableAll(),ee.isWebGL2&&u.enable(0),ee.supportsVertexTextures&&u.enable(1),ee.instancing&&u.enable(2),ee.instancingColor&&u.enable(3),ee.map&&u.enable(4),ee.matcap&&u.enable(5),ee.envMap&&u.enable(6),ee.lightMap&&u.enable(7),ee.aoMap&&u.enable(8),ee.emissiveMap&&u.enable(9),ee.bumpMap&&u.enable(10),ee.normalMap&&u.enable(11),ee.objectSpaceNormalMap&&u.enable(12),ee.tangentSpaceNormalMap&&u.enable(13),ee.clearcoat&&u.enable(14),ee.clearcoatMap&&u.enable(15),ee.clearcoatRoughnessMap&&u.enable(16),ee.clearcoatNormalMap&&u.enable(17),ee.iridescence&&u.enable(18),ee.iridescenceMap&&u.enable(19),ee.iridescenceThicknessMap&&u.enable(20),ee.displacementMap&&u.enable(21),ee.specularMap&&u.enable(22),ee.roughnessMap&&u.enable(23),ee.metalnessMap&&u.enable(24),ee.gradientMap&&u.enable(25),ee.alphaMap&&u.enable(26),ee.alphaTest&&u.enable(27),ee.vertexColors&&u.enable(28),ee.vertexAlphas&&u.enable(29),ee.vertexUvs&&u.enable(30),ee.vertexTangents&&u.enable(31),ee.uvsVertexOnly&&u.enable(32),X.push(u.mask),u.disableAll(),ee.fog&&u.enable(0),ee.useFog&&u.enable(1),ee.flatShading&&u.enable(2),ee.logarithmicDepthBuffer&&u.enable(3),ee.skinning&&u.enable(4),ee.morphTargets&&u.enable(5),ee.morphNormals&&u.enable(6),ee.morphColors&&u.enable(7),ee.premultipliedAlpha&&u.enable(8),ee.shadowMapEnabled&&u.enable(9),ee.physicallyCorrectLights&&u.enable(10),ee.doubleSided&&u.enable(11),ee.flipSided&&u.enable(12),ee.useDepthPacking&&u.enable(13),ee.dithering&&u.enable(14),ee.specularIntensityMap&&u.enable(15),ee.specularColorMap&&u.enable(16),ee.transmission&&u.enable(17),ee.transmissionMap&&u.enable(18),ee.thicknessMap&&u.enable(19),ee.sheen&&u.enable(20),ee.sheenColorMap&&u.enable(21),ee.sheenRoughnessMap&&u.enable(22),ee.decodeVideoTexture&&u.enable(23),ee.opaque&&u.enable(24),X.push(u.mask)}function j(X){let ee=I[X.type],oe;if(ee){let le=Gh[ee];oe=Ex.clone(le.uniforms)}else oe=X.uniforms;return oe}function V(X,ee){let oe;for(let le=0,ve=f.length;le<ve;le++){let we=f[le];if(we.cacheKey===ee){oe=we,++oe.usedTimes;break}}return oe===void 0&&(oe=new fxe(e,ee,X,n),f.push(oe)),oe}function $(X){if(--X.usedTimes===0){let ee=f.indexOf(X);f[ee]=f[f.length-1],f.pop(),X.destroy()}}function Y(X){p.remove(X)}function J(){p.dispose()}return{getParameters:P,getProgramCacheKey:O,getUniforms:j,acquireProgram:V,releaseProgram:$,releaseShaderCache:Y,programs:f,dispose:J}}function _xe(){let e=new WeakMap;function t(n){let c=e.get(n);return c===void 0&&(c={},e.set(n,c)),c}function i(n){e.delete(n)}function r(n,c,u){e.get(n)[c]=u}function s(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:s}}function xxe(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function U7(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function j7(){let e=[],t=0,i=[],r=[],s=[];function n(){t=0,i.length=0,r.length=0,s.length=0}function c(w,E,A,I,P,O){let k=e[t];return k===void 0?(k={id:w.id,object:w,geometry:E,material:A,groupOrder:I,renderOrder:w.renderOrder,z:P,group:O},e[t]=k):(k.id=w.id,k.object=w,k.geometry=E,k.material=A,k.groupOrder=I,k.renderOrder=w.renderOrder,k.z=P,k.group=O),t++,k}function u(w,E,A,I,P,O){let k=c(w,E,A,I,P,O);A.transmission>0?r.push(k):A.transparent===!0?s.push(k):i.push(k)}function p(w,E,A,I,P,O){let k=c(w,E,A,I,P,O);A.transmission>0?r.unshift(k):A.transparent===!0?s.unshift(k):i.unshift(k)}function f(w,E){i.length>1&&i.sort(w||xxe),r.length>1&&r.sort(E||U7),s.length>1&&s.sort(E||U7)}function x(){for(let w=t,E=e.length;w<E;w++){let A=e[w];if(A.id===null)break;A.id=null,A.object=null,A.geometry=null,A.material=null,A.group=null}}return{opaque:i,transmissive:r,transparent:s,init:n,push:u,unshift:p,finish:x,sort:f}}function bxe(){let e=new WeakMap;function t(r,s){let n=e.get(r),c;return n===void 0?(c=new j7,e.set(r,[c])):s>=n.length?(c=new j7,n.push(c)):c=n[s],c}function i(){e=new WeakMap}return{get:t,dispose:i}}function wxe(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new se,color:new Tr};break;case"SpotLight":i={position:new se,direction:new se,color:new Tr,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new se,color:new Tr,distance:0,decay:0};break;case"HemisphereLight":i={direction:new se,skyColor:new Tr,groundColor:new Tr};break;case"RectAreaLight":i={color:new Tr,position:new se,halfWidth:new se,halfHeight:new se};break}return e[t.id]=i,i}}}function Sxe(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new lt};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new lt};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new lt,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}var Exe=0;function Mxe(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Txe(e,t){let i=new wxe,r=Sxe(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let x=0;x<9;x++)s.probe.push(new se);let n=new se,c=new mi,u=new mi;function p(x,w){let E=0,A=0,I=0;for(let le=0;le<9;le++)s.probe[le].set(0,0,0);let P=0,O=0,k=0,U=0,j=0,V=0,$=0,Y=0,J=0,X=0;x.sort(Mxe);let ee=w!==!0?Math.PI:1;for(let le=0,ve=x.length;le<ve;le++){let we=x[le],fe=we.color,Ue=we.intensity,Fe=we.distance,Pe=we.shadow&&we.shadow.map?we.shadow.map.texture:null;if(we.isAmbientLight)E+=fe.r*Ue*ee,A+=fe.g*Ue*ee,I+=fe.b*Ue*ee;else if(we.isLightProbe)for(let Ae=0;Ae<9;Ae++)s.probe[Ae].addScaledVector(we.sh.coefficients[Ae],Ue);else if(we.isDirectionalLight){let Ae=i.get(we);if(Ae.color.copy(we.color).multiplyScalar(we.intensity*ee),we.castShadow){let et=we.shadow,$e=r.get(we);$e.shadowBias=et.bias,$e.shadowNormalBias=et.normalBias,$e.shadowRadius=et.radius,$e.shadowMapSize=et.mapSize,s.directionalShadow[P]=$e,s.directionalShadowMap[P]=Pe,s.directionalShadowMatrix[P]=we.shadow.matrix,V++}s.directional[P]=Ae,P++}else if(we.isSpotLight){let Ae=i.get(we);Ae.position.setFromMatrixPosition(we.matrixWorld),Ae.color.copy(fe).multiplyScalar(Ue*ee),Ae.distance=Fe,Ae.coneCos=Math.cos(we.angle),Ae.penumbraCos=Math.cos(we.angle*(1-we.penumbra)),Ae.decay=we.decay,s.spot[k]=Ae;let et=we.shadow;if(we.map&&(s.spotLightMap[J]=we.map,J++,et.updateMatrices(we),we.castShadow&&X++),s.spotLightMatrix[k]=et.matrix,we.castShadow){let $e=r.get(we);$e.shadowBias=et.bias,$e.shadowNormalBias=et.normalBias,$e.shadowRadius=et.radius,$e.shadowMapSize=et.mapSize,s.spotShadow[k]=$e,s.spotShadowMap[k]=Pe,Y++}k++}else if(we.isRectAreaLight){let Ae=i.get(we);Ae.color.copy(fe).multiplyScalar(Ue),Ae.halfWidth.set(we.width*.5,0,0),Ae.halfHeight.set(0,we.height*.5,0),s.rectArea[U]=Ae,U++}else if(we.isPointLight){let Ae=i.get(we);if(Ae.color.copy(we.color).multiplyScalar(we.intensity*ee),Ae.distance=we.distance,Ae.decay=we.decay,we.castShadow){let et=we.shadow,$e=r.get(we);$e.shadowBias=et.bias,$e.shadowNormalBias=et.normalBias,$e.shadowRadius=et.radius,$e.shadowMapSize=et.mapSize,$e.shadowCameraNear=et.camera.near,$e.shadowCameraFar=et.camera.far,s.pointShadow[O]=$e,s.pointShadowMap[O]=Pe,s.pointShadowMatrix[O]=we.shadow.matrix,$++}s.point[O]=Ae,O++}else if(we.isHemisphereLight){let Ae=i.get(we);Ae.skyColor.copy(we.color).multiplyScalar(Ue*ee),Ae.groundColor.copy(we.groundColor).multiplyScalar(Ue*ee),s.hemi[j]=Ae,j++}}U>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=Fi.LTC_FLOAT_1,s.rectAreaLTC2=Fi.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=Fi.LTC_HALF_1,s.rectAreaLTC2=Fi.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=E,s.ambient[1]=A,s.ambient[2]=I;let oe=s.hash;(oe.directionalLength!==P||oe.pointLength!==O||oe.spotLength!==k||oe.rectAreaLength!==U||oe.hemiLength!==j||oe.numDirectionalShadows!==V||oe.numPointShadows!==$||oe.numSpotShadows!==Y||oe.numSpotMaps!==J)&&(s.directional.length=P,s.spot.length=k,s.rectArea.length=U,s.point.length=O,s.hemi.length=j,s.directionalShadow.length=V,s.directionalShadowMap.length=V,s.pointShadow.length=$,s.pointShadowMap.length=$,s.spotShadow.length=Y,s.spotShadowMap.length=Y,s.directionalShadowMatrix.length=V,s.pointShadowMatrix.length=$,s.spotLightMatrix.length=Y+J-X,s.spotLightMap.length=J,s.numSpotLightShadowsWithMaps=X,oe.directionalLength=P,oe.pointLength=O,oe.spotLength=k,oe.rectAreaLength=U,oe.hemiLength=j,oe.numDirectionalShadows=V,oe.numPointShadows=$,oe.numSpotShadows=Y,oe.numSpotMaps=J,s.version=Exe++)}function f(x,w){let E=0,A=0,I=0,P=0,O=0,k=w.matrixWorldInverse;for(let U=0,j=x.length;U<j;U++){let V=x[U];if(V.isDirectionalLight){let $=s.directional[E];$.direction.setFromMatrixPosition(V.matrixWorld),n.setFromMatrixPosition(V.target.matrixWorld),$.direction.sub(n),$.direction.transformDirection(k),E++}else if(V.isSpotLight){let $=s.spot[I];$.position.setFromMatrixPosition(V.matrixWorld),$.position.applyMatrix4(k),$.direction.setFromMatrixPosition(V.matrixWorld),n.setFromMatrixPosition(V.target.matrixWorld),$.direction.sub(n),$.direction.transformDirection(k),I++}else if(V.isRectAreaLight){let $=s.rectArea[P];$.position.setFromMatrixPosition(V.matrixWorld),$.position.applyMatrix4(k),u.identity(),c.copy(V.matrixWorld),c.premultiply(k),u.extractRotation(c),$.halfWidth.set(V.width*.5,0,0),$.halfHeight.set(0,V.height*.5,0),$.halfWidth.applyMatrix4(u),$.halfHeight.applyMatrix4(u),P++}else if(V.isPointLight){let $=s.point[A];$.position.setFromMatrixPosition(V.matrixWorld),$.position.applyMatrix4(k),A++}else if(V.isHemisphereLight){let $=s.hemi[O];$.direction.setFromMatrixPosition(V.matrixWorld),$.direction.transformDirection(k),O++}}}return{setup:p,setupView:f,state:s}}function V7(e,t){let i=new Txe(e,t),r=[],s=[];function n(){r.length=0,s.length=0}function c(x){r.push(x)}function u(x){s.push(x)}function p(x){i.setup(r,x)}function f(x){i.setupView(r,x)}return{init:n,state:{lightsArray:r,shadowsArray:s,lights:i},setupLights:p,setupLightsView:f,pushLight:c,pushShadow:u}}function Axe(e,t){let i=new WeakMap;function r(n,c=0){let u=i.get(n),p;return u===void 0?(p=new V7(e,t),i.set(n,[p])):c>=u.length?(p=new V7(e,t),u.push(p)):p=u[c],p}function s(){i=new WeakMap}return{get:r,dispose:s}}var uK=class extends jS{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Ip,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},Cxe=class extends jS{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new se,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},Dxe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Ixe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Pxe(e,t,i){let r=new g4,s=new lt,n=new lt,c=new Gr,u=new uK({depthPacking:ZQ}),p=new Cxe,f={},x=i.maxTextureSize,w={[Yu]:fa,[fa]:Yu,[Wa]:Wa},E=new Qn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new lt},radius:{value:4}},vertexShader:Dxe,fragmentShader:Ixe}),A=E.clone();A.defines.HORIZONTAL_PASS=1;let I=new fr;I.setAttribute("position",new Fr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let P=new $s(I,E),O=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=u4,this.render=function(V,$,Y){if(O.enabled===!1||O.autoUpdate===!1&&O.needsUpdate===!1||V.length===0)return;let J=e.getRenderTarget(),X=e.getActiveCubeFace(),ee=e.getActiveMipmapLevel(),oe=e.state;oe.setBlending(Co),oe.buffers.color.setClear(1,1,1,1),oe.buffers.depth.setTest(!0),oe.setScissorTest(!1);for(let le=0,ve=V.length;le<ve;le++){let we=V[le],fe=we.shadow;if(fe===void 0){console.warn("THREE.WebGLShadowMap:",we,"has no shadow.");continue}if(fe.autoUpdate===!1&&fe.needsUpdate===!1)continue;s.copy(fe.mapSize);let Ue=fe.getFrameExtents();if(s.multiply(Ue),n.copy(fe.mapSize),(s.x>x||s.y>x)&&(s.x>x&&(n.x=Math.floor(x/Ue.x),s.x=n.x*Ue.x,fe.mapSize.x=n.x),s.y>x&&(n.y=Math.floor(x/Ue.y),s.y=n.y*Ue.y,fe.mapSize.y=n.y)),fe.map===null){let Pe=this.type!==$w?{minFilter:ns,magFilter:ns}:{};fe.map=new Zn(s.x,s.y,Pe),fe.map.texture.name=we.name+".shadowMap",fe.camera.updateProjectionMatrix()}e.setRenderTarget(fe.map),e.clear();let Fe=fe.getViewportCount();for(let Pe=0;Pe<Fe;Pe++){let Ae=fe.getViewport(Pe);c.set(n.x*Ae.x,n.y*Ae.y,n.x*Ae.z,n.y*Ae.w),oe.viewport(c),fe.updateMatrices(we,Pe),r=fe.getFrustum(),j($,Y,fe.camera,we,this.type)}fe.isPointLightShadow!==!0&&this.type===$w&&k(fe,Y),fe.needsUpdate=!1}O.needsUpdate=!1,e.setRenderTarget(J,X,ee)};function k(V,$){let Y=t.update(P);E.defines.VSM_SAMPLES!==V.blurSamples&&(E.defines.VSM_SAMPLES=V.blurSamples,A.defines.VSM_SAMPLES=V.blurSamples,E.needsUpdate=!0,A.needsUpdate=!0),V.mapPass===null&&(V.mapPass=new Zn(s.x,s.y)),E.uniforms.shadow_pass.value=V.map.texture,E.uniforms.resolution.value=V.mapSize,E.uniforms.radius.value=V.radius,e.setRenderTarget(V.mapPass),e.clear(),e.renderBufferDirect($,null,Y,E,P,null),A.uniforms.shadow_pass.value=V.mapPass.texture,A.uniforms.resolution.value=V.mapSize,A.uniforms.radius.value=V.radius,e.setRenderTarget(V.map),e.clear(),e.renderBufferDirect($,null,Y,A,P,null)}function U(V,$,Y,J,X,ee){let oe=null,le=Y.isPointLight===!0?V.customDistanceMaterial:V.customDepthMaterial;if(le!==void 0)oe=le;else if(oe=Y.isPointLight===!0?p:u,e.localClippingEnabled&&$.clipShadows===!0&&Array.isArray($.clippingPlanes)&&$.clippingPlanes.length!==0||$.displacementMap&&$.displacementScale!==0||$.alphaMap&&$.alphaTest>0||$.map&&$.alphaTest>0){let ve=oe.uuid,we=$.uuid,fe=f[ve];fe===void 0&&(fe={},f[ve]=fe);let Ue=fe[we];Ue===void 0&&(Ue=oe.clone(),fe[we]=Ue),oe=Ue}return oe.visible=$.visible,oe.wireframe=$.wireframe,ee===$w?oe.side=$.shadowSide!==null?$.shadowSide:$.side:oe.side=$.shadowSide!==null?$.shadowSide:w[$.side],oe.alphaMap=$.alphaMap,oe.alphaTest=$.alphaTest,oe.map=$.map,oe.clipShadows=$.clipShadows,oe.clippingPlanes=$.clippingPlanes,oe.clipIntersection=$.clipIntersection,oe.displacementMap=$.displacementMap,oe.displacementScale=$.displacementScale,oe.displacementBias=$.displacementBias,oe.wireframeLinewidth=$.wireframeLinewidth,oe.linewidth=$.linewidth,Y.isPointLight===!0&&oe.isMeshDistanceMaterial===!0&&(oe.referencePosition.setFromMatrixPosition(Y.matrixWorld),oe.nearDistance=J,oe.farDistance=X),oe}function j(V,$,Y,J,X){if(V.visible===!1)return;if(V.layers.test($.layers)&&(V.isMesh||V.isLine||V.isPoints)&&(V.castShadow||V.receiveShadow&&X===$w)&&(!V.frustumCulled||r.intersectsObject(V))){V.modelViewMatrix.multiplyMatrices(Y.matrixWorldInverse,V.matrixWorld);let oe=t.update(V),le=V.material;if(Array.isArray(le)){let ve=oe.groups;for(let we=0,fe=ve.length;we<fe;we++){let Ue=ve[we],Fe=le[Ue.materialIndex];if(Fe&&Fe.visible){let Pe=U(V,Fe,J,Y.near,Y.far,X);e.renderBufferDirect(Y,null,oe,Pe,V,Ue)}}}else if(le.visible){let ve=U(V,le,J,Y.near,Y.far,X);e.renderBufferDirect(Y,null,oe,ve,V,null)}}let ee=V.children;for(let oe=0,le=ee.length;oe<le;oe++)j(ee[oe],$,Y,J,X)}}function Rxe(e,t,i){let r=i.isWebGL2;function s(){let wt=!1,Yt=new Gr,yi=null,Ai=new Gr(0,0,0,0);return{setMask:function(ir){yi!==ir&&!wt&&(e.colorMask(ir,ir,ir,ir),yi=ir)},setLocked:function(ir){wt=ir},setClear:function(ir,dr,Rn,gs,ks){ks===!0&&(ir*=gs,dr*=gs,Rn*=gs),Yt.set(ir,dr,Rn,gs),Ai.equals(Yt)===!1&&(e.clearColor(ir,dr,Rn,gs),Ai.copy(Yt))},reset:function(){wt=!1,yi=null,Ai.set(-1,0,0,0)}}}function n(){let wt=!1,Yt=null,yi=null,Ai=null;return{setTest:function(ir){ir?kt(2929):yt(2929)},setMask:function(ir){Yt!==ir&&!wt&&(e.depthMask(ir),Yt=ir)},setFunc:function(ir){if(yi!==ir){switch(ir){case Kme:e.depthFunc(512);break;case Jme:e.depthFunc(519);break;case ege:e.depthFunc(513);break;case lN:e.depthFunc(515);break;case tge:e.depthFunc(514);break;case ige:e.depthFunc(518);break;case rge:e.depthFunc(516);break;case nge:e.depthFunc(517);break;default:e.depthFunc(515)}yi=ir}},setLocked:function(ir){wt=ir},setClear:function(ir){Ai!==ir&&(e.clearDepth(ir),Ai=ir)},reset:function(){wt=!1,Yt=null,yi=null,Ai=null}}}function c(){let wt=!1,Yt=null,yi=null,Ai=null,ir=null,dr=null,Rn=null,gs=null,ks=null;return{setTest:function(Xn){wt||(Xn?kt(2960):yt(2960))},setMask:function(Xn){Yt!==Xn&&!wt&&(e.stencilMask(Xn),Yt=Xn)},setFunc:function(Xn,ys,On){(yi!==Xn||Ai!==ys||ir!==On)&&(e.stencilFunc(Xn,ys,On),yi=Xn,Ai=ys,ir=On)},setOp:function(Xn,ys,On){(dr!==Xn||Rn!==ys||gs!==On)&&(e.stencilOp(Xn,ys,On),dr=Xn,Rn=ys,gs=On)},setLocked:function(Xn){wt=Xn},setClear:function(Xn){ks!==Xn&&(e.clearStencil(Xn),ks=Xn)},reset:function(){wt=!1,Yt=null,yi=null,Ai=null,ir=null,dr=null,Rn=null,gs=null,ks=null}}}let u=new s,p=new n,f=new c,x=new WeakMap,w=new WeakMap,E={},A={},I=new WeakMap,P=[],O=null,k=!1,U=null,j=null,V=null,$=null,Y=null,J=null,X=null,ee=!1,oe=null,le=null,ve=null,we=null,fe=null,Ue=e.getParameter(35661),Fe=!1,Pe=0,Ae=e.getParameter(7938);Ae.indexOf("WebGL")!==-1?(Pe=parseFloat(/^WebGL (\d)/.exec(Ae)[1]),Fe=Pe>=1):Ae.indexOf("OpenGL ES")!==-1&&(Pe=parseFloat(/^OpenGL ES (\d)/.exec(Ae)[1]),Fe=Pe>=2);let et=null,$e={},rt=e.getParameter(3088),Je=e.getParameter(2978),bt=new Gr().fromArray(rt),ot=new Gr().fromArray(Je);function xt(wt,Yt,yi){let Ai=new Uint8Array(4),ir=e.createTexture();e.bindTexture(wt,ir),e.texParameteri(wt,10241,9728),e.texParameteri(wt,10240,9728);for(let dr=0;dr<yi;dr++)e.texImage2D(Yt+dr,0,6408,1,1,0,6408,5121,Ai);return ir}let Xe={};Xe[3553]=xt(3553,3553,1),Xe[34067]=xt(34067,34069,6),u.setClear(0,0,0,1),p.setClear(1),f.setClear(0),kt(2929),p.setFunc(lN),Li(!1),$t(Oq),kt(2884),Di(Co);function kt(wt){E[wt]!==!0&&(e.enable(wt),E[wt]=!0)}function yt(wt){E[wt]!==!1&&(e.disable(wt),E[wt]=!1)}function Nt(wt,Yt){return A[wt]!==Yt?(e.bindFramebuffer(wt,Yt),A[wt]=Yt,r&&(wt===36009&&(A[36160]=Yt),wt===36160&&(A[36009]=Yt)),!0):!1}function Mt(wt,Yt){let yi=P,Ai=!1;if(wt)if(yi=I.get(Yt),yi===void 0&&(yi=[],I.set(Yt,yi)),wt.isWebGLMultipleRenderTargets){let ir=wt.texture;if(yi.length!==ir.length||yi[0]!==36064){for(let dr=0,Rn=ir.length;dr<Rn;dr++)yi[dr]=36064+dr;yi.length=ir.length,Ai=!0}}else yi[0]!==36064&&(yi[0]=36064,Ai=!0);else yi[0]!==1029&&(yi[0]=1029,Ai=!0);Ai&&(i.isWebGL2?e.drawBuffers(yi):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(yi))}function li(wt){return O!==wt?(e.useProgram(wt),O=wt,!0):!1}let Qt={[L_]:32774,[jme]:32778,[Vme]:32779};if(r)Qt[kq]=32775,Qt[Nq]=32776;else{let wt=t.get("EXT_blend_minmax");wt!==null&&(Qt[kq]=wt.MIN_EXT,Qt[Nq]=wt.MAX_EXT)}let Wt={[Gme]:0,[Hme]:1,[Wme]:768,[VQ]:770,[Qme]:776,[$me]:774,[Yme]:772,[qme]:769,[GQ]:771,[Zme]:775,[Xme]:773};function Di(wt,Yt,yi,Ai,ir,dr,Rn,gs){if(wt===Co){k===!0&&(yt(3042),k=!1);return}if(k===!1&&(kt(3042),k=!0),wt!==Ume){if(wt!==U||gs!==ee){if((j!==L_||Y!==L_)&&(e.blendEquation(32774),j=L_,Y=L_),gs)switch(wt){case Iy:e.blendFuncSeparate(1,771,1,771);break;case Lq:e.blendFunc(1,1);break;case zq:e.blendFuncSeparate(0,769,0,1);break;case Fq:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",wt);break}else switch(wt){case Iy:e.blendFuncSeparate(770,771,1,771);break;case Lq:e.blendFunc(770,1);break;case zq:e.blendFuncSeparate(0,769,0,1);break;case Fq:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",wt);break}V=null,$=null,J=null,X=null,U=wt,ee=gs}return}ir=ir||Yt,dr=dr||yi,Rn=Rn||Ai,(Yt!==j||ir!==Y)&&(e.blendEquationSeparate(Qt[Yt],Qt[ir]),j=Yt,Y=ir),(yi!==V||Ai!==$||dr!==J||Rn!==X)&&(e.blendFuncSeparate(Wt[yi],Wt[Ai],Wt[dr],Wt[Rn]),V=yi,$=Ai,J=dr,X=Rn),U=wt,ee=!1}function Ii(wt,Yt){wt.side===Wa?yt(2884):kt(2884);let yi=wt.side===fa;Yt&&(yi=!yi),Li(yi),wt.blending===Iy&&wt.transparent===!1?Di(Co):Di(wt.blending,wt.blendEquation,wt.blendSrc,wt.blendDst,wt.blendEquationAlpha,wt.blendSrcAlpha,wt.blendDstAlpha,wt.premultipliedAlpha),p.setFunc(wt.depthFunc),p.setTest(wt.depthTest),p.setMask(wt.depthWrite),u.setMask(wt.colorWrite);let Ai=wt.stencilWrite;f.setTest(Ai),Ai&&(f.setMask(wt.stencilWriteMask),f.setFunc(wt.stencilFunc,wt.stencilRef,wt.stencilFuncMask),f.setOp(wt.stencilFail,wt.stencilZFail,wt.stencilZPass)),wi(wt.polygonOffset,wt.polygonOffsetFactor,wt.polygonOffsetUnits),wt.alphaToCoverage===!0?kt(32926):yt(32926)}function Li(wt){oe!==wt&&(wt?e.frontFace(2304):e.frontFace(2305),oe=wt)}function $t(wt){wt!==kme?(kt(2884),wt!==le&&(wt===Oq?e.cullFace(1029):wt===Nme?e.cullFace(1028):e.cullFace(1032))):yt(2884),le=wt}function Ut(wt){wt!==ve&&(Fe&&e.lineWidth(wt),ve=wt)}function wi(wt,Yt,yi){wt?(kt(32823),(we!==Yt||fe!==yi)&&(e.polygonOffset(Yt,yi),we=Yt,fe=yi)):yt(32823)}function Hi(wt){wt?kt(3089):yt(3089)}function lr(wt){wt===void 0&&(wt=33984+Ue-1),et!==wt&&(e.activeTexture(wt),et=wt)}function Ke(wt,Yt,yi){yi===void 0&&(et===null?yi=33984+Ue-1:yi=et);let Ai=$e[yi];Ai===void 0&&(Ai={type:void 0,texture:void 0},$e[yi]=Ai),(Ai.type!==wt||Ai.texture!==Yt)&&(et!==yi&&(e.activeTexture(yi),et=yi),e.bindTexture(wt,Yt||Xe[wt]),Ai.type=wt,Ai.texture=Yt)}function Re(){let wt=$e[et];wt!==void 0&&wt.type!==void 0&&(e.bindTexture(wt.type,null),wt.type=void 0,wt.texture=void 0)}function Lt(){try{e.compressedTexImage2D.apply(e,arguments)}catch(wt){console.error("THREE.WebGLState:",wt)}}function pi(){try{e.compressedTexImage3D.apply(e,arguments)}catch(wt){console.error("THREE.WebGLState:",wt)}}function Ee(){try{e.texSubImage2D.apply(e,arguments)}catch(wt){console.error("THREE.WebGLState:",wt)}}function Zt(){try{e.texSubImage3D.apply(e,arguments)}catch(wt){console.error("THREE.WebGLState:",wt)}}function Xi(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(wt){console.error("THREE.WebGLState:",wt)}}function Pi(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(wt){console.error("THREE.WebGLState:",wt)}}function si(){try{e.texStorage2D.apply(e,arguments)}catch(wt){console.error("THREE.WebGLState:",wt)}}function vi(){try{e.texStorage3D.apply(e,arguments)}catch(wt){console.error("THREE.WebGLState:",wt)}}function ki(){try{e.texImage2D.apply(e,arguments)}catch(wt){console.error("THREE.WebGLState:",wt)}}function Jt(){try{e.texImage3D.apply(e,arguments)}catch(wt){console.error("THREE.WebGLState:",wt)}}function mr(wt){bt.equals(wt)===!1&&(e.scissor(wt.x,wt.y,wt.z,wt.w),bt.copy(wt))}function $i(wt){ot.equals(wt)===!1&&(e.viewport(wt.x,wt.y,wt.z,wt.w),ot.copy(wt))}function Hr(wt,Yt){let yi=w.get(Yt);yi===void 0&&(yi=new WeakMap,w.set(Yt,yi));let Ai=yi.get(wt);Ai===void 0&&(Ai=e.getUniformBlockIndex(Yt,wt.name),yi.set(wt,Ai))}function Sn(wt,Yt){let yi=w.get(Yt).get(wt);x.get(Yt)!==yi&&(e.uniformBlockBinding(Yt,yi,wt.__bindingPointIndex),x.set(Yt,yi))}function kr(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),r===!0&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),E={},et=null,$e={},A={},I=new WeakMap,P=[],O=null,k=!1,U=null,j=null,V=null,$=null,Y=null,J=null,X=null,ee=!1,oe=null,le=null,ve=null,we=null,fe=null,bt.set(0,0,e.canvas.width,e.canvas.height),ot.set(0,0,e.canvas.width,e.canvas.height),u.reset(),p.reset(),f.reset()}return{buffers:{color:u,depth:p,stencil:f},enable:kt,disable:yt,bindFramebuffer:Nt,drawBuffers:Mt,useProgram:li,setBlending:Di,setMaterial:Ii,setFlipSided:Li,setCullFace:$t,setLineWidth:Ut,setPolygonOffset:wi,setScissorTest:Hi,activeTexture:lr,bindTexture:Ke,unbindTexture:Re,compressedTexImage2D:Lt,compressedTexImage3D:pi,texImage2D:ki,texImage3D:Jt,updateUBOMapping:Hr,uniformBlockBinding:Sn,texStorage2D:si,texStorage3D:vi,texSubImage2D:Ee,texSubImage3D:Zt,compressedTexSubImage2D:Xi,compressedTexSubImage3D:Pi,scissor:mr,viewport:$i,reset:kr}}function Oxe(e,t,i,r,s,n,c){let u=s.isWebGL2,p=s.maxTextures,f=s.maxCubemapSize,x=s.maxTextureSize,w=s.maxSamples,E=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,A=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),I=new WeakMap,P,O=new WeakMap,k=!1;try{k=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function U(Ke,Re){return k?new OffscreenCanvas(Ke,Re):vS("canvas")}function j(Ke,Re,Lt,pi){let Ee=1;if((Ke.width>pi||Ke.height>pi)&&(Ee=pi/Math.max(Ke.width,Ke.height)),Ee<1||Re===!0)if(typeof HTMLImageElement<"u"&&Ke instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Ke instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Ke instanceof ImageBitmap){let Zt=Re?_D:Math.floor,Xi=Zt(Ee*Ke.width),Pi=Zt(Ee*Ke.height);P===void 0&&(P=U(Xi,Pi));let si=Lt?U(Xi,Pi):P;return si.width=Xi,si.height=Pi,si.getContext("2d").drawImage(Ke,0,0,Xi,Pi),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ke.width+"x"+Ke.height+") to ("+Xi+"x"+Pi+")."),si}else return"data"in Ke&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ke.width+"x"+Ke.height+")."),Ke;return Ke}function V(Ke){return fN(Ke.width)&&fN(Ke.height)}function $(Ke){return u?!1:Ke.wrapS!==js||Ke.wrapT!==js||Ke.minFilter!==ns&&Ke.minFilter!==cn}function Y(Ke,Re){return Ke.generateMipmaps&&Re&&Ke.minFilter!==ns&&Ke.minFilter!==cn}function J(Ke){e.generateMipmap(Ke)}function X(Ke,Re,Lt,pi,Ee=!1){if(u===!1)return Re;if(Ke!==null){if(e[Ke]!==void 0)return e[Ke];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Ke+"'")}let Zt=Re;return Re===6403&&(Lt===5126&&(Zt=33326),Lt===5131&&(Zt=33325),Lt===5121&&(Zt=33321)),Re===33319&&(Lt===5126&&(Zt=33328),Lt===5131&&(Zt=33327),Lt===5121&&(Zt=33323)),Re===6408&&(Lt===5126&&(Zt=34836),Lt===5131&&(Zt=34842),Lt===5121&&(Zt=pi===sn&&Ee===!1?35907:32856),Lt===32819&&(Zt=32854),Lt===32820&&(Zt=32855)),(Zt===33325||Zt===33326||Zt===33327||Zt===33328||Zt===34842||Zt===34836)&&t.get("EXT_color_buffer_float"),Zt}function ee(Ke,Re,Lt){return Y(Ke,Lt)===!0||Ke.isFramebufferTexture&&Ke.minFilter!==ns&&Ke.minFilter!==cn?Math.log2(Math.max(Re.width,Re.height))+1:Ke.mipmaps!==void 0&&Ke.mipmaps.length>0?Ke.mipmaps.length:Ke.isCompressedTexture&&Array.isArray(Ke.image)?Re.mipmaps.length:1}function oe(Ke){return Ke===ns||Ke===Bq||Ke===iF?9728:9729}function le(Ke){let Re=Ke.target;Re.removeEventListener("dispose",le),we(Re),Re.isVideoTexture&&I.delete(Re)}function ve(Ke){let Re=Ke.target;Re.removeEventListener("dispose",ve),Ue(Re)}function we(Ke){let Re=r.get(Ke);if(Re.__webglInit===void 0)return;let Lt=Ke.source,pi=O.get(Lt);if(pi){let Ee=pi[Re.__cacheKey];Ee.usedTimes--,Ee.usedTimes===0&&fe(Ke),Object.keys(pi).length===0&&O.delete(Lt)}r.remove(Ke)}function fe(Ke){let Re=r.get(Ke);e.deleteTexture(Re.__webglTexture);let Lt=Ke.source,pi=O.get(Lt);delete pi[Re.__cacheKey],c.memory.textures--}function Ue(Ke){let Re=Ke.texture,Lt=r.get(Ke),pi=r.get(Re);if(pi.__webglTexture!==void 0&&(e.deleteTexture(pi.__webglTexture),c.memory.textures--),Ke.depthTexture&&Ke.depthTexture.dispose(),Ke.isWebGLCubeRenderTarget)for(let Ee=0;Ee<6;Ee++)e.deleteFramebuffer(Lt.__webglFramebuffer[Ee]),Lt.__webglDepthbuffer&&e.deleteRenderbuffer(Lt.__webglDepthbuffer[Ee]);else{if(e.deleteFramebuffer(Lt.__webglFramebuffer),Lt.__webglDepthbuffer&&e.deleteRenderbuffer(Lt.__webglDepthbuffer),Lt.__webglMultisampledFramebuffer&&e.deleteFramebuffer(Lt.__webglMultisampledFramebuffer),Lt.__webglColorRenderbuffer)for(let Ee=0;Ee<Lt.__webglColorRenderbuffer.length;Ee++)Lt.__webglColorRenderbuffer[Ee]&&e.deleteRenderbuffer(Lt.__webglColorRenderbuffer[Ee]);Lt.__webglDepthRenderbuffer&&e.deleteRenderbuffer(Lt.__webglDepthRenderbuffer)}if(Ke.isWebGLMultipleRenderTargets)for(let Ee=0,Zt=Re.length;Ee<Zt;Ee++){let Xi=r.get(Re[Ee]);Xi.__webglTexture&&(e.deleteTexture(Xi.__webglTexture),c.memory.textures--),r.remove(Re[Ee])}r.remove(Re),r.remove(Ke)}let Fe=0;function Pe(){Fe=0}function Ae(){let Ke=Fe;return Ke>=p&&console.warn("THREE.WebGLTextures: Trying to use "+Ke+" texture units while this GPU supports only "+p),Fe+=1,Ke}function et(Ke){let Re=[];return Re.push(Ke.wrapS),Re.push(Ke.wrapT),Re.push(Ke.wrapR||0),Re.push(Ke.magFilter),Re.push(Ke.minFilter),Re.push(Ke.anisotropy),Re.push(Ke.internalFormat),Re.push(Ke.format),Re.push(Ke.type),Re.push(Ke.generateMipmaps),Re.push(Ke.premultiplyAlpha),Re.push(Ke.flipY),Re.push(Ke.unpackAlignment),Re.push(Ke.encoding),Re.join()}function $e(Ke,Re){let Lt=r.get(Ke);if(Ke.isVideoTexture&&Hi(Ke),Ke.isRenderTargetTexture===!1&&Ke.version>0&&Lt.__version!==Ke.version){let pi=Ke.image;if(pi===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(pi.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{yt(Lt,Ke,Re);return}}i.bindTexture(3553,Lt.__webglTexture,33984+Re)}function rt(Ke,Re){let Lt=r.get(Ke);if(Ke.version>0&&Lt.__version!==Ke.version){yt(Lt,Ke,Re);return}i.bindTexture(35866,Lt.__webglTexture,33984+Re)}function Je(Ke,Re){let Lt=r.get(Ke);if(Ke.version>0&&Lt.__version!==Ke.version){yt(Lt,Ke,Re);return}i.bindTexture(32879,Lt.__webglTexture,33984+Re)}function bt(Ke,Re){let Lt=r.get(Ke);if(Ke.version>0&&Lt.__version!==Ke.version){Nt(Lt,Ke,Re);return}i.bindTexture(34067,Lt.__webglTexture,33984+Re)}let ot={[pp]:10497,[js]:33071,[hN]:33648},xt={[ns]:9728,[Bq]:9984,[iF]:9986,[cn]:9729,[dge]:9985,[ax]:9987};function Xe(Ke,Re,Lt){if(Lt?(e.texParameteri(Ke,10242,ot[Re.wrapS]),e.texParameteri(Ke,10243,ot[Re.wrapT]),(Ke===32879||Ke===35866)&&e.texParameteri(Ke,32882,ot[Re.wrapR]),e.texParameteri(Ke,10240,xt[Re.magFilter]),e.texParameteri(Ke,10241,xt[Re.minFilter])):(e.texParameteri(Ke,10242,33071),e.texParameteri(Ke,10243,33071),(Ke===32879||Ke===35866)&&e.texParameteri(Ke,32882,33071),(Re.wrapS!==js||Re.wrapT!==js)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(Ke,10240,oe(Re.magFilter)),e.texParameteri(Ke,10241,oe(Re.minFilter)),Re.minFilter!==ns&&Re.minFilter!==cn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){let pi=t.get("EXT_texture_filter_anisotropic");if(Re.magFilter===ns||Re.minFilter!==iF&&Re.minFilter!==ax||Re.type===To&&t.has("OES_texture_float_linear")===!1||u===!1&&Re.type===wp&&t.has("OES_texture_half_float_linear")===!1)return;(Re.anisotropy>1||r.get(Re).__currentAnisotropy)&&(e.texParameterf(Ke,pi.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Re.anisotropy,s.getMaxAnisotropy())),r.get(Re).__currentAnisotropy=Re.anisotropy)}}function kt(Ke,Re){let Lt=!1;Ke.__webglInit===void 0&&(Ke.__webglInit=!0,Re.addEventListener("dispose",le));let pi=Re.source,Ee=O.get(pi);Ee===void 0&&(Ee={},O.set(pi,Ee));let Zt=et(Re);if(Zt!==Ke.__cacheKey){Ee[Zt]===void 0&&(Ee[Zt]={texture:e.createTexture(),usedTimes:0},c.memory.textures++,Lt=!0),Ee[Zt].usedTimes++;let Xi=Ee[Ke.__cacheKey];Xi!==void 0&&(Ee[Ke.__cacheKey].usedTimes--,Xi.usedTimes===0&&fe(Re)),Ke.__cacheKey=Zt,Ke.__webglTexture=Ee[Zt].texture}return Lt}function yt(Ke,Re,Lt){let pi=3553;(Re.isDataArrayTexture||Re.isCompressedArrayTexture)&&(pi=35866),Re.isData3DTexture&&(pi=32879);let Ee=kt(Ke,Re),Zt=Re.source;i.bindTexture(pi,Ke.__webglTexture,33984+Lt);let Xi=r.get(Zt);if(Zt.version!==Xi.__version||Ee===!0){i.activeTexture(33984+Lt),e.pixelStorei(37440,Re.flipY),e.pixelStorei(37441,Re.premultiplyAlpha),e.pixelStorei(3317,Re.unpackAlignment),e.pixelStorei(37443,0);let Pi=$(Re)&&V(Re.image)===!1,si=j(Re.image,Pi,!1,x);si=lr(Re,si);let vi=V(si)||u,ki=n.convert(Re.format,Re.encoding),Jt=n.convert(Re.type),mr=X(Re.internalFormat,ki,Jt,Re.encoding,Re.isVideoTexture);Xe(pi,Re,vi);let $i,Hr=Re.mipmaps,Sn=u&&Re.isVideoTexture!==!0,kr=Xi.__version===void 0||Ee===!0,wt=ee(Re,si,vi);if(Re.isDepthTexture)mr=6402,u?Re.type===To?mr=36012:Re.type===fp?mr=33190:Re.type===Py?mr=35056:mr=33189:Re.type===To&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Re.format===Ry&&mr===6402&&Re.type!==qQ&&Re.type!==fp&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Re.type=fp,Jt=n.convert(Re.type)),Re.format===By&&mr===6402&&(mr=34041,Re.type!==Py&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Re.type=Py,Jt=n.convert(Re.type))),kr&&(Sn?i.texStorage2D(3553,1,mr,si.width,si.height):i.texImage2D(3553,0,mr,si.width,si.height,0,ki,Jt,null));else if(Re.isDataTexture)if(Hr.length>0&&vi){Sn&&kr&&i.texStorage2D(3553,wt,mr,Hr[0].width,Hr[0].height);for(let Yt=0,yi=Hr.length;Yt<yi;Yt++)$i=Hr[Yt],Sn?i.texSubImage2D(3553,Yt,0,0,$i.width,$i.height,ki,Jt,$i.data):i.texImage2D(3553,Yt,mr,$i.width,$i.height,0,ki,Jt,$i.data);Re.generateMipmaps=!1}else Sn?(kr&&i.texStorage2D(3553,wt,mr,si.width,si.height),i.texSubImage2D(3553,0,0,0,si.width,si.height,ki,Jt,si.data)):i.texImage2D(3553,0,mr,si.width,si.height,0,ki,Jt,si.data);else if(Re.isCompressedTexture)if(Re.isCompressedArrayTexture){Sn&&kr&&i.texStorage3D(35866,wt,mr,Hr[0].width,Hr[0].height,si.depth);for(let Yt=0,yi=Hr.length;Yt<yi;Yt++)$i=Hr[Yt],Re.format!==da?ki!==null?Sn?i.compressedTexSubImage3D(35866,Yt,0,0,0,$i.width,$i.height,si.depth,ki,$i.data,0,0):i.compressedTexImage3D(35866,Yt,mr,$i.width,$i.height,si.depth,0,$i.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Sn?i.texSubImage3D(35866,Yt,0,0,0,$i.width,$i.height,si.depth,ki,Jt,$i.data):i.texImage3D(35866,Yt,mr,$i.width,$i.height,si.depth,0,ki,Jt,$i.data)}else{Sn&&kr&&i.texStorage2D(3553,wt,mr,Hr[0].width,Hr[0].height);for(let Yt=0,yi=Hr.length;Yt<yi;Yt++)$i=Hr[Yt],Re.format!==da?ki!==null?Sn?i.compressedTexSubImage2D(3553,Yt,0,0,$i.width,$i.height,ki,$i.data):i.compressedTexImage2D(3553,Yt,mr,$i.width,$i.height,0,$i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Sn?i.texSubImage2D(3553,Yt,0,0,$i.width,$i.height,ki,Jt,$i.data):i.texImage2D(3553,Yt,mr,$i.width,$i.height,0,ki,Jt,$i.data)}else if(Re.isDataArrayTexture)Sn?(kr&&i.texStorage3D(35866,wt,mr,si.width,si.height,si.depth),i.texSubImage3D(35866,0,0,0,0,si.width,si.height,si.depth,ki,Jt,si.data)):i.texImage3D(35866,0,mr,si.width,si.height,si.depth,0,ki,Jt,si.data);else if(Re.isData3DTexture)Sn?(kr&&i.texStorage3D(32879,wt,mr,si.width,si.height,si.depth),i.texSubImage3D(32879,0,0,0,0,si.width,si.height,si.depth,ki,Jt,si.data)):i.texImage3D(32879,0,mr,si.width,si.height,si.depth,0,ki,Jt,si.data);else if(Re.isFramebufferTexture){if(kr)if(Sn)i.texStorage2D(3553,wt,mr,si.width,si.height);else{let Yt=si.width,yi=si.height;for(let Ai=0;Ai<wt;Ai++)i.texImage2D(3553,Ai,mr,Yt,yi,0,ki,Jt,null),Yt>>=1,yi>>=1}}else if(Hr.length>0&&vi){Sn&&kr&&i.texStorage2D(3553,wt,mr,Hr[0].width,Hr[0].height);for(let Yt=0,yi=Hr.length;Yt<yi;Yt++)$i=Hr[Yt],Sn?i.texSubImage2D(3553,Yt,0,0,ki,Jt,$i):i.texImage2D(3553,Yt,mr,ki,Jt,$i);Re.generateMipmaps=!1}else Sn?(kr&&i.texStorage2D(3553,wt,mr,si.width,si.height),i.texSubImage2D(3553,0,0,0,ki,Jt,si)):i.texImage2D(3553,0,mr,ki,Jt,si);Y(Re,vi)&&J(pi),Xi.__version=Zt.version,Re.onUpdate&&Re.onUpdate(Re)}Ke.__version=Re.version}function Nt(Ke,Re,Lt){if(Re.image.length!==6)return;let pi=kt(Ke,Re),Ee=Re.source;i.bindTexture(34067,Ke.__webglTexture,33984+Lt);let Zt=r.get(Ee);if(Ee.version!==Zt.__version||pi===!0){i.activeTexture(33984+Lt),e.pixelStorei(37440,Re.flipY),e.pixelStorei(37441,Re.premultiplyAlpha),e.pixelStorei(3317,Re.unpackAlignment),e.pixelStorei(37443,0);let Xi=Re.isCompressedTexture||Re.image[0].isCompressedTexture,Pi=Re.image[0]&&Re.image[0].isDataTexture,si=[];for(let Yt=0;Yt<6;Yt++)!Xi&&!Pi?si[Yt]=j(Re.image[Yt],!1,!0,f):si[Yt]=Pi?Re.image[Yt].image:Re.image[Yt],si[Yt]=lr(Re,si[Yt]);let vi=si[0],ki=V(vi)||u,Jt=n.convert(Re.format,Re.encoding),mr=n.convert(Re.type),$i=X(Re.internalFormat,Jt,mr,Re.encoding),Hr=u&&Re.isVideoTexture!==!0,Sn=Zt.__version===void 0||pi===!0,kr=ee(Re,vi,ki);Xe(34067,Re,ki);let wt;if(Xi){Hr&&Sn&&i.texStorage2D(34067,kr,$i,vi.width,vi.height);for(let Yt=0;Yt<6;Yt++){wt=si[Yt].mipmaps;for(let yi=0;yi<wt.length;yi++){let Ai=wt[yi];Re.format!==da?Jt!==null?Hr?i.compressedTexSubImage2D(34069+Yt,yi,0,0,Ai.width,Ai.height,Jt,Ai.data):i.compressedTexImage2D(34069+Yt,yi,$i,Ai.width,Ai.height,0,Ai.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Hr?i.texSubImage2D(34069+Yt,yi,0,0,Ai.width,Ai.height,Jt,mr,Ai.data):i.texImage2D(34069+Yt,yi,$i,Ai.width,Ai.height,0,Jt,mr,Ai.data)}}}else{wt=Re.mipmaps,Hr&&Sn&&(wt.length>0&&kr++,i.texStorage2D(34067,kr,$i,si[0].width,si[0].height));for(let Yt=0;Yt<6;Yt++)if(Pi){Hr?i.texSubImage2D(34069+Yt,0,0,0,si[Yt].width,si[Yt].height,Jt,mr,si[Yt].data):i.texImage2D(34069+Yt,0,$i,si[Yt].width,si[Yt].height,0,Jt,mr,si[Yt].data);for(let yi=0;yi<wt.length;yi++){let Ai=wt[yi].image[Yt].image;Hr?i.texSubImage2D(34069+Yt,yi+1,0,0,Ai.width,Ai.height,Jt,mr,Ai.data):i.texImage2D(34069+Yt,yi+1,$i,Ai.width,Ai.height,0,Jt,mr,Ai.data)}}else{Hr?i.texSubImage2D(34069+Yt,0,0,0,Jt,mr,si[Yt]):i.texImage2D(34069+Yt,0,$i,Jt,mr,si[Yt]);for(let yi=0;yi<wt.length;yi++){let Ai=wt[yi];Hr?i.texSubImage2D(34069+Yt,yi+1,0,0,Jt,mr,Ai.image[Yt]):i.texImage2D(34069+Yt,yi+1,$i,Jt,mr,Ai.image[Yt])}}}Y(Re,ki)&&J(34067),Zt.__version=Ee.version,Re.onUpdate&&Re.onUpdate(Re)}Ke.__version=Re.version}function Mt(Ke,Re,Lt,pi,Ee){let Zt=n.convert(Lt.format,Lt.encoding),Xi=n.convert(Lt.type),Pi=X(Lt.internalFormat,Zt,Xi,Lt.encoding);r.get(Re).__hasExternalTextures||(Ee===32879||Ee===35866?i.texImage3D(Ee,0,Pi,Re.width,Re.height,Re.depth,0,Zt,Xi,null):i.texImage2D(Ee,0,Pi,Re.width,Re.height,0,Zt,Xi,null)),i.bindFramebuffer(36160,Ke),wi(Re)?E.framebufferTexture2DMultisampleEXT(36160,pi,Ee,r.get(Lt).__webglTexture,0,Ut(Re)):(Ee===3553||Ee>=34069&&Ee<=34074)&&e.framebufferTexture2D(36160,pi,Ee,r.get(Lt).__webglTexture,0),i.bindFramebuffer(36160,null)}function li(Ke,Re,Lt){if(e.bindRenderbuffer(36161,Ke),Re.depthBuffer&&!Re.stencilBuffer){let pi=33189;if(Lt||wi(Re)){let Ee=Re.depthTexture;Ee&&Ee.isDepthTexture&&(Ee.type===To?pi=36012:Ee.type===fp&&(pi=33190));let Zt=Ut(Re);wi(Re)?E.renderbufferStorageMultisampleEXT(36161,Zt,pi,Re.width,Re.height):e.renderbufferStorageMultisample(36161,Zt,pi,Re.width,Re.height)}else e.renderbufferStorage(36161,pi,Re.width,Re.height);e.framebufferRenderbuffer(36160,36096,36161,Ke)}else if(Re.depthBuffer&&Re.stencilBuffer){let pi=Ut(Re);Lt&&wi(Re)===!1?e.renderbufferStorageMultisample(36161,pi,35056,Re.width,Re.height):wi(Re)?E.renderbufferStorageMultisampleEXT(36161,pi,35056,Re.width,Re.height):e.renderbufferStorage(36161,34041,Re.width,Re.height),e.framebufferRenderbuffer(36160,33306,36161,Ke)}else{let pi=Re.isWebGLMultipleRenderTargets===!0?Re.texture:[Re.texture];for(let Ee=0;Ee<pi.length;Ee++){let Zt=pi[Ee],Xi=n.convert(Zt.format,Zt.encoding),Pi=n.convert(Zt.type),si=X(Zt.internalFormat,Xi,Pi,Zt.encoding),vi=Ut(Re);Lt&&wi(Re)===!1?e.renderbufferStorageMultisample(36161,vi,si,Re.width,Re.height):wi(Re)?E.renderbufferStorageMultisampleEXT(36161,vi,si,Re.width,Re.height):e.renderbufferStorage(36161,si,Re.width,Re.height)}}e.bindRenderbuffer(36161,null)}function Qt(Ke,Re){if(Re&&Re.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,Ke),!(Re.depthTexture&&Re.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(Re.depthTexture).__webglTexture||Re.depthTexture.image.width!==Re.width||Re.depthTexture.image.height!==Re.height)&&(Re.depthTexture.image.width=Re.width,Re.depthTexture.image.height=Re.height,Re.depthTexture.needsUpdate=!0),$e(Re.depthTexture,0);let Lt=r.get(Re.depthTexture).__webglTexture,pi=Ut(Re);if(Re.depthTexture.format===Ry)wi(Re)?E.framebufferTexture2DMultisampleEXT(36160,36096,3553,Lt,0,pi):e.framebufferTexture2D(36160,36096,3553,Lt,0);else if(Re.depthTexture.format===By)wi(Re)?E.framebufferTexture2DMultisampleEXT(36160,33306,3553,Lt,0,pi):e.framebufferTexture2D(36160,33306,3553,Lt,0);else throw new Error("Unknown depthTexture format")}function Wt(Ke){let Re=r.get(Ke),Lt=Ke.isWebGLCubeRenderTarget===!0;if(Ke.depthTexture&&!Re.__autoAllocateDepthBuffer){if(Lt)throw new Error("target.depthTexture not supported in Cube render targets");Qt(Re.__webglFramebuffer,Ke)}else if(Lt){Re.__webglDepthbuffer=[];for(let pi=0;pi<6;pi++)i.bindFramebuffer(36160,Re.__webglFramebuffer[pi]),Re.__webglDepthbuffer[pi]=e.createRenderbuffer(),li(Re.__webglDepthbuffer[pi],Ke,!1)}else i.bindFramebuffer(36160,Re.__webglFramebuffer),Re.__webglDepthbuffer=e.createRenderbuffer(),li(Re.__webglDepthbuffer,Ke,!1);i.bindFramebuffer(36160,null)}function Di(Ke,Re,Lt){let pi=r.get(Ke);Re!==void 0&&Mt(pi.__webglFramebuffer,Ke,Ke.texture,36064,3553),Lt!==void 0&&Wt(Ke)}function Ii(Ke){let Re=Ke.texture,Lt=r.get(Ke),pi=r.get(Re);Ke.addEventListener("dispose",ve),Ke.isWebGLMultipleRenderTargets!==!0&&(pi.__webglTexture===void 0&&(pi.__webglTexture=e.createTexture()),pi.__version=Re.version,c.memory.textures++);let Ee=Ke.isWebGLCubeRenderTarget===!0,Zt=Ke.isWebGLMultipleRenderTargets===!0,Xi=V(Ke)||u;if(Ee){Lt.__webglFramebuffer=[];for(let Pi=0;Pi<6;Pi++)Lt.__webglFramebuffer[Pi]=e.createFramebuffer()}else{if(Lt.__webglFramebuffer=e.createFramebuffer(),Zt)if(s.drawBuffers){let Pi=Ke.texture;for(let si=0,vi=Pi.length;si<vi;si++){let ki=r.get(Pi[si]);ki.__webglTexture===void 0&&(ki.__webglTexture=e.createTexture(),c.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(u&&Ke.samples>0&&wi(Ke)===!1){let Pi=Zt?Re:[Re];Lt.__webglMultisampledFramebuffer=e.createFramebuffer(),Lt.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,Lt.__webglMultisampledFramebuffer);for(let si=0;si<Pi.length;si++){let vi=Pi[si];Lt.__webglColorRenderbuffer[si]=e.createRenderbuffer(),e.bindRenderbuffer(36161,Lt.__webglColorRenderbuffer[si]);let ki=n.convert(vi.format,vi.encoding),Jt=n.convert(vi.type),mr=X(vi.internalFormat,ki,Jt,vi.encoding,Ke.isXRRenderTarget===!0),$i=Ut(Ke);e.renderbufferStorageMultisample(36161,$i,mr,Ke.width,Ke.height),e.framebufferRenderbuffer(36160,36064+si,36161,Lt.__webglColorRenderbuffer[si])}e.bindRenderbuffer(36161,null),Ke.depthBuffer&&(Lt.__webglDepthRenderbuffer=e.createRenderbuffer(),li(Lt.__webglDepthRenderbuffer,Ke,!0)),i.bindFramebuffer(36160,null)}}if(Ee){i.bindTexture(34067,pi.__webglTexture),Xe(34067,Re,Xi);for(let Pi=0;Pi<6;Pi++)Mt(Lt.__webglFramebuffer[Pi],Ke,Re,36064,34069+Pi);Y(Re,Xi)&&J(34067),i.unbindTexture()}else if(Zt){let Pi=Ke.texture;for(let si=0,vi=Pi.length;si<vi;si++){let ki=Pi[si],Jt=r.get(ki);i.bindTexture(3553,Jt.__webglTexture),Xe(3553,ki,Xi),Mt(Lt.__webglFramebuffer,Ke,ki,36064+si,3553),Y(ki,Xi)&&J(3553)}i.unbindTexture()}else{let Pi=3553;(Ke.isWebGL3DRenderTarget||Ke.isWebGLArrayRenderTarget)&&(u?Pi=Ke.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(Pi,pi.__webglTexture),Xe(Pi,Re,Xi),Mt(Lt.__webglFramebuffer,Ke,Re,36064,Pi),Y(Re,Xi)&&J(Pi),i.unbindTexture()}Ke.depthBuffer&&Wt(Ke)}function Li(Ke){let Re=V(Ke)||u,Lt=Ke.isWebGLMultipleRenderTargets===!0?Ke.texture:[Ke.texture];for(let pi=0,Ee=Lt.length;pi<Ee;pi++){let Zt=Lt[pi];if(Y(Zt,Re)){let Xi=Ke.isWebGLCubeRenderTarget?34067:3553,Pi=r.get(Zt).__webglTexture;i.bindTexture(Xi,Pi),J(Xi),i.unbindTexture()}}}function $t(Ke){if(u&&Ke.samples>0&&wi(Ke)===!1){let Re=Ke.isWebGLMultipleRenderTargets?Ke.texture:[Ke.texture],Lt=Ke.width,pi=Ke.height,Ee=16384,Zt=[],Xi=Ke.stencilBuffer?33306:36096,Pi=r.get(Ke),si=Ke.isWebGLMultipleRenderTargets===!0;if(si)for(let vi=0;vi<Re.length;vi++)i.bindFramebuffer(36160,Pi.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+vi,36161,null),i.bindFramebuffer(36160,Pi.__webglFramebuffer),e.framebufferTexture2D(36009,36064+vi,3553,null,0);i.bindFramebuffer(36008,Pi.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Pi.__webglFramebuffer);for(let vi=0;vi<Re.length;vi++){Zt.push(36064+vi),Ke.depthBuffer&&Zt.push(Xi);let ki=Pi.__ignoreDepthValues!==void 0?Pi.__ignoreDepthValues:!1;if(ki===!1&&(Ke.depthBuffer&&(Ee|=256),Ke.stencilBuffer&&(Ee|=1024)),si&&e.framebufferRenderbuffer(36008,36064,36161,Pi.__webglColorRenderbuffer[vi]),ki===!0&&(e.invalidateFramebuffer(36008,[Xi]),e.invalidateFramebuffer(36009,[Xi])),si){let Jt=r.get(Re[vi]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,Jt,0)}e.blitFramebuffer(0,0,Lt,pi,0,0,Lt,pi,Ee,9728),A&&e.invalidateFramebuffer(36008,Zt)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),si)for(let vi=0;vi<Re.length;vi++){i.bindFramebuffer(36160,Pi.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+vi,36161,Pi.__webglColorRenderbuffer[vi]);let ki=r.get(Re[vi]).__webglTexture;i.bindFramebuffer(36160,Pi.__webglFramebuffer),e.framebufferTexture2D(36009,36064+vi,3553,ki,0)}i.bindFramebuffer(36009,Pi.__webglMultisampledFramebuffer)}}function Ut(Ke){return Math.min(w,Ke.samples)}function wi(Ke){let Re=r.get(Ke);return u&&Ke.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&Re.__useRenderToTexture!==!1}function Hi(Ke){let Re=c.render.frame;I.get(Ke)!==Re&&(I.set(Ke,Re),Ke.update())}function lr(Ke,Re){let Lt=Ke.encoding,pi=Ke.format,Ee=Ke.type;return Ke.isCompressedTexture===!0||Ke.isVideoTexture===!0||Ke.format===pN||Lt!==Xu&&(Lt===sn?u===!1?t.has("EXT_sRGB")===!0&&pi===da?(Ke.format=pN,Ke.minFilter=cn,Ke.generateMipmaps=!1):Re=eK.sRGBToLinear(Re):(pi!==da||Ee!==$a)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",Lt)),Re}this.allocateTextureUnit=Ae,this.resetTextureUnits=Pe,this.setTexture2D=$e,this.setTexture2DArray=rt,this.setTexture3D=Je,this.setTextureCube=bt,this.rebindTextures=Di,this.setupRenderTarget=Ii,this.updateRenderTargetMipmap=Li,this.updateMultisampleRenderTarget=$t,this.setupDepthRenderbuffer=Wt,this.setupFrameBufferTexture=Mt,this.useMultisampledRTT=wi}function Lxe(e,t,i){let r=i.isWebGL2;function s(n,c=null){let u;if(n===$a)return 5121;if(n===gge)return 32819;if(n===yge)return 32820;if(n===pge)return 5120;if(n===fge)return 5122;if(n===qQ)return 5123;if(n===mge)return 5124;if(n===fp)return 5125;if(n===To)return 5126;if(n===wp)return r?5131:(u=t.get("OES_texture_half_float"),u!==null?u.HALF_FLOAT_OES:null);if(n===vge)return 6406;if(n===da)return 6408;if(n===_ge)return 6409;if(n===xge)return 6410;if(n===Ry)return 6402;if(n===By)return 34041;if(n===pN)return u=t.get("EXT_sRGB"),u!==null?u.SRGB_ALPHA_EXT:null;if(n===bge)return 6403;if(n===wge)return 36244;if(n===fD)return 33319;if(n===Sge)return 33320;if(n===YQ)return 36249;if(n===rF||n===nF||n===sF||n===oF)if(c===sn)if(u=t.get("WEBGL_compressed_texture_s3tc_srgb"),u!==null){if(n===rF)return u.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===nF)return u.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===sF)return u.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===oF)return u.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(u=t.get("WEBGL_compressed_texture_s3tc"),u!==null){if(n===rF)return u.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===nF)return u.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===sF)return u.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===oF)return u.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===Uq||n===jq||n===Vq||n===Gq)if(u=t.get("WEBGL_compressed_texture_pvrtc"),u!==null){if(n===Uq)return u.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===jq)return u.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Vq)return u.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Gq)return u.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===Ege)return u=t.get("WEBGL_compressed_texture_etc1"),u!==null?u.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===Hq||n===Wq)if(u=t.get("WEBGL_compressed_texture_etc"),u!==null){if(n===Hq)return c===sn?u.COMPRESSED_SRGB8_ETC2:u.COMPRESSED_RGB8_ETC2;if(n===Wq)return c===sn?u.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:u.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===qq||n===Yq||n===Xq||n===$q||n===Zq||n===Qq||n===Kq||n===Jq||n===e7||n===t7||n===i7||n===r7||n===n7||n===s7)if(u=t.get("WEBGL_compressed_texture_astc"),u!==null){if(n===qq)return c===sn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:u.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Yq)return c===sn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:u.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Xq)return c===sn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:u.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===$q)return c===sn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:u.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Zq)return c===sn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:u.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Qq)return c===sn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:u.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Kq)return c===sn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:u.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Jq)return c===sn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:u.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===e7)return c===sn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:u.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===t7)return c===sn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:u.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===i7)return c===sn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:u.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===r7)return c===sn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:u.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===n7)return c===sn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:u.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===s7)return c===sn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:u.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===aF)if(u=t.get("EXT_texture_compression_bptc"),u!==null){if(n===aF)return c===sn?u.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:u.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(n===Mge||n===o7||n===a7||n===l7)if(u=t.get("EXT_texture_compression_rgtc"),u!==null){if(n===aF)return u.COMPRESSED_RED_RGTC1_EXT;if(n===o7)return u.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===a7)return u.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===l7)return u.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===Py?r?34042:(u=t.get("WEBGL_depth_texture"),u!==null?u.UNSIGNED_INT_24_8_WEBGL:null):e[n]!==void 0?e[n]:null}return{convert:s}}var zxe=class extends Ga{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},gp=class extends ls{constructor(){super(),this.isGroup=!0,this.type="Group"}},Fxe={type:"move"},OF=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new gp,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new gp,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new se,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new se),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new gp,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new se,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new se),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,n=null,c=this._targetRay,u=this._grip,p=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(p&&e.hand){n=!0;for(let I of e.hand.values()){let P=t.getJointPose(I,i),O=this._getHandJoint(p,I);P!==null&&(O.matrix.fromArray(P.transform.matrix),O.matrix.decompose(O.position,O.rotation,O.scale),O.jointRadius=P.radius),O.visible=P!==null}let f=p.joints["index-finger-tip"],x=p.joints["thumb-tip"],w=f.position.distanceTo(x.position),E=.02,A=.005;p.inputState.pinching&&w>E+A?(p.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!p.inputState.pinching&&w<=E-A&&(p.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else u!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),s!==null&&(u.matrix.fromArray(s.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),s.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(s.linearVelocity)):u.hasLinearVelocity=!1,s.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(s.angularVelocity)):u.hasAngularVelocity=!1));c!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(c.matrix.fromArray(r.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),r.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(r.linearVelocity)):c.hasLinearVelocity=!1,r.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(r.angularVelocity)):c.hasAngularVelocity=!1,this.dispatchEvent(Fxe)))}return c!==null&&(c.visible=r!==null),u!==null&&(u.visible=s!==null),p!==null&&(p.visible=n!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){let i=new gp;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}},cx=class extends Zs{constructor(e,t,i,r,s,n,c,u,p,f){if(f=f!==void 0?f:Ry,f!==Ry&&f!==By)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&f===Ry&&(i=fp),i===void 0&&f===By&&(i=Py),super(null,r,s,n,c,u,f,i,p),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=c!==void 0?c:ns,this.minFilter=u!==void 0?u:ns,this.flipY=!1,this.generateMipmaps=!1}},kxe=class extends za{constructor(e,t){super();let i=this,r=null,s=1,n=null,c="local-floor",u=1,p=null,f=null,x=null,w=null,E=null,A=null,I=t.getContextAttributes(),P=null,O=null,k=[],U=[],j=new Set,V=new Map,$=new Ga;$.layers.enable(1),$.viewport=new Gr;let Y=new Ga;Y.layers.enable(2),Y.viewport=new Gr;let J=[$,Y],X=new zxe;X.layers.enable(1),X.layers.enable(2);let ee=null,oe=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(rt){let Je=k[rt];return Je===void 0&&(Je=new OF,k[rt]=Je),Je.getTargetRaySpace()},this.getControllerGrip=function(rt){let Je=k[rt];return Je===void 0&&(Je=new OF,k[rt]=Je),Je.getGripSpace()},this.getHand=function(rt){let Je=k[rt];return Je===void 0&&(Je=new OF,k[rt]=Je),Je.getHandSpace()};function le(rt){let Je=U.indexOf(rt.inputSource);if(Je===-1)return;let bt=k[Je];bt!==void 0&&bt.dispatchEvent({type:rt.type,data:rt.inputSource})}function ve(){r.removeEventListener("select",le),r.removeEventListener("selectstart",le),r.removeEventListener("selectend",le),r.removeEventListener("squeeze",le),r.removeEventListener("squeezestart",le),r.removeEventListener("squeezeend",le),r.removeEventListener("end",ve),r.removeEventListener("inputsourceschange",we);for(let rt=0;rt<k.length;rt++){let Je=U[rt];Je!==null&&(U[rt]=null,k[rt].disconnect(Je))}ee=null,oe=null,e.setRenderTarget(P),E=null,w=null,x=null,r=null,O=null,$e.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(rt){s=rt,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(rt){c=rt,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return p||n},this.setReferenceSpace=function(rt){p=rt},this.getBaseLayer=function(){return w!==null?w:E},this.getBinding=function(){return x},this.getFrame=function(){return A},this.getSession=function(){return r},this.setSession=function(rt){return jn(this,null,function*(){if(r=rt,r!==null){if(P=e.getRenderTarget(),r.addEventListener("select",le),r.addEventListener("selectstart",le),r.addEventListener("selectend",le),r.addEventListener("squeeze",le),r.addEventListener("squeezestart",le),r.addEventListener("squeezeend",le),r.addEventListener("end",ve),r.addEventListener("inputsourceschange",we),I.xrCompatible!==!0&&(yield t.makeXRCompatible()),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let Je={antialias:r.renderState.layers===void 0?I.antialias:!0,alpha:I.alpha,depth:I.depth,stencil:I.stencil,framebufferScaleFactor:s};E=new XRWebGLLayer(r,t,Je),r.updateRenderState({baseLayer:E}),O=new Zn(E.framebufferWidth,E.framebufferHeight,{format:da,type:$a,encoding:e.outputEncoding,stencilBuffer:I.stencil})}else{let Je=null,bt=null,ot=null;I.depth&&(ot=I.stencil?35056:33190,Je=I.stencil?By:Ry,bt=I.stencil?Py:fp);let xt={colorFormat:32856,depthFormat:ot,scaleFactor:s};x=new XRWebGLBinding(r,t),w=x.createProjectionLayer(xt),r.updateRenderState({layers:[w]}),O=new Zn(w.textureWidth,w.textureHeight,{format:da,type:$a,depthTexture:new cx(w.textureWidth,w.textureHeight,bt,void 0,void 0,void 0,void 0,void 0,void 0,Je),stencilBuffer:I.stencil,encoding:e.outputEncoding,samples:I.antialias?4:0});let Xe=e.properties.get(O);Xe.__ignoreDepthValues=w.ignoreDepthValues}O.isXRRenderTarget=!0,this.setFoveation(u),p=null,n=yield r.requestReferenceSpace(c),$e.setContext(r),$e.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}})};function we(rt){for(let Je=0;Je<rt.removed.length;Je++){let bt=rt.removed[Je],ot=U.indexOf(bt);ot>=0&&(U[ot]=null,k[ot].disconnect(bt))}for(let Je=0;Je<rt.added.length;Je++){let bt=rt.added[Je],ot=U.indexOf(bt);if(ot===-1){for(let Xe=0;Xe<k.length;Xe++)if(Xe>=U.length){U.push(bt),ot=Xe;break}else if(U[Xe]===null){U[Xe]=bt,ot=Xe;break}if(ot===-1)break}let xt=k[ot];xt&&xt.connect(bt)}}let fe=new se,Ue=new se;function Fe(rt,Je,bt){fe.setFromMatrixPosition(Je.matrixWorld),Ue.setFromMatrixPosition(bt.matrixWorld);let ot=fe.distanceTo(Ue),xt=Je.projectionMatrix.elements,Xe=bt.projectionMatrix.elements,kt=xt[14]/(xt[10]-1),yt=xt[14]/(xt[10]+1),Nt=(xt[9]+1)/xt[5],Mt=(xt[9]-1)/xt[5],li=(xt[8]-1)/xt[0],Qt=(Xe[8]+1)/Xe[0],Wt=kt*li,Di=kt*Qt,Ii=ot/(-li+Qt),Li=Ii*-li;Je.matrixWorld.decompose(rt.position,rt.quaternion,rt.scale),rt.translateX(Li),rt.translateZ(Ii),rt.matrixWorld.compose(rt.position,rt.quaternion,rt.scale),rt.matrixWorldInverse.copy(rt.matrixWorld).invert();let $t=kt+Ii,Ut=yt+Ii,wi=Wt-Li,Hi=Di+(ot-Li),lr=Nt*yt/Ut*$t,Ke=Mt*yt/Ut*$t;rt.projectionMatrix.makePerspective(wi,Hi,lr,Ke,$t,Ut)}function Pe(rt,Je){Je===null?rt.matrixWorld.copy(rt.matrix):rt.matrixWorld.multiplyMatrices(Je.matrixWorld,rt.matrix),rt.matrixWorldInverse.copy(rt.matrixWorld).invert()}this.updateCamera=function(rt){if(r===null)return;X.near=Y.near=$.near=rt.near,X.far=Y.far=$.far=rt.far,(ee!==X.near||oe!==X.far)&&(r.updateRenderState({depthNear:X.near,depthFar:X.far}),ee=X.near,oe=X.far);let Je=rt.parent,bt=X.cameras;Pe(X,Je);for(let xt=0;xt<bt.length;xt++)Pe(bt[xt],Je);X.matrixWorld.decompose(X.position,X.quaternion,X.scale),rt.matrix.copy(X.matrix),rt.matrix.decompose(rt.position,rt.quaternion,rt.scale);let ot=rt.children;for(let xt=0,Xe=ot.length;xt<Xe;xt++)ot[xt].updateMatrixWorld(!0);bt.length===2?Fe(X,$,Y):X.projectionMatrix.copy($.projectionMatrix)},this.getCamera=function(){return X},this.getFoveation=function(){if(!(w===null&&E===null))return u},this.setFoveation=function(rt){u=rt,w!==null&&(w.fixedFoveation=rt),E!==null&&E.fixedFoveation!==void 0&&(E.fixedFoveation=rt)},this.getPlanes=function(){return j};let Ae=null;function et(rt,Je){if(f=Je.getViewerPose(p||n),A=Je,f!==null){let bt=f.views;E!==null&&(e.setRenderTargetFramebuffer(O,E.framebuffer),e.setRenderTarget(O));let ot=!1;bt.length!==X.cameras.length&&(X.cameras.length=0,ot=!0);for(let xt=0;xt<bt.length;xt++){let Xe=bt[xt],kt=null;if(E!==null)kt=E.getViewport(Xe);else{let Nt=x.getViewSubImage(w,Xe);kt=Nt.viewport,xt===0&&(e.setRenderTargetTextures(O,Nt.colorTexture,w.ignoreDepthValues?void 0:Nt.depthStencilTexture),e.setRenderTarget(O))}let yt=J[xt];yt===void 0&&(yt=new Ga,yt.layers.enable(xt),yt.viewport=new Gr,J[xt]=yt),yt.matrix.fromArray(Xe.transform.matrix),yt.projectionMatrix.fromArray(Xe.projectionMatrix),yt.viewport.set(kt.x,kt.y,kt.width,kt.height),xt===0&&X.matrix.copy(yt.matrix),ot===!0&&X.cameras.push(yt)}}for(let bt=0;bt<k.length;bt++){let ot=U[bt],xt=k[bt];ot!==null&&xt!==void 0&&xt.update(ot,Je,p||n)}if(Ae&&Ae(rt,Je),Je.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:Je.detectedPlanes});let bt=null;for(let ot of j)Je.detectedPlanes.has(ot)||(bt===null&&(bt=[]),bt.push(ot));if(bt!==null)for(let ot of bt)j.delete(ot),V.delete(ot),i.dispatchEvent({type:"planeremoved",data:ot});for(let ot of Je.detectedPlanes)if(!j.has(ot))j.add(ot),V.set(ot,Je.lastChangedTime),i.dispatchEvent({type:"planeadded",data:ot});else{let xt=V.get(ot);ot.lastChangedTime>xt&&(V.set(ot,ot.lastChangedTime),i.dispatchEvent({type:"planechanged",data:ot}))}}A=null}let $e=new sK;$e.setAnimationLoop(et),this.setAnimationLoop=function(rt){Ae=rt},this.dispose=function(){}}};function Nxe(e,t){function i(P,O){O.color.getRGB(P.fogColor.value,nK(e)),O.isFog?(P.fogNear.value=O.near,P.fogFar.value=O.far):O.isFogExp2&&(P.fogDensity.value=O.density)}function r(P,O,k,U,j){O.isMeshBasicMaterial||O.isMeshLambertMaterial?s(P,O):O.isMeshToonMaterial?(s(P,O),x(P,O)):O.isMeshPhongMaterial?(s(P,O),f(P,O)):O.isMeshStandardMaterial?(s(P,O),w(P,O),O.isMeshPhysicalMaterial&&E(P,O,j)):O.isMeshMatcapMaterial?(s(P,O),A(P,O)):O.isMeshDepthMaterial?s(P,O):O.isMeshDistanceMaterial?(s(P,O),I(P,O)):O.isMeshNormalMaterial?s(P,O):O.isLineBasicMaterial?(n(P,O),O.isLineDashedMaterial&&c(P,O)):O.isPointsMaterial?u(P,O,k,U):O.isSpriteMaterial?p(P,O):O.isShadowMaterial?(P.color.value.copy(O.color),P.opacity.value=O.opacity):O.isShaderMaterial&&(O.uniformsNeedUpdate=!1)}function s(P,O){P.opacity.value=O.opacity,O.color&&P.diffuse.value.copy(O.color),O.emissive&&P.emissive.value.copy(O.emissive).multiplyScalar(O.emissiveIntensity),O.map&&(P.map.value=O.map),O.alphaMap&&(P.alphaMap.value=O.alphaMap),O.bumpMap&&(P.bumpMap.value=O.bumpMap,P.bumpScale.value=O.bumpScale,O.side===fa&&(P.bumpScale.value*=-1)),O.displacementMap&&(P.displacementMap.value=O.displacementMap,P.displacementScale.value=O.displacementScale,P.displacementBias.value=O.displacementBias),O.emissiveMap&&(P.emissiveMap.value=O.emissiveMap),O.normalMap&&(P.normalMap.value=O.normalMap,P.normalScale.value.copy(O.normalScale),O.side===fa&&P.normalScale.value.negate()),O.specularMap&&(P.specularMap.value=O.specularMap),O.alphaTest>0&&(P.alphaTest.value=O.alphaTest);let k=t.get(O).envMap;if(k&&(P.envMap.value=k,P.flipEnvMap.value=k.isCubeTexture&&k.isRenderTargetTexture===!1?-1:1,P.reflectivity.value=O.reflectivity,P.ior.value=O.ior,P.refractionRatio.value=O.refractionRatio),O.lightMap){P.lightMap.value=O.lightMap;let V=e.physicallyCorrectLights!==!0?Math.PI:1;P.lightMapIntensity.value=O.lightMapIntensity*V}O.aoMap&&(P.aoMap.value=O.aoMap,P.aoMapIntensity.value=O.aoMapIntensity);let U;O.map?U=O.map:O.specularMap?U=O.specularMap:O.displacementMap?U=O.displacementMap:O.normalMap?U=O.normalMap:O.bumpMap?U=O.bumpMap:O.roughnessMap?U=O.roughnessMap:O.metalnessMap?U=O.metalnessMap:O.alphaMap?U=O.alphaMap:O.emissiveMap?U=O.emissiveMap:O.clearcoatMap?U=O.clearcoatMap:O.clearcoatNormalMap?U=O.clearcoatNormalMap:O.clearcoatRoughnessMap?U=O.clearcoatRoughnessMap:O.iridescenceMap?U=O.iridescenceMap:O.iridescenceThicknessMap?U=O.iridescenceThicknessMap:O.specularIntensityMap?U=O.specularIntensityMap:O.specularColorMap?U=O.specularColorMap:O.transmissionMap?U=O.transmissionMap:O.thicknessMap?U=O.thicknessMap:O.sheenColorMap?U=O.sheenColorMap:O.sheenRoughnessMap&&(U=O.sheenRoughnessMap),U!==void 0&&(U.isWebGLRenderTarget&&(U=U.texture),U.matrixAutoUpdate===!0&&U.updateMatrix(),P.uvTransform.value.copy(U.matrix));let j;O.aoMap?j=O.aoMap:O.lightMap&&(j=O.lightMap),j!==void 0&&(j.isWebGLRenderTarget&&(j=j.texture),j.matrixAutoUpdate===!0&&j.updateMatrix(),P.uv2Transform.value.copy(j.matrix))}function n(P,O){P.diffuse.value.copy(O.color),P.opacity.value=O.opacity}function c(P,O){P.dashSize.value=O.dashSize,P.totalSize.value=O.dashSize+O.gapSize,P.scale.value=O.scale}function u(P,O,k,U){P.diffuse.value.copy(O.color),P.opacity.value=O.opacity,P.size.value=O.size*k,P.scale.value=U*.5,O.map&&(P.map.value=O.map),O.alphaMap&&(P.alphaMap.value=O.alphaMap),O.alphaTest>0&&(P.alphaTest.value=O.alphaTest);let j;O.map?j=O.map:O.alphaMap&&(j=O.alphaMap),j!==void 0&&(j.matrixAutoUpdate===!0&&j.updateMatrix(),P.uvTransform.value.copy(j.matrix))}function p(P,O){P.diffuse.value.copy(O.color),P.opacity.value=O.opacity,P.rotation.value=O.rotation,O.map&&(P.map.value=O.map),O.alphaMap&&(P.alphaMap.value=O.alphaMap),O.alphaTest>0&&(P.alphaTest.value=O.alphaTest);let k;O.map?k=O.map:O.alphaMap&&(k=O.alphaMap),k!==void 0&&(k.matrixAutoUpdate===!0&&k.updateMatrix(),P.uvTransform.value.copy(k.matrix))}function f(P,O){P.specular.value.copy(O.specular),P.shininess.value=Math.max(O.shininess,1e-4)}function x(P,O){O.gradientMap&&(P.gradientMap.value=O.gradientMap)}function w(P,O){P.roughness.value=O.roughness,P.metalness.value=O.metalness,O.roughnessMap&&(P.roughnessMap.value=O.roughnessMap),O.metalnessMap&&(P.metalnessMap.value=O.metalnessMap),t.get(O).envMap&&(P.envMapIntensity.value=O.envMapIntensity)}function E(P,O,k){P.ior.value=O.ior,O.sheen>0&&(P.sheenColor.value.copy(O.sheenColor).multiplyScalar(O.sheen),P.sheenRoughness.value=O.sheenRoughness,O.sheenColorMap&&(P.sheenColorMap.value=O.sheenColorMap),O.sheenRoughnessMap&&(P.sheenRoughnessMap.value=O.sheenRoughnessMap)),O.clearcoat>0&&(P.clearcoat.value=O.clearcoat,P.clearcoatRoughness.value=O.clearcoatRoughness,O.clearcoatMap&&(P.clearcoatMap.value=O.clearcoatMap),O.clearcoatRoughnessMap&&(P.clearcoatRoughnessMap.value=O.clearcoatRoughnessMap),O.clearcoatNormalMap&&(P.clearcoatNormalScale.value.copy(O.clearcoatNormalScale),P.clearcoatNormalMap.value=O.clearcoatNormalMap,O.side===fa&&P.clearcoatNormalScale.value.negate())),O.iridescence>0&&(P.iridescence.value=O.iridescence,P.iridescenceIOR.value=O.iridescenceIOR,P.iridescenceThicknessMinimum.value=O.iridescenceThicknessRange[0],P.iridescenceThicknessMaximum.value=O.iridescenceThicknessRange[1],O.iridescenceMap&&(P.iridescenceMap.value=O.iridescenceMap),O.iridescenceThicknessMap&&(P.iridescenceThicknessMap.value=O.iridescenceThicknessMap)),O.transmission>0&&(P.transmission.value=O.transmission,P.transmissionSamplerMap.value=k.texture,P.transmissionSamplerSize.value.set(k.width,k.height),O.transmissionMap&&(P.transmissionMap.value=O.transmissionMap),P.thickness.value=O.thickness,O.thicknessMap&&(P.thicknessMap.value=O.thicknessMap),P.attenuationDistance.value=O.attenuationDistance,P.attenuationColor.value.copy(O.attenuationColor)),P.specularIntensity.value=O.specularIntensity,P.specularColor.value.copy(O.specularColor),O.specularIntensityMap&&(P.specularIntensityMap.value=O.specularIntensityMap),O.specularColorMap&&(P.specularColorMap.value=O.specularColorMap)}function A(P,O){O.matcap&&(P.matcap.value=O.matcap)}function I(P,O){P.referencePosition.value.copy(O.referencePosition),P.nearDistance.value=O.nearDistance,P.farDistance.value=O.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function Bxe(e,t,i,r){let s={},n={},c=[],u=i.isWebGL2?e.getParameter(35375):0;function p(U,j){let V=j.program;r.uniformBlockBinding(U,V)}function f(U,j){let V=s[U.id];V===void 0&&(I(U),V=x(U),s[U.id]=V,U.addEventListener("dispose",O));let $=j.program;r.updateUBOMapping(U,$);let Y=t.render.frame;n[U.id]!==Y&&(E(U),n[U.id]=Y)}function x(U){let j=w();U.__bindingPointIndex=j;let V=e.createBuffer(),$=U.__size,Y=U.usage;return e.bindBuffer(35345,V),e.bufferData(35345,$,Y),e.bindBuffer(35345,null),e.bindBufferBase(35345,j,V),V}function w(){for(let U=0;U<u;U++)if(c.indexOf(U)===-1)return c.push(U),U;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function E(U){let j=s[U.id],V=U.uniforms,$=U.__cache;e.bindBuffer(35345,j);for(let Y=0,J=V.length;Y<J;Y++){let X=V[Y];if(A(X,Y,$)===!0){let ee=X.__offset,oe=Array.isArray(X.value)?X.value:[X.value],le=0;for(let ve=0;ve<oe.length;ve++){let we=oe[ve],fe=P(we);typeof we=="number"?(X.__data[0]=we,e.bufferSubData(35345,ee+le,X.__data)):we.isMatrix3?(X.__data[0]=we.elements[0],X.__data[1]=we.elements[1],X.__data[2]=we.elements[2],X.__data[3]=we.elements[0],X.__data[4]=we.elements[3],X.__data[5]=we.elements[4],X.__data[6]=we.elements[5],X.__data[7]=we.elements[0],X.__data[8]=we.elements[6],X.__data[9]=we.elements[7],X.__data[10]=we.elements[8],X.__data[11]=we.elements[0]):(we.toArray(X.__data,le),le+=fe.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,ee,X.__data)}}e.bindBuffer(35345,null)}function A(U,j,V){let $=U.value;if(V[j]===void 0){if(typeof $=="number")V[j]=$;else{let Y=Array.isArray($)?$:[$],J=[];for(let X=0;X<Y.length;X++)J.push(Y[X].clone());V[j]=J}return!0}else if(typeof $=="number"){if(V[j]!==$)return V[j]=$,!0}else{let Y=Array.isArray(V[j])?V[j]:[V[j]],J=Array.isArray($)?$:[$];for(let X=0;X<Y.length;X++){let ee=Y[X];if(ee.equals(J[X])===!1)return ee.copy(J[X]),!0}}return!1}function I(U){let j=U.uniforms,V=0,$=16,Y=0;for(let J=0,X=j.length;J<X;J++){let ee=j[J],oe={boundary:0,storage:0},le=Array.isArray(ee.value)?ee.value:[ee.value];for(let ve=0,we=le.length;ve<we;ve++){let fe=le[ve],Ue=P(fe);oe.boundary+=Ue.boundary,oe.storage+=Ue.storage}if(ee.__data=new Float32Array(oe.storage/Float32Array.BYTES_PER_ELEMENT),ee.__offset=V,J>0){Y=V%$;let ve=$-Y;Y!==0&&ve-oe.boundary<0&&(V+=$-Y,ee.__offset=V)}V+=oe.storage}return Y=V%$,Y>0&&(V+=$-Y),U.__size=V,U.__cache={},this}function P(U){let j={boundary:0,storage:0};return typeof U=="number"?(j.boundary=4,j.storage=4):U.isVector2?(j.boundary=8,j.storage=8):U.isVector3||U.isColor?(j.boundary=16,j.storage=12):U.isVector4?(j.boundary=16,j.storage=16):U.isMatrix3?(j.boundary=48,j.storage=48):U.isMatrix4?(j.boundary=64,j.storage=64):U.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",U),j}function O(U){let j=U.target;j.removeEventListener("dispose",O);let V=c.indexOf(j.__bindingPointIndex);c.splice(V,1),e.deleteBuffer(s[j.id]),delete s[j.id],delete n[j.id]}function k(){for(let U in s)e.deleteBuffer(s[U]);c=[],s={},n={}}return{bind:p,update:f,dispose:k}}function Uxe(){let e=vS("canvas");return e.style.display="block",e}function hK(e={}){this.isWebGLRenderer=!0;let t=e.canvas!==void 0?e.canvas:Uxe(),i=e.context!==void 0?e.context:null,r=e.depth!==void 0?e.depth:!0,s=e.stencil!==void 0?e.stencil:!0,n=e.antialias!==void 0?e.antialias:!1,c=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,u=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,p=e.powerPreference!==void 0?e.powerPreference:"default",f=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1,x;i!==null?x=i.getContextAttributes().alpha:x=e.alpha!==void 0?e.alpha:!1;let w=null,E=null,A=[],I=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Xu,this.physicallyCorrectLights=!1,this.toneMapping=Zh,this.toneMappingExposure=1;let P=this,O=!1,k=0,U=0,j=null,V=-1,$=null,Y=new Gr,J=new Gr,X=null,ee=t.width,oe=t.height,le=1,ve=null,we=null,fe=new Gr(0,0,ee,oe),Ue=new Gr(0,0,ee,oe),Fe=!1,Pe=new g4,Ae=!1,et=!1,$e=null,rt=new mi,Je=new lt,bt=new se,ot={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function xt(){return j===null?le:1}let Xe=i;function kt(Ze,xe){for(let ie=0;ie<Ze.length;ie++){let re=Ze[ie],he=t.getContext(re,xe);if(he!==null)return he}return null}try{let Ze={alpha:!0,depth:r,stencil:s,antialias:n,premultipliedAlpha:c,preserveDrawingBuffer:u,powerPreference:p,failIfMajorPerformanceCaveat:f};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${wx}`),t.addEventListener("webglcontextlost",mr,!1),t.addEventListener("webglcontextrestored",$i,!1),t.addEventListener("webglcontextcreationerror",Hr,!1),Xe===null){let xe=["webgl2","webgl","experimental-webgl"];if(P.isWebGL1Renderer===!0&&xe.shift(),Xe=kt(xe,Ze),Xe===null)throw kt(xe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Xe.getShaderPrecisionFormat===void 0&&(Xe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ze){throw console.error("THREE.WebGLRenderer: "+Ze.message),Ze}let yt,Nt,Mt,li,Qt,Wt,Di,Ii,Li,$t,Ut,wi,Hi,lr,Ke,Re,Lt,pi,Ee,Zt,Xi,Pi,si,vi;function ki(){yt=new J0e(Xe),Nt=new Y0e(Xe,yt,e),yt.init(Nt),Pi=new Lxe(Xe,yt,Nt),Mt=new Rxe(Xe,yt,Nt),li=new i_e,Qt=new _xe,Wt=new Oxe(Xe,yt,Mt,Qt,Nt,Pi,li),Di=new $0e(P),Ii=new K0e(P),Li=new hye(Xe,Nt),si=new W0e(Xe,yt,Li,Nt),$t=new e_e(Xe,Li,li,si),Ut=new o_e(Xe,$t,Li,li),Ee=new s_e(Xe,Nt,Wt),Re=new X0e(Qt),wi=new vxe(P,Di,Ii,yt,Nt,si,Re),Hi=new Nxe(P,Qt),lr=new bxe,Ke=new Axe(yt,Nt),pi=new H0e(P,Di,Ii,Mt,Ut,x,c),Lt=new Pxe(P,Ut,Nt),vi=new Bxe(Xe,li,Nt,Mt),Zt=new q0e(Xe,yt,li,Nt),Xi=new t_e(Xe,yt,li,Nt),li.programs=wi.programs,P.capabilities=Nt,P.extensions=yt,P.properties=Qt,P.renderLists=lr,P.shadowMap=Lt,P.state=Mt,P.info=li}ki();let Jt=new kxe(P,Xe);this.xr=Jt,this.getContext=function(){return Xe},this.getContextAttributes=function(){return Xe.getContextAttributes()},this.forceContextLoss=function(){let Ze=yt.get("WEBGL_lose_context");Ze&&Ze.loseContext()},this.forceContextRestore=function(){let Ze=yt.get("WEBGL_lose_context");Ze&&Ze.restoreContext()},this.getPixelRatio=function(){return le},this.setPixelRatio=function(Ze){Ze!==void 0&&(le=Ze,this.setSize(ee,oe,!1))},this.getSize=function(Ze){return Ze.set(ee,oe)},this.setSize=function(Ze,xe,ie){if(Jt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}ee=Ze,oe=xe,t.width=Math.floor(Ze*le),t.height=Math.floor(xe*le),ie!==!1&&(t.style.width=Ze+"px",t.style.height=xe+"px"),this.setViewport(0,0,Ze,xe)},this.getDrawingBufferSize=function(Ze){return Ze.set(ee*le,oe*le).floor()},this.setDrawingBufferSize=function(Ze,xe,ie){ee=Ze,oe=xe,le=ie,t.width=Math.floor(Ze*ie),t.height=Math.floor(xe*ie),this.setViewport(0,0,Ze,xe)},this.getCurrentViewport=function(Ze){return Ze.copy(Y)},this.getViewport=function(Ze){return Ze.copy(fe)},this.setViewport=function(Ze,xe,ie,re){Ze.isVector4?fe.set(Ze.x,Ze.y,Ze.z,Ze.w):fe.set(Ze,xe,ie,re),Mt.viewport(Y.copy(fe).multiplyScalar(le).floor())},this.getScissor=function(Ze){return Ze.copy(Ue)},this.setScissor=function(Ze,xe,ie,re){Ze.isVector4?Ue.set(Ze.x,Ze.y,Ze.z,Ze.w):Ue.set(Ze,xe,ie,re),Mt.scissor(J.copy(Ue).multiplyScalar(le).floor())},this.getScissorTest=function(){return Fe},this.setScissorTest=function(Ze){Mt.setScissorTest(Fe=Ze)},this.setOpaqueSort=function(Ze){ve=Ze},this.setTransparentSort=function(Ze){we=Ze},this.getClearColor=function(Ze){return Ze.copy(pi.getClearColor())},this.setClearColor=function(){pi.setClearColor.apply(pi,arguments)},this.getClearAlpha=function(){return pi.getClearAlpha()},this.setClearAlpha=function(){pi.setClearAlpha.apply(pi,arguments)},this.clear=function(Ze=!0,xe=!0,ie=!0){let re=0;Ze&&(re|=16384),xe&&(re|=256),ie&&(re|=1024),Xe.clear(re)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",mr,!1),t.removeEventListener("webglcontextrestored",$i,!1),t.removeEventListener("webglcontextcreationerror",Hr,!1),lr.dispose(),Ke.dispose(),Qt.dispose(),Di.dispose(),Ii.dispose(),Ut.dispose(),si.dispose(),vi.dispose(),wi.dispose(),Jt.dispose(),Jt.removeEventListener("sessionstart",Ai),Jt.removeEventListener("sessionend",ir),$e&&($e.dispose(),$e=null),dr.stop()};function mr(Ze){Ze.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),O=!0}function $i(){console.log("THREE.WebGLRenderer: Context Restored."),O=!1;let Ze=li.autoReset,xe=Lt.enabled,ie=Lt.autoUpdate,re=Lt.needsUpdate,he=Lt.type;ki(),li.autoReset=Ze,Lt.enabled=xe,Lt.autoUpdate=ie,Lt.needsUpdate=re,Lt.type=he}function Hr(Ze){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Ze.statusMessage)}function Sn(Ze){let xe=Ze.target;xe.removeEventListener("dispose",Sn),kr(xe)}function kr(Ze){wt(Ze),Qt.remove(Ze)}function wt(Ze){let xe=Qt.get(Ze).programs;xe!==void 0&&(xe.forEach(function(ie){wi.releaseProgram(ie)}),Ze.isShaderMaterial&&wi.releaseShaderCache(Ze))}this.renderBufferDirect=function(Ze,xe,ie,re,he,De){xe===null&&(xe=ot);let Ie=he.isMesh&&he.matrixWorld.determinant()<0,He=Hl(Ze,xe,ie,re,he);Mt.setMaterial(re,Ie);let nt=ie.index,qe=1;re.wireframe===!0&&(nt=$t.getWireframeAttribute(ie),qe=2);let st=ie.drawRange,St=ie.attributes.position,It=st.start*qe,ni=(st.start+st.count)*qe;De!==null&&(It=Math.max(It,De.start*qe),ni=Math.min(ni,(De.start+De.count)*qe)),nt!==null?(It=Math.max(It,0),ni=Math.min(ni,nt.count)):St!=null&&(It=Math.max(It,0),ni=Math.min(ni,St.count));let Ci=ni-It;if(Ci<0||Ci===1/0)return;si.setup(he,re,He,ie,nt);let Bi,Qi=Zt;if(nt!==null&&(Bi=Li.get(nt),Qi=Xi,Qi.setIndex(Bi)),he.isMesh)re.wireframe===!0?(Mt.setLineWidth(re.wireframeLinewidth*xt()),Qi.setMode(1)):Qi.setMode(4);else if(he.isLine){let fi=re.linewidth;fi===void 0&&(fi=1),Mt.setLineWidth(fi*xt()),he.isLineSegments?Qi.setMode(1):he.isLineLoop?Qi.setMode(2):Qi.setMode(3)}else he.isPoints?Qi.setMode(0):he.isSprite&&Qi.setMode(4);if(he.isInstancedMesh)Qi.renderInstances(It,Ci,he.count);else if(ie.isInstancedBufferGeometry){let fi=ie._maxInstanceCount!==void 0?ie._maxInstanceCount:1/0,Sr=Math.min(ie.instanceCount,fi);Qi.renderInstances(It,Ci,Sr)}else Qi.render(It,Ci)},this.compile=function(Ze,xe){function ie(re,he,De){re.transparent===!0&&re.side===Wa&&re.forceSinglePass===!1?(re.side=fa,re.needsUpdate=!0,On(re,he,De),re.side=Yu,re.needsUpdate=!0,On(re,he,De),re.side=Wa):On(re,he,De)}E=Ke.get(Ze),E.init(),I.push(E),Ze.traverseVisible(function(re){re.isLight&&re.layers.test(xe.layers)&&(E.pushLight(re),re.castShadow&&E.pushShadow(re))}),E.setupLights(P.physicallyCorrectLights),Ze.traverse(function(re){let he=re.material;if(he)if(Array.isArray(he))for(let De=0;De<he.length;De++){let Ie=he[De];ie(Ie,Ze,re)}else ie(he,Ze,re)}),I.pop(),E=null};let Yt=null;function yi(Ze){Yt&&Yt(Ze)}function Ai(){dr.stop()}function ir(){dr.start()}let dr=new sK;dr.setAnimationLoop(yi),typeof self<"u"&&dr.setContext(self),this.setAnimationLoop=function(Ze){Yt=Ze,Jt.setAnimationLoop(Ze),Ze===null?dr.stop():dr.start()},Jt.addEventListener("sessionstart",Ai),Jt.addEventListener("sessionend",ir),this.render=function(Ze,xe){if(xe!==void 0&&xe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(O===!0)return;Ze.matrixWorldAutoUpdate===!0&&Ze.updateMatrixWorld(),xe.parent===null&&xe.matrixWorldAutoUpdate===!0&&xe.updateMatrixWorld(),Jt.enabled===!0&&Jt.isPresenting===!0&&(Jt.cameraAutoUpdate===!0&&Jt.updateCamera(xe),xe=Jt.getCamera()),Ze.isScene===!0&&Ze.onBeforeRender(P,Ze,xe,j),E=Ke.get(Ze,I.length),E.init(),I.push(E),rt.multiplyMatrices(xe.projectionMatrix,xe.matrixWorldInverse),Pe.setFromProjectionMatrix(rt),et=this.localClippingEnabled,Ae=Re.init(this.clippingPlanes,et),w=lr.get(Ze,A.length),w.init(),A.push(w),Rn(Ze,xe,0,P.sortObjects),w.finish(),P.sortObjects===!0&&w.sort(ve,we),Ae===!0&&Re.beginShadows();let ie=E.state.shadowsArray;if(Lt.render(ie,Ze,xe),Ae===!0&&Re.endShadows(),this.info.autoReset===!0&&this.info.reset(),pi.render(w,Ze),E.setupLights(P.physicallyCorrectLights),xe.isArrayCamera){let re=xe.cameras;for(let he=0,De=re.length;he<De;he++){let Ie=re[he];gs(w,Ze,Ie,Ie.viewport)}}else gs(w,Ze,xe);j!==null&&(Wt.updateMultisampleRenderTarget(j),Wt.updateRenderTargetMipmap(j)),Ze.isScene===!0&&Ze.onAfterRender(P,Ze,xe),si.resetDefaultState(),V=-1,$=null,I.pop(),I.length>0?E=I[I.length-1]:E=null,A.pop(),A.length>0?w=A[A.length-1]:w=null};function Rn(Ze,xe,ie,re){if(Ze.visible===!1)return;if(Ze.layers.test(xe.layers)){if(Ze.isGroup)ie=Ze.renderOrder;else if(Ze.isLOD)Ze.autoUpdate===!0&&Ze.update(xe);else if(Ze.isLight)E.pushLight(Ze),Ze.castShadow&&E.pushShadow(Ze);else if(Ze.isSprite){if(!Ze.frustumCulled||Pe.intersectsSprite(Ze)){re&&bt.setFromMatrixPosition(Ze.matrixWorld).applyMatrix4(rt);let De=Ut.update(Ze),Ie=Ze.material;Ie.visible&&w.push(Ze,De,Ie,ie,bt.z,null)}}else if((Ze.isMesh||Ze.isLine||Ze.isPoints)&&(Ze.isSkinnedMesh&&Ze.skeleton.frame!==li.render.frame&&(Ze.skeleton.update(),Ze.skeleton.frame=li.render.frame),!Ze.frustumCulled||Pe.intersectsObject(Ze))){re&&bt.setFromMatrixPosition(Ze.matrixWorld).applyMatrix4(rt);let De=Ut.update(Ze),Ie=Ze.material;if(Array.isArray(Ie)){let He=De.groups;for(let nt=0,qe=He.length;nt<qe;nt++){let st=He[nt],St=Ie[st.materialIndex];St&&St.visible&&w.push(Ze,De,St,ie,bt.z,st)}}else Ie.visible&&w.push(Ze,De,Ie,ie,bt.z,null)}}let he=Ze.children;for(let De=0,Ie=he.length;De<Ie;De++)Rn(he[De],xe,ie,re)}function gs(Ze,xe,ie,re){let he=Ze.opaque,De=Ze.transmissive,Ie=Ze.transparent;E.setupLightsView(ie),Ae===!0&&Re.setGlobalState(P.clippingPlanes,ie),De.length>0&&ks(he,xe,ie),re&&Mt.viewport(Y.copy(re)),he.length>0&&Xn(he,xe,ie),De.length>0&&Xn(De,xe,ie),Ie.length>0&&Xn(Ie,xe,ie),Mt.buffers.depth.setTest(!0),Mt.buffers.depth.setMask(!0),Mt.buffers.color.setMask(!0),Mt.setPolygonOffset(!1)}function ks(Ze,xe,ie){let re=Nt.isWebGL2;$e===null&&($e=new Zn(1,1,{generateMipmaps:!0,type:yt.has("EXT_color_buffer_half_float")?wp:$a,minFilter:ax,samples:re&&n===!0?4:0})),P.getDrawingBufferSize(Je),re?$e.setSize(Je.x,Je.y):$e.setSize(_D(Je.x),_D(Je.y));let he=P.getRenderTarget();P.setRenderTarget($e),P.clear();let De=P.toneMapping;P.toneMapping=Zh,Xn(Ze,xe,ie),P.toneMapping=De,Wt.updateMultisampleRenderTarget($e),Wt.updateRenderTargetMipmap($e),P.setRenderTarget(he)}function Xn(Ze,xe,ie){let re=xe.isScene===!0?xe.overrideMaterial:null;for(let he=0,De=Ze.length;he<De;he++){let Ie=Ze[he],He=Ie.object,nt=Ie.geometry,qe=re===null?Ie.material:re,st=Ie.group;He.layers.test(ie.layers)&&ys(He,xe,ie,nt,qe,st)}}function ys(Ze,xe,ie,re,he,De){Ze.onBeforeRender(P,xe,ie,re,he,De),Ze.modelViewMatrix.multiplyMatrices(ie.matrixWorldInverse,Ze.matrixWorld),Ze.normalMatrix.getNormalMatrix(Ze.modelViewMatrix),he.onBeforeRender(P,xe,ie,re,Ze,De),he.transparent===!0&&he.side===Wa&&he.forceSinglePass===!1?(he.side=fa,he.needsUpdate=!0,P.renderBufferDirect(ie,xe,re,he,Ze,De),he.side=Yu,he.needsUpdate=!0,P.renderBufferDirect(ie,xe,re,he,Ze,De),he.side=Wa):P.renderBufferDirect(ie,xe,re,he,Ze,De),Ze.onAfterRender(P,xe,ie,re,he,De)}function On(Ze,xe,ie){xe.isScene!==!0&&(xe=ot);let re=Qt.get(Ze),he=E.state.lights,De=E.state.shadowsArray,Ie=he.state.version,He=wi.getParameters(Ze,he.state,De,xe,ie),nt=wi.getProgramCacheKey(He),qe=re.programs;re.environment=Ze.isMeshStandardMaterial?xe.environment:null,re.fog=xe.fog,re.envMap=(Ze.isMeshStandardMaterial?Ii:Di).get(Ze.envMap||re.environment),qe===void 0&&(Ze.addEventListener("dispose",Sn),qe=new Map,re.programs=qe);let st=qe.get(nt);if(st!==void 0){if(re.currentProgram===st&&re.lightsStateVersion===Ie)return vc(Ze,He),st}else He.uniforms=wi.getUniforms(Ze),Ze.onBuild(ie,He,P),Ze.onBeforeCompile(He,P),st=wi.acquireProgram(He,nt),qe.set(nt,st),re.uniforms=He.uniforms;let St=re.uniforms;(!Ze.isShaderMaterial&&!Ze.isRawShaderMaterial||Ze.clipping===!0)&&(St.clippingPlanes=Re.uniform),vc(Ze,He),re.needsLights=cs(Ze),re.lightsStateVersion=Ie,re.needsLights&&(St.ambientLightColor.value=he.state.ambient,St.lightProbe.value=he.state.probe,St.directionalLights.value=he.state.directional,St.directionalLightShadows.value=he.state.directionalShadow,St.spotLights.value=he.state.spot,St.spotLightShadows.value=he.state.spotShadow,St.rectAreaLights.value=he.state.rectArea,St.ltc_1.value=he.state.rectAreaLTC1,St.ltc_2.value=he.state.rectAreaLTC2,St.pointLights.value=he.state.point,St.pointLightShadows.value=he.state.pointShadow,St.hemisphereLights.value=he.state.hemi,St.directionalShadowMap.value=he.state.directionalShadowMap,St.directionalShadowMatrix.value=he.state.directionalShadowMatrix,St.spotShadowMap.value=he.state.spotShadowMap,St.spotLightMatrix.value=he.state.spotLightMatrix,St.spotLightMap.value=he.state.spotLightMap,St.pointShadowMap.value=he.state.pointShadowMap,St.pointShadowMatrix.value=he.state.pointShadowMatrix);let It=st.getUniforms(),ni=Q2.seqWithValue(It.seq,St);return re.currentProgram=st,re.uniformsList=ni,st}function vc(Ze,xe){let ie=Qt.get(Ze);ie.outputEncoding=xe.outputEncoding,ie.instancing=xe.instancing,ie.skinning=xe.skinning,ie.morphTargets=xe.morphTargets,ie.morphNormals=xe.morphNormals,ie.morphColors=xe.morphColors,ie.morphTargetsCount=xe.morphTargetsCount,ie.numClippingPlanes=xe.numClippingPlanes,ie.numIntersection=xe.numClipIntersection,ie.vertexAlphas=xe.vertexAlphas,ie.vertexTangents=xe.vertexTangents,ie.toneMapping=xe.toneMapping}function Hl(Ze,xe,ie,re,he){xe.isScene!==!0&&(xe=ot),Wt.resetTextureUnits();let De=xe.fog,Ie=re.isMeshStandardMaterial?xe.environment:null,He=j===null?P.outputEncoding:j.isXRRenderTarget===!0?j.texture.encoding:Xu,nt=(re.isMeshStandardMaterial?Ii:Di).get(re.envMap||Ie),qe=re.vertexColors===!0&&!!ie.attributes.color&&ie.attributes.color.itemSize===4,st=!!re.normalMap&&!!ie.attributes.tangent,St=!!ie.morphAttributes.position,It=!!ie.morphAttributes.normal,ni=!!ie.morphAttributes.color,Ci=re.toneMapped?P.toneMapping:Zh,Bi=ie.morphAttributes.position||ie.morphAttributes.normal||ie.morphAttributes.color,Qi=Bi!==void 0?Bi.length:0,fi=Qt.get(re),Sr=E.state.lights;if(Ae===!0&&(et===!0||Ze!==$)){let _n=Ze===$&&re.id===V;Re.setState(re,Ze,_n)}let _i=!1;re.version===fi.__version?(fi.needsLights&&fi.lightsStateVersion!==Sr.state.version||fi.outputEncoding!==He||he.isInstancedMesh&&fi.instancing===!1||!he.isInstancedMesh&&fi.instancing===!0||he.isSkinnedMesh&&fi.skinning===!1||!he.isSkinnedMesh&&fi.skinning===!0||fi.envMap!==nt||re.fog===!0&&fi.fog!==De||fi.numClippingPlanes!==void 0&&(fi.numClippingPlanes!==Re.numPlanes||fi.numIntersection!==Re.numIntersection)||fi.vertexAlphas!==qe||fi.vertexTangents!==st||fi.morphTargets!==St||fi.morphNormals!==It||fi.morphColors!==ni||fi.toneMapping!==Ci||Nt.isWebGL2===!0&&fi.morphTargetsCount!==Qi)&&(_i=!0):(_i=!0,fi.__version=re.version);let un=fi.currentProgram;_i===!0&&(un=On(re,xe,he));let qi=!1,vr=!1,qn=!1,Zr=un.getUniforms(),Yn=fi.uniforms;if(Mt.useProgram(un.program)&&(qi=!0,vr=!0,qn=!0),re.id!==V&&(V=re.id,vr=!0),qi||$!==Ze){if(Zr.setValue(Xe,"projectionMatrix",Ze.projectionMatrix),Nt.logarithmicDepthBuffer&&Zr.setValue(Xe,"logDepthBufFC",2/(Math.log(Ze.far+1)/Math.LN2)),$!==Ze&&($=Ze,vr=!0,qn=!0),re.isShaderMaterial||re.isMeshPhongMaterial||re.isMeshToonMaterial||re.isMeshStandardMaterial||re.envMap){let _n=Zr.map.cameraPosition;_n!==void 0&&_n.setValue(Xe,bt.setFromMatrixPosition(Ze.matrixWorld))}(re.isMeshPhongMaterial||re.isMeshToonMaterial||re.isMeshLambertMaterial||re.isMeshBasicMaterial||re.isMeshStandardMaterial||re.isShaderMaterial)&&Zr.setValue(Xe,"isOrthographic",Ze.isOrthographicCamera===!0),(re.isMeshPhongMaterial||re.isMeshToonMaterial||re.isMeshLambertMaterial||re.isMeshBasicMaterial||re.isMeshStandardMaterial||re.isShaderMaterial||re.isShadowMaterial||he.isSkinnedMesh)&&Zr.setValue(Xe,"viewMatrix",Ze.matrixWorldInverse)}if(he.isSkinnedMesh){Zr.setOptional(Xe,he,"bindMatrix"),Zr.setOptional(Xe,he,"bindMatrixInverse");let _n=he.skeleton;_n&&(Nt.floatVertexTextures?(_n.boneTexture===null&&_n.computeBoneTexture(),Zr.setValue(Xe,"boneTexture",_n.boneTexture,Wt),Zr.setValue(Xe,"boneTextureSize",_n.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let Ss=ie.morphAttributes;if((Ss.position!==void 0||Ss.normal!==void 0||Ss.color!==void 0&&Nt.isWebGL2===!0)&&Ee.update(he,ie,re,un),(vr||fi.receiveShadow!==he.receiveShadow)&&(fi.receiveShadow=he.receiveShadow,Zr.setValue(Xe,"receiveShadow",he.receiveShadow)),re.isMeshGouraudMaterial&&re.envMap!==null&&(Yn.envMap.value=nt,Yn.flipEnvMap.value=nt.isCubeTexture&&nt.isRenderTargetTexture===!1?-1:1),vr&&(Zr.setValue(Xe,"toneMappingExposure",P.toneMappingExposure),fi.needsLights&&_c(Yn,qn),De&&re.fog===!0&&Hi.refreshFogUniforms(Yn,De),Hi.refreshMaterialUniforms(Yn,re,le,oe,$e),Q2.upload(Xe,fi.uniformsList,Yn,Wt)),re.isShaderMaterial&&re.uniformsNeedUpdate===!0&&(Q2.upload(Xe,fi.uniformsList,Yn,Wt),re.uniformsNeedUpdate=!1),re.isSpriteMaterial&&Zr.setValue(Xe,"center",he.center),Zr.setValue(Xe,"modelViewMatrix",he.modelViewMatrix),Zr.setValue(Xe,"normalMatrix",he.normalMatrix),Zr.setValue(Xe,"modelMatrix",he.matrixWorld),he.previousModelViewMatrix&&Zr.setValue(Xe,"previousModelViewMatrix",he.previousModelViewMatrix),Ze.previousProjectionMatrix&&Zr.setValue(Xe,"previousProjectionMatrix",Ze.previousProjectionMatrix),re.isShaderMaterial||re.isRawShaderMaterial){let _n=re.uniformsGroups;for(let Br=0,cd=_n.length;Br<cd;Br++)if(Nt.isWebGL2){let Wl=_n[Br];vi.update(Wl,un),vi.bind(Wl,un)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return un}function _c(Ze,xe){Ze.ambientLightColor.needsUpdate=xe,Ze.lightProbe.needsUpdate=xe,Ze.directionalLights.needsUpdate=xe,Ze.directionalLightShadows.needsUpdate=xe,Ze.pointLights.needsUpdate=xe,Ze.pointLightShadows.needsUpdate=xe,Ze.spotLights.needsUpdate=xe,Ze.spotLightShadows.needsUpdate=xe,Ze.rectAreaLights.needsUpdate=xe,Ze.hemisphereLights.needsUpdate=xe}function cs(Ze){return Ze.isMeshLambertMaterial||Ze.isMeshToonMaterial||Ze.isMeshPhongMaterial||Ze.isMeshStandardMaterial||Ze.isShadowMaterial||Ze.isShaderMaterial&&Ze.lights===!0}this.getActiveCubeFace=function(){return k},this.getActiveMipmapLevel=function(){return U},this.getRenderTarget=function(){return j},this.setRenderTargetTextures=function(Ze,xe,ie){Qt.get(Ze.texture).__webglTexture=xe,Qt.get(Ze.depthTexture).__webglTexture=ie;let re=Qt.get(Ze);re.__hasExternalTextures=!0,re.__hasExternalTextures&&(re.__autoAllocateDepthBuffer=ie===void 0,re.__autoAllocateDepthBuffer||yt.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),re.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Ze,xe){let ie=Qt.get(Ze);ie.__webglFramebuffer=xe,ie.__useDefaultFramebuffer=xe===void 0},this.setRenderTarget=function(Ze,xe=0,ie=0){j=Ze,k=xe,U=ie;let re=!0,he=null,De=!1,Ie=!1;if(Ze){let He=Qt.get(Ze);He.__useDefaultFramebuffer!==void 0?(Mt.bindFramebuffer(36160,null),re=!1):He.__webglFramebuffer===void 0?Wt.setupRenderTarget(Ze):He.__hasExternalTextures&&Wt.rebindTextures(Ze,Qt.get(Ze.texture).__webglTexture,Qt.get(Ze.depthTexture).__webglTexture);let nt=Ze.texture;(nt.isData3DTexture||nt.isDataArrayTexture||nt.isCompressedArrayTexture)&&(Ie=!0);let qe=Qt.get(Ze).__webglFramebuffer;Ze.isWebGLCubeRenderTarget?(he=qe[xe],De=!0):Nt.isWebGL2&&Ze.samples>0&&Wt.useMultisampledRTT(Ze)===!1?he=Qt.get(Ze).__webglMultisampledFramebuffer:he=qe,Y.copy(Ze.viewport),J.copy(Ze.scissor),X=Ze.scissorTest}else Y.copy(fe).multiplyScalar(le).floor(),J.copy(Ue).multiplyScalar(le).floor(),X=Fe;if(Mt.bindFramebuffer(36160,he)&&Nt.drawBuffers&&re&&Mt.drawBuffers(Ze,he),Mt.viewport(Y),Mt.scissor(J),Mt.setScissorTest(X),De){let He=Qt.get(Ze.texture);Xe.framebufferTexture2D(36160,36064,34069+xe,He.__webglTexture,ie)}else if(Ie){let He=Qt.get(Ze.texture),nt=xe||0;Xe.framebufferTextureLayer(36160,36064,He.__webglTexture,ie||0,nt)}V=-1},this.readRenderTargetPixels=function(Ze,xe,ie,re,he,De,Ie){if(!(Ze&&Ze.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let He=Qt.get(Ze).__webglFramebuffer;if(Ze.isWebGLCubeRenderTarget&&Ie!==void 0&&(He=He[Ie]),He){Mt.bindFramebuffer(36160,He);try{let nt=Ze.texture,qe=nt.format,st=nt.type;if(qe!==da&&Pi.convert(qe)!==Xe.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let St=st===wp&&(yt.has("EXT_color_buffer_half_float")||Nt.isWebGL2&&yt.has("EXT_color_buffer_float"));if(st!==$a&&Pi.convert(st)!==Xe.getParameter(35738)&&!(st===To&&(Nt.isWebGL2||yt.has("OES_texture_float")||yt.has("WEBGL_color_buffer_float")))&&!St){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}xe>=0&&xe<=Ze.width-re&&ie>=0&&ie<=Ze.height-he&&Xe.readPixels(xe,ie,re,he,Pi.convert(qe),Pi.convert(st),De)}finally{let nt=j!==null?Qt.get(j).__webglFramebuffer:null;Mt.bindFramebuffer(36160,nt)}}},this.copyFramebufferToTexture=function(Ze,xe,ie=0){let re=Math.pow(2,-ie),he=Math.floor(xe.image.width*re),De=Math.floor(xe.image.height*re);Wt.setTexture2D(xe,0),Xe.copyTexSubImage2D(3553,ie,0,0,Ze.x,Ze.y,he,De),Mt.unbindTexture()},this.copyTextureToTexture=function(Ze,xe,ie,re=0){let he=xe.image.width,De=xe.image.height,Ie=Pi.convert(ie.format),He=Pi.convert(ie.type);Wt.setTexture2D(ie,0),Xe.pixelStorei(37440,ie.flipY),Xe.pixelStorei(37441,ie.premultiplyAlpha),Xe.pixelStorei(3317,ie.unpackAlignment),xe.isDataTexture?Xe.texSubImage2D(3553,re,Ze.x,Ze.y,he,De,Ie,He,xe.image.data):xe.isCompressedTexture?Xe.compressedTexSubImage2D(3553,re,Ze.x,Ze.y,xe.mipmaps[0].width,xe.mipmaps[0].height,Ie,xe.mipmaps[0].data):Xe.texSubImage2D(3553,re,Ze.x,Ze.y,Ie,He,xe.image),re===0&&ie.generateMipmaps&&Xe.generateMipmap(3553),Mt.unbindTexture()},this.copyTextureToTexture3D=function(Ze,xe,ie,re,he=0){if(P.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let De=Ze.max.x-Ze.min.x+1,Ie=Ze.max.y-Ze.min.y+1,He=Ze.max.z-Ze.min.z+1,nt=Pi.convert(re.format),qe=Pi.convert(re.type),st;if(re.isData3DTexture)Wt.setTexture3D(re,0),st=32879;else if(re.isDataArrayTexture)Wt.setTexture2DArray(re,0),st=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Xe.pixelStorei(37440,re.flipY),Xe.pixelStorei(37441,re.premultiplyAlpha),Xe.pixelStorei(3317,re.unpackAlignment);let St=Xe.getParameter(3314),It=Xe.getParameter(32878),ni=Xe.getParameter(3316),Ci=Xe.getParameter(3315),Bi=Xe.getParameter(32877),Qi=ie.isCompressedTexture?ie.mipmaps[0]:ie.image;Xe.pixelStorei(3314,Qi.width),Xe.pixelStorei(32878,Qi.height),Xe.pixelStorei(3316,Ze.min.x),Xe.pixelStorei(3315,Ze.min.y),Xe.pixelStorei(32877,Ze.min.z),ie.isDataTexture||ie.isData3DTexture?Xe.texSubImage3D(st,he,xe.x,xe.y,xe.z,De,Ie,He,nt,qe,Qi.data):ie.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Xe.compressedTexSubImage3D(st,he,xe.x,xe.y,xe.z,De,Ie,He,nt,Qi.data)):Xe.texSubImage3D(st,he,xe.x,xe.y,xe.z,De,Ie,He,nt,qe,Qi),Xe.pixelStorei(3314,St),Xe.pixelStorei(32878,It),Xe.pixelStorei(3316,ni),Xe.pixelStorei(3315,Ci),Xe.pixelStorei(32877,Bi),he===0&&re.generateMipmaps&&Xe.generateMipmap(st),Mt.unbindTexture()},this.initTexture=function(Ze){Ze.isCubeTexture?Wt.setTextureCube(Ze,0):Ze.isData3DTexture?Wt.setTexture3D(Ze,0):Ze.isDataArrayTexture||Ze.isCompressedArrayTexture?Wt.setTexture2DArray(Ze,0):Wt.setTexture2D(Ze,0),Mt.unbindTexture()},this.resetState=function(){k=0,U=0,j=null,Mt.reset(),si.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var jxe=class extends hK{};jxe.prototype.isWebGL1Renderer=!0;var dK=class{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new Tr(e),this.near=t,this.far=i}clone(){return new dK(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},Qh=class extends ls{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}},Vxe=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=dN,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Zc()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Zc()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Zc()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},pl=new se,gN=class{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)pl.fromBufferAttribute(this,t),pl.applyMatrix4(e),this.setXYZ(t,pl.x,pl.y,pl.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)pl.fromBufferAttribute(this,t),pl.applyNormalMatrix(e),this.setXYZ(t,pl.x,pl.y,pl.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)pl.fromBufferAttribute(this,t),pl.transformDirection(e),this.setXYZ(t,pl.x,pl.y,pl.z);return this}setX(e,t){return this.normalized&&(t=Cs(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Cs(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Cs(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Cs(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=mp(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=mp(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=mp(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=mp(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Cs(t,this.array),i=Cs(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Cs(t,this.array),i=Cs(i,this.array),r=Cs(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Cs(t,this.array),i=Cs(i,this.array),r=Cs(r,this.array),s=Cs(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new Fr(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new gN(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},pK=class extends ls{constructor(){super(),this.isBone=!0,this.type="Bone"}},$c=class extends Zs{constructor(e=null,t=1,i=1,r,s,n,c,u,p=ns,f=ns,x,w){super(null,n,c,u,p,f,r,s,x,w),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},G7=new mi,Gxe=new mi,v4=class{constructor(e=[],t=[]){this.uuid=Zc(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new mi)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let i=new mi;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,n=e.length;s<n;s++){let c=e[s]?e[s].matrixWorld:Gxe;G7.multiplyMatrices(c,t[s]),G7.toArray(i,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new v4(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=QQ(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let i=new $c(t,e,e,da,To);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){let s=e.bones[i],n=t[s];n===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),n=new pK),this.bones.push(n),this.boneInverses.push(new mi().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let r=0,s=t.length;r<s;r++){let n=t[r];e.bones.push(n.uuid);let c=i[r];e.boneInverses.push(c.toArray())}return e}},_S=class extends Fr{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},H7=new mi,W7=new mi,qC=[],Hxe=new mi,Mw=new $s,Wxe=class extends $s{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new _S(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let r=0;r<i;r++)this.setMatrixAt(r,Hxe)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let i=this.matrixWorld,r=this.count;if(Mw.geometry=this.geometry,Mw.material=this.material,Mw.material!==void 0)for(let s=0;s<r;s++){this.getMatrixAt(s,H7),W7.multiplyMatrices(i,H7),Mw.matrixWorld=W7,Mw.raycast(e,qC);for(let n=0,c=qC.length;n<c;n++){let u=qC[n];u.instanceId=s,u.object=this,t.push(u)}qC.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new _S(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},bm=class extends jS{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Tr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},q7=new se,Y7=new se,X7=new mi,LF=new Sx,YC=new jl,xD=class extends ls{constructor(e=new fr,t=new bm){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)q7.fromBufferAttribute(t,r-1),Y7.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=q7.distanceTo(Y7);e.setAttribute("lineDistance",new Vi(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,n=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),YC.copy(i.boundingSphere),YC.applyMatrix4(r),YC.radius+=s,e.ray.intersectsSphere(YC)===!1)return;X7.copy(r).invert(),LF.copy(e.ray).applyMatrix4(X7);let c=s/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,p=new se,f=new se,x=new se,w=new se,E=this.isLineSegments?2:1,A=i.index,I=i.attributes.position;if(A!==null){let P=Math.max(0,n.start),O=Math.min(A.count,n.start+n.count);for(let k=P,U=O-1;k<U;k+=E){let j=A.getX(k),V=A.getX(k+1);if(p.fromBufferAttribute(I,j),f.fromBufferAttribute(I,V),LF.distanceSqToSegment(p,f,w,x)>u)continue;w.applyMatrix4(this.matrixWorld);let $=e.ray.origin.distanceTo(w);$<e.near||$>e.far||t.push({distance:$,point:x.clone().applyMatrix4(this.matrixWorld),index:k,face:null,faceIndex:null,object:this})}}else{let P=Math.max(0,n.start),O=Math.min(I.count,n.start+n.count);for(let k=P,U=O-1;k<U;k+=E){if(p.fromBufferAttribute(I,k),f.fromBufferAttribute(I,k+1),LF.distanceSqToSegment(p,f,w,x)>u)continue;w.applyMatrix4(this.matrixWorld);let j=e.ray.origin.distanceTo(w);j<e.near||j>e.far||t.push({distance:j,point:x.clone().applyMatrix4(this.matrixWorld),index:k,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let n=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=r}}}}},$7=new se,Z7=new se,VS=class extends xD{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[];for(let r=0,s=t.count;r<s;r+=2)$7.fromBufferAttribute(t,r),Z7.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+$7.distanceTo(Z7);e.setAttribute("lineDistance",new Vi(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},qxe=class extends Zs{constructor(e,t,i,r,s,n,c,u,p){super(e,t,i,r,s,n,c,u,p),this.isVideoTexture=!0,this.minFilter=n!==void 0?n:cn,this.magFilter=s!==void 0?s:cn,this.generateMipmaps=!1;let f=this;function x(){f.needsUpdate=!0,e.requestVideoFrameCallback(x)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(x)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},Yxe=class extends Zs{constructor(e,t,i,r,s,n,c,u,p){super(e,t,i,r,s,n,c,u,p),this.isCanvasTexture=!0,this.needsUpdate=!0}},nd=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,r=this.getPoint(0),s=0;t.push(0);for(let n=1;n<=e;n++)i=this.getPoint(n/e),s+=i.distanceTo(r),t.push(s),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i=this.getLengths(),r=0,s=i.length,n;t?n=t:n=e*i[s-1];let c=0,u=s-1,p;for(;c<=u;)if(r=Math.floor(c+(u-c)/2),p=i[r]-n,p<0)c=r+1;else if(p>0)u=r-1;else{u=r;break}if(r=u,i[r]===n)return r/(s-1);let f=i[r],x=i[r+1]-f,w=(n-f)/x;return(r+w)/(s-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);let s=this.getPoint(i),n=this.getPoint(r),c=t||(s.isVector2?new lt:new se);return c.copy(n).sub(s).normalize(),c}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new se,r=[],s=[],n=[],c=new se,u=new mi;for(let E=0;E<=e;E++){let A=E/e;r[E]=this.getTangentAt(A,new se)}s[0]=new se,n[0]=new se;let p=Number.MAX_VALUE,f=Math.abs(r[0].x),x=Math.abs(r[0].y),w=Math.abs(r[0].z);f<=p&&(p=f,i.set(1,0,0)),x<=p&&(p=x,i.set(0,1,0)),w<=p&&i.set(0,0,1),c.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],c),n[0].crossVectors(r[0],s[0]);for(let E=1;E<=e;E++){if(s[E]=s[E-1].clone(),n[E]=n[E-1].clone(),c.crossVectors(r[E-1],r[E]),c.length()>Number.EPSILON){c.normalize();let A=Math.acos(Eo(r[E-1].dot(r[E]),-1,1));s[E].applyMatrix4(u.makeRotationAxis(c,A))}n[E].crossVectors(r[E],s[E])}if(t===!0){let E=Math.acos(Eo(s[0].dot(s[e]),-1,1));E/=e,r[0].dot(c.crossVectors(s[0],s[e]))>0&&(E=-E);for(let A=1;A<=e;A++)s[A].applyMatrix4(u.makeRotationAxis(r[A],E*A)),n[A].crossVectors(r[A],s[A])}return{tangents:r,normals:s,binormals:n}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},xI=class extends nd{constructor(e=0,t=0,i=1,r=1,s=0,n=Math.PI*2,c=!1,u=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=n,this.aClockwise=c,this.aRotation=u}getPoint(e,t){let i=t||new lt,r=Math.PI*2,s=this.aEndAngle-this.aStartAngle,n=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(n?s=0:s=r),this.aClockwise===!0&&!n&&(s===r?s=-r:s=s-r);let c=this.aStartAngle+e*s,u=this.aX+this.xRadius*Math.cos(c),p=this.aY+this.yRadius*Math.sin(c);if(this.aRotation!==0){let f=Math.cos(this.aRotation),x=Math.sin(this.aRotation),w=u-this.aX,E=p-this.aY;u=w*f-E*x+this.aX,p=w*x+E*f+this.aY}return i.set(u,p)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},Xxe=class extends xI{constructor(e,t,i,r,s,n){super(e,t,i,i,r,s,n),this.isArcCurve=!0,this.type="ArcCurve"}};function _4(){let e=0,t=0,i=0,r=0;function s(n,c,u,p){e=n,t=u,i=-3*n+3*c-2*u-p,r=2*n-2*c+u+p}return{initCatmullRom:function(n,c,u,p,f){s(c,u,f*(u-n),f*(p-c))},initNonuniformCatmullRom:function(n,c,u,p,f,x,w){let E=(c-n)/f-(u-n)/(f+x)+(u-c)/x,A=(u-c)/x-(p-c)/(x+w)+(p-u)/w;E*=x,A*=x,s(c,u,E,A)},calc:function(n){let c=n*n,u=c*n;return e+t*n+i*c+r*u}}}var XC=new se,zF=new _4,FF=new _4,kF=new _4,$xe=class extends nd{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new se){let i=t,r=this.points,s=r.length,n=(s-(this.closed?0:1))*e,c=Math.floor(n),u=n-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/s)+1)*s:u===0&&c===s-1&&(c=s-2,u=1);let p,f;this.closed||c>0?p=r[(c-1)%s]:(XC.subVectors(r[0],r[1]).add(r[0]),p=XC);let x=r[c%s],w=r[(c+1)%s];if(this.closed||c+2<s?f=r[(c+2)%s]:(XC.subVectors(r[s-1],r[s-2]).add(r[s-1]),f=XC),this.curveType==="centripetal"||this.curveType==="chordal"){let E=this.curveType==="chordal"?.5:.25,A=Math.pow(p.distanceToSquared(x),E),I=Math.pow(x.distanceToSquared(w),E),P=Math.pow(w.distanceToSquared(f),E);I<1e-4&&(I=1),A<1e-4&&(A=I),P<1e-4&&(P=I),zF.initNonuniformCatmullRom(p.x,x.x,w.x,f.x,A,I,P),FF.initNonuniformCatmullRom(p.y,x.y,w.y,f.y,A,I,P),kF.initNonuniformCatmullRom(p.z,x.z,w.z,f.z,A,I,P)}else this.curveType==="catmullrom"&&(zF.initCatmullRom(p.x,x.x,w.x,f.x,this.tension),FF.initCatmullRom(p.y,x.y,w.y,f.y,this.tension),kF.initCatmullRom(p.z,x.z,w.z,f.z,this.tension));return i.set(zF.calc(u),FF.calc(u),kF.calc(u)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new se().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function Q7(e,t,i,r,s){let n=(r-t)*.5,c=(s-i)*.5,u=e*e,p=e*u;return(2*i-2*r+n+c)*p+(-3*i+3*r-2*n-c)*u+n*e+i}function Zxe(e,t){let i=1-e;return i*i*t}function Qxe(e,t){return 2*(1-e)*e*t}function Kxe(e,t){return e*e*t}function oS(e,t,i,r){return Zxe(e,t)+Qxe(e,i)+Kxe(e,r)}function Jxe(e,t){let i=1-e;return i*i*i*t}function e1e(e,t){let i=1-e;return 3*i*i*e*t}function t1e(e,t){return 3*(1-e)*e*e*t}function i1e(e,t){return e*e*e*t}function aS(e,t,i,r,s){return Jxe(e,t)+e1e(e,i)+t1e(e,r)+i1e(e,s)}var Vu=class extends nd{constructor(e=new lt,t=new lt,i=new lt,r=new lt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new lt){let i=t,r=this.v0,s=this.v1,n=this.v2,c=this.v3;return i.set(aS(e,r.x,s.x,n.x,c.x),aS(e,r.y,s.y,n.y,c.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},K2=class extends nd{constructor(e=new se,t=new se,i=new se,r=new se){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new se){let i=t,r=this.v0,s=this.v1,n=this.v2,c=this.v3;return i.set(aS(e,r.x,s.x,n.x,c.x),aS(e,r.y,s.y,n.y,c.y),aS(e,r.z,s.z,n.z,c.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},qu=class extends nd{constructor(e=new lt,t=new lt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new lt){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let i=t||new lt;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},fK=class extends nd{constructor(e=new se,t=new se){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new se){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},ym=class extends nd{constructor(e=new lt,t=new lt,i=new lt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new lt){let i=t,r=this.v0,s=this.v1,n=this.v2;return i.set(oS(e,r.x,s.x,n.x),oS(e,r.y,s.y,n.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},r1e=class extends nd{constructor(e=new se,t=new se,i=new se){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new se){let i=t,r=this.v0,s=this.v1,n=this.v2;return i.set(oS(e,r.x,s.x,n.x),oS(e,r.y,s.y,n.y),oS(e,r.z,s.z,n.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},x4=class extends nd{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new lt){let i=t,r=this.points,s=(r.length-1)*e,n=Math.floor(s),c=s-n,u=r[n===0?n:n-1],p=r[n],f=r[n>r.length-2?r.length-1:n+1],x=r[n>r.length-3?r.length-1:n+2];return i.set(Q7(c,u.x,p.x,f.x,x.x),Q7(c,u.y,p.y,f.y,x.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new lt().fromArray(r))}return this}},n1e=Object.freeze({__proto__:null,ArcCurve:Xxe,CatmullRomCurve3:$xe,CubicBezierCurve:Vu,CubicBezierCurve3:K2,EllipseCurve:xI,LineCurve:qu,LineCurve3:fK,QuadraticBezierCurve:ym,QuadraticBezierCurve3:r1e,SplineCurve:x4}),mK=class extends nd{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new qu(t,e))}getPoint(e,t){let i=e*this.getLength(),r=this.getCurveLengths(),s=0;for(;s<r.length;){if(r[s]>=i){let n=r[s]-i,c=this.curves[s],u=c.getLength(),p=u===0?0:1-n/u;return c.getPointAt(p,t)}s++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],i;for(let r=0,s=this.curves;r<s.length;r++){let n=s[r],c=n.isEllipseCurve?e*2:n.isLineCurve||n.isLineCurve3?1:n.isSplineCurve?e*n.points.length:e,u=n.getPoints(c);for(let p=0;p<u.length;p++){let f=u[p];i&&i.equals(f)||(t.push(f),i=f)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(new n1e[r.type]().fromJSON(r))}return this}},bD=class extends mK{constructor(e){super(),this.type="Path",this.currentPoint=new lt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new qu(this.currentPoint.clone(),new lt(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){let s=new ym(this.currentPoint.clone(),new lt(e,t),new lt(i,r));return this.curves.push(s),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,s,n){let c=new Vu(this.currentPoint.clone(),new lt(e,t),new lt(i,r),new lt(s,n));return this.curves.push(c),this.currentPoint.set(s,n),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new x4(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,s,n){let c=this.currentPoint.x,u=this.currentPoint.y;return this.absarc(e+c,t+u,i,r,s,n),this}absarc(e,t,i,r,s,n){return this.absellipse(e,t,i,i,r,s,n),this}ellipse(e,t,i,r,s,n,c,u){let p=this.currentPoint.x,f=this.currentPoint.y;return this.absellipse(e+p,t+f,i,r,s,n,c,u),this}absellipse(e,t,i,r,s,n,c,u){let p=new xI(e,t,i,r,s,n,c,u);if(this.curves.length>0){let x=p.getPoint(0);x.equals(this.currentPoint)||this.lineTo(x.x,x.y)}this.curves.push(p);let f=p.getPoint(1);return this.currentPoint.copy(f),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},gK=class extends fr{constructor(e=[new lt(0,-.5),new lt(.5,0),new lt(0,.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=Eo(r,0,Math.PI*2);let s=[],n=[],c=[],u=[],p=[],f=1/t,x=new se,w=new lt,E=new se,A=new se,I=new se,P=0,O=0;for(let k=0;k<=e.length-1;k++)switch(k){case 0:P=e[k+1].x-e[k].x,O=e[k+1].y-e[k].y,E.x=O*1,E.y=-P,E.z=O*0,I.copy(E),E.normalize(),u.push(E.x,E.y,E.z);break;case e.length-1:u.push(I.x,I.y,I.z);break;default:P=e[k+1].x-e[k].x,O=e[k+1].y-e[k].y,E.x=O*1,E.y=-P,E.z=O*0,A.copy(E),E.x+=I.x,E.y+=I.y,E.z+=I.z,E.normalize(),u.push(E.x,E.y,E.z),I.copy(A)}for(let k=0;k<=t;k++){let U=i+k*f*r,j=Math.sin(U),V=Math.cos(U);for(let $=0;$<=e.length-1;$++){x.x=e[$].x*j,x.y=e[$].y,x.z=e[$].x*V,n.push(x.x,x.y,x.z),w.x=k/t,w.y=$/(e.length-1),c.push(w.x,w.y);let Y=u[3*$+0]*j,J=u[3*$+1],X=u[3*$+0]*V;p.push(Y,J,X)}}for(let k=0;k<t;k++)for(let U=0;U<e.length-1;U++){let j=U+k*e.length,V=j,$=j+e.length,Y=j+e.length+1,J=j+1;s.push(V,$,J),s.push(Y,J,$)}this.setIndex(s),this.setAttribute("position",new Vi(n,3)),this.setAttribute("uv",new Vi(c,2)),this.setAttribute("normal",new Vi(p,3))}static fromJSON(e){return new gK(e.points,e.segments,e.phiStart,e.phiLength)}},b4=class extends fr{constructor(e=1,t=1,i=1,r=32,s=1,n=!1,c=0,u=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:s,openEnded:n,thetaStart:c,thetaLength:u};let p=this;r=Math.floor(r),s=Math.floor(s);let f=[],x=[],w=[],E=[],A=0,I=[],P=i/2,O=0;k(),n===!1&&(e>0&&U(!0),t>0&&U(!1)),this.setIndex(f),this.setAttribute("position",new Vi(x,3)),this.setAttribute("normal",new Vi(w,3)),this.setAttribute("uv",new Vi(E,2));function k(){let j=new se,V=new se,$=0,Y=(t-e)/i;for(let J=0;J<=s;J++){let X=[],ee=J/s,oe=ee*(t-e)+e;for(let le=0;le<=r;le++){let ve=le/r,we=ve*u+c,fe=Math.sin(we),Ue=Math.cos(we);V.x=oe*fe,V.y=-ee*i+P,V.z=oe*Ue,x.push(V.x,V.y,V.z),j.set(fe,Y,Ue).normalize(),w.push(j.x,j.y,j.z),E.push(ve,1-ee),X.push(A++)}I.push(X)}for(let J=0;J<r;J++)for(let X=0;X<s;X++){let ee=I[X][J],oe=I[X+1][J],le=I[X+1][J+1],ve=I[X][J+1];f.push(ee,oe,ve),f.push(oe,le,ve),$+=6}p.addGroup(O,$,0),O+=$}function U(j){let V=A,$=new lt,Y=new se,J=0,X=j===!0?e:t,ee=j===!0?1:-1;for(let le=1;le<=r;le++)x.push(0,P*ee,0),w.push(0,ee,0),E.push(.5,.5),A++;let oe=A;for(let le=0;le<=r;le++){let ve=le/r*u+c,we=Math.cos(ve),fe=Math.sin(ve);Y.x=X*fe,Y.y=P*ee,Y.z=X*we,x.push(Y.x,Y.y,Y.z),w.push(0,ee,0),$.x=we*.5+.5,$.y=fe*.5*ee+.5,E.push($.x,$.y),A++}for(let le=0;le<r;le++){let ve=V+le,we=oe+le;j===!0?f.push(we,we+1,ve):f.push(we+1,we,ve),J+=3}p.addGroup(O,J,j===!0?1:2),O+=J}}static fromJSON(e){return new b4(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},w4=class extends b4{constructor(e=1,t=1,i=32,r=1,s=!1,n=0,c=Math.PI*2){super(0,e,t,i,r,s,n,c),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:n,thetaLength:c}}static fromJSON(e){return new w4(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},S4=class extends fr{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};let s=[],n=[];c(r),p(i),f(),this.setAttribute("position",new Vi(s,3)),this.setAttribute("normal",new Vi(s.slice(),3)),this.setAttribute("uv",new Vi(n,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function c(k){let U=new se,j=new se,V=new se;for(let $=0;$<t.length;$+=3)E(t[$+0],U),E(t[$+1],j),E(t[$+2],V),u(U,j,V,k)}function u(k,U,j,V){let $=V+1,Y=[];for(let J=0;J<=$;J++){Y[J]=[];let X=k.clone().lerp(j,J/$),ee=U.clone().lerp(j,J/$),oe=$-J;for(let le=0;le<=oe;le++)le===0&&J===$?Y[J][le]=X:Y[J][le]=X.clone().lerp(ee,le/oe)}for(let J=0;J<$;J++)for(let X=0;X<2*($-J)-1;X++){let ee=Math.floor(X/2);X%2===0?(w(Y[J][ee+1]),w(Y[J+1][ee]),w(Y[J][ee])):(w(Y[J][ee+1]),w(Y[J+1][ee+1]),w(Y[J+1][ee]))}}function p(k){let U=new se;for(let j=0;j<s.length;j+=3)U.x=s[j+0],U.y=s[j+1],U.z=s[j+2],U.normalize().multiplyScalar(k),s[j+0]=U.x,s[j+1]=U.y,s[j+2]=U.z}function f(){let k=new se;for(let U=0;U<s.length;U+=3){k.x=s[U+0],k.y=s[U+1],k.z=s[U+2];let j=P(k)/2/Math.PI+.5,V=O(k)/Math.PI+.5;n.push(j,1-V)}A(),x()}function x(){for(let k=0;k<n.length;k+=6){let U=n[k+0],j=n[k+2],V=n[k+4],$=Math.max(U,j,V),Y=Math.min(U,j,V);$>.9&&Y<.1&&(U<.2&&(n[k+0]+=1),j<.2&&(n[k+2]+=1),V<.2&&(n[k+4]+=1))}}function w(k){s.push(k.x,k.y,k.z)}function E(k,U){let j=k*3;U.x=e[j+0],U.y=e[j+1],U.z=e[j+2]}function A(){let k=new se,U=new se,j=new se,V=new se,$=new lt,Y=new lt,J=new lt;for(let X=0,ee=0;X<s.length;X+=9,ee+=6){k.set(s[X+0],s[X+1],s[X+2]),U.set(s[X+3],s[X+4],s[X+5]),j.set(s[X+6],s[X+7],s[X+8]),$.set(n[ee+0],n[ee+1]),Y.set(n[ee+2],n[ee+3]),J.set(n[ee+4],n[ee+5]),V.copy(k).add(U).add(j).divideScalar(3);let oe=P(V);I($,ee+0,k,oe),I(Y,ee+2,U,oe),I(J,ee+4,j,oe)}}function I(k,U,j,V){V<0&&k.x===1&&(n[U]=k.x-1),j.x===0&&j.z===0&&(n[U]=V/2/Math.PI+.5)}function P(k){return Math.atan2(k.z,-k.x)}function O(k){return Math.atan2(-k.y,Math.sqrt(k.x*k.x+k.z*k.z))}}static fromJSON(e){return new S4(e.vertices,e.indices,e.radius,e.details)}},yK=class extends S4{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=1/i,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],n=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,n,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new yK(e.radius,e.detail)}},wD=class extends bD{constructor(e){super(e),this.uuid=Zc(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(new bD().fromJSON(r))}return this}},s1e={triangulate:function(e,t,i=2){let r=t&&t.length,s=r?t[0]*i:e.length,n=vK(e,0,s,i,!0),c=[];if(!n||n.next===n.prev)return c;let u,p,f,x,w,E,A;if(r&&(n=u1e(e,t,n,i)),e.length>80*i){u=f=e[0],p=x=e[1];for(let I=i;I<s;I+=i)w=e[I],E=e[I+1],w<u&&(u=w),E<p&&(p=E),w>f&&(f=w),E>x&&(x=E);A=Math.max(f-u,x-p),A=A!==0?32767/A:0}return xS(n,c,i,u,p,A,0),c}};function vK(e,t,i,r,s){let n,c;if(s===b1e(e,t,i,r)>0)for(n=t;n<i;n+=r)c=K7(n,e[n],e[n+1],c);else for(n=i-r;n>=t;n-=r)c=K7(n,e[n],e[n+1],c);return c&&bI(c,c.next)&&(wS(c),c=c.next),c}function Uy(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(bI(i,i.next)||Xs(i.prev,i,i.next)===0)){if(wS(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function xS(e,t,i,r,s,n,c){if(!e)return;!c&&n&&m1e(e,r,s,n);let u=e,p,f;for(;e.prev!==e.next;){if(p=e.prev,f=e.next,n?a1e(e,r,s,n):o1e(e)){t.push(p.i/i|0),t.push(e.i/i|0),t.push(f.i/i|0),wS(e),e=f.next,u=f.next;continue}if(e=f,e===u){c?c===1?(e=l1e(Uy(e),t,i),xS(e,t,i,r,s,n,2)):c===2&&c1e(e,t,i,r,s,n):xS(Uy(e),t,i,r,s,n,1);break}}}function o1e(e){let t=e.prev,i=e,r=e.next;if(Xs(t,i,r)>=0)return!1;let s=t.x,n=i.x,c=r.x,u=t.y,p=i.y,f=r.y,x=s<n?s<c?s:c:n<c?n:c,w=u<p?u<f?u:f:p<f?p:f,E=s>n?s>c?s:c:n>c?n:c,A=u>p?u>f?u:f:p>f?p:f,I=r.next;for(;I!==t;){if(I.x>=x&&I.x<=E&&I.y>=w&&I.y<=A&&H_(s,u,n,p,c,f,I.x,I.y)&&Xs(I.prev,I,I.next)>=0)return!1;I=I.next}return!0}function a1e(e,t,i,r){let s=e.prev,n=e,c=e.next;if(Xs(s,n,c)>=0)return!1;let u=s.x,p=n.x,f=c.x,x=s.y,w=n.y,E=c.y,A=u<p?u<f?u:f:p<f?p:f,I=x<w?x<E?x:E:w<E?w:E,P=u>p?u>f?u:f:p>f?p:f,O=x>w?x>E?x:E:w>E?w:E,k=yN(A,I,t,i,r),U=yN(P,O,t,i,r),j=e.prevZ,V=e.nextZ;for(;j&&j.z>=k&&V&&V.z<=U;){if(j.x>=A&&j.x<=P&&j.y>=I&&j.y<=O&&j!==s&&j!==c&&H_(u,x,p,w,f,E,j.x,j.y)&&Xs(j.prev,j,j.next)>=0||(j=j.prevZ,V.x>=A&&V.x<=P&&V.y>=I&&V.y<=O&&V!==s&&V!==c&&H_(u,x,p,w,f,E,V.x,V.y)&&Xs(V.prev,V,V.next)>=0))return!1;V=V.nextZ}for(;j&&j.z>=k;){if(j.x>=A&&j.x<=P&&j.y>=I&&j.y<=O&&j!==s&&j!==c&&H_(u,x,p,w,f,E,j.x,j.y)&&Xs(j.prev,j,j.next)>=0)return!1;j=j.prevZ}for(;V&&V.z<=U;){if(V.x>=A&&V.x<=P&&V.y>=I&&V.y<=O&&V!==s&&V!==c&&H_(u,x,p,w,f,E,V.x,V.y)&&Xs(V.prev,V,V.next)>=0)return!1;V=V.nextZ}return!0}function l1e(e,t,i){let r=e;do{let s=r.prev,n=r.next.next;!bI(s,n)&&_K(s,r,r.next,n)&&bS(s,n)&&bS(n,s)&&(t.push(s.i/i|0),t.push(r.i/i|0),t.push(n.i/i|0),wS(r),wS(r.next),r=e=n),r=r.next}while(r!==e);return Uy(r)}function c1e(e,t,i,r,s,n){let c=e;do{let u=c.next.next;for(;u!==c.prev;){if(c.i!==u.i&&v1e(c,u)){let p=xK(c,u);c=Uy(c,c.next),p=Uy(p,p.next),xS(c,t,i,r,s,n,0),xS(p,t,i,r,s,n,0);return}u=u.next}c=c.next}while(c!==e)}function u1e(e,t,i,r){let s=[],n,c,u,p,f;for(n=0,c=t.length;n<c;n++)u=t[n]*r,p=n<c-1?t[n+1]*r:e.length,f=vK(e,u,p,r,!1),f===f.next&&(f.steiner=!0),s.push(y1e(f));for(s.sort(h1e),n=0;n<s.length;n++)i=d1e(s[n],i);return i}function h1e(e,t){return e.x-t.x}function d1e(e,t){let i=p1e(e,t);if(!i)return t;let r=xK(i,e);return Uy(r,r.next),Uy(i,i.next)}function p1e(e,t){let i=t,r=-1/0,s,n=e.x,c=e.y;do{if(c<=i.y&&c>=i.next.y&&i.next.y!==i.y){let E=i.x+(c-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(E<=n&&E>r&&(r=E,s=i.x<i.next.x?i:i.next,E===n))return s}i=i.next}while(i!==t);if(!s)return null;let u=s,p=s.x,f=s.y,x=1/0,w;i=s;do n>=i.x&&i.x>=p&&n!==i.x&&H_(c<f?n:r,c,p,f,c<f?r:n,c,i.x,i.y)&&(w=Math.abs(c-i.y)/(n-i.x),bS(i,e)&&(w<x||w===x&&(i.x>s.x||i.x===s.x&&f1e(s,i)))&&(s=i,x=w)),i=i.next;while(i!==u);return s}function f1e(e,t){return Xs(e.prev,e,t.prev)<0&&Xs(t.next,e,e.next)<0}function m1e(e,t,i,r){let s=e;do s.z===0&&(s.z=yN(s.x,s.y,t,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,g1e(s)}function g1e(e){let t,i,r,s,n,c,u,p,f=1;do{for(i=e,e=null,n=null,c=0;i;){for(c++,r=i,u=0,t=0;t<f&&(u++,r=r.nextZ,!!r);t++);for(p=f;u>0||p>0&&r;)u!==0&&(p===0||!r||i.z<=r.z)?(s=i,i=i.nextZ,u--):(s=r,r=r.nextZ,p--),n?n.nextZ=s:e=s,s.prevZ=n,n=s;i=r}n.nextZ=null,f*=2}while(c>1);return e}function yN(e,t,i,r,s){return e=(e-i)*s|0,t=(t-r)*s|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function y1e(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function H_(e,t,i,r,s,n,c,u){return(s-c)*(t-u)>=(e-c)*(n-u)&&(e-c)*(r-u)>=(i-c)*(t-u)&&(i-c)*(n-u)>=(s-c)*(r-u)}function v1e(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!_1e(e,t)&&(bS(e,t)&&bS(t,e)&&x1e(e,t)&&(Xs(e.prev,e,t.prev)||Xs(e,t.prev,t))||bI(e,t)&&Xs(e.prev,e,e.next)>0&&Xs(t.prev,t,t.next)>0)}function Xs(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function bI(e,t){return e.x===t.x&&e.y===t.y}function _K(e,t,i,r){let s=ZC(Xs(e,t,i)),n=ZC(Xs(e,t,r)),c=ZC(Xs(i,r,e)),u=ZC(Xs(i,r,t));return!!(s!==n&&c!==u||s===0&&$C(e,i,t)||n===0&&$C(e,r,t)||c===0&&$C(i,e,r)||u===0&&$C(i,t,r))}function $C(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function ZC(e){return e>0?1:e<0?-1:0}function _1e(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&_K(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function bS(e,t){return Xs(e.prev,e,e.next)<0?Xs(e,t,e.next)>=0&&Xs(e,e.prev,t)>=0:Xs(e,t,e.prev)<0||Xs(e,e.next,t)<0}function x1e(e,t){let i=e,r=!1,s=(e.x+t.x)/2,n=(e.y+t.y)/2;do i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function xK(e,t){let i=new vN(e.i,e.x,e.y),r=new vN(t.i,t.x,t.y),s=e.next,n=t.prev;return e.next=t,t.prev=e,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function K7(e,t,i,r){let s=new vN(e,t,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function wS(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function vN(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function b1e(e,t,i,r){let s=0;for(let n=t,c=i-r;n<i;n+=r)s+=(e[c]-e[n])*(e[n+1]+e[c+1]),c=n;return s}var bK=class{static area(e){let t=e.length,i=0;for(let r=t-1,s=0;s<t;r=s++)i+=e[r].x*e[s].y-e[s].x*e[r].y;return i*.5}static isClockWise(e){return bK.area(e)<0}static triangulateShape(e,t){let i=[],r=[],s=[];J7(e),eY(i,e);let n=e.length;t.forEach(J7);for(let u=0;u<t.length;u++)r.push(n),n+=t[u].length,eY(i,t[u]);let c=s1e.triangulate(i,r);for(let u=0;u<c.length;u+=3)s.push(c.slice(u,u+3));return s}};function J7(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function eY(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var wK=class extends S4{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new wK(e.radius,e.detail)}},$_=class extends fr{constructor(e=1,t=32,i=16,r=0,s=Math.PI*2,n=0,c=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:s,thetaStart:n,thetaLength:c},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let u=Math.min(n+c,Math.PI),p=0,f=[],x=new se,w=new se,E=[],A=[],I=[],P=[];for(let O=0;O<=i;O++){let k=[],U=O/i,j=0;O==0&&n==0?j=.5/t:O==i&&u==Math.PI&&(j=-.5/t);for(let V=0;V<=t;V++){let $=V/t;x.x=-e*Math.cos(r+$*s)*Math.sin(n+U*c),x.y=e*Math.cos(n+U*c),x.z=e*Math.sin(r+$*s)*Math.sin(n+U*c),A.push(x.x,x.y,x.z),w.copy(x).normalize(),I.push(w.x,w.y,w.z),P.push($+j,1-U),k.push(p++)}f.push(k)}for(let O=0;O<i;O++)for(let k=0;k<t;k++){let U=f[O][k+1],j=f[O][k],V=f[O+1][k],$=f[O+1][k+1];(O!==0||n>0)&&E.push(U,j,$),(O!==i-1||u<Math.PI)&&E.push(j,V,$)}this.setIndex(E),this.setAttribute("position",new Vi(A,3)),this.setAttribute("normal",new Vi(I,3)),this.setAttribute("uv",new Vi(P,2))}static fromJSON(e){return new $_(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},SK=class extends fr{constructor(e=1,t=.4,i=12,r=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:s},i=Math.floor(i),r=Math.floor(r);let n=[],c=[],u=[],p=[],f=new se,x=new se,w=new se;for(let E=0;E<=i;E++)for(let A=0;A<=r;A++){let I=A/r*s,P=E/i*Math.PI*2;x.x=(e+t*Math.cos(P))*Math.cos(I),x.y=(e+t*Math.cos(P))*Math.sin(I),x.z=t*Math.sin(P),c.push(x.x,x.y,x.z),f.x=e*Math.cos(I),f.y=e*Math.sin(I),w.subVectors(x,f).normalize(),u.push(w.x,w.y,w.z),p.push(A/r),p.push(E/i)}for(let E=1;E<=i;E++)for(let A=1;A<=r;A++){let I=(r+1)*E+A-1,P=(r+1)*(E-1)+A-1,O=(r+1)*(E-1)+A,k=(r+1)*E+A;n.push(I,P,k),n.push(P,O,k)}this.setIndex(n),this.setAttribute("position",new Vi(c,3)),this.setAttribute("normal",new Vi(u,3)),this.setAttribute("uv",new Vi(p,2))}static fromJSON(e){return new SK(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},EK=class extends fr{constructor(e=1,t=.4,i=64,r=8,s=2,n=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:s,q:n},i=Math.floor(i),r=Math.floor(r);let c=[],u=[],p=[],f=[],x=new se,w=new se,E=new se,A=new se,I=new se,P=new se,O=new se;for(let U=0;U<=i;++U){let j=U/i*s*Math.PI*2;k(j,s,n,e,E),k(j+.01,s,n,e,A),P.subVectors(A,E),O.addVectors(A,E),I.crossVectors(P,O),O.crossVectors(I,P),I.normalize(),O.normalize();for(let V=0;V<=r;++V){let $=V/r*Math.PI*2,Y=-t*Math.cos($),J=t*Math.sin($);x.x=E.x+(Y*O.x+J*I.x),x.y=E.y+(Y*O.y+J*I.y),x.z=E.z+(Y*O.z+J*I.z),u.push(x.x,x.y,x.z),w.subVectors(x,E).normalize(),p.push(w.x,w.y,w.z),f.push(U/i),f.push(V/r)}}for(let U=1;U<=i;U++)for(let j=1;j<=r;j++){let V=(r+1)*(U-1)+(j-1),$=(r+1)*U+(j-1),Y=(r+1)*U+j,J=(r+1)*(U-1)+j;c.push(V,$,J),c.push($,Y,J)}this.setIndex(c),this.setAttribute("position",new Vi(u,3)),this.setAttribute("normal",new Vi(p,3)),this.setAttribute("uv",new Vi(f,2));function k(U,j,V,$,Y){let J=Math.cos(U),X=Math.sin(U),ee=V/j*U,oe=Math.cos(ee);Y.x=$*(2+oe)*.5*J,Y.y=$*(2+oe)*X*.5,Y.z=$*Math.sin(ee)*.5}}static fromJSON(e){return new EK(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}};function Vf(e,t,i){return MK(e)?new e.constructor(e.subarray(t,i!==void 0?i:e.length)):e.slice(t,i)}function QC(e,t,i){return!e||!i&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function MK(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function w1e(e){function t(s,n){return e[s]-e[n]}let i=e.length,r=new Array(i);for(let s=0;s!==i;++s)r[s]=s;return r.sort(t),r}function tY(e,t,i){let r=e.length,s=new e.constructor(r);for(let n=0,c=0;c!==r;++n){let u=i[n]*t;for(let p=0;p!==t;++p)s[c++]=e[u+p]}return s}function TK(e,t,i,r){let s=1,n=e[0];for(;n!==void 0&&n[r]===void 0;)n=e[s++];if(n===void 0)return;let c=n[r];if(c!==void 0)if(Array.isArray(c))do c=n[r],c!==void 0&&(t.push(n.time),i.push.apply(i,c)),n=e[s++];while(n!==void 0);else if(c.toArray!==void 0)do c=n[r],c!==void 0&&(t.push(n.time),c.toArray(i,i.length)),n=e[s++];while(n!==void 0);else do c=n[r],c!==void 0&&(t.push(n.time),i.push(c)),n=e[s++];while(n!==void 0)}var wI=class{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let n;i:{r:if(!(e<r)){for(let c=i+2;;){if(r===void 0){if(e<s)break r;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===c)break;if(s=r,r=t[++i],e<r)break t}n=t.length;break i}if(!(e>=s)){let c=t[1];e<c&&(i=2,s=c);for(let u=i-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===u)break;if(r=s,s=t[--i-1],e>=s)break t}n=i,i=0;break i}break e}for(;i<n;){let c=i+n>>>1;e<t[c]?n=c:i=c+1}if(r=t[i],s=t[i-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let n=0;n!==r;++n)t[n]=i[s+n];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},S1e=class extends wI{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:j_,endingEnd:j_}}intervalChanged_(e,t,i){let r=this.parameterPositions,s=e-2,n=e+1,c=r[s],u=r[n];if(c===void 0)switch(this.getSettings_().endingStart){case V_:s=e,c=2*t-i;break;case yD:s=r.length-2,c=t+r[s]-r[s+1];break;default:s=e,c=i}if(u===void 0)switch(this.getSettings_().endingEnd){case V_:n=e,u=2*i-t;break;case yD:n=1,u=i+r[1]-r[0];break;default:n=e-1,u=t}let p=(i-t)*.5,f=this.valueSize;this._weightPrev=p/(t-c),this._weightNext=p/(u-i),this._offsetPrev=s*f,this._offsetNext=n*f}interpolate_(e,t,i,r){let s=this.resultBuffer,n=this.sampleValues,c=this.valueSize,u=e*c,p=u-c,f=this._offsetPrev,x=this._offsetNext,w=this._weightPrev,E=this._weightNext,A=(i-t)/(r-t),I=A*A,P=I*A,O=-w*P+2*w*I-w*A,k=(1+w)*P+(-1.5-2*w)*I+(-.5+w)*A+1,U=(-1-E)*P+(1.5+E)*I+.5*A,j=E*P-E*I;for(let V=0;V!==c;++V)s[V]=O*n[f+V]+k*n[p+V]+U*n[u+V]+j*n[x+V];return s}},AK=class extends wI{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let s=this.resultBuffer,n=this.sampleValues,c=this.valueSize,u=e*c,p=u-c,f=(i-t)/(r-t),x=1-f;for(let w=0;w!==c;++w)s[w]=n[p+w]*x+n[u+w]*f;return s}},E1e=class extends wI{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}},sd=class{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=QC(t,this.TimeBufferType),this.values=QC(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:QC(e.times,Array),values:QC(e.values,Array)};let r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new E1e(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new AK(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new S1e(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case mD:t=this.InterpolantFactoryMethodDiscrete;break;case gD:t=this.InterpolantFactoryMethodLinear;break;case lF:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return mD;case this.InterpolantFactoryMethodLinear:return gD;case this.InterpolantFactoryMethodSmooth:return lF}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){let i=this.times,r=i.length,s=0,n=r-1;for(;s!==r&&i[s]<e;)++s;for(;n!==-1&&i[n]>t;)--n;if(++n,s!==0||n!==r){s>=n&&(n=Math.max(n,1),s=n-1);let c=this.getValueSize();this.times=Vf(i,s,n),this.values=Vf(this.values,s*c,n*c)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,r=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let n=null;for(let c=0;c!==s;c++){let u=i[c];if(typeof u=="number"&&isNaN(u)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,c,u),e=!1;break}if(n!==null&&n>u){console.error("THREE.KeyframeTrack: Out of order keys.",this,c,u,n),e=!1;break}n=u}if(r!==void 0&&MK(r))for(let c=0,u=r.length;c!==u;++c){let p=r[c];if(isNaN(p)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,c,p),e=!1;break}}return e}optimize(){let e=Vf(this.times),t=Vf(this.values),i=this.getValueSize(),r=this.getInterpolation()===lF,s=e.length-1,n=1;for(let c=1;c<s;++c){let u=!1,p=e[c],f=e[c+1];if(p!==f&&(c!==1||p!==e[0]))if(r)u=!0;else{let x=c*i,w=x-i,E=x+i;for(let A=0;A!==i;++A){let I=t[x+A];if(I!==t[w+A]||I!==t[E+A]){u=!0;break}}}if(u){if(c!==n){e[n]=e[c];let x=c*i,w=n*i;for(let E=0;E!==i;++E)t[w+E]=t[x+E]}++n}}if(s>0){e[n]=e[s];for(let c=s*i,u=n*i,p=0;p!==i;++p)t[u+p]=t[c+p];++n}return n!==e.length?(this.times=Vf(e,0,n),this.values=Vf(t,0,n*i)):(this.times=e,this.values=t),this}clone(){let e=Vf(this.times,0),t=Vf(this.values,0),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}};sd.prototype.TimeBufferType=Float32Array;sd.prototype.ValueBufferType=Float32Array;sd.prototype.DefaultInterpolation=gD;var Tx=class extends sd{};Tx.prototype.ValueTypeName="bool";Tx.prototype.ValueBufferType=Array;Tx.prototype.DefaultInterpolation=mD;Tx.prototype.InterpolantFactoryMethodLinear=void 0;Tx.prototype.InterpolantFactoryMethodSmooth=void 0;var CK=class extends sd{};CK.prototype.ValueTypeName="color";var SD=class extends sd{};SD.prototype.ValueTypeName="number";var M1e=class extends wI{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let s=this.resultBuffer,n=this.sampleValues,c=this.valueSize,u=(i-t)/(r-t),p=e*c;for(let f=p+c;p!==f;p+=4)Vr.slerpFlat(s,0,n,p-c,n,p,u);return s}},GS=class extends sd{InterpolantFactoryMethodLinear(e){return new M1e(this.times,this.values,this.getValueSize(),e)}};GS.prototype.ValueTypeName="quaternion";GS.prototype.DefaultInterpolation=gD;GS.prototype.InterpolantFactoryMethodSmooth=void 0;var Ax=class extends sd{};Ax.prototype.ValueTypeName="string";Ax.prototype.ValueBufferType=Array;Ax.prototype.DefaultInterpolation=mD;Ax.prototype.InterpolantFactoryMethodLinear=void 0;Ax.prototype.InterpolantFactoryMethodSmooth=void 0;var ED=class extends sd{};ED.prototype.ValueTypeName="vector";var _N=class{constructor(e,t=-1,i,r=d4){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=Zc(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,r=1/(e.fps||1);for(let n=0,c=i.length;n!==c;++n)t.push(A1e(i[n]).scale(r));let s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){let t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,n=i.length;s!==n;++s)t.push(sd.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(e,t,i,r){let s=t.length,n=[];for(let c=0;c<s;c++){let u=[],p=[];u.push((c+s-1)%s,c,(c+1)%s),p.push(0,1,0);let f=w1e(u);u=tY(u,1,f),p=tY(p,1,f),!r&&u[0]===0&&(u.push(s),p.push(p[0])),n.push(new SD(".morphTargetInfluences["+t[c].name+"]",u,p).scale(1/i))}return new this(e,-1,n)}static findByName(e,t){let i=e;if(!Array.isArray(e)){let r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let r={},s=/^([\w-]*?)([\d]+)$/;for(let c=0,u=e.length;c<u;c++){let p=e[c],f=p.name.match(s);if(f&&f.length>1){let x=f[1],w=r[x];w||(r[x]=w=[]),w.push(p)}}let n=[];for(let c in r)n.push(this.CreateFromMorphTargetSequence(c,r[c],t,i));return n}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(f,x,w,E,A){if(w.length!==0){let I=[],P=[];TK(w,I,P,E),I.length!==0&&A.push(new f(x,I,P))}},r=[],s=e.name||"default",n=e.fps||30,c=e.blendMode,u=e.length||-1,p=e.hierarchy||[];for(let f=0;f<p.length;f++){let x=p[f].keys;if(!(!x||x.length===0))if(x[0].morphTargets){let w={},E;for(E=0;E<x.length;E++)if(x[E].morphTargets)for(let A=0;A<x[E].morphTargets.length;A++)w[x[E].morphTargets[A]]=-1;for(let A in w){let I=[],P=[];for(let O=0;O!==x[E].morphTargets.length;++O){let k=x[E];I.push(k.time),P.push(k.morphTarget===A?1:0)}r.push(new SD(".morphTargetInfluence["+A+"]",I,P))}u=w.length*n}else{let w=".bones["+t[f].name+"]";i(ED,w+".position",x,"pos",r),i(GS,w+".quaternion",x,"rot",r),i(ED,w+".scale",x,"scl",r)}}return r.length===0?null:new this(s,u,r,c)}resetDuration(){let e=this.tracks,t=0;for(let i=0,r=e.length;i!==r;++i){let s=this.tracks[i];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function T1e(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return SD;case"vector":case"vector2":case"vector3":case"vector4":return ED;case"color":return CK;case"quaternion":return GS;case"bool":case"boolean":return Tx;case"string":return Ax}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function A1e(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=T1e(e.type);if(e.times===void 0){let i=[],r=[];TK(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var MD={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},DK=class{constructor(e,t,i){let r=this,s=!1,n=0,c=0,u,p=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(f){c++,s===!1&&r.onStart!==void 0&&r.onStart(f,n,c),s=!0},this.itemEnd=function(f){n++,r.onProgress!==void 0&&r.onProgress(f,n,c),n===c&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(f){r.onError!==void 0&&r.onError(f)},this.resolveURL=function(f){return u?u(f):f},this.setURLModifier=function(f){return u=f,this},this.addHandler=function(f,x){return p.push(f,x),this},this.removeHandler=function(f){let x=p.indexOf(f);return x!==-1&&p.splice(x,2),this},this.getHandler=function(f){for(let x=0,w=p.length;x<w;x+=2){let E=p[x],A=p[x+1];if(E.global&&(E.lastIndex=0),E.test(f))return A}return null}}},C1e=new DK,HS=class{constructor(e){this.manager=e!==void 0?e:C1e,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},Zd={},D1e=class extends Error{constructor(e,t){super(e),this.response=t}},xN=class extends HS{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let s=MD.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(Zd[e]!==void 0){Zd[e].push({onLoad:t,onProgress:i,onError:r});return}Zd[e]=[],Zd[e].push({onLoad:t,onProgress:i,onError:r});let n=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),c=this.mimeType,u=this.responseType;fetch(n).then(p=>{if(p.status===200||p.status===0){if(p.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||p.body===void 0||p.body.getReader===void 0)return p;let f=Zd[e],x=p.body.getReader(),w=p.headers.get("Content-Length")||p.headers.get("X-File-Size"),E=w?parseInt(w):0,A=E!==0,I=0,P=new ReadableStream({start(O){k();function k(){x.read().then(({done:U,value:j})=>{if(U)O.close();else{I+=j.byteLength;let V=new ProgressEvent("progress",{lengthComputable:A,loaded:I,total:E});for(let $=0,Y=f.length;$<Y;$++){let J=f[$];J.onProgress&&J.onProgress(V)}O.enqueue(j),k()}})}}});return new Response(P)}else throw new D1e(`fetch for "${p.url}" responded with ${p.status}: ${p.statusText}`,p)}).then(p=>{switch(u){case"arraybuffer":return p.arrayBuffer();case"blob":return p.blob();case"document":return p.text().then(f=>new DOMParser().parseFromString(f,c));case"json":return p.json();default:if(c===void 0)return p.text();{let f=/charset="?([^;"\s]*)"?/i.exec(c),x=f&&f[1]?f[1].toLowerCase():void 0,w=new TextDecoder(x);return p.arrayBuffer().then(E=>w.decode(E))}}}).then(p=>{MD.add(e,p);let f=Zd[e];delete Zd[e];for(let x=0,w=f.length;x<w;x++){let E=f[x];E.onLoad&&E.onLoad(p)}}).catch(p=>{let f=Zd[e];if(f===void 0)throw this.manager.itemError(e),p;delete Zd[e];for(let x=0,w=f.length;x<w;x++){let E=f[x];E.onError&&E.onError(p)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},I1e=class extends HS{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let s=this,n=MD.get(e);if(n!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(n),s.manager.itemEnd(e)},0),n;let c=vS("img");function u(){f(),MD.add(e,this),t&&t(this),s.manager.itemEnd(e)}function p(x){f(),r&&r(x),s.manager.itemError(e),s.manager.itemEnd(e)}function f(){c.removeEventListener("load",u,!1),c.removeEventListener("error",p,!1)}return c.addEventListener("load",u,!1),c.addEventListener("error",p,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(c.crossOrigin=this.crossOrigin),s.manager.itemStart(e),c.src=e,c}},P1e=class extends HS{constructor(e){super(e)}load(e,t,i,r){let s=new Zs,n=new I1e(this.manager);return n.setCrossOrigin(this.crossOrigin),n.setPath(this.path),n.load(e,function(c){s.image=c,s.needsUpdate=!0,t!==void 0&&t(s)},i,r),s}},WS=class extends ls{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Tr(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}},R1e=class extends WS{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ls.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Tr(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},NF=new mi,iY=new se,rY=new se,E4=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new lt(512,512),this.map=null,this.mapPass=null,this.matrix=new mi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new g4,this._frameExtents=new lt(1,1),this._viewportCount=1,this._viewports=[new Gr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;iY.setFromMatrixPosition(e.matrixWorld),t.position.copy(iY),rY.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(rY),t.updateMatrixWorld(),NF.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(NF),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(NF)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},O1e=class extends E4{constructor(){super(new Ga(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=yS*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(i!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},L1e=class extends WS{constructor(e,t,i=0,r=Math.PI/3,s=0,n=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ls.DEFAULT_UP),this.updateMatrix(),this.target=new ls,this.distance=i,this.angle=r,this.penumbra=s,this.decay=n,this.map=null,this.shadow=new O1e}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},nY=new mi,Tw=new se,BF=new se,z1e=class extends E4{constructor(){super(new Ga(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new lt(4,2),this._viewportCount=6,this._viewports=[new Gr(2,1,1,1),new Gr(0,1,1,1),new Gr(3,1,1,1),new Gr(1,1,1,1),new Gr(3,0,1,1),new Gr(1,0,1,1)],this._cubeDirections=[new se(1,0,0),new se(-1,0,0),new se(0,0,1),new se(0,0,-1),new se(0,1,0),new se(0,-1,0)],this._cubeUps=[new se(0,1,0),new se(0,1,0),new se(0,1,0),new se(0,1,0),new se(0,0,1),new se(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Tw.setFromMatrixPosition(e.matrixWorld),i.position.copy(Tw),BF.copy(i.position),BF.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(BF),i.updateMatrixWorld(),r.makeTranslation(-Tw.x,-Tw.y,-Tw.z),nY.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(nY)}},F1e=class extends WS{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new z1e}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},k1e=class extends E4{constructor(){super(new vI(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},N1e=class extends WS{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ls.DEFAULT_UP),this.updateMatrix(),this.target=new ls,this.shadow=new k1e}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},IK=class extends fr{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},PK=class extends HS{constructor(e){super(e)}load(e,t,i,r){let s=this,n=new xN(s.manager);n.setPath(s.path),n.setRequestHeader(s.requestHeader),n.setWithCredentials(s.withCredentials),n.load(e,function(c){try{t(s.parse(JSON.parse(c)))}catch(u){r?r(u):console.error(u),s.manager.itemError(e)}},i,r)}parse(e){let t={},i={};function r(w,E){if(t[E]!==void 0)return t[E];let A=w.interleavedBuffers[E],I=s(w,A.buffer),P=AC(A.type,I),O=new Vxe(P,A.stride);return O.uuid=A.uuid,t[E]=O,O}function s(w,E){if(i[E]!==void 0)return i[E];let A=w.arrayBuffers[E],I=new Uint32Array(A).buffer;return i[E]=I,I}let n=e.isInstancedBufferGeometry?new IK:new fr,c=e.data.index;if(c!==void 0){let w=AC(c.type,c.array);n.setIndex(new Fr(w,1))}let u=e.data.attributes;for(let w in u){let E=u[w],A;if(E.isInterleavedBufferAttribute){let I=r(e.data,E.data);A=new gN(I,E.itemSize,E.offset,E.normalized)}else{let I=AC(E.type,E.array),P=E.isInstancedBufferAttribute?_S:Fr;A=new P(I,E.itemSize,E.normalized)}E.name!==void 0&&(A.name=E.name),E.usage!==void 0&&A.setUsage(E.usage),E.updateRange!==void 0&&(A.updateRange.offset=E.updateRange.offset,A.updateRange.count=E.updateRange.count),n.setAttribute(w,A)}let p=e.data.morphAttributes;if(p)for(let w in p){let E=p[w],A=[];for(let I=0,P=E.length;I<P;I++){let O=E[I],k;if(O.isInterleavedBufferAttribute){let U=r(e.data,O.data);k=new gN(U,O.itemSize,O.offset,O.normalized)}else{let U=AC(O.type,O.array);k=new Fr(U,O.itemSize,O.normalized)}O.name!==void 0&&(k.name=O.name),A.push(k)}n.morphAttributes[w]=A}e.data.morphTargetsRelative&&(n.morphTargetsRelative=!0);let f=e.data.groups||e.data.drawcalls||e.data.offsets;if(f!==void 0)for(let w=0,E=f.length;w!==E;++w){let A=f[w];n.addGroup(A.start,A.count,A.materialIndex)}let x=e.data.boundingSphere;if(x!==void 0){let w=new se;x.center!==void 0&&w.fromArray(x.center),n.boundingSphere=new jl(w,x.radius)}return e.name&&(n.name=e.name),e.userData&&(n.userData=e.userData),n}},B1e=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=sY(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=sY();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function sY(){return(typeof performance>"u"?Date:performance).now()}var U1e=class{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,s,n;switch(t){case"quaternion":r=this._slerp,s=this._slerpAdditive,n=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,n=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,s=this._lerpAdditive,n=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=n,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,r=this.valueSize,s=e*r+r,n=this.cumulativeWeight;if(n===0){for(let c=0;c!==r;++c)i[s+c]=i[c];n=t}else{n+=t;let c=t/n;this._mixBufferRegion(i,s,0,c,r)}this.cumulativeWeight=n}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,r=e*t+t,s=this.cumulativeWeight,n=this.cumulativeWeightAdditive,c=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){let u=t*this._origIndex;this._mixBufferRegion(i,r,u,1-s,t)}n>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let u=t,p=t+t;u!==p;++u)if(i[u]!==i[u+t]){c.setValue(i,r);break}}saveOriginalState(){let e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let s=i,n=r;s!==n;++s)t[s]=t[r+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,s){if(r>=.5)for(let n=0;n!==s;++n)e[t+n]=e[i+n]}_slerp(e,t,i,r){Vr.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,s){let n=this._workIndex*s;Vr.multiplyQuaternionsFlat(e,n,e,t,e,i),Vr.slerpFlat(e,t,e,t,e,n,r)}_lerp(e,t,i,r,s){let n=1-r;for(let c=0;c!==s;++c){let u=t+c;e[u]=e[u]*n+e[i+c]*r}}_lerpAdditive(e,t,i,r,s){for(let n=0;n!==s;++n){let c=t+n;e[c]=e[c]+e[i+n]*r}}},M4="\\[\\]\\.:\\/",j1e=new RegExp("["+M4+"]","g"),T4="[^"+M4+"]",V1e="[^"+M4.replace("\\.","")+"]",G1e=/((?:WC+[\/:])*)/.source.replace("WC",T4),H1e=/(WCOD+)?/.source.replace("WCOD",V1e),W1e=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",T4),q1e=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",T4),Y1e=new RegExp("^"+G1e+H1e+W1e+q1e+"$"),X1e=["material","materials","bones","map"],$1e=class{constructor(e,t,i){let r=i||xs.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},xs=class{constructor(e,t,i){this.path=t,this.parsedPath=i||xs.parseTrackName(t),this.node=xs.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new xs.Composite(e,t,i):new xs(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(j1e,"")}static parseTrackName(e){let t=Y1e.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){let s=i.nodeName.substring(r+1);X1e.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){let i=function(s){for(let n=0;n<s.length;n++){let c=s[n];if(c.name===t||c.uuid===t)return c;let u=i(c.children);if(u)return u}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,s=t.propertyIndex;if(e||(e=xs.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let p=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let f=0;f<e.length;f++)if(e[f].name===p){p=f;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(p!==void 0){if(e[p]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[p]}}let n=e[r];if(n===void 0){let p=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+p+"."+r+" but it wasn't found.",e);return}let c=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?c=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(c=this.Versioning.MatrixWorldNeedsUpdate);let u=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}u=this.BindingType.ArrayElement,this.resolvedProperty=n,this.propertyIndex=s}else n.fromArray!==void 0&&n.toArray!==void 0?(u=this.BindingType.HasFromToArray,this.resolvedProperty=n):Array.isArray(n)?(u=this.BindingType.EntireArray,this.resolvedProperty=n):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][c]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};xs.Composite=$1e;xs.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};xs.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};xs.prototype.GetterByBindingType=[xs.prototype._getValue_direct,xs.prototype._getValue_array,xs.prototype._getValue_arrayElement,xs.prototype._getValue_toArray];xs.prototype.SetterByBindingTypeAndVersioning=[[xs.prototype._setValue_direct,xs.prototype._setValue_direct_setNeedsUpdate,xs.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[xs.prototype._setValue_array,xs.prototype._setValue_array_setNeedsUpdate,xs.prototype._setValue_array_setMatrixWorldNeedsUpdate],[xs.prototype._setValue_arrayElement,xs.prototype._setValue_arrayElement_setNeedsUpdate,xs.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[xs.prototype._setValue_fromArray,xs.prototype._setValue_fromArray_setNeedsUpdate,xs.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Z1e=class{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;let s=t.tracks,n=s.length,c=new Array(n),u={endingStart:j_,endingEnd:j_};for(let p=0;p!==n;++p){let f=s[p].createInterpolant(null);c[p]=f,f.settings=u}this._interpolantSettings=u,this._interpolants=c,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=$Q,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let r=this._clip.duration,s=e._clip.duration,n=s/r,c=r/s;e.warp(1,n,t),this.warp(c,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let r=this._mixer,s=r.time,n=this.timeScale,c=this._timeScaleInterpolant;c===null&&(c=r._lendControlInterpolant(),this._timeScaleInterpolant=c);let u=c.parameterPositions,p=c.sampleValues;return u[0]=s,u[1]=s+i,p[0]=e/n,p[1]=t/n,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}let s=this._startTime;if(s!==null){let u=(e-s)*i;u<0||i===0?t=0:(this._startTime=null,t=i*u)}t*=this._updateTimeScale(e);let n=this._updateTime(t),c=this._updateWeight(e);if(c>0){let u=this._interpolants,p=this._propertyBindings;switch(this.blendMode){case Tge:for(let f=0,x=u.length;f!==x;++f)u[f].evaluate(n),p[f].accumulateAdditive(c);break;case d4:default:for(let f=0,x=u.length;f!==x;++f)u[f].evaluate(n),p[f].accumulate(r,c)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,r=this.time+e,s=this._loopCount,n=i===h4;if(e===0)return s===-1?r:n&&(s&1)===1?t-r:r;if(i===XQ){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,n)):this._setEndings(this.repetitions===0,!0,n)),r>=t||r<0){let c=Math.floor(r/t);r-=t*c,s+=Math.abs(c);let u=this.repetitions-s;if(u<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(u===1){let p=e<0;this._setEndings(p,!p,n)}else this._setEndings(!1,!1,n);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:c})}}else this.time=r;if(n&&(s&1)===1)return t-r}return r}_setEndings(e,t,i){let r=this._interpolantSettings;i?(r.endingStart=V_,r.endingEnd=V_):(e?r.endingStart=this.zeroSlopeAtStart?V_:j_:r.endingStart=yD,t?r.endingEnd=this.zeroSlopeAtEnd?V_:j_:r.endingEnd=yD)}_scheduleFading(e,t,i){let r=this._mixer,s=r.time,n=this._weightInterpolant;n===null&&(n=r._lendControlInterpolant(),this._weightInterpolant=n);let c=n.parameterPositions,u=n.sampleValues;return c[0]=s,u[0]=t,c[1]=s+e,u[1]=i,this}},Q1e=new Float32Array(1),K1e=class extends za{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,r=e._clip.tracks,s=r.length,n=e._propertyBindings,c=e._interpolants,u=i.uuid,p=this._bindingsByRootAndName,f=p[u];f===void 0&&(f={},p[u]=f);for(let x=0;x!==s;++x){let w=r[x],E=w.name,A=f[E];if(A!==void 0)++A.referenceCount,n[x]=A;else{if(A=n[x],A!==void 0){A._cacheIndex===null&&(++A.referenceCount,this._addInactiveBinding(A,u,E));continue}let I=t&&t._propertyBindings[x].binding.parsedPath;A=new U1e(xs.create(i,E,I),w.ValueTypeName,w.getValueSize()),++A.referenceCount,this._addInactiveBinding(A,u,E),n[x]=A}c[x].resultBuffer=A.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let i=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,i)}let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let s=t[i];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let s=t[i];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){let r=this._actions,s=this._actionsByClip,n=s[t];if(n===void 0)n={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=n;else{let c=n.knownActions;e._byClipCacheIndex=c.length,c.push(e)}e._cacheIndex=r.length,r.push(e),n.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;let s=e._clip.uuid,n=this._actionsByClip,c=n[s],u=c.knownActions,p=u[u.length-1],f=e._byClipCacheIndex;p._byClipCacheIndex=f,u[f]=p,u.pop(),e._byClipCacheIndex=null;let x=c.actionByRoot,w=(e._localRoot||this._root).uuid;delete x[w],u.length===0&&delete n[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let s=t[i];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_addInactiveBinding(e,t,i){let r=this._bindingsByRootAndName,s=this._bindings,n=r[t];n===void 0&&(n={},r[t]=n),n[i]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,r=i.rootNode.uuid,s=i.path,n=this._bindingsByRootAndName,c=n[r],u=t[t.length-1],p=e._cacheIndex;u._cacheIndex=p,t[p]=u,t.pop(),delete c[s],Object.keys(c).length===0&&delete n[r]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return i===void 0&&(i=new AK(new Float32Array(2),new Float32Array(2),1,Q1e),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=t[r];e.__cacheIndex=r,t[r]=e,s.__cacheIndex=i,t[i]=s}clipAction(e,t,i){let r=t||this._root,s=r.uuid,n=typeof e=="string"?_N.findByName(r,e):e,c=n!==null?n.uuid:e,u=this._actionsByClip[c],p=null;if(i===void 0&&(n!==null?i=n.blendMode:i=d4),u!==void 0){let x=u.actionByRoot[s];if(x!==void 0&&x.blendMode===i)return x;p=u.knownActions[0],n===null&&(n=p._clip)}if(n===null)return null;let f=new Z1e(this,n,t,i);return this._bindAction(f,p),this._addInactiveAction(f,c,s),f}existingAction(e,t){let i=t||this._root,r=i.uuid,s=typeof e=="string"?_N.findByName(i,e):e,n=s?s.uuid:e,c=this._actionsByClip[n];return c!==void 0&&c.actionByRoot[r]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;let t=this._actions,i=this._nActiveActions,r=this.time+=e,s=Math.sign(e),n=this._accuIndex^=1;for(let p=0;p!==i;++p)t[p]._update(r,e,s,n);let c=this._bindings,u=this._nActiveBindings;for(let p=0;p!==u;++p)c[p].apply(n);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,r=this._actionsByClip,s=r[i];if(s!==void 0){let n=s.knownActions;for(let c=0,u=n.length;c!==u;++c){let p=n[c];this._deactivateAction(p);let f=p._cacheIndex,x=t[t.length-1];p._cacheIndex=null,p._byClipCacheIndex=null,x._cacheIndex=f,t[f]=x,t.pop(),this._removeInactiveBindingsForAction(p)}delete r[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let n in i){let c=i[n].actionByRoot,u=c[t];u!==void 0&&(this._deactivateAction(u),this._removeInactiveAction(u))}let r=this._bindingsByRootAndName,s=r[t];if(s!==void 0)for(let n in s){let c=s[n];c.restoreOriginalState(),this._removeInactiveBinding(c)}}uncacheAction(e,t){let i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}},di=class{constructor(e){this.value=e}clone(){return new di(this.value.clone===void 0?this.value:this.value.clone())}},RK=class{constructor(e,t,i=0,r=1/0){this.ray=new Sx(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new f4,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return bN(e,this,i,t),i.sort(oY),i}intersectObjects(e,t=!0,i=[]){for(let r=0,s=e.length;r<s;r++)bN(e[r],this,i,t);return i.sort(oY),i}};function oY(e,t){return e.distance-t.distance}function bN(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){let s=e.children;for(let n=0,c=s.length;n<c;n++)bN(s[n],t,i,!0)}}var aY=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Eo(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},lY=new lt,OK=class{constructor(e=new lt(1/0,1/0),t=new lt(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=lY.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return lY.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},cY=new se,KC=new se,Qc=class{constructor(e=new se,t=new se){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){cY.subVectors(e,this.start),KC.subVectors(this.end,this.start);let i=KC.dot(KC),r=KC.dot(cY)/i;return t&&(r=Eo(r,0,1)),r}closestPointToPoint(e,t,i){let r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},uY=new se,J1e=class extends ls{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let i=new fr,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let n=0,c=1,u=32;n<u;n++,c++){let p=n/u*Math.PI*2,f=c/u*Math.PI*2;r.push(Math.cos(p),Math.sin(p),1,Math.cos(f),Math.sin(f),1)}i.setAttribute("position",new Vi(r,3));let s=new bm({fog:!1,toneMapped:!1});this.cone=new VS(i,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),uY.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(uY),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},ebe=class extends $s{constructor(e,t,i){let r=new $_(t,4,2),s=new Sp({wireframe:!0,fog:!1,toneMapped:!1});super(r,s),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},hY=new se,JC=new se,dY=new se,tbe=class extends ls{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new fr;r.setAttribute("position",new Vi([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let s=new bm({fog:!1,toneMapped:!1});this.lightPlane=new xD(r,s),this.add(this.lightPlane),r=new fr,r.setAttribute("position",new Vi([0,0,0,0,0,1],3)),this.targetLine=new xD(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),hY.setFromMatrixPosition(this.light.matrixWorld),JC.setFromMatrixPosition(this.light.target.matrixWorld),dY.subVectors(JC,hY),this.lightPlane.lookAt(JC),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(JC),this.targetLine.scale.z=dY.length()}},e2=new se,Js=new Hy,TD=class extends VS{constructor(e){let t=new fr,i=new bm({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],n={};c("n1","n2"),c("n2","n4"),c("n4","n3"),c("n3","n1"),c("f1","f2"),c("f2","f4"),c("f4","f3"),c("f3","f1"),c("n1","f1"),c("n2","f2"),c("n3","f3"),c("n4","f4"),c("p","n1"),c("p","n2"),c("p","n3"),c("p","n4"),c("u1","u2"),c("u2","u3"),c("u3","u1"),c("c","t"),c("p","c"),c("cn1","cn2"),c("cn3","cn4"),c("cf1","cf2"),c("cf3","cf4");function c(A,I){u(A),u(I)}function u(A){r.push(0,0,0),s.push(0,0,0),n[A]===void 0&&(n[A]=[]),n[A].push(r.length/3-1)}t.setAttribute("position",new Vi(r,3)),t.setAttribute("color",new Vi(s,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=n,this.update();let p=new Tr(16755200),f=new Tr(16711680),x=new Tr(43775),w=new Tr(16777215),E=new Tr(3355443);this.setColors(p,f,x,w,E)}setColors(e,t,i,r,s){let n=this.geometry.getAttribute("color");n.setXYZ(0,e.r,e.g,e.b),n.setXYZ(1,e.r,e.g,e.b),n.setXYZ(2,e.r,e.g,e.b),n.setXYZ(3,e.r,e.g,e.b),n.setXYZ(4,e.r,e.g,e.b),n.setXYZ(5,e.r,e.g,e.b),n.setXYZ(6,e.r,e.g,e.b),n.setXYZ(7,e.r,e.g,e.b),n.setXYZ(8,e.r,e.g,e.b),n.setXYZ(9,e.r,e.g,e.b),n.setXYZ(10,e.r,e.g,e.b),n.setXYZ(11,e.r,e.g,e.b),n.setXYZ(12,e.r,e.g,e.b),n.setXYZ(13,e.r,e.g,e.b),n.setXYZ(14,e.r,e.g,e.b),n.setXYZ(15,e.r,e.g,e.b),n.setXYZ(16,e.r,e.g,e.b),n.setXYZ(17,e.r,e.g,e.b),n.setXYZ(18,e.r,e.g,e.b),n.setXYZ(19,e.r,e.g,e.b),n.setXYZ(20,e.r,e.g,e.b),n.setXYZ(21,e.r,e.g,e.b),n.setXYZ(22,e.r,e.g,e.b),n.setXYZ(23,e.r,e.g,e.b),n.setXYZ(24,t.r,t.g,t.b),n.setXYZ(25,t.r,t.g,t.b),n.setXYZ(26,t.r,t.g,t.b),n.setXYZ(27,t.r,t.g,t.b),n.setXYZ(28,t.r,t.g,t.b),n.setXYZ(29,t.r,t.g,t.b),n.setXYZ(30,t.r,t.g,t.b),n.setXYZ(31,t.r,t.g,t.b),n.setXYZ(32,i.r,i.g,i.b),n.setXYZ(33,i.r,i.g,i.b),n.setXYZ(34,i.r,i.g,i.b),n.setXYZ(35,i.r,i.g,i.b),n.setXYZ(36,i.r,i.g,i.b),n.setXYZ(37,i.r,i.g,i.b),n.setXYZ(38,r.r,r.g,r.b),n.setXYZ(39,r.r,r.g,r.b),n.setXYZ(40,s.r,s.g,s.b),n.setXYZ(41,s.r,s.g,s.b),n.setXYZ(42,s.r,s.g,s.b),n.setXYZ(43,s.r,s.g,s.b),n.setXYZ(44,s.r,s.g,s.b),n.setXYZ(45,s.r,s.g,s.b),n.setXYZ(46,s.r,s.g,s.b),n.setXYZ(47,s.r,s.g,s.b),n.setXYZ(48,s.r,s.g,s.b),n.setXYZ(49,s.r,s.g,s.b),n.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap,i=1,r=1;Js.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),co("c",t,e,Js,0,0,-1),co("t",t,e,Js,0,0,1),co("n1",t,e,Js,-i,-r,-1),co("n2",t,e,Js,i,-r,-1),co("n3",t,e,Js,-i,r,-1),co("n4",t,e,Js,i,r,-1),co("f1",t,e,Js,-i,-r,1),co("f2",t,e,Js,i,-r,1),co("f3",t,e,Js,-i,r,1),co("f4",t,e,Js,i,r,1),co("u1",t,e,Js,i*.7,r*1.1,-1),co("u2",t,e,Js,-i*.7,r*1.1,-1),co("u3",t,e,Js,0,r*2,-1),co("cf1",t,e,Js,-i,0,1),co("cf2",t,e,Js,i,0,1),co("cf3",t,e,Js,0,-r,1),co("cf4",t,e,Js,0,r,1),co("cn1",t,e,Js,-i,0,-1),co("cn2",t,e,Js,i,0,-1),co("cn3",t,e,Js,0,-r,-1),co("cn4",t,e,Js,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function co(e,t,i,r,s,n,c){e2.set(s,n,c).unproject(r);let u=t[e];if(u!==void 0){let p=i.getAttribute("position");for(let f=0,x=u.length;f<x;f++)p.setXYZ(u[f],e2.x,e2.y,e2.z)}}var AD=class extends VS{constructor(e,t=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new fr;s.setIndex(new Fr(i,1)),s.setAttribute("position",new Vi(r,3)),super(s,new bm({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},ibe=class extends VS{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new fr;r.setAttribute("position",new Vi(t,3)),r.setAttribute("color",new Vi(i,3));let s=new bm({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(e,t,i){let r=new Tr,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(t),r.toArray(s,6),r.toArray(s,9),r.set(i),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},hp=rbe();function rbe(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),s=new Uint32Array(512);for(let p=0;p<256;++p){let f=p-127;f<-27?(r[p]=0,r[p|256]=32768,s[p]=24,s[p|256]=24):f<-14?(r[p]=1024>>-f-14,r[p|256]=1024>>-f-14|32768,s[p]=-f-1,s[p|256]=-f-1):f<=15?(r[p]=f+15<<10,r[p|256]=f+15<<10|32768,s[p]=13,s[p|256]=13):f<128?(r[p]=31744,r[p|256]=64512,s[p]=24,s[p|256]=24):(r[p]=31744,r[p|256]=64512,s[p]=13,s[p|256]=13)}let n=new Uint32Array(2048),c=new Uint32Array(64),u=new Uint32Array(64);for(let p=1;p<1024;++p){let f=p<<13,x=0;for(;!(f&8388608);)f<<=1,x-=8388608;f&=-8388609,x+=947912704,n[p]=f|x}for(let p=1024;p<2048;++p)n[p]=939524096+(p-1024<<13);for(let p=1;p<31;++p)c[p]=p<<23;c[31]=1199570944,c[32]=2147483648;for(let p=33;p<63;++p)c[p]=2147483648+(p-32<<23);c[63]=3347054592;for(let p=1;p<64;++p)p!==32&&(u[p]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:s,mantissaTable:n,exponentTable:c,offsetTable:u}}function nbe(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Eo(e,-65504,65504),hp.floatView[0]=e;let t=hp.uint32View[0],i=t>>23&511;return hp.baseTable[i]+((t&8388607)>>hp.shiftTable[i])}function sbe(e){let t=e>>10;return hp.uint32View[0]=hp.mantissaTable[hp.offsetTable[t]+(e&1023)]+hp.exponentTable[t],hp.floatView[0]}var obe=Object.freeze({__proto__:null,fromHalfFloat:sbe,toHalfFloat:nbe});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:wx}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=wx);var Aw=".",A4=Symbol("target"),LK=Symbol("unsubscribe");function wN(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}function abe(e){return(typeof e=="object"?e===null:typeof e!="function")||e instanceof RegExp}var Wh=Array.isArray;function C4(e){return typeof e=="symbol"}var lbe={after:(e,t)=>Wh(e)?e.slice(t.length):t===""?e:e.slice(t.length+1),concat:(e,t)=>Wh(e)?(e=[...e],t&&e.push(t),e):t&&t.toString!==void 0?(e!==""&&(e+=Aw),C4(t)?e+t.toString():e+t):e,initial:e=>{if(Wh(e))return e.slice(0,-1);if(e==="")return e;let t=e.lastIndexOf(Aw);return t===-1?"":e.slice(0,t)},last:e=>{if(Wh(e))return e[e.length-1]||"";if(e==="")return e;let t=e.lastIndexOf(Aw);return t===-1?e:e.slice(t+1)},walk:(e,t)=>{if(Wh(e))for(let i of e)t(i);else if(e!==""){let i=0,r=e.indexOf(Aw);if(r===-1)t(e);else for(;i<e.length;)r===-1&&(r=e.length),t(e.slice(i,r)),i=r+1,r=e.indexOf(Aw,i)}},get(e,t){return this.walk(t,i=>{e&&(e=e[i])}),e}},Wc=lbe;function cbe(e){return typeof e=="object"&&typeof e.next=="function"}function ube(e,t,i,r,s){let n=e.next;if(t.name==="entries")e.next=function(){let c=n.call(this);return c.done===!1&&(c.value[0]=s(c.value[0],t,c.value[0],r),c.value[1]=s(c.value[1],t,c.value[0],r)),c};else if(t.name==="values"){let c=i[A4].keys();e.next=function(){let u=n.call(this);return u.done===!1&&(u.value=s(u.value,t,c.next().value,r)),u}}else e.next=function(){let c=n.call(this);return c.done===!1&&(c.value=s(c.value,t,c.value,r)),c};return e}function pY(e,t,i){return e.isUnsubscribed||t.ignoreSymbols&&C4(i)||t.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in t&&t.ignoreKeys.includes(i)}var hbe=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),i=t.get(e);return i===void 0&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let i=this._getProperties(e),r=i[t];return r===void 0&&(r=Reflect.getOwnPropertyDescriptor(e,t),i[t]=r),r}getProxy(e,t,i,r){if(this.isUnsubscribed)return e;let s=e[r],n=s||e;this._pathCache.set(n,t);let c=this._proxyCache.get(n);return c===void 0&&(c=s===void 0?new Proxy(e,i):e,this._proxyCache.set(n,c)),c}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,Wc.get(t,this.getPath(e)))}defineProperty(e,t,i){return Reflect.defineProperty(e,t,i)?(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0):!1}setProperty(e,t,i,r,s){if(!this._equals(s,i)||!(t in e)){let n=this._getOwnPropertyDescriptor(e,t);return n!==void 0&&"set"in n?Reflect.set(e,t,i,r):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let r=this._getDescriptorCache().get(e);r&&(delete r[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){let r=this._getOwnPropertyDescriptor(t,i);return e!==void 0&&r!==void 0&&Object.is(e.value,r.value)&&(e.writable||!1)===(r.writable||!1)&&(e.enumerable||!1)===(r.enumerable||!1)&&(e.configurable||!1)===(r.configurable||!1)&&e.get===r.get&&e.set===r.set}isGetInvariant(e,t){let i=this._getOwnPropertyDescriptor(e,t);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function SN(e){return toString.call(e)==="[object Object]"}function t2(){return!0}function y_(e,t){return e.length!==t.length||e.some((i,r)=>t[r]!==i)}var zK=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),dbe=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),FK={push:t2,pop:t2,shift:t2,unshift:t2,copyWithin:y_,reverse:y_,sort:y_,splice:y_,flat:y_,fill:y_},pbe=new Set([...zK,...dbe,...Object.keys(FK)]);function i2(e,t){if(e.size!==t.size)return!0;for(let i of e)if(!t.has(i))return!0;return!1}var kK=["keys","values","entries"],NK=new Set(["has","toString"]),BK={add:i2,clear:i2,delete:i2,forEach:i2},fbe=new Set([...NK,...Object.keys(BK),...kK]);function r2(e,t){if(e.size!==t.size)return!0;let i;for(let[r,s]of e)if(i=t.get(r),i!==s||i===void 0&&!t.has(r))return!0;return!1}var mbe=new Set([...NK,"get"]),UK={set:r2,clear:r2,delete:r2,forEach:r2},gbe=new Set([...mbe,...Object.keys(UK),...kK]),vm=class{constructor(e,t,i,r){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=r,this._changes=r?[]:null,this.clone=t===void 0?e:this._shallowClone(e)}static isHandledMethod(e){return zK.has(e)}_shallowClone(e){let t=e;if(SN(e))t=me({},e);else if(Wh(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(i=>this._shallowClone(i)));else if(e instanceof Map){t=new Map;for(let[i,r]of e.entries())t.set(i,this._shallowClone(r))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,r){return e?(Wh(r)?this._onIsChanged=FK[t]:r instanceof Set?this._onIsChanged=BK[t]:r instanceof Map&&(this._onIsChanged=UK[t]),r):i}update(e,t,i){let r=Wc.after(e,this._path);if(t!=="length"){let s=this.clone;Wc.walk(r,n=>{s&&s[n]&&(this._clonedCache.has(s[n])||(s[n]=this._shallowClone(s[n])),s=s[n])}),this._hasOnValidate&&this._changes.push({path:r,property:t,previous:i}),s&&s[t]&&(s[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;i!==-1;i--)t=this._changes[i],Wc.get(e,t.path)[t.property]=t.previous}isChanged(e){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,e)}},fY=class extends vm{static isHandledMethod(e){return pbe.has(e)}},ybe=class extends vm{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},mY=class extends vm{static isHandledMethod(e){return fbe.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},gY=class extends vm{static isHandledMethod(e){return gbe.has(e)}undo(e){for(let[t,i]of this.clone.entries())e.set(t,i);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},vbe=class extends vm{constructor(e,t,i,r){super(void 0,t,i,r),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},_be=class extends vm{constructor(e,t,i,r){super(void 0,t,i,r),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},z_=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return SN(e)||Wh(e)||wN(e)}static isHandledMethod(e,t){return SN(e)?vm.isHandledMethod(t):Wh(e)?fY.isHandledMethod(t):e instanceof Set?mY.isHandledMethod(t):e instanceof Map?gY.isHandledMethod(t):wN(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let r=vm;Wh(e)?r=fY:e instanceof Date?r=ybe:e instanceof Set?r=mY:e instanceof Map?r=gY:e instanceof WeakSet?r=vbe:e instanceof WeakMap&&(r=_be),this._stack.push(new r(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){let{name:r}=e,s=z_.isHandledMethod(i,r);return this._stack[this._stack.length-1].preferredThisArg(s,r,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){this._previousClone!==void 0&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},xbe={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},D4=(e,t,i={})=>{i=me(me({},xbe),i);let r=Symbol("ProxyTarget"),{equals:s,isShallow:n,ignoreDetached:c,details:u}=i,p=new hbe(s),f=typeof i.onValidate=="function",x=new z_(f),w=(U,j,V,$,Y)=>!f||x.isCloning||i.onValidate(Wc.concat(p.getPath(U),j),V,$,Y)===!0,E=(U,j,V,$)=>{!pY(p,i,j)&&!(c&&p.isDetached(U,e))&&A(p.getPath(U),j,V,$)},A=(U,j,V,$,Y)=>{x.isCloning?x.update(U,j,$):t(Wc.concat(U,j),V,$,Y)},I=U=>U&&(U[r]||U),P=(U,j,V,$)=>abe(U)||V==="constructor"||n&&!z_.isHandledMethod(j,V)||pY(p,i,V)||p.isGetInvariant(j,V)||c&&p.isDetached(j,e)?U:($===void 0&&($=p.getPath(j)),p.getProxy(U,Wc.concat($,V),O,r)),O={get(U,j,V){if(C4(j)){if(j===r||j===A4)return U;if(j===LK&&!p.isUnsubscribed&&p.getPath(U).length===0)return p.unsubscribe(),U}let $=wN(U)?Reflect.get(U,j):Reflect.get(U,j,V);return P($,U,j)},set(U,j,V,$){V=I(V);let Y=U[r]||U,J=Y[j];if(s(J,V)&&j in U)return!0;let X=w(U,j,V,J);return X&&p.setProperty(Y,j,V,$,J)?(E(U,j,U[j],J),!0):!X},defineProperty(U,j,V){if(!p.isSameDescriptor(V,U,j)){let $=U[j];w(U,j,V.value,$)&&p.defineProperty(U,j,V,$)&&E(U,j,V.value,$)}return!0},deleteProperty(U,j){if(!Reflect.has(U,j))return!0;let V=Reflect.get(U,j),$=w(U,j,void 0,V);return $&&p.deleteProperty(U,j,V)?(E(U,j,void 0,V),!0):!$},apply(U,j,V){let $=j[r]||j;if(p.isUnsubscribed)return Reflect.apply(U,$,V);if((u===!1||u!==!0&&!u.includes(U.name))&&z_.isHandledType($)){let Y=Wc.initial(p.getPath(U)),J=z_.isHandledMethod($,U.name);x.start($,Y,V);let X=Reflect.apply(U,x.preferredThisArg(U,j,$),J?V.map(le=>I(le)):V),ee=x.isChanged($,s),oe=x.stop();if(z_.isHandledType(X)&&J&&(j instanceof Map&&U.name==="get"&&(Y=Wc.concat(Y,V[0])),X=p.getProxy(X,Y,O)),ee){let le={name:U.name,args:V,result:X},ve=x.isCloning?Wc.initial(Y):Y,we=x.isCloning?Wc.last(Y):"";w(Wc.get(e,ve),we,$,oe,le)?A(ve,we,$,oe,le):x.undo($)}return(j instanceof Map||j instanceof Set)&&cbe(X)?ube(X,U,j,Y,P):X}return Reflect.apply(U,j,V)}},k=p.getProxy(e,i.pathAsArray?[]:"",O);return t=t.bind(k),f&&(i.onValidate=i.onValidate.bind(k)),k};D4.target=e=>e&&e[A4]||e;D4.unsubscribe=e=>e[LK]||e;var yY=D4,bbe=typeof global=="object"&&global&&global.Object===Object&&global,jK=bbe,wbe=typeof self=="object"&&self&&self.Object===Object&&self,Sbe=jK||wbe||Function("return this")(),Qu=Sbe,Ebe=Qu.Symbol,Jc=Ebe,VK=Object.prototype,Mbe=VK.hasOwnProperty,Tbe=VK.toString,Cw=Jc?Jc.toStringTag:void 0;function Abe(e){var t=Mbe.call(e,Cw),i=e[Cw];try{e[Cw]=void 0;var r=!0}catch{}var s=Tbe.call(e);return r&&(t?e[Cw]=i:delete e[Cw]),s}var Cbe=Abe,Dbe=Object.prototype,Ibe=Dbe.toString;function Pbe(e){return Ibe.call(e)}var Rbe=Pbe,Obe="[object Null]",Lbe="[object Undefined]",vY=Jc?Jc.toStringTag:void 0;function zbe(e){return e==null?e===void 0?Lbe:Obe:vY&&vY in Object(e)?Cbe(e):Rbe(e)}var Wy=zbe;function Fbe(e){return e!=null&&typeof e=="object"}var Mp=Fbe,kbe="[object Symbol]";function Nbe(e){return typeof e=="symbol"||Mp(e)&&Wy(e)==kbe}var qS=Nbe;function Bbe(e,t){for(var i=-1,r=e==null?0:e.length,s=Array(r);++i<r;)s[i]=t(e[i],i,e);return s}var GK=Bbe,Ube=Array.isArray,ed=Ube,jbe=1/0,_Y=Jc?Jc.prototype:void 0,xY=_Y?_Y.toString:void 0;function HK(e){if(typeof e=="string")return e;if(ed(e))return GK(e,HK)+"";if(qS(e))return xY?xY.call(e):"";var t=e+"";return t=="0"&&1/e==-jbe?"-0":t}var Vbe=HK,Gbe=/\s/;function Hbe(e){for(var t=e.length;t--&&Gbe.test(e.charAt(t)););return t}var Wbe=Hbe,qbe=/^\s+/;function Ybe(e){return e&&e.slice(0,Wbe(e)+1).replace(qbe,"")}var Xbe=Ybe;function $be(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Zu=$be,bY=NaN,Zbe=/^[-+]0x[0-9a-f]+$/i,Qbe=/^0b[01]+$/i,Kbe=/^0o[0-7]+$/i,Jbe=parseInt;function ewe(e){if(typeof e=="number")return e;if(qS(e))return bY;if(Zu(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Zu(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Xbe(e);var i=Qbe.test(e);return i||Kbe.test(e)?Jbe(e.slice(2),i?2:8):Zbe.test(e)?bY:+e}var wY=ewe;function twe(e){return e}var WK=twe,iwe="[object AsyncFunction]",rwe="[object Function]",nwe="[object GeneratorFunction]",swe="[object Proxy]";function owe(e){if(!Zu(e))return!1;var t=Wy(e);return t==rwe||t==nwe||t==iwe||t==swe}var qK=owe,awe=Qu["__core-js_shared__"],UF=awe,SY=function(){var e=/[^.]+$/.exec(UF&&UF.keys&&UF.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function lwe(e){return!!SY&&SY in e}var cwe=lwe,uwe=Function.prototype,hwe=uwe.toString;function dwe(e){if(e!=null){try{return hwe.call(e)}catch{}try{return e+""}catch{}}return""}var qy=dwe,pwe=/[\\^$.*+?()[\]{}|]/g,fwe=/^\[object .+?Constructor\]$/,mwe=Function.prototype,gwe=Object.prototype,ywe=mwe.toString,vwe=gwe.hasOwnProperty,_we=RegExp("^"+ywe.call(vwe).replace(pwe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function xwe(e){if(!Zu(e)||cwe(e))return!1;var t=qK(e)?_we:fwe;return t.test(qy(e))}var bwe=xwe;function wwe(e,t){return e?.[t]}var Swe=wwe;function Ewe(e,t){var i=Swe(e,t);return bwe(i)?i:void 0}var Yy=Ewe,Mwe=Yy(Qu,"WeakMap"),EN=Mwe,EY=Object.create,Twe=function(){function e(){}return function(t){if(!Zu(t))return{};if(EY)return EY(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),Awe=Twe;function Cwe(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var Dwe=Cwe;function Iwe(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t}var Pwe=Iwe,Rwe=800,Owe=16,Lwe=Date.now;function zwe(e){var t=0,i=0;return function(){var r=Lwe(),s=Owe-(r-i);if(i=r,s>0){if(++t>=Rwe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var Fwe=zwe;function kwe(e){return function(){return e}}var Nwe=kwe,Bwe=function(){try{var e=Yy(Object,"defineProperty");return e({},"",{}),e}catch{}}(),CD=Bwe,Uwe=CD?function(e,t){return CD(e,"toString",{configurable:!0,enumerable:!1,value:Nwe(t),writable:!0})}:WK,jwe=Uwe,Vwe=Fwe(jwe),Gwe=Vwe;function Hwe(e,t){for(var i=-1,r=e==null?0:e.length;++i<r&&t(e[i],i,e)!==!1;);return e}var Wwe=Hwe,qwe=9007199254740991,Ywe=/^(?:0|[1-9]\d*)$/;function Xwe(e,t){var i=typeof e;return t=t??qwe,!!t&&(i=="number"||i!="symbol"&&Ywe.test(e))&&e>-1&&e%1==0&&e<t}var I4=Xwe;function $we(e,t,i){t=="__proto__"&&CD?CD(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var YK=$we;function Zwe(e,t){return e===t||e!==e&&t!==t}var P4=Zwe,Qwe=Object.prototype,Kwe=Qwe.hasOwnProperty;function Jwe(e,t,i){var r=e[t];(!(Kwe.call(e,t)&&P4(r,i))||i===void 0&&!(t in e))&&YK(e,t,i)}var R4=Jwe;function eSe(e,t,i,r){var s=!i;i||(i={});for(var n=-1,c=t.length;++n<c;){var u=t[n],p=r?r(i[u],e[u],u,i,e):void 0;p===void 0&&(p=e[u]),s?YK(i,u,p):R4(i,u,p)}return i}var YS=eSe,MY=Math.max;function tSe(e,t,i){return t=MY(t===void 0?e.length-1:t,0),function(){for(var r=arguments,s=-1,n=MY(r.length-t,0),c=Array(n);++s<n;)c[s]=r[t+s];s=-1;for(var u=Array(t+1);++s<t;)u[s]=r[s];return u[t]=i(c),Dwe(e,this,u)}}var iSe=tSe,rSe=9007199254740991;function nSe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=rSe}var O4=nSe;function sSe(e){return e!=null&&O4(e.length)&&!qK(e)}var XK=sSe,oSe=Object.prototype;function aSe(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||oSe;return e===i}var L4=aSe;function lSe(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}var cSe=lSe,uSe="[object Arguments]";function hSe(e){return Mp(e)&&Wy(e)==uSe}var TY=hSe,$K=Object.prototype,dSe=$K.hasOwnProperty,pSe=$K.propertyIsEnumerable,fSe=TY(function(){return arguments}())?TY:function(e){return Mp(e)&&dSe.call(e,"callee")&&!pSe.call(e,"callee")},z4=fSe;function mSe(){return!1}var gSe=mSe,ZK=typeof exports=="object"&&exports&&!exports.nodeType&&exports,AY=ZK&&typeof module=="object"&&module&&!module.nodeType&&module,ySe=AY&&AY.exports===ZK,CY=ySe?Qu.Buffer:void 0,vSe=CY?CY.isBuffer:void 0,_Se=vSe||gSe,DD=_Se,xSe="[object Arguments]",bSe="[object Array]",wSe="[object Boolean]",SSe="[object Date]",ESe="[object Error]",MSe="[object Function]",TSe="[object Map]",ASe="[object Number]",CSe="[object Object]",DSe="[object RegExp]",ISe="[object Set]",PSe="[object String]",RSe="[object WeakMap]",OSe="[object ArrayBuffer]",LSe="[object DataView]",zSe="[object Float32Array]",FSe="[object Float64Array]",kSe="[object Int8Array]",NSe="[object Int16Array]",BSe="[object Int32Array]",USe="[object Uint8Array]",jSe="[object Uint8ClampedArray]",VSe="[object Uint16Array]",GSe="[object Uint32Array]",Us={};Us[zSe]=Us[FSe]=Us[kSe]=Us[NSe]=Us[BSe]=Us[USe]=Us[jSe]=Us[VSe]=Us[GSe]=!0;Us[xSe]=Us[bSe]=Us[OSe]=Us[wSe]=Us[LSe]=Us[SSe]=Us[ESe]=Us[MSe]=Us[TSe]=Us[ASe]=Us[CSe]=Us[DSe]=Us[ISe]=Us[PSe]=Us[RSe]=!1;function HSe(e){return Mp(e)&&O4(e.length)&&!!Us[Wy(e)]}var WSe=HSe;function qSe(e){return function(t){return e(t)}}var F4=qSe,QK=typeof exports=="object"&&exports&&!exports.nodeType&&exports,lS=QK&&typeof module=="object"&&module&&!module.nodeType&&module,YSe=lS&&lS.exports===QK,jF=YSe&&jK.process,XSe=function(){try{var e=lS&&lS.require&&lS.require("util").types;return e||jF&&jF.binding&&jF.binding("util")}catch{}}(),ux=XSe,DY=ux&&ux.isTypedArray,$Se=DY?F4(DY):WSe,KK=$Se,ZSe=Object.prototype,QSe=ZSe.hasOwnProperty;function KSe(e,t){var i=ed(e),r=!i&&z4(e),s=!i&&!r&&DD(e),n=!i&&!r&&!s&&KK(e),c=i||r||s||n,u=c?cSe(e.length,String):[],p=u.length;for(var f in e)(t||QSe.call(e,f))&&!(c&&(f=="length"||s&&(f=="offset"||f=="parent")||n&&(f=="buffer"||f=="byteLength"||f=="byteOffset")||I4(f,p)))&&u.push(f);return u}var JK=KSe;function JSe(e,t){return function(i){return e(t(i))}}var eJ=JSe,eEe=eJ(Object.keys,Object),tEe=eEe,iEe=Object.prototype,rEe=iEe.hasOwnProperty;function nEe(e){if(!L4(e))return tEe(e);var t=[];for(var i in Object(e))rEe.call(e,i)&&i!="constructor"&&t.push(i);return t}var sEe=nEe;function oEe(e){return XK(e)?JK(e):sEe(e)}var k4=oEe;function aEe(e){var t=[];if(e!=null)for(var i in Object(e))t.push(i);return t}var lEe=aEe,cEe=Object.prototype,uEe=cEe.hasOwnProperty;function hEe(e){if(!Zu(e))return lEe(e);var t=L4(e),i=[];for(var r in e)r=="constructor"&&(t||!uEe.call(e,r))||i.push(r);return i}var dEe=hEe;function pEe(e){return XK(e)?JK(e,!0):dEe(e)}var xy=pEe,fEe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,mEe=/^\w*$/;function gEe(e,t){if(ed(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||qS(e)?!0:mEe.test(e)||!fEe.test(e)||t!=null&&e in Object(t)}var yEe=gEe,vEe=Yy(Object,"create"),SS=vEe;function _Ee(){this.__data__=SS?SS(null):{},this.size=0}var xEe=_Ee;function bEe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var wEe=bEe,SEe="__lodash_hash_undefined__",EEe=Object.prototype,MEe=EEe.hasOwnProperty;function TEe(e){var t=this.__data__;if(SS){var i=t[e];return i===SEe?void 0:i}return MEe.call(t,e)?t[e]:void 0}var AEe=TEe,CEe=Object.prototype,DEe=CEe.hasOwnProperty;function IEe(e){var t=this.__data__;return SS?t[e]!==void 0:DEe.call(t,e)}var PEe=IEe,REe="__lodash_hash_undefined__";function OEe(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=SS&&t===void 0?REe:t,this}var LEe=OEe;function Cx(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}Cx.prototype.clear=xEe;Cx.prototype.delete=wEe;Cx.prototype.get=AEe;Cx.prototype.has=PEe;Cx.prototype.set=LEe;var IY=Cx;function zEe(){this.__data__=[],this.size=0}var FEe=zEe;function kEe(e,t){for(var i=e.length;i--;)if(P4(e[i][0],t))return i;return-1}var SI=kEe,NEe=Array.prototype,BEe=NEe.splice;function UEe(e){var t=this.__data__,i=SI(t,e);if(i<0)return!1;var r=t.length-1;return i==r?t.pop():BEe.call(t,i,1),--this.size,!0}var jEe=UEe;function VEe(e){var t=this.__data__,i=SI(t,e);return i<0?void 0:t[i][1]}var GEe=VEe;function HEe(e){return SI(this.__data__,e)>-1}var WEe=HEe;function qEe(e,t){var i=this.__data__,r=SI(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this}var YEe=qEe;function Dx(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}Dx.prototype.clear=FEe;Dx.prototype.delete=jEe;Dx.prototype.get=GEe;Dx.prototype.has=WEe;Dx.prototype.set=YEe;var EI=Dx,XEe=Yy(Qu,"Map"),ES=XEe;function $Ee(){this.size=0,this.__data__={hash:new IY,map:new(ES||EI),string:new IY}}var ZEe=$Ee;function QEe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var KEe=QEe;function JEe(e,t){var i=e.__data__;return KEe(t)?i[typeof t=="string"?"string":"hash"]:i.map}var MI=JEe;function eMe(e){var t=MI(this,e).delete(e);return this.size-=t?1:0,t}var tMe=eMe;function iMe(e){return MI(this,e).get(e)}var rMe=iMe;function nMe(e){return MI(this,e).has(e)}var sMe=nMe;function oMe(e,t){var i=MI(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this}var aMe=oMe;function Ix(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}Ix.prototype.clear=ZEe;Ix.prototype.delete=tMe;Ix.prototype.get=rMe;Ix.prototype.has=sMe;Ix.prototype.set=aMe;var TI=Ix,lMe="Expected a function";function N4(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(lMe);var i=function(){var r=arguments,s=t?t.apply(this,r):r[0],n=i.cache;if(n.has(s))return n.get(s);var c=e.apply(this,r);return i.cache=n.set(s,c)||n,c};return i.cache=new(N4.Cache||TI),i}N4.Cache=TI;var cMe=N4,uMe=500;function hMe(e){var t=cMe(e,function(r){return i.size===uMe&&i.clear(),r}),i=t.cache;return t}var dMe=hMe,pMe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,fMe=/\\(\\)?/g,mMe=dMe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(pMe,function(i,r,s,n){t.push(s?n.replace(fMe,"$1"):r||i)}),t}),gMe=mMe;function yMe(e){return e==null?"":Vbe(e)}var vMe=yMe;function _Me(e,t){return ed(e)?e:yEe(e,t)?[e]:gMe(vMe(e))}var Px=_Me,xMe=1/0;function bMe(e){if(typeof e=="string"||qS(e))return e;var t=e+"";return t=="0"&&1/e==-xMe?"-0":t}var AI=bMe;function wMe(e,t){t=Px(t,e);for(var i=0,r=t.length;e!=null&&i<r;)e=e[AI(t[i++])];return i&&i==r?e:void 0}var tJ=wMe;function SMe(e,t){for(var i=-1,r=t.length,s=e.length;++i<r;)e[s+i]=t[i];return e}var B4=SMe,PY=Jc?Jc.isConcatSpreadable:void 0;function EMe(e){return ed(e)||z4(e)||!!(PY&&e&&e[PY])}var MMe=EMe;function iJ(e,t,i,r,s){var n=-1,c=e.length;for(i||(i=MMe),s||(s=[]);++n<c;){var u=e[n];t>0&&i(u)?t>1?iJ(u,t-1,i,r,s):B4(s,u):r||(s[s.length]=u)}return s}var TMe=iJ;function AMe(e){var t=e==null?0:e.length;return t?TMe(e,1):[]}var CMe=AMe;function DMe(e){return Gwe(iSe(e,void 0,CMe),e+"")}var rJ=DMe,IMe=eJ(Object.getPrototypeOf,Object),U4=IMe,PMe="[object Object]",RMe=Function.prototype,OMe=Object.prototype,nJ=RMe.toString,LMe=OMe.hasOwnProperty,zMe=nJ.call(Object);function FMe(e){if(!Mp(e)||Wy(e)!=PMe)return!1;var t=U4(e);if(t===null)return!0;var i=LMe.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&nJ.call(i)==zMe}var kMe=FMe;function NMe(e,t,i){var r=-1,s=e.length;t<0&&(t=-t>s?0:s+t),i=i>s?s:i,i<0&&(i+=s),s=t>i?0:i-t>>>0,t>>>=0;for(var n=Array(s);++r<s;)n[r]=e[r+t];return n}var BMe=NMe;function UMe(){this.__data__=new EI,this.size=0}var jMe=UMe;function VMe(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}var GMe=VMe;function HMe(e){return this.__data__.get(e)}var WMe=HMe;function qMe(e){return this.__data__.has(e)}var YMe=qMe,XMe=200;function $Me(e,t){var i=this.__data__;if(i instanceof EI){var r=i.__data__;if(!ES||r.length<XMe-1)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new TI(r)}return i.set(e,t),this.size=i.size,this}var ZMe=$Me;function Rx(e){var t=this.__data__=new EI(e);this.size=t.size}Rx.prototype.clear=jMe;Rx.prototype.delete=GMe;Rx.prototype.get=WMe;Rx.prototype.has=YMe;Rx.prototype.set=ZMe;var J2=Rx;function QMe(e,t){return e&&YS(t,k4(t),e)}var KMe=QMe;function JMe(e,t){return e&&YS(t,xy(t),e)}var eTe=JMe,sJ=typeof exports=="object"&&exports&&!exports.nodeType&&exports,RY=sJ&&typeof module=="object"&&module&&!module.nodeType&&module,tTe=RY&&RY.exports===sJ,OY=tTe?Qu.Buffer:void 0,LY=OY?OY.allocUnsafe:void 0;function iTe(e,t){if(t)return e.slice();var i=e.length,r=LY?LY(i):new e.constructor(i);return e.copy(r),r}var rTe=iTe;function nTe(e,t){for(var i=-1,r=e==null?0:e.length,s=0,n=[];++i<r;){var c=e[i];t(c,i,e)&&(n[s++]=c)}return n}var sTe=nTe;function oTe(){return[]}var oJ=oTe,aTe=Object.prototype,lTe=aTe.propertyIsEnumerable,zY=Object.getOwnPropertySymbols,cTe=zY?function(e){return e==null?[]:(e=Object(e),sTe(zY(e),function(t){return lTe.call(e,t)}))}:oJ,j4=cTe;function uTe(e,t){return YS(e,j4(e),t)}var hTe=uTe,dTe=Object.getOwnPropertySymbols,pTe=dTe?function(e){for(var t=[];e;)B4(t,j4(e)),e=U4(e);return t}:oJ,aJ=pTe;function fTe(e,t){return YS(e,aJ(e),t)}var mTe=fTe;function gTe(e,t,i){var r=t(e);return ed(e)?r:B4(r,i(e))}var lJ=gTe;function yTe(e){return lJ(e,k4,j4)}var MN=yTe;function vTe(e){return lJ(e,xy,aJ)}var cJ=vTe,_Te=Yy(Qu,"DataView"),TN=_Te,xTe=Yy(Qu,"Promise"),AN=xTe,bTe=Yy(Qu,"Set"),CN=bTe,FY="[object Map]",wTe="[object Object]",kY="[object Promise]",NY="[object Set]",BY="[object WeakMap]",UY="[object DataView]",STe=qy(TN),ETe=qy(ES),MTe=qy(AN),TTe=qy(CN),ATe=qy(EN),dy=Wy;(TN&&dy(new TN(new ArrayBuffer(1)))!=UY||ES&&dy(new ES)!=FY||AN&&dy(AN.resolve())!=kY||CN&&dy(new CN)!=NY||EN&&dy(new EN)!=BY)&&(dy=function(e){var t=Wy(e),i=t==wTe?e.constructor:void 0,r=i?qy(i):"";if(r)switch(r){case STe:return UY;case ETe:return FY;case MTe:return kY;case TTe:return NY;case ATe:return BY}return t});var MS=dy,CTe=Object.prototype,DTe=CTe.hasOwnProperty;function ITe(e){var t=e.length,i=new e.constructor(t);return t&&typeof e[0]=="string"&&DTe.call(e,"index")&&(i.index=e.index,i.input=e.input),i}var PTe=ITe,RTe=Qu.Uint8Array,ID=RTe;function OTe(e){var t=new e.constructor(e.byteLength);return new ID(t).set(new ID(e)),t}var V4=OTe;function LTe(e,t){var i=t?V4(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}var zTe=LTe,FTe=/\w*$/;function kTe(e){var t=new e.constructor(e.source,FTe.exec(e));return t.lastIndex=e.lastIndex,t}var NTe=kTe,jY=Jc?Jc.prototype:void 0,VY=jY?jY.valueOf:void 0;function BTe(e){return VY?Object(VY.call(e)):{}}var UTe=BTe;function jTe(e,t){var i=t?V4(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}var VTe=jTe,GTe="[object Boolean]",HTe="[object Date]",WTe="[object Map]",qTe="[object Number]",YTe="[object RegExp]",XTe="[object Set]",$Te="[object String]",ZTe="[object Symbol]",QTe="[object ArrayBuffer]",KTe="[object DataView]",JTe="[object Float32Array]",eAe="[object Float64Array]",tAe="[object Int8Array]",iAe="[object Int16Array]",rAe="[object Int32Array]",nAe="[object Uint8Array]",sAe="[object Uint8ClampedArray]",oAe="[object Uint16Array]",aAe="[object Uint32Array]";function lAe(e,t,i){var r=e.constructor;switch(t){case QTe:return V4(e);case GTe:case HTe:return new r(+e);case KTe:return zTe(e,i);case JTe:case eAe:case tAe:case iAe:case rAe:case nAe:case sAe:case oAe:case aAe:return VTe(e,i);case WTe:return new r;case qTe:case $Te:return new r(e);case YTe:return NTe(e);case XTe:return new r;case ZTe:return UTe(e)}}var cAe=lAe;function uAe(e){return typeof e.constructor=="function"&&!L4(e)?Awe(U4(e)):{}}var hAe=uAe,dAe="[object Map]";function pAe(e){return Mp(e)&&MS(e)==dAe}var fAe=pAe,GY=ux&&ux.isMap,mAe=GY?F4(GY):fAe,gAe=mAe,yAe="[object Set]";function vAe(e){return Mp(e)&&MS(e)==yAe}var _Ae=vAe,HY=ux&&ux.isSet,xAe=HY?F4(HY):_Ae,bAe=xAe,wAe=1,SAe=2,EAe=4,uJ="[object Arguments]",MAe="[object Array]",TAe="[object Boolean]",AAe="[object Date]",CAe="[object Error]",hJ="[object Function]",DAe="[object GeneratorFunction]",IAe="[object Map]",PAe="[object Number]",dJ="[object Object]",RAe="[object RegExp]",OAe="[object Set]",LAe="[object String]",zAe="[object Symbol]",FAe="[object WeakMap]",kAe="[object ArrayBuffer]",NAe="[object DataView]",BAe="[object Float32Array]",UAe="[object Float64Array]",jAe="[object Int8Array]",VAe="[object Int16Array]",GAe="[object Int32Array]",HAe="[object Uint8Array]",WAe="[object Uint8ClampedArray]",qAe="[object Uint16Array]",YAe="[object Uint32Array]",Ls={};Ls[uJ]=Ls[MAe]=Ls[kAe]=Ls[NAe]=Ls[TAe]=Ls[AAe]=Ls[BAe]=Ls[UAe]=Ls[jAe]=Ls[VAe]=Ls[GAe]=Ls[IAe]=Ls[PAe]=Ls[dJ]=Ls[RAe]=Ls[OAe]=Ls[LAe]=Ls[zAe]=Ls[HAe]=Ls[WAe]=Ls[qAe]=Ls[YAe]=!0;Ls[CAe]=Ls[hJ]=Ls[FAe]=!1;function eD(e,t,i,r,s,n){var c,u=t&wAe,p=t&SAe,f=t&EAe;if(i&&(c=s?i(e,r,s,n):i(e)),c!==void 0)return c;if(!Zu(e))return e;var x=ed(e);if(x){if(c=PTe(e),!u)return Pwe(e,c)}else{var w=MS(e),E=w==hJ||w==DAe;if(DD(e))return rTe(e,u);if(w==dJ||w==uJ||E&&!s){if(c=p||E?{}:hAe(e),!u)return p?mTe(e,eTe(c,e)):hTe(e,KMe(c,e))}else{if(!Ls[w])return s?e:{};c=cAe(e,w,u)}}n||(n=new J2);var A=n.get(e);if(A)return A;n.set(e,c),bAe(e)?e.forEach(function(O){c.add(eD(O,t,i,O,e,n))}):gAe(e)&&e.forEach(function(O,k){c.set(k,eD(O,t,i,k,e,n))});var I=f?p?cJ:MN:p?xy:k4,P=x?void 0:I(e);return Wwe(P||e,function(O,k){P&&(k=O,O=e[k]),R4(c,k,eD(O,t,i,k,e,n))}),c}var pJ=eD,XAe=1,$Ae=4;function ZAe(e){return pJ(e,XAe|$Ae)}var CI=ZAe,QAe="__lodash_hash_undefined__";function KAe(e){return this.__data__.set(e,QAe),this}var JAe=KAe;function eCe(e){return this.__data__.has(e)}var tCe=eCe;function PD(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new TI;++t<i;)this.add(e[t])}PD.prototype.add=PD.prototype.push=JAe;PD.prototype.has=tCe;var iCe=PD;function rCe(e,t){for(var i=-1,r=e==null?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}var nCe=rCe;function sCe(e,t){return e.has(t)}var oCe=sCe,aCe=1,lCe=2;function cCe(e,t,i,r,s,n){var c=i&aCe,u=e.length,p=t.length;if(u!=p&&!(c&&p>u))return!1;var f=n.get(e),x=n.get(t);if(f&&x)return f==t&&x==e;var w=-1,E=!0,A=i&lCe?new iCe:void 0;for(n.set(e,t),n.set(t,e);++w<u;){var I=e[w],P=t[w];if(r)var O=c?r(P,I,w,t,e,n):r(I,P,w,e,t,n);if(O!==void 0){if(O)continue;E=!1;break}if(A){if(!nCe(t,function(k,U){if(!oCe(A,U)&&(I===k||s(I,k,i,r,n)))return A.push(U)})){E=!1;break}}else if(!(I===P||s(I,P,i,r,n))){E=!1;break}}return n.delete(e),n.delete(t),E}var fJ=cCe;function uCe(e){var t=-1,i=Array(e.size);return e.forEach(function(r,s){i[++t]=[s,r]}),i}var hCe=uCe;function dCe(e){var t=-1,i=Array(e.size);return e.forEach(function(r){i[++t]=r}),i}var pCe=dCe,fCe=1,mCe=2,gCe="[object Boolean]",yCe="[object Date]",vCe="[object Error]",_Ce="[object Map]",xCe="[object Number]",bCe="[object RegExp]",wCe="[object Set]",SCe="[object String]",ECe="[object Symbol]",MCe="[object ArrayBuffer]",TCe="[object DataView]",WY=Jc?Jc.prototype:void 0,VF=WY?WY.valueOf:void 0;function ACe(e,t,i,r,s,n,c){switch(i){case TCe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case MCe:return!(e.byteLength!=t.byteLength||!n(new ID(e),new ID(t)));case gCe:case yCe:case xCe:return P4(+e,+t);case vCe:return e.name==t.name&&e.message==t.message;case bCe:case SCe:return e==t+"";case _Ce:var u=hCe;case wCe:var p=r&fCe;if(u||(u=pCe),e.size!=t.size&&!p)return!1;var f=c.get(e);if(f)return f==t;r|=mCe,c.set(e,t);var x=fJ(u(e),u(t),r,s,n,c);return c.delete(e),x;case ECe:if(VF)return VF.call(e)==VF.call(t)}return!1}var CCe=ACe,DCe=1,ICe=Object.prototype,PCe=ICe.hasOwnProperty;function RCe(e,t,i,r,s,n){var c=i&DCe,u=MN(e),p=u.length,f=MN(t),x=f.length;if(p!=x&&!c)return!1;for(var w=p;w--;){var E=u[w];if(!(c?E in t:PCe.call(t,E)))return!1}var A=n.get(e),I=n.get(t);if(A&&I)return A==t&&I==e;var P=!0;n.set(e,t),n.set(t,e);for(var O=c;++w<p;){E=u[w];var k=e[E],U=t[E];if(r)var j=c?r(U,k,E,t,e,n):r(k,U,E,e,t,n);if(!(j===void 0?k===U||s(k,U,i,r,n):j)){P=!1;break}O||(O=E=="constructor")}if(P&&!O){var V=e.constructor,$=t.constructor;V!=$&&"constructor"in e&&"constructor"in t&&!(typeof V=="function"&&V instanceof V&&typeof $=="function"&&$ instanceof $)&&(P=!1)}return n.delete(e),n.delete(t),P}var OCe=RCe,LCe=1,qY="[object Arguments]",YY="[object Array]",n2="[object Object]",zCe=Object.prototype,XY=zCe.hasOwnProperty;function FCe(e,t,i,r,s,n){var c=ed(e),u=ed(t),p=c?YY:MS(e),f=u?YY:MS(t);p=p==qY?n2:p,f=f==qY?n2:f;var x=p==n2,w=f==n2,E=p==f;if(E&&DD(e)){if(!DD(t))return!1;c=!0,x=!1}if(E&&!x)return n||(n=new J2),c||KK(e)?fJ(e,t,i,r,s,n):CCe(e,t,p,i,r,s,n);if(!(i&LCe)){var A=x&&XY.call(e,"__wrapped__"),I=w&&XY.call(t,"__wrapped__");if(A||I){var P=A?e.value():e,O=I?t.value():t;return n||(n=new J2),s(P,O,i,r,n)}}return E?(n||(n=new J2),OCe(e,t,i,r,s,n)):!1}var kCe=FCe;function mJ(e,t,i,r,s){return e===t?!0:e==null||t==null||!Mp(e)&&!Mp(t)?e!==e&&t!==t:kCe(e,t,i,r,mJ,s)}var NCe=mJ;function BCe(e,t){return e!=null&&t in Object(e)}var UCe=BCe;function jCe(e,t,i){t=Px(t,e);for(var r=-1,s=t.length,n=!1;++r<s;){var c=AI(t[r]);if(!(n=e!=null&&i(e,c)))break;e=e[c]}return n||++r!=s?n:(s=e==null?0:e.length,!!s&&O4(s)&&I4(c,s)&&(ed(e)||z4(e)))}var VCe=jCe;function GCe(e,t){return e!=null&&VCe(e,t,UCe)}var HCe=GCe,WCe=function(){return Qu.Date.now()},GF=WCe,qCe="Expected a function",YCe=Math.max,XCe=Math.min;function $Ce(e,t,i){var r,s,n,c,u,p,f=0,x=!1,w=!1,E=!0;if(typeof e!="function")throw new TypeError(qCe);t=wY(t)||0,Zu(i)&&(x=!!i.leading,w="maxWait"in i,n=w?YCe(wY(i.maxWait)||0,t):n,E="trailing"in i?!!i.trailing:E);function A(Y){var J=r,X=s;return r=s=void 0,f=Y,c=e.apply(X,J),c}function I(Y){return f=Y,u=setTimeout(k,t),x?A(Y):c}function P(Y){var J=Y-p,X=Y-f,ee=t-J;return w?XCe(ee,n-X):ee}function O(Y){var J=Y-p,X=Y-f;return p===void 0||J>=t||J<0||w&&X>=n}function k(){var Y=GF();if(O(Y))return U(Y);u=setTimeout(k,P(Y))}function U(Y){return u=void 0,E&&r?A(Y):(r=s=void 0,c)}function j(){u!==void 0&&clearTimeout(u),f=0,r=p=s=u=void 0}function V(){return u===void 0?c:U(GF())}function $(){var Y=GF(),J=O(Y);if(r=arguments,s=this,p=Y,J){if(u===void 0)return I(p);if(w)return clearTimeout(u),u=setTimeout(k,t),A(p)}return u===void 0&&(u=setTimeout(k,t)),c}return $.cancel=j,$.flush=V,$}var G4=$Ce;function ZCe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var QCe=ZCe;function KCe(e,t){return e>t}var JCe=KCe;function e2e(e,t){return t.length<2?e:tJ(e,BMe(t,0,-1))}var t2e=e2e;function i2e(e,t){return NCe(e,t)}var H4=i2e;function r2e(e,t,i){for(var r=-1,s=e.length;++r<s;){var n=e[r],c=t(n);if(c!=null&&(u===void 0?c===c&&!qS(c):i(c,u)))var u=c,p=n}return p}var n2e=r2e;function s2e(e){return e&&e.length?n2e(e,WK,JCe):void 0}var o2e=s2e;function a2e(e,t){return t=Px(t,e),e=t2e(e,t),e==null||delete e[AI(QCe(t))]}var l2e=a2e;function c2e(e){return kMe(e)?void 0:e}var u2e=c2e,h2e=1,d2e=2,p2e=4,f2e=rJ(function(e,t){var i={};if(e==null)return i;var r=!1;t=GK(t,function(n){return n=Px(n,e),r||(r=n.length>1),n}),YS(e,cJ(e),i),r&&(i=pJ(i,h2e|d2e|p2e,u2e));for(var s=t.length;s--;)l2e(i,t[s]);return i}),DN=f2e;function m2e(e,t,i,r){if(!Zu(e))return e;t=Px(t,e);for(var s=-1,n=t.length,c=n-1,u=e;u!=null&&++s<n;){var p=AI(t[s]),f=i;if(p==="__proto__"||p==="constructor"||p==="prototype")return e;if(s!=c){var x=u[p];f=r?r(x,p,u):void 0,f===void 0&&(f=Zu(x)?x:I4(t[s+1])?[]:{})}R4(u,p,f),u=u[p]}return e}var g2e=m2e;function y2e(e,t,i){for(var r=-1,s=t.length,n={};++r<s;){var c=t[r],u=tJ(e,c);i(u,c)&&g2e(n,Px(c,e),u)}return n}var v2e=y2e;function _2e(e,t){return v2e(e,t,function(i,r){return HCe(e,r)})}var x2e=_2e,b2e=rJ(function(e,t){return e==null?{}:x2e(e,t)}),_p=b2e,w2e="Expected a function";function S2e(e,t,i){var r=!0,s=!0;if(typeof e!="function")throw new TypeError(w2e);return Zu(i)&&(r="leading"in i?!!i.leading:r,s="trailing"in i?!!i.trailing:s),G4(e,t,{leading:r,maxWait:t,trailing:s})}var E2e=S2e;function gJ(e){for(let t of Object.keys(e))e[t]===void 0&&delete e[t];return e}function eu(e,t){return Object.setPrototypeOf(e,t),e}var M2e=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),T2e=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),A2e=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||DI&&"ontouchend"in document,C2e=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,D2e=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,I2e=()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)},P2e=()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]},R2e=()=>{if(typeof window>"u")return;let e=new URLSearchParams(window.location.search).get("desktop-app-version");return e?(window.localStorage.setItem("desktop-app-version",e),e):window.localStorage.getItem("desktop-app-version")??"0.0.6"},yJ=M2e(),hYe=yJ?R2e():void 0,DI=T2e(),XS=A2e(),O2e=C2e(),fc=D2e(),$Y=I2e(),L2e=Number(P2e());function vJ(e){return Array.isArray(e)?e:[e]}function _J(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}function s2(e){return DI?e.metaKey:e.ctrlKey}function z2e(e){return e.wheelDeltaY===0||e.deltaY===0?DI&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120?!1:e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX||e.wheelDeltaX===-3*window.devicePixelRatio*e.deltaX:e.deltaMode===0:e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY||e.wheelDeltaY===-3*window.devicePixelRatio*e.deltaY:e.deltaMode===0}var Pr=[],RD={},Qw={},tD={};function xJ(e){Pr.includes(e)||Pr.push(e)}function Z_(e){delete RD[e.pointerId];for(let t=0;t<Pr.length;t++)if(Pr[t].pointerId===e.pointerId){Pr.splice(t,1);break}}function F2e(){Pr.splice(0,Pr.length)}function OD(e){if(e.pointerType!=="touch")return;let t=RD[e.pointerId];t===void 0&&(t={x:0,y:0},RD[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function HF(e){let t=e.pointerId===Pr[0].pointerId?Pr[1]:Pr[0];return RD[t.pointerId]}function bJ(e){Qw[e.key]=!0,tD[e.key]=tD[e.key]===void 0?1:tD[e.key]+1}function wJ(e){if(DI&&Qw.Meta)for(let t in Qw)Qw[t]=!1;else Qw[e.key]=!1;tD={}}function k2e(e){e.addEventListener("pointerdown",xJ,!0),e.addEventListener("pointerdown",OD,!0),e.addEventListener("pointermove",OD,!0),e.addEventListener("pointerup",Z_,!0),e.addEventListener("pointercancel",Z_,!0),e.addEventListener("pointerleave",Z_,!0),window.addEventListener("keydown",bJ,!0),window.addEventListener("keyup",wJ,!0)}function N2e(e){e.removeEventListener("pointerdown",xJ,!0),e.removeEventListener("pointerdown",OD,!0),e.removeEventListener("pointermove",OD,!0),e.removeEventListener("pointerup",Z_,!0),e.removeEventListener("pointercancel",Z_,!0),e.removeEventListener("pointerleave",Z_,!0),window.removeEventListener("keydown",bJ,!0),window.removeEventListener("keyup",wJ,!0)}var SJ,B2e=new Promise(e=>{SJ=e}),o2;function U2e(){if(o2)return o2;function e(){return jn(this,null,function*(){let t="https://unpkg.com/@splinetool/navmesh-wasm@1.9.20/build",i=import("./chunk-KTMRIHXN.js"),[r,s]=yield Promise.all([i,fetch(`${t}/navmesh.wasm`).then(u=>u.arrayBuffer())]),n=r.default,c=yield n({wasmBinary:s});SJ(c)})}return o2=e(),o2}var EJ,j2e=new Promise(e=>{EJ=e}),a2;function V2e(){if(a2)return a2;function e(){return jn(this,null,function*(){let t=yield import("./chunk-X6BYTPOU.js");yield t.init(),EJ(t)})}return a2=e(),a2}var Mr=class{modifyById(e,t){let i=this;if(i[e]===void 0)throw new Error("not expected");{let r=pt(me({},i),{[e]:t});return Object.setPrototypeOf(r,Mr.prototype),r}}add(e,t){return this.runOp({type:1,id:e,data:t})?.data??this}runOp(e){let t=this;if(e.type===1){let i=t[e.id],r;i===void 0?r={type:2,id:e.id}:r={type:1,id:e.id,data:i};let{id:s,data:n}=e,c=pt(me({},t),{[s]:n});return Object.setPrototypeOf(c,Mr.prototype),{data:c,actual:e,reverse:r}}else if(e.type===2){let{id:i}=e,r=t[i];if(r===void 0)return null;{let s=me({},t);return Object.setPrototypeOf(s,Mr.prototype),delete s[i],{data:s,actual:e,reverse:{type:1,id:i,data:r}}}}return null}};function W4(e){if(e.deepFreeze!==void 0){e.deepFreeze(e);return}let t=Object.getOwnPropertyNames(e);for(let i of t){let r=e[i];r&&typeof r=="object"&&W4(r)}return Object.freeze(e)}function G2e(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}var MJ=class extends Error{};function WF(e){let t=me({},e);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function nm(e,t,i){if(e===void 0?t===void 0?(e=0,t=10):e=t-10:t===void 0&&(t=e+10),e>t){let n=e;e=t,t=n}let r=[],s=1/(i+1);for(let n=0;n<i;n++){let c=e+(t-e)*(n+.75+Math.random()*.5)*s;r.push(c)}return r}function q4(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function H2e(){return typeof process<"u"}function TJ(e,t){for(let i of e)t(i.id,i.data)!==!0&&TJ(i.children,t)}function AJ(e,t){if(t(e.id,e.data)!==!0)for(let i of e.children)AJ(i,t)}var Pa=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Pa.prototype)}deepFreeze(){let e=0;for(;e<this.length;)W4(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}rootAcestor(e){for(;e;){let t=this.parent(e);if(t)e=t;else return e}return e}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){return this.get(e)?.data}has(e){return this.childrenOf(e)!==void 0}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){return e===null?this:this.get(e)?.children}traverseFrom(e,t){if(e===null)this.traverse(t);else{let i=this.get(e);i&&AJ(i,t)}}traverse(e){TJ(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return e===null?this:this.get(e).children}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this.parent(e),r=this.childrenArray(i),s=r.findIndex(c=>c.id===e);if(s<0)throw new Error("not expected");let n=r[s];return r=[...r],r[s]=pt(me({},n),{data:t}),this.modifyArrayBy(i,r)}}modifyArrayBy(e,t){let i=e,r=t;for(;i!==null;){let n=r,c=i;if(i=this.parent(i),i===void 0)throw new Error;r=this.childrenArray(i);let u=r.findIndex(p=>p.id===c);if(u<0)throw new Error;r=[...r],r[u]=pt(me({},r[u]),{children:n})}Object.setPrototypeOf(r,Pa.prototype);let s=r;return s.fillCaches(),s}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(this.get(e)!==void 0)return!0;for(let i of t)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(e){let{parent:t,fi:i,id:r,data:s,children:n}=e;if(t!==null&&this.get(t)===void 0||this.checkDuplicatedIdRec(e))return null;{let c=t,u=this.childrenArray(c),p={fi:i,id:r,data:s,children:n};return u=[...u,p],u.sort((f,x)=>f.fi-x.fi),e.localIndex=u.indexOf(p),{data:this.modifyArrayBy(c,u),actual:e,reverse:{type:8,id:r}}}}deleteOp(e){let{id:t}=e;if(this.get(t)===null)return null;{let i=this.parent(t);if(i===void 0)return null;let r=this.childrenArray(i),s=r.findIndex(c=>c.id===t);e.localIndex=s,r=[...r];let n=r.splice(s,1)[0];return{data:this.modifyArrayBy(i,r),actual:e,reverse:pt(me({type:7},n),{parent:i})}}}moveOp(e){let{parent:t,fi:i,id:r}=e;if(t!==null&&this.get(t)===void 0)return this.deleteOp({type:8,id:r});if(t!==null){let w=t;for(;w!==null;){if(w===void 0)throw new Error;if(w===r)throw new MJ("cyclic tree");w=this.parent(w)}}let s=this.parent(r);if(s===void 0)return null;let n=s,c=this.childrenArray(s),u=c.findIndex(w=>w.id===r);c=[...c];let p=c.splice(u,1)[0],f=this.modifyArrayBy(s,c);s=t,c=f.childrenArray(s);let x=p.fi;return p=pt(me({},p),{fi:i}),c=[...c,p],c.sort((w,E)=>w.fi-E.fi),e.localIndex=c.indexOf(p),f=f.modifyArrayBy(s,c),{data:f,actual:e,reverse:{type:9,parent:n,fi:x,id:r}}}previous(e,t){if(t===null){let r=this.childrenArray(e);return r.length===0?null:r[r.length-1].id}let i=null;for(let r of this.childrenArray(e)){if(r.id===t)return i;i=r.id}return null}traverseSortNext(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(s=>s.id===e)+1;if(r<i.length)return i[r].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(s=>s.id===e)-1;return r>=0?this.traverseSortPrevious(i[r].id):t}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(me(me({},i),r))}t.sort((i,r)=>G2e(i.sortKey,r.sortKey));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],r=this.get(t),s=r;if(r!==void 0){for(;t;)i.splice(0,0,r.fi),t=this.parent(t),t!==null&&(r=this.get(t));return pt(me({},s),{sortKey:i})}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let r=this.childrenArray(e);if(t===null){if(r.length===0)return nm(0,i,i);{let s=r[0].fi;return nm(s-i,s,i)}}else{let s=this.get(t);if(s===void 0||this.parent(t)!==e)throw new Error("illegal args");let n=r.find(c=>c.fi>s.fi);if(n===void 0){let c=r[r.length-1].fi;return nm(c,c+i,i)}else return nm(s.fi,n.fi,i)}}},LD;(e=>{function t(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let s=r.props,n={},c=[...i],u=!1;if(s)for(let p of Object.keys(s)){let f=parseInt(p);if(isNaN(f))throw new Error("wrong index");n[p]=c[f],c[f]=s[p],u=!0}return u?{data:c,actual:r,reverse:{type:0,props:n}}:null}else{let s=r.props,n={},c=me({},i),u=!1;if(s)for(let p of Object.keys(s)){n[p]=c[p];let f=s[p];f===void 0?delete c[p]:c[p]=f,u=!0}return u?{data:c,actual:r,reverse:{type:0,props:n}}:null}}e.runOp=t})(LD||(LD={}));var pr=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,pr.prototype)}deepFreeze(){let e=0;for(;e<this.length;)W4(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){return this.get(e)?.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this,r=i.findIndex(n=>n.id===e);if(r<0)throw new Error("not expected");let s=i[r];return i=[...i],i[r]=pt(me({},s),{data:t}),this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,pr.prototype);let t=e;return H2e()||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:i,data:r}=e,s=this,n={fi:t,id:i,data:r};return s=[...s,n],s.sort((c,u)=>c.fi-u.fi),e.localIndex=s.indexOf(n),{data:this.modifyArrayBy(s),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,r=i.findIndex(n=>n.id===t);if(r===-1)return null;e.localIndex=r,i=[...i];let s=i.splice(r,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:me({type:4},s)}}moveOp(e){let{fi:t,id:i}=e,r=this;r=[...r];let s=r.findIndex(u=>u.id===i);if(s===-1)return null;let n=r[s].fi,c=pt(me({},r[s]),{fi:t});return r[s]=c,r.sort((u,p)=>u.fi-p.fi),e.localIndex=r.indexOf(c),{data:this.modifyArrayBy(r),actual:e,reverse:{type:6,fi:n,id:i}}}previous(e){if(e===null)return this.length===0?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(e===null){if(i.length===0)return nm(0,t,t);{let r=i[0].fi;return nm(r-t,r,t)}}else{let r=this.get(e);if(r===void 0)throw new Error("illegal args");let s=i.find(n=>n.fi>r.fi);if(s===void 0){let n=i[i.length-1].fi;return nm(n,n+t,t)}else return nm(r.fi,s.fi,t)}}};function hx(e){return e&&typeof e=="object"&&e instanceof Do}var Do=class{unusedFunOverridesTable(e){}runOp(e){let t=[],i=this,r=0,s={};for(;r<e.path.length;){if(t.push(i),i=i===void 0?void 0:i[e.path[r]],i!==void 0&&!hx(i))return null;r+=1}i=i?WF(i):new Do;for(let[u,p]of Object.entries(e.props)){let f=i[u];s[u]=f,p===void 0?delete i[u]:i[u]=p}for(;r>0;){if(Object.keys(i).length===0){let u=t[r-1];u&&(i=WF(u),delete i[e.path[r-1]])}else{let u=t[r-1];if(u){let p=WF(u);p[e.path[r-1]]=i,i=p}else{let p=new Do;p[e.path[r-1]]=i,i=p}}r-=1}let n=Object.setPrototypeOf(i,Do.prototype),c=pt(me({},e),{props:s});return{data:n,actual:e,reverse:c}}},pm;(e=>{function t(s,n){return TS(s,n)??s}e.apply=t;function i(s,n){return X4(s,n)}e.merge=i;function r(s,n){let c=0,u=n.path,p=s;for(;c<u.length&&p!==void 0;){if(p=Zo.zoomOnce(p,u[c]),p===void 0)return n;if(!hx(p))return;c+=1}if(p===void 0)return n;if(hx(p))if(n.type===0){let f=me({},n.props);for(let x of Object.keys(p))delete f[x];return pt(me({},n),{props:f})}else if(n.type===1||n.type===4||n.type===7){let f=Y4([n],p);return f?(console.log(f),f):n}else return n}e.filterOp=r})(pm||(pm={}));function Y4(e,t){if(t===void 0)return;let i=!1,r=e.map(s=>{let n=s.id,c=TS(s.data,t[n]);if(i=i||c!==void 0,c===void 0&&(c=s.data),s.children){let u=Y4(s.children,t);return u!==void 0?i=!0:u=s.children,pt(me({},s),{id:n,data:c,children:u})}else return pt(me({},s),{id:n,data:c})});if(i)return r}function W2e(e,t){if(t===void 0)return;let i=!1,r=e.map(s=>{let n=s.id,c=TS(s.data,t[n]);return i=i||c!==void 0,c===void 0&&(c=s.data),pt(me({},s),{id:n,data:c})});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}function TS(e,t){if(!hx(t))return t;if(e instanceof Pa){let i=Y4(e,t);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}else{if(e instanceof pr)return W2e(e,t);if(Array.isArray(e)){let i=!1,r=e.map((s,n)=>{let c=TS(s,t[n]);return i=i||c!==void 0,c===void 0&&(c=s),c});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else{if(e instanceof Do)return X4(e,t);if(e&&typeof e=="object"){let i={},r=!1;for(let[s,n]of Object.entries(e)){let c=TS(n,t[s]);r=r||c!==void 0,c===void 0&&(c=n),i[s]=c}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}}}function X4(e,t){if(e===void 0)return t;if(t===void 0)return e;if(!hx(t))return t;if(!hx(e))return pm.apply(e,t);let i=new Set;for(let s of Object.keys(e))i.add(s);for(let s of Object.keys(t))i.add(s);let r=new Do;for(let s of i){let n=X4(e===void 0?void 0:e[s],t===void 0?void 0:t[s]);r[s]=n}return r}function q2e(e,t){let i={cur:[],result:[],len:0};return e=AS(e,t,i)??e,[e,i.result]}function zD(e,t){return e===null?null:(e.cur[e.len]=t,e.len+=1,e)}function FD(e){e&&(e.len-=1)}function Y2e(e){if(e===null)return null;e.result.push(e.cur.slice(0,e.len))}function CJ(e,t,i){let r=!1,s=e.map(n=>{let c=n.id,u=t[c];if(u!==void 0&&typeof u=="string"&&(r=!0,c=u,i!==null))throw new Error("not supported");let p=AS(n.data,t,zD(i,c));FD(i),r=r||p!==void 0,p===void 0&&(p=n.data);let f=CJ(n.children,t,i);return f!==void 0?r=!0:f=n.children,pt(me({},n),{id:c,data:p,children:f})});if(r)return s}function X2e(e,t,i){let r=!1,s=e.map(n=>{let c=n.id,u=t[c];if(u!==void 0&&typeof u=="string"&&(r=!0,c=u,i!==null))throw new Error("not supported");let p=AS(n.data,t,zD(i,c));return FD(i),r=r||p!==void 0,p===void 0&&(p=n.data),pt(me({},n),{id:c,data:p})});if(r)return Object.setPrototypeOf(s,Object.getPrototypeOf(e)),s}function AS(e,t,i){if(e instanceof Pa){let r=CJ(e,t,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}else{if(e instanceof pr)return X2e(e,t,i);if(Array.isArray(e)){let r=!1,s=e.map((n,c)=>{let u=AS(n,t,zD(i,c));return FD(i),r=r||u!==void 0,u===void 0&&(u=n),u});return r?(Object.setPrototypeOf(s,Object.getPrototypeOf(e)),s):void 0}else if(e&&typeof e=="object"&&!q4(e)){let r={},s=!1;for(let[n,c]of Object.entries(e))if(n!=="name"&&n!=="variableId"){let u=t[n];if(typeof u=="string"){if(i!==null)throw new Error("not supported");s=!0,n=u}let p=AS(c,t,zD(i,n));FD(i),s=s||p!==void 0,p===void 0&&(p=c),r[n]=p}else r[n]=c;return s?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else if(typeof e=="string"){let r=t[e];return r!==void 0&&Y2e(i),r}else return}}var kD;(e=>{function t(i,r){let s=Zo.zoom(r,i.path);if(typeof s=="object"){let n={};for(let c of Object.keys(i.props))n[c]=s[c];return pt(me({},i),{props:n})}else return pt(me({},i),{props:{}})}e.replaceProps=t})(kD||(kD={}));var pa;(e=>{function t(p,f){return pt(me({},p),{path:p.path.slice(f)})}e.drop=t;function i(p,f){return r(p,f)?.data??p}e.applySimple=i;function r(p,f){let x=f.path;for(var w=[];;){let E;if(p instanceof Do&&f.type===0&&(E=p.runOp(pt(me({},f),{path:x.slice(w.length)})),E===null&&(E=void 0)),E===void 0&&w.length===x.length&&(p instanceof Pa||p instanceof pr||p instanceof Mr?E=p.runOp(f):E=LD.runOp(p,f)),E!==void 0)if(E!==null){let P=E.data;for(let O=w.length-1;O>=0;O--){let k=x[O],U=w[O];if(U instanceof Pa){if(typeof k=="number")throw new Error("illegal arg");P=U.modifyById(k,P)}else if(U instanceof pr){if(typeof k=="number")throw new Error("illegal arg");P=U.modifyById(k,P)}else if(U instanceof Mr){if(typeof k=="number")throw new Error("illegal arg");P=U.modifyById(k,P)}else if(U instanceof Do){let j=pt(me({},U),{[k]:P});P=Object.setPrototypeOf(j,Do.prototype)}else if(typeof U=="object")if(Array.isArray(U)){if(typeof k=="string"&&(k=parseInt(k),isNaN(k)))throw new Error("Invalid path");let j=P;P=[...U],P[k]=j}else P=pt(me({},U),{[k]:P});else return null}return{data:P,actual:pt(me({},E.actual),{path:x}),reverse:pt(me({},E.reverse),{path:x})}}else return null;let A=x[w.length],I;if(p instanceof Pa){if(typeof A=="number")throw new Error("");I=p.get(A)?.data}else if(p instanceof pr){if(typeof A=="number")throw new Error("");I=p.get(A)?.data}else p!==null&&(I=p[A]);if(I!==void 0)w.push(p),p=I;else return null}}e.apply=r;function s(p,f){for(let x=0;x<p.length&&x<f.length;x++)if(p[x]!==f[x])return!0;return!1}e.pathDisjoint=s;function n(p,f){if(p.length!==f.length)return!1;for(let x=0;x<p.length;x++)if(p[x]!==f[x])return!1;return!0}e.pathEq=n;function c(p,f){return s(p.path,f.path)}e.commutative=c;function u(p,f){return p.type===0&&f.type===0&&n(p.path,f.path)?Object.keys(p.props).every(x=>f.props[x]!==void 0):!1}e.subsumed=u})(pa||(pa={}));var IN;(e=>{function t(){return[]}e.empty=t;function i(f,x){let w=[];for(let E of f){let[A,...I]=E.path;A===x&&w.push(pt(me({},E),{path:I}))}return w}e.removePrefix=i;function r(f,x){return f.map(w=>pt(me({},w),{path:[x,...w.path]}))}e.addPrefix=r;function s(f,x){return[...f,...x]}e.concat=s;function n(f,x){return[...f.filter(w=>!x.some(E=>pa.subsumed(w,E))),...x]}e.compress=n;function c(f,x){return f.every(w=>x.every(E=>pa.commutative(w,E)))}e.commutative=c;function u(f,x){for(let w of x){let E=p(f,w);E!==null&&(f=E.data)}return f}e.applyAll=u;function p(f,x){var w=f;let E=[],A=[];for(let I of x)try{if(I.type===3||I.type===5&&I.path[I.path.length-1]==="variables"){let P,O,k;if(I.type===3?(P=Zo.zoom(w,[...I.path,I.id]),k=pa.apply(w,pt(me({},I),{type:2}))):(P=Zo.zoom(w,[...I.path,I.id,"value"]),k=pa.apply(w,I)),k!==null){w=k.data;let[U,j]=q2e(w,{[I.id]:P});w=U;for(let V=0;V<j.length;V++){let $=j[V],Y=$.pop();if(typeof Y=="number"){let J=[Y];for(let ee=V+1;ee<j.length;ee++){let oe=j[ee],le=oe[oe.length-1];if(typeof le=="number"&&Zo.equal($,oe.slice(0,oe.length-1)))J.push(le),j.splice(ee,1);else break}let X=Zo.zoom(w,$);O=X.map((ee,oe)=>J.includes(oe)?I.id:ee),P=X,Y=$.pop()}else{if(Y==="alphaOverride"||Y==="alpha"){P/=100;let J=P,X=Zo.zoom(w,$.slice(0,$.length-2)),ee=X.layers.map(oe=>oe.id===$[$.length-1]?pt(me({},oe),{data:pt(me({},oe.data),{[Y]:J})}):oe);Object.setPrototypeOf(ee,Object.getPrototypeOf(X.layers)),X.layers=ee}O=I.id}E.push({type:0,path:$,props:{[Y]:P}}),A.push({type:0,path:$,props:{[Y]:O}})}A.push(k.reverse),E.push(k.actual)}}else{let P=pa.apply(w,I);P!==null&&(E.push(P.actual),w=P.data,A.push(P.reverse))}}catch(P){if(P instanceof MJ)return null;throw P}return{data:w,actual:E,reverse:A.reverse()}}e.apply=p})(IN||(IN={}));var DJ=Symbol(),$2e=Symbol(),II=Symbol(),$S=class{reportOp(e,t,i=[]){let r=this;if(t===null)return;r._current=t.data;let s=i;for(;!(r instanceof PJ);){let n=r._path,c=r._current;if(n!==""&&s.splice(0,0,n),r=r._parent,r===null)return;r.update(n,c)}r.push(s,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[II];i&&i(),delete this._children[e]}}}},Z2e=class extends $S{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if(typeof e=="string"&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current=pt(me({},this._current),{[e]:t})}runOp(e){this.reportOp(e,LD.runOp(this._current,e),e.path)}},Q2e=class extends $S{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current=pt(me({},this._current),{[e]:t}),Object.setPrototypeOf(this._current,Mr.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},IJ={get(e,t){if(t===II)return()=>{e._parent=null};if(t===DJ)return e._current;if(t===$2e)return e;let{_current:i,_children:r}=e;if(t==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let s=r===void 0?void 0:r[t];if(s!==void 0)return s;let n=i[t],c=PI(e,t,n);return c!==n?(r===void 0&&(r={},e._children=r),r[t]=c,c):n},has(e,t){return t in e._current},ownKeys(e){return Reflect.ownKeys(e._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(e){return Object.getPrototypeOf(e._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,r=Reflect.getOwnPropertyDescriptor(i,t);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[t]}}},K2e=pt(me({},IJ),{set(e,t,i){let r={type:0,props:{[t]:po(i)??i}};return e.deleteChildren(t),e.runOp(r),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}}),J2e=pt(me({},IJ),{set(e,t,i){return i===void 0?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty(e,t){return e.runOp({type:2,id:t}),!0}}),$4=class extends $S{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[II]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,i)=>{e(t,this.data(t))})}data(e){let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let s=t.get(e)?.data,n=PI(this,e,s);return n!==s?(i===void 0&&(i={},this._children=i),i[e]=n,n):s}add(e,t,i,r,s){this.runOp({type:7,parent:e,fi:t,id:i,data:r,children:s})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let s=0;s<i.length;s++){let n=i[s];this.add(e,r[s],n.id,n.data,n.children)}}insertBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let s=0;s<i.length;s++){let n=i[s];this.add(e,r[s],n.id,n.data,n.children)}}moveAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let s=0;s<i.length;s++){let n=i[s];this.move(e,r[s],n)}}moveBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let s=0;s<i.length;s++){let n=i[s];this.move(e,r[s],n)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},Z4=class extends $S{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[II]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id,s=this._current[i].fi;e(this.data(this._current[i].id),r,s)}}find(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id;if(e(this.data(r),r))return this.get(r)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return pt(me({},this._current.get(e)),{data:this.data(e)})}data(e){let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let s=t.get(e)?.data,n=PI(this,e,s);return n!==s?(i===void 0&&(i={},this._children=i),i[e]=n,n):s}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let s=t[r];this.add(i[r],s.id,s.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let s=t[r];this.add(i[r],s.id,s.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let s=t[r];this.move(i[r],s)}}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let s=t[r];this.move(i[r],s)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function qF(e,t,i){if(e.length>0){let r=e[e.length-1];if(r.type===0&&t.type===0&&Zo.equal(r.path,i)){Object.assign(r.props,t.props);return}}e.push(pt(me({},t),{path:i}))}var PJ=class extends $S{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(e!=="")throw new Error("");this._current=t}push(e,t,i,r){qF(this.ts,t,e),qF(this.actual,i,e),qF(this.reverse,r,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function PI(e,t,i){return i instanceof Pa?new $4(e,t,i):i instanceof pr?new Z4(e,t,i):i instanceof Mr?new Proxy(new Q2e(e,t,i),J2e):i!==null&&typeof i=="object"?q4(i)?i:new Proxy(new Z2e(e,t,i),K2e):i}function RJ(e){let t=new PJ(e);return[PI(t,"",e),t]}function CS(e,t){let[i,r]=RJ(e);return t(i),r.result()}function po(e){return e instanceof $4||e instanceof Z4?e._current:e!==null&&typeof e=="object"?e[DJ]:e}var Zo;(e=>{function t(n,c){if(c.length===n.length)for(var u=0;u<n.length;){if(n[u]!==c[u])return!1;u+=1}else return!1;return!0}e.equal=t;function i(n,c,u){let p=s(u,n);if(p!==void 0&&typeof p=="object"&&p!==null){let f=me({},c);return Object.keys(p).forEach(x=>{delete f[x]}),f}else return c}e.removeOverridden=i;function r(n,c){if((n instanceof Pa||n instanceof $4)&&typeof c=="string"||(n instanceof pr||n instanceof Z4)&&typeof c=="string")return n.data(c);if(typeof c=="number"&&Array.isArray(n)||typeof c=="string"&&typeof n=="object"&&n!==null)return n[c]}e.zoomOnce=r;function s(n,c,u=0){for(;u<c.length&&n!==void 0;)n=r(n,c[u]),u+=1;return n}e.zoom=s})(Zo||(Zo={}));function eDe(e,t){let i=[];if(t.length===e.length)for(var r=0;r<e.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}function ws(e,t){let i=[];if(t.length<=e.length)for(var r=0;r<t.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}var OJ=class{},ZY=class extends OJ{constructor(e){super(),this.id=e}},QY=class extends OJ{constructor(e){super(),this.data=e}},PN;try{PN=new TextDecoder}catch{}var Ji,fm,zt=0,LJ=[],RN=LJ,ON=0,kl={},$n,sm,qc=0,qh=0,pc,xp,bl=[],as,KY={useRecords:!1,mapsAsObjects:!0},zJ=class{},FJ=new zJ;FJ.name="MessagePack 0xC1";var dx=!1,ND=class{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(Ji)return VJ(()=>(zN(),this?this.unpack(e,t):ND.prototype.unpack.call(KY,e,t)));fm=t>-1?t:e.length,zt=0,ON=0,qh=0,sm=null,RN=LJ,pc=null,Ji=e;try{as=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw Ji=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof ND){if(kl=this,this.structures)return $n=this.structures,l2();(!$n||$n.length>0)&&($n=[])}else kl=KY,(!$n||$n.length>0)&&($n=[]);return l2()}unpackMultiple(e,t){let i,r=0;try{dx=!0;let s=e.length,n=this?this.unpack(e,s):OI.unpack(e,s);if(t){for(t(n);zt<s;)if(r=zt,t(l2())===!1)return}else{for(i=[n];zt<s;)r=zt,i.push(l2());return i}}catch(s){throw s.lastPosition=r,s.values=i,s}finally{dx=!1,zN()}}_mergeStructures(e,t){e=e||[];for(let i=0,r=e.length;i<r;i++){let s=e[i];s&&(s.isShared=!0,i>=32&&(s.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let r=e[i],s=t[i];s&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[i]=r),e[i]=s)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function l2(){try{if(!kl.trusted&&!dx){let t=$n.sharedLength||0;t<$n.length&&($n.length=t)}let e=to();if(zt==fm)$n.restoreStructures&&JY(),$n=null,Ji=null,xp&&(xp=null);else if(zt>fm){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}else if(!dx)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw $n.restoreStructures&&JY(),zN(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function JY(){for(let e in $n.restoreStructures)$n[e]=$n.restoreStructures[e];$n.restoreStructures=null}function to(){let e=Ji[zt++];if(e<160)if(e<128){if(e<64)return e;{let t=$n[e&63]||kl.getStructures&&kJ()[e&63];return t?(t.read||(t.read=Q4(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,kl.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[BJ()]=to();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(to(),to());return t}else{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=to();return t}else if(e<192){let t=e-160;if(qh>=zt)return sm.slice(zt-qc,(zt+=t)-qc);if(qh==0&&fm<140){let i=t<16?K4(t):NJ(t);if(i!=null)return i}return LN(t)}else{let t;switch(e){case 192:return null;case 193:return pc?(t=to(),t>0?pc[1].slice(pc.position1,pc.position1+=t):pc[0].slice(pc.position0,pc.position0-=t)):FJ;case 194:return!1;case 195:return!0;case 196:return YF(Ji[zt++]);case 197:return t=as.getUint16(zt),zt+=2,YF(t);case 198:return t=as.getUint32(zt),zt+=4,YF(t);case 199:return sy(Ji[zt++]);case 200:return t=as.getUint16(zt),zt+=2,sy(t);case 201:return t=as.getUint32(zt),zt+=4,sy(t);case 202:if(t=as.getFloat32(zt),kl.useFloat32>2){let i=J4[(Ji[zt]&127)<<1|Ji[zt+1]>>7];return zt+=4,(i*t+(t>0?.5:-.5)>>0)/i}return zt+=4,t;case 203:return t=as.getFloat64(zt),zt+=8,t;case 204:return Ji[zt++];case 205:return t=as.getUint16(zt),zt+=2,t;case 206:return t=as.getUint32(zt),zt+=4,t;case 207:return kl.int64AsNumber?(t=as.getUint32(zt)*4294967296,t+=as.getUint32(zt+4)):t=as.getBigUint64(zt),zt+=8,t;case 208:return as.getInt8(zt++);case 209:return t=as.getInt16(zt),zt+=2,t;case 210:return t=as.getInt32(zt),zt+=4,t;case 211:return kl.int64AsNumber?(t=as.getInt32(zt)*4294967296,t+=as.getUint32(zt+4)):t=as.getBigInt64(zt),zt+=8,t;case 212:if(t=Ji[zt++],t==114)return nX(Ji[zt++]&63);{let i=bl[t];if(i)return i.read?(zt++,i.read(to())):i.noBuffer?(zt++,i()):i(Ji.subarray(zt,++zt));throw new Error("Unknown extension "+t)}case 213:return t=Ji[zt],t==114?(zt++,nX(Ji[zt++]&63,Ji[zt++])):sy(2);case 214:return sy(4);case 215:return sy(8);case 216:return sy(16);case 217:return t=Ji[zt++],qh>=zt?sm.slice(zt-qc,(zt+=t)-qc):iDe(t);case 218:return t=as.getUint16(zt),zt+=2,qh>=zt?sm.slice(zt-qc,(zt+=t)-qc):rDe(t);case 219:return t=as.getUint32(zt),zt+=4,qh>=zt?sm.slice(zt-qc,(zt+=t)-qc):nDe(t);case 220:return t=as.getUint16(zt),zt+=2,tX(t);case 221:return t=as.getUint32(zt),zt+=4,tX(t);case 222:return t=as.getUint16(zt),zt+=2,iX(t);case 223:return t=as.getUint32(zt),zt+=4,iX(t);default:if(e>=224)return e-256;if(e===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+e)}}}var tDe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Q4(e,t){function i(){if(i.count++>2){let s=e.read=new Function("r","return function(){return {"+e.map(n=>tDe.test(n)?n+":r()":"["+JSON.stringify(n)+"]:r()").join(",")+"}}")(to);return e.highByte===0&&(e.read=eX(t,e.read)),s()}let r={};for(let s=0,n=e.length;s<n;s++){let c=e[s];r[c]=to()}return r}return i.count=0,e.highByte===0?eX(t,i):i}var eX=(e,t)=>function(){let i=Ji[zt++];if(i===0)return t();let r=e<32?-(e+(i<<5)):e+(i<<5),s=$n[r]||kJ()[r];if(!s)throw new Error("Record id is not defined for "+r);return s.read||(s.read=Q4(s,e)),s.read()};function kJ(){let e=VJ(()=>(Ji=null,kl.getStructures()));return $n=kl._mergeStructures(e,$n)}var LN=RI,iDe=RI,rDe=RI,nDe=RI;function RI(e){let t;if(e<16&&(t=K4(e)))return t;if(e>64&&PN)return PN.decode(Ji.subarray(zt,zt+=e));let i=zt+e,r=[];for(t="";zt<i;){let s=Ji[zt++];if(!(s&128))r.push(s);else if((s&224)===192){let n=Ji[zt++]&63;r.push((s&31)<<6|n)}else if((s&240)===224){let n=Ji[zt++]&63,c=Ji[zt++]&63;r.push((s&31)<<12|n<<6|c)}else if((s&248)===240){let n=Ji[zt++]&63,c=Ji[zt++]&63,u=Ji[zt++]&63,p=(s&7)<<18|n<<12|c<<6|u;p>65535&&(p-=65536,r.push(p>>>10&1023|55296),p=56320|p&1023),r.push(p)}else r.push(s);r.length>=4096&&(t+=la.apply(String,r),r.length=0)}return r.length>0&&(t+=la.apply(String,r)),t}function tX(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=to();return t}function iX(e){if(kl.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[BJ()]=to();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(to(),to());return t}}var la=String.fromCharCode;function NJ(e){let t=zt,i=new Array(e);for(let r=0;r<e;r++){let s=Ji[zt++];if((s&128)>0){zt=t;return}i[r]=s}return la.apply(String,i)}function K4(e){if(e<4)if(e<2){if(e===0)return"";{let t=Ji[zt++];if((t&128)>1){zt-=1;return}return la(t)}}else{let t=Ji[zt++],i=Ji[zt++];if((t&128)>0||(i&128)>0){zt-=2;return}if(e<3)return la(t,i);let r=Ji[zt++];if((r&128)>0){zt-=3;return}return la(t,i,r)}else{let t=Ji[zt++],i=Ji[zt++],r=Ji[zt++],s=Ji[zt++];if((t&128)>0||(i&128)>0||(r&128)>0||(s&128)>0){zt-=4;return}if(e<6){if(e===4)return la(t,i,r,s);{let n=Ji[zt++];if((n&128)>0){zt-=5;return}return la(t,i,r,s,n)}}else if(e<8){let n=Ji[zt++],c=Ji[zt++];if((n&128)>0||(c&128)>0){zt-=6;return}if(e<7)return la(t,i,r,s,n,c);let u=Ji[zt++];if((u&128)>0){zt-=7;return}return la(t,i,r,s,n,c,u)}else{let n=Ji[zt++],c=Ji[zt++],u=Ji[zt++],p=Ji[zt++];if((n&128)>0||(c&128)>0||(u&128)>0||(p&128)>0){zt-=8;return}if(e<10){if(e===8)return la(t,i,r,s,n,c,u,p);{let f=Ji[zt++];if((f&128)>0){zt-=9;return}return la(t,i,r,s,n,c,u,p,f)}}else if(e<12){let f=Ji[zt++],x=Ji[zt++];if((f&128)>0||(x&128)>0){zt-=10;return}if(e<11)return la(t,i,r,s,n,c,u,p,f,x);let w=Ji[zt++];if((w&128)>0){zt-=11;return}return la(t,i,r,s,n,c,u,p,f,x,w)}else{let f=Ji[zt++],x=Ji[zt++],w=Ji[zt++],E=Ji[zt++];if((f&128)>0||(x&128)>0||(w&128)>0||(E&128)>0){zt-=12;return}if(e<14){if(e===12)return la(t,i,r,s,n,c,u,p,f,x,w,E);{let A=Ji[zt++];if((A&128)>0){zt-=13;return}return la(t,i,r,s,n,c,u,p,f,x,w,E,A)}}else{let A=Ji[zt++],I=Ji[zt++];if((A&128)>0||(I&128)>0){zt-=14;return}if(e<15)return la(t,i,r,s,n,c,u,p,f,x,w,E,A,I);let P=Ji[zt++];if((P&128)>0){zt-=15;return}return la(t,i,r,s,n,c,u,p,f,x,w,E,A,I,P)}}}}}function YF(e){return kl.copyBuffers?Uint8Array.prototype.slice.call(Ji,zt,zt+=e):Ji.subarray(zt,zt+=e)}function sy(e){let t=Ji[zt++];if(bl[t])return bl[t](Ji.subarray(zt,zt+=e));throw new Error("Unknown extension type "+t)}var rX=new Array(4096);function BJ(){let e=Ji[zt++];if(e>=160&&e<192){if(e=e-160,qh>=zt)return sm.slice(zt-qc,(zt+=e)-qc);if(!(qh==0&&fm<180))return LN(e)}else return zt--,to();let t=(e<<5^(e>1?as.getUint16(zt):e>0?Ji[zt]:0))&4095,i=rX[t],r=zt,s=zt+e-3,n,c=0;if(i&&i.bytes==e){for(;r<s;){if(n=as.getUint32(r),n!=i[c++]){r=1879048192;break}r+=4}for(s+=3;r<s;)if(n=Ji[r++],n!=i[c++]){r=1879048192;break}if(r===s)return zt=r,i.string;s-=3,r=zt}for(i=[],rX[t]=i,i.bytes=e;r<s;)n=as.getUint32(r),i.push(n),r+=4;for(s+=3;r<s;)n=Ji[r++],i.push(n);let u=e<16?K4(e):NJ(e);return u!=null?i.string=u:i.string=LN(e)}var nX=(e,t)=>{var i=to();let r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let s=$n[e];return s&&s.isShared&&(($n.restoreStructures||($n.restoreStructures=[]))[e]=s),$n[e]=i,i.read=Q4(i,r),i.read()},UJ=typeof self=="object"?self:global;bl[0]=()=>{};bl[0].noBuffer=!0;bl[101]=()=>{let e=to();return(UJ[e[0]]||Error)(e[1])};bl[105]=e=>{let t=as.getUint32(zt-4);xp||(xp=new Map);let i=Ji[zt],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let s={target:r};xp.set(t,s);let n=to();return s.used?Object.assign(r,n):(s.target=n,n)};bl[112]=e=>{let t=as.getUint32(zt-4),i=xp.get(t);return i.used=!0,i.target};bl[115]=()=>new Set(to());var jJ=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");bl[116]=e=>{let t=e[0],i=jJ[t];if(!i)throw new Error("Could not find typed array for code "+t);return new UJ[i](Uint8Array.prototype.slice.call(e,1).buffer)};bl[120]=()=>{let e=to();return new RegExp(e[0],e[1])};bl[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],i=zt;zt+=t-4,pc=[to(),to()],pc.position0=0,pc.position1=0;let r=zt;zt=i;try{return to()}finally{zt=r}};bl[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function VJ(e){let t=fm,i=zt,r=ON,s=qc,n=qh,c=sm,u=RN,p=xp,f=pc,x=new Uint8Array(Ji.slice(0,fm)),w=$n,E=$n.slice(0,$n.length),A=kl,I=dx,P=e();return fm=t,zt=i,ON=r,qc=s,qh=n,sm=c,RN=u,xp=p,pc=f,Ji=x,dx=I,$n=w,$n.splice(0,$n.length,...E),kl=A,as=new DataView(Ji.buffer,Ji.byteOffset,Ji.byteLength),P}function zN(){Ji=null,xp=null,$n=null}function sDe(e){e.unpack?bl[e.type]=e.unpack:bl[e.type]=e}var J4=new Array(147);for(let e=0;e<256;e++)J4[e]=+("1e"+Math.floor(45.15-e*.30103));var OI=new ND({useRecords:!1}),dYe=OI.unpack,pYe=OI.unpackMultiple,fYe=OI.unpack,oDe={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4},aDe=new Float32Array(1),mYe=new Uint8Array(aDe.buffer,0,4),iD;try{iD=new TextEncoder}catch{}var BD,eU,LI=typeof Buffer<"u",XF=LI?Buffer.allocUnsafeSlow:Uint8Array,GJ=LI?Buffer:Uint8Array,sX=LI?4294967296:2144337920,ui,uo,Gt=0,Dh,Ih=null,lDe=/[\u0080-\uFFFF]/,Dw=Symbol("record-id"),HJ=class extends ND{constructor(e){super(e),this.offset=0;let t,i,r,s,n,c,u=0,p=GJ.prototype.utf8Write?function(J,X,ee){return ui.utf8Write(J,X,ee)}:iD&&iD.encodeInto?function(J,X){return iD.encodeInto(J,ui.subarray(X)).written}:!1,f=this;e||(e={});let x=e&&e.sequential,w=e.structures||e.saveStructures,E=e.maxSharedStructures;if(E==null&&(E=w?32:0),E>8160)throw new Error("Maximum maxSharedStructure is 8160");let A=e.maxOwnStructures;A==null&&(A=w?32:64),x&&!e.saveStructures&&(this.structures=[]);let I=E>32||A+E>64,P=E+64,O=E+A+64;if(O>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let k=[],U=0,j=0;this.pack=this.encode=function(J,X){if(ui||(ui=new XF(8192),uo=new DataView(ui.buffer,0,8192),Gt=0),Dh=ui.length-10,Dh-Gt<2048?(ui=new XF(ui.length),uo=new DataView(ui.buffer,0,ui.length),Dh=ui.length-10,Gt=0):Gt=Gt+7&2147483640,i=Gt,c=f.structuredClone?new Map:null,f.bundleStrings?(Ih=["",""],ui[Gt++]=214,ui[Gt++]=98,Ih.position=Gt-i,Gt+=4):Ih=null,r=f.structures,r){r.uninitialized&&(r=f._mergeStructures(f.getStructures()));let ee=r.sharedLength||0;if(ee>E)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+r.sharedLength);if(!r.transitions){r.transitions=Object.create(null);for(let oe=0;oe<ee;oe++){let le=r[oe];if(!le)continue;let ve,we=r.transitions;for(let fe=0,Ue=le.length;fe<Ue;fe++){let Fe=le[fe];ve=we[Fe],ve||(ve=we[Fe]=Object.create(null)),we=ve}we[Dw]=oe+64}u=ee}x||(r.nextId=ee+64)}s&&(s=!1),n=r||[];try{if(V(J),Ih){uo.setUint32(Ih.position+i,Gt-Ih.position-i);let ee=Ih;Ih=null,V(ee[0]),V(ee[1])}if(f.offset=Gt,c&&c.idsToInsert){Gt+=c.idsToInsert.length*6,Gt>Dh&&Y(Gt),f.offset=Gt;let ee=uDe(ui.subarray(i,Gt),c.idsToInsert);return c=null,ee}return X&hDe?(ui.start=i,ui.end=Gt,ui):ui.subarray(i,Gt)}finally{if(r){if(j<10&&j++,U>1e4)r.transitions=null,j=0,U=0,k.length>0&&(k=[]);else if(k.length>0&&!x){for(let ee=0,oe=k.length;ee<oe;ee++)k[ee][Dw]=0;k=[]}if(s&&f.saveStructures){let ee=r.sharedLength||E;r.length>ee&&(r=r.slice(0,ee));let oe=ui.subarray(i,Gt);return f.saveStructures(r,u)===!1?(f._mergeStructures(f.getStructures()),f.pack(J)):(u=ee,oe)}}X&dDe&&(Gt=i)}};let V=J=>{Gt>Dh&&(ui=Y(Gt));var X=typeof J,ee;if(X==="string"){let oe=J.length;if(Ih&&oe>=8&&oe<4096){let we=lDe.test(J);Ih[we?0:1]+=J,ui[Gt++]=193,V(we?-oe:oe);return}let le;oe<32?le=1:oe<256?le=2:oe<65536?le=3:le=5;let ve=oe*3;if(Gt+ve>Dh&&(ui=Y(Gt+ve)),oe<64||!p){let we,fe,Ue,Fe=Gt+le;for(we=0;we<oe;we++)fe=J.charCodeAt(we),fe<128?ui[Fe++]=fe:fe<2048?(ui[Fe++]=fe>>6|192,ui[Fe++]=fe&63|128):(fe&64512)===55296&&((Ue=J.charCodeAt(we+1))&64512)===56320?(fe=65536+((fe&1023)<<10)+(Ue&1023),we++,ui[Fe++]=fe>>18|240,ui[Fe++]=fe>>12&63|128,ui[Fe++]=fe>>6&63|128,ui[Fe++]=fe&63|128):(ui[Fe++]=fe>>12|224,ui[Fe++]=fe>>6&63|128,ui[Fe++]=fe&63|128);ee=Fe-Gt-le}else ee=p(J,Gt+le,ve);ee<32?ui[Gt++]=160|ee:ee<256?(le<2&&ui.copyWithin(Gt+2,Gt+1,Gt+1+ee),ui[Gt++]=217,ui[Gt++]=ee):ee<65536?(le<3&&ui.copyWithin(Gt+3,Gt+2,Gt+2+ee),ui[Gt++]=218,ui[Gt++]=ee>>8,ui[Gt++]=ee&255):(le<5&&ui.copyWithin(Gt+5,Gt+3,Gt+3+ee),ui[Gt++]=219,uo.setUint32(Gt,ee),Gt+=4),Gt+=ee}else if(X==="number")if(J>>>0===J)J<64?ui[Gt++]=J:J<256?(ui[Gt++]=204,ui[Gt++]=J):J<65536?(ui[Gt++]=205,ui[Gt++]=J>>8,ui[Gt++]=J&255):(ui[Gt++]=206,uo.setUint32(Gt,J),Gt+=4);else if(J>>0===J)J>=-32?ui[Gt++]=256+J:J>=-128?(ui[Gt++]=208,ui[Gt++]=J+256):J>=-32768?(ui[Gt++]=209,uo.setInt16(Gt,J),Gt+=2):(ui[Gt++]=210,uo.setInt32(Gt,J),Gt+=4);else{let oe;if((oe=this.useFloat32)>0&&J<4294967296&&J>=-2147483648){ui[Gt++]=202,uo.setFloat32(Gt,J);let le;if(oe<4||(le=J*J4[(ui[Gt]&127)<<1|ui[Gt+1]>>7])>>0===le){Gt+=4;return}else Gt--}ui[Gt++]=203,uo.setFloat64(Gt,J),Gt+=8}else if(X==="object")if(!J)ui[Gt++]=192;else{if(c){let le=c.get(J);if(le){if(!le.id){let ve=c.idsToInsert||(c.idsToInsert=[]);le.id=ve.push(le)}ui[Gt++]=214,ui[Gt++]=112,uo.setUint32(Gt,le.id),Gt+=4;return}else c.set(J,{offset:Gt-i})}let oe=J.constructor;if(oe===Object)$(J,!0);else if(oe===Array){ee=J.length,ee<16?ui[Gt++]=144|ee:ee<65536?(ui[Gt++]=220,ui[Gt++]=ee>>8,ui[Gt++]=ee&255):(ui[Gt++]=221,uo.setUint32(Gt,ee),Gt+=4);for(let le=0;le<ee;le++)V(J[le])}else if(oe===Map){ee=J.size,ee<16?ui[Gt++]=128|ee:ee<65536?(ui[Gt++]=222,ui[Gt++]=ee>>8,ui[Gt++]=ee&255):(ui[Gt++]=223,uo.setUint32(Gt,ee),Gt+=4);for(let[le,ve]of J)V(le),V(ve)}else{for(let le=0,ve=BD.length;le<ve;le++){let we=eU[le];if(J instanceof we){let fe=BD[le];if(fe.write){fe.type&&(ui[Gt++]=212,ui[Gt++]=fe.type,ui[Gt++]=0),V(fe.write.call(this,J));return}let Ue=ui,Fe=uo,Pe=Gt;ui=null;let Ae;try{Ae=fe.pack.call(this,J,et=>(ui=Ue,Ue=null,Gt+=et,Gt>Dh&&Y(Gt),{target:ui,targetView:uo,position:Gt-et}),V)}finally{Ue&&(ui=Ue,uo=Fe,Gt=Pe,Dh=ui.length-10)}Ae&&(Ae.length+Gt>Dh&&Y(Ae.length+Gt),Gt=cDe(Ae,ui,Gt,fe.type));return}}$(J,!J.hasOwnProperty)}}else if(X==="boolean")ui[Gt++]=J?195:194;else if(X==="bigint"){if(J<BigInt(1)<<BigInt(63)&&J>=-(BigInt(1)<<BigInt(63)))ui[Gt++]=211,uo.setBigInt64(Gt,J);else if(J<BigInt(1)<<BigInt(64)&&J>0)ui[Gt++]=207,uo.setBigUint64(Gt,J);else if(this.largeBigIntToFloat)ui[Gt++]=203,uo.setFloat64(Gt,Number(J));else throw new RangeError(J+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");Gt+=8}else if(X==="undefined")this.encodeUndefinedAsNil?ui[Gt++]=192:(ui[Gt++]=212,ui[Gt++]=0,ui[Gt++]=0);else if(X==="function")V(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+X)},$=this.useRecords===!1?this.variableMapSize?J=>{let X=Object.keys(J),ee=X.length;ee<16?ui[Gt++]=128|ee:ee<65536?(ui[Gt++]=222,ui[Gt++]=ee>>8,ui[Gt++]=ee&255):(ui[Gt++]=223,uo.setUint32(Gt,ee),Gt+=4);let oe;for(let le=0;le<ee;le++)V(oe=X[le]),V(J[oe])}:(J,X)=>{ui[Gt++]=222;let ee=Gt-i;Gt+=2;let oe=0;for(let le in J)(X||J.hasOwnProperty(le))&&(V(le),V(J[le]),oe++);ui[ee+++i]=oe>>8,ui[ee+i]=oe&255}:J=>{let X=Object.keys(J),ee,oe=n.transitions||(n.transitions=Object.create(null)),le=0;for(let we=0,fe=X.length;we<fe;we++){let Ue=X[we];ee=oe[Ue],ee||(ee=oe[Ue]=Object.create(null),le++),oe=ee}let ve=oe[Dw];if(ve)ve>=96&&I?(ui[Gt++]=((ve-=96)&31)+96,ui[Gt++]=ve>>5):ui[Gt++]=ve;else{ve=n.nextId,ve||(ve=64),ve<P&&this.shouldShareStructure&&!this.shouldShareStructure(X)?(ve=n.nextOwnId,ve<O||(ve=P),n.nextOwnId=ve+1):(ve>=O&&(ve=P),n.nextId=ve+1);let we=X.highByte=ve>=96&&I?ve-96>>5:-1;oe[Dw]=ve,n[ve-64]=X,ve<P?(X.isShared=!0,n.sharedLength=ve-63,s=!0,we>=0?(ui[Gt++]=(ve&31)+96,ui[Gt++]=we):ui[Gt++]=ve):(we>=0?(ui[Gt++]=213,ui[Gt++]=114,ui[Gt++]=(ve&31)+96,ui[Gt++]=we):(ui[Gt++]=212,ui[Gt++]=114,ui[Gt++]=ve),le&&(U+=j*le),k.length>=A&&(k.shift()[Dw]=0),k.push(oe),V(X))}for(let we=0,fe=X.length;we<fe;we++)V(J[X[we]])},Y=J=>{let X;if(J>16777216){if(J-i>sX)throw new Error("Packed buffer would be larger than maximum buffer size");X=Math.min(sX,Math.round(Math.max((J-i)*(J>67108864?1.25:2),4194304)/4096)*4096)}else X=(Math.max(J-i<<2,ui.length-1)>>12)+1<<12;let ee=new XF(X);return uo=new DataView(ee.buffer,0,X),ui.copy?ui.copy(ee,0,i,J):ee.set(ui.slice(i,J)),Gt-=i,i=0,Dh=ee.length-10,ui=ee}}useBuffer(e){ui=e,uo=new DataView(ui.buffer,ui.byteOffset,ui.byteLength),Gt=0}};eU=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,zJ];BD=[{pack(e,t,i){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:s,targetView:n,position:c}=t(6);s[c++]=214,s[c++]=255,n.setUint32(c,r)}else if(r>0&&r<17179869184){let{target:s,targetView:n,position:c}=t(10);s[c++]=215,s[c++]=255,n.setUint32(c,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),n.setUint32(c+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:s,targetView:n,position:c}=t(3);s[c++]=212,s[c++]=255,s[c++]=255}else{let{target:s,targetView:n,position:c}=t(15);s[c++]=199,s[c++]=12,s[c++]=255,n.setUint32(c,e.getMilliseconds()*1e6),n.setBigInt64(c+4,BigInt(Math.floor(r)))}}},{pack(e,t,i){let r=Array.from(e),{target:s,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(s[n++]=212,s[n++]=115,s[n++]=0),i(r)}},{pack(e,t,i){let{target:r,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(r[s++]=212,r[s++]=101,r[s++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:r,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(r[s++]=212,r[s++]=120,r[s++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?oX(e,16,t):aX(LI?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==GJ&&this.structuredClone?oX(e,jJ.indexOf(i.name),t):aX(e,t)}},{pack(e,t){let{target:i,position:r}=t(1);i[r]=193}}];function oX(e,t,i,r){let s=e.byteLength;if(s+1<256){var{target:n,position:c}=i(4+s);n[c++]=199,n[c++]=s+1}else if(s+1<65536){var{target:n,position:c}=i(5+s);n[c++]=200,n[c++]=s+1>>8,n[c++]=s+1&255}else{var{target:n,position:c,targetView:u}=i(7+s);n[c++]=201,u.setUint32(c,s+1),c+=4}n[c++]=116,n[c++]=t,n.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),c)}function aX(e,t){let i=e.byteLength;var r,s;if(i<256){var{target:r,position:s}=t(i+2);r[s++]=196,r[s++]=i}else if(i<65536){var{target:r,position:s}=t(i+3);r[s++]=197,r[s++]=i>>8,r[s++]=i&255}else{var{target:r,position:s,targetView:n}=t(i+5);r[s++]=198,n.setUint32(s,i),s+=4}r.set(e,s)}function cDe(e,t,i,r){let s=e.length;switch(s){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:s<256?(t[i++]=199,t[i++]=s):s<65536?(t[i++]=200,t[i++]=s>>8,t[i++]=s&255):(t[i++]=201,t[i++]=s>>24,t[i++]=s>>16&255,t[i++]=s>>8&255,t[i++]=s&255)}return t[i++]=r,t.set(e,i),i+=s,i}function uDe(e,t){let i,r=t.length*6,s=e.length-r;for(t.sort((n,c)=>n.offset>c.offset?1:-1);i=t.pop();){let n=i.offset,c=i.id;e.copyWithin(n+r,n,s),r-=6;let u=n+r;e[u++]=214,e[u++]=105,e[u++]=c>>24,e[u++]=c>>16&255,e[u++]=c>>8&255,e[u++]=c&255,s=n}return e}function Ox(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");eU.unshift(e.Class),BD.unshift(e)}sDe(e)}var WJ=new HJ({useRecords:!1}),gYe=WJ.pack,yYe=WJ.pack,{NEVER:vYe,ALWAYS:_Ye,DECIMAL_ROUND:xYe,DECIMAL_FIT:bYe}=oDe,hDe=512,dDe=1024,lX=new HJ({structuredClone:!0});Ox({Class:Mr.prototype.constructor,type:1,write(e){return me({},e)},read(e){return Object.setPrototypeOf(e,Mr.prototype),e}});Ox({Class:pr.prototype.constructor,type:2,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,pr.prototype),e}});Ox({Class:Pa.prototype.constructor,type:3,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,Pa.prototype),e}});Ox({Class:ZY.prototype.constructor,type:4,write(e){return e.id},read(e){return new ZY(e)}});Ox({Class:QY.prototype.constructor,type:5,write(e){return e.data},read(e){return new QY(e)}});Ox({Class:Do.prototype.constructor,type:6,write(e){return me({},e)},read(e){return Object.setPrototypeOf(e,Do.prototype),e}});function pDe(e){var t=0;if(e.length===0)return t;for(let i=0;i<e.length;i++){let r=e[i];t=(t<<5)-t+r,t=t&t}return t}function FN(e){if(q4(e))return e;if(Array.isArray(e))return e.map(FN);if(typeof e=="object"&&e!==null){let t={};for(let i of Object.keys(e).sort())t[i]=FN(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}else return e}var kN;(e=>{function t(s){return lX.pack(s)}e.serialize=t;function i(s){return lX.unpack(s)}e.deserialize=i;function r(s){return pDe(t(FN(s))).toString()}e.checksum=r})(kN||(kN={}));var cX;(e=>{function t(r){return r.type==="Conditional"?r.condition.type==="Distance"?"Distance":"StateChange":r.type}e.toEventUIType=t;function i(r){return r==="Distance"||r==="StateChange"?"Conditional":r}e.fromEventUIType=i})(cX||(cX={}));function uX(e){return e==="MouseDown"||e==="MouseUp"||e==="KeyDown"||e==="KeyUp"||e==="Collision"||e==="Trigger"}var ja={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],API:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],WEBHOOK:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"]},hX;(e=>{function t(r){return r.type==="MouseDown"||r.type==="MouseUp"||r.type==="MousePress"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="KeyPress"}e.is=t;function i(r){return r==="MouseDown"||r==="MouseUp"||r==="MousePress"?{type:r,mode:"Object",disabled:!1,actions:new pr}:{type:r,disabled:!1,key:void 0,actions:new pr}}e.defaultData=i})(hX||(hX={}));var UD;(e=>{function t(i){return{type:"Property",value:[i??null,"position","x"]}}e.propertyDefaultData=t,e.valueDefaultData={type:"Literal",value:0}})(UD||(UD={}));var NN;(e=>{function t(s){return{type:"Comparison",operator:"==",lOperand:UD.propertyDefaultData(s),rOperand:me({},UD.valueDefaultData)}}e.comparisonDefaultData=t;function i(s){return{type:"Distance",toObject:s??null,fromObject:s??null,distance:200}}e.distanceDefaultData=i;function r(s,n){return{type:"State",object:s??null,state:n??null}}e.stateDefaultData=r})(NN||(NN={}));var dX;(e=>{function t(i){return i.find(r=>r==="ifActions"||r==="elseActions")!==void 0}e.isConditionalSubActions=t})(dX||(dX={}));var pX;(e=>{function t(r){return r.type==="Conditional"}e.is=t;function i(r){return{type:"Conditional",disabled:!1,inActions:new pr,outActions:new pr,condition:NN.distanceDefaultData(r)}}e.defaultData=i})(pX||(pX={}));var fX;(e=>e.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new pr,drop:new pr}})(fX||(fX={}));var BN;(e=>e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new pr})(BN||(BN={}));var UN;(e=>e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(UN||(UN={}));var mX;(e=>{function t(r){return r.type==="MouseHover"}e.is=t;function i(){return{type:"MouseHover",disabled:!1,actions:new pr}}e.defaultData=i})(mX||(mX={}));var gX;(e=>{function t(r){return r.type==="Scroll"}e.is=t;function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new pr}}e.defaultData=i})(gX||(gX={}));var yX;(e=>{function t(r){return r.type==="Start"}e.is=t;function i(){return{type:"Start",disabled:!1,actions:new pr}}e.defaultData=i})(yX||(yX={}));var vX;(e=>{function t(r){return r.type==="Collision"}e.is=t;function i(){return{type:"Collision",disabled:!1,target:"character",actions:new pr}}e.defaultData=i})(vX||(vX={}));var _X;(e=>{function t(r){return r.type==="Trigger"}e.is=t;function i(r,s){return{type:"Trigger",disabled:!1,target:"all",triggeringObjects:[],actions:new pr,triggerZone:"box",position:s.toArray(),rotation:[0,0,0],size:r.toArray(),radius:r.length()/2,helperVisible:!0}}e.defaultData=i})(_X||(_X={}));var jN;(e=>{e.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function t(c){return c.type==="Resize"}e.is=t;function i(c){return typeof c=="string"?c:"custom"}e.sizeToDevice=i;function r(c){return typeof c=="string"?[...e.defaultSizes[c]]:[...c]}e.deviceToSize=r;function s(){let c={size:"mobile",operator:"<",actions:new pr},u={size:"tablet",operator:"<",actions:new pr},p={size:[...e.defaultSizes.custom],operator:"<>",actions:new pr},f=new pr;return f.push({id:Yi.generateUUID(),fi:0,data:c},{id:Yi.generateUUID(),fi:1,data:u},{id:Yi.generateUUID(),fi:2,data:p}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:f}}e.defaultData=s;function n(){return{size:[...e.defaultSizes.custom],operator:"<>",actions:new pr}}e.defaultBreakpointData=n})(jN||(jN={}));var VN;(e=>{e.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]};function t(r){return r.type==="VariableChange"}e.is=t;function i(){return{disabled:!1,type:"VariableChange",actions:new pr,variableId:"",objectId:null,property:"Position X"}}e.defaultData=i})(VN||(VN={}));var xX;(e=>{function t(r){return r.type==="API"}e.is=t;function i(){return{disabled:!1,type:"API",successActions:new pr,errorActions:new pr,userAPIId:""}}e.defaultData=i})(xX||(xX={}));var bX;(e=>{function t(r){return r.type==="WEBHOOK"}e.is=t;function i(){return{disabled:!1,type:"WEBHOOK",actions:new pr,userWebhookId:""}}e.defaultData=i})(bX||(bX={}));var Lx="personal camera",cS="a218fcc3-276b-49b9-b485-49037fd14f5f",fDe=2960946,mc=5526619,yp;(e=>{function t(I,P){return I[0]===P[0]&&I[1]===P[1]}e.isEqual=t;function i(I,P,O){return[I[0]+(P[0]-I[0])*O,I[1]+(P[1]-I[1])*O]}e.lerp=i;function r(I,P){return[I[0]+P[0],I[1]+P[1]]}e.add=r;function s(I,P){return[I[0]-P[0],I[1]-P[1]]}e.sub=s;function n(I,P){return[I[0]*P[0],I[1]*P[1]]}e.multiply=n;function c(I,P){return[I[0]/P[0],I[1]/P[1]]}e.divide=c;function u(I,P){return Math.pow(P[0]-I[0],2)+Math.pow(P[1]-I[1],2)}e.distanceSquared=u;function p(I,P){return Math.sqrt(u(I,P))}e.distance=p;function f(I,P){return I[0]*P[0]+I[1]*P[1]}e.dot=f;function x(I,P){return[I[0]*P,I[1]*P]}e.scalarMultiply=x;function w(I,P,O){let k=e.sub(P,I),U=e.sub(O,I),j=e.dot(k,U)/e.dot(k,k),V=e.scalarMultiply(k,j);return e.add(I,V)}e.projectionOnto=w;function E(I,P,O){return p(I,w(I,P,O))}e.projectionOntoDistance=E;function A(I,P){return[(I[0]+P[0])*.5,(I[1]+P[1])*.5]}e.center=A})(yp||(yp={}));var Ly;(e=>{function t(p,f){return p[0]===f[0]&&p[1]===f[1]&&p[2]===f[2]}e.isEqual=t;function i(p,f){return[p[0]+f[0],p[1]+f[1],p[2]+f[2]]}e.add=i;function r(p,f){return[p[0]-f[0],p[1]-f[1],p[2]-f[2]]}e.sub=r;function s(p,f){return[p[0]/f[0],p[1]/f[1],p[2]/f[2]]}e.div=s;function n(p,f){return[p[0]*f[0],p[1]*f[1],p[2]*f[2]]}e.mul=n;function c(p,f){return Math.hypot(p[0]-f[0],p[1]-f[1],p[2]-f[2])}e.dist=c;function u(p,f,x){return[p[0]+(f[0]-p[0])*x,p[1]+(f[1]-p[1])*x,p[2]+(f[2]-p[2])*x]}e.lerp=u})(Ly||(Ly={}));var jD;(e=>{function t(r,s){return r[0]===s[0]&&r[1]===s[1]&&r[2]===s[2]&&r[3]===s[3]}e.isEqual=t;function i(r,s,n){return[r[0]+(s[0]-r[0])*n,r[1]+(s[1]-r[1])*n,r[2]+(s[2]-r[2])*n,r[3]+(s[3]-r[3])*n]}e.lerp=i})(jD||(jD={}));var wX;(e=>{let t=180/Math.PI,i=Math.PI/180;function r(u){return typeof u=="number"?u*t:u}function s(u){return typeof u=="number"?u*i:u}function n(u){return[r(u[0]),r(u[1]),r(u[2])]}e.radToDeg=n;function c(u){return[s(u[0]),s(u[1]),s(u[2])]}e.degToRad=c})(wX||(wX={}));var px;(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function t(s,n){for(let c=0;c<16;c++)if(s[c]!==n[c])return!1;return!0}e.isEqual=t;function i(s){return s??e.identity}e.simplify=i;function r(s,n){let c=n.slice(0);for(var u=0,p=n.length;u<p;u+=3){let f=s[3]*n[u]+s[7]*n[u+1]+s[11]*n[u+2]+s[15];c[u]=(s[0]*n[u]+s[4]*n[u+1]+s[8]*n[u+2]+s[12])/f,c[u+1]=(s[1]*n[u]+s[5]*n[u+1]+s[9]*n[u+2]+s[13])/f,c[u+2]=(s[2]*n[u]+s[6]*n[u+1]+s[10]*n[u+2]+s[14])/f}return c}e.applyMatrix4=r})(px||(px={}));var Da;(e=>{function t(f){return typeof f=="object"&&typeof f.r=="number"&&typeof f.g=="number"&&typeof f.b=="number"}e.isRGB=t,e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0};function i(f){return{r:Math.round(f.r*255),g:Math.round(f.g*255),b:Math.round(f.b*255),a:1}}e.toRgb255a1=i;function r(f){return{r:f.r,g:f.g,b:f.b}}e.clone=r;function s(f){return f=Math.floor(f),{r:(f>>16&255)/255,g:(f>>8&255)/255,b:(f&255)/255}}e.fromHex=s;function n(f){return Math.round(f.r*255)*65536+Math.round(f.g*255)*256+Math.round(f.b*255)}e.toHex=n;function c(f,x){return f.r===x.r&&f.g===x.g&&f.b===x.b}e.equals=c;function u(f,x){return f.r.toFixed(2)===x.r.toFixed(2)&&f.g.toFixed(2)===x.g.toFixed(2)&&f.b.toFixed(2)===x.b.toFixed(2)}e.equalsFixed=u;function p(f,x,w){return{r:f.r+(x.r-f.r)*w,g:f.g+(x.g-f.g)*w,b:f.b+(x.b-f.b)*w}}e.lerp=p})(Da||(Da={}));var fs;(e=>{e.white=pt(me({},Da.white),{a:1}),e.transparent=pt(me({},Da.white),{a:0});function t(p){return{r:p[0],g:p[1],b:p[2],a:p[3]}}e.from0to1=t;function i(p,f){return pt(me({},Da.fromHex(p)),{a:f})}e.fromHexAndA=i;function r(p){return{r:Math.round(p.r*255),g:Math.round(p.g*255),b:Math.round(p.b*255),a:p.a}}e.toRgb255a1=r;function s(p,f){return Da.equals(p,f)&&p.a===f.a}e.equals=s;function n(p,f){return Da.equalsFixed(p,f)&&p.a.toFixed(2)===f.a.toFixed(2)}e.equalsFixed=n;function c(p,f,x){return{r:p.r+(f.r-p.r)*x,g:p.g+(f.g-p.g)*x,b:p.b+(f.b-p.b)*x,a:p.a+(f.a-p.a)*x}}e.lerp=c;function u({r:p,g:f,b:x,a:w}=e.white){return`rgba(${p*255}, ${f*255}, ${x*255}, ${w})`}e.toStyle=u})(fs||(fs={}));var GN;(e=>e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(GN||(GN={}));var SX;(e=>e.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(SX||(SX={}));var EX;(e=>e.defaultData={control1:[.5,0],control2:[.5,1]})(EX||(EX={}));var Kf;(e=>(e.linear=[0,0,1,1],e.ease=[.25,.1,.25,1],e.easeIn=[.42,0,1,1],e.easeOut=[0,0,.58,1],e.easeInOut=[.42,0,.58,1]))(Kf||(Kf={}));function MX(e){return typeof e=="string"&&e.length===36?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e):!1}var jy;(e=>{e.all=["PerspectiveCamera","OrthographicCamera"];function t(i){return e.all.includes(i)}e.is=t})(jy||(jy={}));var fx;(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset};function t(i){return i.type==="PerspectiveCamera"?i.perspective?.zoom??1:i.orthographic?.zoom??1}e.getZoom=t})(fx||(fx={}));var om;(e=>{function t(r,s=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(r[0],r[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[r[0]+r[0]*s,0,0]},grid:{count:[2,2,2],size:r.map(n=>n*(1+s)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}e.defaultData=t;function i(r,s){let n=me({},r);if(qJ.forEach(c=>{Object.assign(n,{[c]:s[c]??r[c]})}),n.radial=me({},r.radial),s.radial){let c=r.radial,u=s.radial;YJ.forEach(p=>{Object.assign(n.radial,{[p]:u[p]??c[p]})})}if(n.linear=me({},r.linear),s.linear){let c=r.linear,u=s.linear;XJ.forEach(p=>{Object.assign(n.linear,{[p]:u[p]??c[p]})})}if(n.grid=me({},r.grid),s.grid){let c=r.grid,u=s.grid;$J.forEach(p=>{Object.assign(n.grid,{[p]:u[p]??c[p]})})}if(n.toObject=me({},r.toObject),s.toObject){let c=r.toObject,u=s.toObject;ZJ.forEach(p=>{Object.assign(n.toObject,{[p]:u[p]??c[p]})})}if(n.randomnessObject=me({},r.randomnessObject),s.randomnessObject){let c=r.randomnessObject,u=s.randomnessObject;QJ.forEach(p=>{Object.assign(n.randomnessObject,{[p]:u[p]??c[p]})})}return n}e.merge=i})(om||(om={}));var HN;(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];function i(r,s){let n=[];r.count!==void 0&&n.push({type:0,path:s,props:{count:r.count}});for(let c of t){let u=r[c];u&&Object.keys(u).length>0&&n.push({type:0,path:[...s,c],props:u})}return n}e.toOps=i})(HN||(HN={}));var qJ=["count"],YJ=["radius","start","end","position","scale","rotation"],XJ=["position","scale","rotation"],$J=["count","size"],ZJ=["count","position","scale","rotation"],QJ=["strength","scale","rotation","position","movement","seed","freqScale"],WN;(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function t(i){return e.all.includes(i)}e.is=t})(WN||(WN={}));var qN;(e=>{function t(r){return i(r)}e.defaultData=t;function i(r){if(r==="PointLight")return{type:r,color:fs.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(r==="SpotLight")return{type:r,color:fs.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:fs.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(qN||(qN={}));var VD;(e=>(e.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},e.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},e.defaultData=me({renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:e.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1},e.defaultCollisionData)))(VD||(VD={}));var mx;(e=>e.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(mx||(mx={}));var YN;(e=>{e.defaultData={castShadow:!0,receiveShadow:!0};function t(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}e.equals=t})(YN||(YN={}));var XN;(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0};function t(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}e.equals=t})(XN||(XN={}));var $N;(e=>e.defaultData=me(me({},XN.defaultData),YN.defaultData))($N||($N={}));var TX;(e=>{function t(i,r){let s=[];if("material"in i){let n=typeof i.material=="string"?r.materials[i.material]??r.lib.materials[i.material]?.asset:i.material;n&&s.push(n)}else if("materials"in i)for(let n of i.materials){let c=typeof n=="string"?r.materials[n]??r.lib.materials[n]?.asset:n;c&&s.push(c)}return s}e.getMaterialData=t})(TX||(TX={}));var GD;(e=>(e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7))(GD||(GD={}));var AX;(e=>{function t(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="particle"||i==="transmission"||i==="matcap"||i==="displace"||i==="pattern"||i==="light"}e.is=t})(AX||(AX={}));function mDe(e){return e.type!=="displace"}var CX;(e=>{function t(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}e.is=t})(CX||(CX={}));var KJ=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],gDe=["wrapping","image","video","name","minFilter","magFilter"],ca;(e=>{function t(n,c){let f=c,{texture:u}=f,p=ll(f,["texture"]);if(Object.assign(n,p),u){let x=n.texture;x&&Object.assign(x,u)}}e.patch=t;function i(n,c){return n==="light"&&c?r(c):s(n)}e.defaultData=i;function r(n){let c={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(n){case"phong":return pt(me({},c),{category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6});case"toon":return pt(me({},c),{category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1});case"lambert":return pt(me({},c),{category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0});case"physical":return pt(me({},c),{category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0})}}function s(n){let c={alpha:1,mode:0,isMask:!1,visible:!0};switch(n){case"texture":return pt(me({},c),{type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1});case"video":return pt(me({},c),{type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:GD.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1});case"color":return pt(me({},c),{type:"color",color:Da.fromHex(mc)});case"depth":return pt(me({},c),{type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200});case"normal":return pt(me({},c),{type:"normal",cnormal:[1,1,1]});case"gradient":return pt(me({},c),{type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]});case"noise":return pt(me({},c),{type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:pt(me({},Da.fromHex(6710886)),{a:1}),colorB:pt(me({},Da.fromHex(6710886)),{a:1}),colorC:pt(me({},Da.fromHex(16777215)),{a:1}),colorD:pt(me({},Da.fromHex(16777215)),{a:1}),distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1});case"fresnel":return pt(me({},c),{type:"fresnel",color:fs.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1});case"rainbow":return pt(me({},c),{type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]});case"toon":return pt(me({},c),{type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:fs.fromHexAndA(0,0),offset:[0,0,0]});case"outline":return pt(me({},c),{type:"outline",outlineColor:fs.fromHexAndA(0,1),contourColor:fs.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0});case"matcap":return pt(me({},c),{type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}});case"transmission":return pt(me({},c),{type:"transmission",thickness:10,ior:1.5,roughness:1});case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return pt(me({},c),{type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:pt(me({},Da.fromHex(0)),{a:1}),colorB:pt(me({},Da.fromHex(16777215)),{a:1}),frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6})}}})(ca||(ca={}));var Ra;(e=>{function t(x){return!x.layers.some(w=>w.data.type==="texture"&&w.data.projection!==0||w.data.type==="depth"&&!w.data.isWorldSpace||w.data.type==="noise"||w.data.type==="displace")}e.isMergable=t;function i(x){let w="";return x.layers.forEach(E=>{Object.entries(E.data).forEach(([A,I])=>{w+=`${A}${I}`,Array.isArray(I)?I.forEach(P=>w+=`${P}`):typeof I=="object"?Object.values(I).forEach(P=>{typeof P=="number"?w+=`${P.toFixed(4)}`:w+=`${P}`}):w+=`${I}`})}),w}e.getHash=i;function r(){return{layers:new pr}}e.defaultEmptyData=r;function s(x="layer1",w="layer2"){return c("phong",x,w)}e.defaultData=s;function n(x,w){return pt(me({},x),{name:w})}e.withName=n;function c(x,w="layer1",E="layer2"){let A=new pr;return A.push({fi:0,data:ca.defaultData("light",x),id:w}),A.push({fi:1,data:ca.defaultData("color"),id:E}),{layers:A}}e.defaultTwoLayerData=c;function u(x){let w=ca.defaultData("texture");x&&Object.assign(w.texture,{image:x});let E=new pr;return E.push({fi:0,data:w,id:"layer1"}),E.push({fi:1,data:pt(me({},ca.defaultData("transmission")),{alpha:1}),id:"layer2"}),E.push({fi:2,data:pt(me({},ca.defaultData("light","lambert")),{alpha:0}),id:"layer3"}),{layers:E}}e.defaultUIObjectMaterial=u;function p(x,w="phong",E="layer1",A="layer2"){let I=ca.defaultData("texture");Object.assign(I.texture,{image:x});let P=new pr;return P.push({fi:0,data:I,id:E}),P.push({fi:1,data:ca.defaultData("light",w),id:A}),{layers:P}}e.defaultTwoLayerTextureData=p;function f(x,w="phong",E="layer1",A="layer2"){let I=ca.defaultData("video");Object.assign(I.texture,{video:x});let P=new pr;return P.push({fi:0,data:I,id:E}),P.push({fi:1,data:ca.defaultData("light",w),id:A}),{layers:P}}e.defaultTwoLayerVideoTextureData=f})(Ra||(Ra={}));var HD;(e=>{function t(){return{points:new pr,roundness:0,shapeHoles:[],isClosed:!1}}e.defaultData=t})(HD||(HD={}));var WD;(e=>{function t(){return{points:new pr,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}e.defaultData=t})(WD||(WD={}));var JJ={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0},ZN;(e=>{function t(i,r){let s=me({},i);return tee.forEach(n=>{Object.assign(s,{[n]:r[n]??i[n]})}),s}e.merge=t})(ZN||(ZN={}));var eee={shape:JJ,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},tee=["depth","offset","angle","twist","startScale","endScale"],qD;(e=>{function t(r){return r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="UIGeometry"}e.is2DParametricMesh=t;function i(r){return r==="PolygonGeometry"||r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="PathGeometry"||r==="VectorGeometry"||r==="ConeGeometry"||r==="CubeGeometry"||r==="CylinderGeometry"||r==="DodecahedronGeometry"||r==="HelixGeometry"||r==="IcosahedronGeometry"||r==="LatheGeometry"||r==="PyramidGeometry"||r==="SphereGeometry"||r==="PlaneGeometry"||r==="BackdropGeometry"||r==="TorusGeometry"||r==="TorusKnotGeometry"||r==="BooleanGeometry"||r==="TextGeometry"||r==="InputGeometry"}e.isParametricMesh=i})(qD||(qD={}));var QN;(e=>{function t(i,r){let s=me({},i);return Object.assign(s,r),s.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(s.extrusion=me({},i.extrusion),Object.assign(s.extrusion,ZN.merge(s.extrusion,r.extrusion))),s}e.merge=t})(QN||(QN={}));var by;(e=>{function t(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="UIGeometry")return{type:i,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:WD.defaultData(),extrusion:eee};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:HD.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="InputGeometry")return pt(me({},e.defaultData("TextGeometry")),{type:i,editable:!0});if(i==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}e.defaultData=t})(by||(by={}));var DX=["width","height","depth"],KN;(e=>e.defaultData={enabled:!1,useBackgroundColor:!1,color:Da.white,near:.1,far:2e3})(KN||(KN={}));var YD;(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:pt(me({},t),{blendFunction:16,granularity:15}),bloom:pt(me({},t),{blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3}),chromaticAberration:pt(me({},t),{offset:[2,2]}),vignette:pt(me({},t),{darkness:1,offset:0}),hueSaturation:pt(me({},t),{hue:3,saturation:0}),brightnessContrast:pt(me({},t),{brightness:.25,contrast:0}),depthOfField:pt(me({},t),{focusDistance:100,focalLength:20,bokehScale:5}),noise:pt(me({},t),{blendFunction:16})}})(YD||(YD={}));var JN;(e=>e.defaultData={softShadowQuality:"low"})(JN||(JN={}));var eB;(e=>e.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(eB||(eB={}));var tB;(e=>e.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})(tB||(tB={}));var gx;(e=>e.defaultData={usePhysics:!1,gravity:-10})(gx||(gx={}));var iB;(e=>e.defaultData={playCamera:Lx,gameControlObject:null})(iB||(iB={}));var rB;(e=>e.defaultData={backgroundColor:fs.fromHexAndA(fDe,1),postprocessing:YD.defaultData,fog:KN.defaultData,globalPhysics:gx.defaultData,ambient:eB.defaultData,ao:tB.defaultData,shadow:JN.defaultData,publish:iB.defaultData})(rB||(rB={}));var nB;(e=>e.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95})(nB||(nB={}));var IX;(e=>{function t(r){return r==="Component"||r==="Instance"}e.isComponentRelated=t;function i(r){return r==="Empty"||r==="Instance"}e.isEmptyOrComponent=i})(IX||(IX={}));var yx;(e=>{e.identity=pt(me({},GN.identity),{hiddenMatrix:px.identity});function t(s){return{position:s.position,rotation:s.rotation,scale:s.scale,hiddenMatrix:s.hiddenMatrix}}e.fromObject=t;function i(s,n){return{position:n?.position||s.position,rotation:n?.rotation||s.rotation,scale:n?.scale||s.scale,hiddenMatrix:n?.hiddenMatrix||s.hiddenMatrix}}e.merge=i;function r(s,n){return gJ({position:Ly.isEqual(s.position,n.position)?void 0:n.position,rotation:Ly.isEqual(s.rotation,n.rotation)?void 0:n.rotation,scale:Ly.isEqual(s.scale,n.scale)?null:n.scale,hiddenMatrix:px.isEqual(s.hiddenMatrix,n.hiddenMatrix)?void 0:n.hiddenMatrix})}e.diff=r})(yx||(yx={}));var ma;(e=>e.defaultData=pt(me({states:new pr,events:new pr,visible:!0,raycastLock:!1,physics:mx.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"}},yx.identity),{cloner:null}))(ma||(ma={}));var sB;(e=>e.defaultData=me({type:"Empty"},ma.defaultData))(sB||(sB={}));var PX;(e=>e.defaultData=me(me({type:"ParticleCollider"},nB.defaultData),ma.defaultData))(PX||(PX={}));var RX;(e=>e.defaultData=me({type:"Component"},ma.defaultData))(RX||(RX={}));var OX;(e=>e.defaultData=me(me({type:"Particle"},ma.defaultData),VD.defaultData))(OX||(OX={}));var wy;(e=>e.defaultData=me(me({type:"Mesh"},ma.defaultData),$N.defaultData))(wy||(wy={}));var DS;(e=>e.defaultData=me(pt(me(me({},ma.defaultData),yx.identity),{position:[0,0,fx.DefaultTargetOffset]}),fx.defaultData))(DS||(DS={}));var oB;(e=>{function t(i){return me(me({},ma.defaultData),qN.defaultData(i))}e.defaultData=t,e.defaultDirectionalLightData=pt(me({},e.defaultData("DirectionalLight")),{position:[200,300,300],name:"Directional Light",intensity:.7})})(oB||(oB={}));var XD;(e=>{function t(r,s,n=0){for(;n<s.length;){let c=r?r[s[n]]:void 0;if(s.length===n+1)return c;if(c)r=c.descendants,n+=1;else return}}e.resolveWithDes=t;function i(r,s,n=0){let c=t(r,s,n);if(c){let u=Object.keys(c);if(u.length===1&&u[0]==="descendants")return}return c}e.resolve=i})(XD||(XD={}));var am;(e=>{e.rootOverrideProps=["physics","events"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"];function t(r,s){return pt(me(me({},ma.defaultData),s),{component:r,overrides:new Do,physics:void 0,events:void 0,type:"Instance"})}e.ofComponent=t;function i(r){let s=yx.fromObject(r.data);return t(r.id,s)}e.fromComponentData=i})(am||(am={}));var vx;(e=>{e.defaultData=pt(me(pt(me({type:"Page"},ma.defaultData),{physics:pt(me({},mx.defaultData),{fusedBody:!1})}),rB.defaultData),{camera:DS.defaultData});function t(i){return i.uiScene!==void 0}e.isUIPage=t})(vx||(vx={}));var aB;(e=>(e.defaultCamera=me({position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:px.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:mx.defaultData,states:new pr,events:new pr,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0}},fx.defaultData),e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject=pt(me(me({name:"Rectangle"},ma.defaultData),wy.defaultData),{geometry:by.defaultData("RectangleGeometry"),material:Ra.defaultTwoLayerData("phong","layer1","layer2")}),e.defaultBooleanObject=pt(me(me({name:"Boolean"},ma.defaultData),wy.defaultData),{geometry:by.defaultData("BooleanGeometry"),material:Ra.defaultTwoLayerData("phong","layer1","layer2")}),e.defaultTextObject=pt(me(me({name:"Text"},ma.defaultData),wy.defaultData),{geometry:by.defaultData("TextGeometry"),material:Ra.defaultTwoLayerData("phong","layer1","layer2")}),e.defaultInputObject=pt(me(me({name:"Input"},ma.defaultData),wy.defaultData),{geometry:by.defaultData("InputGeometry"),material:Ra.defaultTwoLayerData("phong","layer1","layer2")})))(aB||(aB={}));var Sy;(e=>{function t(n,c){let u={name:c};return n.type==="Mesh"?(u.geometry={},"material"in n&&(u.material={layers:new Do}),"materials"in n&&(u.materials=n.materials.map(p=>({layers:new Do})))):jy.is(n.type)&&(u.perspective={},u.orthographic={}),u}e.newEmpty=t;function i(n,c){if(c===void 0)return n;let u=me({},n);return"material"in u&&"material"in c&&c.material&&(u.material=CS(u.material,p=>{if(typeof p!="string")for(let[f,x]of Object.entries(c.material.layers)){let w=p.layers.data(f);w&&ca.patch(w,x)}}).data),u.materials&&c.materials&&(u.materials=CS(u.materials,p=>{for(let f=0;f<u.materials.length;f++){let x=c.materials[f];if(typeof x!="string")for(let[w,E]of Object.entries(x.layers)){let A=p[f]?.layers?.data(w);A&&ca.patch(A,E)}}}).data),u}function r(n,c){let u,p=[],f={orthographic:0,perspective:0,geometry:0};function x(w,E){for(let[I,P]of Object.entries(E.layers)){let A=P,{texture:O}=A,k=ll(A,["texture"]);if(O!==void 0&&Object.keys(O).length>0){let U={path:[...w,"layers",I,"texture"],props:O,type:0};p.push(U)}if(Object.keys(k).length>0){let U={path:[...w,"layers",I],props:k,type:0};p.push(U)}}}for(let[w,E]of Object.entries(c))if(w!=="name")if(w==="cloner")p.push(...HN.toOps(E,["cloner"]));else if(w==="pathSnapping")p.push({path:[w],props:{slide:E.slide,offset:E.offset},type:0});else if(w==="material")x(["material"],E);else if(w==="materials")for(let[A,I]of Object.entries(E))x(["materials",A],I);else if(f[w]===0){if(w==="geometry"&&E.extrusion!==void 0){let A={path:[w,"extrusion"],props:E.extrusion,type:0};p.push(A),E=me({},E),delete E.extrusion}if(Object.keys(E).length>0){let A={path:[w],props:E,type:0};p.push(A)}}else u===void 0&&(u={path:[],props:{},type:0},p.push(u)),u.props[w]=E;return p}e.toOps=r;function s(n,c){if(c===void 0)return n;let u=me({},n);if(Object.assign(u,yx.merge(u,c)),Object.assign(u,{pathSnapping:Object.assign({},u.pathSnapping,{slide:c.pathSnapping?.slide??u.pathSnapping?.slide??0,offset:c.pathSnapping?.offset??u.pathSnapping?.offset??0})}),jy.is(n.type)){u.orthographic=me({},u.orthographic),u.perspective=me({},u.perspective);let p=c;p.orthographic?.zoom!==void 0&&(u.orthographic.zoom=p.orthographic.zoom),p.perspective?.zoom!==void 0&&(u.perspective.zoom=p.perspective.zoom),p.isUpVectorFlipped!==void 0&&(u.isUpVectorFlipped=p.isUpVectorFlipped),p.targetOffset!==void 0&&(u.targetOffset=p.targetOffset)}else if(n.type==="Mesh")"geometry"in c&&Object.assign(u,{geometry:QN.merge(u.geometry,c.geometry)}),(c.material||c.materials)&&(u=i(u,c)),u.cloner&&"cloner"in c&&Object.assign(u,{cloner:om.merge(u.cloner,c.cloner)});else if(n.type==="Empty")u.cloner&&"cloner"in c&&Object.assign(u,{cloner:om.merge(u.cloner,c.cloner)});else if(WN.is(n.type)){let p=c;p.intensity!==void 0&&(u.intensity=p.intensity),p.color!==void 0&&(typeof p.color=="string"?u.color=p.color:u.color=Da.clone(p.color))}return u}e.patch=s})(Sy||(Sy={}));var $D;(e=>e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})($D||($D={}));var lm;(e=>e.defaultData={orbitControls:$D.defaultData,playPage:cS,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((t,i)=>{let r=0,s=0;return i<5?s=-30:i<10&&(s=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,s],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70}},stopRaycast:!0,hdTransmission:!1})(lm||(lm={}));var lB;(e=>e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(lB||(lB={}));var cB;(e=>e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(cB||(cB={}));var Ey;(e=>(e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:me({},lB.defaultData),isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:cB.defaultData}),e.generateSeed=()=>Math.round(Math.random()*1e5)))(Ey||(Ey={}));var IS;(e=>{function t(r){return r.find(s=>s.data.type==="Page"&&s.data.globalPhysics.usePhysics)!==void 0}e.physicsEnabled=t;function i(r,s,n){r.scene.objects.traverseFrom(s,(c,u)=>{if(u.type==="Instance"){let p=KD.getComponentData(r,u.component)?.data;p&&n(c,u,p.events)}else n(c,u,u.events)})}e.traverseModuleInstances=i})(IS||(IS={}));var My;(e=>{e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",e.defaultLight={fi:-1,data:oB.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]};function t(s=!0,n=[]){let c=[],u=aB.defaultMeshObject;s&&(c.push(me({},e.defaultLight)),c.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:u,children:[]})),c.push(...n);let p=new Pa;return p.push({fi:1,id:cS,data:pt(me({},vx.defaultData),{name:"Scene 1"}),children:c}),p}e.createDefaultObjectTreeWithPage=t,e.defaultData={objects:t(),publish:lm.defaultData,styles:Ey.defaultData()},e.emptyDataWithoutPage=function(){return{objects:new Pa,publish:lm.defaultData,styles:Ey.defaultData()}},e.emptyDataWithPage=function(s=!0){return{objects:t(s),publish:lm.defaultData,styles:Ey.defaultData()}},e.emptyData=function(){return{objects:new Pa,publish:me({},lm.defaultData),styles:Ey.defaultData()}};function i(s){return pt(me({},e.defaultData),{objects:eu(s,Pa.prototype)})}e.withObjs=i;function r(s,n){return i([{id:s,data:n,children:[],fi:0}])}e.withObj=r})(My||(My={}));var uS;(e=>e.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}})(uS||(uS={}));var uB;(e=>(e.defaultData=t=>({url:t,name:"New Webhook",parametersSchemas:new pr}),e.defaultParameterValueByType=t=>t==="number"?0:t==="boolean"?!1:""))(uB||(uB={}));var LX;(e=>e.defaultData=(t,i="GET")=>({url:t,method:i,name:"New API",headers:new pr,queries:new pr,autoStart:!0}))(LX||(LX={}));var Oa;(e=>{function t(c){return c.textValue!==void 0}e.isTextValue=t;function i(c){return typeof c=="number"}e.isNumber=i;function r(c){return typeof c=="boolean"}e.isBoolean=r;function s(c){return t(c)?"string":r(c)?"boolean":"number"}e.typeOfVariable=s;function n(c){return e.isTextValue(c)?Array.isArray(c.textValue)?c.textValue.map(u=>u.toString().padStart(c.padding??2,"0")).join(c.deliminator??":")+(c.suffix!==void 0?" "+c.suffix:""):c.textValue.toString():e.isBoolean(c)?c?"True":"False":e.isNumber(c)?parseFloat(c.toFixed(3)).toString():c.toString()}e.getDisplayedValue=n})(Oa||(Oa={}));var hB;(e=>e.all=["images","videos","colors","audios","particles","fonts","materials","variables"])(hB||(hB={}));var zX;(e=>e.all=[...hB.all,"components"])(zX||(zX={}));var FX;(e=>{function t(){return{images:new Mr,videos:new Mr,colors:new Mr,audios:new Mr,particles:new Mr,fonts:new Mr,materials:new Mr,components:new Mr,variables:new Mr,userAPIs:new Mr,userWebhooks:new Mr}}e.defaultData=t})(FX||(FX={}));var Tp;(e=>{function t(){return{images:new Mr,videos:new Mr,colors:new Mr,audios:new Mr,particles:new Mr,fonts:new Mr,materials:new Mr,components:new Mr,variables:new Mr,userAPIs:new Mr,userWebhooks:new Mr}}e.defaultData=t})(Tp||(Tp={}));var Yc;(e=>{function t(){let c={};return c["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},eu(c,Mr.prototype)}e.defaultColors=t;function i(){return eu({},Mr.prototype)}e.defaultImages=i;function r(){return{catelogs:new Mr,materials:new Mr,images:new Mr,videos:new Mr,colors:new Mr,audios:new Mr,particles:new Mr,fonts:new Mr,variables:new pr,userAPIs:new Mr,userWebhooks:new Mr,lib:Tp.defaultData()}}e.emptyData=r;function s(c){switch(c){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let u=[0,0,0];return{name:"Time",value:{textValue:u,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:u,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",c)}}e.defaultVariables=s;function n(c,u){if(u.format==="HH:mm:ss"){let p=Math.floor(c/3600),f=Math.floor((c-p*3600)/60),x=Math.round(c-p*3600-f*60);return{textValue:[p,f,x]}}else if(u.format==="mm:ss"){let p=Math.floor(c/60),f=Math.round(c-p*60);return{textValue:[p,f]}}else return u.format==="number"?c=Math.round(c):c=Math.round(c*1e3)/1e3,c}e.getFormattedTimerTime=n})(Yc||(Yc={}));var ZD;(e=>e.list=["idle","move","jump","run"])(ZD||(ZD={}));var QD;(e=>(e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","\u25B2"],["rotPosY","\u25C0"],["rotNegX","\u25BC"],["rotNegY","\u25B6"],["jump","Space"],["run","\u21E7"],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new pr,move:new pr,jump:new pr,run:new pr},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:fs.fromHexAndA(3728051,1)}}))(QD||(QD={}));function kX(e){e.layers.forEach(t=>{if(t.type==="depth"&&t.colorA!==void 0){let i=t.colorA,r=t.colorB,s=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],n=[0,1];for(let u=2;u<10;u++)s.push(s[1]),n.push(1);let c=pt(me({},_p(po(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode")),{near:Math.max(0,t.near),far:Math.max(0,t.far),colors:s,steps:n,num:2,direction:[1,0,0],smooth:!1,gradientType:1});Object.assign(t,c)}else if(t.type==="depth"&&t.gradientType===1&&(t.near<0||t.far<0)){let i=pt(me({},po(t)),{near:Math.max(t.near,0),far:Math.max(t.far,0)});Object.assign(t,i)}})}function em(e,t){Object.values(e.shared.materials).forEach(i=>t(i))}function tm(e,t){e.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach((s,n)=>{s===void 0&&(r.materials[n]=Ra.defaultData(),s=r.materials[n]),typeof s!="string"&&t(s)}):"material"in r?typeof r.material!="string"&&(r.material===void 0&&(r.material=Ra.defaultData()),t(r.material)):r.type==="Mesh"&&(r.material===void 0&&(r.material=Ra.defaultData()),t(r.material)),"overrides"in r&&Object.values(r.overrides).forEach(s=>{s.material&&typeof s.material!="string"&&Object.getPrototypeOf(s.material)!==Do.prototype&&t(s.material)})})}function yDe(e){Object.assign(e.scene.publish,{orbitControls:me(me({},$D.defaultData),po(e.scene.publish.orbitControls))})}function vDe(e){Object.assign(e.scene.publish.settings,{video:me(me({},lm.defaultData.settings.video),po(e.scene.publish.settings.video))})}function _De(e){function t(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[s,n]of Object.entries(r))if((KJ.includes(s)||typeof n=="boolean")&&delete r[s],s==="texture")for(let[c,u]of Object.entries(n))(gDe.includes(c)||typeof u=="boolean")&&delete n[c]}}}e.scene.objects.traverse((i,r)=>{r.states.forEach(s=>{let n=s;n.material?t(n.material):n.materials&&n.materials.forEach(c=>{t(c)})})})}function xDe(e){e.scene.publish.withBackground=!0}function bDe(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function wDe(e){e.scene.objects.traverse((t,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(s=>s+1),r.linear.scale=r.linear.scale.map(s=>s+1))})}function SDe(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function EDe(e){e.scene.objects.traverse((t,i)=>{let r=e.scene.objects.unproxy().parent(t);if(r){let s=po(e.scene.objects.data(r));s&&s.type==="Mesh"&&s.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=po(i).booleanExclude!==!0)}})}function MDe(e){e.scene.objects.traverse((t,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function TDe(e){function t(r){Object.setPrototypeOf(r,Do.prototype),r.texture&&Object.setPrototypeOf(r.texture,Do.prototype)}function i(r){Object.setPrototypeOf(r,Do.prototype);for(let s in r)t(r[s])}e.scene.objects.traverse((r,s)=>{s.states.forEach(n=>{let c=n;if(c.material){let u=po(c.material).layers;i(u),c.material.layers=u}if(c.materials)for(let u=0;u<c.materials.length;u++){let p=c.materials[u],f=po(p).layers;i(f),p.layers=f}})})}function NX(e){e.layers===void 0&&Object.assign(e,Ra.defaultTwoLayerData("lambert"))}function $F(e){!e.layers||e.layers.forEach(t=>{if(t.type==="depth"&&t.colors.length===10){let i=[...t.colors];i.push(t.colors[9]);let r=[...t.steps];r.push(t.steps[9]);let s=pt(me({},po(t)),{colors:i,steps:r});Object.assign(t,s)}})}function ADe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function BX(e){e.scene.objects.traverse((t,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&$F(r)}):"material"in i&&typeof i.material!="string"&&$F(i.material)}),Object.values(e.shared.materials).forEach(t=>$F(t))}function CDe(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}function DDe(e){e.shared.audios=eu({},Mr.prototype)}function IDe(e){e.shared.videos=eu({},Mr.prototype)}function PDe(e){let t=e.shared.materials;Object.entries(t).forEach(([i,r])=>{if(!r.layers){let s={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[i]:s})}})}function RDe(e){Object.entries(po(e.shared.images)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries(po(e.shared.audios)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}function ODe(e){e.scene.publish.settings.web.preload=!1}function UX(e){e.layers&&e.layers.forEach(t=>{t.type==="depth"&&t.num!==void 0&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function jX(e){e.layers&&e.layers.forEach(t=>{mDe(t)&&t.isMask===void 0&&(t.isMask=!1),(t.type==="texture"||t.type==="video")&&t.blending===void 0&&(t.blending=0),(t.type==="noise"||t.type==="displace"&&t.displacementType==="noise")&&(t.voronoiStyle===void 0&&(t.voronoiStyle=0),t.highCut===void 0&&(t.highCut=1),t.lowCut===void 0&&(t.lowCut=0),t.smoothness===void 0&&(t.smoothness=.3),t.seed===void 0&&(t.seed=0),t.quality===void 0&&(t.quality=1))})}function LDe(e){e.shared.fonts=eu({},Mr.prototype)}function zDe(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function FDe(e){let t=[];e.scene.objects.traverse((i,r)=>{let s=r;if(s.type==="TextFrame"){let n=Ra.defaultTwoLayerData("phong"),c=typeof s.color=="string"?e.shared.colors[s.color]:s.color;n.layers[1].data.color={r:c.r,g:c.g,b:c.b},n.layers[1].data.alpha=s.alpha;let u=zDe(s.font);e.shared.fonts[u]===void 0&&(e.shared.fonts[u]={name:u});let p=pt(me(me({name:s.name},ma.defaultData),wy.defaultData),{flatShading:!1,wireframe:!1,geometry:pt(me({},by.defaultData("TextGeometry")),{width:s.width,height:s.height,font:u,depth:0,horizontalAlign:s.horizontalAlign,verticalAlign:s.verticalAlign,fontSize:s.fontSize*1.40625,lineHeight:s.lineHeight/1.40625,letterSpacing:s.letterSpacing-1,text:s.text,textTransform:s.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1}),material:n,states:po(s.states),events:po(s.events),visible:s.visible,raycastLock:s.raycastLock,position:s.position,rotation:s.rotation,scale:s.scale,hiddenMatrix:s.hiddenMatrix}),f=po(e.scene.objects).parent(i);e.scene.objects.insertAfter(f??null,i,[{id:i+"new",data:p,children:[]}]),t.push(i)}}),t.forEach(i=>{e.scene.objects.delete(i)})}function kDe(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((i,r)=>{r.events.forEach(s=>{if(t[Number(s.type)])if(Object.assign(s,{type:t[Number(s.type)]}),s.type==="Audio"&&"audioEvent"in s&&(Object.assign(s,{playAudio:s.audioEvent}),delete s.audioEvent),s.type==="GameControl")Object.assign(s,{gameActions:{idle:new pr,move:new pr,jump:new pr}});else{let n=new pr;Object.assign(s,{actions:n}),(s.type==="MouseDown"||s.type==="MouseUp"||s.type==="KeyDown"||s.type==="KeyUp")&&"url"in s&&n.push({fi:0,id:Yi.generateUUID(),data:{type:"Link",url:s.url,delay:0}}),"targets"in s&&(s.targets.forEach((c,u,p)=>{let f={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},x={easing:c.easing,duration:c.duration};c.easing===6?Object.assign(x,_p(c,"mass","stiffness","damping","velocity")):c.easing===5&&Object.assign(x,{control1:me({},c.control1),control2:me({},c.control2)});let w={repeat:c.repeat?-1:0,delay:c.delay,delayDirection:c.delayDirection,direction:c.cycle&&c.rewind?"pingpong-rewind":c.cycle?"pingpong":"normal"},E=me(me({state:c.state},w),x),A={allowSlerp:!0,type:"Transition",object:c.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new pr({fi:0,id:Yi.generateUUID(),data:f},{fi:1,id:Yi.generateUUID(),data:E})};n.push({fi:p,id:u,data:A})}),delete s.targets)}})})}function NDe(e){e.scene.objects.traverse((t,i)=>{function r(s,n){let c=new pr,u=[];if(i.events.forEach((p,f,x)=>{if(p.type==="Audio"&&p.trigger===n){let w;u.push(f),p.interaction==="play"?w=pt(me({},_p(p,"interaction","audio","delay","volume","loop")),{triggerAfter:"after"in p?p.after:void 0,toggle:"after"in p?p.toggle:void 0,type:"Audio"}):(p.interaction==="pause"||p.interaction==="stop")&&(w=pt(me({},_p(p,"interaction","delay","object","playAudio")),{type:"Audio"})),w&&c.push({fi:x,id:f,data:w})}}),u.forEach(p=>i.events.delete(p)),c.length){let p=i.events.find(f=>f.type===s)?.data;p?"actions"in p&&p.actions.insertBefore(null,c):i.events.insertBefore(null,[{id:Yi.generateUUID(),data:{type:s,actions:c}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function VX(e){let t=e.layers.find(i=>i.type==="light")?.data;if(t?.category==="basic"){let i=ca.defaultData("light","phong"),r=t;Object.assign(r,i),r.visible=!1}}function GX(e){em(e,VX),tm(e,VX)}function BDe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function UDe(e){e.scene.objects.traverse((t,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner=pt(me({},i.cloner),{toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}))})}function jDe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=Ra.defaultTwoLayerData("phong"))})}function VDe(e){e.scene.publish.orbitControls.autoZoom===void 0&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((t,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function GDe(e){e.scene.objects.traverse((t,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function HDe(e){e.scene.publish.mouseEventTarget===void 0&&(e.scene.publish.mouseEventTarget="canvas"),e.scene.publish.settings.web.hint===void 0&&(e.scene.publish.settings.web.hint=!1)}function WDe(e){let{video:t}=e.scene.publish.settings;t.format==="gif"&&t.fps>48&&(t.fps=15)}function qDe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function YDe(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse((i,r)=>{t&&r.physics===null?r.collision=!1:r.collision="visibility"})}function XDe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.navmesh=QD.defaultDataThirdPerson.navmesh)})})}function $De(e){e.scene.styles||(e.scene.styles=Ey.defaultData())}function HX(e){e.layers.forEach(t=>{t.type==="light"&&t.category!=="toon"&&t.occlusion===void 0&&(t.occlusion=!0)})}function ZDe(e){e.scene.environment.ambientLight.occlusion===void 0&&(e.scene.environment.ambientLight.occlusion=!1),e.scene.environment.ambientLight.aoFullRes===void 0&&(e.scene.environment.ambientLight.aoFullRes=!1),e.scene.environment.ambientLight.radius===void 0&&(e.scene.environment.ambientLight.radius=256),e.scene.environment.ambientLight.bias===void 0&&(e.scene.environment.ambientLight.bias=.5),e.scene.environment.ambientLight.aoColor===void 0&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),tm(e,HX),em(e,HX)}function QDe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&Object.assign(r.gameActions,{run:new pr})})})}function KDe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.keyAssignments=[...r.keyAssignments,["run","\u21E7"],["none","Ctrl"]])})})}function WX(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.bumpMapIntensity===void 0&&(t.bumpMapIntensity=5)})}function JDe(e,t){if(t<1&&(tm(e,kX),em(e,kX),e.schema=1),t<2&&(yDe(e),e.schema=2),t<3&&(_De(e),e.schema=3),t<4&&(xDe(e),e.schema=4),t<5&&(bDe(e),e.schema=5),t<6&&(wDe(e),e.schema=6),t<7&&(SDe(e),e.schema=7),t<8&&(e.schema=8),t<9&&(BX(e),e.schema=9),t<10&&(ADe(e),e.schema=10),t<11&&(CDe(e),e.schema=11),t<12&&(BX(e),e.schema=12),t<13&&(DDe(e),e.schema=13),t<14&&(PDe(e),e.schema=14),t<15&&(RDe(e),e.schema=15),t<16&&(ODe(e),e.schema=16),t<17&&(tm(e,UX),em(e,UX),e.schema=17),t<18&&(tm(e,NX),em(e,NX),e.schema=18),t<19&&(vDe(e),e.schema=19),t<20&&(LDe(e),FDe(e),e.schema=20),t<21&&(kDe(e),NDe(e),e.schema=21),t<22&&(GX(e),e.schema=22),t<23&&(BDe(e),e.schema=23),t<24&&(UDe(e),e.schema=24),(t<25||e.shared.videos===void 0)&&(IDe(e),t<25&&(e.schema=25)),t<26&&(EDe(e),e.schema=26),t<27&&(MDe(e),e.schema=27),t<28&&(GX(e),e.schema=28),t<29&&(TDe(e),e.schema=29),t<30&&(jDe(e),e.schema=30),t<31&&(VDe(e),e.schema=31),t<33&&(GDe(e),e.schema=33),t<34&&(HDe(e),e.schema=34),t<35&&(WDe(e),e.schema=35),t<36&&(qDe(e),e.schema=36),t<37&&(YDe(e),e.schema=37),t<38&&(tm(e,jX),em(e,jX),e.schema=38),t<39&&(XDe(e),e.schema=39),t<40&&($De(e),e.schema=40),t<41&&(ZDe(e),e.schema=41),t<42&&(QDe(e),e.schema=42),t<43&&(KDe(e),e.schema=43),t<99){tm(e,WX),em(e,WX),e.scene.publish.playCamera===null&&(e.scene.publish.playCamera=Lx);let i=po(e.scene.objects),r=e.scene.objects;e.scene.publish.playPage=cS,r.insertBefore(null,null,[{id:cS,data:pt(me({},vx.defaultData),{backgroundColor:e.scene.backgroundColor,fog:e.scene.fog,postprocessing:e.scene.postprocessing,ao:_p(e.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:e.scene.publish.playCamera,gameControlObject:e.scene.publish.gameControlObject},shadow:_p(e.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:me(me({},gx.defaultData),_p(e.scene.environment,"usePhysics","gravity")),camera:po(e.scene.ownerCamera)??vx.defaultData.camera,name:"Scene"}),children:[]}]);for(let c of i)c.id!==My.TRASH_CAN_ID&&r.move(cS,c.fi,c.id);let s=0,n=0;e.shared.penumbraSize&&e.scene.objects.traverse((c,u)=>{u.type==="DirectionalLight"?(u.penumbraSize=e.shared.penumbraSize[Math.min(s,2)],s+=1):u.type==="SpotLight"&&(u.penumbraSize=e.shared.penumbraSize[3+Math.min(n,1)],n+=1),(u.physics===void 0||u.physics===null)&&u.type!=="Instance"&&(u.physics={},Object.assign(u.physics,mx.defaultData)),u.physics!==void 0&&u.physics!==null&&(u.physics.enabled=u.collision??"visibility",delete u.collision)}),e.schema=99}}function qX(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.alphaOverride===void 0&&(t.alphaOverride=1)})}function eIe(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&r.type==="PathGeometry"&&(r.extrusion.capType="flat",r.extrusion.bevel=50,r.extrusion.bevelSides=6,r.extrusion.shape.type==="Custom"&&(r.extrusion.shape.shapeQuality="low"))})}function tIe(e){Array.isArray(po(e.events))&&e.events?.forEach(t=>{"disabled"in t||(t.disabled=!1),(t.type==="MouseDown"||t.type==="MouseUp"||t.type==="MousePress")&&(t.mode=t.mode||"Object")})}var F_=180/Math.PI;function YX(e){e.rotation=e.rotation.slice(0,3).map(t=>t*F_)}function iee(e){YX(e),e.type==="Page"&&YX(e.camera),e.states?.forEach(i=>{i.rotation===void 0||i.rotation===null||(i.rotation=i.rotation.slice(0,3).map(r=>r*F_))});let t=e.geometry;t&&t.type==="SphereGeometry"&&(t.thetaLength=(t.thetaLength??180)*F_),t&&t.type==="TorusGeometry"&&(t.arc=t.arc*F_),t&&t.type==="PathGeometry"&&(t.extrusion.angle*=F_,t.extrusion.twist*=F_),e.type==="Mesh"&&e.geometry.type==="TextGeometry"&&(e.geometry.text={textValue:e.geometry.text}),Array.isArray(po(e.events))&&e.events?.forEach(i=>{(i.type==="MouseDown"||i.type==="MouseUp"||i.type==="MousePress"||i.type==="KeyDown"||i.type==="KeyUp"||i.type==="KeyPress"||i.type==="Collision"||i.type==="Trigger")&&(i.runMode=i.toggle?"Toggle":"Repeat")})}function iIe(e){e.shared.variables=eu({},Mr.prototype)}function rIe(e){let t=po(e.shared.variables);e.shared.variables=eu(Object.entries(t??{}).map(([i,r],s)=>({fi:s,id:i,data:r})),pr.prototype)}var ap=115;function ree(e,t){t(e.data);for(let i of e.children)ree(i,t)}function nIe(e){let t=e.schema??104;t!==ap&&t<105&&(ree(e.asset,iee),e.schema=105)}function sIe(e){e.shared.particles=eu({},Mr.prototype),e.shared.lib&&(e.shared.lib.particles=Tp.defaultData().particles)}function oIe(e){e.scene.objects.traverse((t,i)=>{i.type==="Particle"&&typeof i.renderMaterial.size=="number"&&Object.assign(i.renderMaterial,{size:[i.renderMaterial.size,i.renderMaterial.size]})})}function aIe(e){e.scene.objects.traverse((t,i)=>{i.type==="Page"&&(i.postprocessing.depthOfField.focusDistance=100,i.postprocessing.depthOfField.focalLength=20,i.postprocessing.depthOfField.bokehScale=5)})}function lIe(e){e.scene.objects.traverse((t,i)=>{Array.isArray(po(i.events))!==!1&&i.events?.forEach(r=>{let s=r.runMode;r.type==="MouseDown"||r.type==="MouseUp"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="Collision"||r.type==="Trigger"?r.actions?.forEach(n=>{n.type==="Transition"&&(n.runMode=s??"Repeat"),(n.type==="Animation"||n.type==="SwitchCamera")&&(n.runMode=s==="Toggle"?"Toggle":"Normal")}):r.type==="MouseHover"||r.type==="MousePress"||r.type==="KeyPress"?r.actions?.forEach(n=>{(n.type==="Transition"||n.type==="Animation"||n.type==="SwitchCamera")&&(n.runMode="Toggle")}):r.type==="GameControl"?(delete r.actions,Object.keys(r.gameActions).forEach(n=>{r.gameActions[n]?.forEach(c=>{c.type==="Transition"&&(c.runMode="Repeat"),c.type==="Animation"&&(c.runMode="Normal")})})):r.type==="DragDrop"?(delete r.actions,r.dragDropActions?.drag?.forEach(n=>{(n.type==="Transition"||n.type==="Animation"||n.type==="SwitchCamera")&&(n.runMode="Toggle")}),r.dragDropActions?.drop?.forEach(n=>{(n.type==="Transition"||n.type==="Animation"||n.type==="SwitchCamera")&&(n.runMode="Toggle")})):r.type==="Resize"?(delete r.actions,r.breakpoints?.forEach(n=>{n.actions?.forEach(c=>{(c.type==="Transition"||c.type==="Animation"||c.type==="SwitchCamera")&&(c.runMode="Toggle")})})):r.type==="Start"?r.actions?.forEach(n=>{n.type==="Transition"&&(n.runMode="Once"),(n.type==="Animation"||n.type==="SwitchCamera")&&(n.runMode="Normal")}):r.type==="VariableChange"||r.type==="Scroll"?r.actions?.forEach(n=>{n.type==="Transition"&&(n.runMode="Repeat"),(n.type==="Animation"||n.type==="SwitchCamera")&&(n.runMode="Normal")}):r.type==="Conditional"&&(delete r.actions,r.inActions?.forEach(n=>{n.type==="Transition"&&(n.runMode="Repeat"),(n.type==="Animation"||n.type==="SwitchCamera")&&(n.runMode="Normal")}),r.outActions?.forEach(n=>{n.type==="Transition"&&(n.runMode="Repeat"),(n.type==="Animation"||n.type==="SwitchCamera")&&(n.runMode="Normal")}))})})}function cIe(e){e.shared.userAPIs=eu({},Mr.prototype),e.shared.userWebhooks=eu({},Mr.prototype),e.shared.lib&&(e.shared.lib.userAPIs=Tp.defaultData().userAPIs,e.shared.lib.userWebhooks=Tp.defaultData().userWebhooks)}function nee(e){let t=e.schema??0;if(t!==ap){console.warn("updating from ",t,"to ",ap),JDe(e,t),t<100&&(e.scene.publish.joystickSizeAndXYOffset===void 0&&(e.scene.publish.joystickSizeAndXYOffset=lm.defaultData.joystickSizeAndXYOffset),e.schema=100),t<101&&(tm(e,qX),em(e,qX),e.schema=101),t<102&&(eIe(e),e.schema=102),t<104&&(e.shared.catelogs=new Mr,e.shared.lib=Tp.defaultData(),e.schema=104),t<105&&(iIe(e),e.scene.objects.traverse((i,r)=>{iee(r)}),e.schema=105);for(let i of Object.values(e.shared.lib.components))nIe(i);t<106&&(rIe(e),e.schema=106),t<107&&(e.shared.lib.variables=Tp.defaultData().variables,e.schema=107),t<109&&(sIe(e),e.schema=109),t<110&&(oIe(e),e.schema=110),t<111&&(e.scene.objects.traverse((i,r)=>{tIe(r)}),e.schema=111),t<112&&(aIe(e),e.schema=112),t<113&&(lIe(e),e.schema=113),t<114&&(e.scene.publish.settings.web.imageQuality===void 0&&(e.scene.publish.settings.web.imageQuality=70),e.schema=114),t<115&&(cIe(e),e.schema=115)}}var KD;(e=>{e.defaultData={schema:ap,scene:My.defaultData,frames:new Mr().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",uS.defaultData),shared:pt(me({},Yc.emptyData()),{colors:Yc.defaultColors()})},e.emptyDataForImports=function(){let n=My.emptyDataWithPage();return{schema:ap,scene:n,frames:new Mr().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",uS.defaultData),shared:pt(me({},Yc.emptyData()),{colors:Yc.defaultColors(),images:Yc.defaultImages()})}},e.emptyData=function(){return{schema:ap,scene:My.emptyDataWithPage(),frames:new Mr().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",uS.defaultData),shared:Yc.emptyData()}},e.clipboard2dData=function(){return{schema:ap,scene:My.emptyData(),frames:new Mr,shared:Yc.emptyData()}},e.collabHelper=pt(me({},IN),{updateSchema(n){return(n.schema??0)<ap?CS(n,nee):(n.schema??0)-ap}});function t(n){let c=e.collabHelper.updateSchema(n);return typeof c=="number"?c===0?n:null:c.data}e.updateSchemaDirectly=t;function i(n){return pt(me({},n),{shared:pt(me({},n.shared),{lib:Tp.defaultData()})})}e.withoutLib=i;function r(n,c){let u=n.scene.objects.get(c);if(u&&u.data.type==="Component")return u;{let p=n.shared.lib.components[c];if(p)return p.asset}}e.getComponentData=r;function s(n){let c=Object.values(n.shared.userAPIs);for(let u of c){let p=u.headers;for(let f of p)if(f.data.key.toLowerCase()==="authorization"&&f.data.value!=="")return!0}return!1}e.hasSensitiveData=s})(KD||(KD={}));var dB;(e=>e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(dB||(dB={}));var XX;(e=>{function t(i){return!0}e.is=t})(XX||(XX={}));var JD;(e=>{e.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]};function t(r,s){return{position:s?.position??r.position,rotation:s?.rotation??r.rotation,scale:s?.scale??r.scale,shear:s?.shear??r.shear}}e.merge=t;function i(r,s){return gJ({position:yp.isEqual(r.position,s.position)?void 0:s.position,rotation:r.rotation===s.rotation?void 0:s.rotation,scale:yp.isEqual(r.scale,s.scale)?void 0:s.scale,shear:r.shear&&s.shear&&yp.isEqual(r.shear,s.shear)?void 0:s.shear})}e.diff=i})(JD||(JD={}));var pB;(e=>e.defaultData={horizontalConstraint:0,verticalConstraint:0})(pB||(pB={}));var $X;(e=>e.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8})($X||($X={}));var eI;(e=>e.defaultData={opacity:1,fill:{color:fs.fromHexAndA(mc,1),enabled:!0},stroke:{color:fs.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:fs.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:fs.from0to1([0,0,0,1]),enabled:!1,spread:0}})(eI||(eI={}));var Ty;(e=>{function t(c,u){return{name:u}}e.newEmpty=t;function i(c,u){if(u===void 0)return c;let p=me({},c),f=["width","height","cornerRadius"];for(let x of f)x in p&&x in u&&u[x]!==void 0&&Object.assign(p,{[x]:u[x]});return p}function r(c,u){if(u===void 0)return c;let p=me({},c);return"fill"in p&&"fill"in u&&u.fill!==void 0&&Object.assign(p,{fill:me(me({},p.fill),u.fill)}),"stroke"in p&&"stroke"in u&&u.stroke!==void 0&&Object.assign(p,{stroke:me(me({},p.stroke),u.stroke)}),"layerBlur"in p&&"layerBlur"in u&&u.layerBlur!==void 0&&Object.assign(p,{layerBlur:me(me({},p.layerBlur),u.layerBlur)}),"backgroundBlur"in p&&"backgroundBlur"in u&&u.backgroundBlur!==void 0&&Object.assign(p,{backgroundBlur:me(me({},p.backgroundBlur),u.backgroundBlur)}),"dropShadow"in p&&"dropShadow"in u&&u.dropShadow!==void 0&&Object.assign(p,{dropShadow:me(me({},p.dropShadow),u.dropShadow)}),"innerShadow"in p&&"innerShadow"in u&&u.innerShadow!==void 0&&Object.assign(p,{innerShadow:me(me({},p.innerShadow),u.innerShadow)}),p}function s(c,u){if(u===void 0)return c;let p=me({},c);return Object.assign(p,JD.merge(p,u)),p=i(p,u),p=r(p,u),p}e.patch=s;function n(c,u){let p,f=[];for(let[x,w]of Object.entries(u))x!=="name"&&(p===void 0&&(p={path:[],props:{},type:0},f.push(p)),p.props[x]=w);return f}e.toOps=n})(Ty||(Ty={}));var PS;(e=>e.defaultData=pt(me(me({},JD.defaultData),pB.defaultData),{states:new pr,events:new pr,visible:!0,raycastLock:!1}))(PS||(PS={}));var _x;(e=>e.defaultData=me(me({},PS.defaultData),eI.defaultData))(_x||(_x={}));var tI;(e=>e.defaultData={cornerRadius:[0,0,0,0]})(tI||(tI={}));var fB;(e=>e.defaultData=pt(me({},_x.defaultData),{type:"ellipse2d",width:100,height:100,name:"Ellipse"}))(fB||(fB={}));var RS;(e=>e.defaultData=pt(me(me({},_x.defaultData),tI.defaultData),{type:"rectangle2d",width:100,height:100,name:"Rectangle"}))(RS||(RS={}));var mB;(e=>e.defaultData=pt(me({},_x.defaultData),{type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"}))(mB||(mB={}));var gB;(e=>e.defaultData=pt(me({},_x.defaultData),{type:"path2d",path:"",name:"Path"}))(gB||(gB={}));var ZX;(e=>{function t(i){return i.type==="ellipse2d"||i.type==="rectangle2d"||i.type==="text2d"||i.type==="vector2d"||i.type==="path2d"}e.is=t})(ZX||(ZX={}));var iI;(e=>e.defaultData=pt(me({},PS.defaultData),{name:"Group",type:"group2d"}))(iI||(iI={}));var yB;(e=>e.defaultData=()=>pt(me(me(me({},PS.defaultData),tI.defaultData),eI.defaultData),{name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:fs.fromHexAndA(4737101,1),enabled:!0},stroke:{color:fs.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}}))(yB||(yB={}));var zy;(e=>{function t(c){switch(c){case"rectangle2d":return me({},RS.defaultData);case"ellipse2d":return me({},fB.defaultData);case"text2d":return me({},mB.defaultData);case"vector2d":return me({},RS.defaultData);case"path2d":return me({},gB.defaultData);case"frame2d":return me({},yB.defaultData());case"group2d":return me({},iI.defaultData)}}e.defaultData=t;function i(c){return"width"in c&&"height"in c?[typeof c.width=="number"?c.width*.5:0,typeof c.height=="number"?c.height*.5:0]:[0,0]}e.getPivot=i;function r(c){return c.type==="rectangle2d"||c.type==="ellipse2d"||c.type==="text2d"||c.type==="frame2d"}e.isResizeable=r;function s(c){return c.type==="frame2d"&&c.autoLayout!==void 0}e.isAutoLayoutable=s;function n(c){return c.type==="rectangle2d"||c.type==="frame2d"}e.hasCorners=n})(zy||(zy={}));var vB;(e=>(e.defaultData={name:"UI",type:"scene2d",objects:new Pa},e.emptyData=function(){return{type:"scene2d",objects:new Pa}}))(vB||(vB={}));function Ay(e,t=!1){let i=e[0].index!==null,r=new Set(Object.keys(e[0].attributes)),s=new Set(Object.keys(e[0].morphAttributes)),n={},c={},u=e[0].morphTargetsRelative,p=new fr,f=0;for(let x=0;x<e.length;++x){let w=e[x],E=0;if(i!==(w.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+x+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let A in w.attributes){if(!r.has(A))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+x+'. All geometries must have compatible attributes; make sure "'+A+'" attribute exists among all geometries, or in none of them.'),null;n[A]===void 0&&(n[A]=[]),n[A].push(w.attributes[A]),E++}if(E!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+x+". Make sure all geometries have the same number of attributes."),null;if(u!==w.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+x+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let A in w.morphAttributes){if(!s.has(A))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+x+".  .morphAttributes must be consistent throughout all geometries."),null;c[A]===void 0&&(c[A]=[]),c[A].push(w.morphAttributes[A])}if(t){let A;if(i)A=w.index.count;else if(w.attributes.position!==void 0)A=w.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+x+". The geometry must have either an index or a position attribute"),null;p.addGroup(f,A,x),f+=A}}if(i){let x=0,w=[];for(let E=0;E<e.length;++E){let A=e[E].index;for(let I=0;I<A.count;++I)w.push(A.getX(I)+x);x+=e[E].attributes.position.count}p.setIndex(w)}for(let x in n){let w=QX(n[x]);if(!w)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+x+" attribute."),null;p.setAttribute(x,w)}for(let x in c){let w=c[x][0].length;if(w===0)break;p.morphAttributes=p.morphAttributes||{},p.morphAttributes[x]=[];for(let E=0;E<w;++E){let A=[];for(let P=0;P<c[x].length;++P)A.push(c[x][P][E]);let I=QX(A);if(!I)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+x+" morphAttribute."),null;p.morphAttributes[x].push(I)}}return p}function QX(e){let t,i,r,s=0;for(let u=0;u<e.length;++u){let p=e[u];if(p.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=p.array.constructor),t!==p.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=p.itemSize),i!==p.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=p.normalized),r!==p.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;s+=p.array.length}let n=new t(s),c=0;for(let u=0;u<e.length;++u)n.set(e[u].array,c),c+=e[u].array.length;return new Fr(n,i,r)}var uIe=Math.pow(2,-24),c2=class{constructor(){}};function Yh(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function KX(e){let t=-1,i=-1/0;for(let r=0;r<3;r++){let s=e[r+3]-e[r];s>i&&(i=s,t=r)}return t}function JX(e,t){t.set(e)}function e$(e,t,i){let r,s;for(let n=0;n<3;n++){let c=n+3;r=e[n],s=t[n],i[n]=r<s?r:s,r=e[c],s=t[c],i[c]=r>s?r:s}}function u2(e,t,i){for(let r=0;r<3;r++){let s=t[e+2*r],n=t[e+2*r+1],c=s-n,u=s+n;c<i[r]&&(i[r]=c),u>i[r+3]&&(i[r+3]=u)}}function Iw(e){let t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2];return 2*(t*i+i*r+r*t)}function hIe(e,t){if(!e.index){let i=e.attributes.position.count,r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,s;i>65535?s=new Uint32Array(new r(4*i)):s=new Uint16Array(new r(2*i)),e.setIndex(new Fr(s,1));for(let n=0;n<i;n++)s[n]=n}}function dIe(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let s of e.groups)i.add(s.start),i.add(s.start+s.count);let r=Array.from(i.values()).sort((s,n)=>s-n);for(let s=0;s<r.length-1;s++){let n=r[s],c=r[s+1];t.push({offset:n/3,count:(c-n)/3})}return t}function ZF(e,t,i,r,s=null){let n=1/0,c=1/0,u=1/0,p=-1/0,f=-1/0,x=-1/0,w=1/0,E=1/0,A=1/0,I=-1/0,P=-1/0,O=-1/0,k=s!==null;for(let U=t*6,j=(t+i)*6;U<j;U+=6){let V=e[U+0],$=e[U+1],Y=V-$,J=V+$;Y<n&&(n=Y),J>p&&(p=J),k&&V<w&&(w=V),k&&V>I&&(I=V);let X=e[U+2],ee=e[U+3],oe=X-ee,le=X+ee;oe<c&&(c=oe),le>f&&(f=le),k&&X<E&&(E=X),k&&X>P&&(P=X);let ve=e[U+4],we=e[U+5],fe=ve-we,Ue=ve+we;fe<u&&(u=fe),Ue>x&&(x=Ue),k&&ve<A&&(A=ve),k&&ve>O&&(O=ve)}r[0]=n,r[1]=c,r[2]=u,r[3]=p,r[4]=f,r[5]=x,k&&(s[0]=w,s[1]=E,s[2]=A,s[3]=I,s[4]=P,s[5]=O)}function pIe(e,t,i,r){let s=1/0,n=1/0,c=1/0,u=-1/0,p=-1/0,f=-1/0;for(let x=t*6,w=(t+i)*6;x<w;x+=6){let E=e[x+0];E<s&&(s=E),E>u&&(u=E);let A=e[x+2];A<n&&(n=A),A>p&&(p=A);let I=e[x+4];I<c&&(c=I),I>f&&(f=I)}r[0]=s,r[1]=n,r[2]=c,r[3]=u,r[4]=p,r[5]=f}function fIe(e,t,i,r,s){let n=i,c=i+r-1,u=s.pos,p=s.axis*2;for(;;){for(;n<=c&&t[n*6+p]<u;)n++;for(;n<=c&&t[c*6+p]>=u;)c--;if(n<c){for(let f=0;f<3;f++){let x=e[n*3+f];e[n*3+f]=e[c*3+f],e[c*3+f]=x;let w=t[n*6+f*2+0];t[n*6+f*2+0]=t[c*6+f*2+0],t[c*6+f*2+0]=w;let E=t[n*6+f*2+1];t[n*6+f*2+1]=t[c*6+f*2+1],t[c*6+f*2+1]=E}n++,c--}else return n}}var ip=32,mIe=(e,t)=>e.candidate-t.candidate,Gf=new Array(ip).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),h2=new Float32Array(6);function gIe(e,t,i,r,s,n){let c=-1,u=0;if(n===0)c=KX(t),c!==-1&&(u=(t[c]+t[c+3])/2);else if(n===1)c=KX(e),c!==-1&&(u=yIe(i,r,s,c));else if(n===2){let p=Iw(e),f=1.25*s,x=r*6,w=(r+s)*6;for(let E=0;E<3;E++){let A=t[E],I=(t[E+3]-A)/ip;if(s<ip/4){let P=[...Gf];P.length=s;let O=0;for(let U=x;U<w;U+=6,O++){let j=P[O];j.candidate=i[U+2*E],j.count=0;let{bounds:V,leftCacheBounds:$,rightCacheBounds:Y}=j;for(let J=0;J<3;J++)Y[J]=1/0,Y[J+3]=-1/0,$[J]=1/0,$[J+3]=-1/0,V[J]=1/0,V[J+3]=-1/0;u2(U,i,V)}P.sort(mIe);let k=s;for(let U=0;U<k;U++){let j=P[U];for(;U+1<k&&P[U+1].candidate===j.candidate;)P.splice(U+1,1),k--}for(let U=x;U<w;U+=6){let j=i[U+2*E];for(let V=0;V<k;V++){let $=P[V];j>=$.candidate?u2(U,i,$.rightCacheBounds):(u2(U,i,$.leftCacheBounds),$.count++)}}for(let U=0;U<k;U++){let j=P[U],V=j.count,$=s-j.count,Y=j.leftCacheBounds,J=j.rightCacheBounds,X=0;V!==0&&(X=Iw(Y)/p);let ee=0;$!==0&&(ee=Iw(J)/p);let oe=1+1.25*(X*V+ee*$);oe<f&&(c=E,f=oe,u=j.candidate)}}else{for(let k=0;k<ip;k++){let U=Gf[k];U.count=0,U.candidate=A+I+k*I;let j=U.bounds;for(let V=0;V<3;V++)j[V]=1/0,j[V+3]=-1/0}for(let k=x;k<w;k+=6){let U=~~((i[k+2*E]-A)/I);U>=ip&&(U=ip-1);let j=Gf[U];j.count++,u2(k,i,j.bounds)}let P=Gf[ip-1];JX(P.bounds,P.rightCacheBounds);for(let k=ip-2;k>=0;k--){let U=Gf[k],j=Gf[k+1];e$(U.bounds,j.rightCacheBounds,U.rightCacheBounds)}let O=0;for(let k=0;k<ip-1;k++){let U=Gf[k],j=U.count,V=U.bounds,$=Gf[k+1].rightCacheBounds;j!==0&&(O===0?JX(V,h2):e$(V,h2,h2)),O+=j;let Y=0,J=0;O!==0&&(Y=Iw(h2)/p);let X=s-O;X!==0&&(J=Iw($)/p);let ee=1+1.25*(Y*O+J*X);ee<f&&(c=E,f=ee,u=U.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${n} used.`);return{axis:c,pos:u}}function yIe(e,t,i,r){let s=0;for(let n=t,c=t+i;n<c;n++)s+=e[n*6+r*2];return s/i}function vIe(e,t){let i=e.attributes.position,r=e.index.array,s=r.length/3,n=new Float32Array(s*6),c=i.normalized,u=i.array,p=i.offset||0,f=3;i.isInterleavedBufferAttribute&&(f=i.data.stride);let x=["getX","getY","getZ"];for(let w=0;w<s;w++){let E=w*3,A=w*6,I,P,O;c?(I=r[E+0],P=r[E+1],O=r[E+2]):(I=r[E+0]*f+p,P=r[E+1]*f+p,O=r[E+2]*f+p);for(let k=0;k<3;k++){let U,j,V;c?(U=i[x[k]](I),j=i[x[k]](P),V=i[x[k]](O)):(U=u[I+k],j=u[P+k],V=u[O+k]);let $=U;j<$&&($=j),V<$&&($=V);let Y=U;j>Y&&(Y=j),V>Y&&(Y=V);let J=(Y-$)/2,X=k*2;n[A+X+0]=$+J,n[A+X+1]=J+(Math.abs($)+J)*uIe,$<t[k]&&(t[k]=$),Y>t[k+3]&&(t[k+3]=Y)}}return n}function _Ie(e,t){function i(k){E&&E(k/A)}function r(k,U,j,V=null,$=0){if(!I&&$>=p&&(I=!0,f&&(console.warn(`MeshBVH: Max depth of ${p} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),j<=x||$>=p)return i(U+j),k.offset=U,k.count=j,k;let Y=gIe(k.boundingData,V,c,U,j,w);if(Y.axis===-1)return i(U+j),k.offset=U,k.count=j,k;let J=fIe(u,c,U,j,Y);if(J===U||J===U+j)i(U+j),k.offset=U,k.count=j;else{k.splitAxis=Y.axis;let X=new c2,ee=U,oe=J-U;k.left=X,X.boundingData=new Float32Array(6),ZF(c,ee,oe,X.boundingData,n),r(X,ee,oe,n,$+1);let le=new c2,ve=J,we=j-oe;k.right=le,le.boundingData=new Float32Array(6),ZF(c,ve,we,le.boundingData,n),r(le,ve,we,n,$+1)}return k}hIe(e,t);let s=new Float32Array(6),n=new Float32Array(6),c=vIe(e,s),u=e.index.array,p=t.maxDepth,f=t.verbose,x=t.maxLeafTris,w=t.strategy,E=t.onProgress,A=e.index.count/3,I=!1,P=[],O=dIe(e);if(O.length===1){let k=O[0],U=new c2;U.boundingData=s,pIe(c,k.offset,k.count,n),r(U,k.offset,k.count,n),P.push(U)}else for(let k of O){let U=new c2;U.boundingData=new Float32Array(6),ZF(c,k.offset,k.count,U.boundingData,n),r(U,k.offset,k.count,n),P.push(U)}return P}function xIe(e,t){let i=_Ie(e,t),r,s,n,c=[],u=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let x=0;x<i.length;x++){let w=i[x],E=p(w),A=new u(32*E);r=new Float32Array(A),s=new Uint32Array(A),n=new Uint16Array(A),f(0,w),c.push(A)}return c;function p(x){return x.count?1:1+p(x.left)+p(x.right)}function f(x,w){let E=x/4,A=x/2,I=!!w.count,P=w.boundingData;for(let O=0;O<6;O++)r[E+O]=P[O];if(I){let O=w.offset,k=w.count;return s[E+6]=O,n[A+14]=k,n[A+15]=65535,x+32}else{let O=w.left,k=w.right,U=w.splitAxis,j;if(j=f(x+32,O),j/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return s[E+6]=j/4,j=f(j,k),s[E+7]=U,j}}}var td=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,r=-1/0;for(let s=0,n=e.length;s<n;s++){let c=e[s][t];i=c<i?c:i,r=c>r?c:r}this.min=i,this.max=r}setFromPoints(e,t){let i=1/0,r=-1/0;for(let s=0,n=t.length;s<n;s++){let c=t[s],u=e.dot(c);i=u<i?u:i,r=u>r?u:r}this.min=i,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}};td.prototype.setFromBox=function(){let e=new se;return function(t,i){let r=i.min,s=i.max,n=1/0,c=-1/0;for(let u=0;u<=1;u++)for(let p=0;p<=1;p++)for(let f=0;f<=1;f++){e.x=r.x*u+s.x*(1-u),e.y=r.y*p+s.y*(1-p),e.z=r.z*f+s.z*(1-f);let x=t.dot(e);n=Math.min(x,n),c=Math.max(x,c)}this.min=n,this.max=c}}();var wYe=function(){let e=new td;return function(t,i){let r=t.points,s=t.satAxes,n=t.satBounds,c=i.points,u=i.satAxes,p=i.satBounds;for(let f=0;f<3;f++){let x=n[f],w=s[f];if(e.setFromPoints(w,c),x.isSeparated(e))return!1}for(let f=0;f<3;f++){let x=p[f],w=u[f];if(e.setFromPoints(w,r),x.isSeparated(e))return!1}}}(),bIe=function(){let e=new se,t=new se,i=new se;return function(r,s,n){let c=r.start,u=e,p=s.start,f=t;i.subVectors(c,p),e.subVectors(r.end,r.start),t.subVectors(s.end,s.start);let x=i.dot(f),w=f.dot(u),E=f.dot(f),A=i.dot(u),I=u.dot(u)*E-w*w,P,O;I!==0?P=(x*w-A*E)/I:P=0,O=(x+P*w)/E,n.x=P,n.y=O}}(),tU=function(){let e=new lt,t=new se,i=new se;return function(r,s,n,c){bIe(r,s,e);let u=e.x,p=e.y;if(u>=0&&u<=1&&p>=0&&p<=1){r.at(u,n),s.at(p,c);return}else if(u>=0&&u<=1){p<0?s.at(0,c):s.at(1,c),r.closestPointToPoint(c,!0,n);return}else if(p>=0&&p<=1){u<0?r.at(0,n):r.at(1,n),s.closestPointToPoint(n,!0,c);return}else{let f;u<0?f=r.start:f=r.end;let x;p<0?x=s.start:x=s.end;let w=t,E=i;if(r.closestPointToPoint(x,!0,t),s.closestPointToPoint(f,!0,i),w.distanceToSquared(x)<=E.distanceToSquared(f)){n.copy(w),c.copy(x);return}else{n.copy(f),c.copy(E);return}}}}(),wIe=function(){let e=new se,t=new se,i=new zl,r=new Qc;return function(s,n){let{radius:c,center:u}=s,{a:p,b:f,c:x}=n;if(r.start=p,r.end=f,r.closestPointToPoint(u,!0,e).distanceTo(u)<=c||(r.start=p,r.end=x,r.closestPointToPoint(u,!0,e).distanceTo(u)<=c)||(r.start=f,r.end=x,r.closestPointToPoint(u,!0,e).distanceTo(u)<=c))return!0;let w=n.getPlane(i);if(Math.abs(w.distanceToPoint(u))<=c){let E=w.projectPoint(u,t);if(n.containsPoint(E))return!0}return!1}}(),SIe=1e-15;function v_(e){return Math.abs(e)<SIe}var Ap=class extends Ia{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new se),this.satBounds=new Array(4).fill().map(()=>new td),this.points=[this.a,this.b,this.c],this.sphere=new jl,this.plane=new zl,this.needsUpdate=!0}intersectsSphere(e){return wIe(e,this)}update(){let e=this.a,t=this.b,i=this.c,r=this.points,s=this.satAxes,n=this.satBounds,c=s[0],u=n[0];this.getNormal(c),u.setFromPoints(c,r);let p=s[1],f=n[1];p.subVectors(e,t),f.setFromPoints(p,r);let x=s[2],w=n[2];x.subVectors(t,i),w.setFromPoints(x,r);let E=s[3],A=n[3];E.subVectors(i,e),A.setFromPoints(E,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(c,e),this.needsUpdate=!1}};Ap.prototype.closestPointToSegment=function(){let e=new se,t=new se,i=new Qc;return function(r,s=null,n=null){let{start:c,end:u}=r,p=this.points,f,x=1/0;for(let w=0;w<3;w++){let E=(w+1)%3;i.start.copy(p[w]),i.end.copy(p[E]),tU(i,r,e,t),f=e.distanceToSquared(t),f<x&&(x=f,s&&s.copy(e),n&&n.copy(t))}return this.closestPointToPoint(c,e),f=c.distanceToSquared(e),f<x&&(x=f,s&&s.copy(e),n&&n.copy(c)),this.closestPointToPoint(u,e),f=u.distanceToSquared(e),f<x&&(x=f,s&&s.copy(e),n&&n.copy(u)),Math.sqrt(x)}}();Ap.prototype.intersectsTriangle=function(){let e=new Ap,t=new Array(3),i=new Array(3),r=new td,s=new td,n=new se,c=new se,u=new se,p=new se,f=new Qc,x=new Qc,w=new Qc;return function(E,A=null,I=!1){this.needsUpdate&&this.update(),E.isExtendedTriangle?E.needsUpdate&&E.update():(e.copy(E),e.update(),E=e);let P=this.plane,O=E.plane;if(Math.abs(P.normal.dot(O.normal))>1-1e-10){let k=this.satBounds,U=this.satAxes;i[0]=E.a,i[1]=E.b,i[2]=E.c;for(let $=0;$<4;$++){let Y=k[$],J=U[$];if(r.setFromPoints(J,i),Y.isSeparated(r))return!1}let j=E.satBounds,V=E.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let $=0;$<4;$++){let Y=j[$],J=V[$];if(r.setFromPoints(J,t),Y.isSeparated(r))return!1}for(let $=0;$<4;$++){let Y=U[$];for(let J=0;J<4;J++){let X=V[J];if(n.crossVectors(Y,X),r.setFromPoints(n,t),s.setFromPoints(n,i),r.isSeparated(s))return!1}}return A&&(I||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),A.start.set(0,0,0),A.end.set(0,0,0)),!0}else{let k=this.points,U=!1,j=0;for(let we=0;we<3;we++){let fe=k[we],Ue=k[(we+1)%3];f.start.copy(fe),f.end.copy(Ue),f.delta(c);let Fe=U?x.start:x.end,Pe=v_(O.distanceToPoint(fe));if(v_(O.normal.dot(c))&&Pe){x.copy(f),j=2;break}if((O.intersectLine(f,Fe)||Pe)&&!v_(Fe.distanceTo(Ue))){if(j++,U)break;U=!0}}if(j===1&&E.containsPoint(x.end))return A&&(A.start.copy(x.end),A.end.copy(x.end)),!0;if(j!==2)return!1;let V=E.points,$=!1,Y=0;for(let we=0;we<3;we++){let fe=V[we],Ue=V[(we+1)%3];f.start.copy(fe),f.end.copy(Ue),f.delta(u);let Fe=$?w.start:w.end,Pe=v_(P.distanceToPoint(fe));if(v_(P.normal.dot(u))&&Pe){w.copy(f),Y=2;break}if((P.intersectLine(f,Fe)||Pe)&&!v_(Fe.distanceTo(Ue))){if(Y++,$)break;$=!0}}if(Y===1&&this.containsPoint(w.end))return A&&(A.start.copy(w.end),A.end.copy(w.end)),!0;if(Y!==2)return!1;if(x.delta(c),w.delta(u),c.dot(u)<0){let we=w.start;w.start=w.end,w.end=we}let J=x.start.dot(c),X=x.end.dot(c),ee=w.start.dot(c),oe=w.end.dot(c),le=X<ee,ve=J<oe;return J!==oe&&ee!==X&&le===ve?!1:(A&&(p.subVectors(x.start,w.start),p.dot(c)>0?A.start.copy(x.start):A.start.copy(w.start),p.subVectors(x.end,w.end),p.dot(c)<0?A.end.copy(x.end):A.end.copy(w.end)),!0)}}}();Ap.prototype.distanceToPoint=function(){let e=new se;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();Ap.prototype.distanceToTriangle=function(){let e=new se,t=new se,i=["a","b","c"],r=new Qc,s=new Qc;return function(n,c=null,u=null){let p=c||u?r:null;if(this.intersectsTriangle(n,p))return(c||u)&&(c&&p.getCenter(c),u&&p.getCenter(u)),0;let f=1/0;for(let x=0;x<3;x++){let w,E=i[x],A=n[E];this.closestPointToPoint(A,e),w=A.distanceToSquared(e),w<f&&(f=w,c&&c.copy(e),u&&u.copy(A));let I=this[E];n.closestPointToPoint(I,e),w=I.distanceToSquared(e),w<f&&(f=w,c&&c.copy(I),u&&u.copy(e))}for(let x=0;x<3;x++){let w=i[x],E=i[(x+1)%3];r.set(this[w],this[E]);for(let A=0;A<3;A++){let I=i[A],P=i[(A+1)%3];s.set(n[I],n[P]),tU(r,s,e,t);let O=e.distanceToSquared(t);O<f&&(f=O,c&&c.copy(e),u&&u.copy(t))}}return Math.sqrt(f)}}();var id=class{constructor(e,t,i){this.isOrientedBox=!0,this.min=new se,this.max=new se,this.matrix=new mi,this.invMatrix=new mi,this.points=new Array(8).fill().map(()=>new se),this.satAxes=new Array(3).fill().map(()=>new se),this.satBounds=new Array(3).fill().map(()=>new td),this.alignedSatBounds=new Array(3).fill().map(()=>new td),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};id.prototype.update=function(){return function(){let e=this.matrix,t=this.min,i=this.max,r=this.points;for(let p=0;p<=1;p++)for(let f=0;f<=1;f++)for(let x=0;x<=1;x++){let w=1*p|2*f|4*x,E=r[w];E.x=p?i.x:t.x,E.y=f?i.y:t.y,E.z=x?i.z:t.z,E.applyMatrix4(e)}let s=this.satBounds,n=this.satAxes,c=r[0];for(let p=0;p<3;p++){let f=n[p],x=s[p],w=1<<p,E=r[w];f.subVectors(c,E),x.setFromPoints(f,r)}let u=this.alignedSatBounds;u[0].setFromPointsField(r,"x"),u[1].setFromPointsField(r,"y"),u[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();id.prototype.intersectsBox=function(){let e=new td;return function(t){this.needsUpdate&&this.update();let i=t.min,r=t.max,s=this.satBounds,n=this.satAxes,c=this.alignedSatBounds;if(e.min=i.x,e.max=r.x,c[0].isSeparated(e)||(e.min=i.y,e.max=r.y,c[1].isSeparated(e))||(e.min=i.z,e.max=r.z,c[2].isSeparated(e)))return!1;for(let u=0;u<3;u++){let p=n[u],f=s[u];if(e.setFromBox(p,t),f.isSeparated(e))return!1}return!0}}();id.prototype.intersectsTriangle=function(){let e=new Ap,t=new Array(3),i=new td,r=new td,s=new se;return function(n){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(e.copy(n),e.update(),n=e);let c=this.satBounds,u=this.satAxes;t[0]=n.a,t[1]=n.b,t[2]=n.c;for(let w=0;w<3;w++){let E=c[w],A=u[w];if(i.setFromPoints(A,t),E.isSeparated(i))return!1}let p=n.satBounds,f=n.satAxes,x=this.points;for(let w=0;w<3;w++){let E=p[w],A=f[w];if(i.setFromPoints(A,x),E.isSeparated(i))return!1}for(let w=0;w<3;w++){let E=u[w];for(let A=0;A<4;A++){let I=f[A];if(s.crossVectors(E,I),i.setFromPoints(s,t),r.setFromPoints(s,x),i.isSeparated(r))return!1}}return!0}}();id.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();id.prototype.distanceToPoint=function(){let e=new se;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();id.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map(()=>new Qc),i=new Array(12).fill().map(()=>new Qc),r=new se,s=new se;return function(n,c=0,u=null,p=null){if(this.needsUpdate&&this.update(),this.intersectsBox(n))return(u||p)&&(n.getCenter(s),this.closestPointToPoint(s,r),n.closestPointToPoint(r,s),u&&u.copy(r),p&&p.copy(s)),0;let f=c*c,x=n.min,w=n.max,E=this.points,A=1/0;for(let P=0;P<8;P++){let O=E[P];s.copy(O).clamp(x,w);let k=O.distanceToSquared(s);if(k<A&&(A=k,u&&u.copy(O),p&&p.copy(s),k<f))return Math.sqrt(k)}let I=0;for(let P=0;P<3;P++)for(let O=0;O<=1;O++)for(let k=0;k<=1;k++){let U=(P+1)%3,j=(P+2)%3,V=O<<U|k<<j,$=1<<P|O<<U|k<<j,Y=E[V],J=E[$];t[I].set(Y,J);let X=e[P],ee=e[U],oe=e[j],le=i[I],ve=le.start,we=le.end;ve[X]=x[X],ve[ee]=O?x[ee]:w[ee],ve[oe]=k?x[oe]:w[ee],we[X]=w[X],we[ee]=O?x[ee]:w[ee],we[oe]=k?x[oe]:w[ee],I++}for(let P=0;P<=1;P++)for(let O=0;O<=1;O++)for(let k=0;k<=1;k++){s.x=P?w.x:x.x,s.y=O?w.y:x.y,s.z=k?w.z:x.z,this.closestPointToPoint(s,r);let U=s.distanceToSquared(r);if(U<A&&(A=U,u&&u.copy(r),p&&p.copy(s),U<f))return Math.sqrt(U)}for(let P=0;P<12;P++){let O=t[P];for(let k=0;k<12;k++){let U=i[k];tU(O,U,r,s);let j=r.distanceToSquared(s);if(j<A&&(A=j,u&&u.copy(r),p&&p.copy(s),j<f))return Math.sqrt(j)}}return Math.sqrt(A)}}();var __=new se,x_=new se,b_=new se,d2=new lt,p2=new lt,f2=new lt,t$=new se,i$=new se,r$=new se,m2=new se;function EIe(e,t,i,r,s,n){let c;return n===fa?c=e.intersectTriangle(r,i,t,!0,s):c=e.intersectTriangle(t,i,r,n!==Wa,s),c===null?null:{distance:e.origin.distanceTo(s),point:s.clone()}}function MIe(e,t,i,r,s,n,c,u,p){__.fromBufferAttribute(t,n),x_.fromBufferAttribute(t,c),b_.fromBufferAttribute(t,u);let f=EIe(e,__,x_,b_,m2,p);if(f){r&&(d2.fromBufferAttribute(r,n),p2.fromBufferAttribute(r,c),f2.fromBufferAttribute(r,u),f.uv=Ia.getInterpolation(m2,__,x_,b_,d2,p2,f2,new lt)),s&&(d2.fromBufferAttribute(s,n),p2.fromBufferAttribute(s,c),f2.fromBufferAttribute(s,u),f.uv1=Ia.getInterpolation(m2,__,x_,b_,d2,p2,f2,new lt)),i&&(t$.fromBufferAttribute(i,n),i$.fromBufferAttribute(i,c),r$.fromBufferAttribute(i,u),f.normal=Ia.getInterpolation(m2,__,x_,b_,t$,i$,r$,new se),f.normal.dot(e.direction)>0&&f.normal.multiplyScalar(-1));let x={a:n,b:c,c:u,normal:new se,materialIndex:0};Ia.getNormal(__,x_,b_,x.normal),f.face=x,f.faceIndex=n}return f}function see(e,t,i,r,s){let n=r*3,c=e.index.getX(n),u=e.index.getX(n+1),p=e.index.getX(n+2),{position:f,normal:x,uv:w,uv1:E}=e.attributes,A=MIe(i,f,x,w,E,c,u,p,t);return A?(A.faceIndex=r,s&&s.push(A),A):null}function TIe(e,t,i,r,s,n){for(let c=r,u=r+s;c<u;c++)see(e,t,i,c,n)}function AIe(e,t,i,r,s){let n=1/0,c=null;for(let u=r,p=r+s;u<p;u++){let f=see(e,t,i,u);f&&f.distance<n&&(c=f,n=f.distance)}return c}function Hh(e,t,i,r){let s=e.a,n=e.b,c=e.c,u=t,p=t+1,f=t+2;i&&(u=i.getX(t),p=i.getX(t+1),f=i.getX(t+2)),s.x=r.getX(u),s.y=r.getY(u),s.z=r.getZ(u),n.x=r.getX(p),n.y=r.getY(p),n.z=r.getZ(p),c.x=r.getX(f),c.y=r.getY(f),c.z=r.getZ(f)}function n$(e,t,i,r,s,n,c){let u=i.index,p=i.attributes.position;for(let f=e,x=t+e;f<x;f++)if(Hh(c,f*3,u,p),c.needsUpdate=!0,r(c,f,s,n))return!0;return!1}var oee=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function im(e,t){return t[e+15]===65535}function Q_(e,t){return t[e+6]}function OS(e,t){return t[e+14]}function LS(e){return e+8}function zS(e,t){return t[e+6]}function CIe(e,t){return t[e+7]}var W_=new mo,rI=new se,DIe=["x","y","z"];function _B(e,t,i,r,s){let n=e*2,c=zx,u=mm,p=gm;if(im(n,u)){let f=Q_(e,p),x=OS(n,u);TIe(t,i,r,f,x,s)}else{let f=LS(e);nI(f,c,r,rI)&&_B(f,t,i,r,s);let x=zS(e,p);nI(x,c,r,rI)&&_B(x,t,i,r,s)}}function xB(e,t,i,r){let s=e*2,n=zx,c=mm,u=gm;if(im(s,c)){let p=Q_(e,u),f=OS(s,c);return AIe(t,i,r,p,f)}else{let p=CIe(e,u),f=DIe[p],x=r.direction[f]>=0,w,E;x?(w=LS(e),E=zS(e,u)):(w=zS(e,u),E=LS(e));let A=nI(w,n,r,rI)?xB(w,t,i,r):null;if(A){let P=A.point[f];if(x?P<=n[E+p]:P>=n[E+p+3])return A}let I=nI(E,n,r,rI)?xB(E,t,i,r):null;return A&&I?A.distance<=I.distance?A:I:A||I||null}}var IIe=function(){let e,t,i=[],r=new oee(()=>new mo);return function(...n){e=r.getPrimitive(),t=r.getPrimitive(),i.push(e,t);let c=s(...n);r.releasePrimitive(e),r.releasePrimitive(t),i.pop(),i.pop();let u=i.length;return u>0&&(t=i[u-1],e=i[u-2]),c};function s(n,c,u,p,f=null,x=0,w=0){function E(U){let j=U*2,V=mm,$=gm;for(;!im(j,V);)U=LS(U),j=U*2;return Q_(U,$)}function A(U){let j=U*2,V=mm,$=gm;for(;!im(j,V);)U=zS(U,$),j=U*2;return Q_(U,$)+OS(j,V)}let I=n*2,P=zx,O=mm,k=gm;if(im(I,O)){let U=Q_(n,k),j=OS(I,O);return Yh(n,P,e),p(U,j,!1,w,x+n,e)}else{let U=LS(n),j=zS(n,k),V=U,$=j,Y,J,X,ee;if(f&&(X=e,ee=t,Yh(V,P,X),Yh($,P,ee),Y=f(X),J=f(ee),J<Y)){V=j,$=U;let Fe=Y;Y=J,J=Fe,X=ee}X||(X=e,Yh(V,P,X));let oe=im(V*2,O),le=u(X,oe,Y,w+1,x+V),ve;if(le===2){let Fe=E(V),Pe=A(V)-Fe;ve=p(Fe,Pe,!0,w+1,x+V,X)}else ve=le&&s(V,c,u,p,f,x,w+1);if(ve)return!0;ee=t,Yh($,P,ee);let we=im($*2,O),fe=u(ee,we,J,w+1,x+$),Ue;if(fe===2){let Fe=E($),Pe=A($)-Fe;Ue=p(Fe,Pe,!0,w+1,x+$,ee)}else Ue=fe&&s($,c,u,p,f,x,w+1);return!!Ue}}}(),PIe=function(){let e=new Ap,t=new Ap,i=new mi,r=new id,s=new id;return function n(c,u,p,f,x=null){let w=c*2,E=zx,A=mm,I=gm;if(x===null&&(p.boundingBox||p.computeBoundingBox(),r.set(p.boundingBox.min,p.boundingBox.max,f),x=r),im(w,A)){let P=u,O=P.index,k=P.attributes.position,U=p.index,j=p.attributes.position,V=Q_(c,I),$=OS(w,A);if(i.copy(f).invert(),p.boundsTree)return Yh(c,E,s),s.matrix.copy(i),s.needsUpdate=!0,p.boundsTree.shapecast({intersectsBounds:Y=>s.intersectsBox(Y),intersectsTriangle:Y=>{Y.a.applyMatrix4(f),Y.b.applyMatrix4(f),Y.c.applyMatrix4(f),Y.needsUpdate=!0;for(let J=V*3,X=($+V)*3;J<X;J+=3)if(Hh(t,J,O,k),t.needsUpdate=!0,Y.intersectsTriangle(t))return!0;return!1}});for(let Y=V*3,J=$+V*3;Y<J;Y+=3){Hh(e,Y,O,k),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let X=0,ee=U.count;X<ee;X+=3)if(Hh(t,X,U,j),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}else{let P=c+8,O=I[c+6];return Yh(P,E,W_),!!(x.intersectsBox(W_)&&n(P,u,p,f,x)||(Yh(O,E,W_),x.intersectsBox(W_)&&n(O,u,p,f,x)))}}}();function nI(e,t,i,r){return Yh(e,t,W_),i.intersectBox(W_,r)}var bB=[],rD,zx,mm,gm;function Kw(e){rD&&bB.push(rD),rD=e,zx=new Float32Array(e),mm=new Uint16Array(e),gm=new Uint32Array(e)}function g2(){rD=null,zx=null,mm=null,gm=null,bB.length&&Kw(bB.pop())}var QF=Symbol("skip tree generation"),KF=new mo,JF=new mo,w_=new mi,oy=new id,Pw=new id,Rw=new se,y2=new se,RIe=new se,OIe=new se,LIe=new se,s$=new mo,Ph=new oee(()=>new Ap),hS=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),hS.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});t=me({cloneBuffers:!0},t);let i=e.geometry,r=e._roots,s=i.getIndex(),n;return t.cloneBuffers?n={roots:r.map(c=>c.slice()),index:s.array.slice()}:n={roots:r,index:s.array},n}static deserialize(e,t,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),hS.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i=me({setIndex:!0},i);let{index:r,roots:s}=e,n=new hS(t,pt(me({},i),{[QF]:!0}));if(n._roots=s,i.setIndex){let c=t.getIndex();if(c===null){let u=new Fr(e.index,1,!1);t.setIndex(u)}else c.array!==r&&(c.array.set(r),c.needsUpdate=!0)}return n}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[QF]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[QF]||(this._roots=xIe(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new mo))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let t=this.geometry,i=t.index.array,r=t.attributes.position,s,n,c,u,p=0,f=this._roots;for(let w=0,E=f.length;w<E;w++)s=f[w],n=new Uint32Array(s),c=new Uint16Array(s),u=new Float32Array(s),x(0,p),p+=s.byteLength;function x(w,E,A=!1){let I=w*2;if(c[I+15]===65535){let P=n[w+6],O=c[I+14],k=1/0,U=1/0,j=1/0,V=-1/0,$=-1/0,Y=-1/0;for(let J=3*P,X=3*(P+O);J<X;J++){let ee=i[J],oe=r.getX(ee),le=r.getY(ee),ve=r.getZ(ee);oe<k&&(k=oe),oe>V&&(V=oe),le<U&&(U=le),le>$&&($=le),ve<j&&(j=ve),ve>Y&&(Y=ve)}return u[w+0]!==k||u[w+1]!==U||u[w+2]!==j||u[w+3]!==V||u[w+4]!==$||u[w+5]!==Y?(u[w+0]=k,u[w+1]=U,u[w+2]=j,u[w+3]=V,u[w+4]=$,u[w+5]=Y,!0):!1}else{let P=w+8,O=n[w+6],k=P+E,U=O+E,j=A,V=!1,$=!1;e?j||(V=e.has(k),$=e.has(U),j=!V&&!$):(V=!0,$=!0);let Y=j||V,J=j||$,X=!1;Y&&(X=x(P,E,j));let ee=!1;J&&(ee=x(O,E,j));let oe=X||ee;if(oe)for(let le=0;le<3;le++){let ve=P+le,we=O+le,fe=u[ve],Ue=u[ve+3],Fe=u[we],Pe=u[we+3];u[w+le]=fe<Fe?fe:Fe,u[w+le+3]=Ue>Pe?Ue:Pe}return oe}}}traverse(e,t=0){let i=this._roots[t],r=new Uint32Array(i),s=new Uint16Array(i);n(0);function n(c,u=0){let p=c*2,f=s[p+15]===65535;if(f){let x=r[c+6],w=s[p+14];e(u,f,new Float32Array(i,c*4,6),x,w)}else{let x=c+8,w=r[c+6],E=r[c+7];e(u,f,new Float32Array(i,c*4,6),E)||(n(x,u+1),n(w,u+1))}}}raycast(e,t=Yu){let i=this._roots,r=this.geometry,s=[],n=t.isMaterial,c=Array.isArray(t),u=r.groups,p=n?t.side:t;for(let f=0,x=i.length;f<x;f++){let w=c?t[u[f].materialIndex].side:p,E=s.length;if(Kw(i[f]),_B(0,r,w,e,s),g2(),c){let A=u[f].materialIndex;for(let I=E,P=s.length;I<P;I++)s[I].face.materialIndex=A}}return s}raycastFirst(e,t=Yu){let i=this._roots,r=this.geometry,s=t.isMaterial,n=Array.isArray(t),c=null,u=r.groups,p=s?t.side:t;for(let f=0,x=i.length;f<x;f++){let w=n?t[u[f].materialIndex].side:p;Kw(i[f]);let E=xB(0,r,w,e);g2(),E!=null&&(c==null||E.distance<c.distance)&&(c=E,n&&(E.face.materialIndex=u[f].materialIndex))}return c}intersectsGeometry(e,t){let i=this.geometry,r=!1;for(let s of this._roots)if(Kw(s),r=PIe(0,i,e,t),g2(),r)break;return r}shapecast(e,t,i){let r=this.geometry;if(e instanceof Function){if(t){let w=t;t=(E,A,I,P)=>{let O=A*3;return w(E,O,O+1,O+2,I,P)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let s=Ph.getPrimitive(),{boundsTraverseOrder:n,intersectsBounds:c,intersectsRange:u,intersectsTriangle:p}=e;if(u&&p){let w=u;u=(E,A,I,P,O)=>w(E,A,I,P,O)?!0:n$(E,A,r,p,I,P,s)}else u||(p?u=(w,E,A,I)=>n$(w,E,r,p,A,I,s):u=(w,E,A)=>A);let f=!1,x=0;for(let w of this._roots){if(Kw(w),f=IIe(0,r,c,u,n,x),g2(),f)break;x+=w.byteLength}return Ph.releasePrimitive(s),f}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:s}=i,n=this.geometry.index,c=this.geometry.attributes.position,u=e.geometry.index,p=e.geometry.attributes.position;w_.copy(t).invert();let f=Ph.getPrimitive(),x=Ph.getPrimitive();if(s){let E=function(A,I,P,O,k,U,j,V){for(let $=P,Y=P+O;$<Y;$++){Hh(x,$*3,u,p),x.a.applyMatrix4(t),x.b.applyMatrix4(t),x.c.applyMatrix4(t),x.needsUpdate=!0;for(let J=A,X=A+I;J<X;J++)if(Hh(f,J*3,n,c),f.needsUpdate=!0,s(f,x,J,$,k,U,j,V))return!0}return!1};if(r){let A=r;r=function(I,P,O,k,U,j,V,$){return A(I,P,O,k,U,j,V,$)?!0:E(I,P,O,k,U,j,V,$)}}else r=E}e.getBoundingBox(JF),JF.applyMatrix4(t);let w=this.shapecast({intersectsBounds:E=>JF.intersectsBox(E),intersectsRange:(E,A,I,P,O,k)=>(KF.copy(k),KF.applyMatrix4(w_),e.shapecast({intersectsBounds:U=>KF.intersectsBox(U),intersectsRange:(U,j,V,$,Y)=>r(E,A,U,j,P,O,$,Y)}))});return Ph.releasePrimitive(f),Ph.releasePrimitive(x),w}intersectsBox(e,t){return oy.set(e.min,e.max,t),oy.needsUpdate=!0,this.shapecast({intersectsBounds:i=>oy.intersectsBox(i),intersectsTriangle:i=>oy.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},s=0,n=1/0){e.boundingBox||e.computeBoundingBox(),oy.set(e.boundingBox.min,e.boundingBox.max,t),oy.needsUpdate=!0;let c=this.geometry,u=c.attributes.position,p=c.index,f=e.attributes.position,x=e.index,w=Ph.getPrimitive(),E=Ph.getPrimitive(),A=y2,I=RIe,P=null,O=null;r&&(P=OIe,O=LIe);let k=1/0,U=null,j=null;return w_.copy(t).invert(),Pw.matrix.copy(w_),this.shapecast({boundsTraverseOrder:V=>oy.distanceToBox(V),intersectsBounds:(V,$,Y)=>Y<k&&Y<n?($&&(Pw.min.copy(V.min),Pw.max.copy(V.max),Pw.needsUpdate=!0),!0):!1,intersectsRange:(V,$)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:Y=>Pw.distanceToBox(Y),intersectsBounds:(Y,J,X)=>X<k&&X<n,intersectsRange:(Y,J)=>{for(let X=Y*3,ee=(Y+J)*3;X<ee;X+=3){Hh(E,X,x,f),E.a.applyMatrix4(t),E.b.applyMatrix4(t),E.c.applyMatrix4(t),E.needsUpdate=!0;for(let oe=V*3,le=(V+$)*3;oe<le;oe+=3){Hh(w,oe,p,u),w.needsUpdate=!0;let ve=w.distanceToTriangle(E,A,P);if(ve<k&&(I.copy(A),O&&O.copy(P),k=ve,U=oe/3,j=X/3),ve<s)return!0}}}});{let Y=x?x.count:f.count;for(let J=0,X=Y;J<X;J+=3){Hh(E,J,x,f),E.a.applyMatrix4(t),E.b.applyMatrix4(t),E.c.applyMatrix4(t),E.needsUpdate=!0;for(let ee=V*3,oe=(V+$)*3;ee<oe;ee+=3){Hh(w,ee,p,u),w.needsUpdate=!0;let le=w.distanceToTriangle(E,A,P);if(le<k&&(I.copy(A),O&&O.copy(P),k=le,U=ee/3,j=J/3),le<s)return!0}}}}}),Ph.releasePrimitive(w),Ph.releasePrimitive(E),k===1/0?null:(i.point?i.point.copy(I):i.point=I.clone(),i.distance=k,i.faceIndex=U,r&&(r.point?r.point.copy(O):r.point=O.clone(),r.point.applyMatrix4(w_),I.applyMatrix4(w_),r.distance=I.sub(r.point).length(),r.faceIndex=j),i)}closestPointToPoint(e,t={},i=0,r=1/0){let s=i*i,n=r*r,c=1/0,u=null;if(this.shapecast({boundsTraverseOrder:f=>(Rw.copy(e).clamp(f.min,f.max),Rw.distanceToSquared(e)),intersectsBounds:(f,x,w)=>w<c&&w<n,intersectsTriangle:(f,x)=>{f.closestPointToPoint(e,Rw);let w=e.distanceToSquared(Rw);return w<c&&(y2.copy(Rw),c=w,u=x),w<s}}),c===1/0)return null;let p=Math.sqrt(c);return t.point?t.point.copy(y2):t.point=y2.clone(),t.distance=p,t.faceIndex=u,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Yh(0,new Float32Array(t),s$),e.union(s$)}),e}},Ow=Dp(Ime()),zIe=.5*(Math.sqrt(3)-1),Lw=(3-Math.sqrt(3))/6,FIe=1/3,Rh=1/6,SYe=(Math.sqrt(5)-1)/4,EYe=(5-Math.sqrt(5))/20,dS=e=>Math.floor(e)|0,o$=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),ek=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function tk(e=Math.random){let t=aee(e),i=new Float64Array(t).map(s=>o$[s%12*2]),r=new Float64Array(t).map(s=>o$[s%12*2+1]);return function(s,n){let c=0,u=0,p=0,f=(s+n)*zIe,x=dS(s+f),w=dS(n+f),E=(x+w)*Lw,A=x-E,I=w-E,P=s-A,O=n-I,k,U;P>O?(k=1,U=0):(k=0,U=1);let j=P-k+Lw,V=O-U+Lw,$=P-1+2*Lw,Y=O-1+2*Lw,J=x&255,X=w&255,ee=.5-P*P-O*O;if(ee>=0){let ve=J+t[X],we=i[ve],fe=r[ve];ee*=ee,c=ee*ee*(we*P+fe*O)}let oe=.5-j*j-V*V;if(oe>=0){let ve=J+k+t[X+U],we=i[ve],fe=r[ve];oe*=oe,u=oe*oe*(we*j+fe*V)}let le=.5-$*$-Y*Y;if(le>=0){let ve=J+1+t[X+1],we=i[ve],fe=r[ve];le*=le,p=le*le*(we*$+fe*Y)}return 70*(c+u+p)}}function kIe(e=Math.random){let t=aee(e),i=new Float64Array(t).map(n=>ek[n%12*3]),r=new Float64Array(t).map(n=>ek[n%12*3+1]),s=new Float64Array(t).map(n=>ek[n%12*3+2]);return function(n,c,u){let p,f,x,w,E=(n+c+u)*FIe,A=dS(n+E),I=dS(c+E),P=dS(u+E),O=(A+I+P)*Rh,k=A-O,U=I-O,j=P-O,V=n-k,$=c-U,Y=u-j,J,X,ee,oe,le,ve;V>=$?$>=Y?(J=1,X=0,ee=0,oe=1,le=1,ve=0):V>=Y?(J=1,X=0,ee=0,oe=1,le=0,ve=1):(J=0,X=0,ee=1,oe=1,le=0,ve=1):$<Y?(J=0,X=0,ee=1,oe=0,le=1,ve=1):V<Y?(J=0,X=1,ee=0,oe=0,le=1,ve=1):(J=0,X=1,ee=0,oe=1,le=1,ve=0);let we=V-J+Rh,fe=$-X+Rh,Ue=Y-ee+Rh,Fe=V-oe+2*Rh,Pe=$-le+2*Rh,Ae=Y-ve+2*Rh,et=V-1+3*Rh,$e=$-1+3*Rh,rt=Y-1+3*Rh,Je=A&255,bt=I&255,ot=P&255,xt=.6-V*V-$*$-Y*Y;if(xt<0)p=0;else{let Nt=Je+t[bt+t[ot]];xt*=xt,p=xt*xt*(i[Nt]*V+r[Nt]*$+s[Nt]*Y)}let Xe=.6-we*we-fe*fe-Ue*Ue;if(Xe<0)f=0;else{let Nt=Je+J+t[bt+X+t[ot+ee]];Xe*=Xe,f=Xe*Xe*(i[Nt]*we+r[Nt]*fe+s[Nt]*Ue)}let kt=.6-Fe*Fe-Pe*Pe-Ae*Ae;if(kt<0)x=0;else{let Nt=Je+oe+t[bt+le+t[ot+ve]];kt*=kt,x=kt*kt*(i[Nt]*Fe+r[Nt]*Pe+s[Nt]*Ae)}let yt=.6-et*et-$e*$e-rt*rt;if(yt<0)w=0;else{let Nt=Je+1+t[bt+1+t[ot+1]];yt*=yt,w=yt*yt*(i[Nt]*et+r[Nt]*$e+s[Nt]*rt)}return 32*(p+f+x+w)}}function aee(e){let t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(e()*(256-i)),s=t[i];t[i]=t[r],t[r]=s}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var Ru=new Ia,NIe=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let s=1;Ru.a.fromBufferAttribute(e,r),Ru.b.fromBufferAttribute(e,r+1),Ru.c.fromBufferAttribute(e,r+2),s*=Ru.getArea(),t[r/3]=s}this.distribution=new Float32Array(e.count/3);let i=0;for(let r=0;r<t.length;r++)i+=t[r],this.distribution[r]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,r=t.length-1,s=-1;for(;i<=r;){let n=Math.ceil((i+r)/2);if(n===0||t[n-1]<=e&&t[n]>e){s=n;break}else e<t[n]?r=n-1:i=n+1}return s}sampleFace(e,t,i){let r=this.randomFunction(),s=this.randomFunction();return r+s>1&&(r=1-r,s=1-s),Ru.a.fromBufferAttribute(this.positionAttribute,e*3),Ru.b.fromBufferAttribute(this.positionAttribute,e*3+1),Ru.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(Ru.a,r).addScaledVector(Ru.b,s).addScaledVector(Ru.c,1-(r+s)),Ru.getNormal(i),this}},BIe=Dp(UQ()),UIe=new mi,jIe=new mi,VIe=new mi,FS;(e=>{function t(i){return i&&i.__isSPEObject}e.is=t})(FS||(FS={}));var iU=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new mi,this.copyPreviousMatrix=!0,this.hiddenMatrix=new mi,this.matrixWorldRigid=new mi,this.shearScale=new mi,this.shearScaleInv=new mi}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof ls&&(t=t.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===t)return!0;i=i.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let i of this.children)i.updateMatrixWorld(t)}updateWorldMatrix(t,i){let r=this.parent;if(t&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let s of this.children)s.updateWorldMatrix(!1,!0)}traverseChildren(t,i=0){for(let r of this.children)FS.is(r)&&r.traverseObject(t,i+1)}traverseObject(t,i=0){if(t(this,i)!==!0)for(let r of this.children)FS.is(r)&&r.traverseObject(t,i+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,i=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:r,v:s,q:n}=(0,BIe.SVD)(i),c=UIe.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),u=jIe.set(s[0][0],s[0][1],s[0][2],0,s[1][0],s[1][1],s[1][2],0,s[2][0],s[2][1],s[2][2],0,0,0,0,1),p=VIe.copy(u).transpose();this.shearScale.makeScale(n[0],n[1],n[2]).multiply(p).premultiply(u),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(c,p).copyPosition(this.matrixWorld),n.every(f=>Math.abs(n[0]-f)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,i){this.updateWorldMatrix(!0,!1);let r=new mi().copy(this.matrixWorld).invert();return t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),r.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof mi?t.hiddenMatrix.premultiply(r):t.applyMatrix4(r),t.updateWorldMatrix(!1,!1),this.add(t),i!==void 0&&(this.children.pop(),this.children.splice(i,0,t)),this}copy(t,i=!1){return super.copy(t,i),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,i,r,s,n,c){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},GIe=class extends iU(ls){},HIe=e=>e.type==="Mesh",qa=class extends GIe{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let i=this.children[e];i?.object!==t&&(i&&this.remove(i),i=new qa(t),this.add(i),this.children.splice(e,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&this.object.dataPatched.cloner?.hideBase===!0}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return HIe(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},gy=new se,yy=new se,K_=new mi,lee=[new se(-1,1,1),new se(-1,-1,1),new se(1,-1,1),new se(1,1,1),new se(-1,1,-1),new se(-1,-1,-1),new se(1,-1,-1),new se(1,1,-1)],WIe=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],qIe=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],a$=(e,t,i)=>{e.updateEntityBoxSize(gy,yy),K_.copy(t).multiply(e.matrixWorld),yy.x===0&&yy.y===0&&yy.z===0?i.push(new se(gy.x,gy.y,gy.z).applyMatrix4(K_)):lee.forEach(r=>{i.push(r.clone().multiply(yy).add(gy).applyMatrix4(K_))})},l$=class extends mo{constructor(){super(...arguments),this.matrix=new mi,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=new mi().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];return i===!0?e.traverseEntity(s=>{if(s.visible||s.cloner&&s.data.visible){if(!("geometry"in s)){r.push(new se);return}a$(s,t,r)}}):a$(e,t,r),this.setFromPoints(r)}getCenter(e){return e=super.getCenter(e),e.applyMatrix4(this.matrix),e}getPositionToCenter(e){return e=super.getCenter(e),e.applyMatrix4(K_.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(yy).multiplyScalar(.5),this.getCenter(gy),K_.copy(this.matrix).setPosition(gy),this.vertices=lee.map(e=>e.clone().multiply(yy).applyMatrix4(K_))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=WIe.map(([e,t])=>new Qc(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new se))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=qIe.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},cm={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},YIe=class extends mK{constructor(){super()}getPoints(e=12){let t=[],i,r=this.getCurveLengths(),s=r[r.length-1]/r.length;for(let n=0,c=this.curves;n<c.length;n++){let u=c[n],p=n===0?r[n]:r[n]-r[n-1],f=Math.ceil(e*p/s),x=u.getPoints(f);for(let w=0;w<x.length;w++){let E=x[w];i&&i.equals(E)||(t.push(E),i=E)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}},wB=.001;function SB(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=wB}function ik(e,t){let i=new se(...e.position),r=new se(...e.controlNext.position),s=new se(...t.controlPrevious.position),n=new se(...t.position);return SB(i,r,n)&&SB(i,s,n)}function cee(e){let t=e.points.map(x=>new se(...x.data.position)),i=[e.points[0]],r=new se(...i[0].data.position);for(let x=0;x<e.points.length-1;x++)SB(r,t[x],t[x+1])||(i.push(e.points[x]),r=t[x]);i.push(e.points[e.points.length-1]);let s=e.isClosed,n=i.length-(s?0:1),c=i.length,u=[];for(let x=0;x<c;x++){let w=i[x].data,E=new se(...w.position),A=new se(...w.controlPrevious.position),I=new se(...w.controlNext.position),P={position:E,baseRoundness:w.roundness,controlPrevious:A,controlNext:I};if(w.roundness===0||!e.isClosed&&(x===0||x===c-1)){u[x]=pt(me({},P),{removedLength:0});continue}let O=s&&x==0?c-1:x-1,k=s&&x==c-1?0:x+1,U=i[O].data,j=i[k].data,V=new se(...U.position),$=new se(...j.position),Y=V.clone().sub(E).normalize(),J=$.clone().sub(E).normalize();Object.assign(P,{prevDir:Y,nextDir:J});let X=ik(U,w),ee=ik(w,j);if(!X||!ee)u[x]=pt(me({},P),{removedLength:0});else{let oe=Y.clone().add(J).normalize(),le=oe.clone().cross(Y).length()/Y.dot(oe);u[x]=pt(me({},P),{tan:le,removedLength:w.roundness/le})}}for(let x=0;x<n;x++){let w=x,E=s&&x===c-1?0:x+1,A=u[w],I=u[E];if(A.removedLength!==0||I.removedLength!==0){let P=A.position.distanceTo(I.position);A.removedLength=Math.min(A.removedLength,P/2),I.removedLength=Math.min(I.removedLength,P/2)}}let p=[];for(let x=0;x<n;x++){let w=x,E=s&&x===c-1?0:x+1,A=u[w],I=u[E],P=null;if(!ik(i[w].data,i[E].data))A.position.distanceTo(I.position)>wB&&(P=new K2(A.position,A.controlNext,I.controlPrevious,I.position));else{let O=A.position.clone(),k=I.position.clone();(A.removedLength!==0||I.removedLength!==0)&&(A.nextDir&&O.add(A.nextDir.clone().setLength(A.removedLength)),I.prevDir&&k.add(I.prevDir.clone().setLength(I.removedLength))),O.distanceTo(k)>wB&&(P=new K2(O,O.clone().lerp(k,.3),k.clone().lerp(O,.3),k))}p[2*x+1]=P}for(let x=0;x<c;x++){let w=u[x];if(w.removedLength===0){p[2*x]=null;continue}let E=w.position,A=w.prevDir.clone().multiplyScalar(w.removedLength).add(E),I=w.nextDir.clone().multiplyScalar(w.removedLength).add(E),P=w.tan*w.removedLength,O=w.prevDir.clone().add(w.nextDir).normalize(),k=A.clone().lerp(I,.5),U=A.distanceTo(I)/2,j=O.clone().multiplyScalar(Math.sqrt(Math.pow(P,2)-Math.pow(U,2))).add(k),V=O.clone().multiplyScalar(-P).add(j),$=E.distanceTo(V)/E.distanceTo(k),Y=w.prevDir.clone().multiplyScalar($*E.distanceTo(A)).add(E),J=Y.clone().lerp(V,2),X=A.clone().lerp(Y,4/3),ee=I.clone().lerp(J,4/3);p[2*x]=new K2(A,X,ee,I)}let f=new YIe;return p.forEach(x=>{x&&f.add(x)}),f}var Ln;(e=>{function t(i){return i&&i.__isEntity}e.is=t})(Ln||(Ln={}));var lp=e=>Ln.is(e),XIe={type:"completeState",isfromEntity:!0},$Ie=["x","y","z"],rk=new se,ZIe=new se().set(0,1,0),rU=e=>class extends iU(e){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new l$,this._recursiveBBox=new l$,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let i=this.children[t];if(Ln.is(i))return i}entityChildrenCount(){let t=this.children.length;for(;t--;)if(Ln.is(this.children[t]))return t+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let t=this;for(;t.data.type!=="Instance";){let i=t.parent;if(Ln.is(i))t=i;else return}return t}forInstancesRec(t){this.instances.forEach(i=>{i.disposed||t(i),i.forInstancesRec(t)})}super_Entity(t,i){typeof t=="string"&&(this.uuid=t),this.identity=t,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let s of this.data.states)Sy.toOps(this.data,s.data).forEach(n=>{let c=kD.replaceProps(n,this.data);this.dataPatched=this.data,this.updateByPatchedOp(c,this.data,i)});if(t!==null){let s=this.data.states.data(t);s&&(this.dataPatched=Sy.patch(this.data,s),Sy.toOps(this.data,s).forEach(n=>{this.updateByPatchedOp(n,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched,i),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,i){t.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{lp(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let i;return this.traverseEntity(r=>{r.uuid===t&&(i=r)}),i}traverseSortNextHelper(){let t=this.parent;if(t){let i=t.children,r=i.indexOf(this)+1;if(Ln.is(i[r]))return i[r];if(Ln.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&Ln.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let i=this;for(;t>0&&i!==null;)i=i.parent,t-=1;return i}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let i=this.parent;for(;i;){if(t===i)return!0;i=i.parent}return!1}countToAccestor(t){let i=0,r=this;for(;r!==t;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(t){for(let i of this.children)lp(i)&&t(i)}traverseEntityAncestors(t){this.traverseAncestors(i=>{Ln.is(i)&&t(i)})}traverseConcreteEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)lp(r)&&r.isConcreteEntity&&r.traverseEntity(t,i+1)}traverseEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)lp(r)&&r.traverseEntity(t,i+1)}traverseVisibleEntity(t){t(this);for(let i of this.children)lp(i)&&i.visible&&i.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(t){super.updateMatrixWorld(t),this.dispatchEvent({type:"updateMatrixWorld"})}copy(t,i=!1){return super.copy(t,i),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>lp(t))}isAncestorOf(t){if(this.uuid===t)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===t&&(i=!0)}),i}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*Yi.RAD2DEG,this.rotation.y*Yi.RAD2DEG,this.rotation.z*Yi.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return DN(i,t)}getTransformValues(t,i,r){return i[t].map((s,n)=>r?.shared.getVariable(s,[this.uuid,t,$Ie[n]])??s)}updateTransformState(t,i){let r=!1;return t.position&&(this.position.fromArray(this.getTransformValues("position",t,i)),r=!0),t.rotation&&(rk.fromArray(this.getTransformValues("rotation",t,i)).multiplyScalar(Yi.DEG2RAD),this.rotation.setFromVector3(rk),r=!0),t.scale&&(this.scale.fromArray(this.getTransformValues("scale",t,i)),r=!0),t.hiddenMatrix!==void 0&&(r=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??px.identity)),r&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(s=>{s.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&t.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),r}onVariableUpdate(t=!1){if(t){this.resetBBoxNeedsUpdate();return}this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)})}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)Ln.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{Ln.is(t)&&t.disposeRecursively()})}toState(t=[]){let i=me({name:this.name,visible:this.visible,raycastLock:this.raycastLock},this.toObjectTransformState(t));return DN(i,t)}updateByObjUpdateOp(t,i){t!==void 0&&this.updateByOp({type:0,props:t,path:[]},me(me({},this.data),t),i,!1)}updateByOp(t,i,r,s){let n=this.data;this.data=i;let c=t,u=ws(t.path,["states","*"]);if(u!==null){if(t.type===0){let[x]=u;if(this?.stateSelection===x){let w=me({},t.props);if(delete w.name,Object.values(t.props).some(E=>E===void 0)){let E=this.data;if(E!==void 0){let A=Zo.zoom(E,t.path.slice(2));if(A)for(let I in t.props)t.props[I]===void 0&&I in A&&(w[I]=A[I])}}c=pt(me({},t),{props:w,path:t.path.slice(2)})}}}else if(t.type===0){let x=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(x!==void 0){if(t.props.name!==void 0&&x.name){let p=x,{name:E}=p;x=ll(p,["name"])}if(t.props.material!==void 0&&"material"in x){let f=x,{material:E}=f;x=ll(f,["material"])}let w=Zo.removeOverridden(t.path,t.props,x);c=pt(me({},t),{props:w})}}if(this.updateByPatchedOpBase(c,Sy.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),ws(t.path,["overrides"])){let x=[],w=[...t.path];for(x.push(w[1]),w.splice(0,2);w.length>0&&w[0]==="descendants";)x.push(w[1]),w.splice(0,2);if(x[x.length-1]===void 0){if(t.type===0)for(let E of Object.keys(t.props)){x[x.length-1]=E;let A=r.scene.findInstance([this.uuid,...x]);A&&(A.overrideData=t.props[E],A.updateState(pm.apply(A.component.data,A.overrideData),r))}}else{let E=r.scene.findInstance([this.uuid,...x]);if(E){let A=Zo.zoom(E.component.data,w);if(t=pt(me({},t),{path:w}),t.type===0){let I=t.props;if(A)for(let[P,O]of Object.entries(t.props))O===void 0&&(I===t.props&&(I=me({},t.props)),I[P]=A[P]);t=pt(me({},t),{props:I})}E.overrideData=XD.resolve(i.overrides,x),E.updateByOp(t,pa.applySimple(E.data,t),r,!1)}}}else if(this.instances.length>0){let x;if(t.path.length===0&&t.type===0){let w;for(let E of am.rootOverrideProps)E in t.props&&(w===void 0&&(w={}),w[E]=t.props[E]);w&&(x=pt(me({},t),{props:w}))}else for(let w of am.rootOverrideProps)if(ws(t.path,[w])){x=t;break}x!==void 0&&this.instances.forEach(w=>{if(w.isInstanceRoot){let E=pm.filterOp(w.overrideData,x);E&&w.updateByOp(E,pa.applySimple(w.data,E),r,!0)}}),this.instances.forEach(w=>{if(!w.isInstanceRoot){let E=pm.filterOp(w.overrideData,t);if(E){let A;n===w.data&&t===E?A=i:A=pa.applySimple(w.data,E),w.updateByOp(E,A,r,!0)}}})}}updateByPatchedOpBase(t,i,r){if(this.dataPatched=i,t.path.length===0&&t.type===0)t.props.type!==void 0&&!jy.is(t.props.type)&&cm.changeEntityProptotype(this,i,r);else if(t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&"type"in t.props){cm.changeEntityProptotype(this,i,r);for(let s of this.children)Ln.is(s)&&s.updateVisible(r.scene)}this.updateByPatchedOp(t,i,r)}updateByPatchedOp(t,i,r){if(t.path.length===0&&t.type===0&&this.updateState(t.props,r),ws(t.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),ws(t.path,["cloner"])!==null){let s=pa.drop(t,1);s.path.length===0&&s.type===0&&s.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r.scene):(this.setFromClonerState(i.cloner,r),this.expandCloner(r.scene)),this.updateVisible(r.scene)}}updatePathSnapping(t=this.dataPatched.pathSnapping){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){let i=this._updatedPathSnapping?.pathId??this.dataPatched.pathSnapping.pathId,r=this._updatedPathSnapping?.slide??this.dataPatched.pathSnapping.slide??0,s=this._updatedPathSnapping?.offset??this.dataPatched.pathSnapping.offset??0,n=this._updatedPathSnapping?.orientation??this.dataPatched.pathSnapping.orientation;if(i===null)return;let c=t.find(i);if(!c||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let u=c.data;if(u.geometry.path.points.length<=1)return;let p=cee(u.geometry.path),f=(r+s)%1;r+s===1&&f===0&&(f=1);let x=p.curves.length?p.getPointAt(f):null;if(x===null)return;let w=this.parent?this.parent?.matrixWorld:new mi;c.updateMatrixWorld();let E=new mi().multiplyMatrices(w.clone().invert(),c.matrixWorld);x.applyMatrix4(E);let A={position:x.toArray(),rotation:u.rotation};if(n==="tangential"){let I=new mi().extractRotation(c.matrixWorld),P=p.getTangentAt(f).applyMatrix4(I).add(x),O=new mi().lookAt(x,P,ZIe),k=rk.setFromEuler(new $o().setFromRotationMatrix(O)).multiplyScalar(Yi.RAD2DEG);A=pt(me({},A),{rotation:k.toArray()})}this.updateTransformState(A),this.traverseEntity(I=>{I._cameraType&&I.dispatchEvent(XIe)})}updateVisible(t){if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||this.dataPatched.cloner?.hideBase!==!0),!t)return;let i=!1;this.traverseEntity(r=>{if(r.data.type==="Splat")return i=!0,!0}),i&&t.reloadSplats()}updateState_Entity(t,i){t.name!==void 0&&(this.name=t.name),t.raycastLock!==void 0&&(this.raycastLock=t.raycastLock),t.visible!==void 0&&(this.updateVisible(i?.scene),this.resetBBoxNeedsUpdate()),i&&"cloner"in t&&t.cloner!==void 0&&(this.setFromClonerState(t.cloner,i),this.updateVisible(i.scene)),this.updateTransformState(t,i)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof cm.Cloner&&t.parameters.type==="toObject")}setFromClonerState(t,i){this.disposed||(t===null||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new cm.Cloner(this,t),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,i.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}requestRender(){this.dispatchEvent({type:"requestRender"})}},uee=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters);i.thetaLength=Yi.clamp(i.thetaLength,0,360);let r=i.width/2,s=i.radiusTop??r,n=i.radiusBottom??r;return s===n?(s=r,n=r):s>n?(s=r,n=n*r/s):(s=s*r/n,n=r),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),radiusTop:s,radiusBottom:n})}}static build(e){let{width:t,depth:i,height:r,radialSegments:s,heightSegments:n,openEnded:c,thetaStart:u,thetaLength:p,radiusTop:f,radiusBottom:x,cornerRadius:w,cornerSegments:E,hollow:A}=e.parameters,I;return p===0?(I=new fr,I.setAttribute("position",new Vi([],3))):w||A?I=new hee(f,x,r,s,n,c,u,p*Math.PI/180,w,w,E,A):I=new b4(f,x,r,s,n,c,u,p*Math.PI/180),I.scale(1,1,i/t),Object.assign(I,{userData:pt(me({},e),{type:"CylinderGeometry"})})}};function Hf(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function c$(e){return new lt(e.y,-e.x)}var hee=class extends fr{constructor(e,t,i,r,s,n,c,u,p,f,x,w,E=!1){super(),this.type="RoundedCylinderBufferGeometry",e=e!==void 0?e:1,t=t!==void 0?t:1,i=i||1,r=Math.floor(r)||8,s=Math.floor(s)||1,n=n!==void 0?n:!1,c=c!==void 0?c:0,u=u!==void 0?u:Math.PI*2,n&&(p=0,f=0);let A=[],I=[],P=[],O=[],k=0,U=i/2,j=new se,V=new se;E&&e==0&&(e=p),E&&t==0&&(t=f);let $=new lt(e,U),Y=new lt(t,-U),J=null,X=null,ee=null,oe=null,le=$.clone().sub(Y),ve=0,we=0,fe=0;w>0&&(ve=Math.min(e,t)*(1-w),we=e-ve,fe=t-ve);let Ue=$.clone();Ue.x-=ve;let Fe=Math.PI-le.angle(),Pe=le.angle(),Ae=Math.tan(Pe/2),et=Math.tan(Fe/2),$e=Ae+et,rt=w?$e:et,Je=w?$e:Ae;if(p=Math.min(p,(e-we)/rt,le.length()/$e),f=Math.min(f,(t-fe)/Je,le.length()/$e),p>0){let yt=p/Ae;J=$.clone().sub(new lt(yt,p)),w&&(ee=J.clone(),ee.x-=ve-$e*p),$.sub(le.clone().setLength(yt))}if(f>0){let yt=f/et;X=Y.clone().sub(new lt(yt,-f)),Y.add(le.clone().setLength(yt)),w&&(oe=X.clone(),oe.x-=ve-$e*f,Ue.sub(le.clone().setLength(yt)))}le=$.clone().sub(Y);let bt=le.length()<.5,ot=[];for(let yt=0;yt<=r;yt++){let Nt=[],Mt=yt/r,li=Mt*u+c,Qt=new lt(Math.sin(li),Math.cos(li));oe&&X?(xt(Nt,Mt,Qt,Fe,f,oe,-1,!0),xt(Nt,Mt,Qt,Pe,f,X,-1,!1)):X?(Xe(Nt,Qt,X.x,0,-1),xt(Nt,Mt,Qt,Pe,f,X,-1,!1)):n||Xe(Nt,Qt,t,fe,-1);let Wt=c$(le).normalize();if(Hf(Wt,Qt,j),!bt)for(let Di=0;Di<=s;Di++){let Ii=Di/s,Li=le.clone().multiplyScalar(Ii).add(Y);Hf(Li,Qt,V),I.push(V.x,V.y,V.z),P.push(j.x,j.y,j.z),O.push(Mt,.5+V.y/i),Nt.push(k++)}if(ee&&J?(xt(Nt,Mt,Qt,Fe,p,J,1,!1),xt(Nt,Mt,Qt,Pe,p,ee,1,!0)):J?(xt(Nt,Mt,Qt,Fe,p,J,1,!1),Xe(Nt,Qt,J.x,0,1)):n||Xe(Nt,Qt,e,we,1),w&&!bt){let Di=c$(le).multiplyScalar(-1).normalize();Hf(Di,Qt,j);for(let Ii=0;Ii<=s;Ii++){let Li=Ii/s,$t=le.clone().multiplyScalar(-Li).add(Ue);Hf($t,Qt,V),I.push(V.x,V.y,V.z),P.push(j.x,j.y,j.z),O.push(Mt,.5+V.y/i),Nt.push(k++)}}w&&!n&&Nt.push(Nt[0]),ot.push(Nt)}for(let yt=0;yt<ot.length-1;yt++)for(let Nt=0;Nt<ot[0].length-1;Nt++){if(n&&w&&Nt==s)continue;let Mt=ot[yt][Nt],li=ot[yt+1][Nt],Qt=ot[yt+1][Nt+1],Wt=ot[yt][Nt+1],Di=I[Qt*3+0],Ii=I[Qt*3+2];A.push(Mt,li,Wt),(Di!=0||Ii!=0)&&A.push(li,Qt,Wt)}u<Math.PI*2&&(kt(-1,ot[0],c),kt(1,ot[ot.length-1],c+u)),this.setIndex(A),this.setAttribute("position",new Vi(I,3)),this.setAttribute("normal",new Vi(P,3)),this.setAttribute("uv",new Vi(O,2));function xt(yt,Nt,Mt,li,Qt,Wt,Di,Ii){for(let Li=0;Li<x+1;Li++){let $t=Li/x,Ut=Di<0?$t:1-$t;Ii&&(Ut-=1),Ut*=li;let wi=new lt(Math.sin(Ut),Math.cos(Ut)*Di),Hi=wi.clone().multiplyScalar(Qt).add(Wt);Hf(Hi,Mt,V),I.push(V.x,V.y,V.z),Hf(wi,Mt,j),P.push(j.x,j.y,j.z),O.push(Nt,.5+V.y/i),yt.push(k++)}}function Xe(yt,Nt,Mt,li,Qt){let Wt=new se,Di=new lt,Ii=[Mt,li];Qt<0&&Ii.reverse();for(let Li of Ii)Di.set(Li,U*Qt),Hf(Di,Nt,Wt),I.push(Wt.x,Wt.y,Wt.z),P.push(0,Qt,0),O.push(.5,.5),yt.push(k++)}function kt(yt,Nt,Mt){let li=new lt(Math.sin(Mt),Math.cos(Mt)),Qt=new lt(-Math.cos(Mt),Math.sin(Mt)),Wt=new se,Di=yt<0?($t,Ut,wi)=>A.push($t,Ut,wi):($t,Ut,wi)=>A.push($t,wi,Ut),Ii=new lt((e+t+we+fe)/4,0);Hf(Ii,li,Wt),I.push(Wt.x,Wt.y,Wt.z),P.push(Qt.x,0,Qt.y),O.push(.5,.5);let Li=k++;for(let $t of Nt){let Ut=I.slice($t*3,$t*3+3);I.push(...Ut),P.push(Qt.x,0,Qt.y);let wi=O.slice($t*2,$t*2+2);O.push(...wi),k++}for(let $t=Li+1;$t<k-1;$t++)Di(Li,$t,$t+1);Di(Li,k-1,Li+1)}}},QIe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return i.thetaLength=Yi.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,depth:i,height:r,radialSegments:s,heightSegments:n,openEnded:c,thetaStart:u,thetaLength:p,cornerRadiusTop:f,cornerRadiusBottom:x,cornerSegments:w}=e.parameters,E;return p===0?(E=new fr,E.setAttribute("position",new Vi([],3))):f>0||x>0||p<360?E=new hee(0,t/2,r,s,n,c,u,p*Math.PI/180,f,x,w,0,!0):E=new w4(t/2,r,s,n,c),E.scale(1,1,i/t),Object.assign(E,{userData:pt(me({},e),{type:"ConeGeometry"})})}},KIe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,widthSegments:s,heightSegments:n,depthSegments:c,cornerRadius:u,cornerSegments:p}=e.parameters,f;return u===0?f=new $u(t,i,r,s,n,c):f=new JIe(t,i,r,s,n,c,u,p),Object.assign(f,{userData:pt(me({},e),{type:"CubeGeometry"})})}},nk=Math.PI/2,JIe=class extends fr{constructor(e=1,t=1,i=1,r=1,s=1,n=1,c=0,u=4){super(),this.type="BoxGeometry",r=Math.floor(r),s=Math.floor(s),n=Math.floor(n),u=Math.floor(u),c=Math.min(c,e/2,t/2,i/2);let p=[],f=[],x=[],w=[],E=0;A("z","y","x",-1,-1,i,t,e,n,s),A("z","y","x",1,-1,i,t,-e,n,s),A("x","z","y",1,1,e,i,t,r,n),A("x","z","y",1,-1,e,i,-t,r,n),A("x","y","z",1,-1,e,t,i,r,s),A("x","y","z",-1,-1,e,t,-i,r,s),c>0&&(I("z","y","x",-1,-1,1,i,t,e,n),I("z","y","x",1,-1,-1,i,t,e,n),I("z","y","x",-1,1,-1,i,t,e,n),I("z","y","x",1,1,1,i,t,e,n),I("x","y","z",-1,-1,-1,e,t,i,r),I("x","y","z",1,-1,1,e,t,i,r),I("x","y","z",-1,1,1,e,t,i,r),I("x","y","z",1,1,-1,e,t,i,r),I("y","x","z",-1,-1,1,t,e,i,s),I("y","x","z",1,-1,-1,t,e,i,s),I("y","x","z",1,1,1,t,e,i,s),I("y","x","z",-1,1,-1,t,e,i,s),P(1,1,1),P(-1,1,1),P(1,-1,1),P(-1,-1,1),P(1,1,-1),P(-1,1,-1),P(1,-1,-1),P(-1,-1,-1)),this.setIndex(p),this.setAttribute("position",new Vi(f,3)),this.setAttribute("normal",new Vi(x,3)),this.setAttribute("uv",new Vi(w,2));function A(O,k,U,j,V,$,Y,J,X,ee){let oe=($-2*c)/X,le=(Y-2*c)/ee,ve=$/2-c,we=Y/2-c,fe=J/2,Ue=X+1,Fe=ee+1,Pe=0,Ae=new se;for(let et=0;et<Fe;et++){let $e=et*le-we;for(let rt=0;rt<Ue;rt++){let Je=rt*oe-ve;Ae[O]=Je*j,Ae[k]=$e*V,Ae[U]=fe,f.push(Ae.x,Ae.y,Ae.z),Ae[O]=0,Ae[k]=0,Ae[U]=J>0?1:-1,x.push(Ae.x,Ae.y,Ae.z),w.push(rt/X),w.push(1-et/ee),Pe+=1}}for(let et=0;et<ee;et++)for(let $e=0;$e<X;$e++){let rt=E+$e+Ue*et,Je=E+$e+Ue*(et+1),bt=E+($e+1)+Ue*(et+1),ot=E+($e+1)+Ue*et;p.push(rt,Je,ot),p.push(Je,bt,ot)}E+=Pe}function I(O,k,U,j,V,$,Y,J,X,ee){let oe=(Y-2*c)/ee,le=Y/2-c,ve=J/2-c,we=X/2,fe=ee+1,Ue=0,Fe=new se,Pe=new se;for(let Ae=0;Ae<u+1;Ae++){let et=Ae/u*nk,$e=Math.sin(et)*c,rt=(1-Math.cos(et))*c,Je=Math.sin(et),bt=Math.cos(et);Fe[k]=(ve+$e)*V,Fe[U]=(we-rt)*$,Pe[O]=0,Pe[k]=Je*Math.sign(Fe[k]),Pe[U]=bt*Math.sign(Fe[U]);for(let ot=0;ot<fe;ot++){let xt=ot*oe-le;Fe[O]=xt*j,f.push(Fe.x,Fe.y,Fe.z),x.push(Pe.x,Pe.y,Pe.z),w.push(ot/ee),w.push(0),Ue+=1}}for(let Ae=0;Ae<u;Ae++)for(let et=0;et<ee;et++){let $e=E+et+fe*Ae,rt=E+et+fe*(Ae+1),Je=E+(et+1)+fe*(Ae+1),bt=E+(et+1)+fe*Ae;p.push($e,rt,bt),p.push(rt,Je,bt)}E+=Ue}function P(O,k,U){let j=new se,V=new se(e/2,t/2,i/2);V.subScalar(c);let $=[],Y=O*k*U>0?(X,ee,oe)=>p.push(X,ee,oe):(X,ee,oe)=>p.push(X,oe,ee);for(let X=0;X<=u;X++){let ee=[],oe=nk*(1-X/u),le=Math.cos(oe),ve=Math.sin(oe),we=0;for(let fe=0;fe<=X;fe++){let Ue=Math.cos(we),Fe=Math.sin(we);j.x=le*Ue,j.y=ve,j.z=le*Fe;let Pe=V.clone().addScaledVector(j,c);f.push(O*Pe.x,k*Pe.y,U*Pe.z),x.push(O*j.x,k*j.y,U*j.z),w.push(0,0),ee.push(E++),we+=nk/X}$.push(ee)}let J=$.length-1;for(let X=0;X<J;X++){let ee=$[X],oe=$[X+1],le=ee.length-1;Y(ee[0],oe[1],oe[0]);for(let ve=1;ve<=le;ve++)Y(ee[ve-1],ee[ve],oe[ve]),Y(ee[ve],oe[ve+1],oe[ve])}}}},nU=class extends fr{constructor(e=[],t=[],i="",r=1,s=.2,n=4){super(),this.type="PolyhedronGeometryRound";let c=[],u=[],p=[];f(),x(),this.setAttribute("position",new Vi(c,3)),this.setAttribute("normal",new Vi(p,3)),this.setAttribute("uv",new Vi(u,2));return;function f(){s=Math.min(1-1e-5,s),s==0&&(n=0);let w={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],E=new se,A=E.clone(),I=new Ia,P=s*r,O=r-P,k=n+1,U=new se,j=(Pe,Ae)=>U.subVectors(Pe,Ae).normalize(),V=(Pe,Ae)=>Array(Pe).fill(void 0).map(Ae),$=V(e.length/3,(Pe,Ae)=>new se().fromArray(e,Ae*3).setLength(r)),Y=[],J=1e6;for(let Pe=0;Pe<$.length;Pe++){let Ae=$[Pe],et=[],$e,rt,Je,bt=1e10,ot=-1;for(;(ot=t.indexOf(Pe,ot+1))!=-1;){let yt=ot-ot%3;$e=t[yt+(ot+1)%3],rt=t[yt+(ot+2)%3],Je=Ae.distanceToSquared($[$e]),bt=Math.min(bt,Je),et.push([$e,rt,Je])}bt+=1e-6;let xt=[],Xe=0,kt=et.length;for(let yt=0;yt<kt;yt++){[$e,rt,Je]=et[Xe];let Nt=Y[$e]?.includes(Pe)==!0;Je<=bt&&xt.push($e+ +Nt*J),Xe=et.findIndex(Mt=>Mt[0]==rt)}Y.push(xt)}let X=[];{let Pe=0,Ae=0,et,$e,rt=w==3;for(let Je=0;Je<=n;Je++){et=Je*(Je+1)/2,$e=(Je+1)*(Je+2)/2;for(let bt=0;bt<n-Je;bt++)[Pe,Ae]=[et+bt+Je+2,$e+bt+Je+3],X.push(et,$e,...rt?[Ae,et]:[Pe,$e],Ae,Pe),[et,$e]=[Pe,Ae];X.push(et,$e,et+n+2)}}let ee=E.clone(),oe=E.clone(),le=E.clone(),ve=E.clone(),we=E.clone(),fe=[],Ue=V($.length,()=>V(w,()=>E.clone()));for(let Pe=0;Pe<$.length;Pe++){E.copy($[Pe]).normalize(),ee.copy(E).multiplyScalar(O);let Ae=Y[Pe];for(let xt=0;xt<Ae.length;xt++){let Xe=Ae[xt],kt=Ae[(xt+1)%w];I.setFromPointsAndIndices($,Pe,Xe%J,kt%J),I.b.sub(I.a).setLength(1e10).add(I.a),I.c.sub(I.a).setLength(1e10).add(I.a),I.closestPointToPoint(ee,Ue[Pe][xt])}let et=[],$e=[],rt=[],Je=new se;n==0&&[...Ue[Pe]].reduce((xt,Xe)=>xt.add(Xe),Je).multiplyScalar(1/w);for(let xt=0;xt<w;xt++){let Xe=[],kt=(xt-1+w)%w,yt=Ue[Pe][kt],Nt=Ue[Pe][xt];E.copy(yt).sub(ee),A.copy(Nt).sub(ee);let Mt=ee.angleTo(E),li=E.angleTo(A),Qt=Math.cos(Mt)*P;n==0?oe.copy(Je):oe.copy(ee).setLength(O+Qt),$e.push(Qt);let Wt=[oe,yt,Nt];for(let Di=0;Di<2;Di++){let Ii=Wt[Di],Li=Wt[Di+1];ve.subVectors(Ii,ee),we.subVectors(Li,ee),le.crossVectors(ve,we).normalize();for(let $t=0;$t<k;$t++){let Ut=[Mt,li][Di]*$t/k;E.copy(ve).applyAxisAngle(le,Ut).add(ee),et.push(E.clone()),Di&&(j(E,ee),Xe.push([$t==0?Ii:E.clone(),U.clone()]))}Di&&(j(Li,ee),Xe.push([Li,U.clone()]))}rt.push(Xe)}fe.push(rt);let bt=2*k,ot=2;for(let xt=0;xt<w;xt++){let Xe=bt*xt,kt=bt*((xt+1)%w),yt=[et[Xe]];for(let Mt=1;Mt<k;Mt++){ve=et[Xe+Mt],we=et[kt+Mt],yt.push(ve);for(let li=1,Qt=Mt-ot+1;li<=Qt;li++)E.lerpVectors(ve,we,li/(Qt+1)),E.sub(ee).setLength($e[xt]).add(ee),yt.push(E.clone());yt.push(we)}for(let Mt=0;Mt<k;Mt++)yt.push(et[Mt+k+Xe]);yt.push(et[kt+k]);let Nt=X.map(Mt=>yt[Mt]);c.push(...Nt.map(Mt=>[Mt.x,Mt.y,Mt.z]).flat()),p.push(...Nt.map(Mt=>(j(Mt,ee),[U.x,U.y,U.z])).flat())}}let Fe=[];for(let Pe=0;Pe<Y.length;Pe++)for(let Ae=0;Ae<w;Ae++){let et=Y[Pe][Ae];if(et<J){let $e=Y[et].findIndex(bt=>bt%J==Pe),rt=fe[Pe][Ae],Je=fe[et][$e];for(let bt=0;bt<k;bt++){let ot=rt[bt],xt=Je[k-bt],Xe=rt[bt+1],kt=Je[k-(bt+1)];[ot,xt,Xe,Xe,xt,kt].forEach(yt=>{c.push(yt[0].x,yt[0].y,yt[0].z),p.push(yt[1].x,yt[1].y,yt[1].z)})}Fe.push(rt[0][0],Je[k][0],rt[k][0],Je[0][0])}}for(;Fe.length;){let Pe,Ae,et,$e;[Pe,Ae]=Fe.splice(0,2);let rt=[Pe];for(;Pe!=Ae;)rt.push(Ae),et=Fe.indexOf(Ae),$e=et%2,Ae=Fe.splice(et-$e,2)[1-$e];U.subVectors(rt[0],rt[1]).cross(E.subVectors(rt[0],rt[2])).normalize();let Je=U.dot(rt[0])<0;Je&&U.negate();for(let bt=1;bt<=rt.length-2;bt++)[rt[bt+ +Je],rt[bt+1-+Je],rt[0]].forEach(ot=>{c.push(ot.x,ot.y,ot.z),p.push(U.x,U.y,U.z)})}}function x(){let w=new se;for(let Y=0;Y<c.length;Y+=3){w.x=c[Y+0],w.y=c[Y+1],w.z=c[Y+2];let J=V(w)/2/Math.PI+.5,X=$(w)/Math.PI+.5;u.push(J,1-X)}let E=new se,A=new se,I=new se,P=new se,O=new lt,k=new lt,U=new lt,j=(Y,J,X,ee)=>{ee<0&&Y.x===1&&(u[J]=Y.x-1),X.x===0&&X.z===0&&(u[J]=ee/2/Math.PI+.5)};for(let Y=0,J=0;Y<c.length;Y+=9,J+=6){E.set(c[Y+0],c[Y+1],c[Y+2]),A.set(c[Y+3],c[Y+4],c[Y+5]),I.set(c[Y+6],c[Y+7],c[Y+8]),O.set(u[J+0],u[J+1]),k.set(u[J+2],u[J+3]),U.set(u[J+4],u[J+5]),P.copy(E).add(A).add(I).divideScalar(3);let X=V(P);j(O,J+0,E,X),j(k,J+2,A,X),j(U,J+4,I,X)}for(let Y=0;Y<u.length;Y+=6){let J=u[Y+0],X=u[Y+2],ee=u[Y+4],oe=Math.max(J,X,ee),le=Math.min(J,X,ee);oe>.9&&le<.1&&(J<.2&&(u[Y+0]+=1),X<.2&&(u[Y+2]+=1),ee<.2&&(u[Y+4]+=1))}function V(Y){return Math.atan2(Y.z,-Y.x)}function $(Y){return Math.atan2(-Y.y,Math.sqrt(Y.x*Y.x+Y.z*Y.z))}}}static fromJSON(e){return new nU(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},ePe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:s,corner:n,cornerSides:c}=e.parameters,u=s===0&&n!==0?new dee(t*.5,n,c):new yK(t*.5,s);return u.scale(1,i/t,r/t),Object.assign(u,{userData:pt(me({},e),{type:"DodecahedronGeometry"})})}},dee=class extends nU{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,s=1/r,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-r,0,-s,r,0,s,-r,0,s,r,-s,-r,0,-s,r,0,s,-r,0,s,r,0,-r,0,-s,r,0,-s,-r,0,s,r,0,s],c=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],u="DodecahedronGeometry";super(n,c,u,e,t,i),this.type=u}static fromJSON(e){return new dee(e.radius,e.corner,e.cornerSides)}},zw=1e-12,sU=class{constructor(e){this.position=new lt,this.startPosition=new lt,this.uuid=Yi.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new sU(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},EB=class extends sU{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new EB(this.parent).copy(this)}},J_=class extends sU{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new EB(this),new EB(this))}static create(e,t){let i=new J_(e,new lt(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return t===0?this.controls[1]:t===1?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let i=0,r=this.controls.length;i<r;i++){let s=this.controls[i];this.position.distanceTo(s.position)<=t?s.position.copy(this.position):s.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new J_(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){let e=this.curveBefore?.getTangentAt(1),t=this.curveAfter?.getTangentAt(0);return[e,t]}computeNormals(e=new lt,t=new lt){let[i,r]=this.computeTangents();return i&&r&&(u$(i,e),u$(r,t)),[e,t]}computeTangent(e=new lt){let[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(e=new lt){let[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function u$(e,t=new lt){let i=e.length();return t.set(-e.y/i,e.x/i)}var oU=e=>e,Fx=new lt,zI=new lt,tPe=new lt,iPe=new lt,rPe=new lt,nPe=new lt,pee=new se,fee=new se;function sPe(e){let t=new lt;t.addVectors(e.v0,Fx.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new lt;return i.addVectors(e.v2,zI.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new Vu(e.v0,t,i,e.v2)}function Jw(e,t,i=Number.EPSILON){return Math.abs(e-t)<i}function oPe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function aPe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function mee(e,t,i){let r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),s=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),n=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((s*s+r*r-n*n)/(2*s*r))}function lPe(e,t,i){return d$(e,t)&&d$(t,i)&&MB(e.position,t.position,i.position)}function MB(e,t,i){return Fx.copy(t).sub(e).cross(zI.copy(i).sub(e))===0}function cPe(e,t,i,r,s){let n=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),c=(e.y+t.y)/2,u=(e.x+t.x)/2,p=Math.sqrt(Math.pow(i,2)-Math.pow(n/2,2))*(e.y-t.y)/n,f=Math.sqrt(Math.pow(i,2)-Math.pow(n/2,2))*(t.x-e.x)/n;return r.set(u+p,c+f),s.set(u-p,c-f),[r,s]}function uPe(e,t,i){let r=e.distanceTo(i),s=t.distanceTo(i);return r<s?t:e}function hPe(e,t,i,r,s,n){let c=t.x-e.x,u=t.y-e.y,p=i.x-e.x,f=i.y-e.y,x=Math.sqrt((c+p)*(c+p)+(u+f)*(u+f)),w;return mee(t,e,i)>Math.PI&&(x*=-1),Jw(f,u)?w=(u+f)*(r/x-.5)*8/3/(c-p):w=(c+p)*(r/x-.5)*8/3/(f-u),s.set(t.x-w*u,t.y+w*c),n.set(i.x+w*f,i.y-w*p),[s,n]}function h$(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function d$(e,t){return MB(e.position,e.controls[1].position,t.position)&&MB(e.position,t.controls[0].position,t.position)}function dPe(e,t,i,r,s=.5){let n=Fx.subVectors(t,e).multiplyScalar(s).add(e),c=zI.subVectors(i,t).multiplyScalar(s).add(t),u=tPe.subVectors(r,i).multiplyScalar(s).add(i),p=n,f=iPe.subVectors(c,n).multiplyScalar(s).add(n),x=rPe.subVectors(u,c).multiplyScalar(s).add(c),w=u,E=nPe.subVectors(x,f).multiplyScalar(s).add(f);return[e.x,e.y,p.x,p.y,f.x,f.y,E.x,E.y,x.x,x.y,w.x,w.y,r.x,r.y]}function pPe(e,t,i=12,r=!0){let s=fee.set(0,0,0),n,c=0,u=[];for(let p=0;p<t.length;p++){let f=oU(t[p]),x=Fx,w=Fy(f,i);u.push(w);for(let E=0;E<=w;E++)if(f instanceof Vu||f instanceof ym||f instanceof qu){if(f.getPoint(E/w,x),s.set(x.x,x.y,0),n!==void 0&&aPe(n,s))continue;n===void 0&&(n=pee),n.copy(s),e.setXYZ(c,s.x,s.y,s.z),c++}}return r&&c>1&&!(e.getX(c-1)===e.getX(0)&&e.getY(c-1)===e.getY(0)&&e.getZ(c-1)===e.getZ(0))&&(e.setXYZ(c,e.getX(0),e.getY(0),e.getZ(0)),c++),e}function fPe(e,t,i,r=12,s=!0){let n=fee.set(0,0,0),c=0,u=[];for(let p=0;p<t.length;p++){if(i[p]===!1)continue;let f,x=oU(t[p]),w=Fx,E=Fy(x,r);u.push(E);for(let A=0;A<=E;A++)if(x instanceof Vu||x instanceof ym||x instanceof qu){if(x.getPoint(A/E,w),n.set(w.x,w.y,0),f?.equals(n))continue;f===void 0?f=pee:(e.setXYZ(c,f.x,f.y,f.z),c++,e.setXYZ(c,n.x,n.y,n.z),c++),f.copy(n)}}return s&&c>1&&!(e.getX(c-1)===e.getX(0)&&e.getY(c-1)===e.getY(0)&&e.getZ(c-1)===e.getZ(0))&&(e.setXYZ(c,e.getX(0),e.getY(0),e.getZ(0)),c++),u}function p$(e,t=12,i=!1){let r=[];for(let s=0,n=e.length;s<n;s++){let c=e[s],u=0;if(i&&c.roundedCurveCorner!==void 0){let p=Fy(c.roundedCurveCorner,t)*.5;s>0&&(r[s-1]+=p),u+=p}c.curveAfter!==void 0&&(u+=Fy(c.curveAfter,t)),r.push(u)}return e.length>0&&i&&e[0].roundedCurveCorner!==void 0&&(r[e.length-1]+=Fy(e[0].roundedCurveCorner,t)*.5),r}function Fy(e,t=12){return e&&e instanceof xI?t*2:e&&(e instanceof qu||e instanceof fK)?1:e&&e instanceof x4?t*e.points.length:t}function mPe(e,t,i=12,r=!0){let s,n=0;for(let c=0;c<t.length;c++){let u=oU(t[c]),p=Fy(u,i),f=Fx;for(let x=0;x<=p;x++)if(u instanceof Vu||u instanceof ym||u instanceof qu){if(u.getPoint(x/p,f),s!==void 0&&oPe(s,f,zw))continue;s===void 0&&(s=zI),s.copy(f),e.push(f.x,f.y),n++}}return Jw(e[0],e[e.length-2],zw)&&Jw(e[1],e[e.length-1],zw)&&(e.pop(),e.pop()),r&&n>1&&!(Jw(e[n-1],e[1],zw)&&Jw(e[n-2],e[0],zw))&&(e.push(e[0],e[1]),n++),e}var sk=new lt,gPe=new lt,yPe=new lt,vPe=new lt,_Pe=new lt,xPe=new lt,io=class extends wD{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new zl(new se(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=Yi.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let r=new io;return r.isClosed=e.isClosed,r.points=e.points.map(s=>J_.create(s.id,s.data)),typeof e.roundness=="number"&&(r.roundness=e.roundness),r.shapeHoles=e.shapeHoles.map(s=>io.createFromState(s)),t!==void 0&&i!==void 0&&r.applySize(t,i),r.update(),r}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex(r=>r.uuid===e);if(i<0){let r=t;for(let s=0,n=this.shapeHoles.length;s<n;s++){let c=this.shapeHoles[s],u=c.points.length,p=c.getPointIndexById(e);if(p<0)r+=u;else return p+r}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,r=this.shapeHoles.length;i<r;i++){let s=this.shapeHoles[i],n=e-t;if(n<=s.points.length-1)return s.points[n];t+=s.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,r=this.shapeHoles.length;i<r;i++){let s=this.shapeHoles[i],n=s.points.indexOf(e);if(n>=0)return t+n;t+=s.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){e===0&&(e=.001),t===0&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=sk.set(e,t);for(let r=0,s=this.points.length;r<s;r++){let n=this.points[r];n.position.multiply(i),n.controls[0].position.multiply(i),n.controls[1].position.multiply(i)}for(let r=0,s=this.shapeHoles.length;r<s;r++)this.shapeHoles[r].applyScale(e,t);this._update()}createPoint(e,t=0,i=Yi.generateUUID()){let r;e instanceof lt?r=e:r=new lt(e,t);let s=new J_(i,r);return s.roundness=this.roundness,s}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(r.uuid===e)return r}for(let t=0,i=this.shapeHoles.length;t<i;t++){let r=this.shapeHoles[t].getPointByUuid(e);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(i=>i.uuid===e);t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,i=!1){this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t);let r=i?this.roundedCurveDivisions:this.curveDivisions;return pPe(e,i?this.roundedCurves:this.curves,t,this.autoClose),r.reduce((s,n)=>s+n,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=p$(this.points,e,!1),this.roundedCurveDivisions=p$(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,i=12){return fPe(e,this.curves,t,i,this.autoClose).reduce((r,s)=>r+s,0)*2}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t),mPe(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let r=t?this.roundedCurveDivisions:this.curveDivisions,s=0;t&&this.points[0].roundedCurveCorner!==void 0&&(s=Fy(this.points[0].roundedCurveCorner,this.subdivision)*.5);let n=e-s;n<0&&(n+=r.reduce((c,u)=>c+u,0));for(let c=0,u=r.length;c<u;c++){let p=r[c];if(n<i+p)return[c,(n-i+1)/p];i+=p}return[0,1]}getCurveT(e,t,i){let r=this.points[e],s=this.points[e>=this.points.length-1?0:e+1],n=this.curveDivisions,c=n[e];if(h$(r,s)){let p=r.position.distanceTo(s.position);return r.position.distanceTo(sk.set(i.x,i.y))/p}let u=0;for(let p=0;p<e;p++)u+=n[p];return(t-u)/c}dispose(){}_applyCurveForPoint(e,t){h$(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let r=i.clone();e.roundedCurveBefore=r,t.roundedCurveAfter=r,e.roundedCurveCorner=void 0,this.roundedCurves.push(r)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(t===0)this.moveTo(r.position.x,r.position.y);else{let s=this.points[t-1];this._applyCurveForPoint(r,s)}}let e=this.getLastPoint();if(e?.curveAfter&&(e.curveAfter=void 0),this.isClosed){let t=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(t,i)}if(this.points.length>2){let t=0;for(let i=0,r=this.points.length;i<r;i++){let s=this.points[i],n=this.points[i-1]??this.points[this.points.length-1],c=this.points[i+1]??this.points[0],u=s.roundness,p=n&&c&&lPe(n,s,c);if(!s.controlsMoved()&&u>0&&!p){let f=s.curveBefore,x=s.curveAfter;if(f===void 0||x===void 0)continue;let w=s.roundedCurveBefore,E=s.roundedCurveAfter,A=f.getLength(),I=x.getLength(),P=Math.min(u,A*.499),O=Math.min(u,I*.499),k=Math.min(P,O),U=1-k/A,j=k/I,V=f.getPointAt(U,sk),$=x.getPointAt(j,gPe);this._subSplitCurve(f,w,U,V,void 0),this._subSplitCurve(x,E,j,void 0,$);let Y;if(this.useCubicForRoundedCorners){let J=mee(V,s.position,$)/2,X=Math.tan(J)*V.distanceTo(s.position),[ee,oe]=cPe(V,$,X,yPe,vPe),le=uPe(ee,oe,s.position),[ve,we]=hPe(le,V,$,X,_Pe,xPe);Y=new Vu(V.clone(),ve.clone(),we.clone(),$.clone())}else Y=new ym(V.clone(),s.position.clone(),$.clone());s.roundedCurveCorner=Y,this.roundedCurves.splice(i+t,0,Y),t++}}}}_subSplitCurve(e,t,i,r,s){if(e instanceof qu)r!==void 0&&t.v2.copy(r),s!==void 0&&t.v1.copy(s);else{let n=e,c=t,u=n.getUtoTmapping(i,0),p=dPe(n.v0,n.v1,n.v2,n.v3,u);return r!==void 0&&(c.v0.set(p[0],p[1]),c.v1.set(p[2],p[3]),c.v2.set(p[4],p[5]),c.v3.set(p[6],p[7])),s!==void 0&&(c.v0.set(p[6],p[7]),c.v1.set(p[8],p[9]),c.v2.set(p[10],p[11]),c.v3.set(p[12],p[13])),c}return t}clone(){let e=new io(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let i=0;i<t;i++){let r=i*7,s=e.points[r+0],n=e.points[r+1],c=e.points[r+2],u=e.points[r+3],p=e.points[r+4],f=e.points[r+5],x=e.points[r+6],w=new J_(Yi.generateUUID(),new lt(s,n));w.controls[0].position.set(c,u),w.controls[1].position.set(p,f),w.roundness=x,this.points.push(w)}return this.shapeHoles=e.shapeHoles?.length?e.shapeHoles.map(i=>{let r=new io;return r.fromJSON(i),r}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e,t=!1){this.isText=t;let i=(s,n)=>{n instanceof Vu&&n.v3.equals(s.position)&&s.controls[0].position.copy(n.v2)},r=s=>{let n=[],c,u;for(c=0,u=s.length;c<u;c++)s[c]instanceof ym&&(s[c]=sPe(s[c]));for(c=0,u=s.length;c<u;c++){let x=s[c],w=c>0?s[c-1]:null,E;x instanceof Vu?(E=this.createPoint(x.v0),E.controls[1].position.copy(x.v1)):x instanceof qu&&(E=this.createPoint(x.v1)),E!==void 0&&(w!==null&&i(E,w),n.push(E))}let p=s[s.length-1],f=!1;return p instanceof Vu?p.v3.equals(n[0].position)&&(n[0].controls[0].position.copy(p.v2),f=!0):p instanceof qu&&p.v2.equals(n[0].position)&&(f=!0),this.isClosed=f,n};return this.points=r(e.curves),e instanceof wD&&(this.shapeHoles=e.holes.map(s=>{let n=new io;return n.fromShape(s),n})),this.update(),this}updatePoint(e,t){let i=this.getPointByUuid(e);i&&(t.position!==void 0&&i.position.fromArray(t.position),t.roundness!==void 0&&(i.roundness=t.roundness),t.areControlsDirectionsMirrored!==void 0&&(i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){let i=this.getPointByUuid(e)?.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){let i=this.getPointByUuid(e)?.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},TB=Math.PI*2;function ok({x:e,y:t},i,r,s,n){return{x:e*i+s,y:t*r+n}}function bPe(e,t){let i=t===1.5707963267948966?.551915024494:t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=Math.cos(e),s=Math.sin(e),n=Math.cos(e+t),c=Math.sin(e+t);return[{x:r-s*i,y:s+r*i},{x:n+c*i,y:c-n*i},{x:n,y:c}]}function f$(e,t,i,r){let s=e*r-t*i<0?-1:1,n=Math.min(1,Math.max(-1,e*i+t*r));return s*Math.acos(n)}function wPe(e,t,i,r,s,n,c,u,p,f){let x=Math.pow(s,2),w=Math.pow(n,2),E=Math.pow(c,2),A=Math.pow(u,2),I=x*w-x*A-w*E;I<0&&(I=0),I/=x*A+w*E,I=Math.sqrt(I)*(p===f?-1:1);let P=I*s/n*u,O=I*-n/s*c,k=P+(e+i)/2,U=O+(t+r)/2,j=(c-P)/s,V=(u-O)/n,$=(-c-P)/s,Y=(-u-O)/n,J=f$(1,0,j,V),X=f$(j,V,$,Y);return!f&&X>0&&(X-=TB),f&&X<0&&(X+=TB),{centerx:k,centery:U,ang1:J,ang2:X}}function SPe({px:e,py:t,cx:i,cy:r,rx:s,ry:n,largeArcFlag:c,sweepFlag:u}){let p=[];if(s===0||n===0)return[];let f=(e-i)/2,x=(t-r)/2;if(f===0&&x===0)return[];s=Math.abs(s),n=Math.abs(n);let w=Math.pow(f,2)/Math.pow(s,2)+Math.pow(x,2)/Math.pow(n,2);w>1&&(s*=Math.sqrt(w),n*=Math.sqrt(w));let E=wPe(e,t,i,r,s,n,f,x,c,u),{ang1:A,ang2:I}=E,{centerx:P,centery:O}=E,k=Math.abs(I)/(TB/4);Math.abs(1-k)<1e-7&&(k=1);let U=Math.max(Math.ceil(k),1);I/=U;for(let j=0;j<U;j++)p.push(bPe(A,I)),A+=I;return p.map(j=>{let{x:V,y:$}=ok(j[0],s,n,P,O),{x:Y,y:J}=ok(j[1],s,n,P,O),{x:X,y:ee}=ok(j[2],s,n,P,O);return{x1:V,y1:$,x2:Y,y2:J,x:X,y:ee}})}var ps;(function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(ps||(ps={}));var Mo;(function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(Mo||(Mo={}));function Lr(e,t){if(!e)throw t||"Assertion Failed!"}var wr=function(){function e(){}return e.vertEq=function(t,i){return t.s===i.s&&t.t===i.t},e.vertLeq=function(t,i){return t.s<i.s||t.s===i.s&&t.t<=i.t},e.transLeq=function(t,i){return t.t<i.t||t.t===i.t&&t.s<=i.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},e.edgeEval=function(t,i,r){Lr(e.vertLeq(t,i)&&e.vertLeq(i,r));var s=i.s-t.s,n=r.s-i.s;return s+n>0?s<n?i.t-t.t+(t.t-r.t)*(s/(s+n)):i.t-r.t+(r.t-t.t)*(n/(s+n)):0},e.edgeSign=function(t,i,r){Lr(e.vertLeq(t,i)&&e.vertLeq(i,r));var s=i.s-t.s,n=r.s-i.s;return s+n>0?(i.t-r.t)*s+(i.t-t.t)*n:0},e.transEval=function(t,i,r){Lr(e.transLeq(t,i)&&e.transLeq(i,r));var s=i.t-t.t,n=r.t-i.t;return s+n>0?s<n?i.s-t.s+(t.s-r.s)*(s/(s+n)):i.s-r.s+(r.s-t.s)*(n/(s+n)):0},e.transSign=function(t,i,r){Lr(e.transLeq(t,i)&&e.transLeq(i,r));var s=i.t-t.t,n=r.t-i.t;return s+n>0?(i.s-r.s)*s+(i.s-t.s)*n:0},e.vertCCW=function(t,i,r){return t.s*(i.t-r.t)+i.s*(r.t-t.t)+r.s*(t.t-i.t)>=0},e.interpolate=function(t,i,r,s){return t=t<0?0:t,r=r<0?0:r,t<=r?r===0?(i+s)/2:i+(s-i)*(t/(t+r)):s+(i-s)*(r/(t+r))},e.intersect=function(t,i,r,s,n){var c,u,p;e.vertLeq(t,i)||(p=t,t=i,i=p),e.vertLeq(r,s)||(p=r,r=s,s=p),e.vertLeq(t,r)||(p=t,t=r,r=p,p=i,i=s,s=p),e.vertLeq(r,i)?e.vertLeq(i,s)?(c=e.edgeEval(t,r,i),u=e.edgeEval(r,i,s),c+u<0&&(c=-c,u=-u),n.s=e.interpolate(c,r.s,u,i.s)):(c=e.edgeSign(t,r,i),u=-e.edgeSign(t,s,i),c+u<0&&(c=-c,u=-u),n.s=e.interpolate(c,r.s,u,s.s)):n.s=(r.s+i.s)/2,e.transLeq(t,i)||(p=t,t=i,i=p),e.transLeq(r,s)||(p=r,r=s,s=p),e.transLeq(t,r)||(p=t,t=r,r=p,p=i,i=s,s=p),e.transLeq(r,i)?e.transLeq(i,s)?(c=e.transEval(t,r,i),u=e.transEval(r,i,s),c+u<0&&(c=-c,u=-u),n.t=e.interpolate(c,r.t,u,i.t)):(c=e.transSign(t,r,i),u=-e.transSign(t,s,i),c+u<0&&(c=-c,u=-u),n.t=e.interpolate(c,r.t,u,s.t)):n.t=(r.t+i.t)/2},e}(),Fw=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return e}(),v2=function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e}(),k_=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return e}(),m$=function(){function e(){var t=new k_,i=new Fw,r=new v2(0),s=new v2(1);t.next=t.prev=t,t.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=s,s.next=s,s.Sym=r,this.vHead=t,this.fHead=i,this.eHead=r,this.eHeadSym=s}return e.prototype.makeEdge_=function(t){var i=new v2(0),r=new v2(1);t.Sym.side<t.side&&(t=t.Sym);var s=t.Sym.next;return r.next=s,s.Sym.next=i,i.next=t,t.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},e.prototype.splice_=function(t,i){var r=t.Onext,s=i.Onext;r.Sym.Lnext=i,s.Sym.Lnext=t,t.Onext=s,i.Onext=r},e.prototype.makeVertex_=function(t,i,r){var s=t;Lr(s,"Vertex can't be null!");var n=r.prev;s.prev=n,n.next=s,s.next=r,r.prev=s,s.anEdge=i;var c=i;do c.Org=s,c=c.Onext;while(c!==i)},e.prototype.makeFace_=function(t,i,r){var s=t;Lr(s,"Face can't be null");var n=r.prev;s.prev=n,n.next=s,s.next=r,r.prev=s,s.anEdge=i,s.trail=null,s.marked=!1,s.inside=r.inside;var c=i;do c.Lface=s,c=c.Lnext;while(c!==i)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,r=t.Sym.next;i.Sym.next=r,r.Sym.next=i},e.prototype.killVertex_=function(t,i){var r=t.anEdge,s=r;do s.Org=i,s=s.Onext;while(s!==r);var n=t.prev,c=t.next;c.prev=n,n.next=c},e.prototype.killFace_=function(t,i){var r=t.anEdge,s=r;do s.Lface=i,s=s.Lnext;while(s!==r);var n=t.prev,c=t.next;c.prev=n,n.next=c},e.prototype.makeEdge=function(){var t=new k_,i=new k_,r=new Fw,s=this.makeEdge_(this.eHead);return this.makeVertex_(t,s,this.vHead),this.makeVertex_(i,s.Sym,this.vHead),this.makeFace_(r,s,this.fHead),s},e.prototype.splice=function(t,i){var r=!1,s=!1;if(t!==i){if(i.Org!==t.Org&&(s=!0,this.killVertex_(i.Org,t.Org)),i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!s){var n=new k_;this.makeVertex_(n,i,t.Org),t.Org.anEdge=t}if(!r){var c=new Fw;this.makeFace_(c,i,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var i=t.Sym,r=!1;if(t.Lface!==t.Rface&&(r=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!r){var s=new Fw;this.makeFace_(s,t,t.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var i=this.makeEdge_(t),r=i.Sym;this.splice_(i,t.Lnext),i.Org=t.Dst;var s=new k_;return this.makeVertex_(s,r,i.Org),i.Lface=r.Lface=t.Lface,i},e.prototype.splitEdge=function(t){var i=this.addEdgeVertex(t),r=i.Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,r),t.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=t.Rface,r.winding=t.winding,r.Sym.winding=t.Sym.winding,r.idx=t.idx,r.Sym.idx=t.Sym.idx,r},e.prototype.connect=function(t,i){var r=!1,s=this.makeEdge_(t),n=s.Sym;if(i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(s,t.Lnext),this.splice_(n,i),s.Org=t.Dst,n.Org=i.Org,s.Lface=n.Lface=t.Lface,t.Lface.anEdge=n,!r){var c=new Fw;this.makeFace_(c,s,t.Lface)}return s},e.prototype.zapFace=function(t){var i=t.anEdge,r,s,n,c,u;s=i.Lnext;do r=s,s=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),n=r.Sym,n.Onext===n?this.killVertex_(n.Org,null):(n.Org.anEdge=n.Onext,this.splice_(n,n.Oprev)),this.killEdge_(r));while(r!=i);c=t.prev,u=t.next,u.prev=c,c.next=u},e.prototype.countFaceVerts_=function(t){var i=t.anEdge,r=0;do r++,i=i.Lnext;while(i!==t.anEdge);return r},e.prototype.mergeConvexFaces=function(t){var i,r,s,n,c,u,p;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,c=r.Org;s=r.Lnext,n=r.Sym,n&&n.Lface&&n.Lface.inside&&(u=this.countFaceVerts_(i),p=this.countFaceVerts_(n.Lface),u+p-2<=t&&wr.vertCCW(r.Lprev.Org,r.Org,n.Lnext.Lnext.Org)&&wr.vertCCW(n.Lprev.Org,n.Org,r.Lnext.Lnext.Org)&&(s=n.Lnext,this.delete(n),r=null,n=null)),!(r&&r.Lnext.Org===c);)r=s;return!0},e.prototype.check=function(){var t=this.fHead,i=this.vHead,r=this.eHead,s,n,c,u,p,f;for(n=t,n=t;(s=n.next)!==t;n=s){Lr(s.prev===n),p=s.anEdge;do Lr(p.Sym!==p),Lr(p.Sym.Sym===p),Lr(p.Lnext.Onext.Sym===p),Lr(p.Onext.Sym.Lnext===p),Lr(p.Lface===s),p=p.Lnext;while(p!==s.anEdge)}for(Lr(s.prev===n&&s.anEdge===null),u=i,u=i;(c=u.next)!==i;u=c){Lr(c.prev===u),p=c.anEdge;do Lr(p.Sym!==p),Lr(p.Sym.Sym===p),Lr(p.Lnext.Onext.Sym===p),Lr(p.Onext.Sym.Lnext===p),Lr(p.Org===c),p=p.Onext;while(p!==c.anEdge)}for(Lr(c.prev===u&&c.anEdge===null),f=r,f=r;(p=f.next)!==r;f=p)Lr(p.Sym.next===f.Sym),Lr(p.Sym!==p),Lr(p.Sym.Sym===p),Lr(p.Org!==null),Lr(p.Dst!==null),Lr(p.Lnext.Onext.Sym===p),Lr(p.Onext.Sym.Lnext===p);Lr(p.Sym.next===f.Sym&&p.Sym===this.eHeadSym&&p.Sym.Sym===p&&p.Org===null&&p.Dst===null&&p.Lface===null&&p.Rface===null)},e}(),g$=function(){function e(){this.handle=null}return e}(),y$=function(){function e(){this.key=null,this.node=0}return e}(),EPe=function(){function e(t,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var r=0;r<t+1;r++)this.nodes[r]=new g$,this.handles[r]=new y$;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var i=this.nodes,r=this.handles,s,n,c;for(s=i[t].handle;;){if(c=t<<1,c<this.size&&this.leq(r[i[c+1].handle].key,r[i[c].handle].key)&&++c,Lr(c<=this.max),n=i[c].handle,c>this.size||this.leq(r[s].key,r[n].key)){i[t].handle=s,r[s].node=t;break}i[t].handle=n,r[n].node=t,t=c}},e.prototype.floatUp_=function(t){var i=this.nodes,r=this.handles,s,n,c;for(s=i[t].handle;;){if(c=t>>1,n=i[c].handle,c===0||this.leq(r[n].key,r[s].key)){i[t].handle=s,r[s].node=t;break}i[t].handle=n,r[n].node=t,t=c}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var s,n;for(n=this.nodes.length,this.nodes.length=this.max+1,s=n;s<this.nodes.length;s++)this.nodes[s]=new g$;for(n=this.handles.length,this.handles.length=this.max+1,s=n;s<this.handles.length;s++)this.handles[s]=new y$}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=t,this.initialized&&this.floatUp_(i),r},e.prototype.extractMin=function(){var t=this.nodes,i=this.handles,r=t[1].handle,s=i[r].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),s},e.prototype.delete=function(t){var i=this.nodes,r=this.handles,s;Lr(t>=1&&t<=this.max&&r[t].key!==null),s=r[t].node,i[s].handle=i[this.size].handle,r[i[s].handle].node=s,--this.size,s<=this.size&&(s<=1||this.leq(r[i[s>>1].handle].key,r[i[s].handle].key)?this.floatDown_(s):this.floatUp_(s)),r[t].key=null,r[t].node=this.freeList,this.freeList=t},e}(),ak=function(){function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return e}(),v$=function(){function e(){this.key=null,this.next=null,this.prev=null}return e}(),MPe=function(){function e(t,i){this.frame=t,this.leq=i,this.head=new v$,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,t,i.key));return i},e.prototype.insertBefore=function(t,i){do t=t.prev;while(t.key!==null&&!this.leq(this.frame,t.key,i));var r=new v$;return r.key=i,r.next=t.next,t.next.prev=r,r.prev=t,t.next=r,r},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e}(),TPe=function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.edgeLeq=function(t,i,r){var s=t.event,n=i.eUp,c=r.eUp;if(n.Dst===s)return c.Dst===s?wr.vertLeq(n.Org,c.Org)?wr.edgeSign(c.Dst,n.Org,c.Org)<=0:wr.edgeSign(n.Dst,c.Org,n.Org)>=0:wr.edgeSign(c.Dst,s,c.Org)<=0;if(c.Dst===s)return wr.edgeSign(n.Dst,s,n.Org)>=0;var u=wr.edgeEval(n.Dst,s,n.Org),p=wr.edgeEval(c.Dst,s,c.Org);return u>=p},e.deleteRegion=function(t,i){i.fixUpperEdge&&Lr(i.eUp.winding===0),i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},e.fixUpperEdge=function(t,i,r){Lr(i.fixUpperEdge),t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},e.topLeftRegion=function(t,i){var r=i.eUp.Org,s;do i=e.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(s=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext),s===null)return null;e.fixUpperEdge(t,i,s),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do t=e.regionAbove(t);while(t.eUp.Dst===i);return t},e.addRegionBelow=function(t,i,r){var s=new ak;return s.eUp=r,s.nodeUp=t.dict.insertBefore(i.nodeUp,s),s.fixUpperEdge=!1,s.sentinel=!1,s.dirty=!1,r.activeRegion=s,s},e.isWindingInside=function(t,i){switch(t.windingRule){case ps.ODD:return(i&1)!==0;case ps.NONZERO:return i!==0;case ps.POSITIVE:return i>0;case ps.NEGATIVE:return i<0;case ps.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var r=i.eUp,s=r.Lface;s.inside=i.inside,s.anEdge=r,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,r){for(var s,n=null,c=i,u=i.eUp;c!==r;){if(c.fixUpperEdge=!1,n=e.regionBelow(c),s=n.eUp,s.Org!=u.Org){if(!n.fixUpperEdge){e.finishRegion(t,c);break}s=t.mesh.connect(u.Lprev,s.Sym),e.fixUpperEdge(t,n,s)}u.Onext!==s&&(t.mesh.splice(s.Oprev,s),t.mesh.splice(u,s)),e.finishRegion(t,c),u=n.eUp,c=n}return u},e.addRightEdges=function(t,i,r,s,n,c){var u,p,f,x,w=!0;f=r;do Lr(wr.vertLeq(f.Org,f.Dst)),e.addRegionBelow(t,i,f.Sym),f=f.Onext;while(f!==s);for(n===null&&(n=e.regionBelow(i).eUp.Rprev),p=i,x=n;u=e.regionBelow(p),f=u.eUp.Sym,f.Org===x.Org;)f.Onext!==x&&(t.mesh.splice(f.Oprev,f),t.mesh.splice(x.Oprev,f)),u.windingNumber=p.windingNumber-f.winding,u.inside=e.isWindingInside(t,u.windingNumber),p.dirty=!0,!w&&e.checkForRightSplice(t,p)&&(e.addWinding(f,x),e.deleteRegion(t,p),t.mesh.delete(x)),w=!1,p=u,x=f;p.dirty=!0,Lr(p.windingNumber-f.winding===u.windingNumber),c&&e.walkDirtyRegions(t,p)},e.spliceMergeVertices=function(t,i,r){t.mesh.splice(i,r)},e.vertexWeights=function(t,i,r){var s=wr.vertL1dist(i,t),n=wr.vertL1dist(r,t),c=.5*n/(s+n),u=.5*s/(s+n);t.coords[0]+=c*i.coords[0]+u*r.coords[0],t.coords[1]+=c*i.coords[1]+u*r.coords[1],t.coords[2]+=c*i.coords[2]+u*r.coords[2]},e.getIntersectData=function(t,i,r,s,n,c){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,r,s),e.vertexWeights(i,n,c)},e.checkForRightSplice=function(t,i){var r=e.regionBelow(i),s=i.eUp,n=r.eUp;if(wr.vertLeq(s.Org,n.Org)){if(wr.edgeSign(n.Dst,s.Org,n.Org)>0)return!1;wr.vertEq(s.Org,n.Org)?s.Org!==n.Org&&(t.pq.delete(s.Org.pqHandle),e.spliceMergeVertices(t,n.Oprev,s)):(t.mesh.splitEdge(n.Sym),t.mesh.splice(s,n.Oprev),i.dirty=r.dirty=!0)}else{if(wr.edgeSign(s.Dst,n.Org,s.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(s.Sym),t.mesh.splice(n.Oprev,s)}return!0},e.checkForLeftSplice=function(t,i){var r=e.regionBelow(i),s=i.eUp,n=r.eUp,c;if(Lr(!wr.vertEq(s.Dst,n.Dst)),wr.vertLeq(s.Dst,n.Dst)){if(wr.edgeSign(s.Dst,n.Dst,s.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,c=t.mesh.splitEdge(s),t.mesh.splice(n.Sym,c),c.Lface.inside=i.inside}else{if(wr.edgeSign(n.Dst,s.Dst,n.Org)>0)return!1;i.dirty=r.dirty=!0,c=t.mesh.splitEdge(n),t.mesh.splice(s.Lnext,n.Sym),c.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var r=e.regionBelow(i),s=i.eUp,n=r.eUp,c=s.Org,u=n.Org,p=s.Dst,f=n.Dst,x,w,E=new k_,A,I;if(Lr(!wr.vertEq(f,p)),Lr(wr.edgeSign(p,t.event,c)<=0),Lr(wr.edgeSign(f,t.event,u)>=0),Lr(c!==t.event&&u!==t.event),Lr(!i.fixUpperEdge&&!r.fixUpperEdge),c===u||(x=Math.min(c.t,p.t),w=Math.max(u.t,f.t),x>w))return!1;if(wr.vertLeq(c,u)){if(wr.edgeSign(f,c,u)>0)return!1}else if(wr.edgeSign(p,u,c)<0)return!1;return e.debugEvent(t),wr.intersect(p,c,f,u,E),Lr(Math.min(c.t,p.t)<=E.t),Lr(E.t<=Math.max(u.t,f.t)),Lr(Math.min(f.s,p.s)<=E.s),Lr(E.s<=Math.max(u.s,c.s)),wr.vertLeq(E,t.event)&&(E.s=t.event.s,E.t=t.event.t),A=wr.vertLeq(c,u)?c:u,wr.vertLeq(A,E)&&(E.s=A.s,E.t=A.t),wr.vertEq(E,c)||wr.vertEq(E,u)?(e.checkForRightSplice(t,i),!1):!wr.vertEq(p,t.event)&&wr.edgeSign(p,t.event,E)>=0||!wr.vertEq(f,t.event)&&wr.edgeSign(f,t.event,E)<=0?f===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(n.Sym,s),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),r),e.addRightEdges(t,i,s.Oprev,s,s,!0),!0):p===t.event?(t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Lnext,n.Oprev),r=i,i=e.topRightRegion(i),I=e.regionBelow(i).eUp.Rprev,r.eUp=n.Oprev,n=e.finishLeftRegions(t,r,null),e.addRightEdges(t,i,n.Onext,s.Rprev,I,!0),!0):(wr.edgeSign(p,t.event,E)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),wr.edgeSign(f,t.event,E)<=0&&(i.dirty=r.dirty=!0,t.mesh.splitEdge(n.Sym),n.Org.s=t.event.s,n.Org.t=t.event.t),!1):(t.mesh.splitEdge(s.Sym),t.mesh.splitEdge(n.Sym),t.mesh.splice(n.Oprev,s),s.Org.s=E.s,s.Org.t=E.t,s.Org.pqHandle=t.pq.insert(s.Org),e.getIntersectData(t,s.Org,c,p,u,f),e.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var r=e.regionBelow(i),s,n;;){for(;r.dirty;)i=r,r=e.regionBelow(r);if(!i.dirty&&(r=i,i=e.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,s=i.eUp,n=r.eUp,s.Dst!==n.Dst&&e.checkForLeftSplice(t,i)&&(r.fixUpperEdge?(e.deleteRegion(t,r),t.mesh.delete(n),r=e.regionBelow(i),n=r.eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(s),i=e.regionAbove(r),s=i.eUp)),s.Org!==n.Org)if(s.Dst!==n.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(s.Dst===t.event||n.Dst===t.event)){if(e.checkForIntersect(t,i))return}else e.checkForRightSplice(t,i);s.Org===n.Org&&s.Dst===n.Dst&&(e.addWinding(n,s),e.deleteRegion(t,i),t.mesh.delete(s),i=e.regionAbove(r))}},e.connectRightVertex=function(t,i,r){var s,n=r.Onext,c=e.regionBelow(i),u=i.eUp,p=c.eUp,f=!1;if(u.Dst!==p.Dst&&e.checkForIntersect(t,i),wr.vertEq(u.Org,t.event)&&(t.mesh.splice(n.Oprev,u),i=e.topLeftRegion(t,i),n=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),c),f=!0),wr.vertEq(p.Org,t.event)&&(t.mesh.splice(r,p.Oprev),r=e.finishLeftRegions(t,c,null),f=!0),f){e.addRightEdges(t,i,r.Onext,n,n,!0);return}wr.vertLeq(p.Org,u.Org)?s=p.Oprev:s=u,s=t.mesh.connect(r.Lprev,s),e.addRightEdges(t,i,s,s.Onext,s.Onext,!1),s.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i)},e.connectLeftDegenerate=function(t,i,r){var s,n,c,u,p;if(s=i.eUp,wr.vertEq(s.Org,r)){Lr(!1),e.spliceMergeVertices(t,s,r.anEdge);return}if(!wr.vertEq(s.Dst,r)){t.mesh.splitEdge(s.Sym),i.fixUpperEdge&&(t.mesh.delete(s.Onext),i.fixUpperEdge=!1),t.mesh.splice(r.anEdge,s),e.sweepEvent(t,r);return}Lr(!1),i=e.topRightRegion(i),p=e.regionBelow(i),c=p.eUp.Sym,n=u=c.Onext,p.fixUpperEdge&&(Lr(n!==c),e.deleteRegion(t,p),t.mesh.delete(c),c=n.Oprev),t.mesh.splice(r.anEdge,c),wr.edgeGoesLeft(n)||(n=null),e.addRightEdges(t,i,c.Onext,u,n,!0)},e.connectLeftVertex=function(t,i){var r,s,n,c,u,p,f=new ak;if(f.eUp=i.anEdge.Sym,r=t.dict.search(f).key,s=e.regionBelow(r),!!s){if(c=r.eUp,u=s.eUp,wr.edgeSign(c.Dst,i,c.Org)===0){e.connectLeftDegenerate(t,r,i);return}if(n=wr.vertLeq(u.Dst,c.Dst)?r:s,r.inside||n.fixUpperEdge){if(n===r)p=t.mesh.connect(i.anEdge.Sym,c.Lnext);else{var x=t.mesh.connect(u.Dnext,i.anEdge);p=x.Sym}n.fixUpperEdge?e.fixUpperEdge(t,n,p):e.computeWinding(t,e.addRegionBelow(t,r,p)),e.sweepEvent(t,i)}else e.addRightEdges(t,r,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){e.connectLeftVertex(t,i);return}var s=e.topLeftRegion(t,r.activeRegion);Lr(s!==null);var n=e.regionBelow(s),c=n.eUp,u=e.finishLeftRegions(t,n,null);u.Onext===c?e.connectRightVertex(t,s,u):e.addRightEdges(t,s,u.Onext,c,c,!0)},e.addSentinel=function(t,i,r,s){var n=new ak,c=t.mesh.makeEdge();c.Org.s=r,c.Org.t=s,c.Dst.s=i,c.Dst.t=s,t.event=c.Dst,n.eUp=c,n.windingNumber=0,n.inside=!1,n.fixUpperEdge=!1,n.sentinel=!0,n.dirty=!1,n.nodeUp=t.dict.insert(n)},e.initEdgeDict=function(t){t.dict=new MPe(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],r=t.bmax[1]-t.bmin[1],s=t.bmin[0]-i,n=t.bmax[0]+i,c=t.bmin[1]-r,u=t.bmax[1]+r;e.addSentinel(t,s,n,c),e.addSentinel(t,s,n,u)},e.doneEdgeDict=function(t){for(var i,r=0;(i=t.dict.min().key)!==null;)i.sentinel||(Lr(i.fixUpperEdge),Lr(++r===1)),Lr(i.windingNumber===0),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,r,s,n=t.mesh.eHead;for(i=n.next;i!==n;i=r)r=i.next,s=i.Lnext,wr.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,s,i),t.mesh.delete(i),i=s,s=i.Lnext),s.Lnext===i&&(s!==i&&((s===r||s===r.Sym)&&(r=r.next),t.mesh.delete(s)),(i===r||i===r.Sym)&&(r=r.next),t.mesh.delete(i))},e.initPriorityQ=function(t){var i,r,s,n=0;for(s=t.mesh.vHead,r=s.next;r!==s;r=r.next)n++;for(n+=8,i=t.pq=new EPe(n,wr.vertLeq),s=t.mesh.vHead,r=s.next;r!==s;r=r.next)r.pqHandle=i.insert(r);return r!==s?!1:(i.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,i){var r,s,n;for(r=i.fHead.next;r!==i.fHead;r=s)s=r.next,n=r.anEdge,Lr(n.Lnext!==n),n.Lnext.Lnext===n&&(e.addWinding(n.Onext,n),t.mesh.delete(n));return!0},e.computeInterior=function(t,i){i===void 0&&(i=!0);var r,s;if(e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);(r=t.pq.extractMin())!==null;){for(;s=t.pq.min(),!(s===null||!wr.vertEq(s,r));)s=t.pq.extractMin(),e.spliceMergeVertices(t,r.anEdge,s.anEdge);e.sweepEvent(t,r)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),e.removeDegenerateFaces(t,t.mesh)?(i&&t.mesh.check(),!0):!1},e}(),APe=function(){function e(){this.mesh=new m$,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=ps.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},e.prototype.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.prototype.longAxis_=function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},e.prototype.computeNormal_=function(t){var i,r,s,n,c,u,p=[0,0,0],f=[0,0,0],x=[0,0,0],w=[0,0,0],E=[0,0,0],A=[null,null,null],I=[null,null,null],P=this.mesh.vHead;i=P.next;for(var O=0;O<3;++O)n=i.coords[O],f[O]=n,I[O]=i,p[O]=n,A[O]=i;for(i=P.next;i!==P;i=i.next)for(var k=0;k<3;++k)n=i.coords[k],n<f[k]&&(f[k]=n,I[k]=i),n>p[k]&&(p[k]=n,A[k]=i);var U=0;if(p[1]-f[1]>p[0]-f[0]&&(U=1),p[2]-f[2]>p[U]-f[U]&&(U=2),f[U]>=p[U]){t[0]=0,t[1]=0,t[2]=1;return}for(u=0,r=I[U],s=A[U],x[0]=r.coords[0]-s.coords[0],x[1]=r.coords[1]-s.coords[1],x[2]=r.coords[2]-s.coords[2],i=P.next;i!==P;i=i.next)w[0]=i.coords[0]-s.coords[0],w[1]=i.coords[1]-s.coords[1],w[2]=i.coords[2]-s.coords[2],E[0]=x[1]*w[2]-x[2]*w[1],E[1]=x[2]*w[0]-x[0]*w[2],E[2]=x[0]*w[1]-x[1]*w[0],c=E[0]*E[0]+E[1]*E[1]+E[2]*E[2],c>u&&(u=c,t[0]=E[0],t[1]=E[1],t[2]=E[2]);u<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(x)]=1)},e.prototype.checkOrientation_=function(){for(var t=this.mesh.fHead,i,r=this.mesh.vHead,s,n=0,c=t.next;c!==t;c=c.next)if(s=c.anEdge,!(s.winding<=0))do n+=(s.Org.s-s.Dst.s)*(s.Org.t+s.Dst.t),s=s.Lnext;while(s!==c.anEdge);if(n<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var t=this.mesh.vHead,i=[0,0,0],r,s,n=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),n=!0),r=this.sUnit,s=this.tUnit;var c=this.longAxis_(i);r[c]=0,r[(c+1)%3]=1,r[(c+2)%3]=0,s[c]=0,s[(c+1)%3]=0,s[(c+2)%3]=i[c]>0?1:-1;for(var u=t.next;u!==t;u=u.next)u.s=this.dot_(u.coords,r),u.t=this.dot_(u.coords,s);n&&this.checkOrientation_();for(var p=!0,f=t.next;f!==t;f=f.next)p?(this.bmin[0]=this.bmax[0]=f.s,this.bmin[1]=this.bmax[1]=f.t,p=!1):(f.s<this.bmin[0]&&(this.bmin[0]=f.s),f.s>this.bmax[0]&&(this.bmax[0]=f.s),f.t<this.bmin[1]&&(this.bmin[1]=f.t),f.t>this.bmax[1]&&(this.bmax[1]=f.t))},e.prototype.addWinding_=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,i){var r,s;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;wr.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;wr.vertLeq(r.Org,r.Dst);r=r.Lnext);s=r.Lprev;for(var n=void 0;r.Lnext!==s;)if(wr.vertLeq(r.Dst,s.Org)){for(;s.Lnext!==r&&(wr.edgeGoesLeft(s.Lnext)||wr.edgeSign(s.Org,s.Dst,s.Lnext.Dst)<=0);)n=t.connect(s.Lnext,s),s=n.Sym;s=s.Lprev}else{for(;s.Lnext!==r&&(wr.edgeGoesRight(r.Lprev)||wr.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)n=t.connect(r,r.Lprev),r=n.Sym;r=r.Lnext}if(s.Lnext===r)throw"Mono region invalid";for(;s.Lnext.Lnext!==r;)n=t.connect(s.Lnext,s),s=n.Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(t,r))return!1;return!0},e.prototype.discardExterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)i=r.next,r.inside||t.zapFace(r)},e.prototype.setWindingNumber_=function(t,i,r){for(var s,n=t.eHead.next;n!==t.eHead;n=s)s=n.next,n.Rface.inside!==n.Lface.inside?n.winding=n.Lface.inside?i:-i:r?t.delete(n):n.winding=0},e.prototype.getNeighbourFace_=function(t){return!t.Rface||!t.Rface.inside?-1:t.Rface.n},e.prototype.outputPolymesh_=function(t,i,r,s){var n,c=0,u=0,p;r>3&&t.mergeConvexFaces(r);for(var f=t.vHead.next;f!==t.vHead;f=f.next)f.n=-1;for(var x=t.fHead.next;x!==t.fHead;x=x.next)if(x.n=-1,!!x.inside){n=x.anEdge,p=0;do{var f=n.Org;f.n===-1&&(f.n=u,u++),p++,n=n.Lnext}while(n!==x.anEdge);if(p>r)throw"Face vertex greater that support polygon";x.n=c,++c}this.elementCount=c,i===Mo.CONNECTED_POLYGONS&&(c*=2),this.elements=[],this.elements.length=c*r,this.vertexCount=u,this.vertices=[],this.vertices.length=u*s,this.vertexIndices=[],this.vertexIndices.length=u;for(var f=t.vHead.next;f!==t.vHead;f=f.next)if(f.n!==-1){var w=f.n*s;this.vertices[w+0]=f.coords[0],this.vertices[w+1]=f.coords[1],s>2&&(this.vertices[w+2]=f.coords[2]),this.vertexIndices[f.n]=f.idx}for(var E=0,x=t.fHead.next;x!==t.fHead;x=x.next)if(x.inside){n=x.anEdge,p=0;do{var f=n.Org;this.elements[E++]=f.n,p++,n=n.Lnext}while(n!==x.anEdge);for(var A=p;A<r;++A)this.elements[E++]=-1;if(i===Mo.CONNECTED_POLYGONS){n=x.anEdge;do this.elements[E++]=this.getNeighbourFace_(n),n=n.Lnext;while(n!==x.anEdge);for(var I=p;I<r;++I)this.elements[E++]=-1}}},e.prototype.outputContours_=function(t,i){var r,s,n=0,c=0;this.vertexCount=0,this.elementCount=0;for(var u=t.fHead.next;u!==t.fHead;u=u.next)if(u.inside){s=r=u.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==s);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var p=0,f=0,x=0;n=0;for(var u=t.fHead.next;u!==t.fHead;u=u.next)if(u.inside){c=0,s=r=u.anEdge;do this.vertices[p++]=r.Org.coords[0],this.vertices[p++]=r.Org.coords[1],i>2&&(this.vertices[p++]=r.Org.coords[2]),this.vertexIndices[f++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,c++,r=r.Lnext;while(r!==s);this.elements[x++]=n,this.elements[x++]=c,n+=c}},e.prototype.addContour=function(t,i){this.mesh===null&&(this.mesh=new m$),t<2&&(t=2),t>3&&(t=3);for(var r=null,s=0;s<i.length;s+=t)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[s+0],r.Org.coords[1]=i[s+1],t>2?r.Org.coords[2]=i[s+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},e.prototype.tesselate=function(t,i,r,s,n,c){if(t===void 0&&(t=ps.ODD),i===void 0&&(i=Mo.POLYGONS),c===void 0&&(c=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,n&&(this.normal[0]=n[0],this.normal[1]=n[1],this.normal[2]=n[2]),this.windingRule=t,s<2&&(s=2),s>3&&(s=3),!this.mesh)return!1;this.projectPolygon_(),TPe.computeInterior(this,c);var u=this.mesh;return i===Mo.BOUNDARY_CONTOURS?this.setWindingNumber_(u,1,!0):this.tessellateInterior_(u),c&&u.check(),i===Mo.BOUNDARY_CONTOURS?this.outputContours_(u,s):this.outputPolymesh_(u,i,r,s),!0},e}();function um(e){var t=e.windingRule,i=t===void 0?ps.ODD:t,r=e.elementType,s=r===void 0?Mo.POLYGONS:r,n=e.polySize,c=n===void 0?3:n,u=e.vertexSize,p=u===void 0?2:u,f=e.normal,x=f===void 0?[0,0,1]:f,w=e.contours,E=w===void 0?[]:w,A=e.strict,I=A===void 0?!0:A,P=e.debug,O=P===void 0?!1:P;if(!E&&I)throw new Error("Contours can't be empty");if(E){var k=new APe;e.edgeCreateCallback&&(k.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(k.vertexIdCallback=e.vertexIdCallback);for(var U=0;U<E.length;U++)k.addContour(p||2,E[U]);return k.tesselate(i,s,c,p,x,I),{vertices:k.vertices,vertexIndices:k.vertexIndices,vertexCount:k.vertexCount,elements:k.elements,elementCount:k.elementCount,mesh:O?k.mesh:void 0}}}var MYe=ps.ODD,TYe=ps.NONZERO,AYe=ps.POSITIVE,CYe=ps.NEGATIVE,DYe=ps.ABS_GEQ_TWO,IYe=Mo.POLYGONS,PYe=Mo.CONNECTED_POLYGONS,RYe=Mo.BOUNDARY_CONTOURS,AB=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`);let i=e*AB.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,s=0;this.positions=new Float32Array(this.buffer,s*r,3*e),s+=3*e,this.normals=new Float32Array(this.buffer,s*r,3*e),s+=3*e,this.uvs=new Float32Array(this.buffer,s*r,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity} \u2192 ${e}`);let i=e*AB.eSize,r=new ArrayBuffer(i),s=Float32Array.BYTES_PER_ELEMENT,n=0,c=new Float32Array(r,n*s,3*e);n+=3*e;let u=new Float32Array(r,n*s,3*e);n+=3*e;let p=new Float32Array(r,n*s,2*e);t?(c.set(this.positions.subarray(0,this.size*3)),u.set(this.normals.subarray(0,this.size*3)),p.set(this.uvs.subarray(0,this.size*2))):(c.set(this.positions),u.set(this.normals),p.set(this.uvs)),this.buffer=r,this.positions=c,this.normals=u,this.uvs=p,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let r=this.capacity;for(;t>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} \u2192 ${this.size}`),this.realloc(this.size,!0)}},gee=AB;gee.eSize=8*Float32Array.BYTES_PER_ELEMENT;var CPe=Dp(Rme()),aU={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},yee={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},vee={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},lk=(e,t)=>([i,r])=>(r<i&&(r+=t),(e>=i?e:e+t)<=r),lU=class extends fr{constructor(e,t,i=0,r=12,s=3,n=ps.ODD,c=!1){super(),this.forPathBevel=c,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._curveSegments=r,this._bevelSegmentsInput=s;let u=this._shape.extractShapePointsToFlatArray([],r),p=this._shape.shapeHoles.map(ee=>{let oe=ee.extractShapePointsToFlatArray([],r),le=[];for(let ve=oe.length-1;ve>=1;ve-=2){let we=oe[ve-1],fe=oe[ve-0];le.push(we,fe)}return le}),f=[],x=[];for(let ee=0;ee<u.length;ee+=2)x.push([u[ee],u[ee+1]]);f.push(x);for(let ee=0;ee<p.length;ee++){let oe=p[ee],le=[];for(let ve=0;ve<oe.length;ve+=2)le.push([oe[ve],oe[ve+1]]);f.push(le)}let w;e.isText?w=new OK().setFromPoints(e.points.map(ee=>ee.position)).getSize(new lt).length()*.1:f[0].length===0?w=i:w=(0,CPe.default)(f).distance,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,w,t/2),this._bevelSegments=Math.floor(s));let E;try{E=um({windingRule:n,elementType:Mo.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[u]})}catch{E=aU}let A;try{A=um({windingRule:ps.ODD,elementType:Mo.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...p]})}catch{A=yee}if(!E)throw new Error("error generating geometry");let I=E.elementCount;if(A){E.elementCount+=A.elementCount;for(let ee=0;ee<A.elements.length;ee++){let oe=A.elements[ee],le=ee%2===0?E.vertexCount:0;E.elements.push(oe+le)}for(let ee=0;ee<A.vertexIndices.length;ee++){let oe=A.vertexIndices[ee],le=E.vertexCount;E.vertexIndices.push(oe+le)}for(let ee=0;ee<A.vertices.length;ee++){let oe=A.vertices[ee];E.vertices.push(oe)}}let P=1/0,O=-1/0,k=1/0,U=-1/0;for(let ee=0,oe=E.vertexCount;ee<oe;ee++){let le=ee*2,ve=E.vertices[le+0],we=E.vertices[le+1];ve<P&&(P=ve),ve>O&&(O=ve),we<k&&(k=we),we>U&&(U=we)}this._minX=P,this._minY=k,this._width=O-P,this._height=U-k,this._buffer=new gee(this._computeBufferEstimatedSize(E));let j=[],V=[];for(let ee=E.elementCount-1;ee>=0;ee--){let oe=ee>=I,le=ee*2,ve=E.elements[le+0],we=E.elements[le+1],fe=ve+we,Ue={start:ve,count:we,normals:[],continuous:[],concave:[]},Fe=ve,Pe=fe-1,Ae=ve+1,et=this._shape.roundedCurves.length;do{let ot=Fe-ve,xt=E.vertices[Pe*2+0],Xe=E.vertices[Pe*2+1],kt=E.vertices[Fe*2+0],yt=E.vertices[Fe*2+1],Nt=E.vertices[Ae*2+0],Mt=E.vertices[Ae*2+1],li=kt-xt,Qt=yt-Xe,Wt=Math.sqrt(li*li+Qt*Qt);li/=Wt,Qt/=Wt;let Di=kt-Nt,Ii=yt-Mt,Li=Math.sqrt(Di*Di+Ii*Ii);Di/=Li,Ii/=Li,Ue.normals[ot*2+0]=-Ii,Ue.normals[ot*2+1]=Di,Ue.concave[ot]=li*Ii-Qt*Di>0;let $t=E.vertexIndices[Fe];if(Array.isArray($t))Ue.continuous[ot]=!1;else{let[Ut,wi]=this._shape.getCurveIndexFromVertexId($t-1,!0);if(wi>0&&wi<1)Ue.continuous[ot]=!0;else{let Hi=wi===1?Ut+1:Ut-1;Hi=(Hi+et)%et;let lr=wi===1?0:1,Ke=this._shape.roundedCurves[Ut].getTangent(wi),Re=this._shape.roundedCurves[Hi].getTangent(lr);Ue.continuous[ot]=Ke.dot(Re)>.95}}oe&&(Ue.normals[ot*2+0]*=-1,Ue.normals[ot*2+1]*=-1),[Pe,Fe,Ae]=[Fe,Ae,Ae+1],Ae>=fe&&(Ae-=we)}while(Ae!==ve+1);let $e=[];$e.push({bevelI:0,angle:0,size:0,boundary:{vertices:E.vertices.slice(ve*2,fe*2),vertexCount:we,vertexIndices:new Array(we).fill(!0).map((ot,xt)=>[xt,xt]),elements:[0,we],elementCount:1,mesh:null},reverseMap:[],insetPoints:E.vertices.slice(ve*2,fe*2)});let rt=0;for(let ot=1;ot<=this._bevelSegments;ot++){let xt=ot/this._bevelSegments*Math.PI/2,Xe=(1-Math.cos(xt))*this._bevel,kt=[],yt=[],Nt=[],Mt=[],li=0;for(let Wt=0;Wt<we;Wt++){let Di=Wt*2,Ii=(Wt-1+we)%we*2,Li=E.vertices[Ue.start*2+Di+0],$t=E.vertices[Ue.start*2+Di+1],Ut=-Ue.normals[Ii+0]*Xe,wi=-Ue.normals[Ii+1]*Xe,Hi=-Ue.normals[Di+0]*Xe,lr=-Ue.normals[Di+1]*Xe;if(Ue.concave[Wt]||!Ue.concave[Wt]&&oe){let Ke=Math.atan2(wi,Ut),Re=Math.atan2(lr,Hi);Re>Ke&&(Re-=Math.PI*2);let Lt=Re-Ke;if(Ue.continuous[Wt]||oe){let pi=Ke+Lt/2,Ee=Math.cos(pi)*Xe,Zt=Math.sin(pi)*Xe;kt[2*li+0]=Li+Ee*(oe?-1:1),kt[2*li+1]=$t+Zt*(oe?-1:1),Mt[li]=Wt,li++}else{let pi=Math.max(1,Math.floor(r/4*Math.abs(Lt)/Math.PI));for(let Ee=0;Ee<=pi;Ee++){let Zt=Ke+Lt*(Ee/pi),Xi=Math.cos(Zt)*Xe,Pi=Math.sin(Zt)*Xe;kt[2*li+0]=Li+Xi,kt[2*li+1]=$t+Pi,Mt[li]=Wt,li++}}}else kt[2*li+0]=Li+Ut,kt[2*li+1]=$t+wi,Mt[li]=Wt,yt[Wt]=li,li++,kt[2*li+0]=Li,kt[2*li+1]=$t,Mt[li]=Wt,li++,kt[2*li+0]=Li+Hi,kt[2*li+1]=$t+lr,Mt[li]=Wt,Nt[Wt]=li,li++}let Qt=um({windingRule:ps.POSITIVE,elementType:Mo.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[kt],edgeCreateCallback:Wt=>{let Di=Wt.Org.idx,Ii=Mt[Di],Li=Mt[(Di+1)%Mt.length];Wt.idx=[Ii,Li],Wt.Sym.idx=[Li,Ii]},vertexIdCallback:Wt=>{let Di=Wt.Lprev.idx;return[Di?Di[1]:0,Wt.idx?Wt.idx[0]:0]}});if(!Qt)throw console.log("Error"),new Error(`error generating bevel geometry for ${ot}'th loop`);if(!Qt.vertexCount){let Wt=(ot-1)/this._bevelSegments*Math.PI/2;rt=(1-Math.sin(Wt))*this._bevel;break}for(let Wt=0;Wt<Qt.vertexIndices.length;Wt++){let[Di,Ii]=Qt.vertexIndices[Wt];if(Di===Ii)continue;let Li=Ii;Ii<Di&&(Li+=we);for(let $t=Di;$t<Li;$t++){let Ut=$t%we,wi=($t+1)%we;if(!Ue.continuous[Ut]||!Ue.continuous[wi]){Qt.vertexIndices[Wt]=[Di,Ut],Qt.vertexIndices.splice(Wt+1,0,[wi,Ii]),Qt.vertices.splice((Wt+1)*2,0,Qt.vertices[Wt*2],Qt.vertices[Wt*2+1]);break}}}$e.push({bevelI:ot,angle:xt,size:Xe,boundary:Qt,reverseMap:Mt,insetPoints:kt})}let Je=(ot,xt,Xe)=>{let kt=0,yt=ot.boundary.vertexIndices.length;for(;kt<yt&&Xe(ot.boundary.vertexIndices[xt]);)xt=(xt+1)%yt,kt++;return kt},bt=j.length;for(let ot=1;ot<$e.length;ot++){let xt=$e[ot-1],Xe=$e[ot],kt=xt.boundary.vertexIndices.length,yt=Xe.boundary.vertexIndices.length;if(!kt||!yt)break;let Nt=Ue.concave.length,Mt=0,li=lk(Mt,we);for(;!xt.boundary.vertexIndices.filter(li).length||!Xe.boundary.vertexIndices.filter(li).length;)Mt++,li=lk(Mt,we);let Qt=xt.boundary.vertexIndices.findIndex(li),Wt=Xe.boundary.vertexIndices.findIndex(li);do Qt=(Qt+1)%kt;while(li(xt.boundary.vertexIndices[Qt]));do Wt=(Wt+1)%yt;while(li(Xe.boundary.vertexIndices[Wt]));Mt=(Mt+1)%we;let Di=Mt,Ii=0,Li=this._buildBevelVert(Ue,xt,(Qt-1+kt)%kt,void 0,Ii),$t=this._buildBevelVert(Ue,Xe,(Wt-1+yt)%yt,void 0,Ii),Ut=Li,wi=$t,Hi,lr,Ke=!1;do{Ii=(Mt||Nt)/Nt,li=lk(Mt,we);let Re=Je(xt,Qt,li),Lt=Je(Xe,Wt,li),pi=Ke;if(Ke=!1,Re&&!Lt){for(let Ee=0;Ee<Re;Ee++)Hi=this._buildBevelVert(Ue,xt,(Qt+Ee)%kt,Ee/(Re-1),Ii),j.push(Ut.topN,Hi.topP,wi.topN),c===!1&&j.push(Hi.bottomP,Ut.bottomN,wi.bottomN),Ut=Hi;Ke=!0}else if(!Re&&Lt)for(let Ee=0;Ee<Lt;Ee++)lr=this._buildBevelVert(Ue,Xe,(Wt+Ee)%yt,Ee/(Lt-1),Ii),j.push(wi.topN,Ut.topP,lr.topP),c===!1&&j.push(Ut.bottomP,wi.bottomN,lr.bottomP),wi=lr;else if(Re&&Lt)if(Hi=this._buildBevelVert(Ue,xt,Qt,0,Ii),lr=this._buildBevelVert(Ue,Xe,Wt,0,Ii),pi?(j.push(Ut.topN,lr.topP,wi.topN),j.push(Ut.topN,Hi.topP,lr.topP),c===!1&&(j.push(lr.bottomP,Ut.bottomN,wi.bottomN),j.push(lr.bottomP,Hi.bottomP,Ut.bottomN))):(j.push(wi.topN,Ut.topN,Hi.topP),j.push(wi.topN,Hi.topP,lr.topP),c===!1&&(j.push(Hi.bottomP,Ut.bottomN,wi.bottomN),j.push(Hi.bottomP,wi.bottomN,lr.bottomP))),Ut=Hi,wi=lr,Re===Lt)for(let Ee=1;Ee<Re;Ee++)Hi=this._buildBevelVert(Ue,xt,(Qt+Ee)%kt,Ee/(Re-1),Ii),lr=this._buildBevelVert(Ue,Xe,(Wt+Ee)%yt,Ee/(Lt-1),Ii),j.push(Ut.topN,Hi.topP,wi.topN),j.push(wi.topN,Hi.topP,lr.topP),c===!1&&(j.push(Hi.bottomP,Ut.bottomN,wi.bottomN),j.push(Hi.bottomP,wi.bottomN,lr.bottomP)),Ut=Hi,wi=lr;else if(Re>Lt){let Ee=Re/Lt,Zt=0;for(let Xi=1;Xi<Re;Xi++)Hi=this._buildBevelVert(Ue,xt,(Qt+Xi)%kt,Xi/(Re-1),Ii),j.push(Ut.topN,Hi.topP,wi.topN),c===!1&&j.push(Hi.bottomP,Ut.bottomN,wi.bottomN),Ut=Hi,Xi>(Zt+1)*Ee&&(Zt++,lr=this._buildBevelVert(Ue,Xe,(Wt+Zt)%yt,Zt/(Lt-1),Ii),j.push(wi.topN,Hi.topP,lr.topP),c===!1&&j.push(Hi.bottomP,wi.bottomN,lr.bottomP),wi=lr)}else{let Ee=Lt/Re,Zt=0;for(let Xi=1;Xi<Lt;Xi++)lr=this._buildBevelVert(Ue,Xe,(Wt+Xi)%yt,Xi/(Lt-1),Ii),j.push(wi.topN,Hi.topP,lr.topP),c===!1&&j.push(Hi.bottomP,wi.bottomN,lr.bottomP),wi=lr,Xi>(Zt+1)*Ee&&(Zt++,Hi=this._buildBevelVert(Ue,xt,(Qt+Zt)%kt,Zt/(Re-1),Ii),j.push(Ut.topN,Hi.topP,wi.topN),c===!1&&j.push(Hi.bottomP,Ut.bottomN,wi.bottomN),Ut=Hi)}Qt=(Qt+Re)%kt,Wt=(Wt+Lt)%yt,Mt=(Mt+1)%Nt}while(Mt!==Di)}if(c===!1&&this._depth>this._bevel*2&&this._buildWall($e,Ue,j),oe){let ot=[];for(let xt=j.length-1;xt>=bt+2;xt-=3){let Xe=j[xt-2],kt=j[xt-1],yt=j[xt-0];ot.push(yt,kt,Xe)}j.splice(bt,j.length-bt,...ot)}if(oe){let ot=[];for(let xt=$e[$e.length-1].boundary.vertices.length-1;xt>=1;xt-=2){let Xe=$e[$e.length-1].boundary.vertices[xt-1],kt=$e[$e.length-1].boundary.vertices[xt-0];ot.push(Xe,kt)}V.push(ot)}if(!oe){let ot=$e[$e.length-1],xt;try{xt=um({windingRule:$e.length>1?ps.POSITIVE:ps.ODD,elementType:Mo.POLYGONS,vertexSize:2,strict:!0,contours:[ot.insetPoints,...V]})}catch{xt=vee}if(!xt)throw new Error("Error generating geometry for surface");p.length===0&&this._bevel<w&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let Xe=0;Xe<xt.elementCount*3;Xe+=3){let kt=this._buildSurfaceVert(xt,xt.elements[Xe+0],rt),yt=this._buildSurfaceVert(xt,xt.elements[Xe+1],rt),Nt=this._buildSurfaceVert(xt,xt.elements[Xe+2],rt);j.push(kt.top,yt.top,Nt.top),c===!1&&j.push(Nt.bottom,yt.bottom,kt.bottom)}}this.vertexCache={}}this._buffer.shrink();let $=new Fr(Uint32Array.from(j),1),Y=new Fr(this._buffer.positions,3),J=new Fr(this._buffer.normals,3),X=new Fr(this._buffer.uvs,2);Y.needsUpdate=!0,J.needsUpdate=!0,X.needsUpdate=!0,$.needsUpdate=!0,this.setAttribute("position",Y),this.setAttribute("normal",J),this.setAttribute("uv",X),this.setIndex($)}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let s=0,n=r.boundary.vertexCount;s<n;s++){let c=this._buildBevelVert(t,r,s),u=this._buildBevelVert(t,r,(s+1)%n);i.push(u.topP,c.topN,c.bottomN),i.push(u.topP,c.bottomN,u.bottomP)}}_buildSurfaceVert(e,t,i){let r=t.toString();if(r in this.vertexCache)return this.vertexCache[r];let s=e.vertices[t*2+0],n=e.vertices[t*2+1],c=(s-this._minX)/this._width,u=(n-this._minY)/this._height;this.forPathBevel&&(u=1);let p=this._buffer.get(this.forPathBevel?1:2),f=p*3,x=p*2,w={top:p+0,bottom:p+1};return this._buffer.positions[f+0]=s,this._buffer.positions[f+1]=n,this._buffer.positions[f+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[f+0]=0,this._buffer.normals[f+1]=0,this._buffer.normals[f+2]=1,this._buffer.uvs[x+0]=c,this._buffer.uvs[x+1]=u,this.forPathBevel===!1&&(this._buffer.positions[f+3]=s,this._buffer.positions[f+4]=n,this._buffer.positions[f+5]=i,this._buffer.normals[f+3]=0,this._buffer.normals[f+4]=0,this._buffer.normals[f+5]=-1,this._buffer.uvs[x+2]=c,this._buffer.uvs[x+3]=u),this.vertexCache[r]=w,w}_buildBevelVert(e,t,i,r=1,s){let n=`${t.bevelI}:${i}`;if(n in this.vertexCache&&s!==0&&s!==1&&(!s||s===this.vertexCache[n].pathBevelUCoord))return this.vertexCache[n];let[c,u]=t.boundary.vertexIndices[i],p,f,x,w;c!==u?(f=c,p=u,w=!1,x=e.continuous[f]&&e.continuous[p]):(p=c,f=(p-1+e.count)%e.count,w=e.concave[p]&&t.bevelI>0,x=e.continuous[p]||w);let E=Math.cos(t.angle),A=Math.sin(t.angle),I=i*2,P=p*2,O=f*2,k=t.boundary.vertices[I+0],U=t.boundary.vertices[I+1],j=(1-A)*this._bevel,V=(k-this._minX)/this._width,$=(U-this._minY)/this._height;this.forPathBevel&&(s!==void 0&&(V=s),$=1);let Y=e.normals[P+0],J=e.normals[P+1],X=e.normals[O+0],ee=e.normals[O+1];if(w){let fe=X-Y,Ue=ee-J;Y=Y+fe*(1-r),J=J+Ue*(1-r);let Fe=Math.sqrt(Y*Y+J*J);Y/=Fe,J/=Fe}let oe=this.forPathBevel?this._buffer.get(x?1:2):this._buffer.get(x?2:4),le=oe*3,ve=oe*2,we={i,fi:p,topP:oe+0,topN:oe+0,bottomP:oe+1,bottomN:oe+1,pathBevelUCoord:s};return this._buffer.positions[le+0]=k,this._buffer.positions[le+1]=U,this._buffer.positions[le+2]=(this.forPathBevel?this._bevel:this._depth)-j,this._buffer.normals[le+0]=Y*E,this._buffer.normals[le+1]=J*E,this._buffer.normals[le+2]=A,this._buffer.uvs[ve+0]=V,this._buffer.uvs[ve+1]=$,this.forPathBevel===!1&&(this._buffer.positions[le+3]=k,this._buffer.positions[le+4]=U,this._buffer.positions[le+5]=j,this._buffer.normals[le+3]=Y*E,this._buffer.normals[le+4]=J*E,this._buffer.normals[le+5]=-A,this._buffer.uvs[ve+2]=$,this._buffer.uvs[ve+3]=V),x||(this.forPathBevel?(oe+=1,le+=3,ve+=2):(oe+=2,le+=6,ve+=4),we.topP=oe+0,we.bottomP=oe+1,this._buffer.positions[le+0]=k,this._buffer.positions[le+1]=U,this._buffer.positions[le+2]=(this.forPathBevel?this._bevel:this._depth)-j,this._buffer.normals[le+0]=X*E,this._buffer.normals[le+1]=ee*E,this._buffer.normals[le+2]=A,this._buffer.uvs[ve+0]=V,this._buffer.uvs[ve+1]=$,this.forPathBevel===!1&&(this._buffer.positions[le+3]=k,this._buffer.positions[le+4]=U,this._buffer.positions[le+5]=j,this._buffer.normals[le+3]=X*E,this._buffer.normals[le+4]=ee*E,this._buffer.normals[le+5]=-A,this._buffer.uvs[ve+2]=$,this._buffer.uvs[ve+3]=V)),this.vertexCache[n]=we,we}clone(){let e=new lU(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=CI(this.userData),e}},_ee=class extends fr{constructor(e,t=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=ps.ODD,this.elementType=Mo.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:ps.ODD,elementType:Mo.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),s=this._shape.shapeHoles.map(E=>E.extractShapePointsToFlatArray([],this._curveSegments)),n,c=!0,u=!0,p,f;for(let E=0,A=r.length/2;E<A;E++){let I=E*2,P=r[I+0],O=r[I+1];if(p!==void 0&&P!==p&&(c=!1),f!==void 0&&O!==f&&(u=!1),p=P,f=O,!c&&!u)break}if(!c&&!u)try{n=um({contours:[r,...s],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{n=aU}let x=n?.vertexCount??1,w=n?.elementCount??1;if(this._positionAttribute=new Fr(new Float32Array(x*3),3),this._normalAttribute=new Fr(new Float32Array(x*3),3),this._uvAttribute=new Fr(new Float32Array(x*2),2),this._indexAttribute=new Fr(new Uint32Array(w*3),1),n){let E=1/0,A=-1/0,I=1/0,P=-1/0;for(let U=0,j=x;U<j;U++){let V=U*2,$=n.vertices[V+0],Y=n.vertices[V+1];$<E&&(E=$),$>A&&(A=$),Y<I&&(I=Y),Y>P&&(P=Y)}let O=A-E,k=P-I;for(let U=0,j=x;U<j;U++){let V=U*2,$=n.vertices[V+0],Y=n.vertices[V+1],J=($-E)/O,X=(Y-I)/k;this._positionAttribute.setXYZ(U,$,Y,0),this._normalAttribute.setXYZ(U,0,0,1),this._uvAttribute.setXY(U,J,X)}for(let U=0,j=w;U<j;U++){let V=U*3,$=n.elements[V+0],Y=n.elements[V+1],J=n.elements[V+2];this._indexAttribute.setX(V+0,$),this._indexAttribute.setX(V+1,Y),this._indexAttribute.setX(V+2,J)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,(n?.elementCount??1)*3)}clone(){let e=new _ee(this._shape,this._curveSegments);return e.userData=CI(this.userData),e}},xee=class extends lU{constructor(e,t,i=0,r=12,s=3,n=ps.ODD){super(e,t,i,r,s,n),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let s=0,n=r.boundary.vertexCount;s<n;s++){let c=this._buildBevelVert(t,r,s),u=this._buildBevelVert(t,r,(s+1)%n);i.push(u.topP,c.topN,c.bottomN),i.push(u.topP,c.bottomN,u.bottomP)}}clone(){let e=new xee(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=CI(this.userData),e}},Xy=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:ps.ODD},e.parameters),r=Math.abs(i.width),s=Math.abs(i.height??i.width),n=Math.abs(i.depth??0),c=e.shape??t?.shape,u=c?.roundness??i.roundness;c!==void 0&&(c instanceof io?(c.width!==r||c.height!==s)&&c.applySize(r,s):c=new io(r,s).fromJSON(c),e.parameters?.roundness!==void 0&&e.parameters?.roundness>0&&c.update());let p=c??new io(r,s);return{parameters:Object.assign(i,{width:r,height:s,depth:n,roundness:u}),shape:p}}static build(e){let{depth:t,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:s,roundness:n,windingRule:c}=e.parameters;e.shape.roundness=n;let u;return t<=0?u=new _ee(e.shape,s,{windingRule:c}):u=new xee(e.shape,t,i,s,r,c),Object.assign(u,{userData:pt(me({},e),{type:"VectorGeometry"})})}},bee=Math.PI*2,cU=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return i.angle=Yi.clamp(i.angle,0,360),{shape:e.shape&&e.shape instanceof io?e.shape:new io,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,angle:s,innerRadius:n,depth:c,extrudeBevelSize:u,extrudeBevelSegments:p}=e.parameters,f=e.shape,x=t*.5,w=i*.5,E=DPe(f,x,w,s*Math.PI/180,r,n);f.isClosed=!0,f.update();let A;return s===0?(A=new fr,A.setAttribute("position",new Vi([],3))):A=Xy.create({shape:f,parameters:{subdivisions:E,depth:c,extrudeBevelSize:u,extrudeBevelSegments:p}}),Object.assign(A,{userData:pt(me({},e),{type:"EllipseGeometry"})})}};function DPe(e,t,i,r,s,n){if(r>=bee)return s>30||s%4===0?(PPe(e,t,i,n),Math.round(s/4)):_$(e,r,s,t,i,n);r=Math.max(r,.001);let c={x:0,y:i},u=r+Math.PI*.5,p={x:Math.cos(u)*t,y:Math.sin(u)*i},f=SPe({px:c.x,py:c.y,cx:p.x,cy:p.y,rx:t,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return s>30||s%f.length===0?IPe(e,c.x,c.y,f,s,t,i,n):_$(e,r,s,t,i,n)}function IPe(e,t,i,r,s,n,c,u){let p=Math.round(s/r.length);e.addPoint(ex(t,i));for(let f=0,x=r.length;f<x;f++){let w=r[f],E=e.points[f],A=ex(w.x,w.y);E.controls[1].position.set(w.x1,w.y1),A.controls[0].position.set(w.x2,w.y2),e.addPoint(A)}return u>0?wee(e,n,c,u):e.addPoint(ex(0,0)),p}function _$(e,t,i,r,s,n){let c=-t/i;for(let u=0;u<=i;u++){let p=c*u,f=Math.sin(p)*r,x=Math.cos(p)*s;e.addPoint(ex(f,x))}return t<bee?n>0?wee(e,r,s,n):e.addPoint(ex(0,0)):(e.removePoint(e.points[e.points.length-1]),n>0&&See(e,r,s,n)),1}function PPe(e,t,i,r=0,s=0,n=0){let c=.5522847498,u=t*c,p=i*c;e.addPoint(_2(s-t,n,s-t,n-p,s-t,n+p)),e.addPoint(_2(s,n+i,s-u,n+i,s+u,n+i)),e.addPoint(_2(s+t,n,s+t,n+p,s+t,n-p)),e.addPoint(_2(s,n-i,s+u,n-i,s-u,n-i)),r>0&&See(e,t,i,r)}function ex(e,t){return new J_(Yi.generateUUID(),new lt(e,t))}function _2(e,t,i,r,s,n){let c=ex(e,t);return c.controls[0].position.set(i,r),c.controls[1].position.set(s,n),c}function wee(e,t,i,r){Eee(e,t,i,r).forEach(s=>e.addPoint(s))}function See(e,t,i,r){let s=Eee(e,t,i,r),n=new io;s.forEach(c=>n.addPoint(c)),n.isClosed=!0,e.shapeHoles.push(n)}function Eee(e,t,i,r){let s=r*t/100,n=s*(Math.abs(i)/Math.abs(t)),c=new lt(s/t,n/i),u=e.points.map(p=>{let f=p.clone();return f.uuid=Yi.generateUUID(),f}).reverse();return u.forEach(p=>{p.position.multiply(c);let f=p.controls[0].position.clone().multiply(c),x=p.controls[1].position.clone().multiply(c);p.controls[0].position.copy(x),p.controls[1].position.copy(f)}),u}var RPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),r=Math.abs(i.width),s=Math.abs(i.height??r),n=Math.abs(i.depth??r),c=Math.abs(Math.min(r,n))/2;return{parameters:Object.assign(i,{width:r,height:s,depth:n,radius:c,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:r,radius:s,revolutions:n,segments:c,pathRadius:u,pathType:p,pathSegments:f,cornerRadius:x,cornerSegments:w}=e.parameters,E=new Mee(!1,t,i,r,s,n,c,u,p,f,x,w);return Object.assign(E,{userData:pt(me({},e),{type:"HelixGeometry"})})}},ck=new X_([0,0,0],1),Mee=class extends fr{constructor(e=!0,t=1,i=1,r=1,s=1,n=1,c=1,u=1,p=1,f=1,x=1,w=1){if(super(),n===0)return;let E=e&&n===1;E&&(w=0),x>100&&(x=100),x===0&&(w=0);let A=()=>new se,I=new se,P=A(),O=A(),k=A(),U,j,V,$,Y,J,X,ee,oe=A(),le=A(),ve=A(),we=A(),fe=A(),Ue=A(),Fe=A(),Pe=A(),Ae=i-2*u+.001,et=Ae/n,$e=Math.ceil(c*n),rt=$e+1,Je=Ae/$e,bt=-Ae/2,ot=f+1,xt=2*Math.PI/f,Xe=Math.PI/2/w,kt=.01,yt=Math.min((1-x/100)*u,u-kt),Nt=u-yt,Mt=0,li=2,Qt=w*li+li,Wt=ot*Qt/li,Di=Wt+ot*rt,Ii=Math.max(0,ot*(rt+Qt)),[Li,$t,Ut]=[3,3,2].map(vi=>Array(Ii*vi).fill(0)),wi=[],Hi=s-u;function lr(vi,ki){let Jt=Math.PI/2;J=ki*Je,ee=2*Math.PI*(J%et)/et+Jt,J+=bt,X=Math.sin(ee)*Hi,Y=Math.cos(ee)*Hi,e?vi.set(Y,X,J):vi.set(Y,J,X)}lr(I,-1e-10),lr(P,0),oe.copy(I),lr(I,1);let Ke=I.distanceTo(P),Re=E?0:Nt+yt,Lt=Ke*$e+2*Re,pi=yt,Ee=Lt-Re;for(let vi=0;vi<=$e;vi++){lr(O,vi),Pe.subVectors(O,oe).normalize(),oe.copy(O),Ue.copy(O).setComponent(+e+1,0).normalize(),Fe.crossVectors(Pe,Ue).normalize();let ki=vi===0,Jt=vi===$e,mr=ki?3*Math.PI/2:Xe,$i=ki?pi:Ee,Hr=ki?ot:Di,Sn=ki?0:Ii-ot,kr=Pe.clone().multiplyScalar(ki?-Nt:Nt).add(O),wt=Pe.clone().multiplyScalar(ki?-1:1).normalize();for(let Yt=0;Yt<ot;Yt++){let yi=Yt*xt;if(le.addVectors(I.copy(Ue).multiplyScalar(u*Math.cos(yi)),P.copy(Fe).multiplyScalar(u*Math.sin(yi))),ve.copy(le).normalize(),ki||Jt){E||(Mt=Sn+Yt,[0,1,2].forEach(Ai=>{Li[Mt*3+Ai]=kr.getComponent(Ai),$t[Mt*3+Ai]=wt.getComponent(Ai)}),Ut[Mt*2]=+Jt,Ut[Mt*2+1]=Yt/f),P.copy(ve).multiplyScalar(yt),k.addVectors(O,P);for(let Ai=0;Ai<w;Ai++){let ir=Ai*Xe+mr;we.addVectors(I.copy(Pe).multiplyScalar(Nt*Math.sin(ir)),P.copy(ve).multiplyScalar(Nt*Math.cos(ir))),fe.copy(we).normalize(),P.addVectors(k,we),we.normalize(),Mt=Hr+Ai*ot+Yt,[0,1,2].forEach(Rn=>{Li[Mt*3+Rn]=P.getComponent(Rn),$t[Mt*3+Rn]=fe.getComponent(Rn)});let dr=+ki+Math.sin(ir);Ut[Mt*2]=($i+Nt*dr)/Lt,Ut[Mt*2+1]=Yt/f}}P.addVectors(O,le),Mt=Wt+vi*ot+Yt,[0,1,2].forEach(Ai=>{Li[Mt*3+Ai]=P.getComponent(Ai),$t[Mt*3+Ai]=ve.getComponent(Ai)}),Ut[Mt*2]=(Re+vi*Ke)/Lt,Ut[Mt*2+1]=Yt/f}}let Zt=rt+2*w+li,Xi=1,[Pi,si]=[+E,Zt-1];for(let vi=Pi;vi<=si-1;vi++){let ki=E&&vi===si-1;for(let Jt=0;Jt<ot-1;Jt++)U=vi*ot+Jt,j=U+1,V=(ki?Jt:U)+ot,$=(ki?Jt+1:j)+ot,vi===0?wi.push(j,$,V):vi===Zt-2?wi.push(U,j,V):wi.push(U,j,V,j,$,V)}this.setIndex(wi),this.setAttribute("position",new Vi(Li,3)),this.setAttribute("normal",new Vi($t,3)),this.setAttribute("uv",new Vi(Ut,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e=this.userData.parameters,t=Math.ceil(e.tubularSegments),i=e.radialSegments+1,r=Array.from(this.getIndex().array),s,n,c,u,p=6*(t-1)*e.radialSegments,f=t,x=f===t;for(let w=0;w<e.radialSegments;w++)s=f*i+w,n=s+1,c=(x?w:s)+i,u=(x?w+1:n)+i,r[p++]=s,r[p++]=n,r[p++]=c,r[p++]=n,r[p++]=u,r[p++]=c;return r.length=p,ck.array=r,ck.count=r.length,ck}},OPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:s,corner:n,cornerSides:c}=e.parameters,u=s===0&&n!==0?new Tee(t*.5,n,c):new wK(t*.5,s);return u.scale(1,i/t,r/t),Object.assign(u,{userData:pt(me({},e),{type:"IcosahedronGeometry"})})}},Tee=class extends nU{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,s=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],c="IcosahedronGeometry";super(s,n,c,e,t,i),this.type=c}static fromJSON(e){return new Tee(e.radius,e.corner,e.cornerSides)}},LPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){(e.parameters?.points??[]).forEach(r=>{Array.isArray(r)&&(r.x=r[0],r.y=r[1])});let i=Object.assign({},t?.parameters??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:r}=e.parameters,s=new wD;s.moveTo(t[0].x,t[0].y),s.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let n=new gK(s.extractPoints(r).shape,i);return n.rotateZ(Math.PI),Object.assign(n,{userData:pt(me({},e),{type:"LatheGeometry"})})}},Oh=new mi,uk=new ls,x2=new se,sI=class extends za{constructor(){super(),this.uuid=Yi.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new Ao().getNormalMatrix(e);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(e);for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i];s.normal.applyMatrix3(t).normalize();for(let n=0,c=s.vertexNormals.length;n<c;n++)s.vertexNormals[n].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return Oh.makeRotationX(e),this.applyMatrix4(Oh),this}rotateY(e){return Oh.makeRotationY(e),this.applyMatrix4(Oh),this}rotateZ(e){return Oh.makeRotationZ(e),this.applyMatrix4(Oh),this}translate(e,t,i){return Oh.makeTranslation(e,t,i),this.applyMatrix4(Oh),this}scale(e,t,i){return Oh.makeScale(e,t,i),this.applyMatrix4(Oh),this}lookAt(e){return uk.lookAt(e),uk.updateMatrix(),this.applyMatrix4(uk.matrix),this}fromBufferGeometry(e){let t=this,i=e.index!==null?e.index:void 0,r=e.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let s=r.position,n=r.normal,c=r.color,u=r.uv,p=r.uv2;p!==void 0&&(this.faceVertexUvs[1]=[]);for(let w=0;w<s.count;w++)t.vertices.push(new se().fromBufferAttribute(s,w)),c!==void 0&&t.colors.push(new Tr().fromBufferAttribute(c,w));function f(w,E,A,I){let P=c===void 0?[]:[t.colors[w].clone(),t.colors[E].clone(),t.colors[A].clone()],O=n===void 0?[]:[new se().fromBufferAttribute(n,w),new se().fromBufferAttribute(n,E),new se().fromBufferAttribute(n,A)],k=new CB(w,E,A,O,P,I);t.faces.push(k),u!==void 0&&t.faceVertexUvs[0].push([new lt().fromBufferAttribute(u,w),new lt().fromBufferAttribute(u,E),new lt().fromBufferAttribute(u,A)]),p!==void 0&&t.faceVertexUvs[1].push([new lt().fromBufferAttribute(p,w),new lt().fromBufferAttribute(p,E),new lt().fromBufferAttribute(p,A)])}let x=e.groups;if(x.length>0)for(let w=0;w<x.length;w++){let E=x[w],A=E.start,I=E.count;for(let P=A,O=A+I;P<O;P+=3)i!==void 0?f(i.getX(P),i.getX(P+1),i.getX(P+2),E.materialIndex):f(P,P+1,P+2,E.materialIndex)}else if(i!==void 0)for(let w=0;w<i.count;w+=3)f(i.getX(w),i.getX(w+1),i.getX(w+2));else for(let w=0;w<s.count;w+=3)f(w,w+1,w+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(x2).negate(),this.translate(x2.x,x2.y,x2.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=t===0?1:1/t,r=new mi;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let e=new se,t=new se;for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i],n=this.vertices[s.a],c=this.vertices[s.b],u=this.vertices[s.c];e.subVectors(u,c),t.subVectors(n,c),e.cross(t),e.normalize(),s.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)t[i]=new se;if(e){let i=new se,r=new se;for(let s=0,n=this.faces.length;s<n;s++){let c=this.faces[s],u=this.vertices[c.a],p=this.vertices[c.b],f=this.vertices[c.c];i.subVectors(f,p),r.subVectors(u,p),i.cross(r),t[c.a].add(i),t[c.b].add(i),t[c.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i];t[s.a].add(s.normal),t[s.b].add(s.normal),t[s.c].add(s.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)t[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i],n=s.vertexNormals;n.length===3?(n[0].copy(t[s.a]),n[1].copy(t[s.b]),n[2].copy(t[s.c])):(n[0]=t[s.a].clone(),n[1]=t[s.b].clone(),n[2]=t[s.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let i=this.faces[e],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let s=0,n=r.vertexNormals.length;s<n;s++)r.__originalVertexNormals[s]?r.__originalVertexNormals[s].copy(r.vertexNormals[s]):r.__originalVertexNormals[s]=r.vertexNormals[s].clone()}let e=new sI;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let s=this.morphNormals[t].faceNormals,n=this.morphNormals[t].vertexNormals;for(let c=0,u=this.faces.length;c<u;c++){let p=new se,f={a:new se,b:new se,c:new se};s.push(p),n.push(f)}}let r=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let s=0,n=this.faces.length;s<n;s++){let c=this.faces[s],u=r.faceNormals[s],p=r.vertexNormals[s];u.copy(c.normal),p.a.copy(c.vertexNormals[0]),p.b.copy(c.vertexNormals[1]),p.c.copy(c.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new mo),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new jl),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,i=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let r,s=this.vertices.length,n=this.vertices,c=e.vertices,u=this.faces,p=e.faces,f=this.colors,x=e.colors;t!==void 0&&(r=new Ao().getNormalMatrix(t));for(let w=0,E=c.length;w<E;w++){let A=c[w].clone();t!==void 0&&A.applyMatrix4(t),n.push(A)}for(let w=0,E=x.length;w<E;w++)f.push(x[w].clone());for(let w=0,E=p.length;w<E;w++){let A=p[w],I,P,O=A.vertexNormals,k=A.vertexColors,U=new CB(A.a+s,A.b+s,A.c+s);U.normal.copy(A.normal),r!==void 0&&U.normal.applyMatrix3(r).normalize();for(let j=0,V=O.length;j<V;j++)I=O[j].clone(),r!==void 0&&I.applyMatrix3(r).normalize(),U.vertexNormals.push(I);U.color.copy(A.color);for(let j=0,V=k.length;j<V;j++)P=k[j],U.vertexColors.push(P.clone());U.materialIndex=A.materialIndex+i,u.push(U)}for(let w=0,E=e.faceVertexUvs.length;w<E;w++){let A=e.faceVertexUvs[w];this.faceVertexUvs[w]===void 0&&(this.faceVertexUvs[w]=[]);for(let I=0,P=A.length;I<P;I++){let O=A[I],k=[];for(let U=0,j=O.length;U<j;U++)k.push(O[U].clone());this.faceVertexUvs[w].push(k)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},i=[],r=[],s=Math.pow(10,e);for(let u=0,p=this.vertices.length;u<p;u++){let f=this.vertices[u],x=Math.round(f.x*s)+"_"+Math.round(f.y*s)+"_"+Math.round(f.z*s);t[x]===void 0?(t[x]=u,i.push(this.vertices[u]),r[u]=i.length-1):r[u]=r[t[x]]}let n=[];for(let u=0,p=this.faces.length;u<p;u++){let f=this.faces[u];f.a=r[f.a],f.b=r[f.b],f.c=r[f.c];let x=[f.a,f.b,f.c];for(let w=0;w<3;w++)if(x[w]===x[(w+1)%3]){n.push(u);break}}for(let u=n.length-1;u>=0;u--){let p=n[u];this.faces.splice(p,1);for(let f=0,x=this.faceVertexUvs.length;f<x;f++)this.faceVertexUvs[f].splice(p,1)}let c=this.vertices.length-i.length;return this.vertices=i,c}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let r=e[t];this.vertices.push(new se(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let u=0;u<t;u++)e[u]._id=u;function i(u,p){return u.materialIndex-p.materialIndex}e.sort(i);let r=this.faceVertexUvs[0],s=this.faceVertexUvs[1],n,c;r&&r.length===t&&(n=[]),s&&s.length===t&&(c=[]);for(let u=0;u<t;u++){let p=e[u]._id;n&&n.push(r[p]),c&&c.push(s[p])}n&&(this.faceVertexUvs[0]=n),c&&(this.faceVertexUvs[1]=c)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let A=this.parameters;for(let I in A)A[I]!==void 0&&(e[I]=A[I]);return e}let t=[];for(let A=0;A<this.vertices.length;A++){let I=this.vertices[A];t.push(I.x,I.y,I.z)}let i=[],r=[],s={},n=[],c={},u=[],p={};for(let A=0;A<this.faces.length;A++){let I=this.faces[A],P=!0,O=!1,k=this.faceVertexUvs[0][A]!==void 0,U=I.normal.length()>0,j=I.vertexNormals.length>0,V=I.color.r!==1||I.color.g!==1||I.color.b!==1,$=I.vertexColors.length>0,Y=0;if(Y=f(Y,0,0),Y=f(Y,1,P),Y=f(Y,2,O),Y=f(Y,3,k),Y=f(Y,4,U),Y=f(Y,5,j),Y=f(Y,6,V),Y=f(Y,7,$),i.push(Y),i.push(I.a,I.b,I.c),i.push(I.materialIndex),k){let J=this.faceVertexUvs[0][A];i.push(E(J[0]),E(J[1]),E(J[2]))}if(U&&i.push(x(I.normal)),j){let J=I.vertexNormals;i.push(x(J[0]),x(J[1]),x(J[2]))}if(V&&i.push(w(I.color)),$){let J=I.vertexColors;i.push(w(J[0]),w(J[1]),w(J[2]))}}function f(A,I,P){return P?A|1<<I:A&~(1<<I)}function x(A){let I=A.x.toString()+A.y.toString()+A.z.toString();return s[I]!==void 0||(s[I]=r.length/3,r.push(A.x,A.y,A.z)),s[I]}function w(A){let I=A.r.toString()+A.g.toString()+A.b.toString();return c[I]!==void 0||(c[I]=n.length,n.push(A.getHex())),c[I]}function E(A){let I=A.x.toString()+A.y.toString();return p[I]!==void 0||(p[I]=u.length/2,u.push(A.x,A.y)),p[I]}return e.data={},e.data.vertices=t,e.data.normals=r,n.length>0&&(e.data.colors=n),u.length>0&&(e.data.uvs=[u]),e.data.faces=i,e}clone(){return new sI().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let w=0,E=t.length;w<E;w++)this.vertices.push(t[w].clone());let i=e.colors;for(let w=0,E=i.length;w<E;w++)this.colors.push(i[w].clone());let r=e.faces;for(let w=0,E=r.length;w<E;w++)this.faces.push(r[w].clone());for(let w=0,E=e.faceVertexUvs.length;w<E;w++){let A=e.faceVertexUvs[w];this.faceVertexUvs[w]===void 0&&(this.faceVertexUvs[w]=[]);for(let I=0,P=A.length;I<P;I++){let O=A[I],k=[];for(let U=0,j=O.length;U<j;U++){let V=O[U];k.push(V.clone())}this.faceVertexUvs[w].push(k)}}let s=e.morphTargets;for(let w=0,E=s.length;w<E;w++){let A={};if(A.name=s[w].name,s[w].vertices!==void 0){A.vertices=[];for(let I=0,P=s[w].vertices.length;I<P;I++)A.vertices.push(s[w].vertices[I].clone())}if(s[w].normals!==void 0){A.normals=[];for(let I=0,P=s[w].normals.length;I<P;I++)A.normals.push(s[w].normals[I].clone())}this.morphTargets.push(A)}let n=e.morphNormals;for(let w=0,E=n.length;w<E;w++){let A={};if(n[w].vertexNormals!==void 0){A.vertexNormals=[];for(let I=0,P=n[w].vertexNormals.length;I<P;I++){let O=n[w].vertexNormals[I],k={};k.a=O.a.clone(),k.b=O.b.clone(),k.c=O.c.clone(),A.vertexNormals.push(k)}}if(n[w].faceNormals!==void 0){A.faceNormals=[];for(let I=0,P=n[w].faceNormals.length;I<P;I++)A.faceNormals.push(n[w].faceNormals[I].clone())}this.morphNormals.push(A)}let c=e.skinWeights;for(let w=0,E=c.length;w<E;w++)this.skinWeights.push(c[w].clone());let u=e.skinIndices;for(let w=0,E=u.length;w<E;w++)this.skinIndices.push(u[w].clone());let p=e.lineDistances;for(let w=0,E=p.length;w<E;w++)this.lineDistances.push(p[w]);let f=e.boundingBox;f!==null&&(this.boundingBox=f.clone());let x=e.boundingSphere;return x!==null&&(this.boundingSphere=x.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new zPe().fromGeometry(this),t=new fr,i=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",b2.call(new Fr(i,3),e.vertices)),e.normals.length>0){let r=new Float32Array(e.normals.length*3);t.setAttribute("normal",b2.call(new Fr(r,3),e.normals))}if(e.colors.length>0){let r=new Float32Array(e.colors.length*3);t.setAttribute("color",x$.call(new Fr(r,3),e.colors))}if(e.uvs.length>0){let r=new Float32Array(e.uvs.length*2);t.setAttribute("uv",b$.call(new Fr(r,2),e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",b$.call(new Fr(r,2),e.uvs2))}t.groups=e.groups;for(let r in e.morphTargets){let s=[],n=e.morphTargets[r];for(let c=0,u=n.length;c<u;c++){let p=n[c],f=new Vi(p.data.length*3,3);f.name=p.name,s.push(b2.call(f,p.data))}t.morphAttributes[r]=s}if(e.skinIndices.length>0){let r=new Vi(e.skinIndices.length*4,4);t.setAttribute("skinIndex",w$.call(r,e.skinIndices))}if(e.skinWeights.length>0){let r=new Vi(e.skinWeights.length*4,4);t.setAttribute("skinWeight",w$.call(r,e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new fr,i=e.geometry;if(e.isPoints||e.isLine){let r=new Vi(i.vertices.length*3,3),s=new Vi(i.colors.length*3,3);if(t.setAttribute("position",b2.call(r,i.vertices)),t.setAttribute("color",x$.call(s,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let n=new Vi(i.lineDistances.length,1);t.setAttribute("lineDistance",FPe.call(n,i.lineDistances))}i.boundingSphere!==null&&(t.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};sI.prototype.isGeometry=!0;var zPe=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],i,r,s,n=e.faces;for(r=0;r<n.length;r++){let c=n[r];c.materialIndex!==s&&(s=c.materialIndex,i!==void 0&&(i.count=r*3-i.start,t.push(i)),i={start:r*3,materialIndex:s})}i!==void 0&&(i.count=r*3-i.start,t.push(i)),this.groups=t}fromGeometry(e){let t=e.faces,i=e.vertices,r=e.faceVertexUvs,s=r[0]&&r[0].length>0,n=r[1]&&r[1].length>0,c=e.morphTargets,u=c.length,p;if(u>0){p=[];for(let O=0;O<u;O++)p[O]={name:c[O].name,data:[]};this.morphTargets.position=p}let f=e.morphNormals,x=f.length,w;if(x>0){w=[];for(let O=0;O<x;O++)w[O]={name:f[O].name,data:[]};this.morphTargets.normal=w}let E=e.skinIndices,A=e.skinWeights,I=E.length===i.length,P=A.length===i.length;i.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let O=0;O<t.length;O++){let k=t[O];this.vertices.push(i[k.a],i[k.b],i[k.c]);let U=k.vertexNormals;if(U.length===3)this.normals.push(U[0],U[1],U[2]);else{let V=k.normal;this.normals.push(V,V,V)}let j=k.vertexColors;if(j.length===3)this.colors.push(j[0],j[1],j[2]);else{let V=k.color;this.colors.push(V,V,V)}if(s===!0){let V=r[0][O];V!==void 0?this.uvs.push(V[0],V[1],V[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",O),this.uvs.push(new lt,new lt,new lt))}if(n===!0){let V=r[1][O];V!==void 0?this.uvs2.push(V[0],V[1],V[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",O),this.uvs2.push(new lt,new lt,new lt))}for(let V=0;V<u;V++){let $=c[V].vertices;p[V].data.push($[k.a],$[k.b],$[k.c])}for(let V=0;V<x;V++){let $=f[V].vertexNormals[O];w[V].data.push($.a,$.b,$.c)}I&&this.skinIndices.push(E[k.a],E[k.b],E[k.c]),P&&this.skinWeights.push(A[k.a],A[k.b],A[k.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},CB=class{constructor(e,t,i,r,s,n=0){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new se,this.vertexNormals=Array.isArray(r)?r:[],this.color=s&&s.isColor?s:new Tr,this.vertexColors=Array.isArray(s)?s:[],this.materialIndex=n}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function FPe(e){return this.array.set(e),this}function x$(e){let t=this.array,i=0;for(let r=0,s=e.length;r<s;r++){let n=e[r];n===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),n=new Tr),t[i++]=n.r,t[i++]=n.g,t[i++]=n.b}return this}function b$(e){let t=this.array,i=0;for(let r=0,s=e.length;r<s;r++){let n=e[r];n===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),n=new lt),t[i++]=n.x,t[i++]=n.y}return this}function b2(e){let t=this.array,i=0;for(let r=0,s=e.length;r<s;r++){let n=e[r];n===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),n=new se),t[i++]=n.x,t[i++]=n.y,t[i++]=n.z}return this}function w$(e){let t=this.array,i=0;for(let r=0,s=e.length;r<s;r++){let n=e[r];n===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),n=new Gr),t[i++]=n.x,t[i++]=n.y,t[i++]=n.z,t[i++]=n.w}return this}var kPe=["a","b","c"];function NPe(e,t){switch(t){case"c":return e.c;case"b":return e.b;case"a":default:return e.a}}function hk(e,t,i){let r=Math.min(e,t),s=Math.max(e,t),n=r+"_"+s;return i.get(n)}function dk(e,t,i,r,s,n){let c=Math.min(e,t),u=Math.max(e,t),p=c+"_"+u,f;if(r.has(p))f=r.get(p);else{let x=i[c],w=i[u];f={a:x,b:w,newEdge:null,faces:[]},r.set(p,f)}f.faces.push(s),n[e].edges.push(f),n[t].edges.push(f)}function BPe(e,t,i,r){let s,n,c;for(s=0,n=e.length;s<n;s++)i[s]={edges:[]};for(s=0,n=t.length;s<n;s++)c=t[s],dk(c.a,c.b,e,r,c,i),dk(c.b,c.c,e,r,c,i),dk(c.c,c.a,e,r,c,i)}function w2(e,t,i,r,s){e.push(new CB(t,i,r,void 0,void 0,s))}function S_(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function S2(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}var UPe=class{constructor(e=1){this.subdivisions=e}modify(e){e instanceof fr?e=new sI().fromBufferGeometry(e):e=e.clone(),e.mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t=new se,i,r,s,n,c,u=e.vertices,p=e.faces,f=e.faceVertexUvs[0],x=f!==void 0&&f.length>0,w=[],E=new Map;BPe(u,p,w,E);let A=[],I,P,O,k,U,j,V;for(let kt of Array.from(E.keys())){for(P=E.get(kt),O=new se,U=3/8,j=1/8,V=P.faces.length,V!=2&&(U=.5,j=0,V!=1),O.addVectors(P.a,P.b).multiplyScalar(U),t.set(0,0,0),n=0;n<V;n++){for(k=P.faces[n],c=0;c<3&&(I=u[NPe(k,kPe[c])],!(I!==P.a&&I!==P.b));c++);I&&t.add(I)}t.multiplyScalar(j),O.add(t),P.newEdge=A.length,A.push(O)}let $,Y,J,X,ee,oe,le,ve=[];for(r=0,s=u.length;r<s;r++){for(oe=u[r],ee=w[r].edges,i=ee.length,i==3?$=3/16:i>3&&($=3/(8*i)),Y=1-i*Number($),J=$,i<=2&&(i==2?(Y=3/4,J=1/8):i==1||i==0),le=oe.clone().multiplyScalar(Y),t.set(0,0,0),n=0;n<i;n++)X=ee[n],I=X.a!==oe?X.a:X.b,t.add(I);t.multiplyScalar(Number(J)),le.add(t),ve.push(le)}let we=ve.concat(A),fe=ve.length,Ue,Fe,Pe,Ae=[],et=[],$e,rt,Je,bt,ot=new lt,xt=new lt,Xe=new lt;for(r=0,s=p.length;r<s;r++)k=p[r],Ue=Number(hk(k.a,k.b,E).newEdge)+fe,Fe=Number(hk(k.b,k.c,E).newEdge)+fe,Pe=Number(hk(k.c,k.a,E).newEdge)+fe,w2(Ae,Ue,Fe,Pe,k.materialIndex),w2(Ae,k.a,Ue,Pe,k.materialIndex),w2(Ae,k.b,Fe,Ue,k.materialIndex),w2(Ae,k.c,Pe,Fe,k.materialIndex),x&&($e=f[r],rt=$e[0],Je=$e[1],bt=$e[2],ot.set(S_(rt.x,Je.x),S_(rt.y,Je.y)),xt.set(S_(Je.x,bt.x),S_(Je.y,bt.y)),Xe.set(S_(rt.x,bt.x),S_(rt.y,bt.y)),S2(et,ot,xt,Xe),S2(et,rt,ot,Xe),S2(et,Je,xt,ot),S2(et,bt,Xe,xt));e.vertices=we,e.faces=Ae,x&&(e.faceVertexUvs[0]=et)}},Wo=new se,jPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=e.geometry??t?.geometry??new fr().copy(new $u(100,100,100)),r;t===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(Wo),r={width:Wo.x,height:Wo.y,depth:Wo.z,subdivisions:0}):r=t.parameters;let s=me(me({},r),e.parameters);return{parameters:{width:Math.abs(s.width),height:Math.abs(s.height),depth:Math.abs(s.depth),subdivisions:Math.abs(s.subdivisions)},geometry:i}}static build(e){let{width:t,height:i,depth:r,subdivisions:s}=e.parameters,n=e.geometry??new fr().copy(new $u(100,100,100)),c=n.userData.parameters;c===void 0?(n.computeBoundingBox(),n.boundingBox.getSize(Wo)):Wo.set(c.width,c.height,c.depth),(t!==Wo.x||i!==Wo.y||r!==Wo.z)&&n.scale(Wo.x===0?1:t/Wo.x,Wo.y===0?1:i/Wo.y,Wo.z===0?1:r/Wo.z);let u=n.originalGeometry;try{s>0?(u===void 0||c?.subdivisions!==s)&&(u===void 0&&(u=n),n=new UPe(s).modify(u).toBufferGeometry()):(u!==void 0&&(n=u),u=void 0,n.getAttribute("normal")===void 0&&n.computeVertexNormals())}catch{u!==void 0&&(n=u),u=void 0,n.getAttribute("normal")===void 0&&n.computeVertexNormals()}return u!==void 0&&Object.assign(n,{originalGeometry:u}),delete e.geometry,Object.assign(n,{userData:pt(me({},e),{type:"NonParametricGeometry"})})}static loadFromUrl(e,t,i){new PK(i).load(e,r=>{let s=this.normalizeInputs({geometry:r});r.boundingBox.getSize(Wo);let n=100/Wo.x;Object.assign(s.parameters,{width:100,height:Wo.y*n,depth:Wo.z*n}),t(this.build(s))})}},Aee=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof io?e.shape:new io,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,cornerRadius:s,depth:n,extrudeBevelSize:c,extrudeBevelSegments:u}=e.parameters,p=e.shape,f=t*.5,x=i*.5,w=0,E=0,A=2*Math.PI/r;for(let P=0;P<r;P++){let O=A*P,k=w+Math.sin(O)*f,U=E+Math.cos(O)*x;p.addPoint(p.createPoint(k,U))}p.isClosed=!0;for(let P=0,O=p.points.length;P<O;P++)p.points[P].roundness=s;p.roundness=s,p.update();let I=Xy.create({shape:p,parameters:{roundness:s,depth:n,extrudeBevelSize:c,extrudeBevelSegments:u}});return Object.assign(I,{userData:pt(me({},e),{type:"PolygonGeometry"})})}},VPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,radialSegments:s,heightSegments:n,openEnded:c,cornerRadius:u,cornerSegments:p}=e.parameters,f=new HPe(t*.5,i,s,n,c,u,p);return f.scale(1,1,r/t),Object.assign(f,{userData:pt(me({},e),{type:"PyramidGeometry"})})}};function kw(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function pk(e,t,i,r,s,n){let c=t.clone().sub(e),u=i.clone().sub(e),p=c.angleTo(u);if(c.normalize(),u.normalize(),r===s){let f=c.add(u).normalize();n.copy(e).addScaledVector(f,r/Math.sin(p/2))}else{let f=c.angleTo(u);n.copy(e),n.addScaledVector(c,s/Math.sin(f)),n.addScaledVector(u,r/Math.sin(f))}}function GPe(e,t,i){let r=e.clone().sub(t),s=i.clone().sub(t);return r.projectOnVector(s),r.add(t)}var HPe=class extends fr{constructor(e=.5,t=1,i=4,r=1,s=!1,n=0,c=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),c=Math.floor(c);let u=[],p=[],f=[],x=[],w=0,E=t/2,A=Math.PI/i,I=e*Math.cos(Math.PI/i),P=2*Math.PI/i,O=(i-2)*Math.PI/i,k=Math.PI-O,U=new se(0,-E,0),j=new se(0,E,0),V=new lt(e,-E),$=new lt(I,-E),Y=new lt(0,j.y).sub($),J=new lt(0,j.y).sub(V),X=new lt(Y.y,-Y.x).normalize(),ee=new lt(J.y,-J.x).normalize(),oe=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-Y.angle())/2)-1e-8;n=Math.min(n,oe);let le;{let Ae=new se(X.x,X.y,0),et=new se(Math.cos(P)*Ae.x,Ae.y,Math.sin(P)*Ae.x);le=Ae.angleTo(et)}let ve=n/Math.tan((Math.PI-Y.angle())/2),we=n/Math.tan((Math.PI-le)/2),fe=new se;if(!s){p.push(U.x,U.y,U.z),f.push(0,-1,0),x.push(0,0);let Ae=w++,et=[],$e=V.clone(),rt=ve/Math.cos(Math.PI/i);$e.x-=rt;for(let Je=0;Je<i;Je++){let bt=Je/i*Math.PI*2+A,ot=new lt(Math.sin(bt),Math.cos(bt));kw($e,ot,fe),p.push(fe.x,fe.y,fe.z),f.push(0,-1,0),x.push(0,0),et.push(w++)}for(let Je=0;Je<et.length;Je++)u.push(et[Je],Ae,et[(Je+1)%et.length])}let Ue=[];{let Ae=new se,et=new se,$e=new se,rt=new se,Je=new se,bt=new se;for(let ot=0;ot<i;ot++){let xt=ot/i*Math.PI*2+A,Xe=(ot+.5)/i*Math.PI*2+A,kt=(ot+1)/i*Math.PI*2+A,yt=new lt(Math.sin(xt),Math.cos(xt)),Nt=new lt(Math.sin(Xe),Math.cos(Xe)),Mt=new lt(Math.sin(kt),Math.cos(kt));kw(V,yt,et),kw(V,Mt,$e),kw(X,Nt,Ae),pk(j,et,$e,we,we,rt),p.push(rt.x,rt.y,rt.z),pk(et,j,$e,we,ve,Je),p.push(Je.x,Je.y,Je.z),pk($e,et,j,ve,we,bt),p.push(bt.x,bt.y,bt.z),f.push(Ae.x,Ae.y,Ae.z),f.push(Ae.x,Ae.y,Ae.z),f.push(Ae.x,Ae.y,Ae.z),x.push(0,0),x.push(0,0),x.push(0,0);let li=w++,Qt=w++,Wt=w++;if(u.push(li,Qt,Wt),n>0){{let Li=et.clone().add($e).multiplyScalar(.5),$t=j.clone().sub(Li).normalize(),Ut=U.clone().sub(Li).normalize().add($t).normalize().multiplyScalar(-1),wi=bt.clone().sub(Je);Fe(Li,wi,Ut,Y.angle())}let Di,Ii;{let Li=new se;kw(ee,Mt,Li);let $t=bt.clone().add(rt).multiplyScalar(.5);$t=GPe($t,$e,j);let Ut=bt.clone().sub(rt);[Di,Ii]=Fe($t,Ut,Li,le,rt.y)}{let Li=Di,$t=Li.clone().setY(0).normalize(),Ut=new se(0,-1,0),wi=$t.clone().cross(Ut);Pe(Li,$t,Ut,wi)}Ue.concat(Ii);{let Li=Y.angle(),$t=Math.PI-Li,Ut=j.clone();Ut.y-=n/Math.sin(Li-Math.PI/2);let wi=new se,Hi=[];for(let Ke=0;Ke<c;Ke++){let Re=[],Lt=Math.PI/2-$t*Ke/c,pi=Math.cos(Lt),Ee=Math.sin(Lt),Zt=Xe;for(let Xi=0;Xi<=Ke;Xi++){let Pi=Math.cos(Zt),si=Math.sin(Zt);Ae.x=pi*si,Ae.y=Ee,Ae.z=pi*Pi,wi.copy(Ut).addScaledVector(Ae,n),p.push(wi.x,wi.y,wi.z),f.push(Ae.x,Ae.y,Ae.z),x.push(0,0),Re.push(w++),Zt+=Math.PI*2/Ke/i}Hi.push(Re)}Ii.reverse(),Hi.push(Ii);let lr=Hi.length-1;for(let Ke=0;Ke<lr;Ke++){let Re=Hi[Ke],Lt=Hi[Ke+1],pi=Re.length-1;u.push(Lt[1],Re[0],Lt[0]);for(let Ee=1;Ee<=pi;Ee++)u.push(Re[Ee],Re[Ee-1],Lt[Ee]),u.push(Lt[Ee+1],Re[Ee],Lt[Ee])}}}}}this.setIndex(u),this.setAttribute("position",new Vi(p,3)),this.setAttribute("normal",new Vi(f,3)),this.setAttribute("uv",new Vi(x,2));function Fe(Ae,et,$e,rt,Je){let bt=-rt/2,ot=(Math.PI-rt)/2,xt=et.clone().normalize().cross($e);Ae.addScaledVector($e,-n/Math.sin(ot));let Xe=new se,kt=new se,yt=1,Nt=w,Mt=[];for(let li=0;li<=c;li++){let Qt=bt+li/c*rt;kt.set(0,0,0),kt.addScaledVector(xt,Math.sin(Qt)),kt.addScaledVector($e,Math.cos(Qt));for(let Wt=0;Wt<=yt;Wt++){let Di=Wt/yt-.5;if(Xe.copy(Ae),Xe.addScaledVector(et,Di),Xe.addScaledVector(kt,n),Je!=null){let Ii=Math.max(0,Xe.y-Je);Xe.addScaledVector(et,-Ii/et.y)}p.push(Xe.x,Xe.y,Xe.z),f.push(kt.x,kt.y,kt.z),x.push(0,0),Wt===0&&Mt.push(w),w++}}for(let li=0;li<c;li++)for(let Qt=0;Qt<yt;Qt++){let Wt=Nt+Qt+(yt+1)*li,Di=Wt+(yt+1),Ii=Di+1,Li=Wt+1;u.push(Wt,Di,Li),u.push(Di,Ii,Li)}return[Ae.clone().addScaledVector(et,.5),Mt]}function Pe(Ae,et,$e,rt){let Je=Math.PI/2,bt=J.angle()-Je,ot=[],xt=new se,Xe=new se;for(let yt=0;yt<=c;yt++){let Nt=[],Mt=yt/c;for(let li=0;li<=yt;li++){let Qt=((yt?li/yt:0)-.5)*k,Wt=Math.cos(Qt),Di=Math.sin(Qt),Ii=Math.atan(Math.tan(bt)*Wt),Li=(Je+Ii)*Mt,$t=Math.cos(Li),Ut=Math.sin(Li);xt.set(0,0,0),xt.addScaledVector(et,Ut*Wt),xt.addScaledVector($e,$t),xt.addScaledVector(rt,Ut*Di),Xe.copy(Ae).addScaledVector(xt,n),p.push(Xe.x,Xe.y,Xe.z),f.push(xt.x,xt.y,xt.z),x.push(0,0),Nt.push(w++)}ot.push(Nt)}let kt=ot.length-1;for(let yt=0;yt<kt;yt++){let Nt=ot[yt],Mt=ot[yt+1],li=Nt.length-1;u.push(Nt[0],Mt[1],Mt[0]);for(let Qt=1;Qt<=li;Qt++)u.push(Nt[Qt-1],Nt[Qt],Mt[Qt]),u.push(Nt[Qt],Mt[Qt+1],Mt[Qt])}}}},uU=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),r=Object.assign(t?.ui??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof io?e.shape:new io,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:r}}static build(e){let t=e.shape,{width:i,height:r,cornerRadius:s,cornerType:n,depth:c,extrudeBevelSize:u,extrudeBevelSegments:p}=e.parameters,f={x:i*.5,y:r*.5},x={x:-f.x,y:-f.y},w={x:f.x,y:f.y};function E(V,$,Y){return $>i&&Y>r?Math.min(V*i/$,V*r/Y):$>i?V*i/$:Y>r?V*r/Y:V}let A=[];A[0]=s[0]===0?0:E(s[0],s[0]+s[3],s[0]+s[1]),A[1]=s[1]===0?0:E(s[1],s[1]+s[2],s[1]+s[0]),A[2]=s[2]===0?0:E(s[2],s[2]+s[1],s[2]+s[3]),A[3]=s[3]===0?0:E(s[3],s[3]+s[0],s[3]+s[2]);let I=x.x,P=w.x,O=w.y,k=x.y;t.addPoint(t.createPoint(I,O)),t.addPoint(t.createPoint(P,O)),t.addPoint(t.createPoint(P,k)),t.addPoint(t.createPoint(I,k)),t.isClosed=!0;let U=!0;for(let V=0,$=t.points.length;V<$;V++)t.points[V].roundness=A[V],V>0&&A[V]!==A[V-1]&&(U=!1);U&&(t.roundness=A[0]),t.useCubicForRoundedCorners=n!==1,t.update();let j=Xy.create({shape:t,parameters:{depth:c,extrudeBevelSize:u,extrudeBevelSegments:p}});return Object.assign(j,{userData:pt(me({},e),{type:"RectangleGeometry"})})}},WPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},e.parameters);return i.thetaLength=Yi.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t=100,height:i=t,depth:r=t,widthSegments:s=64,heightSegments:n=64,phiStart:c,phiLength:u,thetaStart:p,thetaLength:f}=e.parameters,x;return f===0?(x=new fr,x.setAttribute("position",new Vi([],3))):x=new $_(.5*t,s,n,c,u,p,f*Yi.DEG2RAD),x.scale(1,i/t,r/t),Object.assign(x,{userData:pt(me({},e),{type:"SphereGeometry"})})}},qPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:r=8,heightSegments:s=8}=e.parameters,n=new Ep(t,i,r,s);return n.scale(1,1,1),Object.assign(n,{userData:pt(me({},e),{type:"PlaneGeometry"})})}},YPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,angle:s,cornerRadius:n,cornerSegments:c}=e.parameters,u=new XPe(t,i,r,s,n,c);return Object.assign(u,{userData:pt(me({},e),{type:"BackdropGeometry"})})}},XPe=class extends fr{constructor(e=1,t=1,i=1,r=90,s=10,n=24){super(),this.type="BackdropGeometry";let c=[],u=[],p=[],f=.001;s==0&&(n=1),n=Math.max(1,Math.floor(n)),s=Math.min(s,100),r=Math.min(180-f,r),r*=Math.PI/180;let x=[],w=Math.PI/2,E=(kt=0,yt=0,Nt=0)=>new se(kt,yt,Nt),A=E(),I=E(),[P,O,k]=[t/2,e/2,i/2],U=-O,j=+O,[V,$,Y]=[E(U,-P,+k),E(U,-P,-k),E(U,+P,-k)],J=(kt,yt=!1)=>Math.sin(kt-Math.PI/(1+ +yt)),X=(kt,yt=!1)=>Math.cos(kt-Math.PI/(1+ +yt));Y.y=Math.sin(r)*t-P;let ee=Math.cos(r)*t-k,oe=V.z-f;r<=w?(Y.z=Math.min(ee,oe),Y.z==oe&&(Y.y-=(ee-oe)/Math.tan(w-r))):$.z=Math.min($.z-ee-k,V.z-f),A.subVectors(V,$),I.subVectors(Y,$);let le=Math.min(A.length(),I.length())*s/100,ve=le*Math.tan(r/2),we=le/Math.cos(r/2),fe=A.clone().normalize().add(I.normalize()).setLength(we).add($);A.set(0,J(r,!0),X(r,!0)),x.push([Y,A.clone()]);let Ue=(Math.PI-r)/n;for(let kt=0;kt<=n;kt++){let yt=w+r+kt*Ue;A.set(0,Math.sin(yt)*ve,Math.cos(yt)*ve),A.add(fe),I.set(0,J(yt),X(yt)),x.push([A.clone(),I.clone()])}x.push([V,E(0,1,0)]);let Fe=Math.sin(Ue/2)*ve*2,Pe=x.length-1,Ae=x[0][0].distanceTo(x[1][0]),et=x[Pe-1][0].distanceTo(x[Pe][0]),$e=Ae+Fe*n+et;x[0].push(1);for(let kt=0;kt<=n;kt++)x[kt+1].push(1-(Ae+kt*Fe)/$e);x[Pe].push(0);let[rt,Je,bt]=x[0],ot,xt,Xe;for(let kt=1;kt<x.length;kt++)[ot,xt,Xe]=x[kt],c.push(U,rt.y,rt.z,U,ot.y,ot.z,j,rt.y,rt.z,j,rt.y,rt.z,U,ot.y,ot.z,j,ot.y,ot.z),u.push(0,Je.y,Je.z,0,xt.y,xt.z,0,Je.y,Je.z,0,Je.y,Je.z,0,xt.y,xt.z,0,xt.y,xt.z),p.push(0,bt,0,Xe,1,bt,1,bt,0,Xe,1,Xe),[rt,Je,bt]=[ot,xt,Xe];this.setAttribute("position",new Vi(c,3)),this.setAttribute("normal",new Vi(u,3)),this.setAttribute("uv",new Vi(p,2))}},Cee=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof io?e.shape:new io,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:r,spikes:s,cornerRadius:n,angle:c,depth:u,extrudeBevelSize:p,extrudeBevelSegments:f}=e.parameters,x=e.shape,w=t*.5,E=i*.5,A=0,I=0,P=c*Math.PI/360/s,O=Math.PI/2*3*-1,k=w*r/100,U=E*r/100;if(s===3&&r===50){P=2*Math.PI/s;for(let V=0;V<s;V++){let $=P*V,Y=A+Math.sin($)*w,J=I+Math.cos($)*E;x.addPoint(x.createPoint(Y,J))}}else for(let V=0;V<s;V++){let $=A+Math.cos(O)*w,Y=I+Math.sin(O)*E;x.addPoint(x.createPoint($,Y)),O+=P,$=A+Math.cos(O)*k,Y=I+Math.sin(O)*U,V<=s,x.addPoint(x.createPoint($,Y)),O+=P}x.isClosed=!0;for(let V=0,$=x.points.length;V<$;V++)x.points[V].roundness=n;x.roundness=n,x.update();let j=Xy.create({shape:x,parameters:{roundness:n,depth:u,extrudeBevelSize:p,extrudeBevelSegments:f}});return Object.assign(j,{userData:pt(me({},e),{type:"StarGeometry"})})}},$Pe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i}=e.parameters,r=new Ep(t,i);return Object.assign(r,{userData:pt(me({},e),{type:"TextFrameGeometry"})})}},ZPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},e.parameters),r=Math.abs(i.width),s=Math.abs(i.height??i.width),n=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:r,height:s,depth:n})}}static build(e){let{width:t,height:i,depth:r,radialSegments:s,tubularSegments:n,arc:c,cornerRadius:u,cornerSegments:p}=e.parameters,f=QPe(t,i,r,t*.5,c,n,0,0,s,u,p);return f.scale(1,i/t,1),Object.assign(f,{userData:pt(me({},e),{type:"TorusGeometry"})})}};function QPe(e,t,i,r,s,n,c,u,p,f,x){[t,i]=[i,t],c=t/2;let w=Yi.clamp(s/360,0,1);if(w===0){let E=new fr;return E.setAttribute("position",new Vi([],3)),E}return w===1&&(f=0),new Mee(!0,e,t,i,r,w,n,c,u,p,f,x)}var KPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(e){let{width:t,tube:i,tubularSegments:r,radialSegments:s,p:n,q:c}=e.parameters,u=t*.5;u!==i&&(u-=i);let p=new EK(u,i,r,s,n,c);return Object.assign(p,{userData:pt(me({},e),{type:"TorusKnotGeometry"})})}},JPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof io?e.shape:new io,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t=100,height:i,cornerRadius:r,depth:s,extrudeBevelSize:n,extrudeBevelSegments:c,isRect:u}=e.parameters,p=e.shape,f=t*.5,x=i*.5;u?(p.addPoint(p.createPoint(-f,x)),p.addPoint(p.createPoint(f,-x)),p.addPoint(p.createPoint(-f,-x))):(p.addPoint(p.createPoint(0,x)),p.addPoint(p.createPoint(f,-x)),p.addPoint(p.createPoint(-f,-x))),p.isClosed=!0;for(let E=0,A=p.points.length;E<A;E++)p.points[E].roundness=r;p.roundness=r,p.update();let w=Xy.create({shape:p,parameters:{roundness:r,depth:s,extrudeBevelSize:n,extrudeBevelSegments:c}});return Object.assign(w,{userData:pt(me({},e),{type:"TriangleGeometry"})})}};function eRe(e,t){let i=2*Math.PI;return(e%i+i)%i===(t%i+i)%i}var tRe=class{add(e,t,i){if(typeof arguments[0]!="string")for(let r in arguments[0])this.add(r,arguments[0][r],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(r){this[r]=this[r]||[],t&&this[r][i?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(i){i.call(t&&t.context?t.context:t,t)})}},iRe=class{constructor(e){this.jsep=e,this.registered={}}register(...e){e.forEach(t=>{if(typeof t!="object"||!t.name||!t.init)throw new Error("Invalid JSEP plugin format");this.registered[t.name]||(t.init(this.jsep),this.registered[t.name]=t)})}},ei=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+ei.version}static addUnaryOp(e){return ei.max_unop_len=Math.max(e.length,ei.max_unop_len),ei.unary_ops[e]=1,ei}static addBinaryOp(e,t,i){return ei.max_binop_len=Math.max(e.length,ei.max_binop_len),ei.binary_ops[e]=t,i?ei.right_associative.add(e):ei.right_associative.delete(e),ei}static addIdentifierChar(e){return ei.additional_identifier_chars.add(e),ei}static addLiteral(e,t){return ei.literals[e]=t,ei}static removeUnaryOp(e){return delete ei.unary_ops[e],e.length===ei.max_unop_len&&(ei.max_unop_len=ei.getMaxKeyLen(ei.unary_ops)),ei}static removeAllUnaryOps(){return ei.unary_ops={},ei.max_unop_len=0,ei}static removeIdentifierChar(e){return ei.additional_identifier_chars.delete(e),ei}static removeBinaryOp(e){return delete ei.binary_ops[e],e.length===ei.max_binop_len&&(ei.max_binop_len=ei.getMaxKeyLen(ei.binary_ops)),ei.right_associative.delete(e),ei}static removeAllBinaryOps(){return ei.binary_ops={},ei.max_binop_len=0,ei}static removeLiteral(e){return delete ei.literals[e],ei}static removeAllLiterals(){return ei.literals={},ei}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new ei(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map(t=>t.length))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return ei.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!ei.binary_ops[String.fromCharCode(e)]||ei.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return ei.isIdentifierStart(e)||ei.isDecimalDigit(e)}throwError(e){let t=new Error(e+" at character "+this.index);throw t.index=this.index,t.description=e,t}runHook(e,t){if(ei.hooks[e]){let i={context:this,node:t};return ei.hooks.run(e,i),i.node}return t}searchHook(e){if(ei.hooks[e]){let t={context:this};return ei.hooks[e].find(function(i){return i.call(t.context,t),t.node}),t.node}}gobbleSpaces(){let e=this.code;for(;e===ei.SPACE_CODE||e===ei.TAB_CODE||e===ei.LF_CODE||e===ei.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let e=this.gobbleExpressions(),t=e.length===1?e[0]:{type:ei.COMPOUND,body:e};return this.runHook("after-all",t)}gobbleExpressions(e){let t=[],i,r;for(;this.index<this.expr.length;)if(i=this.code,i===ei.SEMCOL_CODE||i===ei.COMMA_CODE)this.index++;else if(r=this.gobbleExpression())t.push(r);else if(this.index<this.expr.length){if(i===e)break;this.throwError('Unexpected "'+this.char+'"')}return t}gobbleExpression(){let e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,ei.max_binop_len),t=e.length;for(;t>0;){if(ei.binary_ops.hasOwnProperty(e)&&(!ei.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!ei.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=t,e;e=e.substr(0,--t)}return!1}gobbleBinaryExpression(){let e,t,i,r,s,n,c,u,p;if(n=this.gobbleToken(),!n||(t=this.gobbleBinaryOp(),!t))return n;for(s={value:t,prec:ei.binaryPrecedence(t),right_a:ei.right_associative.has(t)},c=this.gobbleToken(),c||this.throwError("Expected expression after "+t),r=[n,s,c];t=this.gobbleBinaryOp();){if(i=ei.binaryPrecedence(t),i===0){this.index-=t.length;break}s={value:t,prec:i,right_a:ei.right_associative.has(t)},p=t;let f=x=>s.right_a&&x.right_a?i>x.prec:i<=x.prec;for(;r.length>2&&f(r[r.length-2]);)c=r.pop(),t=r.pop().value,n=r.pop(),e={type:ei.BINARY_EXP,operator:t,left:n,right:c},r.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+p),r.push(s,e)}for(u=r.length-1,e=r[u];u>1;)e={type:ei.BINARY_EXP,operator:r[u-1].value,left:r[u-2],right:e},u-=2;return e}gobbleToken(){let e,t,i,r;if(this.gobbleSpaces(),r=this.searchHook("gobble-token"),r)return this.runHook("after-token",r);if(e=this.code,ei.isDecimalDigit(e)||e===ei.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===ei.SQUOTE_CODE||e===ei.DQUOTE_CODE)r=this.gobbleStringLiteral();else if(e===ei.OBRACK_CODE)r=this.gobbleArray();else{for(t=this.expr.substr(this.index,ei.max_unop_len),i=t.length;i>0;){if(ei.unary_ops.hasOwnProperty(t)&&(!ei.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!ei.isIdentifierPart(this.expr.charCodeAt(this.index+t.length)))){this.index+=i;let s=this.gobbleToken();return s||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:ei.UNARY_EXP,operator:t,argument:s,prefix:!0})}t=t.substr(0,--i)}ei.isIdentifierStart(e)?(r=this.gobbleIdentifier(),ei.literals.hasOwnProperty(r.name)?r={type:ei.LITERAL,value:ei.literals[r.name],raw:r.name}:r.name===ei.this_str&&(r={type:ei.THIS_EXP})):e===ei.OPAREN_CODE&&(r=this.gobbleGroup())}return r?(r=this.gobbleTokenProperty(r),this.runHook("after-token",r)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let t=this.code;for(;t===ei.PERIOD_CODE||t===ei.OBRACK_CODE||t===ei.OPAREN_CODE||t===ei.QUMARK_CODE;){let i;if(t===ei.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==ei.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),t=this.code}this.index++,t===ei.OBRACK_CODE?(e={type:ei.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},this.gobbleSpaces(),t=this.code,t!==ei.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):t===ei.OPAREN_CODE?e={type:ei.CALL_EXP,arguments:this.gobbleArguments(ei.CPAREN_CODE),callee:e}:(t===ei.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),e={type:ei.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),i&&(e.optional=!0),this.gobbleSpaces(),t=this.code}return e}gobbleNumericLiteral(){let e="",t,i;for(;ei.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(this.code===ei.PERIOD_CODE)for(e+=this.expr.charAt(this.index++);ei.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(t=this.char,t==="e"||t==="E"){for(e+=this.expr.charAt(this.index++),t=this.char,(t==="+"||t==="-")&&(e+=this.expr.charAt(this.index++));ei.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);ei.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+e+this.char+")")}return i=this.code,ei.isIdentifierStart(i)?this.throwError("Variable names cannot start with a number ("+e+this.char+")"):(i===ei.PERIOD_CODE||e.length===1&&e.charCodeAt(0)===ei.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:ei.LITERAL,value:parseFloat(e),raw:e}}gobbleStringLiteral(){let e="",t=this.index,i=this.expr.charAt(this.index++),r=!1;for(;this.index<this.expr.length;){let s=this.expr.charAt(this.index++);if(s===i){r=!0;break}else if(s==="\\")switch(s=this.expr.charAt(this.index++),s){case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=s}else e+=s}return r||this.throwError('Unclosed quote after "'+e+'"'),{type:ei.LITERAL,value:e,raw:this.expr.substring(t,this.index)}}gobbleIdentifier(){let e=this.code,t=this.index;for(ei.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,ei.isIdentifierPart(e));)this.index++;return{type:ei.IDENTIFIER,name:this.expr.slice(t,this.index)}}gobbleArguments(e){let t=[],i=!1,r=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let s=this.code;if(s===e){i=!0,this.index++,e===ei.CPAREN_CODE&&r&&r>=t.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}else if(s===ei.COMMA_CODE){if(this.index++,r++,r!==t.length){if(e===ei.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===ei.CBRACK_CODE)for(let n=t.length;n<r;n++)t.push(null)}}else if(t.length!==r&&r!==0)this.throwError("Expected comma");else{let n=this.gobbleExpression();(!n||n.type===ei.COMPOUND)&&this.throwError("Expected comma"),t.push(n)}}return i||this.throwError("Expected "+String.fromCharCode(e)),t}gobbleGroup(){this.index++;let e=this.gobbleExpressions(ei.CPAREN_CODE);if(this.code===ei.CPAREN_CODE)return this.index++,e.length===1?e[0]:e.length?{type:ei.SEQUENCE_EXP,expressions:e}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:ei.ARRAY_EXP,elements:this.gobbleArguments(ei.CBRACK_CODE)}}},rRe=new tRe;Object.assign(ei,{hooks:rRe,plugins:new iRe(ei),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});ei.max_unop_len=ei.getMaxKeyLen(ei.unary_ops);ei.max_binop_len=ei.getMaxKeyLen(ei.binary_ops);var xx=e=>new ei(e).parse(),nRe=Object.getOwnPropertyNames(ei);nRe.forEach(e=>{xx[e]===void 0&&e!=="prototype"&&(xx[e]=ei[e])});xx.Jsep=ei;var sRe="ConditionalExpression",oRe={name:"ternary",init(e){e.hooks.add("after-expression",function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;let i=t.node,r=this.gobbleExpression();if(r||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let s=this.gobbleExpression();if(s||this.throwError("Expected expression"),t.node={type:sRe,test:i,consequent:r,alternate:s},i.operator&&e.binary_ops[i.operator]<=.9){let n=i;for(;n.right.operator&&e.binary_ops[n.right.operator]<=.9;)n=n.right;t.node.test=n.right,n.right=t.node,t.node=i}}else this.throwError("Expected :")}})}};xx.plugins.register(oRe);var aRe=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],lRe=["0","1","2","3","4","5","6","7","8","9","."],cRe=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function uRe(e){return typeof e!="string"?!1:!isNaN(e)&&!isNaN(parseFloat(e))}xx.addBinaryOp("^",11,!0);function Dee(e,t,i="number"){let r="";for(let c=0;c<e.length;c++){let u=e[c];if("objType"in u&&u.objType==="api"){let p=JSON.parse(u.id),f=p[0],x=t.getUserAPI(f);if(x!==void 0){let w=x.retrieveValue(p.slice(1));w!==void 0&&(r+=w)}continue}if("objType"in u&&u.objType==="webhook"){let p=JSON.parse(u.id),[f,x]=p,w=t.getUserWebhook(f);if(w!==void 0){let E=w.getParameterValue(x);E!==void 0&&(r+=E)}continue}if("id"in u){let p=e[c-1];if(c>0&&"id"in p){console.error("Two variables in a row",e);return}let f=t.getVariable(u.id),x=Oa.getDisplayedValue(f);i==="number"&&Oa.isTextValue(f)&&Array.isArray(f.textValue)&&f.textValue.length===1?x=parseFloat(x).toString():i==="boolean"&&Oa.isBoolean(f)?x=f?"true":"false":i==="boolean"&&Oa.isTextValue(f)&&!Array.isArray(f.textValue)&&(x='"'+x+'"'),r+=x;continue}else if(i==="string"){u.name!=='"'&&(u.name!=="+"||u.escaped)&&(r+=u.name),u.name==="+"&&!u.escaped&&r[r.length-1]==="\\"&&(r=r.slice(0,-1)+u.name);continue}if(u.name==="and"){r+="&&";continue}if(u.name==="or"){r+="||";continue}if(u.name==="True"){r+="true";continue}if(u.name==="False"){r+="false";continue}if(i==="boolean"&&!uRe(u.name)&&!lRe.includes(u.name)&&!aRe.includes(u.name)&&!cRe.includes(u.name.replace(/\($/g,""))){r+='"'+u.name+'"';continue}r+=u.name}if(i==="string")return r;if(e.length===0){if(i==="number")return 0;if(i==="boolean")return!1}let s;try{s=xx(r)}catch(c){console.error(r,c);return}let n;try{n=Hn(s)}catch(c){console.error(r,s,c)}return n}function Hn(e){switch(e.type){case"BinaryExpression":switch(e.operator){case"==":return+(Hn(e.left)===Hn(e.right));case"!=":return+(Hn(e.left)!==Hn(e.right));case">":return+(Hn(e.left)>Hn(e.right));case">=":return+(Hn(e.left)>=Hn(e.right));case"<":return+(Hn(e.left)<Hn(e.right));case"<=":return+(Hn(e.left)<=Hn(e.right));case"+":return Hn(e.left)+Hn(e.right);case"-":return Hn(e.left)-Hn(e.right);case"*":return Hn(e.left)*Hn(e.right);case"/":return Hn(e.left)/Hn(e.right);case"%":return Hn(e.left)%Hn(e.right);case"&&":return Hn(e.left)&&Hn(e.right);case"||":return Hn(e.left)||Hn(e.right);case"^":return Math.pow(Hn(e.left),Hn(e.right));default:throw new Error("Unknown operator: "+e.operator)}case"UnaryExpression":switch(e.operator){case"-":return-Hn(e.argument);case"!":return+!Hn(e.argument);default:throw new Error("Unknown operator: "+e.operator)}case"Identifier":throw new Error("Unknown identifier: "+e.name);case"Literal":return e.value;case"CallExpression":if(e.callee.type==="Identifier"){if(e.callee.name==="random"){let t=0,i=1;if(e.arguments.length>=1)try{t=Hn(e.arguments[0])}catch(r){console.warn(r)}if(e.arguments.length>=2)try{i=Hn(e.arguments[1])}catch(r){console.warn(r)}return t=Math.min(i,t),i=Math.max(i,t),t+Math.random()*(i-t)}return Math[e.callee.name].apply(null,e.arguments.map(Hn))}else throw new Error("Unknown node");default:throw new Error("Unknown node type: "+e.type)}}var hRe=new mi,dRe=new mi;function pRe(e,t,i){let r=[new se,new se,new se],s=[new se,new se,new se];return e.extractBasis(r[0],r[1],r[2]),t.extractBasis(s[0],s[1],s[2]),r.forEach((n,c)=>{let u=s[c],p=Yi.lerp(n.length(),u.length(),i);n.lerp(u,i).setLength(p)}),new mi().makeBasis(r[0],r[1],r[2])}var fRe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),r=Math.abs(i.width),s=Math.abs(i.height??i.width),n=Math.abs(i.depth??0),c=t?.shapeData??cU.create({parameters:JJ}).userData.shape;return{path:e.path??WD.defaultData(),parameters:Object.assign(i,{width:r,height:s,depth:n,extrusion:me(me({},eee),i.extrusion)}),shapeData:c}}static build(e){if(e.path.points.length>=2){let t=new mRe(e);return Object.assign(t,{userData:pt(me({},e),{type:"PathGeometry"})})}else return Object.assign(new fr,{userData:pt(me({},e),{type:"PathGeometry"})})}},mRe=class extends fr{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&e.depth===1)||!eRe(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:r}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),r=Math.max(0,Math.min(r,1));let s=this.inputs.path.isClosed?e.length:e.length-1,n=Math.floor(r*s),c=this.inputs.path.isClosed?Math.ceil((i+r)*s):Math.ceil(Math.min(1,i+r)*s),u=Math.min(Math.max(2,c-n+1),s+2),p=[],f=[];for(let Pe=0;Pe<u;Pe++){let Ae=this.inputs.path.isClosed?(Pe+n)%e.length:Math.min(Pe+n,e.length-1);p.push(e[Ae].clone()),f.push(t[Ae].clone())}let x=(Pe,Ae,et)=>{p[Pe]=p[Pe].clone().lerp(p[Ae],et),f[Pe]=pRe(f[Pe],f[Ae],et)},w=0,E=r*s%1;(!this.inputs.path.isClosed||i<=1)&&(E||r===0)&&(w=E,x(0,1,w));let A=0,I=(r+i)*s%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&r+i<1)&&I&&(A=I,x(p.length-1,p.length-2,1-A)),i===0){let Pe=p.length-1;p[Pe].copy(p[0]),f[Pe].copy(f[0])}this._applyPathModifiers(f,w,A);let{bevel:P,bevelSides:O}=this.inputs.parameters.extrusion,k=P>0?this.inputs.parameters.extrusion.capType:"flat",U=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(U=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let{regions:j,infos:V,vertices:$}=this._computeShapePoints(U),Y=0,J;k==="round"&&(J=new lU(this.inputs.shapeData,2*P,P,U,O,void 0,!0),Y=J.getAttribute("position").count);let X=0,ee=0;V.sort((Pe,Ae)=>Pe.start-Ae.start),V.forEach(Pe=>{Pe.verticesStart=X,Pe.verticesCount=Pe.continuous.reduce((Ae,et,$e)=>Ae+($e===0||!et?2:1),0),ee+=Pe.verticesCount,X=ee});let oe=ee*u,le,ve=0;if(this._isOpenEnded()&&k==="flat"){try{le=um({windingRule:ps.ODD,elementType:Mo.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:j})}catch{le=vee}ve=le.vertexCount}let we=oe+2*ve+Y*2,fe=oe+2*ve,Ue={positions:new Float32Array(we*3),normals:new Float32Array(we*3),uvs:new Float32Array(we*2)},Fe=[];if(V.forEach(Pe=>{this._extrudeRegion(Pe,$,f,p,Ue,Fe,this._isGeometryClosed()&&!this._isOpenEnded())}),le&&(this._closeEnd(le,oe,Fe,Ue,f[0],p[0],!1),this._closeEnd(le,oe+ve,Fe,Ue,f[f.length-1],p[p.length-1],!0)),J){Ue.positions.set(J.getAttribute("position").array,fe*3),Ue.normals.set(J.getAttribute("normal").array,fe*3),Ue.uvs.set(J.getAttribute("uv").array,fe*2);for(let $e=fe;$e<fe+Y;$e++)Ue.uvs[$e*2+1]=1e-4;let Pe=Fe.length;Fe.push(...J.getIndex().array.map($e=>$e+fe)),fe+=Y,Ue.positions.set(J.getAttribute("position").array,fe*3),Ue.normals.set(J.getAttribute("normal").array,fe*3),Ue.uvs.set(J.getAttribute("uv").array,fe*2);let Ae=Fe.length;Fe.push(...J.getIndex().array.map($e=>$e+fe)),this.setAttribute("position",new Fr(Ue.positions,3)),this.setAttribute("normal",new Fr(Ue.normals,3)),this.setAttribute("uv",new Fr(Ue.uvs,2)),this.setIndex(Fe);let et=hRe;et.copy(f[f.length-1]).setPosition(p[p.length-1]),this.applyMatrix4OnRange(et,fe,we),et.copy(f[0]).setPosition(p[0]).multiply(dRe.makeScale(1,1,-1)),this.applyMatrix4OnRange(et,fe-Y,fe),this.reverseIndicesOnRange(Pe,Ae)}else this.setAttribute("position",new Fr(Ue.positions,3)),this.setAttribute("normal",new Fr(Ue.normals,3)),this.setAttribute("uv",new Fr(Ue.uvs,2)),this.setIndex(Fe)}_extractPathPoints(){let e=cee(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach(i=>{t[t.length-1].distanceToSquared(i)>.001&&t.push(i)}),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,r=this.inputs.path.isClosed,s=new se,n=new se,c=new se,u=new se,p=new se(0,1,0);for(let I=0;I<i;I++){let P=e[I],O;I===0?O=r?e[e.length-2]:P.clone().multiplyScalar(2).sub(e[1]):O=e[I-1];let k;I===i-1?k=r?e[1]:P.clone().multiplyScalar(2).sub(e[I-1]):k=e[I+1];let U=P.clone().sub(O).normalize(),j=k.clone().sub(P).normalize(),V=U.clone().add(j).normalize();c.copy(V),I===0&&(V.equals(p)||V.clone().negate().equals(p))&&p.set(0,0,1);let $=p.clone().cross(V).normalize(),Y=V.clone().cross($).normalize();p.copy(Y),u.copy($),I===0&&(s.copy(Y),n.copy(V));let J=new mi().makeBasis($,Y,V);t.push(J)}let f=r?n:c,x=r?s:new se(0,1,0),w=f.clone().cross(u).normalize(),E=Math.acos(x.dot(w));if(isNaN(E))return t;let A=x.clone().cross(w);f.dot(A)>0&&(E*=-1);for(let I=1;I<t.length;I++){let P=new mi().makeRotationZ(E*I/t.length);t[I].multiply(P)}return t}_applyPathModifiers(e,t,i){let r=e.length,{angle:s,twist:n,startScale:c,endScale:u}=this.inputs.parameters.extrusion,p=new mi,f=new mi;return e.forEach((x,w)=>{let E=w===0?0:w===r-1?1:(w-t)/(r-(i===0?0:1)-(t+(1-i)));p.makeRotationZ(Yi.lerp(s,s+n,E)*Yi.DEG2RAD);let A=Yi.lerp(c,u,E);f.makeScale(A,A,A),x.multiply(p).multiply(f)}),e}_computeShapePoints(e=12,t=ps.ODD){let i=this.inputs.shapeData,r=i.extractShapePointsToFlatArray([],e),s=i.shapeHoles.map(A=>{let I=A.extractShapePointsToFlatArray([],e),P=[];for(let O=I.length-1;O>=1;O-=2){let k=I[O-1],U=I[O-0];P.push(k,U)}return P}),n;try{n=um({windingRule:t,elementType:Mo.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[r]})}catch{n=aU}let c;try{c=um({windingRule:ps.ODD,elementType:Mo.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...s]})}catch{c=yee}if(!n)throw new Error("error generating geometry");let u=n.elementCount;if(c){n.elementCount+=c.elementCount;for(let A=0;A<c.elements.length;A++){let I=c.elements[A],P=A%2===0?n.vertexCount:0;n.elements.push(I+P)}for(let A=0;A<c.vertexIndices.length;A++){let I=c.vertexIndices[A],P=n.vertexCount;n.vertexIndices.push(I+P)}for(let A=0;A<c.vertices.length;A++){let I=c.vertices[A];n.vertices.push(I)}}let p=1/0,f=-1/0,x=1/0,w=-1/0;for(let A=0,I=n.vertexCount;A<I;A++){let P=A*2,O=n.vertices[P+0],k=n.vertices[P+1];O<p&&(p=O),O>f&&(f=O),k<x&&(x=k),k>w&&(w=k)}let E=[];for(let A=n.elementCount-1;A>=0;A--){let I=A>=u,P=A*2,O=n.elements[P+0],k=n.elements[P+1],U=O+k,j={start:O,count:k,normals:[],isHole:I,continuous:[],verticesStart:0,verticesCount:0};E.push(j);let V=O,$=U-1,Y=O+1,J=i.roundedCurves.length;do{let X=V-O,ee=n.vertices[$*2+0],oe=n.vertices[$*2+1],le=n.vertices[V*2+0],ve=n.vertices[V*2+1],we=n.vertices[Y*2+0],fe=n.vertices[Y*2+1],Ue=le-ee,Fe=ve-oe,Pe=Math.sqrt(Ue*Ue+Fe*Fe);Ue/=Pe,Fe/=Pe;let Ae=le-we,et=ve-fe,$e=Math.sqrt(Ae*Ae+et*et);Ae/=$e,et/=$e,j.normals[X*2+0]=-et,j.normals[X*2+1]=Ae;let rt=n.vertexIndices[V];if(Array.isArray(rt))j.continuous[X]=!1;else{let[Je,bt]=i.getCurveIndexFromVertexId(rt-1,!0);if(bt>0&&bt<1)j.continuous[X]=!0;else{let ot=bt===1?Je+1:Je-1;ot=(ot+J)%J;let xt=bt===1?0:1,Xe=i.roundedCurves[Je].getTangent(bt),kt=i.roundedCurves[ot].getTangent(xt);j.continuous[X]=Xe.dot(kt)>.95}}I&&(j.normals[X*2+0]*=-1,j.normals[X*2+1]*=-1),[$,V,Y]=[V,Y,Y+1],Y>=U&&(Y-=k)}while(Y!==O+1)}return{regions:[r,...s],infos:E,vertices:n.vertices}}_insertVertex(e,t,i,r,s){let n=t*2,c=t*3;e.positions[c+0]=i.x,e.positions[c+1]=i.y,e.positions[c+2]=i.z,e.normals[c+0]=r.x,e.normals[c+1]=r.y,e.normals[c+2]=r.z,e.uvs[n+0]=s.x,e.uvs[n+1]=s.y}_extrudeRegion(e,t,i,r,s,n,c){let u=new se,p=new se,f=new se,x=new se,w=new lt;i.forEach((A,I)=>{let P=r[I],O=e.verticesStart*i.length+e.verticesCount*I;for(let k=0;k<e.count;k++){let U=(e.start+k)*2;if(u.set(t[U+0],t[U+1],0),f.copy(u).applyMatrix4(A).add(P),e.continuous[k])x.set(e.normals[k*2+0],e.normals[k*2+1],0);else{let j=k===0?(e.start+e.count-1)*2:U-2;p.set(t[j+0],t[j+1],0),x.copy(u).sub(p),x.set(-x.y,x.x,0),e.isHole||x.negate()}if(x.applyMatrix4(A).normalize(),w.set(k===0?1:k/e.count,I/(i.length-1)),this._insertVertex(s,O,f,x,w),O++,!e.continuous[k]||k===0){if(k===0)x.set(e.normals[k*2+0],e.normals[k*2+1],0),w.set(0,I/(i.length-1));else{let j=k===e.count-1?e.start*2:U+2;p.set(t[j+0],t[j+1],0),x.copy(p).sub(u),x.set(-x.y,x.x,0),e.isHole||x.negate()}x.applyMatrix4(A).normalize(),this._insertVertex(s,O,f,x,w),O++}}});let E=i.length-1;for(let A=0;A<E;A++){let I=e.verticesStart*i.length+e.verticesCount*A,P=e.verticesStart*i.length+e.verticesCount*(A+1),O=0;for(let k=0;k<e.count;k++){(!e.continuous[k]||k===0)&&O++;let U=k===e.count-1?0:O+1,j=I+O,V=I+U,$=P+U,Y=P+O;e.isHole?n.push(j,$,V,j,Y,$):n.push(j,V,$,j,$,Y),O++}}}_closeEnd(e,t,i,r,s,n,c){let u=e.vertexCount,p=new se(0,0,c?-1:1).applyMatrix4(s),f=new se,x=new lt;for(let E=0;E<u;E++){let A=2*E;f.set(e.vertices[A+0],e.vertices[A+1],0).applyMatrix4(s).add(n),this._insertVertex(r,t+E,f,p,x)}let w=e.elements;for(let E=0;E<e.elementCount;E++){let A=3*E,I=w[A+0]+t,P=w[A+(c?1:2)]+t,O=w[A+(c?2:1)]+t;i.push(I,P,O)}}applyMatrix4OnRange(e,t,i){let r=e.elements,s=new Ao().getNormalMatrix(e).elements,n,c,u,p,f=this.attributes.position,x=this.attributes.normal;if(!f||!x)return;let w=f.array,E=x.array,A=f.itemSize;for(let I=t*A,P=i*A;I<P;I+=A){if(I===t)debugger;n=w[I+0],c=w[I+1],u=w[I+2],p=1/(r[3]*n+r[7]*c+r[11]*u+r[15]),w[I+0]=(r[0]*n+r[4]*c+r[8]*u+r[12])*p,w[I+1]=(r[1]*n+r[5]*c+r[9]*u+r[13])*p,w[I+2]=(r[2]*n+r[6]*c+r[10]*u+r[14])*p,n=E[I+0],c=E[I+1],u=E[I+2],E[I+0]=s[0]*n+s[3]*c+s[6]*u,E[I+1]=s[1]*n+s[4]*c+s[7]*u,E[I+2]=s[2]*n+s[5]*c+s[8]*u}f.needsUpdate=!0,x.needsUpdate=!0}reverseIndicesOnRange(e,t){let i=this.index;if(i){for(let r=e;r<t;r+=3){let s=i.getX(r),n=i.getX(r+1),c=i.getX(r+2);i.setXYZ(r,c,n,s)}i.needsUpdate=!0}}};function Iee(){let e=new fr;return e.setAttribute("position",new Fr(new Float32Array([]),3)),e.setIndex(new Fr(new Uint16Array([]),1)),e}var gRe=Iee().attributes,yRe=12,vRe=1,DB=class extends fr{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,gRe),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);i?.isLoaded?(this.font=i,this.update(e)):this.updateFont(e.font,t).then(()=>{this.update(e),t?.requestRender()})}updateFont(e,t){return jn(this,null,function*(){let i=t.getFont(e);i&&(this.font=i,yield i.loadingPromise)})}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!t?.isLoaded){console.warn("Cannot update text because its font is not loaded");return}let{width:i,height:r,depth:s,extrudeBevelSize:n,extrudeBevelSegments:c,text:u,textTransform:p}=e,f=Oa.getDisplayedValue(u),x=p===2?f.toUpperCase():p===3?f.toLowerCase():f,w=_Re(e,t,x),{shapes:E,charWidths:A,charCoords:I}=t.generateShapes(w,e),P=(typeof i=="number"?i:1)*.5,O=(typeof r=="number"?r:1)*.5,k=E.map(V=>new io().fromShape(V,!0));this.vectorShapes=k;let U=k.map(V=>Xy.create({shape:V,parameters:{depth:s,extrudeBevelSegments:c,extrudeBevelSize:n,windingRule:s<=0?ps.NONZERO:ps.ODD,subdivisions:this.isLowResolution&&s>0?vRe:yRe}})),j=U.length?Ay(U):Iee();j.translate(-P,O,0),this.dispose(),this.wrappedText=w,this.charCoords=I,this.charWidths=A,this.deleteAttribute("extrudeNormal"),Object.entries(j.attributes).forEach(([V,$])=>{this.setAttribute(V,$)}),this.setIndex(j.index),this.computeBoundingSphere()}clone(){let e=eu(new fr,DB.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,i])=>{this.setAttribute(t,i)}),this.setIndex(e.index),this.userData={parameters:me({},e.userData.parameters),type:"TextGeometry"},this}setText(e){return jn(this,null,function*(){this.font&&(yield this.font.loadingPromise),yield this.update(pt(me({},this.userData.parameters),{text:{textValue:e}}))})}get text(){return this.userData.parameters.text??""}};function _Re(e,t,i){let r=[""],s="";for(let n of i)s+=n,n===" "||n===`
`?(r[r.length-1]+=s,s="",n===`
`&&r.push("")):t.getTextWidth(r[r.length-1]+s,e)>e.width&&(r[r.length-1].length&&r.push(""),t.getTextWidth(r[r.length-1]+s,e)>e.width&&(s.length===1?(r[r.length-1]+=s,s=""):(r[r.length-1]+=s.slice(0,-1),s=s[s.length-1],r.push(""))));return r[r.length-1]+=s,r}var Pee,Ree=new Promise(e=>{Pee=e}),S$=!1,E2;function xRe(){if(S$)return;if(E2)return E2;function e(){return jn(this,null,function*(){let t="https://unpkg.com/@splinetool/modelling-wasm@1.9.20/build",i=import("./chunk-L7R4EUWH.js"),[r,s]=yield Promise.all([i,fetch(`${t}/process.wasm`).then(u=>u.arrayBuffer())]),n=r.default,c=yield n({wasmBinary:s});Pee(c),S$=!0})}return E2=e(),E2}var bRe=["font"];function kS(e,t,i,r){let s,n,c;e.type==="PathGeometry"?(n=JSON.parse(JSON.stringify(e)),c=[[],["extrusion"]]):(n=me({},e),c=[[]]);for(let f of c){let x=n;for(let w of f)x=x[w];for(s in x){let w=x[s];MX(w)&&!bRe.includes(s)&&(x[s]=t.getVariable(w,[r.uuid,"geometry",...f,s]),MX(x[s])&&(x[s]=1))}}let u={parameters:n,type:n.type};if(n.type==="PathGeometry")u.path=n.path;else if(n.type==="VectorGeometry"){let f=io.createFromState(n.shape,n.width,n.height);u.shape=f}else if(n.type==="NonParametricGeometry"){if(n.data.groups&&n.data.groups?.forEach(f=>f.materialIndex=Math.max(f.materialIndex??0,0)),u.geometry=new PK().parse(n),u.geometry.groups.length===0){let f=u.geometry;f.addGroup(0,Math.max(f.getIndex()?.count??0,f.getAttribute("position").count),0)}}else if(n.type==="SubdivGeometry"){let f=new yl(n,i);return f.data=e,f}else{if(n.type==="TextGeometry")return new DB(n,t);if(n.type==="InputGeometry")return new DB(n,t);if(n.type==="UIGeometry")return uU.create({parameters:{width:n.width,height:n.height,cornerRadius:n.cornerRadius,cornerType:n.cornerType}})}let p;try{p=C$(u)}catch(f){console.error(f)}if(!p){let f=io.createFromState(HD.defaultData(),100,100);u.shape=f,p=C$(u)}return p}var wRe=new mi;function IB(e,t,i,r){let s=e.position.array,n=e.normal.array,c=wRe.makeScale(t,i,r).invert().elements,u,p,f;for(var x=0,w=s.length;x<w;x+=3)s[x]*=t,s[x+1]*=i,s[x+2]*=r,u=n[x],p=n[x+1],f=n[x+2],n[x]=c[0]*u+c[4]*p+c[8]*f,n[x+1]=c[1]*u+c[5]*p+c[9]*f,n[x+2]=c[2]*u+c[6]*p+c[10]*f;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var M2=new mo,E_=new se,Cr;Ree.then(e=>{Cr=e});var E$=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),M$=new Uint32Array([0,1,2,3]),T$=new Uint8Array([4]),yl=class extends fr{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let i=this.data.scaleBaked,r=Ly.div(t,i);this.subdividedGeometry&&IB(this.subdividedGeometry.attributes,...r),this.originalGeometry&&IB(this.originalGeometry.attributes,...r),this.data=e;let s=this.userData.parameters;this.userData.parameters={width:s.width*r[0],height:s.height*r[1],depth:s.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply(E_.fromArray(r));let n=E_.set(s.width,s.height,s.depth).length();this.originalGeometry.boundingSphere.radius=n/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,i;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:i}=yl.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new $u(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=e,this.subdividedGeometry=t??void 0;let r=this.subdividedGeometry??this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(yl.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new jl,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;M2.setFromBufferAttribute(t),M2.getCenter(i),e.boundingSphere.radius=i.distanceTo(M2.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),M2.getSize(E_);let r={width:E_.x,height:E_.y,depth:E_.z};return this.userData.parameters=r,r}static build(e,t,i,r){let s,n,c,u=e?.phongAngle??35;i===!1&&(u=-1),t&&(Cr.free_bvh(t),Cr.free_subdivision_surface(t));try{s=yl.allocate(e,r)}catch(p){console.error(p,e),s=yl.allocate({positionWASM:E$,indexWASM:M$,verticesPerFaceWASM:T$},r)}if(Cr.set_destination_refinement_level(s,0),n=yl.buildLevel(s,!0,u),e.subdivisions>0)try{Cr.set_destination_refinement_level(s,e.subdivisions),c=yl.buildLevel(s,!1,u)}catch{try{Cr.set_destination_refinement_level(s,e.subdivisions-1),c=yl.buildLevel(s,!1,u)}catch{c=null}}else c=null;return{subdivPointer:s,originalGeometry:n,subdividedGeometry:c}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),e.type==="DodecahedronGeometry"&&(e.detail=0);let r=e.shape!==void 0||e.path!==void 0?t.geometry:kS(e,i,!1),s;e.type==="TorusGeometry"&&e.arc===Math.PI*2?s=r.getClosedTorusIndicesForBooleanOrSubdiv():s=r.getIndex();let n,c,u,p;({positions:n,triIndices:p}=FI(r.getAttribute("position"),s));let f;if(e.type==="CylinderGeometry"&&e.cornerRadius===0&&e.hollow===0&&e.openEnded===!1){let x=e.radialSegments*e.heightSegments*3*2,w=x+e.radialSegments*3;f=[x,w]}return{indices:c,verticesPerFace:u}=Oee(n,p,r,f),{positions:n,indices:c,verticesPerFace:u}}static allocate(e,t){let i,r,s,n=[],c=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,r=e.indexWASM,s=e.verticesPerFaceWASM):(i=E$,r=M$,s=T$);let u=i.length,p=r.length,f=s.length,x=i.length+n.length+c.length,w=r.length+s.length,E=x*Float32Array.BYTES_PER_ELEMENT+w*Uint32Array.BYTES_PER_ELEMENT,A=x*Float32Array.BYTES_PER_ELEMENT,I=w*Uint32Array.BYTES_PER_ELEMENT,P=Cr._malloc(E),O=new Float32Array(Cr.HEAPF32.buffer,P,x),k=new Uint32Array(Cr.HEAPU32.buffer,P+A,w);O.set(i,0),O.set(n,i.length),O.set(c,i.length+n.length),k.set(r,0),k.set(s,r.length);let U;e?.scaleBaked?.some(V=>V!==1)&&(U=new mi().makeScale(...e.scaleBaked)),t&&(U?U.premultiply(t):U=t);let j=U?Cr.alloc_subdivision_surface2(P,u,P+A,p,P+A+r.length*Uint32Array.BYTES_PER_ELEMENT,f,U.elements):Cr.alloc_subdivision_surface(P,u,P+A,p,P+A+r.length*Uint32Array.BYTES_PER_ELEMENT,f);return Cr._free(P),j}static buildLevel(e,t,i,r,s){let n=s?Cr.get_mesh_data2(e,t?Cr.Level.CONTROL:Cr.Level.REFINED,i,s.elements):Cr.get_mesh_data(e,t?Cr.Level.CONTROL:Cr.Level.REFINED,i),c=8,u=Cr.HEAPU32.subarray(n>>2,(n>>2)+c),p=u.subarray(4,8),f=0,x=Cr.HEAPU32[u[f]>>2],w=Cr.HEAPF32.subarray(x>>2,(x>>2)+p[f]);f++;let E=Cr.HEAPU32[u[f]>>2],A=Cr.HEAPF32.subarray(E>>2,(E>>2)+p[f]);f++;let I=Cr.HEAPU32[u[f]>>2],P=Cr.HEAPU32.subarray(I>>2,(I>>2)+p[f]);f++;let O=Cr.HEAPU32[u[f]>>2],k=Cr.HEAPU32.subarray(O>>2,(O>>2)+p[f]);if(f++,r===void 0){let U=new fr;if(U.setIndex(new X_(k,1)),U.setAttribute("position",new Vi(w,3)),U.setAttribute("normal",new Vi(A,3)),t){U.setAttribute("faceMap",new X_(P,1));let j=new Float32Array(A.length/3*4).fill(0);U.setAttribute("color",new Fr(j,4))}return Cr.free_mesh_data(n),U.userData.type="SubdivGeometry",U}r.getAttribute("position").copyArray(w),r.getAttribute("normal").copyArray(A),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,Cr.free_mesh_data(n)}static freeSubdivPointer(e){Cr.free_bvh(e),Cr.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let r=Cr.get_wireframe_data_for_base_level(e),s=4,n=Cr.HEAPU32.subarray(r>>2,(r>>2)+s),c=n.subarray(2,4),u=0,p=Cr.HEAPU32[n[u]>>2],f=Cr.HEAPF32.subarray(p>>2,(p>>2)+c[u]);u++;let x=Cr.HEAPU32[n[u]>>2],w=Cr.HEAPU32.subarray(x>>2,(x>>2)+c[u]);if(t===void 0){let E=new fr;E.setAttribute("position",new Vi(f,3));let A=new Float32Array(f.length);for(let I=0,P=f.length;I<P;)A[I++]=i.r,A[I++]=i.g,A[I++]=i.b;return E.setAttribute("color",new Fr(A,3)),E.setIndex(new X_(w,1)),Cr.free_wireframe_data_for_base_level(r),E}t.getAttribute("position").copyArray(f),t.attributes.position.needsUpdate=!0,Cr.free_wireframe_data_for_base_level(r)}static updateCollabMesh(e,t,i){let r=t===0;r||Cr.set_destination_refinement_level(e,t);let s=i?Cr.get_topological_data2(e,r?Cr.Level.CONTROL:Cr.Level.REFINED,i.elements):Cr.get_topological_data(e,r?Cr.Level.CONTROL:Cr.Level.REFINED),n=6,c=Cr.HEAPU32.subarray(s>>2,(s>>2)+n),u=c.subarray(3,6),p=0,f=Cr.HEAPU32[c[p]>>2],x=new Float32Array(Cr.HEAPF32.subarray(f>>2,(f>>2)+u[p]));p++;let w=Cr.HEAPU32[c[p]>>2],E=new Uint32Array(Cr.HEAPU32.subarray(w>>2,(w>>2)+u[p]));p++;let A=Cr.HEAPU32[c[p]>>2],I=new Uint8Array(Cr.HEAPU32.subarray(A>>2,(A>>2)+u[p]));return Cr.free_topological_data(s),{positions:x,indices:E,verticesPerFace:I}}},A$=["getX","getY","getZ"];function FI(e,t){let i={},r=t?t.count:e.count,s=0,n=[],c=[],u=1e4;for(let f=0;f<r;f++){let x=t?t.getX(f):f,w="";for(let E=0;E<3;E++)w+=`${~~(e[A$[E]](x)*u)},`;if(w in i)n.push(i[w]);else{for(let E=0;E<3;E++)c.push(e[A$[E]](x));i[w]=s,n.push(s),s++}}let p=[];for(let f=0;f<n.length;f+=3)n[f]===n[f+1]||n[f]===n[f+2]||n[f+1]===n[f+2]||p.push(n[f],n[f+1],n[f+2]);return{positions:c,triIndices:p}}var T2=new se,fk=new se,mk=new se,gk=new se;function Oee(e,t,i,r){let s=[],n=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let p=i.userData.shape.extractShapePointsToFlatArray([]),f=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&f<=24&&f%4===0&&i.userData.parameters.angle>=360){let E=p.length/2/f;p=p.filter((A,I)=>Math.floor(I/2)%E===0)}let x=0;for(let E=0;E<p.length;E+=2)x+=(p[E]-p[(E===0?p.length:E)-2])*(p[E+1]+p[(E===0?p.length:E)-1]);e.length=0;let w=0;if(x<0)for(let E=0;E<p.length;E+=2)e.push(p[E],p[E+1],0),s.push(w++);else for(let E=p.length-2;E>=0;E-=2)e.push(p[E],p[E+1],0),s.push(w++);return n.push(w),{indices:s,verticesPerFace:n}}let c=new Float32Array([i.userData.parameters.depth])[0],u=0;for(;u<t.length;){if(i.useNgonForTopBottomFaceDuringBake){let p=0;if((e[t[u]*3+2]===c||e[t[u]*3+2]===0)&&p++,(e[t[u+1]*3+2]===c||e[t[u+1]*3+2]===0)&&p++,(e[t[u+2]*3+2]===c||e[t[u+2]*3+2]===0)&&p++,p===3)break}if(t[u+1]===t[u+3]&&t[u+2]===t[u+5]||t[u+0]===t[u+3]&&t[u+2]===t[u+4]){T2.set(e[t[u]*3],e[t[u]*3+1],e[t[u]*3+2]),fk.set(e[t[u+1]*3],e[t[u+1]*3+1],e[t[u+1]*3+2]),mk.set(e[t[u+4]*3],e[t[u+4]*3+1],e[t[u+4]*3+2]),gk.set(e[t[u+5]*3],e[t[u+5]*3+1],e[t[u+5]*3+2]),fk.sub(T2).normalize(),mk.sub(T2).normalize(),gk.sub(T2).normalize();let p=fk.cross(mk).dot(gk);Math.abs(p)>.005||r&&r.some((f,x)=>x%2===1?!1:u>=r[x]&&u<r[x+1])?(s.push(t[u],t[u+1],t[u+2]),n.push(3),u+=3):(s.push(t[u],t[u+1],t[u+4],t[u+5]),n.push(4),u+=6)}else s.push(t[u],t[u+1],t[u+2]),n.push(3),u+=3}if(i.useNgonForTopBottomFaceDuringBake){let p=[],f=[],x=0;for(let w=0,E=0;w<e.length;w+=3,E++)e[w+2]===0&&(p.push(E),x++),e[w+2]===c&&f.push(E);if(i.userData.parameters.extrudeBevelSize===0){let w=f[0];f[0]=f[1],f[1]=w}p.reverse(),s.push(...p,...f),n.push(x,x)}return{indices:s,verticesPerFace:n}}var sp={};Cme(sp,{calcBoolean:()=>ARe,calcBooleanTopological:()=>TRe,freeMeshSet:()=>PRe,getMeshSet:()=>CRe,hasOpenEdges:()=>DRe,transformMeshSet:()=>IRe});var Lee,SRe=new Promise(e=>{Lee=e}),A2;function ERe(){if(A2)return A2;function e(){return jn(this,null,function*(){let t="https://unpkg.com/@splinetool/boolean-wasm@1.9.20/build",i=import("./chunk-IRU45XNF.js"),[r,s]=yield Promise.all([i,fetch(`${t}/boolean.wasm`).then(u=>u.arrayBuffer())]),n=r.default,c=yield n({wasmBinary:s});Lee(c)})}return A2=e(),A2}var wn,tx;SRe.then(e=>wn=e);function MRe(e,t,i){let r,s;e.userData.parameters.type==="TorusGeometry"&&e.userData.parameters.arc===Math.PI*2?s=e.getClosedTorusIndicesForBooleanOrSubdiv():s=e.getIndex();let{positions:n,triIndices:c}=FI(e.getAttribute("position"),s),u;if(t&&i){let{indices:p,verticesPerFace:f}=Oee(n,c,e);u=f.length,r=[];for(let x=0,w=0;x<u;x++){r.push(f[x]);for(let E=0;E<f[x];E++)r.push(p[w++])}}else{let p=c.length;r=Array(p+p/3),u=0;for(let f=0,x=0;x<r.length;)r[x++]=3,u++,r[x++]=c[f++],r[x++]=c[f++],r[x++]=c[f++]}return{positions:n,faceIndices:r,nFaces:u}}function zee(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,r=t*Float32Array.BYTES_PER_ELEMENT,s=Number.isInteger(e[0])?i:r,n=wn._malloc(s);return(Number.isInteger(e[0])?new Uint32Array(wn.HEAPU32.buffer,n,t):new Float32Array(wn.HEAPF32.buffer,n,t)).set(e,0),n}function Fee(e){switch(e){case 0:return wn.OP.UNION;case 1:return wn.OP.INTERSECTION;case 2:return wn.OP.A_MINUS_B;case 3:return wn.OP.B_MINUS_A;case 4:return wn.OP.SYMMETRIC_DIFFERENCE;case 5:return wn.OP.ALL;default:throw new Error("Unknown boolean operation "+e)}}function TRe(e,t){tx===void 0&&(tx=wn.init_csg());let i=zee(e),r=wn.csg_calc_topological(tx,i,e.length,Fee(t));wn._free(i);let s=6,n=wn.HEAPU32.subarray(r>>2,(r>>2)+s),c=n.subarray(3,6),u=0,p=wn.HEAPU32[n[u]>>2],f=new Float32Array(wn.HEAPF32.subarray(p>>2,(p>>2)+c[u]));u++;let x=wn.HEAPU32[n[u]>>2],w=new Uint32Array(wn.HEAPU32.subarray(x>>2,(x>>2)+c[u]));u++;let E=wn.HEAPU32[n[u]>>2],A=new Uint8Array(wn.HEAPU32.subarray(E>>2,(E>>2)+c[u]));return wn.free_mesh_data(r),{positions:f,indices:w,verticesPerFace:A}}function ARe(e,t,i,r){tx===void 0&&(tx=wn.init_csg());let s=zee(e),n=wn.csg_calc(tx,s,e.length,r,Fee(t));wn._free(s);let c=5,u=wn.HEAPU32.subarray(n>>2,(n>>2)+c),p=u.subarray(2,5),f=0,x=wn.HEAPU32[u[f]>>2],w=wn.HEAPF32.subarray(x>>2,(x>>2)+p[f]);f++;let E=wn.HEAPU32[u[f]>>2],A=wn.HEAPF32.subarray(E>>2,(E>>2)+p[f]);f++;let I=p[f];i.setAttribute("position",new Vi(w,3)),i.setAttribute("normal",new Vi(A,3));let P=wn.HEAPF32.subarray((n>>2)+5,(n>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new jl),i.boundingSphere.center.set(P[0],P[1],P[2]),i.boundingSphere.radius=(P[3]**2+P[4]**2+P[5]**2)**.5,i.userData.parameters={width:P[3]*2,height:P[4]*2,depth:P[5]*2},wn.free_mesh_data(n),I}function CRe(e,t,i){if(wn===void 0)return-1;let r,s,n;if(t&&e.userData.positions!==void 0){let k=e.userData;n=k.verticesPerFace.length,r=k.positions,s=Array(k.verticesPerFace.reduce((U,j)=>U+j,0)+n);for(let U=0,j=0,V=0;U<k.verticesPerFace.length;U++){s[V++]=k.verticesPerFace[U];for(let $=0;$<k.verticesPerFace[U];$++)s[V++]=k.indices[j++]}}else({positions:r,faceIndices:s,nFaces:n}=MRe(e,t,i));let c=r.length,u=s.length,p=r.length,f=s.length,x=p*Float32Array.BYTES_PER_ELEMENT+f*Uint32Array.BYTES_PER_ELEMENT,w=p*Float32Array.BYTES_PER_ELEMENT,E=f*Uint32Array.BYTES_PER_ELEMENT,A=wn._malloc(x),I=new Float32Array(wn.HEAPF32.buffer,A,p),P=new Uint32Array(wn.HEAPU32.buffer,A+w,f);I.set(r,0),P.set(s,0);let O=wn.get_csg_mesh(A,c,A+w,u,n);return wn._free(A),O}function DRe(e){return wn.has_open_edges(e)}function IRe(e,t){wn.transform_csg_mesh(e,t.elements)}function PRe(e){wn.free_csg_mesh(e)}var RRe={ConeGeometry:QIe,CubeGeometry:KIe,CylinderGeometry:uee,DodecahedronGeometry:ePe,EllipseGeometry:cU,HelixGeometry:RPe,IcosahedronGeometry:OPe,LatheGeometry:LPe,NonParametricGeometry:jPe,PolygonGeometry:Aee,PyramidGeometry:VPe,RectangleGeometry:uU,SphereGeometry:WPe,PlaneGeometry:qPe,BackdropGeometry:YPe,StarGeometry:Cee,TextFrameGeometry:$Pe,TorusGeometry:ZPe,TorusKnotGeometry:KPe,TriangleGeometry:JPe,PathGeometry:fRe,VectorGeometry:Xy},C$=e=>RRe[e.type].create(e);function M_(e){return e!==null&&"booleanOp"in e}var kee=class extends rU($s){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new mi}updateVisible(e){super.updateVisible(e),this.visible=!M_(this.parent)&&this.visible,M_(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(sp.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),M_(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof kee&&(e.freeBooleanPointer(),M_(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e,t){let i=super.updateTransformState(e,t);return i&&M_(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(e=!1){super.onVariableUpdate(e),M_(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},C2=new mo;function hU(e,t=0,i=e.count,r,s){let n=1/0,c=1/0,u=1/0,p=-1/0,f=-1/0,x=-1/0;for(let w=t;w<i;w++){let E=e.getX(w),A=e.getY(w),I=e.getZ(w);E<n&&(n=E),A<c&&(c=A),I<u&&(u=I),E>p&&(p=E),A>f&&(f=A),I>x&&(x=I)}C2.min.set(n,c,u),C2.max.set(p,f,x),C2.getCenter(r),C2.getSize(s).multiplyScalar(.5)}var ORe=new fr,LRe=new Sp,wl=class extends kee{constructor(e,t){super(ORe,LRe),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?hU(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},Jf=class{constructor(e){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},Jf.uuidContext===null)throw new Error("plz startContext");Jf.uuidContext===Jf.globalContext?this.uuid="_gid"+Jf.uuidContext.nodeContextUuid++:this.uuid="_uid"+Jf.uuidContext.nodeContextUuid++,this.type=e,this.name=""}static startContext(e){this.uuidContext===null||this.uuidContext===Jf.globalContext?this.uuidContext=e:console.error("Can't start context twice")}static endContext(e){this.uuidContext!==e&&console.error("Can't end context twice"),this.uuidContext=null}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return i=i??{},this.analyze(e,i),this.flow(e,t,i)}flow(e,t,i){i=i??{},e.addFlow(i.slot,i.cache,i.context);let r={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),r}build(e,t,i){t=t??this.getType(e,t);let r=e.getNodeData(i??this);return e.analyzing&&this.appendDepsNode(e,r,t),e.nodes.indexOf(this)===-1&&e.nodes.push(this),this.updateFrame!==void 0&&e.updaters.indexOf(this)===-1&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,r,s,n){return""}generate(e,t,i,r,s){return""}parse(e,t,i,r){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let r=e.getTypeLength(i);(r>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=r,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return t==="sampler2D"||t==="samplerCube"?t:this.type}},Xo=Jf;Xo.globalContext={nodeContextUuid:0},Xo.uuidContext=Jf.globalContext;var D$=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},zRe=class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){i=i!==void 0?i:!0,this.keywords[e]={callback:t,cache:i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return this.nodes[e]!==void 0}containsKeyword(e){return this.keywords[e]!==void 0}},Nl=new zRe,ms=class extends Xo{constructor(e,t){super(e),this.scope="",t=t??{},this.shared=t.shared!==void 0?t.shared:!0,this.unique=t.unique!==void 0?t.unique:!1}build(e,t,i,r){if(t=t??this.getType(e),this.getShared(e,t)){let s=this.getUnique(e,t);s&&this.uuid===void 0&&(this.uuid=Yi.generateUUID()),i=e.getUUID(i??this.getUUID(),!s);let n=e.getNodeData(i),c=n.output||this.getType(e);if(e.analyzing)return(n.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,n,t),this.generate(e,t,i)):super.build(e,t,i);if(s)return n.name=n.name||super.build(e,t,i),n.name;if(!this.getLabel()&&(!this.getShared(e,c)||e.context.ignoreCache||n.deps===1))return super.build(e,t,i);i=this.getUUID(!1);let u=this.getTemp(e,i);if(u)return e.format(u,c,t);{u=super.generate(e,t,i,n.output,r);let p=this.generate(e,c,i);return e.addNodeCode(u+" = "+p+";"),e.format(u,c,t)}}return super.build(e,t,i)}getShared(e,t){return t!=="sampler2D"&&t!=="samplerCube"&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return typeof this.scope=="string"&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,r,s){return this.getShared(e,t)||console.error("TempNode is not shared"),i=i??this.uuid,e.getTempVar(i,r??this.getType(e),s,this.getLabel()).name}},Vl=class extends ms{constructor(e,t){t=t??{},t.shared=t.shared!==void 0?t.shared:!1,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,r,s,n){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let c=e.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(e,t,i,r,s,n):e.isShader("vertex")?(c.vertex||(c.vertex=e.createVertexUniform(r,this,s,n,this.getLabel())),e.format(c.vertex.name,r,t)):(c.fragment||(c.fragment=e.createFragmentUniform(r,this,s,n,this.getLabel())),e.format(c.fragment.name,r,t))}},Aa=class extends Vl{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof lt?e:new lt(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,r,s,n){return e.format("vec2("+this.value.x+", "+this.value.y+")",r,t)}},Hc=class extends Vl{constructor(e=0,t,i){super("v3"),this.nodeType="Vector3",this.value=e instanceof se?e:new se(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,r,s,n){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,t)}},La=class extends Tr{constructor(e,t,i,r){super(e,t,i),this.isColorA=!0,this.a=r}setRGBA(e,t,i,r){super.setRGB(e,t,i),this.a=r}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(e){return super.equals(e)&&this.a===e.a}setStyle(e,t="srgb"){let i;if(e==="transparent")return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let r,s=i[1],n=i[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.a=s==="rgba"?parseFloat(r[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.a=s==="hsla"?parseFloat(r[4]):1,super.setStyle(e,t);break}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},op=class extends Vl{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof La?e:new La(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,r,s,n){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,t)}},FRe=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,I$=/[a-z_0-9]+/gi,Ni=class extends ms{constructor(e,t,i,r,s){super(s),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=s===void 0,this.isInterface=!1,this.parse(e,t,i,r)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,r,s){let n,c=0,u=this.src;if(this.includes)for(let f=0;f<this.includes.length;f++)e.include(this.includes[f],this);for(let f in this.extensions)e.extensions[f]=!0;let p=[];for(;n=I$.exec(this.src);)p.push(n);for(let f=0;f<p.length;f++){let x=p[f],w=x[0],E=this.isMethod?!this.getInputByName(w):!0,A=w;if(this.keywords[w]||this.useKeywords&&E&&Nl.containsKeyword(w)){let I=this.keywords[w];if(!I){let P=Nl.getKeywordData(w);P.cache&&(I=e.keywords[w]),I=I||Nl.getKeyword(w,e),P.cache&&(e.keywords[w]=I)}A=I.build(e)}w!==A&&u[x.index+c-1]!=="."&&(u=u.substring(0,x.index+c)+A+u.substring(x.index+w.length+c),c+=A.length-w.length),this.getIncludeByName(A)===void 0&&Nl.contains(A)&&e.include(Nl.get(A))}return t==="source"?u:this.isMethod?(this.isInterface||e.include(this,void 0,u),this.name):e.format("( "+u+" )",this.getType(e),t)}parse(e,t,i,r){if(this.src=e||"",this.includes=t??[],this.extensions=i??{},this.keywords=r??{},this.isMethod){let s=FRe.exec(this.src);if(this.inputs=[],s&&s.length==4){this.type=s[1],this.name=s[2];let n=s[3].match(I$);if(n){let c=0;for(;c<n.length;){let u=n[c++],p;u==="in"||u==="out"||u==="inout"?p=n[c++]:(p=u,u="");let f=n[c++];this.inputs.push({name:f,type:p,qualifier:u})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},kRe=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,Nee=class extends ms{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||Nee.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,r,s){this.src=e||"";let n,c,u="",p=kRe.exec(e);this.useDefine=s??this.src.charAt(0)==="#",p&&p.length>1?(c=p[1],n=p[2],u=p[3]):(n=this.src,c="f"),this.name=n,this.type=c,this.value=u}build(e,t){if(t==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,r,s){return e.format(this.name,this.getType(e),t)}},ds=Nee;ds.PI="PI",ds.PI2="PI2",ds.RECIPROCAL_PI="RECIPROCAL_PI",ds.RECIPROCAL_PI2="RECIPROCAL_PI2",ds.LOG2="LOG2",ds.EPSILON="EPSILON";var NRe=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),BRe=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),Bee=class extends ms{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,r,s){return t==="source"?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=NRe.exec(e);if(t){let i=t[2],r;for(;r=BRe.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=t[1]}else this.name="";this.type=this.name}},dU=class extends ms{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(r,this.getType(e),t)}};Nl.addKeyword("uv",function(){return new dU});Nl.addKeyword("uv2",function(){return new dU(1)});var N_=class extends ms{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??N_.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case Xu:return["Linear"];case sn:return["sRGB"];default:return[]}}generate(e,t){let i=this.input.build(e,"v4"),r=this.getType(e),s=N_.Nodes[this.method],n=e.include(s);if(n===N_.LINEAR_TO_LINEAR)return e.format(i,r,t);if(s.inputs?.length===2){let c=this.factor.build(e,"f");return e.format(n+"( "+i+", "+c+" )",r,t)}else return e.format(n+"( "+i+" )",r,t)}fromEncoding(e){let t=N_.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=N_.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},Xh=N_;Xh.Nodes={LinearToLinear:new Ni(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new Ni(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new Ni(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},Xh.LINEAR_TO_LINEAR="LinearToLinear",Xh.SRGB_TO_LINEAR="sRGBToLinear",Xh.LINEAR_TO_SRGB="LinearTosRGB";var zs=class extends Ni{constructor(e="",t,i,r,s){super(e,s,r,i,t),this.nodeType="Expression"}},dp=class extends Vl{constructor(e=new Zs,t,i,r){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new dU,this.bias=i,this.project=r!==void 0?r:!1}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if(t==="sampler2D")return this.getTexture(e,t);let i=this.getTexture(e,t),r=this.uv.build(e,this.project?"v4":"v2"),s=this.bias?this.bias.build(e,"f"):void 0;s===void 0&&e.context.bias&&(s=e.context.bias.setTexture(this).build(e,"f"));let n,c;this.project?n="texture2DProj":n=s?"tex2DBias":"tex2D",s?c=n+"( "+i+", "+r+", "+s+" )":c=n+"( "+i+", "+r+" )";let u={include:e.isShader("vertex"),ignoreCache:!0},p=this.getType(e);return e.addContext(u),this.colorSpace=this.colorSpace??new Xh(new zs("",p)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(c),c=this.colorSpace.build(e,p),e.removeContext(),e.format(c,p,t)}},Zi=class extends Vl{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,i,r,s,n){return e.format(this.value+(this.value%1?"":".0"),r,t)}},P$=class extends ms{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,r,s){r=this.getType(e);let n=this.value,c=n.build(e,t)+"( ",u=[];if(n.inputs){for(let p=0;p<n.inputs.length;p++){let f=n.inputs[p],x=this.inputs[p]||this.inputs[f.name];u.push(x.build(e,e.getTypeByFormat(f.type)))}c+=u.join(", ")+" )"}return e.format(c,r,t)}},Uee=class extends ms{constructor(e,t,i=Uee.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let r=this.a.build(e,i),s=this.b.build(e,i);return e.format("( "+r+" "+this.op+" "+s+" )",i,t)}},Ll=Uee;Ll.ADD="+",Ll.SUB="-",Ll.MUL="*",Ll.DIV="/";var hs=class extends ms{constructor(e,t=hs.ABS,i,r){super(),this.nodeType="Math",this.a=e,typeof t!="string"?this.b=t:r=t,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case hs.MIX:case hs.CLAMP:case hs.REFRACT:case hs.SMOOTHSTEP:case hs.FACEFORWARD:return 3;case hs.MIN:case hs.MAX:case hs.MOD:case hs.STEP:case hs.REFLECT:case hs.DISTANCE:case hs.DOT:case hs.CROSS:case hs.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,r=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>r?this.a.getType(e):i>r?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case hs.LENGTH:case hs.DISTANCE:case hs.DOT:return"f";case hs.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,r,s,n=this.a?e.getTypeLength(this.a.getType(e)):0,c=this.b?e.getTypeLength(this.b.getType(e)):0,u=this.c?e.getTypeLength(this.c.getType(e)):0,p=this.getInputType(e),f=this.getType(e);switch(this.type=f,this.method){case hs.NEGATE:return e.format("( -"+this.a.build(e,p)+" )",p,t);case hs.INVERT:return e.format("( 1.0 - "+this.a.build(e,p)+" )",p,t);case hs.CROSS:i=this.a.build(e,"v3"),r=this.b.build(e,"v3");break;case hs.STEP:i=this.a.build(e,n===1?"f":p),r=this.b.build(e,p);break;case hs.MIN:case hs.MAX:case hs.MOD:i=this.a.build(e,p),r=this.b.build(e,c===1?"f":p);break;case hs.REFRACT:i=this.a.build(e,p),r=this.b.build(e,p),s=this.c.build(e,"f");break;case hs.MIX:i=this.a.build(e,p),r=this.b.build(e,p),s=this.c.build(e,u===1?"f":p);break;default:i=this.a.build(e,p),this.b&&(r=this.b.build(e,p)),this.c&&(s=this.c.build(e,p));break}let x=[];x.push(i),r&&x.push(r),s&&x.push(s);let w=this.getNumInputs(e);if(x.length!==w)throw Error(`Arguments not match used in "${this.method}". Require ${w}, currently ${x.length}.`);return e.format(this.method+"( "+x.join(", ")+" )",f,t)}},Jr=hs;Jr.RAD="radians",Jr.DEG="degrees",Jr.EXP="exp",Jr.EXP2="exp2",Jr.LOG="log",Jr.LOG2="log2",Jr.SQRT="sqrt",Jr.INV_SQRT="inversesqrt",Jr.FLOOR="floor",Jr.CEIL="ceil",Jr.NORMALIZE="normalize",Jr.FRACT="fract",Jr.SATURATE="saturate",Jr.SIN="sin",Jr.COS="cos",Jr.TAN="tan",Jr.ASIN="asin",Jr.ACOS="acos",Jr.ARCTAN="atan",Jr.ABS="abs",Jr.SIGN="sign",Jr.LENGTH="length",Jr.NEGATE="negate",Jr.INVERT="invert",Jr.MIN="min",Jr.MAX="max",Jr.MOD="mod",Jr.STEP="step",Jr.REFLECT="reflect",Jr.DISTANCE="distance",Jr.DOT="dot",Jr.CROSS="cross",Jr.POW="pow",Jr.MIX="mix",Jr.CLAMP="clamp",Jr.REFRACT="refract",Jr.SMOOTHSTEP="smoothstep",Jr.FACEFORWARD="faceforward";var eS=class extends ms{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,r){let s=new P$(eS.Nodes.bilinearCubeUV,[t,i,r]);this.colorSpaceTL=this.colorSpaceTL??new Xh(new zs("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(s.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new Xh(new zs("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(s.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new Xh(new zs("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(s.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new Xh(new zs("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(s.build(e)+".br");let n={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(n),this.colorSpaceTLExp=new zs(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new zs(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new zs(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new zs(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let c=new zs("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return c.keywords.cubeUV_TL=this.colorSpaceTLExp,c.keywords.cubeUV_TR=this.colorSpaceTRExp,c.keywords.cubeUV_BL=this.colorSpaceBLExp,c.keywords.cubeUV_BR=this.colorSpaceBRExp,c.keywords.cubeUV=s,c}generate(e,t){if(e.isShader("fragment")){let i=this.uv,r=this.bias||e.context.roughness,s=new P$(eS.Nodes.roughnessToMip,[r]),n=new Jr(s,eS.Nodes.m0,eS.Nodes.cubeUV_maxMipLevel,Jr.CLAMP),c=new Jr(n,Jr.FLOOR),u=new Jr(n,Jr.FRACT),p=this.bilinearCubeUV(e,this.value,i,c),f=this.bilinearCubeUV(e,this.value,i,new Ll(c,new Zi(1).setReadonly(!0),Ll.ADD)),x=new Jr(p,f,u,Jr.MIX);return e.format(x.build(e),"v4",t)}else return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},PB=eS;PB.Nodes=function(){let e=new Bee(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new ds("float cubeUV_maxMipLevel 8.0",!0),i=new ds("float cubeUV_minMipLevel 4.0",!0),r=new ds("float cubeUV_maxTileSize 256.0",!0),s=new ds("float cubeUV_minTileSize 16.0",!0),n=new Ni(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);n.useKeywords=!1;let c=new Ni(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);c.useKeywords=!1;let u=new Ni(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,n,c,t,i,r,s]);u.useKeywords=!1;let p=new ds("float r0 1.0",!0),f=new ds("float v0 0.339",!0),x=new ds("float m0 -2.0",!0),w=new ds("float r1 0.8",!0),E=new ds("float v1 0.276",!0),A=new ds("float m1 -1.0",!0),I=new ds("float r4 0.4",!0),P=new ds("float v4 0.046",!0),O=new ds("float m4 2.0",!0),k=new ds("float r5 0.305",!0),U=new ds("float v5 0.016",!0),j=new ds("float m5 3.0",!0),V=new ds("float r6 0.21",!0),$=new ds("float v6 0.0038",!0),Y=new ds("float m6 4.0",!0),J=[p,f,x,w,E,A,I,P,O,k,U,j,V,$,Y],X=new Ni(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,J);return{bilinearCubeUV:u,roughnessToMip:X,m0:x,cubeUV_maxMipLevel:t}}();var B_=class extends ms{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??B_.VIEW}getShared(){return this.scope===B_.WORLD}build(e,t,i,r){let s=e.context[this.scope+"Normal"];return s?s.build(e,t,i,r):super.build(e,t,i)}generate(e,t,i,r,s){let n;switch(this.scope){case B_.VIEW:e.isShader("vertex")?n="transformedNormal":n="geometryNormal";break;case B_.LOCAL:e.isShader("vertex")?n="objectNormal":(e.requires.normal=!0,n="vObjectNormal");break;case B_.WORLD:e.isShader("vertex")?n="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,n="vWNormal");break}return e.format(n,this.getType(e),t)}},Bl=B_;Bl.LOCAL="local",Bl.WORLD="world",Bl.VIEW="view",Bl.NORMAL="normal";Nl.addKeyword("viewNormal",function(){return new Bl(Bl.VIEW)});Nl.addKeyword("localNormal",function(){return new Bl(Bl.NORMAL)});Nl.addKeyword("worldNormal",function(){return new Bl(Bl.WORLD)});var rp=class extends ms{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??rp.LOCAL}getType(){switch(this.scope){case rp.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case rp.LOCAL:case rp.WORLD:return!1}return!0}generate(e,t,i,r,s){let n;switch(this.scope){case rp.LOCAL:e.isShader("vertex")?n="transformed":(e.requires.position=!0,n="vPosition");break;case rp.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,n="vWPosition";break;case rp.VIEW:n=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case rp.PROJECTION:n=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return e.format(n,this.getType(),t)}},Gu=rp;Gu.LOCAL="local",Gu.WORLD="world",Gu.VIEW="view",Gu.PROJECTION="projection";Nl.addKeyword("position",function(){return new Gu});Nl.addKeyword("worldPosition",function(){return new Gu(Gu.WORLD)});Nl.addKeyword("viewPosition",function(){return new Gu(Gu.VIEW)});var Uh=class extends ms{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??Uh.CUBE}getUnique(e){return!e.context.viewNormal}getType(){switch(this.scope){case Uh.SPHERE:return"v2"}return this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let r;switch(this.scope){case Uh.VECTOR:{let s=new Bl(Bl.VIEW),n=e.context.roughness,c=s.build(e,"v3"),u=new Gu(Gu.VIEW).build(e,"v3"),p=n?n.build(e,"f"):void 0,f=`reflect( -normalize( ${u} ), ${c} )`;p&&(f=`normalize( mix( ${f}, ${c}, ${p} * ${p} ) )`);let x=`inverseTransformDirection( ${f}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${x};`),r="reflectVec"):r=x;break}case Uh.CUBE:{let s=new Uh(Uh.VECTOR).build(e,"v3"),n="vec3( -"+s+".x, "+s+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${n};`),r="reflectCubeVec"):r=n;break}case Uh.SPHERE:{let s="normalize( ( viewMatrix * vec4( "+new Uh(Uh.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${s};`),r="reflectSphereVec"):r=s;break}}return e.format(r,this.getType(),t)}else return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},ix=Uh;ix.CUBE="cube",ix.SPHERE="sphere",ix.VECTOR="vector";var URe=class extends ms{constructor(e=new dp,t,i){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new PB(this.value,t??new ix(ix.VECTOR),i),this.irradianceNode=new PB(this.value,new Bl(Bl.WORLD),new Zi(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),(e.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},jRe=class extends Vl{constructor(e=new m4,t,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new ix,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){if(t==="samplerCube")return this.getTexture(e,t);let i=this.getTexture(e,t),r=this.uv?.build(e,"v3"),s=this.bias?this.bias.build(e,"f"):void 0;s===void 0&&e.context.bias&&(s=e.context.bias.setTexture(this).build(e,"f"));let n;s?n="texCubeBias( "+i+", "+r+", "+s+" )":n="texCube( "+i+", "+r+" )";let c={include:e.isShader("vertex"),ignoreCache:!0},u=this.getType(e);return e.addContext(c),this.colorSpace=this.colorSpace??new Xh(new zs("",u)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(n),n=this.colorSpace.build(e,u),e.removeContext(),e.format(n,u,t)}},VRe=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,GRe=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,HRe=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,WRe=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,qRe=`
layout(location = 1) out vec4 gVelocity;
`,YRe=`
    // Discard fully transparent pixels 
    if (gl_FragColor.a <= 0.0) discard;

    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);
`,R$=["x","y","z","w"],XRe=["float","vec2","vec3","vec4"],$Re={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},ZRe={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},jee=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(t,i){return t.deps.length-i.deps.length}return function(t,i){let r=this.getIncludes(t,i);if(!r)return"";let s="";r=r.sort(e);for(let n=0;n<r.length;n++)r[n].src&&(s+=r[n].src+`
`);return s}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode(VRe),this.addFragmentParsCode(GRe),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(HRe),this.addFragmentFinalCode(WRe)),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){this.fragmentVariables[e]===void 0&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){this.fragmentParsVariables[e]===void 0&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){this.vertexParsVariables[e]===void 0&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+`
`}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+`
`}clearNodeCode(e){e=e??this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+`
`}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+`
`}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return this.caches.indexOf(e)!==-1}isSlot(e){return this.slots.indexOf(e)!==-1}define(e,t){this.defines[e]=t===void 0?1:t}require(e){this.requires[e]=!0}isDefined(e){return this.defines[e]!==void 0}getVar(e,t,i,r="varying",s="V",n=""){let c=this.getVars(r),u=c[e];if(!u){let p=c.length;u={name:i||"node"+s+p+(n?"_"+n:""),type:t},c.push(u),c[e]=u}return u}getTempVar(e,t,i,r){return this.getVar(e,t,i,this.shader,"T",r)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join(`
`)}getVarListCode(e,t){t=t??"";let i="";for(let r=0,s=e.length;r<s;++r){let n=e[r],c=n.type,u=n.name,p=n.size,f=this.getFormatByType(c);if(f===void 0)throw new Error("Node pars "+f+" not found.");f.includes("[]")?i+=t+" "+f.substring(0,f.length-2)+" "+u+`[${p}];
`:i+=t+" "+f+" "+u+`;
`}return i}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof Xo?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,r,s,n){if(t.includes("[]")){let c=this.inputs.arrayUniforms,u=c.list.length,p=new D$({type:t,size:i.size,name:r||"nodeUA"+u+(n?"_"+n:""),node:i,needsUpdate:s});return c.list.push(p),c[e].push(p),c[e][p.name]=p,this.uniforms[p.name]=p,p}else{let c=this.inputs.uniforms,u=c.list.length,p=new D$({type:t,name:r||"nodeU"+u+(n?"_"+n:""),node:i,needsUpdate:s});return c.list.push(p),c[e].push(p),c[e][p.name]=p,this.uniforms[p.name]=p,p}}createVertexUniform(e,t,i,r,s){return this.createUniform("vertex",e,t,i,r,s)}createFragmentUniform(e,t,i,r,s){return this.createUniform("fragment",e,t,i,r,s)}include(e,t,i){let r;if(e=typeof e=="string"?Nl.get(e):e,this.context.include===!1)return e.name;e instanceof Ni?r=this.includes.functions:e instanceof ds?r=this.includes.consts:e instanceof Bee&&(r=this.includes.structs);let s=r[this.shader]=r[this.shader]||[];if(e){let n=s[e.name];if(n||(n=s[e.name]={node:e,deps:[]},s.push(n),n.src=e.build(this,"source")),e instanceof Ni&&t&&s[t.name]&&s[t.name].deps.indexOf(e)===-1&&(s[t.name].deps.push(e),e.includes?.length)){let c=0;do this.include(e.includes[c++],t);while(c<e.includes.length)}return i&&(n.src=i),e.name}else throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return XRe[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return e==="f"?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return e===1?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i?.isNode)return i}}resolve(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case ky:case Ny:return new jRe(i);case US:return new URe(new dp(i));default:return new dp(i)}else{if(i.isVector2)return new Aa(i);if(i.isVector3)return new Hc(i);if(i.isVector4)return new op(i)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":return e+".x";case"f <- v3":return e+".x";case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":return e+".xy";case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":return"int( "+e+".x )";case"i <- v3":return"int( "+e+".x )";case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return $Re[e]||e}getFormatByType(e){return ZRe[e]||e}getUUID(e,t){return t=t!==void 0?t:!0,t&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return R$[e]}getIndexByElement(e){return R$.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=Xu,t===Xu&&this.context.gamma&&(t=sn),t}},ro=class extends Vl{constructor(e=0,t,i,r){super("c"),this.nodeType="Color",this.value=e instanceof La?e:new La(e||0,t,i,r)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,r,s,n){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let c=e.getNodeData(i),u=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let p=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${p};`)}return u?this.generateReadonly(e,t,i,r,s,n):e.isShader("vertex")?(c.vertex||(c.vertex=e.createVertexUniform(r,this,s,n,this.getLabel())),e.format(c.vertex.name,r,t)):(c.fragment||(c.fragment=e.createFragmentUniform(r,this,s,n,this.getLabel())),e.format(c.fragment.name,r,t))}generateReadonly(e,t,i,r,s,n){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,t)}},bs=class extends Vl{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,i,r,s,n){return e.format(this.value.toString(),r,t)}},vl=class extends Vl{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,i,r){return e.format(this.value?"true":"false",r,t)}},py=class extends Vl{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:typeof t=="number"?new Array(e).fill(t):new Array(e).fill(0)}},pU=class extends Vl{},QRe=class extends pU{constructor(e){super("v3"),this.image=e,this._value=new se}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},RB=class extends pU{constructor(e,t,i=1008,r=1006){super("t"),this.image=e,this.wrap=t,this.minFilter=i,this.magFilter=r}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}},Vee=class extends Vl{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new Ao}generateReadonly(e,t,i,r,s,n){return e.format("mat3("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},rd=class extends Vl{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new mi}generateReadonly(e,t,i,r,s,n){return e.format("mat4("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function O$(e,t,i,r=0){e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0).premultiply(new Ao().makeRotation(r*Yi.DEG2RAD))}var KRe=class extends Vee{constructor(e,t,i=0){super(new Ao),this.repeat=e,this.offset=t,this.rotation=i,O$(this.value,e,t,i)}updateMatrix(){O$(this.value,this.repeat,this.offset,this.rotation)}},fy=class extends Vl{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof Gr?new Array(e).fill(t):new Array(e).fill(new Gr(0))}},L$=class extends ms{constructor(e,t,i,r){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=r}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}else return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Gee=class extends ms{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(Gee.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.color.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},OB=Gee;OB.Nodes=function(){return{customColor:new Ni(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}}();var Hee=class extends ms{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(Hee.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.cnormal.build(e,"v3")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Wee=Hee;Wee.Nodes=function(){return{customNormal:new Ni(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}}();var tS=class extends ms{constructor(e,t,i,r,s,n,c,u,p,f,x,w){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=i,this.projection=r,this.axis=s,this.side=n,this.size=c,this.blending=u,this.mat=p,this.isMask=w,this.alpha=f,this.mode=x,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=e.include(tS.Nodes.cylindrical);break;case 2:r=e.include(tS.Nodes.spherical);break;case 1:let n=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],c=["zy","xz","xy"][this.axis.value],u=new Ni(`
		vec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${c})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, ${n}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);r=e.include(u);break;case 4:r=e.include(tS.Nodes.triplanar);break;default:r=e.include(tS.Nodes.uv);break}e.addFragmentVariable(this.calpha,"float");let s=[];if(s.push("normal"),s.push(this.texture.generate(e,"t")),s.push(this.textureSize.build(e,"v2")),s.push(this.crop.build(e,"f")),s.push(this.mat.build(e,"mat3")),s.push(this.size.build(e,"v2")),s.push(this.blending.build(e,"f")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.mode.build(e,"i")),s.push(this.calpha),this.projection.value===4){let n=`${i}_writeUvs`,c=n+"0",u=n+"1",p=n+"2",f=`${i}_triplanarWeights`;e.addFragmentVariable(c,"vec2"),e.addFragmentVariable(u,"vec2"),e.addFragmentVariable(p,"vec2"),e.addFragmentVariable(f,"vec3"),s.push(c),s.push(u),s.push(p),s.push(f)}else{let n=`${i}_writeUvs`;e.addFragmentVariable(n,"vec2"),s.push(n)}return e.format(r+"("+s.join(",")+")",this.getType(e),t)}},fU=tS;fU.Nodes=function(){let e=new Ni(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),t=new Ni(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),i=new Ni(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),r=new Ni(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:e,spherical:t,uv:i,triplanar:r}}();var iS=class extends ms{constructor(e,t,i,r,s,n,c,u,p,f,x,w){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=r,this.isVector=s,this.isWorldSpace=n,this.origin=c,this.direction=u,this.colors=p,this.steps=f,this.isMask=w,this.alpha=x,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new Ni(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[iS.Nodes.vectorLinearWorldSpaceDepth,iS.Nodes.vectorLinearObjectSpaceDepth,iS.Nodes.vectorSphericalObjectSpaceDepth,iS.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let s=e.include(r),n=[];return n.push(this.near.build(e,"f")),n.push(this.far.build(e,"f")),n.push(this.origin.build(e,"v3")),n.push(this.direction.build(e,"v3")),n.push(this.colors.build(e,"v4[]")),n.push(this.steps.build(e,"f[]")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(s+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},qee=iS;qee.Nodes=function(){let e=new Ni(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),t=new Ni(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new Ni(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new Ni(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:e,vectorLinearObjectSpaceDepth:t,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}}();var JRe=class extends ms{constructor(e,t,i,r,s,n,c,u){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=r,this.factor=s,this.isMask=u,this.alpha=n,this.mode=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=new Ni(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),r=e.include(i),s=[];return s.push(this.color.build(e,"c")),s.push(this.bias.build(e,"f")),s.push(this.scale.build(e,"f")),s.push(this.intensity.build(e,"f")),s.push(this.factor.build(e,"f")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.mode.build(e,"i")),s.push(this.calpha),e.format(r+"("+s.join(",")+")",this.getType(e),t)}else return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Yee=class extends ms{constructor(e,t,i,r,s,n,c,u,p){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=r,this.offset=s,this.morph=n,this.angle=c,this.isMask=p,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(Yee.Nodes.gradient),r=[];return r.push(this.gradientType.build(e,"i")),r.push(this.smooth.build(e,"b")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.offset.build(e,"v2")),r.push(this.morph.build(e,"v2")),r.push(this.angle.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Xee=Yee;Xee.Nodes=function(){return{gradient:new Ni(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}}();var $ee=class extends ms{constructor(e,t,i,r,s){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=r,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=s}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include($ee.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let r=[];return r.push(this.texture.generate(e,"t")),r.push("normal"),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),r.push(this.rotation.build(e,"f")),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Zee=$ee;Zee.Nodes=function(){return{matcap:new Ni(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) );
					uv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;
					uv = uv * 0.495 + 0.5;
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}}();var mU=(e=>(e.SIMPLEX="simplex3d",e.SIMPLEX_FRACTAL="simplex3dFractal",e.ASHIMA="simplexAshima",e.FBM="fbm",e.PERLIN="perlin",e.VORONOI="voronoi",e))(mU||{}),Fl=function(){let e=new Ni(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),t=new Ni(`float simplex3d(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);t.keywords.F3=new ds("float F3 0.3333333"),t.keywords.G3=new ds("float G3 0.1666667");let i=new Ni(`float simplex3dFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplex3d(m * rot1)
				 + 0.2666667 * simplex3d(2.0 * m * rot2)
				 + 0.1333333 * simplex3d(4.0 * m * rot3)
				 + 0.0666667 * simplex3d(8.0 * m);
		}`,[t]),r=new Ni("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new Ni("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),n=new Ni(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[r,s]),c=new Ni("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),u=new Ni("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[c]),p=new Ni(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[u]),f=new Ni(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[p]);f.keywords.NUM_OCTAVES=new ds("int NUM_OCTAVES 5");let x=new Ni("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),w=new Ni(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[r,s,x]),E=new Ni(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),A=new Ni(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),I=new Ni(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),P=new Ni(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),O=new Ni(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),k=new Ni(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),U=new Ni(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			float id = hashwithoutsine13(vec3(p + mb) + seed);

			// Second pass for edge distance  
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[E,A,I,P,O,k]);return{simplex:t,simplexFractal:i,simplexAshima:n,fbm:f,perlin:w,voronoi:U}}(),Qee=class extends ms{constructor(e,t,i,r,s,n,c,u,p,f,x,w,E,A,I,P,O,k,U){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=r,this.fB=s,this.distortion=n,this.colorA=c,this.colorB=u,this.colorC=p,this.colorD=f,this.noiseType=w,this.voronoiStyle=A,this.highCut=I,this.lowCut=P,this.smoothness=O,this.seed=k,this.quality=U,this.isMask=E,this.alpha=x,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,r,s){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let n=Object.values(mU)[this.noiseType.value],c=n=="voronoi"?`
		float v = ${n}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${n}(st),
					   ${n}(st + vec3(1.0)),
					   ${n}(st + vec3(1.0)));
		vec3 r = vec3(${n}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${n}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${n}(st * q));
		float f = ${n}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,u=new Ni(`vec3 ${n}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${c}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[Fl.simplex,Fl.simplexFractal,Fl.simplexAshima,Fl.fbm,Fl.perlin,Fl.voronoi]),p=e.include(u),f=[];return f.push(this.scale.build(e,"f")),f.push(this.size.build(e,"v3")),f.push(this.move.build(e,"f")),f.push(this.fA.build(e,"v2")),f.push(this.fB.build(e,"v2")),f.push(this.distortion.build(e,"v2")),f.push(this.colorA.build(e,"v4")),f.push(this.colorB.build(e,"v4")),f.push(this.colorC.build(e,"v4")),f.push(this.colorD.build(e,"v4")),f.push(this.voronoiStyle.build(e,"i")),f.push(this.highCut.build(e,"f")),f.push(this.lowCut.build(e,"f")),f.push(this.smoothness.build(e,"f")),f.push(this.seed.build(e,"f")),f.push(this.quality.build(e,"i")),f.push(this.isMask.build(e,"b")),f.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),f.push(this.alpha.build(e,"f")),f.push(this.calpha),e.format(p+"("+f.join(",")+")",this.getType(e),t)}};Qee.numOctaves=5;var Kee=class extends ms{constructor(e,t,i,r,s,n,c,u,p,f,x,w,E,A,I,P){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=s,this.outlineThreshold=n,this.contourFrequency=c,this.outlineSmoothing=u,this.contourDirection=p,this.positionalLines=f,this.compensation=x,this.resolution=w,this.normalMap=E,this.depthMap=A,this.pixelRatio=I,this.alpha=P,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let r=this.outlineWidth.build(e,"f"),s=this.resolution.build(e,"v2"),n=this.compensation.build(e,"b"),c=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(r,"uniform float"),e.addVertexParsVariable(s,"uniform vec2"),e.addVertexParsVariable(n,"uniform bool"),e.addVertexParsVariable(c,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${i}_offset = vec2(0.0);
                if (${n}) {
                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${s} * (${r} / 2.0) * ${i}_clipPosition.w * 2.0 * ${c};
                    ${i}_clipPosition.xy += ${i}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${i}_clipPosition;
                }
            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(Kee.Nodes.outline),s=[];return s.push(this.outlineColor.build(e,"c")),s.push(this.contourColor.build(e,"c")),s.push(this.outlineWidth.build(e,"f")),s.push(this.contourWidth.build(e,"f")),s.push(this.contourThreshold.build(e,"f")),s.push(this.outlineThreshold.build(e,"f")),s.push(this.contourFrequency.build(e,"f")),s.push(this.outlineSmoothing.build(e,"f")),s.push(this.contourDirection.build(e,"v3")),s.push(this.positionalLines.build(e,"b")),s.push(this.resolution.build(e,"v2")),s.push(this.normalMap.getTexture(e,"t")),s.push(this.depthMap.getTexture(e,"t")),s.push(this.pixelRatio.build(e,"f")),s.push(this.compensation.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+s.join(",")+")",this.getType(e),t)}else return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},Jee=Kee;Jee.Nodes=function(){let e=new Ni(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new Ni(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[e])}}();var np=class extends ms{constructor(e,t,i,r,s,n,c,u,p,f,x,w,E,A,I,P,O,k){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=i,this.blending=r,this.offset=s,this.colorA=n,this.colorB=c,this.frequency=u,this.size=p,this.variation=f,this.smoothness=x,this.zigzag=w,this.rotation=E,this.vertical=A,this.horizontal=I,this.sides=P,this.isMask=k,this.alpha=O,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float");let i;switch(this.style.value){case 0:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave";break;default:i="circle";break}let r=`g${this.uuid.toString().replace(/-/g,"")}`,s=new Ni(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),n=new Ni(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),c="";if(this.projection.value===4){let x=this.style.value===2?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,w=this.style.value===2?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,E=this.style.value===2?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;c=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${x};
				float d1 = ${w};
				float d2 = ${E};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let x=this.style.value===2?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,w="";this.axis.value===0?w=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?w=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,w=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let E="";switch(this.projection.value){case 0:E="custom_uv = vUv.st;";break;case 1:break;case 2:E=`
							vec3 p = position;
							${w}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break;case 3:break;default:break}c=`
				vec2 custom_uv;
				${E}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${x};
				`}let u=new Ni(`vec3 ${r}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${c}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[n,s,np.DrawFunctions.circle,np.DrawFunctions.ring,np.DrawFunctions.polygon,np.DrawFunctions.cross,np.DrawFunctions.diamond,np.DrawFunctions.checkerboard,np.DrawFunctions.line,np.DrawFunctions.wave]),p=e.include(u),f=[];return f.push("normal"),f.push(this.blending.build(e,"f")),f.push(this.style.build(e,"i")),f.push(this.offset.build(e,"v2")),f.push(this.colorA.build(e,"v4")),f.push(this.colorB.build(e,"v4")),f.push(this.frequency.build(e,"v2")),f.push(this.size.build(e,"f")),f.push(this.variation.build(e,"f")),f.push(this.smoothness.build(e,"f")),f.push(this.zigzag.build(e,"f")),f.push(this.rotation.build(e,"f")),f.push(this.vertical.build(e,"v2")),f.push(this.horizontal.build(e,"v2")),f.push(this.sides.build(e,"i")),f.push(this.isMask.build(e,"b")),f.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),f.push(this.alpha.build(e,"f")),f.push(this.calpha),e.format(p+"("+f.join(",")+")",this.getType(e),t)}else return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},ete=np;ete.DrawFunctions=function(){let e=new Ni(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),t=new Ni(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[e]),i=new Ni(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[t]),r=new Ni(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[t]),s=new Ni(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[t]),n=new Ni(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[t]),c=new Ni(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[t]),u=new Ni(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),p=new Ni(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[t]),f=new Ni(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:t,circle:i,ring:r,polygon:s,cross:n,diamond:c,checkerboard:u,line:p,wave:f}}();var tte=class extends ms{constructor(e,t,i,r,s,n,c,u){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=s,this.offset=n,this.isMask=u,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(tte.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(e,"f")),r.push(this.movement.build(e,"f")),r.push(this.wavelengths.build(e,"v3")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.offset.build(e,"v3")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},ite=tte;ite.Nodes=function(){let e=new Ni(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
                 vec3 st = position / noiseScale;
				 vec3 q = vec3(simplex3d(st),
							  simplex3d(st + vec3(1.0)),
							  simplex3d(st + vec3(1.0)));

				 vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),
							  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),
							  simplex3d(st * q));

                 float noise = simplex3d(st + r);

                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);
             }`,[Fl.simplex]);return{rainbow:new Ni(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
             }`,[e])}}();var rte=class extends ms{constructor(e,t,i,r,s,n,c,u,p,f){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=r,this.isWorldSpace=s,this.noiseStrength=n,this.noiseScale=c,this.shadowColor=u,this.offset=p,this.alpha=f,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(rte.Nodes.toon),r=[];return r.push(this.positioning.build(e,"i")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.source.build(e,"v3")),r.push(this.isWorldSpace.build(e,"b")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.shadowColor.build(e,"v4")),r.push(this.offset.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},nte=rte;nte.Nodes=function(){let e=new Ni(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),t=new Ni(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new Ni(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[t]),r=new Ni(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),s=new Ni(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new Ni(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplex3d(st),
					// 	simplex3d(st + vec3(111.1, 143.89, 217.19)),
					// 	simplex3d(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[Fl.simplex,e,i,s])}}();var eOe=function(){return{textureBicubic:new Ni(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)}}();function tOe(e,t){return e>=t?new lt(t/e,1):new lt(1,e/t)}var ste=class extends ms{constructor(e,t,i,r,s,n,c,u){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=s,this.transmissionDepthMap=n,this.aspectRatio=c,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,Dr.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(ste.Nodes.transmission),r=[];return r.push(this.thickness.build(e,"f")),r.push(this.ior.build(e,"f")),r.push(this.roughness.build(e,"f")),r.push(this.transmissionSamplerSize.build(e,"v2")),r.push(this.transmissionSamplerMap.getTexture(e,"t")),r.push(this.transmissionDepthMap.getTexture(e,"t")),r.push(this.aspectRatio.build(e,"v2")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},ote=ste;ote.Nodes=function(){let e=new Ni(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),t=new Ni(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),i=new Ni(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),r=new Ni(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[eOe.textureBicubic,i,e]),s=new Ni(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[r,t]);return{transmission:new Ni(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[s])}}();var LB=(e=>(e.NOISE="noise",e.MAP="map",e))(LB||{}),ate=class extends ms{constructor(e,t,i,r,s,n,c,u,p,f,x){super("v3"),this.displacementTypeIndex=new bs(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,Object.values(LB)[this.displacementTypeIndex.value]==="map"&&(this.mat=new Vee(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=f,this.noiseFunctionIndex=x,this.voronoiStyle=r,this.smoothness=s,this.seed=n,this.highCut=c,this.lowCut=u,this.quality=p}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(LB)[this.displacementTypeIndex.value]){case"map":{i=e.include(ate.Nodes.map),r.push(this.movementOrTexture.getTexture(e,"t")),r.push("uv"),r.push(this.cropOrOffset.build(e,"f")),this.mat&&r.push(this.mat.build(e,"mat3"));break}case"noise":{let s=Object.values(mU)[this.noiseFunctionIndex.value],n=new Ni(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),c=s=="voronoi"?`
					float v = ${s}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${s}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,u=new Ni(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${c}
						}`,[Fl.simplex,Fl.simplexFractal,Fl.simplexAshima,Fl.fbm,Fl.perlin,Fl.voronoi]),p=new Ni(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[u,n]);i=e.include(p),r.push(this.scale.build(e,"f")),r.push(this.cropOrOffset.build(e,"v3")),r.push(this.movementOrTexture.build(e,"f")),r.push(this.voronoiStyle.build(e,"i")),r.push(this.smoothness.build(e,"f")),r.push(this.seed.build(e,"f")),r.push(this.highCut.build(e,"f")),r.push(this.lowCut.build(e,"f")),r.push(this.quality.build(e,"i"));break}}return r.push(this.intensity.build(e,"f")),r.push("displaced_normal"),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},lte=ate;lte.Nodes=function(){let e=new Ni(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),t=new Ni(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new Ni(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[e,t])}}();var Dr={normalRenderTarget:new dp,normalRenderTargetDepth:new dp,transmissionRenderTarget:new dp,aspectRatio:new Aa,transmissionSize:new Aa(2048,2048),transmissionRenderTargetDepth:new dp,aoRenderTarget:new dp,aoEnabled:new vl,pixelRatioNode:new Zi(1),resolution:new Aa,penumbraSize:new py(5,.5),frameIndex:new bs(0),transmissionLod:new bs(2)};for(let e of Object.values(Dr))e.isRenderGlobal=!0;var cte={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.9.20/build/ui.wasm"},gU=class extends Xo{constructor(){super("basic"),this.nodeType="Basic",this.color=new ro(mc),this.shadingAlpha=new Zi(1),this.shadingBlend=new bs(0),this.previousModelViewMatrix=new rd,this.previouseProjectionMatrix=new rd}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Dr.frameIndex}),e.mergeUniform({resolution:Dr.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Ex.merge([Fi.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{this.color===void 0&&(this.color=new ro(mc)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(e,"f"):void 0,s=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,n=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=r!==void 0,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",i.code];r&&c.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),n?c.push(n.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${n.result}, 1.0, SPE_BLENDING_NORMAL);`):c.push(`vec3 finalColor = ${i.result};`);let u="1.0";this.mask&&(this.mask.analyze(e),u=`luminance(${this.mask.flow(e,"v3").result})`),r?c.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${r.result} * ${u} );`):c.push("gl_FragColor = vec4("+i.result+", 1.0 );"),s&&c.push(`gl_FragColor.a *= ${s.result};`),c.push("#include <fog_fragment>","#include <dithering_fragment>"),t=c.join(`
`)}return t}},iOe=class extends Xo{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new ro(mc),this.emissive=new ro(0),this.emissiveIntensity=new Zi(1),this.previousModelViewMatrix=new rd,this.previouseProjectionMatrix=new rd,this.shadingAlpha=new Zi(1),this.shadingBlend=new bs(0),this.occlusion=new vl(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Dr.frameIndex}),e.mergeUniform({resolution:Dr.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Ex.merge([Fi.fog,Fi.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),r.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Dr.penumbraSize}),e.mergeUniform({frameIndex:Dr.frameIndex}),e.mergeUniform({aoMap:Dr.aoRenderTarget}),e.mergeUniform({aoEnabled:Dr.aoEnabled}),this.color===void 0&&(this.color=new ro(mc)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.emissive.flow(e,"c",{slot:"emissive"}),s=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),n=this.occlusion.flow(e,"b",{slot:"occlusion"}),c=this.shadingAlpha.flow(e,"f"),u=this.shadingBlend.flow(e,"i"),p=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,f=this.alpha?this.alpha.flow(e,"f"):void 0,x=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=f!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let w=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];w.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),f&&w.push(f.code,"#ifdef ALPHATEST","if ( "+f.result+" <= ALPHATEST ) discard;","#endif"),w.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&w.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+s.result+";"),w.push("vec3 ao = aoEnabled && "+n.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let E="1.0";this.mask&&(this.mask.analyze(e),E=`luminance(${this.mask.flow(e,"v3").result})`),w.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${c.result} * ${E} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${c.result} * ${E}, ${u.result} );

					outgoingLight *= ao;
				}
				`),p&&w.push(p.code,`outgoingLight = spe_blend(outgoingLight, ${p.result}, 1.0, SPE_BLENDING_NORMAL);`),f?w.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${f.result} );`):w.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),x&&w.push(`gl_FragColor.a *= ${x.result};`),w.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=w.join(`
`)}return t}},bx=function(){let e=new Ni(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),t=new Ni(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`);return{dHdxy:e,perturbNormalArb:t}}(),rOe=class extends Xo{constructor(){super("phong"),this.nodeType="Phong",this.color=new ro(mc),this.specular=new ro(1118481),this.shininess=new Zi(30),this.previousModelViewMatrix=new rd,this.previouseProjectionMatrix=new rd,this.shadingAlpha=new Zi(1),this.shadingBlend=new bs(0),this.occlusion=new vl(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Dr.frameIndex}),e.mergeUniform({resolution:Dr.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Ex.merge([Fi.fog,Fi.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Dr.penumbraSize}),e.mergeUniform({frameIndex:Dr.frameIndex}),e.mergeUniform({aoMap:Dr.aoRenderTarget}),e.mergeUniform({aoEnabled:Dr.aoEnabled}),this.color===void 0&&(this.color=new ro(mc)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let r=this.color.flow(e,"c",{slot:"color"}),s=this.specular.flow(e,"c"),n=this.shininess.flow(e,"f"),c=this.shadingAlpha.flow(e,"f"),u=this.shadingBlend.flow(e,"i"),p=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,f=this.alpha?this.alpha.flow(e,"f"):void 0,x=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=f!==void 0,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let w=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){e.include(bx.dHdxy),e.include(bx.perturbNormalArb);let A=this.bumpMap.texture.flow(e,"t"),I=this.bumpMap.flow(e,"v3"),P=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",O="";this.bumpMap.projection.value===4?O=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${A.result}, uv0, ${P});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${A.result}, uv1, ${P});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${A.result}, uv2, ${P});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:O=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${A.result}, bumpMapCachedUv, ${P});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,w.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${I.result};
					${O}
					`)}w.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",s.code,"	vec3 specular = "+s.result+";",n.code,"	float shininess = max( 0.0001, "+n.result+" );","	float specularStrength = 1.0;"),f&&w.push(f.code,"#ifdef ALPHATEST","if ( "+f.result+" <= ALPHATEST ) discard;","#endif"),w.push("material.diffuseColor = diffuseColor;"),w.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),w.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let E="1.0";this.mask&&(this.mask.analyze(e),E=`luminance(${this.mask.flow(e,"v3").result})`),w.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${c.result} * ${E} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${c.result} * ${E}, ${u.result} );
					
					outgoingLight *= ao;
				}
				`),p&&w.push(p.code,`outgoingLight = spe_blend(outgoingLight, ${p.result}, 1.0, SPE_BLENDING_NORMAL);`),f?w.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${f.result});`):w.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),x&&w.push(`gl_FragColor.a *= ${x.result};`),w.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=w.join(`
`)}return t}},nOe=class extends Xo{constructor(){super("standard"),this.nodeType="Standard",this.color=new ro(mc),this.roughness=new Zi(.3),this.metalness=new Zi(0),this.reflectivity=new Zi(.5),this.previousModelViewMatrix=new rd,this.previouseProjectionMatrix=new rd,this.shadingAlpha=new Zi(1),this.shadingBlend=new bs(0),this.occlusion=new vl(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Dr.frameIndex}),e.mergeUniform({resolution:Dr.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Ex.merge([Fi.fog,Fi.lights])),Fi.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Dr.penumbraSize}),e.mergeUniform({frameIndex:Dr.frameIndex}),e.mergeUniform({aoMap:Dr.aoRenderTarget}),e.mergeUniform({aoEnabled:Dr.aoEnabled});let i={gamma:!0};this.color===void 0&&(this.color=new ro(mc)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e);let r=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let s=this.color.flow(e,"c",{slot:"color",context:i}),n=this.roughness.flow(e,"f"),c=this.metalness.flow(e,"f"),u=this.shadingAlpha.flow(e,"f"),p=this.shadingBlend.flow(e,"i"),f=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,x=this.alpha?this.alpha.flow(e,"f"):void 0,w=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,E=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=x!==void 0,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let A=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(bx.dHdxy),e.include(bx.perturbNormalArb);let P=this.bumpMap.texture.flow(e,"t"),O=this.bumpMap.flow(e,"v3"),k=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",U="";this.bumpMap.projection.value===4?U=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${P.result}, uv0, ${k});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${P.result}, uv1, ${k});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${P.result}, uv2, ${k});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:U=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${P.result}, bumpMapCachedUv, ${k});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,A.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${O.result};
					${U}
					`)}if(A.push(s.code,"	vec3 diffuseColor = "+s.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",c.code,"	float metalnessFactor = "+c.result+";"),this.roughnessMap){let P=this.roughnessMap.texture.flow(e,"t"),O=this.roughnessMap.flow(e,"v3"),k="";this.roughnessMap.projection.value===4?k=`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${P.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${P.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${P.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${n.result};
					`:k=`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${P.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${n.result};
					`,A.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${O.result};

					const float roughnessScale = 1.0;

					${k}
				`)}else A.push(n.code,"	float roughnessFactor = "+n.result+";");x&&A.push(x.code,"#ifdef ALPHATEST","	if ( "+x.result+" <= ALPHATEST ) discard;","#endif"),A.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),A.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),E?A.push(E.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+E.result+" ) ), diffuseColor, metalnessFactor );"):A.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),A.push("#include <lights_fragment_begin>"),A.push("#include <lights_fragment_end>"),A.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let I="1.0";this.mask&&(this.mask.analyze(e),I=`luminance(${this.mask.flow(e,"v3").result})`),A.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${u.result} * ${I} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${u.result} * ${I}, ${p.result} );
					
					outgoingLight *= ao;
				}
				`),f&&A.push(f.code,`outgoingLight = spe_blend(outgoingLight, ${f.result}, 1.0, SPE_BLENDING_NORMAL);`),x?A.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${x.result} );`):A.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),w&&A.push(`gl_FragColor.a *= ${w.result};`),A.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=A.join(`
`)}return t}},sOe=class extends Xo{constructor(){super("toon"),this.nodeType="Toon",this.color=new ro(mc),this.specular=new ro(1118481),this.shininess=new Zi(30),this.previousModelViewMatrix=new rd,this.previouseProjectionMatrix=new rd,this.shadingAlpha=new Zi(1),this.shadingBlend=new bs(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Dr.frameIndex}),e.mergeUniform({resolution:Dr.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Ex.merge([Fi.fog,Fi.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Dr.penumbraSize}),e.mergeUniform({frameIndex:Dr.frameIndex}),e.mergeUniform({aoMap:Dr.aoRenderTarget}),e.mergeUniform({aoEnabled:Dr.aoEnabled}),this.color===void 0&&(this.color=new ro(mc)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),n=this.shadingAlpha.flow(e,"f"),c=this.shadingBlend.flow(e,"i"),u=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,p=this.alpha?this.alpha.flow(e,"f"):void 0,f=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=p!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let x=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){e.include(bx.dHdxy),e.include(bx.perturbNormalArb);let E=this.bumpMap.texture.flow(e,"t"),A=this.bumpMap.flow(e,"v3"),I=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",P="";this.bumpMap.projection.value===4?P=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${E.result}, uv0, ${I});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${E.result}, uv1, ${I});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${E.result}, uv2, ${I});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:P=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${E.result}, bumpMapCachedUv, ${I});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,x.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${A.result};
					${P}
					`)}x.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),p&&x.push(p.code,"#ifdef ALPHATEST","if ( "+p.result+" <= ALPHATEST ) discard;","#endif"),x.push("material.diffuseColor = diffuseColor;"),x.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),x.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let w="1.0";this.mask&&(this.mask.analyze(e),w=`luminance(${this.mask.flow(e,"v3").result})`),x.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${n.result} * ${w} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${n.result} * ${w}, ${c.result} );
				}
				`),u&&x.push(u.code,`outgoingLight = spe_blend(outgoingLight, ${u.result}, 1.0, SPE_BLENDING_NORMAL);`),p?x.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${p.result} );`):x.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),f&&x.push(`gl_FragColor.a *= ${f.result};`),x.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=x.join(`
`)}return t}},oOe=class{constructor(e=1e3*10){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){return this.cache.get(e)?.data}load(e){let t=Date.now(),i=this.cache.get(e);return i===void 0?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},aOe=class extends oOe{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}},yk;function lOe(e){return typeof e=="string"?e:(yk||(yk=new aOe),yk.load(e))}var cOe=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},uOe=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let t=this.cache.get(e);return t===void 0&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},ute=class extends cOe{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isBuffer=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo=e.type==="video",this.isBuffer=e.isWebGLRenderTarget===!0,this.loadPromise=this.updateSrc(this.isBuffer?e:e.data)}updateSrc(e){return jn(this,null,function*(){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;for(let r of Object.values(this._cache))for(let s of Object.values(r))for(let n of Object.values(s))n&&(n.image=this.img,n.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=e,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof e!="string"){var i=new FileReader;i.readAsDataURL(new Blob([e],{type:"video/mp4"}));let r;yield new Promise(s=>{i.onloadend=n=>{r=n.target?.result,s(null)}}),this.img.src=r}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=lOe(e),this.img.onload=t})}getTexture(e,t=1008,i=1006){let r=this._cache[e]?.[t]?.[i];if(r)return r;{let s;return this.isBuffer?s=this.img.texture:this.isVideo?s=new qxe(this.img,void 0,e,e):s=new Zs(this.img,void 0,e,e,i,t),this.loaded&&(s.needsUpdate=!0),this._cache[e]===void 0&&(this._cache[e]={}),this._cache[e][t]===void 0&&(this._cache[e][t]={}),this._cache[e][t][i]=s,s}}setNeedsUpdate(e){for(let t of Object.values(this._cache))for(let i of Object.values(t))for(let r of Object.values(i))r&&(r.needsUpdate=e)}disposeTextures(){for(let[e,t]of Object.entries(this._cache))for(let[i,r]of Object.entries(t))for(let[s,n]of Object.entries(r))n?.dispose(),this._cache[e]!==void 0&&this._cache[e][i]!==void 0&&(this._cache[e][i][s]=void 0)}dispose(){super.dispose(),this.disposeTextures()}},rm=class extends ute{};function hOe(e,t){var i=mOe(t);return i.formatToParts?pOe(i,e):fOe(i,e)}var dOe={year:0,month:1,day:2,hour:3,minute:4,second:5};function pOe(e,t){try{for(var i=e.formatToParts(t),r=[],s=0;s<i.length;s++){var n=dOe[i[s].type];n>=0&&(r[n]=parseInt(i[s].value,10))}return r}catch(c){if(c instanceof RangeError)return[NaN];throw c}}function fOe(e,t){var i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[r[3],r[1],r[2],r[4],r[5],r[6]]}var vk={};function mOe(e){if(!vk[e]){var t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i=t==="06/25/2014, 00:00:00"||t==="\u200E06\u200E/\u200E25\u200E/\u200E2014\u200E \u200E00\u200E:\u200E00\u200E:\u200E00";vk[e]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return vk[e]}function hte(e,t,i,r,s,n,c){var u=new Date(0);return u.setUTCFullYear(e,t,i),u.setUTCHours(r,s,n,c),u}var z$=36e5,gOe=6e4,_k={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function dte(e,t,i){var r,s;if(!e||(r=_k.timezoneZ.exec(e),r))return 0;var n;if(r=_k.timezoneHH.exec(e),r)return n=parseInt(r[1],10),F$(n)?-(n*z$):NaN;if(r=_k.timezoneHHMM.exec(e),r){n=parseInt(r[1],10);var c=parseInt(r[2],10);return F$(n,c)?(s=Math.abs(n)*z$+c*gOe,n>0?-s:s):NaN}if(_Oe(e)){t=new Date(t||Date.now());var u=i?t:yOe(t),p=zB(u,e),f=i?p:vOe(t,p,e);return-f}return NaN}function yOe(e){return hte(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function zB(e,t){var i=hOe(e,t),r=hte(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),s=e.getTime(),n=s%1e3;return s-=n>=0?n:1e3+n,r-s}function vOe(e,t,i){var r=e.getTime(),s=r-t,n=zB(new Date(s),i);if(t===n)return t;s-=n-t;var c=zB(new Date(s),i);return n===c?n:Math.max(n,c)}function F$(e,t){return-23<=e&&e<=23&&(t==null||0<=t&&t<=59)}var k$={};function _Oe(e){if(k$[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),k$[e]=!0,!0}catch{return!1}}var xOe=Dp(Ome(),1),N$=Dp(Lme(),1),bOe=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,wOe=bOe,xk=36e5,B$=6e4,SOe=2,_l={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:wOe};function EOe(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(e===null)return new Date(NaN);var i=t||{},r=i.additionalDigits==null?SOe:(0,xOe.default)(i.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]")return new Date(e.getTime());if(typeof e=="number"||Object.prototype.toString.call(e)==="[object Number]")return new Date(e);if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var s=MOe(e),n=TOe(s.date,r),c=n.year,u=n.restDateString,p=AOe(u,c);if(isNaN(p))return new Date(NaN);if(p){var f=p.getTime(),x=0,w;if(s.time&&(x=COe(s.time),isNaN(x)))return new Date(NaN);if(s.timeZone||i.timeZone){if(w=dte(s.timeZone||i.timeZone,new Date(f+x)),isNaN(w))return new Date(NaN)}else w=(0,N$.default)(new Date(f+x)),w=(0,N$.default)(new Date(f+x+w));return new Date(f+x+w)}else return new Date(NaN)}function MOe(e){var t={},i=_l.dateTimePattern.exec(e),r;if(i?(t.date=i[1],r=i[3]):(i=_l.datePattern.exec(e),i?(t.date=i[1],r=i[2]):(t.date=null,r=e)),r){var s=_l.timeZone.exec(r);s?(t.time=r.replace(s[1],""),t.timeZone=s[1].trim()):t.time=r}return t}function TOe(e,t){var i=_l.YYY[t],r=_l.YYYYY[t],s;if(s=_l.YYYY.exec(e)||r.exec(e),s){var n=s[1];return{year:parseInt(n,10),restDateString:e.slice(n.length)}}if(s=_l.YY.exec(e)||i.exec(e),s){var c=s[1];return{year:parseInt(c,10)*100,restDateString:e.slice(c.length)}}return{year:null}}function AOe(e,t){if(t===null)return null;var i,r,s,n;if(e.length===0)return r=new Date(0),r.setUTCFullYear(t),r;if(i=_l.MM.exec(e),i)return r=new Date(0),s=parseInt(i[1],10)-1,j$(t,s)?(r.setUTCFullYear(t,s),r):new Date(NaN);if(i=_l.DDD.exec(e),i){r=new Date(0);var c=parseInt(i[1],10);return POe(t,c)?(r.setUTCFullYear(t,0,c),r):new Date(NaN)}if(i=_l.MMDD.exec(e),i){r=new Date(0),s=parseInt(i[1],10)-1;var u=parseInt(i[2],10);return j$(t,s,u)?(r.setUTCFullYear(t,s,u),r):new Date(NaN)}if(i=_l.Www.exec(e),i)return n=parseInt(i[1],10)-1,V$(t,n)?U$(t,n):new Date(NaN);if(i=_l.WwwD.exec(e),i){n=parseInt(i[1],10)-1;var p=parseInt(i[2],10)-1;return V$(t,n,p)?U$(t,n,p):new Date(NaN)}return null}function COe(e){var t,i,r;if(t=_l.HH.exec(e),t)return i=parseFloat(t[1].replace(",",".")),bk(i)?i%24*xk:NaN;if(t=_l.HHMM.exec(e),t)return i=parseInt(t[1],10),r=parseFloat(t[2].replace(",",".")),bk(i,r)?i%24*xk+r*B$:NaN;if(t=_l.HHMMSS.exec(e),t){i=parseInt(t[1],10),r=parseInt(t[2],10);var s=parseFloat(t[3].replace(",","."));return bk(i,r,s)?i%24*xk+r*B$+s*1e3:NaN}return null}function U$(e,t,i){t=t||0,i=i||0;var r=new Date(0);r.setUTCFullYear(e,0,4);var s=r.getUTCDay()||7,n=t*7+i+1-s;return r.setUTCDate(r.getUTCDate()+n),r}var DOe=[31,28,31,30,31,30,31,31,30,31,30,31],IOe=[31,29,31,30,31,30,31,31,30,31,30,31];function pte(e){return e%400===0||e%4===0&&e%100!==0}function j$(e,t,i){if(t<0||t>11)return!1;if(i!=null){if(i<1)return!1;var r=pte(e);if(r&&i>IOe[t]||!r&&i>DOe[t])return!1}return!0}function POe(e,t){if(t<1)return!1;var i=pte(e);return!(i&&t>366||!i&&t>365)}function V$(e,t,i){return!(t<0||t>52||i!=null&&(i<0||i>6))}function bk(e,t,i){return!(e!=null&&(e<0||e>=25)||t!=null&&(t<0||t>=60)||i!=null&&(i<0||i>=60))}function ROe(e,t,i){var r=EOe(e,i),s=dte(t,r,!0),n=new Date(r.getTime()-s),c=new Date(0);return c.setFullYear(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate()),c.setHours(n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds()),c}function xl(e,t){return t.color(e)}function G$(e=new Date,t){let i=t.format,r=e.getSeconds(),s=e;t&&t.timeZone!==null&&(s=ROe(new Date,t.timeZone));let n=s.getHours(),c=s.getMinutes(),u;t.format12h24h==="12ampm"&&(u=n>=12?"PM":"AM");let p=n;t.format12h24h!=="24"&&(p=n%12,p===0&&(p=12));let f,x;switch(i){case"HH:mm:ss":f=[p,c,r];break;case"HH:mm":f=[p,c];break;case"HH":f=[p],u=void 0;break;case"mm":f=[c],u=void 0;break;case"ss":f=[r],u=void 0;break;case"year":x=s.getFullYear();break;case"month":x=s.getMonth()+1;break;case"dayOfYear":x=Math.floor((s.getTime()-new Date(s.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":x=s.getDate();break;case"secondOfDay":x=n*60*60+c*60+r;break;default:console.error("Unknown time format",i),x=0;break}return f!==void 0?{textValue:f,suffix:u}:x}function OOe(e,t){switch(e.type){case"fresnel":return FOe(e,t);case"gradient":return kOe(e,t);case"depth":return NOe(e,t);case"normal":return BOe(e,t);case"noise":return UOe(e,t);case"rainbow":return jOe(e,t);case"toon":return VOe(e,t);case"outline":return GOe(e,t);case"transmission":return HOe(e,t);case"color":return zOe(e,t);case"pattern":return WOe(e,t)}}function LOe(e){return{type:e.type}}function Ku(e,t){let{alpha:i,mode:r,isMask:s}=e,n=typeof i=="string"?(Number(t.getVariable(i))??100)/100:i;return pt(me({},LOe(e)),{alpha:n,mode:r,isMask:s})}function zOe(e,t){return pt(me({},Ku(e,t)),{color:xl(e.color,t)})}function FOe(e,t){let{bias:i,scale:r,intensity:s,factor:n,color:c}=e;return pt(me({},Ku(e,t)),{color:xl(c,t),bias:i,scale:r,intensity:s,factor:n})}function kOe(e,t){let{gradientType:i,smooth:r,colors:s,steps:n,angle:c,offset:u,morph:p}=e;return pt(me({},Ku(e,t)),{gradientType:i,smooth:r,colors:s.map(f=>new Gr(f[0],f[1],f[2],f[3])),num:s.length,steps:n,offset:new lt(...u),morph:new lt(...p),angle:c})}function NOe(e,t){let{gradientType:i,near:r,far:s,isVector:n,isWorldSpace:c,origin:u,direction:p,colors:f,steps:x,smooth:w}=e;return pt(me({},Ku(e,t)),{gradientType:i,near:r,far:s,isVector:n,isWorldSpace:c,origin:new se(...u),direction:p?new se(...p):new se(1,0,0),colors:f.map(E=>E!==void 0?new Gr(E[0],E[1],E[2],E[3]):new Gr(0,0,0,0)),steps:x.slice(0,f.length),smooth:w})}function BOe(e,t){let{cnormal:i}=e;return pt(me({},Ku(e,t)),{cnormal:new se(i[0],i[1],i[2])})}function UOe(e,t){return pt(me({},Ku(e,t)),{scale:e.scale,move:e.move,fA:new lt(...e.fA),fB:new lt(...e.fB),size:new se(...e.size),distortion:new lt(...e.distortion),colorA:xl(e.colorA,t),colorB:xl(e.colorB,t),colorC:xl(e.colorC,t),colorD:xl(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality})}function jOe(e,t){return pt(me({},Ku(e,t)),{filmThickness:e.filmThickness,movement:e.movement,wavelengths:new se(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new se(...e.offset)})}function VOe(e,t){return pt(me({},Ku(e,t)),{positioning:e.positioning,colors:e.colors.map(i=>new Gr(i[0],i[1],i[2],i[3])),num:e.colors.length,steps:e.steps,source:new se(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:xl(e.shadowColor,t),offset:new se(...e.offset)})}function GOe(e,t){return pt(me({},Ku(e,t)),{outlineColor:xl(e.outlineColor,t),contourColor:xl(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new se(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation})}function HOe(e,t){return pt(me({},Ku(e,t)),{thickness:e.thickness,ior:e.ior,roughness:e.roughness})}function WOe(e,t){return pt(me({},Ku(e,t)),{style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new lt(...e.offset),colorA:xl(e.colorA,t),colorB:xl(e.colorB,t),frequency:new lt(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new lt(...e.vertical),horizontal:new lt(...e.horizontal),sides:e.sides})}var oI=class extends La{},qOe={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},YOe={depth:["colors"]};function XOe(e,t,i){if(t==="isMask")return!0;let r=qOe[e.type],s=YOe[e.type];if(s!==void 0){let n=e.color;if(s.includes(t)){let c=n[t]?.value?.length;if(c!==void 0&&c!==i.length)return!0}}return r!==void 0?r.includes(t):!1}function fte(e,t,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let s=!1,n=e;if("image"in n){let c=n.image,u=t.image(c),p=r;p.image instanceof rm||p.image.deref(),p.image=u}if("video"in n){let c=n.video,u=t.video(c),p=r;p.image instanceof rm||p.image.deref(),p.image=u}if("wrapping"in n){let c=r;c.wrap=n.wrapping}if("minFilter"in n){let c=r;c.minFilter=n.minFilter}if("magFilter"in n){let c=r;c.magFilter=n.magFilter}if("rotation"in n&&i.uniforms[`f${i.id}_rotation`])return i.uniforms[`f${i.id}_rotation`].value=(n.rotation??0)*Yi.DEG2RAD,s;if("repeat"in n||"offset"in n||"rotation"in n){let c="mat",u=i.uniforms[`f${i.id}_${c}`];"repeat"in n&&(u.repeat=n.repeat),"offset"in n&&(u.offset=n.offset),"rotation"in n&&(u.rotation=n.rotation??0),u.updateMatrix()}return s}function $Oe(e,t,i,r){let s=!1;for(let[n,c]of Object.entries(e)){if(n==="bumpMap"||n==="roughnessMap"){s=!0;continue}if(!n||c===void 0)continue;if(gte(n,i,r,t)){n==="visible"&&i.type==="light"&&(s=!0);continue}i.visible=r.visible;let u=i.uniforms[`f${i.id}_${n}`];if(u&&!(u instanceof pU))switch(s=s||XOe(i,n,c),u.constructor){case ro:if(typeof c=="string"){let p=t.getColor(c);p&&(u.value=p);break}else{let p=c;u.value instanceof oI?u.value=new La(p.r,p.g,p.b,p.a):u.setRGBA(p);break}case op:if(typeof c=="string"){let p=t.getColor(c);p&&(u.value=p);break}else{let p=c;u.value instanceof oI?u.value=new La(p.r,p.g,p.b,p.a):u.value.setRGBA(p.r,p.g,p.b,p.a);break}case Aa:{let p=c;u.value.setX(p[0]),u.value.setY(p[1]);break}case Hc:{let p=c;u.value.setX(p[0]),u.value.setY(p[1]),u.value.setZ(p[2]);break}case dp:{fte(c,t,i);break}case fy:{u.value=c.map(p=>new Gr(...p));break}default:{u.value=c;break}}}return s}var Vy=(e,t,i)=>Math.max(0,Math.min(1,Number(t.getVariable(typeof e=="number"?e*100:e,i)??100)/100))??1,ZS=class{constructor(e,t,i,r,s){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let n in r)this.uniforms[`f${this.id}_${n}`]=r[n];for(let n in i)gte(n,this,i,s)}get type(){return this.data.type}static create(e,t,i,r){if(i.type==="light")return Vh.createLigherLayer(e,t,i,r);if(i.type==="texture"||i.type==="video"){let s=i.type==="texture"?r.uiBuffer(i.texture.image)??r.image(i.texture.image):r.video(i.texture.video),n=new RB(s,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),c=new QRe(s),u=new KRe(i.texture.repeat,i.texture.offset,i.texture.rotation??0),p=new Zi(i.crop?1:0),f=new bs(i.projection??0),x=new bs(["x","y","z"].indexOf(i.axis)??0),w=new bs(i.side??0),E=new Aa(i.size?new lt(i.size[0],i.size[1]):new lt(100,100)),A=new Zi(i.blending??0),I=new Zi(Vy(i.alpha,r)),P=new bs(i.mode??0),O=new vl(i.isMask??!1),k=new fU(n,c,p,f,x,w,E,A,u,I,P,O),U=new zs(k.calpha,"f");return new eo(e,t,i,{texture:n,textureSize:c,crop:p,projection:f,axis:x,side:w,size:E,blending:A,mat:u,alpha:I,mode:P,isMask:O},k,P,U,O,r)}else if(i.type==="matcap"){let s=r.image(i.texture.image),n=new RB(s,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),c=new Zi(Vy(i.alpha,r)),u=new bs(i.mode??0),p=new vl(i.isMask??!1),f=new Zi((i.texture.rotation??0)*Yi.DEG2RAD),x=new Zee(n,c,u,p,f),w=new zs(x.calpha,"f");return new eo(e,t,i,{texture:n,alpha:c,mode:u,isMask:p,rotation:f},x,u,w,p,r)}else if(i.type==="displace")if(i.displacementType==="noise"){let s=new Hc(new se(...i.offset)),n=new Zi(i.scale??10),c=new Zi(i.intensity??8),u=new Zi(i.movement??1),p=new bs(i.noiseType??0),f=new bs(i.voronoiStyle??0),x=new Zi(i.smoothness??.5),w=new Zi(i.seed??0),E=new Zi(i.highCut??1),A=new Zi(i.lowCut??0),I=new bs(i.quality??1),P=new lte(c,u,s,f,x,w,E,A,I,n,p);return new mte(e,t,i,{offset:s,scale:n,intensity:c,movement:u,noiseType:p,voronoiStyle:f,smoothness:x,seed:w,highCut:E,lowCut:A,quality:I},P,r)}else throw new Error;else return KOe(e,t,i,r)}updateByOp(e,t,i){let r=e;if(r.path[0]===void 0){if(r.type===0)return"type"in r.props||"category"in r.props||"visible"in r.props?(i.scene.markNeedsUpdateRendererDirty(),!0):$Oe(r.props,i.shared,this,t)}else if(r.path[0]==="texture")return"texture"in t||"video"in t?fte(r.props,i.shared,this):!0;return!1}dispose(){if(ZOe(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let t=e;t.image instanceof rm||t.image.deref()}}hasValueByKey(e){return this.uniforms[e]!==void 0}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&t!==void 0&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},eo=class extends ZS{constructor(e,t,i,r,s,n,c,u,p){super(e,t,i,r,p),this.params=r,this.color=s,this.mode=n,this.alpha=c,this.isMask=u}},mte=class extends ZS{constructor(e,t,i,r,s,n){super(e,t,i,r,n),this.position=s}},Vh=class extends ZS{constructor(e,t,i,r,s,n){super(e,t,i,s,n),this.node=r}static createLigherLayer(e,t,i,r){let s,n=new Zi(Vy(i.alpha,r)),c=new bs(i.mode),u=new Zi(i.bumpMapIntensity),p=new Zi(Vy(i.alphaOverride,r)),f;if(!i.visible)s=new gU,f={};else if(i.category==="lambert"){s=new iOe;let x=new ro(r.color(i.emissive)??0),w=new vl(i.occlusion??!0);f={emissive:x,occlusion:w},s.emissive=x,s.occlusion=w}else if(i.category==="toon"){s=new sOe;let x=new Zi(i.shininess??30),w=new ro(r.color(i.specular)??1118481);f={shininess:x,specular:w},s.shininess=x,s.specular=w}else if(i.category==="physical"){s=new nOe;let x=new Zi(i.roughness??.3),w=new Zi(i.metalness??0),E=new Zi(i.reflectivity??.5),A=new vl(i.occlusion??!0);f={roughness:x,metalness:w,reflectivity:E,occlusion:A},s.roughness=x,s.metalness=w,s.reflectivity=E,s.occlusion=A}else{s=new rOe;let x=new Zi(i.shininess??30),w=new ro(i.specular!==void 0?r.color(i.specular)??1118481:1118481),E=new vl(i.occlusion??!0);f={shininess:x,specular:w,occlusion:E},s.shininess=x,s.specular=w,s.occlusion=E}return s.alpha=new Zi(1),s.shadingAlpha=n,s.shadingBlend=c,s.bumpMapIntensity=u,s.alphaOverride=p,f.alpha=s.shadingAlpha,f.mode=s.shadingBlend,f.bumpMapIntensity=s.bumpMapIntensity,f.alphaOverride=s.alphaOverride,new Vh(e,t,i,s,f,r)}get category(){return this.node.category}};function ZOe(e){let t=e instanceof ZS?e.type:e;return t==="texture"||t==="video"||t==="displace_map"||t==="matcap"}function Uc(e){return{alpha:new Zi(e.alpha??1),mode:new bs(e.mode??0),isMask:new vl(e.isMask??!1)}}function QOe(e,t,i,r,s){switch(e.type){case"color":{let n=new ro(r.color??mc),c=Uc(r),u=new OB(n,c.alpha),p=new zs(u.calpha,"f");return new eo(t,i,e,me({color:n},c),u,c.mode,p,c.isMask,s)}case"fresnel":{let n=new ro(r.color??16777215),c=new Zi(r.bias??.1),u=new Zi(r.scale??1),p=new Zi(r.intensity??2),f=new Zi(r.factor??1),x=Uc(r),w=new JRe(n,c,u,p,f,x.alpha,x.mode,x.isMask),E=new zs(w.calpha,"f");return new eo(t,i,e,me({color:n,bias:c,scale:u,intensity:p,factor:f},x),w,x.mode,E,x.isMask,s)}case"rainbow":{let n=new Zi(r.filmThickness??30),c=new Zi(r.movement??0),u=new Hc(r.wavelengths??new se(0,0,0)),p=new Zi(r.noiseStrength??0),f=new Zi(r.noiseScale??1),x=new Hc(r.offset??new se(0,0,0)),w=Uc(r),E=new ite(n,c,u,p,f,x,w.alpha,w.isMask),A=new zs(E.calpha,"f");return new eo(t,i,e,me({filmThickness:n,movement:c,wavelengths:u,noiseStrength:p,noiseScale:f,offset:x},w),E,w.mode,A,w.isMask,s)}case"transmission":{let n=new Zi(r.thickness??10),c=new Zi(r.ior??1.5),u=new Zi(r.roughness??.5),p=Dr.transmissionSize,f=Dr.transmissionRenderTarget,x=Dr.transmissionRenderTargetDepth,w=window.innerWidth,E=window.innerHeight,A=w>=E?new Aa(E/w,1):new Aa(1,w/E),I=Uc(r),P=new ote(n,c,u,p,f,x,A,I.alpha),O=new zs(P.calpha,"f");return new eo(t,i,e,me({thickness:n,ior:c,roughness:u,aspectRatio:A},I),P,I.mode,O,I.isMask,s)}case"toon":{let n=new bs(r.positioning??0),c;r.colors?c=new fy(r.colors.length,r.colors):(c=new fy(10,new Gr(0,0,0,1)),c.value[1]=new Gr(1,1,1,1));let u;r.steps?u=new py(r.steps.length,r.steps):(u=new py(10,1),u.value[0]=0);let p=new Hc(r.source??new se(0,0,0)),f=new vl(r.isWorldSpace??!0),x=new Zi(r.noiseStrength??0),w=new Zi(r.noiseScale??1),E=new op(r.shadowColor),A=new Hc(r.offset??new se(0,0,0)),I=Uc(r),P=new nte(n,c,u,p,f,x,w,E,A,I.alpha),O=new zs(P.calpha,"f");return new eo(t,i,e,me({positioning:n,colors:c,steps:u,source:p,isWorldSpace:f,noiseStrength:x,noiseScale:w,shadowColor:E,offset:A},I),P,I.mode,O,I.isMask,s)}case"outline":{let n=new ro(r.outlineColor??16777215),c=new ro(r.contourColor??16777215),u=new Zi(r.outlineWidth??.1),p=new Zi(r.contourWidth??.1),f=new Zi(r.outlineThreshold??.1),x=new Zi(r.contourThreshold??.1),w=new Zi(r.outlineSmoothing??.1),E=new Zi(r.contourFrequency??.1),A=new Hc(r.contourDirection??new se(0,1,0)),I=new vl(r.positionalLines??!1),P=new vl(r.compensation??!0),O=Dr.normalRenderTarget,k=Dr.normalRenderTargetDepth,U=Dr.pixelRatioNode,j=Dr.resolution,V=Uc(r),$=new Jee(n,c,u,p,f,x,w,E,A,I,P,j,O,k,U,V.alpha),Y=new zs($.calpha,"f");return new eo(t,i,e,me({outlineColor:n,contourColor:c,outlineWidth:u,contourWidth:p,outlineThreshold:f,contourThreshold:x,outlineSmoothing:w,contourFrequency:E,contourDirection:A,positionalLines:I,compensation:P},V),$,V.mode,Y,V.isMask,s)}case"depth":{let n=new bs(r.gradientType??0),c=new vl(r.smooth??!1),u=new Zi(r.near??50),p=new Zi(r.far??200),f=new Zi(r.isVector??1),x=new Zi(r.isWorldSpace??0),w=new Hc(r.origin??new se),E=new Hc(r.direction??new se),A;r.colors?A=new fy(r.colors.length,r.colors):(A=new fy(2,new Gr(0,0,0,1)),A.value[1]=new Gr(1,1,1,1));let I;r.steps?I=new py(r.steps.length,r.steps):(I=new py(2,1),I.value[0]=0);let P=Uc(r),O=new qee(n,c,u,p,f,x,w,E,A,I,P.alpha,P.isMask),k=new zs(O.calpha,"f");return new eo(t,i,e,me({gradientType:n,smooth:c,near:u,far:p,isVector:f,isWorldSpace:x,origin:w,direction:E,colors:A,steps:I},P),O,P.mode,k,P.isMask,s)}case"noise":{let n=new Zi(r.scale??1),c=new Hc(r.size??new se(100,100,100)),u=new Zi(r.move??1),p=new Aa(r.fA??new lt(1.7,9.2)),f=new Aa(r.fB??new lt(8.3,2.8)),x=new Aa(r.distortion??new lt(1,1)),w=new op(r.colorA),E=new op(r.colorB),A=new op(r.colorC),I=new op(r.colorD),P=new bs(r.noiseType??0),O=new bs(r.voronoiStyle??0),k=new Zi(r.highCut??1),U=new Zi(r.lowCut??0),j=new Zi(r.smoothness??.5),V=new Zi(r.seed??.5),$=new bs(r.quality??1),Y=Uc(r),J=new Qee(n,c,u,p,f,x,w,E,A,I,Y.alpha,P,Y.isMask,O,k,U,j,V,$),X=new zs(J.calpha,"f");return new eo(t,i,e,pt(me({scale:n,size:c,move:u,fA:p,fB:f,distortion:x,colorA:w,colorB:E,colorC:A,colorD:I,noiseType:P},Y),{voronoiStyle:O,highCut:k,lowCut:U,smoothness:j,seed:V,quality:$}),J,Y.mode,X,Y.isMask,s)}case"normal":{let n=new Hc(r.cnormal??new se(1,1,1)),c=Uc(r),u=new Wee(n,c.alpha),p=new zs(u.calpha,"f");return new eo(t,i,e,me({cnormal:n},c),u,c.mode,p,c.isMask,s)}case"gradient":{let n=new bs(r.gradientType??0),c=new vl(r.smooth??!1),u;r.colors?u=new fy(r.colors.length,r.colors):(u=new fy(10,new Gr(0,0,0,1)),u.value[1]=new Gr(1,1,1,1));let p;r.steps?p=new py(r.steps.length,r.steps):(p=new py(10,1),p.value[0]=0);let f=new Aa(r.offset??new lt(0,0)),x=new Aa(r.morph??new lt(0,0)),w=new Zi(r.angle??0),E=Uc(r),A=new Xee(n,c,u,p,f,x,w,E.alpha,E.isMask),I=new zs(A.calpha,"f");return new eo(t,i,e,me({gradientType:n,smooth:c,colors:u,steps:p,offset:f,morph:x,angle:w},E),A,E.mode,I,E.isMask,s)}case"pattern":{let n=new bs(r.style??0),c=new bs(r.projection??0),u=new bs(["x","y","z"].indexOf(r.axis)??0),p=new Zi(r.blending??0),f=new Aa(r.offset??new lt(0,0)),x=new op(r.colorA),w=new op(r.colorB),E=new Aa(r.frequency??new lt(10,10)),A=new Zi(r.size??.5),I=new Zi(r.variation??0),P=new Zi(r.smoothness??.5),O=new Zi(r.zigzag??0),k=new Zi(r.rotation??0),U=new Aa(r.vertical??new lt(0,1)),j=new Aa(r.horizontal??new lt(0,1)),V=new bs(r.sides??6),$=Uc(r),Y=new ete(n,c,u,p,f,x,w,E,A,I,P,O,k,U,j,V,$.alpha,$.isMask),J=new zs(Y.calpha,"f");return new eo(t,i,e,me({style:n,projection:c,axis:u,blending:p,offset:f,colorA:x,colorB:w,frequency:E,size:A,variation:I,smoothness:P,zigzag:O,rotation:k,vertical:U,horizontal:j,sides:V},$),Y,$.mode,J,$.isMask,s)}default:{let n=new ro(1,0,0,1),c=Uc(r),u=new OB(n,c.alpha),p=new zs(u.calpha,"f");return new eo(t,i,e,me({color:n},c),u,c.mode,p,c.isMask,s)}}}function KOe(e,t,i,r){let s=OOe(i,r);return QOe(i,e,t,s,r)}function gte(e,t,i,r){if(i.type==="displace"&&(e==="intensity"||e==="visible")){let s=t.uniforms[`f${t.id}_intensity`];return s?(s.value=i.intensity*(i.visible?1:0),s):void 0}if(i.type!=="displace"&&(e==="alpha"||e==="visible")){let s=t.uniforms[`f${t.id}_alpha`];if(!s)return;if(s.value=Vy(i.alpha,r)*(i.visible?1:0),i.type==="outline"&&e==="visible"){let n=t.uniforms[`f${t.id}_compensation`];n&&(n.value=i.compensation&&i.visible)}return s}}function q_(e,t){let i=0,r=e.layers.find(s=>s.data.type==="light");if(r){let s=r.data,n=Number(t.getVariable(s.alphaOverride));if((typeof s.alphaOverride=="string"?n/100:s.alphaOverride)<1)return!0}for(let s of e.layers){if(s.data.type!=="displace"&&s.data.isMask)return!0;if(s.data.type!=="displace"&&"alpha"in s.data&&s.data.type!=="light"&&s.data.type!=="fresnel"&&s.data.type!=="texture"&&s.data.type!=="matcap"&&s.data.type!=="rainbow"&&s.data.type!=="outline"&&s.data.type!=="pattern"){let n=s.data.visible?s.data.alpha:0;if(typeof n=="string"&&(n=Math.max(0,Math.min(1,Number(t.getVariable(n)??100)/100))),n===1&&s.data.type==="depth"||s.data.type==="gradient"){for(let c of s.data.colors)if(c[3]<1){n=c[3];break}}else if(n===1&&s.data.type==="noise"){let c=t.color(s.data.colorA).a,u=t.color(s.data.colorB).a,p=t.color(s.data.colorC).a,f=t.color(s.data.colorD).a,x=Math.min(c,Math.min(u,Math.min(p,f)));x<1&&(n=x)}i+=(1-i)*n}}return i<1}var _m=class extends Qn{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},JOe=class extends _m{constructor(e,t,i,r){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=r}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,i){return this.root.getFlavor(e,t,i)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},yU=class extends _m{constructor(e,t,i=!0){super(),this.data=e,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.needsJitter=t.shared.needsJitter,Xo.startContext(this),this.reset0(e,t),Xo.endContext(this)}get nodeMaterial(){return this}getFlavor(e,t,i){let r=i?6:(e?3:0)+t;if(r===0)return this;this.flavors===void 0&&(this.flavors=[]),r-=1;let s=this.flavors[r];return s===void 0&&(s=new JOe(e,t,i,this),s.needsJitter=this.needsJitter,this.flavors[r]=s,s.flatShading=e,s.side=t,s.updateAfterBuild()),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){return this.lightLayer.getNode("occlusion")?.value??!1}reset(e,t,i=!1){Xo.startContext(this),(this.data!==e||i)&&this.reset0(e,t),Xo.endContext(this)}reset0(e,t){this.data=e;let i=e.layers??Ra.defaultTwoLayerData("phong").layers;try{this.layers=i.map(r=>ZS.create(this.layerIdGen++,r.id,r.data,t.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(t.shared),this.transparent=q_(e,t.shared),this.saveVariableLocations(t)}onVariableUpdate(e,t,i){if(e[0]==="alphaOverride")this.transparent=q_(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(t)/100,1)));else if(e[0]==="layer"){let r=e[1],s=e[2];if(r&&s){let n=this.layers.find(c=>c.uuid===r);n?.hasValue(s)&&(s==="alpha"?(this.transparent=q_(this.data,i.shared),n.setValue(s,Math.max(0,Math.min(Number(t)/100,1)))):n.setValue(s,t))}}}saveVariableLocations(e){if(!this.allowVariableSaves)return;let t=this.data.layers.find(i=>i.data.type==="light");t&&e.shared.getVariable(t.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(i=>{"alpha"in i.data&&typeof i.data.alpha=="string"&&e.shared.getVariable(i.data.alpha,["material",this.uuid,"layer",i.id,"alpha"])})}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(e){this.lightLayer=this.layers.find(t=>t instanceof Vh),this.lightLayer===void 0&&(this.lightLayer=new Vh(0,"",pt(me({},ca.defaultData("light","phong")),{visible:!1}),new gU,{},e)),this.dispose();for(let t of this.flavors)t&&t.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let e=this.layers.find(s=>s instanceof Vh);if(!e)return;let t=e.data,i=t.bumpMap,r=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let s=0;s<this.layers.length;++s){let n=this.layers[s];n instanceof eo&&n.color instanceof fU&&(n.uuid===i&&(e.node.bumpMap=n.color),n.uuid===r&&(e.node.roughnessMap=n.color))}}updateByOp(e,t,i){if(Xo.startContext(this),t!==void 0?this.data=t:t=this.data,this.transparent=q_(t,i.shared),e.path[0]==="layers"){let r=i.shared,s=e.path[1];if(s===void 0)i.scene.markNeedsUpdateRendererDirty(),this.reset0(t,i);else{e.type===0&&e.props.occlusion!==void 0&&i.scene.markNeedsUpdateRendererDirty();let n=this.layers.find(c=>c.uuid===s);if(n){let c=t.layers.data(s),u;e.type===0&&("alpha"in e.props||"alphaOverride"in e.props)&&("alpha"in e.props?u=pt(me({},e.props),{alpha:Vy(e.props.alpha,r,["material",this.uuid,"layer",s,"alpha"])}):u=pt(me({},e.props),{alphaOverride:Vy(e.props.alphaOverride,r,["material",this.uuid,"alphaOverride"])})),n.updateByOp(pt(me(me({},e),u?{props:u}:{}),{path:e.path.slice(2)}),c,i)&&this.reset0(t,i)}}}else this.reset0(t,i);Xo.endContext(this)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof eo?t.color.mask=void 0:t instanceof Vh&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof eo&&t.isMask.value&&t.data.visible&&e>0){let i=e-1,r=this.layers[i];r instanceof Vh?r.node.mask=new Ll(t.color,t.alpha,Ll.MUL):r instanceof eo&&(r.isMask.value||(r.color.mask=new Ll(t.color,t.alpha,Ll.MUL)))}}}blendColors(){let e=this.layers.findIndex(i=>i instanceof eo),t=this.layers.findIndex(i=>i instanceof Vh);if(e!==-1&&e<t){let i=this.layers[e].color;for(let r=e+1;r<t;++r){let s=this.layers[r];if(s instanceof eo){if(s.isMask.value)continue;i=new L$(i,s.color,s.alpha,s.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new zs("outgoingLight","f"),t=this.layers.findIndex(i=>i instanceof Vh);if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let r=this.layers[i];if(r instanceof eo){if(r.isMask.value)continue;e=new L$(e,r.color,r.alpha,r.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof mte);if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new Ll(t,e[i].position,Ll.ADD),t=new Ll(t,new Zi(.5).setReadonly(!0),Ll.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=this.extensions.derivatives===!0,e.extensionFragDepth=this.extensions.fragDepth===!0,e.extensionDrawBuffers=this.extensions.drawBuffers===!0,e.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(e,t){let i=(r,s,n)=>Math.min(Math.max(r,s),n);for(let r of this.layers)if(r.type==="displace"){let s=i(r.uniforms[`f${r.id}_intensity`].value,e,t);r.uniforms[`f${r.id}_intensity`].value=s}}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new jee;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof eo){let t=e.params.texture;if(t instanceof RB&&!t.image.loaded)return!1}return!0}};Object.defineProperties(_m.prototype,{properties:{get:function(){return this.fragment.properties}}});var FB=class extends yU{constructor(e,t,i){super(e,t,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(t)}},H$=new Map;function e3e(e){if(typeof e=="string")return e;let t=H$.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},H$.set(e,t)),t.url}var yte,t3e=new Promise(e=>{yte=e}),W$=!1,D2;function i3e(){if(W$)return;if(D2)return D2;function e(){return jn(this,null,function*(){yield import("./chunk-PHUGBRRI.js"),yte(window!==void 0?window:global),W$=!0})}return D2=e(),D2}var vte;t3e.then(e=>vte=e);function r3e(e){let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.events===void 0||Array.isArray(r.events)===!1)return!0;let s=[];r.events.forEach(n=>{"dragDropActions"in n.data?(s.push(...n.data.dragDropActions.drag),s.push(...n.data.dragDropActions.drop)):"inActions"in n.data?(s.push(...n.data.inActions),s.push(...n.data.outActions)):"gameActions"in n.data?(s.push(...n.data.gameActions.idle),s.push(...n.data.gameActions.move),s.push(...n.data.gameActions.jump),s.push(...n.data.gameActions.run)):"breakpoints"in n.data?n.data.breakpoints.forEach(c=>{s.push(...c.data.actions)}):"actions"in n.data&&s.push(...n.data.actions),t=t||s.some(c=>c.data.type==="Audio")})}),t}var rS=class{constructor({src:e,volume:t,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let s;typeof e=="string"?s={src:e}:s={src:e3e(e),format:"wav"},this.sound=new vte.Howl(s),this.sound.on("end",this.onEnd),this.src=e,t!==void 0&&(this.volume=t),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},n3e=class{constructor(){this.type="ShapePath",this.color=new Tr,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new bD,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath?.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){return this.currentPath?.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,s,n){return this.currentPath?.bezierCurveTo(e,t,i,r,s,n),this}splineThru(e){return this.currentPath?.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function i(A,I,P,O){let k=A.x,U=I.x,j=P.x,V=O.x,$=A.y,Y=I.y,J=P.y,X=O.y,ee=(V-j)*($-J)-(X-J)*(k-j),oe=(U-k)*($-J)-(Y-$)*(k-j),le=(X-J)*(U-k)-(V-j)*(Y-$),ve=ee/le,we=oe/le;if(le===0&&ee!==0||ve<=0||ve>=1||we<0||we>1)return null;if(ee===0&&le===0){for(let fe=0;fe<2;fe++)if(r(fe===0?P:O,A,I),t.loc===e.ORIGIN){let Ue=fe===0?P:O;return{x:Ue.x,y:Ue.y,t:t.t}}else if(t.loc===e.BETWEEN){let Ue=+(k+t.t*(U-k)).toPrecision(10),Fe=+($+t.t*(Y-$)).toPrecision(10);return{x:Ue,y:Fe,t:t.t}}return null}else{for(let Fe=0;Fe<2;Fe++)if(r(Fe===0?P:O,A,I),t.loc===e.ORIGIN){let Pe=Fe===0?P:O;return{x:Pe.x,y:Pe.y,t:t.t}}let fe=+(k+ve*(U-k)).toPrecision(10),Ue=+($+ve*(Y-$)).toPrecision(10);return{x:fe,y:Ue,t:ve}}}function r(A,I,P){let O=P.x-I.x,k=P.y-I.y,U=A.x-I.x,j=A.y-I.y,V=O*j-U*k;if(A.x===I.x&&A.y===I.y){t.loc=e.ORIGIN,t.t=0;return}if(A.x===P.x&&A.y===P.y){t.loc=e.DESTINATION,t.t=1;return}if(V<-Number.EPSILON){t.loc=e.LEFT;return}if(V>Number.EPSILON){t.loc=e.RIGHT;return}if(O*U<0||k*j<0){t.loc=e.BEHIND;return}if(Math.sqrt(O*O+k*k)<Math.sqrt(U*U+j*j)){t.loc=e.BEYOND;return}let $;O!==0?$=U/O:$=j/k,t.loc=e.BETWEEN,t.t=$}function s(A,I){let P=[],O=[];for(let k=1;k<A.length;k++){let U=A[k-1],j=A[k];for(let V=1;V<I.length;V++){let $=I[V-1],Y=I[V],J=i(U,j,$,Y);J!==null&&P.find(X=>X.t<=J.t+Number.EPSILON&&X.t>=J.t-Number.EPSILON)===void 0&&(P.push(J),O.push(new lt(J.x,J.y)))}}return O}function n(A,I,P){let O=new lt;I.getCenter(O);let k=[];return P.forEach(U=>{U.boundingBox.containsPoint(O)&&s(A,U.points).forEach(j=>{k.push({identifier:U.identifier,isCW:U.isCW,point:j})})}),k.sort((U,j)=>U.point.x-j.point.x),k}function c(A,I,P,O,k){(k==null||k==="")&&(k="nonzero");let U=new lt;A.boundingBox.getCenter(U);let j=[new lt(P,U.y),new lt(O,U.y)],V=n(j,A.boundingBox,I);V.sort((oe,le)=>oe.point.x-le.point.x);let $=[],Y=[];V.forEach(oe=>{oe.identifier===A.identifier?$.push(oe):Y.push(oe)});let J=$[0].point.x,X=[],ee=0;for(;ee<Y.length&&Y[ee].point.x<J;)X.length>0&&X[X.length-1]===Y[ee].identifier?X.pop():X.push(Y[ee].identifier),ee++;if(X.push(A.identifier),k==="evenodd"){let oe=X.length%2===0,le=X[X.length-2];return{identifier:A.identifier,isHole:oe,for:le}}else if(k==="nonzero"){let oe=!0,le=null,ve=null;for(let we=0;we<X.length;we++){let fe=X[we];I[fe]&&(oe?(ve=I[fe].isCW,oe=!1,le=fe):ve!==I[fe].isCW&&(ve=I[fe].isCW,oe=!0))}return{identifier:A.identifier,isHole:oe,for:le}}else console.warn('fill-rule: "'+k+'" is currently not implemented.')}let u=0,p=999999999,f=-999999999,x=[];this.subPaths.forEach(A=>{let I=A.getPoints(),P=-999999999,O=999999999,k=-999999999,U=999999999;for(let j=0;j<I.length;j++){let V=I[j];V.y>P&&(P=V.y),V.y<O&&(O=V.y),V.x>k&&(k=V.x),V.x<U&&(U=V.x)}f<=k&&(f=k+1),p>=U&&(p=U-1),I.length&&x.push({curves:A.curves,points:I,isCW:bK.isClockWise(I),identifier:u++,boundingBox:new OK(new lt(U,O),new lt(k,P))})});let w=x.map(A=>c(A,x,p,f,this.userData?.style.fillRule)),E=[];return x.forEach(A=>{let I=w[A.identifier];if(I&&!I.isHole){let P=new wD;P.curves=A.curves,w.filter(O=>O?.isHole&&O.for===A.identifier).forEach(O=>{if(O){let k=x[O.identifier],U=new bD;U.curves=k.curves,P.holes.push(U)}}),E.push(P)}}),E}},_te=!1,xte,q$=new Promise(e=>{xte=e}),Y$=!1,I2;function s3e(){if(_te=!0,Y$)return;if(I2)return I2;function e(){return jn(this,null,function*(){let t=yield import("./chunk-DH46XXCJ.js");xte(t),Y$=!0})}return I2=e(),I2}var o3e=class{load(e,t,i=()=>{}){return jn(this,null,function*(){let{load:r}=yield q$;r(e,(s,n)=>{s||!n?i(s??"Something went wrong"):t(n)})})}parse(e){return jn(this,null,function*(){let{parse:t,Bidi:i}=yield q$;try{let r=t(e),s=new i,n=c=>r.charToGlyphIndex(c.char);return s.registerModifier("glyphIndex",null,n),s.applyFeatures(r,r.defaultRenderOptions.features),{font:r,bidi:s}}catch(r){console.error(r)}})}};function a3e(e){return jn(this,null,function*(){return yield(yield fetch(e)).arrayBuffer()})}var l3e=new o3e;function X$(e){return jn(this,null,function*(){let t,i,r=!1;if(e.url?(t=yield a3e(e.url),i=e.url,r=e.url.startsWith("/")):e.data&&(t=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength)),t)if(_te){let s=yield l3e.parse(t);if(s)return{font:s.font,url:i,intercepted:r,arr:t,bidi:s.bidi}}else return{font:void 0,url:i,intercepted:r,arr:t,bidi:null}})}function c3e(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var u3e=class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=X$(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=X$(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let r=this._bidi;r.getTextGlyphs(t);let s=r.tokenizer.tokens,n=[],c=0,u=i.length===s.length;for(let p=0;p<i.length;p++){let f=i[p].index,x=String.fromCharCode(i[p].unicode),w=s[c];if(c3e(f,w)||u)n.push({char:x,index:f,replacements:[w.state.glyphIndex],replacementChars:[w.char]}),c++;else{let E=w.char,A="",I=[w.state.glyphIndex],P=[],O=!1;for(;!O;)c++,A=t.charAt(c),E+=A,I.push(e.charToGlyphIndex(A)),P=e.stringToGlyphs(E),P.length===1&&P[0].index===f&&(O=!0),c>t.length&&(O=!0);n.push({char:x,index:f,replacements:I,replacementChars:Array.from(E)}),c++}}return n}generateShapes(e,t){if(!this._isLoaded)return;let i=this.font,r=t.fontSize/this.unitsPerEm,s=t.fontSize*t.lineHeight,n=e.map(k=>this.getTextWidth(k,t)),c=t.width,u=this.getCharWidth(`
`,t),p=t.horizontalAlign===1?u:0,f=this.computeSpaceWidthForLine(e,0,t),x=this.getLineInitialOffsetX(n[0],c,t.horizontalAlign,e[0],u),w=this.getLineInitialOffsetY(s,e.length,t.height,r,t.verticalAlign),E=[],A=e.map(k=>[]),I=e.map(k=>[]),P;for(let k=0;k<e.length;k++){let U=e[k],j={features:{liga:!0}},V=[];try{V=i.stringToGlyphs(U,j)}catch(Y){console.warn(Y)}x=this.getLineInitialOffsetX(n[k],c,t.horizontalAlign,U,u);let $=[];try{$=this.reverseLigaturesTable(i,U,V)}catch(Y){console.warn(Y)}f=this.computeSpaceWidthForLine(e,k,t);for(let Y=0;Y<V.length;Y++){let J=V[Y],X=J.index===0?`
`:J.unicode?String.fromCharCode(J.unicode):void 0,ee=$[Y],oe=0,le=0;Y===0&&t.horizontalAlign===2&&J.leftSideBearing!==void 0&&(le=-J.leftSideBearing*r),P&&(oe=i.getKerningValue(J,P)*r),x+=le+oe;let ve=0;if(X===`
`)ve=p;else if(X===" ")ve=f;else{let we=this.createPath(J,r,x,w,t);we&&(ve=we.offsetX-(oe+le),E.push(we.path))}if(ee.replacements.length===1)I[k].push([x,w]),A[k].push(ve);else{let we=ee.replacements.map(Pe=>(i.glyphs.get(Pe).advanceWidth??0)*r),fe=we.reduce((Pe,Ae)=>Pe+=Ae,0),Ue=we.map(Pe=>Pe/fe),Fe=x;for(let Pe=0;Pe<Ue.length;Pe++){let Ae=ve*Ue[Pe];I[k].push([Fe,w]),A[k].push(Ae),Fe+=Ae}}x+=ve,P=J}w-=s}let O=[];for(let k=0,U=E.length;k<U;k++)O.push(...E[k].toShapes());return{shapes:O,charWidths:A,lineWidths:n,charCoords:I}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){return this.font?.ascender??0}get descender(){return this.font?.descender??0}get familyName(){return this.font?.names.fontFamily??""}get subfamilyName(){return this.font?.names.fontSubfamily??""}get unitsPerEm(){return this.font?.unitsPerEm??1}getLineInitialOffsetX(e,t,i,r,s){return(i===3||i===2)&&r.indexOf(`
`)>=0&&(e-=s),i===3?t*.5-e*.5:i===2?t-e:0}getLineInitialOffsetY(e,t,i,r,s){let n=t*e,c=Math.abs(this.ascender-this.descender)*r,u=e-c,p=-this.ascender*r-u/2;return s===3?-(i-n-p):s===2?-(i*.5-n*.5-p):p}createPath(e,t,i,r,s){let n=e.getPath(i,-r,s.fontSize,{kerning:!1,letterSpacing:s.letterSpacing});if(!n){console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");return}let c=new n3e,u=(e.advanceWidth??1)*t;if(e)for(let p of n.commands){let f=c.currentPath?.currentPoint;if(!(f&&p.type!=="Z"&&f.x===p.x&&-f.y===p.y))switch(p.type){case"M":c.moveTo(p.x,-p.y);break;case"L":c.lineTo(p.x,-p.y);break;case"Q":c.quadraticCurveTo(p.x1,-p.y1,p.x,-p.y);break;case"C":c.bezierCurveTo(p.x1,-p.y1,p.x2,-p.y2,p.x,-p.y);break}}return c.subPaths.forEach(p=>{let f=h3e(p.curves);f!==void 0&&p.currentPoint.distanceTo(f)>0&&p.lineTo(f.x,f.y)}),{offsetX:u+s.fontSize*s.letterSpacing,path:c}}getCharWidth(e,t){return this.font?.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing})??0}getTextWidth(e,t){return this.font?.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing})??0}computeSpaceWidthForLine(e,t,i){let r=this.getCharWidth(" ",i),s=e[t];if(s){let n=this.countSpaces(s.trimEnd());if(i.horizontalAlign===4&&t<e.length-1&&n){let c=i.width,u=this.getTextWidth(s,i);return(c-(u-n*r))/n}}return r}countSpaces(e){return(e.match(/ /g)||[]).length}};function h3e(e){if(e.length){let t=e[0];if(t instanceof qu)return t.v1;if(t instanceof Vu||t instanceof ym)return t.v0}}var d3e=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t,i){let r=this.objects.get(e);return r===void 0?(r=this.createObject(e,t,i),this.objects.set(e,r)):r.isShared=!0,r}forceDelete(e){let t=this.objects.get(e);t&&(this.disposeObject(t),this.objects.delete(e))}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&i.isShared!==!0)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){let i=this.objects.get(e);t===i&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},$$=class extends d3e{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t,i){let r=kS(e,t,this.flatShading,i);return r.computeBoundingSphere(),r}},p3e={markNeedsUpdateRendererDirty:()=>{}};function vU(e){return{all:e=e||new Map,on:function(t,i){var r=e.get(t);r?r.push(i):e.set(t,[i])},off:function(t,i){var r=e.get(t);r&&(i?r.splice(r.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var r=e.get(t);r&&r.slice().map(function(s){s(i)}),(r=e.get("*"))&&r.slice().map(function(s){s(t,i)})}}}var f3e=class{constructor(e,t,i){this.id=e,this.userAPI=t,this.result=void 0,this.error="null",this.isPrefetched=!1,this.isLoading=!1,this.isLoaded=!1,this.prefetchPromise=new Promise(r=>r()),this.emitter=vU(),t?.integration?.type==="OpenAI"?this.result={content:""}:t.method==="GET"&&t.url!==""&&(this.prefetchPromise=this.prefetch(i))}prefetch(e){return jn(this,null,function*(){yield this.callUserAPI(e)})}callUserAPI(e){return jn(this,null,function*(){this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=yield _3e(this.userAPI,e),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(t){let i=t.message?.split("_:_")?.[0]?.replace("status:","")??"null";this.error=i,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0})}update(e,t){this.userAPI=e,this.userAPI.url!==""&&this.userAPI.method==="GET"&&this.prefetch(t)}retrieveValue(e){if(this.result)try{return Zo.zoom(this.result,e)}catch(t){console.error(t)}}retrieveZoomedKeyValues(e){if(this.result){let t=e&&e.length?Zo.zoom(this.result,e):this.result;if(v3e(t))return Object.entries(t);if(y3e(t))return t.map((i,r)=>[r.toString(),i]);throw g3e(t)?new Error("This path points to a value, use retrieveValue() instead. "+e?.join(".")):new Error("Path error"+e?.join("."))}}dispose(){}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}get autostart(){return this.userAPI.autoStart}};function m3e(e){let t=new Headers;return e.headers.forEach(i=>{i.data.key!==""&&t.append(i.data.key,i.data.value)}),t}function g3e(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e===null}function y3e(e){return Array.isArray(e)}function v3e(e){return typeof e=="object"&&e!==null}function _3e(r,s){return jn(this,arguments,function*(e,t,i=new AbortController){let n;if(e.integration?.type==="OpenAI"){let u=nD(e.integration.prompt===""?"":JSON.parse(e.integration.prompt),t),p=e.integration.behavior===""?"":nD(JSON.parse(e.integration.behavior),t);n=`{
			"model": "${e.integration.model}",
			"messages": [${e.integration.useBehavior?`
			{
				"role": "system",
				"content": "${p}"
			},`:""}
			{
				"role": "user",
				"content": "${u}"
			}
			]
		}`}else e.method==="POST"&&e.body&&(n=nD(JSON.parse(e.body),t));let c=yield fetch(e.url,{method:e.method,headers:m3e(e),signal:i.signal,body:n});if(!c.ok)throw new Error("status:"+c.status+"_:_"+c.statusText);return e.integration?.type==="OpenAI"?{content:(yield c.json()).choices[0].message.content}:yield c.json()})}var bte=(e,t)=>{if(typeof e=="string"){let i=t.getVariable(e);if(i)return bte(i,t)}return Oa.isBoolean(e)?Oa.getDisplayedValue(e).toLowerCase():Oa.getDisplayedValue(e)},nD=(e,t)=>e.map((i,r)=>{if("text"in i)return i.text;if("type"in i){if(i.type==="paragraph")return(r>0?`
`:"")+nD(i.children,t);if(i.type==="variable"){let s=t.getVariable(i.variableId);if(s!==void 0)return bte(s,t)}}return""}).join(""),sD=1e3,Z$=512*sD;function x3e(e,t){let i=typeof e;return!!((t==="string"||t==="number")&&i===t||t==="boolean"&&(e==="true"||e==="false"||e===!0||e===!1)||t==="image"&&i==="string"&&e.startsWith("http"))}var wte="https://hooks.spline.design",b3e=`${wte}/events?hashFile=`,OYe=`${wte}/`,w3e=class{constructor(e,t){this.id=e,this.userWebhook=t,this.result=void 0,this._connected=!1,this.emitter=vU(),this.reconnectWaitFor=sD,this._onError=i=>{this.eventSource?.removeEventListener("message",this._onMessage),this.eventSource?.removeEventListener("error",this._onError),this.eventSource?.removeEventListener("open",this._onConnected),this._scheduleReconnect()},this._onConnected=i=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=sD,this._connected=!0},this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=sD,this._connected=!1},this._onMessage=i=>{let r=i.data,s;try{s=JSON.parse(r)}catch(n){console.error("Error parsing webhook message",n)}if(s){let n=!1;this.userWebhook.parametersSchemas.forEach(({data:c})=>{s[c.name]!==void 0&&x3e(s[c.name],c.type)&&(this.result===void 0&&(this.result={}),this.result[c.name]=s[c.name],n=!0)}),n&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(b3e+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){this.eventSource?.removeEventListener("message",this._onMessage),this.eventSource?.removeEventListener("error",this._onError),this.eventSource?.removeEventListener("open",this._onConnected),this.eventSource?.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>Z$&&(this.reconnectWaitFor=Z$),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout(()=>{this.scheduledReconnectHandle=void 0,this.connect()},this.reconnectWaitFor)}update(e){this.userWebhook=e}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}getParametersKeys(){return this.userWebhook.parametersSchemas.map(e=>e.data.name)}getParameterValue(e){if(this.getParametersKeys().includes(e)){if(this.result)return this.result?.[e];for(let t of this.userWebhook.parametersSchemas)if(t.data.name===e)return uB.defaultParameterValueByType(t.data.type)}}};function kB(e){return"variable_"+e}var S3e=class extends uOe{constructor(e){super(),this.shared=e}create(e){return new ute(e,this.shared)}},_U=class{constructor(e,t={},i=!0,r=!1){if(this.data=e,this.needsJitter=i,this.enableLocalStorageForPersistentVariables=r,this.geometryCache=new $$(!0),this.geometryCache2=new $$(!1),this.imageHolderCache=new S3e(this),this.thisContext={scene:p3e,shared:this},this.deletedMaterial=new FB(Ra.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new rm(dB.emptyImage,this),this.deletedVideo=new rm(GD.defaultVideo,this),this.materials={},this.images={},this.uiBuffers={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.userAPIs={},this.userWebhooks={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[s,n]of Object.entries(t.images))this.addImage(s,n);if(t.videos)for(let[s,n]of Object.entries(t.videos))this.addVideo(s,n);if(t.audios)for(let[s,n]of Object.entries(t.audios))this.addAudio(s,n);if(t.particles)for(let[s,n]of Object.entries(t.particles))this.addParticle(s,n);this.reset(e)}setRequestRender(e){this._requestRender=e}getImageLoadPromises(){return Object.values(this.images).map(e=>e.loadPromise)}setEntityOpContext(e){this.entityOpContext=e}reset(e,t=!1){this.data=e,this.resetLib(e.lib);for(let{id:i,data:r}of e.variables)this.addVariableHolder(i,r),t&&this.updateVariableHolder(i,r);for(let[i,r]of Object.entries(e.userAPIs))this.addUserAPI(i,r);for(let[i,r]of Object.entries(e.userWebhooks))this.addUserWebhook(i,r);for(let[i,r]of Object.entries(e.images))this.addImage(i,r);for(let[i,r]of Object.entries(e.videos))this.addVideo(i,r);for(let[i,r]of Object.entries(e.colors))this.addColor(i,r);for(let[i,r]of Object.entries(e.materials))this.addMaterial(i,r);for(let[i,r]of Object.entries(e.audios))this.addAudio(i,r);for(let[i,r]of Object.entries(e.particles))this.addParticle(i,r);for(let[i,r]of Object.entries(e.fonts))this.addFont(i,r)}addMaterial(e,t){if(this.materials[e]){let i=this.materials[e];i.reset(t,this.thisContext),i.dispose()}else{let i=new FB(t,this.thisContext,e);this.materials[e]=i}}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return typeof e=="string"?this.getMaterialOrDeletedPlaceholder(e):e==null?(console.error("material is undefined or null"),this.deletedMaterial):new yU(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new rm(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return typeof e=="string"?this.getImage(e):this.imageHolderCache.load(e)}addUIBuffer(e,t){return this.uiBuffers[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[e].updateSrc(t),!0):(this.uiBuffers[e]=new rm(t,this),!1)}uiBuffer(e){return this.uiBuffers[e]}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new rm(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return typeof e=="string"?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):("a"in t?this.colors[e]=new oI(t.r,t.g,t.b,t.a):this.colors[e]=new oI(t.r,t.g,t.b,1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[e];return this.colors[e].r=t.r??i.r,this.colors[e].g=t.g??i.g,this.colors[e].b=t.b??i.b,this.colors[e].a=t.a??i.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}color(e){let t;if(typeof e=="string"){let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new La(0,0,0,0))}else return"a"in e?new La(e.r,e.g,e.b,e.a):new La(e.r,e.g,e.b,1);return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof rS)return t;{let i=new rS({src:t.data});return this.audios[e]=i,i}}addParticle(e,t){this.particles[e]=t}getParticle(e){return this.particles[e]}deleteParticle(e){this.particles[e]&&delete this.particles[e]}deleteAudio(e){let t=this.audios[e];t&&(t instanceof rS&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new u3e(t),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof rS&&e.dispose()}),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(e,t){if(this.variables[e]===void 0){let i=t.value;if(this.enableLocalStorageForPersistentVariables&&t.persistent){let r=localStorage.getItem(kB(e));i=r!==null?JSON.parse(r):t.value}return this.variables[e]={value:i,locations:[],persistent:t.persistent},"dynamicVariableType"in t&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0),!0}return this.variables[e].value=t.value,!1}resetDynamicVariablePlayState(){for(let e in this.variables)this.variables[e].dynamicVariablePlayState!==void 0&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(e,t){this.updateVariable(e,t.value)}updateVariable(e,t){if(this.variables[e]===void 0)return!1;this.variables[e].value=t,this.enableLocalStorageForPersistentVariables&&this.variables[e].persistent&&localStorage.setItem(kB(e),JSON.stringify(t));let i=t;for(;typeof i=="string";)i=this.variables[i].value;let r=this.entityOpContext.scene;for(let s=this.variables[e].locations.length-1;s>=0;s--){let n=this.variables[e].locations[s];if(n[0]==="material"){let c=n[1],u=i,p={scene:r,shared:this},f=n.slice(2);r.traverseMaterial(w=>{let E=w.root??w;E.uuid===c&&E.onVariableUpdate(f,u,p)});let x=this.materials[c];x&&x.onVariableUpdate(f,u,p)}else{let c=r.find(n[0]);if(c===void 0){this.variables[e].locations.splice(s,1);continue}if(n[1]!=="geometry"&&n[1]!=="particles"){for(let u=1;u<n.length-1;u++)c=c[n[u]];n[1]==="rotation"?c[n[n.length-1]]=i*Yi.DEG2RAD:c[n[n.length-1]]=i}if(c=r.find(n[0]),c.type==="ParticleEmitter"&&c.updateVariableState(i,n),Ln.is(c)){if(n[1]==="position"||n[1]==="rotation"||n[1]==="scale")c.onVariableUpdate();else if(n[1]==="geometry"){let u=c;c.component&&(u=c.component);let p=u.dataPatched;u.chooseGeoemtryCache(this).forceDelete(p.geometry),u.createGeometryDelayed(this.entityOpContext),u.onVariableUpdate(!0),u.instances.forEach(f=>{let x=f.dataPatched;f.chooseGeoemtryCache(this).forceDelete(x.geometry),f.createGeometryDelayed(this.entityOpContext),f.onVariableUpdate(!0)})}}}}return this.requestRender(),!0}deleteVariable(e){this.variables[e]&&delete this.variables[e]}getVariable(e,t){if(Array.isArray(e)){if(e[0]==="mouse")return this.mouseProperty?.[e[1]]??0;if(e[0]==="raycast")return this.raycastProperty?.[e[1]]??0;let i=this.entityOpContext.scene.find(e[0]);if(e[1]==="width"||e[1]==="height"||e[1]==="depth")return i.geometry.userData.parameters[e[1]];for(let r=1;r<e.length;r++)i=i[e[r]];return e[1]==="rotation"&&(i*=Yi.RAD2DEG),i}for(let i in this.variables){if(t===void 0)break;let r=this.variables[i],s=r.locations?.findIndex(n=>Zo.equal(n,t));s!==void 0&&s!==-1&&r.locations.splice(s,1)}if(typeof e=="string"){let i=e,r=e;do{if(r=i,this.variables[i]===void 0)break;let s=this.variables[i].value;t&&this.variables[r]!==void 0&&this.variables[r].locations.push(t),i=s}while(typeof i=="string");return i}else return e}getVariables(){return this.variables}getDynamicVariablePlayState(e){return this.variables[e]?.dynamicVariablePlayState}setDynamicVariablePlayState(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariablePlayState=t)}getDynamicVariableToggleIsForward(e){return this.variables[e]?.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariableToggleIsForward=t)}resetLib(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i.asset);for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.asset);for(let[t,i]of Object.entries(e.particles))this.addParticle(t,i.asset);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i.asset);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i.asset);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,i.asset);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i.asset);for(let[t,i]of Object.entries(e.variables))this.addVariableHolder(t,i.asset)}updateLibByOp(e,t){e.path[0]==="images"?e.path.length===1&&e.type===1?this.addImage(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteImage(e.id):e.path[0]==="videos"?e.path.length===1&&e.type===1?this.addVideo(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVideo(e.id):e.path[0]==="audios"?e.path.length===1&&e.type===1?this.addAudio(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteAudio(e.id):e.path[0]==="particles"?e.path.length===1&&e.type===1?this.addParticle(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteParticle(e.id):e.path[0]==="colors"?e.path.length===1&&e.type===1?this.addColor(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteColor(e.id):e.path[0]==="materials"?e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteMaterial(e.id):e.path[0]==="fonts"?e.path.length===1&&e.type===1?this.addFont(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteFont(e.id):e.path[0]==="variables"?e.path.length===1&&e.type===1?this.addVariableHolder(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVariable(e.id):e.path[0]==="components"&&t.updateByLibOp(e,this)}updateByOp(e,t,i){if(this.data=t,e.path[0]==="images")e.path.length===2&&e.type===0?e.props.data&&this.getImage(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addImage(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteImage(e.id);else if(e.path[0]==="videos")e.path.length===2&&e.type===0?e.props.data&&this.getVideo(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addVideo(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteVideo(e.id);else if(e.path[0]==="audios")e.path.length===2&&e.type===0?e.props.data&&this.addAudio(e.path[1],t.audios[e.path[1]]):e.path.length===1&&e.type===1?this.addAudio(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteAudio(e.id);else if(e.path[0]==="particles")e.path.length===2&&e.type===0?e.props.data&&this.addParticle(e.path[1],t.particles[e.path[1]]):e.path.length===1&&e.type===1?this.addParticle(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteParticle(e.id);else if(e.path[0]==="colors")e.path.length===2&&e.type===0?this.updateColor(e.path[1],e.props):e.path.length===1&&e.type===1?this.addColor(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteColor(e.id);else if(e.path[0]==="materials")e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data):e.path.length===1&&e.type===2?this.deleteMaterial(e.id):e.path.length>1&&this.getMaterial(e.path[1]).updateByOp(pa.drop(e,2),t.materials[e.path[1]],{shared:this,scene:i});else if(e.path[0]==="fonts")e.path.length===2&&e.type===0?this.updateFont(e.path[1],e,i):e.path.length===1&&e.type===1?this.addFont(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteFont(e.id);else if(e.path[0]==="variables")e.path.length===2&&e.type===0?"value"in e.props?this.updateVariable(e.path[1],e.props.value):"persistent"in e.props&&(this.variables[e.path[1]].persistent=e.props.persistent):e.path.length===1&&e.type===4?this.addVariableHolder(e.id,e.data):e.path.length===1&&e.type===5&&this.deleteVariable(e.id);else if(e.path[0]==="userAPIs"){if(e.path.length===1&&e.type===1)this.addUserAPI(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserAPI(e.id);else if(typeof e.path[1]=="string"){let r=t.userAPIs[e.path[1]];r&&this.getUserAPI(e.path[1])?.update(r,this)}}else if(e.path[0]==="userWebhooks"){if(e.path.length===1&&e.type===1)this.addUserWebhook(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserWebhook(e.id);else if(typeof e.path[1]=="string"){let r=t.userWebhooks[e.path[1]];r&&this.getUserWebhook(e.path[1])?.update(r)}}else e.path[0]==="lib"&&this.updateLibByOp(pa.drop(e,1),i)}updateFont(e,t,i){if(t.props.url){let r=this.getFont(e),s=pt(me({},this.data.fonts[e]),{url:t.props.url});r.update(s),r.loadingPromise.then(()=>this.requestRender()),i.updateFont(e,this)}}addUserAPI(e,t){return this.userAPIs[e]?(this.userAPIs[e].update(t,this),!0):(this.userAPIs[e]=new f3e(e,t,this),!1)}getUserAPI(e){return this.userAPIs[e]}getUserAPIs(){return this.userAPIs}deleteUserAPI(e){let t=this.userAPIs[e];t&&(t.dispose(),delete this.userAPIs[e])}addUserWebhook(e,t){return this.userWebhooks[e]?(this.userWebhooks[e].update(t),!0):(this.userWebhooks[e]=new w3e(e,t),!1)}getUserWebhook(e){return this.userWebhooks[e]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(e){let t=this.userWebhooks[e];t&&(t.dispose(),delete this.userWebhooks[e])}},LYe=new _U(Yc.emptyData()),kx=class extends wl{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),eDe(e.path,["materials"])!==null&&e.type===0&&Array.isArray(this.material))for(let[r,s]of Object.entries(e.props)){let n=i.shared.material(s);this.material[Number(r)]=n}else if(ws(e.path,["material"])&&this.material instanceof _m)"material"in t&&typeof t.material!="string"&&this.material.updateByOp(pa.drop(e,1),t.material,i);else if(ws(e.path,["materials","*"])&&Array.isArray(this.material)){let r=e.path[1];if("materials"in t&&r<this.material.length){let s=t.materials[r];typeof s!="string"&&this.material[r].updateByOp(pa.drop(e,2),s,i)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(e,t){super.updateState(e,t),e.castShadow!==void 0&&(this.castShadow=e.castShadow),e.receiveShadow!==void 0&&(this.receiveShadow=e.receiveShadow);let i=this.dataPatched;if(e.geometry?.type!=="NonParametricGeometry"&&"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe),t.scene.markNeedsUpdateRendererDirty()),(e.geometry?.type==="NonParametricGeometry"||"materials"in e)&&("materials"in e&&e.materials!==void 0?(this.disposeMaterial(),this.material=e.materials.map(r=>t.shared.material(r).getFlavor(i.flatShading,i.side,i.wireframe)),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe)],t.scene.markNeedsUpdateRendererDirty())),e.flatShading!==void 0||e.wireframe!==void 0||e.side!==void 0)if(Array.isArray(this.material))for(let r=0;r<this.material.length;r++)this.material[r]=this.material[r].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe)}disposeMaterial(){this.material&&vJ(this.material).forEach(e=>{e instanceof _m&&(e instanceof FB||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},Q$=new se,K$=new Gr,J$=new Gr,E3e=new se,eZ=new mi,Ya=class extends kx{constructor(e,t,i){super(e,t),this.data=t,this.isSkinnedMesh=!1,this.localGeometry=void 0,t.bindMode&&t.bindMatrix&&(this.bindMode=t.bindMode,this.bindMatrix=new mi().fromArray(t.bindMatrix),this.bindMatrixInverse=new mi)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof fr&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof _U){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e,this)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return qD.is2DParametricMesh(e.type)&&e.depth===0}get is2DType(){return qD.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),ws(e.path,["geometry"])&&this.updateByPatchedOpGeometry(pa.drop(e,1),t.geometry,i)}removeInteractionGeometry(e){this.localGeometry?.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if(i==="NonParametricGeometry"||i==="SubdivGeometry"){let r=e;if(this.localGeometry===void 0){let p=me(me({},this.data.geometry),r);this.localGeometry=kS(p,t,this.data.flatShading,this)}let s,n,c;r.scaleBaked?[s,n,c]=r.scaleBaked:{width:s,height:n,depth:c}=r;let u=this.localGeometry.userData;u.sxPrev!==void 0&&IB(this.localGeometry.attributes,s/u.sxPrev,n/u.syPrev,c/u.szPrev),u.sxPrev=s,u.syPrev=n,u.szPrev=c}else{let r=me(me({},this.data.geometry),e);this.localGeometry?.dispose(),this.localGeometry=kS(r,t,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let e of this.attachedSurfaceCloners)e.update()}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand(()=>t.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,i){let r=!1;e.type===0&&e.path.length===0&&Object.keys(e.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof yl&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),r||(i.scene?.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){e.geometry!==void 0&&this.updateGeometryOnStateUpdate(e.geometry,t),super.updateState(e,t)}updateGeometryGroupsIfNeeded(){Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(this.geometry.getIndex()?.count??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;this.is2DType?e.set(0,0,i.depth*.5):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):e.setScalar(0),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,t){this.skeleton=e,this.isSkinnedMesh=!0,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let t=new Gr,i=this.geometry.attributes.skinWeight;for(let r=0,s=i.count;r<s;r++){t.fromBufferAttribute(i,r);let n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),i.setXYZW(r,t.x,t.y,t.z,t.w)}}boneTransform(e,t){let i=this.skeleton;if(i===void 0)return;let r=this.geometry;K$.fromBufferAttribute(r.attributes.skinIndex,e),J$.fromBufferAttribute(r.attributes.skinWeight,e),Q$.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){let n=J$.getComponent(s);if(n!==0){let c=K$.getComponent(s);eZ.multiplyMatrices(i.bones[c].matrixWorld,i.boneInverses[c]),t.addScaledVector(E3e.copy(Q$).applyMatrix4(eZ),n)}}return t.applyMatrix4(this.bindMatrixInverse)}};function M3e(e){if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,r=i.position.array,s=i.normal.array,n=new Float32Array(r.length);for(let c=0;c<r.length;c+=3){let u=`${r[c]}_${r[c+1]}_${r[c+2]}`,p=new se(s[c],s[c+1],s[c+2]);t.has(u)?t.get(u)?.normals.push(p):t.set(u,{normals:[p],result:new se})}t.forEach((c,u)=>{for(let p of c.normals)c.result.add(p);c.result.divideScalar(c.normals.length)});for(let c=0;c<r.length;c+=3){let u=`${r[c]}_${r[c+1]}_${r[c+2]}`,p=t.get(u)?.result;p&&(n[c]=p.x,n[c+1]=p.y,n[c+2]=p.z)}e.geometry.setAttribute("extrudeNormal",new Vi(n,3))}function T3e(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=new se;for(let s=0;s<t.length;s+=3)r.set(t[s],t[s+1],t[s+2]).normalize(),i[s]=r.x,i[s+1]=r.y,i[s+2]=r.z;e.geometry.setAttribute("extrudeNormal",new Vi(i,3))}function xU(e){if(Array.isArray(e.material)){for(let t of e.material)if(t.getLayersOfType("outline").length===0)return}else if(!(e.material instanceof _m)||e.material.getLayersOfType("outline").length===0)return;e instanceof Ya&&e.is2DAndNoDepth?T3e(e):M3e(e)}function bU(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=parseInt(e.uuid.replace(/\D/g,"")),s=[Yi.seededRandom(r),Yi.seededRandom(r+1e4),Yi.seededRandom(r+2e4)];for(let n=0;n<t.length;n++)i[n]=s[n%3];e.geometry.setAttribute("randomColor",new Fr(i,3))}var Lh=new mo,Nw=new se;function A3e(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(t=!0)}),t}var NS=class extends Ya{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new mi,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(e){if(this.skipReactionUpdate===!0)return;let t=this.localGeometry?.uuid,{originalGeometry:i,subdividedGeometry:r,subdivPointer:s}=yl.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=s,i!==void 0&&(this.originalGeometry?.dispose(),this.originalGeometry=i),r!==void 0&&(this.subdividedGeometry?.dispose(),this.subdividedGeometry=r??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,xU(this),bU(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),e.flatShading!==void 0){let i=this.material;this.material=Array.isArray(i)?i.map(r=>r.getFlavor(!1,r.side,r.wireframe)):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){yl.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&yl.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=yl.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=yl.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,wl.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new jl,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;Lh.setFromBufferAttribute(t),Lh.getCenter(i),e.boundingSphere.radius=i.distanceTo(Lh.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),Lh.getSize(Nw),this.hasNonUniformScale&&Nw.divide(this.scale);let r={width:Nw.x,height:Nw.y,depth:Nw.z};return this.geometry.userData.parameters=r,r}updateBoundingSphere(e){let t=this.originalGeometry;Lh.min.set(e[0],e[2],e[4]),Lh.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(Lh.min.applyMatrix4(this.shearScaleInv),Lh.max.applyMatrix4(this.shearScaleInv)),t.boundingSphere===null&&(t.boundingSphere=new jl);let i=t.boundingSphere.center;Lh.getCenter(i),t.boundingSphere.radius=i.distanceTo(Lh.max)}freeSubdivPointer(){this.subdivPointer&&(yl.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,this.originalGeometry?.dispose(),this.subdividedGeometry?.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},tZ=-1,C3e=1,D3e={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},I3e={polygon_center:0,edge:1,vertex:2},P2=(e,t)=>(i,r)=>!t||i===0||e===0?0:e*r/100,nn=(e,t)=>{let i=Math.abs(t),r=i*-1;return(e-tZ)*(i-r)/(C3e-tZ)+r};function P3e(e){let t=[],i={};for(var r=0,s=e.length;r<s;r++){var n=JSON.stringify(e[r].pos.map(c=>Math.round(c*1e4)/1e4));i[n]||(t.push(e[r]),i[n]=!0)}return t}var R3e=new se,R2=new se,O3e=new se,L3e=new se;function rx(e,t){let i=O3e.fromArray(e),r=L3e.fromArray(t);R2.copy(r).sub(i);let s=R2.length();return R2.normalize().multiplyScalar(s*.5),R3e.copy(i).add(R2).toArray()}var Xc=new Ia,O2=new se,aI=new se,vy=new se;function z3e(e){let t=[];for(let i=0;i<=e.index.count;i++)if(O2.fromArray(e.index.array,i*3),Xc.setFromAttributeAndIndices(e.attributes.position,O2.x,O2.y,O2.z),Xc.getNormal(aI),Xc.getMidpoint(vy),!(isNaN(vy.x)||isNaN(vy.y)||isNaN(vy.z))){let{a:r,b:s,c:n}=Xc,c=r.toArray(),u=s.toArray(),p=n.toArray(),f=r.distanceTo(s),x=s.distanceTo(n),w=n.distanceTo(r),E=rx(c,u),A=rx(u,p),I=rx(p,c),P=[f,x,w],O=Math.max(...P),k=P.filter(V=>Math.round(V)===Math.round(O)).length>1,U=[],j=Xc.getMidpoint(vy).toArray();O===f&&!k&&(U=[A,I,I],j=E),O===x&&!k&&(U=[E,I,I],j=A),O===w&&!k&&(U=[E,A,A],j=I),k&&(U=[E,A,I]),t.push({vertices:[c,u,p],faceCenters:U,midpoint:j,norm:Xc.getNormal(aI).toArray()})}return t}function F3e(e){let t=[],{position:i}=e.attributes;for(let r=0;r<i.count;r++){Xc.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),Xc.getNormal(aI),Xc.getMidpoint(vy);let s=Xc.a.toArray(),n=Xc.b.toArray(),c=Xc.c.toArray();t.push({vertices:[s,n,c],faceCenters:[rx(s,n),rx(n,c),rx(c,s)],midpoint:vy.toArray(),norm:aI.toArray()})}return t}var k3e=4,N3e=.5,wk=e=>.5*(1-Math.cos(e*Math.PI)),B3e=class{constructor(){this.perlin=new Array(4096)}noise(e,t=0,i=0){if(this.perlin==null){this.perlin=new Array(4096);for(let O=0;O<4096;O++)this.perlin[O]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let r=Math.floor(e),s=Math.floor(t),n=Math.floor(i),c=e-r,u=t-s,p=i-n,f,x,w=0,E=.5,A,I,P;for(let O=0;O<k3e;O++){let k=r+(s<<4)+(n<<8);f=wk(c),x=wk(u),A=this.perlin[k&4095],A+=f*(this.perlin[k+1&4095]-A),I=this.perlin[k+16&4095],I+=f*(this.perlin[k+16+1&4095]-I),A+=x*(I-A),k+=256,I=this.perlin[k&4095],I+=f*(this.perlin[k+1&4095]-I),P=this.perlin[k+16&4095],P+=f*(this.perlin[k+16+1&4095]-P),I+=x*(P-I),A+=wk(p)*(I-A),w+=A*E,E*=N3e,r<<=1,c*=2,s<<=1,u*=2,n<<=1,p*=2,c>=1&&(r++,c--),u>=1&&(s++,u--),p>=1&&(n++,p--)}return w}noiseSeed(e){let t=(()=>{let i,r;return{setSeed(s){r=i=(s??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return r=(1664525*r+1013904223)%4294967296,r/4294967296}}})();t.setSeed(e),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=t.rand()}},U3e=B3e,iZ=new se,rZ=new mi,nZ=new Sx;function sZ(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="TextGeometry"&&(t=!0)}),t}var wU=class extends Ya{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){let e=this.dataPatched;return this.font?.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign)??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){return(this.font?.ascender??1)*this.fontScale}get descender(){return(this.font?.descender??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!(isNaN(e.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(rZ.copy(i).invert(),nZ.copy(e.ray).applyMatrix4(rZ),nZ.intersectBox(this.singleBBox,iZ))){let r=iZ.applyMatrix4(i),s=e.ray.origin.distanceTo(r);t.push({distance:s,point:r.clone(),object:this})}}},fl=1e-4,zh,Ste,Ete,Mte,oZ=new se,aZ=new se;Ree.then(e=>{zh=e,Ste=[zh.get_face_center,zh.get_edge_midpoint,zh.get_vertex_position],Ete=[zh.get_face_normal,zh.get_edge_normal,zh.get_vertex_normal],Mte=[zh.face_count,zh.edge_count,zh.vertex_count]});var j3e=new mi,V3e=new mi,Wf=new se,L2=new se,Bw=new se,Sk=new se,G3e=new se,H3e=new se,Qd=new U3e,Hu=class extends iU(ls){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(this.parent===null)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof qa&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(t=>{t instanceof qa&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(e!==void 0?t=e:t=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"&&!this.parameters.toObject.object&&(t=0),this.parameters.type==="toObject"&&this.objectForSample){for(let r=0,s=this.children.length;r<s;++r)this.remove(this.children[0]);let i=this.children;if(i.length===t)return;if(i.length<t)for(let r=0,s=t-i.length;r<s;++r){let n=new qa(this.object);n.expand(),this.add(n)}else for(let r=0,s=i.length-t;r<s;++r)this.remove(i[r])}else{if(this.children.length===t)return;if(this.children.length<t)for(let i=0,r=t-this.children.length;i<r;++i){let s=new qa(this.object);s.expand(),this.add(s)}else for(let i=0,r=this.children.length-t;i<r;++i)this.remove(this.children[0])}}_updateRadial(e){let t=e.radial,i=t.start*Yi.DEG2RAD,r=t.end*Yi.DEG2RAD,s=i-r,n=new $o(t.rotation[0],t.rotation[1],t.rotation[2]),c;switch(t.axis){case"z":c=new se(0,0,1);break;case"y":c=new se(0,1,0);break;default:case"x":c=new se(1,0,0);break}let u=e.randomnessObject??om.defaultData([1,1,1]).randomnessObject,p=u.noiseType==="perlin";Qd.noiseSeed(u.seed);let f=tk((0,Ow.default)(u.seed)),x=P2(u.strength,this.parameters.randomness);for(let[w,E]of this.children.entries()){let A=w*(u.freqScale/10)+u.movement,I=p?Qd.noise(A):f(A,A),P=w+1;E.scale.x=t.scale[0]+x(P,nn(I,u.scale[0]))||fl,E.scale.y=t.scale[1]+x(P,nn(I,u.scale[1]))||fl,E.scale.z=t.scale[2]+x(P,nn(I,u.scale[2]))||fl,E.position.setScalar(0);let O=s/e.count*w-i;switch(t.axis){case"x":E.rotation.set(0,O,0);break;case"y":E.rotation.set(0,0,O);break;case"z":E.rotation.set(O,0,0);break}E.translateOnAxis(c,t.radius),E.position.x+=t.position[0]+x(P,nn(I,u.position[0])),E.position.y+=t.position[1]+x(P,nn(I,u.position[1])),E.position.z+=t.position[2]+x(P,nn(I,u.position[2]));let k=x(P,nn(I,u.rotation[0])),U=x(P,nn(I,u.rotation[1])),j=x(P,nn(I,u.rotation[2]));t.alignment===!0?(E.rotation.x+=n.x+k,E.rotation.y+=n.y+U,E.rotation.z+=n.z+j):E.rotation.set(n.x+k,n.y+U,n.z+j)}}_updateLinear(e){if(e.type!=="linear")throw new Error;let t=e.linear,i=new $o(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??om.defaultData([1,1,1]).randomnessObject,s=r.noiseType==="perlin";Qd.noiseSeed(r.seed);let n=tk((0,Ow.default)(r.seed)),c=P2(r.strength,this.parameters.randomness);for(let[u,p]of this.children.entries()){let f=u*(r.freqScale/10)+r.movement,x=s?Qd.noise(f):n(f,f),w=u+1,E=c(w,nn(x,r.rotation[0])),A=c(w,nn(x,r.rotation[1])),I=c(w,nn(x,r.rotation[2]));p.scale.x=1+(t.scale[0]-1)*u+c(w,nn(x,r.scale[0]))||fl,p.scale.y=1+(t.scale[1]-1)*u+c(w,nn(x,r.scale[1]))||fl,p.scale.z=1+(t.scale[2]-1)*u+c(w,nn(x,r.scale[2]))||fl,p.rotation.x=i.x*u+E,p.rotation.y=i.y*u+A,p.rotation.z=i.z*u+I,p.position.x=t.position[0]*u+c(w,nn(x,r.position[0])),p.position.y=t.position[1]*u+c(w,nn(x,r.position[1])),p.position.z=t.position[2]*u+c(w,nn(x,r.position[2]))}}_updateGrid(e){let t=0,i=e.grid,r=e.randomnessObject??om.defaultData([1,1,1]).randomnessObject,s=P2(r.strength,this.parameters.randomness),n=r.noiseType==="perlin";Qd.noiseSeed(r.seed);let c=kIe((0,Ow.default)(r.seed));if(i.useCenter===!0){let u={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},p=new se(i.size[0]*(i.count[0]-u.x)*.5,i.size[1]*(i.count[1]-u.y)*.5,i.size[2]*(i.count[2]-u.z)*.5);for(let f=0;f<i.count[0];f++)for(let x=0;x<i.count[1];x++)for(let w=0;w<i.count[2];w++){let E=[(f+1)*(r.freqScale/10)+r.movement,(x+1)*(r.freqScale/10)+r.movement,(w+1)*(r.freqScale/10)+r.movement],A=n?Qd.noise(...E):c(...E),I=this.children[t++];I.scale.x=1+s(t,nn(A,r.scale[0]))||fl,I.scale.y=1+s(t,nn(A,r.scale[1]))||fl,I.scale.z=1+s(t,nn(A,r.scale[2]))||fl;let P=s(t,nn(A,r.rotation[0])),O=s(t,nn(A,r.rotation[1])),k=s(t,nn(A,r.rotation[2]));I.rotation.set(P,O,k),I.position.x=i.size[0]*f-p.x+s(t,nn(A,r.position[0])),I.position.y=i.size[1]*x-p.y+s(t,nn(A,r.position[1])),I.position.z=i.size[2]*w-p.z+s(t,nn(A,r.position[2]))}}else for(let u=0;u<i.count[0];u++)for(let p=0;p<i.count[1];p++)for(let f=0;f<i.count[2];f++){let x=[(u+1)*(r.freqScale/10)+r.movement,(p+1)*(r.freqScale/10)+r.movement,(f+1)*(r.freqScale/10)+r.movement],w=n?Qd.noise(...x):c(...x),E=this.children[t++];E.scale.x=1+s(t,nn(w,r.scale[0]))||fl,E.scale.y=1+s(t,nn(w,r.scale[1]))||fl,E.scale.z=1+s(t,nn(w,r.scale[2]))||fl;let A=s(t,nn(w,r.rotation[0])),I=s(t,nn(w,r.rotation[1])),P=s(t,nn(w,r.rotation[2]));E.rotation.set(A,I,P),E.position.x=i.size[0]*u+s(t,nn(w,r.position[0])),E.position.y=-i.size[1]*p+s(t,nn(w,r.position[1])),E.position.z=-i.size[2]*f+s(t,nn(w,r.position[2]))}}_updateToObject(e){if(e.type!=="toObject")throw new Error;let{toObject:t}=e,i=new $o(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??om.defaultData([1,1,1]).randomnessObject,s=r.noiseType==="perlin";Qd.noiseSeed(r.seed);let n=tk((0,Ow.default)(r.seed)),c=P2(r.strength,this.parameters.randomness);if(!t.object){for(let[,P]of this.children.entries())P.position.set(0,0,0),P.scale.setScalar(1),P.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof wU)if(!this.objectForSample.font?.isLoaded||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let u=this.getSubdivData(),p=[],f=P=>{let O=P.length,k=P.map(V=>V[0]).reduce((V,$)=>V+$,0),U=P.map(V=>V[1]).reduce((V,$)=>V+$,0),j=P.map(V=>V[2]).reduce((V,$)=>V+$,0);return[k/O,U/O,j/O]},x=P=>Math.round(P*1e6)/1e6;u.forEach(P=>{let O=u.filter(k=>x(P.pos[0])===x(k.pos[0])&&x(P.pos[1])===x(k.pos[1])&&x(P.pos[2])===x(k.pos[2]));O.length>1?p.push({pos:P.pos,norm:f(O.map(k=>k.norm))}):p.push(P)});let w=P3e(p);if(w.length>0){let P=Math.round(w.length*t.count/100);this._updateCount(P)}else{let P=this.objectForSample.geometry.getAttribute("position");if(!P||isNaN(P.count)||P.count===0){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let E=new NIe(this.objectForSample).build(),A=D3e[t.axis],I=this.children;E.setRandomGenerator((0,Ow.default)(this.object.uuid+t.seed));for(let[P,O]of I.entries()){let k=P*(r.freqScale/10)+r.movement,U=s?Qd.noise(k):n(k,k),j=P+1,V=c(j,nn(U,r.rotation[0])),$=c(j,nn(U,r.rotation[1])),Y=c(j,nn(U,r.rotation[2]));t.spreadType==="random"?E.sample(Bw,Sk):(w.length&&(Bw.fromArray(w[P].pos),Sk.fromArray(w[P].norm)),this.objectForSample instanceof NS&&Bw.applyMatrix4(j3e.copy(this.objectForSample.matrixWorld).invert())),Bw.applyMatrix4(this.object.hiddenMatrix.clone().invert()),O.position.copy(Bw),Wf.fromArray(A);let J=t.align==="normal"?Sk:this.object.getWorldDirection(H3e),X=L2.fromArray(t.position);L2.x+=c(j,nn(U,r.position[0])),L2.y+=c(j,nn(U,r.position[1])),L2.z+=c(j,nn(U,r.position[2]));let ee=Math.acos(J.dot(Wf)),oe=G3e.crossVectors(Wf,J).normalize(),le=V3e.makeRotationAxis(oe,ee),ve=J.clone().cross(this.object.up).normalize(),we=ve.clone().cross(J).normalize(),fe=new mi().makeBasis(ve,J,we),Ue=new se(Wf.y,Wf.z,Wf.x).normalize(),Fe=Ue.clone().cross(Wf).normalize(),Pe=new mi().makeBasis(Ue,Wf,Fe).invert(),Ae=new mi().multiplyMatrices(fe,Pe);O.rotation.setFromRotationMatrix(Ae),X.applyMatrix4(le),O.position.add(X),O.rotation.x=O.rotation.x+i.x+V,O.rotation.y=O.rotation.y+i.y+$,O.rotation.z=O.rotation.z+i.z+Y,O.scale.setScalar(1),O.scale.x=O.scale.x+t.scale[0]+c(j,nn(U,r.scale[0]))||fl,O.scale.y=O.scale.y+t.scale[1]+c(j,nn(U,r.scale[1]))||fl,O.scale.z=O.scale.z+t.scale[2]+c(j,nn(U,r.scale[2]))||fl,O.scale.multiply(this.object.scale),O.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType;if(e==="random")return[];if(this.objectForSample instanceof NS){let t=this.objectForSample,i=I3e[e],r=Mte[i],s=Ste[i],n=Ete[i],c=[],u=r(t.subdivPointerNew);for(let p=0;p<=u-1;p++){let f=s(t.subdivPointerNew,p),x=n(t.subdivPointerNew,p);oZ.fromArray(f).applyMatrix4(t.matrixWorld),aZ.fromArray(x),c.push({pos:oZ.toArray(),norm:aZ.toArray()})}return c}else return(this.objectForSample.geometry.index?z3e(this.objectForSample.geometry):F3e(this.objectForSample.geometry)).map((t,i)=>e==="polygon_center"?{pos:t.midpoint,norm:t.norm}:e==="vertex"?[{pos:t.vertices[0],norm:t.norm},{pos:t.vertices[1],norm:t.norm},{pos:t.vertices[2],norm:t.norm}]:e==="edge"?[{pos:t.faceCenters[0],norm:t.norm},{pos:t.faceCenters[1],norm:t.norm},{pos:t.faceCenters[2],norm:t.norm}]:[]).flat()}updateState(e,t){if(this.parameters=CI(e),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),this.object.parent?.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let i=t.find(this.parameters.toObject.object);i instanceof wl?this.objectForSample=i:this.objectForSample=void 0,this.matrix=new mi,this.hiddenMatrix=new mi,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,i&&i.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},QS=e=>{var t;return t=class extends e{},t.geometryHelper=new $u(30,30,30),t},z2=new Sx,Ek=new jl,lZ=new mi,KS=(e,t,i,r,s=!1,n=e)=>{let c=t,u=n.matrixWorld;if(c.boundingSphere===null&&c.computeBoundingSphere(),Ek.copy(c.boundingSphere),Ek.applyMatrix4(u),i.ray.intersectsSphere(Ek)===!1||(lZ.copy(u).invert(),z2.copy(i.ray).applyMatrix4(lZ),c.boundingBox!==null&&z2.intersectsBox(c.boundingBox)===!1))return;let p,f,x,w,E=c.index,A=c.attributes.position,I=c.drawRange,P,O;if(s===!1){let U=Math.max(0,I.start),j=Math.min(E.count,I.start+I.count);for(P=U,O=j;P<O;P+=3)if(f=E.getX(P),x=E.getX(P+1),w=E.getX(P+2),p=k(e,i,z2,A,f,x,w),p){p.faceIndex=Math.floor(P/3),r.push(p);return}}else{let U=c.attributes.position,j=new se,V=new se,$=new se,Y=new se,J=2,X=1/((n.scale.x+n.scale.y+n.scale.z)/3),ee=X*X,oe=Math.max(0,I.start),le=Math.min(U.count,I.start+I.count);for(let ve=oe,we=le-1;ve<we;ve+=J){if(j.fromBufferAttribute(U,ve),V.fromBufferAttribute(U,ve+1),z2.distanceSqToSegment(j,V,Y,$)>ee)continue;Y.applyMatrix4(n.matrixWorld);let fe=i.ray.origin.distanceTo(Y);fe<i.near||fe>i.far||r.push({distance:fe,point:$.clone().applyMatrix4(n.matrixWorld),object:e})}}function k(U,j,V,$,Y,J,X){let ee=new se,oe=new se,le=new se,ve=new se,we=new se;if(ee.fromBufferAttribute($,Y),oe.fromBufferAttribute($,J),le.fromBufferAttribute($,X),V.intersectTriangle(ee,oe,le,!1,ve)===null)return null;we.copy(ve),we.applyMatrix4(U.matrixWorld);let fe=j.ray.origin.distanceTo(we);return fe<j.near||fe>j.far?null:{faceIndex:1,distance:fe,point:we.clone(),object:U}}},F2=new se,jc=new Hy,W3e=class extends VS{constructor(e){let t=new fr,i=new bm({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],n={},c=new Tr(15711266),u=new Tr(15711266),p=new Tr(2857471);f("n1","n2",c),f("n2","n4",c),f("n4","n3",c),f("n3","n1",c),f("f1","f2",c),f("f2","f4",c),f("f4","f3",c),f("f3","f1",c),f("n1","f1",c),f("n2","f2",c),f("n3","f3",c),f("n4","f4",c),f("p","n1",u),f("p","n2",u),f("p","n3",u),f("p","n4",u),f("u1","u2",p),f("u2","u3",p),f("u3","u1",p);function f(w,E,A){x(w,A),x(E,A)}function x(w,E){r.push(0,0,0),s.push(E.r,E.g,E.b),n[w]===void 0&&(n[w]=[]),n[w].push(r.length/3-1)}t.setAttribute("position",new Vi(r,3)),t.setAttribute("color",new Vi(s,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=n,this.update()}update(){let e=this.geometry,t=this.pointMap,i=!0;jc.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let r=1,s=1,n=i?.8:1e-4;Ou("n1",t,e,jc,-r,-s,n),Ou("n2",t,e,jc,r,-s,n),Ou("n3",t,e,jc,-r,s,n),Ou("n4",t,e,jc,r,s,n);let c=n;Ou("f1",t,e,jc,-r,-s,c),Ou("f2",t,e,jc,r,-s,c),Ou("f3",t,e,jc,-r,s,c),Ou("f4",t,e,jc,r,s,c);let u=c,p=.5;Ou("u1",t,e,jc,r*.7*p,s*1.1,u),Ou("u2",t,e,jc,-r*.7*p,s*1.1,u),Ou("u3",t,e,jc,0,s*(1.1+.9*p),u),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Ou(e,t,i,r,s,n,c){F2.set(s,n,c).unproject(r);let u=t[e];if(u!==void 0){let p=i.getAttribute("position");for(let f=0,x=u.length;f<x;f++)p.setXYZ(u[f],F2.x,F2.y,F2.z)}}var q3e=class extends QS(W3e){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){KS(this.object,this.geometry,e,t,!0)}},NB;(e=>e.is=t=>"objectHelper"in t)(NB||(NB={}));var Nx=(e,t)=>class extends rU(e){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof AD&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof $u?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof AD&&(r.visible=!1)}}},k2=790,T_=new se,Mk=new se,Tk=new Vr,Ak=new se,Uw=new se,Ck=new se,Xa=class extends Nx(Hy,q3e){constructor(e="",t=pt(me({},DS.defaultData),{name:""})){super(),this._cameraType="OrthographicCamera",this.targetOffset=fx.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new mi,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,r=this.height;this.orthoCamera=new vI(i*-.5,i*.5,r*.5,r*-.5,-5e4,1e4),this.perspCamera=new Ga(45,i/r,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){e==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&(e==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){e==="PerspectiveCamera"?this.toPerspective():e==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(e){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,i){typeof e=="number"&&(e=new se(e,t,i)),super.lookAt(e),this.getWorldPosition(T_),this.targetOffset=T_.distanceTo(e)}getTarget(e=new se){return this.getWorldDirection(Mk),this.getWorldPosition(T_),Mk.multiplyScalar(this.targetOffset),e.copy(T_).add(Mk),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(T_),T_.distanceTo(e)}updateUp(){this.getWorldQuaternion(Tk),Ak.set(0,0,1).applyQuaternion(Tk),Uw.copy(ls.DEFAULT_UP),this.isUpVectorFlipped&&Uw.negate(),Uw.applyQuaternion(Tk),Ck.copy(ls.DEFAULT_UP).projectOnPlane(Ak),this.angleOffsetFromUp=Ck.angleTo(Uw),this.angleOffsetFromUp*=Ck.cross(Uw).dot(Ak)>=0?1:-1}updateTransformState(e,t){let i=super.updateTransformState(e,t);return e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(e){let t=e.getWorldPosition(new se),i=e.getWorldDirection(new se).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToTarget(e){let t=this.getWorldDirection(new se).multiplyScalar(this.targetOffset);return{position:e.clone().sub(t),target:e}}getViewToObject(e){let t=new se,i=e.getWorldPosition(t);return this.getViewToTarget(t)}setViewplaneSize(e,t,i=!1){if(this.aspect=e/t,i){let r=e>t?this.aspect:1,s=e>t?1:this.aspect;this.left=-k2*.5*r,this.right=k2*.5*r,this.top=k2*.5*(1/s),this.bottom=-k2*.5*(1/s)}else this.left=-e*.5,this.right=e*.5,this.top=t*.5,this.bottom=-t*.5;this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,r,s,n){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(e,t,i,r,s,n):this.orthoCamera.setViewOffset(e,t,i,r,s,n)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=e.view===null?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return DN(t,e)}updateCameraSubtype(e,t){let i=e==="perspective"?"PerspectiveCamera":"OrthographicCamera";t.zoom!==void 0&&this.setZoom(i,t.zoom),t.near!==void 0&&this.setNear(i,t.near),t.fov!==void 0&&i==="PerspectiveCamera"&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),e.far!==void 0&&(this.far=e.far),e.orthographic!==void 0&&this.updateCameraSubtype("orthographic",e.orthographic),e.perspective!==void 0&&this.updateCameraSubtype("perspective",e.perspective),e.type!==void 0&&(this.cameraType=e.type),e.up!==void 0&&this.up.fromArray(e.up),e.targetOffset!==void 0&&(this.targetOffset=e.targetOffset),e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.type===0&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return pt(me(me({},super.toState(e)),this.toCameraState(e)),{type:this.cameraType})}},A_=new mi,Y3e=new mi;function cZ(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.geometry?.type==="BooleanGeometry"&&(t=!0)}),t}var Gy=class extends kx{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new fr,this.onAfterRender=(r,s,n,c,u,p)=>{super.onAfterRender(r,s,n,c,u,p),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&e.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){if(this.booleanMeshSetAddress!==-1&&!e)return;for(let r=0;r<this.children.length;r++){let s=this.children[r];s instanceof Gy&&s.dataPatched.visible===!0&&s.recomputeBoolean(e===!0,t)}this.meshSetAddresses=[];for(let r=0;r<this.children.length;r++){let s=this.children[r];if(s instanceof wl&&s.dataPatched.visible===!0&&s.geometry.attributes.position?.count>0&&s.geometry.drawRange.count>0&&s.booleanMeshSetAddress!==0){A_.multiplyMatrices(s.hiddenMatrix,s.matrix);try{if(s.booleanMeshSetAddress===-1){if((s.geometry.index??s.geometry.getAttribute("position")).count/3<15e5&&(s.booleanMeshSetAddress=sp.getMeshSet(s.geometry,e===!0,t)),s.booleanMeshSetAddress===-1)return;sp.transformMeshSet(s.booleanMeshSetAddress,A_),s.booleanMatrixInvOld.copy(A_).invert(),s.booleanWasTransformed=!1}else s instanceof Gy&&s.needsTransformForDownstream===!0?(sp.transformMeshSet(s.booleanMeshSetAddress,A_),s.needsTransformForDownstream=!1):s.booleanWasTransformed===!0&&(sp.transformMeshSet(s.booleanMeshSetAddress,Y3e.multiplyMatrices(A_,s.booleanMatrixInvOld)),s.booleanMatrixInvOld.copy(A_).invert(),s.booleanWasTransformed=!1)}catch(n){console.error(n),s.booleanMeshSetAddress=0,s.geometry.userData.booleanOperationDidFail=!0;continue}sp.hasOpenEdges(s.booleanMeshSetAddress)===!1||r===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(s.booleanMeshSetAddress),s.geometry.userData.booleanOperationDidFail=!1):s.geometry.userData.booleanOperationDidFail="openEdges"}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new Vi([],0)),this.geometry.setDrawRange(0,0);return}if(e===!0)return sp.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new fr,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=sp.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(r){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(r)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,xU(this),bU(this)}dispose(){super.dispose(),this.geometry.dispose()}},BB;(e=>{function t(i){return Ln.is(i)&&i instanceof WS}e.is=t})(BB||(BB={}));var SU=(e,t)=>class extends Nx(e,t){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},Uu=e=>e instanceof wl,vp=e=>e!==null&&e instanceof Gy,X3e=e=>e instanceof Xa,$3e=e=>BB.is(e),UB=e=>NB.is(e),Z3e=new se(1,1,1),uZ=new se,Q3e=new se,hZ=new Vr,JS=class extends QS(ibe){constructor(e,t=15){super(t),this.object=e,this.dummy=new gp,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){KS(this.object,JS.geometryHelper,e,t,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(e){this.object.matrixWorld.decompose(uZ,hZ,Q3e),this.matrix.compose(uZ,hZ,Z3e),super.updateMatrixWorld(e)}updateWorldMatrix(e,t){}},nx=class extends Nx(gp,JS){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t),"buffer"in e&&Object.keys(e).length===1&&t.scene.reloadSplats()}},oD=class extends Nx(gp,JS){constructor(e,t,i){super(),this.super_Entity(e,t),this.context=i,this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},Tte={RED:0,GREEN:1,BLUE:2,ALPHA:3},eE="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",K3e=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}`,N2=class extends Qn{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{kernel64:new di(null),kernel16:new di(null),inputBuffer:new di(null),cocBuffer:new di(null),texelSize:new di(new lt),scale:new di(1)},blending:Co,depthWrite:!1,depthTest:!1,fragmentShader:K3e,vertexShader:eE}),this.toneMapped=!1,t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=2.39996323,t=new Float32Array(128),i=new Float32Array(32),r=0,s=0;for(let u=0;u<80;++u){let p=u*e,f=Math.sqrt(u)/Math.sqrt(80),x=f*Math.cos(p),w=f*Math.sin(p);u%5===0?(i[s++]=x,i[s++]=w):(t[r++]=x,t[r++]=w)}let n=[],c=[];for(let u=0;u<128;)n.push(new Gr(t[u++],t[u++],t[u++],t[u++]));for(let u=0;u<32;)c.push(new Gr(i[u++],i[u++],i[u++],i[u++]));this.uniforms.kernel64.value=n,this.uniforms.kernel16.value=c}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function dZ(e,t,i){return e*(t-i)-t}function jB(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}var J3e=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,eLe=class extends Qn{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new di(null),focusDistance:new di(0),focusRange:new di(0),cameraNear:new di(.3),cameraFar:new di(1e3)},blending:Co,depthWrite:!1,depthTest:!1,fragmentShader:J3e,vertexShader:eE}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Ip){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-dZ(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=jB(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-dZ(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=jB(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Ga?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},tLe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,iLe="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",pZ=class extends Qn{constructor(e=new lt){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new di(null),texelSize:new di(new lt),halfTexelSize:new di(new lt),kernel:new di(0),scale:new di(1)},blending:Co,depthWrite:!1,depthTest:!1,fragmentShader:tLe,vertexShader:iLe}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},rLe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,nLe=class extends Qn{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new di(null),opacity:new di(1)},blending:Co,depthWrite:!1,depthTest:!1,fragmentShader:rLe,vertexShader:eE}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},sLe=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,oLe=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,kI={DEPTH:0,LUMA:1,COLOR:2},aLe={DISABLED:0,DEPTH:1,CUSTOM:2},lLe=class extends Qn{constructor(e=new lt,t=kI.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:wx.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new di(null),depthBuffer:new di(null),predicationBuffer:new di(null),texelSize:new di(e)},blending:Co,depthWrite:!1,depthTest:!1,fragmentShader:sLe,vertexShader:oLe}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Ip){this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(e*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},cLe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,uLe="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",Lu={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},VB=class extends Qn{constructor(e,t,i,r,s=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:wx.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new di(null),depthBuffer:new di(null),resolution:new di(new lt),texelSize:new di(new lt),cameraNear:new di(.3),cameraFar:new di(1e3),aspect:new di(1),time:new di(0)},blending:Co,depthWrite:!1,depthTest:!1,dithering:s}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.adoptCameraSettings(r)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Ip){this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader=cLe.replace(Lu.FRAGMENT_HEAD,e.get(Lu.FRAGMENT_HEAD)).replace(Lu.FRAGMENT_MAIN_UV,e.get(Lu.FRAGMENT_MAIN_UV)).replace(Lu.FRAGMENT_MAIN_IMAGE,e.get(Lu.FRAGMENT_MAIN_IMAGE)),this.vertexShader=uLe.replace(Lu.VERTEX_HEAD,e.get(Lu.VERTEX_HEAD)).replace(Lu.VERTEX_MAIN_SUPPORT,e.get(Lu.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Ga?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return Lu}},hLe=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,dLe=class extends Qn{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:wx.replace(/\D+/g,"")},uniforms:{inputBuffer:new di(null),threshold:new di(0),smoothing:new di(1),range:new di(null)},blending:Co,depthWrite:!1,depthTest:!1,fragmentShader:hLe,vertexShader:eE}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},pLe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,Ate={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},fLe=class extends Qn{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new di(e),inputBuffer:new di(null),strength:new di(1)},blending:Co,depthWrite:!1,depthTest:!1,fragmentShader:pLe,vertexShader:eE}),this.toneMapped=!1,this.setColorChannel(Tte.RED),this.setMaskFunction(Ate.DISCARD)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==$a&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return this.defines.INVERTED!==void 0}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},mLe=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,gLe="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",yLe=class extends Qn{constructor(e=new lt,t=new lt){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new di(null),searchTexture:new di(null),areaTexture:new di(null),resolution:new di(t),texelSize:new di(e)},blending:Co,depthWrite:!1,depthTest:!1,fragmentShader:mLe,vertexShader:gLe}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}},vLe=new Hy,qf=null;function _Le(){if(qf===null){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);qf=new fr,qf.setAttribute!==void 0?(qf.setAttribute("position",new Fr(e,3)),qf.setAttribute("uv",new Fr(t,2))):(qf.addAttribute("position",new Fr(e,3)),qf.addAttribute("uv",new Fr(t,2)))}return qf}var Sl=class{constructor(e="Pass",t=new Qh,i=vLe){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();t!==null&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new $s(_Le(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Qh),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=Ip){}render(e,t,i,r,s){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof Qh||t===this.renderer)continue;this[e].dispose()}}}},GB=class extends Sl{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new nLe,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new Zn(1,1,{minFilter:cn,magFilter:cn,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,r,s){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==$a?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===sn&&(this.renderTarget.texture.encoding=sn))}},xLe=class extends Sl{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,r,s){let n=e.state.buffers.stencil;n.setLocked(!1),n.setTest(!1)}},Dk=new Tr,EU=class extends Sl{constructor(e=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,r,s){let n=this.overrideClearColor,c=this.overrideClearAlpha,u=e.getClearAlpha(),p=n!==null,f=c>=0;p?(Dk.copy(e.getClearColor(Dk)),e.setClearColor(n,f?c:u)):f&&e.setClearAlpha(c),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),p?e.setClearColor(Dk,u):f&&e.setClearAlpha(u)}},Yf=-1,Ul=class extends za{constructor(e,t=Yf,i=Yf,r=1){super(),this.resizable=e,this.base=new lt(1,1),this.preferred=new lt(t,i),this.target=this.preferred,this.s=r}get width(){let{base:e,preferred:t,scale:i}=this,r;return t.width!==Yf?r=t.width:t.height!==Yf?r=Math.round(t.height*(e.width/Math.max(e.height,1))):r=Math.round(e.width*i),r}set width(e){this.preferredWidth=e}get height(){let{base:e,preferred:t,scale:i}=this,r;return t.height!==Yf?r=t.height:t.width!==Yf?r=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):r=Math.round(e.height*i),r}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(Yf),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return Yf}},Ik=!1,fZ=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let i;if(t.material.flatShading)switch(t.material.side){case Wa:i=this.materialsFlatShadedDoubleSide;break;case fa:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(t.material.side){case Wa:i=this.materialsDoubleSide;break;case fa:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=i[2]:t.isInstancedMesh?t.material=i[1]:t.material=i[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let i of t)i.uniforms=Object.assign({},e.uniforms),i.side=Yu;t[2].skinning=!0,this.materialsBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=fa,r}),this.materialsDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=Wa,r}),this.materialsFlatShaded=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=fa,r}),this.materialsFlatShadedDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=Wa,r})}}render(e,t,i){let r=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,Ik){let s=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(let n of s)n[0].material=n[1];this.meshCount!==s.size&&s.clear()}else{let s=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=s}e.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Ik}static set workaroundEnabled(e){Ik=e}},bLe=class extends Sl{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new EU,this.overrideMaterialManager=i===null?null:new fZ(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new fZ(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,r,s){let n=this.scene,c=this.camera,u=this.selection,p=c.layers.mask,f=n.background,x=e.shadowMap.autoUpdate,w=this.renderToScreen?null:t;u!==null&&c.layers.set(u.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(n.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(w),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,n,c):e.render(n,c),c.layers.mask=p,n.background=f,e.shadowMap.autoUpdate=x}},mZ=class extends Sl{constructor(e,t,{resolutionScale:i=1,width:r=Ul.AUTO_SIZE,height:s=Ul.AUTO_SIZE,renderTarget:n}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new bLe(e,t,new uK({depthPacking:ZQ}));let c=this.renderPass;c.skipShadowMapUpdate=!0,c.ignoreBackground=!0;let u=c.getClearPass();u.overrideClearColor=new Tr(16777215),u.overrideClearAlpha=1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new Zn(1,1,{minFilter:ns,magFilter:ns,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let p=this.resolution=new Ul(this,r,s,i);p.addEventListener("change",f=>this.setSize(p.baseWidth,p.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,s){let n=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,n)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}},zYe=new Float32Array([255/256/256**3,255/256/256**2,255/256/256,255/256]),Bn={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},wLe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",SLe="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",ELe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",MLe="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",TLe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",ALe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",CLe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",DLe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",ILe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",PLe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",RLe="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",OLe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",LLe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",zLe="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",FLe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",kLe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",NLe="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",BLe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",ULe=new Map([[Bn.SKIP,null],[Bn.ADD,wLe],[Bn.ALPHA,SLe],[Bn.AVERAGE,ELe],[Bn.COLOR_BURN,MLe],[Bn.COLOR_DODGE,TLe],[Bn.DARKEN,ALe],[Bn.DIFFERENCE,CLe],[Bn.EXCLUSION,DLe],[Bn.LIGHTEN,ILe],[Bn.MULTIPLY,PLe],[Bn.DIVIDE,RLe],[Bn.NEGATION,OLe],[Bn.NORMAL,LLe],[Bn.OVERLAY,zLe],[Bn.REFLECT,FLe],[Bn.SCREEN,kLe],[Bn.SOFT_LIGHT,NLe],[Bn.SUBTRACT,BLe]]),jLe=class extends za{constructor(e,t=1){super(),this.f=e,this.opacity=new di(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return ULe.get(this.blendFunction)}},Kh={NONE:0,DEPTH:1,CONVOLUTION:2},od=class extends za{constructor(e,t,{attributes:i=Kh.NONE,blendFunction:r=Bn.SCREEN,defines:s=new Map,uniforms:n=new Map,extensions:c=null,vertexShader:u=null}={}){super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=u,this.defines=s,this.uniforms=n,this.extensions=c,this.blendMode=new jLe(r),this.blendMode.addEventListener("change",p=>this.setChanged())}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=Ip){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof Qh||t===this.renderer)continue;this[e].dispose()}}}};function gZ(e,t,i){for(let r of t){let s="$1"+e+r.charAt(0).toUpperCase()+r.slice(1),n=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(let c of i.entries())c[1]!==null&&i.set(c[0],c[1].replace(n,s))}}function VLe(e,t,i,r,s,n,c){let u=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),p=u.get("fragment")!==void 0&&/mainImage/.test(u.get("fragment")),f=u.get("fragment")!==void 0&&/mainUv/.test(u.get("fragment")),x=[],w=[],E=!1,A=!1;if(u.get("fragment")===void 0)console.error("Missing fragment shader",t);else if(f&&c&Kh.CONVOLUTION)console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(!p&&!f)console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);else{let I=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,P=VB.Section;if(f){let k=`	${e}MainUv(UV);
`;i.set(P.FRAGMENT_MAIN_UV,i.get(P.FRAGMENT_MAIN_UV)+k),E=!0}if(u.get("vertex")!==null&&/mainSupport/.test(u.get("vertex"))){let k=`	${e}MainSupport(`;k+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(u.get("vertex"))?`vUv);
`:`);
`,i.set(P.VERTEX_MAIN_SUPPORT,i.get(P.VERTEX_MAIN_SUPPORT)+k),x=x.concat([...u.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(U=>U[1])),w=w.concat(x).concat([...u.get("vertex").matchAll(I)].map(U=>U[1]))}w=w.concat([...u.get("fragment").matchAll(I)].map(k=>k[1])),w=w.concat([...t.defines.keys()].map(k=>k.replace(/\([\w\s,]*\)/g,""))),w=w.concat([...t.uniforms.keys()]),t.uniforms.forEach((k,U)=>n.set(e+U.charAt(0).toUpperCase()+U.slice(1),k)),t.defines.forEach((k,U)=>s.set(e+U.charAt(0).toUpperCase()+U.slice(1),k)),gZ(e,w,s),gZ(e,w,u);let O=t.blendMode;if(r.set(O.blendFunction,O),p){let k=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,U=`${e}MainImage(color0, UV, `;c&Kh.DEPTH&&k.test(u.get("fragment"))&&(U+="depth, ",A=!0),U+=`color1);
	`;let j=e+"BlendOpacity";n.set(j,O.opacity),U+=`color0 = blend${O.blendFunction}(color0, color1, ${j});

	`,i.set(P.FRAGMENT_MAIN_IMAGE,i.get(P.FRAGMENT_MAIN_IMAGE)+U),U=`uniform float ${j};

`,i.set(P.FRAGMENT_HEAD,i.get(P.FRAGMENT_HEAD)+U)}i.set(P.FRAGMENT_HEAD,i.get(P.FRAGMENT_HEAD)+u.get("fragment")+`
`),u.get("vertex")!==null&&i.set(P.VERTEX_HEAD,i.get(P.VERTEX_HEAD)+u.get("vertex")+`
`)}return{varyings:x,transformedUv:E,readDepth:A}}var lI=class extends Sl{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new VB(null,null,null,e),this.effects=t.sort((i,r)=>r.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=VB.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),i=new Map,r=new Map,s=new Map,n=new Set,c=0,u=0,p=0,f=!1,x=!1;for(let E of this.effects)if(E.blendMode.blendFunction===Bn.SKIP)p|=E.getAttributes()&Kh.DEPTH;else if(p&E.getAttributes()&Kh.CONVOLUTION)console.error("Convolution effects cannot be merged",E);else{p|=E.getAttributes();let A="e"+c++,I=VLe(A,E,t,i,r,s,p);if(u+=I.varyings.length,f=f||I.transformedUv,x=x||I.readDepth,E.extensions!==null)for(let P of E.extensions)n.add(P)}let w=/\bblend\b/g;for(let E of i.values()){let A=E.getShaderCode().replace(w,`blend${E.blendFunction}`);t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+A+`
`)}p&Kh.DEPTH?(x&&t.set(e.FRAGMENT_MAIN_IMAGE,`float depth = readDepth(UV);

	`+t.get(e.FRAGMENT_MAIN_IMAGE)),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,f?(t.set(e.FRAGMENT_MAIN_UV,`vec2 transformedUv = vUv;
`+t.get(e.FRAGMENT_MAIN_UV)),r.set("UV","transformedUv")):r.set("UV","vUv"),t.forEach((E,A,I)=>I.set(A,E.trim().replace(/^#/,`
#`))),this.uniformCount=s.size,this.varyingCount=u,this.skipRendering=c===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(n).setUniforms(s).setDefines(r)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=Ip){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,r,s){for(let n of this.effects)n.update(e,t,r);if(!this.skipRendering||this.renderToScreen){let n=this.fullscreenMaterial;n.inputBuffer=t.texture,n.time+=r,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(let r of this.effects)r.initialize(e,t,i),r.addEventListener("change",s=>this.handleEvent(s));this.updateMaterial(),this.verifyResources(),i!==void 0&&i!==$a&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},GLe=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],MU=class extends Sl{constructor({resolutionScale:e=.5,width:t=Ul.AUTO_SIZE,height:i=Ul.AUTO_SIZE,kernelSize:r=NI.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Zn(1,1,{minFilter:cn,magFilter:cn,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let s=this.resolution=new Ul(this,t,i,e);s.addEventListener("change",n=>this.setSize(s.baseWidth,s.baseHeight)),this.blurMaterial=new pZ,this.ditheredBlurMaterial=new pZ,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=r}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,s){let n=this.scene,c=this.camera,u=this.renderTargetA,p=this.renderTargetB,f=GLe[this.kernelSize],x=this.blurMaterial,w=t,E,A;for(this.fullscreenMaterial=x,E=0,A=f.length-1;E<A;++E){let I=E&1?p:u;x.kernel=f[E],x.inputBuffer=w.texture,e.setRenderTarget(I),e.render(n,c),w=I}this.dithering&&(x=this.ditheredBlurMaterial,this.fullscreenMaterial=x),x.kernel=f[E],x.inputBuffer=w.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(n,c)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,s=i.height;this.renderTargetA.setSize(r,s),this.renderTargetB.setSize(r,s),this.blurMaterial.setSize(r,s),this.ditheredBlurMaterial.setSize(r,s)}initialize(e,t,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==$a?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===sn&&(this.renderTargetA.texture.encoding=sn,this.renderTargetB.texture.encoding=sn))}static get AUTO_SIZE(){return Ul.AUTO_SIZE}},HLe=class extends Sl{constructor({width:e=Ul.AUTO_SIZE,height:t=Ul.AUTO_SIZE,renderTarget:i,luminanceRange:r,colorOutput:s}={}){super("LuminancePass"),this.fullscreenMaterial=new dLe(s,r),this.needsSwap=!1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new Zn(1,1,{minFilter:cn,magFilter:cn,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let n=this.resolution=new Ul(this,e,t);n.addEventListener("change",c=>this.setSize(n.baseWidth,n.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,r,s){let n=this.fullscreenMaterial;n.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){i!==void 0&&i!==$a&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},WLe=class extends Sl{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new EU(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,r,s){let n=e.getContext(),c=e.state.buffers,u=this.scene,p=this.camera,f=this.clearPass,x=this.inverted?0:1,w=1-x;c.color.setMask(!1),c.depth.setMask(!1),c.color.setLocked(!0),c.depth.setLocked(!0),c.stencil.setTest(!0),c.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),c.stencil.setFunc(n.ALWAYS,x,4294967295),c.stencil.setClear(w),c.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?f.render(e,null):(f.render(e,t),f.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(u,p)):(e.setRenderTarget(t),e.render(u,p),e.setRenderTarget(i),e.render(u,p)),c.color.setLocked(!1),c.depth.setLocked(!1),c.stencil.setLocked(!1),c.stencil.setFunc(n.EQUAL,1,4294967295),c.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),c.stencil.setLocked(!0)}},Bu=class extends Sl{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let t=this.fullscreenMaterial.uniforms;t!==void 0&&t[e]!==void 0&&(this.inputBufferUniform=t[e])}}render(e,t,i,r,s){this.inputBufferUniform!==null&&t!==null&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){i!==void 0&&i!==$a&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Pk=1/1e3,qLe=1e3,YLe=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*Pk}getFixedDelta(){return this.fixedDelta*Pk}setFixedDelta(e){return this.fixedDelta=e*qLe,this}getElapsed(){return this.elapsed*Pk}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=e!==void 0?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},NI={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},XLe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,$Le=class extends od{constructor({blendFunction:e=Bn.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,resolutionScale:r=.5,intensity:s=1,width:n=Ul.AUTO_SIZE,height:c=Ul.AUTO_SIZE,kernelSize:u=NI.LARGE}={}){super("BloomEffect",XLe,{blendFunction:e,uniforms:new Map([["map",new di(null)],["intensity",new di(s)]])}),this.renderTarget=new Zn(1,1,{minFilter:cn,magFilter:cn,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new HLe({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new MU({resolutionScale:r,width:n,height:c,kernelSize:u});let p=this.blurPass.getResolution();p.addEventListener("change",f=>this.setSize(p.baseWidth,p.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){let r=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,r),this.blurPass.render(e,r,r)):this.blurPass.render(e,t,r)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e.outputEncoding===sn&&(this.renderTarget.texture.encoding=sn))}},ZLe="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",QLe=class extends od{constructor({blendFunction:e=Bn.NORMAL,brightness:t=0,contrast:i=0}={}){super("BrightnessContrastEffect",ZLe,{blendFunction:e,uniforms:new Map([["brightness",new di(t)],["contrast",new di(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},KLe="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",JLe=class extends od{constructor(e=Bn.NORMAL){super("ColorAverageEffect",KLe,{blendFunction:e})}},eze="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",tze="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",ize=class extends od{constructor({blendFunction:e=Bn.NORMAL,offset:t=new lt(.001,5e-4)}={}){super("ChromaticAberrationEffect",eze,{vertexShader:tze,blendFunction:e,attributes:Kh.CONVOLUTION,uniforms:new Map([["offset",new di(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},rze=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,nze=class extends od{constructor(e,{blendFunction:t=Bn.NORMAL,worldFocusDistance:i,worldFocusRange:r,focusDistance:s=0,focalLength:n=.1,focusRange:c=n,bokehScale:u=1,width:p=Ul.AUTO_SIZE,height:f=Ul.AUTO_SIZE}={}){super("DepthOfFieldEffect",rze,{blendFunction:t,attributes:Kh.DEPTH,uniforms:new Map([["nearColorBuffer",new di(null)],["farColorBuffer",new di(null)],["nearCoCBuffer",new di(null)],["scale",new di(1)]])}),this.camera=e,this.renderTarget=new Zn(1,1,{minFilter:cn,magFilter:cn,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new Bu(new eLe(e));let x=this.cocMaterial;x.focusDistance=s,x.focusRange=c,i!==void 0&&(x.worldFocusDistance=i),r!==void 0&&(x.worldFocusRange=r),this.blurPass=new MU({kernelSize:NI.MEDIUM,width:p,height:f});let w=this.blurPass.getResolution();w.addEventListener("change",A=>this.setSize(w.getBaseWidth(),w.getBaseHeight())),this.maskPass=new Bu(new fLe(this.renderTargetCoC.texture));let E=this.maskPass.fullscreenMaterial;E.maskFunction=Ate.MULTIPLY,E.colorChannel=Tte.GREEN,this.bokehNearBasePass=new Bu(new N2(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new Bu(new N2(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new Bu(new N2(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new Bu(new N2(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=u}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of t)i.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera,i=t.position.distanceTo(e);return jB(-i,t.near,t.far)}setDepthTexture(e,t=Ip){this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,i){let r=this.renderTarget,s=this.renderTargetCoC,n=this.renderTargetCoCBlurred,c=this.renderTargetMasked;if(this.target!==null){let u=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=u}this.cocPass.render(e,null,s),this.blurPass.render(e,s,n),this.maskPass.render(e,t,c),this.bokehFarBasePass.render(e,c,r),this.bokehFarFillPass.render(e,r,this.renderTargetFar),this.bokehNearBasePass.render(e,t,r),this.bokehNearFillPass.render(e,r,this.renderTargetNear)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,s=i.height,n=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];n.push(this.renderTargetCoC,this.renderTargetMasked),n.forEach(c=>c.setSize(e,t)),n=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],n.forEach(c=>c.setSize(r,s)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(c=>c.fullscreenMaterial.setSize(r,s))}initialize(e,t,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(r=>r.initialize(e,t,i)),this.blurPass.initialize(e,t,$a),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputEncoding===sn&&(this.renderTarget.texture.encoding=sn,this.renderTargetNear.texture.encoding=sn,this.renderTargetFar.texture.encoding=sn,this.renderTargetMasked.texture.encoding=sn))}},FYe=new se,kYe=new mi,sze="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",oze=class extends od{constructor({blendFunction:e=Bn.NORMAL,hue:t=0,saturation:i=0}={}){super("HueSaturationEffect",sze,{blendFunction:e,uniforms:new Map([["hue",new di(new se)],["saturation",new di(i)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((e.x*3-1)/2)}set hue(e){let t=Math.sin(e),i=Math.cos(e);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}},NYe=new Tr,aze=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,lze=class extends od{constructor({blendFunction:e=Bn.SCREEN,premultiply:t=!1}={}){super("NoiseEffect",aze,{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}},cze="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",uze=class extends od{constructor(e=30){super("PixelationEffect",cze,{uniforms:new Map([["active",new di(!1)],["d",new di(new lt)]])}),this.resolution=new lt,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}},BYe=Math.PI*.5,UYe=new se,jYe=new se,yZ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",vZ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",hze="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",dze="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",_y={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},Cte=class extends od{constructor({preset:e=_y.MEDIUM,edgeDetectionMode:t=kI.COLOR,predicationMode:i=aLe.DISABLED}={}){super("SMAAEffect",hze,{vertexShader:dze,blendFunction:Bn.NORMAL,attributes:Kh.CONVOLUTION|Kh.DEPTH,uniforms:new Map([["weightMap",new di(null)]])});let r,s;arguments.length>1&&(r=arguments[0],s=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new Zn(1,1,{minFilter:cn,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new EU(!0,!1,!1),this.clearPass.overrideClearColor=new Tr(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new Bu(new lLe),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new Bu(new yLe);let n=new DK;n.onLoad=()=>{let c=new Zs(r);c.name="SMAA.Search",c.magFilter=ns,c.minFilter=ns,c.generateMipmaps=!1,c.needsUpdate=!0,c.flipY=!0,this.weightsMaterial.searchTexture=c;let u=new Zs(s);u.name="SMAA.Area",u.magFilter=cn,u.minFilter=cn,u.generateMipmaps=!1,u.needsUpdate=!0,u.flipY=!1,this.weightsMaterial.areaTexture=u,this.dispatchEvent({type:"load"})},n.itemStart("search"),n.itemStart("area"),r!==void 0&&s!==void 0?(n.itemEnd("search"),n.itemEnd("area")):typeof Image<"u"&&(r=new Image,s=new Image,r.addEventListener("load",()=>n.itemEnd("search")),s.addEventListener("load",()=>n.itemEnd("area")),r.src=yZ,s.src=vZ),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case _y.LOW:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case _y.MEDIUM:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case _y.HIGH:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case _y.ULTRA:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(e,t=Ip){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;e!==null&&t!==null&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return yZ}static get areaImageDataURL(){return vZ}},pze=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,B2={DEFAULT:0,ESKIL:1},fze=class extends od{constructor({blendFunction:e=Bn.NORMAL,technique:t=B2.DEFAULT,eskil:i=!1,offset:r=.5,darkness:s=.5}={}){super("VignetteEffect",pze,{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new di(r)],["darkness",new di(s)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===B2.ESKIL}set eskil(e){this.technique=e?B2.ESKIL:B2.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}},VYe=[new Float32Array(3),new Float32Array(3)],GYe=[new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3)],HYe=[[new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1])]],WYe=[new Float32Array(2),new Float32Array(2)],qYe=new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),YYe=[new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125])],XYe=[new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4])],$Ye=[new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3])],ZYe=new Map([[Va(0,0,0,0),new Float32Array([0,0,0,0])],[Va(0,0,0,1),new Float32Array([0,0,0,1])],[Va(0,0,1,0),new Float32Array([0,0,1,0])],[Va(0,0,1,1),new Float32Array([0,0,1,1])],[Va(0,1,0,0),new Float32Array([0,1,0,0])],[Va(0,1,0,1),new Float32Array([0,1,0,1])],[Va(0,1,1,0),new Float32Array([0,1,1,0])],[Va(0,1,1,1),new Float32Array([0,1,1,1])],[Va(1,0,0,0),new Float32Array([1,0,0,0])],[Va(1,0,0,1),new Float32Array([1,0,0,1])],[Va(1,0,1,0),new Float32Array([1,0,1,0])],[Va(1,0,1,1),new Float32Array([1,0,1,1])],[Va(1,1,0,0),new Float32Array([1,1,0,0])],[Va(1,1,0,1),new Float32Array([1,1,0,1])],[Va(1,1,1,0),new Float32Array([1,1,1,0])],[Va(1,1,1,1),new Float32Array([1,1,1,1])]]);function Rk(e,t,i){return e+(t-e)*i}function Va(e,t,i,r){let s=Rk(e,t,.75),n=Rk(i,r,1-.25);return Rk(s,n,1-.125)}var Pp=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=Bn.NORMAL}},mze=class extends Pp{constructor(){super($Le),this.blendFunction=Bn.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},gze=class extends Pp{constructor(){super(QLe)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},yze=class extends Pp{constructor(){super(ize),this.effect.offset=new lt(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},vze=class extends Pp{constructor(){super(JLe)}},_ze=class extends Pp{constructor(){super(oze),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},xze=class extends Pp{constructor(){super(lze),this.blendFunction=Bn.OVERLAY}},bze=class extends Pp{constructor(){super(fze)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},wze=class extends Pp{constructor(e){super(nze)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?e/2e3:(e+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}setCamera(e){let t=!1;(e.isPerspectiveCamera&&this.isPerspectiveCamera===!1||!e.isPerspectiveCamera&&this.isPerspectiveCamera===!0)&&(t=!0),e.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e),this.isPerspectiveCamera=!1),t&&this.effect.setChanged()}},Sze=class extends Pp{constructor(){super(uze)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},Eze=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,Mze=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,Tze=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,Aze=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,HB=class extends Qn{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new di(null)},blending:Co,depthWrite:!1,depthTest:!1,vertexShader:Tze,fragmentShader:Aze})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},Cze=class extends Sl{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new HB,this.resolutionVector=new lt,this.resolveMaterial=new Qn({name:"TAAResolveMaterial",uniforms:{inputBuffer:new di(null),historyBuffer:new di(null),velocityBuffer:new di(null),depthBuffer:new di(null),resolution:new di(new lt)},blending:Co,depthWrite:!1,depthTest:!1,vertexShader:Eze,fragmentShader:Mze}),this.historyRenderTarget=new Zn(1024,1024,{minFilter:cn,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Zn(1024,1024,{minFilter:cn,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let i=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(i),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},Dze=class extends Sl{constructor(e,t,i){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new mZ(e,t,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new HB,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new HB,this.depthPass=new mZ(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,i){let r=this.camera.layers.mask,s=e;s.setRenderTarget(s.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],s.clear(),s.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,i),s.shadowMap.needsUpdate=!1,s.shadowMap.autoUpdate=!1;let n=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(n),e.render(this.splineScene,this.camera),this.camera.layers.mask=r}},_Z=new Qh,Ize=new Qn({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),WB=class extends Sl{constructor(e,t,i){super("OpaquePass",t??_Z,i),this.MRTCompatible=!0,this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.originalMaterials=new Map,this.MRTCompatible=e}setCamera(e){this.camera=e}setScene(e){this.scene=e??_Z}getScene(){return this.scene}render(e,t){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.clear(),this.scene.traverse(r=>{r.layers.isEnabled(3)&&r instanceof wl&&(this.originalMaterials.set(r.id,r.material),r.material=Ize)}),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:t;e.setRenderTarget(i),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),e.render(this.scene,this.camera),this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach((r,s)=>{let n=this.scene.getObjectById(s);n&&(n.material=r)})}},Pze=class{constructor(e,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:s=0}={}){this.renderer=e,this.helperStartIndex=0,this.copyPass=new GB,this.depthTexture=null,this.timer=new YLe,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,i,s,r,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,i,s,r,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,i,s,r,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){let t=e.getSize(new lt),i=e.getContext().getContextAttributes()?.alpha??!1,r=this.inputBuffer.texture[0].type;r===$a&&e.outputEncoding===sn&&(this.inputBuffer.texture[0].encoding=sn,this.outputBuffer.texture[0].encoding=sn,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(t.width,t.height,!1);for(let s of this.passes)s.initialize(e,i,r)}}replaceRenderer(e,t=!0){let i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(e),t&&r!==null&&(r.removeChild(i.domElement),r.appendChild(e.domElement)),i}createDepthTexture(){let e=this.depthTexture=new cx(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.stencilBuffer?(e.format=By,e.type=Py):e.type=fp,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,r,s,n){let c=this.renderer,u=c===null?new lt:c.getDrawingBufferSize(new lt),p={minFilter:cn,magFilter:cn,wrapS:js,wrapT:js,stencilBuffer:t,depthBuffer:e},f;return r>0?(f=new Zn(u.width,u.height,p),f.samples=r):(s?(f=new Yge(u.width,u.height,2,p),f.texture[1].type=wp):f=new Zn(u.width,u.height,p),f.depthTexture=new cx(2048,2048),f.depthTexture.type=To),i===$a&&c!==null&&c.outputEncoding===sn&&(Array.isArray(f.texture)?f.texture.forEach(x=>x.encoding=sn):f.texture.encoding=sn),Array.isArray(f.texture)?f.texture.forEach((x,w)=>{x.name=`EffectComposer.Buffer ${s} ${w}`,x.generateMipmaps=!1}):(f.texture.name=`EffectComposer.Buffer ${s}`,f.texture.generateMipmaps=!1),f.name=n,f}addPass(e,t){let i=this.passes,r=this.renderer,s=r.getDrawingBufferSize(new lt),n=r.getContext().getContextAttributes()?.alpha??!1,c;if(e.MRTCompatible&&(c=this.inputBuffer.texture[0].type),e.MRTCompatible||(c=this.inputBuffer.texture.type),e.setRenderer(r),e.setSize(s.width,s.height),e.initialize(r,n,c),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let u=this.createDepthTexture();for(e of i)e.setDepthTexture(u)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,i=t.indexOf(e);if(i!==-1&&t.splice(i,1).length>0){if(this.depthTexture!==null){let r=(s,n)=>s||n.needsDepthTexture;t.reduce(r,!1)||e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null)}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let t=this.renderer,i=this.copyPass,r=this.inputBuffer,s=this.outputBuffer,n=this.inputBufferSingle,c=this.outputBufferSingle,u=!1,p,f,x,w;e===void 0&&(e=this.timer.update().getDelta());for(let E of this.passes)E.enabled&&(E.MRTCompatible?E.render(t,r,s,e,u):E.render(t,n,c,e,u),E.needsSwap&&(u&&(i.renderToScreen=E.renderToScreen,p=t.getContext(),f=t.state.buffers.stencil,f.setFunc(p.NOTEQUAL,1,4294967295),i.render(t,r,s,e,u),f.setFunc(p.EQUAL,1,4294967295)),x=r,w=n,r=s,n=c,s=x,c=w),E instanceof WLe?u=!0:E instanceof xLe&&(u=!1))}setSize(e,t,i){let r=this.renderer;if(this._width=e,this._height=t,e===void 0||t===void 0){let n=r.getSize(new lt);e=n.width,t=n.height}r.setSize(e,t,i);let s=r.getDrawingBufferSize(new lt);this.inputBuffer.setSize(s.width,s.height),this.outputBuffer.setSize(s.width,s.height),this.inputBufferSingle.setSize(s.width,s.height),this.outputBufferSingle.setSize(s.width,s.height);for(let n of this.passes)n.setSize(s.width,s.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},Rze=new Qn({name:"CombineMaterial",uniforms:{inputBufferA:new di(null),inputBufferB:new di(null)},blending:Co,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),Oze=class extends Sl{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=Rze,this.helperPass=new WB(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new WB(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new Cte({preset:_y.LOW,edgeDetectionMode:kI.COLOR});this.effectPass=new lI(this.camera,t),this.rt=new Zn(10,10,{minFilter:cn,magFilter:cn,wrapS:js,wrapT:js,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,i){this.rt.depthTexture=t.depthTexture;let r=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(r),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},Lze=`#define GLSLIFY 1
#include <skinning_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,zze=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,Fze=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,kze=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,Nze=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,Bze=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,jw=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],Uze=new Qn({vertexShader:Lze,fragmentShader:zze}),C_=new Qn({vertexShader:Nze,fragmentShader:Bze,uniforms:{texture_ao_lrez:new di(null),texture_depth_lrez:new di(null),texture_depth_hrez:new di(null),near:new di(null),far:new di(null)}}),jze=class extends Sl{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,r=1024;this.gBuffer=new Zn(i,r,{type:XS?wp:To,depthTexture:new cx(i,r),minFilter:cn,magFilter:cn}),this.depthBufferHighRes=new Zn(i,r,{depthTexture:new cx(i,r)}),this.aoBuffer=new Zn(i,r,{minFilter:cn,magFilter:cn}),this.splineScene=e,this.splineCamera=t;let s=new Float32Array(jw.length*2);for(let c=0;c<jw.length;c++){let u=c*2;s[u+0]=jw[c][0],s[u+1]=jw[c][1]}this.blueNoiseInDiskTexture=new $c(s,jw.length,1,fD,To),this.blueNoiseInDiskTexture.wrapS=pp,this.blueNoiseInDiskTexture.wrapT=pp,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new Qn({vertexShader:Fze,fragmentShader:kze,uniforms:{near:new di(null),far:new di(null),fov:new di(null),proj_info:new di(new Gr),is_ortho:new di(!1),resolution:new di(new lt),radius_of_influence:new di(8),radius_in_screen_space:new di(1),exponent:new di(1),ao_color:new di(new se),bias:new di(.5),texture_depth:new di(null),texture_normals:new di(null),texture_blue_noise:new di(null),texture_blue_noise_in_disk:new di(this.blueNoiseInDiskTexture),frame_index:new di(0),fog_enabled:new di(!1),fog_near:new di(1),fog_far:new di(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Zn(i,r,{minFilter:cn,magFilter:cn,wrapS:js,wrapT:js,depthBuffer:!1,type:To});let n=new Cte({preset:_y.ULTRA,edgeDetectionMode:kI.COLOR});this.effectPass=new lI(this.camera,n)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let i=this._runHalfRes?.5:1,r=e*i,s=t*i;this.gBuffer.setSize(r,s),this.aoBuffer.setSize(r,s),this.hbaoMaterial.uniforms.resolution.value.set(r,s),this.aaBuffer.setSize(r,s),this.effectPass.setSize(r,s)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}setDepthTexture(e){this.depthBufferHighRes.depthTexture=e,C_.uniforms.texture_depth_hrez.value=e,C_.needsUpdate=!0}render(e,t,i){this.splineScene.overrideMaterial=Uze;let r=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=r,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let s=this.splineCamera.perspCamera.projectionMatrix.elements,n=2/s[0],c=2/s[5],u=-(1-s[8])/s[0],p=-(1+s[9])/s[5];this.hbaoMaterial.uniforms.proj_info.value.set(n,c,u,p);let f=this.splineCamera.perspCamera.fov*(Math.PI/180),x=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(f*.5)*2),w=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*x;this.hbaoMaterial.uniforms.radius_in_screen_space.value=w,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let s=this.splineCamera.orthoCamera.projectionMatrix.elements,n=2/s[0],c=2/s[5],u=-(1+s[12])/s[0],p=-(1-s[13])/s[5];this.hbaoMaterial.uniforms.proj_info.value.set(n,c,u,p);let f=.5*(this.hbaoMaterial.uniforms.resolution.value.y/c),x=this.hbaoMaterial.uniforms.radius_of_influence.value*f;this.hbaoMaterial.uniforms.radius_in_screen_space.value=x,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=C_,C_.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,C_.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,C_.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},Vze=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Gze=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,Hze=class extends Bu{constructor(){super(new Qn({vertexShader:Vze,fragmentShader:Gze,uniforms:{tInput:new di(null),tMap:new di(null),uResolution:new di(new lt),uSize:new di(new lt),uCoords:new di(new lt),uScale:new di(1),uSceneColor:new di(new Tr(16711680)),uDPR:new di(1),uCurrent:new di(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},Wze=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,qze=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,Yze=[],Xze=class extends Bu{constructor(){super(new Qn({vertexShader:Wze,fragmentShader:qze,uniforms:{toScene:new di(null),fromScene:new di(null),uResolution:new di(new lt),uDPR:new di(1),mixRatio:new di(0),threshold:new di(.1),useTexture:new di(0),tMixTexture:{value:Yze[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}},$ze=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Zze=`
uniform sampler2D inputBuffer;
uniform sampler2D blurredInputBuffer;
uniform sampler2D overlay;
uniform float blurIntensity;

uniform vec2 uResolution;
uniform float uDPR;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( overlay, screenUv );
	vec4 texel2 = texture2D( inputBuffer, screenUv );
	vec4 texel3 = texture2D( blurredInputBuffer, screenUv );

	float blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;
    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );
}
`,Qze=class extends Bu{constructor(){super(new Qn({vertexShader:$ze,fragmentShader:Zze,uniforms:{inputBuffer:new di(null),blurredInputBuffer:new di(null),overlay:new di(null),uResolution:new di(new lt),uDPR:new di(1),blurIntensity:new di(0)}})),this._blurEnabled=!1,this.blurTarget=new Zn(1,1,{minFilter:cn,magFilter:cn,wrapS:js,wrapT:js}),this.blurPass=new MU({width:window.innerWidth,height:window.innerHeight,kernelSize:NI.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(e){this.uniforms.overlay.value=e}setResolution(e,t,i=1){this.uniforms.uResolution.value.set(e,t),this.uniforms.uDPR.value=i,this.blurPass.setSize(e,t),this.blurTarget.setSize(e,t),this.blurPass.setSize(e,t)}get uiCanvas(){return this._uiCanvas}set uiCanvas(e){this._uiCanvas=e,e.texture&&(this.uniforms.overlay.value=e.texture);let t=e.frame;if(t){let i=t.data.backgroundBlur,r=i.radius;this._blurEnabled=i.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=r/3}}render(e,t,i,r,s){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(e,t,this.blurTarget,r,s)),super.render(e,t,i,r,s)}};function xZ(e,t){return t&&t.enabled&&e.push(t.effect),e}var Kze=e=>Object.values(Bn).includes(e)?e:Bn.NORMAL,Jze=class extends za{constructor(e,t){super(),this._needsDOFResize=t,this.postprocessingState=YD.defaultData,this._scene=new Qh,this._camera=new Xa,this.effects=new Map,this.blueNoiseTexture=new $c,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new B1e,this.renderer=e,this.debug=!1,this.effects.set("bloom",new mze),this.effects.set("chromaticAberration",new yze),this.effects.set("vignette",new bze),this.effects.set("noise",new xze),this.effects.set("colorAverage",new vze),this.effects.set("hueSaturation",new _ze),this.effects.set("brightnessContrast",new gze),this.effects.set("depthOfField",new wze),this.effects.set("pixelation",new Sze),this.effectComposer=new Pze(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new WB(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new Dze(this.scene,this.camera,this.renderer),this.aoPass=new jze(this.scene,this.camera),this.taaPass=new Cze,this.taaPass.renderToScreen=!1,this.helperPass=new Oze(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new Hze,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new Qze,this.uiOverlayPass.enabled=!1,this.sceneTransitionPass=new Xze,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){e!==void 0?(this.stylesOverlayPass.texture=e,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){let t=this._camera!==e;this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),t&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(e),this.helperPass.setCamera(e),this.effects.get("depthOfField").setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let i=this.effectComposer.passes[t];if(i.enabled===!0&&!e&&this._renderToScreen){i.renderToScreen=!0,e=!0;continue}i.renderToScreen=!1}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new $c(e,128,128),this.blueNoiseTexture.wrapS=pp,this.blueNoiseTexture.wrapT=pp,this.blueNoiseTexture.minFilter=ns,this.blueNoiseTexture.magFilter=ns,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,i,r,s,n,c,u){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=i,this.aoPass.aoColor=r,this.aoPass.fogEnabled=s,this.aoPass.fogNear=n,this.aoPass.fogFar=c,this.aoPass.runHalfRes!==!u&&(this.aoPass.runHalfRes=!u)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){if(this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let e=[this.effects.get("pixelation")].reduce(xZ,[]);e.length>0&&(this.uvEffectPass=new lI(this.camera,...e),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let t=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(xZ,[]);if(t.length>0&&(this.effectPass=new lI(this.camera,...t),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this._needsDOFResize&&this.effects.get("depthOfField")?.enabled&&window!==void 0)){let i=this.renderer.viewportWidth,r=this.renderer.viewportHeight;this.renderer.setSize(i-1,r-1),this.renderer.setSize(i,r)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass)}_initCopyPass(){if(this._savePass)return;let e=new lt;this.renderer.getDrawingBufferSize(e),this._rt=new Zn(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:pp,wrapT:pp}),this._rt.samples=0,this._savePass=new GB(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new GB(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(e===!0?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(e!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let s=e,{enabled:t}=s,i=ll(s,["enabled"]),r=!1;t!==this.postprocessingState.enabled&&(r=!0);for(let n of Object.entries(i)){let c=n[1],u=this.effects.get(n[0]);if(u){u.enabled!==c.enabled&&(r=!0),u.enabled=c.enabled;for(let[p,f]of Object.entries(c))p==="blendFunction"?u.blendFunction=Kze(f):u[p]=f}}this.postprocessingState=e,r&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,i,r){e instanceof Gr?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,i,r),this.effectComposer.outputBuffer.scissor.set(e,t,i,r));let s=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(s),this.effectComposer.outputBuffer.scissor.multiplyScalar(s),this.renderer.setScissor(e,t,i,r)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,i,r){e instanceof Gr?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,i,r),this.effectComposer.outputBuffer.viewport.set(e,t,i,r))}resize(e,t,i){if(this.effectComposer.setSize(e,t,i),this._rt){let r=this.renderer.getPixelRatio();this._rt.setSize(e*r,t*r)}}dispose(){this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.dispose()}},eFe=e=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${e};
const int gShadowSamples = ${e};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,tFe=ln.lights_fragment_begin,iFe=ln.shadowmask_pars_fragment,bZ=null,rFe=e=>{switch(e){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},nFe=(e="medium")=>{if(bZ===e)return!1;bZ=e;let t=rFe(e);ln.shadowmap_pars_fragment=eFe(t);let i=tFe.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),ln.lights_fragment_begin=i;let r=iFe.slice();return r=r.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),ln.shadowmask_pars_fragment=r,!0},sFe=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;
#include <skinning_pars_vertex>

void main()
{
#include <beginnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
vec3 transformed = vec3(position);
#include <skinning_vertex>

vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
}
`,oFe=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,Ok=new Qn({vertexShader:sFe,fragmentShader:oFe,uniforms:{depthContrast:{value:1}}}),wZ=new Zs,aFe=new lt,lFe=class extends hK{constructor(e){super(e),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new lt,this.dummyCamera=new Xa,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(s=!0,n=!0,c=!0)=>{let u=this.getContext(),p=0;s&&(p|=u.COLOR_BUFFER_BIT),n&&(p|=u.DEPTH_BUFFER_BIT),c&&(p|=u.STENCIL_BUFFER_BIT),u.clear(p),u.clearBufferfv(u.COLOR,1,[0,0,0,1])},this.pipeline=new Jze(this,e?.needsDOFResize??!1),this.autoClear=!1;let t=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=u4,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(s){console.warn(s)}this.setPixelRatio=s=>{this._pixelRatio!==s&&(this._pixelRatio=s,t(s))},this.setSize=(s,n,c=!0)=>{(this.viewportWidth!==s||this.viewportHeight!==n)&&(this.viewportWidth=s,this.viewportHeight=n,i(s,n,c),this.normalRenderTarget?.setSize(s*this._pixelRatio,n*this._pixelRatio),this._resizeTransmission(s,n),this.transmissionDepthTarget?.setSize(s*this._pixelRatio/2,n*this._pixelRatio/2),this.pipeline.resize(s,n,c))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new Zn(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:cn,magFilter:cn,wrapS:js,wrapT:js,depthBuffer:!1}))}_resizeTransmission(e,t){this.transmissionRenderTarget?.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),this.aoRenderTarget?.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return Dr.transmissionLod.value===1}set hdTransmission(e){Dr.transmissionLod.value=e===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new Zn(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:ax,magFilter:cn,wrapS:js,wrapT:js,depthBuffer:!1}),this.transmissionDepthTarget=new Zn(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:ns,magFilter:ns,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new Zn(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:ns,magFilter:ns,type:To,depthTexture:new cx(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),i instanceof Xa?Ok.uniforms.depthContrast.value=(i.far-i.near)/1e4:Ok.uniforms.depthContrast.value=1,t.overrideMaterial=Ok,this.render(t,i),this.setClearColor(t.bgColor,t.bgColor.a),this.setRenderTarget(null),t.overrideMaterial=e.wireframeState?KB:null,i.layers.enable(0),i.layers.enable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(e,t,i=1){this.dummyCamera.updateCameraState(t.dataPatched),this.dummyCamera.matrix.copy(t.matrixWorld);let r=t.height,s=t.width,n=this.viewportWidth/this.viewportHeight;s<r?s=r*n:r=s/n,this.dummyCamera.setViewplaneSize(s,r);for(let c=0;c<i;c++)this.renderSplineScene(e,this.dummyCamera)}renderSplineScene(e,t,{sceneHelpers:i=this.sceneHelpers,sceneHelpersOnTop:r=this.sceneHelpersOnTop,overrideTransmission:s=void 0,overrideNormal:n=void 0}={}){let c=e instanceof OU?e.activePage:e,u=c.visible;c.visible=!0;let p=c.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(c.bgColor,c.bgColor.a),c.penumbraSizeArray.forEach((E,A)=>{Dr.penumbraSize.value[A]=E}),Dr.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?Dr.resolution.value.set(this.resolution.x,this.resolution.y):Dr.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),n!==void 0?(Dr.normalRenderTarget.value=n,Dr.normalRenderTargetDepth.value=wZ):p.needsNormal()&&(this.createNormalRenderTarget(),Dr.normalRenderTarget.value=this.normalRenderTarget.texture,Dr.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(p,c,t));let f=c.data.ao,x=f.occlusion;if(x&&(this.createAORenderTarget(),Dr.aoRenderTarget.value=this.aoRenderTarget.texture),Dr.aoEnabled.value=x,this.pipeline.setAmbientOcclusionParams(f.occlusion,f.radius,f.bias,c.aoColor,c.fog!==null,c.backupFog.near,c.backupFog.far,f.aoFullRes&&!XS),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&c.uiCanvas?.enabled&&c.uiCanvas.texture&&c.uiCanvas.texture.image.width>0){let E=this.getSize(aFe),A=this.getPixelRatio();(c.uiCanvas.width!==this.viewportWidth||c.uiCanvas.height!==this.viewportHeight||c.uiCanvas.dpr!==A)&&c.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},A),c.uiCanvas.render(this),this.pipeline.uiOverlayPass.uiCanvas=c.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(E.x,E.y,A),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();let w=!1;if(s!==void 0)Dr.transmissionRenderTarget.value=s,Dr.transmissionRenderTargetDepth.value=wZ,this.pipeline.setTransmissionPassEnabled(!1);else{let E=p.needsTransmission();E&&(this.transmissionRenderTarget===void 0&&(w=!0),this.createTransmissionRenderTarget(),Dr.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,Dr.aspectRatio.value=tOe(this.viewportWidth,this.viewportHeight),Dr.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(E)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=r,this.pipeline.scene=c,this.pipeline.camera=t,w&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==c.postprocessing&&(this.pipeline.updatePostprocessing(c.postprocessing),!i&&!r&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),c.overrideMaterial=p.wireframeState?KB:null,this.pipeline.render(),Dr.frameIndex.value=(Dr.frameIndex.value+1)%16,t instanceof Xa&&t.copyHistory(),c.visible=u}renderFromSceneForSceneTransitionPass(e,t,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(e,t),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let r=this.pipeline.sceneTransitionPass.uniforms;r.uDPR.value=window.devicePixelRatio,r.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){this._superDispose(),this.pipeline.dispose(),this.aoRenderTarget?.dispose(),this.transmissionRenderTarget?.dispose(),this.transmissionDepthTarget?.dispose(),this.normalRenderTarget?.dispose(),this.normalRenderTarget?.depthTexture?.dispose()}},Dte=class extends QS(tbe){constructor(e,t=15,i=10066329){super(e,t,i),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){KS(this.object,Dte.geometryHelper,e,t)}},Ite=class extends QS(ebe){constructor(e,t=15,i=6710886){super(e,t,i),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){KS(this.object,Ite.geometryHelper,e,t)}},qB=class extends QS(J1e){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){KS(this.object,qB.geometryHelper,e,t)}update(){if(this.object!==void 0){let e=qB._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let r=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let s=0,n=this.cone.material.length;s<n;s++)this.cone.material[s].color.set(r);else this.cone.material.color.set(r)}}},Pte=qB;Pte._vector=new se;var Rte=class extends gp{constructor(){super(),this.caretIndex=0,this._caretVisibleAlpha=1,this._selectionVisibleAlpha=.3,this.current={start:0,end:void 0},this.matrixAutoUpdate=!1,this.caretMesh=new $s(new Ep(1,1),new Sp({transparent:!0,opacity:0,side:Wa})),this.add(this.caretMesh),this.selectionMesh=new $s(new Ep(1,1),new Sp({color:2857471,transparent:!0,depthTest:!1,depthWrite:!1,opacity:0,side:Wa})),this.add(this.selectionMesh),this.hide()}get caretHeight(){return this.object?.AD??0}show(e){this.visible=!0,this.object=e,this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.y=-this.caretHeight*.5,this.setCaretPosition(this.caretIndex),this.update()}hide(){this.visible=!1}update(){if(this.object===void 0)return;this.updateHelperMatrix();let{depth:e}=this.object.geometry.userData.parameters;this.caretMesh.position.z=e,this.selectionMesh.position.z=e}updateHelperMatrix(){if(this.object===void 0)return;let e=this.object,t=e.parent;t!==null&&t.updateWorldMatrix(!0,!1),e.matrixAutoUpdate&&e.updateMatrix(),t!==null?(this.matrixWorld.multiplyMatrices(t.matrixWorld,e.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,e.matrix)):this.matrixWorld.multiplyMatrices(e.hiddenMatrix,e.matrix),this.matrix.copy(this.matrixWorld);for(let i of this.children)i.matrixWorld.copy(this.matrixWorld);e.updateWorldMatrix(!0,!0)}setCaretColor(e){let t=this.caretMesh.material;t.color.setRGB(e.r,e.g,e.b);let i=this._caretVisibleAlpha===t.opacity;this._caretVisibleAlpha=e.a,i&&(t.opacity=this._caretVisibleAlpha)}setSelectionColor(e){this.selectionMesh.material.color.setRGB(e.r,e.g,e.b)}setCaretPosition(e,t={}){if(this.object===void 0)return;this.caretIndex=e;let i=this.object.wrappedText,[r,s]=cI(i,e),[n,c]=e>0?cI(i,e-1):[null,null];(e>0&&i.length?i[n].charAt(c):null)===`
`&&(r++,s=0),this.current.start=e,this.current.end=void 0;let[u,p]=Lk(this.object,r,s),{AD:f,descender:x}=this.object,w=x+f*.5,{width:E,height:A,depth:I}=this.object.geometry.userData.parameters,P=typeof E=="string"?0:E,O=typeof A=="string"?0:A;this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.set(u-P*.5,p+w+O*.5,I),this.hideSelectionMesh(),this.showCaretMesh()}setSelection(e,t){if(this.object===void 0)return;let i=this.object.wrappedText;this.current.start=e,this.current.end=t;let r=[],s=[],n=cFe(i,e,t),{lineHeight:c,AD:u,descender:p}=this.object,f=p+u*.5-c*.5;for(let[O,k,U]of n)if(k!==U){let[j,V]=Lk(this.object,O,k),[$,Y]=Lk(this.object,O,U);V+=f,Y+=f,Y+=c;let J=r.length/3;r.push(j,V,0),r.push($,V,0),r.push($,Y,0),r.push(j,Y,0),s.push(J+0,J+1,J+2),s.push(J+2,J+3,J+0)}let x=new fr;x.setIndex(s),x.setAttribute("position",new Vi(r,3));let{width:w,height:E,depth:A}=this.object.geometry.userData.parameters,I=typeof w=="string"?0:w,P=typeof E=="string"?0:E;this.selectionMesh.geometry.dispose(),this.selectionMesh.geometry=x,this.selectionMesh.position.x=-I*.5,this.selectionMesh.position.y=P*.5,this.selectionMesh.position.z=A,this.showSelectionMesh(),this.hideCaretMesh()}getSelectionFromPosition(e,t,i="previous"){if(this.object===void 0||this.object.font===void 0)return;let r=this.object.wrappedText,s=r.length,n=this.object.lineHeight,c=s*n,{height:u,verticalAlign:p}=this.object.geometry.userData.parameters,f=typeof u=="string"?0:u,x=0;p===3?x=f-c:p===2&&(x=f*.5-c*.5);let w=Math.min(Math.floor(Math.max(Math.min(-t-x,c),0)/n),s-1),E=this.object.charCoords[w],A=this.object.charWidths[w],I=0,P=!1;if(i==="previous"){for(let O=0;O<E.length;O++)if(E[O][0]+A[O]*.5-e>0){I=O,P=!0;break}}else if(i==="closest"){let O=1/0;for(let k=0;k<E.length;k++){let U=E[k][0]+A[k]*.5,j=Math.abs(U-e);j<O&&(O=j,I=k,P=!0)}}else for(let O=0;O<E.length;O++){let k=E[O][0],U=E[O][0]+A[O];if(e>=k&&e<U){I=O,P=!0;break}}return P||(I=E.length),{index:this.getGlobalIndexFromLineAndCharIndexes(r,w,I),lineIndex:w,characterIndex:I}}getGlobalIndexFromLineAndCharIndexes(e,t,i){return e.slice(0,t).reduce((r,s)=>r+=s.length,0)+i}showSelectionMesh(){this.selectionMesh.material.opacity=this._selectionVisibleAlpha}hideSelectionMesh(){this.selectionMesh.material.opacity=0}showCaretMesh(){this.caretMesh.material.opacity=this._caretVisibleAlpha}hideCaretMesh(){this.caretMesh.material.opacity=0}};function Lk(e,t,i){let{charCoords:r,charWidths:s,initialOffsetY:n,lineHeight:c}=e;if(r[t]&&r[t].length===0||r.length===0){let x=0,{horizontalAlign:w}=e.data.geometry,E=e.wrappedText,{width:A}=e.geometry.userData.parameters;return E.length===1&&E[0].length===0&&(w===3?x=A*.5:w===2&&(x=A)),[x,n-c*t]}let u=r[t];if(u===void 0||u.length===0)return[0,0];let[p,f]=u[Math.min(i,u.length-1)];return i>=u.length&&(p+=s[t][i-1]),[p,f]}function cI(e,t){let i=0;for(let r=0;r<e.length;r++){let s=e[r],n=t-i;if(n<=s.length)return[r,n];i+=s.length}return[Math.max(0,e.length-1),e[e.length-1]?.length??0]}function cFe(e,t,i){let[r,s]=cI(e,t),[n,c]=cI(e,i),u=[];s>=e[r].length&&(r++,s=0);for(let p=r;p<=n;p++){let f=e[p],x=p===r?s:0,w=p===n?c:f.length;u.push([p,x,w])}return u}function uFe(e,t){let i=Da.fromHex(3223857),r=.8;for(let s of e.layers){if(s.data.type==="light"||s.data.type==="displace"||s.data.type==="fresnel"||s.data.type==="matcap"||s.data.type==="texture"||s.data.type==="toon"||s.data.type==="outline"||s.data.type==="transmission"||s.data.type==="noise")continue;let n=typeof s.data.alpha=="string"?Number(t.getVariable(s.data.alpha)):s.data.alpha;if(s.data.type==="color"&&n>.3){i=hFe(s.data.color,t),r=n;break}else if((s.data.type==="depth"||s.data.type==="gradient")&&n>.3){let c=dFe(s.data);i={r:c[0],g:c[1],b:c[2]},r=typeof s.data.alpha=="string"?1:s.data.alpha;break}}return pt(me({},i),{a:r})}function hFe(e,t){return typeof e=="string"?t.data.colors[e]:e}function dFe(e){return e.colors[0]}function pFe(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}var Ote=class extends SU(N1e,Dte){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.top=1250,r.bottom=-1250,r.right=1250,r.left=-1250,r.near=-1e4,r.far=2500;let s=new TD(this.shadow.camera);s.visible=!1,this.gizmos.shadowmap=s}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof TD&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=e.depth!==void 0&&e.depth!==this.shadow.camera.far||e.size!==void 0&&e.size/2!==this.shadow.camera.right;e.size!==void 0&&pFe(this,e.size),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),i&&this.update()}},SZ=new se,EZ=new se,MZ=new Vr,Lte=class extends SU(L1e,Pte){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=Yi.RAD2DEG*2*this.angle,r.aspect=1,r.near=100,r.far=2500;let s=new TD(this.shadow.camera);s.visible=!1,this.gizmos.shadowmap=s,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof TD&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),EZ.setFromMatrixPosition(this.matrixWorld),MZ.setFromRotationMatrix(this.matrixWorld),SZ.copy(this.up).applyQuaternion(MZ).negate().multiplyScalar(this.distance),this.target.position.copy(EZ).add(SZ),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.angle!==void 0&&(this.angle=e.angle),e.penumbra!==void 0&&(this.penumbra=e.penumbra),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function fFe(e){let t=(e[0][0]+e[1][1])/2,i=(e[0][0]-e[1][1])/2,r=(e[1][0]+e[0][1])/2,s=(e[1][0]-e[0][1])/2,n=Math.sqrt(t*t+s*s),c=Math.sqrt(i*i+r*r),u=n+c,p=n-c,f=Math.atan2(r,i),x=Math.atan2(s,t),w=(x-f)/2,E=(x+f)/2,A=[[Math.cos(E),Math.sin(E)],[-Math.sin(E),Math.cos(E)]],I=[[u,0],[0,p]],P=[[Math.cos(w),Math.sin(w)],[-Math.sin(w),Math.cos(w)]];return A[0][0]*=-1,A[0][1]*=-1,P[0][0]*=-1,P[1][0]*=-1,[A,I,P]}function aD(e,t){return[[e[0][0]*t[0][0]+e[0][1]*t[1][0],e[0][0]*t[0][1]+e[0][1]*t[1][1]],[e[1][0]*t[0][0]+e[1][1]*t[1][0],e[1][0]*t[0][1]+e[1][1]*t[1][1]]]}function TZ(e){return[[e[0][0],e[1][0]],[e[0][1],e[1][1]]]}function mFe(e){let[t,i,r]=fFe(e),s=aD(t,TZ(r)),n=aD(aD(r,i),TZ(r)),c=Math.atan2(s[1][0],s[0][0]),u=[n[0][0],n[1][1]],p=[n[0][1]/n[1][1],n[1][0]/n[0][0]];return{rotation:c,scale:u,shear:p}}function gFe({rotation:e,scale:t,shear:i}){let r=Math.cos(e),s=Math.sin(e),n=[[r,-s],[s,r]],c=[[t[0],i[0]*t[1]],[i[1]*t[0],t[1]]],u=aD(n,c);return[u[0][0],u[1][0],u[0][1],u[1][1]]}var Wn;(e=>{function t(){return[1,0,0,0,1,0,0,0,1]}e.identity=t;function i(Y,J=e.identity()){for(let X=0,ee=Y.length;X<ee;X++)J[X]=Y[X];return J}e.copy=i;function r(Y,J,X,ee,oe,le){return e.setAbcdef(e.identity(),Y,J,X,ee,oe,le)}e.create=r;function s(Y,J,X,ee,oe,le,ve){return Y[0]=J,Y[1]=ee,Y[2]=le,Y[3]=X,Y[4]=oe,Y[5]=ve,Y}e.setAbcdef=s;function n(Y,J){let[X,ee,oe,le,ve,we]=u(Y),[fe,Ue,Fe,Pe,Ae,et]=u(J),$e=fe*X+Ue*oe,rt=fe*ee+Ue*le,Je=Fe*X+Pe*oe,bt=Fe*ee+Pe*le,ot=Ae*X+et*oe+ve,xt=Ae*ee+et*le+we;return e.create($e,rt,Je,bt,ot,xt)}e.append=n;function c(Y,J){let[X,ee,oe,le,ve,we]=u(Y),[fe,Ue,Fe,Pe,Ae,et]=u(J),$e=X,rt=ee,Je=oe,bt=le;(fe!==1||Ue!==0||Fe!==0||Pe!==1)&&($e=X*fe+ee*Fe,rt=X*Ue+ee*Pe,Je=oe*fe+le*Fe,bt=oe*Ue+le*Pe);let ot=ve*fe+we*Fe+Ae,xt=ve*Ue+we*Pe+et;return e.create($e,rt,Je,bt,ot,xt)}e.prepend=c;function u(Y){return[Y[0],Y[3],Y[1],Y[4],Y[2],Y[5]]}e.getAbcdef=u;function p(Y){let[J,X,ee,oe,le,ve]=e.getAbcdef(Y),we=J*oe-X*ee,fe=oe/we,Ue=-X/we,Fe=-ee/we,Pe=J/we,Ae=(ee*ve-oe*le)/we,et=-(J*ve-X*le)/we;return e.create(fe,Ue,Fe,Pe,Ae,et)}e.invert=p;function f([Y,J],X){let[ee,oe,le,ve,we,fe]=e.getAbcdef(X);return[ee*Y+le*J+we,oe*Y+ve*J+fe]}e.apply=f;function x(Y,J){let[X,ee,oe,le,ve,we]=e.getAbcdef(J),fe=1/(X*le+oe*-ee),[Ue,Fe]=Y;return[le*fe*Ue+-oe*fe*Fe+(we*oe-ve*le)*fe,X*fe*Fe+-ee*fe*Ue+(-we*X+ve*ee)*fe]}e.applyInverse=x;function w(Y,J,X=J){let[ee,oe,le,ve,we,fe]=e.getAbcdef(Y);return e.setAbcdef(Y,ee*J,oe*X,le*J,ve*X,we*J,fe*X),Y}e.scale=w;function E(Y,J){let X=Math.cos(J),ee=Math.sin(J),[oe,le,ve,we,fe,Ue]=e.getAbcdef(Y);return e.setAbcdef(Y,oe*X-le*ee,oe*ee+le*X,ve*X-we*ee,ve*ee+we*X,fe*X-Ue*ee,fe*ee+Ue*X),Y}e.rotate=E;function A(Y,J,X){let[ee,oe]=X,le=e.translate(Y,-ee,-oe);return le=e.rotate(le,J),le=e.translate(le,ee,oe),le}e.rotateAround=A;function I(Y,J,X){let[ee,oe,le,ve,we,fe]=e.getAbcdef(Y);return e.setAbcdef(Y,ee,oe,le,ve,we+J,fe+X),Y}e.translate=I;function P(Y,J,X){let[ee,oe,le,ve]=e.getAbcdef(Y);return e.setAbcdef(Y,ee,oe,le,ve,J,X),Y}e.setTranslate=P;function O(Y,J,X){let[ee,oe,le,ve]=e.getAbcdef(Y);return e.setAbcdef(Y,ee,oe,le,ve,J,X),Y}e.setPosition=O;function k(Y){let[J,X,ee,oe]=e.getAbcdef(Y),le=Math.sqrt(J*J+X*X),ve=Math.sqrt(ee*ee+oe*oe);return[le,ve]}e.getScale=k;function U(Y){let[,,,,J,X]=e.getAbcdef(Y);return[J,X]}e.getPosition=U;function j(Y,J){return e.decompose(Y,J).rotation}e.getRotation=j;function V(Y,J){let[X,ee,oe,le,ve,we]=e.getAbcdef(Y),{rotation:fe,scale:Ue,shear:Fe}=mFe([[X,oe],[ee,le]]);return{position:[ve+(J[0]*X+J[1]*oe)-J[0],we+(J[0]*ee+J[1]*le)-J[1]],scale:Ue,rotation:fe,shear:Fe,pivot:J}}e.decompose=V;function $(Y,J,X,ee,oe=[0,0]){let[le,ve]=Y,[we,fe]=ee,[Ue,Fe,Pe,Ae]=gFe({rotation:X,scale:J,shear:oe}),et=le-(we*Ue+fe*Pe)+we,$e=ve-(we*Fe+fe*Ae)+fe;return e.create(Ue,Fe,Pe,Ae,et,$e)}e.compose=$})(Wn||(Wn={}));var yFe=Math.PI/180,QYe=180/Math.PI;function vFe(e,t,i,r,s,n){let c=e-i,u=t-r;return c*c/(s*s)+u*u/(n*n)<=1}function _Fe(e){return e*yFe}var ya=class{constructor(e,t,i){this.uuid=e,this.data=t,this.localMatrix=Wn.identity(),this.worldMatrix=Wn.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new YB,this._recursiveBBox=new YB,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=vU(),this.dpr=i.dpr??1,this.dataPatched=t}project(e,t){let i=this.worldMatrix;return t&&(i=Wn.append(t.worldMatrix,i)),Wn.applyInverse(e,i)}intersects(e,t,i,r=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([e,t],i),r)}intersectsInLocalSpace(e,t,i=!1){let{min:r,max:s}=i?this.recursiveBBox:this.singleBBox;return e>=r[0]&&e<=s[0]&&t>=r[1]&&t<=s[1]}applyTransforms(e){e.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=Wn.compose(this.position,this.scale,_Fe(this.rotation),zy.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(e,t,i){let r=this.parent;t&&r!==null&&r!==void 0&&r.updateWorldMatrix(e,!0,!1),e&&this.updateLocalMatrix(),this.parent?this.worldMatrix=Wn.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=Wn.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return zy.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(e=>{e.resetBBoxNeedsUpdateSelf()})}updateTransformState(e){let t=!1;e.position!==void 0&&(t=!0,this.position=e.position),e.rotation!==void 0&&(t=!0,this.rotation=e.rotation),e.scale!==void 0&&(t=!0,this.scale=e.scale),e.shear!==void 0&&(t=!0,this.shear=e.shear),t&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(e,t,i){e.type===0&&e.props.visible!==void 0&&(this.visible=e.props.visible),this.data=t,this.data=t;let r=e,s=ws(e.path,["states","*"]);if(s!==null){if(e.type===0){let[c]=s;if(this?.stateSelection===c){let u=me({},e.props);if(delete u.name,Object.values(e.props).some(p=>p===void 0)){let p=this.data;if(p!==void 0){let f=Zo.zoom(p,e.path.slice(2));if(f)for(let x in e.props)e.props[x]===void 0&&x in f&&(u[x]=f[x])}}r=pt(me({},e),{props:u,path:e.path.slice(2)})}}}else if(e.type===0){let c=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(c!==void 0){if(e.props.name!==void 0&&c.name){let n=c,{name:p}=n;c=ll(n,["name"])}let u=Zo.removeOverridden(e.path,e.props,c);r=pt(me({},e),{props:u})}}this.updateByPatchedOpBase(r,Ty.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(e,t,i=!1){if(!(this.data.states.length===0&&!i)){for(let r of this.data.states)Ty.toOps(this.data,r.data).forEach(s=>{let n=kD.replaceProps(s,this.data);this.dataPatched=this.data,this.updateByPatchedOp(n,this.data,t)});if(e!==null){let r=this.data.states.data(e);r&&(this.dataPatched=Ty.patch(this.data,r),Ty.toOps(this.data,r).forEach(s=>{this.updateByPatchedOp(s,this.dataPatched,t)}))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=e}}updateState(e,t){e.name!==void 0&&(this.name=e.name),e.visible!==void 0&&(this.visible=e.visible),this.updateTransformState(e)}updateByPatchedOpBase(e,t,i){this.dataPatched=t,this.updateByPatchedOp(e,t,i)}updateByPatchedOp(e,t,i){e.path.length===0&&e.type===0&&this.updateState(e.props,i),this.requestRender()}traverseFrameAncestors(e){this.traverseAncestors(t=>{t.data.type==="frame2d"&&e(t)})}traverseAncestors(e){let t=this.parent;for(;t;)e(t),t=t.parent}requestRender(){this.traverseFrameAncestors(e=>{e.requestRender()})}clone(e){let t=new ya(this.uuid,this.data,e);return t.parent=void 0,t}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}dispatchEvent(e){this.emitter.emit(e.type,pt(me({},e),{target:e.target??this}))}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children;if(t){let i=t.indexOf(this)+1;return t[i]?t[i]:e.traverseSortNextHelper()}}}sortNext(){let e=this.children;return e&&e.length>0&&e[0]?e[0]:this.traverseSortNextHelper()}isDescendantOf(e){e instanceof ya&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}},ju=class extends ya{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.context=i,this.children=[]}add(e){e.parent&&e.parent instanceof ju&&e.parent.remove(e),this.children.push(e),e.parent=this}remove(e){let t=this.children.indexOf(e);t>=0&&(this.children.splice(t,1),e.parent=void 0)}traverse(e){let t=e(this);if(t!==!0)for(let i of this.children)i instanceof ju?i.traverse(e):t=e(i)}intersectsChildrenHelper(e,t,i,r,s){for(let n of this.children)if(n.intersects(e,t,i,!1)&&(s.push(n),r)||n instanceof ju&&n.intersectsChildrenHelper(e,t,i,r,s))return!0;return!1}intersectsChildren(e,t,i,r=!1,s=[],n=!1){return this.intersectsChildrenHelper(e,t,i,r,s),s}intersectsChildrenHelperReverse(e,t,i,r,s){for(let n of this.children)if(n instanceof ju&&n.intersectsChildrenHelperReverse(e,t,i,r,s)||n.intersects(e,t,i,!1)&&(s.push(n),r))return!0;return!1}intersectsChildrenReverse(e,t,i,r=!1,s=[],n=!1){return this.intersectsChildrenHelperReverse(e,t,i,r,s),s}updateWorldMatrix(e,t,i){if(super.updateWorldMatrix(e,t,i),i&&this.children)for(let r of this.children)r.updateWorldMatrix(e,!1,!0)}find(e){let t;return this.traverse(i=>{i.uuid===e&&(t=i)}),t}innerDrawChildren(e){for(let t=this.children.length-1;t>=0;t--)this.children[t].draw(e)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse(e=>{e.resetBBoxNeedsUpdateSelf()})}clone(e){let t=new ju(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},xm=class extends ju{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.updateState(t,i)}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.innerDrawChildren(e),e.restore())}clone(e){let t=new xm(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}};function xFe(e,t){let[[i,r],[s,n]]=e,[[c,u],[p,f]]=t,x=(i-s)*(u-f)-(r-n)*(c-p);if(x===0)return!1;let w=((i-c)*(u-f)-(r-u)*(c-p))/x,E=-((i-s)*(r-u)-(r-n)*(i-c))/x;return w>=0&&w<=1&&E>=0&&E<=1}var zte=[[-1,1],[-1,-1],[1,-1],[1,1]],AZ=(e,t,i)=>{let r=e.getCenter(),s=e.getHalfSize(),n=Wn.append(t,e.worldMatrix);s[0]===0&&s[1]===0?i.push(Wn.apply(r,n)):zte.forEach(c=>{let u=[c[0]*s[0]+r[0],c[1]*s[1]+r[1]];i.push(Wn.apply(u,n))})},YB=class{constructor(){this.matrix=Wn.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(e,t=!1){e.updateWorldMatrix(),this.makeEmpty(),Wn.copy(e.worldMatrix,this.matrix);let i=Wn.invert(e.worldMatrix);this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];i===!0&&e instanceof ju?e.traverse(s=>{s.visible&&AZ(s,t,r)}):AZ(e,t,r),this.setFromPoints(r)}setFromSize(e,t,i){this.makeEmpty(),Wn.copy(i,this.matrix),this.expandBySize(e,t,i)}expandBySize(e,t,i){[Wn.apply([0,0],i),Wn.apply([0,t],i),Wn.apply([e,t],i),Wn.apply([e,0],i)].forEach(r=>this.expandByPoint(r))}getCenter(){let[e,t]=this.min,[i,r]=this.getHalfSize();return Wn.apply([e+i,t+r],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[(this.max[0]-this.min[0])*.5,(this.max[1]-this.min[1])*.5]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(e){this.makeEmpty();for(let t of e)this.expandByPoint(t)}expandByPoint(e){this.min=[Math.min(this.min[0],e[0]),Math.min(this.min[1],e[1])],this.max=[Math.max(this.max[0],e[0]),Math.max(this.max[1],e[1])]}computeVertices(){let[e,t]=this.getHalfSize(),i=this.getCenter(),[r,s,n,c]=Wn.getAbcdef(this.matrix),u=Wn.create(r,s,n,c,i[0],i[1]);this.vertices=zte.map(([p,f])=>Wn.apply([p*e,f*t],u))}computeEdges(){this.edges=[];for(let e=0,t=this.vertices.length;e<t;++e)this.edges.push([this.vertices[e],this.vertices[(e+1)%t]])}project(e,t){let i=this.matrix;return t&&(i=Wn.append(t.worldMatrix,i)),Wn.applyInverse(e,i)}intersects(e,t,i){return this.intersectsInLocalSpace(...this.project([e,t],i))}intersectsInLocalSpace(e,t){let{min:i,max:r}=this;return e>=i[0]&&e<=r[0]&&t>=i[1]&&t<=r[1]}containsPoint(e){let[t,i]=e,[r,s]=this.min,[n,c]=this.max;return t>=r&&t<=n&&i>=s&&i<=c}intersectsBBox2D(e){for(let t=0,i=this.edges.length;t<i;t++){let r=this.edges[t];for(let s=0,n=e.edges.length;s<n;s++){let c=e.edges[s];if(xFe(r,c))return!0}}for(let t=0,i=e.vertices.length;t<i;t++){let r=e.vertices[t];if(this.containsPoint(r))return!0}return!1}ensureMinMax(){let e=this.min,t=this.max;this.min=[Math.min(e[0],t[0]),Math.min(e[1],t[1])],this.max=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]}copy(e){this.min=[...e.min],this.max=[...e.max],Wn.copy(e.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let e=new YB;return e.copy(this),e}},Fte,bFe=new Promise(e=>{Fte=e}),CZ=!1,U2;function wFe(){if(CZ)return;if(U2)return U2;function e(){return jn(this,null,function*(){let t=yield import("./chunk-L7DD5ISM.js");Fte(t.default??t),CZ=!0})}return U2=e(),U2}function DZ(e){let t=!1;return e.scene.objects.traverse((i,r)=>{(r.type==="Mesh"&&r.geometry.type==="UIGeometry"||r.type==="Page"&&r.uiFrame!==void 0)&&(t=!0)}),t}var Yr,zk;function SFe(e){return jn(this,null,function*(){let t=yield bFe;Yr||(zk||(zk=t({locateFile:()=>e})),Yr=yield zk)})}var IZ=Wn.identity(),kte=class{constructor(e,t=1){this.canvas=e,this._dpr=t,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=fs.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=fs.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let i=e.getBoundingClientRect();e.width=i.width*t,e.height=i.height*t}catch{console.log(e.width,t)}this._currentM3Transform=IZ,this._currentTransform=new Float32Array(IZ)}get dpr(){return this._dpr}set dpr(e){this._dpr=e,this._isSizeDirty=!0}init(){return jn(this,null,function*(){if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");yield SFe(this.wasmURL),this._surface=Yr.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas(),this._paint=new Yr.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(Yr.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(Yr.PaintStyle.Stroke),this.ctx?.scale(this.dpr,this.dpr)})}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(e){this._currentM3Transform=e,this._currentTransform.set(e)}loadFont(e,t){return jn(this,null,function*(){let i=yield(yield fetch(e)).arrayBuffer();this.registerFont(i,t)})}registerFont(e,t){if(this._fonts.has(t))return;let i=Yr.FontMgr.FromData(e);if(i)this._fonts.set(t,i);else throw new Error("Invalid font data for "+t)}get width(){return this._width}get height(){return this._height}set strokeColor(e){this._paintStroke&&this._paintStroke.setColor(j2(e),Yr.ColorSpace.DISPLAY_P3)}set fillColor(e){this._paintFill&&this._paintFill.setColor(j2(e),Yr.ColorSpace.DISPLAY_P3)}set lineWidth(e){this._paintStroke&&this._paintStroke.setStrokeWidth(this._strokeMode==="center"?e:e*2)}set strokeMode(e){this._strokeMode=e}set dropShadowBlur(e){this._dropShadowBlur=e}set dropShadowColor(e){this._dropShadowColor=e}set dropShadowOffsetX(e){this._dropShadowOffsetX=e}set dropShadowOffsetY(e){this._dropShadowOffsetY=e}set innerShadowBlur(e){this._innerShadowBlur=e}set innerShadowColor(e){this._innerShadowColor=e}set innerShadowOffsetX(e){this._innerShadowOffsetX=e}set innerShadowOffsetY(e){this._innerShadowOffsetY=e}set innerShadowSpread(e){this._innerShadowSpread=e}set layerBlur(e){this._layerBlur=e}set backgroundBlur(e){this._backgroundBlur=e}clear(){this.ctx?.clear(Yr.TRANSPARENT)}save(){this.ctx?.save()}restore(){this.ctx?.restore()}beginPath(){this._currentPath?.delete(),this._currentPath=new Yr.Path}closePath(){let e=this._currentPath;if(e){if(e.isEmpty())return;let t=e.getBounds();(t[3]-t[1]||t[2]-t[0])&&e.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(e,t,i,r,s=0,n=0,c=0,u=0){let p=Yr.XYWHRect(e,t,i,r);if(s===0&&n===0&&u===0&&c===0)this.ctx?.clipRect(p,Yr.ClipOp.Intersect,!0);else{let f=Yr.RRectXY(p,s,s);f[4]=f[5]=s,f[6]=f[7]=n,f[8]=f[9]=c,f[10]=f[11]=u,this.ctx?.clipRRect(f,Yr.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let e=Wn.invert(this.currentTransform);this.ctx.concat(e);let t=Wn.translate(Wn.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(t),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(e,t,i=!0){if(this.ctx&&this._currentPath){let r,s=!1;if(i&&this._hasDropShadow()){let n=e.copy();n.setColor(j2(this._dropShadowColor));let c;this._dropShadowBlur>0&&(c=Yr.MaskFilter.MakeBlur(Yr.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(this.camera?.scale??1),!1),n.setMaskFilter(c)),this.ctx.save(),this.ctx.clipPath(this._currentPath,Yr.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),t(n),this.ctx.restore(),n.delete(),c?.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,Yr.ClipOp.Intersect,!0);let n=Yr.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,Yr.TileMode.Clamp,null),c=e.copy();c.setImageFilter(n),c.setAlphaf(1);let u=this._currentPath.computeTightBounds();this.ctx.saveLayer(c,u,null,Yr.SaveLayerInitWithPrevious),this.ctx.drawColor(e.getColor()),this.ctx.restore(),this.ctx.restore(),c.delete(),n.delete(),s=!0}if(this._layerBlur>0){let n=e.copy();r=Yr.MaskFilter.MakeBlur(Yr.BlurStyle.Normal,this._layerBlur*this.dpr*(this.camera?.scale??1),!1),n.setMaskFilter(r),t(n),n.delete(),r.delete(),s=!0}if(s||t(e),i&&this._hasInnerShadow()){let n=new Yr.Paint;n.setAntiAlias(!0),n.setStyle(Yr.PaintStyle.Fill),n.setColor(j2(this._innerShadowColor));let c;this._innerShadowBlur>0&&(c=Yr.MaskFilter.MakeBlur(Yr.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(this.camera?.scale??1),!1),n.setMaskFilter(c));let u=this._currentPath.computeTightBounds(),[p,f,x,w]=u,E=x-p,A=w-f;this.ctx.save(),this.ctx.clipPath(this._currentPath,Yr.ClipOp.Intersect,!0),this.ctx.saveLayer(n,u,null,Yr.SaveLayerInitWithPrevious),this.ctx?.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(Yr.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+E+Math.abs(this._innerShadowOffsetX*2),2e3+A+Math.abs(this._innerShadowOffsetY*2)),n),n.setBlendMode(Yr.BlendMode.Clear),this.ctx.drawPath(this._currentPath,n),this.ctx.restore(),this.ctx.restore(),n.delete(),c?.delete()}}}_paintInner(e,t=!0){if(this.ctx&&this._currentPath&&e){let i=this.ctx,r=this._currentPath;this._applyEffectsToPaint(e,s=>{let n=!1;!t&&this._strokeMode!=="center"&&(i.save(),i.clipPath(r,this._strokeMode==="outside"?Yr.ClipOp.Difference:Yr.ClipOp.Intersect,!0),n=!0),i.drawPath(r,s),n&&i.restore()},t)}}_hasDropShadow(){return this._dropShadowColor?.a>0}_hasInnerShadow(){return this._innerShadowColor?.a>0}path(e){this._currentPath?.addPath(Yr.Path.MakeFromSVGString(e))}ellipse(e,t,i,r,s,n,c,u){if(!PZ([e,t,i,r])||!this._currentPath)return;if(i<0||r<0)throw Error("radii cannot be negative");let p=Yr.XYWHRect(e-i,t-r,i*2,r*2);this._currentPath?.addOval(p)}rect(e,t,i,r,s=0,n=0,c=0,u=0){let p=Yr.XYWHRect(e,t,i,r);if(PZ(p))if(s===0&&n===0&&u===0&&c===0)this._currentPath?.addRect(p);else{let f=Yr.RRectXY(p,s,s);f[4]=f[5]=s,f[6]=f[7]=n,f[8]=f[9]=c,f[10]=f[11]=u,this._currentPath?.addRRect(f)}}getHorizontalAlign(e){switch(e){case 2:return Yr.TextAlign.Right;case 3:return Yr.TextAlign.Center;case 4:return Yr.TextAlign.Justify;case 1:default:return Yr.TextAlign.Left}}drawTextInner(e,t,i,[r,s,n,c],u,p,f=!0){let x=0,{ctx:w}=this;if(!w)return x;let E=p.copy(),A=p.copy();return A.setAlphaf(0),this._applyEffectsToPaint(E,I=>{t.pushPaintStyle(i,I,A),t.addText(e);let P=t.build();P.layout(n);let O=s;u===2?O+=(c-P.getHeight())/2:u===3&&(O+=c-P.getHeight()),w.drawParagraph(P,r,O),x=P.getHeight(),t.reset(),P.delete()},f),E.delete(),A.delete(),x}drawText(e,t){let i=0,r=this._fonts.get(t.font),{ctx:s,_paintFill:n,_paintStroke:c}=this;if(r&&s){let u=new Yr.TextStyle({fontFamilies:[t.font],fontSize:t.fontSize,heightMultiplier:t.lineHeight,letterSpacing:t.letterSpacing}),p=new Yr.ParagraphStyle({textStyle:u,textAlign:this.getHorizontalAlign(t.horizontalAlign)}),f=Yr.XYWHRect(t.x,t.y,t.width,t.height),x=Yr.ParagraphBuilder.Make(p,r);n&&(i=this.drawTextInner(e,x,u,f,t.verticalAlign,n,!0)),c&&(i=this.drawTextInner(e,x,u,f,t.verticalAlign,c,!1)),x.delete()}return{height:i}}render(){this._surface?.flush()}moveTo(e,t){this._currentPath?.moveTo(e,t)}lineTo(e,t){this._currentPath?.lineTo(e,t)}bezierCurveTo(e,t,i,r,s,n){this._currentPath?.cubicTo(e,t,i,r,s,n)}quadraticCurveTo(e,t,i,r){this._currentPath?.quadTo(e,t,i,r)}setTransform(e,t=!1){if(!this.ctx)return;let i=this.ctx.getTotalMatrix(),r=Wn.invert(i);if(r&&this.ctx.concat(r),this.ctx?.scale(this.dpr,this.dpr),this.camera?.enabled&&(this.ctx?.concat(this.camera.worldMatrix),t)){let s=Wn.getScale(this.camera.worldMatrix);this.ctx?.scale(1/s[0],1/s[1])}this.ctx?.concat(e),this.currentTransform=e}transform(e){this.ctx?.concat(e)}setSize(e,t){!this._isSizeDirty&&e===this._width&&t===this._height||(this._isSizeDirty=!1,this._width=e,this._height=t,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.width=e*this.dpr,this.canvas.height=t*this.dpr,this._surface&&(this._surface=Yr.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas()))}};function PZ(e){for(let t=0;t<e.length;t++)if(e[t]!==void 0&&!Number.isFinite(e[t]))return!1;return!0}function j2({r:e,g:t,b:i,a:r}){return Yr.Color4f(e,t,i,r)}var RZ=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=fs.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(t)}update(e){e.color!==void 0&&(this.color=e.color),e.enabled!==void 0&&(this.enabled=e.enabled),e.blurRadius!==void 0&&(this.blurRadius=e.blurRadius),e.offset!==void 0&&(this.offset=e.offset),e.spread!==void 0&&(this.spread=e.spread)}},OZ=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.radius=0,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.radius!==void 0&&(this.radius=e.radius)}},EFe=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=fs.transparent,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color)}},MFe=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=fs.transparent,this.thickness=0,this.mode="inside",this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color),e.thickness!==void 0&&(this.thickness=e.thickness),e.mode!==void 0&&(this.mode=e.mode)}},ha=class extends ya{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.autoClose=!0,this.fill=new EFe(e+"-fill",t.fill,i),this.stroke=new MFe(e+"-stroke",t.stroke,i),this.dropShadow=new RZ(e+"-dropShadow",t.dropShadow,i),this.innerShadow=new RZ(e+"-innerShadow",t.innerShadow,i),this.backgroundBlur=new OZ(e+"-backgroundBlur",t.backgroundBlur,i),this.layerBlur=new OZ(e+"-layerBlur",t.layerBlur,i)}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:fs.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:fs.transparent,e.strokeMode=this.stroke.mode,e.lineWidth=this.stroke.thickness}applyFilters(e){this.layerBlur.enabled?e.layerBlur=this.layerBlur.radius*5:e.layerBlur=0,this.backgroundBlur.enabled?e.backgroundBlur=this.backgroundBlur.radius*5:e.backgroundBlur=0,this.dropShadow.enabled?(e.dropShadowBlur=this.dropShadow.blurRadius*5,e.dropShadowColor=this.dropShadow.color,e.dropShadowOffsetX=this.dropShadow.offset[0],e.dropShadowOffsetY=this.dropShadow.offset[1]):e.dropShadowColor=fs.transparent,this.innerShadow.enabled?(e.innerShadowSpread=this.innerShadow.spread,e.innerShadowBlur=this.innerShadow.blurRadius*5,e.innerShadowColor=this.innerShadow.color,e.innerShadowOffsetX=this.innerShadow.offset[0],e.innerShadowOffsetY=this.innerShadow.offset[1]):e.innerShadowColor=fs.transparent}innerDraw(e){}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.applyFilters(e),this.applyFillStroke(e),e.beginPath(),this.innerDraw(e),this.autoClose&&e.closePath(),this.fill.enabled&&e.fill(),this.stroke.enabled&&e.stroke(),e.restore())}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(ws(e.path,["fill"])?this.fill.update(e.props):ws(e.path,["stroke"])?this.stroke.update(e.props):ws(e.path,["dropShadow"])?this.dropShadow.update(e.props):ws(e.path,["innerShadow"])?this.innerShadow.update(e.props):ws(e.path,["layerBlur"])?this.layerBlur.update(e.props):ws(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}updateState(e,t){super.updateState(e,t),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur)}clone(e){let t=new ha(this.uuid,this.data,e);return t.parent=void 0,t}},TU=class extends ha{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.updateState(t,i)}innerDraw(e){e.ellipse(this.width*.5,this.height*.5,this.width*.5,this.height*.5,0,0,Math.PI*2)}intersectsInLocalSpace(e,t){return vFe(e,t,this.width*.5,this.height*.5,this.width*.5,this.height*.5)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e)}clone(e){let t=new TU(this.uuid,this.data,e);return t.parent=void 0,t}},tE=class extends ha{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(t,i)}innerDraw(e){e.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e)}clone(e){let t=new tE(this.uuid,this.data,e);return t.parent=void 0,t}},AU=class extends ha{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(t,i)}get textHeight(){return this._textHeight}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:fs.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:fs.transparent,e.strokeMode="center",e.lineWidth=this.stroke.thickness}innerDraw(e){this._fontHolder?.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&e.registerFont(this._fontHolder.arrayBuffer,this.data.font);let t=this.data.textTransform,i=this.data.text.textValue.toString(),r=t===2?i.toUpperCase():t===3?i.toLowerCase():i,{height:s}=e.drawText(r,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=s}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(e,{shared:t}){e.font!==void 0&&(this._fontHolder=t.getFont(e.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then(()=>{this.requestRender()}))}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateFontState(e,t)}clone(e){let t=new AU(this.uuid,this.data,e);return t.parent=void 0,t}},Nte=class extends ha{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(t,i)}computeExtremas(){this.curves.length===0&&this.computeCurves();let e=this.curves.map(r=>uI.extremas(r)),t=[1/0,1/0],i=[-1/0,-1/0];for(let r=0,s=e.length;r<s;r++){let n=e[r];n[0][0]<t[0]&&(t[0]=n[0][0]),n[0][1]<t[1]&&(t[1]=n[0][1]),n[1][0]>i[0]&&(i[0]=n[1][0]),n[1][1]>i[1]&&(i[1]=n[1][1])}return this.extremasBBox.min=[t[0],t[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,r=this.data.points.length;i<r;i++){let s=this.data.points[i].data,n=this.data.points[i-1].data,c={start:n.position,cp1:n.controlNext.position,cp2:s.controlPrevious.position,end:s.position};this.curves.push(c)}let e=this.data.points[0].data,t=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let i={start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(i)}}getCenter(){let[e,t]=this.extremasBBox.min,[i,r]=this.getHalfSize();return[e+i,t+r]}getHalfSize(){let{min:e,max:t}=this.extremasBBox;return[(t[0]-e[0])*.5,(t[1]-e[1])*.5]}innerDraw(e){for(let r=0,s=this.data.points.length;r<s;r++){let n=this.data.points[r].data;if(r===0){let[c,u]=n.position;e.moveTo(c,u)}else{let c=this.data.points[r-1].data,[u,p]=c.controlNext.position,[f,x]=n.controlPrevious.position,[w,E]=n.position,A={start:c.position,cp1:c.controlNext.position,cp2:n.controlPrevious.position,end:n.position};uI.derive(A),e.bezierCurveTo(u,p,f,x,w,E)}}let t=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[r,s]=i.controlNext.position,[n,c]=t.controlPrevious.position,[u,p]=t.position;e.bezierCurveTo(r,s,n,c,u,p)}}updateState(e,t){super.updateState(e,t),this.computeExtremas()}clone(e){let t=new Nte(this.uuid,this.data,e);return t.parent=void 0,t}},uI;(e=>{function t(c){let u=c.start,p=c.cp1,f=c.cp2,x=c.end,w=[3*(p[0]-u[0]),3*(p[1]-u[1])],E=[3*(f[0]-p[0]),3*(f[1]-p[1])],A=[3*(x[0]-f[0]),3*(x[1]-f[1])],I={start:w,cp:E,end:A};return c.derivative=I,I.derivative=XB.derive(I),I}e.derive=t;function i(c,u,p,f=!1){let x=c-2*u+p;if(x!==0){let w=-Math.sqrt(Math.abs(u*u-c*p)),E=-c+u,A=-(w+E)/x,I=-(-w+E)/x;return[A,I]}else if(u!==p&&x===0)return[(2*u-p)/(2*(u-p))];return[]}function r(c){let u=c.derivative??e.derive(c),p=u.start,f=u.cp,x=u.end;return[i(p[0],f[0],x[0]),i(p[1],f[1],x[1])]}e.droot=r;function s(c){let[u,p]=e.droot(c),f=[c.start[0],c.end[0]],x=[c.start[1],c.end[1]];for(let w of u)f.push(e.compute(c,Math.min(1,Math.max(0,w)))[0]);for(let w of p)x.push(e.compute(c,Math.min(1,Math.max(0,w)))[1]);return f.sort((w,E)=>w-E),x.sort((w,E)=>w-E),[[f[0],x[0]],[f[f.length-1],x[x.length-1]]]}e.extremas=s;function n(c,u){if(u===0)return[...c.start];if(u===1)return[...c.end];let p=1-u,f=p*p,x=u*u,w=f*p,E=f*u*3,A=p*x*3,I=u*x;return[w*c.start[0]+E*c.cp1[0]+A*c.cp2[0]+I*c.end[0],w*c.start[1]+E*c.cp1[1]+A*c.cp2[1]+I*c.end[1]]}e.compute=n})(uI||(uI={}));var XB;(e=>{function t(s){let n=s.start,c=s.cp,u=s.end,p=[2*(c[0]-n[0]),2*(c[1]-n[1])],f=[2*(u[0]-c[0]),2*(u[1]-c[1])],x={start:p,end:f};return x.derivative=$B.derive(x),s.derivative=x,x}e.derive=t;function i(s){let n=s.derivative??e.derive(s),c=n.start,u=n.end;return[c[0]!==u[0]?c[0]/(c[0]-u[0]):0,c[1]!==u[1]?c[1]/(c[1]-u[1]):0]}e.droot=i;function r(s,n){if(n===0)return[...s.start];if(n===1)return[...s.end];let c=1-n,u=c*c,p=n*n,f=u,x=c*n*2,w=p;return[f*s.start[0]+x*s.cp[0]+w*s.end[0],f*s.start[1]+x*s.cp[1]+w*s.end[1]]}e.compute=r})(XB||(XB={}));var $B;(e=>{function t(r){let s=r.start,n=r.end,c=[n[0]-s[0],n[1]-s[1]];return r.derivative=c,r.derivative}e.derive=t;function i(r,s){if(s===0)return[...r.start];if(s===1)return[...r.end];let n=r.start,c=r.end;return[n[0]+(c[0]-n[0])*s,n[1]+(c[1]-n[1])*s]}e.compute=i})($B||($B={}));var Jh=class extends ju{constructor(e,t,i){super(e,t,i),this.uuid=e,this.width=0,this.height=0,this.clipped=!0,this.background=new tE(e+"-background",RS.defaultData,i),this.background.parent=this,this.updateState(t,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(e){this.background.cornerRadius=e}updateLocalMatrix(){super.updateLocalMatrix(),this.background?.updateLocalMatrix()}updateWorldMatrix(e,t,i){super.updateWorldMatrix(e,t,i),this.background?.updateWorldMatrix(e,t,i)}draw(e){if(!this.visible)return;e.save();let t=this.width,i=this.height;this.applyTransforms(e),this.background.width=t,this.background.height=i,this.background.draw(e),this.clipped&&e.clipRect(0,0,t,i,...this.cornerRadius),this.innerDrawChildren(e),e.restore()}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur),e.clipped!==void 0&&(this.clipped=e.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(ws(e.path,["fill"])?this.fill.update(e.props):ws(e.path,["stroke"])?this.stroke.update(e.props):ws(e.path,["dropShadow"])?this.dropShadow.update(e.props):ws(e.path,["innerShadow"])?this.innerShadow.update(e.props):ws(e.path,["layerBlur"])?this.layerBlur.update(e.props):ws(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}clone(e){let t=new Jh(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},TFe=Dp(jQ(),1),BI=class extends ha{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._pathBBox=new DOMRect,this.path="",this.updateState(t,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(e),t.setAttribute("d",this.path),e.appendChild(t),this._pathBBox=t.getBBox(),e.remove()}innerDraw(e){e.path(this.path)}intersectsInLocalSpace(e,t){return e>=this._pathBBox.x&&e<=this._pathBBox.x+this._pathBBox.width&&t>=this._pathBBox.y&&t<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(e,t){super.updateState(e,t),e.path!==void 0&&(this.path=e.path,this.computeSVGBBox())}clone(e){let t=new BI(this.uuid,this.data,e);return t.parent=void 0,t}};function AFe(e,t=1,i=1){if(t<=0||i<=0)return e;let r=(0,TFe.parseSVG)(e).map(s=>{let n=me({},s);return"x"in n&&(n.x=n.x*t),"y"in n&&(n.y=n.y*i),"x1"in n&&(n.x1=n.x1*t),"x2"in n&&(n.x2=n.x2*t),"y1"in n&&(n.y1=n.y1*i),"y2"in n&&(n.y2=n.y2*i),"rx"in n&&(n.rx=n.rx*t),"ry"in n&&(n.ry=n.ry*i),n});return CFe(r)}function CFe(e){let t=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"],i;return e.map(r=>{let s=[];t.forEach(c=>{if(c in r){let u=r[c]*1;s.length&&u>=0&&s.push(","),s.push(u)}});let n=(i===r.code?s[0]<0?"":",":r.code)+s.join("");return i=r.code,n}).join("")}function DFe(e,t,i){switch(t.type){case"ellipse2d":return new TU(e,t,i);case"rectangle2d":return new tE(e,t,i);case"text2d":return new AU(e,t,i);case"vector2d":return new Nte(e,t,i);case"path2d":return new BI(e,t,i);case"frame2d":return new Jh(e,t,i);case"group2d":default:return new xm(e,t,i)}}var Bte=class{constructor(e,t,i){this.uuid=e,this.data=t,this.group=new xm(Bte.GROUP_ID,me({},iI.defaultData),i),this.createChildrenObjects(t.objects,this.group,i)}createObject(e,t,i,r,s,n){let c=DFe(e,t,n);c&&(r.add(c),r.children.splice(s,0,r.children.pop()),c.updateWorldMatrix(),i.length>0&&(c instanceof xm||c instanceof Jh)&&this.createChildrenObjects(i,c,n))}createChildrenObjects(e,t,i){let r=0;for(let s of e)this.createObject(s.id,s.data,s.children,t,r,i),r+=1}draw(e){this.group.draw(e)}updateEntityByOp(e,t,i,r){let s=this.find(e);if(s)try{s.updateByOp(t,i,{shared:r})}catch(n){console.error(n)}}updateTreeByOp(e,t){if(e.path.length===0&&e.type===7){let i=e.parent===null?this.group:this.find(e.parent);i!==void 0&&i instanceof ju&&(this.createObject(e.id,e.data,e.children,i,e.localIndex,t),i.requestRender())}else if(e.path.length===0&&e.type===8){let i=this.find(e.id);if(i!==void 0&&i.parent!==void 0&&i.parent instanceof ju){let r=i.parent;i.resetBBoxNeedsUpdate(),r?.remove(i),r?.requestRender()}}else if(e.path.length===0&&e.type===9){let i=this.find(e.id);if(i!==void 0){let r=i.parent,s=e.parent===null?this:this.find(e.parent);if(s instanceof ju||s===this){s.add(i);let n=e.localIndex;s.children.splice(n,0,s.children.pop()),i.updateWorldMatrix(!0,!1,!0),r?.requestRender(),i.requestRender()}i.resetBBoxNeedsUpdate()}}}add(e){this.group.add(e)}remove(e){this.group.remove(e)}traverse(e){this.group.traverse(t=>{t!==this.group&&e(t)})}intersectsChildren(e,t,i,r=!1,s=[]){return this.group.intersectsChildren(e,t,i,r,s,!0)}intersectsChildrenReverse(e,t,i,r=!1,s=[]){return this.group.intersectsChildrenReverse(e,t,i,r,s,!0)}find(e){return this.group.find(e)}get children(){return this.group.children}project(e,t){return this.group.project(e,t)}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this.group;){let s=r;r=r.parent;let n=r.children.indexOf(s);i.splice(0,0,n)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>_J(i.sortKey,r.sortKey)),t.map(i=>i.entity)}},CU=Bte;CU.GROUP_ID="scene2d";function Ute({constraints:e,newParentWidth:t,newParentHeight:i,initialParentWidth:r,initialParentHeight:s,objectInitialWidth:n,objectInitialHeight:c,objectInitialPosition:u}){let{horizontalConstraint:p,verticalConstraint:f}=e,x=t-r,w=i-s,E=n,A=c,I=u[0],P=u[1];if(p!==0){if(p===1)I+=x;else if(p===3)I+=x/2;else if(p===2)E=Math.max(1,E+x);else if(p===4){let O=t/r;E*=O,I*=O}}if(f!==0){if(f===1)P+=w;else if(f===3)P+=w/2;else if(f===2)A=Math.max(1,A+w);else if(f===4){let O=i/s;A*=O,P*=O}}return{width:E,height:A,position:[I,P]}}var KYe=Dp(jQ(),1),JYe={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{mm:1,px:1,cm:1,in:1,pt:1,pc:1}},IFe=`
	varying vec2 vUv;
	void main() {
		vUv = uv;
		gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
	}`,PFe=`
	uniform sampler2D tDiffuse;
	varying vec2 vUv;
	void main() {
		vec4 texel = texture2D( tDiffuse, vUv );
		gl_FragColor = texel;
	}`,RFe=new vI(-1,1,1,-1,0,1),OFe=class extends fr{constructor(){super(),this.setAttribute("position",new Vi([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Vi([0,2,0,0,2,0],2))}},LFe=new OFe,zFe=class{constructor(e){this._mesh=new $s(LFe,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,RFe)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}},jte=new Qn({defines:{},uniforms:{tDiffuse:new di(null)},vertexShader:IFe,fragmentShader:PFe}),FFe=new zFe(jte),Fk=null,kk=null,kFe=()=>(Fk===null&&(Fk=document.createElement("canvas")),Fk),NFe=e=>(kk===null&&(kk=new kte(e)),kk),BFe=Wn.identity(),Vte=class{constructor(e,t,i,r){this.uuid=e,this.width=t,this.height=i,this.context=r,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this._innerApplySize=()=>{let s=this.width,n=this.height,c=this.dpr;this.renderer.dpr=this.isScreenSpace?c:Math.floor(2048/Math.max(s,n)),this.renderer.setSize(s,n)},this.onFrameOverrideObjectEvent=s=>{if(s.target?.uuid!==void 0){let n=this.frameRoot?.find(s.target.uuid);n&&n.dispatchEvent(pt(me({},s),{target:n}))}},this.scene2d=new CU(Yi.generateUUID(),vB.defaultData,{dpr:window.devicePixelRatio,shared:r.shared}),this.canvas=kFe(),this.renderer=NFe(this.canvas),this.promise=this.init(),this.renderTarget=new Zn(1,1,{type:wp,stencilBuffer:!1,depthBuffer:!1}),r.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=r.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new Yxe(this.canvas)),this._canvasTexture}init(){return jn(this,null,function*(){this.renderer instanceof kte&&(this.renderer.wasmURL=cte.skiaWasmUrl),yield this.renderer.init()})}render(e){if(this.isFrameDirty){this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),this.frameOverride?.draw(this.renderer),this.renderer.render(),jte.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let t=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.clear(),FFe.render(e),e.setRenderTarget(t),this.textureHolder?.setNeedsUpdate(!0)}}updateEntity2DByOp(e,t,i,r){this.scene2d.updateEntityByOp(e,t,i,r),this.applySize()}updateTreeByOp(e,t){this.scene2d.updateTreeByOp(e,t),this.applySize()}applyOverrides(e){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let t=e?.width??this.width,i=e?.height??this.height;this.frameOverride.width=t,this.frameOverride.height=i,this.frameOverride.localMatrix=BFe,this.isScreenSpace&&(this.frameOverride.fill.color=fs.from0to1([0,0,0,0])),this.frameOverride.data=pt(me({},this.frameOverride.data),{width:t,height:i}),Gte({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(e,t=window.devicePixelRatio){let i=e?.width??this.width,r=e?.height??this.height;this.dpr=t,this.width=i,this.height=r,this._innerApplySize();let s=1,n=512,c=512;(i*t<n||r*t<c)&&(s=Math.max(n/(i*t),c/(r*t))),this.renderTarget.setSize(i*t*s,r*t*s),this._canvasTexture?.dispose(),this._canvasTexture=void 0,this.applyOverrides(e),this.frameOverride?.requestRender()}applyFrame(e){let t=this.context.scene.find2D(e);if(!(!t||!(t instanceof Jh)))return this.disposeFrameOverride(),this.frameRoot=t,this.frameOverride=t.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),this.frame?.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse(i=>{i.addEventListener("beginState",this.onFrameOverrideObjectEvent)}),this.frameOverride.traverse(i=>{i.addEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frame?.requestRender(),t}get frame(){return this.frameOverride}get frameId(){return this.frame?.uuid}find(e){return this.scene2d.find(e)}get texture(){return this.textureHolder?.getTexture(1001)}disposeFrameOverride(){this.frameOverride?.removeEventListener("render",this.onRenderRequestedDownstream),this.frameOverride?.traverse(e=>{e.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)}),this.frameOverride?.traverse(e=>{e.removeEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function Gte({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:s,initialParentHeight:n}){if(e instanceof Jh&&t instanceof Jh||e instanceof xm&&t instanceof xm)for(let c=0,u=e.children.length;c<u;c++){let p=e.children[c],f=t.children[c];p&&f&&p.uuid===f.uuid&&jFe({objectOverride:p,objectRoot:f,newParentWidth:i,newParentHeight:r,initialParentWidth:s,initialParentHeight:n})}}function UFe(e){if(ZB(e))return[e.width,e.height];if(e instanceof BI){let[t,i]=e.getHalfSize();return[t*2,i*2]}else if(e instanceof xm){let[t,i]=e.recursiveBBox.getHalfSize();return[t*2,i*2]}return[0,0]}function jFe({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:s,initialParentHeight:n}){let[c,u]=UFe(t),{width:p,height:f,position:x}=Ute({constraints:e.data,newParentWidth:i,newParentHeight:r,initialParentWidth:s,initialParentHeight:n,objectInitialWidth:c,objectInitialHeight:u,objectInitialPosition:t.position});if(e.position=x,e.data=pt(me({},e.data),{position:x}),e.states)for(let w in e.states)VFe({stateId:w,objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:s,initialParentHeight:n});if(ZB(e)||e instanceof xm)ZB(e)&&(e.width=p,e.height=f,e.data=pt(me({},e.data),{width:p,height:f})),Gte({objectOverride:e,objectRoot:t,newParentWidth:p,newParentHeight:f,initialParentWidth:c,initialParentHeight:u});else if(e instanceof BI){let w=t,E=c!==0?p/c:1,A=u!==0?f/u:1;e.path=AFe(w.path,E,A),e.data=pt(me({},e.data),{path:e.path})}}function VFe({stateId:e,objectOverride:t,objectRoot:i,newParentWidth:r,newParentHeight:s,initialParentWidth:n,initialParentHeight:c}){let u=t.states?.[e],p=i.states?.[e];if(u&&p){let{width:f,height:x,position:w}=Ute({constraints:t.data,newParentWidth:r,newParentHeight:s,initialParentWidth:n,initialParentHeight:c,objectInitialWidth:zy.isResizeable(p)?p.width:0,objectInitialHeight:zy.isResizeable(p)?p.height:0,objectInitialPosition:p.position});Object.assign(t.states[e],{position:w}),zy.isResizeable(u)&&Object.assign(t.states[e],{width:f,height:x})}}function ZB(e){return e instanceof tE||e instanceof Jh||e instanceof TU||e instanceof AU}var ua=class extends rU(Qh){constructor(e,t,i){super(),this.data=t,this.bgColor=new La(1,1,1,1),this.fog=null,this.backupFog=new dK(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new Tr,this.penumbraSizeArrayCache=null,this.super_Entity(e,t),this.personalCamera=new Xa(Lx,pt(me(me({},DS.defaultData),t.camera),{name:"Personal Camera"})),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new R1e(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),t.uiScene?this.uiScene=new CU((Array.isArray(e)?e[0]:e)+"-ui",t.uiScene,{dpr:window.devicePixelRatio,shared:i.shared}):t.uiFrame&&this.createUICanvas(t.uiFrame,i)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){return this.uiCanvas?.frame}createUICanvas(e,t){this.uiCanvas=new Vte(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,t),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then(()=>{this.uiCanvas?.applyFrame(e),this.uiCanvas?.applySize()})}updateVisible(){}setBackgroundColor(e){this.bgColor=e,this.fogUseBGColor===!0&&(this.backupFog.color=e)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(e,t){e.color!==void 0&&(this.ambientLight.color=xl(e.color,t)),e.intensity!==void 0&&(this.ambientLight.intensity=e.intensity),e.enabled!==void 0&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.traverseEntity(t=>{t instanceof Gy&&t.recomputeBoolean()}),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(e=>{if(e instanceof kx)if(Array.isArray(e.material))for(let t of e.material)t.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()})}updateShadow(e){e.softShadowQuality!==void 0&&this.isActive&&nFe(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,t){if(e.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let i=this.scene;i.fog=this.fog}this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=xl(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,t){e.aoColor!==void 0&&(this.aoColor=xl(e.aoColor,t))}updateByOp(e,t,i,r){let s=this.data.uiFrame;super.updateByOp(e,t,i,r);let n=t;ws(e.path,["fog"])?this.updateFog(n.fog,i.shared):ws(e.path,["ao"])?this.updateAo(n.ao,i.shared):ws(e.path,["ambient"])?this.updateAmbientLight(n.ambient,i.shared):ws(e.path,["shadow"])?this.updateShadow(n.shadow):e.type===0&&e.path.length===0&&(e.props.uiFrame!==void 0||s!==n.uiFrame)&&this.updateUIFrame(e.props.uiFrame,i)}updateUIFrame(e,t){e?(this.uiCanvas||this.createUICanvas(e,t),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(e)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(e,t){this.updateState_Entity(e,t),e.backgroundColor!==void 0&&this.setBackgroundColor(xl(e.backgroundColor,t.shared)),e.fog!==void 0&&this.updateFog(e.fog,t.shared),e.ambient!==void 0&&this.updateAmbientLight(e.ambient,t.shared),e.ao!==void 0&&this.updateAo(e.ao,t.shared),e.shadow!==void 0&&this.updateShadow(e.shadow)}createFrame(e,t){}raycast(e,t){super.raycast(e,t)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){return this.scene?.find(this.data.publish.playCamera)??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let e=0,t=0;this.traverseEntity(i=>{if(!i.visible)return!0;i instanceof Ote&&i.visible&&e<3&&(this.penumbraSizeArrayCache[e]=i.data.penumbraSize,e+=1),i instanceof Lte&&i.visible&&e<2&&(this.penumbraSizeArrayCache[3+t]=i.data.penumbraSize,t+=1)})}raycastWithClones(e){let t=[],i=r=>{for(let s of r.children){let n=s.cloner;Ln.is(s)&&(s.visible||n?.object.data.visible)&&((Uu(s)||UB(s)&&this.scene.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,t),QB(s,e,t,!0)),i(s))}};return i(this),t}updateEntity2DByOp(e,t,i,r){this.uiCanvas?.updateEntity2DByOp(e,t,i,r)}},GFe=class extends SU(F1e,Ite){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=90,r.aspect=1,r.near=100,r.far=2500;let s=new se(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),n=new se(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z),c=new mo(s,n),u=new AD(c,new Tr(16755200));u.visible=!1,this.gizmos.shadowmap=u,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof AD){let i=this.shadow.camera,r=new se(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),s=new se(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);t.box.set(r,s),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},HFe=class extends Ya{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?hU(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},DU=class extends Ya{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape()}updateShape(){let e=me({},this.data.geometry.extrusion.shape);for(let r in e)typeof e[r]=="string"&&(e[r]=this._context.shared.getVariable(e[r],[this.uuid,"geometry","extrusion","shape",r]));let t;if(e.type==="Custom"){let r=e.shapeId;if(r!==this._shapeId&&this.detachShape(),r){this._shapeId=r;let s=this._context.scene.find(r);s?.data&&(s.attachedPaths.add(this),t=s.geometry.userData?.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let r;switch(e.type){case"Rectangle":r=uU;break;case"Ellipse":r=cU;break;case"Polygon":r=Aee;break;case"Star":r=Cee;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=r.create({parameters:e}).userData.shape}let i=this.geometry;t&&i.inputs&&(i.inputs.shapeData=t,i.build(),this.attachedSurfaceCloners.forEach(r=>r.update()))}detachShape(){this._shapeId!==null&&this._context.scene.find(this._shapeId)?.attachedPaths.delete(this)}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e,t){return super.updateTransformState(e,t)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?hU(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},IU=class extends wU{constructor(e,t,i){super(e,t,i),this.data=t}},sx=class extends Nx(gp,JS){constructor(e,t,i){super(),t.type==="Instance"&&typeof e=="string"&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(e,t){let i=KD.getComponentData({scene:t.scene.data,shared:t.shared.data},e.component);if(i){let r,s;for(let n of am.rootOverrideProps)e[n]===void 0?(r===void 0&&(r=me({},e)),r[n]=i.data[n]):(s===void 0&&(s={}),s[n]=e[n],r===void 0&&(r=me({},e)),r[n]=pm.apply(i.data[n],e[n]));return this.overrideData=s,r}else return me(me(me({},ma.defaultData),e),_p(ma.defaultData,am.rootOverrideProps))}updateByOp(e,t,i,r){let s;if(this.isInstanceRoot&&!r){if(t=this.transformAssignData(t,i),e.type===0&&e.path.length===0&&this.component)for(let n of am.rootOverrideProps)n in e.props&&e.props[n]===void 0&&(s===void 0&&(s=pt(me({},e),{props:me({},e.props)})),s.props[n]=this.component.data[n]);else if(e.type===0&&e.path.length>0&&am.rootOverrideProps.includes(e.path[0])){let n=e.path[0];s===void 0&&(s=pt(me({},e),{path:[],props:{[n]:t[n]}}))}}super.updateByOp(s??e,t,i,r)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(this.component===void 0){let i=e.scene.find(t.component)??null,r=!1;if(i!==this.oldComponent){if(this.oldComponent){let s=0;for(let n of this.children)if(Ln.is(n))e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),PU(n),s+=1;else break;this.children.splice(0,s)}r=!0}if(i){let s={};Hte(e,[this.uuid],t.overrides,this,i,i,0,r,s);for(let n of this.children)if(Ln.is(n)){let c=n.data;c.type==="Empty"&&c.animations&&n.traverseEntity(u=>{let p=u.dataPatched;if(u instanceof Ya&&p.bones&&p.boneInverses){let f=u.dataPatched;if(f.bones&&f.boneInverses){let x=f.bones.map(A=>e.scene.find(s[A])),w=f.boneInverses.map(A=>new mi().fromArray(A)),E=new v4(x,w);u.bind(E,u.bindMatrix)}}else u.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function PU(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)Ln.is(i)&&PU(i)}}function LZ(e,t,i,r){return e.component===t&&H4(e.identity,r)?e.overrideData===i?2:1:0}function Hte(e,t,i,r,s,n,c,u,p){if(c>50)return!1;if(r.component!==s){if(r.component){let x=r.component.instances.indexOf(r);x>=0&&r.component.instances.splice(x,1)}s.instances.find(x=>x===r)||s.instances.push(r),r.component=s}s instanceof sx&&s.isInstanceRoot&&s.expandInstanceChildren(e);let f=0;for(let x of s.children)if(Ln.is(x)){let w=[...t,...typeof x.identity=="string"?[x.identity]:x.identity],E=XD.resolve(i,w,1);E!=null&&!(E instanceof Do)&&(Object.setPrototypeOf(E,Do.prototype),console.error("wrong prototype"));let A=null,I;if(!u){let P=r.children[f];if(A=Ln.is(P)?P:null,A!==null){let O=LZ(A,x,E,w);I=O>=1?A.stateSelection:void 0,O!==2&&(A=null)}if(A===null&&(A=e.scene.findInstance(w)??null,A!==null)){let O=LZ(A,x,E,w);if(I=O>=1?A.stateSelection:void 0,O!==2)A=null;else{let k=A.parent.children.indexOf(A);A.parent.children.splice(k,1),r.children.splice(f,0,A),A.parent===r?k<=f&&console.error("not possible"):(A.parent=r,A.matrixWorldNeedsUpdate=!0,A.resetBBoxNeedsUpdate(),A.updateVisible(),e.pendingDeletes.delete(A))}}}if(A===null){let P=E?pm.apply(x.data,E):x.data;jy.is(P.type)&&(P=pt(me({},P),{type:"Empty"})),A=cm.createEntity(w,P,e),A.overrideData=E,r.add(A),r.children.splice(r.children.length-1,1),r.children.splice(f,0,A),A.updateState(A.data,e),I&&A.changeSelectedState(I,e),e.scene.registerInstanceAndSetUuid(A)}if(A.isBone){let P=A.identity[A.identity.length-1];p[P]=A.uuid}f+=1,Hte(e,t,i,A,x,n,c+1,u,p)}if(!u){let x=f;for(;;){let w=r.children[f];if(Ln.is(w))e.pendingDeletes.add(w);else break;f+=1}r.children.splice(x,f-x)}return!0}var WFe=class extends Nx(pK,JS){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,t){this.updateState_Entity(e,t)}},Ha=class extends Ya{constructor(e,t,i){super(e,t,i),this.onBeforeRender=r=>{this.uiCanvas.render(r)},this.uiCanvas=new Vte(e+"-canvas",t.geometry.width,t.geometry.height,i),this.uiCanvas.promise.then(()=>{this.applyFrame(this.dataPatched.geometry.frame,i.shared)})}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),e.type===0&&(e.props.frame!==void 0&&this.applyFrame(e.props.frame,i.shared),(e.props.width!==void 0||e.props.height!==void 0)&&this.applySize(e.props,i.shared))}applySize(e,t){let i=e?.width??this.dataPatched.geometry.width,r=e?.height??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:i,height:r}),this.applyGeometryParametersFromFrame(t)}applyFrame(e,t){this.uiCanvas.applyFrame(e),this.applyGeometryParametersFromFrame(t),this.applyMaterialParametersFromFrame({shared:t})}applyGeometryParametersFromFrame(e){let t=this.frame;t&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),this.localGeometry?.dispose(),this.localGeometry=kS(this.dataPatched.geometry,e,this.data.flatShading,this))}applyMaterialParametersFromFrame(e){let t=this.frame;if(t){let i=t.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),this.material.reset(this.dataPatched.material,e,!0)}}updateEntity2DByOp(e,t,i,r){this.uiCanvas.updateEntity2DByOp(e,t,i,r),e===this.frameId&&t.type===0&&(t.props.cornerRadius!==void 0?this.applyGeometryParametersFromFrame(r):ws(t.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:r}))}get frame(){return this.uiCanvas.frame}get frameId(){return this.frame?.uuid}removeInteractionGeometry(e){super.removeInteractionGeometry(e),this.applySize({},e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.applySize({width:e.width,height:e.height},t)}},qFe=class{constructor(e,t,i){this.variables=[],this.currentTextureIndex=0;let r=To,s=new Qh,n=new Hy;n.position.z=1;let c={passThruTexture:{value:null}},u=x(E(),c),p=new $s(new Ep(2,2),u);s.add(p),this.setDataType=function(A){return r=A,this},this.addVariable=function(A,I,P){let O=this.createShaderMaterial(I),k={name:A,initialValueTexture:P,material:O,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:ns,magFilter:ns};return this.variables.push(k),k},this.setVariableDependencies=function(A,I){A.dependencies=I},this.init=function(){if(i.capabilities.isWebGL2===!1&&i.extensions.has("OES_texture_float")===!1)return"No OES_texture_float support for float textures.";if(i.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let A=0;A<this.variables.length;A++){let I=this.variables[A];I.renderTargets[0]=this.createRenderTarget(e,t,I.wrapS,I.wrapT,I.minFilter,I.magFilter),I.renderTargets[1]=this.createRenderTarget(e,t,I.wrapS,I.wrapT,I.minFilter,I.magFilter),this.renderTexture(I.initialValueTexture,I.renderTargets[0]),this.renderTexture(I.initialValueTexture,I.renderTargets[1]);let P=I.material,O=P.uniforms;if(I.dependencies!==null)for(let k=0;k<I.dependencies.length;k++){let U=I.dependencies[k];if(U.name!==I.name){let j=!1;for(let V=0;V<this.variables.length;V++)if(U.name===this.variables[V].name){j=!0;break}if(!j)return"Variable dependency not found. Variable="+I.name+", dependency="+U.name}O[U.name]={value:null},P.fragmentShader=`
uniform sampler2D `+U.name+`;
`+P.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let A=this.currentTextureIndex,I=this.currentTextureIndex===0?1:0;for(let P=0,O=this.variables.length;P<O;P++){let k=this.variables[P];if(k.dependencies!==null){let U=k.material.uniforms;for(let j=0,V=k.dependencies.length;j<V;j++){let $=k.dependencies[j];U[$.name].value=$.renderTargets[A].texture}}this.doRenderTarget(k.material,k.renderTargets[I])}this.currentTextureIndex=I},this.getCurrentRenderTarget=function(A){return A.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(A){return A.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){p.geometry.dispose(),p.material.dispose();let A=this.variables;for(let I=0;I<A.length;I++){let P=A[I];P.initialValueTexture&&P.initialValueTexture.dispose();let O=P.renderTargets;for(let k=0;k<O.length;k++)O[k].dispose()}};function f(A){A.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}this.addResolutionDefine=f;function x(A,I){I=I||{};let P=new Qn({uniforms:I,vertexShader:w(),fragmentShader:A});return f(P),P}this.createShaderMaterial=x,this.createRenderTarget=function(A,I,P,O,k,U){return A=A||e,I=I||t,P=P||js,O=O||js,k=k||ns,U=U||ns,new Zn(A,I,{wrapS:P,wrapT:O,minFilter:k,magFilter:U,format:da,type:r,depthBuffer:!1})},this.createTexture=function(){let A=new Float32Array(e*t*4),I=new $c(A,e,t,da,To);return I.needsUpdate=!0,I},this.renderTexture=function(A,I){c.passThruTexture.value=A,this.doRenderTarget(u,I),c.passThruTexture.value=null},this.doRenderTarget=function(A,I){let P=i.getRenderTarget(),O=i.xr.enabled,k=i.shadowMap.autoUpdate,U=i.outputEncoding,j=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=Xu,i.toneMapping=Zh,p.material=A,i.setRenderTarget(I),i.render(s,n),p.material=u,i.xr.enabled=O,i.shadowMap.autoUpdate=k,i.outputEncoding=U,i.toneMapping=j,i.setRenderTarget(P)};function w(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function E(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}},Ma=new Ia,V2=new se,YFe=class{constructor(e){let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,i=new Float32Array(e.count/3);for(let s=0;s<e.count;s+=3){let n=1;t&&(n=t.getX(s)+t.getX(s+1)+t.getX(s+2)),Ma.a.fromBufferAttribute(e,s),Ma.b.fromBufferAttribute(e,s+1),Ma.c.fromBufferAttribute(e,s+2),n*=Ma.getArea(),i[s/3]=n}this.distribution=new Float32Array(e.count/3);let r=0;for(let s=0;s<i.length;s++)r+=i[s],this.distribution[s]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,i){let r=this.distribution[this.distribution.length-1],s=this.binarySearch(this.randomFunction()*r);return this.sampleFace(s,e,t,i)}binarySearch(e){let t=this.distribution,i=0,r=t.length-1,s=-1;for(;i<=r;){let n=Math.ceil((i+r)/2);if(n===0||t[n-1]<=e&&t[n]>e){s=n;break}else e<t[n]?r=n-1:i=n+1}return s}sampleFace(e,t,i,r){let s=this.randomFunction(),n=this.randomFunction();return s+n>1&&(s=1-s,n=1-n),Ma.a.fromBufferAttribute(this.positionAttribute,e*3),Ma.b.fromBufferAttribute(this.positionAttribute,e*3+1),Ma.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(Ma.a,s).addScaledVector(Ma.b,n).addScaledVector(Ma.c,1-(s+n)),i!==void 0&&Ma.getNormal(i),r!==void 0&&this.colorAttribute!==void 0&&(Ma.a.fromBufferAttribute(this.colorAttribute,e*3),Ma.b.fromBufferAttribute(this.colorAttribute,e*3+1),Ma.c.fromBufferAttribute(this.colorAttribute,e*3+2),V2.set(0,0,0).addScaledVector(Ma.a,s).addScaledVector(Ma.b,n).addScaledVector(Ma.c,1-(s+n)),r.r=V2.x,r.g=V2.y,r.b=V2.z),this}};function XFe(e){let t=new Float32Array(e*e*2);for(let i=0;i<e;i++)for(let r=0;r<e;r++){let s=i*e+r;t[s*2+0]=i/(e-1),t[s*2+1]=r/(e-1)}return t}function $Fe(e){let t=Math.ceil(Math.sqrt(e));return Math.max(t,1)}function ZFe(e,t){let i=new $s(e.geometry,e.material),r=[],s=[],n=new se,c=new se;i.geometry.index!==null&&(i.geometry=i.geometry.toNonIndexed());let u=new YFe(i).build();for(let x=0;x<t;x++)u.sample(n,c),r.push(n.x,n.y,n.z),s.push(c.x,c.y,c.z);let p=new Float32Array(r),f=new Float32Array(s);return{positions:p,normals:f}}function zZ(e,t){let i=e,r=new Float32Array(4*t*t);for(let n=0;n<t*t;n++)r[4*n]=i[3*n],r[4*n+1]=i[3*n+1],r[4*n+2]=i[3*n+2],r[4*n+3]=0;let s=new $c(r,t,t,da,To);return s.needsUpdate=!0,s}function QFe({size:e}){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=r,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new $c(t,e,e,da,To);return i.needsUpdate=!0,i}function KFe(e){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=0,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new $c(t,e,e,da,To);return i.needsUpdate=!0,i}var JFe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform float uTime;
uniform float uSpeed;     // update speed of the particles
uniform vec3 uWorldOffset;    
uniform vec4 uWorldQuaternion;
uniform float uMaxLifeTime;
uniform vec3 uEmitterSize;
uniform float uFPSRatio;     // 1  for 60 FPS

float random (vec2 st) {
    return fract(sin(dot(st.xy,
        vec2(12.9898,78.233)))*
        43758.5453123);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
    vec3 acceleration = force / mass;
    
    return acceleration;
  }
  

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted
    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided
    float lifeTime = uMaxLifeTime;

    // Calculate the position adjustment based on collision
    //     if (collisionFlag > .5) {  
    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0
    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise
    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);

    // Update position based on collision or normal movement
    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);
    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);

    // EMISSION RATE - BIRTH
    // if (isSpawning == 1.0) {
    // Better Approach to avoid If statement
    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;
    originalPosition = mix(originalPosition, newPosition, isSpawning);
    position = mix(position, originalPosition, isSpawning);;
    timeStart = mix(timeStart, uTime, isSpawning);

    // Calculate timeLeft for life normalization
    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);
    float life_Normalize = timeLeft / lifeTime;

    // Use isActive to blend between the calculated color and black
    vec4 activeColor = vec4(position, life_Normalize);
    // if (isActive == 1.0) {
    gl_FragColor = mix(vec4(0.0), activeColor, isActive);

}
`,eke=`

    vec3 mod289(vec3 x) {
      return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 mod289(vec4 x) {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 permute(vec4 x) {
        return mod289(((x*34.0)+1.0)*x);
    }
    
    vec4 taylorInvSqrt(vec4 r)
    {
    return 1.79284291400159 - 0.85373472095314 * r;
    }
    
    vec3 fade(vec3 t) {
  return t*t*t*(t*(t*6.0-15.0)+10.0);
}

    float snoise(vec3 v)
    {
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );
    vec3 x1 = x0 - i1 + C.xxx;
    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y
    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y
    
    // Permutations
    i = mod289(i);
    vec4 p = permute( permute( permute(
                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
    
    // Gradients: 7x7 points over a square, mapped onto an octahedron.
    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)
    float n_ = 0.142857142857; // 1.0/7.0
    vec3  ns = n_ * D.wyz - D.xzx;
    
    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)
    
    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
    
    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);
    
    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );
    
    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));
    
    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
    
    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);
    
    //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;
    
    // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
    }
    
    vec3 snoiseVec3( vec3 x ){
    
      float s  = snoise(vec3( x ));
      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));
      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));
      vec3 c = vec3( s , s1 , s2 );
      return c;
    
    }
    
      
    vec3 curlNoise( vec3 p, float seed){
      p += seed;
      const float e = .1;
      vec3 dx = vec3( e   , 0.0 , 0.0 );
      vec3 dy = vec3( 0.0 , e   , 0.0 );
      vec3 dz = vec3( 0.0 , 0.0 , e   );
    
      vec3 p_x0 = snoiseVec3( p - dx );
      vec3 p_x1 = snoiseVec3( p + dx );
      vec3 p_y0 = snoiseVec3( p - dy );
      vec3 p_y1 = snoiseVec3( p + dy );
      vec3 p_z0 = snoiseVec3( p - dz );
      vec3 p_z1 = snoiseVec3( p + dz );
    
      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;
      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;
      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;
    
      const float divisor = 1.0 / ( 2.0 * e );
      return normalize( vec3( x , y , z ) * divisor );
    
    }


// Classic Perlin noise
float cnoise(vec3 P)
{
  vec3 Pi0 = floor(P); // Integer part for indexing
  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P); // Fractional part for interpolation
  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);

  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
  return 2.2 * n_xyz;
}


vec3 fbm_vec3(vec3 p, float frequency, float offset)
{
  return vec3(
    cnoise((p+vec3(offset))*frequency),
    cnoise((p+vec3(offset+20.0))*frequency),
    cnoise((p+vec3(offset-30.0))*frequency)
  );
}

`,tke=`
  #ifdef USE_COLLIDER
    float restitution = max(uBounce * 2., .01); // Energy Loss
    // SPHERE COLLIDER
    // **************************************************************
    #ifdef USE_SPHERE_COLLIDER       
      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
      vec3 radii = uColliderSize;
      // Adjust position relative to collider
      vec3 relPos = position - uColliderPos;
      // Apply rotation of the collider to the relative position
      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
      // Scale relative position by radii (for ellipsoid collision detection)
      vec3 scaledPos = relPos / radii;
      // Calculate ellipsoidal distance
      float dist = length(scaledPos); // Distance in terms of ellipsoid
      
      // Check for collision
      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {
          // Compute the normal at the collision point, accounting for particle size
        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          
        // Compute the normal at the collision point
        vec3 normal = ellipsoidNormal(adjustedPos, radii);
        // Rotate the normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);
        // Reflect the velocity vector off the normal
        velocity = reflect(velocity, normal) * restitution;

        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif

    // BOX COLLIDER or PLANE COLLIDER 
    // **************************************************************
    #ifdef USE_BOX_COLLIDER
      // Box dimensions and repulsion variables
      vec3 boxHalfSize = uColliderSize / 2.0;
      // Convert world position to box's local space
      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
      // Collision detection
      vec3 localDistance = abs(localPos) - boxHalfSize;
      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    

      // Collision Detected
      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      
        // Find the nearest face normal for bounce direction
        vec3 normal;
        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {
            normal = vec3(sign(localPos.x), 0.0, 0.0);
        } else if (localDistance.y > localDistance.z) {
            normal = vec3(0.0, sign(localPos.y), 0.0);
        } else {
            normal = vec3(0.0, 0.0, sign(localPos.z));
        }            
        // Rotate normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);      
        // Reflect velocity and apply repulsion force
        velocity = reflect(velocity, normal) * restitution;
        
        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif      
  #endif      
  // END COLLIDER    
`,ike=`
  #ifdef USE_ATTRACTOR

      #ifdef USE_SPHERE_COLLIDER      
        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
        vec3 radii = uColliderSize;
        // Adjust position relative to collider
        vec3 relPos = position - uColliderPos;
        // Apply rotation of the collider to the relative position
        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
        // Scale relative position by radii (for ellipsoid collision detection)
        vec3 scaledPos = relPos / radii;
        // Calculate ellipsoidal distance
        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid
        float insideCheck = 1.0;

      #endif


      #ifdef USE_BOX_COLLIDER
        // Box dimensions
        vec3 boxHalfSize = uColliderSize / 2.0;
        // Convert world position to box's local space
        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
        vec3 localDistance = abs(localPos) - boxHalfSize;
        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));
        float insideCheck = particleSize;
      #endif      
  
      // Apply vortex force inside the Helper
      #ifdef USE_FORCE_LOCAL_SPACE
        if (distToSurface <= insideCheck ) {    
            // Define parameters for the attractor field
            #ifdef USE_SPHERE_COLLIDER      
              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed
            #endif

            #ifdef USE_BOX_COLLIDER
              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed
              #endif

            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)
          
            // Use the same radii calculation code as for the collider
            vec3 attractorRadii = uColliderSize;
            // Adjust position relative to attractor center
            vec3 relPos = position - uColliderPos;
            // Apply rotation of the collider to the relative position
            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
            // Scale relative position by radii (for ellipsoid attraction)
            vec3 scaledPos = relPos / attractorRadii;

            // Calculate ellipsoidal distance as attractor radius
            float attractorRadius = length(scaledPos);
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * attractorStrength;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= attractorDamping;
        }
      #else 
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= uForceDamping;
      #endif    
  #endif      
`,rke=`
  #ifdef USE_VORTEX
    // Box dimensions
    vec3 boxHalfSize = uColliderSize / 2.0;
    // Convert world position to box's local space
    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
    vec3 localDistance = abs(localPos) - boxHalfSize;
    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));

    // Apply vortex force inside the box
    if (distToSurface <= particleSize) {
      float vortexStrength = uForceIntensity;
      vec3 localTopCenter = vec3(0.0, 0., 0.0);

      // Transform the local top center to the world space
      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);
      // Calculate the vector from particle to vortex center
      vec3 vortexVector = vortexCenter - position;

      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector
      // Note: important to add a tiny z component to the up vector to avoid instability
      vec3 upVector = vec3(0.0, 1.0, 0.01);
      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));
      rotationAxis = normalize(rotationAxis);

      // Add rotational component to velocity
      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; 

      vec3 rotationVelocity = rotationAxis * rotationSpeed;
      // velocity += rotationVelocity * 0.005 ;
      velocity = rotationVelocity * 0.005 ;

      // Calculate vortex force
      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;
      // Apply the vortex force to the particle
      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);
      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);
    }
  #endif      
`,nke=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform sampler2D uDirections;     
uniform vec3 uDirectionsAxis;
uniform vec4 uWorldQuaternion;
uniform vec3 uGravity;        
uniform float uNoiseStrength;     // Variation of the noise
uniform float uNoiseScale;        // Scale of the noise
uniform float uNoiseSeed;         // Seed of the noise
uniform float particleSize;
uniform float uSpeed;     // update speed of the particles
uniform float uRandomMassFactor;

// COLLIDER
uniform vec3 uColliderPos;                // Collider Position
uniform vec3 uColliderSize;               // Collider Dimension
uniform vec4 uColliderQuaternion;         // Collider Rotation
uniform vec4 uColliderQuaternionInvert;   // Collider Rotation
uniform float uBounce;                    // Bounce factor
uniform float uForceDamping;
uniform float uForceIntensity;


`+eke+`
float rand(vec2 co){
    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
 } 
vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
  
  return acceleration;
}

vec4 conjugate(vec4 q) {
  return vec4(q.w, -q.x, -q.y, -q.z);
}

// Function to compute the normal of the ellipsoid at a given point
vec3 ellipsoidNormal(vec3 p, vec3 radii) {
  return normalize(p / (radii * radii));
}

float friction = .3;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    vec3 directions = texture2D( uDirections, vUv ).xyz;    
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float mass = rand(originalPosition.xy) * 0.5 + 0.5;
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active
    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision

    // Randomness Mass
    mass = (1.0 - (uRandomMassFactor * mass));
    
    if (isActive == 1.0) {
      // **************************************************************
      // FORCES NOISES
      // **************************************************************
      #ifdef USE_CURL_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {
          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;
        }
      #endif
      // **************************************************************
      #ifdef USE_SIMPLEX_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {
          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);
        }
      #endif
      // ************************************************************** 
      #ifdef USE_FBM_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      
          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;
        }
      #endif

      // COLLIDER
      ${tke}
      // ATTRACTION
      ${ike}  
      // VORTEX
      ${rke}
    } 
    // End isActive

    // SPAWN BIRTH 
    // **************************************************************
    // if (isSpawning == 1.)
    #ifdef USE_NORMALS
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);
    #else
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    
    #endif
    
    // if (collisionFlag == 0.0)
    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);

    gl_FragColor = vec4(velocity, collisionFlag);
}
`,Wte=`

  // Linear Fade In
  float linearFadeIn(float t) {
    return t;
  }


  // linear fade out
  float linearFadeOut(float t) {
    return 1.0 - t;
  }
  
  float linearInOut(float t) {
    return t < 0.5 ? t :  (1.0 - t);  
  }

    // lerp
    float lerp(float a, float b, float t) {
      return a + (b - a) * t;
    }

  // Ease In Out Quart
  float exponentialInOut(float t) {
    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :
    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :
    1.0;
   }

  // constant
  float constant(float t) {
    return 1.0;
  } 
`,ske=`

float rand(vec3 co){
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

vec3 applyQuaternionToVector( vec4 q, vec3 v ){
  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
    
  return acceleration;
}
`,oke=`
vec3 rgb2xyz (in vec3 rgb) {
    float r = rgb.r;
	float g = rgb.g;
	float b = rgb.b;

	r = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);
	g = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);
	b = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);

	float x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);
	float y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);
	float z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);
    
    vec3 xyz = vec3(
        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,
        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,
        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0
    );
    return(xyz);
}

vec3 xyz2lab (in vec3 xyz) {
	float x = xyz.x / 95.047;
	float y = xyz.y / 100.0;
	float z = xyz.z / 108.883;

	x = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);
	y = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);
	z = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);

    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));
    return(lab);
}

vec3 rgb2lab(in vec3 rgb) {
    vec3 xyz = rgb2xyz(rgb);
    vec3 lab = xyz2lab(xyz);
    return(lab);
}

vec3 xyz2rgb (in vec3 xyz) {
	float x = xyz.x / 100.0;
	float y = xyz.y / 100.0;
	float z = xyz.z / 100.0;
	
    
	float r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);
	float g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);
	float b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);

	r = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;
	g = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;
	b = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;

	r = min(max(0.0, r), 1.0);
	g = min(max(0.0, g), 1.0);
	b = min(max(0.0, b), 1.0);

	return(vec3(r, g, b));
}

vec3 lab2xyz (in vec3 lab) {
    float l = lab.x;
	float a = lab.y;
	float b = lab.z;

  	float y = (l + 16.0) / 116.0;
	float x = a / 500.0 + y;
	float z = y - b / 200.0;

	float y2 = pow(y, 3.0);
	float x2 = pow(x, 3.0);
	float z2 = pow(z, 3.0);

  	y = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;
	x = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;
	z = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;

	x *= 95.047;
	y *= 100.0;
	z *= 108.883;

	return(vec3(x, y, z));
}
vec3 lab2rgb (in vec3 lab) {
    vec3 xyz = lab2xyz(lab);
    vec3 rgb = xyz2rgb(xyz);
    return(rgb);
}

`,ake=`
  uniform sampler2D uPosition;
  uniform float uSize;
  uniform float uSizeEnd;
  uniform vec3 uWorldOffset;
  uniform vec4 uWorldQuaternion;
  // Billboard Behavior - Currently at Zero, but we can change that
  uniform float uRotation;
  uniform float uRotationEnd;
  uniform vec2 center;

  // Randomness
  uniform float uRandScaleFactor;
  uniform float uRandRotationFactor;

  attribute vec2 ref;

  varying float v_LifeLeft;    // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  ${ske}
  ${Wte}
`,lke=({easeSize:e="linearFadeOut"})=>`
  vUv = uv;  
  vRef = ref;
  // Normalized LifeTime 1 to 0
  float lifeLeft = texture2D(uPosition, ref).w;
  v_LifeLeft = lifeLeft;
  // Position From DataTexture Simulation
  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;
  // Apply World Quaternion
  pos = applyQuaternionToVector(uWorldQuaternion, pos);  
            
  #ifdef  USE_SIZE_END
    // Scaled Over Time
    float t = 1. - lifeLeft;
    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd
    vec3 scaledPosition = position * vec3(currentSize);
  #else
    // Change Size Behavior over LifeTime
    float easeSize = ${e}(1. - lifeLeft);
    // Scaled Over Time
    vec3 scaledPosition = position * vec3(uSize * easeSize);
  #endif

  // Billboard Behavior
  vec2 scale;
  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    
  // Randomness 
  float randRef = rand(ref);
  scale *= (1.0 - (uRandScaleFactor * randRef));
  // Rotation
  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);
  float originalRotation = (1.0 - uRotation) * 2.0 * PI;
  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;
  // OverTime
  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);

  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;
  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;
  
  mat4 instanceMatrix = mat4(
    vec4(1.0, 0.0, 0.0, 0.0),
    vec4(0.0, 1.0, 0.0, 0.0),
    vec4(0.0, 0.0, 1.0, 0.0),
    vec4(pos.x, pos.y, pos.z, 1.0)
  );  

  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  mvPosition.xy += rotatedPosition;
  gl_Position = projectionMatrix  * mvPosition;   
`,cke=`
  uniform vec4 uColor;                // start color
  uniform vec4 uColor2;               // end color
  uniform sampler2D uTexture;         // texture
  varying float v_LifeLeft;   // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  float random(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
  }
  `+Wte+`  
  ${oke}

`,uke=({easeOpacity:e="linearFadeOut"})=>`  
  // if Particle is dead, hide it
  if (v_LifeLeft <= 0.005 ) {
    discard;
  }

  #ifdef USE_RANDOM_COLORING
    float randVal = random(vRef); // Generate a random value based on the reference
    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors
  #else
    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);
  #endif

  // Opacity over Life Time
  float finalAlpha = ${e}(1. - v_LifeLeft);  
  vec4 textureColor = texture2D(uTexture, vUv).rgba; 
  finalColor = textureColor.rgb * color.rgb;
  finalAlpha = color.a * textureColor.a * finalAlpha;
  
  gl_FragColor = vec4(finalColor, finalAlpha);     

`,hke=class extends Qn{constructor(e,t){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(e,t),this.context=t}reset(){}init(e,t){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=e.ease,this.easeSize=e.easeSize,this.layers=[],Xo.startContext(Xo.globalContext),this.lightLayer=new Vh(0,"",pt(me({},ca.defaultData("light","phong")),{visible:!1}),new gU,{},t.shared),Xo.endContext(Xo.globalContext),this.build()}updateState(e){e.coloring!==void 0&&(this.isColoringRandom=e.coloring==="random"),e.color!==void 0&&(e.color instanceof Array?this.uniforms.uColor.value=e.color:this.uniforms.uColor.value=this.context.shared.color(e.color)),e.color2!==void 0&&(e.color2 instanceof Array?this.uniforms.uColor2.value=e.color2:this.uniforms.uColor2.value=this.context.shared.color(e.color2)),e.size!==void 0&&(this.uniforms.uSize.value=e.size[0],this.uniforms.uSizeEnd.value=e.size[1],e.size[0]!==e.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),e.ease!==void 0&&(this.easeOpacity=e.ease,this.build()),e.easeSize!==void 0&&(this.easeSize=e.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader}build(){let e=new jee;return e.needsJitter=this.needsJitter,e.addFragmentParsCode(qRe),e.buildShader("vertex",this.fragment),e.buildShader("fragment",this.fragment),e.addFragmentFinalCode(YRe),this.isColoringRandom&&e.define("USE_RANDOM_COLORING"),this.useSizeEnd&&e.define("USE_SIZE_END"),e.addVertexParsCode(ake),e.addFragmentParsCode(cke),e.addVertexFinalCode(lke({easeSize:this.easeSize})),e.addFragmentFinalCode(uke({easeOpacity:this.easeOpacity})),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=me(me({},e.uniforms),this.uniforms),this.extensions=e.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose()}},Nk=class{constructor(e,t,i,r){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=e,this.type=i,this.textureSize=$Fe(t);let s=1;this.targetMesh=r?.type==="Mesh"&&r?r:this.getMesh(i,s);let{positions:n,dataTexture:c,dataTextureNormals:u}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(i,s));this.positionsTexture=c,this.positionsAttribute=n,this.directionsTexture=u}createPositions(e,t){let{positions:i,normals:r}=ZFe(t,e*e),s=zZ(i,e),n=zZ(r,e);return{dataTexture:s,positions:i,dataTextureNormals:n}}getMesh(e,t){let i=null;switch(e){case"SphereEmitterShape":{i=new $_(t*.5,32,32);break}case"TorusEmitterShape":{i=new SK(t*.5,.3,15,40);break}case"ConeEmitterShape":{i=new w4(t,t,15);break}case"BoxEmitterShape":{i=new $u(t,t,t);break}case"PlaneEmitterShape":{i=new Ep(t,t),i.rotateX(-Math.PI/2);break}case"MeshEmitterShape":{i=new $_(t,32,32);break}default:{i=new $_(t,32,32);break}}return new $s(i,new Sp({color:16711680}))}applyToShader(e,t){this.size=new se().fromArray(t.size),e.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function U_(e){let t=me({},e),i=VD.defaultData;t.forceFieldObjectId&&(t.colliderEntityId=t.forceFieldObjectId);let r=me(me({},i.shape),t.shape),s=me(me({},i.renderMaterial),t.renderMaterial);return pt(me(me({},i),t),{shape:r,renderMaterial:s})}var dke=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU

uniform sampler2D uIndex; // Texture with corresponding index
uniform float uLastIndexEmitted; // Last emitted index
uniform float uParticlesToEmit; // Number of particles to emit on that frame
uniform float uTime;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    float particleIndex = texture(uIndex, vUv).x;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;


    // ********** Detect Colision to Create a flag and use it in position **********
    // We are doing this here, so

    // ********** Emit Particles **********
    // X = isSpawning 0.0 or 1.0
    // Y = isActive 0.0 or 1.0
    // Check if the vertex index is between the first value and the last value
    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {
    //     // Emit a particle by writing 1 to the red channel of the color output
    //     // r: 1. == emit the particle
    //     // g: 1. == particle is now active
    //     timeStart = uTime;
    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);
    // } else {
    //     // The Particle is either already emitted or not in the range of the particles to emit
    //     // Do not emit a particle by writing 0 to the red channel of the color output        
    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);
    // }
    // Determine if the particle is within the emission range
    float emitLowerBound = step(uLastIndexEmitted, particleIndex);
    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);
    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise

    // Set timeStart and color
    timeStart = mix(timeStart, uTime, emitParticle);
    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);


}
`,Bk=10,pke=class extends ls{constructor(e,t){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new P1e,this.currentWorldPosition=new se,this.systemQuaternion=new Vr,this.worldGravity=new se(0,0,0),this.directionAxis=new se(0,0,0),this.colliderV3=new se(0,0,0),this.colliderQuaternion=new Vr(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=e,this.system=t,this.shared=t.context.shared;let i=t.data;this.material=new hke(i.renderMaterial,t.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:i.renderMaterial.color},uColor2:{value:i.renderMaterial.color2},uPosition:{value:new se(0,0,0)},uEmissionData:{value:new se(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new se(0,0,0)},uWorldQuaternion:{value:new Gr(0,0,0,1)},uRandScaleFactor:{value:i.randomScale??0},uRandRotationFactor:{value:i.randomRotation??0},uRotation:{value:i.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:i.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,i.renderMaterial.texture),this.init(i)}setTexture(e,t){let i=t.data;if(typeof t=="string"){let r=this.shared.image(t),s=new Zs(r.img);s.needsUpdate=!0,e.uTexture.value=s;return}if(typeof i!="string"){let r=new Image;r.onload=()=>{let c=new Zs(r);c.needsUpdate=!0,e.uTexture.value=c};let s=new Blob([i],{type:"image/*"}),n=URL.createObjectURL(s);r.src=n}}updateGeometryAttributes(e,t){let i=XFe(t);!this.emitterShape?.positionsAttribute||e.geometry.setAttribute("ref",new _S(i,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let e=this.system;e.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),e.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(e,t){if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset){this.reset();return}this.applyWorldSpace(),this.globalTime=e,this.positionSimRT.material.uniforms.uTime.value=e,this.emissionRateSimRT.material.uniforms.uTime.value=e;let i=1e3/t,r=this.targetFPS/i,s=this.previousRatio+(r-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=s,this.previousRatio=s;let n=this.isEmitting?this.GoEmitSomeParticles(e,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=n,this.material.uniforms.uPosition.value=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT)?.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let e=this.system.colliderEntities[0],t=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(e.destroyedInAction&&t&&this.init(U_(pt(me({},this.system.data),{colliderEntityId:null}))),!e||e.destroyedInAction)return;e.getWorldPosition(this.colliderV3),this.colliderV3.y===0&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let i=e.data.size;this.colliderV3.fromArray(i),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),e.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(e){!this.velocitySimRT||!this.positionSimRT||(e.renderMaterial&&this.updateMaterialState(e.renderMaterial),this.updateParticleState(e))}updateVariableState(e,t){if(!this.velocitySimRT||!this.positionSimRT)return;t[2]==="size"&&this.material.updateState({size:[e,this.material.uniforms.uSizeEnd.value]}),t[2]==="sizeEnd"&&this.material.updateState({size:[this.material.uniforms.uSize.value,e]});let i=(r,s)=>{let n=[...this.system.data.shape.size];n[r]=s,this.updateParticleState({shape:pt(me({},this.system.data.shape),{size:n})})};t[2]==="shape_size_0"&&i(0,e),t[2]==="shape_size_1"&&i(1,e),t[2]==="shape_size_2"&&i(2,e),t[2]==="speed"&&(this.velocitySimRT.material.uniforms.uSpeed.value=e/Bk),t[2]==="gravity"&&this.worldGravity.set(0,e/100,0),t[2]==="noiseStrength"&&(this.noiseStrength=e,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),t[2]==="noiseScale"&&(this.noiseScale=e,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),t[2]==="direction_x"&&(this.directionAxis=this.getDirectionAxis([Number(e),this.system.data.direction[1],this.system.data.direction[2]])),t[2]==="direction_y"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(e),this.system.data.direction[2]])),t[2]==="direction_z"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(e)]))}updateMaterialState(e){this.material.updateState(pt(me({},e),{size:e.size?[Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]})),e.texture&&(this.setTexture(this.material.uniforms,e.texture),this.material.needsUpdate=!0)}updateParticleState(e){if(!(!this.positionSimRT||!this.velocitySimRT)){if(this.shouldReInitGPUCompute(e)&&this.init(U_(this.system.data)),e.life!==void 0&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=e.life),e.speed!==void 0&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/Bk),e.collisionBounce!==void 0&&(this.velocitySimRT.material.uniforms.uBounce.value=e.collisionBounce),e.noiseStrength!==void 0&&(this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),e.noiseScale!==void 0&&(this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),e.noiseSeed!==void 0&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=e.noiseSeed),e.randomMass!==void 0&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=e.randomMass),e.renderMaterial?.size!==void 0){let t=this.shared.getVariable(e.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(t)}if(e.renderMaterial?.spriteRotation!==void 0&&(this.material.uniforms.uRotation.value=e.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=e.renderMaterial.spriteRotation[1]),e.shape!==void 0){let t=e.shape.size??this.system.data.shape.size,i=[Number(this.shared.getVariable(t[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t[2],[this.uuid,"particles","shape_size_2"]))],r=pt(me({},U_(this.system.data).shape),{size:i});this.emitterShape?.applyToShader(this.positionSimRT.material.uniforms,r)}if(e.gravity!==void 0&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),e.direction!==void 0){let t=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(t),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}e.randomRotation!==void 0&&(this.material.uniforms.uRandRotationFactor.value=e.randomRotation),e.randomScale!==void 0&&(this.material.uniforms.uRandScaleFactor.value=e.randomScale)}}updateForceFieldParameters(e){!this.velocitySimRT||(e.forceIntensity!==void 0&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=e.forceIntensity),e.forceDambing!==void 0&&(this.velocitySimRT.material.uniforms.uForceDamping.value=e.forceDambing))}getDirectionAxis(e){let t=[Number(e[0])*Yi.DEG2RAD,Number(e[1])*Yi.DEG2RAD,Number(e[2])*Yi.DEG2RAD],i=new $o(t[0],t[1],t[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(e){let{birthRatePerSec:t,rootObjectType:i,colliderEntityId:r,shape:s,emitTimeDuration:n,emitTimeCycle:c,life:u,directionMode:p,noiseType:f}=e;return t!==void 0||i!==void 0||r||r===null||c!==void 0||s!==void 0||u!==void 0||n!==void 0||p!==void 0||f!==void 0}init(e){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:e.birthRatePerSec,particleMaxLifeTime:e.life,loopDuration:e.emitTimeCycle==="infinity"?0:e.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(e.shape,this.particlesAmount);let t=setInterval(()=>{if(this.emitterShape)if(isNaN(this.emitterShape.positionsTexture.source.data.data[0])){this.init(e);return}else clearInterval(t)},100);if(!this.emitterShape)return;let i=new qFe(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),r=this.updateSimulationDefinition(e),s=i.addVariable("uCurrentPosition",r+JFe,this.emitterShape.positionsTexture),n=i.addVariable("uCurrentVelocity",r+nke,this.emitterShape.directionsTexture),c=i.addVariable("uCurrentEmissionRate",dke,KFe(this.emitterShape.textureSize));i.setVariableDependencies(s,[s,n,c]),i.setVariableDependencies(n,[s,n,c]),i.setVariableDependencies(c,[s,n,c]);let u=QFe({size:this.emitterShape.textureSize}),p={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new se(0,0,0)},uWorldQuaternion:{value:new Gr(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:e.life},uEmitterSize:{value:new se(Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};s.material.uniforms=p;let f=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(f),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"]));let x=e.colliderEntityId&&this.system.getColliderData(e.colliderEntityId),w={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new Gr(0,0,0,1)},uColliderPos:{value:new se(0,0,0)},uColliderSize:{value:new se(0,0,0)},uForceIntensity:{value:x?x.forceIntensity:0},uForceDamping:{value:x?x.forceDambing:0},uColliderQuaternion:{value:new Gr(0,0,0,1)},uColliderQuaternionInvert:{value:new Gr(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:e.noiseSeed},uRandomMassFactor:{value:e.randomMass},uBounce:{value:e.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/Bk}};n.material.uniforms=w;let E={uIndex:{value:u},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};c.material.uniforms=E;let A=[Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"]))],I=pt(me({},U_(this.system.data).shape),{size:A});this.emitterShape.applyToShader(s.material.uniforms,I),i.init(),this.gpuCompute=i,this.positionSimRT=s,this.velocitySimRT=n,this.emissionRateSimRT=c,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(e){let t=Number(this.shared.getVariable(e[0],[this.uuid,"particles","direction_x"])),i=Number(this.shared.getVariable(e[1],[this.uuid,"particles","direction_y"])),r=Number(this.shared.getVariable(e[2],[this.uuid,"particles","direction_z"]));return[t,i,r]}updateSimulationDefinition(e){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,e.colliderEntityId&&this.system.colliderEntities.length>0){let i=this.system.getColliderData(e.colliderEntityId);switch(i?.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0;break}let r=i?.colliderType;r==="sphere"&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),r==="box"&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),i?.forceRange==="helper"&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}e.directionMode==="normals"&&(this.simFeaturesDefinition.USE_NORMALS=!0),e.noiseType==="curl"&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),e.noiseType==="simplex"&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),e.noiseType==="fbm"&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let t="";for(let[i,r]of Object.entries(this.simFeaturesDefinition))r&&(t+=`#define ${i}
`);return t}createShape(e,t){this.emitterShape&&this.emitterShape.dispose();let i=new se(Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.size[2],[this.uuid,"particles","shape_size_2"])));if(e.type==="MeshEmitterShape"){let r=null;return this.system.context.scene.traverseEntity(s=>{s.uuid===e.fromMeshId&&(r=s)}),r?new Nk(i,t,e.type,r):new Nk(i,t,"SphereEmitterShape")}else return new Nk(i,t,e.type)}createPrimaryEmitter(e){let t,i=e*e;return t=new Wxe(new Ep(1,1,1),this.material,i),this.updateGeometryAttributes(t,e),this.material.needsUpdate=!0,t.onBeforeRender=()=>{this.applyWorldSpace()},t}getMaxParticlesAmount({birthRatePerSecond:e,particleMaxLifeTime:t,loopDuration:i=0}){return Math.ceil(e*(t+i))}dispose(){!this.gpuCompute||(this.rootObject?.parent?.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),this.emitterShape?.dispose())}GoEmitSomeParticles(e,t){let i=e-this.lastEmitTime,r=1/t;if(i>=r){let s=Math.max(1,Math.floor(i/r));return this.lastEmitTime=e,this.emittedParticlesAmount+s>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=s,s}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(U_(this.system.data))}startEmitting(e){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=e}stopEmitting(){this.isEmitting=!1}},lD=class extends wl{constructor(e,t,i){super(e,t),this.type="ParticleSystem",this.geometry=new fr,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.timeoutId=void 0,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=r=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(r))},this.context=i,this.data=me(me({},t),U_(t)),this.geometry.setAttribute("position",new Vi([],3)),this.material=new Sp({colorWrite:!1}),this.frustumCulled=!1}init(e){this.renderer=e,this.emitter=new pke(e,this),this.add(this.emitter),this.updateParticleState(this.data)}update(e){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=e,this.stopped||(this.currentLoopTime+=e);let t=this.data.emitTimeCycle==="one_time";if((this.data.emitTimeCycle==="loop"||t)&&this.currentLoopTime>this.data.emitTimeDuration*1e3&&(this.stopped||(this.stop(),t||this.start(this.data.emitTimeDelay*1e3))),this.emitter&&this.started){let i=this.actualTime/1e3;this.emitter.update(i,e)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(e){return this.colliderEntities.some(t=>t.identity===e)}getColliderData(e){let t=this.colliderEntities.find(i=>i.identity===e);return t?t.data:null}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),ws(e.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:me(me({},this.data.renderMaterial),pa.drop(e,1).props)}),ws(e.path,["shape"])&&this.updateParticleState({shape:me(me({},this.data.shape),pa.drop(e,1).props)})}updateState(e,t){super.updateState(e,t),this.updateParticleState(e)}updateParticleState(e){if(this.emitter){if(e.colliderEntityId!==void 0&&e.colliderEntityId!==null){let t=this.context.scene.find(e.colliderEntityId);this.colliderEntities=t?[t]:[]}e.colliderEntityId===null&&(this.colliderEntities=[]),this.emitter.updateState(e),e.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(e){!this.emitter||(this.emitter.updateForceFieldParameters(e),this.stop(),this.start())}start(e=0){if(this.currentLoopTime=0,e){this.timeoutId=window.setTimeout(()=>{this.start(0)},e);return}this.started=!0,this.stopped=!1,this.isFrozen=!1,this.emitter?.startEmitting(this.actualTime/1e3)}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){this.stopped=!0,this.currentLoopTime=0,this.emitter?.stopEmitting(),clearTimeout(this.timeoutId)}reset(){this.started=!1,this.stopped=!1,this.emitter?.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};function fke(){try{let e=window.location.href;if(e.includes("reducesubdiv=")){let t=e.indexOf("reducesubdiv=")+13;return parseInt(e.slice(t,t+1))}}catch{}}var Uk=fke();function mke(e,t,i){Uk!==void 0&&(t?.geometry?.subdivisions??0)>Uk&&(console.log("reducing subdivisions",t.name,t.geometry.subdivisions),t.geometry.subdivisions=Uk);let r;return t.geometry.type==="TextGeometry"?new wU(e,t,i):t.geometry.type==="InputGeometry"?new IU(e,t,i):(t.geometry.type==="SubdivGeometry"?r=new NS(e,t,i):t.geometry.type==="PathGeometry"?r=new DU(e,t,i):t.geometry.type==="VectorGeometry"?r=new HFe(e,t,i):t.geometry.type==="BooleanGeometry"?r=new Gy(e,t,i):t.geometry.type==="UIGeometry"?r=new Ha(e,t,i):r=new Ya(e,t,i),r)}function RU(e,t,i){return console.assert(t.type!==void 0),t.type==="Mesh"?mke(e,t,i):t.type==="Empty"?new nx(e,t):t.type==="Particle"?new lD(e,t,i):t.type==="ParticleCollider"?new oD(e,t,i):t.type==="Splat"?new nx(e,t):t.type==="Bone"?new WFe(e,t):t.type==="Page"?new ua(e,t,i):t.type==="PointLight"?new GFe(e,t,i):t.type==="SpotLight"?new Lte(e,t,i):t.type==="DirectionalLight"?new Ote(e,t,i):t.type==="Component"||t.type==="Instance"?new sx(e,t,i):jy.is(t.type)?new Xa(e,t):(console.error(t),new nx(e,t))}cm.createEntity=RU;function gke(e,t,i){let r=RU(e.identity,t,i),s=e.children,n=e.attachedPaths,c=e.parent,u=e.component,p=e.instances,f=e.overrideData,x=e.uuid,w=e.stateSelection;e.dispose();for(let E of Object.keys(e))delete e[E];Object.setPrototypeOf(e,Object.getPrototypeOf(r));for(let E of Object.keys(r))e[E]=r[E];e.children=[...e.children,...s],e.attachedPaths=n,e.parent=c,e.component=u,e.instances=p,e.uuid=x,e.overrideData=f,e.updateState(e.data,i),w&&e.changeSelectedState(w,i),e.resetBBoxNeedsUpdate()}cm.changeEntityProptotype=gke;cm.Cloner=Hu;function yke(e,t,i,r){e.updateByOp(t,i,r,!1)}function FZ(e,t){let i=!1,r=t.getLayersOfType("transmission"),s=t.getLayersOfType("outline");return s.length>0&&(e.layers.set(8),r.length>0&&e.layers.enable(3),i=!0,bU(e),xU(e)),r.length===0&&s.length===0&&e.layers.set(0),e instanceof kx&&e.needsAO&&e.layers.enable(5),i}function kZ(e,t){if(!t.layers)return!1;let i=!1,r=t.getLayersOfType("transmission").filter(n=>n.data.visible),s=t.getLayersOfType("outline").filter(n=>n.data.visible);return r.length>0&&(e.layers.set(3),s.length>0&&e.layers.enable(8),i=!0),r.length===0&&s.length===0&&e.layers.set(0),e.needsAO&&e.layers.enable(5),i}function vke(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof kx)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)FZ(i,i.material[r])&&(t=!0);else FZ(i,i.material)&&(t=!0)}),t}function _ke(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof kx)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)kZ(i,i.material[r])&&(t=!0);else kZ(i,i.material)&&(t=!0)}),t}var xke=new RK,bke=new mi,wke=new Sx;function QB(e,t,i,r=!1){let s=e.cloner;if(s)for(let n of s.children){let c=bke.copy(n.matrixWorld).invert(),u=wke.copy(t.ray).applyMatrix4(c),p=e.matrixWorld;u.applyMatrix4(p);let f=xke;f.set(u.origin,u.direction),f.near=t.near,f.far=t.far;let x=f.intersectObject(e,!1);x.length>0&&i.push(pt(me({},x[0]),{object:r?n:e}))}}var Ske=class{constructor(){this._constraints=new Map}setConstraint(e,t){t===null?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach((i,r)=>{let s=[r,i],n=i;for(;this._constraints.has(n);){if(n=this._constraints.get(n),s.includes(n)){console.warn(`circular dependency detected: ${s.join(" -> ")}`);break}t.has(n)||s.push(n)}for(let c=s.length-2;c>=0;c--)if(!t.has(s[c])){let u=e.find(s[c]);u?u.applyPathSnapping(e):console.warn(`missing entity ${s[c]}`),t.add(s[c])}})}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},Eke="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL",hm=class{};Xw(hm,"DepthMapRange",65536),Xw(hm,"MemoryPageSize",65536),Xw(hm,"BytesPerFloat",4),Xw(hm,"BytesPerInt",4);function Mke(e){let t,i,r,s,n,c,u,p,f,x,w,E,A,I,P,O;function k(le){let ve=new Float64Array(x,c,16);for(let fe=0;fe<16;fe++)ve[fe]=le[fe];let we;if(r>1){t.exports.sortIndexes(s,n,f,c,u,p,E.DepthMapRange,r);let fe=new Uint32Array(r);we=fe.buffer,fe.set(new Uint32Array(x,p,r))}else if(r===1){let fe=new Uint32Array(r);fe[0]=new Uint32Array(x,s,i)[0],we=fe.buffer}else we=new ArrayBuffer(0);e.postMessage({sortDone:!0,indexesBuffer:we},[we])}function U(le,ve,we){let fe=new Float32Array(x,n,i*3);r=0;let Ue=new Uint32Array(x,s,i);for(let Fe=0;Fe<we.length-1;Fe++){let Pe=ve[Fe],Ae=le[Fe].elements,et=Pe.filter(rt=>rt.enabled&&rt.mode==="Include").map(rt=>rt.type==="Box"?Y(rt):ee(rt)),$e=Pe.filter(rt=>rt.enabled&&rt.mode==="Exclude").map(rt=>rt.type==="Box"?Y(rt):ee(rt));for(let rt=we[Fe];rt<we[Fe+1];rt++){let Je=A[rt*3],bt=A[rt*3+1],ot=A[rt*3+2];if((et.length===0||V(Je,bt,ot,et))&&($e.length===0||!V(Je,bt,ot,$e))){let xt=1/(Ae[3]*Je+Ae[7]*bt+Ae[11]*ot+Ae[15]);fe[r*3]=(Ae[0]*Je+Ae[4]*bt+Ae[8]*ot+Ae[12])*xt,fe[r*3+1]=(Ae[1]*Je+Ae[5]*bt+Ae[9]*ot+Ae[13])*xt,fe[r*3+2]=(Ae[2]*Je+Ae[6]*bt+Ae[10]*ot+Ae[14])*xt,Ue[r]=rt,r++}}}}function j(le,ve){let we=[],fe=ve.filter(Pe=>Pe.enabled&&Pe.mode==="Include").map(Pe=>Pe.type==="Box"?Y(Pe):ee(Pe)),Ue=ve.filter(Pe=>Pe.enabled&&Pe.mode==="Exclude").map(Pe=>Pe.type==="Box"?Y(Pe):ee(Pe)),Fe=le.length;for(let Pe=0;Pe<Fe;Pe+=3){let Ae=le[Pe],et=le[Pe+1],$e=le[Pe+2];(fe.length===0||V(Ae,et,$e,fe))&&(Ue.length===0||!V(Ae,et,$e,Ue))||we.push(Pe/3)}return we}function V(le,ve,we,fe,Ue){return fe[Ue==="Intersect"?"every":"some"](Fe=>{let Pe=$(le,ve,we,Fe.invRotationMatrix,Fe.cropCenter);return Array.isArray(Fe)?X(Pe.x,Pe.y,Pe.z,Fe):oe(Pe.x,Pe.y,Pe.z,Fe)})}function $(le,ve,we,fe,Ue){let Fe=le-Ue[0],Pe=ve-Ue[1],Ae=we-Ue[2],et=1/(fe[3]*Fe+fe[7]*Pe+fe[11]*Ae+fe[15]);return{x:(fe[0]*Fe+fe[4]*Pe+fe[8]*Ae+fe[12])*et+Ue[0],y:(fe[1]*Fe+fe[5]*Pe+fe[9]*Ae+fe[13])*et+Ue[1],z:(fe[2]*Fe+fe[6]*Pe+fe[10]*Ae+fe[14])*et+Ue[2]}}function Y(le){let ve=le.cropSize[0]/2,we=le.cropSize[1]/2,fe=le.cropSize[2]/2,Ue=[le.cropCenter[0]-ve,le.cropCenter[1]-we,le.cropCenter[2]-fe,le.cropCenter[0]+ve,le.cropCenter[1]+we,le.cropCenter[2]+fe],Fe=J(le.cropRotation);return Object.assign(Ue,{invRotationMatrix:Fe,cropCenter:le.cropCenter})}function J(le){let ve=[],we=le[0]*Math.PI/180,fe=le[1]*Math.PI/180,Ue=le[2]*Math.PI/180,Fe=Math.cos(we),Pe=Math.sin(we),Ae=Math.cos(fe),et=Math.sin(fe),$e=Math.cos(Ue),rt=Math.sin(Ue),Je=Fe*$e,bt=Fe*rt,ot=Pe*$e,xt=Pe*rt;return ve[0]=Ae*$e,ve[1]=-Ae*rt,ve[2]=et,ve[4]=bt+ot*et,ve[5]=Je-xt*et,ve[6]=-Pe*Ae,ve[8]=xt-Je*et,ve[9]=ot+bt*et,ve[10]=Fe*Ae,ve[12]=0,ve[13]=0,ve[14]=0,ve[3]=0,ve[7]=0,ve[11]=0,ve[15]=1,ve}function X(le,ve,we,fe){return le>=fe[0]&&le<=fe[3]&&ve>=fe[1]&&ve<=fe[4]&&we>=fe[2]&&we<=fe[5]}function ee(le){let ve=2/le.cropSize[0],we=2/le.cropSize[1],fe=2/le.cropSize[2],Ue=J(le.cropRotation);return{invRadiusX:ve,invRadiusY:we,invRadiusZ:fe,cropCenter:le.cropCenter,invRotationMatrix:Ue}}function oe(le,ve,we,fe){let Ue=(le-fe.cropCenter[0])*fe.invRadiusX,Fe=(ve-fe.cropCenter[1])*fe.invRadiusY,Pe=(we-fe.cropCenter[2])*fe.invRadiusZ;return Ue*Ue+Fe*Fe+Pe*Pe<=1}e.onmessage=le=>{if(le.data.getCroppedIndexes){let ve=new Uint32Array(j(new Float32Array(le.data.positions),le.data.crops)).buffer;e.postMessage({outOfBoundsIndexes:ve},[ve])}else if(le.data.positions)w=le.data.positions,A=new Float32Array(w),P=le.data.meshMatrixWorlds,O=le.data.cropsArray,I=le.data.meshIndexIntervals,U(P,O,I),e.postMessage({sortSetupComplete:!0});else if(le.data.sort||le.data.newMatrixWorlds||le.data.newCropsArray)(le.data.newMatrixWorlds||le.data.newCropsArray)&&(O=le.data.newCropsArray||O,P=le.data.newMatrixWorlds||P,U(P,O,I)),k(le.data.sort.view,le.data.sort.cameraPosition);else if(le.data.init){E=le.data.init.Constants,i=le.data.init.splatCount;let ve=E.BytesPerInt,we=E.BytesPerFloat*3,fe=new Uint8Array(le.data.init.sorterWasmBytes),Ue=ve+we,Fe=i*Ue,Pe=i*E.BytesPerInt*2+E.DepthMapRange*E.BytesPerInt*2,Ae=E.MemoryPageSize*32,et=Fe+Pe+Ae,$e=Math.floor(et/E.MemoryPageSize)+1,rt={module:{},env:{memory:new WebAssembly.Memory({initial:$e*2,maximum:$e*3,shared:!0})}};WebAssembly.compile(fe).then(Je=>WebAssembly.instantiate(Je,rt)).then(Je=>{t=Je,s=0,n=i*ve,c=n+i*we,f=c+16*E.BytesPerFloat*2,u=f+i*E.BytesPerInt,p=u+E.DepthMapRange*E.BytesPerInt,x=rt.env.memory.buffer,e.postMessage({sortSetupPhase1Complete:!0})})}}}function Tke(e){let t=new Worker(URL.createObjectURL(new Blob(["(",Mke.toString(),")(self)"],{type:"application/javascript"}))),i=atob(Eke),r=new Uint8Array(i.length);for(let s=0;s<i.length;s++)r[s]=i.charCodeAt(s);return t.postMessage({init:{sorterWasmBytes:r.buffer,splatCount:e,Constants:{BytesPerFloat:hm.BytesPerFloat,BytesPerInt:hm.BytesPerInt,DepthMapRange:hm.DepthMapRange,MemoryPageSize:hm.MemoryPageSize}}}),t}var jk=function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(i){return e[0]=i,t[0]}}(),Ake=function(e,t,i,r){return e+(t<<8)+(i<<16)+(r<<24)},G2=new lt;function NZ(e){let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.visible===!1)return!0;r.type==="Splat"&&(t=!0)}),t}var cD=class extends $s{constructor(e,t,i,r,s=!1,n=1,c,u){super(i,r),this.splatCount=t,this.meshIndexIntervals=c,this.meshMatrixWorlds=u,this.splatBuffers=e,this.geometry=i,this.material=r,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=s,this.devicePixelRatio=n,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(e,t,i=!1,r=1,s,n){let c=cD.buildGeomtery(t),u=cD.buildMaterial(s);return new cD(e,t,c,u,i,r,s,n)}static buildMaterial(e){let t=`
            precision highp float;
            #include <common>

            attribute uint splatIndex;

            uniform highp sampler2D covariancesTexture;
            uniform highp usampler2D centersColorsTexture;
            uniform vec2 focal;
            uniform vec2 viewport;
            uniform vec2 basisViewport;
            uniform vec2 covariancesTextureSize;
            uniform vec2 centersColorsTextureSize;
						uniform highp sampler2D meshMatrixWorldsTexture;
						uniform uint meshIndexIntervals[257];
						uniform float orthoZoom;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;

            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);
            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));
            const uvec4 shift4 = uvec4(0, 8, 16, 24);
            vec4 uintToRGBAVec (uint u) {
               uvec4 urgba = mask4 & u;
               urgba = urgba >> shift4;
               vec4 rgba = vec4(urgba) * encodeNorm4;
               return rgba;
            }

            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {
                vec2 samplerUV = vec2(0.0, 0.0);
                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;
                samplerUV.y = float(floor(d)) / dimensions.y;
                samplerUV.x = fract(d);
                return samplerUV;
            }

            void main () {
                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));
                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));
                vColor = uintToRGBAVec(sampledCenterColor.r);

                vPosition = position.xy * 2.0;

								uint meshIndex;
								for (int i = 1; i < 257; i++) {
									if (splatIndex < meshIndexIntervals[i]) {
										meshIndex = uint(i - 1);
										break;
									}
								}

								float strideMulmeshIndex = float(4u*meshIndex);
								float meshMatrixWorldsTextureLength = float(256*4);

								mat4 modelMat = mat4(
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))
								);
								mat4 modelViewMat = viewMatrix * modelMat;
								vec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); 
                vec4 clipCenter = projectionMatrix * viewCenter;

                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;
                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;
                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;

                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);
                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);

                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix
                mat3 Vrk = mat3(
                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,
                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,
                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z
                );
                float s = 1.0 / (viewCenter.z * viewCenter.z);

                mat3 W = transpose(mat3(modelViewMat));
                mat3 T = orthoZoom > 0.0 ? W : W * mat3(
									focal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,
									0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,
									0., 0., 0.
								);
                mat3 cov2Dm = transpose(T) * Vrk * T;
                cov2Dm[0][0] += 0.3;
                cov2Dm[1][1] += 0.3;

                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because
                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],
                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't
                // need cov2Dm[1][0] because it is a symetric matrix.
                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);

                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;

                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix
                // so that we can determine the 2D basis for the splat. This is done using the method described
                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html
                //
                // This is a different approach than in the original work at INRIA. In that work they compute the
                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle
                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance
                // matrix (called 'conic') to determine fragment opacity.
                float a = cov2Dv.x;
                float d = cov2Dv.z;
                float b = cov2Dv.y;
                float D = a * d - b * b;
                float trace = a + d;
                float traceOver2 = 0.5 * trace;
                float term2 = sqrt(trace * trace / 4.0 - D);
                float eigenValue1 = traceOver2 + term2;
								float eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value

                const float maxSplatSize = 1024.0;
                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));
                // since the eigen vectors are orthogonal, we derive the second one from the first
                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);
                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);
                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);

                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;

								if (orthoZoom > 0.0) {
									ndcOffset *= orthoZoom;
								}

                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
            }`,i=`
            precision highp float;
            #include <common>

            uniform vec3 debugColor;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;
						layout(location = 1) out vec4 gVelocity; 

            void main () {
                // compute the negative squared distance from the center of the splat to the
                // current fragment in the splat's local space.
                float A = -dot(vPosition, vPosition);
                if (A < -4.0) discard;
                vec3 color = vColor.rgb;
                A = exp(A) * vColor.a;
                gl_FragColor = vec4(color.rgb, A);
								gVelocity = vec4(0.0); // so it is ignored by TAA
            }`,r={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:e},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new lt},viewport:{type:"v2",value:new lt},basisViewport:{type:"v2",value:new lt},debugColor:{type:"v3",value:new Tr},covariancesTextureSize:{type:"v2",value:new lt(1024,1024)},centersColorsTextureSize:{type:"v2",value:new lt(1024,1024)},orthoZoom:{type:"f",value:-1}};return new Qn({uniforms:r,vertexShader:t,fragmentShader:i,transparent:!0,alphaTest:1,blending:Iy,depthTest:!0,depthWrite:!1,side:Wa})}static buildGeomtery(e){let t=new fr;t.setIndex([0,1,2,0,2,3]);let i=new Float32Array(4*3),r=new Fr(i,3);t.setAttribute("position",r),r.setXYZ(0,-1,-1,0),r.setXYZ(1,-1,1,0),r.setXYZ(2,1,1,0),r.setXYZ(3,1,-1,0),r.needsUpdate=!0;let s=new IK().copy(t),n=new Uint32Array(e),c=new _S(n,1,!1);return c.setUsage(Ige),s.setAttribute("splatIndex",c),s.instanceCount=e,s}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach(r=>r.buildPreComputedBuffers()),this.covariances=new Float32Array(this.splatCount*6),this.colors=new Uint8Array(this.splatCount*4),this.centers=new Float32Array(this.splatCount*3);let e=0,t=0,i=0;for(let r of this.splatBuffers){let s=r.nsplats;this.colors.subarray(e,e+s*4).set(r.colorsA),e+=s*4,this.centers.subarray(t,t+s*3).set(r.decoded.xyz.denormDequant().data),t+=s*3,this.covariances.subarray(i,i+s*6).set(new Float32Array(r.precomputedCovarianceBufferData)),i+=s*6}}allocateAndStoreLocalSplatDataInTextures(){let e=this.splatCount,t=new lt(4096,1024);for(;t.x*t.y*2<e*6;)t.y*=2;let i=new lt(4096,1024);for(;i.x*i.y*4<e*4;)i.y*=2;let r,s;if(this.halfPrecisionCovariancesOnGPU){s=new Uint16Array(t.x*t.y*2);for(let x=0;x<this.covariances.length;x++)s[x]=obe.toHalfFloat(this.covariances[x]);r=new $c(s,t.x,t.y,fD,wp)}else s=new Float32Array(t.x*t.y*2),s.set(this.covariances),r=new $c(s,t.x,t.y,fD,To);r.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=r,this.material.uniforms.covariancesTextureSize.value.copy(t);let n=new Uint32Array(i.x*i.y*4);for(let x=0;x<e;x++){let w=x*4,E=x*3,A=x*4;n[A]=Ake(this.colors[w],this.colors[w+1],this.colors[w+2],this.colors[w+3]),n[A+1]=jk(this.centers[E]),n[A+2]=jk(this.centers[E+1]),n[A+3]=jk(this.centers[E+2])}let c=new $c(n,i.x,i.y,YQ,fp);c.internalFormat="RGBA32UI",c.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=c,this.material.uniforms.centersColorsTextureSize.value.copy(i);let u=256*4,p=new Float32Array(256*16);for(let x=0;x<this.meshMatrixWorlds.length;x++)p.set(this.meshMatrixWorlds[x].elements,x*16);let f=new $c(p,u,1,da,To);f.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=f,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:s,texture:r,size:t},centerColors:{data:n,texture:c,size:i},meshMatrixWorlds:{data:p,texture:f}}}updateIndexes(e){let t=this.geometry;t.attributes.splatIndex.set(e),t.attributes.splatIndex.needsUpdate=!0,t.instanceCount=e.length}updateUniforms(e,t,i,r){this.splatCount>0&&(G2.set(e.x*this.devicePixelRatio,e.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(G2),this.material.uniforms.basisViewport.value.set(2/G2.x,2/G2.y),this.material.uniforms.focal.value.set(t,i),this.material.uniforms.orthoZoom.value=r,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},qte,Cke=new Promise(e=>{qte=e}),BZ=!1,H2;function Dke(){if(BZ)return;if(H2)return H2;function e(){return jn(this,null,function*(){let t=yield import("./chunk-2XPCY2TG.js");qte(t),BZ=!0})}return H2=e(),H2}var Yte;Cke.then(e=>Yte=e);var Ike=class{constructor(e={}){Xw(this,"updateView",function(){let t=new mi,i=[],r=new se(0,0,-1),s=new se(0,0,-1),n=new se,c=new se;return function(u=!1,p){let f=this.updateMatrixWorldsInWorkerIfNeeded(),x=this.cropsChanged();if(!u){s.set(0,0,-1).applyQuaternion(p.quaternion);let E=!1,A=!1;if(s.dot(r)<=.95&&(E=!0),c.copy(p.position).sub(n).length()>=1&&(A=!0),!E&&!A&&!f&&!x&&!this.needsInitialRender)return}this.needsInitialRender=!1,n.copy(p.position),r.copy(s),t.copy(p.matrixWorld).invert(),t.premultiply(this.dummyPerspectiveMatrix),i[0]=p.position.x,i[1]=p.position.y,i[2]=p.position.z;let w=me(me({sort:{view:t.elements,cameraPosition:i,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount}},f?{newMatrixWorlds:this.meshMatrixWorlds}:{}),x?{newCropsArray:this.cropsArray}:{});this.sortRunning?this.queuedMessage=w:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(w))}}()),this.scene=e.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=new mi().makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(e,t){let i=new lt;this.splatMesh!==null&&this.splatMesh.getSplatCount()>0&&(e.getSize(i),this.cameraFocalLengthX=t.projectionMatrix.elements[0]*this.devicePixelRatio*i.x*.45,this.cameraFocalLengthY=t.projectionMatrix.elements[5]*this.devicePixelRatio*i.y*.45,this.splatMesh.updateUniforms(i,this.cameraFocalLengthX,this.cameraFocalLengthY,t.isPerspectiveCamera?-1:t.zoom*this.devicePixelRatio))}loadSplat(e={}){this.activePage=this.scene.activePage,e.position&&(e.position=new se().fromArray(e.position)),e.orientation&&(e.orientation=new Vr().fromArray(e.orientation)),e.halfPrecisionCovariances=!!e.halfPrecisionCovariances;let t=[];if(this.splatEntries=t,this.activePage.traverseVisibleEntity(n=>{n.data.type==="Splat"&&t.push(n)}),this.splatMesh&&this.splatMesh.dispose(),t.length===0)return this.splatMesh=null,!1;this.meshMatrixWorlds=t.map(n=>n.matrixWorld),this.meshMatrixWorldsOld=t.map(n=>n.matrixWorld.clone()),this.cropsArray=t.map(n=>n.data.crops.map(c=>c.data));let i=t.map(n=>new Yte.GSplineBuffer(new Uint8Array(n.data.buffer).buffer)),r=0,s=[0];for(let n of i)r+=n.getSplatCount(),s.push(r);return this.setupSplatMesh(i,r,e.position,e.orientation,e.halfPrecisionCovariances,this.devicePixelRatio,s,this.meshMatrixWorlds),this.setupSortWorker(r),!0}updateMatrixWorldsInWorkerIfNeeded(){let e=this.splatDataTextures.meshMatrixWorlds.data;for(let t=0;t<this.meshMatrixWorlds.length;t++)e.set(this.meshMatrixWorlds[t].elements,t*16);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,this.meshMatrixWorlds.every((t,i)=>t.equals(this.meshMatrixWorldsOld[i]))?!1:(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map(t=>t.clone()),!0)}cropsChanged(){let e=!1;return this.splatEntries.forEach((t,i)=>{t.data.crops.forEach((r,s)=>{this.cropsArray[i][s]===void 0?(e=!0,this.cropsArray[i][s]=r.data):Object.entries(r.data).forEach(([n,c])=>{Array.isArray(c)&&c.some((u,p)=>u!==this.cropsArray[i][s][n][p])?(e=!0,this.cropsArray[i][s][n]=c):c!==this.cropsArray[i][s]?.[n]&&(e=!0,this.cropsArray[i][s][n]=c)})}),t.data.crops.length!==this.cropsArray[i]?.length&&(this.cropsArray[i].length=t.data.crops.length,e=!0)}),e}setupSplatMesh(e,t,i=new se,r=new Vr,s=!1,n=1,c,u){this.splatMesh=cD.buildMesh(e,t,s,n,c,u),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(r),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=t,this.splatMesh.onBeforeRender=(p,f,x)=>this.update(p,x)}setupSortWorker(e){this.sortWorker=Tke(e),this.sortWorker.onmessage=t=>{t.data.sortDone?(this.sortRunning=!1,this.splatMesh?.updateIndexes(new Uint32Array(t.data.indexesBuffer)),this.lastSortTime=t.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):t.data.sortCanceled?this.sortRunning=!1:t.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):t.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(e,t){this.splatMesh!==null&&(this.updateSplatMeshUniforms(e,t),this.updateView(!1,t))}getSplatMesh(){return this.splatMesh}},KB=new Sp;KB.wireframe=!0;var UZ=new se,OU=class extends Qh{constructor(e,t){super(),this.data=e,this.sharedAssets=t,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new Ske,this.invisibleObjects=new nx("jflkdsafjasdifjaslk",pt(me({},sB.defaultData),{visible:!1,name:"buildin invisible"})),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1,this.errorPage=new ua("fdasfa",pt(me({},vx.defaultData),{name:""}),{shared:t,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=_ke(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=vke(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof ua&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this;){let s=r;r=r.parent;let n=r.children.indexOf(s);i.splice(0,0,n)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>_J(i.sortKey,r.sortKey)),t.map(i=>i.entity)}nonExistOrDescendantOf(e,t){let i=this.find(e);if(i===void 0)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if(e==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(e===Lx)return this.activePage.personalCamera}if(e===""||e===void 0)return;let t=this.entityByUuid[e];return t===void 0?this.getObjectByProperty("uuid",e):t}find2D(e){for(let t of this.children)if(t instanceof ua&&t.uiScene){let i=t.uiScene.find(e);if(i)return i}}findScene2DfromObject2D(e){for(let t of this.children)if(t instanceof ua&&t.uiScene&&t.uiScene.find(e))return t.uiScene}find2DInUIObjects(e){let t;return this.traverseEntity(i=>{t===void 0&&i instanceof Ha&&(t=i.uiCanvas.find(e))}),t}traverse2D(e){for(let t of this.children)t instanceof ua&&t.uiScene&&t.uiScene.traverse(e)}debugEnsureEntity(e){let t=this.find(e);if(t){if(Array.isArray(t.identity)&&this.findInstance(t.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{e.cloner?.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateByLibOp(e,t){e.path.length===1&&e.path[0]==="components"&&e.type===1&&this.createChildrenObjects([pt(me({},e.data.asset),{id:e.id})],this.invisibleObjects,t)}updateTreeByOp(e,t){if(e.path.length===0&&e.type===7){let i=e.parent===null?this:this.find(e.parent);if(i===void 0)throw new Error("unexpected");let r=this.createObject(e.id,e.data,e.children,i,e.localIndex,t);r.updateVisible(this),r.resetBBoxNeedsUpdate(),Uu(r)&&vp(r.parent)&&(r.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(i),this.markNeedsRecomputeInstancesForChildren(r),this.markToExpandCloner(r),this.markPenumbraSizeDirty(),r.updatePathSnapping()}else if(e.path.length===0&&e.type===8){let i=this.find(e.id);if(i===void 0)throw new Error("unexpected");this.markToExpandCloner(i),i.resetBBoxNeedsUpdate(),this.unregisterObject(i);let r=i.parent;this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(i),this.markPenumbraSizeDirty(),i.parent.remove(i),vp(i.parent)&&(i.parent.invalidateUpstreamBooleanData(),i.parent.invalidateDownstreamBooleanData().recomputeBoolean()),Uu(i)&&(i.freeBooleanPointer(),r instanceof Gy&&r.invalidateDownstreamBooleanData().recomputeBoolean()),i instanceof DU&&i.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(i),this.pathConstraints.removeDependencies(i.uuid),i.updatePathSnapping()}else if(e.path.length===0&&e.type===9){let i=this.find(e.id);if(i===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(i);let r=i.parent;this.markNeedsRecomputeInstancesForAncessors(r),i.cloner?.resetOnMove(),this.markToExpandCloner(i);let s=e.parent===null?this:this.find(e.parent);if(s===void 0)throw new Error("unexpected");s.add(i),this.markNeedsRecomputeInstancesForAncessors(s),this.markToExpandCloner(i),i.invalidateClonerTransform(i),i.updateVisible(this),i.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let n=e.localIndex;s.children.splice(n,0,s.children.pop()),Uu(i)&&(i.invalidateUpstreamBooleanData(),vp(i.parent)?i.parent.invalidateDownstreamBooleanData().recomputeBoolean():r instanceof Gy&&r.invalidateDownstreamBooleanData().recomputeBoolean()),i.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(e){this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let t of this.children)t instanceof ua&&(t.visible=t.uuid===e,t.visible&&(this.activePage=t,this.activePage.onActive(this)));this.activePage!==this.splatViewer?.activePage&&this.reloadSplats()}updateEntityByOp(e,t,i,r){if(t.type===0){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:n}=t.props;t=pt(me({},t),{props:n}),this.markNeedsRecomputeInstances()}t.path[0]==="pathSnapping"&&t.props.pathId!==void 0&&this.pathConstraints.setConstraint(e,t.props.pathId)}let s=this.find(e);if(s)try{yke(s,t,i,{scene:this,shared:r}),s instanceof Ya&&s.updateGeometryGroupsIfNeeded()}catch(n){console.error(n)}}updateEntity2DByOp(e,t,i,r,s,n=[]){e.updateEntityByOp(t,i,r,s),this.traverseEntity(c=>{(c instanceof Ha||c instanceof ua)&&(n.includes(c.frameId??"")||c.frameId===t)&&c.updateEntity2DByOp(t,i,r,s)})}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}isInvisibleObjects(e){return e===this.invisibleObjects||e.hasAnccestor(this.invisibleObjects)}init(e,t){let i=Object.entries(t.data.lib.components).map((r,s)=>({data:r[1].asset.data,children:r[1].asset.children,id:r[0],fi:s}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:t}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,t),this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity(r=>{r instanceof Xa&&r.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{(t.data.type==="Component"||t.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){Ln.is(e)&&(e.data.type==="Component"&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{Ln.is(t)&&t.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,i,r,s,n,c){if(e){let u=r.find(e);u&&u!==r&&s.forInstancesRec(p=>{p.data=CS(p.data,f=>{let x=f.events.data(c.id),w=p.goUp(n);if(w){let E=[...vJ(w.identity),e].join("-"),A=this.entityIdentityToEntity[E];if(A){let I=A.uuid,P=Zo.zoom(x,t);P[i]=I}else console.warn("cannot find instance")}}).data})}}rewriteActions(e,t,i,r,s,n){e.forEach(c=>{c.data.type==="Transition"?this.relativeizeInner(c.data.object,[...t,c.id],"object",i,r,s,n):c.data.type==="Animation"?this.relativeizeInner(c.data.object,[...t,c.id],"object",i,r,s,n):c.data.type==="Conditional"&&(this.rewriteActions(c.data.ifActions,[...t,c.id,"ifActions"],i,r,s,n),this.rewriteActions(c.data.elseActions,[...t,c.id,"elseActions"],i,r,s,n))})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof sx&&typeof e.identity=="string"&&e.data.type==="Component")return e.traverseEntity((t,i)=>{t.data.events.forEach(r=>{if(r.data.type==="GameControl"){let s=!1;if(t.forInstancesRec(n=>{n.data=CS(n.data,c=>{n.isInstanceRoot||(c.events.delete(r.id),s=!0)}).data}),s===!1)for(let n of ZD.list)this.rewriteActions(r.data.gameActions[n],["gameActions",n],e,t,i,r)}else r.data.type==="Conditional"?(r.data.condition.type==="Distance"?(this.relativeizeInner(r.data.condition.fromObject,["condition"],"fromObject",e,t,i,r),this.relativeizeInner(r.data.condition.toObject,["condition"],"toObject",e,t,i,r)):r.data.condition.type==="State"?this.relativeizeInner(r.data.condition.object,["condition"],"object",e,t,i,r):r.data.condition.type==="Comparison"&&(r.data.condition.lOperand.type==="Property"&&this.relativeizeInner(r.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,r),r.data.condition.rOperand.type==="Property"&&this.relativeizeInner(r.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,r)),this.rewriteActions(r.data.inActions,["inActions"],e,t,i,r),this.rewriteActions(r.data.outActions,["outActions"],e,t,i,r)):"actions"in r.data&&this.rewriteActions(r.data.actions,["actions"],e,t,i,r)})}),!0})}expandInstances(e,t,i){let r=new Set;this.traverseEntity(s=>{if(s instanceof sx&&s.isInstanceRoot)return s.expandInstanceChildren({scene:this,shared:e,pendingDeletes:r}),t||s.resetBBoxNeedsUpdate(),i&&s.traverseEntity(n=>{i.addClip(n)}),!0});for(let s of r)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),PU(s)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(i=>{i instanceof sx&&i.isInstanceRoot&&(i.component=void 0)}),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let i=typeof t.identity=="string"?t.identity:t.identity.join("-");this.entityIdentityToEntity[i]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[i]),t.dispose()})}clearScene(){for(let e of this.children)Ln.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let i=[],r=s=>{for(let n of s.children){let c=n.cloner;if(Ln.is(n)&&!n.raycastLock&&(n.visible||c?.object.data.visible))if(t===!0&&n.isInstanceRoot){let u=[];if(e.intersectObject(n,!0,u),u.length){let p=u[0];p.object=n,p.point.applyMatrix4(p.object.matrixWorld);let f=n.matrixWorld.clone().invert();p.point.applyMatrix4(f),i.push(p)}}else(Uu(n)||UB(n)&&this.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,i),QB(n,e,i)),r(n)}};return r(this.activePage),i}raycastWithClones(e){let t=[],i=r=>{for(let s of r.children){let n=s.cloner;Ln.is(s)&&(s.visible||n?.object.data.visible)&&((Uu(s)||UB(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,t),QB(s,e,t,!0)),i(s))}};return i(this),t}forEachEntity(e){for(let t of this.children)Ln.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)Ln.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)Ln.is(t)&&t.traverseEntity(e)}updateFont(e,t){this.traverseEntity(i=>{if(i instanceof Ya&&i.data.type==="Mesh"&&(i.data.geometry.type==="TextGeometry"||i.data.geometry.type==="InputGeometry")&&i.data.geometry.font===e){let r=i.geometry,s=i.data.geometry;r.updateFont(e,t).then(()=>{r.update(s);let n=i.invalidateDownstreamBooleanData();vp(n)&&n.recomputeBoolean()})}})}traverseObject(e){for(let t of this.children)FS.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)Ln.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,i){let r=0;for(let s of e)this.createObject(s.id,s.data,s.children,t,r,i),r+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,r,s,n){let c={scene:this,shared:n},u=RU(e,t,c);return u&&(this.entityByUuid[e]=u,r.add(u),r.children.splice(s,0,r.children.pop()),i.length>0&&(u.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,u,n)),u.updateState(t,c),u instanceof Ya&&u.updateGeometryGroupsIfNeeded(),u.updateVisible(this),u.cloner&&this.toExpandCloner.add(u),t.pathSnapping?.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),t.type==="Empty"&&t.animations&&u.traverseEntity(p=>{let f=p.dataPatched;if(p instanceof Ya&&f.bones&&f.boneInverses){let x=f.bones.map(A=>this.find(A)),w=f.boneInverses.map(A=>new mi().fromArray(A)),E=new v4(x,w);p.bind(E,p.bindMatrix)}else p.matrixAutoUpdate=!0}),u}getCenter(e){let t=[];for(let r=0,s=e.length;r<s;++r){let{id:n,recursive:c}=e[r],u=this.find(n),p=c?u.recursiveBBox:u.singleBBox;t.push(...p.vertices)}let i=new mo;return i.setFromPoints(t),i.getCenter(UZ),UZ}copyMatrixWorld(e,t){if(e===null){t.identity();return}let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){if(e===null){t.identity();return}let i=this.find(e)?.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof wl)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof _m&&e(t.material[i]);else t.material instanceof _m&&e(t.material)})}updateViewPlaneSize(e,t,i=!1){this.traverseConcreteEntity(r=>{r instanceof Xa&&r.setViewplaneSize(e,t,i)})}initializeSplatViewer(){this.splatViewer=new Ike({scene:this}),this.reloadSplats()}reloadSplats(){this.splatViewer?.loadSplat()}},uD=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)},Pke=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return Oke(Math.atan2(r,i))},Rke=(e,t,i)=>{let r={x:0,y:0};return i=JB(i),r.x=e.x-t*Math.cos(i),r.y=e.y-t*Math.sin(i),r},JB=e=>e*(Math.PI/180),Oke=e=>e*(180/Math.PI),Lke=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,Vk=new Map,jZ=e=>{Vk.has(e)&&clearTimeout(Vk.get(e)),Vk.set(e,setTimeout(e,100))},hI=(e,t,i)=>{let r=t.split(/[ ,]+/g),s;for(let n=0;n<r.length;n+=1)s=r[n],e.addEventListener?e.addEventListener(s,i,!1):e.attachEvent&&e.attachEvent(s,i)},VZ=(e,t,i)=>{let r=t.split(/[ ,]+/g),s;for(let n=0;n<r.length;n+=1)s=r[n],e.removeEventListener?e.removeEventListener(s,i):e.detachEvent&&e.detachEvent(s,i)},Xte=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),GZ=()=>{if(typeof window>"u")return;let e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},e4=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},LU=(e,t,i)=>{let r=$te(e);for(let s in r)if(r.hasOwnProperty(s))if(typeof t=="string")r[s]=t+" "+i;else{let n="";for(let c=0,u=t.length;c<u;c+=1)n+=t[c]+" "+i+", ";r[s]=n.slice(0,-2)}return r},zke=(e,t)=>{let i=$te(e);for(let r in i)i.hasOwnProperty(r)&&(i[r]=t);return i},$te=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach(function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},Gk=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},Fke=(e,t)=>{let i={};for(let r in e)e.hasOwnProperty(r)&&t.hasOwnProperty(r)?i[r]=t[r]:e.hasOwnProperty(r)&&(i[r]=e[r]);return i},t4=(e,t)=>{if(e.length)for(let i=0,r=e.length;i<r;i+=1)t(e[i]);else t(e)},kke=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});typeof window<"u"&&(Zte="ontouchstart"in window,Qte=!!window.PointerEvent,Kte=!!window.MSPointerEvent);var Zte,Qte,Kte,Vw={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},Y_,BS={};Qte?Y_=Vw.pointer:Kte?Y_=Vw.MSPointer:Zte?(Y_=Vw.touch,BS=Vw.mouse):Y_=Vw.mouse;function $y(){}$y.prototype.on=function(e,t){var i=this,r=e.split(/[ ,]+/g),s;i._handlers_=i._handlers_||{};for(var n=0;n<r.length;n+=1)s=r[n],i._handlers_[s]=i._handlers_[s]||[],i._handlers_[s].push(t);return i};$y.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};$y.prototype.trigger=function(e,t){var i=this,r=e.split(/[ ,]+/g),s;i._handlers_=i._handlers_||{};for(var n=0;n<r.length;n+=1)s=r[n],i._handlers_[s]&&i._handlers_[s].length&&i._handlers_[s].forEach(function(c){c.call(i,{type:s,target:i},t)})};$y.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=Fke(t.options,e))};$y.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},hI(e,Y_[t],i._domHandlers_[t]),BS[t]&&hI(e,BS[t],i._domHandlers_[t]),i};$y.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},VZ(e,Y_[t],i._domHandlers_[t]),BS[t]&&VZ(e,BS[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};var zU=$y;function Jo(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=Jo.id,Jo.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Jo.prototype=new zU;Jo.constructor=Jo;Jo.id=0;Jo.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};Jo.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=zke("borderRadius","50%"),i=LU("transition","opacity",e),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},Gk(r.el,i),this.options.shape==="circle"&&Gk(r.back,t),Gk(r.front,t),this.applyStyles(r),this};Jo.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};Jo.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};Jo.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};Jo.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};Jo.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};Jo.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){let i=t.options.restJoystick,r={};r.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,r.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,r)}return t};Jo.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var r=i.options.fadeTime+"ms",s={};s.front=LU("transition",["top","left"],r);var n={front:{}};n.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(s),i.applyStyles(n),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};Jo.prototype.restCallback=function(){var e=this,t={};t.front=LU("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};Jo.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};Jo.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,r=Math.PI/2,s,n,c;if(t>i&&t<i*3&&!e.lockX?s="up":t>-i&&t<=i&&!e.lockY?s="left":t>-i*3&&t<=-i&&!e.lockX?s="down":e.lockY||(s="right"),e.lockY||(t>-r&&t<r?n="left":n="right"),e.lockX||(t>0?c="up":c="down"),e.force>this.options.threshold){var u={},p;for(p in this.direction)this.direction.hasOwnProperty(p)&&(u[p]=this.direction[p]);var f={};this.direction={x:n,y:c,angle:s},e.direction=this.direction;for(p in u)u[p]===this.direction[p]&&(f[p]=!0);if(f.x&&f.y&&f.angle)return e;(!f.x||!f.y)&&this.trigger("plain",e),f.x||this.trigger("plain:"+n,e),f.y||this.trigger("plain:"+c,e),f.angle||this.trigger("dir dir:"+s,e)}else this.resetDirection();return e};var Nke=Jo;function go(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=go.id,go.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let r=getComputedStyle(i.options.zone.parentElement);return r&&r.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}go.prototype=new zU;go.constructor=go;go.id=0;go.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var r=0,s=t.length;r<s;r+=1)if(t[r].identifier===i)return t[r];return!1}};go.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};go.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};go.prototype.createNipple=function(e,t){var i=this,r=i.manager.scroll,s={},n=i.options,c={x:i.parentIsFlex?r.x:r.x+i.box.left,y:i.parentIsFlex?r.y:r.y+i.box.top};if(e.x&&e.y)s={x:e.x-c.x,y:e.y-c.y};else if(e.top||e.right||e.bottom||e.left){var u=document.createElement("DIV");u.style.display="hidden",u.style.top=e.top,u.style.right=e.right,u.style.bottom=e.bottom,u.style.left=e.left,u.style.position="absolute",n.zone.appendChild(u);var p=u.getBoundingClientRect();n.zone.removeChild(u),s=e,e={x:p.left+r.x,y:p.top+r.y}}var f=new Nke(i,{color:n.color,size:n.size,threshold:n.threshold,fadeTime:n.fadeTime,dataOnly:n.dataOnly,restJoystick:n.restJoystick,restOpacity:n.restOpacity,mode:n.mode,identifier:t,position:e,zone:n.zone,frontPosition:{x:0,y:0},shape:n.shape});return n.dataOnly||(e4(f.ui.el,s),e4(f.ui.front,f.frontPosition)),i.nipples.push(f),i.trigger("added "+f.identifier+":added",f),i.manager.trigger("added "+f.identifier+":added",f),i.bindNipple(f),f};go.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};go.prototype.bindNipple=function(e){var t=this,i,r=function(s,n){i=s.type+" "+n.id+":"+s.type,t.trigger(i,n)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};go.prototype.pressureFn=function(e,t,i){var r=this,s=0;clearInterval(r.pressureIntervals[i]),r.pressureIntervals[i]=setInterval((function(){var n=e.force||e.pressure||e.webkitForce||0;n!==s&&(t.trigger("pressure",n),r.trigger("pressure "+t.identifier+":pressure",n),s=n)}).bind(r),100)};go.prototype.onstart=function(e){var t=this,i=t.options,r=e;e=Xte(e),t.updateBox();var s=function(n){t.actives.length<i.maxNumberOfNipples?t.processOnStart(n):r.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(c){if(Object.values(r.touches).findIndex(function(p){return p.identifier===c})<0){var u=[e[0]];u.identifier=c,t.processOnEnd(u)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(n))};return t4(e,s),t.manager.bindDocument(),!1};go.prototype.processOnStart=function(e){var t=this,i=t.options,r,s=t.manager.getIdentifier(e),n=e.force||e.pressure||e.webkitForce||0,c={x:e.pageX,y:e.pageY},u=t.getOrCreate(s,c);u.identifier!==s&&t.manager.removeIdentifier(u.identifier),u.identifier=s;var p=function(x){x.trigger("start",x),t.trigger("start "+x.id+":start",x),x.show(),n>0&&t.pressureFn(e,x,x.identifier),t.processOnMove(e)};if((r=t.idles.indexOf(u))>=0&&t.idles.splice(r,1),t.actives.push(u),t.ids.push(u.identifier),i.mode!=="semi")p(u);else{var f=uD(c,u.position);if(f<=i.catchDistance)p(u);else{u.destroy(),t.processOnStart(e);return}}return u};go.prototype.getOrCreate=function(e,t){var i=this,r=i.options,s;return/(semi|static)/.test(r.mode)?(s=i.idles[0],s?(i.idles.splice(0,1),s):r.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(s=i.createNipple(t,e),s)};go.prototype.processOnMove=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),s=t.nipples.get(r),n=t.manager.scroll;if(!Lke(e)){this.processOnEnd(e);return}if(!s){console.error("Found zombie joystick with ID "+r),t.manager.removeIdentifier(r);return}if(i.dynamicPage){var c=s.el.getBoundingClientRect();s.position={x:n.x+c.left,y:n.y+c.top}}s.identifier=r;var u=s.options.size/2,p={x:e.pageX,y:e.pageY};i.lockX&&(p.y=s.position.y),i.lockY&&(p.x=s.position.x);var f=uD(p,s.position),x=Pke(p,s.position),w=JB(x),E=f/u,A={distance:f,position:p},I,P;if(s.options.shape==="circle"?(I=Math.min(f,u),P=Rke(s.position,I,x)):(P=kke(p,s.position,u),I=uD(P,s.position)),i.follow){if(f>u){let j=p.x-P.x,V=p.y-P.y;s.position.x+=j,s.position.y+=V,s.el.style.top=s.position.y-(t.box.top+n.y)+"px",s.el.style.left=s.position.x-(t.box.left+n.x)+"px",f=uD(p,s.position)}}else p=P,f=I;var O=p.x-s.position.x,k=p.y-s.position.y;s.frontPosition={x:O,y:k},i.dataOnly||e4(s.ui.front,s.frontPosition);var U={identifier:s.identifier,position:p,force:E,pressure:e.force||e.pressure||e.webkitForce||0,distance:f,angle:{radian:w,degree:x},vector:{x:O/u,y:-k/u},raw:A,instance:s,lockX:i.lockX,lockY:i.lockY};U=s.computeDirection(U),U.angle={radian:JB(180-x),degree:180-x},s.trigger("move",U),t.trigger("move "+s.id+":move",U)};go.prototype.processOnEnd=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),s=t.nipples.get(r),n=t.manager.removeIdentifier(s.identifier);!s||(i.dataOnly||s.hide(function(){i.mode==="dynamic"&&(s.trigger("removed",s),t.trigger("removed "+s.id+":removed",s),t.manager.trigger("removed "+s.id+":removed",s),s.destroy())}),clearInterval(t.pressureIntervals[s.identifier]),s.resetDirection(),s.trigger("end",s),t.trigger("end "+s.id+":end",s),t.ids.indexOf(s.identifier)>=0&&t.ids.splice(t.ids.indexOf(s.identifier),1),t.actives.indexOf(s)>=0&&t.actives.splice(t.actives.indexOf(s),1),/(semi|static)/.test(i.mode)?t.idles.push(s):t.nipples.indexOf(s)>=0&&t.nipples.splice(t.nipples.indexOf(s),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[n.id]=n.identifier))};go.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};go.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var Bke=go;function va(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=GZ(),t.config(e),t.prepareCollections();var i=function(){var s;t.collections.forEach(function(n){n.forEach(function(c){s=c.el.getBoundingClientRect(),c.position={x:t.scroll.x+s.left,y:t.scroll.y+s.top}})})};if(typeof window>"u")return t.collections;hI(window,"resize",function(){jZ(i)});var r=function(){t.scroll=GZ()};return hI(window,"scroll",function(){jZ(r)}),t.collections}va.prototype=new zU;va.constructor=va;va.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(r){return i=r.get(t),!i}),i}};va.prototype.create=function(e){return this.createCollection(e)};va.prototype.createCollection=function(e){var t=this,i=new Bke(t,e);return t.bindCollection(i),t.collections.push(i),i};va.prototype.bindCollection=function(e){var t=this,i,r=function(s,n){i=s.type+" "+n.id+":"+s.type,t.trigger(i,n)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};va.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};va.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};va.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};va.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};va.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};va.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};va.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};va.prototype.onAny=function(e,t){var i=this,r,s="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=Xte(t);var n=function(u,p,f){f.ids.indexOf(p)>=0&&(f[s](u),u._found_=!0)},c=function(u){r=i.getIdentifier(u),t4(i.collections,n.bind(null,u,r)),u._found_||i.removeIdentifier(r)};return t4(t,c),!1};va.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};va.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};var Uke=va,HZ=new Uke,jke={create:function(e){return HZ.create(e)},factory:HZ},Jte=new Map,pS=new Map,Cy=class{constructor(e,t,i,r){this.data=t;let{audio:s,volume:n,delay:c,loop:u}=t;if(!s)throw new Error("Missing property");let p=typeof s=="string"?r.getAudio(s).src:s.data;this.audioPlayer=new rS({src:p,volume:n,delay:c,loop:u}),pS.has(i.uuid)?pS.get(i.uuid).push(this):pS.set(i.uuid,[this]),Jte.set(e,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},i4=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=Jte.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=pS.get(e);!t?.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let e=[...pS.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},eie=class{constructor(e,t,i,r,s){if(this.data=t,this.shared=r,this.condition=s,t.interaction==="play")this.interaction=new Cy(e,t,i,r);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new i4(t);else throw new Error("Missing property")}dispatchBasic(){if(Fs(this.shared,this.condition)===!1)return!1;this.interaction instanceof Cy?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(Fs(this.shared,this.condition)===!1)return!1;this.interaction instanceof Cy?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){if(Fs(this.shared,this.condition)===!1)return!1;this.interaction instanceof Cy&&(e==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},tie=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.delay=0,this.emission=e.emission,e.delay!==void 0&&(this.delay=e.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.start(0),this.clearDelay()},e);return}this.particleSystem.start()}stop(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.stop(0),this.clearDelay()},e);return}this.particleSystem.stop()}freeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.freeze(0),this.clearDelay()},e);return}this.particleSystem.froze()}unFreeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.unFreeze(0),this.clearDelay()},e);return}this.particleSystem.unFroze()}reset(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.reset(0),this.clearDelay()},e);return}this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze();break}}dispatchBasic(){if(Fs(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break;default:break}}dispatchConditional(){if(Fs(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break;default:break}}dispatchGameControl(e){if(Fs(this.shared,this.condition)===!1||!this.particleSystem)return!1;e==="start"?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},Vke="text/plain",Gke="us-ascii",WZ=(e,t)=>t.some(i=>i instanceof RegExp?i.test(e):i===e),Hke=(e,{stripHash:t})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!i)throw new Error(`Invalid URL: ${e}`);let{type:r,data:s,hash:n}=i.groups,c=r.split(";");n=t?"":n;let u=!1;c[c.length-1]==="base64"&&(c.pop(),u=!0);let p=(c.shift()||"").toLowerCase(),f=[...c.map(x=>{let[w,E=""]=x.split("=").map(A=>A.trim());return w==="charset"&&(E=E.toLowerCase(),E===Gke)?"":`${w}${E?`=${E}`:""}`}).filter(Boolean)];return u&&f.push("base64"),(f.length>0||p&&p!==Vke)&&f.unshift(p),`data:${f.join(";")},${u?s.trim():s}${n?`#${n}`:""}`};function Wke(e,t){if(t=me({defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0},t),e=e.trim(),/^data:/i.test(e))return Hke(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=e.startsWith("//");!i&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let r=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&r.protocol==="https:"&&(r.protocol="http:"),t.forceHttps&&r.protocol==="http:"&&(r.protocol="https:"),t.stripAuthentication&&(r.username="",r.password=""),t.stripHash?r.hash="":t.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){let n=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,c=0,u="";for(;;){let f=n.exec(r.pathname);if(!f)break;let x=f[0],w=f.index,E=r.pathname.slice(c,w);u+=E.replace(/\/{2,}/g,"/"),u+=x,c=w+x.length}let p=r.pathname.slice(c,r.pathname.length);u+=p.replace(/\/{2,}/g,"/"),r.pathname=u}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let n=r.pathname.split("/"),c=n[n.length-1];WZ(c,t.removeDirectoryIndex)&&(n=n.slice(0,-1),r.pathname=n.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let n of[...r.searchParams.keys()])WZ(n,t.removeQueryParameters)&&r.searchParams.delete(n);if(t.removeQueryParameters===!0&&(r.search=""),t.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}t.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));let s=e;return e=r.toString(),!t.removeSingleSlash&&r.pathname==="/"&&!s.endsWith("/")&&r.hash===""&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||r.pathname==="/")&&r.hash===""&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),i&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var qke=class{constructor({url:e,context:t},i,r,s){if(this.controlsManager=i,this.shared=r,this.condition=s,!e)throw new Error("Missing property");this.url=e.startsWith("mailto:")?e:Wke(e,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=t??"tab"}dispatch(){if(Fs(this.shared,this.condition)===!1)return!1;XS?window.location.assign(this.url):(this.context==="tab"||yJ&&this.context==="none"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),this.controlsManager.orbitControls?.onPointerUp(Pr[0]),F2e())}},iie=class{constructor(e,t,i,r,s){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=s,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=n=>{this.timeoutIdQueue.shift();let c=this.page.scene.find(n);if(c===void 0)return;let u=this.controlsManager.sharedGameControlGlobals.rapierWorld,p=u?c.dataPatched.physics?.fusedBody:!0;if(c.cloner){for(let f of c.cloner.children)p?(f.playModeVisible=!1,f.rigidBody&&c.dataPatched.physics?.rigidBody==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(f.rigidBody.collider(0).handle),u.removeRigidBody(f.rigidBody),f.rigidBody=void 0),f.bvhGeometry&&(f.bvhGeometry=void 0)):this.clone===void 0||this.clone===f?(f.playModeVisible=!1,f.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(f.rigidBody.collider(0).handle),u.removeRigidBody(f.rigidBody),f.rigidBody=void 0)):f.playModeVisible===void 0&&(f.playModeVisible=!0);(p||this.clone===void 0||this.clone===!1)&&(c.visible=!1,c.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(c.rigidBody.collider(0).handle),u.removeRigidBody(c.rigidBody),c.rigidBody=void 0),c.bvhGeometry&&(c.bvhGeometry=void 0))}else c.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(c.rigidBody.collider(0).handle),u.removeRigidBody(c.rigidBody),c.rigidBody=void 0),c.bvhGeometry&&(c.bvhGeometry=void 0),c.visible=!1;u===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(f=>f.bvhGeometry!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(f=>f.rigidBody!==void 0),c.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...e.objects]}dispatch(e){if(Fs(this.shared,this.condition)===!1)return!1;this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){if(Fs(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(e=>window.clearTimeout(e))}},rie=class{constructor(e,t,i,r,s){this.data=e,this.page=t,this.shared=i,this.eventManager=r,this.condition=s,this.shared=i}dispatch(){if(Fs(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{this.shared.reset(this.shared.data,!0),qU(this.page,this.shared,!0),this.eventManager.reset(),this.eventManager.controlsManager.gameControl?.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},nie={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},FU={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},Yke=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],dI={CSS:{},springs:{}};function Wu(e,t,i){return Math.min(Math.max(e,t),i)}function fS(e,t){return e.indexOf(t)>-1}function Hk(e,t){return e.apply(null,t)}var zr={arr:function(e){return Array.isArray(e)},obj:function(e){return fS(Object.prototype.toString.call(e),"Object")},pth:function(e){return zr.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||zr.svg(e))},str:function(e){return typeof e=="string"},fnc:function(e){return typeof e=="function"},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return zr.hex(e)||zr.rgb(e)||zr.hsl(e)},key:function(e){return!nie.hasOwnProperty(e)&&!FU.hasOwnProperty(e)&&e!=="targets"&&e!=="keyframes"}};function sie(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(i){return parseFloat(i)}):[]}function oie(e,t){var i=sie(e),r=Wu(zr.und(i[0])?1:i[0],.1,100),s=Wu(zr.und(i[1])?100:i[1],.1,100),n=Wu(zr.und(i[2])?10:i[2],.1,100),c=Wu(zr.und(i[3])?0:i[3],.1,100),u=Math.sqrt(s/r),p=n/(2*Math.sqrt(s*r)),f=p<1?u*Math.sqrt(1-p*p):0,x=1,w=p<1?(p*u+-c)/f:-c+u;function E(I){var P=t?t*I/1e3:I;return p<1?P=Math.exp(-P*p*u)*(x*Math.cos(f*P)+w*Math.sin(f*P)):P=(x+w*P)*Math.exp(-P*u),I===0||I===1?I:1-P}function A(){var I=dI.springs[e];if(I)return I;for(var P=1/6,O=0,k=0;;)if(O+=P,E(O)===1){if(k++,k>=16)break}else k=0;var U=O*P*1e3;return dI.springs[e]=U,U}return t?E:A}function Xke(e){return e===void 0&&(e=10),function(t){return Math.ceil(Wu(t,1e-6,1)*e)*(1/e)}}var $ke=function(){var e=11,t=1/(e-1);function i(x,w){return 1-3*w+3*x}function r(x,w){return 3*w-6*x}function s(x){return 3*x}function n(x,w,E){return((i(w,E)*x+r(w,E))*x+s(w))*x}function c(x,w,E){return 3*i(w,E)*x*x+2*r(w,E)*x+s(w)}function u(x,w,E,A,I){var P,O,k=0;do O=w+(E-w)/2,P=n(O,A,I)-x,P>0?E=O:w=O;while(Math.abs(P)>1e-7&&++k<10);return O}function p(x,w,E,A){for(var I=0;I<4;++I){var P=c(w,E,A);if(P===0)return w;var O=n(w,E,A)-x;w-=O/P}return w}function f(x,w,E,A){if(!(0<=x&&x<=1&&0<=E&&E<=1))return;var I=new Float32Array(e);if(x!==w||E!==A)for(var P=0;P<e;++P)I[P]=n(P*t,x,E);function O(k){for(var U=0,j=1,V=e-1;j!==V&&I[j]<=k;++j)U+=t;--j;var $=(k-I[j])/(I[j+1]-I[j]),Y=U+$*t,J=c(Y,x,E);return J>=.001?p(k,Y,x,E):J===0?Y:u(k,U,U+t,x,E)}return function(k){return x===w&&E===A||k===0||k===1?k:n(O(k),w,A)}}return f}(),aie=function(){var e={linear:function(){return function(r){return r}}},t={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var s,n=4;r<((s=Math.pow(2,--n))-1)/11;);return 1/Math.pow(4,3-n)-7.5625*Math.pow((s*3-2)/22-r,2)}},Elastic:function(r,s){r===void 0&&(r=1),s===void 0&&(s=.5);var n=Wu(r,1,10),c=Wu(s,.1,2);return function(u){return u===0||u===1?u:-n*Math.pow(2,10*(u-1))*Math.sin((u-1-c/(Math.PI*2)*Math.asin(1/n))*(Math.PI*2)/c)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(r,s){t[r]=function(){return function(n){return Math.pow(n,s+2)}}}),Object.keys(t).forEach(function(r){var s=t[r];e["easeIn"+r]=s,e["easeOut"+r]=function(n,c){return function(u){return 1-s(n,c)(1-u)}},e["easeInOut"+r]=function(n,c){return function(u){return u<.5?s(n,c)(u*2)/2:1-s(n,c)(u*-2+2)/2}}}),e}();function kU(e,t){if(zr.fnc(e))return e;var i=e.split("(")[0],r=aie[i],s=sie(e);switch(i){case"spring":return oie(e,t);case"cubicBezier":return Hk($ke,s);case"steps":return Hk(Xke,s);default:return Hk(r,s)}}function lie(e){try{var t=document.querySelectorAll(e);return t}catch{return}}function UI(e,t){for(var i=e.length,r=arguments.length>=2?arguments[1]:void 0,s=[],n=0;n<i;n++)if(n in e){var c=e[n];t.call(r,c,n,e)&&s.push(c)}return s}function jI(e){return e.reduce(function(t,i){return t.concat(zr.arr(i)?jI(i):i)},[])}function qZ(e){return zr.arr(e)?e:(zr.str(e)&&(e=lie(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function NU(e,t){return e.some(function(i){return i===t})}function BU(e){var t={};for(var i in e)t[i]=e[i];return t}function r4(e,t){var i=BU(e);for(var r in e)i[r]=t.hasOwnProperty(r)?t[r]:e[r];return i}function VI(e,t){var i=BU(e);for(var r in t)i[r]=zr.und(e[r])?t[r]:e[r];return i}function Zke(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}function Qke(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=e.replace(t,function(u,p,f,x){return p+p+f+f+x+x}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),s=parseInt(r[1],16),n=parseInt(r[2],16),c=parseInt(r[3],16);return"rgba("+s+","+n+","+c+",1)"}function Kke(e){var t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),i=parseInt(t[1],10)/360,r=parseInt(t[2],10)/100,s=parseInt(t[3],10)/100,n=t[4]||1;function c(E,A,I){return I<0&&(I+=1),I>1&&(I-=1),I<1/6?E+(A-E)*6*I:I<1/2?A:I<2/3?E+(A-E)*(2/3-I)*6:E}var u,p,f;if(r==0)u=p=f=s;else{var x=s<.5?s*(1+r):s+r-s*r,w=2*s-x;u=c(w,x,i+1/3),p=c(w,x,i),f=c(w,x,i-1/3)}return"rgba("+u*255+","+p*255+","+f*255+","+n+")"}function Jke(e){if(zr.rgb(e))return Zke(e);if(zr.hex(e))return Qke(e);if(zr.hsl(e))return Kke(e)}function bp(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function eNe(e){if(fS(e,"translate")||e==="perspective")return"px";if(fS(e,"rotate")||fS(e,"skew"))return"deg"}function n4(e,t){return zr.fnc(e)?e(t.target,t.id,t.total):e}function $h(e,t){return e.getAttribute(t)}function UU(e,t,i){var r=bp(t);if(NU([i,"deg","rad","turn"],r))return t;var s=dI.CSS[t+i];if(!zr.und(s))return s;var n=100,c=document.createElement(e.tagName),u=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;u.appendChild(c),c.style.position="absolute",c.style.width=n+i;var p=n/c.offsetWidth;u.removeChild(c);var f=p*parseFloat(t);return dI.CSS[t+i]=f,f}function cie(e,t,i){if(t in e.style){var r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),s=e.style[t]||getComputedStyle(e).getPropertyValue(r)||"0";return i?UU(e,s,i):s}}function jU(e,t){if(zr.dom(e)&&!zr.inp(e)&&($h(e,t)||zr.svg(e)&&e[t]))return"attribute";if(zr.dom(e)&&NU(Yke,t))return"transform";if(zr.dom(e)&&t!=="transform"&&cie(e,t))return"css";if(e[t]!=null)return"object"}function uie(e){if(zr.dom(e)){for(var t=e.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map,s;s=i.exec(t);)r.set(s[1],s[2]);return r}}function tNe(e,t,i,r){var s=fS(t,"scale")?1:0+eNe(t),n=uie(e).get(t)||s;return i&&(i.transforms.list.set(t,n),i.transforms.last=t),r?UU(e,n,r):n}function VU(e,t,i,r){switch(jU(e,t)){case"transform":return tNe(e,t,r,i);case"css":return cie(e,t,i);case"attribute":return $h(e,t);default:return e[t]||0}}function GU(e,t){var i=/^(\*=|\+=|-=)/.exec(e);if(!i)return e;var r=bp(e)||0,s=parseFloat(t),n=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return s+n+r;case"-":return s-n+r;case"*":return s*n+r}}function hie(e,t){if(zr.col(e))return Jke(e);if(/\s/g.test(e))return e;var i=bp(e),r=i?e.substr(0,e.length-i.length):e;return t?r+t:r}function HU(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function iNe(e){return Math.PI*2*$h(e,"r")}function rNe(e){return $h(e,"width")*2+$h(e,"height")*2}function nNe(e){return HU({x:$h(e,"x1"),y:$h(e,"y1")},{x:$h(e,"x2"),y:$h(e,"y2")})}function die(e){for(var t=e.points,i=0,r,s=0;s<t.numberOfItems;s++){var n=t.getItem(s);s>0&&(i+=HU(r,n)),r=n}return i}function sNe(e){var t=e.points;return die(e)+HU(t.getItem(t.numberOfItems-1),t.getItem(0))}function pie(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return iNe(e);case"rect":return rNe(e);case"line":return nNe(e);case"polyline":return die(e);case"polygon":return sNe(e)}}function oNe(e){var t=pie(e);return e.setAttribute("stroke-dasharray",t),t}function aNe(e){for(var t=e.parentNode;zr.svg(t)&&zr.svg(t.parentNode);)t=t.parentNode;return t}function fie(e,t){var i=t||{},r=i.el||aNe(e),s=r.getBoundingClientRect(),n=$h(r,"viewBox"),c=s.width,u=s.height,p=i.viewBox||(n?n.split(" "):[0,0,c,u]);return{el:r,viewBox:p,x:p[0]/1,y:p[1]/1,w:c/p[2],h:u/p[3]}}function lNe(e,t){var i=zr.str(e)?lie(e)[0]:e,r=t||100;return function(s){return{property:s,el:i,svg:fie(i),totalLength:pie(i)*(r/100)}}}function cNe(e,t){function i(u){u===void 0&&(u=0);var p=t+u>=1?t+u:0;return e.el.getPointAtLength(p)}var r=fie(e.el,e.svg),s=i(),n=i(-1),c=i(1);switch(e.property){case"x":return(s.x-r.x)*r.w;case"y":return(s.y-r.y)*r.h;case"angle":return Math.atan2(c.y-n.y,c.x-n.x)*180/Math.PI}}function YZ(e,t){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=hie(zr.pth(e)?e.totalLength:e,t)+"";return{original:r,numbers:r.match(i)?r.match(i).map(Number):[0],strings:zr.str(e)||t?r.split(i):[]}}function mie(e){var t=e?jI(zr.arr(e)?e.map(qZ):qZ(e)):[];return UI(t,function(i,r,s){return s.indexOf(i)===r})}function gie(e){var t=mie(e);return t.map(function(i,r){return{target:i,id:r,total:t.length,transforms:{list:uie(i)}}})}function uNe(e,t){var i=BU(t);if(/^spring/.test(i.easing)&&(i.duration=oie(i.easing)),zr.arr(e)){var r=e.length,s=r===2&&!zr.obj(e[0]);s?e={value:e}:zr.fnc(t.duration)||(i.duration=t.duration/r)}var n=zr.arr(e)?e:[e];return n.map(function(c,u){var p=zr.obj(c)&&!zr.pth(c)?c:{value:c};return zr.und(p.delay)&&(p.delay=u?0:t.delay),zr.und(p.endDelay)&&(p.endDelay=u===n.length-1?t.endDelay:0),p}).map(function(c){return VI(c,i)})}function hNe(e){for(var t=UI(jI(e.map(function(n){return Object.keys(n)})),function(n){return zr.key(n)}).reduce(function(n,c){return n.indexOf(c)<0&&n.push(c),n},[]),i={},r=function(n){var c=t[n];i[c]=e.map(function(u){var p={};for(var f in u)zr.key(f)?f==c&&(p.value=u[f]):p[f]=u[f];return p})},s=0;s<t.length;s++)r(s);return i}function dNe(e,t){var i=[],r=t.keyframes;r&&(t=VI(hNe(r),t));for(var s in t)zr.key(s)&&i.push({name:s,tweens:uNe(t[s],e)});return i}function pNe(e,t){var i={};for(var r in e){var s=n4(e[r],t);zr.arr(s)&&(s=s.map(function(n){return n4(n,t)}),s.length===1&&(s=s[0])),i[r]=s}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function fNe(e,t){var i;return e.tweens.map(function(r){var s=pNe(r,t),n=s.value,c=zr.arr(n)?n[1]:n,u=bp(c),p=VU(t.target,e.name,u,t),f=i?i.to.original:p,x=zr.arr(n)?n[0]:f,w=bp(x)||bp(p),E=u||w;return zr.und(c)&&(c=f),s.from=YZ(x,E),s.to=YZ(GU(c,x),E),s.start=i?i.end:0,s.end=s.start+s.delay+s.duration+s.endDelay,s.easing=kU(s.easing,s.duration),s.isPath=zr.pth(n),s.isColor=zr.col(s.from.original),s.isColor&&(s.round=1),i=s,s})}var yie={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,r,s){if(r.list.set(t,i),t===r.last||s){var n="";r.list.forEach(function(c,u){n+=u+"("+c+") "}),e.style.transform=n}}};function vie(e,t){var i=gie(e);i.forEach(function(r){for(var s in t){var n=n4(t[s],r),c=r.target,u=bp(n),p=VU(c,s,u,r),f=u||bp(p),x=GU(hie(n,f),p),w=jU(c,s);yie[w](c,s,x,r.transforms,!0)}})}function mNe(e,t){var i=jU(e.target,t.name);if(i){var r=fNe(t,e),s=r[r.length-1];return{type:i,property:t.name,animatable:e,tweens:r,duration:s.end,delay:r[0].delay,endDelay:s.endDelay}}}function gNe(e,t){return UI(jI(e.map(function(i){return t.map(function(r){return mNe(i,r)})})),function(i){return!zr.und(i)})}function _ie(e,t){var i=e.length,r=function(n){return n.timelineOffset?n.timelineOffset:0},s={};return s.duration=i?Math.max.apply(Math,e.map(function(n){let c=n.startOnceDelay??0,u=n.pingPongDelayCorrection??0,p=n.pingPongEndDelayCorrection??0;return r(n)+c+u+p+n.duration*(n.loop??1)})):t.duration,s.delay=i?Math.min.apply(Math,e.map(function(n){let c=n.startOnceDelay??0,u=n.pingPongDelayCorrection??0;return r(n)+c+u+n.delay})):t.delay,s.endDelay=i?s.duration-Math.max.apply(Math,e.map(function(n){let c=n.startOnceDelay??0,u=n.pingPongDelayCorrection??0,p=n.pingPongEndDelayCorrection??0;return r(n)+c+u+n.duration*(n.loop??1)-n.endDelay-p})):t.endDelay,s}var XZ=0;function yNe(e){var t=r4(nie,e),i=r4(FU,e),r=dNe(i,e),s=gie(e.targets),n=gNe(s,r),c=_ie(n,i),u=XZ;return XZ++,VI(t,{id:u,children:[],animatables:s,animations:n,duration:c.duration,delay:c.delay,endDelay:c.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}var Kc=[],$Z=[],hD,vNe=function(){function e(){hD=requestAnimationFrame(t)}function t(i){var r=Kc.length;if(r){for(var s=0;s<r;){var n=Kc[s];n.paused?(Kc.splice(s,1),r-=1):(n.tick(i),s++)}e()}else hD=cancelAnimationFrame(hD)}return e}();function _Ne(e){document.hidden?(Kc.forEach(function(t){return t.pause(e.timeStamp)}),$Z=Kc.slice(0),fo.running=Kc=[]):$Z.forEach(function(t){return t.play(e.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",_Ne);function fo(e){e===void 0&&(e={});var t=0,i=0,r=0,s,n,c=0,u=null;function p(J){var X=window.Promise&&new Promise(function(ee){return u=ee});return J.finished=X,X}var f=yNe(e),x=p(f);function w(){var J=f.direction;J!=="alternate"&&(f.direction=J!=="normal"?"normal":"reverse"),f.reversed=!f.reversed,n.forEach(function(X){(X.loop===1||X.loop%2===0)&&(X.reversed=f.reversed)})}function E(){f.direction="normal",f.reversed=!1,n.forEach(function(J){return J.reversed=!1})}function A(J){return f.reversed?f.duration-J:J}function I(){t=0,i=A(f.currentTime)*(1/fo.speed)}function P(J,X,ee=!1){X&&(f.reversed?X.seek(X.duration*X.loop-(J-X.timelineOffset-X.pingPongDelayCorrection),ee):X.seek(J-X.timelineOffset-X.startOnceDelay-X.pingPongDelayCorrection,ee))}function O(J,X=!1){if(f.reversed)for(var ee=c;ee--;)P(J,n[ee],X);else for(var oe=0;oe<c;oe++)P(J,n[oe],X)}function k(J){var X=0,ee=f.animations,oe=ee.length;for(f.direction!=="alternate"&&f.parent?.direction==="alternate"?f.parent?.rewind===!1&&f.reversePlayback===!0&&f.rewind===!1&&(f.parent?.reversed&&f.direction==="alternate"?J=f.duration-f.delay+f.endDelay-J:J=f.duration+f.delay-f.endDelay-J):$(!1,f.parent?.rewind,f.rewind,f.parent?.reversePlayback,f.reversePlayback)&&(f.parent?.reversed&&f.direction==="alternate"?J=f.duration-f.delay+f.endDelay-J:J=f.duration+f.delay-f.endDelay-J);X<oe;){var le=ee[X],ve=le.animatable,we=le.tweens,fe=we.length-1,Ue=we[fe];fe&&(Ue=UI(we,function(Mt){return J<Mt.end})[0]||Ue);let Nt;f.parent?.reversed&&f.direction==="alternate"?Nt=Wu(J-Ue.start-Ue.endDelay,0,Ue.duration)/Ue.duration:Nt=Wu(J-Ue.start-Ue.delay,0,Ue.duration)/Ue.duration;for(var Fe=isNaN(Nt)?1:Ue.easing(Nt),Pe=Ue.to.strings,Ae=Ue.round,et=[],$e=Ue.to.numbers.length,rt=void 0,Je=0;Je<$e;Je++){var bt=void 0;let Mt,li;f.direction!=="alternate"?f.parent?.rewind===!1&&f.reversePlayback===!0&&f.rewind===!1?(Mt=Ue.to.numbers[Je],li=Ue.from.numbers[Je]||0):(li=Ue.to.numbers[Je],Mt=Ue.from.numbers[Je]||0):$(!0,f.parent?.rewind,f.rewind,f.parent?.reversePlayback,f.reversePlayback)?(Mt=Ue.to.numbers[Je],li=Ue.from.numbers[Je]||0):(li=Ue.to.numbers[Je],Mt=Ue.from.numbers[Je]||0),Ue.isPath?bt=cNe(Ue.value,Fe*li):bt=Mt+Fe*(li-Mt),Ae&&(Ue.isColor&&Je>2||(bt=Math.round(bt*Ae)/Ae)),et.push(bt)}var ot=Pe.length;if(!ot)rt=et[0];else{rt=Pe[0];for(var xt=0;xt<ot;xt++){var Xe=Pe[xt],kt=Pe[xt+1],yt=et[xt];isNaN(yt)||(kt?rt+=yt+kt:rt+=yt+" ")}}yie[le.type](ve.target,le.property,rt,ve.transforms),le.currentValue=rt,X++}}function U(J){f[J]&&!f.passThrough&&f[J](f)}function j(){f.remaining&&f.remaining!==!0&&f.remaining--}let V={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function $(J,X,ee,oe,le){return V[J<<4|X<<3|ee<<2|oe<<1|le]}function Y(J,X=!1){var ee=f.duration;let oe=f.delay,le=ee-f.endDelay;f.parent?.reversed&&f.direction==="alternate"&&(oe=f.endDelay,le=ee-f.delay);var ve=A(J);if(f.progress=Wu(ve/ee*100,0,100),X||(f.reversePlayback=ve<f.currentTime),c&&O(ve,X),!f.began&&f.currentTime>=0&&(f.began=!0,U("begin")),!f.loopBegan&&f.currentTime>0&&(f.loopBegan=!0,U("loopBegin")),(f.reversed||ve>=0)&&ve<=oe&&f.currentTime!==0&&(k(0),U("change")),(ve>=le&&f.currentTime!==ee+f.pingPongDelayCorrection||!ee)&&(k(ee),U("change")),ve>oe&&ve<le?(f.changeBegan||(f.changeBegan=!0,f.changeCompleted=!1,U("changeBegin")),k(ve),U("change")):f.changeBegan?(f.changeCompleted=!0,f.changeBegan=!1,U("change"),c&&U("timelineChangeComplete")):f.began&&ve>le&&U("changeComplete"),f.currentTime=Wu(ve,0,ee+f.pingPongDelayCorrection),f.began&&U("update"),J>=ee)if(j(),!f.remaining)f.paused=!0,f.completed||(f.completed=!0,U("loopComplete"),U("complete"),!f.passThrough&&"Promise"in window&&(u(),x=p(f)));else{c?t+=f.duration/fo.speed:t+=f.duration;for(let we of n)we.setStartTime(0),we.remaining=we.loop;U("loopComplete"),f.loopBegan=!1,f.direction==="alternate"?w():c&&E()}}return f.reset=function(){var J=f.direction;f.passThrough=!1,f.currentTime=0,f.progress=0,f.paused=!0,f.began=!1,f.loopBegan=!1,f.changeBegan=!1,f.completed=!1,f.changeCompleted=!1,f.reversePlayback=!1,f.reversed=J==="reverse",f.remaining=f.loop,n=f.children,c=n.length;for(var X=c;X--;)f.children[X].reset();k(f.reversed?f.duration:0)},f.setStartTime=function(J){t=J},f.set=function(J,X){return vie(J,X),f},f.tick=function(J){r=J,t||(t=r),Y((r+(i-t))*fo.speed)},f.seek=function(J,X=!1){Y(J-t,X)},f.pause=function(J){f.paused=!0,c&&(s=J??performance.now())},f.play=function(J){!f.paused||(f.completed&&f.reset(),f.paused=!1,Kc.push(f),c&&s!==void 0&&(t+=(J??performance.now())-s),hD||vNe())},f.reverse=function(){w(),f.completed=!f.reversed,I()},f.restart=function(){f.reset(),f.play()},f.reset(),f.autoplay&&f.play(),f}function ZZ(e,t){for(var i=t.length;i--;)NU(e,t[i].animatable.target)&&t.splice(i,1)}function xNe(e){for(var t=mie(e),i=Kc.length;i--;){var r=Kc[i],s=r.animations,n=r.children;ZZ(t,s);for(var c=n.length;c--;){var u=n[c],p=u.animations;ZZ(t,p),!p.length&&!u.children.length&&n.splice(c,1)}!s.length&&!n.length&&r.pause()}}function bNe(e,t){t===void 0&&(t={});var i=t.direction||"normal",r=t.easing?kU(t.easing):null,s=t.grid,n=t.axis,c=t.from||0,u=c==="first",p=c==="center",f=c==="last",x=zr.arr(e),w=parseFloat(x?e[0]:e),E=x?parseFloat(e[1]):0,A=bp(x?e[1]:e)||0,I=t.start||0+(x?w:0),P=[],O=0;return function(k,U,j){if(u&&(c=0),p&&(c=(j-1)/2),f&&(c=j-1),!P.length){for(var V=0;V<j;V++){if(!s)P.push(Math.abs(c-V));else{var $=p?(s[0]-1)/2:c%s[0],Y=p?(s[1]-1)/2:Math.floor(c/s[0]),J=V%s[0],X=Math.floor(V/s[0]),ee=$-J,oe=Y-X,le=Math.sqrt(ee*ee+oe*oe);n==="x"&&(le=-ee),n==="y"&&(le=-oe),P.push(le)}O=Math.max.apply(Math,P)}r&&(P=P.map(function(we){return r(we/O)*O})),i==="reverse"&&(P=P.map(function(we){return n?we<0?we*-1:-we:Math.abs(O-we)}))}var ve=x?(E-w)/O:w;return I+ve*(Math.round(P[U]*100)/100)+A}}function wNe(e){e===void 0&&(e={});var t=fo(e);return t.duration=0,t.add=function(i,r){var s=Kc.indexOf(t),n=t.children;s>-1&&Kc.splice(s,1);function c(E){E.passThrough=!0}for(var u=0;u<n.length;u++)c(n[u]);var p=VI(i,r4(FU,e));p.targets=p.targets||e.targets;var f=t.duration;p.autoplay=!1,p.timelineOffset=zr.und(r)?f:GU(r,f),c(t);var x=fo(p);c(x),n.push(x),x.parent=t;var w=_ie(n,e);return t.delay=w.delay,t.endDelay=w.endDelay,t.duration=w.duration,x.loop===!0&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t}fo.version="3.2.0";fo.speed=1;fo.running=Kc;fo.remove=xNe;fo.get=VU;fo.set=vie;fo.convertPx=UU;fo.path=lNe;fo.setDashoffset=oNe;fo.stagger=bNe;fo.timeline=wNe;fo.easing=kU;fo.penner=aie;fo.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var xie=fo,QZ=new se,KZ=new se,JZ=new Vr;function SNe(e,t,i,r){if(r===0)return i.copy(e);if(r===1)return i.copy(t);let s=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(s>=1)return i.copy(e);let n=1-s*s;if(n<=Number.EPSILON){let x=1-r;return i.w=x*e.w+r*t.w,i.x=x*e.x+r*t.x,i.y=x*e.y+r*t.y,i.z=x*e.z+r*t.z,i.normalize(),i}let c=Math.sqrt(n),u=Math.atan2(c,s),p=Math.sin((1-r)*u)/c,f=Math.sin(r*u)/c;return i.w=e.w*p+t.w*f,i.x=e.x*p+t.x*f,i.y=e.y*p+t.y*f,i.z=e.z*p+t.z*f,i}function Ca(e,t,i,r,s,n){let c=i[e]!==void 0?i[e]:void 0,u=r[e];if(u==null)return;let p=c!=null?typeof c=="string"?Number(s.getVariable(c)??0):c:t[e],f=typeof u=="string"?Number(s.getVariable(u)??0):u;if(p!==f)return{update:x=>{let w=Yi.lerp(p,f,x);n?t[e]=Math.trunc(w):t[e]=w},start:()=>{t[e]=p},end:()=>{t[e]=f}}}function WU(e,t,i,r,s,n){let c=i[e]?i[e]:void 0,u=r[e];if(!u)return;let p=t[e],f=[...c??p].map(w=>typeof w=="string"?Number(s.getVariable(w)??0):w),x=[...u].map(w=>typeof w=="string"?Number(s.getVariable(w)??0):w);if(!(f.length!==x.length||H4(f,x)))return{update:w=>{f.forEach((E,A)=>{let I=Yi.lerp(E,x[A],w);t[e][A]=n?Math.trunc(I):I})},start:()=>{Object.assign(t[e],f)},end:()=>{Object.assign(t[e],x)}}}function pI(e,t,i){return t.forEach((r,s)=>{e.setComponent(s,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function eQ(e,t,i,r,s){let n=i[e]?i[e]:void 0,c=r[e];if(!c)return;let u=t[e],p=n?pI(new se,n,s):u.clone(),f=pI(new se,c,s);if(!p.equals(f))return{update:x=>{u.lerpVectors(p,f,x)},start:()=>{u.copy(p)},end:()=>{u.copy(f)}}}function tQ(e,t,i){return t.forEach((r,s)=>{e.setComponent(s,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function fI(e,t,i,r,s){let n=i[e]?i[e]:void 0,c=r[e];if(!c)return;let u=t[e],p=!(u instanceof lt),f=u instanceof lt?u:new lt().fromArray(u),x=n?tQ(new lt,n,s):f.clone(),w=tQ(new lt,c,s);if(!x.equals(w))return{update:E=>{f.lerpVectors(x,w,E),p&&(t[e]=f.toArray())},start:()=>{f.copy(x),p&&(t[e]=f.toArray())},end:()=>{f.copy(w),p&&(t[e]=f.toArray())}}}function ENe(e,t,i,r){let s=i[e]?i[e]:void 0,n=r[e];if(!n)return;let c=t[e],u=s?new mi().fromArray(s):c.clone(),p=new se,f=new Vr,x=new se;u.decompose(p,f,x);let w=new mi().fromArray(n),E=new se,A=new Vr,I=new se;if(w.decompose(E,A,I),!u.equals(w))return{update:P=>{JZ.slerpQuaternions(f,A,P),QZ.lerpVectors(p,E,P),KZ.lerpVectors(x,I,P),c.compose(QZ,JZ,KZ)},start:()=>{c.compose(p,f,x)},end:()=>{c.compose(E,A,I)}}}function MNe(e,t,i,r,s){let n=i[e]?i[e]:void 0,c=r[e];if(!c)return;let u=t[e],p=n?typeof n=="string"?s.getColor(n).clone():new Tr().setRGB(n.r,n.g,n.b):u.clone(),f=typeof c=="string"?s.getColor(c).clone():new Tr().setRGB(c.r,c.g,c.b);if(p.equals(f))return;let x=u.clone();return t[e]=x,{update:w=>{x.lerpColors(p,f,w)},start:()=>{x.copy(p)},end:()=>{x.copy(f)}}}function W2(e,t,i,r,s){let n=i[e]?i[e]:void 0,c=r[e];if(!c)return;let u=t[e],p=new La(u.r,u.g,u.b,u.a),f=n?typeof n=="string"?s.getColor(n).clone():new La(n.r,n.g,n.b,n.a):p.clone(),x=typeof c=="string"?s.getColor(c).clone():new La(c.r,c.g,c.b,c.a);if(!f.equals(x))return{update:w=>{p.lerpColors(f,x,w);let E=Yi.lerp(f.a,x.a,w);p.a=E,t[e]={r:p.r,g:p.g,b:p.b,a:p.a}},start:()=>{p.copy(f)},end:()=>{p.copy(x)}}}function wm(e,t,i,r,s){if(typeof t[e]=="number")return Ca(e,t,i??{},r,s);if(Array.isArray(t[e]))return WU(e,t,i??{},r,s)}function TNe(e,t,i,r){let s=[],n=e.cameraType==="OrthographicCamera"?t.orthographic?.zoom:t.perspective?.zoom,c=e.cameraType==="OrthographicCamera"?i.orthographic?.zoom:i.perspective?.zoom;if(c!==void 0){let u=n??e.zoom,p=c;u!==p&&s.push({update:f=>{e.zoom=Yi.lerp(u,p,f),e.updateProjectionMatrix()},start:()=>{e.zoom=u,e.updateProjectionMatrix()},end:()=>{e.zoom=p,e.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let u=Ca("targetOffset",e,t,i,r);u&&s.push(u)}return s}function ANe(e,t,i,r){if(i.scaleBaked===void 0)return;let s=(t.scaleBaked??e.data.geometry.scaleBaked).map(u=>typeof u=="string"?Number(r.getVariable(u)??0):u),n=i.scaleBaked.map(u=>typeof u=="string"?Number(r.getVariable(u)??0):u);if(Ly.isEqual(s,n))return;let c=[];return c.push({update:u=>{e.updateGeometryInteractions({scaleBaked:[Yi.lerp(s[0],n[0],u),Yi.lerp(s[1],n[1],u),Yi.lerp(s[2],n[2],u)]},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},start:()=>{e.updateGeometryInteractions({scaleBaked:s},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},end:()=>{e.updateGeometryInteractions({scaleBaked:n},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()}}),c}function CNe(e,t,i,r){if(!i.extrusion)return;let s=e.extrusion,n=t.extrusion??{},c=i.extrusion,u=[];return tee.forEach(p=>{let f=wm(p,s,n,c,r);f&&u.push(f)}),u}function DNe(e,t,i,r){let s=[];if(!("geometry"in i))return s;let n=e.geometry.userData.parameters,c="geometry"in t?t.geometry:{},u=i.geometry;if(e instanceof NS){let p=ANe(e,c,u,r);p&&s.push(...p)}else{let p={};if(Object.assign(p,_p(n,DX)),DX.forEach(f=>{let x=wm(f,p,c,u,r);x&&s.push(x)}),e instanceof DU){Object.assign(p,{extrusion:me({},n.extrusion)});let f=CNe(p,c,u,r);f&&s.push(...f)}s.length&&s.push({update:f=>{e.updateGeometryInteractions(p,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},start:f=>{e.updateGeometryInteractions(p,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},end:f=>{e.updateGeometryInteractions(p,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()}})}return s}function INe(e,t,i,r){let s=[];if(i.intensity!==void 0){let n=Ca("intensity",e,t,i,r);n&&s.push(n)}if(i.color!==void 0){let n=MNe("color",e,t,i,r);n&&s.push(n)}return s}function PNe(e,t,i,r){let s=[];if(Array.isArray(e.material)){if(!("materials"in i&&i.materials))return s;let n="materials"in t&&t.materials?t.materials:[],c=i.materials;e.material.forEach((u,p)=>{if(!c[p])return;let f=n[p]??{},x=c[p];typeof f=="string"||typeof x=="string"||s.push(...iQ(u,f,x,r))})}else{if(!("material"in i&&i.material))return s;let n="material"in t&&t.material?t.material:{},c=i.material;if(typeof n=="string"||typeof c=="string")return s;s.push(...iQ(e.material,n,c,r))}return s}function iQ(e,t,i,r){let s=[],n=q_(i,r)||!!t.layers&&q_(t,r);s.push(UNe(e,n));for(let c of e.layers){let u=t.layers?.data(c.uuid),p=i.layers.data(c.uuid);if(!p||c.type!=="light"&&(!(c.visible??!0)||!(p.visible??!0)))continue;let f=c.getNames().filter(x=>!KJ.some(w=>x.includes(w)));for(let x of f)try{let w=c.getValue(x),E;if(x==="colors")E=NNe(c,u,p,x);else if(Array.isArray(w))x==="steps"&&(E=kNe(c,u,p,x));else if(typeof w=="number")E=RNe(c,u,p,x,r);else{if(typeof w=="boolean")continue;w instanceof lt?E=ONe(c,u,p,x):w instanceof se?E=LNe(c,u,p,x,r):w instanceof La?E=FNe(c,u,p,x,r):w instanceof Tr?E=zNe(c,u,p,x,r):"isTexture"in w&&(E=BNe(c,u,p,x))}E&&(Array.isArray(E)?s.push(...E):s.push(E))}catch(w){console.error(`lerpMaterial: unexpected material layer for ${x}`,w)}}return s}function RNe(e,t,i,r,s){if(!e.hasValue(r)||!(r in i))return;let n=t?t[r]:e.getValue(r),c=i[r],u=typeof n=="string"?Number(s.getVariable(n)??0):n,p=typeof c=="string"?Number(s.getVariable(c)??0):c;if(u!==p)return{update:f=>{e.setValue(r,Yi.lerp(u,p,f))},start:()=>{e.setValue(r,u)},end:()=>{e.setValue(r,p)}}}function ONe(e,t,i,r){if(!e.hasValue(r)||!(r in i))return;let s=e.getValue(r),n=t?new lt().fromArray(t[r]):s.clone(),c=new lt().fromArray(i[r]);if(!n.equals(c))return{update:u=>{s.lerpVectors(n,c,u)},start:()=>{s.copy(n)},end:()=>{s.copy(c)}}}function LNe(e,t,i,r,s){if(!e.hasValue(r)||!(r in i))return;let n=e.getValue(r),c=t?t[r]:void 0,u=i[r],p=c?pI(new se,c,s):n.clone(),f=pI(new se,u,s);if(!p.equals(f))return{update:x=>{n.lerpVectors(p,f,x)},start:()=>{n.copy(p)},end:()=>{n.copy(f)}}}function zNe(e,t,i,r,s){if(!e.hasValue(r)||!(r in i))return;let n=t?t[r]:void 0,c=i[r],u=e.getValue(r),p=n?typeof n=="string"?s.getColor(n).clone():new Tr().setRGB(n.r,n.g,n.b):u.clone(),f=typeof c=="string"?s.getColor(c).clone():new Tr().setRGB(c.r,c.g,c.b);if(p.equals(f))return;let x=u.clone();return{update:w=>{e.getValue(r)!==x&&e.setValue(r,x),x.lerpColors(p,f,w)},start:()=>{x.copy(p)},end:()=>{x.copy(f)}}}function FNe(e,t,i,r,s){if(!e.hasValue(r)||!(r in i))return;let n=t?t[r]:void 0,c=i[r],u=e.getValue(r),p=n?typeof n=="string"?s.getColor(n).clone():new Tr().setRGB(n.r,n.g,n.b):u.clone(),f=typeof c=="string"?s.getColor(c).clone():new La(c.r,c.g,c.b,c.a);if(p.equals(f))return;let x=u.clone();return{update:w=>{e.getValue(r)!==x&&e.setValue(r,x),x.lerpColors(p,f,w)},start:()=>{x.copy(p)},end:()=>{x.copy(f)}}}function kNe(e,t,i,r="steps"){if(!e.hasValue(r)||!(r in i))return;let s=[],n=e.getValue(r),c=t?t[r]:n,u=i[r];return H4(c,u)||s.push({update:p=>{let f=[...n];for(let x=0;x<n.length;++x){let w=c[x],E=u[x];f[x]=Yi.lerp(w,E,p)}e.setValue(r,f)},start:()=>{e.setValue(r,c)},end:()=>{e.setValue(r,u)}}),s.length?s:void 0}function NNe(e,t,i,r="colors"){if(!e.hasValue(r)||!(r in i))return;let s=[],n=e.getValue(r),c=t?t[r]:n.map(p=>p.toArray()),u=i[r];for(let p=0;p<n.length;++p){let f=[...c[p]],x=[...u[p]];jD.isEqual(f,x)||s.push({update:w=>{n[p].fromArray(jD.lerp(f,x,w))},start:()=>{n[p].fromArray(f)},end:()=>{n[p].fromArray(x)}})}return s.length?s:void 0}function BNe(e,t,i,r="texture"){if(!e.hasValue(r)||!(r in i))return;let s=e.getNode("rotation"),n=t?.[r]?.rotation??0,c=i[r]?.rotation??0;if(s&&n!==c)return{update:O=>{s.value=Yi.lerp(n,c,O)*Yi.DEG2RAD},start:()=>{s.value=n*Yi.DEG2RAD},end:()=>{s.value=c*Yi.DEG2RAD}};let u=e.getNode("mat");if(!u)return;let p=t?t[r]:u,f=i[r],x=[...p.repeat],w=[...p.offset],E=[...f.repeat],A=[...f.offset],I=p.rotation??0,P=f.rotation??0;if(!yp.isEqual(x,E)||!yp.isEqual(w,A)||I!==P)return{update:O=>{u.repeat=yp.lerp(x,E,O),u.offset=yp.lerp(w,A,O),u.rotation=Yi.lerp(I,P,O),u.updateMatrix()},start:()=>{u.repeat=[...x],u.offset=[...w],u.rotation=I,u.updateMatrix()},end:()=>{u.repeat=[...E],u.offset=[...A],u.rotation=P,u.updateMatrix()}}}function UNe(e,t){return{update:()=>{e.transparent=t}}}var Wk=new se,rQ=new $o;function jNe(e,t,i,r,s){let n=[],c,u,p,f,x,w,E,A;if(e instanceof ya?(c=fI("position",e,t,i,s),c&&n.push(c),p=Ca("rotation",e,t,i,s),p&&n.push(p),f=fI("shear",e,t,i,s),f&&n.push(f)):(A={slide:t.pathSnapping?.slide??e.updatedPathSnapping?.slide??e.dataPatched.pathSnapping?.slide??0,offset:t.pathSnapping?.offset??e.updatedPathSnapping?.offset??e.dataPatched.pathSnapping?.offset??0},w=Ca("slide",A,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,s),w&&n.push(w),E=Ca("offset",A,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,s),E&&n.push(E),!w&&!E&&(c=eQ("position",e,t,i,s),c&&n.push(c),u=eQ("scale",e,t,i,s),u&&n.push(u),p=VNe(e,t,i,r,s),p&&n.push(p),x=ENe("hiddenMatrix",e,t,i),x&&n.push(x))),c||u||p||x||w||E){let I=e instanceof ya?()=>{e.updateWorldMatrix(!0)}:()=>{e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),e.parent?.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),Uu(e)&&vp(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,A))};n.push({update:I,start:I,end:I})}return n}function VNe(e,t,i,r,s){let n=t?.rotation?t.rotation.map(x=>(typeof x=="string"?Number(s.getVariable(x)??0):x)*Yi.DEG2RAD):void 0,c=i.rotation?.map(x=>(typeof x=="string"?Number(s.getVariable(x)??0):x)*Yi.DEG2RAD);if(!c)return;let u=n?new se().fromArray(n):new se().setFromEuler(e.rotation),p=new se().fromArray(c);if(u.equals(p))return;let f=Wk.subVectors(p,u);if(r&&f.toArray().every(x=>Math.abs(x)<2*Math.PI)){let x=new Vr().setFromEuler(rQ.setFromVector3(u)),w=new Vr().setFromEuler(rQ.setFromVector3(p));return{update:E=>{SNe(x,w,e.quaternion,E)},start:()=>{e.rotation.setFromVector3(u)},end:()=>{e.rotation.setFromVector3(p)}}}else return{update:x=>{Wk.lerpVectors(u,p,x),e.rotation.setFromVector3(Wk)},start:()=>{e.rotation.setFromVector3(u)},end:()=>{e.rotation.setFromVector3(p)}}}function GNe(e,t,i,r){let s=[];if(!("cloner"in i)||!e.cloner)return s;let n=e.cloner,c="cloner"in t?t.cloner:{},u=i.cloner;qJ.forEach(A=>{let I;A==="count"?I=Ca("count",n.parameters,c,u,r,!0):I=wm(A,n.parameters,c??{},u,r),I&&s.push(I)});let p=HNe(n,c,u,r);p?.length&&s.push(...p);let f=WNe(n,c,u,r);f?.length&&s.push(...f);let x=qNe(n,c,u,r);x?.length&&s.push(...x);let w=YNe(n,c,u,r);w?.length&&s.push(...w);let E=XNe(n,c,u,r);return E?.length&&s.push(...E),s.length&&s.push({update:()=>{n.update()}}),s}function HNe(e,t,i,r){if(e.parameters.type!=="radial")return;let s=t.radial,n=i.radial;if(!n)return;let c=e.parameters.radial,u=[];return YJ.forEach(p=>{let f=wm(p,c,s??{},n,r);f&&u.push(f)}),u}function WNe(e,t,i,r){if(e.parameters.type!=="linear")return;let s=t.linear,n=i.linear;if(!n)return;let c=[],u=e.parameters.linear;return XJ.forEach(p=>{let f=wm(p,u,s??{},n,r);f&&c.push(f)}),c}function qNe(e,t,i,r){if(e.parameters.type!=="grid")return;let s=t.grid,n=i.grid;if(!n)return;let c=[],u=e.parameters.grid;return $J.forEach(p=>{let f;p==="count"?f=WU(p,u,s??{},n,r,!0):f=wm(p,u,s??{},n,r),f&&c.push(f)}),c}function YNe(e,t,i,r){if(e.parameters.type!=="toObject")return;let s=t.toObject,n=i.toObject;if(!n)return;let c=[],u=e.parameters.toObject;return ZJ.forEach(p=>{let f;p==="count"?f=Ca(p,u,s??{},n,r,!0):f=wm(p,u,s??{},n,r),f&&c.push(f)}),c}function XNe(e,t,i,r){if(!e.parameters.randomness)return;let s=t.randomnessObject,n=i.randomnessObject;if(!n)return;let c=[],u=e.parameters.randomnessObject;return QJ.forEach(p=>{let f=wm(p,u,s??{},n,r);f&&c.push(f)}),c}function $Ne(e,t){return{update:()=>{e instanceof ha&&(e.fill.enabled=t)}}}function ZNe(e,t){return{update:()=>{e instanceof ha&&(e.stroke.enabled=t)}}}function QNe(e,t){return{update:()=>{e instanceof ha&&(e.dropShadow.enabled=t)}}}function KNe(e,t){return{update:()=>{e instanceof ha&&(e.innerShadow.enabled=t)}}}function JNe(e,t){return{update:()=>{e instanceof ha&&(e.backgroundBlur.enabled=t)}}}function eBe(e,t){return{update:()=>{e instanceof ha&&(e.layerBlur.enabled=t)}}}function tBe(e,t,i,r,s){let n=[],c,u,p,f,x,w,E,A,I,P,O,k,U,j,V;if("width"in e&&(c=Ca("width",e,t,i,s),c&&n.push(c)),"height"in e&&(u=Ca("height",e,t,i,s),u&&n.push(u)),e instanceof ha||e instanceof Jh){let $=me({},t.fill),Y=me({},i.fill);$.enabled!==void 0&&$.enabled!==Y.enabled&&(n.push($Ne(e,!0)),$.enabled||Object.assign($,{enabled:!0,color:pt(me({},$.color),{a:0})}),Y.enabled||Object.assign(Y,{enabled:!0,color:pt(me({},Y.color),{a:0})})),p=W2("color",e.fill,$,Y,s),p&&n.push(p)}if(e instanceof ha){let $=me({},t.stroke),Y=me({},i.stroke);($.enabled||Y.enabled)&&(n.push(ZNe(e,!0)),$.enabled||Object.assign($,{enabled:!0,color:pt(me({},$.color),{a:0})}),Y.enabled||Object.assign(Y,{enabled:!0,color:pt(me({},Y.color),{a:0})})),f=W2("color",e.stroke,$,Y,s),f&&n.push(f),x=Ca("thickness",e.stroke,$,Y,s),x&&n.push(x)}if(e instanceof ha){let $=me({},t.dropShadow),Y=me({},i.dropShadow);($.enabled||Y.enabled)&&(n.push(QNe(e,!0)),$.enabled||Object.assign($,{enabled:!0,color:pt(me({},$.color),{a:0})}),Y.enabled||Object.assign(Y,{enabled:!0,color:pt(me({},Y.color),{a:0})})),w=W2("color",e.dropShadow,$,Y,s),w&&n.push(w),E=Ca("blurRadius",e.dropShadow,$,Y,s),E&&n.push(E),I=Ca("spread",e.dropShadow,$,Y,s),I&&n.push(I),A=fI("offset",e.dropShadow,$,Y,s),A&&n.push(A)}if(e instanceof ha){let $=me({},t.innerShadow),Y=me({},i.innerShadow);($.enabled||Y.enabled)&&(n.push(KNe(e,!0)),$.enabled||Object.assign($,{enabled:!0,color:pt(me({},$.color),{a:0})}),Y.enabled||Object.assign(Y,{enabled:!0,color:pt(me({},Y.color),{a:0})})),P=W2("color",e.innerShadow,$,Y,s),P&&n.push(P),O=Ca("blurRadius",e.innerShadow,$,Y,s),O&&n.push(O),U=Ca("spread",e.innerShadow,$,Y,s),U&&n.push(U),k=fI("offset",e.innerShadow,$,Y,s),k&&n.push(k)}if(e instanceof ha||e instanceof Jh){let $=me({},t.backgroundBlur),Y=me({},i.backgroundBlur);($.enabled||Y.enabled)&&(n.push(JNe(e,!0)),$.enabled||Object.assign($,{enabled:!0,radius:0}),Y.enabled||Object.assign(Y,{enabled:!0,radius:0})),j=Ca("radius",e.backgroundBlur,$,Y,s),j&&n.push(j)}if(e instanceof ha){let $=me({},t.layerBlur),Y=me({},i.layerBlur);($.enabled||Y.enabled)&&(n.push(eBe(e,!0)),$.enabled||Object.assign($,{enabled:!0,radius:0}),Y.enabled||Object.assign(Y,{enabled:!0,radius:0})),V=Ca("radius",e.layerBlur,$,Y,s),V&&n.push(V)}if(e instanceof Jh||e instanceof tE){let $=WU("cornerRadius",e,t,i,s);$&&n.push($)}return n}function nQ(e,t,i,r,s){let n=[];return e.data.visible&&n.push(...jNe(e,t,i,s,r)),e instanceof ya?n.push(...tBe(e,t,i,s,r)):(e.data.visible&&n.push(...GNe(e,t,i,r)),Uu(e)?(e instanceof Ya&&e.data.visible&&n.push(...DNe(e,t,i,r)),e.data.visible&&n.push(...PNe(e,t,i,r))):$3e(e)?e.data.visible&&n.push(...INe(e,t,i,r)):X3e(e)&&n.push(...TNe(e,t,i,r))),n.length?{update:c=>{n.forEach(u=>u.update(c))},start:c=>{n.forEach(u=>u.start?.(c))},end:c=>{n.forEach(u=>u.end?.(c))}}:void 0}var sQ=new se;function qU(e,t,i=!1){let r=[],s=n=>{let c=n.data;delete n.states,n.currentState=null,n.reversibleToState=null,n.currentTransitionEvent=null;for(let u of c.states){let p=me({},u.data);n.states||(n.states={}),n.states[u.id]=Ty.patch(c,p)}aQ(e.scene,n,null,t,c.events.find(u=>u.data.type==="Follow"||u.data.type==="LookAt")!==void 0),oQ(e)};e.scene.traverse2D(s),e.traverseChildren(n=>{if(i&&(n.rigidBody?.setTranslation(n.position0,!0),n.rigidBody?.setRotation(n.rotation0,!0),n.rigidBody?.setLinvel(sQ,!0),n.rigidBody?.setAngvel(sQ,!0)),!Ln.is(n))return;let c=n.uuid,u=n.data;if(delete n.states,n.uuid===Lx)return;let p=!1;r.some(f=>e.scene.find(c)?.isDescendantOf(f))?p=!0:u.physics?.fusedBody===!0&&u.physics.rigidBody==="dynamic"&&r.push(c),n.data=u,n.currentState=null,n.reversibleToState=null,n.currentTransitionEvent=null;for(let f of u.states){let x=me({},f.data);e.data.globalPhysics.usePhysics===!0&&u.physics&&(u.physics.rigidBody==="dynamic"||p)&&(f.data.position!==void 0&&delete x.position,f.data.rotation!==void 0&&delete x.rotation,f.data.hiddenMatrix!==void 0&&delete x.hiddenMatrix),n.states||(n.states={}),n.states[f.id]=Sy.patch(u,x)}aQ(e.scene,n,null,t,u.events.find(f=>f.data.type==="Follow"||f.data.type==="LookAt")!==void 0),oQ(e),n instanceof Ha&&n.frame&&(n.frame.traverse(f=>s(f)),n.uiCanvas?.applySize())}),e.frame&&(e.frame.traverse(n=>s(n)),e.uiCanvas?.applySize())}function oQ(e){e.traverseEntity(t=>{for(let i of t.data.events){let r=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":r.push(...i.data.actions);break;case"GameControl":for(let s of Object.values(i.data.gameActions))r.push(...s);break;case"DragDrop":r.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":r.push(...i.data.inActions,...i.data.outActions);break}for(let s of r)if(s.data.type==="Create"&&s.data.hideBase==="Yes"){let n=e.scene.find(s.data.object);n&&(n.visible=!1)}}})}function aQ(e,t,i,r,s=!1){if(t instanceof Ya&&t.removeInteractionGeometry(r),t instanceof ya?t.changeSelectedState(i,{shared:r},s):t.changeSelectedState(i,{scene:e,shared:r},s),t instanceof Ya&&t.updateGeometryGroupsIfNeeded(),t instanceof Xa&&t.updateCameraState(t.dataPatched,{scene:e,shared:r}),!(t instanceof ya)){if(t.cloner)for(let n of t.cloner.children)n.playModeVisible=void 0;t.updateVisible()}}function bie(e){let t;if(e.easing===5){let{control1:i,control2:r}=e;t=`cubicBezier(
			${i[0]}, ${i[1]}, ${r[0]}, ${r[1]}
		)`}else if(e.easing===6){let{mass:i,stiffness:r,damping:s,velocity:n}=e;t=`spring( ${i}, ${r}, ${s}, ${n} )`}else{let i;switch(e.easing){case 0:i=Kf.linear;break;case 1:i=Kf.ease;break;case 2:i=Kf.easeIn;break;case 3:i=Kf.easeOut;break;case 4:i=Kf.easeInOut;break;default:i=Kf.linear}let[r,s,n,c]=i;t=`cubicBezier( ${r}, ${s}, ${n}, ${c} )`}return{duration:Math.max(e.duration,1e-4),easing:t}}function s4(e){let t={delay:0,loop:e.repeat===-1?!0:e.repeat+1};if(e.repeat===0)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1;break}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay;break}return t.direction==="alternate"&&(t.delay/=2,t.endDelay/=2,e.delayDirection==="start"?(t.pingPongDelayCorrection=t.delay,typeof t.loop=="number"&&t.loop%2===0&&(t.pingPongEndDelayCorrection=t.delay)):e.delayDirection==="end"?typeof t.loop=="number"&&t.loop%2!==0&&(t.pingPongEndDelayCorrection=t.endDelay):e.delayDirection==="start-end"&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var iBe={type:"beginState"},rBe={type:"completeState",isfromEntity:!1},lQ=class{constructor(e,t,i,r,s,n){if(this.object=e,this.data=r,this.sharedAssets=s,this.allowSlerp=n,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let c=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=c,this.object.dispatchEvent({type:"beginState",state:c}),this.object instanceof ya||this.object.traverseEntity(u=>{u!==this.object&&u instanceof Xa&&u.dispatchEvent(iBe)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let c=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=c,this.object.dispatchEvent({type:"completeState",state:c}),this.object instanceof ya||this.object.traverseEntity(u=>{u!==this.object&&u instanceof Xa&&u.dispatchEvent(rBe)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=nQ(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},t===void 0){let c=dD(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!c)throw new Error("Missing property");this.from=c}else{let c=dD(this.object,t);if(!c)throw new Error("Missing property");this.from=c}if(i===void 0)throw new Error("Missing property");{let c=dD(this.object,i);if(!c)throw new Error("Missing property");this.to=c}this.useCurrentState=t===void 0||i===void 0,this.params=pt(me(me({targets:this.targets,t:1,autoplay:!1},s4(r)),bie(r)),{change:this.onChange}),this.callback=nQ(this.object,t===void 0?{}:this.from.data,i===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},wie=class extends za{constructor(e,t,i,r,s){if(super(),this.eventType=e,this.data=t,this.page=i,this.shared=r,this.condition=s,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.hasPlayedOnce=!1,this.onTimelineChangeComplete=()=>{this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!t.object)throw new Error("Missing property");let n=this.page.scene.find(t.object)??this.page.uiCanvas?.find(t.object)??this.page.scene.find2DInUIObjects(t.object);if(!n)throw new Error("Missing property");if(!n.states)throw new Error("Missing property");if(this.object=n,t.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=t.tweens[0].data.delayDirection==="start-once"?t.tweens[0].data.delay:0,this.init()}get playing(){return this.timeline?.paused===!1}get changeBegan(){return this.tweens.some(e=>e.changeBegan)??!1}init(){this.initialCurrentState=dD(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.data.runMode==="Toggle"&&uX(this.eventType)?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:e=!0,needsRebuild:t=!1,isRebuild:i=!1}={}){try{let r=s4(this.data.tweens[0].data);i&&typeof r.loop=="number"&&r.loop--,this.timeline?.pause(),this.timeline=xie.timeline(me(me({autoplay:!1},r),r.loop===!0||r.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}));let s=this.tweens.findIndex(n=>n?.changeBegan);if(t===!0&&(this.timelineNeedsRebuild=!0),e){let n=s===-1?0:s;for(let c=n;c<this.data.tweens.length-1;c++){let u=this.data.tweens[c],p=this.data.tweens[c+1],f;c===n&&(this.object.wasMovedByUser===!0||this.object.previousAction?.changeBegan===!0)?(f=void 0,this.object instanceof Xa&&(this.object.wasMovedByUser=!1)):f=u.data.state===void 0?this.currentState:u.data.state;let x=new lQ(this.object,f,p.data.state===void 0?this.currentState:p.data.state,p.data,this.shared,this.data.allowSlerp??!1);s!==-1&&c===n&&Object.assign(x.params,{startOnceDelay:0}),this.tweens[c]=x,this.timeline.add(x.params,this.timeline.duration+(c===n?r.delay:0))}this.timeline.duration+=r.endDelay}else{let n=s===-1?this.data.tweens.length-1:s+1;for(let c=n;c>0;c--){let u=this.data.tweens[c],p=this.data.tweens[c-1],f;c===n&&(this.object.wasMovedByUser===!0||this.object.previousAction?.changeBegan===!0)?(f=void 0,this.object instanceof Xa&&(this.object.wasMovedByUser=!1)):f=u.data.state===void 0?this.currentState:u.data.state;let x=new lQ(this.object,f,p.data.state===void 0?this.currentState:p.data.state,u.data,this.shared,this.data.allowSlerp??!1);s!==-1&&c===n&&Object.assign(x.params,{startOnceDelay:0}),this.tweens[c-1]=x,this.timeline.add(x.params,this.timeline.duration+(c===n?r.endDelay:0))}this.timeline.duration+=r.delay}}catch(r){r instanceof Error&&console.error(r.message)}this.object.previousAction?.playing===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(Fs(this.shared,this.condition)===!1||uX(this.eventType)&&this.data.runMode==="Once"&&this.hasPlayedOnce||(this.hasPlayedOnce=!0,this.playing))return!1;clearTimeout(this.timeoutId);let e=s4(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(t){t instanceof Error&&console.error(t.message)}},this.startOnceDelay+e)}pause(){this.timeline?.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof ya?this.object.changeSelectedState(e,{shared:this.shared}):this.object.changeSelectedState(e,{scene:this.page.scene,shared:this.shared}),this.object.currentState=e}seek(e){if(Fs(this.shared,this.condition)===!1)return!1;this.timeline===void 0&&this.buildTimeline(),this.timeline?.seek(e*this.timeline.duration,!0)}toggle(e){if(Fs(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function dD(e,t){let i,r;if(typeof t=="string"?(i=t,r=e.states?.[i]):t===null&&(i=null,r=e.data),!(i===void 0||r===void 0))return{id:i,data:r}}var nBe={type:"beginState"},cQ={type:"completeState",isfromEntity:!1},uQ={type:"requestRender"},Sie=class extends za{constructor(e,t,i,r){super(),this.data=e,this.page=t,this.shared=i,this.condition=r,this.toggleIsForward=!1,this.posStart=new se,this.posEnd=new se,this.qStart=new Vr,this.qEnd=new Vr,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(e=!1){if(!this.data.animate)return;let t=this.page.scene.find(this.data.targetCamera);if(!t||!t.visible)throw new ReferenceError("Target camera not founded or not visible");let i={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=xie(pt(me({targets:i,t:1},bie(this.data)),{update:()=>{i.t===0&&(this.data.runMode==="Toggle"&&!this.toggleIsForward?this.fromCamera&&(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(t.position),this.qEnd.copy(t.quaternion),this.zoomEnd=t.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(t.uuid)),this.page.activeCamera.dispatchEvent(nBe));let r=this.page.activeCamera;r.position.lerpVectors(this.posStart,this.posEnd,i.t),r.quaternion.slerpQuaternions(this.qStart,this.qEnd,i.t),r.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*i.t,r.wasMovedBySwitchCameraAction=!0,r.updateMatrix(),r.updateMatrixWorld(),r.updateProjectionMatrix(),r.dispatchEvent(uQ),i.t===1&&r.dispatchEvent(cQ)}}))}switchCamera(e){let t=this.page.activeCamera,i=this.page.scene.find(e);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),t.dispatchEvent({type:"cameraChange",camera:i})}play(){if(Fs(this.shared,this.condition)===!1)return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{delete this.timeoutId,this.data.animate?(this.buildAnimation(),this.animation?.play()):this.switchCamera(this.data.targetCamera)},this.data.delay*1e3)}catch{}}pause(){this.animation?.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){if(Fs(this.shared,this.condition)===!1)return!1;if(window.clearTimeout(this.timeoutId),delete this.timeoutId,e!==this.toggleIsForward)try{this.playing?(this.animation?.pause(),this.toggleIsForward=e??!this.toggleIsForward,this.buildAnimation(!0),this.animation?.play()):this.timeoutId=window.setTimeout(()=>{this.toggleIsForward=e??!this.toggleIsForward,this.data.animate?(this.animation?.pause(),this.buildAnimation(),this.animation?.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.fromCamera&&this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(cQ),this.page.activeCamera.dispatchEvent(uQ))},this.data.delay*1e3)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}};function Eie(e){let t=e?.tracks.filter(i=>i.ValueTypeName==="vector"||i.ValueTypeName==="quaternion").map(i=>i.times.length);if(t?.length){let i=o2e(t);return i&&i>2?i:2}return 2}var Mie=class extends za{constructor(e,t,i,r,s){super(),this.data=e,this.page=t,this.animationControls=i,this.shared=r,this.condition=s,this.startOnceDelay=0,this.toggleIsForward=!1;let n=e.object,c=t.scene.find(e.object);c&&Array.isArray(c.identity)&&(n=c.identity[0]),this.data=pt(me({},e),{object:n});let u=this.animationControls.clipIdToAction[e.clipId+"/"+n];if(this.duration=u?.getClip()?.duration??1,this.data.crop2){let p=Eie(u?.getClip());this.leftFrameTime=this.data.crop2[0]/(p-1)*this.duration,this.rightFrameTime=this.data.crop2[1]/(p-1)*this.duration}else{let p=u?.getClip()?.tracks[0]?.times.length;p&&p>1?(this.leftFrameTime=this.data.crop[0]/p*this.duration,this.rightFrameTime=this.data.crop[1]/p*this.duration):(this.leftFrameTime=0,this.rightFrameTime=this.duration)}this.startOnceDelay=e.delay}get playing(){return this.threeAnimAction?.isRunning()??!1}play(e=!1){if(Fs(this.shared,this.condition)===!1)return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let t=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([i,r])=>{let s=i.split("/")[1];this.threeAnimAction!==r&&s===t&&r.isRunning()&&(e?r.fadeOut(.2):r.stop())}),e&&this.threeAnimAction?.fadeIn(.2)},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){this.threeAnimAction?.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=Yi.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e,t=!1){if(Fs(this.shared,this.condition)===!1)return!1;this.toggleIsForward=e??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let i=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([r,s])=>{let n=r.split("/")[1];this.threeAnimAction!==s&&n===i&&s.isRunning()&&(t?s.fadeOut(.2):s.stop())}),t&&this.threeAnimAction?.fadeIn(.2)}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){let e=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object]?.getClip();e&&(e.duration=this.duration),this.pause()}},Tie=class{constructor(e,t,i,r,s){this.data=e,this.page=t,this.eventManager=i,this.shared=r,this.condition=s,this.timeOutId=-1,this.scene=t.scene}dispatch(){if(Fs(this.shared,this.condition)===!1)return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(t=>t.uuid!==this.data.target))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity(t=>{t.type==="ParticleSystem"&&(t.sleep(),t.wakeUp(),t.data.autoPlay?t.start():t.stop())}),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),qU(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},Aie=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=Fs(this.shared,this.condition)}dispatch(){if(this.evaluatedCondition===!1)return!1;let e=this.shared.getVariable(this.data.variableId),t=Dee(this.data.expression,this.shared,Oa.typeOfVariable(e));t!==void 0&&this.shared.updateVariable(this.data.variableId,typeof t=="string"?{textValue:t}:t)}dispose(){}},Cie=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.timeoutId=null}dispatchInner(){if(Fs(this.shared,this.condition)===!1)return!1;let e=this.shared.getDynamicVariablePlayState(this.data.variableId);if(this.data.mode==="PlayPause")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,e==="Playing"?"Paused":"Playing");else if(this.data.mode==="Play"&&e!=="Playing")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if(this.data.mode==="Stop"&&e!=="Stopped")this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if(this.data.mode==="Pause"&&e!=="Paused")this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if(this.data.mode==="Restart")this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if(this.data.mode==="Toggle"){let t=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);e==="Playing"?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,t===void 0?!1:!t):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!t),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let e=this.data.delay,t=this.shared.getDynamicVariablePlayState(this.data.variableId);this.data.mode==="PlayPause"&&t==="Playing"&&(e=this.data.pauseDelay),e!==0?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},e)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}},sBe=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r}dispatch(){if(Fs(this.shared,this.condition)===!1)return!1;(this.data.target==="single"?this.data.variableId?[this.data.variableId]:[]:Object.keys(this.shared.getVariables())).forEach(e=>{this.shared.getVariable(e);let t=this.shared.data.variables.data(e)?.value;t!==void 0&&this.shared.updateVariable(e,t),this.shared.enableLocalStorageForPersistentVariables&&localStorage.removeItem(kB(e))})}dispose(){}},oBe=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r}dispatch(){if(Fs(this.shared,this.condition)===!1)return!1;this.data.userAPIId&&this.shared.getUserAPI(this.data.userAPIId)?.callUserAPI(this.shared)}dispose(){}};function Fs(e,t){if(t===void 0)return!0;if(t.expression.length===0)return!1;let i=Dee(t.expression,e,"boolean");return t.negate?!i:!!i}function _a(e,t,i,r,s,n){let c={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[],ClearLocalStorage:[],UserAPI:[]},u=p=>({id:f,data:x})=>{try{x.type==="Audio"?ja[e.type].includes("Audio")&&c.Audio.push(new eie(f,x,n,r,p)):x.type==="Video"&&!(n instanceof ya)?ja[e.type].includes("Video")&&c.Video.push(new Iie(f,x,n,r,p)):x.type==="Particles"?ja[e.type].includes("Particles")&&c.Particles.push(new tie(x,i,r,p)):x.type==="Link"?ja[e.type].includes("Link")&&c.Link.push(new qke(x,s.controlsManager,r,p)):x.type==="Create"?ja[e.type].includes("Create")&&c.Create.push(new Pie(x,i,s.controlsManager,r,p)):x.type==="Destroy"?ja[e.type].includes("Destroy")&&c.Destroy.push(new iie(x,i,s.controlsManager,r,p)):x.type==="Reset"?ja[e.type].includes("Reset")&&c.Reset.push(new rie(x,i,r,s,p)):x.type==="Transition"?ja[e.type].includes("Transition")&&c.Transition.push(new wie(e.type,x,i,r,p)):x.type==="SwitchCamera"?ja[e.type].includes("SwitchCamera")&&c.SwitchCamera.push(new Sie(x,i,r,p)):x.type==="SceneTransition"?ja[e.type].includes("SceneTransition")&&c.SceneTransition.push(new Tie(x,i,s,r,p)):x.type==="Animation"?ja[e.type].includes("Animation")&&c.Animation.push(new Mie(x,i,s.animationControls,r,p)):x.type==="SetVariable"?ja[e.type].includes("SetVariable")&&c.SetVariable.push(new Aie(x,i,r,p)):x.type==="DynamicVariablePlay"?ja[e.type].includes("DynamicVariablePlay")&&c.DynamicVariablePlay.push(new Cie(x,i,r,p)):x.type==="Conditional"?ja[e.type].includes("Conditional")&&(x.ifActions.forEach(u({expression:x.condition,negate:!1})),x.elseActions.forEach(u({expression:x.condition,negate:!0}))):x.type==="ClearLocalStorage"?ja[e.type].includes("ClearLocalStorage")&&c.ClearLocalStorage.push(new sBe(x,i,r,p)):x.type==="UserAPI"&&ja[e.type].includes("UserAPI")&&c.UserAPI.push(new oBe(x,i,r,p))}catch{}};return t.forEach(u()),c}function ga(e){Object.values(e).forEach(t=>{t.forEach(i=>{(i instanceof eie||i instanceof Iie||i instanceof tie||i instanceof Mie||i instanceof wie||i instanceof Pie||i instanceof iie||i instanceof Sie||i instanceof Tie||i instanceof rie||i instanceof Aie||i instanceof Cie)&&i.dispose()})})}function aBe(e,t){let i;if("material"in e){let r=e.material;Array.isArray(r)?i=e.material[0].layers.find(s=>s.uuid===t):i=e.material.layers.find(s=>s.uuid===t)}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}var Die=new Map,mS=new Map,ox=class{constructor(e,t,i){this.data=t,this.delay=0,this.status="stopped";let{layerId:r,loop:s,volume:n,delay:c}=t;if(this.object=i,r===void 0)throw new Error("Missing property");let u=aBe(i,r);u&&(this.videoElement=u,this.videoElement.loop=s===1/0,XS&&(this.videoElement.autoplay=!0),n!==void 0&&(this.videoElement.volume=n)),c!==void 0&&(this.delay=c),mS.has(i.uuid)?mS.get(i.uuid).push(this):mS.set(i.uuid,[this]),Die.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();i!==void 0&&i.then(r=>{}).catch(r=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},o4=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=Die.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t[this.data.interaction](),this.disposeDelay()},this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=mS.get(e);!t?.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let e=[...mS.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},Iie=class{constructor(e,t,i,r,s){if(this.data=t,this.shared=r,this.condition=s,t.interaction==="play")this.interaction=new ox(e,t,i);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new o4(t);else throw new Error("Missing property")}dispatchBasic(){if(Fs(this.shared,this.condition)===!1)return!1;this.interaction instanceof ox?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(Fs(this.shared,this.condition)===!1)return!1;this.interaction instanceof ox?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},hQ=(()=>{let e,t,i,r;function s(u){!e&&!dQ()&&t?.sharedGameControlGlobals.createdObjects.length>0&&(e=requestAnimationFrame(n)),u&&(t=u,r=u.requestRender)}function n(u){let p=i?u-i:0,f=t.sharedGameControlGlobals.createdObjects,x=t.sharedGameControlGlobals.nCreatedPerAction,w=f.length,E=0;for(;E<w;){let A=f[E];A.userData.createdTime===void 0&&(A.userData.createdTime=u),A.userData.lifetime===void 0&&A.userData.quantity===void 0||A.userData.lifetime&&u-A.userData.createdTime<A.userData.lifetime||A.userData.quantity&&x[A.userData.actionId]<=A.userData.quantity?(A.userData.velocity&&(A.position.addScaledVector(A.userData.velocity,p/1e3),A.updateMatrix(),r()),E++):(x[A.userData.actionId]>A.userData.quantity&&x[A.userData.actionId]--,f.splice(E,1),A.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&A.rigidBody?(t.sharedGameControlGlobals.colliderToEntity.delete(A.rigidBody.collider(0).handle),t.sharedGameControlGlobals.rapierWorld.removeRigidBody(A.rigidBody)):(A.bvhGeometry=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter(I=>I.bvhGeometry!==void 0)),w--,r())}e=E>0?requestAnimationFrame(n):void 0,i=E>0?u:void 0}function c(){dQ()?e&&(cancelAnimationFrame(e),e=void 0,i=void 0):s()}return typeof document<"u"&&document.addEventListener("visibilitychange",c),s})();function dQ(){return!!document&&document.hidden}var pQ=new Vr,lBe=new se,cBe=new se,Pie=class{constructor(e,t,i,r,s){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=s,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=Yi.generateUUID(),this.dispatch=()=>{if(Fs(this.shared,this.condition)===!1)return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{if(Fs(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=E2e(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let c=new qa(this.object);if(c.playModeVisible=!0,c.expand(),this.data.coordinateSystem!=="world"){let p=this.data.coordinateSystem,f=this.page.scene.find(p);f&&(f.updateMatrixWorldSVD(),c.hiddenMatrix.copy(f.matrixWorldRigid))}c.scale.copy(this.object.scale),c.position.fromArray(this.data.position),c.rotation.fromArray(this.data.rotation),c.updateMatrix(),this.page.add(c);let u=this.controlsManager.sharedGameControlGlobals;u.createdObjects.push(c),u.nCreatedPerAction[this.uniqueId]===void 0?u.nCreatedPerAction[this.uniqueId]=1:u.nCreatedPerAction[this.uniqueId]++,c.updateWorldMatrix(!0,!0),c.traverseObject(this.traverseObjectCB),hQ(),this.controlsManager.requestRender()},this.traverseObjectCB=c=>{c.hasNonUniformScale&&c.updateMatrixWorldSVD();let u;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(c instanceof Hu)if(c.objectForSample){if(c.objectForSample.dataPatched.physics.fusedBody)return;u=c.object}else return c.object.dataPatched.physics.fusedBody===!0&&c.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(c instanceof qa)u=c.object;else if(u=c,u.dataPatched.cloner?.hideBase)return!0}else{if(c instanceof Hu)return;c instanceof qa?u=c.object:u=c}this.data.destroy==="Time"?c.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(c.userData.quantity=this.data.destroyAfterQuantity,c.userData.actionId=this.uniqueId);let p=new se().fromArray(this.data.velocity),f=u.dataPatched;if(!(f.physics.enabled==="visibility"?!f.visible:!f.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(c,u,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&(c.rigidBody?.collider(0).setActiveEvents(1),c.userData.hasCollisionDestroy=!0),c.matrixWorld.decompose(lBe,pQ,cBe),p.applyQuaternion(pQ),this.data.velocity.some(x=>x!==0)&&this.data.dynamic&&c.rigidBody?.setLinvel(p.divideScalar(this.controlsManager.pixelsPerMeter),!0)):("geometry"in c.object&&this.controlsManager.addBoundsTree(c),this.data.velocity.some(x=>x!==0)&&this.data.dynamic&&(c.userData.velocity=p)),u.dataPatched.physics?.fusedBody===!0))return!0};let n=this.page.scene.find(this.data.object);if(!n)throw new Error("Missing Property");if(this.object=n,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");hQ(i)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(e=>window.clearTimeout(e)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},Rie=200,qk=.02,Yk=.3,uBe=65,eXe=new se,fQ=new se,mQ=new se,hBe=new se,ml=new se,Ol=new se,Xf=new se,Xk=new mi,gQ=new mi,dBe=new mi,tXe=new mi,zu=new Vr,Kd=new Vr,Fh=new $o(0,0,0,"YXZ"),pBe=new se(1,0,0),Fu=new se(0,1,0),fBe=new se(0,0,1),yQ=new se(1,1,1),iXe=new jl,mBe=1,gBe=.025,yBe=16e-6,vQ=12,vBe=20,aa=new Qc,Vc=new mo,_Be={type:"requestRender"},xBe={type:"updateMatrix"},_Q=Math.PI/6,a4=class extends za{constructor(e,t,i,r,s,n,c,u,p){super(),this.object=e,this.domElement=t,this.data=i,this.gloabalPhysics=r,this.controlsManager=s,this.cameraFollow=n,this.camera=c,this.page=u,this.sharedAssets=p,this.enableDamping=!0,this.hiddenMatrix0=new mi,this.target0=new se,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=Rie,this.euler0=new $o(0,0,0,"YXZ"),this.position0Cam=new se,this.quat0Cam=new Vr,this.scale0Cam=new se,this.hiddenMatrix0Cam=new mi,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new Qc(new se(0,-40,0),new se(0,40,0)),matrix:new mi,position:new se,rotation:new Vr},this.euler=new $o(0,0,0,"YXZ"),this.eulerDelta=new se,this.lastPosition=new se,this.lastCameraQuaternion=new Vr,this.lastCameraPosition=new se,this.PI_2=Math.PI/2,this.prevMouse=new lt,this.velocityTarget=new se,this.velocity=new se,this.directionXZ=new se,this.rotVelocityStick=new se,this.rotVelocityTarget=new se,this.rotVelocity=new se,this.rotDirection=new se,this.nonColliderRotOffset=new mi,this.nonColliderPosOffset=new mi,this.firstPointerId=-1,this.rot=new se,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new mi,this.objectToTarget=new se,this.objectToTarget0=new se,this.objectToCamXZ=new se,this.objectToCamXZ0=new se,this.targetToCamera=new se,this.targetToCamera0=new se,this.cameraPolarAxis0=new se,this.targetPos=new se,this.targetQuat=new Vr,this.lerpFactorPos=new se().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new Vr,this.objXZQuatInv=new Vr,this.objXZRotMat=new mi,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new se,this.pushedVelocity=new se,this.groundYRotation=0,this.objectRealQuat=new Vr,this.colliderWorldQuat=new Vr,this.groundNormal=new se,this.groundTilt=new Vr,this.groundTiltInv=new Vr,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new se,this.quaternion=new Vr,this.scale=new se,this.initialAction=!0,this.onPointerDown=I=>{!(I.target===this.domElement||I.target instanceof HTMLElement&&I.target.tagName==="SPLINE-VIEWER"&&I.target.shadowRoot?.contains(this.domElement))||this.firstPointerId!==-1||(this.firstPointerId=I.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!fc&&!$Y&&this.domElement.requestPointerLock(),this.prevMouse.set(I.clientX,I.clientY))},this.onPointerUp=I=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),I.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=I=>{if(I.pointerId!==this.firstPointerId)return;let P=I.clientX-this.prevMouse.x,O=I.clientY-this.prevMouse.y;this.prevMouse.set(I.clientX,I.clientY),I.pointerType==="mouse"&&this.rotBy!=="keys"&&($Y&&L2e<15.5&&!fc?(this.eulerDelta.y=-P*this.mouseOrbitSensitivity,this.eulerDelta.x=-O*this.mouseOrbitSensitivity):(this.eulerDelta.y=-I.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-I.movementY*this.mouseOrbitSensitivity)),I.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-P*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-O*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=I=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?a4.isLocked=!0:a4.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document?.hidden)for(let I in this.movementState)this.movementState[I]=0},this.onKeyDown=I=>{!(I.target instanceof HTMLInputElement)&&(I.code==="ArrowLeft"||I.code==="ArrowUp"||I.code==="ArrowRight"||I.code==="ArrowDown"||I.code==="Space")&&I.preventDefault();for(let P of this.keyAssignments)if(I.key.toUpperCase()===P[1]||I.key===P[1]){this.movementState[P[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=I=>{for(let P of this.keyAssignments)if(I.key.toUpperCase()===P[1]||I.key===P[1]||I.code.slice(3,I.code.length).toUpperCase()===P[1]){this.movementState[P[0]]=0;break}},this.copyVRGamePadValues=(I,P)=>{for(let O=2;O<4;O++){let k=I.axes[O];P===0?O===2?this.movementState.movePosX=k:this.movementState.movePosZ=k:(I.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,O===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(k)>=.3&&(this.vrEulerYOffset+=k<0?1:-1),this.movementState.rotPosY=k):this.moveMode==="fly"&&(this.movementState.moveNegY=k))}},this.sharedGameControlGlobals=s.sharedGameControlGlobals,e===c&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let f=this.euler0.clone(),x=f.y;if(this.objectRealQuat.copy(this.quaternion),f.y=0,this.quaternion.setFromEuler(f),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),f.set(0,x,0),this.quaternion.setFromEuler(f),this.rot.setFromEuler(f),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy(this.camera?.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let I=new se(0,0,-1).applyQuaternion(this.camera.quaternion),P=new se().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(P),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let O,k;Math.abs(I.y)<1e-6?(P.y=0,I.y=0,k=P.projectOnVector(I)):P.y/I.y>0?k=I.multiplyScalar(P.y/I.y):k=I.multiplyScalar(P.length()),this.targetToCamera0.copy(k).negate(),O=this.camera.position.clone().add(k),this.objectToTarget0.subVectors(O,this.position);let U=new $o().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-U.x,U.x=0,U.z=0,U.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(U)}if(this.object instanceof Xa&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=(i.speedTranslate??250)*mBe,this.speedOrbit=(i.speedRotate??100)*gBe,this.mouseOrbitSensitivity=(i.speedRotate??100)*yBe,this.keyAssignments=i.keyAssignments.map(I=>{let P=[I[0],I[1]];return P[1]==="\u25B2"?P[1]="ArrowUp":P[1]==="\u25C0"?P[1]="ArrowLeft":P[1]==="\u25BC"?P[1]="ArrowDown":P[1]==="\u25B6"?P[1]="ArrowRight":P[1]==="\u21E7"?P[1]="Shift":P[1]==="\u21B5"?P[1]="Enter":P[1]==="Space"?P[1]=" ":P[1]==="\u2318"?P[1]="Meta":P[1]==="Ctrl"?P[1]="Control":P[1]==="Esc"&&(P[1]="Escape"),P}),i.rotBy==="mouse"){let I;I=this.keyAssignments.findIndex(P=>P[0]==="rotNegX"),I!==-1&&(this.keyAssignments[I][1]=""),I=this.keyAssignments.findIndex(P=>P[0]==="rotPosX"),I!==-1&&(this.keyAssignments[I][1]=""),I=this.keyAssignments.findIndex(P=>P[0]==="rotPosY"),I!==-1&&(this.keyAssignments[I][1]=""),I=this.keyAssignments.findIndex(P=>P[0]==="rotNegY"),I!==-1&&(this.keyAssignments[I][1]="")}this.lerpFactorPosStart=1-.02**(1/((i.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((i.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((i.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((i.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((i.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((i.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??gx.defaultData.gravity)*vQ,this.usePhysics=this.gloabalPhysics.usePhysics??gx.defaultData.usePhysics,this.jumpPower=i.jumpPower*vBe,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??QD.defaultDataThirdPerson.orientWith,this.slopeThresh=uBe*Math.PI/180,i.collider.type==="capsule"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*qk/this.pixelsPerMeter,this.stepThresh=i.collider.height*Yk/this.pixelsPerMeter,this.colliderHeight=i.collider.height):i.collider.type==="sphere"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*qk/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*Yk/this.pixelsPerMeter,this.colliderHeight=i.collider.radius*2):(this.offset=i.collider.height*qk/this.pixelsPerMeter,this.stepThresh=i.collider.height*Yk/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let w=new se().fromArray(i.collider.position),E=new Vr().setFromEuler(new $o().fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(w).multiply(this.scale),this.collider.rotation.copy(E),this.collider.matrix.compose(w,E,yQ),i.cameraXAxis!==void 0&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=i.runMultiplier??2;let A=i.navmesh.destinationHelperRadius*2;if(A>0){let I=new pr;I.push({fi:0,data:pt(me({},ca.defaultData("light","phong")),{alpha:0}),id:"layer1"}),I.push({fi:0,data:pt(me({},ca.defaultData("color")),{color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a}),id:"layer2"});let P=new yU({layers:I},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new $s(uee.create({parameters:{width:A,height:A/10,hollow:.7}}),P),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(e=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let t=new $o().setFromQuaternion(this.quaternion,"YXZ"),i=t.y;this.objectRealQuat.copy(this.quaternion),t.y=0,this.quaternion.setFromEuler(t),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),t.set(0,i,0),this.quaternion.setFromEuler(t),this.rot.setFromEuler(t),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof Xa?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){this.deactivate(),this.navMeshPathDest?.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,t=this.sharedAssets;e.gameActions!==void 0&&(this.actions={},ZD.list.forEach(i=>{this.actions[i]=_a(pt(me({},e),{disabled:!1,type:"GameControl"}),e.gameActions[i],this.page,t,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),ga(this.actions.idle),ga(this.actions.move),ga(this.actions.run),ga(this.actions.jump)}dispatchStartEvent(e){this.actions[e]!==void 0&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].Transition.forEach(t=>{t.play()}),this.actions[e].Animation.forEach(t=>{t.play(this.initialAction===!1)}),this.actions[e].Create.forEach(t=>{t.dispatchStart()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("start")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("start")})))}dispatchStopEvent(e){this.actions[e]!==void 0&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].Transition.forEach(t=>{t.stop(),t.object.currentState!==null&&t.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[e].Create.forEach(t=>{t.dispatchStop()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("stop")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("stop")})))}get colliderWorldPosition(){return ml.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,t,i){if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let r=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let s=r*60,n=!1;if(this.usePhysics&&this.collisionEnabled){let u=Ol.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*vQ),1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),p=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,u,this.object.rigidBody?.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(p){this.onObject=!0,this.groundNormal.set(p.normal2.x,p.normal2.y,p.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(n=!0),p.collider.parent()?.bodyType()===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let f=p.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let x of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(x.rigidBody===f&&x.userData.isFollowingObj!==this.object.uuid){(x.hasNonUniformScale?x.matrixWorldRigid:x.matrixWorld).decompose(ml,Kd,Ol),this.groundVelocity.subVectors(ml,x.prevT),this.object.getWorldPosition(Ol).add(this.collider.position).sub(ml),this.groundYRotation=Fh.setFromQuaternion(Kd).y-x.prevR.y,Xf.copy(Ol).applyAxisAngle(Fu,this.groundYRotation),this.groundVelocity.add(Xf.sub(Ol)).divideScalar(r);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*s),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let u=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let p=ml.subVectors(this.path[1],this.position),f=Ol.subVectors(this.path[1],this.path[0]);p.dot(f)<0?this.path.shift():(this.directionXZ.x=f.x,this.directionXZ.z=f.z),u.opacity=u.userData.opacity0}else u.opacity-=.05*u.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**s),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**s),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**s)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let c=hBe.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let u=Ol.copy(c);u.y=0,c.set(0,c.y,u.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none"&&this.isFirstPerson===!1)if(this.orientWith==="camera"&&this.path.length<=1){let u=ml;this.camera.getWorldDirection(u);let p=Xf.copy(Fu).multiplyScalar(u.dot(Fu));u.sub(p);let f=Ol.copy(this.directionXZ);f.x*=-1,this.rot.y=u.angleTo(f)*(u.cross(f).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(Fh.setFromVector3(this.rot),this.moveMode==="walk"&&(Fh.x=0),c.applyEuler(Fh),n&&(Kd.setFromUnitVectors(Fu,this.groundNormal),c.applyQuaternion(Kd)),i){let u=Fh.set(0,this.vrEulerYOffset*_Q,0);i.applyEuler(u),c.x+=i.x,c.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*r}if(this.usePhysics===!0){let u=Ol;this.pushedVelocity.set(0,0,0);for(let p of this.sharedGameControlGlobals.entitiesWithTransformAnim){let f=Xf.setFromMatrixPosition(p.matrixWorld).sub(p.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),x=p.rigidBody.collider(0).castCollider(f,this.object.rigidBody.collider(0),ml.copy(c).divideScalar(this.pixelsPerMeter),r,!1);f.multiplyScalar(this.pixelsPerMeter);let w=Ln.is(p)?p:p.object;if(x!==null&&this.lastHitObj!==w){let E;p instanceof qa&&(E=p);let A=this.sharedGameControlGlobals.entityToCollisionEvents[w.uuid];if(A)for(let I of A)I.data.target==="character"&&(I.dispatch(E),w.dispatchEvent(c4));this.lastHitObj=w}if(x!==null){this.pushedVelocity.copy(f),u.copy(x.normal1).applyQuaternion(p.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let p=u.dot(c);p<0&&c.addScaledVector(u,-p),c.add(this.pushedVelocity)}else c.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**s):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**s),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(Fu,this.euler.y-this.euler0.y);let u=Ol.copy(this.objectToCamXZ).normalize(),p=Xf.copy(c).multiplyScalar(r);p.y=0;let f=p.sub(ml.copy(u).multiplyScalar(p.dot(u))).cross(u).y;this.euler.y-=Math.atan2(f,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=Yi.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=Yi.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=Yi.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(Fh.copy(t),Fh.y=0):(Fh.copy(this.euler),Fh.y=0),this.nonColliderRotOffset.makeRotationFromEuler(Fh)),t&&(this.moveMode==="walk"?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*_Q),zu.setFromAxisAngle(pBe,this.rot.x),Kd.setFromAxisAngle(Fu,this.rot.y),Kd.multiply(zu),zu.setFromAxisAngle(fBe,this.rot.z),Kd.multiply(zu),this.quaternion.copy(Kd),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let u=Ol.copy(c).multiplyScalar(r/this.pixelsPerMeter),p=null;this.didHit=!1;let f=new se;for(let x=0;x<5;x++){let w=u.length(),E=Xf.copy(u).normalize();if(p=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(f),this.colliderWorldQuat,E,this.object.rigidBody?.collider(0).shape,w,!1,24,void 0,void 0,this.object.rigidBody),p!==null){this.didHit=!0;let A=this.sharedGameControlGlobals.colliderToEntity.get(p.collider.handle);if(A!==this.lastHitObj&&x===0){this.lastHitObj=A;let k=this.sharedGameControlGlobals.entityToCollisionEvents[A?.uuid];if(k){for(let U of k)if(U.data.target==="character"){let j=(this.sharedGameControlGlobals.rapierWorld?.getCollider(p.collider.handle))._parent,V;if(A.cloner){for(let $ of A.cloner.children)if($.rigidBody===j){V=$;break}}U.dispatch(V),A.dispatchEvent(c4)}}}let I=fQ.set(p.normal2.x,p.normal2.y,p.normal2.z).applyQuaternion(this.colliderWorldQuat),P=mQ.copy(E).multiplyScalar(p.toi).dot(I),O=p.toi;if(O===0&&(this.position.y+=this.offset*this.pixelsPerMeter),P>this.offset&&(O=p.toi*(P-this.offset)/P,f.addScaledVector(E,O)),u.copy(E).multiplyScalar(w-O),Math.acos(-I.y)>this.slopeThresh){let k=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(f),U=Xf.copy(p.witness2).applyQuaternion(this.colliderWorldQuat);U.y=0;let j=k.add(U);j.y+=this.stepThresh;let V=this.sharedGameControlGlobals.rapierWorld.castShape(j,this.colliderWorldQuat,u,this.object.rigidBody?.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);V!==null&&V.toi===0&&(I.y=0,I.normalize())}u.addScaledVector(I,-u.dot(I))}else{x===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),f.add(u);break}}this.position.addScaledVector(f,this.pixelsPerMeter),this.object.rigidBody?.setTranslation(ml.copy(this.position).divideScalar(this.pixelsPerMeter),!0),this.object.rigidBody?.setRotation(zu.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let u=this.onObject?1:5,p=c.multiplyScalar(r/u);for(let f=0;f<u;f++)this.position.add(p),this.collisionAdjustment(r/u)}else this.position.addScaledVector(c,r);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let u=this.objectToTarget.add(this.position),p=this.targetToCamera.add(u);Xk.lookAt(p,u,Fu).setPosition(p),Xk.decompose(this.targetPos,this.targetQuat,ml),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**s),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**s),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=Yi.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=Yi.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(xBe),this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&(this.navMeshPathDest===null||this.navMeshPathDest.material.opacity<-.04*this.navMeshPathDest?.material?.userData.opacity0)?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(_Be),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e=zu.setFromAxisAngle(Fu,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?Yi.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(e);let t;this.cameraXAxis==="Limit"?t=Yi.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):t=Yi.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=ml.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&i.applyQuaternion(e);let r=Kd.setFromAxisAngle(i,t);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(e),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(r)}groundTiltAdjustment(e){Fu.angleTo(e)*180/Math.PI<15||Fu.angleTo(e)*180/Math.PI>85?zu.identity():zu.setFromUnitVectors(Fu,e),this.groundTilt.slerp(zu,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){let t=mQ.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=Xk.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(ml,zu,Ol).compose(ml,zu,yQ);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(s=>{if(s===this.object||s.isDescendantOf(this.object))return;Vc.makeEmpty(),s.updateMatrixWorldSVD();let n=s.matrixWorldRigid,c=gQ.copy(n).invert(),u=dBe.copy(gQ).multiply(i);aa.copy(this.collider.segment),aa.start.applyMatrix4(u),aa.end.applyMatrix4(u);let p=fQ.copy(this.position).applyMatrix4(c);Vc.expandByPoint(aa.start),Vc.expandByPoint(aa.end),Vc.min.addScalar(-this.collider.radius),Vc.max.addScalar(this.collider.radius),s.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(f){return f.distanceToPoint(aa.end)},intersectsBounds:f=>f.intersectsBox(Vc),intersectsTriangle:f=>{let x=ml,w=Ol,E=f.closestPointToSegment(aa,x,w);if(E<this.collider.radius){let A=this.collider.radius-E,I=w.sub(x).normalize(),P=Xf.copy(p);P.addScaledVector(I,A);let O=P.applyMatrix4(n).sub(this.position);t.add(O),aa.start.addScaledVector(I,A),aa.end.addScaledVector(I,A)}}})}),Vc.makeEmpty(),aa.copy(this.collider.segment),aa.start.applyMatrix4(i),aa.end.applyMatrix4(i),Vc.expandByPoint(aa.start),Vc.expandByPoint(aa.end),Vc.min.addScalar(-this.collider.radius),Vc.max.addScalar(this.collider.radius),this.sharedGameControlGlobals.staticMeshBVH?.shapecast({traverseBoundsOrder(s){return s.distanceToPoint(aa.end)},intersectsBounds:s=>s.intersectsBox(Vc),intersectsTriangle:s=>{let n=ml,c=Ol,u=s.closestPointToSegment(aa,n,c);if(u<this.collider.radius){let p=this.collider.radius-u,f=c.sub(n).normalize();this.alignToGround&&this.groundTiltAdjustment(f),t.addScaledVector(f,p),aa.start.addScaledVector(f,p),aa.end.addScaledVector(f,p)}}}),this.onObject=Math.abs(t.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,t.length()-1e-5);t.normalize().multiplyScalar(r),this.position.add(t)}},Oie=a4;Oie.isLocked=!1;var bBe=Dp(UQ());function cp(e,t){let i=new fr;if(!e.getAttribute("position"))return i.setAttribute("position",new Vi([],3)),i.setIndex([]),i;let{positions:r,triIndices:s}=FI(e.getAttribute("position"),e.getIndex());return i.setAttribute("position",new Vi(r,3)),i.setIndex(s),t&&i.applyMatrix4(t),i}var wBe=new mi,SBe=new mi,kh=[[0,0,0],[0,0,0],[0,0,0]];function Lie(e){let t=e.elements;kh[0][0]=t[0],kh[0][1]=t[4],kh[0][2]=t[8],kh[1][0]=t[1],kh[1][1]=t[5],kh[1][2]=t[9],kh[2][0]=t[2],kh[2][1]=t[6],kh[2][2]=t[10];let{u:i,v:r}=(0,bBe.SVD)(kh),s=wBe.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),n=SBe.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1);return s.multiply(n.transpose())}var EBe=class extends RK{constructor(){super(),this.layers.enable(3),this.layers.enable(8)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e,t=!0,i=[]){return e.forEach(r=>{r.visible&&this.intersectObject(r,t,i)}),i}createRaycastLineHelper(){let e=new bm({color:65280,linewidth:10}),t=new se(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new se(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),r=this.camera.far-this.camera.near,s=new se().addVectors(t,i.multiplyScalar(r)),n=new fr;return n.setFromPoints([t,s]),new xD(n,e)}},zie=e=>e instanceof nx||e instanceof sx;function MBe(e,t){return e.distance-t.distance}function Fie(e,t,i){if(!(!lp(t)||!t.visible)){Uu(t)&&t.raycast(e,i);for(let r of t.children)Fie(e,r,i)}}function pD(e,t,i,r=!1){if(!r&&!i.some(n=>mI(e,n)!==void 0))return[];let s=[];return t.children.forEach(n=>Fie(e,n,s)),s.sort(MBe),s}function l4(e){let t=[];if(e.length){let i=e[0].object;lp(i)&&t.push(i);let r=i.parent;for(;r;)zie(r)&&t.push(r),r=r.parent}return t}function up(e,t,i,r){let s=e.frame;if(s){let n=t[0]*s.width,c=(1-t[1])*s.height;for(let u of i){let p=u===s.uuid?s:s.find(u);if(p?.intersects(n,c))return r(p),!0}}return!1}function mI(e,t){if(Uu(t)){if(t.visible){let i=[];return t.raycast(e,i),i.length?i[0]:void 0}}else if(zie(t))return kie(e,t)}function kie(e,t){if(!(!lp(t)||!t.visible)){if(Uu(t)){let i=[];if(t.raycast(e,i),i.length)return i[0]}for(let i of t.children){let r=kie(e,i);if(r)return r}}}function TBe(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width*2-1,y:-((t-(i.top+window.scrollY))/i.height)*2+1}}function ABe(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width,y:1-(t-(i.top+window.scrollY))/i.height}}var CBe=class{constructor(e,t,i,r,s,n,c,u){this.renderer=e,this.publish=t,this.scene=i,this.getCamera=r,this.sharedAssets=s,this.requestRender=n,this.isExport=c,this.frame=u,this.raycaster=new EBe,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents=t.mouseEventTarget==="window",this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(e){this._domRect=e}get domRect(){return this._domRect}updateRaycaster(e){let{pageX:t,pageY:i}=e.touches?.length>0?e.touches[0]:e;this.pointerWorld=TBe(t,i,this._domRect),this.pointerScreen=ABe(t,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},Gl=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},YU=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],Nie=e=>YU.find(([t,i])=>i===e)?.[0],iE=e=>YU.find(([t])=>t===e)?.[1],DBe=(e,t)=>{let i=Nie(e);if(i){let r=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(r,"target",{writable:!1,value:t}),r}},IBe=class extends Gl{constructor(){super(...arguments),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=e=>{if(!e.eventName||!e.target||e.eventName==="Scroll")return;let t=this.splineEvents[Nie(e.eventName)]?.[e.target.uuid];if(!t)return;e.eventName==="Scroll"&&e.deltaY!==void 0&&Object.assign(t,{deltaY:e.deltaY});let{domElement:i}=this.eventContext;i.dispatchEvent(t)}}connect(){let{page:e}=this.eventContext;e.traverseEntity(t=>{if(t.data?.events.length){for(let[i,r]of YU)if(t.data.events.some(s=>s.data.type===r&&!s.data.disabled)){this.objectsPerEvents.has(i)?this.objectsPerEvents.get(i)?.push(t):this.objectsPerEvents.set(i,[t]);let s={id:t.uuid,name:t.name},n=DBe(r,s),c=this.splineEvents[i];c?c[t.uuid]=n:this.splineEvents[i]={[t.uuid]:n}}}}),this.objectsPerEvents.forEach(t=>{t.forEach(i=>{i.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.removeEventListener("beginEvent",this.onBeginEvent)})})}},PBe=class{constructor(e,t,i,r,s,n){if(this.id=e,this.data=t,this.object=i,this.entered=!1,(t.type==="KeyDown"||t.type==="KeyUp"||t.type==="KeyPress")&&!t.key)throw new Error("Missing property");this.actions=_a(t,t.actions,r,s,n,i)}disconnect(){ga(this.actions)}dispatchHeld(e){this.actions.Create.forEach(t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()})}dispatch(e=!1){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStart())):(this.actions.Transition.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.SwitchCamera.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.SwitchCamera.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()})),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),e===!1&&this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStop()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},RBe=class extends Gl{constructor(e,t,i){super(e),this.eventManager=t,this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=r=>{if(this.useForRaycastProperty===!0&&this.sceneInterects===null){this.eventContext.updateRaycaster(r);let{raycaster:s,page:n}=this.eventContext,c=pD(s,n,[],!0);this.sceneInterects=c,c.length&&(this.eventContext.sharedAssets.raycastProperty={x:c[0].point.x,y:c[0].point.y,z:c[0].point.z,objX:c[0].object.matrixWorld.elements[12],objY:c[0].object.matrixWorld.elements[13],objZ:c[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(s=>{(s.data.type==="MouseDown"||s.data.type==="MousePress")&&(this.onCanvasRaycast(r),s.dispatch())})},this.onCanvasMouseUp=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(s=>{s.data.type==="MouseUp"?(this.onCanvasRaycast(r),s.dispatch()):s.data.type==="MousePress"&&s.dispatchRelease()})},this.onMouseDown=r=>{Pr.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseDown"))},this.onMouseUp=r=>{Pr.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=r=>{Pr.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent())},this.onMousePressRelease=r=>{Pr.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent(!0))},this.onKeyDown=r=>{this.heldKeys[r.key]||(this.handleKeyEvent(r,"KeyDown"),this.handleKeyEventHeld(r,"KeyDown",!0)),this.heldKeys[r.key]=!0},this.onKeyUp=r=>{this.handleKeyEvent(r,"KeyUp"),this.handleKeyEventHeld(r,"KeyUp",!0)},this.onKeyPressDown=r=>{this.heldKeysPress[r.key]?this.handleKeyEventHeld(r,"KeyPress"):(this.handleKeyEvent(r,"KeyPress"),this.handleKeyEventHeld(r,"KeyPress",!0)),this.heldKeysPress[r.key]=!0},this.onKeyPressUp=r=>{this.handleKeyEvent(r,"KeyPress",!0)},this.releaseHeldKey=r=>{delete this.heldKeys[r.key]},this.releaseHeldKeyPress=r=>{delete this.heldKeysPress[r.key]},this._onUserEvent=({eventName:r,target:s,reverse:n})=>{if(!r||!s)return;let c=iE(r);c&&(c==="MouseDown"||c==="MouseUp"||c==="MousePress"?(s.dispatchEvent({type:"beginEvent",eventName:c}),this.eventsPerObjects[c]?.[s.uuid]?.forEach(u=>{u.dispatchUserEvent(n)})):(c==="KeyDown"||c==="KeyUp"||c==="KeyPress")&&(s.dispatchEvent({type:"beginEvent",eventName:c}),this.eventsPerObjects[c]?.[s.uuid]?.forEach(u=>{u.dispatchUserEvent()})))}}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext,r=(s,n)=>{if(!s.data?.events.length)return;let c=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let u of c){let p=this.eventsPerObjects[u];s.data.events.filter(({data:f})=>f.type===u&&f.disabled!==!0).forEach(({id:f,data:x})=>{try{let w=new PBe(f,x,s,e,t,this.eventManager);w.actions.Video.length&&(this.hasVideoAction=!0),(x.type==="MouseDown"||x.type==="MouseUp"||x.type==="MousePress")&&(x.mode==="Canvas"||x.mode==="Window")?this.canvasMouseEvents.push(w):p[s.uuid]?p[s.uuid].some(E=>E.id===w.id)||p[s.uuid].push(w):p[s.uuid]=[w]}catch{}}),p[s.uuid]?.length&&this.objectsPerTypes[u].push(s instanceof ya&&(u==="MouseDown"||u==="MouseUp"||u==="MousePress")?n:s)}};e.traverseEntity(s=>{(s instanceof Ha||s instanceof ua)&&s.frame?.traverse(n=>{r(n,s)}),r(s)}),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),i.addEventListener("pointerdown",this.onCanvasMouseDown),i.addEventListener("pointerup",this.onCanvasMouseUp),(this.objectsPerTypes.MouseDown?.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMouseDown)),this.objectsPerTypes.MouseUp?.length&&(this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMouseUp)),this.objectsPerTypes.MousePress?.length&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMousePressRelease)),this.objectsPerTypes.KeyDown?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),this.objectsPerTypes.KeyUp?.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),this.objectsPerTypes.KeyPress?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([s,n])=>{n.forEach(c=>{c.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},e.removeEventListener("pointerdown",this.onCanvasMouseDown),e.removeEventListener("pointerup",this.onCanvasMouseUp),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(t=>{Object.values(t).forEach(i=>{i.forEach(r=>{r.disconnect()})})}),this.canvasMouseEvents.forEach(t=>{t.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([t,i])=>{i.forEach(r=>{r.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(e){let{stopRaycast:t,raycaster:i,page:r,pointerScreen:s}=this.eventContext,n=this.objectsPerTypes[e],c=n.filter(u=>!(u instanceof ya));if(!(!n.length&&!this.useForRaycastProperty)&&!(r.uiCanvas&&up(r,[s.x,s.y],Object.keys(this.eventsPerObjects[e]),u=>{this.handleObjectMouseEventDispatch(u,e)}))){if(t||this.useForRaycastProperty){let u;if(this.sceneInterects===null?u=pD(i,r,c,this.useForRaycastProperty):(u=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&u.length&&(this.eventContext.sharedAssets.raycastProperty={x:u[0].point.x,y:u[0].point.y,z:u[0].point.z,objX:u[0].object.matrixWorld.elements[12],objY:u[0].object.matrixWorld.elements[13],objZ:u[0].object.matrixWorld.elements[14]}),t){let p=[u[0]?.uv?.x??0,u[0]?.uv?.y??0];l4(u).forEach(f=>{f instanceof Ha&&up(f,p,Object.keys(this.eventsPerObjects[e]),x=>{this.handleObjectMouseEventDispatch(x,e)}),this.eventsPerObjects[e][f.uuid]&&this.handleObjectMouseEventDispatch(f,e)})}}t||c.forEach(u=>{let p=mI(i,u);p&&(this.handleObjectMouseEventDispatch(u,e),u instanceof Ha&&up(u,[p?.uv?.x??0,p?.uv?.y??0],Object.keys(this.eventsPerObjects[e]),f=>{this.handleObjectMouseEventDispatch(f,e)}))})}}handleMousePressEvent(e=!1){let t="MousePress",i=this.objectsPerTypes[t],r=i.filter(n=>!(n instanceof ya)),s=[];if(i.length){if(!e){let{stopRaycast:n,raycaster:c,page:u,pointerScreen:p}=this.eventContext,f=!1;if(u.uiCanvas&&(f=up(u,[p.x,p.y],Object.keys(this.eventsPerObjects[t]),x=>{s.push(x)})),n&&!f){let x=pD(c,u,r);s=l4(x),x.forEach(w=>{w.object instanceof Ha&&up(w.object,[w?.uv?.x??0,w?.uv?.y??0],Object.keys(this.eventsPerObjects[t]),E=>{s.push(E)})})}else r.forEach(x=>{let w=mI(c,x);w&&(s.push(x),x instanceof Ha&&up(x,[w?.uv?.x??0,w?.uv?.y??0],Object.keys(this.eventsPerObjects[t]),E=>{s.push(E)}))})}this._prevObjects.length&&this._prevObjects.forEach(n=>{s.includes(n)||this.handleObjectMouseEventDispatchRelease(n,t)}),s.length&&s.forEach(n=>{this.handleObjectMouseEventDispatch(n,t)}),this._prevObjects=s}}handleObjectMouseEventDispatch(e,t){e.dispatchEvent({type:"beginEvent",eventName:t}),this.eventsPerObjects[t]?.[e.uuid]?.forEach(i=>{i.dispatch()})}handleObjectMouseEventDispatchRelease(e,t){e.dispatchEvent({type:"beginEvent",eventName:t}),this.eventsPerObjects[t]?.[e.uuid]?.forEach(i=>{i.dispatchRelease()})}handleKeyEvent(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{let s=this.eventsPerObjects[t][r.uuid];s.some(({data:n})=>"key"in n&&n.key===e.key)&&r.dispatchEvent({type:"beginEvent",eventName:t}),s.forEach(n=>{"key"in n.data&&n.data.key===e.key&&(i?n.dispatchRelease():n.dispatch(!0))})})}handleKeyEventHeld(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{this.eventsPerObjects[t][r.uuid].forEach(s=>{"key"in s.data&&s.data.key===e.key&&s.dispatchHeld(i)})})}},OBe=new se,LBe=new se,Bie=class{constructor(e,t,i,r,s){this.actionsIn=_a(e,e.inActions,i,r,s,t),this.actionsOut=_a(e,e.outActions,i,r,s,t)}disconnect(){ga(this.actionsIn),ga(this.actionsOut)}},zBe=class extends Bie{constructor(e,t,i,r,s,n){super(t,i,r,s,n),this.id=e,this.data=t,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let E of this.objects)if(!E.visible)return;let f=OBe.setFromMatrixPosition(this.objects[0].matrixWorld),x=LBe.setFromMatrixPosition(this.objects[1].matrixWorld),w=f.distanceTo(x)<=this.distance?"in":"out";if(this.stage!==w){this.stage=w;let E=w==="in"?this.actionsIn:this.actionsOut;E.Audio.forEach(A=>A.dispatchConditional()),E.Particles.forEach(A=>A.dispatchConditional()),E.Video.forEach(A=>A.dispatchConditional()),E.Link.forEach(A=>A.dispatch()),E.Create.forEach(A=>A.dispatch()),E.Destroy.forEach(A=>A.dispatch()),E.Reset.forEach(A=>A.dispatch()),E.Transition.forEach(A=>{A.object.currentTransitionEvent!==this&&(A.object.currentTransitionEvent=this),A.init()}),E.Transition.forEach(A=>A.play()),E.Animation.forEach(A=>A.play()),E.SwitchCamera.forEach(A=>A.play()),E.SceneTransition.forEach(A=>A.dispatch()),E.SetVariable.forEach(A=>A.checkConditions()),E.SetVariable.forEach(A=>A.dispatch()),E.DynamicVariablePlay.forEach(A=>A.dispatch()),E.ClearLocalStorage.forEach(A=>A.dispatch()),E.UserAPI.forEach(A=>A.dispatch())}};let{distance:c,fromObject:u,toObject:p}=t.condition;this.distance=c;for(let f of[u,p]){if(!f)throw new Error("Missing property");let x=r.find(f);if(!x)throw new Error("Missing property");this.objects.push(x)}}connect(){window.setTimeout(()=>{this.objects.forEach(e=>{e.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(e=>{e.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},FBe=class extends Bie{constructor(e,t,i,r,s,n){super(t,i,r,s,n),this.id=e,this.data=t,this.object=i,this.onBegin=({target:p,state:f})=>{this.toState!==f&&(this.actionsOut.Audio.forEach(x=>x.dispatchConditional()),this.actionsOut.Particles.forEach(x=>x.dispatchConditional()),this.actionsOut.Video.forEach(x=>x.dispatchConditional()),this.actionsOut.Link.forEach(x=>x.dispatch()),this.actionsOut.Create.forEach(x=>x.dispatch()),this.actionsOut.Destroy.forEach(x=>x.dispatch()),this.actionsOut.Reset.forEach(x=>x.dispatch()),this.actionsIn.Transition.forEach(x=>x.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(x=>x.play()),this.actionsOut.Animation.forEach(x=>x.play()),this.actionsIn.SwitchCamera.forEach(x=>x.pause()),this.actionsOut.SwitchCamera.forEach(x=>x.play()),this.actionsOut.SceneTransition.forEach(x=>x.dispatch()),this.actionsOut.SetVariable.forEach(x=>x.checkConditions()),this.actionsOut.SetVariable.forEach(x=>x.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(x=>x.dispatch()),this.actionsOut.ClearLocalStorage.forEach(x=>x.dispatch()),this.actionsOut.UserAPI.forEach(x=>x.dispatch()))},this.onComplete=({target:p,state:f})=>{this.toState===f&&(this.actionsIn.Audio.forEach(x=>x.dispatchConditional()),this.actionsIn.Particles.forEach(x=>x.dispatchConditional()),this.actionsIn.Video.forEach(x=>x.dispatchConditional()),this.actionsIn.Link.forEach(x=>x.dispatch()),this.actionsIn.Create.forEach(x=>x.dispatch()),this.actionsIn.Destroy.forEach(x=>x.dispatch()),this.actionsIn.Reset.forEach(x=>x.dispatch()),this.actionsOut.Transition.forEach(x=>x.pause()),this.actionsOut.Transition.forEach(x=>x.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(x=>x.play()),this.actionsIn.Animation.forEach(x=>x.play()),this.actionsOut.SwitchCamera.forEach(x=>x.pause()),this.actionsIn.SwitchCamera.forEach(x=>x.play()),this.actionsIn.SceneTransition.forEach(x=>x.dispatch()),this.actionsIn.SetVariable.forEach(x=>x.checkConditions()),this.actionsIn.SetVariable.forEach(x=>x.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(x=>x.dispatch()),this.actionsOut.ClearLocalStorage.forEach(x=>x.dispatch()),this.actionsOut.UserAPI.forEach(x=>x.dispatch()))};let{condition:c}=t;if(!c.object)throw new Error("Missing property");let u=r.find(c.object)??r.scene.find2D(c.object);if(!u)throw new Error("Missing property");if(this.toObject=u,c.state&&!this.toObject.states?.[c.state])throw new Error("Missing property");this.toState=c.state}connect(){xy(this.actionsOut).forEach(e=>{this.actionsOut[e]?.length&&this.toObject.addEventListener("beginState",this.onBegin)}),xy(this.actionsIn).forEach(e=>{this.actionsIn[e]?.length&&this.toObject.addEventListener("completeState",this.onComplete)})}disconnect(){super.disconnect(),xy(this.actionsOut).forEach(e=>{this.actionsIn[e]?.length&&this.toObject.removeEventListener("beginState",this.onBegin)}),xy(this.actionsIn).forEach(e=>{this.actionsIn[e]?.length&&this.toObject.removeEventListener("completeState",this.onComplete)})}},kBe=class extends Gl{constructor(e,t){super(e),this.eventManager=t,this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1}connect(){super.connect();let{page:e,sharedAssets:t}=this.eventContext;e.traverseEntity(i=>{if(i.data?.events.length){for(let{id:r,data:s}of i.data.events)if(!s.disabled&&s.type==="Conditional")try{let n;s.condition.type==="Comparison"||(s.condition.type==="Distance"?n=new zBe(r,s,i,e,t,this.eventManager):s.condition.type==="State"&&(n=new FBe(r,s,i,e,t,this.eventManager))),n&&(this.eventsPerConditions[s.condition.type].push(n),(n.actionsIn.Video.length||n.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}}),Object.values(this.eventsPerConditions).forEach(i=>i.forEach(r=>r.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.disconnect()))}},Gw=new se,$f=new se,ay=new se,xQ=new zl,NBe=.01,rs=new se,Yo=new se,bQ=new se,Dy=new Vr,$k=new $o,BBe=new mi,Zk=new Ao,D_=new se,Nh=new se,I_=.2;function Qk(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var UBe=function(){let e=new mi;return(t,i,r)=>{let s=t.obj;e.copy(s.hiddenMatrix),s.parent!==null&&e.premultiply(s.parent.matrixWorld),e.invert(),s.position.copy(i),t.reference==="global"&&Qk(s.position,t.limits),s.position.applyMatrix4(e),t.reference==="parent"?Qk(s.position,t.limits):t.reference==="local"&&(Dy.copy(t.quat0).invert(),s.position.sub(t.position0),s.position.applyQuaternion(Dy),Qk(s.position,t.limits),Dy.invert(),s.position.applyQuaternion(Dy),s.position.add(t.position0)),e.multiply(r??s.matrixWorld).decompose(rs,s.quaternion,Yo),s.updateMatrix(),s.hasNonUniformScale&&(s.updateMatrixWorld(),s.updateMatrixWorldSVD()),s instanceof wl&&vp(s.parent)&&s.invalidateDownstreamBooleanData(!0)}}(),jBe=class{constructor(e,t,i,r,s,n,c){this.object=e,this.id=t,this.data=i,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=_a(i,i.dragDropActions.drag,r,s,n,this.object),this.actionsDrop=_a(i,i.dragDropActions.drop,r,s,n,this.object);let u=[];this.data.objects.forEach(p=>{let f=r.find(p);!f||f.data.visible!==!1&&(u.push(f),c[f.uuid]&&c[f.uuid].forEach(x=>{let w=r.find(x);!w||w.data.visible!==!1&&u.push(w)}))}),this.data.dropDestinations.forEach(p=>{let f=r.find(p);!f||f.data.visible!==!1&&(this.dropDestIds.push(f.uuid),c[f.uuid]&&c[f.uuid].forEach(x=>{let w=r.find(x);!w||w.data.visible!==!1&&this.dropDestIds.push(w.uuid)}))}),this.dragItems=u.map(p=>(this.data.planeMode==="locked"&&(p.userData.lockedPlane=!0),p.userData.worldPosition0=new se().setFromMatrixPosition(p.matrixWorld),{obj:p,fromPosition:new se().setFromMatrixPosition(p.matrixWorld),pointStart:new se,pointEnd:new se,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new se().copy(p.position),quat0:new Vr().copy(p.quaternion),snapped:!1,orientationMatrix:new mi,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){ga(this.actionsDrag),ga(this.actionsDrop),this.dragItems.forEach(e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()})}},VBe=class extends Gl{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=i=>{if(Pr.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:s}=this.eventContext,n=s.raycastWithClones(r);if(this.lastDropDestination=null,n.length===0){this.activeEvent=null;return}for(let c of this.events){let u=0;for(let{obj:p,pointEnd:f,pointStart:x}of c.dragItems){if(p===n[0].object||p===n[0].object.object||Ln.is(p)&&p.isAncestorOf(n[0].object.uuid)){if(c.activeIdx=u,c.activeDragItem.reset=!1,c.activeDragItem.currentDampingFactor=c.data.dampingFactor,c.activeDragItem.snapped=!1,c.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){c.activeDragItem.obj.rigidBody&&c.activeDragItem.obj.rigidBody.setBodyType(2,!0);let w=c.activeDragItem.obj;p.hasNonUniformScale&&p.updateMatrixWorldSVD(),(w.hasNonUniformScale?w.matrixWorldRigid:w.matrixWorld).decompose(rs,Dy,Yo),$k.setFromQuaternion(Dy),w.prevR===void 0?(w.prevR=$k.clone(),w.prevT=rs.clone()):(w.prevR.copy($k),w.prevT.copy(rs)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(c.activeDragItem.obj)}this.calcPlaneIntersectPos(p,x,c.data.plane,c.data.referenceFrame),f.copy(x),(this.eventManager.controlsManager.usePhysics&&p.data.physics?.rigidBody==="dynamic"||c.data.drop===!1||c.data.resetOnSnapFail===!1)&&c.activeDragItem.fromPosition.setFromMatrixPosition(c.activeDragItem.obj.matrixWorld),this.activeEvent=c,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}u++}}this.activeEvent=null},this.onPointerMove=i=>{if(Pr.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:s}=this.eventContext,n=s.raycastWithClones(r);if(Pr.length===0){let c=!1;for(let u of this.events){for(let{obj:p}of u.dragItems)if(p===n[0]?.object||p===n[0]?.object?.object||Ln.is(p)&&p.isAncestorOf(n[0]?.object.uuid)){switch(c=!0,u.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break;default:break}break}if(c)break}c||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let c=this.activeEvent.activeDragItem;c.snapped=!1;let u;if(this.activeEvent.data.drop&&(u=n.filter(p=>c.obj!==p.object&&!c.obj.isAncestorOf(p.object.uuid)&&!(p.object instanceof nx)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(f=>f===p.object.uuid||s.scene.find(f).isAncestorOf(p.object.uuid))))[0]),u){let p=bQ.copy(u.face.normal).applyMatrix3(Zk.getNormalMatrix(u.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")c.fromPosition.setFromMatrixPosition(u.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(c.fromPosition.copy(u.point),this.activeEvent.data.snapSurfaceMode==="bbox"){rs.copy(p).applyMatrix3(Zk.setFromMatrix4(c.obj.matrixWorld).transpose());let f=c.obj;rs.x>I_?Yo.x=-f.recursiveBBox.min.x:rs.x<-I_&&(Yo.x=-f.recursiveBBox.max.x),rs.y>I_?Yo.y=-f.recursiveBBox.min.y:rs.y<-I_&&(Yo.y=-f.recursiveBBox.max.y),rs.z>I_?Yo.z=-f.recursiveBBox.min.z:rs.z<-I_&&(Yo.z=-f.recursiveBBox.max.z),Yo.applyMatrix3(Zk.invert())}else Yo.copy(p).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);c.fromPosition.add(Yo)}this.activeEvent.data.autoOrient&&(rs.set(0,1,0).cross(p),rs.length()<1e-4&&rs.set(-1,0,0).cross(p),Yo.crossVectors(bQ,rs),c.orientationMatrix.makeBasis(rs,Yo,p)),c.pointStart.copy(c.fromPosition),c.pointEnd.copy(c.pointStart),c.currentDampingFactor=this.activeEvent.snapDampingFactor,c.snapped=!0,this.lastDropDestination!==u.object&&(this.lastDropDestination=u.object,this.activeEvent.actionsDrop.Transition.forEach(f=>{f.play()}),this.activeEvent.actionsDrop.Animation.forEach(f=>{f.play()}),this.activeEvent.actionsDrop.Audio.forEach(f=>{f.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Particles.forEach(f=>{f.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(f=>{f.dispatchThrottled()}))}else c.orientationMatrix.makeRotationFromQuaternion(c.quat0),this.lastDropDestination=null,c.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(c.obj,c.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(p=>{p.stop(),p.object.currentState!==null&&p.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(p=>{p.stop()}),this.activeEvent.actionsDrop.Audio.forEach(p=>{p.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.Particles.forEach(p=>{p.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(p=>{p.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(p=>p.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(p=>p.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(p=>p.dispatch()),this.activeEvent.actionsDrag.ClearLocalStorage.forEach(p=>p.dispatch()),this.activeEvent.actionsDrag.UserAPI.forEach(p=>p.dispatch()),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(p=>{p.play()}),this.activeEvent.actionsDrag.Animation.forEach(p=>{p.play()}),this.activeEvent.actionsDrag.Audio.forEach(p=>{p.dispatchGameControl("start")}),this.activeEvent.actionsDrag.Particles.forEach(p=>{p.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(p=>{p.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(p=>{p.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(p=>{p.stop(),p.object.currentState!==null&&p.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(p=>{p.stop()}))},500),this.updateDragItem(c),c.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=i=>{if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let r=this.activeEvent.activeDragItem.obj.data.physics?.rigidBody==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!r)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&r&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(s=>{s.stop(),s.object.currentState!==null&&s.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(s=>{s.stop()}),this.activeEvent.actionsDrag.Audio.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.ClearLocalStorage.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.UserAPI.forEach(s=>s.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let e={};if(this.eventContext.page.traverseEntity(i=>{i.component&&(e[i.component.uuid]?e[i.component.uuid].push(i.uuid):e[i.component.uuid]=[i.uuid])}),this.eventContext.page.traverseEntity(i=>{i.data?.events.filter(r=>r.data.type==="DragDrop"&&!r.data.disabled).forEach(r=>{this.events.push(new jBe(i,r.id,r.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,e))})}),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let t=this.eventContext.domElement;t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(t=>t.dispose())}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,i,r){let{getCamera:s,raycaster:n}=this.eventContext;s().getWorldDirection($f),$f.negate();let c=Dy.identity();switch(r==="parent"?BBe.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(rs,c,Yo):r==="local"&&e.matrixWorld.decompose(rs,c,Yo),i){case"x":rs.set(1,0,0).applyQuaternion(c),D_.copy($f).cross(rs),Nh.copy(rs).cross(D_);break;case"y":rs.set(0,1,0).applyQuaternion(c),D_.copy($f).cross(rs),Nh.copy(rs).cross(D_);break;case"z":rs.set(0,0,1).applyQuaternion(c),D_.copy($f).cross(rs),Nh.copy(rs).cross(D_);break;case"xy":Nh.set(0,0,1).applyQuaternion(c);break;case"yz":Nh.set(1,0,0).applyQuaternion(c);break;case"xz":Nh.set(0,1,0).applyQuaternion(c);break;case"adaptive":$f.angleTo(Yo.set(0,1,0))>Math.PI/6?(rs.crossVectors(Yo.set(0,1,0),$f),Nh.crossVectors(rs,Yo)):Nh.set(0,1,0);break;default:Nh.copy($f);break}ay.setFromMatrixPosition(e.matrixWorld);let u=e.userData.lockedPlane?e.userData.worldPosition0:ay;if(xQ.setFromNormalAndCoplanarPoint(Nh,u),!!n.ray.intersectPlane(xQ,t)&&(i==="x"||i==="y"||i==="z")){let p=Yo.subVectors(t,u).dot(rs);t.copy(u).addScaledVector(rs,p)}}updateDragItem(e,t=!1){ay.setFromMatrixPosition(e.obj.matrixWorld),e.reset==="current"?Gw.subVectors(e.fromPosition,ay).divideScalar(e.currentDampingFactor):e.reset==="original"?(Gw.subVectors(e.obj.userData.worldPosition0,ay).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):Gw.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(ay).divideScalar(e.currentDampingFactor),e.paused=e.currentDampingFactor>1?Gw.length()<NBe:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||t)&&UBe(e,Gw.add(ay),this.activeEvent?.data.drop&&this.activeEvent?.data.autoOrient?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},P_=new se,Kk=new se,Jd=new se,ep=new se,wQ=new zl,GBe=.01,HBe={type:"requestRender"},WBe=function(){let e=new se,t=new se;return(i,r,s)=>s>0?(e.subVectors(i,r),e.length()<=s?i:t.copy(r).add(e.normalize().multiplyScalar(s))):r}(),SQ=function(){let e=new mi;return(t,i)=>{t.position.copy(i),t.parent!==null&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof wl&&vp(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),qBe=class{constructor(e,t,i,r,s,n){this.data=e,this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new se,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data=me(me(me({},BN.defaultData),e),e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}),e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=_a(e,e.actions,r,s,n,i)}},YBe=class extends Gl{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.pairOfEventListeners=[],this.onMouseMove=i=>{if(!(Pr.length>1)){this.eventContext.updateRaycaster(i);for(let r of this.events)r.target===void 0&&this.updateSingleEvent(r)}},this.onMouseEnter=i=>{for(let r of this.events)r.target===void 0&&(r.isReset=!1,r.currentDampingFactor=r.data.dampingFactor)},this.onMouseLeave=i=>{for(let r of this.events)r.target===void 0&&(r.data.resetOnPointerLeave&&(r.isReset=!0,r.currentDampingFactor=r.resetDampingFactor),this.updateSingleEvent(r))},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(r=>{let s=r.data?.events.find(n=>n.data.type==="Follow"&&!n.data.disabled);s&&(!e.data.globalPhysics.usePhysics||r.dataPatched.physics?.rigidBody!=="dynamic")&&this.events.push(new qBe(s.data,s.id,r,e,this.eventContext.sharedAssets,this.eventManager))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),fc&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events)if(r.target!==void 0){let s=r.target,n=this.onTargetChange(r);this.pairOfEventListeners.push([s,n]),s.addEventListener("requestRender",n)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),fc&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let i of this.events)i.paused=!0,i.isReset=!1,ga(i.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e,t=!1){this.events.forEach(c=>{c.actions.Create.forEach(u=>{u.dispatchThrottled()})});let{plane:i,limitDistance:r,limitDistanceEnabled:s}=e.data;if(e.object.getWorldPosition(Jd),e.isReset)ep.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(ep);else{let{getCamera:c,raycaster:u}=this.eventContext;if(i==="custom"?(c().getWorldDirection(Kk),Kk.negate(),P_.copy(Kk)):i==="xy"?P_.set(0,0,1):i==="xz"?P_.set(0,1,0):i==="yz"&&P_.set(1,0,0),wQ.setFromNormalAndCoplanarPoint(P_,Jd),!u.ray.intersectPlane(wQ,ep))return}if(!e.isReset){if(ep.distanceTo(e.worldPosition0)>r&&s&&e.target)if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)ep.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor;else return;else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return}e.data.enabledTranslation[0]===!1&&(ep.x=Jd.x),e.data.enabledTranslation[1]===!1&&(ep.y=Jd.y),e.data.enabledTranslation[2]===!1&&(ep.z=Jd.z);let n=WBe(Jd,ep,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let c=P_.subVectors(n,Jd).divideScalar(e.currentDampingFactor);Jd.add(c),t&&SQ(e.object,Jd),e.paused=c.length()<GBe}else SQ(e.object,n),e.paused=!0;e.object?.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(HBe)}},Hw=new se,q2=new se,Ww=new mi,R_=new Vr,Zf=new Vr,qw=new se,Yw=new se,ly=new se,tp=new se,Jk=new zl,XBe=1e-6,$Be={type:"requestRender"},ZBe={type:"changeRotation"},EQ=function(){let e=new mi;return function(t,i){t.parent!==null?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),i.premultiply(Lie(e).invert()),t.rotation.setFromRotationMatrix(i),t.updateMatrix(),t instanceof wl&&vp(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),QBe=class{constructor(e,t,i,r){this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new Vr,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data=me(me(me({},UN.defaultData),e),e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}),e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},KBe=class extends Gl{constructor(){super(...arguments),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=e=>{if(!(Pr.length>1)){this._lastMouseEvent=e,this.eventContext.updateRaycaster(e);for(let t of this.events)t.target===void 0&&this.updateSingleEvent(t)}},this.onMouseEnter=e=>{for(let t of this.events)t.target===void 0&&(t.isReset=!1,t.currentDampingFactor=t.data.dampingFactor)},this.onMouseLeave=e=>{for(let t of this.events)t.target===void 0&&(t.data.resetOnPointerLeave&&(t.isReset=!0,t.currentDampingFactor=t.resetDampingFactor),this.updateSingleEvent(t))},this.onScroll=e=>{if(this._lastMouseEvent){let t=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(t)}},this.onTargetChange=e=>()=>{this.updateSingleEvent(e)},this.createUserEventListener=e=>({eventName:t,target:i})=>{if(!t||!i)return;let r=iE(t);r&&r==="LookAt"&&this.updateSingleEvent(e)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(r=>{let s=r.data?.events.find(n=>n.data.type==="LookAt"&&!n.data.disabled);s&&(!e.data.globalPhysics.usePhysics||r.dataPatched.physics?.rigidBody!=="dynamic")&&this.events.push(new QBe(s.data,s.id,r,e))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),fc&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?i.addEventListener("scroll",this.onScroll):(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events){if(r.target!==void 0){let c=this.onTargetChange(r),u=r.target;this.pairOfEventListeners.push([u,c]),u.addEventListener("requestRender",c)}let s=this.createUserEventListener(r),n=r.object;this.pairOfUserEventListeners.push([n,s]),n.addEventListener("userEvent",s)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),fc&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let[i,r]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",r);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){let{tilt:t,axis:i,distance:r,plane:s,limitDistance:n,enabledRotation:c,limitDistanceEnabled:u}=e.data,{getCamera:p,raycaster:f}=this.eventContext,{object:x,target:w}=e;if(x.getWorldPosition(qw),!e.isReset)if(e.target)e.target.getWorldPosition(Yw);else{if(s==="custom"?(p().getWorldDirection(q2),q2.negate(),Jk.setFromNormalAndCoplanarPoint(q2,qw)):(s==="xy"?Hw.set(0,0,1):s==="xz"?Hw.set(0,1,0):s==="yz"&&Hw.set(1,0,0),Jk.setFromNormalAndCoplanarPoint(Hw,qw)),!f.ray.intersectPlane(Jk,Yw))return;r>0&&(s==="custom"||s===void 0)&&Yw.addScaledVector(q2,r)}if(e.isReset||(w?t==="target"?ly.copy(w.up).applyMatrix4(Ww.extractRotation(w.matrixWorld)).normalize():c.some(E=>E===!1)?(i==="x"?(tp.set(0,0,1),c[2]===!1&&tp.set(0,1,0)):i==="y"?(tp.set(1,0,0),c[0]===!1&&tp.set(0,0,1)):(tp.set(0,1,0),c[1]===!1&&tp.set(1,0,0)),ly.copy(tp).applyQuaternion(e.worldQuaternion0).normalize()):ly.set(0,1,0):s==="custom"?ly.set(0,1,0):ly.copy(Hw)),e.isReset)Zf.copy(e.worldQuaternion0);else if(qw.distanceTo(Yw)>n&&u&&w)if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)Zf.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor;else return;else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return;JBe(Ww,Yw,qw,ly,i,tp),Zf.setFromRotationMatrix(Ww),R_.setFromUnitVectors(tp.applyQuaternion(Zf),ly),c.some(E=>E===!1)&&t!=="target"&&Zf.premultiply(R_).normalize()}e.currentDampingFactor>1?(x.updateWorldMatrix(!0,!1),R_.setFromRotationMatrix(Lie(x.matrixWorld)),R_.slerp(Zf,1/e.currentDampingFactor),EQ(x,Ww.makeRotationFromQuaternion(R_)),e.paused=8*(1-R_.dot(Zf))<XBe):(EQ(x,Ww.makeRotationFromQuaternion(Zf)),e.paused=!0),e.object?.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),x.dispatchEvent($Be),x.dispatchEvent(ZBe)}},Gc=new se,qo=new se,ho=new se;function JBe(e,t,i,r,s,n){let c=e.elements;ho.subVectors(t,i),ho.lengthSq()===0&&(ho.z=1),ho.normalize(),qo.crossVectors(r,ho),qo.lengthSq()===0&&(Math.abs(r.z)===1?ho.x+=1e-4:ho.z+=1e-4,ho.normalize(),qo.crossVectors(r,ho)),qo.normalize(),Gc.crossVectors(ho,qo),s==="x"?n.z===1?[qo,Gc,ho]=[ho,qo,Gc]:(qo.negate(),[qo,ho]=[ho,qo]):s==="y"?n.x===1?[qo,Gc,ho]=[Gc,ho,qo]:(qo.negate(),[Gc,ho]=[ho,Gc]):n.x===1&&(qo.negate(),[qo,Gc]=[Gc,qo]),c[0]=qo.x,c[4]=Gc.x,c[8]=ho.x,c[1]=qo.y,c[5]=Gc.y,c[9]=ho.y,c[2]=qo.z,c[6]=Gc.z,c[10]=ho.z}var e4e=class{constructor(e,t,i,r,s,n){this.id=e,this.data=t,this.object=i,this.entered=!1,this.actions=_a(t,t.actions,r,s,n,i)}disconnect(){ga(this.actions)}dispatchEnter(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.play()),this.actions.Create.forEach(e=>e.dispatchStart()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered&&(this.entered=!1,this.actions.Create.forEach(e=>e.dispatchStop()),this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},t4e=class extends Gl{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=i=>{Pr.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onMouseUp=i=>{Pr.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=i=>{Pr.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:i,target:r,reverse:s})=>{if(!i||!r)return;let n=iE(i);n&&n==="MouseHover"&&(r.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[r.uuid]?.forEach(c=>c.dispatchUserEvent(s)))}}connect(){let{page:e,sharedAssets:t}=this.eventContext,i=(s,n)=>{if(!(!s.visible||!s.data?.events.length)){for(let{id:c,data:u}of s.data.events)if(!u.disabled&&u.type==="MouseHover")try{let p=new e4e(c,u,s,e,t,this.eventManager);this.eventsPerObjects[s.uuid]?this.eventsPerObjects[s.uuid].push(p):this.eventsPerObjects[s.uuid]=[p]}catch{}this.eventsPerObjects[s.uuid]?.length&&this.objects.push(s instanceof ya?n:s)}};if(e.traverseEntity(s=>{(s instanceof Ha||s instanceof ua)&&s.frame?.traverse(n=>{i(n,s)}),i(s)}),!this.objects.length)return;let{domElement:r}=this.eventContext;this.domEventsNeeded.clear(),fc&&(this.domEventsNeeded.add("pointerdown"),r.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),r.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),r.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(s=>{s.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),fc&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(t=>{t.forEach(i=>{i.disconnect()})}),this.objects.forEach(t=>{t.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(e=!1){let t=[];if(!e){let{stopRaycast:i,raycaster:r,page:s,pointerScreen:n}=this.eventContext,c=!1;if(s.uiCanvas&&(c=up(s,[n.x,n.y],Object.keys(this.eventsPerObjects),u=>{t.push(u)})),i&&!c){let u=pD(r,s,this.objects);t=l4(u),u.forEach(p=>{p.object instanceof Ha&&up(p.object,[p?.uv?.x??0,p?.uv?.y??0],Object.keys(this.eventsPerObjects),f=>{t.push(f)})})}else this.objects.forEach(u=>{let p=mI(r,u);p&&(t.push(u),u instanceof Ha&&up(u,[p?.uv?.x??0,p?.uv?.y??0],Object.keys(this.eventsPerObjects),f=>{t.push(f)}))})}this._prevObjects.length&&this._prevObjects.forEach(i=>{t.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[i.uuid]?.forEach(r=>r.dispatchLeave()))}),t.length&&t.forEach(i=>{i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[i.uuid]?.forEach(r=>r.dispatchEnter())}),this._prevObjects=t}},i4e=class{constructor(e,t,i,r,s,n){this.id=e,this.data=t,this.object=i,this.scrollCounter=0,this.actions=_a(t,t.actions,r,s,n,i)}connect(){this.scrollCounter=0}disconnect(){ga(this.actions)}dispatch(e){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(r=>r.seek(i)),this.actions.Animation.forEach(r=>r.seek(t)),this.actions.Create.forEach(r=>r.dispatchThrottled()),this.actions.SetVariable.forEach(r=>r.checkConditions()),this.actions.SetVariable.forEach(r=>r.dispatch()),this.actions.DynamicVariablePlay.forEach(r=>r.dispatch()),this.actions.ClearLocalStorage.forEach(r=>r.dispatch()),this.actions.UserAPI.forEach(r=>r.dispatch())}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},r4e=class{constructor(e,t,i,r,s,n,c){this.id=e,this.data=t,this.object=i,this.domElement=n,this.eventManager=c,this.scrollStart=0,this.scrollEnd=0,this.actions=_a(t,t.actions,r,s,c,i)}getStickyParentElement(){let e=this.domElement;for(;e;){if(window.getComputedStyle(e).position==="sticky")return e;e=e.parentElement}return null}computeScrollBounds(){let e=this.getStickyParentElement(),t=e?.parentElement,i=this.domElement.getBoundingClientRect(),r={top:i.top,bottom:i.bottom,left:i.left,right:i.right,width:i.width,height:i.height};if(t){let f=t.getBoundingClientRect(),x=window.getComputedStyle(e),w=parseFloat(x.marginTop)+parseFloat(x.marginBottom),E=parseFloat(x.top),A=parseFloat(x.bottom),I=f.height-w;if(!isNaN(E))i.top===E?(r.top+=f.top-E,r.bottom+=f.top-E):i.top<0&&(r.top-=I-i.height,r.bottom-=I-i.height);else if(!isNaN(A)){let P=document.body.clientHeight??window.innerHeight,O=window.innerWidth-(document.documentElement.clientWidth??window.innerWidth);i.bottom===P-A?(r.top+=f.top-i.height+A+O,r.bottom+=f.top-i.height+A+O):i.bottom<P-A&&(r.top-=I-i.height,r.bottom-=I-i.height)}}let s=document.body,n=document.documentElement,c=window.pageYOffset||n.scrollTop||s.scrollTop,u=n.clientTop||s.clientTop||0,p=Math.round(r.top+c-u);if(this.data.startFrom==="enter"){let f=window.innerHeight,x=r.height,w=this.data.enterAnchor,E=w==="top"?f:w==="bottom"?f-x:f-x*.5;this.scrollStart=p-E}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=r,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){ga(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return this.box===void 0||this.box.width===0&&this.box.height===0&&this.box.top===0&&this.box.bottom===0}computeScroll({x:e,y:t}){this.actions.Transition.forEach(s=>{s.object.currentTransitionEvent!==this&&(s.object.currentTransitionEvent=this,s.init())});let i=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(t-this.scrollStart)/i));this.actions.Transition.forEach(s=>s.seek(r)),this.actions.Animation.forEach(s=>s.seek(r)),this.actions.Create.forEach(s=>s.dispatchThrottled()),this.actions.SetVariable.forEach(s=>s.checkConditions()),this.actions.SetVariable.forEach(s=>s.dispatch()),this.actions.DynamicVariablePlay.forEach(s=>s.dispatch()),this.actions.ClearLocalStorage.forEach(s=>s.dispatch()),this.actions.UserAPI.forEach(s=>s.dispatch())}dispatch(e){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(e)}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},n4e=class extends Gl{constructor(e,t){super(e),this.managers=t,this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([i,r])=>{r.forEach(s=>s.handleResize())})},this.onScroll=i=>{if(!this.isInview)return;let r={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([s,n])=>{s.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:r}),n.forEach(c=>c.dispatch(r))})},this.onWheel=i=>{!this.isInview||i.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([r,s])=>{r.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:i.deltaY}),s.forEach(n=>n.dispatch(i.deltaY))})},this.onUserEvent=({eventName:i,target:r,reverse:s})=>{if(!i||!r)return;let n=iE(i);n&&n==="Scroll"&&(r.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),this.wheelEventsPerObject.get(r)?.forEach(c=>{c.dispatchUserEvent(s)}))}}connect(){let{page:e,sharedAssets:t,domElement:i,isExport:r}=this.eventContext,s=n=>{if(n.data?.events.length){for(let{id:c,data:u}of n.data.events)if(!u.disabled&&u.type==="Scroll")if(u.trigger==="load"||!r){let p=new i4e(c,u,n,e,t,this.managers);this.wheelEventsPerObject.has(n)?this.wheelEventsPerObject.get(n)?.push(p):this.wheelEventsPerObject.set(n,[p])}else{let p=new r4e(c,u,n,e,t,i,this.managers);this.scrollEventsPerObject.has(n)?this.scrollEventsPerObject.get(n)?.push(p):this.scrollEventsPerObject.set(n,[p])}}};e.traverseEntity(n=>{(n instanceof Ha||n instanceof ua)&&n.frame?.traverse(c=>{s(c)}),s(n)}),this.intersectionObserver=new IntersectionObserver(n=>{let c=n[0];c&&(this.isInview=c.isIntersecting)},{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([n,c])=>{c.forEach(u=>u.connect()),n.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([n,c])=>{c.forEach(u=>u.connect()),n.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(n=>n.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(n=>n.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)})}},s4e=class{constructor(e,t,i,r,s,n){this.id=e,this.data=t,this.object=i,this.actions=_a(t,t.actions,r,s,n,i)}disconnect(){ga(this.actions)}dispatch(){this.actions.Transition.forEach(e=>{e.play()}),this.actions.Animation.forEach(e=>{e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatchFromStart()}),this.actions.Destroy.forEach(e=>{e.dispatchFromStart()})}dispatchAfter(e){this.actions.Audio.forEach(t=>{(t.interaction.data.triggerAfter??"any")===e&&(t.interaction instanceof Cy?t.interaction.audioPlayer.play():t.interaction instanceof i4&&t.interaction.dispatch())}),this.actions.Video.forEach(t=>{let i=t.interaction.data.triggerAfter??"autoplay";i===e&&(t.interaction instanceof ox?t.interaction.play(i==="autoplay"):t.interaction instanceof o4&&t.interaction.dispatch())}),this.actions.Particles.forEach(t=>{(t.data.triggerAfter??"any")===e&&t.dispatchBasic()})}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.interaction instanceof Cy?t.interaction.audioPlayer.play():t.interaction instanceof i4&&t.interaction.dispatch()}),this.actions.Video.forEach(t=>{t.interaction instanceof ox?t.interaction.play():t.interaction instanceof o4&&t.interaction.dispatch()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()})}},o4e=class extends Gl{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(s=>{s.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(s=>{s.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:i,isExport:r}=this.eventContext,s=r?document:i;s.removeEventListener("pointerdown",this.onAny),s.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([n,c])=>{n.dispatchEvent({type:"beginEvent",eventName:"Start"}),c.forEach(u=>{u.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(s=>{s.actions.Audio.forEach(n=>{n.interaction instanceof Cy&&n.interaction.audioPlayer.play()}),s.actions.Video.forEach(n=>{let c=n.interaction.data.triggerAfter??"autoplay";n.interaction instanceof ox&&n.interaction.play(c==="autoplay")}),s.actions.Particles.forEach(n=>{n.dispatchBasic()})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(s=>{s.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:i,target:r,reverse:s})=>{if(!i||!r)return;let n=iE(i);n&&n==="Start"&&(r instanceof ya||r.dispatchEvent({type:"beginEvent",eventName:"Start"}),this.eventsPerObject.get(r)?.forEach(c=>{c.dispatchUserEvent(s)}),this.eventsAfterPerObject.get(r)?.forEach(c=>{c.dispatchUserEvent(s)}))}}connect(){let{sharedAssets:e,page:t}=this.eventContext,i=r=>{if(r.data?.events.length)for(let{id:s,data:n}of r.data.events){if(n.disabled||n.type!=="Start")continue;let c=new s4e(s,n,r,t,e,this.eventManager);(c.actions.Transition.length||c.actions.Animation.length||c.actions.SwitchCamera.length||c.actions.Create.length||c.actions.Destroy.length||c.actions.SceneTransition.length||c.actions.Reset.length||c.actions.SetVariable.length||c.actions.DynamicVariablePlay.length||c.actions.ClearLocalStorage.length||c.actions.UserAPI.length)&&(this.eventsPerObject.has(r)?this.eventsPerObject.get(r)?.push(c):this.eventsPerObject.set(r,[c])),c.actions.Audio.length&&(this.eventsAfterPerObject.has(r)?this.eventsAfterPerObject.get(r)?.push(c):this.eventsAfterPerObject.set(r,[c])),c.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(r)?this.eventsAfterPerObject.get(r)?.push(c):this.eventsAfterPerObject.set(r,[c])),c.actions.Particles.length&&(this.eventsAfterPerObject.has(r)?this.eventsAfterPerObject.get(r)?.push(c):this.eventsAfterPerObject.set(r,[c]))}};if(t.traverseEntity(r=>{(r instanceof Ha||r instanceof ua)&&r.frame?.traverse(s=>{i(s)}),i(r)}),[...this.eventsAfterPerObject.values()].some(r=>r.length)){if(this.eventManager.activateCount===0){let{domElement:r,isExport:s}=this.eventContext,n=s?document:r;n.addEventListener("pointerdown",this.onMouseDown,{once:!0}),n.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),n.addEventListener("pointerdown",this.onAny),n.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([c,u])=>{c.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([r,s])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),s.forEach(n=>n.dispatch()),r.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(e=>e.length)){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([r,s])=>{r.removeEventListener("userEvent",this.onUserEvent),s.forEach(n=>n.disconnect())})}[...this.eventsPerObject.entries()].forEach(([e,t])=>{e.removeEventListener("userEvent",this.onUserEvent),t.forEach(i=>i.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},a4e=class{constructor(e,t,i,r,s,n){this.id=e,this.data=t,this.object=i,this.initialDisabled=!1,this.actions=_a(t,t.actions,r,s,n,i),this.target=t.target}disconnect(){ga(this.actions)}dispatch(e){this.initialDisabled||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(e??!1)}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()))}},l4e=class extends Gl{constructor(e,t,i,r,s){super(e),this.sharedVariables=t,this.eventManager=i,this.needsMouse=r,this.needsRaycast=s,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.isOutOfFocus=!1,this.events=[],this.onFrame=n=>{let c=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let u=new Date,p=[],f=[];for(let E=0;E<this.propertiesToWatch.length;E++){let{objectId:A,property:I,prevValue:P}=this.propertiesToWatch[E],O=this.eventContext.scene.find(A),k=VN.propertyPaths[I];if(k[0]==="width"||k[0]==="height"||k[0]==="depth")O=O.geometry.userData.parameters[k[0]];else for(let U=0;U<k.length;U++)O=O[k[U]];P===null?this.propertiesToWatch[E].prevValue=O instanceof se?O.clone():O:(O instanceof se?!O.equals(P):P!==O)&&(f.push({objId:A,property:I}),O instanceof se?this.propertiesToWatch[E].prevValue.copy(O):this.propertiesToWatch[E].prevValue=O)}for(let E=0;E<this.variablesToWatch.length;E++){let{id:A,prevValue:I}=this.variablesToWatch[E],P=c.getVariable(A);P!==I&&(p.push(A),this.variablesToWatch[E].prevValue=P)}for(let E=0;E<this.dynamicVars.length;E++){let{id:A,expectedTime:I,last:P,data:O,timerSeconds:k,startValue:U}=this.dynamicVars[E],j=1e3;if((O.dynamicVariableType==="timer"||O.dynamicVariableType==="stopwatch")&&O.format==="number3decimal"?j=1:O.dynamicVariableType==="counter"?j=O.updateInterval:O.dynamicVariableType==="random"&&(j=O.isStatic?1/0:O.updateInterval),I===-1){this.dynamicVars[E].last=n,this.dynamicVars[E].expectedTime=n+j;continue}if(!((c.getDynamicVariablePlayState(A)==="Stopped"||c.getDynamicVariablePlayState(A)==="Restarted")&&(this.dynamicVars[E].last=n,this.dynamicVars[E].expectedTime=n+j,O.dynamicVariableType==="counter"&&c.getVariable(A)!==U&&(c.updateVariable(A,U),this.eventManager.requestRender()),(O.dynamicVariableType==="timer"||O.dynamicVariableType==="stopwatch")&&this.dynamicVars[E].timerSeconds!==U&&(this.dynamicVars[E].timerSeconds=U,c.updateVariable(A,Yc.getFormattedTimerTime(U,O)),this.eventManager.requestRender()),c.getDynamicVariablePlayState(A)==="Restarted"&&c.setDynamicVariablePlayState(A,"Playing"),c.getDynamicVariablePlayState(A)==="Stopped"))){if(c.getDynamicVariablePlayState(A)==="Paused"){this.dynamicVars[E].deltaToExpectedTime===void 0&&(this.dynamicVars[E].deltaToExpectedTime=Math.max(this.dynamicVars[E].expectedTime-n,0)),this.dynamicVars[E].last=n-(j-this.dynamicVars[E].deltaToExpectedTime),this.dynamicVars[E].expectedTime=n+this.dynamicVars[E].deltaToExpectedTime;continue}else this.dynamicVars[E].deltaToExpectedTime=void 0;if(n>=I)if(this.dynamicVars[E].last=n,this.dynamicVars[E].expectedTime+=j,O.dynamicVariableType==="random"){let V=O.min+Math.random()*(O.max-O.min),$=O.decimals;V=Math.round(V*Math.pow(10,$))/Math.pow(10,$),c.updateVariable(A,V),p.push(A),this.eventManager.requestRender()}else if(O.dynamicVariableType==="counter"){let V=c.getVariable(A),$=c.getDynamicVariableToggleIsForward(A)??!0,Y=c.getVariable(A)+O.increment*($?1:-1);O.hasEnd&&(Y=O.increment>0?Yi.clamp(Y,U,O.endValue):Yi.clamp(Y,O.endValue,U),Y===U&&c.setDynamicVariableToggleIsForward(A,void 0),O.repeat?Y===O.endValue&&(Y=U):(Y===U||Y===O.endValue)&&c.setDynamicVariablePlayState(A,"Paused")),Y!==V&&(p.push(A),c.updateVariable(A,Y),this.eventManager.requestRender())}else if(O.dynamicVariableType==="time"){let V=c.getVariable(A),$=G$(u,O);if(typeof V=="object"&&"textValue"in V&&typeof $=="object"&&"textValue"in $){if(Array.isArray(V.textValue)&&Array.isArray($.textValue)){if(V.textValue.every((Y,J)=>Y===$.textValue[J]))continue}else if(V.textValue===$.textValue)continue}else if(V===$)continue;c.updateVariable(A,$),p.push(A),this.eventManager.requestRender()}else{let V=Oa.isTextValue(O.endValue)?MQ(O.endValue.textValue):O.endValue,$=c.getDynamicVariableToggleIsForward(A)??!0,Y=k+(n-P)/1e3*(O.dynamicVariableType==="timer"?-1:1)*($?1:-1);Y=Math.max(Y,0),O.hasEnd&&(Y=O.dynamicVariableType==="stopwatch"?Yi.clamp(Y,U,V):Yi.clamp(Y,V,U),Y===U&&c.setDynamicVariableToggleIsForward(A,void 0),O.repeat?Math.abs(Y-V)<(O.format==="number3decimal"?1e-4:.1)&&(Y=U):(Math.abs(Y-U)<(O.format==="number3decimal"?1e-4:.1)||Math.abs(Y-V)<(O.format==="number3decimal"?1e-4:.1))&&c.setDynamicVariablePlayState(A,"Paused")),Y!==k&&(p.push(A),this.dynamicVars[E].timerSeconds=Y,c.updateVariable(A,Yc.getFormattedTimerTime(Y,O)),this.eventManager.requestRender())}}}let x=!1;c.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=c.mouseProperty,x=!0);let w=!1;c.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=c.raycastProperty,w=!0),this.events.forEach(E=>{(p.includes(E.data.variableId)||f.find(A=>A.objId===E.data.objectId&&A.property===E.data.property)||E.data.variableId==="mouseProperty"&&x||E.data.variableId==="raycastProperty"&&w)&&(E.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let e=Date.now()-this.pauseTime;for(let t=0;t<this.dynamicVars.length;t++)this.dynamicVars[t].last+=e,this.dynamicVars[t].expectedTime+=e}connect(){this.eventContext.page.traverseEntity(t=>{t.data?.events.filter(i=>i.data.type==="VariableChange"&&!i.data.disabled).forEach(i=>{this.events.push(new c4e(i.id,i.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.propertiesToWatch=this.events.filter(t=>t.data.variableId==="objectProperty"&&t.data.objectId!==null).map(t=>({objectId:t.data.objectId,property:t.data.property,prevValue:null}));let e=this.eventContext.sharedAssets;this.sharedVariables.forEach(({id:t,data:i})=>{if(!("dynamicVariableType"in i)){this.events.find(s=>s.data.variableId===t)&&this.variablesToWatch.push({id:t,prevValue:e.getVariable(t)});return}let r;if(i.dynamicVariableType==="timer"||i.dynamicVariableType==="stopwatch"){let s;if(Oa.isTextValue(i.value)&&Array.isArray(i.value.textValue)){let n=i.value.textValue;n.length===3?s=n[2]+n[1]*60+n[0]*3600:s=n[1]+n[0]*60}else s=i.value;r=s,this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,timerSeconds:s,startValue:r})}else i.dynamicVariableType==="time"&&e.updateVariable(t,G$(new Date,i)),i.dynamicVariableType==="counter"&&(r=Oa.isTextValue(i.value)?MQ(i.value.textValue):i.value),this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,startValue:r})}),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(e=>e.dispose())}},c4e=class{constructor(e,t,i,r,s,n){this.id=e,this.data=t,this.object=i,this.actions=_a(t,t.actions,r,s,n,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}dispose(){ga(this.actions)}};function MQ(e){return e.length===3?e[2]+e[1]*60+e[0]*3600:e[1]+e[0]*60}var u4e="https://unpkg.com/@splinetool/runtime@1.9.20/build/",h4e="https://unpkg.com/@splinetool/navmesh-wasm@1.9.20/build/",d4e=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${u4e}' + 'navmesh.js'),
		fetch('${h4e}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,p4e=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,f4e=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,TQ=.001,m4e={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},Uie,Cn,Ta;B2e.then(e=>{Uie=e,Cn=new e.Vec3,Ta=new e.Vec3});var g4e=new se,y4e=class{constructor(e=!1,t=!1){this.usePhysics=e,this.isExport=t,this.onPointerDown=i=>{if(Pr.length!==1)return;let{raycaster:r,page:s}=this.eventContext;this.eventContext.updateRaycaster(i);let n=s.raycastWithClones(r);if(n.length!==0){if(this.gameControl){let c=g4e.copy(this.gameControl.colliderWorldPosition);c.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(c,n[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,r)=>s=>{let n;if(s instanceof Hu)if(s.objectForSample){if(s.objectForSample.dataPatched.physics.fusedBody)return;n=s.object}else return s.object.dataPatched.physics.fusedBody===!0&&s.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(s instanceof qa)n=s.object;else if(n=s,n.dataPatched.cloner?.disabled===!1&&n.dataPatched.cloner?.hideBase&&n.dataPatched.physics?.fusedBody!==!0)return!0;if(r&&!n.userData.navmesh)return;let c=n.dataPatched;if(!c.visible&&c.physics?.enabled!==!0)return!0;s.updateMatrixWorldSVD();let u=gI(c),p=n.userData.hasDestroy,f=n.userData.hasDrag,x=!1,w=!1;for(let E of c.events)E.data.disabled!==!0&&(E.data.type==="GameControl"?x=!0:E.data.type==="Follow"&&(w=!0));if(x||u||w||p||f)return!0;if(this.usePhysics&&c.physics?.rigidBody==="dynamic"){if(this.usePhysics&&c.physics?.fusedBody)return!0}else if("geometry"in s&&s.geometry&&i.push(cp(s.geometry,s.matrixWorld)),this.usePhysics&&c.physics?.fusedBody)return s.traverseObject((E,A)=>{if(A===0)return;let I;if(E instanceof Hu)if(E.objectForSample){if(E.objectForSample.dataPatched.physics.fusedBody)return;I=E.object}else return E.object.dataPatched.physics.fusedBody===!0&&E.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(E instanceof qa)I=E.object;else if(I=E,E.dataPatched.cloner?.hideBase)return!0;let P=I.dataPatched;if(!P.visible&&P.physics?.enabled!==!0)return!0;"geometry"in E&&E.geometry&&i.push(cp(E.geometry,E.matrixWorld))}),!0},this.traverseNoPhysics=(i,r)=>s=>{let n;if(s instanceof Hu)return;s instanceof qa?n=s.object:n=s;let c=n.dataPatched;if(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled)return!0;if(r&&!n.userData.navmesh)return;let u=s.geometry,p=n.userData.hasDestroy===!0,f=n.userData.hasDrag===!0;if(gI(c)||p||f||n.dataPatched.events.some(x=>x.data.disabled!==!0&&x.data.type==="GameControl"))return!0;u&&i.push(cp(u,s.matrixWorld))},this.navmeshWasm=Uie,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?d4e:p4e)+f4e])),this._worker=new Worker(this._workerURL)}init(e,t,i){this.gameControl=t,this.eventContext=i,this.setDefaultQueryExtent(new se().setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,e,r=>{this.buildFromNavmeshData(r.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,i){t.objects.forEach(p=>{let f=e.scene.find(p);f.traverseEntity(x=>{x.userData.navmesh=!0}),f.cloner?.traverseObject(x=>{x.userData.navmesh=!0})});let r=[],s=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(r,t.zones==="custom");if(e.traverseChildren(s),t.objects.forEach(p=>{let f=e.scene.find(p);f.traverseEntity(x=>{x.userData.navmesh=void 0}),f.cloner?.traverseObject(x=>{x.userData.navmesh=void 0})}),r.length===0)return!1;let n=Ay(r),{positions:c,triIndices:u}=FI(n.getAttribute("position"),n.getIndex());return this._worker.postMessage([c,c.length/3,u,u.length,me(me({},m4e),t)]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let e,t,i=this.navMesh.getDebugNavMesh(),r=i.getTriangleCount(),s=new Uint32Array(r*3),n=new Float32Array(r*3*3);for(e=0;e<r*3;e++)s[e]=e;for(e=0;e<r;e++)for(t=0;t<3;t++){let u=i.getTriangle(e).getPoint(t);n[e*9+t*3+0]=u.x,n[e*9+t*3+1]=u.y,n[e*9+t*3+2]=u.z}let c=new fr;return c.setIndex(new Fr(s,1)),c.setAttribute("position",new Fr(n,3)),c}getClosestPoint(e){return Cn.x=e.x,Cn.y=e.y,Cn.z=e.z,this.navMesh.getClosestPoint(Cn)}getClosestPointToRef(e,t){Cn.x=e.x,Cn.y=e.y,Cn.z=e.z;let i=this.navMesh.getClosestPoint(Cn);t.set(i.x,i.y,i.z)}getRandomPointAround(e,t){return Cn.x=e.x,Cn.y=e.y,Cn.z=e.z,this.navMesh.getRandomPointAround(Cn,t)}getRandomPointAroundToRef(e,t,i){Cn.x=e.x,Cn.y=e.y,Cn.z=e.z;let r=this.navMesh.getRandomPointAround(Cn,t);i.set(r.x,r.y,r.z)}moveAlong(e,t){return Cn.x=e.x,Cn.y=e.y,Cn.z=e.z,Ta.x=t.x,Ta.y=t.y,Ta.z=t.z,this.navMesh.moveAlong(Cn,Ta)}moveAlongToRef(e,t,i){return Cn.x=e.x,Cn.y=e.y,Cn.z=e.z,Ta.x=t.x,Ta.y=t.y,Ta.z=t.z,this.navMesh.moveAlong(Cn,Ta)}computePath(e,t){let i=this.getClosestPoint(t);if(Ta.x=i.x,Ta.y=i.y,Ta.z=i.z,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(e);let r=this.navMesh.computePath(Cn,Ta),s=r.getPointCount(),n=[];for(let c=0;c<s;c++){let u=r.getPoint(c);n.push(new se(u.x,u.y,u.z))}return n}createCrowd(e,t){return new v4e(this,e,t)}setDefaultQueryExtent(e){Cn.x=e.x,Cn.y=e.y,Cn.z=e.z,this.navMesh.setDefaultQueryExtent(Cn)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(t),r=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,t);r.set(e);let s=new this.navmeshWasm.NavmeshData;s.dataPointer=r.byteOffset,s.size=e.length,this.navMesh.buildFromNavmeshData(s),this.navmeshWasm._free(r.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),i=new Uint8Array(e.size);return i.set(t),this.navMesh.freeNavmeshData(e),i}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),this.eventContext?.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,i){return Cn.x=e.x,Cn.y=e.y,Cn.z=e.z,this.navMesh.addCylinderObstacle(Cn,t,i)}addBoxObstacle(e,t,i){return Cn.x=e.x,Cn.y=e.y,Cn.z=e.z,Ta.x=t.x,Ta.y=t.y,Ta.z=t.z,this.navMesh.addBoxObstacle(Cn,Ta,i)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return this.navmeshWasm!==void 0}},v4e=class{constructor(e,t,i){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,i){let r=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;r.radius=t.radius,r.height=t.height,r.maxAcceleration=t.maxAcceleration,r.maxSpeed=t.maxSpeed,r.collisionQueryRange=t.collisionQueryRange,r.pathOptimizationRange=t.pathOptimizationRange,r.separationWeight=t.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;let s=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),r);return this.transforms.push(i),this.agents.push(s),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new se(0,0,0)),s}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let i=this.crowd.getAgentPosition(e);t.set(i.x,i.y,i.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let i=this.crowd.getAgentVelocity(e);t.set(i.x,i.y,i.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let i=this.crowd.getAgentNextTargetPath(e);t.set(i.x,i.y,i.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let i=this.agents.indexOf(e);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let i=this.crowd.getAgentParameters(e);t.radius!==void 0&&(i.radius=t.radius),t.height!==void 0&&(i.height=t.height),t.maxAcceleration!==void 0&&(i.maxAcceleration=t.maxAcceleration),t.maxSpeed!==void 0&&(i.maxSpeed=t.maxSpeed),t.collisionQueryRange!==void 0&&(i.collisionQueryRange=t.collisionQueryRange),t.pathOptimizationRange!==void 0&&(i.pathOptimizationRange=t.pathOptimizationRange),t.separationWeight!==void 0&&(i.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,i)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),e<=TQ)return;let t=1/60,i=10;if(t<=TQ)this.crowd.update(e);else{let r=Math.floor(e/t);i&&r>i&&(r=i),r<1&&(r=1);let s=e/r;for(let n=0;n<r;n++)this.crowd.update(s)}for(let r=0;r<this.agents.length;r++){let s=this.agents[r],n=this.getAgentPosition(s);if(this.transforms[r].copy(n),this._agentDestinationArmed[r]){let c=n.x-this._agentDestination[r].x,u=n.z-this._agentDestination[r].z,p=this.reachRadii[r],f=this._agentDestination[r].y-this.reachRadii[r],x=this._agentDestination[r].y+this.reachRadii[r],w=c*c+u*u;n.y>f&&n.y<x&&w<p*p&&(this.onReachTarget(s,this._agentDestination[r]),this._agentDestinationArmed[r]=!1)}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,i=this.crowd.getCorners(e),r=i.getPointCount(),s=[];for(t=0;t<r;t++){let n=i.getPoint(t);s.push(new se(n.x,n.y,n.z))}return s}dispose(){this.crowd.destroy()}};function _4e(e){let t=!1;return e.scene.objects.forEach(i=>{i.data.type==="Page"&&!t&&i.data.publish.gameControlObject&&IS.traverseModuleInstances(e,i.id,(r,s,n)=>{for(let c of n)c.data.type==="GameControl"&&c.data.navmesh.enabled&&(t=!0)})}),t}var x4e={type:"change"},AQ={type:"changeZoom"},b4e={type:"changePan"},cy={type:"start"},uy={type:"end",changed:!0},w4e={type:"end",changed:!1},eN=new Vr,CQ=new lt,S4e=2*Math.PI,E4e=1e-8,M4e=.01,tN=new se,Y2=new lt,iN=new se,X2=new Vr,DQ=new mi,T4e={type:"requestRender"},jie=class extends za{constructor(e,t,i={isPlayMode:!1,isExport:!1}){super(),this.object=e,this.domElement=t,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,Nc.DOLLY_ROTATE,Nc.PAN],this.offset=new se,this.eye=new se,this.lastPosition=new se,this.lastQuaternion=new Vr,this.current=new lt,this.overShoot=new lt,this.overRatio=new lt,this.spherical=new aY,this.sphericalDelta=new aY,this.panOffset=new se,this.panLeftV=new se,this.panUpV=new se,this.panV=new se,this.rotateStart=new lt,this.rotateEnd=new lt,this.rotateDelta=new lt,this.panStart=new lt,this.panEnd=new lt,this.panDelta=new lt,this.dollyStart=new lt,this.dollyEnd=new lt,this.dollyDelta=new lt,this.rotationRangeFactor=new lt,this.panRangeFactor=new lt,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=r=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=r.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(iN,X2,tN),this.offset.copy(iN).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(eN.copy(X2).invert()),this.panOffset.applyQuaternion(eN),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(X2),this.panOffset.applyQuaternion(X2)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),iN.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(DQ.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(DQ));let r=this.spherical.phi%S4e;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(ls.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),r>0&&r>Math.PI||r<0&&r>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0){let s=this.hoverRotatePanMode===1?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-s,this.sphericalDelta.phi*=1-s}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>M4e||8*(1-this.lastQuaternion.dot(this.object.quaternion))>E4e?(this.dispatchEvent(x4e),this.object.dispatchEvent(T4e),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=r=>{this.enabled!==!1&&(r.pointerType==="touch"||r.pointerType==="pen"&&fc?this.onPointerDownTouch(r):this.onPointerDownMouse(r),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(cy),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&fc||this.domElement.setPointerCapture(r.pointerId)))},this.onPointerLeave=r=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,tN.subVectors(this.position0,this.target0),this.spherical.setFromVector3(tN),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=r},this.onPointerEnter=r=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?Y2.set(r.clientX-this.domElement.clientWidth/2,r.clientY-this.domElement.clientHeight/2):Y2.set(r.clientX-this.pointerLeaveEvent.clientX,r.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(Y2).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(CQ,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(r.clientX,r.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(Y2).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(r.clientX,r.clientY)),this.update()},this.onPointerMove=r=>{this.enabled!==!1&&(this.checkRaycastLock()||(r.pointerType==="touch"||r.pointerType==="pen"&&fc?this.onPointerMoveTouch(r):this.onPointerMoveMouse(r),r.stopPropagation()))},this.onPointerUp=r=>{this.isPointerDown=!1,Pr.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),Pr.length>1&&r.preventDefault(),this.hasChange?this.dispatchEvent(uy):this.dispatchEvent(w4e),this.state=-1,r&&(r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&fc||this.domElement.releasePointerCapture(r.pointerId))},this.onPointerDownMouse=r=>{let s;switch(this.useKeyEvents?s=this.mouseButtons[r.button]:s=this.mouseButtonsPlay[r.button],s){case 0:if(r.altKey===!0&&!r.shiftKey&&!s2(r)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2;break;case 3:if(s2(r)||r.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}break;case 5:if(s2(r)||r.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=r=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(r);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(r);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(r);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=r=>{switch(Pr.length>1&&r.preventDefault(),this.touches[Pr.length-1]){case Nc.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case Nc.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case Nc.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case Nc.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=r=>{switch(Pr.length>1&&r.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(r),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(r),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(r),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(r),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=G4(()=>this.dispatchEvent(uy),33),this.onMouseWheel=r=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&r.preventDefault(),this.dispatchEvent(cy),this.handleMouseWheel(r),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=r=>{if(r.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!XS)if(r.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(cy),r.scale>this.prevScale?this.dollyIn(this.getZoomScale()):r.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=r.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(uy)},this.onContextMenu=r=>{r.preventDefault()},this.onTouchEnd=r=>{r.preventDefault()},this.onKeyDown=r=>{this.enabled!==!1&&(this.key=r.key,r.key===" "&&this.dispatchEvent(cy))},this.onKeyUp=r=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&r.key==="Alt"&&this.onPointerUp(Pr[0]),r.key===" "&&this.dispatchEvent(uy))},this.onPointerHover=r=>{r.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(r,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(r,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=r=>{r.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.initialSphericalRadius=this.spherical.radius,this.addEventListenersToCamera()}dispatchEvent(e){e.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.hoverRotateDamping=e.hoverRotateDamping??this.dampingFactor,this.useWindowEvents=t==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=e.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/e.zoomLimits.max,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let r=this.object.getTarget().applyQuaternion(eN.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+r.y,this.maxV=e.panVerticalOffset.max+r.y,this.minH=-e.panHorizontalOffset.min+r.x,this.maxH=e.panHorizontalOffset.max+r.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=Bh(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=Bh(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=Bh(Bh(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=Bh(Bh(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,e.orbitTouches===1&&(this.touches[0]=Nc.ROTATE),e.panTouches===1&&(this.touches[0]=Nc.PAN),e.orbitTouches===2&&(this.touches[1]=Nc.DOLLY_ROTATE),e.panTouches===2&&(this.touches[1]=Nc.DOLLY_PAN),e.orbitTouches===3&&(this.touches[2]=Nc.ROTATE),e.panTouches===3&&(this.touches[2]=Nc.PAN),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=e.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,i,r,s,n,c,u){this.overShoot.set(0,0);let p,f,x;e instanceof se?(p=e.x,f=e.y,this.current.set(this.target.x,this.target.y),x=!0):(p=e.theta,f=e.phi,this.current.set(Bh(this.spherical.theta),Bh(this.spherical.phi)),x=!1),i===0&&(this.current.x+=p,this.current.y+=f),(t===3||t===2)&&(!x&&this.isThetaFlipped?this.current.x>r&&this.current.x<0?this.overShoot.x=r-this.current.x:this.current.x<s&&this.current.x>0&&(this.overShoot.x=s-this.current.x):this.current.x>r?this.overShoot.x=r-this.current.x:this.current.x<s&&(this.overShoot.x=s-this.current.x)),(t===3||t===1)&&(this.current.y>n?this.overShoot.y=n-this.current.y:this.current.y<c&&(this.overShoot.y=c-this.current.y)),x||(this.overShoot.x=Bh(this.overShoot.x),this.overShoot.y=Bh(this.overShoot.y)),i!==0?(this.overRatio.copy(this.overShoot).divide(u),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),i===1&&(this.overRatio.x=IQ(Math.abs(this.overRatio.x)),this.overRatio.y=IQ(Math.abs(this.overRatio.y))),this.isPointerDown||i===1?i===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(p*this.overShoot.x<0&&!this.thetaIsFree&&(p*=1-this.overRatio.x),f*this.overShoot.y<0&&!this.phiIsFree&&(f*=1-this.overRatio.y)):i===2&&(!x&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||x&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(p=this.overShoot.x*.05),this.phiIsFree||(f=this.overShoot.y*.05),x?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):x?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(p+=this.overShoot.x,f+=this.overShoot.y),e instanceof se?(e.x=p,e.y=f):(this.thetaIsFree||(e.theta=p),this.phiIsFree||(e.phi=f))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=e===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let r=this.object.position;this.panV.copy(r).sub(this.target);let s=this.panV.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*s/i.clientHeight,this.object.matrixWorld),this.panUp(2*t*s/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(b4e)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(AQ)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(AQ)}zoomOut(e=this.getZoomScale()){this.dispatchEvent(cy),this.dollyOut(e),this.dispatchEvent(uy)}zoomIn(e=this.getZoomScale()){this.dispatchEvent(cy),this.dollyIn(e),this.dispatchEvent(uy)}setZoom(e){if(this.dispatchEvent(cy),this.object.isPerspectiveCamera){let t=this.initialSphericalRadius/e/this.spherical.radius;this.scale=t}else this.object.isOrthographicCamera&&(this.object.zoom=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0);this.dispatchEvent(uy)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e,t=1){e.movementX!==void 0?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(CQ,-this.object.angleOffsetFromUp);let i=this.domElement,r=this.useWindowEvents?window.innerHeight:i.clientHeight,s=2*Math.PI*this.rotateDelta.x/r,n=2*Math.PI*this.rotateDelta.y/r;this.rotateLeft(s),this.rotateUp(n),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e,t=1){e.movementX!==void 0?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(O2e===!1&&s2(e)===!1&&z2e(e)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(this.enableZoom===!1||this.gesture)return;e.deltaY===0?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(Pr.length===2){let e=.5*(Pr[0].pageX+Pr[1].pageX),t=.5*(Pr[0].pageY+Pr[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set(Pr[0].pageX,Pr[0].pageY)}handleTouchStartPan(){if(Pr.length===2){let e=.5*(Pr[0].pageX+Pr[1].pageX),t=.5*(Pr[0].pageY+Pr[1].pageY);this.panStart.set(e,t)}else this.panStart.set(Pr[0].pageX,Pr[0].pageY)}handleTouchStartDolly(){let e=Pr[0].pageX-Pr[1].pageX,t=Pr[0].pageY-Pr[1].pageY,i=Math.sqrt(e*e+t*t);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(Pr.length===2){let i=HF(e),r=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this.rotateEnd.set(r,s)}else{if(e.pointerId!==Pr[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(Pr.length===2){let t=HF(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this.panEnd.set(i,r)}else{if(e.pointerId!==Pr[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=HF(e),i=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(i*i+r*r);this.dollyEnd.set(0,s),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let e=this.options?.showCameraLock;return e&&e(),!0}}else return!1}};function Bh(e){let t=Math.PI*2;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function IQ(e){return 1-Math.pow(1-e,4)}var PQ=class{constructor(e,t,i,r,s,n){this.id=e,this.data=t,this.object=i,this.page=r,this.currentIntersectedObjects=[],this.actions=_a(t,t.actions,r,s,n,i),this.target=t.target,this.triggeringObjects=[];for(let c of t.triggeringObjects){let u=r.scene.find(c);u&&this.triggeringObjects.push(u)}}isValidTriggeringObject(e){return this.target==="all"?!0:this.triggeringObjects.some(t=>t===e||t.isAncestorOf(e.uuid)||e.isAncestorOf(t.uuid))}disconnect(){ga(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.SwitchCamera.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(!1)}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}},Nn;j2e.then(e=>Nn=e);var So=new se,ku=new Vr,Qf=new se,rN=new $o(0,0,0,"YXZ"),RQ=new $o(0,0,0,"XYZ"),Nu=new se,nN=new se,sN=new se(1,1,1),O_=new Vr,$2=new mi,OQ=new mi,A4e={type:"updateMatrix"},LQ=new Vr,oN=new jl,c4={type:"beginEvent",eventName:"Collision"},C4e={type:"beginEvent",eventName:"Trigger"};function D4e(e){if(IS.physicsEnabled(e.scene.objects))return!0;let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.events){if(Array.isArray(r.events)){for(let s of r.events)if(s.data.disabled!==!0&&s.data.type==="GameControl"&&s.data.collisionEnabled){t=!0;break}}else for(let s of Object.values(r.events))if(s.disabled!==!0&&s.type==="GameControl"&&s.collisionEnabled){t=!0;break}}}),t}var gI=e=>e.states.some(t=>t.data.position!==void 0||t.data.rotation!==void 0||t.data.hiddenMatrix!==void 0||t.data.cloner!==void 0||t.data.pathSnapping!==void 0),I4e=class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=t=>{if(t.bodyType()!==Nn.RigidBodyType.Dynamic)return;t.isSleeping()||this.nActiveRigidBodies++;let[i,r,s]=this.rigidBodyToMesh.get(t.handle);if(So.copy(t.translation()).multiplyScalar(this.pixelsPerMeter),ku.copy(t.rotation()),i.matrixWorld.compose(So,ku,r),i.hasNonUniformScale&&i.matrixWorld.multiply(i.shearScale),i.dispatchEvent(A4e),s){let n=i.cloner;if(n&&n.objectForSample===void 0){n.matrixWorld.copy(i.matrixWorld);for(let c of n.children)c.updateMatrixWorld(!0)}for(let c of i.children)c.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(t,i,r)=>{if(r===!1)return;let s,n;if(this.sensorToTriggerEvent[t]?(s=this.sensorToTriggerEvent[t],n=this.sharedGameControlGlobals.colliderToEntity.get(i)):this.sensorToTriggerEvent[i]&&(s=this.sensorToTriggerEvent[i],n=this.sharedGameControlGlobals.colliderToEntity.get(t)),s&&n&&s.isValidTriggeringObject(n)){s.dispatch();return}for(let c=this.sharedGameControlGlobals.createdObjects.length-1;c>=0;c--){let u=this.sharedGameControlGlobals.createdObjects[c];if(u.userData.hasCollisionDestroy&&(u.rigidBody?.collider(0).handle===t||u.rigidBody?.collider(0).handle===i)){this.sharedGameControlGlobals.createdObjects.splice(c,1),u.removeFromParent(),requestAnimationFrame(()=>this.sharedGameControlGlobals.rapierWorld?.removeRigidBody(u.rigidBody));break}}if(this.gameControl?.object!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(t)){let c=this.sharedGameControlGlobals.colliderToEntity.get(i),u=this.sharedGameControlGlobals.entityToCollisionEvents[c.uuid];if(u===void 0)return;for(let p of u)p.data.target==="character"&&this.dispatchCollisionEvent(p,c,i)}else if(this.gameControl?.object!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(i)){let c=this.sharedGameControlGlobals.colliderToEntity.get(t),u=this.sharedGameControlGlobals.entityToCollisionEvents[c.uuid];if(u===void 0)return;for(let p of u)p.data.target==="character"&&this.dispatchCollisionEvent(p,c,t)}else{let c=this.sharedGameControlGlobals.colliderToEntity.get(t),u=this.sharedGameControlGlobals.entityToCollisionEvents[c.uuid];if(u!==void 0)for(let x of u)x.data.target==="scene"&&this.dispatchCollisionEvent(x,c,t);let p=this.sharedGameControlGlobals.colliderToEntity.get(i),f=this.sharedGameControlGlobals.entityToCollisionEvents[p?.uuid];if(f!==void 0)for(let x of f)x.data.target==="scene"&&this.dispatchCollisionEvent(x,p,i)}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=Rie,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach(t=>{t.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events){if(i.data.disabled===!0)continue;let r=i.data.actions?.find(s=>s.data.type==="Destroy")?.data;if(r)for(let s of r.objects){let n=this.page.scene.find(s);n&&(n.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events)if(!(i.data.disabled===!0||i.data.type!=="DragDrop"))for(let r of i.data.objects){let s=this.page.scene.find(r);s&&(s.userData.hasDrag=!0)}})}initBVH(){let e=[];if(this.page.traverseChildren(t=>{let i,r=t instanceof oD,s=t instanceof lD;if(t instanceof Hu||r||s)return;t instanceof qa?i=t.object:i=t;let n=i.dataPatched;if(n.physics?.enabled==="visibility"?!n.visible:!n.physics?.enabled)return!0;let c=t.geometry,u=i.userData.hasDestroy===!0,p=i.userData.hasDrag===!0;if(gI(n)||u||p||i.dataPatched.events.some(f=>f.data.disabled!==!0&&f.data.type==="GameControl"))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;c&&e.push(cp(c,t.matrixWorld))}),e.length>0){let t=Ay(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new hS(t)}}addRigidBody(e,t,i){let r=[],s="geometry"in e?e.geometry:void 0,n=t.dataPatched;if(s?.getAttribute("position")!==void 0&&r.push(cp(s,e.shearScale)),n.physics.fusedBody){let c=this.gatherChildrenGeom(e,r);e.traverseObject(c),e.children.forEach(p=>p.updateMatrixWorld(!0));let u=e.cloner;u&&u.objectForSample===void 0&&n.physics.rigidBody==="dynamic"&&(u.traverseObject(c),u.children.forEach(p=>p.updateMatrixWorld(!0)))}if(r.length>0){let c,u=!i.fromCreate&&n.physics.rigidBody==="dynamic"||i.fromCreate&&i.dynamic;u?(c=Nn.RigidBodyDesc.dynamic(),c.setLinearDamping(n.physics.damping).setAngularDamping(n.physics.damping).setAdditionalMass(1e-9).setGravityScale(n.physics.gravityScale).enabledRotations(...n.physics.enabledRotation).enabledTranslations(...n.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(c=Nn.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):c=Nn.RigidBodyDesc.fixed();let p=Ay(r);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(So,ku,Qf),e.position0=So.clone().divideScalar(this.pixelsPerMeter),e.rotation0=ku.clone(),So.divideScalar(this.pixelsPerMeter),c.setTranslation(So.x,So.y,So.z).setRotation(ku),s?p?.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):p?.scale(Qf.x/this.pixelsPerMeter,Qf.y/this.pixelsPerMeter,Qf.z/this.pixelsPerMeter);let f=this.sharedGameControlGlobals.rapierWorld.createRigidBody(c);u&&this.rigidBodyToMesh.set(f.handle,[e,Qf.clone(),n.physics.fusedBody]);let x=!(n.geometry===void 0||n.geometry.type==="SubdivGeometry"||n.geometry.type==="NonParametricGeometry"||n.geometry.type==="BooleanGeometry"||n.geometry.type==="VectorGeometry"||n.geometry.type==="StarGeometry"||n.geometry.type==="RectangleGeometry"||n.geometry.type==="EllipseGeometry"||n.geometry.type==="TriangleGeometry"||n.geometry.type==="TorusGeometry"||n.geometry.type==="HelixGeometry");try{this.addCollider(f,n.physics,p,t,x)}catch{try{this.addCollider(f,n.physics,p,t,!1)}catch(w){console.error(w)}}e.rigidBody=f}}addBoundsTree(e){let t=[];if(e.geometry?.getAttribute("position")!==void 0&&e.geometry?.getAttribute("position").count>0&&t.push(cp(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,t)),e.children.forEach(i=>i.updateMatrixWorld(!0)),t.length>0){let i=Ay(t,!1);e.bvhGeometry=i,i.getAttribute("position").count>0&&(e.bvhGeometry.boundsTree=new hS(i),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e))}}addCollider(e,t,i,r,s=!0){if(i?.getAttribute("position").count===0||i?.getIndex()?.count===0)return;let n;i&&(t.colliderType==="trimesh"?n=Nn.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):n=Nn.ColliderDesc.convexMesh(i.getAttribute("position").array,s?i.getIndex().array:void 0)),n.setFrictionCombineRule(Nn.CoefficientCombineRule.Average).setRestitutionCombineRule(Nn.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let c=this.sharedGameControlGlobals.rapierWorld.createCollider(n,e);this.sharedGameControlGlobals.colliderToEntity.set(c.handle,r),this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid]?.some(u=>u.target==="scene")&&c.setActiveEvents(Nn.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,t){return(i,r)=>{if(r===0)return;let s;if(i instanceof Hu)if(i.objectForSample){if(i.objectForSample.dataPatched.physics.fusedBody)return;s=i.object}else return i.object.dataPatched.physics.fusedBody===!0&&i.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(i instanceof qa)s=i.object;else if(s=i,s.dataPatched.cloner?.hideBase)return!0;let n=s.dataPatched;if(n.physics.enabled==="visibility"?!n.visible:!n.physics.enabled)return!0;r===1?e.hasNonUniformScale?i.matrixWorld.multiplyMatrices(e.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let c=i.geometry;c?.getAttribute("position")!==void 0&&t.push(cp(c,i.matrixWorld))}}activate(e){if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let t=this.page.playCamera,i=!1,r=5,s=8,n=9,c="drag",u=this.page.data.publish.gameControlObject,p=u!==null?this.page.find(u):null,f=null;if(p)for(let E of p.data.events){if(E.data.disabled||E.data.type!=="GameControl")continue;let A=p;for(;this.usePhysics&&(A=A.parent)?.parent!==null;)A.data.physics?.fusedBody;E.data.collisionEnabled&&(this.needsCollisionDetection=!0),f===null&&(f=E.data)}if(this.page.traverseEntity(E=>{for(let A of E.dataPatched.events)if(A.data.disabled===!1&&A.data.type==="Trigger")return this.needsCollisionDetection=!0,!0}),p&&f&&(p.data.visible===!0||p.data.physics.enabled===!0)){i=i||f.camera===t.uuid||p.uuid===t.uuid;let E=new Oie(p,this.renderer.domElement,f,this.eventContext.page.data.globalPhysics,this,p.uuid!==t.uuid&&f.camera===t.uuid,t,this.page,this.sharedAssets);this.gameControl=E,r=f.joystickPosLoc,s=f.joystickRotLoc,n=f.jumpTouchButtonLoc,c=f.rotByTouch,fc&&f.touchControl&&(this.joystickToGameControls[r]="pos",f.moveMode==="walk"&&(this.joystickToGameControls[n]="jmp"),c==="joystick"&&(this.joystickToGameControls[s]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let E=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new y4e(this.usePhysics,this.isExport);let A;E.collider.type==="sphere"?A=E.collider.radius*2:A=E.collider.height,A=Math.floor(A/E.navmesh.ch-1),this.navigationMeshWrapper.init(pt(me({},E.navmesh),{walkableHeight:A}),this.gameControl,this.eventContext)}}if(i===!1){let{enableRotate:E,enablePan:A,enableZoom:I,autoRotate:P,hoverRotatePanMode:O}=this.eventManager.publish.orbitControls;(E||A||I||P||O!==0)&&(this.orbitControls=new jie(t,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let x=this.renderer.domElement.width/this.renderer.getPixelRatio(),w=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((E,A)=>{let I=document.body.appendChild(document.createElement("div")),[P,O,k]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[A],U=(x-5*P)/4+P,j={},V=E==="jmp",$=V?0:P;A<10?(A<5?j.top=$/2:j.bottom=$/2,j.left=$/2+A%5*U):A===10?(j.left=$/2,j.top=w/2):(j.right=$/2,j.top=w/2),j.top?j.top-=O[1]:j.bottom+=O[1],j.left?j.left+=O[0]:j.right-=O[0];for(let X in j)j[X]+="px";if(V){let X=I.appendChild(document.createElement("div"));Object.assign(X.style,j,{position:"absolute",width:P+"px",height:P+"px",backgroundColor:`rgba(255,255,255,${k==="show"?.4:0})`,zIndex:"9999",borderRadius:P+"px",border:k==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let ee=P/16*16*.4;k==="show"&&(X.innerHTML=`
						<svg width="${ee}" height="${P*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),X.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),X.addEventListener("touchend",oe=>oe.preventDefault()),this.joysticks[A]=[void 0,I];return}let Y={zone:I,mode:"static",position:j,size:P};k==="hide"&&(Y.restOpacity=0);let J=jke.create(Y);J.on("move",(X,ee)=>{let oe=this.gameControl;E==="pos"?ee.force<.2?oe.moveForce=0:(oe.movementState.movePosZ=Math.sin(-ee.angle.radian),oe.movementState.movePosX=Math.cos(-ee.angle.radian),ee.force>1.2?oe.movementState.run=1:oe.movementState.run=0,ee.force<.3?oe.moveForce=(ee.force-.2)/.1:oe.moveForce=1):E==="rot"&&(ee.force<.2?oe.rotForce=0:(oe.movementState.rotPosX=ee.vector.y,oe.movementState.rotPosY=-ee.vector.x,ee.force<.3?oe.rotForce=(ee.force-.2)/.1:oe.rotForce=1)),this.requestRender()}),J.on("end",(X,ee)=>{let oe=this.gameControl;E==="pos"?(oe.movementState.movePosZ=0,oe.movementState.movePosX=0,oe.moveForce=1):E==="rot"&&(oe.movementState.rotPosX=0,oe.movementState.rotPosY=0,oe.rotForce=1)}),this.joysticks[A]=[J,I]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(E=>E.initialDisabled=!1)},80)}initPhysics(){this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=new Nn.World(new Nn.Vector3(0,this.gravity,0)),this.events=new Nn.EventQueue(!0);let e=[],t=[];if(this.page.traverseChildren(c=>{let u;if(c instanceof Hu)if(c.objectForSample){if(c.objectForSample.dataPatched.physics.fusedBody)return;u=c.object}else return c.object.dataPatched.physics.fusedBody===!0&&c.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(c instanceof qa)u=c.object;else{if(c instanceof lD||c instanceof oD)return;if(u=c,u.dataPatched.cloner?.disabled===!1&&u.dataPatched.cloner?.hideBase&&u.dataPatched.physics?.fusedBody!==!0)return!0}let p=u.dataPatched,f;for(let O of p.events)O.data.disabled!==!0&&O.data.type==="GameControl"&&(f=O.data);if(!p.physics||(p.physics.enabled==="visibility"?!p.visible:!p.physics.enabled))return!0;c.updateMatrixWorldSVD();let x=gI(p),w=!1,E=u.userData.hasDestroy,A=u.userData.hasDrag,I=!1;for(let O of p.events)if(O.data.disabled!==!0){if(O.data.type==="Collision"){w=!0;let k=new a4e(O.id,O.data,u,this.page,this.sharedAssets,this.eventManager);k.initialDisabled=!0,this.collisionEvents.push(k),this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid].every(U=>U.id!==O.id)?this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid].push(k):this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid]=[k]}else if(O.data.type==="Follow"){I=!0;let k=O.data.target;c.traverseVisible(U=>{U.userData.isFollowingObj=k})}}p.physics.rigidBody==="dynamic"&&p.physics.fusedBody===!1&&(c.matrixWorldFusedFalse=c.matrixWorld.clone());let P=c.geometry;if(f!==void 0){let O=Nn.RigidBodyDesc.kinematicPositionBased();(c.hasNonUniformScale?c.matrixWorldRigid:c.matrixWorld).decompose(So,ku,Qf),c.position0=So.clone().divideScalar(this.pixelsPerMeter),c.rotation0=ku.clone(),So.divideScalar(this.pixelsPerMeter),O.setTranslation(So.x,So.y,So.z).setRotation(ku);let k=this.sharedGameControlGlobals.rapierWorld.createRigidBody(O);c.rigidBody=k;let U;f.collider.type==="sphere"?U=Nn.ColliderDesc.ball(f.collider.radius/this.pixelsPerMeter):f.collider.type==="capsule"?U=Nn.ColliderDesc.capsule((f.collider.height/2-f.collider.radius)/this.pixelsPerMeter,f.collider.radius/this.pixelsPerMeter):U=Nn.ColliderDesc.cuboid(f.collider.width/this.pixelsPerMeter/2,f.collider.height/this.pixelsPerMeter/2,f.collider.depth/this.pixelsPerMeter/2),U.setFrictionCombineRule(Nn.CoefficientCombineRule.Average).setRestitutionCombineRule(Nn.CoefficientCombineRule.Average).setDensity(p.physics.density).setFriction(p.physics.friction).setRestitution(p.physics.restitution);let j=this.sharedGameControlGlobals.rapierWorld.createCollider(U,k);this.sharedGameControlGlobals.colliderToEntity.set(j.handle,u),So.fromArray(f.collider.position).multiply(Qf.setFromMatrixScale(u.matrixWorld)).divideScalar(this.pixelsPerMeter),j.setTranslationWrtParent(So);let V=new Vr().setFromEuler(new $o().setFromVector3(new se().fromArray(f.collider.rotation)));j.setRotationWrtParent(V),j.setActiveEvents(Nn.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(u,!0)}else p.physics.rigidBody==="dynamic"||x||I||E||A||w?(this.addRigidBody(c,u,{hasFollow:I,hasTransformAnim:x,hasDrag:A}),this.generateSensorColliderDescs(u,p.physics.fusedBody)):(P&&e.push(cp(P,c.matrixWorld)),p.physics.fusedBody&&c.traverseObject((O,k)=>{if(k===0)return;let U;if(O instanceof Hu)if(O.objectForSample){if(O.objectForSample.dataPatched.physics.fusedBody)return;U=O.object}else return O.object.dataPatched.physics.fusedBody===!0&&O.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else{if(O instanceof lD||O instanceof oD)return;if(O instanceof qa)U=O.object;else if(U=O,U.dataPatched.cloner?.hideBase)return!0}let j=U.dataPatched;if(j.physics.enabled==="visibility"?!j.visible:!j.physics.enabled)return!0;let V=O.geometry;V?.getAttribute("position")!==void 0&&e.push(cp(V,O.matrixWorld))}),this.generateSensorColliderDescs(u,p.physics.fusedBody,t));if(p.physics?.fusedBody===!0||f)return!0}),e.length===0)return;let i=Ay(e);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let r=Nn.RigidBodyDesc.fixed(),s=this.sharedGameControlGlobals.rapierWorld.createRigidBody(r),n=Nn.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(Nn.CoefficientCombineRule.Multiply).setRestitutionCombineRule(Nn.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(n,s);for(let[c,u]of t){let p=this.sharedGameControlGlobals.rapierWorld.createCollider(c,s);this.sensorToTriggerEvent[p.handle]=u}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(e=>{for(let t of e.dataPatched.events)if(t.data.type==="Trigger"&&t.data.disabled!==!0){let i=new PQ(t.id,t.data,e,this.page,this.sharedAssets,this.eventManager),r=new mi().compose(Nu.fromArray(t.data.position),O_.setFromEuler(RQ.fromArray(t.data.rotation)),sN);if(t.data.triggerZone==="box"){let s=new mo;s.min.fromArray(t.data.size).multiplyScalar(-.5),s.max.fromArray(t.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([s,r,e,i])}else this.sharedGameControlGlobals.triggers.push([t.data.radius,r,e,i])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(e=>e.disconnect()),this.sharedGameControlGlobals.triggers.forEach(e=>e[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){if(this.isEnabled){this.isEnabled=!1,this.page.traverse(e=>{let t=e;t.matrixWorldFusedFalse&&(t.matrixWorldFusedFalse=void 0),t.rigidBody&&(t.rigidBody=void 0),t.position0&&(t.position0=void 0),t.rotation0&&(t.rotation0=void 0)}),this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),this.gameControl?.reset(),this.gameControl?.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([e,t])=>{e?.destroy(),t.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),this.navigationMeshWrapper?.dispose(),this.navigationMeshWrapper=void 0;for(let e of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))e.forEach(t=>t.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,t,i){if(!this.isEnabled)return!0;let r=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(r=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,r=!1):this.initializationCounter===2&&this.gameControl&&(r=!this.gameControl.update(e,t,i)&&r),this.usePhysics===!1&&this.checkTrigger(),this.usePhysics){let s=.016666666666666666;if(e===0)r=this.stepPhysics()&&r;else{let n=e/1e3;n<s&&n>s*.55&&(n=s),this.accumulator+=n;let c=performance.now(),u=0,p=6;for(;this.accumulator>=s&&u<p&&(r=this.stepPhysics()&&r,this.accumulator-=s,u++,!(performance.now()-c>s*1e3)););this.accumulator=this.accumulator%s}}return r}stepPhysics(){for(let e of this.sharedGameControlGlobals.entitiesWithTransformAnim){(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(So,ku,Qf),rN.setFromQuaternion(ku);let t=e;t.prevR===void 0?(t.prevR=rN.clone(),t.prevT=So.clone()):(t.prevR.copy(rN),t.prevT.copy(So)),e.rigidBody&&(e.rigidBody.setNextKinematicTranslation(So.divideScalar(this.pixelsPerMeter)),e.rigidBody.setNextKinematicRotation(ku))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),this.events?.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,t,i){let r=(this.sharedGameControlGlobals.rapierWorld?.getCollider(i))._parent,s;if(t.cloner){for(let n of t.cloner.children)if(n.rigidBody===r){s=n;break}}e.dispatch(s),t.dispatchEvent(c4)}updateUseWindowEvents(e){this.orbitControls?.updateUseWindowEvents(e)}generateSensorColliderDescs(e,t,i){let r=OQ.copy(e.matrixWorld).invert();e.traverseEntity((s,n)=>{if(t===!1&&n===1)return!0;for(let c of s.dataPatched.events)if(c.data.type==="Trigger"&&c.data.disabled!==!0){let u=new PQ(c.id,c.data,s,this.page,this.sharedAssets,this.eventManager),p;if(c.data.triggerZone==="box"?p=Nn.ColliderDesc.cuboid(...c.data.size.map(f=>f/(2*this.pixelsPerMeter))):p=Nn.ColliderDesc.ball(c.data.radius/this.pixelsPerMeter),p.setDensity(0).setSensor(!0).setActiveEvents(Nn.ActiveEvents.COLLISION_EVENTS),Nu.fromArray(c.data.position),O_.setFromEuler(RQ.fromArray(c.data.rotation)),$2.compose(Nu,O_,sN).premultiply(s.matrixWorld),i?($2.decompose(Nu,O_,nN),p.setActiveCollisionTypes(Nn.ActiveCollisionTypes.KINEMATIC_FIXED|Nn.ActiveCollisionTypes.DYNAMIC_FIXED)):($2.premultiply(r).decompose(Nu,O_,nN),e.rigidBody.bodyType()===Nn.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===Nn.RigidBodyType.Fixed?p.setActiveCollisionTypes(Nn.ActiveCollisionTypes.KINEMATIC_FIXED|Nn.ActiveCollisionTypes.DYNAMIC_FIXED):p.setActiveCollisionTypes(Nn.ActiveCollisionTypes.KINEMATIC_KINEMATIC|Nn.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),Nu.divideScalar(this.pixelsPerMeter),p.setTranslation(Nu.x,Nu.y,Nu.z),p.setRotation(O_),i)i.push([p,u]);else{let f=this.sharedGameControlGlobals.rapierWorld.createCollider(p,e.rigidBody);this.sensorToTriggerEvent[f.handle]=u}}})}checkTrigger(){let e;for(let t=0;t<this.sharedGameControlGlobals.triggers.length;t++){let[i,r,s,n]=this.sharedGameControlGlobals.triggers[t];for(let c=0;c<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;c++){let u=this.sharedGameControlGlobals.entitiesWithTransformAnim[c];if(s===u||n.isValidTriggeringObject(Ln.is(u)?u:u.object)===!1)continue;let p=OQ.copy(s.matrixWorld).decompose(Nu,LQ,nN).compose(Nu,LQ,sN).multiply(r),f=$2.copy(u.matrixWorld).invert().multiply(p);i instanceof mo?e=u.bvhGeometry.boundsTree.intersectsBox(i,f):(oN.radius=i,oN.center.setFromMatrixPosition(f),e=u.bvhGeometry.boundsTree.intersectsSphere(oN)),e?n.currentIntersectedObjects.indexOf(u)===-1&&(n.currentIntersectedObjects.push(u),n.dispatch(),s.dispatchEvent(C4e)):n.currentIntersectedObjects=n.currentIntersectedObjects.filter(x=>x!==u)}}}};function P4e(e){let t=this._clip.duration,i=this._clip.start??0,r=this.loop,s=this.time+e,n=this._loopCount,c=r===h4;if(e===0)return n===-1?s:c&&(n&1)===1?t-(s-i):s;if(r===XQ){n===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(n===-1&&(e>=0?(n=0,this._setEndings(!0,this.repetitions===0,c)):this._setEndings(this.repetitions===0,!0,c)),s>=t||s<i){let u=Math.floor((s-i)/(t-i));s-=(t-i)*u,n+=Math.abs(u);let p=this.repetitions-n;if(p<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,c||(s=e>0?t:i,this.repetitions===1&&(s=t)),this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(p===1){let f=e<0;this._setEndings(f,!f,c)}else this._setEndings(!1,!1,c);this._loopCount=n,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:u})}}else this.time=s;if(c&&(n&1)===1)return t-(s-i)}return s}var zQ=!1,R4e=class{constructor(e,t,i,r){this.scene=e,this.requestRender=t,this.updateDisplayProgress=i,this.animationInspectorState=r,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=s=>{s.data.type==="Empty"&&s.data.animations&&s.data.animations.forEach((n,c)=>{let u=n[0]+"/";if(Array.isArray(s.identity)?u+=s.identity[0]:u+=s.uuid,this.clipIdToAction[u])return;let p=_N.parse(JSON.parse(n[2]));s.animations[c]=p;let f=this.mixer.clipAction(p,s);zQ===!1&&(Object.getPrototypeOf(f)._updateTime=P4e,zQ=!0),f.clampWhenFinished=!0,this.clipIdToAction[u]=f})},this.mixer=new K1e(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,t){let i=this.scene.find(t);if(!i)return;let r=i.animations.find(n=>n.uuid===e);if(!r)return;let s=this.clipIdToAction[e];!s||(s.stop(),this.mixer.uncacheClip(r),delete this.clipIdToAction[e],i.animations=i.animations.filter(n=>n.uuid!==e))}get isPlaying(){return Object.values(this.clipIdToAction).some(e=>e.isRunning())}playFromInspector(e){this.mixer.stopAllAction();let t=this.clipIdToAction[e];!t||(t.play(),this.activeClip=t.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(e=>{e.repetitions=1/0,e.loop=$Q}),this.mixer.stopAllAction(),this.requestRender()}play(e){let t=e.clipId+"/"+e.object,i=this.clipIdToAction[t];if(i)return e&&(e.repeat>=0&&(i.repetitions=e.repeat+1),e.direction==="pingpong"&&e.repeat!==0&&(i.loop=h4)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(e){let t=this.clipIdToAction[e];!t||(t.play(),t.paused=!1,this.requestRender())}pauseFromInspector(e){let t=this.clipIdToAction[e];!t||(t.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||this.animationInspectorState?.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*(this.maxFrames-1)%(this.maxFrames-1))),this.requestRender()}get maxFrames(){return Eie(this.activeClip??void 0)}setProgressFromInspector(e,t){if(!this.clipIdToAction[t])return;this.activeClip!==this.clipIdToAction[t].getClip()&&this.playFromInspector(t);let i=this.clipIdToAction[t].paused;this.clipIdToAction[t].paused=!1,this.mixer.setTime(Math.min(e/(this.maxFrames-1),.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[t].paused=!0)}},aN=new WeakMap,O4e=class extends HS{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){let s=new xN(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,n=>{this.decodeDracoFile(n,t).catch(r)},i,r)}decodeDracoFile(e,t,i,r){let s={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(e,s).then(t)}decodeGeometry(e,t){let i=JSON.stringify(t);if(aN.has(e)){let u=aN.get(e);if(u.key===i)return u.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,s=this.workerNextTaskID++,n=e.byteLength,c=this._getWorker(s,n).then(u=>(r=u,new Promise((p,f)=>{r._callbacks[s]={resolve:p,reject:f},r.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(u=>this._createGeometry(u.geometry));return c.catch(()=>!0).then(()=>{r&&s&&this._releaseTask(r,s)}),aN.set(e,{key:i,promise:c}),c}_createGeometry(e){let t=new fr;e.index&&t.setIndex(new Fr(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let r=e.attributes[i],s=r.name,n=r.array,c=r.itemSize;t.setAttribute(s,new Fr(n,c))}return t}_loadLibrary(e,t){let i=new xN(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((r,s)=>{i.load(e,r,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{let r=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let s=L4e.toString(),n=["/* draco decoder */",r,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([n]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(s){let n=s.data;switch(n.type){case"decode":r._callbacks[n.id].resolve(n);break;case"error":r._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,s){return r._taskLoad>s._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function L4e(){let e,t;onmessage=function(c){let u=c.data;switch(u.type){case"init":e=u.decoderConfig,t=new Promise(function(x){e.onModuleLoaded=function(w){x({draco:w})},DracoDecoderModule(e)});break;case"decode":let p=u.buffer,f=u.taskConfig;t.then(x=>{let w=x.draco,E=new w.Decoder,A=new w.DecoderBuffer;A.Init(new Int8Array(p),p.byteLength);try{let I=i(w,E,A,f),P=I.attributes.map(O=>O.array.buffer);I.index&&P.push(I.index.array.buffer),self.postMessage({type:"decode",id:u.id,geometry:I},P)}catch(I){console.error(I),self.postMessage({type:"error",id:u.id,error:I.message})}finally{w.destroy(A),w.destroy(E)}});break}};function i(c,u,p,f){let x=f.attributeIDs,w=f.attributeTypes,E,A,I=u.GetEncodedGeometryType(p);if(I===c.TRIANGULAR_MESH)E=new c.Mesh,A=u.DecodeBufferToMesh(p,E);else if(I===c.POINT_CLOUD)E=new c.PointCloud,A=u.DecodeBufferToPointCloud(p,E);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!A.ok()||E.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+A.error_msg());let P={index:null,attributes:[]};for(let O in x){let k=self[w[O]],U,j;if(f.useUniqueIDs)j=x[O],U=u.GetAttributeByUniqueId(E,j);else{if(j=u.GetAttributeId(E,c[x[O]]),j===-1)continue;U=u.GetAttribute(E,j)}P.attributes.push(s(c,u,E,O,k,U))}return I===c.TRIANGULAR_MESH&&(P.index=r(c,u,E)),c.destroy(E),P}function r(c,u,p){let f=p.num_faces()*3,x=f*4,w=c._malloc(x);u.GetTrianglesUInt32Array(p,x,w);let E=new Uint32Array(c.HEAPF32.buffer,w,f).slice();return c._free(w),{array:E,itemSize:1}}function s(c,u,p,f,x,w){let E=w.num_components(),A=p.num_points()*E,I=A*x.BYTES_PER_ELEMENT,P=n(c,x),O=c._malloc(I);u.GetAttributeDataArrayForAllPoints(p,w,P,I,O);let k=new x(c.HEAPF32.buffer,O,A).slice();return c._free(O),{name:f,array:k,itemSize:E}}function n(c,u){switch(u){case Float32Array:return c.DT_FLOAT32;case Int8Array:return c.DT_INT8;case Int16Array:return c.DT_INT16;case Int32Array:return c.DT_INT32;case Uint8Array:return c.DT_UINT8;case Uint16Array:return c.DT_UINT16;case Uint32Array:return c.DT_UINT32}}}var dm;function z4e(){return dm||(dm=new O4e,dm.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),dm.decoderPending}function F4e(e){return jn(this,null,function*(){if(dm){let t={attributeIDs:dm.defaultAttributeIDs,attributeTypes:dm.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=yield dm.decodeGeometry(new Int8Array(e).buffer,t)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,s])=>({name:r,itemSize:s.itemSize,array:s.array}))}}return null})}function k4e(e,t){return jn(this,null,function*(){let[i,r]=RJ(kN.deserialize(new Uint8Array(e)));return nee(i),t&&t(i),r.result().data})}function N4e(e){let t=[];return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="NonParametricGeometry"&&r.geometry.data.draco!==void 0&&t.push(r)}),t}function B4e(e){return jn(this,null,function*(){for(let t of e){let i=yield F4e(t.geometry.data.draco);if(i){let r=t.geometry.data;i.index&&(r.index={array:i.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let s={};i.attributes.forEach(({name:n,array:c,itemSize:u})=>{s[n]={array:c,itemSize:u,type:"Float32Array",normalized:!1}}),r.attributes=s,r.draco=void 0}}})}var U4e=class{constructor(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0],this._delay=500,this._distance=2,this._onMouseDown=e=>{let t=[e.clientX,e.clientY],i=new Date().getTime();if(this._clickCount>0){let r=t[0]-this._lastPosition[0],s=t[1]-this._lastPosition[1];Math.sqrt(r*r+s*s)>this._distance&&(this._clickCount=0)}this._lastPosition=t,this._clickCount=i-this._lastTime>this._delay?1:this._clickCount+1,this._lastTime=i},this._onMouseUp=e=>{}}start(e,t=500,i=2){this._target&&this.stop(),this.reset(),this._delay=t,this._distance=i,this._target=e,this._target.addEventListener("pointerdown",this._onMouseDown,!1),this._target.addEventListener("pointerup",this._onMouseUp,!1)}stop(){this._target&&(this._target.removeEventListener("pointerdown",this._onMouseDown,!1),this._target.removeEventListener("pointerup",this._onMouseUp,!1),this._target=void 0)}get clickCount(){return this._clickCount}reset(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0]}},j4e=class{constructor(e,t,i,r,s,n,c,u){this.eventId=e,this.id=t,this.data=i,this.dataEvent=r,this.object=s,this.stage=!1,this.actions=_a(r,i.actions,n,c,u,s)}disconnect(){ga(this.actions)}dispatchIn(){this.actions.Audio.forEach(e=>e.dispatchBasic()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Video.forEach(e=>e.dispatchBasic()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.Link.forEach(e=>e.dispatch()),this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.actions.Transition.forEach(e=>e.toggle()),this.actions.Animation.forEach(e=>e.play()),this.actions.SwitchCamera.forEach(e=>e.play()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}dispatchOut(){this.actions.Transition.forEach(e=>{e.toggle()})}},V4e=class extends Gl{constructor(e,t){super(e),this.eventManager=t,this.breakpoints=[],this.resize=(i,r)=>{this.breakpoints.forEach(s=>{let n=jN.deviceToSize(s.data.size),c=s.dataEvent.orientation==="horizontal"?i:r,u;switch(s.data.operator){case"<":u=c<n[0];break;case">":u=c>n[0];break;case"<>":u=c>n[0]&&c<n[1];break}s.stage!==u&&(s.stage=u,s.stage?s.dispatchIn():s.dispatchOut())})},this.onResizeObserver=new ResizeObserver(i=>{for(let r of i){let{width:s,height:n}=r.contentRect;this.resize(s,n)}})}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let r=s=>{if(!(!s.visible||!s.data?.events.length))for(let{data:n,id:c}of s.data.events)n.disabled||n.type==="Resize"&&n.breakpoints.forEach(({data:u,id:p})=>{try{let f=new j4e(c,p,u,n,s,e,t,this.eventManager);this.breakpoints.push(f)}catch{}})};e.traverseEntity(s=>{(s instanceof Ha||s instanceof ua)&&s.frame?.traverse(n=>{r(n)}),r(s)})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(e=>{e.disconnect()}),this.breakpoints=[]}},G4e=class extends Gl{constructor(e,t){super(e),this.eventManager=t,this.userAPIs={},this.events=[],this.onSuccess=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchSuccess()})},this.onError=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchError()})},this.userAPIs=e.sharedAssets.getUserAPIs()}connect(){this.eventContext.page.traverseEntity(e=>{e.data?.events.filter(t=>t.data.type==="API"&&!t.data.disabled).forEach(t=>{this.events.push(new H4e(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userAPIs).forEach(([e,t])=>{t.on("success",this.onSuccess),t.on("error",this.onError),t.autostart&&t.callUserAPI(this.eventContext.sharedAssets)})}disconnect(){Object.entries(this.userAPIs).forEach(([e,t])=>{t.off("success",this.onSuccess),t.off("error",this.onError)})}},H4e=class{constructor(e,t,i,r,s,n){this.id=e,this.data=t,this.object=i,this.successActions=_a(t,t.successActions,r,s,n,i),this.errorActions=_a(t,t.errorActions,r,s,n,i)}dispatchSuccess(){this.dispatchActions(this.successActions)}dispatchError(){this.dispatchActions(this.errorActions)}dispatchActions(e){e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}},W4e=class extends Gl{constructor(e,t){super(e),this.eventManager=t,this.userWebhooks={},this.events=[],this.onMessage=({userWebhookId:i})=>{this.events.forEach(r=>{r.data.userWebhookId===i&&r.dispatch()})},this.userWebhooks=e.sharedAssets.getUserWebhooks()}connect(){this.eventContext.page.traverseEntity(e=>{e.data?.events.filter(t=>t.data.type==="WEBHOOK"&&!t.data.disabled).forEach(t=>{this.events.push(new q4e(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userWebhooks).forEach(([e,t])=>{t.connect(),t.on("message",this.onMessage)})}disconnect(){Object.entries(this.userWebhooks).forEach(([e,t])=>{t.off("message",this.onMessage),t.disconnect()})}},q4e=class{constructor(e,t,i,r,s,n){this.id=e,this.data=t,this.object=i,this.actions=_a(t,t.actions,r,s,n,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}};function Y4e(){let e=document.createElement("textarea");return e.style.position="fixed",e.style.top="200px",e.style.left="400px",e.style.zIndex="-1",e.style.border="1px solid rgba(255,0,0,0.5)",e.style.width="10px",e.style.height="500px",e.style.color="white",e.style.opacity="0.5",e.style.background="transparent",e.style.display="none",e.style.margin="0px",e.style.padding="0px",e.style.boxSizing="content-box",e.style.pointerEvents="none",e}var X4e=new se(0,0,1),FQ=new se,kQ=new se,NQ=new Ao,$4e=class{constructor(e,t,i,r,s){this.containerScene=e,this.raycaster=t,this.sharedAssets=i,this.requestRender=r,this.onExit=s,this.htmlInput=null,this.virtualInput=null,this.helper=new Rte,this.doubleClickHandler=new U4e,this.isDragging=!1,this.plane=new zl,this.caretInterval=0,this.planeIntersection=new se,this.projected=new lt,this._lastIndex=0,this._isFirstDragMove=!1,this.selectionOnDragStart=0,this.onTextMaterialChanged=()=>{let n=this.virtualInput?.data;if(this.virtualInput!==void 0&&n){let c=n.material,u=typeof c=="string"?this.sharedAssets.data.materials[c]:c,p=uFe(u,this.sharedAssets);this.helper.setCaretColor(p)}},this.stopAnimateTextCursor=()=>{clearInterval(this.caretInterval),this.helper&&(this.helper.caretMesh.visible=!1)},this.startAnimateTextCursor=()=>{this.stopAnimateTextCursor(),this.helper&&(this.helper.caretMesh.visible=!0,this.caretInterval=setInterval(()=>{this.helper&&(this.helper.caretMesh.visible=!this.helper.caretMesh.visible),this.requestRender()},600))},this.handleCaretUpdate=n=>{if(!this.htmlInput||!this.virtualInput)return;let c=this.helper,u=n?.key==="ArrowLeft"||n?.key==="ArrowRight",p=n?.key==="ArrowUp"||n?.key==="ArrowDown";this.htmlInput.selectionStart===this.htmlInput.selectionEnd?(c.setCaretPosition(this.htmlInput.selectionStart,{horizontalKeyMove:u,verticalKeyMove:p}),this.startAnimateTextCursor()):c.setSelection(this.htmlInput.selectionStart,this.htmlInput.selectionEnd),this.requestRender()},this.containerScene.add(this.helper)}createInput(){return this.htmlInput=Y4e(),this.htmlInput}connect(){}disconnect(){this.stopAnimateTextCursor(),this.helper.hide(),this.htmlInput?.remove(),this.doubleClickHandler.stop()}handleMouseDown(){if(!this.htmlInput||!this.virtualInput)return!0;this.getPointOnPlane();let e=this.doubleClickHandler.clickCount,{index:t,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,e>1?"inside":"previous")??{index:0,lineIndex:0,characterIndex:0};this.virtualInput?.wrappedText[i][Math.max(0,r-1)]===`
`&&(t--,r--),this._lastIndex=t,this._isFirstDragMove=!0;let s=this.checkClickedObject();if(e===1){if(s===null)return this.onExit(this.virtualInput),!0;this.selectionOnDragStart=t,this.isDragging=!0,this.setInputSelection(t)}else s===this.virtualInput&&(e===2?this.selectClosestWord(i,r):e>2&&(this.setInputSelection(0,this.htmlInput.value.length),this.doubleClickHandler.reset()))}handleMouseUp(){this.applyRangeToTextInput(),this.isDragging=!1,this._isFirstDragMove=!1}handleMouseMove(){!this.virtualInput||(this._isFirstDragMove&&this.doubleClickHandler.clickCount>1&&(this.selectionOnDragStart=this._lastIndex,this.isDragging=!0,this.setInputSelection(this._lastIndex)),this._isFirstDragMove=!1,this.getPointOnPlane(),this.applyRangeToTextInput())}focus(e){if(this.virtualInput=e,this.updateTextInputStyles(),this.htmlInput)if(e){let t=this.data?.geometry.text;this.htmlInput.value=typeof t=="string"?"":t?.textValue.toString()??""}else this.htmlInput.value=""}blur(){}get data(){let{virtualInput:e}=this;if(e)return e.dataPatched}applyRangeToTextInput(){if(!this.isDragging||!this.virtualInput||!this.htmlInput)return;let e=this.selectionOnDragStart,{index:t,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,this.doubleClickHandler.clickCount>2?"inside":"previous")??{index:0};i!==void 0&&r!==void 0&&this.virtualInput?.wrappedText[i][r-1]===`
`&&t--,this.htmlInput.setSelectionRange(Math.min(e,t),Math.max(e,t))}checkClickedObject(){if(this.virtualInput){let e=this.raycaster.intersectObject(this.virtualInput,!1);if(e.length>0){let t=e[0];if(t.object instanceof IU)return t.object}}return null}selectClosestWord(e,t){if(!this.virtualInput)return;let i=this.virtualInput.wrappedText,r=i[e],s=t+1,n=t;r[t]!==" "&&(s=this.findNextCharOccurence(r,t,"forward"," "),n=this.findNextCharOccurence(r,t,"backward"," "),n>0&&n++,s>=r.length-1&&e===i.length-1&&s++);let c=this.helper,u=c.getGlobalIndexFromLineAndCharIndexes(i,e,n),p=c.getGlobalIndexFromLineAndCharIndexes(i,e,s);this.setInputSelection(u,p)}findNextCharOccurence(e,t,i,r=" "){let s=Math.max(0,e.length-1),n=i==="forward"?s:0,c=i==="forward"?1:-1,u=Math.max(Math.min(t,s),0);for(;u!==n;)if(u+=c,e.charAt(u)===r)return u;return n}getPointOnPlane(){let e=this.virtualInput?.data;if(!(!this.virtualInput||!e)&&this.raycaster.ray.intersectsPlane(this.plane)){this.planeIntersection===null&&(this.planeIntersection=new se);let t=this.raycaster.ray.intersectPlane(this.plane,this.planeIntersection);if(t){this.planeIntersection.copy(this.virtualInput.worldToLocal(t));let i=typeof e.geometry.width=="number"?e.geometry.width:1,r=typeof e.geometry.height=="number"?e.geometry.height:1;this.projected.set(t.x+i*.5,t.y-r*.5)}}}updatePlane(){let e=this.virtualInput?.data;this.virtualInput&&e&&(NQ.getNormalMatrix(this.virtualInput.matrixWorld),FQ.copy(X4e).applyMatrix3(NQ).normalize(),this.virtualInput.localToWorld(kQ.set(0,0,e.geometry.depth)),this.plane.setFromNormalAndCoplanarPoint(FQ,kQ))}setInputSelection(e,t=e){this.htmlInput?.setSelectionRange(e,t),setTimeout(()=>{this.htmlInput?.focus()})}updateTextInputStyles(){let e=this.virtualInput?.data;this.virtualInput&&e&&this.htmlInput&&(this.htmlInput.style.fontSize=e.geometry.fontSize+"px",this.htmlInput.style.letterSpacing=e.geometry.letterSpacing*e.geometry.fontSize+"px",this.htmlInput.style.lineHeight=e.geometry.fontSize*e.geometry.lineHeight+"px",this.htmlInput.style.width=e.geometry.width+"px",this.htmlInput.style.height=e.geometry.height+"px",this.htmlInput.style.textAlign=Z4e(e.geometry.horizontalAlign))}};function Z4e(e){return e===4?"justify":e===2?"right":e===3?"center":"left"}var Vie=(e,t)=>{if(typeof e=="string"){let i=t.data(e);if(i)return Vie(i.value,t)}return Oa.getDisplayedValue(e)};function BQ(e,t){let i=e.text,r="";if(typeof i=="string"){let s=t.variables.data(r);s&&(r=Vie(s.value,t.variables))}else r=i.textValue.toString();return r}var Q4e=class extends Gl{constructor(e,t){super(e),this.eventManager=t,this._textInputs=[],this.sceneHelpers=new Qh,this.helper=new Rte,this._onMouseDownFocusIn=i=>{if(Pr.length>1)return;this.eventContext.updateRaycaster(i);let r=null;if(this.eventContext.raycaster){for(let s of this._textInputs)if(this.eventContext.raycaster.intersectObject(s,!0).length>0){r=s;break}}this.focusOnTextInput(r),this._onCaretUpdate(),this._onMouseUp(),this.textInputManager.doubleClickHandler.start(this.eventContext.domElement),this.textInputManager.doubleClickHandler._onMouseDown(i),this._onMouseDown(i)},this.onExit=()=>{let{virtualInput:i}=this.textInputManager;if(i===null)return;let r=this.textInputManager.htmlInput;this.helper.hide(),r?.setSelectionRange(r.value.length,r.value.length),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0);let{domElement:s}=this.eventContext;s.removeEventListener("pointerdown",this._onMouseDown,!1),s.removeEventListener("pointerup",this._onMouseUp,!1),s.removeEventListener("pointermove",this._onMouseMove,!1),window.removeEventListener("keydown",this._onKeyPress),this.textInputManager.doubleClickHandler.reset(),s.addEventListener("pointerdown",this._onMouseDownFocusIn),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers()},this._onMouseDown=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseDown(),this.textInputManager.virtualInput&&this.eventContext.raycaster.intersectObject(this.textInputManager.virtualInput,!0).length>0&&this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1)},this._onMouseUp=()=>{this.textInputManager.handleMouseUp(),this.eventManager.controlsManager.orbitControls&&!this.eventManager.controlsManager.orbitControls.enabled&&(this.eventManager.controlsManager.orbitControls.enabled=!0)},this._onMouseMove=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseMove()},this._onTextEdit=i=>{let{htmlInput:r,virtualInput:s,helper:n}=this.textInputManager;if(!r||!s)return;let c=r.value;s.textGeometry.setText(c).then(()=>{this.eventContext.requestRender()});let u=s.data;n.update();let p=u.geometry.text;if(typeof p=="string"){let f=p;this.eventContext.sharedAssets.updateVariable(f,{textValue:c})}this.textInputManager.updateTextInputStyles(),this._onCaretUpdate()},this._onCaretUpdate=i=>{this.textInputManager.handleCaretUpdate(i)},this._onKeyPress=i=>{i.key==="Escape"&&this.onExit()},this.textInputManager=new $4e(this.sceneHelpers,e.raycaster,e.sharedAssets,e.requestRender,this.onExit)}connect(){let e=[];if(this.eventContext.scene.traverseEntity(r=>{r instanceof IU&&e.push(r)}),this._textInputs=e,e.length===0)return;let{domElement:t}=this.eventContext;t.addEventListener("pointerdown",this._onMouseDownFocusIn),this.textInputManager.connect();let i=this.textInputManager.createInput();document.body.appendChild(i),i.style.display="none",i.addEventListener("keyup",this._onCaretUpdate),i.addEventListener("keydown",this._onCaretUpdate),i.addEventListener("beforeinput",this._onCaretUpdate),i.addEventListener("paste",this._onCaretUpdate),i.addEventListener("cut",this._onCaretUpdate),i.addEventListener("select",this._onCaretUpdate),i.addEventListener("selectstart",this._onCaretUpdate)}disconnect(){let e=this.textInputManager.htmlInput,{domElement:t}=this.eventContext;t.removeEventListener("pointerdown",this._onMouseDownFocusIn),e?.removeEventListener("keyup",this._onCaretUpdate),e?.removeEventListener("keydown",this._onCaretUpdate),e?.removeEventListener("beforeinput",this._onCaretUpdate),e?.removeEventListener("paste",this._onCaretUpdate),e?.removeEventListener("cut",this._onCaretUpdate),e?.removeEventListener("select",this._onCaretUpdate),e?.removeEventListener("selectstart",this._onCaretUpdate),this._textInputs.forEach(i=>{let r=BQ(i.data.geometry,this.eventContext.sharedAssets.data);i.textGeometry.setText(r)}),t.removeEventListener("pointerdown",this._onMouseDown,!1),t.removeEventListener("pointerup",this._onMouseUp,!1),t.removeEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers(),this.textInputManager.disconnect()}focusOnTextInput(e){this.textInputManager.focus(e),this.textInputManager.onTextMaterialChanged();let t=this.textInputManager.htmlInput;if(!t||e===null)return;this.textInputManager.updateTextInputStyles(),this.eventContext.renderer.sceneHelpersOnTop=this.sceneHelpers,this.eventContext.renderer.pipeline.enableHelpers(),this.textInputManager.isDragging=!1;let i=BQ(e.textGeometry.userData.parameters,this.eventContext.sharedAssets.data);t.value=i,t.setSelectionRange(0,0),this.textInputManager.helper.show(e),t.style.display="block",t.addEventListener("input",this._onTextEdit),this.textInputManager.updatePlane();let{domElement:r}=this.eventContext;r.removeEventListener("pointerdown",this._onMouseDownFocusIn),r.addEventListener("pointerdown",this._onMouseDown,!1),r.addEventListener("pointerup",this._onMouseUp,!1),r.addEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress)}},K4e=class{constructor(e,t,i,r,s){this.publish=e,this.controlsManager=t,this.animationControls=i,this.eventContext=r,this.sharedVariables=s,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=n=>{let c=window.parent!==window,u=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(n.touches.length>1||this.preventTouchScroll||c===!1&&u===!1)&&n.preventDefault()},this.onMouseWheelPreventScroll=n=>{this.preventScroll&&n.preventDefault()},this.onMouseMove=n=>{this.eventContext.sharedAssets.mouseProperty=pt(me({},this.getMousePosition(n)),{pressed:n.buttons>0})},this.onMouseDown=n=>{this.eventContext.sharedAssets.mouseProperty=pt(me({},this.getMousePosition(n)),{pressed:!0})},this.onMouseUp=n=>{this.eventContext.sharedAssets.mouseProperty=pt(me({},this.getMousePosition(n)),{pressed:!1})},this.getMousePosition=n=>{let{domRect:c}=this.eventContext,{pageX:u,pageY:p}=n.touches?.length>0?n.touches[0]:n;return{x:u-(c.left+window.scrollX),y:p-(c.top+window.scrollY)}},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=r.requestRender}activate(){if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new IBe(this.eventContext),VariableChange:new l4e(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),API:new G4e(this.eventContext,this),WEBHOOK:new W4e(this.eventContext,this),Conditional:new kBe(this.eventContext,this),Start:new o4e(this.eventContext,this),Basic:new RBe(this.eventContext,this,this.needsRaycast),MouseHover:new t4e(this.eventContext,this),Scroll:new n4e(this.eventContext,this),Follow:new YBe(this.eventContext,this),DragDrop:new VBe(this.eventContext,this),LookAt:new KBe(this.eventContext),Resize:new V4e(this.eventContext,this),Textfields:new Q4e(this.eventContext,this)};let{page:e,domElement:t}=this.eventContext;this.hideCursor&&(t.style.cursor="none"),e.traverseEntity(i=>{i.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(i=>i.connect()),t.addEventListener("wheel",this.onMouseWheelPreventScroll),t.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++}deactivate(){if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:e,domElement:t}=this.eventContext;t.style.cursor="",Object.values(this.handlers).forEach(i=>i.disconnect()),this.controlsManager.gameControl?.disposeActions(),this.controlsManager.disconnectEvents(),e.traverseEntity(i=>{i.removeEventListener("requestRender",this.requestRender),i.destroyedInAction=!1}),t.removeEventListener("touchmove",this.onTouchMovePreventScroll),t.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode()}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(),this.activate(),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let t=this.isEnabled;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}initializeActionsDependentStates(){let e=this.eventContext.sharedAssets;e.resetDynamicVariablePlayState();let t=i=>{if(i.data.type==="Conditional"&&(i.data.ifActions.forEach(t),i.data.elseActions.forEach(t)),i.data.type==="Conditional"||i.data.type==="SetVariable")for(let r of i.data.type==="Conditional"?i.data.condition:i.data.expression)"id"in r&&Array.isArray(r.id)&&(r.id[0]==="mouse"&&(this.needsMouse=!0),r.id[0]==="raycast"&&(this.needsRaycast=!0));i.data.type==="DynamicVariablePlay"&&i.data.variableId!==""&&(i.data.mode==="Play"||i.data.mode==="PlayPause"||i.data.mode==="Toggle")&&e.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(i=>{if(i.data?.events.length)for(let r of i.data.events)if(r.data.type==="VariableChange"&&(r.data.variableId==="mouseProperty"&&(this.needsMouse=!0),r.data.variableId==="raycastProperty"&&(this.needsRaycast=!0)),r.data.type==="Conditional")for(let s of["inActions","outActions"])r.data[s].forEach(t);else if(r.data.type==="DragDrop")for(let s of["drag","drop"])r.data.dragDropActions[s].forEach(t);else if(r.data.type==="GameControl")for(let s of["idle","move","jump","run"])r.data.gameActions[s].forEach(t);else if(r.data.type==="Resize")for(let s of r.data.breakpoints)s.data.actions.forEach(t);else r.data.type==="LookAt"||r.data.type==="API"||r.data.actions.forEach(t)})}},J4e=class{constructor(e,t,i,r,s){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=t,this._frameSize=new lt().copy(i),this._editorSize=new lt().copy(r),this._aspect=t.aspect,this._fov=s??t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.y;this._aspect=e/t,t<=i&&(this._camera.zoom*=i/t),this._renderer.setViewport(0,0,e,t)}updateCamera(e=!0){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let t=this._frameSize.y,i=this._editorSize.y,r=this._fov;if(e&&t>i){let s=eUe(t,1080,2160,1,15)/100;r*=t/i,r*=1-s}this._camera.aspect=this._aspect,this._camera.fov=r,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t,this.enableResponsive),this._camera.updateProjectionMatrix())}};function eUe(e,t,i,r,s){return(e-t)/(i-t)*(s-r)+r}var tUe=class{get sharedAssets(){return this.shared}constructor(e,t={},i=!0){this.shared=new _U(e.shared,t,!0,i),this.scene=new OU(e.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof ua&&!e.uiScene&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(e=>{e instanceof Ya&&e.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},iUe=class{constructor({x:e=10,y:t=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${t}px`}dispose(){this.element.parentElement?.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function rUe(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function gS(e){return e instanceof NS?"SubdivObject":e.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function nUe(e,t){let i={};return e.traverseEntity(r=>{if(!r.visible||!(r instanceof wl)||r.type!=="Mesh"||Array.isArray(r.material)||r.states&&Object.keys(r.states).length)return;let s=r.parent;for(;s;){if(s instanceof wl&&r.states&&Object.keys(r.states).length)return;s=s.parent}let n=r.material.uuid,c=t.shared.materials[n];if(c){if(!Ra.isMergable(c))return}else{let p=t.scene.objects.get(r.uuid)?.data;if(p&&"material"in p&&typeof p.material!="string"){if(!Ra.isMergable(p.material))return;n=Ra.getHash(p.material)}}i[n]||(i[n]={});let u=i[n][gS(r)];if(u){if(u.push(r),r.cloner)for(let p of r.cloner.children)u.push(p)}else if(i[n][gS(r)]=[r],r.cloner)for(let p of r.cloner.children)i[n][gS(r)].push(p)}),i}function sUe(e){let t=0;return Object.values(e).forEach(i=>{Object.values(i).forEach(r=>{let s=r.length;s>t&&(t=s)})}),t}function oUe(e,t){let i=nUe(t,e),r=sUe(i),s=new Array(r),n=0,c=new Array(r),u=0,p=new Array(r),f=0,x=new Array(r),w=0;for(let[E,A]of Object.entries(i))for(let I of Object.values(A)){if(u=0,f=0,I.forEach(O=>{O instanceof wl&&(c[u++]=O.geometry.clone(),p[f++]=O)}),f<2)continue;for(let O=0;O<f;O++)p[O].updateWorldMatrix(!0,!1),c[O].applyMatrix4(p[O].matrixWorld),p[O].matrixWorld.determinant()<0&&rUe(c[O]);let P=Ay(c.slice(0,u),!1);if(P){let O;switch(E){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),O=new $s(P,p[0].material);break}default:{O=new $s(P,p[0].material);break}}O.castShadow=p[0].castShadow,O.receiveShadow=p[0].receiveShadow,t.add(O);let k=U=>{w=0;for(let j of U)j.children&&k(j.children),j instanceof wl&&(Array.isArray(j.material)||i[j.material.uuid]&&i[j.material.uuid][gS(j)]&&i[j.material.uuid][gS(j)].length>1||(x[w++]=j));for(let j=0;j<w;j++)t.attach(x[j])};for(let U=0;U<f;U++){let j=p[U];k(j.children),s[n++]=j}}}for(let E=0;E<n;E++)s[E].removeFromParent()}var aUe=Dp(Fme(),1),lUe=new lt;function cUe(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)}var Gie=class{constructor(e,{renderOnDemand:t,renderMode:i="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=r=>{if(this.time=r,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,this._perfs?.start(),!this._renderer){this._perfs?.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){this._perfs?.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&(this._eventManager.handlers?.Start.hasVideoAction||this._eventManager.handlers?.Basic.hasVideoAction||this._eventManager.handlers?.Conditional.hasVideoAction)&&(this._skipRender=!1),this._animationControls?.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,this._scene?.traverseVisibleEntity(s=>{s.type==="ParticleSystem"&&(s.update(this.dt),this._skipRender=!1)}),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),this._eventManager?.isEnabled&&((this._eventManager.handlers?.Follow).onAnimationFrameDamping(),(this._eventManager.handlers?.LookAt).onAnimationFrameDamping(),(this._eventManager.handlers?.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let s=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=s,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),this._perfs?.end()},this._resize=r=>{if(this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=lUe.set(this._viewportWidth,this._viewportHeight)),r){let s=this._viewportWidth,n=this._viewportHeight;this._renderer.setSize(s-1,n-1,!1),this._renderer.setSize(s,n,!1)}else this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1);if(this._camera=this._scene?.activeCamera,this._scene?.updateViewPlaneSize(this._frameView?.frameSize?.x??this._viewportWidth,this._frameView?.frameSize?.y??this._viewportHeight,this._frameView?.enableResponsive??!1),this._camera){let s=Object.values(this._data?.frames??{})[0].preset??"fullscreen";this._frameView?.setCamera(this._camera),this._frameView?.updateCamera(s!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=G4(this._resize,10),this._onScroll=r=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=e,this.renderMode=t?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new iUe({x:10,y:10})),k2e(e)}load(e,t,i){return jn(this,null,function*(){cUe(e),this.disposed=!1;let r=yield(yield fetch(e,i)).arrayBuffer();yield this.start(r,{variables:t})})}start(r){return jn(this,arguments,function*(e,{interactive:t=!0,variables:i}={}){if(this.disposed)return;let s=yield k4e(e);this._data=s;let n=N4e(s);s.version&&(0,aUe.default)(s.version,"1.9.20")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),yield Promise.all([n.length&&z4e(),cZ(s)&&ERe(),A3e(s)&&xRe(),IS.physicsEnabled(s.scene.objects)&&V2e(),sZ(s)&&s3e(),NZ(s)&&Dke(),r3e(s)&&i3e(),DZ(s)&&wFe(),_4e(s)&&U2e()].filter(Boolean)),n.length&&(yield B4e(n)),this._eventManager?.deactivate(),this._controls?.deactivate(),this._scene?.dispose();let c=new tUe(s);if(c.resetPersonalCameraFromDocumentData(),this._scene=c.scene,this._sharedAssetsManager=c.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let f=performance.now();oUe(s,c.scene);let x=performance.now();console.log("Merged geometries in ",x-f," ms")}cZ(s)&&this._scene.traverse(f=>{vp(f)&&f.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{this._requestRenderAutoMode(),this._scene?.traverse(f=>{f instanceof Hu&&f.pendingMediaLoad&&f.update()})}),this._scene?.traverse(f=>{f.type==="ParticleSystem"&&(f.wakeUp(),f.data.autoPlay?f.start():f.stop())});let u=Object.keys(s.shared.fonts).map(f=>this._sharedAssetsManager.getFont(f).loadingPromise);if(Promise.all(u).then(()=>{c.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),sZ(s)&&D4e(s)&&(yield Promise.all(u)),DZ(s)){let f=[];this._scene.traverseEntity(x=>{(x instanceof Ha||x instanceof ua)&&x.uiCanvas&&f.push(x.uiCanvas)}),yield Promise.all(f.map(x=>x.promise))}this._scene.rewriteEventsBeforeGoToPlayMode(),qU(this._scene.activePage,this._sharedAssetsManager),this._renderer||(this._renderer=new lFe({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=s.scene.publish.hdTransmission===!0,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode)),NZ(s)&&this._scene.initializeSplatViewer(),s.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(s.scene.blueNoiseTextureData);let p=Object.values(s.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):(p.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=p.size[0],this._viewportHeight=p.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new J4e(this._renderer,this._camera,new lt(this._viewportWidth,this._viewportHeight),new lt(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(p.allowResponsive??!1)&&p.preset==="fullscreen"),t){let f=new CBe(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0,p);this._scene.updateMatrixWorld(!0),this._controls=new I4e(f),this._animationControls=new R4e(this._scene,this._requestRenderAutoMode),this._eventManager=new K4e(s.scene.publish,this._controls,this._animationControls,f,s.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this._scene.activePage.data.postprocessing.depthOfField.enabled&&Promise.all(this._sharedAssetsManager.getImageLoadPromises()).then(()=>{this._resize(!0)}),i!==void 0&&this.setVariables(i),this.dt===0&&(this.render(performance.now()),setTimeout(()=>{this._renderer?.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300),document.addEventListener("scroll",this._onScroll)})}setVariables(e){if(this._data!==void 0){let t=Object.entries(e);for(let[i,r]of t)this.setVariable(i,r)}}setVariable(e,t){let i=this._getVariableByName(e);if(i&&!("dynamicVariableType"in i.data)){let r=t;typeof i.data.value=="number"?r=typeof t=="number"?t:typeof t=="boolean"?t===!0?1:0:parseFloat(t):typeof i.data.value=="boolean"?r=typeof t=="number"?!!t:typeof t=="boolean"?t:t.toLocaleLowerCase()==="false"?!1:!!t:typeof i.data.value!="string"&&i.data.value.textValue!==void 0&&(r=t.toString());let s=typeof r=="string"?{textValue:r}:r;this._sharedAssetsManager?.updateVariable(i.id,s),this.requestRender(),this._requestRenderAutoMode()}else i===void 0?console.warn(`No variable named ${e} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${e} cannot be updated from code.`)}getVariables(){let e={};return this._data&&this._data.shared.variables.forEach(t=>{e[t.data.name]===void 0&&(e[t.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(t.id)))}),e}getVariable(e){let t=this._getVariableByName(e);if(t){let i=this._sharedAssetsManager.getVariable(t.id);return this._getVariableValue(i)}}_getVariableValue(e){return typeof e!="string"&&Oa.isTextValue(e)?Oa.getDisplayedValue(e):e}_getVariableByName(e){if(this._data){if(this._variablesCache.has(e))return this._variablesCache.get(e);let t=this._data.shared.variables.find(i=>i.data.name===e);return t&&this._variablesCache.set(e,t),t}}findObjectById(e){let t=this._scene?.getObjectByProperty("uuid",e);return this._createProxyObject(t)}findObjectByName(e){let t=this._scene?.getObjectByName(e);return this._createProxyObject(t)}getAllObjects(){let e=[];return this._scene?.traverseEntity(t=>{if(t.uuid!==Lx&&!this._scene.isInvisibleObjects(t)&&!(t instanceof ua)){let i=this._createProxyObject(t);i&&e.push(i)}}),e}getSplineEvents(){return(this._eventManager?.handlers?.Spline).splineEvents}emitEvent(e,t){(this.findObjectById(t)||this.findObjectByName(t))?.emitEvent(e)}emitEventReverse(e,t){(this.findObjectById(t)||this.findObjectByName(t))?.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){this._controls?.orbitControls instanceof jie&&this._controls?.orbitControls.setZoom(e)}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){let{r:t,g:i,b:r,a:s}={r:0,g:0,b:0,a:1},n=new La(t,i,r,s);try{n.setStyle(e)}catch{console.error("This is not a valid css color",e)}this._scene?.activePage.setBackgroundColor(n),this._requestRenderAutoMode()}dispose(){this.disposed=!0,this._eventManager?.deactivate(),this._scene?.dispose(),this._sharedAssetsManager?.dispose(),this._proxyObjectCache.forEach(e=>{yY.unsubscribe(e)}),this._variablesCache.clear(),this._renderer?.setAnimationLoop(null),this._renderer?.dispose(),this._renderer=void 0,this._sharedAssetsManager?.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),this._controls?.deactivate(),this.dt=0,N2e(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){this._isPaused||(this._renderer?.setAnimationLoop(null),this._isPaused=!0,this._eventManager?.pause(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){!this._isPaused||(this._isPaused=!1,this._eventManager?.resume(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!0),this._renderer?.setAnimationLoop(this.render))}setGlobalEvents(e){this._eventManager?.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){if(e==null)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let t;e.traverseAncestors(s=>{s instanceof ua&&(t=s.name)});let i={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:t,parentUuid:e.parent instanceof ua||e instanceof OU?void 0:e.parent?.uuid,emitEvent(s){e.dispatchEvent({type:"userEvent",eventName:s})},emitEventReverse(s){e.dispatchEvent({type:"userEvent",eventName:s,reverse:!0})}},r=yY(i,(s,n)=>{typeof e[s]!="object"&&Object.getOwnPropertyDescriptor(e,s)?.writable&&(e[s]=n),this._requestRenderAutoMode(),e.updateMatrix()});return this._proxyObjectCache.set(e.uuid,r),r}setUIWasmUrl(e){cte.skiaWasmUrl=e}};var Hie=(()=>{let t=class t{constructor(r){this.document=r}ngAfterViewInit(){let r=this.document.getElementById("canvas3d");new Gie(r).load("https://prod.spline.design/VCg4XaCIhzE5GjQu/scene.splinecode")}};t.\u0275fac=function(s){return new(s||t)(_s(Ks))},t.\u0275cmp=xo({type:t,selectors:[["app-devices-view"]],standalone:!0,features:[bo],decls:2,vars:0,consts:[[1,"container"],["id","canvas3d"]],template:function(s,n){s&1&&(Pn(0,"div",0),Os(1,"canvas",1),kn())},styles:[".container[_ngcontent-%COMP%]{width:100vw;height:100vh;display:flex;justify-content:center;align-items:center}.container[_ngcontent-%COMP%]   #canvas3d[_ngcontent-%COMP%]{width:500px;height:500px}"]});let e=t;return e})();var Wie=[{path:"",redirectTo:"map",pathMatch:"full"},{path:"map",component:Rq,title:"Sencity | Map"},{path:"devices",component:Hie,title:"Sencity | Devices"}];var gn=function(e){return e[e.State=0]="State",e[e.Transition=1]="Transition",e[e.Sequence=2]="Sequence",e[e.Group=3]="Group",e[e.Animate=4]="Animate",e[e.Keyframes=5]="Keyframes",e[e.Style=6]="Style",e[e.Trigger=7]="Trigger",e[e.Reference=8]="Reference",e[e.AnimateChild=9]="AnimateChild",e[e.AnimateRef=10]="AnimateRef",e[e.Query=11]="Query",e[e.Stagger=12]="Stagger",e}(gn||{}),ad="*";function qie(e,t){return{type:gn.Trigger,name:e,definitions:t,options:{}}}function XU(e,t=null){return{type:gn.Animate,styles:t,timings:e}}function Yie(e,t=null){return{type:gn.Sequence,steps:e,options:t}}function Zy(e){return{type:gn.Style,styles:e,offset:null}}function Xie(e,t,i=null){return{type:gn.Transition,expr:e,animation:t,options:i}}function GI(e,t,i=null){return{type:gn.Query,selector:e,animation:t,options:i}}var Sm=class{constructor(t=0,i=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+i}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){let i=t=="start"?this._onStartFns:this._onDoneFns;i.forEach(r=>r()),i.length=0}},rE=class{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let i=0,r=0,s=0,n=this.players.length;n==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(c=>{c.onDone(()=>{++i==n&&this._onFinish()}),c.onDestroy(()=>{++r==n&&this._onDestroy()}),c.onStart(()=>{++s==n&&this._onStart()})}),this.totalTime=this.players.reduce((c,u)=>Math.max(c,u.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){let i=t*this.totalTime;this.players.forEach(r=>{let s=r.totalTime?Math.min(1,i/r.totalTime):1;r.setPosition(s)})}getPosition(){let t=this.players.reduce((i,r)=>i===null||r.totalTime>i.totalTime?r:i,null);return t!=null?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){let i=t=="start"?this._onStartFns:this._onDoneFns;i.forEach(r=>r()),i.length=0}},HI="!";function $ie(e){return new Ui(3e3,!1)}function uUe(){return new Ui(3100,!1)}function hUe(){return new Ui(3101,!1)}function dUe(e){return new Ui(3001,!1)}function pUe(e){return new Ui(3003,!1)}function fUe(e){return new Ui(3004,!1)}function mUe(e,t){return new Ui(3005,!1)}function gUe(){return new Ui(3006,!1)}function yUe(){return new Ui(3007,!1)}function vUe(e,t){return new Ui(3008,!1)}function _Ue(e){return new Ui(3002,!1)}function xUe(e,t,i,r,s){return new Ui(3010,!1)}function bUe(){return new Ui(3011,!1)}function wUe(){return new Ui(3012,!1)}function SUe(){return new Ui(3200,!1)}function EUe(){return new Ui(3202,!1)}function MUe(){return new Ui(3013,!1)}function TUe(e){return new Ui(3014,!1)}function AUe(e){return new Ui(3015,!1)}function CUe(e){return new Ui(3016,!1)}function DUe(e,t){return new Ui(3404,!1)}function IUe(e){return new Ui(3502,!1)}function PUe(e){return new Ui(3503,!1)}function RUe(){return new Ui(3300,!1)}function OUe(e){return new Ui(3504,!1)}function LUe(e){return new Ui(3301,!1)}function zUe(e,t){return new Ui(3302,!1)}function FUe(e){return new Ui(3303,!1)}function kUe(e,t){return new Ui(3400,!1)}function NUe(e){return new Ui(3401,!1)}function BUe(e){return new Ui(3402,!1)}function UUe(e,t){return new Ui(3505,!1)}function Em(e){switch(e.length){case 0:return new Sm;case 1:return e[0];default:return new rE(e)}}function cre(e,t,i=new Map,r=new Map){let s=[],n=[],c=-1,u=null;if(t.forEach(p=>{let f=p.get("offset"),x=f==c,w=x&&u||new Map;p.forEach((E,A)=>{let I=A,P=E;if(A!=="offset")switch(I=e.normalizePropertyName(I,s),P){case HI:P=i.get(A);break;case ad:P=r.get(A);break;default:P=e.normalizeStyleValue(A,I,P,s);break}w.set(I,P)}),x||n.push(w),u=w,c=f}),s.length)throw IUe(s);return n}function y5(e,t,i,r){switch(t){case"start":e.onStart(()=>r(i&&$U(i,"start",e)));break;case"done":e.onDone(()=>r(i&&$U(i,"done",e)));break;case"destroy":e.onDestroy(()=>r(i&&$U(i,"destroy",e)));break}}function $U(e,t,i){let r=i.totalTime,s=!!i.disabled,n=v5(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,r??e.totalTime,s),c=e._data;return c!=null&&(n._data=c),n}function v5(e,t,i,r,s="",n=0,c){return{element:e,triggerName:t,fromState:i,toState:r,phaseName:s,totalTime:n,disabled:!!c}}function yc(e,t,i){let r=e.get(t);return r||e.set(t,r=i),r}function Zie(e){let t=e.indexOf(":"),i=e.substring(1,t),r=e.slice(t+1);return[i,r]}var jUe=typeof document>"u"?null:document.documentElement;function _5(e){let t=e.parentNode||e.host||null;return t===jUe?null:t}function VUe(e){return e.substring(1,6)=="ebkit"}var Qy=null,Qie=!1;function GUe(e){Qy||(Qy=HUe()||{},Qie=Qy.style?"WebkitAppearance"in Qy.style:!1);let t=!0;return Qy.style&&!VUe(e)&&(t=e in Qy.style,!t&&Qie&&(t="Webkit"+e.charAt(0).toUpperCase()+e.slice(1)in Qy.style)),t}function HUe(){return typeof document<"u"?document.body:null}function ure(e,t){for(;t;){if(t===e)return!0;t=_5(t)}return!1}function hre(e,t,i){if(i)return Array.from(e.querySelectorAll(t));let r=e.querySelector(t);return r?[r]:[]}var x5=(()=>{let t=class t{validateStyleProperty(r){return GUe(r)}matchesElement(r,s){return!1}containsElement(r,s){return ure(r,s)}getParentElement(r){return _5(r)}query(r,s,n){return hre(r,s,n)}computeStyle(r,s,n){return n||""}animate(r,s,n,c,u,p=[],f){return new Sm(n,c)}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=hr({token:t,factory:t.\u0275fac});let e=t;return e})(),E5=class E5{};E5.NOOP=new x5;var ev=E5,tv=class{};var WUe=1e3,dre="{{",qUe="}}",pre="ng-enter",t5="ng-leave",WI="ng-trigger",ZI=".ng-trigger",Kie="ng-animating",i5=".ng-animating";function Rp(e){if(typeof e=="number")return e;let t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:r5(parseFloat(t[1]),t[2])}function r5(e,t){switch(t){case"s":return e*WUe;default:return e}}function QI(e,t,i){return e.hasOwnProperty("duration")?e:YUe(e,t,i)}function YUe(e,t,i){let r=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,s,n=0,c="";if(typeof e=="string"){let u=e.match(r);if(u===null)return t.push($ie(e)),{duration:0,delay:0,easing:""};s=r5(parseFloat(u[1]),u[2]);let p=u[3];p!=null&&(n=r5(parseFloat(p),u[4]));let f=u[5];f&&(c=f)}else s=e;if(!i){let u=!1,p=t.length;s<0&&(t.push(uUe()),u=!0),n<0&&(t.push(hUe()),u=!0),u&&t.splice(p,0,$ie(e))}return{duration:s,delay:n,easing:c}}function XUe(e){return e.length?e[0]instanceof Map?e:e.map(t=>new Map(Object.entries(t))):[]}function ld(e,t,i){t.forEach((r,s)=>{let n=b5(s);i&&!i.has(s)&&i.set(s,e.style[n]),e.style[n]=r})}function Jy(e,t){t.forEach((i,r)=>{let s=b5(r);e.style[s]=""})}function nE(e){return Array.isArray(e)?e.length==1?e[0]:Yie(e):e}function $Ue(e,t,i){let r=t.params||{},s=fre(e);s.length&&s.forEach(n=>{r.hasOwnProperty(n)||i.push(dUe(n))})}var n5=new RegExp(`${dre}\\s*(.+?)\\s*${qUe}`,"g");function fre(e){let t=[];if(typeof e=="string"){let i;for(;i=n5.exec(e);)t.push(i[1]);n5.lastIndex=0}return t}function oE(e,t,i){let r=`${e}`,s=r.replace(n5,(n,c)=>{let u=t[c];return u==null&&(i.push(pUe(c)),u=""),u.toString()});return s==r?e:s}var ZUe=/-+([a-z0-9])/g;function b5(e){return e.replace(ZUe,(...t)=>t[1].toUpperCase())}function QUe(e,t){return e===0||t===0}function KUe(e,t,i){if(i.size&&t.length){let r=t[0],s=[];if(i.forEach((n,c)=>{r.has(c)||s.push(c),r.set(c,n)}),s.length)for(let n=1;n<t.length;n++){let c=t[n];s.forEach(u=>c.set(u,w5(e,u)))}}return t}function gc(e,t,i){switch(t.type){case gn.Trigger:return e.visitTrigger(t,i);case gn.State:return e.visitState(t,i);case gn.Transition:return e.visitTransition(t,i);case gn.Sequence:return e.visitSequence(t,i);case gn.Group:return e.visitGroup(t,i);case gn.Animate:return e.visitAnimate(t,i);case gn.Keyframes:return e.visitKeyframes(t,i);case gn.Style:return e.visitStyle(t,i);case gn.Reference:return e.visitReference(t,i);case gn.AnimateChild:return e.visitAnimateChild(t,i);case gn.AnimateRef:return e.visitAnimateRef(t,i);case gn.Query:return e.visitQuery(t,i);case gn.Stagger:return e.visitStagger(t,i);default:throw fUe(t.type)}}function w5(e,t){return window.getComputedStyle(e)[t]}var JUe=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),KI=class extends tv{normalizePropertyName(t,i){return b5(t)}normalizeStyleValue(t,i,r,s){let n="",c=r.toString().trim();if(JUe.has(i)&&r!==0&&r!=="0")if(typeof r=="number")n="px";else{let u=r.match(/^[+-]?[\d\.]+([a-z]*)$/);u&&u[1].length==0&&s.push(mUe(t,r))}return c+n}};var JI="*";function e5e(e,t){let i=[];return typeof e=="string"?e.split(/\s*,\s*/).forEach(r=>t5e(r,i,t)):i.push(e),i}function t5e(e,t,i){if(e[0]==":"){let p=i5e(e,i);if(typeof p=="function"){t.push(p);return}e=p}let r=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(r==null||r.length<4)return i.push(AUe(e)),t;let s=r[1],n=r[2],c=r[3];t.push(Jie(s,c));let u=s==JI&&c==JI;n[0]=="<"&&!u&&t.push(Jie(c,s))}function i5e(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(i,r)=>parseFloat(r)>parseFloat(i);case":decrement":return(i,r)=>parseFloat(r)<parseFloat(i);default:return t.push(CUe(e)),"* => *"}}var qI=new Set(["true","1"]),YI=new Set(["false","0"]);function Jie(e,t){let i=qI.has(e)||YI.has(e),r=qI.has(t)||YI.has(t);return(s,n)=>{let c=e==JI||e==s,u=t==JI||t==n;return!c&&i&&typeof s=="boolean"&&(c=s?qI.has(e):YI.has(e)),!u&&r&&typeof n=="boolean"&&(u=n?qI.has(t):YI.has(t)),c&&u}}var mre=":self",r5e=new RegExp(`s*${mre}s*,?`,"g");function gre(e,t,i,r){return new s5(e).build(t,i,r)}var ere="",s5=class{constructor(t){this._driver=t}build(t,i,r){let s=new o5(i);return this._resetContextStyleTimingState(s),gc(this,nE(t),s)}_resetContextStyleTimingState(t){t.currentQuerySelector=ere,t.collectedStyles=new Map,t.collectedStyles.set(ere,new Map),t.currentTime=0}visitTrigger(t,i){let r=i.queryCount=0,s=i.depCount=0,n=[],c=[];return t.name.charAt(0)=="@"&&i.errors.push(gUe()),t.definitions.forEach(u=>{if(this._resetContextStyleTimingState(i),u.type==gn.State){let p=u,f=p.name;f.toString().split(/\s*,\s*/).forEach(x=>{p.name=x,n.push(this.visitState(p,i))}),p.name=f}else if(u.type==gn.Transition){let p=this.visitTransition(u,i);r+=p.queryCount,s+=p.depCount,c.push(p)}else i.errors.push(yUe())}),{type:gn.Trigger,name:t.name,states:n,transitions:c,queryCount:r,depCount:s,options:null}}visitState(t,i){let r=this.visitStyle(t.styles,i),s=t.options&&t.options.params||null;if(r.containsDynamicStyles){let n=new Set,c=s||{};r.styles.forEach(u=>{u instanceof Map&&u.forEach(p=>{fre(p).forEach(f=>{c.hasOwnProperty(f)||n.add(f)})})}),n.size&&i.errors.push(vUe(t.name,[...n.values()]))}return{type:gn.State,name:t.name,style:r,options:s?{params:s}:null}}visitTransition(t,i){i.queryCount=0,i.depCount=0;let r=gc(this,nE(t.animation),i),s=e5e(t.expr,i.errors);return{type:gn.Transition,matchers:s,animation:r,queryCount:i.queryCount,depCount:i.depCount,options:Ky(t.options)}}visitSequence(t,i){return{type:gn.Sequence,steps:t.steps.map(r=>gc(this,r,i)),options:Ky(t.options)}}visitGroup(t,i){let r=i.currentTime,s=0,n=t.steps.map(c=>{i.currentTime=r;let u=gc(this,c,i);return s=Math.max(s,i.currentTime),u});return i.currentTime=s,{type:gn.Group,steps:n,options:Ky(t.options)}}visitAnimate(t,i){let r=a5e(t.timings,i.errors);i.currentAnimateTimings=r;let s,n=t.styles?t.styles:Zy({});if(n.type==gn.Keyframes)s=this.visitKeyframes(n,i);else{let c=t.styles,u=!1;if(!c){u=!0;let f={};r.easing&&(f.easing=r.easing),c=Zy(f)}i.currentTime+=r.duration+r.delay;let p=this.visitStyle(c,i);p.isEmptyStep=u,s=p}return i.currentAnimateTimings=null,{type:gn.Animate,timings:r,style:s,options:null}}visitStyle(t,i){let r=this._makeStyleAst(t,i);return this._validateStyleAst(r,i),r}_makeStyleAst(t,i){let r=[],s=Array.isArray(t.styles)?t.styles:[t.styles];for(let u of s)typeof u=="string"?u===ad?r.push(u):i.errors.push(_Ue(u)):r.push(new Map(Object.entries(u)));let n=!1,c=null;return r.forEach(u=>{if(u instanceof Map&&(u.has("easing")&&(c=u.get("easing"),u.delete("easing")),!n)){for(let p of u.values())if(p.toString().indexOf(dre)>=0){n=!0;break}}}),{type:gn.Style,styles:r,easing:c,offset:t.offset,containsDynamicStyles:n,options:null}}_validateStyleAst(t,i){let r=i.currentAnimateTimings,s=i.currentTime,n=i.currentTime;r&&n>0&&(n-=r.duration+r.delay),t.styles.forEach(c=>{typeof c!="string"&&c.forEach((u,p)=>{let f=i.collectedStyles.get(i.currentQuerySelector),x=f.get(p),w=!0;x&&(n!=s&&n>=x.startTime&&s<=x.endTime&&(i.errors.push(xUe(p,x.startTime,x.endTime,n,s)),w=!1),n=x.startTime),w&&f.set(p,{startTime:n,endTime:s}),i.options&&$Ue(u,i.options,i.errors)})})}visitKeyframes(t,i){let r={type:gn.Keyframes,styles:[],options:null};if(!i.currentAnimateTimings)return i.errors.push(bUe()),r;let s=1,n=0,c=[],u=!1,p=!1,f=0,x=t.steps.map(k=>{let U=this._makeStyleAst(k,i),j=U.offset!=null?U.offset:o5e(U.styles),V=0;return j!=null&&(n++,V=U.offset=j),p=p||V<0||V>1,u=u||V<f,f=V,c.push(V),U});p&&i.errors.push(wUe()),u&&i.errors.push(SUe());let w=t.steps.length,E=0;n>0&&n<w?i.errors.push(EUe()):n==0&&(E=s/(w-1));let A=w-1,I=i.currentTime,P=i.currentAnimateTimings,O=P.duration;return x.forEach((k,U)=>{let j=E>0?U==A?1:E*U:c[U],V=j*O;i.currentTime=I+P.delay+V,P.duration=V,this._validateStyleAst(k,i),k.offset=j,r.styles.push(k)}),r}visitReference(t,i){return{type:gn.Reference,animation:gc(this,nE(t.animation),i),options:Ky(t.options)}}visitAnimateChild(t,i){return i.depCount++,{type:gn.AnimateChild,options:Ky(t.options)}}visitAnimateRef(t,i){return{type:gn.AnimateRef,animation:this.visitReference(t.animation,i),options:Ky(t.options)}}visitQuery(t,i){let r=i.currentQuerySelector,s=t.options||{};i.queryCount++,i.currentQuery=t;let[n,c]=n5e(t.selector);i.currentQuerySelector=r.length?r+" "+n:n,yc(i.collectedStyles,i.currentQuerySelector,new Map);let u=gc(this,nE(t.animation),i);return i.currentQuery=null,i.currentQuerySelector=r,{type:gn.Query,selector:n,limit:s.limit||0,optional:!!s.optional,includeSelf:c,animation:u,originalSelector:t.selector,options:Ky(t.options)}}visitStagger(t,i){i.currentQuery||i.errors.push(MUe());let r=t.timings==="full"?{duration:0,delay:0,easing:"full"}:QI(t.timings,i.errors,!0);return{type:gn.Stagger,animation:gc(this,nE(t.animation),i),timings:r,options:null}}};function n5e(e){let t=!!e.split(/\s*,\s*/).find(i=>i==mre);return t&&(e=e.replace(r5e,"")),e=e.replace(/@\*/g,ZI).replace(/@\w+/g,i=>ZI+"-"+i.slice(1)).replace(/:animating/g,i5),[e,t]}function s5e(e){return e?me({},e):null}var o5=class{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function o5e(e){if(typeof e=="string")return null;let t=null;if(Array.isArray(e))e.forEach(i=>{if(i instanceof Map&&i.has("offset")){let r=i;t=parseFloat(r.get("offset")),r.delete("offset")}});else if(e instanceof Map&&e.has("offset")){let i=e;t=parseFloat(i.get("offset")),i.delete("offset")}return t}function a5e(e,t){if(e.hasOwnProperty("duration"))return e;if(typeof e=="number"){let n=QI(e,t).duration;return ZU(n,0,"")}let i=e;if(i.split(/\s+/).some(n=>n.charAt(0)=="{"&&n.charAt(1)=="{")){let n=ZU(0,0,"");return n.dynamic=!0,n.strValue=i,n}let s=QI(i,t);return ZU(s.duration,s.delay,s.easing)}function Ky(e){return e?(e=me({},e),e.params&&(e.params=s5e(e.params))):e={},e}function ZU(e,t,i){return{duration:e,delay:t,easing:i}}function S5(e,t,i,r,s,n,c=null,u=!1){return{type:1,element:e,keyframes:t,preStyleProps:i,postStyleProps:r,duration:s,delay:n,totalTime:s+n,easing:c,subTimeline:u}}var aE=class{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,i){let r=this._map.get(t);r||this._map.set(t,r=[]),r.push(...i)}has(t){return this._map.has(t)}clear(){this._map.clear()}},l5e=1,c5e=":enter",u5e=new RegExp(c5e,"g"),h5e=":leave",d5e=new RegExp(h5e,"g");function yre(e,t,i,r,s,n=new Map,c=new Map,u,p,f=[]){return new a5().buildKeyframes(e,t,i,r,s,n,c,u,p,f)}var a5=class{buildKeyframes(t,i,r,s,n,c,u,p,f,x=[]){f=f||new aE;let w=new l5(t,i,f,s,n,x,[]);w.options=p;let E=p.delay?Rp(p.delay):0;w.currentTimeline.delayNextStep(E),w.currentTimeline.setStyles([c],null,w.errors,p),gc(this,r,w);let A=w.timelines.filter(I=>I.containsAnimation());if(A.length&&u.size){let I;for(let P=A.length-1;P>=0;P--){let O=A[P];if(O.element===i){I=O;break}}I&&!I.allowOnlyTimelineStyles()&&I.setStyles([u],null,w.errors,p)}return A.length?A.map(I=>I.buildKeyframes()):[S5(i,[],[],[],0,E,"",!1)]}visitTrigger(t,i){}visitState(t,i){}visitTransition(t,i){}visitAnimateChild(t,i){let r=i.subInstructions.get(i.element);if(r){let s=i.createSubContext(t.options),n=i.currentTimeline.currentTime,c=this._visitSubInstructions(r,s,s.options);n!=c&&i.transformIntoNewTimeline(c)}i.previousNode=t}visitAnimateRef(t,i){let r=i.createSubContext(t.options);r.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],i,r),this.visitReference(t.animation,r),i.transformIntoNewTimeline(r.currentTimeline.currentTime),i.previousNode=t}_applyAnimationRefDelays(t,i,r){for(let s of t){let n=s?.delay;if(n){let c=typeof n=="number"?n:Rp(oE(n,s?.params??{},i.errors));r.delayNextStep(c)}}}_visitSubInstructions(t,i,r){let n=i.currentTimeline.currentTime,c=r.duration!=null?Rp(r.duration):null,u=r.delay!=null?Rp(r.delay):null;return c!==0&&t.forEach(p=>{let f=i.appendInstructionToTimeline(p,c,u);n=Math.max(n,f.duration+f.delay)}),n}visitReference(t,i){i.updateOptions(t.options,!0),gc(this,t.animation,i),i.previousNode=t}visitSequence(t,i){let r=i.subContextCount,s=i,n=t.options;if(n&&(n.params||n.delay)&&(s=i.createSubContext(n),s.transformIntoNewTimeline(),n.delay!=null)){s.previousNode.type==gn.Style&&(s.currentTimeline.snapshotCurrentStyles(),s.previousNode=eP);let c=Rp(n.delay);s.delayNextStep(c)}t.steps.length&&(t.steps.forEach(c=>gc(this,c,s)),s.currentTimeline.applyStylesToKeyframe(),s.subContextCount>r&&s.transformIntoNewTimeline()),i.previousNode=t}visitGroup(t,i){let r=[],s=i.currentTimeline.currentTime,n=t.options&&t.options.delay?Rp(t.options.delay):0;t.steps.forEach(c=>{let u=i.createSubContext(t.options);n&&u.delayNextStep(n),gc(this,c,u),s=Math.max(s,u.currentTimeline.currentTime),r.push(u.currentTimeline)}),r.forEach(c=>i.currentTimeline.mergeTimelineCollectedStyles(c)),i.transformIntoNewTimeline(s),i.previousNode=t}_visitTiming(t,i){if(t.dynamic){let r=t.strValue,s=i.params?oE(r,i.params,i.errors):r;return QI(s,i.errors)}else return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,i){let r=i.currentAnimateTimings=this._visitTiming(t.timings,i),s=i.currentTimeline;r.delay&&(i.incrementTime(r.delay),s.snapshotCurrentStyles());let n=t.style;n.type==gn.Keyframes?this.visitKeyframes(n,i):(i.incrementTime(r.duration),this.visitStyle(n,i),s.applyStylesToKeyframe()),i.currentAnimateTimings=null,i.previousNode=t}visitStyle(t,i){let r=i.currentTimeline,s=i.currentAnimateTimings;!s&&r.hasCurrentStyleProperties()&&r.forwardFrame();let n=s&&s.easing||t.easing;t.isEmptyStep?r.applyEmptyStep(n):r.setStyles(t.styles,n,i.errors,i.options),i.previousNode=t}visitKeyframes(t,i){let r=i.currentAnimateTimings,s=i.currentTimeline.duration,n=r.duration,u=i.createSubContext().currentTimeline;u.easing=r.easing,t.styles.forEach(p=>{let f=p.offset||0;u.forwardTime(f*n),u.setStyles(p.styles,p.easing,i.errors,i.options),u.applyStylesToKeyframe()}),i.currentTimeline.mergeTimelineCollectedStyles(u),i.transformIntoNewTimeline(s+n),i.previousNode=t}visitQuery(t,i){let r=i.currentTimeline.currentTime,s=t.options||{},n=s.delay?Rp(s.delay):0;n&&(i.previousNode.type===gn.Style||r==0&&i.currentTimeline.hasCurrentStyleProperties())&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=eP);let c=r,u=i.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!s.optional,i.errors);i.currentQueryTotal=u.length;let p=null;u.forEach((f,x)=>{i.currentQueryIndex=x;let w=i.createSubContext(t.options,f);n&&w.delayNextStep(n),f===i.element&&(p=w.currentTimeline),gc(this,t.animation,w),w.currentTimeline.applyStylesToKeyframe();let E=w.currentTimeline.currentTime;c=Math.max(c,E)}),i.currentQueryIndex=0,i.currentQueryTotal=0,i.transformIntoNewTimeline(c),p&&(i.currentTimeline.mergeTimelineCollectedStyles(p),i.currentTimeline.snapshotCurrentStyles()),i.previousNode=t}visitStagger(t,i){let r=i.parentContext,s=i.currentTimeline,n=t.timings,c=Math.abs(n.duration),u=c*(i.currentQueryTotal-1),p=c*i.currentQueryIndex;switch(n.duration<0?"reverse":n.easing){case"reverse":p=u-p;break;case"full":p=r.currentStaggerTime;break}let x=i.currentTimeline;p&&x.delayNextStep(p);let w=x.currentTime;gc(this,t.animation,i),i.previousNode=t,r.currentStaggerTime=s.currentTime-w+(s.startTime-r.currentTimeline.startTime)}},eP={},l5=class e{constructor(t,i,r,s,n,c,u,p){this._driver=t,this.element=i,this.subInstructions=r,this._enterClassName=s,this._leaveClassName=n,this.errors=c,this.timelines=u,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=eP,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=p||new tP(this._driver,i,0),u.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,i){if(!t)return;let r=t,s=this.options;r.duration!=null&&(s.duration=Rp(r.duration)),r.delay!=null&&(s.delay=Rp(r.delay));let n=r.params;if(n){let c=s.params;c||(c=this.options.params={}),Object.keys(n).forEach(u=>{(!i||!c.hasOwnProperty(u))&&(c[u]=oE(n[u],c,this.errors))})}}_copyOptions(){let t={};if(this.options){let i=this.options.params;if(i){let r=t.params={};Object.keys(i).forEach(s=>{r[s]=i[s]})}}return t}createSubContext(t=null,i,r){let s=i||this.element,n=new e(this._driver,s,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(s,r||0));return n.previousNode=this.previousNode,n.currentAnimateTimings=this.currentAnimateTimings,n.options=this._copyOptions(),n.updateOptions(t),n.currentQueryIndex=this.currentQueryIndex,n.currentQueryTotal=this.currentQueryTotal,n.parentContext=this,this.subContextCount++,n}transformIntoNewTimeline(t){return this.previousNode=eP,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,i,r){let s={duration:i??t.duration,delay:this.currentTimeline.currentTime+(r??0)+t.delay,easing:""},n=new c5(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,s,t.stretchStartingKeyframe);return this.timelines.push(n),s}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,i,r,s,n,c){let u=[];if(s&&u.push(this.element),t.length>0){t=t.replace(u5e,"."+this._enterClassName),t=t.replace(d5e,"."+this._leaveClassName);let p=r!=1,f=this._driver.query(this.element,t,p);r!==0&&(f=r<0?f.slice(f.length+r,f.length):f.slice(0,r)),u.push(...f)}return!n&&u.length==0&&c.push(TUe(i)),u}},tP=class e{constructor(t,i,r,s){this._driver=t,this.element=i,this.startTime=r,this._elementTimelineStylesLookup=s,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(i),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(i,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){let i=this._keyframes.size===1&&this._pendingStyles.size;this.duration||i?(this.forwardTime(this.currentTime+t),i&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,i){return this.applyStylesToKeyframe(),new e(this._driver,t,i||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=l5e,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,i){this._localTimelineStyles.set(t,i),this._globalTimelineStyles.set(t,i),this._styleSummary.set(t,{time:this.currentTime,value:i})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[i,r]of this._globalTimelineStyles)this._backFill.set(i,r||ad),this._currentKeyframe.set(i,ad);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,i,r,s){i&&this._previousKeyframe.set("easing",i);let n=s&&s.params||{},c=p5e(t,this._globalTimelineStyles);for(let[u,p]of c){let f=oE(p,n,r);this._pendingStyles.set(u,f),this._localTimelineStyles.has(u)||this._backFill.set(u,this._globalTimelineStyles.get(u)??ad),this._updateStyle(u,f)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((t,i)=>{this._currentKeyframe.set(i,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,i)=>{this._currentKeyframe.has(i)||this._currentKeyframe.set(i,t)}))}snapshotCurrentStyles(){for(let[t,i]of this._localTimelineStyles)this._pendingStyles.set(t,i),this._updateStyle(t,i)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let t=[];for(let i in this._currentKeyframe)t.push(i);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((i,r)=>{let s=this._styleSummary.get(r);(!s||i.time>s.time)&&this._updateStyle(r,i.value)})}buildKeyframes(){this.applyStylesToKeyframe();let t=new Set,i=new Set,r=this._keyframes.size===1&&this.duration===0,s=[];this._keyframes.forEach((u,p)=>{let f=new Map([...this._backFill,...u]);f.forEach((x,w)=>{x===HI?t.add(w):x===ad&&i.add(w)}),r||f.set("offset",p/this.duration),s.push(f)});let n=[...t.values()],c=[...i.values()];if(r){let u=s[0],p=new Map(u);u.set("offset",0),p.set("offset",1),s=[u,p]}return S5(this.element,s,n,c,this.duration,this.startTime,this.easing,!1)}},c5=class extends tP{constructor(t,i,r,s,n,c,u=!1){super(t,i,c.delay),this.keyframes=r,this.preStyleProps=s,this.postStyleProps=n,this._stretchStartingKeyframe=u,this.timings={duration:c.duration,delay:c.delay,easing:c.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:i,duration:r,easing:s}=this.timings;if(this._stretchStartingKeyframe&&i){let n=[],c=r+i,u=i/c,p=new Map(t[0]);p.set("offset",0),n.push(p);let f=new Map(t[0]);f.set("offset",tre(u)),n.push(f);let x=t.length-1;for(let w=1;w<=x;w++){let E=new Map(t[w]),A=E.get("offset"),I=i+A*r;E.set("offset",tre(I/c)),n.push(E)}r=c,i=0,s="",t=n}return S5(this.element,t,this.preStyleProps,this.postStyleProps,r,i,s,!0)}};function tre(e,t=3){let i=Math.pow(10,t-1);return Math.round(e*i)/i}function p5e(e,t){let i=new Map,r;return e.forEach(s=>{if(s==="*"){r??=t.keys();for(let n of r)i.set(n,ad)}else for(let[n,c]of s)i.set(n,c)}),i}function ire(e,t,i,r,s,n,c,u,p,f,x,w,E){return{type:0,element:e,triggerName:t,isRemovalTransition:s,fromState:i,fromStyles:n,toState:r,toStyles:c,timelines:u,queriedElements:p,preStyleProps:f,postStyleProps:x,totalTime:w,errors:E}}var QU={},iP=class{constructor(t,i,r){this._triggerName=t,this.ast=i,this._stateStyles=r}match(t,i,r,s){return f5e(this.ast.matchers,t,i,r,s)}buildStyles(t,i,r){let s=this._stateStyles.get("*");return t!==void 0&&(s=this._stateStyles.get(t?.toString())||s),s?s.buildStyles(i,r):new Map}build(t,i,r,s,n,c,u,p,f,x){let w=[],E=this.ast.options&&this.ast.options.params||QU,A=u&&u.params||QU,I=this.buildStyles(r,A,w),P=p&&p.params||QU,O=this.buildStyles(s,P,w),k=new Set,U=new Map,j=new Map,V=s==="void",$={params:vre(P,E),delay:this.ast.options?.delay},Y=x?[]:yre(t,i,this.ast.animation,n,c,I,O,$,f,w),J=0;return Y.forEach(X=>{J=Math.max(X.duration+X.delay,J)}),w.length?ire(i,this._triggerName,r,s,V,I,O,[],[],U,j,J,w):(Y.forEach(X=>{let ee=X.element,oe=yc(U,ee,new Set);X.preStyleProps.forEach(ve=>oe.add(ve));let le=yc(j,ee,new Set);X.postStyleProps.forEach(ve=>le.add(ve)),ee!==i&&k.add(ee)}),ire(i,this._triggerName,r,s,V,I,O,Y,[...k.values()],U,j,J))}};function f5e(e,t,i,r,s){return e.some(n=>n(t,i,r,s))}function vre(e,t){let i=me({},t);return Object.entries(e).forEach(([r,s])=>{s!=null&&(i[r]=s)}),i}var u5=class{constructor(t,i,r){this.styles=t,this.defaultParams=i,this.normalizer=r}buildStyles(t,i){let r=new Map,s=vre(t,this.defaultParams);return this.styles.styles.forEach(n=>{typeof n!="string"&&n.forEach((c,u)=>{c&&(c=oE(c,s,i));let p=this.normalizer.normalizePropertyName(u,i);c=this.normalizer.normalizeStyleValue(u,p,c,i),r.set(u,c)})}),r}};function m5e(e,t,i){return new h5(e,t,i)}var h5=class{constructor(t,i,r){this.name=t,this.ast=i,this._normalizer=r,this.transitionFactories=[],this.states=new Map,i.states.forEach(s=>{let n=s.options&&s.options.params||{};this.states.set(s.name,new u5(s.style,n,r))}),rre(this.states,"true","1"),rre(this.states,"false","0"),i.transitions.forEach(s=>{this.transitionFactories.push(new iP(t,s,this.states))}),this.fallbackTransition=g5e(t,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,i,r,s){return this.transitionFactories.find(c=>c.match(t,i,r,s))||null}matchStyles(t,i,r){return this.fallbackTransition.buildStyles(t,i,r)}};function g5e(e,t,i){let r=[(c,u)=>!0],s={type:gn.Sequence,steps:[],options:null},n={type:gn.Transition,animation:s,matchers:r,options:null,queryCount:0,depCount:0};return new iP(e,n,t)}function rre(e,t,i){e.has(t)?e.has(i)||e.set(i,e.get(t)):e.has(i)&&e.set(t,e.get(i))}var y5e=new aE,d5=class{constructor(t,i,r){this.bodyNode=t,this._driver=i,this._normalizer=r,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,i){let r=[],s=[],n=gre(this._driver,i,r,s);if(r.length)throw PUe(r);s.length&&void 0,this._animations.set(t,n)}_buildPlayer(t,i,r){let s=t.element,n=cre(this._normalizer,t.keyframes,i,r);return this._driver.animate(s,n,t.duration,t.delay,t.easing,[],!0)}create(t,i,r={}){let s=[],n=this._animations.get(t),c,u=new Map;if(n?(c=yre(this._driver,i,n,pre,t5,new Map,new Map,r,y5e,s),c.forEach(x=>{let w=yc(u,x.element,new Map);x.postStyleProps.forEach(E=>w.set(E,null))})):(s.push(RUe()),c=[]),s.length)throw OUe(s);u.forEach((x,w)=>{x.forEach((E,A)=>{x.set(A,this._driver.computeStyle(w,A,ad))})});let p=c.map(x=>{let w=u.get(x.element);return this._buildPlayer(x,new Map,w)}),f=Em(p);return this._playersById.set(t,f),f.onDestroy(()=>this.destroy(t)),this.players.push(f),f}destroy(t){let i=this._getPlayer(t);i.destroy(),this._playersById.delete(t);let r=this.players.indexOf(i);r>=0&&this.players.splice(r,1)}_getPlayer(t){let i=this._playersById.get(t);if(!i)throw LUe(t);return i}listen(t,i,r,s){let n=v5(i,"","","");return y5(this._getPlayer(t),r,n,s),()=>{}}command(t,i,r,s){if(r=="register"){this.register(t,s[0]);return}if(r=="create"){let c=s[0]||{};this.create(t,i,c);return}let n=this._getPlayer(t);switch(r){case"play":n.play();break;case"pause":n.pause();break;case"reset":n.reset();break;case"restart":n.restart();break;case"finish":n.finish();break;case"init":n.init();break;case"setPosition":n.setPosition(parseFloat(s[0]));break;case"destroy":this.destroy(t);break}}},nre="ng-animate-queued",v5e=".ng-animate-queued",KU="ng-animate-disabled",_5e=".ng-animate-disabled",x5e="ng-star-inserted",b5e=".ng-star-inserted",w5e=[],_re={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},S5e={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Ju="__ng_removed",lE=class{get params(){return this.options.params}constructor(t,i=""){this.namespaceId=i;let r=t&&t.hasOwnProperty("value"),s=r?t.value:t;if(this.value=M5e(s),r){let n=t,{value:c}=n,u=ll(n,["value"]);this.options=u}else this.options={};this.options.params||(this.options.params={})}absorbOptions(t){let i=t.params;if(i){let r=this.options.params;Object.keys(i).forEach(s=>{r[s]==null&&(r[s]=i[s])})}}},sE="void",JU=new lE(sE),p5=class{constructor(t,i,r){this.id=t,this.hostElement=i,this._engine=r,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,tu(i,this._hostClassName)}listen(t,i,r,s){if(!this._triggers.has(i))throw zUe(r,i);if(r==null||r.length==0)throw FUe(i);if(!T5e(r))throw kUe(r,i);let n=yc(this._elementListeners,t,[]),c={name:i,phase:r,callback:s};n.push(c);let u=yc(this._engine.statesByElement,t,new Map);return u.has(i)||(tu(t,WI),tu(t,WI+"-"+i),u.set(i,JU)),()=>{this._engine.afterFlush(()=>{let p=n.indexOf(c);p>=0&&n.splice(p,1),this._triggers.has(i)||u.delete(i)})}}register(t,i){return this._triggers.has(t)?!1:(this._triggers.set(t,i),!0)}_getTrigger(t){let i=this._triggers.get(t);if(!i)throw NUe(t);return i}trigger(t,i,r,s=!0){let n=this._getTrigger(i),c=new cE(this.id,i,t),u=this._engine.statesByElement.get(t);u||(tu(t,WI),tu(t,WI+"-"+i),this._engine.statesByElement.set(t,u=new Map));let p=u.get(i),f=new lE(r,this.id);if(!(r&&r.hasOwnProperty("value"))&&p&&f.absorbOptions(p.options),u.set(i,f),p||(p=JU),!(f.value===sE)&&p.value===f.value){if(!D5e(p.params,f.params)){let P=[],O=n.matchStyles(p.value,p.params,P),k=n.matchStyles(f.value,f.params,P);P.length?this._engine.reportError(P):this._engine.afterFlush(()=>{Jy(t,O),ld(t,k)})}return}let E=yc(this._engine.playersByElement,t,[]);E.forEach(P=>{P.namespaceId==this.id&&P.triggerName==i&&P.queued&&P.destroy()});let A=n.matchTransition(p.value,f.value,t,f.params),I=!1;if(!A){if(!s)return;A=n.fallbackTransition,I=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:i,transition:A,fromState:p,toState:f,player:c,isFallbackTransition:I}),I||(tu(t,nre),c.onStart(()=>{Bx(t,nre)})),c.onDone(()=>{let P=this.players.indexOf(c);P>=0&&this.players.splice(P,1);let O=this._engine.playersByElement.get(t);if(O){let k=O.indexOf(c);k>=0&&O.splice(k,1)}}),this.players.push(c),E.push(c),c}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(i=>i.delete(t)),this._elementListeners.forEach((i,r)=>{this._elementListeners.set(r,i.filter(s=>s.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);let i=this._engine.playersByElement.get(t);i&&(i.forEach(r=>r.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,i){let r=this._engine.driver.query(t,ZI,!0);r.forEach(s=>{if(s[Ju])return;let n=this._engine.fetchNamespacesByElement(s);n.size?n.forEach(c=>c.triggerLeaveAnimation(s,i,!1,!0)):this.clearElementCache(s)}),this._engine.afterFlushAnimationsDone(()=>r.forEach(s=>this.clearElementCache(s)))}triggerLeaveAnimation(t,i,r,s){let n=this._engine.statesByElement.get(t),c=new Map;if(n){let u=[];if(n.forEach((p,f)=>{if(c.set(f,p.value),this._triggers.has(f)){let x=this.trigger(t,f,sE,s);x&&u.push(x)}}),u.length)return this._engine.markElementAsRemoved(this.id,t,!0,i,c),r&&Em(u).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){let i=this._elementListeners.get(t),r=this._engine.statesByElement.get(t);if(i&&r){let s=new Set;i.forEach(n=>{let c=n.name;if(s.has(c))return;s.add(c);let p=this._triggers.get(c).fallbackTransition,f=r.get(c)||JU,x=new lE(sE),w=new cE(this.id,c,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:c,transition:p,fromState:f,toState:x,player:w,isFallbackTransition:!0})})}}removeNode(t,i){let r=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,i),this.triggerLeaveAnimation(t,i,!0))return;let s=!1;if(r.totalAnimations){let n=r.players.length?r.playersByQueriedElement.get(t):[];if(n&&n.length)s=!0;else{let c=t;for(;c=c.parentNode;)if(r.statesByElement.get(c)){s=!0;break}}}if(this.prepareLeaveAnimationListeners(t),s)r.markElementAsRemoved(this.id,t,!1,i);else{let n=t[Ju];(!n||n===_re)&&(r.afterFlush(()=>this.clearElementCache(t)),r.destroyInnerAnimations(t),r._onRemovalComplete(t,i))}}insertNode(t,i){tu(t,this._hostClassName)}drainQueuedTransitions(t){let i=[];return this._queue.forEach(r=>{let s=r.player;if(s.destroyed)return;let n=r.element,c=this._elementListeners.get(n);c&&c.forEach(u=>{if(u.name==r.triggerName){let p=v5(n,r.triggerName,r.fromState.value,r.toState.value);p._data=t,y5(r.player,u.phase,p,u.callback)}}),s.markedForDestroy?this._engine.afterFlush(()=>{s.destroy()}):i.push(r)}),this._queue=[],i.sort((r,s)=>{let n=r.transition.ast.depCount,c=s.transition.ast.depCount;return n==0||c==0?n-c:this._engine.driver.containsElement(r.element,s.element)?1:-1})}destroy(t){this.players.forEach(i=>i.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}},f5=class{_onRemovalComplete(t,i){this.onRemovalComplete(t,i)}constructor(t,i,r,s){this.bodyNode=t,this.driver=i,this._normalizer=r,this.scheduler=s,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(n,c)=>{}}get queuedPlayers(){let t=[];return this._namespaceList.forEach(i=>{i.players.forEach(r=>{r.queued&&t.push(r)})}),t}createNamespace(t,i){let r=new p5(t,i,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,i)?this._balanceNamespaceList(r,i):(this.newHostElements.set(i,r),this.collectEnterElement(i)),this._namespaceLookup[t]=r}_balanceNamespaceList(t,i){let r=this._namespaceList,s=this.namespacesByHostElement;if(r.length-1>=0){let c=!1,u=this.driver.getParentElement(i);for(;u;){let p=s.get(u);if(p){let f=r.indexOf(p);r.splice(f+1,0,t),c=!0;break}u=this.driver.getParentElement(u)}c||r.unshift(t)}else r.push(t);return s.set(i,t),t}register(t,i){let r=this._namespaceLookup[t];return r||(r=this.createNamespace(t,i)),r}registerTrigger(t,i,r){let s=this._namespaceLookup[t];s&&s.register(i,r)&&this.totalAnimations++}destroy(t,i){t&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let r=this._fetchNamespace(t);this.namespacesByHostElement.delete(r.hostElement);let s=this._namespaceList.indexOf(r);s>=0&&this._namespaceList.splice(s,1),r.destroy(i),delete this._namespaceLookup[t]}))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){let i=new Set,r=this.statesByElement.get(t);if(r){for(let s of r.values())if(s.namespaceId){let n=this._fetchNamespace(s.namespaceId);n&&i.add(n)}}return i}trigger(t,i,r,s){if(XI(i)){let n=this._fetchNamespace(t);if(n)return n.trigger(i,r,s),!0}return!1}insertNode(t,i,r,s){if(!XI(i))return;let n=i[Ju];if(n&&n.setForRemoval){n.setForRemoval=!1,n.setForMove=!0;let c=this.collectedLeaveElements.indexOf(i);c>=0&&this.collectedLeaveElements.splice(c,1)}if(t){let c=this._fetchNamespace(t);c&&c.insertNode(i,r)}s&&this.collectEnterElement(i)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,i){i?this.disabledNodes.has(t)||(this.disabledNodes.add(t),tu(t,KU)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),Bx(t,KU))}removeNode(t,i,r){if(XI(i)){this.scheduler?.notify();let s=t?this._fetchNamespace(t):null;s?s.removeNode(i,r):this.markElementAsRemoved(t,i,!1,r);let n=this.namespacesByHostElement.get(i);n&&n.id!==t&&n.removeNode(i,r)}else this._onRemovalComplete(i,r)}markElementAsRemoved(t,i,r,s,n){this.collectedLeaveElements.push(i),i[Ju]={namespaceId:t,setForRemoval:s,hasAnimation:r,removedBeforeQueried:!1,previousTriggersValues:n}}listen(t,i,r,s,n){return XI(i)?this._fetchNamespace(t).listen(i,r,s,n):()=>{}}_buildInstruction(t,i,r,s,n){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,r,s,t.fromState.options,t.toState.options,i,n)}destroyInnerAnimations(t){let i=this.driver.query(t,ZI,!0);i.forEach(r=>this.destroyActiveAnimationsForElement(r)),this.playersByQueriedElement.size!=0&&(i=this.driver.query(t,i5,!0),i.forEach(r=>this.finishActiveQueriedAnimationOnElement(r)))}destroyActiveAnimationsForElement(t){let i=this.playersByElement.get(t);i&&i.forEach(r=>{r.queued?r.markedForDestroy=!0:r.destroy()})}finishActiveQueriedAnimationOnElement(t){let i=this.playersByQueriedElement.get(t);i&&i.forEach(r=>r.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return Em(this.players).onDone(()=>t());t()})}processLeaveNode(t){let i=t[Ju];if(i&&i.setForRemoval){if(t[Ju]=_re,i.namespaceId){this.destroyInnerAnimations(t);let r=this._fetchNamespace(i.namespaceId);r&&r.clearElementCache(t)}this._onRemovalComplete(t,i.setForRemoval)}t.classList?.contains(KU)&&this.markElementAsDisabled(t,!1),this.driver.query(t,_5e,!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(t=-1){let i=[];if(this.newHostElements.size&&(this.newHostElements.forEach((r,s)=>this._balanceNamespaceList(r,s)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let r=0;r<this.collectedEnterElements.length;r++){let s=this.collectedEnterElements[r];tu(s,x5e)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let r=[];try{i=this._flushAnimations(r,t)}finally{for(let s=0;s<r.length;s++)r[s]()}}else for(let r=0;r<this.collectedLeaveElements.length;r++){let s=this.collectedLeaveElements[r];this.processLeaveNode(s)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(r=>r()),this._flushFns=[],this._whenQuietFns.length){let r=this._whenQuietFns;this._whenQuietFns=[],i.length?Em(i).onDone(()=>{r.forEach(s=>s())}):r.forEach(s=>s())}}reportError(t){throw BUe(t)}_flushAnimations(t,i){let r=new aE,s=[],n=new Map,c=[],u=new Map,p=new Map,f=new Map,x=new Set;this.disabledNodes.forEach(Fe=>{x.add(Fe);let Pe=this.driver.query(Fe,v5e,!0);for(let Ae=0;Ae<Pe.length;Ae++)x.add(Pe[Ae])});let w=this.bodyNode,E=Array.from(this.statesByElement.keys()),A=are(E,this.collectedEnterElements),I=new Map,P=0;A.forEach((Fe,Pe)=>{let Ae=pre+P++;I.set(Pe,Ae),Fe.forEach(et=>tu(et,Ae))});let O=[],k=new Set,U=new Set;for(let Fe=0;Fe<this.collectedLeaveElements.length;Fe++){let Pe=this.collectedLeaveElements[Fe],Ae=Pe[Ju];Ae&&Ae.setForRemoval&&(O.push(Pe),k.add(Pe),Ae.hasAnimation?this.driver.query(Pe,b5e,!0).forEach(et=>k.add(et)):U.add(Pe))}let j=new Map,V=are(E,Array.from(k));V.forEach((Fe,Pe)=>{let Ae=t5+P++;j.set(Pe,Ae),Fe.forEach(et=>tu(et,Ae))}),t.push(()=>{A.forEach((Fe,Pe)=>{let Ae=I.get(Pe);Fe.forEach(et=>Bx(et,Ae))}),V.forEach((Fe,Pe)=>{let Ae=j.get(Pe);Fe.forEach(et=>Bx(et,Ae))}),O.forEach(Fe=>{this.processLeaveNode(Fe)})});let $=[],Y=[];for(let Fe=this._namespaceList.length-1;Fe>=0;Fe--)this._namespaceList[Fe].drainQueuedTransitions(i).forEach(Ae=>{let et=Ae.player,$e=Ae.element;if($.push(et),this.collectedEnterElements.length){let kt=$e[Ju];if(kt&&kt.setForMove){if(kt.previousTriggersValues&&kt.previousTriggersValues.has(Ae.triggerName)){let yt=kt.previousTriggersValues.get(Ae.triggerName),Nt=this.statesByElement.get(Ae.element);if(Nt&&Nt.has(Ae.triggerName)){let Mt=Nt.get(Ae.triggerName);Mt.value=yt,Nt.set(Ae.triggerName,Mt)}}et.destroy();return}}let rt=!w||!this.driver.containsElement(w,$e),Je=j.get($e),bt=I.get($e),ot=this._buildInstruction(Ae,r,bt,Je,rt);if(ot.errors&&ot.errors.length){Y.push(ot);return}if(rt){et.onStart(()=>Jy($e,ot.fromStyles)),et.onDestroy(()=>ld($e,ot.toStyles)),s.push(et);return}if(Ae.isFallbackTransition){et.onStart(()=>Jy($e,ot.fromStyles)),et.onDestroy(()=>ld($e,ot.toStyles)),s.push(et);return}let xt=[];ot.timelines.forEach(kt=>{kt.stretchStartingKeyframe=!0,this.disabledNodes.has(kt.element)||xt.push(kt)}),ot.timelines=xt,r.append($e,ot.timelines);let Xe={instruction:ot,player:et,element:$e};c.push(Xe),ot.queriedElements.forEach(kt=>yc(u,kt,[]).push(et)),ot.preStyleProps.forEach((kt,yt)=>{if(kt.size){let Nt=p.get(yt);Nt||p.set(yt,Nt=new Set),kt.forEach((Mt,li)=>Nt.add(li))}}),ot.postStyleProps.forEach((kt,yt)=>{let Nt=f.get(yt);Nt||f.set(yt,Nt=new Set),kt.forEach((Mt,li)=>Nt.add(li))})});if(Y.length){let Fe=[];Y.forEach(Pe=>{Fe.push(UUe(Pe.triggerName,Pe.errors))}),$.forEach(Pe=>Pe.destroy()),this.reportError(Fe)}let J=new Map,X=new Map;c.forEach(Fe=>{let Pe=Fe.element;r.has(Pe)&&(X.set(Pe,Pe),this._beforeAnimationBuild(Fe.player.namespaceId,Fe.instruction,J))}),s.forEach(Fe=>{let Pe=Fe.element;this._getPreviousPlayers(Pe,!1,Fe.namespaceId,Fe.triggerName,null).forEach(et=>{yc(J,Pe,[]).push(et),et.destroy()})});let ee=O.filter(Fe=>lre(Fe,p,f)),oe=new Map;ore(oe,this.driver,U,f,ad).forEach(Fe=>{lre(Fe,p,f)&&ee.push(Fe)});let ve=new Map;A.forEach((Fe,Pe)=>{ore(ve,this.driver,new Set(Fe),p,HI)}),ee.forEach(Fe=>{let Pe=oe.get(Fe),Ae=ve.get(Fe);oe.set(Fe,new Map([...Pe?.entries()??[],...Ae?.entries()??[]]))});let we=[],fe=[],Ue={};c.forEach(Fe=>{let{element:Pe,player:Ae,instruction:et}=Fe;if(r.has(Pe)){if(x.has(Pe)){Ae.onDestroy(()=>ld(Pe,et.toStyles)),Ae.disabled=!0,Ae.overrideTotalTime(et.totalTime),s.push(Ae);return}let $e=Ue;if(X.size>1){let Je=Pe,bt=[];for(;Je=Je.parentNode;){let ot=X.get(Je);if(ot){$e=ot;break}bt.push(Je)}bt.forEach(ot=>X.set(ot,$e))}let rt=this._buildAnimation(Ae.namespaceId,et,J,n,ve,oe);if(Ae.setRealPlayer(rt),$e===Ue)we.push(Ae);else{let Je=this.playersByElement.get($e);Je&&Je.length&&(Ae.parentPlayer=Em(Je)),s.push(Ae)}}else Jy(Pe,et.fromStyles),Ae.onDestroy(()=>ld(Pe,et.toStyles)),fe.push(Ae),x.has(Pe)&&s.push(Ae)}),fe.forEach(Fe=>{let Pe=n.get(Fe.element);if(Pe&&Pe.length){let Ae=Em(Pe);Fe.setRealPlayer(Ae)}}),s.forEach(Fe=>{Fe.parentPlayer?Fe.syncPlayerEvents(Fe.parentPlayer):Fe.destroy()});for(let Fe=0;Fe<O.length;Fe++){let Pe=O[Fe],Ae=Pe[Ju];if(Bx(Pe,t5),Ae&&Ae.hasAnimation)continue;let et=[];if(u.size){let rt=u.get(Pe);rt&&rt.length&&et.push(...rt);let Je=this.driver.query(Pe,i5,!0);for(let bt=0;bt<Je.length;bt++){let ot=u.get(Je[bt]);ot&&ot.length&&et.push(...ot)}}let $e=et.filter(rt=>!rt.destroyed);$e.length?A5e(this,Pe,$e):this.processLeaveNode(Pe)}return O.length=0,we.forEach(Fe=>{this.players.push(Fe),Fe.onDone(()=>{Fe.destroy();let Pe=this.players.indexOf(Fe);this.players.splice(Pe,1)}),Fe.play()}),we}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,i,r,s,n){let c=[];if(i){let u=this.playersByQueriedElement.get(t);u&&(c=u)}else{let u=this.playersByElement.get(t);if(u){let p=!n||n==sE;u.forEach(f=>{f.queued||!p&&f.triggerName!=s||c.push(f)})}}return(r||s)&&(c=c.filter(u=>!(r&&r!=u.namespaceId||s&&s!=u.triggerName))),c}_beforeAnimationBuild(t,i,r){let s=i.triggerName,n=i.element,c=i.isRemovalTransition?void 0:t,u=i.isRemovalTransition?void 0:s;for(let p of i.timelines){let f=p.element,x=f!==n,w=yc(r,f,[]);this._getPreviousPlayers(f,x,c,u,i.toState).forEach(A=>{let I=A.getRealPlayer();I.beforeDestroy&&I.beforeDestroy(),A.destroy(),w.push(A)})}Jy(n,i.fromStyles)}_buildAnimation(t,i,r,s,n,c){let u=i.triggerName,p=i.element,f=[],x=new Set,w=new Set,E=i.timelines.map(I=>{let P=I.element;x.add(P);let O=P[Ju];if(O&&O.removedBeforeQueried)return new Sm(I.duration,I.delay);let k=P!==p,U=C5e((r.get(P)||w5e).map(J=>J.getRealPlayer())).filter(J=>{let X=J;return X.element?X.element===P:!1}),j=n.get(P),V=c.get(P),$=cre(this._normalizer,I.keyframes,j,V),Y=this._buildPlayer(I,$,U);if(I.subTimeline&&s&&w.add(P),k){let J=new cE(t,u,P);J.setRealPlayer(Y),f.push(J)}return Y});f.forEach(I=>{yc(this.playersByQueriedElement,I.element,[]).push(I),I.onDone(()=>E5e(this.playersByQueriedElement,I.element,I))}),x.forEach(I=>tu(I,Kie));let A=Em(E);return A.onDestroy(()=>{x.forEach(I=>Bx(I,Kie)),ld(p,i.toStyles)}),w.forEach(I=>{yc(s,I,[]).push(A)}),A}_buildPlayer(t,i,r){return i.length>0?this.driver.animate(t.element,i,t.duration,t.delay,t.easing,r):new Sm(t.duration,t.delay)}},cE=class{constructor(t,i,r){this.namespaceId=t,this.triggerName=i,this.element=r,this._player=new Sm,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((i,r)=>{i.forEach(s=>y5(t,r,void 0,s))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){let i=this._player;i.triggerCallback&&t.onStart(()=>i.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,i){yc(this._queuedCallbacks,t,[]).push(i)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){let i=this._player;i.triggerCallback&&i.triggerCallback(t)}};function E5e(e,t,i){let r=e.get(t);if(r){if(r.length){let s=r.indexOf(i);r.splice(s,1)}r.length==0&&e.delete(t)}return r}function M5e(e){return e??null}function XI(e){return e&&e.nodeType===1}function T5e(e){return e=="start"||e=="done"}function sre(e,t){let i=e.style.display;return e.style.display=t??"none",i}function ore(e,t,i,r,s){let n=[];i.forEach(p=>n.push(sre(p)));let c=[];r.forEach((p,f)=>{let x=new Map;p.forEach(w=>{let E=t.computeStyle(f,w,s);x.set(w,E),(!E||E.length==0)&&(f[Ju]=S5e,c.push(f))}),e.set(f,x)});let u=0;return i.forEach(p=>sre(p,n[u++])),c}function are(e,t){let i=new Map;if(e.forEach(u=>i.set(u,[])),t.length==0)return i;let r=1,s=new Set(t),n=new Map;function c(u){if(!u)return r;let p=n.get(u);if(p)return p;let f=u.parentNode;return i.has(f)?p=f:s.has(f)?p=r:p=c(f),n.set(u,p),p}return t.forEach(u=>{let p=c(u);p!==r&&i.get(p).push(u)}),i}function tu(e,t){e.classList?.add(t)}function Bx(e,t){e.classList?.remove(t)}function A5e(e,t,i){Em(i).onDone(()=>e.processLeaveNode(t))}function C5e(e){let t=[];return xre(e,t),t}function xre(e,t){for(let i=0;i<e.length;i++){let r=e[i];r instanceof rE?xre(r.players,t):t.push(r)}}function D5e(e,t){let i=Object.keys(e),r=Object.keys(t);if(i.length!=r.length)return!1;for(let s=0;s<i.length;s++){let n=i[s];if(!t.hasOwnProperty(n)||e[n]!==t[n])return!1}return!0}function lre(e,t,i){let r=i.get(e);if(!r)return!1;let s=t.get(e);return s?r.forEach(n=>s.add(n)):t.set(e,r),i.delete(e),!0}var jx=class{constructor(t,i,r,s){this._driver=i,this._normalizer=r,this._triggerCache={},this.onRemovalComplete=(n,c)=>{},this._transitionEngine=new f5(t.body,i,r,s),this._timelineEngine=new d5(t.body,i,r),this._transitionEngine.onRemovalComplete=(n,c)=>this.onRemovalComplete(n,c)}registerTrigger(t,i,r,s,n){let c=t+"-"+s,u=this._triggerCache[c];if(!u){let p=[],f=[],x=gre(this._driver,n,p,f);if(p.length)throw DUe(s,p);f.length&&void 0,u=m5e(s,x,this._normalizer),this._triggerCache[c]=u}this._transitionEngine.registerTrigger(i,s,u)}register(t,i){this._transitionEngine.register(t,i)}destroy(t,i){this._transitionEngine.destroy(t,i)}onInsert(t,i,r,s){this._transitionEngine.insertNode(t,i,r,s)}onRemove(t,i,r){this._transitionEngine.removeNode(t,i,r)}disableAnimations(t,i){this._transitionEngine.markElementAsDisabled(t,i)}process(t,i,r,s){if(r.charAt(0)=="@"){let[n,c]=Zie(r),u=s;this._timelineEngine.command(n,i,c,u)}else this._transitionEngine.trigger(t,i,r,s)}listen(t,i,r,s,n){if(r.charAt(0)=="@"){let[c,u]=Zie(r);return this._timelineEngine.listen(c,i,u,n)}return this._transitionEngine.listen(t,i,r,s,n)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(t){this._transitionEngine.afterFlushAnimationsDone(t)}};function I5e(e,t){let i=null,r=null;return Array.isArray(t)&&t.length?(i=e5(t[0]),t.length>1&&(r=e5(t[t.length-1]))):t instanceof Map&&(i=e5(t)),i||r?new m5(e,i,r):null}var Ux=class Ux{constructor(t,i,r){this._element=t,this._startStyles=i,this._endStyles=r,this._state=0;let s=Ux.initialStylesByElement.get(t);s||Ux.initialStylesByElement.set(t,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&ld(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(ld(this._element,this._initialStyles),this._endStyles&&(ld(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(Ux.initialStylesByElement.delete(this._element),this._startStyles&&(Jy(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Jy(this._element,this._endStyles),this._endStyles=null),ld(this._element,this._initialStyles),this._state=3)}};Ux.initialStylesByElement=new WeakMap;var m5=Ux;function e5(e){let t=null;return e.forEach((i,r)=>{P5e(r)&&(t=t||new Map,t.set(r,i))}),t}function P5e(e){return e==="display"||e==="position"}var rP=class{constructor(t,i,r,s){this.element=t,this.keyframes=i,this.options=r,this._specialStyles=s,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=r.duration,this._delay=r.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map;let i=()=>this._onFinish();this.domPlayer.addEventListener("finish",i),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",i)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){let i=[];return t.forEach(r=>{i.push(Object.fromEntries(r))}),i}_triggerWebAnimation(t,i,r){return t.animate(this._convertKeyframesToObject(i),r)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((r,s)=>{s!=="offset"&&t.set(s,this._finished?r:w5(this.element,s))}),this.currentSnapshot=t}triggerCallback(t){let i=t==="start"?this._onStartFns:this._onDoneFns;i.forEach(r=>r()),i.length=0}},nP=class{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,i){return!1}containsElement(t,i){return ure(t,i)}getParentElement(t){return _5(t)}query(t,i,r){return hre(t,i,r)}computeStyle(t,i,r){return w5(t,i)}animate(t,i,r,s,n,c=[]){let u=s==0?"both":"forwards",p={duration:r,delay:s,fill:u};n&&(p.easing=n);let f=new Map,x=c.filter(A=>A instanceof rP);QUe(r,s)&&x.forEach(A=>{A.currentSnapshot.forEach((I,P)=>f.set(P,I))});let w=XUe(i).map(A=>new Map(A));w=KUe(t,w,f);let E=I5e(t,w);return new rP(t,w,p,E)}};var $I="@",bre="@.disabled",sP=class{constructor(t,i,r,s){this.namespaceId=t,this.delegate=i,this.engine=r,this._onDestroy=s,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(t){this.delegate.destroyNode?.(t)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(t,i){return this.delegate.createElement(t,i)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,i){this.delegate.appendChild(t,i),this.engine.onInsert(this.namespaceId,i,t,!1)}insertBefore(t,i,r,s=!0){this.delegate.insertBefore(t,i,r),this.engine.onInsert(this.namespaceId,i,t,s)}removeChild(t,i,r){this.engine.onRemove(this.namespaceId,i,this.delegate)}selectRootElement(t,i){return this.delegate.selectRootElement(t,i)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,i,r,s){this.delegate.setAttribute(t,i,r,s)}removeAttribute(t,i,r){this.delegate.removeAttribute(t,i,r)}addClass(t,i){this.delegate.addClass(t,i)}removeClass(t,i){this.delegate.removeClass(t,i)}setStyle(t,i,r,s){this.delegate.setStyle(t,i,r,s)}removeStyle(t,i,r){this.delegate.removeStyle(t,i,r)}setProperty(t,i,r){i.charAt(0)==$I&&i==bre?this.disableAnimations(t,!!r):this.delegate.setProperty(t,i,r)}setValue(t,i){this.delegate.setValue(t,i)}listen(t,i,r){return this.delegate.listen(t,i,r)}disableAnimations(t,i){this.engine.disableAnimations(t,i)}},g5=class extends sP{constructor(t,i,r,s,n){super(i,r,s,n),this.factory=t,this.namespaceId=i}setProperty(t,i,r){i.charAt(0)==$I?i.charAt(1)=="."&&i==bre?(r=r===void 0?!0:!!r,this.disableAnimations(t,r)):this.engine.process(this.namespaceId,t,i.slice(1),r):this.delegate.setProperty(t,i,r)}listen(t,i,r){if(i.charAt(0)==$I){let s=R5e(t),n=i.slice(1),c="";return n.charAt(0)!=$I&&([n,c]=O5e(n)),this.engine.listen(this.namespaceId,s,n,c,u=>{let p=u._data||-1;this.factory.scheduleListenerCallback(p,r,u)})}return this.delegate.listen(t,i,r)}};function R5e(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}function O5e(e){let t=e.indexOf("."),i=e.substring(0,t),r=e.slice(t+1);return[i,r]}var oP=class{constructor(t,i,r){this.delegate=t,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,i.onRemovalComplete=(s,n)=>{let c=n?.parentNode(s);c&&n.removeChild(c,s)}}createRenderer(t,i){let r="",s=this.delegate.createRenderer(t,i);if(!t||!i?.data?.animation){let f=this._rendererCache,x=f.get(s);if(!x){let w=()=>f.delete(s);x=new sP(r,s,this.engine,w),f.set(s,x)}return x}let n=i.id,c=i.id+"-"+this._currentId;this._currentId++,this.engine.register(c,t);let u=f=>{Array.isArray(f)?f.forEach(u):this.engine.registerTrigger(n,c,t,f.name,f)};return i.data.animation.forEach(u),new g5(this,c,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(t,i,r){if(t>=0&&t<this._microtaskId){this._zone.run(()=>i(r));return}let s=this._animationCallbacksBuffer;s.length==0&&queueMicrotask(()=>{this._zone.run(()=>{s.forEach(n=>{let[c,u]=n;c(u)}),this._animationCallbacksBuffer=[]})}),s.push([i,r])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var z5e=(()=>{let t=class t extends jx{constructor(r,s,n){super(r,s,n,tr(Rb,{optional:!0}))}ngOnDestroy(){this.flush()}};t.\u0275fac=function(s){return new(s||t)(Er(Ks),Er(ev),Er(tv))},t.\u0275prov=hr({token:t,factory:t.\u0275fac});let e=t;return e})();function F5e(){return new KI}function k5e(e,t,i){return new oP(e,t,i)}var wre=[{provide:tv,useFactory:F5e},{provide:jx,useClass:z5e},{provide:Ug,useFactory:k5e,deps:[VA,jx,Ys]}],N5e=[{provide:ev,useFactory:()=>new nP},{provide:gL,useValue:"BrowserAnimations"},...wre],Brt=[{provide:ev,useClass:x5},{provide:gL,useValue:"NoopAnimations"},...wre];function Sre(){return jb("NgEagerAnimations"),[...N5e]}var Ere={providers:[wq(Wie),QL(),Sre()]};var Mre=(()=>{let t=class t{constructor(r,s){this.router=r,this.mapService=s,this.ViewState=aP,this.currentPitch=60,this.mapState=aP.MAP_VIEW}ngOnInit(){}handleActiveItem(r,s){this.router.navigateByUrl(`/${s}`).then(()=>{let n=r.target.id;this.mapState=aP[n]})}handleZoomChange(r){this.mapService.updateZoom(r)}handlePitchChange(r){this.mapService.updatePitch(r)}navigate(r){this.router.navigateByUrl(`/${r}`)}};t.\u0275fac=function(s){return new(s||t)(_s(oC),_s(i_))},t.\u0275cmp=xo({type:t,selectors:[["app-toolbar"]],standalone:!0,features:[bo],decls:17,vars:3,consts:[[1,"container"],[1,"map-control"],[1,"img-container",3,"click"],["src","../../../assets/map-2d-control.svg"],["src","../../../assets/map-location-control.svg"],["src","../../../assets/map-devices-control.svg"],[1,"view-control"],["id","MAP_VIEW",1,"img-container",3,"click","ngClass"],["id","MAP_VIEW","src","../../../assets/menu-map.svg"],["id","BUBBLE_VIEW",1,"img-container",3,"click","ngClass"],["id","BUBBLE_VIEW","src","../../../assets/bubble-menu-item.svg"],["id","DEVICE_VIEW",1,"img-container",3,"click","ngClass"],["id","DEVICE_VIEW","src","../../../assets/map-cluster-control.svg"],[1,"ai-control"],["src","../../../assets/ai-ball.svg",1,"ai-ball"]],template:function(s,n){s&1&&(Pn(0,"div",0)(1,"div",1)(2,"div",2),oc("click",function(){return n.handlePitchChange(0)}),Os(3,"img",3),kn(),Pn(4,"div",2),oc("click",function(){return n.handleZoomChange(15)}),Os(5,"img",4),kn(),Pn(6,"div",2),oc("click",function(){return n.handleZoomChange(11)}),Os(7,"img",5),kn()(),Pn(8,"div",6)(9,"div",7),oc("click",function(u){return n.handleActiveItem(u,"map")}),Os(10,"img",8),kn(),Pn(11,"div",9),oc("click",function(u){return n.handleActiveItem(u,"map")}),Os(12,"img",10),kn(),Pn(13,"div",11),oc("click",function(u){return n.handleActiveItem(u,"devices")}),Os(14,"img",12),kn()(),Pn(15,"div",13),Os(16,"img",14),kn()()),s&2&&(Qs(9),sa("ngClass",n.mapState===n.ViewState.MAP_VIEW?"active":"not-active"),Qs(2),sa("ngClass",n.mapState===n.ViewState.BUBBLE_VIEW?"active":"not-active"),Qs(2),sa("ngClass",n.mapState===n.ViewState.DEVICE_VIEW?"active":"not-active"))},dependencies:[lc,OA],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:absolute;justify-content:space-between;bottom:24px;left:32px;width:48px;height:352px;z-index:800}.container[_ngcontent-%COMP%]   .map-control[_ngcontent-%COMP%]{height:128px;border-radius:8px;width:48px;height:144px;display:flex;flex-direction:column;box-sizing:border-box;justify-content:space-between;align-items:center;padding:8px}.container[_ngcontent-%COMP%]   .map-control[_ngcontent-%COMP%]   .img-container[_ngcontent-%COMP%]{cursor:pointer;border-radius:4px;display:flex;justify-content:center;align-items:center;width:32px;height:32px}.container[_ngcontent-%COMP%]   .map-control[_ngcontent-%COMP%]   .img-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:24px;width:24px}.container[_ngcontent-%COMP%]   .view-control[_ngcontent-%COMP%]{background:linear-gradient(90deg,#fff,#f7f7f7 50%);box-shadow:0 0 3px 1px #dad3d3;border-radius:8px;width:48px;height:144px;display:flex;flex-direction:column;box-sizing:border-box;justify-content:space-between;align-items:center;padding:8px}.container[_ngcontent-%COMP%]   .view-control[_ngcontent-%COMP%]   .img-container[_ngcontent-%COMP%]{cursor:pointer;border-radius:4px;display:flex;justify-content:center;align-items:center;width:32px;height:32px}.container[_ngcontent-%COMP%]   .view-control[_ngcontent-%COMP%]   .img-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:24px;width:24px}.container[_ngcontent-%COMP%]   .ai-control[_ngcontent-%COMP%]{background:linear-gradient(90deg,#fff,#f7f7f7 50%);box-shadow:0 0 3px 1px #dad3d3;border-radius:8px;width:48px;height:48px;display:flex;align-items:center;justify-content:center}.container[_ngcontent-%COMP%]   .ai-control[_ngcontent-%COMP%]   .ai-ball[_ngcontent-%COMP%]{width:80%;height:80%}.active[_ngcontent-%COMP%]{box-shadow:0 0 3px 2px #dad3d3;background-color:#fff;transition:all 1s}.not-active[_ngcontent-%COMP%]{box-shadow:none;background-color:transparent;transition:all .5s}"]});let e=t;return e})(),aP=function(e){return e.MAP_VIEW="mapView",e.BUBBLE_VIEW="bubbleView",e.DEVICE_VIEW="deviceView",e}(aP||{});var Tre=(()=>{let t=class t{constructor(){}ngOnInit(){}};t.\u0275fac=function(s){return new(s||t)},t.\u0275cmp=xo({type:t,selectors:[["app-topbar"]],standalone:!0,features:[bo],decls:8,vars:0,consts:[[1,"container"],[1,"regions"],["src","../../assets/topbar-regions.svg"],[1,"filters-profile"],["src","../../assets/topbar-search.svg"],["src","../../assets/topbar-filters.svg"],["src","../../assets/topbar-profile.svg"]],template:function(s,n){s&1&&(Pn(0,"div",0)(1,"div",1),Os(2,"img",2),ac(3," Regiony "),kn(),Pn(4,"div",3),Os(5,"img",4)(6,"img",5)(7,"img",6),kn()())},styles:[".container[_ngcontent-%COMP%]{position:absolute;top:32px;left:32px;z-index:800;width:302px;height:48px;display:flex;justify-content:space-around;align-items:center}.container[_ngcontent-%COMP%]   .regions[_ngcontent-%COMP%]{width:118px;height:48px;border-radius:8px;background-color:#fff;box-shadow:0 0 2px 1px #dad3d3;display:flex;font-size:large;justify-content:space-evenly;align-items:center;cursor:pointer}.container[_ngcontent-%COMP%]   .filters-profile[_ngcontent-%COMP%]{width:160px;height:48px;display:flex;justify-content:space-around;align-items:center}.container[_ngcontent-%COMP%]   .filters-profile[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{cursor:pointer}"]});let e=t;return e})();var B5e=["*"];function U5e(e,t){e&1&&(Pn(0,"div",1),AA(1),kn())}var lP=(()=>{let t=class t{constructor(){this.tabTitle="",this.active=!1}ngOnInit(){}};t.\u0275fac=function(s){return new(s||t)},t.\u0275cmp=xo({type:t,selectors:[["app-tab"]],inputs:{tabTitle:"tabTitle",active:"active"},standalone:!0,features:[bo],ngContentSelectors:B5e,decls:1,vars:1,consts:[["style","width: 100%; box-sizing: border-box; display: flex; align-content: center; flex-direction: column",4,"ngIf"],[2,"width","100%","box-sizing","border-box","display","flex","align-content","center","flex-direction","column"]],template:function(s,n){s&1&&(TA(),sc(0,U5e,2,0,"div",0)),s&2&&sa("ngIf",n.active)},dependencies:[lc,H0],encapsulation:2});let e=t;return e})();var j5e=["*"];function V5e(e,t){if(e&1){let i=MA();Pn(0,"li",2),oc("click",function(){let s=hA(i).$implicit,n=Of();return dA(n.selectTab(s))}),Pn(1,"div",3),ac(2),kn()()}if(e&2){let i=t.$implicit;zL("active",i.active),Qs(2),Hd(" ",i.tabTitle," ")}}var Are=(()=>{let t=class t{constructor(){}ngAfterContentInit(){this.tabs.filter(s=>s.active).length===0&&this.selectTab(this.tabs.first)}selectTab(r){this.tabs.toArray().forEach(s=>s.active=!1),r.active=!0}};t.\u0275fac=function(s){return new(s||t)},t.\u0275cmp=xo({type:t,selectors:[["app-tabs"]],contentQueries:function(s,n,c){if(s&1&&kL(c,lP,4),s&2){let u;Gb(u=Hb())&&(n.tabs=u)}},standalone:!0,features:[bo],ngContentSelectors:j5e,decls:3,vars:1,consts:[[1,"tabs"],[3,"active","click",4,"ngFor","ngForOf"],[3,"click"],[1,"content"]],template:function(s,n){s&1&&(TA(),Pn(0,"ul",0),sc(1,V5e,3,3,"li",1),kn(),AA(2)),s&2&&(Qs(),sa("ngForOf",n.tabs))},dependencies:[lc,LA],styles:[".tabs[_ngcontent-%COMP%]{list-style-type:none;padding:0;display:flex;cursor:pointer;justify-content:center;align-items:center;height:44px}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{height:30px;width:40%;display:flex;align-items:center;justify-content:center;padding:5px 10px;background-color:#fafafa}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:nth-child(1){border-radius:20px 0 0 20px;background-color:#fafafa;border-right:none}.tabs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:nth-child(2){border-radius:0 20px 20px 0;border-left:none}.tabs[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;transition:all .5s;border-radius:20px;background-color:#fff;box-shadow:0 0 3px 2px #dad3d3;align-items:center;justify-content:center}"]});let e=t;return e})();var Cre=(()=>{let t=class t{constructor(r,s){this.document=r,this.mapService=s,this.sidenavMaxWidth=window.innerWidth-300}getRightbarWidth(){return parseInt(this.document.getElementById("rightbar").style.width)}handleResizing(r){let s=this.document.getElementById("sidebar"),n=this.document.getElementById("resizer");window.innerWidth-r>40&&(s.style.marginLeft="0px",s.style.width="0px"),window.innerWidth-r>30&&window.innerWidth/2<r&&(n.style.left=r+"px",s.style.marginLeft=-(window.innerWidth-r-30)+"px",s.style.width=window.innerWidth-r-30+"px",this.handleMainViewResize(r,s))}handleMainViewResize(r,s){if(window.location.href.includes("map")){let n=this.document.getElementById("match-parent"),c=this.document.getElementById("map");n.style.marginLeft=-(window.innerWidth-r-30)+"px",c.style.marginLeft=-(window.innerWidth-r-30)+"px",this.mapService.handleRightBarMovement(parseInt(s.style.width))}}setSidenavWidth(r){this.document.getElementById("rightbar")?.setAttribute("width",`${r}px`)}};t.\u0275fac=function(s){return new(s||t)(Er(Ks),Er(i_))},t.\u0275prov=hr({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function H5e(e,t){e&1&&EA(0)}function W5e(e,t){e&1&&EA(0)}function q5e(e,t){if(e&1&&(wA(0),Pn(1,"div",10)(2,"div",11)(3,"p")(4,"b"),ac(5),kn()(),Pn(6,"p"),ac(7,"12:04"),kn()(),Pn(8,"p",12),ac(9),kn(),Pn(10,"p",13),ac(11),kn()(),SA()),e&2){let i=t.$implicit,r=Of(2);Qs(),FL("ngClass",r.getAlarmLevel(i)),Qs(4),Hd("",i,"-001"),Qs(4),Hd("",i,"/00001"),Qs(2),Wb(i)}}function Y5e(e,t){if(e&1&&sc(0,q5e,12,4,"ng-container",9),e&2){let i=Of();sa("ngForOf",i.states)}}function X5e(e,t){e&1&&(Pn(0,"div",14),Os(1,"img",15),Pn(2,"div",16),ac(3," W tej chwili wszystko dzia\u0142a bez zarzutu, nie musisz podejmowa\u0107 \u017Cadnych akcji"),kn()())}var Dre=(()=>{let t=class t{getAlarmLevel(r){return r.includes("New")?"critical":r.includes("North")?"high":"normal"}constructor(r,s){this.rightbarService=r,this.documentService=s,this.sidebarWidth=0,this.isResizing=!1,this.states=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"],this.onResizing=n=>{this.isResizing&&this.rightbarService.handleResizing(n.clientX)},this.onResizeEnd=()=>{document.removeEventListener("mousemove",this.onResizing),document.removeEventListener("mouseup",this.onResizeEnd),this.isResizing=!1}}onResizeStart(r){this.isResizing=!0,document.addEventListener("mousemove",this.onResizing),document.addEventListener("mouseup",this.onResizeEnd)}};t.\u0275fac=function(s){return new(s||t)(_s(Cre),_s(Ks))},t.\u0275cmp=xo({type:t,selectors:[["app-rightbar"]],standalone:!0,features:[bo],decls:12,vars:4,consts:[["activeList",""],["emptyList",""],["id","sidebar"],[1,"conent"],["tabTitle","Aktywne",1,"content"],[4,"ngIf","ngIfThen","ngIfElse"],["tabTitle","Oddelegowane",1,"content"],[4,"ngTemplateOutlet"],["id","resizer",3,"mousedown"],[4,"ngFor","ngForOf"],[1,"card-container",3,"ngClass"],[1,"header"],[1,"name"],[1,"localization"],[1,"empty-text"],["src","https://s3-alpha-sig.figma.com/img/f83e/172c/3c49722eca6c7d3de26eecdbea948102?Expires=1725840000&Key-Pair-Id=APKAQ4GOSFWCVNEHN3O4&Signature=fEoIwb3YFrZkUYUPkLkQzRLxajmORXg5msnMLPWH4VWOPT3W8Xnd0dtm-zj6fX8NVs9sNsIgZGK~UOqUIuHpj0r2yOtDj-9eQVY3wGdWM3tJDgQKZmHKtgJnuiAmRFLgn08MmjARPc5OMxkszS7mUgm~0AxRpnN~qoksoarqKtWsiHwuUuoPCdGR2~In3p2hc6ioT4b5mG6mummSmQ6i~eIhj9fkJIZaZhiSOt7rGAb6udLMt96hnC8rpzv76iwj696JOSPUHqSvabWbwOW5xncDQgQAOonh7GZv1QAvMBvxnYkEe6U2MypxYwtGkzIPuXM7mirqT-n9BqbdknvN3A__"],[1,"text"]],template:function(s,n){if(s&1){let c=MA();Pn(0,"div",2)(1,"div",3)(2,"app-tabs")(3,"app-tab",4),sc(4,H5e,1,0,"ng-container",5),kn(),Pn(5,"app-tab",6),sc(6,W5e,1,0,"ng-container",7),kn()()()(),Pn(7,"div",8),oc("mousedown",function(p){return hA(c),dA(n.onResizeStart(p))}),kn(),sc(8,Y5e,1,1,"ng-template",null,0,BL)(10,X5e,4,0,"ng-template",null,1,BL)}if(s&2){let c=NL(9),u=NL(11);Qs(4),sa("ngIf",n.states.length)("ngIfThen",c)("ngIfElse",u),Qs(2),sa("ngTemplateOutlet",u)}},dependencies:[lc,OA,LA,H0,w9,Are,lP],styles:["#sidebar[_ngcontent-%COMP%]{z-index:800;height:100vh;position:absolute;top:0;right:0;width:0px;overflow-y:auto;background-color:#fff}#resizer[_ngcontent-%COMP%]{width:8px;cursor:ew-resize;height:64px;position:absolute;top:calc(50% - 32px);right:30px;z-index:800;border-radius:8px;background-color:#ababab}.title-container[_ngcontent-%COMP%]{padding:24px 8%;position:sticky;display:flex;flex-direction:row;justify-content:space-between}.title-container[_ngcontent-%COMP%]   .alerts[_ngcontent-%COMP%]{cursor:pointer;font-size:x-large}.title-container[_ngcontent-%COMP%]   .check[_ngcontent-%COMP%]{cursor:pointer}.content[_ngcontent-%COMP%]{display:flex;margin-left:7%;width:86%}.content[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]{padding:10px;margin-bottom:10px;height:120px;border:1px solid #ccc;border-radius:10px}.content[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{height:30px;margin-bottom:30px;display:flex;justify-content:space-between}.content[_ngcontent-%COMP%]   .card-container[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:is(.name, .localization)[_ngcontent-%COMP%]{margin-top:0;margin-bottom:10px;height:fit-content}[_ngcontent-%COMP%]::-webkit-scrollbar{padding-right:20px;width:10px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#fff;margin-top:76px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:#ecd8d8}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:gray;cursor:grab}.critical[_ngcontent-%COMP%]{color:#fff;background:linear-gradient(45deg,#e11515,#f55d8b 70%,#ff8080)}.high[_ngcontent-%COMP%]{color:#000;background:linear-gradient(90deg,#ffeded,#f5f5f5 70%)}.normal[_ngcontent-%COMP%]{color:#000;background:linear-gradient(90deg,#fff7e0,#f5f5f5 90%)}.empty-text[_ngcontent-%COMP%]{overflow:hidden;display:flex;justify-content:center;align-items:center;flex-direction:column;width:100%;height:calc(100vh - 200px);transition:all .5s}.empty-text[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:322px;-webkit-user-select:none;user-select:none;height:242px}.empty-text[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{text-align:center;-webkit-user-select:none;user-select:none}"]});let e=t;return e})();var Ire=qie("routeTransition",[Xie("* => *",[GI(":enter",[Zy({opacity:0,scale:.9})],{optional:!0}),GI(":leave",[XU("0.5s",Zy({opacity:0,scale:.9}))],{optional:!0}),GI(":enter",[XU("0.5s",Zy({opacity:1,scale:1}))],{optional:!0})])]);var Pre=(()=>{let t=class t{constructor(r){this.route=r,this.title="sencity"}};t.\u0275fac=function(s){return new(s||t)(_s(Ff))},t.\u0275cmp=xo({type:t,selectors:[["app-root"]],standalone:!0,features:[bo],decls:5,vars:1,consts:[["id","main",2,"height","100%","width","100%","position","absolute","top","0","left","0","overflow","hidden","display","contents"]],template:function(s,n){s&1&&(Os(0,"app-rightbar"),Pn(1,"div",0),Os(2,"router-outlet"),kn(),Os(3,"app-toolbar")(4,"app-topbar")),s&2&&(Qs(),sa("@routeTransition",n.route.snapshot.data))},dependencies:[lc,Uz,Mre,Tre,Dre],data:{animation:[Ire]}});let e=t;return e})();j9(Pre,Ere).catch(e=>console.error(e));
